/*! For license information please see 0ubt4j.9.29869680.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{12574:(H,c,y)=>{"use strict";var Z=y(12578),F=y(12580),P=y(12584);y.g.__TYPEDARRAY_POOL||(y.g.__TYPEDARRAY_POOL={UINT8:F([32,0]),UINT16:F([32,0]),UINT32:F([32,0]),INT8:F([32,0]),INT16:F([32,0]),INT32:F([32,0]),FLOAT:F([32,0]),DOUBLE:F([32,0]),DATA:F([32,0]),UINT8C:F([32,0]),BUFFER:F([32,0])});var S="undefined"!==typeof Uint8ClampedArray,n=y.g.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=F([32,0])),n.BUFFER||(n.BUFFER=F([32,0]));var O=n.DATA,a=n.BUFFER;function i(H){if(H){var c=H.length||H.byteLength,y=Z.log2(c);O[y].push(H)}}function C(H){H=Z.nextPow2(H);var c=Z.log2(H),y=O[c];return y.length>0?y.pop():new ArrayBuffer(H)}function g(H){return new Uint8Array(C(H),0,H)}function v(H){return new Uint16Array(C(2*H),0,H)}function m(H){return new Uint32Array(C(4*H),0,H)}function z(H){return new Int8Array(C(H),0,H)}function V(H){return new Int16Array(C(2*H),0,H)}function h(H){return new Int32Array(C(4*H),0,H)}function Q(H){return new Float32Array(C(4*H),0,H)}function D(H){return new Float64Array(C(8*H),0,H)}function f(H){return S?new Uint8ClampedArray(C(H),0,H):g(H)}function J(H){return new DataView(C(H),0,H)}c.free=function(H){if(P(H))a[Z.log2(H.length)].push(H);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(H)&&(H=H.buffer),!H)return;var c=H.length||H.byteLength,y=0|Z.log2(c);O[y].push(H)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(H){i(H.buffer)},c.freeArrayBuffer=i,c.freeBuffer=function(H){a[Z.log2(H.length)].push(H)},c.malloc=function(H,c){if(void 0===c||"arraybuffer"===c)return C(H);switch(c){case"uint8":return g(H);case"uint16":return v(H);case"uint32":return m(H);case"int8":return z(H);case"int16":return V(H);case"int32":return h(H);case"float":case"float32":return Q(H);case"double":case"float64":return D(H);case"uint8_clamped":return f(H);case"buffer":throw"Buffer not supported";case"data":case"dataview":return J(H);default:return null}return null},c.mallocArrayBuffer=C,c.mallocUint8=g,c.mallocUint16=v,c.mallocUint32=m,c.mallocInt8=z,c.mallocInt16=V,c.mallocInt32=h,c.mallocFloat32=c.mallocFloat=Q,c.mallocFloat64=c.mallocDouble=D,c.mallocUint8Clamped=f,c.mallocDataView=J,c.clearCache=function(){for(var H=0;H<32;++H)n.UINT8[H].length=0,n.UINT16[H].length=0,n.UINT32[H].length=0,n.INT8[H].length=0,n.INT16[H].length=0,n.INT32[H].length=0,n.FLOAT[H].length=0,n.DOUBLE[H].length=0,n.UINT8C[H].length=0,O[H].length=0,a[H].length=0}},12687:(H,c,y)=>{H.exports=F;var Z=y(12015);function F(H,c){if(!(this instanceof F))return new F(H,c);var y=Z.create();Z.add(y,H,c),this.base=Z.min(Z.create(),H,y),this.Wg=Z.clone(c),this.max=Z.max(Z.create(),H,y),this.mag=Z.length(this.Wg)}var P=F.prototype;P.width=function(){return this.Wg[0]},P.height=function(){return this.Wg[1]},P.depth=function(){return this.Wg[2]},P.x0=function(){return this.base[0]},P.y0=function(){return this.base[1]},P.z0=function(){return this.base[2]},P.x1=function(){return this.max[0]},P.y1=function(){return this.max[1]},P.z1=function(){return this.max[2]},P.translate=function(H){return Z.add(this.max,this.max,H),Z.add(this.base,this.base,H),this},P.setPosition=function(H){return Z.add(this.max,H,this.Wg),Z.i(this.base,H),this},P.expand=function(H){var c=Z.create(),y=Z.create();return Z.max(c,H.max,this.max),Z.min(y,H.base,this.base),Z.Rc(c,c,y),new F(y,c)},P.intersects=function(H){return!(H.base[0]>this.max[0])&&(!(H.base[1]>this.max[1])&&(!(H.base[2]>this.max[2])&&(!(H.max[0]<this.base[0])&&(!(H.max[1]<this.base[1])&&!(H.max[2]<this.base[2])))))},P.touches=function(H){var c=this.union(H);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},P.union=function(H){if(!this.intersects(H))return null;var c=Math.max(H.base[0],this.base[0]),y=Math.max(H.base[1],this.base[1]),Z=Math.max(H.base[2],this.base[2]);return new F([c,y,Z],[Math.min(H.max[0],this.max[0])-c,Math.min(H.max[1],this.max[1])-y,Math.min(H.max[2],this.max[2])-Z])}},12578:(H,c)=>{"use strict";function y(H){var c=32;return(H&=-H)&&c--,65535&H&&(c-=16),16711935&H&&(c-=8),252645135&H&&(c-=4),858993459&H&&(c-=2),1431655765&H&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(H){return(H>0)-(H<0)},c.abs=function(H){var c=H>>31;return(H^c)-c},c.min=function(H,c){return c^(H^c)&-(H<c)},c.max=function(H,c){return H^(H^c)&-(H<c)},c.isPow2=function(H){return!(H&H-1)&&!!H},c.log2=function(H){var c,y;return c=(H>65535)<<4,c|=y=((H>>>=c)>255)<<3,c|=y=((H>>>=y)>15)<<2,(c|=y=((H>>>=y)>3)<<1)|(H>>>=y)>>1},c.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},c.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},c.countTrailingZeros=y,c.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},c.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},c.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var Z=new Array(256);!function(H){for(var c=0;c<256;++c){var y=c,Z=c,F=7;for(y>>>=1;y;y>>>=1)Z<<=1,Z|=1&y,--F;H[c]=Z<<F&255}}(Z),c.reverse=function(H){return Z[255&H]<<24|Z[H>>>8&255]<<16|Z[H>>>16&255]<<8|Z[H>>>24&255]},c.interleave2=function(H,c){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(H,c){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>c&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},c.interleave3=function(H,c,y){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},c.deinterleave3=function(H,c){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>c&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},c.nextCombination=function(H){var c=H|H-1;return c+1|(~c&-~c)-1>>>y(H)+1}},12571:(H,c,y)=>{"use strict";H.exports=function(H,c,y){switch(arguments.length){case 1:return Z=[],a(F=H,F,i,!0),Z;case 2:return"function"===typeof c?a(H,H,c,!0):function(H,c){return Z=[],a(H,c,i,!1),Z}(H,c);case 3:return a(H,c,y,!1);default:throw new Error("box-intersect: Invalid arguments")}var F};var Z,F=y(12574),P=y(12591),S=y(12605);function n(H,c){for(var y=0;y<H;++y)if(!(c[y]<=c[y+H]))return!0;return!1}function O(H,c,y,Z){for(var F=0,P=0,S=0,O=H.length;S<O;++S){var a=H[S];if(!n(c,a)){for(var i=0;i<2*c;++i)y[F++]=a[i];Z[P++]=S}}return P}function a(H,c,y,Z){var n=H.length,a=c.length;if(!(n<=0||a<=0)){var i=H[0].length>>>1;if(!(i<=0)){var C,g=F.mallocDouble(2*i*n),v=F.mallocInt32(n);if((n=O(H,i,g,v))>0){if(1===i&&Z)P.init(n),C=P.sweepComplete(i,y,0,n,g,v,0,n,g,v);else{var m=F.mallocDouble(2*i*a),z=F.mallocInt32(a);(a=O(c,i,m,z))>0&&(P.init(n+a),C=1===i?P.sweepBipartite(i,y,0,n,g,v,0,a,m,z):S(i,y,Z,n,g,v,a,m,z),F.free(m),F.free(z))}F.free(g),F.free(v)}return C}}}function i(H,c){Z.push([H,c])}},12613:(H,c)=>{"use strict";var y="d",Z="ax",F="fp",P="es",S="rs",n="re",O="rb",a="bs",i="be",C="bb",g=[y,Z,"vv",S,n,O,"ri",a,i,C,"bi"];function v(H){var c="bruteForce"+(H?"Full":"Partial"),Z=[],S=g.slice();H||S.splice(3,0,F);var n=["function "+c+"("+S.join()+"){"];function O(c,F){var S=function(H,c,Z){var F="bruteForce"+(H?"Red":"Blue")+(c?"Flip":"")+(Z?"Full":""),S=["function ",F,"(",g.join(),"){","var ",P,"=2*",y,";"],n="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",O="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return H?S.push(n,"Q",":",O):S.push(O,"Q",":",n),Z?S.push("if(y1<x0||x1<y0)continue;"):c?S.push("if(y0<=x0||x1<y0)continue;"):S.push("if(y0<x0||x1<y0)continue;"),S.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?S.push("yi,xi"):S.push("xi,yi"),S.push(");if(rv!==void 0)return rv;}}}"),{name:F,code:S.join("")}}(c,F,H);Z.push(S.code),n.push("return "+S.name+"("+g.join()+");")}n.push("if(re-rs>be-bs){"),H?(O(!0,!1),n.push("}else{"),O(!1,!1)):(n.push("if(fp){"),O(!0,!0),n.push("}else{"),O(!0,!1),n.push("}}else{if(fp){"),O(!1,!0),n.push("}else{"),O(!1,!1),n.push("}")),n.push("}}return "+c);var a=Z.join("")+n.join("");return new Function(a)()}c.partial=v(!1),c.full=v(!0)},12605:(H,c,y)=>{"use strict";H.exports=function(H,c,y,P,i,E,U,G,p){!function(H,c){var y=8*F.log2(c+1)*(H+1)|0,P=F.nextPow2(f*y);l.length<P&&(Z.free(l),l=Z.mallocInt32(P));var S=F.nextPow2(J*y);d.length<S&&(Z.free(d),d=Z.mallocDouble(S))}(H,P+U);var t,o=0,s=2*H;K(o++,0,0,P,0,U,y?16:0,-1/0,1/0),y||K(o++,0,0,U,0,P,1,-1/0,1/0);for(;o>0;){var q=(o-=1)*f,I=l[q],j=l[q+1],k=l[q+2],W=l[q+3],M=l[q+4],x=l[q+5],R=o*J,A=d[R],e=d[R+1],r=1&x,N=!!(16&x),w=i,L=E,b=G,X=p;if(r&&(w=G,L=p,b=i,X=E),!(2&x&&j>=(k=V(H,I,j,k,w,L,e)))&&!(4&x&&(j=h(H,I,j,k,w,L,A))>=k)){var B=k-j,Y=M-W;if(N){if(H*B*(B+Y)<v){if(void 0!==(t=O.scanComplete(H,I,c,j,k,w,L,W,M,b,X)))return t;continue}}else{if(H*Math.min(B,Y)<C){if(void 0!==(t=S(H,I,c,r,j,k,w,L,W,M,b,X)))return t;continue}if(H*B*Y<g){if(void 0!==(t=O.scanBipartite(H,I,c,r,j,k,w,L,W,M,b,X)))return t;continue}}var HH=m(H,I,j,k,w,L,A,e);if(j<HH)if(H*(HH-j)<C){if(void 0!==(t=n(H,I+1,c,j,HH,w,L,W,M,b,X)))return t}else if(I===H-2){if(void 0!==(t=r?O.sweepBipartite(H,c,W,M,b,X,j,HH,w,L):O.sweepBipartite(H,c,j,HH,w,L,W,M,b,X)))return t}else K(o++,I+1,j,HH,W,M,r,-1/0,1/0),K(o++,I+1,W,M,j,HH,1^r,-1/0,1/0);if(HH<k){var cH=a(H,I,W,M,b,X),yH=b[s*cH+I],ZH=z(H,I,cH,M,b,X,yH);if(ZH<M&&K(o++,I,HH,k,ZH,M,(4|r)+(N?16:0),yH,e),W<cH&&K(o++,I,HH,k,W,cH,(2|r)+(N?16:0),A,yH),cH+1===ZH){if(void 0!==(t=N?u(H,I,c,HH,k,w,L,cH,b,X[cH]):T(H,I,c,r,HH,k,w,L,cH,b,X[cH])))return t}else if(cH<ZH){var FH;if(N){if(HH<(FH=Q(H,I,HH,k,w,L,yH))){var PH=z(H,I,HH,FH,w,L,yH);if(I===H-2){if(HH<PH&&void 0!==(t=O.sweepComplete(H,c,HH,PH,w,L,cH,ZH,b,X)))return t;if(PH<FH&&void 0!==(t=O.sweepBipartite(H,c,PH,FH,w,L,cH,ZH,b,X)))return t}else HH<PH&&K(o++,I+1,HH,PH,cH,ZH,16,-1/0,1/0),PH<FH&&(K(o++,I+1,PH,FH,cH,ZH,0,-1/0,1/0),K(o++,I+1,cH,ZH,PH,FH,1,-1/0,1/0))}}else HH<(FH=r?D(H,I,HH,k,w,L,yH):Q(H,I,HH,k,w,L,yH))&&(I===H-2?t=r?O.sweepBipartite(H,c,cH,ZH,b,X,HH,FH,w,L):O.sweepBipartite(H,c,HH,FH,w,L,cH,ZH,b,X):(K(o++,I+1,HH,FH,cH,ZH,r,-1/0,1/0),K(o++,I+1,cH,ZH,HH,FH,1^r,-1/0,1/0)))}}}}};var Z=y(12574),F=y(12578),P=y(12613),S=P.partial,n=P.full,O=y(12591),a=y(12621),i=y(12629),C=128,g=1<<22,v=1<<22,m=i("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),z=i("lo===p0",["p0"]),V=i("lo<p0",["p0"]),h=i("hi<=p0",["p0"]),Q=i("lo<=p0&&p0<=hi",["p0"]),D=i("lo<p0&&p0<=hi",["p0"]),f=6,J=2,l=Z.mallocInt32(1024),d=Z.mallocDouble(1024);function K(H,c,y,Z,F,P,S,n,O){var a=f*H;l[a]=c,l[a+1]=y,l[a+2]=Z,l[a+3]=F,l[a+4]=P,l[a+5]=S;var i=J*H;d[i]=n,d[i+1]=O}function T(H,c,y,Z,F,P,S,n,O,a,i){var C=2*H,g=O*C,v=a[g+c];H:for(var m=F,z=F*C;m<P;++m,z+=C){var V=S[z+c],h=S[z+c+H];if(!(v<V||h<v)&&(!Z||v!==V)){for(var Q,D=n[m],f=c+1;f<H;++f){V=S[z+f],h=S[z+f+H];var J=a[g+f],l=a[g+f+H];if(h<J||l<V)continue H}if(void 0!==(Q=Z?y(i,D):y(D,i)))return Q}}}function u(H,c,y,Z,F,P,S,n,O,a){var i=2*H,C=n*i,g=O[C+c];H:for(var v=Z,m=Z*i;v<F;++v,m+=i){var z=S[v];if(z!==a){var V=P[m+c],h=P[m+c+H];if(!(g<V||h<g)){for(var Q=c+1;Q<H;++Q){V=P[m+Q],h=P[m+Q+H];var D=O[C+Q],f=O[C+Q+H];if(h<D||f<V)continue H}var J=y(z,a);if(void 0!==J)return J}}}}},12621:(H,c,y)=>{"use strict";H.exports=function(H,c,y,S,n,O){if(S<=y+1)return y;var a=y,i=S,C=S+y>>>1,g=2*H,v=C,m=n[g*C+c];for(;a<i;){if(i-a<F){P(H,c,a,i,n,O),m=n[g*C+c];break}var z=i-a,V=Math.random()*z+a|0,h=n[g*V+c],Q=Math.random()*z+a|0,D=n[g*Q+c],f=Math.random()*z+a|0,J=n[g*f+c];h<=D?J>=D?(v=Q,m=D):h>=J?(v=V,m=h):(v=f,m=J):D>=J?(v=Q,m=D):J>=h?(v=V,m=h):(v=f,m=J);for(var l=g*(i-1),d=g*v,K=0;K<g;++K,++l,++d){var T=n[l];n[l]=n[d],n[d]=T}var u=O[i-1];O[i-1]=O[v],O[v]=u;for(l=g*(i-1),d=g*(v=Z(H,c,a,i-1,n,O,m)),K=0;K<g;++K,++l,++d){T=n[l];n[l]=n[d],n[d]=T}u=O[i-1];if(O[i-1]=O[v],O[v]=u,C<v){for(i=v-1;a<i&&n[g*(i-1)+c]===m;)i-=1;i+=1}else{if(!(v<C))break;for(a=v+1;a<i&&n[g*a+c]===m;)a+=1}}return Z(H,c,y,C,n,O,n[g*C+c])};var Z=y(12629)("lo<p0",["p0"]),F=8;function P(H,c,y,Z,F,P){for(var S=2*H,n=S*(y+1)+c,O=y+1;O<Z;++O,n+=S)for(var a=F[n],i=O,C=S*(O-1);i>y&&F[C+c]>a;--i,C-=S){for(var g=C,v=C+S,m=0;m<S;++m,++g,++v){var z=F[g];F[g]=F[v],F[v]=z}var V=P[i];P[i]=P[i-1],P[i-1]=V}}},12629:H=>{"use strict";H.exports=function(H,y){var Z="abcdef".split("").concat(y),F=[];H.indexOf("lo")>=0&&F.push("lo=e[k+n]");H.indexOf("hi")>=0&&F.push("hi=e[k+o]");return Z.push(c.replace("_",F.join()).replace("$",H)),Function.apply(void 0,Z)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12598:H=>{"use strict";H.exports=function(H,Z){Z<=4*c?y(0,Z-1,H):a(0,Z-1,H)};var c=32;function y(H,c,y){for(var Z=2*(H+1),F=H+1;F<=c;++F){for(var P=y[Z++],S=y[Z++],n=F,O=Z-2;n-- >H;){var a=y[O-2],i=y[O-1];if(a<P)break;if(a===P&&i<S)break;y[O]=a,y[O+1]=i,O-=2}y[O]=P,y[O+1]=S}}function Z(H,c,y){c*=2;var Z=y[H*=2],F=y[H+1];y[H]=y[c],y[H+1]=y[c+1],y[c]=Z,y[c+1]=F}function F(H,c,y){c*=2,y[H*=2]=y[c],y[H+1]=y[c+1]}function P(H,c,y,Z){c*=2,y*=2;var F=Z[H*=2],P=Z[H+1];Z[H]=Z[c],Z[H+1]=Z[c+1],Z[c]=Z[y],Z[c+1]=Z[y+1],Z[y]=F,Z[y+1]=P}function S(H,c,y,Z,F){c*=2,F[H*=2]=F[c],F[c]=y,F[H+1]=F[c+1],F[c+1]=Z}function n(H,c,y){c*=2;var Z=y[H*=2],F=y[c];return!(Z<F)&&(Z!==F||y[H+1]>y[c+1])}function O(H,c,y,Z){var F=Z[H*=2];return F<c||F===c&&Z[H+1]<y}function a(H,i,C){var g=(i-H+1)/6|0,v=H+g,m=i-g,z=H+i>>1,V=z-g,h=z+g,Q=v,D=V,f=z,J=h,l=m,d=H+1,K=i-1,T=0;n(Q,D,C)&&(T=Q,Q=D,D=T),n(J,l,C)&&(T=J,J=l,l=T),n(Q,f,C)&&(T=Q,Q=f,f=T),n(D,f,C)&&(T=D,D=f,f=T),n(Q,J,C)&&(T=Q,Q=J,J=T),n(f,J,C)&&(T=f,f=J,J=T),n(D,l,C)&&(T=D,D=l,l=T),n(D,f,C)&&(T=D,D=f,f=T),n(J,l,C)&&(T=J,J=l,l=T);for(var u=C[2*D],E=C[2*D+1],U=C[2*J],G=C[2*J+1],p=2*Q,t=2*f,o=2*l,s=2*v,q=2*z,I=2*m,j=0;j<2;++j){var k=C[p+j],W=C[t+j],M=C[o+j];C[s+j]=k,C[q+j]=W,C[I+j]=M}F(V,H,C),F(h,i,C);for(var x=d;x<=K;++x)if(O(x,u,E,C))x!==d&&Z(x,d,C),++d;else if(!O(x,U,G,C))for(;;){if(O(K,U,G,C)){O(K,u,E,C)?(P(x,d,K,C),++d,--K):(Z(x,K,C),--K);break}if(--K<x)break}S(H,d-1,u,E,C),S(i,K+1,U,G,C),d-2-H<=c?y(H,d-2,C):a(H,d-2,C),i-(K+2)<=c?y(K+2,i,C):a(K+2,i,C),K-d<=c?y(d,K,C):a(d,K,C)}},12591:(H,c,y)=>{"use strict";H.exports={init:function(H){var c=F.nextPow2(H);O.length<c&&(Z.free(O),O=Z.mallocInt32(c));a.length<c&&(Z.free(a),a=Z.mallocInt32(c));i.length<c&&(Z.free(i),i=Z.mallocInt32(c));C.length<c&&(Z.free(C),C=Z.mallocInt32(c));g.length<c&&(Z.free(g),g=Z.mallocInt32(c));v.length<c&&(Z.free(v),v=Z.mallocInt32(c));var y=8*c;m.length<y&&(Z.free(m),m=Z.mallocDouble(y))},sweepBipartite:function(H,c,y,Z,F,n,g,v,h,Q){for(var D=0,f=2*H,J=H-1,l=f-1,d=y;d<Z;++d){var K=n[d],T=f*d;m[D++]=F[T+J],m[D++]=-(K+1),m[D++]=F[T+l],m[D++]=K}for(d=g;d<v;++d){K=Q[d]+S;var u=f*d;m[D++]=h[u+J],m[D++]=-K,m[D++]=h[u+l],m[D++]=K}var E=D>>>1;P(m,E);var U=0,G=0;for(d=0;d<E;++d){var p=0|m[2*d+1];if(p>=S)z(i,C,G--,p=p-S|0);else if(p>=0)z(O,a,U--,p);else if(p<=-S){p=-p-S|0;for(var t=0;t<U;++t){if(void 0!==(o=c(O[t],p)))return o}V(i,C,G++,p)}else{p=-p-1|0;for(t=0;t<G;++t){var o;if(void 0!==(o=c(p,i[t])))return o}V(O,a,U++,p)}}},sweepComplete:function(H,c,y,Z,F,S,n,h,Q,D){for(var f=0,J=2*H,l=H-1,d=J-1,K=y;K<Z;++K){var T=S[K]+1<<1,u=J*K;m[f++]=F[u+l],m[f++]=-T,m[f++]=F[u+d],m[f++]=T}for(K=n;K<h;++K){T=D[K]+1<<1;var E=J*K;m[f++]=Q[E+l],m[f++]=1|-T,m[f++]=Q[E+d],m[f++]=1|T}var U=f>>>1;P(m,U);var G=0,p=0,t=0;for(K=0;K<U;++K){var o=0|m[2*K+1],s=1&o;if(K<U-1&&o>>1===m[2*K+3]>>1&&(s=2,K+=1),o<0){for(var q=-(o>>1)-1,I=0;I<t;++I){if(void 0!==(j=c(g[I],q)))return j}if(0!==s)for(I=0;I<G;++I){if(void 0!==(j=c(O[I],q)))return j}if(1!==s)for(I=0;I<p;++I){var j;if(void 0!==(j=c(i[I],q)))return j}0===s?V(O,a,G++,q):1===s?V(i,C,p++,q):2===s&&V(g,v,t++,q)}else{q=(o>>1)-1;0===s?z(O,a,G--,q):1===s?z(i,C,p--,q):2===s&&z(g,v,t--,q)}}},scanBipartite:function(H,c,y,Z,F,n,i,C,g,v,h,Q){var D=0,f=2*H,J=c,l=c+H,d=1,K=1;Z?K=S:d=S;for(var T=F;T<n;++T){var u=T+d,E=f*T;m[D++]=i[E+J],m[D++]=-u,m[D++]=i[E+l],m[D++]=u}for(T=g;T<v;++T){u=T+K;var U=f*T;m[D++]=h[U+J],m[D++]=-u}var G=D>>>1;P(m,G);var p=0;for(T=0;T<G;++T){var t=0|m[2*T+1];if(t<0){var o=!1;if((u=-t)>=S?(o=!Z,u-=S):(o=!!Z,u-=1),o)V(O,a,p++,u);else{var s=Q[u],q=f*u,I=h[q+c+1],j=h[q+c+1+H];H:for(var k=0;k<p;++k){var W=O[k],M=f*W;if(!(j<i[M+c+1]||i[M+c+1+H]<I)){for(var x=c+2;x<H;++x)if(h[q+x+H]<i[M+x]||i[M+x+H]<h[q+x])continue H;var R,A=C[W];if(void 0!==(R=Z?y(s,A):y(A,s)))return R}}}}else z(O,a,p--,t-d)}},scanComplete:function(H,c,y,Z,F,n,a,i,C,g,v){for(var z=0,V=2*H,h=c,Q=c+H,D=Z;D<F;++D){var f=D+S,J=V*D;m[z++]=n[J+h],m[z++]=-f,m[z++]=n[J+Q],m[z++]=f}for(D=i;D<C;++D){f=D+1;var l=V*D;m[z++]=g[l+h],m[z++]=-f}var d=z>>>1;P(m,d);var K=0;for(D=0;D<d;++D){var T=0|m[2*D+1];if(T<0){if((f=-T)>=S)O[K++]=f-S;else{var u=v[f-=1],E=V*f,U=g[E+c+1],G=g[E+c+1+H];H:for(var p=0;p<K;++p){var t=O[p],o=a[t];if(o===u)break;var s=V*t;if(!(G<n[s+c+1]||n[s+c+1+H]<U)){for(var q=c+2;q<H;++q)if(g[E+q+H]<n[s+q]||n[s+q+H]<g[E+q])continue H;var I=y(o,u);if(void 0!==I)return I}}}}else{for(f=T-S,p=K-1;p>=0;--p)if(O[p]===f){for(q=p+1;q<K;++q)O[q-1]=O[q];break}--K}}}};var Z=y(12574),F=y(12578),P=y(12598),S=1<<28,n=1024,O=Z.mallocInt32(n),a=Z.mallocInt32(n),i=Z.mallocInt32(n),C=Z.mallocInt32(n),g=Z.mallocInt32(n),v=Z.mallocInt32(n),m=Z.mallocDouble(8192);function z(H,c,y,Z){var F=c[Z],P=H[y-1];H[F]=P,c[P]=F}function V(H,c,y,Z){H[y]=Z,c[Z]=y}},12580:H=>{"use strict";function c(H,y,Z){var F=0|H[Z];if(F<=0)return[];var P,S=new Array(F);if(Z===H.length-1)for(P=0;P<F;++P)S[P]=y;else for(P=0;P<F;++P)S[P]=c(H,y,Z+1);return S}H.exports=function(H,y){switch("undefined"===typeof y&&(y=0),typeof H){case"number":if(H>0)return function(H,c){var y,Z;for(y=new Array(H),Z=0;Z<H;++Z)y[Z]=c;return y}(0|H,y);break;case"object":if("number"===typeof H.length)return c(H,y,0)}return[]}},12539:(H,c,y)=>{H.exports=function(){var H=this;this.components={},this.comps=this.components;var c=this.components,y=1,F={},P=[],S=[],n={timeout:!1,removals:[],multiComps:[]};function O(H,y){var Z=c[y],P=F[y],S=P.hash[H];S&&(P.remove(H),Z.ab&&(Z.multi?(S.forEach((c=>{c&&Z.ab(H,c)})),S.length=0):Z.ab(H,S)),n.removals.push(P),a())}function a(){n.timeout||(n.timeout=!0,setTimeout(i,1))}function i(){n.timeout=!1,C()}function C(){n.multiComps.length&&function(H){for(var c=0;c<H.length;c++){var{entID:y,data:Z}=H[c],F=Z.hash[y];if(F){for(var P=0;P<F.length;P++)F[P]||(F.splice(P,1),P--);0===F.length&&(Z.remove(y),n.removals.push(Z))}}H.length=0}(n.multiComps),n.removals.length&&function(H){for(var c=0;c<H.length;c++){H[c].flush()}H.length=0}(n.removals)}this.Ci=F,this._systems=P,this._renderSystems=S,this.bh=function(c){var Z=y++;return Array.isArray(c)&&c.forEach((c=>H.bf(Z,c))),Z},this.deleteEntity=function(c){return Object.keys(F).forEach((H=>{F[H].hash[c]&&O(c,H)})),H},this.Dh=function(H){if(!H)throw new Error("Missing component definition");var y=H.name;if(!y)throw new Error("Component definition must have a name property.");if("string"!==typeof y)throw new Error("Component name must be a string.");if(""===y)throw new Error("Component name must be a non-empty string.");if(F[y])throw new Error(`Component ${y} already exists.`);var n={};return n.name=y,n.multi=!!H.multi,n.order=isNaN(H.order)?99:H.order,n.stateConstructor=H.stateConstructor||null,n.state=H.state||{},n.Jd=H.Jd||null,n.ab=H.ab||null,n.system=H.system||null,n.Ud=H.Ud||null,c[y]=n,F[y]=new Z,F[y]._pendingMultiCleanup=!1,F[y]._multiCleanupIDs=n.multi?[]:null,n.system&&(P.push(y),P.sort(((H,y)=>c[H].order-c[y].order))),n.Ud&&(S.push(y),S.sort(((H,y)=>c[H].order-c[y].order))),y},this.overwriteComponent=function(H,y){var Z=c[H];if(!Z)throw new Error(`Unknown component: ${H}`);if(!y)throw new Error("Missing component definition");if(Z.name!==y.name)throw new Error("Overwriting component must use the same name property.");var n={};n.name=H,n.multi=!!y.multi,n.order=isNaN(y.order)?99:y.order,n.state=y.state||{},n.Jd=y.Jd||null,n.ab=y.ab||null,n.system=y.system||null,n.Ud=y.Ud||null,c[H]=n,F[H]._pendingMultiCleanup=!1,F[H]._multiCleanupIDs=n.multi?[]:null;var O=P.indexOf(H);n.system&&O<0&&P.push(H),!n.system&&O>=0&&P.splice(O,1),P.sort(((H,y)=>c[H].order-c[y].order));var a=S.indexOf(H);n.Ud&&a<0&&S.push(H),!n.Ud&&a>=0&&S.splice(a,1),S.sort(((H,y)=>c[H].order-c[y].order));var i=n.state;return this.zg(H).forEach((H=>{for(var c in i)c in H||(H[c]=i[c]);n.Jd&&n.Jd(H.Rd,H)})),H},this.deleteComponent=function(y){var Z=F[y];if(!Z)throw new Error(`Unknown component: ${y}`);Z.flush(),Z.list.forEach((H=>{H&&O(H.Rd||H[0].Rd,y)}));var n=P.indexOf(y),a=S.indexOf(y);return n>-1&&P.splice(n,1),a>-1&&S.splice(a,1),F[y].dispose(),delete F[y],delete c[y],H},this.bf=function(H,y,Z){var P,S=c[y],n=F[y];if(!n)throw new Error(`Unknown component: ${y}.`);if(n.hash[H]&&!S.multi)throw new Error(`Entity ${H} already has component: ${y}.`);if(S.stateConstructor){if(!(P=new S.stateConstructor).hasOwnProperty("Rd"))throw new Error(`Component ${S.name} stateConstructor type does not have property __id`)}else P=Object.assign({},{Rd:H},S.state,Z);if(P.Rd=H,S.multi){var O=n.hash[H];O||(O=[],n.add(H,O)),O.push(P)}else n.add(H,P);return S.Jd&&S.Jd(H,P),this},this.mf=function(H,c){var y=F[c];if(!y)throw new Error(`Unknown component: ${c}.`);return!!y.hash[H]},this.ff=function(c,y){if(!F[y])throw new Error(`Unknown component: ${y}.`);return O(c,y),H},this.getState=function(H,c){var y=F[c];if(!y)throw new Error(`Unknown component: ${c}.`);return y.hash[H]},this.zg=function(H){var c=F[H];if(!c)throw new Error(`Unknown component: ${H}.`);return C(),c.list},this.xk=function(H){if(!F[H])throw new Error(`Unknown component: ${H}.`);var c=F[H].hash;return H=>c[H]},this.Ak=function(H){if(!F[H])throw new Error(`Unknown component: ${H}.`);var c=F[H].hash;return H=>!!c[H]},this.Ed=function(y){C();for(var Z=0;Z<P.length;Z++){var S=P[Z],n=c[S],O=F[S];n.system(y,O.list),C()}return H},this.render=function(y){C();for(var Z=0;Z<S.length;Z++){var P=S[Z],n=c[P],O=F[P];n.Ud(y,O.list),C()}return H},this.removeMultiComponent=function(y,Z,P){var S=c[Z],O=F[Z];if(!O)throw new Error(`Unknown component: ${Z}.`);if(!S.multi)throw new Error("removeMultiComponent called on non-multi component");return function(H,c,y,Z){var F=y.hash[H];if(F){var P=F[Z];P&&(F[Z]=null,c.ab&&c.ab(H,P),n.multiComps.push({entID:H,data:y}),a())}}(y,S,O,P),H}};var Z=y(12546)},12546:H=>{function c(H,c){var y=H._map[c];if(delete H.hash[c],delete H._map[c],y===H.list.length-1)H.list.pop();else{var Z=H.list.pop();if(H.list[y]=Z,null===Z||null===Z[0]){var F=H.list.length;for(var P in H._map)if(H._map[P]===F)return void(H._map[P]=y)}else{var S=Z.Rd||Z[0].Rd;H._map[S]=y}}}H.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(H,c){if("number"===typeof this._map[H]){var y=this._map[H];this.hash[H]=c,this.list[y]=c}else this._map[H]=this.list.length,this.hash[H]=c,this.list.push(c)}remove(H){var c=this._map[H];this.hash[H]=null,this.list[c]=null,this._pendingRemovals.push(H)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var H=0;H<this._pendingRemovals.length;H++){var y=this._pendingRemovals[H];null===this.hash[y]&&c(this,y)}this._pendingRemovals.length=0}}},12501:H=>{"use strict";var c,y="object"===typeof Reflect?Reflect:null,Z=function(H,c,y){return Function.prototype.apply.call(H,c,y)};c=y&&"function"===typeof y.ownKeys?y.ownKeys:Object.getOwnPropertySymbols?function(H){return Object.getOwnPropertyNames(H).concat(Object.getOwnPropertySymbols(H))}:function(H){return Object.getOwnPropertyNames(H)};var F=Number.isNaN||function(H){return H!==H};function P(){P.init.call(this)}H.exports=P,H.exports.once=function(H,c){return new Promise((function(y,Z){function F(y){H.removeListener(c,P),Z(y)}function P(){"function"===typeof H.removeListener&&H.removeListener("error",F),y([].slice.call(arguments))}z(H,c,P,{once:!0}),"error"!==c&&function(H,c,y){"function"===typeof H.on&&z(H,"error",c,y)}(H,F,{once:!0})}))},P.EventEmitter=P,P.prototype._events=void 0,P.prototype._eventsCount=0,P.prototype._maxListeners=void 0;var S=10;function n(H){if("function"!==typeof H)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof H)}function O(H){return void 0===H._maxListeners?P.defaultMaxListeners:H._maxListeners}function a(H,c,y,Z){var F,P,S,a;if(n(y),void 0===(P=H._events)?(P=H._events=Object.create(null),H._eventsCount=0):(void 0!==P.newListener&&(H.emit("newListener",c,y.listener?y.listener:y),P=H._events),S=P[c]),void 0===S)S=P[c]=y,++H._eventsCount;else if("function"===typeof S?S=P[c]=Z?[y,S]:[S,y]:Z?S.unshift(y):S.push(y),(F=O(H))>0&&S.length>F&&!S.warned){S.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+S.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.j=H,i.type=c,i.count=S.length,a=i,console&&console.warn&&console.warn(a)}return H}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(H,c,y){var Z={fired:!1,wrapFn:void 0,target:H,type:c,listener:y},F=i.bind(Z);return F.listener=y,Z.wrapFn=F,F}function g(H,c,y){var Z=H._events;if(void 0===Z)return[];var F=Z[c];return void 0===F?[]:"function"===typeof F?y?[F.listener||F]:[F]:y?function(H){for(var c=new Array(H.length),y=0;y<c.length;++y)c[y]=H[y].listener||H[y];return c}(F):m(F,F.length)}function v(H){var c=this._events;if(void 0!==c){var y=c[H];if("function"===typeof y)return 1;if(void 0!==y)return y.length}return 0}function m(H,c){for(var y=new Array(c),Z=0;Z<c;++Z)y[Z]=H[Z];return y}function z(H,c,y,Z){if("function"===typeof H.on)Z.once?H.once(c,y):H.on(c,y);else{if("function"!==typeof H.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof H);H.addEventListener(c,(function F(P){Z.once&&H.removeEventListener(c,F),y(P)}))}}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(H){if("number"!==typeof H||H<0||F(H))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+H+".");S=H}}),P.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(H){if("number"!==typeof H||H<0||F(H))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+H+".");return this._maxListeners=H,this},P.prototype.getMaxListeners=function(){return O(this)},P.prototype.emit=function(H){for(var c=[],y=1;y<arguments.length;y++)c.push(arguments[y]);var F="error"===H,P=this._events;if(void 0!==P)F=F&&void 0===P.error;else if(!F)return!1;if(F){var S;if(c.length>0&&(S=c[0]),S instanceof Error)throw S;var n=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw n.context=S,n}var O=P[H];if(void 0===O)return!1;if("function"===typeof O)Z(O,this,c);else{var a=O.length,i=m(O,a);for(y=0;y<a;++y)Z(i[y],this,c)}return!0},P.prototype.addListener=function(H,c){return a(this,H,c,!1)},P.prototype.on=P.prototype.addListener,P.prototype.prependListener=function(H,c){return a(this,H,c,!0)},P.prototype.once=function(H,c){return n(c),this.on(H,C(this,H,c)),this},P.prototype.prependOnceListener=function(H,c){return n(c),this.prependListener(H,C(this,H,c)),this},P.prototype.removeListener=function(H,c){var y,Z,F,P,S;if(n(c),void 0===(Z=this._events))return this;if(void 0===(y=Z[H]))return this;if(y===c||y.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete Z[H],Z.removeListener&&this.emit("removeListener",H,y.listener||c));else if("function"!==typeof y){for(F=-1,P=y.length-1;P>=0;P--)if(y[P]===c||y[P].listener===c){S=y[P].listener,F=P;break}if(F<0)return this;0===F?y.shift():function(H,c){for(;c+1<H.length;c++)H[c]=H[c+1];H.pop()}(y,F),1===y.length&&(Z[H]=y[0]),void 0!==Z.removeListener&&this.emit("removeListener",H,S||c)}return this},P.prototype.off=P.prototype.removeListener,P.prototype.removeAllListeners=function(H){var c,y,Z;if(void 0===(y=this._events))return this;if(void 0===y.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==y[H]&&(0===--this._eventsCount?this._events=Object.create(null):delete y[H]),this;if(0===arguments.length){var F,P=Object.keys(y);for(Z=0;Z<P.length;++Z)"removeListener"!==(F=P[Z])&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=y[H]))this.removeListener(H,c);else if(void 0!==c)for(Z=c.length-1;Z>=0;Z--)this.removeListener(H,c[Z]);return this},P.prototype.listeners=function(H){return g(this,H,!0)},P.prototype.rawListeners=function(H){return g(this,H,!1)},P.listenerCount=function(H,c){return"function"===typeof H.listenerCount?H.listenerCount(c):v.call(H,c)},P.prototype.listenerCount=v,P.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},12845:H=>{"use strict";H.exports=function(H,c,y,Z,F,P){var S=+c[0],n=+c[1],O=+c[2],a=+y[0],i=+y[1],C=+y[2],g=Math.sqrt(a*a+i*i+C*C);if(0===g)throw new Error("Can't raycast along a zero vector");return function(H,c,y,Z,F,P,S,n,O,a){for(var i=0,C=Math.floor,g=0|C(c),v=0|C(y),m=0|C(Z),z=F>0?1:-1,V=P>0?1:-1,h=S>0?1:-1,Q=Math.abs(1/F),D=Math.abs(1/P),f=Math.abs(1/S),J=Q<1/0?Q*(z>0?g+1-c:c-g):1/0,l=D<1/0?D*(V>0?v+1-y:y-v):1/0,d=f<1/0?f*(h>0?m+1-Z:Z-m):1/0,K=-1;i<=n;){var T=H(g,v,m);if(T)return O&&(O[0]=c+i*F,O[1]=y+i*P,O[2]=Z+i*S),a&&(a[0]=a[1]=a[2]=0,0===K&&(a[0]=-z),1===K&&(a[1]=-V),2===K&&(a[2]=-h)),T;J<l?J<d?(g+=z,i=J,J+=Q,K=0):(m+=h,i=d,d+=f,K=2):l<d?(v+=V,i=l,l+=D,K=1):(m+=h,i=d,d+=f,K=2)}return O&&(O[0]=c+i*F,O[1]=y+i*P,O[2]=Z+i*S),a&&(a[0]=a[1]=a[2]=0),0}(H,S,n,O,a/=g,i/=g,C/=g,Z="undefined"===typeof Z?64:+Z,F,P)}},12872:(H,c,y)=>{"use strict";y.d(c,{e:()=>P});var Z=y(12501);function F(){this.vj=!1,this.stopPropagation=!1,this.wj=!1,this.disabled=!1}class P{constructor(H,c){this.version="0.7.0";var y=Object.assign({},new F,c||{});this.element=H||document,this.vj=!!y.vj,this.stopPropagation=!!y.stopPropagation,this.wj=!!y.wj,this.disabled=!!y.disabled,this.filterEvents=(H,c)=>!0,this.down=new Z.EventEmitter,this.up=new Z.EventEmitter,this.state={},this.qg={dx:0,dy:0,nk:0,og:0,pk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?n(this):document.addEventListener("DOMContentLoaded",(H=>{n(this)}),{once:!0})}bind(H){for(var c=arguments.length,y=new Array(c>1?c-1:0),Z=1;Z<c;Z++)y[Z-1]=arguments[Z];y.forEach((c=>{var y=this._keyBindmap[c]||[];y.includes(H)||(y.push(H),this._keyBindmap[c]=y)})),this.state[H]=!!this.state[H],this.pressCount[H]=this.pressCount[H]||0,this.releaseCount[H]=this.releaseCount[H]||0}unbind(H){for(var c in this._keyBindmap){var y=this._keyBindmap[c],Z=y.indexOf(H);Z>-1&&y.splice(Z,1)}}getBindings(){var H={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((y=>{H[y]=H[y]||[],H[y].push(c)}))}return H}Ed(){S(this.qg),S(this.pressCount),S(this.releaseCount)}}function S(H){for(var c in H)H[c]=0}function n(H){window.addEventListener("keydown",m.bind(null,H,!0),!1),window.addEventListener("keyup",m.bind(null,H,!1),!1);var c={passive:!0};H.element.addEventListener("touchstart",C.bind(void 0,H),{passive:!1}),H.element.addEventListener("touchend",v.bind(void 0,H),c),H.element.addEventListener("mousedown",z.bind(null,H,!0),c),window.document.addEventListener("mouseup",z.bind(null,H,!1),c),H.element.addEventListener("touchmove",V.bind(null,H),c),H.element.addEventListener("mousemove",V.bind(null,H),c),window.PointerEvent,H.element.addEventListener("wheel",h.bind(null,H),c),H.element.addEventListener("contextmenu",Q.bind(null,H),!1),window.addEventListener("blur",D.bind(null,H),!1)}var O=0,a=0,i=null;function C(H,c){c.preventDefault(),g(c)}function g(H){let c=!1;for(let y=0;y<H.touches.length;++y)if(H.touches[y].identifier===i){c=!0;break}if(!c){const c=H.changedTouches[0];O=c.clientX,a=c.clientY,i=c.identifier}}function v(H,c){for(var y=c.changedTouches,Z=0;Z<y.length;++Z)y[Z].identifier===i&&(i=null)}function m(H,c,y){f(y.code,c,H,y)}function z(H,c,y){if("pointerId"in y)if(c){if(null!==H._touches.currID)return;H._touches.currID=y.pointerId}else{if(H._touches.currID!==y.pointerId)return;H._touches.currID=null}return f("Mouse"+("button"in y?y.button+1:1),c,H,y),!1}function V(H,c){var y=c.movementX||c.mozMovementX||0,Z=c.movementY||c.mozMovementY||0;if(c.touches&&0===(y|Z)){var F=function(H){g(H);for(let c=0;c<H.changedTouches.length;++c)if(H.changedTouches[c].identifier==i){const y=H.changedTouches[c],Z=[y.clientX-O,y.clientY-a];return O=y.clientX,a=y.clientY,Z}return console.error(`Did not find touch id ${i}`),[0,0]}(c);y=F[0],Z=F[1]}H.qg.dx+=y,H.qg.dy+=Z}function h(H,c){var y=1;switch(c.deltaMode){case 0:y=1;break;case 1:y=12;break;case 2:y=H.element.clientHeight||window.innerHeight}H.qg.nk+=(c.deltaX||0)*y,H.qg.og+=(c.deltaY||0)*y,H.qg.pk+=(c.deltaZ||0)*y}function Q(H,c){if(!H.wj)return c.preventDefault(),!1}function D(H){for(var c in H._keyStates)H._keyStates[c]&&(/^Mouse\d/.test(c)||f(c,!1,H,{code:c,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(H,c,y,Z){var F=y._keyBindmap[H];F&&(J(y._keyStates[H],c)&&(y._keyStates[H]=c,F.forEach((H=>{(!y.filterEvents||y.filterEvents(Z,H))&&function(H,c,y,Z){var F=c?y.pressCount:y.releaseCount;F[H]=(F[H]||0)+1;var P=y._bindPressCount[H]||0;(P+=c?1:-1)<0&&(P=0);y._bindPressCount[H]=P;var S=y.state[H];if(J(S,P)){y.state[H]=P>0;var n=c?y.down:y.up;y.disabled||n.emit(H,Z)}}(H,c,y,Z)}))),"button"in Z||(y.vj&&!Z.defaultPrevented&&Z.preventDefault(),y.stopPropagation&&Z.stopPropagation()))}function J(H,c){return H?!c:c}},12085:H=>{H.exports=function(H,c,y){return H[0]=c[0]+y[0],H[1]=c[1]+y[1],H[2]=c[2]+y[2],H}},12036:(H,c,y)=>{H.exports=function(H,c){var y=Z(H[0],H[1],H[2]),S=Z(c[0],c[1],c[2]);F(y,y),F(S,S);var n=P(y,S);return n>1?0:Math.acos(n)};var Z=y(12045),F=y(12048),P=y(12056)},12122:H=>{H.exports=function(H,c){return H[0]=Math.ceil(c[0]),H[1]=Math.ceil(c[1]),H[2]=Math.ceil(c[2]),H}},12030:H=>{H.exports=function(H){var c=new Float32Array(3);return c[0]=H[0],c[1]=H[1],c[2]=H[2],c}},12064:H=>{H.exports=function(H,c){return H[0]=c[0],H[1]=c[1],H[2]=c[2],H}},12026:H=>{H.exports=function(){var H=new Float32Array(3);return H[0]=0,H[1]=0,H[2]=0,H}},12197:H=>{H.exports=function(H,c,y){var Z=c[0],F=c[1],P=c[2],S=y[0],n=y[1],O=y[2];return H[0]=F*O-P*n,H[1]=P*S-Z*O,H[2]=Z*n-F*S,H}},12152:(H,c,y)=>{H.exports=y(12143)},12143:H=>{H.exports=function(H,c){var y=c[0]-H[0],Z=c[1]-H[1],F=c[2]-H[2];return Math.sqrt(y*y+Z*Z+F*F)}},12109:(H,c,y)=>{H.exports=y(12105)},12105:H=>{H.exports=function(H,c,y){return H[0]=c[0]/y[0],H[1]=c[1]/y[1],H[2]=c[2]/y[2],H}},12056:H=>{H.exports=function(H,c){return H[0]*c[0]+H[1]*c[1]+H[2]*c[2]}},12017:H=>{H.exports=1e-6},12078:(H,c,y)=>{H.exports=function(H,c){var y=H[0],F=H[1],P=H[2],S=c[0],n=c[1],O=c[2];return Math.abs(y-S)<=Z*Math.max(1,Math.abs(y),Math.abs(S))&&Math.abs(F-n)<=Z*Math.max(1,Math.abs(F),Math.abs(n))&&Math.abs(P-O)<=Z*Math.max(1,Math.abs(P),Math.abs(O))};var Z=y(12017)},12082:H=>{H.exports=function(H,c){return H[0]===c[0]&&H[1]===c[1]&&H[2]===c[2]}},12117:H=>{H.exports=function(H,c){return H[0]=Math.floor(c[0]),H[1]=Math.floor(c[1]),H[2]=Math.floor(c[2]),H}},12251:(H,c,y)=>{H.exports=function(H,c,y,F,P,S){var n,O;c||(c=3);y||(y=0);O=F?Math.min(F*c+y,H.length):H.length;for(n=y;n<O;n+=c)Z[0]=H[n],Z[1]=H[n+1],Z[2]=H[n+2],P(Z,Z,S),H[n]=Z[0],H[n+1]=Z[1],H[n+2]=Z[2];return H};var Z=y(12026)()},12045:H=>{H.exports=function(H,c,y){var Z=new Float32Array(3);return Z[0]=H,Z[1]=c,Z[2]=y,Z}},12015:(H,c,y)=>{H.exports={EPSILON:y(12017),create:y(12026),clone:y(12030),angle:y(12036),nd:y(12045),i:y(12064),set:y(12070),equals:y(12078),exactEquals:y(12082),add:y(12085),Rc:y(12092),sub:y(12097),multiply:y(12101),mul:y(12103),divide:y(12105),div:y(12109),min:y(12113),max:y(12115),floor:y(12117),ceil:y(12122),round:y(12125),scale:y(12132),pd:y(12141),distance:y(12143),dist:y(12152),squaredDistance:y(12155),sqrDist:y(12161),length:y(12165),len:y(12169),squaredLength:y(12172),ud:y(12181),negate:y(12186),inverse:y(12188),normalize:y(12048),dot:y(12056),cross:y(12197),ed:y(12206),random:y(12210),transformMat4:y(12218),transformMat3:y(12226),transformQuat:y(12231),vd:y(12235),wd:y(12242),yd:y(12245),forEach:y(12251)}},12188:H=>{H.exports=function(H,c){return H[0]=1/c[0],H[1]=1/c[1],H[2]=1/c[2],H}},12169:(H,c,y)=>{H.exports=y(12165)},12165:H=>{H.exports=function(H){var c=H[0],y=H[1],Z=H[2];return Math.sqrt(c*c+y*y+Z*Z)}},12206:H=>{H.exports=function(H,c,y,Z){var F=c[0],P=c[1],S=c[2];return H[0]=F+Z*(y[0]-F),H[1]=P+Z*(y[1]-P),H[2]=S+Z*(y[2]-S),H}},12115:H=>{H.exports=function(H,c,y){return H[0]=Math.max(c[0],y[0]),H[1]=Math.max(c[1],y[1]),H[2]=Math.max(c[2],y[2]),H}},12113:H=>{H.exports=function(H,c,y){return H[0]=Math.min(c[0],y[0]),H[1]=Math.min(c[1],y[1]),H[2]=Math.min(c[2],y[2]),H}},12103:(H,c,y)=>{H.exports=y(12101)},12101:H=>{H.exports=function(H,c,y){return H[0]=c[0]*y[0],H[1]=c[1]*y[1],H[2]=c[2]*y[2],H}},12186:H=>{H.exports=function(H,c){return H[0]=-c[0],H[1]=-c[1],H[2]=-c[2],H}},12048:H=>{H.exports=function(H,c){var y=c[0],Z=c[1],F=c[2],P=y*y+Z*Z+F*F;P>0&&(P=1/Math.sqrt(P),H[0]=c[0]*P,H[1]=c[1]*P,H[2]=c[2]*P);return H}},12210:H=>{H.exports=function(H,c){c=c||1;var y=2*Math.random()*Math.PI,Z=2*Math.random()-1,F=Math.sqrt(1-Z*Z)*c;return H[0]=Math.cos(y)*F,H[1]=Math.sin(y)*F,H[2]=Z*c,H}},12235:H=>{H.exports=function(H,c,y,Z){var F=y[1],P=y[2],S=c[1]-F,n=c[2]-P,O=Math.sin(Z),a=Math.cos(Z);return H[0]=c[0],H[1]=F+S*a-n*O,H[2]=P+S*O+n*a,H}},12242:H=>{H.exports=function(H,c,y,Z){var F=y[0],P=y[2],S=c[0]-F,n=c[2]-P,O=Math.sin(Z),a=Math.cos(Z);return H[0]=F+n*O+S*a,H[1]=c[1],H[2]=P+n*a-S*O,H}},12245:H=>{H.exports=function(H,c,y,Z){var F=y[0],P=y[1],S=c[0]-F,n=c[1]-P,O=Math.sin(Z),a=Math.cos(Z);return H[0]=F+S*a-n*O,H[1]=P+S*O+n*a,H[2]=c[2],H}},12125:H=>{H.exports=function(H,c){return H[0]=Math.round(c[0]),H[1]=Math.round(c[1]),H[2]=Math.round(c[2]),H}},12132:H=>{H.exports=function(H,c,y){return H[0]=c[0]*y,H[1]=c[1]*y,H[2]=c[2]*y,H}},12141:H=>{H.exports=function(H,c,y,Z){return H[0]=c[0]+y[0]*Z,H[1]=c[1]+y[1]*Z,H[2]=c[2]+y[2]*Z,H}},12070:H=>{H.exports=function(H,c,y,Z){return H[0]=c,H[1]=y,H[2]=Z,H}},12161:(H,c,y)=>{H.exports=y(12155)},12181:(H,c,y)=>{H.exports=y(12172)},12155:H=>{H.exports=function(H,c){var y=c[0]-H[0],Z=c[1]-H[1],F=c[2]-H[2];return y*y+Z*Z+F*F}},12172:H=>{H.exports=function(H){var c=H[0],y=H[1],Z=H[2];return c*c+y*y+Z*Z}},12097:(H,c,y)=>{H.exports=y(12092)},12092:H=>{H.exports=function(H,c,y){return H[0]=c[0]-y[0],H[1]=c[1]-y[1],H[2]=c[2]-y[2],H}},12226:H=>{H.exports=function(H,c,y){var Z=c[0],F=c[1],P=c[2];return H[0]=Z*y[0]+F*y[3]+P*y[6],H[1]=Z*y[1]+F*y[4]+P*y[7],H[2]=Z*y[2]+F*y[5]+P*y[8],H}},12218:H=>{H.exports=function(H,c,y){var Z=c[0],F=c[1],P=c[2],S=y[3]*Z+y[7]*F+y[11]*P+y[15];return S=S||1,H[0]=(y[0]*Z+y[4]*F+y[8]*P+y[12])/S,H[1]=(y[1]*Z+y[5]*F+y[9]*P+y[13])/S,H[2]=(y[2]*Z+y[6]*F+y[10]*P+y[14])/S,H}},12231:H=>{H.exports=function(H,c,y){var Z=c[0],F=c[1],P=c[2],S=y[0],n=y[1],O=y[2],a=y[3],i=a*Z+n*P-O*F,C=a*F+O*Z-S*P,g=a*P+S*F-n*Z,v=-S*Z-n*F-O*P;return H[0]=i*a+v*-S+C*-O-g*-n,H[1]=C*a+v*-n+g*-S-i*-O,H[2]=g*a+v*-O+i*-n-C*-S,H}},12520:H=>{"use strict";H.exports=function(H){for(var c=new Array(H),y=0;y<H;++y)c[y]=y;return c}},12584:H=>{H.exports=function(H){return null!=H&&null!=H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}},12849:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z});class Z{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this._h=!1,this.ai=!1,this.Zh=30,this.$h=0,this.ii=!1,this.fullscreen=!1,this.ci=function(H){},this.di=function(){},this.gi=function(){},this.bb=function(){},this.ei=function(H){},this.onFullscreenChanged=function(H){},a((()=>{!function(H,c){H._nowObject=performance||Date,H._lastTick=0,H._renderAccum=0,H._rt=0,H._frameCB=n.bind(null,H),requestAnimationFrame(H._frameCB),c>0&&(H._intervalCB=S.bind(null,H),H._interval=setInterval(H._intervalCB,Math.max(c,1e3/H.Zh/2)))}(this,c),function(H,c){if(!c)return;var y=!1,Z=!1;document.addEventListener("pointerlockchange",(Z=>{y=document.pointerLockElement===c,H.ei(y)})),document.addEventListener("fullscreenchange",(y=>{Z=document.fullscreenElement===c,H.onFullscreenChanged(Z)})),Object.defineProperty(H,"ii",{get:()=>y,set:H=>{H&&!y?O(c):y&&!H&&function(H){H.exitPointerLock&&H.exitPointerLock()}(document)}}),Object.defineProperty(H,"fullscreen",{get:()=>Z,set:H=>{H&&!Z?c.requestFullscreen():Z&&!H&&document.exitFullscreen()}}),c.addEventListener("click",(F=>{H._h&&!y&&O(c),H.ai&&!Z&&c.requestFullscreen()}));var F=()=>H.bb();if(window.ResizeObserver){new ResizeObserver(F).observe(c)}else window.addEventListener("resize",F)}(this,H),this.gi()}))}}var F=3,P=20;function S(H){for(var c=1e3/H.Zh,y=H._nowObject.now()+P,Z=0;H._nowObject.now()>=H._lastTick+c&&H._nowObject.now()<y&&++Z<=F;)H.ci(c),H._lastTick+=c;var S=5*(c+5),n=H._nowObject.now();if(n-H._lastTick>S)for(;n>=H._lastTick+c;)H._lastTick+=c}function n(H){requestAnimationFrame(H._frameCB),S(H);var c=H._nowObject.now(),y=c-H._rt;if(H._rt=c,H.$h>0){H._renderAccum+=y;var Z=1e3/H.$h;if(H._renderAccum<Z)return;H._renderAccum=Math.min(H._renderAccum-Z,Z)}var F=1e3/H.Zh,P=(c-H._lastTick)/F;H.di(y,P,F)}function O(H){H.requestPointerLock&&H.requestPointerLock()}var a=H=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),H()};document.addEventListener("readystatechange",c)}else setTimeout(H,1)}},12518:(H,c,y)=>{var Z=y(12520),F=y(12529),P="undefined"!==typeof Float64Array;function S(H,c){return H[0]-c[0]}function n(){var H,c=this.stride,y=new Array(c.length);for(H=0;H<y.length;++H)y[H]=[Math.abs(c[H]),H];y.sort(S);var Z=new Array(y.length);for(H=0;H<Z.length;++H)Z[H]=y[H][1];return Z}function O(H,c){var y=["View",c,"d",H].join("");c<0&&(y="View_Nil"+H);var F="generic"===H;if(-1===c){var P="function "+y+"(a){this.data=a;};var proto="+y+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+y+"(a){return new "+y+"(a);}";return new Function(P)()}if(0===c){P="function "+y+"(a,d) {this.data = a;this.offset = d};var proto="+y+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+y+"_copy() {return new "+y+"(this.data,this.offset)};proto.pick=function "+y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+y+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+y+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+y+"(a,b,c,d){return new "+y+"(a,d)}";return new Function("TrivialArray",P)(a[H][0])}P=["'use strict'"];var S=Z(c),O=S.map((function(H){return"i"+H})),i="this.offset+"+S.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),C=S.map((function(H){return"b"+H})).join(","),g=S.map((function(H){return"c"+H})).join(",");P.push("function "+y+"(a,"+C+","+g+",d){this.data=a","this.shape=["+C+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+y+".prototype","proto.dtype='"+H+"'","proto.dimension="+c),P.push("Object.defineProperty(proto,'size',{get:function "+y+"_size(){return "+S.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===c?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),c<4?(P.push("function "+y+"_order(){"),2===c?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+y+"_set("+O.join(",")+",v){"),F?P.push("return this.data.set("+i+",v)}"):P.push("return this.data["+i+"]=v}"),P.push("proto.get=function "+y+"_get("+O.join(",")+"){"),F?P.push("return this.data.get("+i+")}"):P.push("return this.data["+i+"]}"),P.push("proto.index=function "+y+"_index(",O.join(),"){return "+i+"}"),P.push("proto.hi=function "+y+"_hi("+O.join(",")+"){return new "+y+"(this.data,"+S.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+S.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var v=S.map((function(H){return"a"+H+"=this.shape["+H+"]"})),m=S.map((function(H){return"c"+H+"=this.stride["+H+"]"}));P.push("proto.lo=function "+y+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+m.join(","));for(var z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");P.push("return new "+y+"(this.data,"+S.map((function(H){return"a"+H})).join(",")+","+S.map((function(H){return"c"+H})).join(",")+",b)}"),P.push("proto.step=function "+y+"_step("+O.join(",")+"){var "+S.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+S.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");P.push("return new "+y+"(this.data,"+S.map((function(H){return"a"+H})).join(",")+","+S.map((function(H){return"b"+H})).join(",")+",c)}");var V=new Array(c),h=new Array(c);for(z=0;z<c;++z)V[z]="a[i"+z+"]",h[z]="b[i"+z+"]";P.push("proto.transpose=function "+y+"_transpose("+O+"){"+O.map((function(H,c){return H+"=("+H+"===undefined?"+c+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+y+"(this.data,"+V.join(",")+","+h.join(",")+",this.offset)}"),P.push("proto.pick=function "+y+"_pick("+O+"){var a=[],b=[],c=this.offset");for(z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+y+"(data,shape,stride,offset){return new "+y+"(data,"+S.map((function(H){return"shape["+H+"]"})).join(",")+","+S.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(a[H],n)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,c,y,Z){if(void 0===H)return(0,a.array[0])([]);"number"===typeof H&&(H=[H]),void 0===c&&(c=[H.length]);var S=c.length;if(void 0===y){y=new Array(S);for(var n=S-1,i=1;n>=0;--n)y[n]=i,i*=c[n]}if(void 0===Z){Z=0;for(n=0;n<S;++n)y[n]<0&&(Z-=(c[n]-1)*y[n])}for(var C=function(H){if(F(H))return"buffer";if(P)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),g=a[C];g.length<=S+1;)g.push(O(C,g.length-1));return(0,g[S+1])(H,c,y,Z)}},12529:H=>{function c(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(c(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&c(H.slice(0,0))}(H)||!!H._isBuffer)}},12689:H=>{"use strict";var c=[],y=[],Z=[],F=[],P=[],S=[],n=[],O=[],a=[],i=[],C=[],g=[];H.exports=function(H,v,m,z,V,h){for(var Q=n,D=a,f=i,J=g,l=0;l<3;l++)Q[l]=+m[l],f[l]=+v.max[l],D[l]=+v.base[l];h||(h=1e-10);var d=function(H,n,a,i,g,v){var m=c,z=y,V=Z,h=F,Q=P,D=S,f=O,J=Math.floor,l=0,d=0,K=0,T=0,u=0;if(E(),0===K)return 0;for(T=p();d<=K;){if(U(T)&&G())return l;T=p()}for(l+=K,u=0;u<3;u++)i[u]+=a[u],g[u]+=a[u];return l;function E(){if(d=0,0!==(K=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])))for(var H=0;H<3;H++){var c=a[H]>=0;h[H]=c?1:-1;var y=c?g[H]:i[H];m[H]=c?i[H]:g[H],z[H]=t(y,h[H]),V[H]=o(m[H],h[H]),f[H]=a[H]/K,Q[H]=Math.abs(1/f[H]);var Z=c?z[H]+1-y:y-z[H];D[H]=Q[H]<1/0?Q[H]*Z:1/0}}function U(c){for(var y=h[0],Z=0===c?z[0]:V[0],F=z[0]+y,P=h[1],S=1===c?z[1]:V[1],n=z[1]+P,O=h[2],a=2===c?z[2]:V[2],i=z[2]+O,C=Z;C!=F;C+=y)for(var g=S;g!=n;g+=P)for(var v=a;v!=i;v+=O)if(H(C,g,v))return!0;return!1}function G(){l+=d;var H=h[T],c=d/K,y=C;for(u=0;u<3;u++){var Z=a[u]*c;i[u]+=Z,g[u]+=Z,y[u]=a[u]-Z}if(H>0?g[T]=Math.round(g[T]):i[T]=Math.round(i[T]),n(l,T,H,y))return!0;for(u=0;u<3;u++)a[u]=y[u];return E(),0===K}function p(){var H=D[0]<D[1]?D[0]<D[2]?0:2:D[1]<D[2]?1:2,c=D[H]-d;for(d=D[H],z[H]+=h[H],D[H]+=Q[H],u=0;u<3;u++)m[u]+=c*f[u],V[u]=o(m[u],h[u]);return H}function t(H,c){return J(H-c*v)}function o(H,c){return J(H+c*v)}}(H,z,Q,D,f,h);if(!V){for(l=0;l<3;l++)J[l]=m[l]>0?f[l]-v.max[l]:D[l]-v.base[l];v.translate(J)}return d}},12879:(H,c,y)=>{"use strict";y.d(c,{c:()=>C});var Z=y(12687),F=y(12015);class P{constructor(H,c,y,P,S,n,O){this.wg=new Z(H.base,H.Wg),this.mass=c,this.friction=y,this.restitution=P,this.Vc=S,this.Ik=n,this.Xc=!!O,this.Ug=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.vl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Of=F.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=F.create(),this._impulses=F.create(),this._sleepFrameCount=10}loadFromCopy(H){F.i(this.wg.base,H.wg.base),F.i(this.wg.Wg,H.wg.Wg),F.i(this.wg.max,H.wg.max),this.wg.mag=H.wg.mag,this.mass=H.mass,this.friction=H.friction,this.restitution=H.restitution,this.Vc=H.Vc,this.Ik=H.Ik,this.Xc=H.Xc,this.Ug=H.Ug,this.fluidDrag=H.fluidDrag,this.vl=H.vl,this.preventFallOffEdge=H.preventFallOffEdge,this.rolledBackLastTick=H.rolledBackLastTick,F.i(this.Of,H.Of),F.i(this.resting,H.resting),this.inFluid=H.inFluid,this._ratioInFluid=H._ratioInFluid,F.i(this._forces,H._forces),F.i(this._impulses,H._impulses),this._sleepFrameCount=H._sleepFrameCount}setPosition(H){S(H),F.Rc(H,H,this.wg.base),this.wg.translate(H),this.Sf()}cb(){return F.clone(this.wg.base)}applyForce(H){S(H),F.add(this._forces,this._forces,H),this.Sf()}applyImpulse(H){S(H),F.add(this._impulses,this._impulses,H),this.Sf()}Sf(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var S=H=>{};var n=y(12687),O=y(12015),a=y(12689);function i(){this.Ug=.1,this.fluidDrag=.4,this.dd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function C(H,c,y){H=Object.assign(new i,H),this.gravity=H.gravity||[0,-10,0],this.Ug=H.Ug||.1,this.dd=H.dd||2,this.fluidDrag=H.fluidDrag||.4,this.minBounceImpulse=H.minBounceImpulse,this.bodies=[],this.dk=H.dk,this.testSolid=c,this.testFluid=y}C.prototype.Pk=function(H,c,y,Z,F,S){H=H||new n([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof y&&(y=1),"undefined"==typeof Z&&(Z=0),"undefined"==typeof F&&(F=1);var O=new P(H,c,y,Z,F,S);return this.bodies.push(O),O},C.prototype.Qk=function(H){var c=this.bodies.indexOf(H);c<0||(this.bodies.splice(c,1),H.wg=H.Ik=null)};var g=O.create(),v=O.create(),m=O.create(),z=O.create(),V=O.create(),h=O.create(),Q=O.create(),D=new n([0,0,0],[1,1,1]),f=new P(D,1,1,0,1,(()=>{}),!1);function J(H,c,y){return c=y,c*=1-(1-H.ratioInFluid)**2}C.prototype.Ed=function(H){H/=1e3;var c=k(0,O.squaredLength(this.gravity));this.bodies.forEach((y=>function(H,c,y,Z){O.i(V,c.resting),H.dk&&f.loadFromCopy(c);if(c.mass<=0)return O.set(c.Of,0,0,0),O.set(c._forces,0,0,0),void O.set(c._impulses,0,0,0);var F=Z||0===c.Vc;if(function(H,c,y,Z){if(c._sleepFrameCount>0)return!1;if(Z)return!0;var F=!1,P=.5*y*y*c.Vc;return O.scale(j,H.gravity,P),a(H.testSolid,c.wg,j,(function(){return F=!0,!0}),!0),F}(H,c,y,F))return;c._sleepFrameCount--,function(H,c){var y=c.wg,Z=Math.floor(y.base[0]),F=Math.floor(y.base[2]),P=Math.floor(y.base[1]),S=Math.floor(y.max[1]);if(!H.testFluid(Z,P,F))return c.inFluid=!1,void(c.ratioInFluid=0);var n=1,a=P+1;for(;a<=S&&H.testFluid(Z,a,F);)n++,a++;var i=(P+n-y.base[1])/y.Wg[1];i>1&&(i=1);var C=y.Wg[0]*y.Wg[1]*y.Wg[2]*i,g=d;O.scale(g,H.gravity,-H.dd*C*c.Vc),c.applyForce(g),c.inFluid=!0,c.ratioInFluid=i}(H,c),M(c._forces),M(c._impulses),M(c.Of),M(c.resting),O.scale(g,c._forces,1/c.mass),O.pd(g,g,H.gravity,c.Vc),O.scale(v,c._impulses,1/c.mass),O.pd(v,v,g,y),O.add(c.Of,c.Of,v),c.friction&&(K(H,0,c,v,y),K(H,1,c,v,y),K(H,2,c,v,y));var P=c.fluidDrag>=0?c.fluidDrag:H.fluidDrag,S=c.Ug>=0?c.Ug:H.Ug,n=S,i=S;c.inFluid&&(n=J(c,n,c.fluidDragHoriz>=0?c.fluidDragHoriz:P),i=J(c,i,c.fluidDragVert>=0?c.fluidDragVert:P));n=Math.max(1-n*y/c.mass,0),i=Math.max(1-i*y/c.mass,0),O.set(l,n,i,n),O.multiply(c.Of,c.Of,l),O.scale(m,c.Of,y),O.set(c._forces,0,0,0),O.set(c._impulses,0,0,0),c.Xc&&W(E,c.wg);O.i(h,m),O.set(Q,0,0,0),c.preventFallOffEdge&&function(H,c,y,Z){if(!c.resting[1]||y[1]>0)return;var F=s;W(F,c.wg);for(var P=0;P<3;P+=2){O.set(o,0,0,0),o[P]=y[P];var S=!0;(S=(S=(S=(S=S&&!I(H,F.base[0]+o[0]+1e-5,F.base[1],F.base[2]+o[2]+1e-5))&&!I(H,F.max[0]+o[0]-1e-5,F.base[1],F.base[2]+o[2]+1e-5))&&!I(H,F.base[0]+o[0]+1e-5,F.base[1],F.max[2]+o[2]-1e-5))&&!I(H,F.max[0]+o[0]-1e-5,F.base[1],F.max[2]+o[2]-1e-5))?(Z[P]=y[P]>0?1:-1,y[P]=0):0===P&&(O.set(q,y[0],0,0),u(H,F,q,Z,c.slideOnCollision))}}(H,c,m,Q);u(H,c.wg,m,c.resting,c.slideOnCollision),c.Xc&&function(H,c,y,Z){if(c.resting[1]>=0&&!c.inFluid)return;var F=0!==c.resting[0],P=0!==c.resting[2];if(!F&&!P)return;var S=Math.abs(Z[0]/Z[2]),n=4;if(!F&&S>n)return;if(!P&&S<1/n)return;O.add(G,y.base,Z);var i=H.testSolid;a(i,y,Z,(function(H,c,y,Z){if(1!==c)return!0;Z[c]=0}));var C=y.base[1],g=c.inFluid?1.951:1.001,v=Math.floor(C+g)-C;O.set(p,0,v,0);var m=!1;if(a(i,y,p,(function(H,c,y,Z){return m=!0,!0})),m)return;O.Rc(t,G,y.base),t[1]=0,u(H,y,t,U,!0);var z=k(y.base[0],G[0]),V=k(y.base[2],G[2]);if(F&&!z&&(!V||!P))return;if(P&&(!z||!F)&&!V)return;var h=!0;if(h=h&&!I(H,y.base[0]+1e-5,y.base[1],y.base[2]+1e-5),h=h&&!I(H,y.max[0]-1e-5,y.base[1],y.base[2]+1e-5),h=h&&!I(H,y.base[0]+1e-5,y.base[1],y.max[2]-1e-5),h=h&&!I(H,y.max[0]-1e-5,y.base[1],y.max[2]-1e-5),h)return;W(c.wg,y),c.resting[0]=U[0],c.resting[2]=U[2],c.vl&&c.vl()}(H,c,E,h);for(var C=0;C<3;++C)c.resting[C]=c.resting[C]||Q[C],z[C]=0,c.resting[C]&&(V[C]||(z[C]=-c.Of[C]),c.Of[C]=0);var D=O.length(z);D>.001&&(O.scale(z,z,c.mass),c.Ik&&c.Ik(z),c.restitution>0&&D>H.minBounceImpulse&&(O.scale(z,z,c.restitution),c.applyImpulse(z)));var T=O.squaredLength(c.Of);T>1e-5&&c.Sf();H.dk&&H.dk(c)?(c.loadFromCopy(f),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,y,H,c)))};var l=O.create([0,0,0]);var d=O.create();function K(H,c,y,Z,F){var P=y.resting[c],S=Z[c];if(!y.alwaysApplyHorizFriction||1!==c){if(0===P)return;if(P*S<=0)return}O.i(T,y.Of),T[c]=0;var n=O.length(T);if(!k(n,0)){var a=Math.abs(y.friction*H.gravity[c]*F),i=n>a?(n-a)/n:0;y.Of[(c+1)%3]*=i,y.Of[(c+2)%3]*=i}}var T=O.create();function u(H,c,y,Z,F){return O.set(Z,0,0,0),a(H.testSolid,c,y,(function(H,c,y,P){Z[c]=y,P[c]=0,F||(P[0]=0,P[1]=0,P[2]=0)}))}var E=new n([],[]),U=O.create(),G=O.create(),p=O.create(),t=O.create();var o=O.create(),s=new n([],[]),q=O.create();function I(H,c,y,Z){return H.testSolid(Math.floor(c),Math.floor(y-1),Math.floor(Z))}var j=O.create();function k(H,c){return Math.abs(H-c)<1e-5}function W(H,c){for(var y=0;y<3;y++)H.base[y]=c.base[y],H.max[y]=c.max[y],H.Wg[y]=c.Wg[y]}var M=function(H){}},10675:function(H,c){!function(H){"use strict";var c=function(H,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,c){H.__proto__=c}||function(H,c){for(var y in c)Object.prototype.hasOwnProperty.call(c,y)&&(H[y]=c[y])},c(H,y)};function y(H,y){if("function"!==typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function Z(){this.constructor=H}c(H,y),H.prototype=null===y?Object.create(y):(Z.prototype=y.prototype,new Z)}function Z(H,c,y,Z){var F,P=arguments.length,S=P<3?c:null===Z?Z=Object.getOwnPropertyDescriptor(c,y):Z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)S=Reflect.decorate(H,c,y,Z);else for(var n=H.length-1;n>=0;n--)(F=H[n])&&(S=(P<3?F(S):P>3?F(c,y,S):F(c,y))||S);return P>3&&S&&Object.defineProperty(c,y,S),S}function F(H,c,y){if(y||2===arguments.length)for(var Z,F=0,P=c.length;F<P;F++)!Z&&F in c||(Z||(Z=Array.prototype.slice.call(c,0,F)),Z[F]=c[F]);return H.concat(Z||Array.prototype.slice.call(c))}var P,S=255,n=213;H.OPERATION=void 0,(P=H.OPERATION||(H.OPERATION={}))[P.ADD=128]="ADD",P[P.REPLACE=0]="REPLACE",P[P.DELETE=64]="DELETE",P[P.DELETE_AND_ADD=192]="DELETE_AND_ADD",P[P.TOUCH=1]="TOUCH",P[P.CLEAR=10]="CLEAR";var O=function(){function c(H,c,y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=H,this.setParent(c,y)}return c.prototype.setParent=function(H,c,y){var Z=this;if(this.indexes||(this.indexes=this.ref instanceof tH?this.ref._definition.indexes:{}),this.parent=H,this.parentIndex=y,c)if(this.root=c,this.ref instanceof tH){var F=this.ref._definition;for(var P in F.schema){var S=this.ref[P];if(S&&S.$changes){var n=F.indexes[P];S.$changes.setParent(this.ref,c,n)}}}else"object"===typeof this.ref&&this.ref.forEach((function(H,c){if(H instanceof tH){var y=H.$changes,F=Z.ref.$changes.indexes[c];y.setParent(Z.ref,Z.root,F)}}))},c.prototype.operation=function(H){this.changes.set(--this.currentCustomOperation,H)},c.prototype.change=function(c,y){void 0===y&&(y=H.OPERATION.ADD);var Z="number"===typeof c?c:this.indexes[c];this.assertValidIndex(Z,c);var F=this.changes.get(Z);F&&F.op!==H.OPERATION.DELETE&&F.op!==H.OPERATION.TOUCH||this.changes.set(Z,{op:F&&F.op===H.OPERATION.DELETE?H.OPERATION.DELETE_AND_ADD:y,index:Z}),this.allChanges.add(Z),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var y="number"===typeof c?c:this.indexes[c];this.assertValidIndex(y,c),this.changes.has(y)||this.changes.set(y,{op:H.OPERATION.TOUCH,index:y}),this.allChanges.add(y),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(H){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[H]];var c,y=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(y)[0]},c.prototype.getChildrenFilter=function(){var H=this.parent._definition.childFilters;return H&&H[this.parentIndex]},c.prototype.getValue=function(H){return this.ref.getByIndex(H)},c.prototype.delete=function(c){var y="number"===typeof c?c:this.indexes[c];if(void 0!==y){var Z=this.getValue(y);this.changes.set(y,{op:H.OPERATION.DELETE,index:y}),this.allChanges.delete(y),delete this.caches[y],Z&&Z.$changes&&(Z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(y,")"))},c.prototype.discard=function(c,y){var Z=this;void 0===c&&(c=!1),void 0===y&&(y=!1),this.ref instanceof tH||this.changes.forEach((function(c){if(c.op===H.OPERATION.DELETE){var y=Z.ref.getIndex(c.index);delete Z.indexes[y]}})),this.changes.clear(),this.changed=c,y&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var H=this;this.changes.forEach((function(c){var y=H.getValue(c.index);y&&y.$changes&&y.$changes.discardAll()})),this.discard()},c.prototype.cache=function(H,c){this.caches[H]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(H,c){if(void 0===H)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function a(H,c,y,Z){return H[c]||(H[c]=[]),H[c].push(y),null===Z||void 0===Z||Z.forEach((function(H,c){return y(H,c)})),function(){return C(H[c],H[c].indexOf(y))}}function i(c){var y=this,Z="string"!==typeof this.$changes.getType();this.$items.forEach((function(F,P){c.push({refId:y.$changes.refId,op:H.OPERATION.DELETE,field:P,value:void 0,previousValue:F}),Z&&y.$changes.root.removeRef(F.$changes.refId)}))}function C(H,c){if(-1===c||c>=H.length)return!1;for(var y=H.length-1,Z=c;Z<y;Z++)H[Z]=H[Z+1];return H.length=y,!0}var g=function(H,c){var y=H.toString(),Z=c.toString();return y<Z?-1:y>Z?1:0};function v(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,c){return"symbol"===typeof c||isNaN(c)?H[c]:H.at(c)},set:function(H,c,y){if("symbol"===typeof c||isNaN(c))H[c]=y;else{var Z=Array.from(H.$items.keys()),F=parseInt(Z[c]||c);void 0===y||null===y?H.deleteAt(F):H.setAt(F,y)}return!0},deleteProperty:function(H,c){return"number"===typeof c?H.deleteAt(c):delete H[c],!0}})}var m=function(){function c(){for(var H=[],c=0;c<arguments.length;c++)H[c]=arguments[c];this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,H)}return c.prototype.Jd=function(c,y){return void 0===y&&(y=!0),a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,c,y?this.$items:void 0)},c.prototype.ab=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,c)},c.is=function(H){return Array.isArray(H)||void 0!==H.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(H){0===H?this.clear():this.splice(H,this.length-H)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var H,c=this,y=[],Z=0;Z<arguments.length;Z++)y[Z]=arguments[Z];return y.forEach((function(y){H=c.$refId++,c.setAt(H,y)})),H},c.prototype.pop=function(){var H=Array.from(this.$indexes.values()).pop();if(void 0!==H){this.$changes.delete(H),this.$indexes.delete(H);var c=this.$items.get(H);return this.$items.delete(H),c}},c.prototype.at=function(H){var c=Array.from(this.$items.keys())[H];return this.$items.get(c)},c.prototype.setAt=function(c,y){var Z,F;if(void 0!==y&&null!==y){if(this.$items.get(c)!==y){void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,c);var P=null!==(F=null===(Z=this.$changes.indexes[c])||void 0===Z?void 0:Z.op)&&void 0!==F?F:H.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,y),this.$changes.change(c,P)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(H){var c=Array.from(this.$items.keys())[H];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(H){return this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&i.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var H,y=[],Z=0;Z<arguments.length;Z++)y[Z]=arguments[Z];return new(c.bind.apply(c,F([void 0],(H=Array.from(this.$items.values())).concat.apply(H,y),!1)))},c.prototype.join=function(H){return Array.from(this.$items.values()).join(H)},c.prototype.reverse=function(){var H=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(y,Z){H.setAt(c[Z],y)})),this},c.prototype.shift=function(){var H=Array.from(this.$items.keys()).shift();if(void 0!==H){var c=this.$items.get(H);return this.$deleteAt(H),c}},c.prototype.slice=function(H,y){var Z=new c;return Z.push.apply(Z,Array.from(this.$items.values()).slice(H,y)),Z},c.prototype.sort=function(H){var c=this;void 0===H&&(H=g);var y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(H).forEach((function(H,Z){c.setAt(y[Z],H)})),this},c.prototype.splice=function(H,c){void 0===c&&(c=this.length-H);for(var y=Array.from(this.$items.keys()),Z=[],F=H;F<H+c;F++)Z.push(this.$items.get(y[F])),this.$deleteAt(y[F]);return Z},c.prototype.unshift=function(){for(var H=this,c=[],y=0;y<arguments.length;y++)c[y]=arguments[y];var Z=this.length,F=c.length,P=Array.from(this.$items.values());return c.forEach((function(c,y){H.setAt(y,c)})),P.forEach((function(c,y){H.setAt(F+y,c)})),Z+F},c.prototype.indexOf=function(H,c){return Array.from(this.$items.values()).indexOf(H,c)},c.prototype.lastIndexOf=function(H,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(H,c)},c.prototype.every=function(H,c){return Array.from(this.$items.values()).every(H,c)},c.prototype.some=function(H,c){return Array.from(this.$items.values()).some(H,c)},c.prototype.forEach=function(H,c){Array.from(this.$items.values()).forEach(H,c)},c.prototype.map=function(H,c){return Array.from(this.$items.values()).map(H,c)},c.prototype.filter=function(H,c){return Array.from(this.$items.values()).filter(H,c)},c.prototype.reduce=function(H,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(H,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(H,c){return Array.from(this.$items.values()).find(H,c)},c.prototype.findIndex=function(H,c){return Array.from(this.$items.values()).findIndex(H,c)},c.prototype.fill=function(H,c,y){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(H,c,y){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(H,c){return Array.from(this.$items.values()).includes(H,c)},c.prototype.flatMap=function(H,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(H){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var H=Array.from(this.$items.values());return H.findLast.apply(H,arguments)},c.prototype.findLastIndex=function(){var H=Array.from(this.$items.values());return H.findLastIndex.apply(H,arguments)},c.prototype.setIndex=function(H,c){this.$indexes.set(H,c)},c.prototype.getIndex=function(H){return this.$indexes.get(H)},c.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},c.prototype.deleteByIndex=function(H){var c=this.$indexes.get(H);this.$items.delete(c),this.$indexes.delete(H)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(H){return"function"===typeof H.toJSON?H.toJSON():H}))},c.prototype.clone=function(H){return H?new(c.bind.apply(c,F([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,F([void 0],this.map((function(H){return H.$changes?H.clone():H})),!1)))},c}();function z(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,c){return"symbol"!==typeof c&&"undefined"===typeof H[c]?H.get(c):H[c]},set:function(H,c,y){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"Jd"!==c&&"ab"!==c&&"onChange"!==c?H.set(c,y):H[c]=y,!0},deleteProperty:function(H,c){return H.delete(c),!0}})}var V=function(){function c(H){var y=this;if(this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H)if(H instanceof Map||H instanceof c)H.forEach((function(H,c){return y.set(c,H)}));else for(var Z in H)this.set(Z,H[Z])}return c.prototype.Jd=function(c,y){return void 0===y&&(y=!0),a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,c,y?this.$items:void 0)},c.prototype.ab=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,c)},c.is=function(H){return void 0!==H.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,y){if(void 0===y||null===y)throw new Error("MapSchema#set('".concat(c,"', ").concat(y,"): trying to set ").concat(y," value on '").concat(c,"'."));c=c.toString();var Z="undefined"!==typeof this.$changes.indexes[c],F=Z?this.$changes.indexes[c]:this.$refId++,P=Z?H.OPERATION.REPLACE:H.OPERATION.ADD,S=void 0!==y.$changes;if(S&&y.$changes.setParent(this,this.$changes.root,F),Z){if(!S&&this.$items.get(c)===y)return;S&&this.$items.get(c)!==y&&(P=H.OPERATION.ADD)}else this.$changes.indexes[c]=F,this.$indexes.set(F,c);return this.$items.set(c,y),this.$changes.change(c,P),this},c.prototype.get=function(H){return this.$items.get(H)},c.prototype.delete=function(H){return this.$changes.delete(H),this.$items.delete(H)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&i.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(H){return this.$items.has(H)},c.prototype.forEach=function(H){this.$items.forEach(H)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(H,c){this.$indexes.set(H,c)},c.prototype.getIndex=function(H){return this.$indexes.get(H)},c.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},c.prototype.deleteByIndex=function(H){var c=this.$indexes.get(H);this.$items.delete(c),this.$indexes.delete(H)},c.prototype.toJSON=function(){var H={};return this.forEach((function(c,y){H[y]="function"===typeof c.toJSON?c.toJSON():c})),H},c.prototype.clone=function(H){var y;return H?y=Object.assign(new c,this):(y=new c,this.forEach((function(H,c){H.$changes?y.set(c,H.clone()):y.set(c,H)}))),y},c}(),h={};function Q(H,c){h[H]=c}function D(H){return h[H]}var f=function(){function H(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return H.create=function(c){var y=new H;return y.schema=Object.assign({},c&&c.schema||{}),y.indexes=Object.assign({},c&&c.indexes||{}),y.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),y.descriptors=Object.assign({},c&&c.descriptors||{}),y.deprecated=Object.assign({},c&&c.deprecated||{}),y},H.prototype.addField=function(H,c){var y=this.getNextFieldIndex();this.fieldsByIndex[y]=H,this.indexes[H]=y,this.schema[H]=Array.isArray(c)?{array:c[0]}:c},H.prototype.hasField=function(H){return void 0!==this.indexes[H]},H.prototype.addFilter=function(H,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[H]]=c,this.indexesWithFilters.push(this.indexes[H]),!0},H.prototype.addChildrenFilter=function(H,c){var y=this.indexes[H],Z=this.schema[H];if(D(Object.keys(Z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[y]=c,!0;console.warn("@filterChildren: field '".concat(H,"' can't have children. Ignoring filter."))},H.prototype.getChildrenFilter=function(H){return this.childFilters&&this.childFilters[this.indexes[H]]},H.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},H}();function J(H){return H._context&&H._context.useFilters}var l=function(){function H(){this.types={},this.schemas=new Map,this.useFilters=!1}return H.prototype.has=function(H){return this.schemas.has(H)},H.prototype.get=function(H){return this.types[H]},H.prototype.add=function(H,c){void 0===c&&(c=this.schemas.size),H._definition=f.create(H._definition),H._typeid=c,this.types[c]=H,this.schemas.set(H,c)},H.create=function(c){return void 0===c&&(c={}),function(y){return c.context||(c.context=new H),K(y,c)}},H}(),d=new l;function K(H,c){return void 0===c&&(c={}),function(y,Z){var P=c.context||d,S=y.constructor;if(S._context=P,!H)throw new Error("".concat(S.name,': @type() reference provided for "').concat(Z,"\" is undefined. Make sure you don't have any circular dependencies."));P.has(S)||P.add(S);var n=S._definition;if(n.addField(Z,H),n.descriptors[Z]){if(n.deprecated[Z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Z,"' definition on '").concat(S.name,"'.\nCheck @type() annotation"))}catch(h){var O=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(O))}}var a=m.is(H),i=!a&&V.is(H);if("string"!==typeof H&&!tH.is(H)){var C=Object.values(H)[0];"string"===typeof C||P.has(C)||P.add(C)}if(c.manual)n.descriptors[Z]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(Z);n.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},n.descriptors[Z]={get:function(){return this[g]},set:function(H){H!==this[g]&&(void 0!==H&&null!==H?(!a||H instanceof m||(H=new(m.bind.apply(m,F([void 0],H,!1)))),!i||H instanceof V||(H=new V(H)),void 0===H.$proxy&&(i?H=z(H):a&&(H=v(H))),this.$changes.change(Z),H.$changes&&H.$changes.setParent(this,this.$changes.root,this._definition.indexes[Z])):this[g]&&this.$changes.delete(Z),this[g]=H)},enumerable:!0,configurable:!0}}}}function T(H){return function(c,y){var Z=c.constructor;Z._definition.addFilter(y,H)&&(Z._context.useFilters=!0)}}function u(H){return function(c,y){var Z=c.constructor;Z._definition.addChildrenFilter(y,H)&&(Z._context.useFilters=!0)}}function E(H){return void 0===H&&(H=!0),function(c,y){var Z=c.constructor._definition;Z.deprecated[y]=!0,H&&(Z.descriptors[y]={get:function(){throw new Error("".concat(y," is deprecated."))},set:function(H){},enumerable:!1,configurable:!0})}}function U(H,c,y){for(var Z in void 0===y&&(y={}),y.context||(y.context=H._context||y.context||d),c)K(c[Z],y)(H.prototype,Z);return H}function G(H){for(var c=0,y=0,Z=0,F=H.length;Z<F;Z++)(c=H.charCodeAt(Z))<128?y+=1:c<2048?y+=2:c<55296||c>=57344?y+=3:(Z++,y+=4);return y}function p(H,c,y){for(var Z=0,F=0,P=y.length;F<P;F++)(Z=y.charCodeAt(F))<128?H[c++]=Z:Z<2048?(H[c++]=192|Z>>6,H[c++]=128|63&Z):Z<55296||Z>=57344?(H[c++]=224|Z>>12,H[c++]=128|Z>>6&63,H[c++]=128|63&Z):(F++,Z=65536+((1023&Z)<<10|1023&y.charCodeAt(F)),H[c++]=240|Z>>18,H[c++]=128|Z>>12&63,H[c++]=128|Z>>6&63,H[c++]=128|63&Z)}function t(H,c){H.push(255&c)}function o(H,c){H.push(255&c)}function s(H,c){H.push(255&c),H.push(c>>8&255)}function q(H,c){H.push(255&c),H.push(c>>8&255)}function I(H,c){H.push(255&c),H.push(c>>8&255),H.push(c>>16&255),H.push(c>>24&255)}function j(H,c){var y=c>>24,Z=c>>16,F=c>>8,P=c;H.push(255&P),H.push(255&F),H.push(255&Z),H.push(255&y)}function k(H,c){var y=Math.floor(c/Math.pow(2,32));j(H,c>>>0),j(H,y)}function W(H,c){var y=c/Math.pow(2,32)|0;j(H,c>>>0),j(H,y)}function M(H,c){r(H,c)}function x(H,c){N(H,c)}var R=new Int32Array(2),A=new Float32Array(R.buffer),e=new Float64Array(R.buffer);function r(H,c){A[0]=c,I(H,R[0])}function N(H,c){e[0]=c,I(H,R[0]),I(H,R[1])}function w(H,c){return o(H,c?1:0)}function L(H,c){c||(c="");var y=G(c),Z=0;if(y<32)H.push(160|y),Z=1;else if(y<256)H.push(217),o(H,y),Z=2;else if(y<65536)H.push(218),q(H,y),Z=3;else{if(!(y<4294967296))throw new Error("String too long");H.push(219),j(H,y),Z=5}return p(H,H.length,c),Z+y}function b(H,c){return isNaN(c)?b(H,0):isFinite(c)?c!==(0|c)?(H.push(203),N(H,c),9):c>=0?c<128?(o(H,c),1):c<256?(H.push(204),o(H,c),2):c<65536?(H.push(205),q(H,c),3):c<4294967296?(H.push(206),j(H,c),5):(H.push(207),W(H,c),9):c>=-32?(H.push(224|c+32),1):c>=-128?(H.push(208),t(H,c),2):c>=-32768?(H.push(209),s(H,c),3):c>=-2147483648?(H.push(210),I(H,c),5):(H.push(211),k(H,c),9):b(H,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:p,int8:t,uint8:o,int16:s,uint16:q,int32:I,uint32:j,int64:k,uint64:W,float32:M,float64:x,writeFloat32:r,writeFloat64:N,boolean:w,string:L,number:b});function B(H,c,y){for(var Z="",F=0,P=c,S=c+y;P<S;P++){var n=H[P];0!==(128&n)?192!==(224&n)?224!==(240&n)?240!==(248&n)?console.error("Invalid byte "+n.toString(16)):(F=(7&n)<<18|(63&H[++P])<<12|(63&H[++P])<<6|63&H[++P])>=65536?(F-=65536,Z+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):Z+=String.fromCharCode(F):Z+=String.fromCharCode((15&n)<<12|(63&H[++P])<<6|63&H[++P]):Z+=String.fromCharCode((31&n)<<6|63&H[++P]):Z+=String.fromCharCode(n)}return Z}function Y(H,c){return HH(H,c)<<24>>24}function HH(H,c){return H[c.offset++]}function cH(H,c){return yH(H,c)<<16>>16}function yH(H,c){return H[c.offset++]|H[c.offset++]<<8}function ZH(H,c){return H[c.offset++]|H[c.offset++]<<8|H[c.offset++]<<16|H[c.offset++]<<24}function FH(H,c){return ZH(H,c)>>>0}function PH(H,c){return gH(H,c)}function SH(H,c){return vH(H,c)}function nH(H,c){var y=FH(H,c);return ZH(H,c)*Math.pow(2,32)+y}function OH(H,c){var y=FH(H,c);return FH(H,c)*Math.pow(2,32)+y}var aH=new Int32Array(2),iH=new Float32Array(aH.buffer),CH=new Float64Array(aH.buffer);function gH(H,c){return aH[0]=ZH(H,c),iH[0]}function vH(H,c){return aH[0]=ZH(H,c),aH[1]=ZH(H,c),CH[0]}function mH(H,c){return HH(H,c)>0}function zH(H,c){var y,Z=H[c.offset++];Z<192?y=31&Z:217===Z?y=HH(H,c):218===Z?y=yH(H,c):219===Z&&(y=FH(H,c));var F=B(H,c.offset,y);return c.offset+=y,F}function VH(H,c){var y=H[c.offset];return y<192&&y>160||217===y||218===y||219===y}function hH(H,c){var y=H[c.offset++];return y<128?y:202===y?gH(H,c):203===y?vH(H,c):204===y?HH(H,c):205===y?yH(H,c):206===y?FH(H,c):207===y?OH(H,c):208===y?Y(H,c):209===y?cH(H,c):210===y?ZH(H,c):211===y?nH(H,c):y>223?-1*(255-y+1):void 0}function QH(H,c){var y=H[c.offset];return y<128||y>=202&&y<=211}function DH(H,c){return H[c.offset]<160}function fH(H,c){return H[c.offset-1]===S&&(H[c.offset]<128||H[c.offset]>=202&&H[c.offset]<=211)}var JH=Object.freeze({__proto__:null,int8:Y,uint8:HH,int16:cH,uint16:yH,int32:ZH,uint32:FH,float32:PH,float64:SH,int64:nH,uint64:OH,readFloat32:gH,readFloat64:vH,boolean:mH,string:zH,stringCheck:VH,number:hH,numberCheck:QH,arrayCheck:DH,switchStructureCheck:fH}),lH=function(){function c(H){var c=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return c.add(H)}))}return c.prototype.Jd=function(c,y){return void 0===y&&(y=!0),a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,c,y?this.$items:void 0)},c.prototype.ab=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,c)},c.is=function(H){return void 0!==H.collection},c.prototype.add=function(H){var c=this.$refId++;return void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,H),this.$changes.change(c),c},c.prototype.at=function(H){var c=Array.from(this.$items.keys())[H];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(H){for(var c,y,Z=this.$items.entries();(y=Z.next())&&!y.done;)if(H===y.value[1]){c=y.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&i.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(H){return Array.from(this.$items.values()).some((function(c){return c===H}))},c.prototype.forEach=function(H){var c=this;this.$items.forEach((function(y,Z,F){return H(y,Z,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(H,c){this.$indexes.set(H,c)},c.prototype.getIndex=function(H){return this.$indexes.get(H)},c.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},c.prototype.deleteByIndex=function(H){var c=this.$indexes.get(H);this.$items.delete(c),this.$indexes.delete(H)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var H=[];return this.forEach((function(c,y){H.push("function"===typeof c.toJSON?c.toJSON():c)})),H},c.prototype.clone=function(H){var y;return H?y=Object.assign(new c,this):(y=new c,this.forEach((function(H){H.$changes?y.add(H.clone()):y.add(H)}))),y},c}(),dH=function(){function c(H){var c=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return c.add(H)}))}return c.prototype.Jd=function(c,y){return void 0===y&&(y=!0),a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,c,y?this.$items:void 0)},c.prototype.ab=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,c)},c.is=function(H){return void 0!==H.set},c.prototype.add=function(c){var y,Z;if(this.has(c))return!1;var F=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,F);var P=null!==(Z=null===(y=this.$changes.indexes[F])||void 0===y?void 0:y.op)&&void 0!==Z?Z:H.OPERATION.ADD;return this.$changes.indexes[F]=F,this.$indexes.set(F,F),this.$items.set(F,c),this.$changes.change(F,P),F},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(H){for(var c,y,Z=this.$items.entries();(y=Z.next())&&!y.done;)if(H===y.value[1]){c=y.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&i.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(H){for(var c,y=this.$items.values(),Z=!1;(c=y.next())&&!c.done;)if(H===c.value){Z=!0;break}return Z},c.prototype.forEach=function(H){var c=this;this.$items.forEach((function(y,Z,F){return H(y,Z,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(H,c){this.$indexes.set(H,c)},c.prototype.getIndex=function(H){return this.$indexes.get(H)},c.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},c.prototype.deleteByIndex=function(H){var c=this.$indexes.get(H);this.$items.delete(c),this.$indexes.delete(H)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var H=[];return this.forEach((function(c,y){H.push("function"===typeof c.toJSON?c.toJSON():c)})),H},c.prototype.clone=function(H){var y;return H?y=Object.assign(new c,this):(y=new c,this.forEach((function(H){H.$changes?y.add(H.clone()):y.add(H)}))),y},c}(),KH=function(){function H(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return H.prototype.addRefId=function(H){this.refIds.has(H)||(this.refIds.add(H),this.containerIndexes.set(H,new Set))},H.get=function(c){return void 0===c.$filterState&&(c.$filterState=new H),c.$filterState},H}(),TH=function(){function H(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return H.prototype.getNextUniqueId=function(){return this.nextUniqueId++},H.prototype.addRef=function(H,c,y){void 0===y&&(y=!0),this.refs.set(H,c),y&&(this.refCounts[H]=(this.refCounts[H]||0)+1)},H.prototype.removeRef=function(H){this.refCounts[H]=this.refCounts[H]-1,this.deletedRefs.add(H)},H.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},H.prototype.garbageCollectDeletedRefs=function(){var H=this;this.deletedRefs.forEach((function(c){if(!(H.refCounts[c]>0)){var y=H.refs.get(c);if(y instanceof tH)for(var Z in y._definition.schema)"string"!==typeof y._definition.schema[Z]&&y[Z]&&y[Z].$changes&&H.removeRef(y[Z].$changes.refId);else{var F=y.$changes.parent._definition,P=F.schema[F.fieldsByIndex[y.$changes.parentIndex]];"function"===typeof Object.values(P)[0]&&Array.from(y.values()).forEach((function(c){return H.removeRef(c.$changes.refId)}))}H.refs.delete(c),delete H.refCounts[c]}})),this.deletedRefs.clear()},H}(),uH=function(H){function c(){return null!==H&&H.apply(this,arguments)||this}return y(c,H),c}(Error);function EH(H,c,y,Z){var F,P=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":F="number",isNaN(H)&&console.log('trying to encode "NaN" in '.concat(y.constructor.name,"#").concat(Z));break;case"string":F="string",P=!0;break;case"boolean":return}if(typeof H!==F&&(!P||P&&null!==H)){var S="'".concat(JSON.stringify(H),"'").concat(H&&H.constructor&&" (".concat(H.constructor.name,")")||"");throw new uH("a '".concat(F,"' was expected, but ").concat(S," was provided in ").concat(y.constructor.name,"#").concat(Z))}}function UH(H,c,y,Z){if(!(H instanceof c))throw new uH("a '".concat(c.name,"' was expected, but '").concat(H.constructor.name,"' was provided in ").concat(y.constructor.name,"#").concat(Z))}function GH(H,c,y,Z,F){EH(y,H,Z,F);var P=X[H];if(!P)throw new uH("a '".concat(H,"' was expected, but ").concat(y," was provided in ").concat(Z.constructor.name,"#").concat(F));P(c,y)}function pH(H,c,y){return JH[H](c,y)}var tH=function(){function c(){for(var H=[],c=0;c<arguments.length;c++)H[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new O(this,void 0,new TH),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var y=this._definition.descriptors;y&&Object.defineProperties(this,y),H[0]&&this.assign(H[0])}return c.onError=function(H){console.error(H)},c.is=function(H){return H._definition&&void 0!==H._definition.schema},c.prototype.onChange=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,c)},c.prototype.ab=function(c){return a(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,c)},c.prototype.assign=function(H){return Object.assign(this,H),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(H,c){this.$changes.change(H,c)},c.prototype.listen=function(H,c,y){var Z=this;return void 0===y&&(y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[H]||(this.$callbacks[H]=[]),this.$callbacks[H].push(c),y&&void 0!==this[H]&&c(this[H],void 0),function(){return C(Z.$callbacks[H],Z.$callbacks[H].indexOf(c))}},c.prototype.decode=function(y,Z,F){var P;void 0===Z&&(Z={offset:0}),void 0===F&&(F=this);var n=[],O=this.$changes.root,a=y.length,i=0;for(O.refs.set(i,this);Z.offset<a;){var C=y[Z.offset++];if(C!=S){var g=F.$changes,v=void 0!==F._definition,z=v?C>>6<<6:C;if(z!==H.OPERATION.CLEAR){var h=v?C%(z||255):hH(y,Z),Q=v?F._definition.fieldsByIndex[h]:"",f=g.getType(h),J=void 0,l=void 0,d=void 0;if(v?l=F["_".concat(Q)]:(l=F.getByIndex(h),(z&H.OPERATION.ADD)===H.OPERATION.ADD?(d=F instanceof V?zH(y,Z):h,F.setIndex(h,d)):d=F.getIndex(h)),(z&H.OPERATION.DELETE)===H.OPERATION.DELETE&&(z!==H.OPERATION.DELETE_AND_ADD&&F.deleteByIndex(h),l&&l.$changes&&O.removeRef(l.$changes.refId),J=null),void 0!==Q){if(z===H.OPERATION.DELETE);else if(c.is(f)){var K=hH(y,Z);if(J=O.refs.get(K),z!==H.OPERATION.REPLACE){var T=this.getSchemaType(y,Z,f);J||((J=this.createTypeInstance(T)).$changes.refId=K,l&&(J.$callbacks=l.$callbacks,l.$changes.refId&&K!==l.$changes.refId&&O.removeRef(l.$changes.refId))),O.addRef(K,J,J!==l)}}else if("string"===typeof f)J=pH(f,y,Z);else{var u=D(Object.keys(f)[0]),E=hH(y,Z),U=O.refs.has(E)?l||O.refs.get(E):new u.constructor;if((J=U.clone(!0)).$changes.refId=E,l&&(J.$callbacks=l.$callbacks,l.$changes.refId&&E!==l.$changes.refId)){O.removeRef(l.$changes.refId);for(var G=l.entries(),p=void 0;(p=G.next())&&!p.done;){var t=(P=p.value)[0],o=P[1];n.push({refId:E,op:H.OPERATION.DELETE,field:t,value:void 0,previousValue:o})}}O.addRef(E,J,U!==l)}if(null!==J&&void 0!==J)if(J.$changes&&J.$changes.setParent(g.ref,g.root,h),F instanceof c)F[Q]=J;else if(F instanceof V)t=d,F.$items.set(t,J),F.$changes.allChanges.add(h);else if(F instanceof m)F.setAt(h,J);else if(F instanceof lH){var s=F.add(J);F.setIndex(h,s)}else F instanceof dH&&!1!==(s=F.add(J))&&F.setIndex(h,s);l!==J&&n.push({refId:i,op:z,field:Q,dynamicIndex:d,value:J,previousValue:l})}else{console.warn("@colyseus/schema: definition mismatch");for(var q={offset:Z.offset};Z.offset<a&&(!fH(y,Z)||(q.offset=Z.offset+1,!O.refs.has(hH(y,q))));)Z.offset++}}else F.clear(n)}else{i=hH(y,Z);var I=O.refs.get(i);if(!I)throw new Error('"refId" not found: '.concat(i));F=I}}return this._triggerChanges(n),O.garbageCollectDeletedRefs(),n},c.prototype.encode=function(y,Z,F){void 0===y&&(y=!1),void 0===Z&&(Z=[]),void 0===F&&(F=!1);for(var P=this.$changes,n=new WeakSet,O=[P],a=1,i=0;i<a;i++){var C=O[i],g=C.ref,v=g instanceof c;C.ensureRefId(),n.add(C),C!==P&&(C.changed||y)&&(o(Z,S),b(Z,C.refId));for(var m=y?Array.from(C.allChanges):Array.from(C.changes.values()),z=0,h=m.length;z<h;z++){var Q=y?{op:H.OPERATION.ADD,index:m[z]}:m[z],f=Q.index,J=v?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[f]:f,l=Z.length;if(Q.op!==H.OPERATION.TOUCH)if(v)o(Z,f|Q.op);else{if(o(Z,Q.op),Q.op===H.OPERATION.CLEAR)continue;b(Z,f)}if(v||(Q.op&H.OPERATION.ADD)!=H.OPERATION.ADD||g instanceof V&&L(Z,C.ref.$indexes.get(f)),Q.op!==H.OPERATION.DELETE){var d=C.getType(f),K=C.getValue(f);if(K&&K.$changes&&!n.has(K.$changes)&&(O.push(K.$changes),K.$changes.ensureRefId(),a++),Q.op!==H.OPERATION.TOUCH){if(c.is(d))UH(K,d,g,J),b(Z,K.$changes.refId),(Q.op&H.OPERATION.ADD)===H.OPERATION.ADD&&this.tryEncodeTypeId(Z,d,K.constructor);else if("string"===typeof d)GH(d,Z,K,g,J);else{var T=D(Object.keys(d)[0]);UH(g["_".concat(J)],T.constructor,g,J),b(Z,K.$changes.refId)}F&&C.cache(f,Z.slice(l))}}}y||F||C.discard()}return Z},c.prototype.encodeAll=function(H){return this.encode(!0,[],H)},c.prototype.applyFilters=function(y,Z){var F,P;void 0===Z&&(Z=!1);for(var n=this,O=new Set,a=KH.get(y),i=[this.$changes],C=1,g=[],v=function(v){var m=i[v];if(O.has(m.refId))return"continue";var z=m.ref,h=z instanceof c;o(g,S),b(g,m.refId);var Q=a.refIds.has(m),D=Z||!Q;a.addRefId(m);var f=a.containerIndexes.get(m),J=D?Array.from(m.allChanges):Array.from(m.changes.values());!Z&&h&&z._definition.indexesWithFilters&&z._definition.indexesWithFilters.forEach((function(c){!f.has(c)&&m.allChanges.has(c)&&(D?J.push(c):J.push({op:H.OPERATION.ADD,index:c}))}));for(var l=0,d=J.length;l<d;l++){var K=D?{op:H.OPERATION.ADD,index:J[l]}:J[l];if(K.op!==H.OPERATION.CLEAR){var T=K.index;if(K.op!==H.OPERATION.DELETE){var u=m.getValue(T),E=m.getType(T);if(h){if((U=z._definition.filters&&z._definition.filters[T])&&!U.call(z,y,u,n)){u&&u.$changes&&O.add(u.$changes.refId);continue}}else{var U,G=m.parent;if((U=m.getChildrenFilter())&&!U.call(G,y,z.$indexes.get(T),u,n)){u&&u.$changes&&O.add(u.$changes.refId);continue}}if(u.$changes&&(i.push(u.$changes),C++),K.op!==H.OPERATION.TOUCH)if(K.op===H.OPERATION.ADD||h)g.push.apply(g,null!==(F=m.caches[T])&&void 0!==F?F:[]),f.add(T);else if(f.has(T))g.push.apply(g,null!==(P=m.caches[T])&&void 0!==P?P:[]);else{if(f.add(T),o(g,H.OPERATION.ADD),b(g,T),z instanceof V){var p=m.ref.$indexes.get(T);L(g,p)}u.$changes?b(g,u.$changes.refId):X[E](g,u)}else u.$changes&&!h&&(o(g,H.OPERATION.ADD),b(g,T),z instanceof V&&(p=m.ref.$indexes.get(T),L(g,p)),b(g,u.$changes.refId))}else h?o(g,K.op|T):(o(g,K.op),b(g,T))}else o(g,K.op)}},m=0;m<C;m++)v(m);return g},c.prototype.clone=function(){var H,c=new this.constructor,y=this._definition.schema;for(var Z in y)"object"===typeof this[Z]&&"function"===typeof(null===(H=this[Z])||void 0===H?void 0:H.clone)?c[Z]=this[Z].clone():c[Z]=this[Z];return c},c.prototype.toJSON=function(){var H=this._definition.schema,c=this._definition.deprecated,y={};for(var Z in H)c[Z]||null===this[Z]||"undefined"===typeof this[Z]||(y[Z]="function"===typeof this[Z].toJSON?this[Z].toJSON():this["_".concat(Z)]);return y},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(H){return this[this._definition.fieldsByIndex[H]]},c.prototype.deleteByIndex=function(H){this[this._definition.fieldsByIndex[H]]=void 0},c.prototype.tryEncodeTypeId=function(H,c,y){c._typeid!==y._typeid&&(o(H,n),b(H,y._typeid))},c.prototype.getSchemaType=function(H,c,y){var Z;return H[c.offset]===n&&(c.offset++,Z=this.constructor._context.get(hH(H,c))),Z||y},c.prototype.createTypeInstance=function(H){var c=new H;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(y){for(var Z,F,P,S,n,O,a,i,C,g=new Set,v=this.$changes.root.refs,m=function(m){var z=y[m],V=z.refId,h=v.get(V),Q=h.$callbacks;if((z.op&H.OPERATION.DELETE)===H.OPERATION.DELETE&&z.previousValue instanceof c&&(null===(F=null===(Z=z.previousValue.$callbacks)||void 0===Z?void 0:Z[H.OPERATION.DELETE])||void 0===F||F.forEach((function(H){return H()}))),!Q)return"continue";if(h instanceof c){if(!g.has(V))try{null===(P=null===Q||void 0===Q?void 0:Q[H.OPERATION.REPLACE])||void 0===P||P.forEach((function(H){return H()}))}catch(D){c.onError(D)}try{Q.hasOwnProperty(z.field)&&(null===(S=Q[z.field])||void 0===S||S.forEach((function(H){return H(z.value,z.previousValue)})))}catch(D){c.onError(D)}}else z.op===H.OPERATION.ADD&&void 0===z.previousValue?null===(n=Q[H.OPERATION.ADD])||void 0===n||n.forEach((function(H){var c;return H(z.value,null!==(c=z.dynamicIndex)&&void 0!==c?c:z.field)})):z.op===H.OPERATION.DELETE?void 0!==z.previousValue&&(null===(O=Q[H.OPERATION.DELETE])||void 0===O||O.forEach((function(H){var c;return H(z.previousValue,null!==(c=z.dynamicIndex)&&void 0!==c?c:z.field)}))):z.op===H.OPERATION.DELETE_AND_ADD&&(void 0!==z.previousValue&&(null===(a=Q[H.OPERATION.DELETE])||void 0===a||a.forEach((function(H){var c;return H(z.previousValue,null!==(c=z.dynamicIndex)&&void 0!==c?c:z.field)}))),null===(i=Q[H.OPERATION.ADD])||void 0===i||i.forEach((function(H){var c;return H(z.value,null!==(c=z.dynamicIndex)&&void 0!==c?c:z.field)}))),z.value!==z.previousValue&&(null===(C=Q[H.OPERATION.REPLACE])||void 0===C||C.forEach((function(H){var c;return H(z.value,null!==(c=z.dynamicIndex)&&void 0!==c?c:z.field)})));g.add(V)},z=0;z<y.length;z++)m(z)},c._definition=f.create(),c}();function oH(H){for(var c=[H.$changes],y=1,Z={},F=Z,P=function(H){var y=c[H];y.changes.forEach((function(H){var c=y.ref,Z=H.index,P=c._definition?c._definition.fieldsByIndex[Z]:c.$indexes.get(Z);F[P]=y.getValue(Z)}))},S=0;S<y;S++)P(S);return Z}var sH={context:new l},qH=function(H){function c(){return null!==H&&H.apply(this,arguments)||this}return y(c,H),Z([K("string",sH)],c.prototype,"name",void 0),Z([K("string",sH)],c.prototype,"type",void 0),Z([K("number",sH)],c.prototype,"referencedType",void 0),c}(tH),IH=function(H){function c(){var c=null!==H&&H.apply(this,arguments)||this;return c.fields=new m,c}return y(c,H),Z([K("number",sH)],c.prototype,"id",void 0),Z([K([qH],sH)],c.prototype,"fields",void 0),c}(tH),jH=function(H){function c(){var c=null!==H&&H.apply(this,arguments)||this;return c.types=new m,c}return y(c,H),c.encode=function(H){var y=H.constructor,Z=new c;Z.rootType=y._typeid;var F=function(H,c){for(var y in c){var F=new qH;F.name=y;var P=void 0;if("string"===typeof c[y])P=c[y];else{var S=c[y],n=void 0;tH.is(S)?(P="ref",n=c[y]):"string"===typeof S[P=Object.keys(S)[0]]?P+=":"+S[P]:n=S[P],F.referencedType=n?n._typeid:-1}F.type=P,H.fields.push(F)}Z.types.push(H)},P=y._context.types;for(var S in P){var n=new IH;n.id=Number(S),F(n,P[S]._definition.schema)}return Z.encodeAll()},c.decode=function(H,Z){var F=new l,P=new c;P.decode(H,Z);var S=P.types.reduce((function(H,c){var Z=function(H){function c(){return null!==H&&H.apply(this,arguments)||this}return y(c,H),c}(tH),P=c.id;return H[P]=Z,F.add(Z,P),H}),{});P.types.forEach((function(H){var c=S[H.id];H.fields.forEach((function(H){var y;if(void 0!==H.referencedType){var Z=H.type,P=S[H.referencedType];if(!P){var n=H.type.split(":");Z=n[0],P=n[1]}"ref"===Z?K(P,{context:F})(c.prototype,H.name):K(((y={})[Z]=P,y),{context:F})(c.prototype,H.name)}else K(H.type,{context:F})(c.prototype,H.name)}))}));var n=S[P.rootType],O=new n;for(var a in n._definition.schema){var i=n._definition.schema[a];"string"!==typeof i&&(O[a]="function"===typeof i?new i:new(D(Object.keys(i)[0]).constructor))}return O},Z([K([IH],sH)],c.prototype,"types",void 0),Z([K("number",sH)],c.prototype,"rootType",void 0),c}(tH);Q("map",{constructor:V}),Q("array",{constructor:m}),Q("set",{constructor:dH}),Q("collection",{constructor:lH}),H.ArraySchema=m,H.CollectionSchema=lH,H.Context=l,H.MapSchema=V,H.Reflection=jH,H.ReflectionField=qH,H.ReflectionType=IH,H.Schema=tH,H.SchemaDefinition=f,H.SetSchema=dH,H.decode=JH,H.defineTypes=U,H.deprecated=E,H.dumpChanges=oH,H.encode=X,H.filter=T,H.filterChildren=u,H.hasFilter=J,H.registerType=Q,H.type=K,Object.defineProperty(H,"__esModule",{value:!0})}(c)},12741:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12735:(H,c,y)=>{var Z=y(12741),F=y(12749),P=Object.hasOwnProperty,S=Object.create(null);for(var n in Z)P.call(Z,n)&&(S[Z[n]]=n);var O=H.exports={to:{},get:{}};function a(H,c,y){return Math.min(Math.max(c,H),y)}function i(H){var c=Math.round(H).toString(16).toUpperCase();return c.length<2?"0"+c:c}O.get=function(H){var c,y;switch(H.substring(0,3).toLowerCase()){case"hsl":c=O.get.hsl(H),y="hsl";break;case"hwb":c=O.get.hwb(H),y="hwb";break;default:c=O.get.rgb(H),y="rgb"}return c?{model:y,value:c}:null},O.get.rgb=function(H){if(!H)return null;var c,y,F,S=[0,0,0,1];if(c=H.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(F=c[2],c=c[1],y=0;y<3;y++){var n=2*y;S[y]=parseInt(c.slice(n,n+2),16)}F&&(S[3]=parseInt(F,16)/255)}else if(c=H.match(/^#([a-f0-9]{3,4})$/i)){for(F=(c=c[1])[3],y=0;y<3;y++)S[y]=parseInt(c[y]+c[y],16);F&&(S[3]=parseInt(F+F,16)/255)}else if(c=H.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(y=0;y<3;y++)S[y]=parseInt(c[y+1],0);c[4]&&(c[5]?S[3]=.01*parseFloat(c[4]):S[3]=parseFloat(c[4]))}else{if(!(c=H.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=H.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:P.call(Z,c[1])?((S=Z[c[1]])[3]=1,S):null:null;for(y=0;y<3;y++)S[y]=Math.round(2.55*parseFloat(c[y+1]));c[4]&&(c[5]?S[3]=.01*parseFloat(c[4]):S[3]=parseFloat(c[4]))}for(y=0;y<3;y++)S[y]=a(S[y],0,255);return S[3]=a(S[3],0,1),S},O.get.hsl=function(H){if(!H)return null;var c=H.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var y=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,a(parseFloat(c[2]),0,100),a(parseFloat(c[3]),0,100),a(isNaN(y)?1:y,0,1)]}return null},O.get.hwb=function(H){if(!H)return null;var c=H.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var y=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,a(parseFloat(c[2]),0,100),a(parseFloat(c[3]),0,100),a(isNaN(y)?1:y,0,1)]}return null},O.to.hex=function(){var H=F(arguments);return"#"+i(H[0])+i(H[1])+i(H[2])+(H[3]<1?i(Math.round(255*H[3])):"")},O.to.rgb=function(){var H=F(arguments);return H.length<4||1===H[3]?"rgb("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+")":"rgba("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+", "+H[3]+")"},O.to.rgb.percent=function(){var H=F(arguments),c=Math.round(H[0]/255*100),y=Math.round(H[1]/255*100),Z=Math.round(H[2]/255*100);return H.length<4||1===H[3]?"rgb("+c+"%, "+y+"%, "+Z+"%)":"rgba("+c+"%, "+y+"%, "+Z+"%, "+H[3]+")"},O.to.hsl=function(){var H=F(arguments);return H.length<4||1===H[3]?"hsl("+H[0]+", "+H[1]+"%, "+H[2]+"%)":"hsla("+H[0]+", "+H[1]+"%, "+H[2]+"%, "+H[3]+")"},O.to.hwb=function(){var H=F(arguments),c="";return H.length>=4&&1!==H[3]&&(c=", "+H[3]),"hwb("+H[0]+", "+H[1]+"%, "+H[2]+"%"+c+")"},O.to.keyword=function(H){return S[H.slice(0,3)]}},12730:(H,c,y)=>{const Z=y(12735),F=y(12759),P=["keyword","gray","hex"],S={};for(const v of Object.keys(F))S[[...F[v].labels].sort().join("")]=v;const n={};function O(H,c){if(!(this instanceof O))return new O(H,c);if(c&&c in P&&(c=null),c&&!(c in F))throw new Error("Unknown model: "+c);let y,a;if(null==H)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(H instanceof O)this.model=H.model,this.color=[...H.color],this.valpha=H.valpha;else if("string"===typeof H){const c=Z.get(H);if(null===c)throw new Error("Unable to parse color from string: "+H);this.model=c.model,a=F[this.model].channels,this.color=c.value.slice(0,a),this.valpha="number"===typeof c.value[a]?c.value[a]:1}else if(H.length>0){this.model=c||"rgb",a=F[this.model].channels;const y=Array.prototype.slice.call(H,0,a);this.color=g(y,a),this.valpha="number"===typeof H[a]?H[a]:1}else if("number"===typeof H)this.model="rgb",this.color=[H>>16&255,H>>8&255,255&H],this.valpha=1;else{this.valpha=1;const c=Object.keys(H);"alpha"in H&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof H.alpha?H.alpha:0);const Z=c.sort().join("");if(!(Z in S))throw new Error("Unable to parse color from object: "+JSON.stringify(H));this.model=S[Z];const{labels:P}=F[this.model],n=[];for(y=0;y<P.length;y++)n.push(H[P[y]]);this.color=g(n)}if(n[this.model])for(a=F[this.model].channels,y=0;y<a;y++){const H=n[this.model][y];H&&(this.color[y]=H(this.color[y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}O.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(H){let c=this.model in Z.to?this:this.rgb();c=c.round("number"===typeof H?H:1);const y=1===c.valpha?c.color:[...c.color,this.valpha];return Z.to[c.model](y)},percentString(H){const c=this.rgb().round("number"===typeof H?H:1),y=1===c.valpha?c.color:[...c.color,this.valpha];return Z.to.rgb.percent(y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const H={},{channels:c}=F[this.model],{labels:y}=F[this.model];for(let Z=0;Z<c;Z++)H[y[Z]]=this.color[Z];return 1!==this.valpha&&(H.alpha=this.valpha),H},unitArray(){const H=this.rgb().color;return H[0]/=255,H[1]/=255,H[2]/=255,1!==this.valpha&&H.push(this.valpha),H},unitObject(){const H=this.rgb().object();return H.r/=255,H.g/=255,H.b/=255,1!==this.valpha&&(H.alpha=this.valpha),H},round(H){return H=Math.max(H||0,0),new O([...this.color.map(a(H)),this.valpha],this.model)},alpha(H){return void 0!==H?new O([...this.color,Math.max(0,Math.min(1,H))],this.model):this.valpha},red:i("rgb",0,C(255)),green:i("rgb",1,C(255)),blue:i("rgb",2,C(255)),hue:i(["hsl","hsv","hsl","hwb","hcg"],0,(H=>(H%360+360)%360)),saturationl:i("hsl",1,C(100)),lightness:i("hsl",2,C(100)),saturationv:i("hsv",1,C(100)),value:i("hsv",2,C(100)),chroma:i("hcg",1,C(100)),gray:i("hcg",2,C(100)),white:i("hwb",1,C(100)),wblack:i("hwb",2,C(100)),cyan:i("cmyk",0,C(100)),magenta:i("cmyk",1,C(100)),yellow:i("cmyk",2,C(100)),black:i("cmyk",3,C(100)),x:i("xyz",0,C(95.047)),y:i("xyz",1,C(100)),z:i("xyz",2,C(108.833)),l:i("lab",0,C(100)),a:i("lab",1),b:i("lab",2),keyword(H){return void 0!==H?new O(H):F[this.model].keyword(this.color)},hex(H){return void 0!==H?new O(H):Z.to.hex(this.rgb().round().color)},hexa(H){if(void 0!==H)return new O(H);const c=this.rgb().round().color;let y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===y.length&&(y="0"+y),Z.to.hex(c)+y},rgbNumber(){const H=this.rgb().color;return(255&H[0])<<16|(255&H[1])<<8|255&H[2]},luminosity(){const H=this.rgb().color,c=[];for(const[y,Z]of H.entries()){const H=Z/255;c[y]=H<=.04045?H/12.92:((H+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(H){const c=this.luminosity(),y=H.luminosity();return c>y?(c+.05)/(y+.05):(y+.05)/(c+.05)},level(H){const c=this.contrast(H);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const H=this.rgb().color;return(2126*H[0]+7152*H[1]+722*H[2])/1e4<128},isLight(){return!this.isDark()},negate(){const H=this.rgb();for(let c=0;c<3;c++)H.color[c]=255-H.color[c];return H},lighten(H){const c=this.hsl();return c.color[2]+=c.color[2]*H,c},darken(H){const c=this.hsl();return c.color[2]-=c.color[2]*H,c},saturate(H){const c=this.hsl();return c.color[1]+=c.color[1]*H,c},desaturate(H){const c=this.hsl();return c.color[1]-=c.color[1]*H,c},whiten(H){const c=this.hwb();return c.color[1]+=c.color[1]*H,c},blacken(H){const c=this.hwb();return c.color[2]+=c.color[2]*H,c},grayscale(){const H=this.rgb().color,c=.3*H[0]+.59*H[1]+.11*H[2];return O.rgb(c,c,c)},fade(H){return this.alpha(this.valpha-this.valpha*H)},opaquer(H){return this.alpha(this.valpha+this.valpha*H)},rotate(H){const c=this.hsl();let y=c.color[0];return y=(y+H)%360,y=y<0?360+y:y,c.color[0]=y,c},mix(H,c){if(!H||!H.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof H);const y=H.rgb(),Z=this.rgb(),F=void 0===c?.5:c,P=2*F-1,S=y.alpha()-Z.alpha(),n=((P*S===-1?P:(P+S)/(1+P*S))+1)/2,a=1-n;return O.rgb(n*y.red()+a*Z.red(),n*y.green()+a*Z.green(),n*y.blue()+a*Z.blue(),y.alpha()*F+Z.alpha()*(1-F))}};for(const v of Object.keys(F)){if(P.includes(v))continue;const{channels:H}=F[v];O.prototype[v]=function(){if(this.model===v)return new O(this);for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];return c.length>0?new O(c,v):new O([...(Z=F[this.model][v].raw(this.color),Array.isArray(Z)?Z:[Z]),this.valpha],v);var Z},O[v]=function(){for(var c=arguments.length,y=new Array(c),Z=0;Z<c;Z++)y[Z]=arguments[Z];let F=y[0];return"number"===typeof F&&(F=g(y,H)),new O(F,v)}}function a(H){return function(c){return function(H,c){return Number(H.toFixed(c))}(c,H)}}function i(H,c,y){H=Array.isArray(H)?H:[H];for(const Z of H)(n[Z]||(n[Z]=[]))[c]=y;return H=H[0],function(Z){let F;return void 0!==Z?(y&&(Z=y(Z)),F=this[H](),F.color[c]=Z,F):(F=this[H]().color[c],y&&(F=y(F)),F)}}function C(H){return function(c){return Math.max(0,Math.min(H,c))}}function g(H,c){for(let y=0;y<c;y++)"number"!==typeof H[y]&&(H[y]=0);return H}H.exports=O},12762:(H,c,y)=>{const Z=y(12769),F={};for(const S of Object.keys(Z))F[Z[S]]=S;const P={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};H.exports=P;for(const S of Object.keys(P)){if(!("channels"in P[S]))throw new Error("missing channels property: "+S);if(!("labels"in P[S]))throw new Error("missing channel labels property: "+S);if(P[S].labels.length!==P[S].channels)throw new Error("channel and label counts mismatch: "+S);const{channels:H,labels:c}=P[S];delete P[S].channels,delete P[S].labels,Object.defineProperty(P[S],"channels",{value:H}),Object.defineProperty(P[S],"labels",{value:c})}P.rgb.hsl=function(H){const c=H[0]/255,y=H[1]/255,Z=H[2]/255,F=Math.min(c,y,Z),P=Math.max(c,y,Z),S=P-F;let n,O;P===F?n=0:c===P?n=(y-Z)/S:y===P?n=2+(Z-c)/S:Z===P&&(n=4+(c-y)/S),n=Math.min(60*n,360),n<0&&(n+=360);const a=(F+P)/2;return O=P===F?0:a<=.5?S/(P+F):S/(2-P-F),[n,100*O,100*a]},P.rgb.hsv=function(H){let c,y,Z,F,P;const S=H[0]/255,n=H[1]/255,O=H[2]/255,a=Math.max(S,n,O),i=a-Math.min(S,n,O),C=function(H){return(a-H)/6/i+.5};return 0===i?(F=0,P=0):(P=i/a,c=C(S),y=C(n),Z=C(O),S===a?F=Z-y:n===a?F=1/3+c-Z:O===a&&(F=2/3+y-c),F<0?F+=1:F>1&&(F-=1)),[360*F,100*P,100*a]},P.rgb.hwb=function(H){const c=H[0],y=H[1];let Z=H[2];const F=P.rgb.hsl(H)[0],S=1/255*Math.min(c,Math.min(y,Z));return Z=1-1/255*Math.max(c,Math.max(y,Z)),[F,100*S,100*Z]},P.rgb.cmyk=function(H){const c=H[0]/255,y=H[1]/255,Z=H[2]/255,F=Math.min(1-c,1-y,1-Z);return[100*((1-c-F)/(1-F)||0),100*((1-y-F)/(1-F)||0),100*((1-Z-F)/(1-F)||0),100*F]},P.rgb.keyword=function(H){const c=F[H];if(c)return c;let y,P=1/0;for(const F of Object.keys(Z)){const c=Z[F],O=(n=c,((S=H)[0]-n[0])**2+(S[1]-n[1])**2+(S[2]-n[2])**2);O<P&&(P=O,y=F)}var S,n;return y},P.keyword.rgb=function(H){return Z[H]},P.rgb.xyz=function(H){let c=H[0]/255,y=H[1]/255,Z=H[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92;return[100*(.4124*c+.3576*y+.1805*Z),100*(.2126*c+.7152*y+.0722*Z),100*(.0193*c+.1192*y+.9505*Z)]},P.rgb.lab=function(H){const c=P.rgb.xyz(H);let y=c[0],Z=c[1],F=c[2];y/=95.047,Z/=100,F/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;return[116*Z-16,500*(y-Z),200*(Z-F)]},P.hsl.rgb=function(H){const c=H[0]/360,y=H[1]/100,Z=H[2]/100;let F,P,S;if(0===y)return S=255*Z,[S,S,S];F=Z<.5?Z*(1+y):Z+y-Z*y;const n=2*Z-F,O=[0,0,0];for(let a=0;a<3;a++)P=c+1/3*-(a-1),P<0&&P++,P>1&&P--,S=6*P<1?n+6*(F-n)*P:2*P<1?F:3*P<2?n+(F-n)*(2/3-P)*6:n,O[a]=255*S;return O},P.hsl.hsv=function(H){const c=H[0];let y=H[1]/100,Z=H[2]/100,F=y;const P=Math.max(Z,.01);Z*=2,y*=Z<=1?Z:2-Z,F*=P<=1?P:2-P;return[c,100*(0===Z?2*F/(P+F):2*y/(Z+y)),100*((Z+y)/2)]},P.hsv.rgb=function(H){const c=H[0]/60,y=H[1]/100;let Z=H[2]/100;const F=Math.floor(c)%6,P=c-Math.floor(c),S=255*Z*(1-y),n=255*Z*(1-y*P),O=255*Z*(1-y*(1-P));switch(Z*=255,F){case 0:return[Z,O,S];case 1:return[n,Z,S];case 2:return[S,Z,O];case 3:return[S,n,Z];case 4:return[O,S,Z];case 5:return[Z,S,n]}},P.hsv.hsl=function(H){const c=H[0],y=H[1]/100,Z=H[2]/100,F=Math.max(Z,.01);let P,S;S=(2-y)*Z;const n=(2-y)*F;return P=y*F,P/=n<=1?n:2-n,P=P||0,S/=2,[c,100*P,100*S]},P.hwb.rgb=function(H){const c=H[0]/360;let y=H[1]/100,Z=H[2]/100;const F=y+Z;let P;F>1&&(y/=F,Z/=F);const S=Math.floor(6*c),n=1-Z;P=6*c-S,0!==(1&S)&&(P=1-P);const O=y+P*(n-y);let a,i,C;switch(S){default:case 6:case 0:a=n,i=O,C=y;break;case 1:a=O,i=n,C=y;break;case 2:a=y,i=n,C=O;break;case 3:a=y,i=O,C=n;break;case 4:a=O,i=y,C=n;break;case 5:a=n,i=y,C=O}return[255*a,255*i,255*C]},P.cmyk.rgb=function(H){const c=H[0]/100,y=H[1]/100,Z=H[2]/100,F=H[3]/100;return[255*(1-Math.min(1,c*(1-F)+F)),255*(1-Math.min(1,y*(1-F)+F)),255*(1-Math.min(1,Z*(1-F)+F))]},P.xyz.rgb=function(H){const c=H[0]/100,y=H[1]/100,Z=H[2]/100;let F,P,S;return F=3.2406*c+-1.5372*y+-.4986*Z,P=-.9689*c+1.8758*y+.0415*Z,S=.0557*c+-.204*y+1.057*Z,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,P=P>.0031308?1.055*P**(1/2.4)-.055:12.92*P,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,F=Math.min(Math.max(0,F),1),P=Math.min(Math.max(0,P),1),S=Math.min(Math.max(0,S),1),[255*F,255*P,255*S]},P.xyz.lab=function(H){let c=H[0],y=H[1],Z=H[2];c/=95.047,y/=100,Z/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116;return[116*y-16,500*(c-y),200*(y-Z)]},P.lab.xyz=function(H){let c,y,Z;y=(H[0]+16)/116,c=H[1]/500+y,Z=y-H[2]/200;const F=y**3,P=c**3,S=Z**3;return y=F>.008856?F:(y-16/116)/7.787,c=P>.008856?P:(c-16/116)/7.787,Z=S>.008856?S:(Z-16/116)/7.787,c*=95.047,y*=100,Z*=108.883,[c,y,Z]},P.lab.lch=function(H){const c=H[0],y=H[1],Z=H[2];let F;F=360*Math.atan2(Z,y)/2/Math.PI,F<0&&(F+=360);return[c,Math.sqrt(y*y+Z*Z),F]},P.lch.lab=function(H){const c=H[0],y=H[1],Z=H[2]/360*2*Math.PI;return[c,y*Math.cos(Z),y*Math.sin(Z)]},P.rgb.ansi16=function(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[y,Z,F]=H;let S=null===c?P.rgb.hsv(H)[2]:c;if(S=Math.round(S/50),0===S)return 30;let n=30+(Math.round(F/255)<<2|Math.round(Z/255)<<1|Math.round(y/255));return 2===S&&(n+=60),n},P.hsv.ansi16=function(H){return P.rgb.ansi16(P.hsv.rgb(H),H[2])},P.rgb.ansi256=function(H){const c=H[0],y=H[1],Z=H[2];if(c===y&&y===Z)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(y/255*5)+Math.round(Z/255*5)},P.ansi16.rgb=function(H){let c=H%10;if(0===c||7===c)return H>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const y=.5*(1+~~(H>50));return[(1&c)*y*255,(c>>1&1)*y*255,(c>>2&1)*y*255]},P.ansi256.rgb=function(H){if(H>=232){const c=10*(H-232)+8;return[c,c,c]}let c;H-=16;return[Math.floor(H/36)/5*255,Math.floor((c=H%36)/6)/5*255,c%6/5*255]},P.rgb.hex=function(H){const c=(((255&Math.round(H[0]))<<16)+((255&Math.round(H[1]))<<8)+(255&Math.round(H[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},P.hex.rgb=function(H){const c=H.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let y=c[0];3===c[0].length&&(y=y.split("").map((H=>H+H)).join(""));const Z=parseInt(y,16);return[Z>>16&255,Z>>8&255,255&Z]},P.rgb.hcg=function(H){const c=H[0]/255,y=H[1]/255,Z=H[2]/255,F=Math.max(Math.max(c,y),Z),P=Math.min(Math.min(c,y),Z),S=F-P;let n,O;return n=S<1?P/(1-S):0,O=S<=0?0:F===c?(y-Z)/S%6:F===y?2+(Z-c)/S:4+(c-y)/S,O/=6,O%=1,[360*O,100*S,100*n]},P.hsl.hcg=function(H){const c=H[1]/100,y=H[2]/100,Z=y<.5?2*c*y:2*c*(1-y);let F=0;return Z<1&&(F=(y-.5*Z)/(1-Z)),[H[0],100*Z,100*F]},P.hsv.hcg=function(H){const c=H[1]/100,y=H[2]/100,Z=c*y;let F=0;return Z<1&&(F=(y-Z)/(1-Z)),[H[0],100*Z,100*F]},P.hcg.rgb=function(H){const c=H[0]/360,y=H[1]/100,Z=H[2]/100;if(0===y)return[255*Z,255*Z,255*Z];const F=[0,0,0],P=c%1*6,S=P%1,n=1-S;let O=0;switch(Math.floor(P)){case 0:F[0]=1,F[1]=S,F[2]=0;break;case 1:F[0]=n,F[1]=1,F[2]=0;break;case 2:F[0]=0,F[1]=1,F[2]=S;break;case 3:F[0]=0,F[1]=n,F[2]=1;break;case 4:F[0]=S,F[1]=0,F[2]=1;break;default:F[0]=1,F[1]=0,F[2]=n}return O=(1-y)*Z,[255*(y*F[0]+O),255*(y*F[1]+O),255*(y*F[2]+O)]},P.hcg.hsv=function(H){const c=H[1]/100,y=c+H[2]/100*(1-c);let Z=0;return y>0&&(Z=c/y),[H[0],100*Z,100*y]},P.hcg.hsl=function(H){const c=H[1]/100,y=H[2]/100*(1-c)+.5*c;let Z=0;return y>0&&y<.5?Z=c/(2*y):y>=.5&&y<1&&(Z=c/(2*(1-y))),[H[0],100*Z,100*y]},P.hcg.hwb=function(H){const c=H[1]/100,y=c+H[2]/100*(1-c);return[H[0],100*(y-c),100*(1-y)]},P.hwb.hcg=function(H){const c=H[1]/100,y=1-H[2]/100,Z=y-c;let F=0;return Z<1&&(F=(y-Z)/(1-Z)),[H[0],100*Z,100*F]},P.apple.rgb=function(H){return[H[0]/65535*255,H[1]/65535*255,H[2]/65535*255]},P.rgb.apple=function(H){return[H[0]/255*65535,H[1]/255*65535,H[2]/255*65535]},P.gray.rgb=function(H){return[H[0]/100*255,H[0]/100*255,H[0]/100*255]},P.gray.hsl=function(H){return[0,0,H[0]]},P.gray.hsv=P.gray.hsl,P.gray.hwb=function(H){return[0,100,H[0]]},P.gray.cmyk=function(H){return[0,0,0,H[0]]},P.gray.lab=function(H){return[H[0],0,0]},P.gray.hex=function(H){const c=255&Math.round(H[0]/100*255),y=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(y.length)+y},P.rgb.gray=function(H){return[(H[0]+H[1]+H[2])/3/255*100]}},12759:(H,c,y)=>{const Z=y(12762),F=y(12775),P={};Object.keys(Z).forEach((H=>{P[H]={},Object.defineProperty(P[H],"channels",{value:Z[H].channels}),Object.defineProperty(P[H],"labels",{value:Z[H].labels});const c=F(H);Object.keys(c).forEach((y=>{const Z=c[y];P[H][y]=function(H){const c=function(){for(var c=arguments.length,y=new Array(c),Z=0;Z<c;Z++)y[Z]=arguments[Z];const F=y[0];if(void 0===F||null===F)return F;F.length>1&&(y=F);const P=H(y);if("object"===typeof P)for(let H=P.length,S=0;S<H;S++)P[S]=Math.round(P[S]);return P};return"conversion"in H&&(c.conversion=H.conversion),c}(Z),P[H][y].raw=function(H){const c=function(){for(var c=arguments.length,y=new Array(c),Z=0;Z<c;Z++)y[Z]=arguments[Z];const F=y[0];return void 0===F||null===F?F:(F.length>1&&(y=F),H(y))};return"conversion"in H&&(c.conversion=H.conversion),c}(Z)}))})),H.exports=P},12775:(H,c,y)=>{const Z=y(12762);function F(H){const c=function(){const H={},c=Object.keys(Z);for(let y=c.length,Z=0;Z<y;Z++)H[c[Z]]={distance:-1,parent:null};return H}(),y=[H];for(c[H].distance=0;y.length;){const H=y.pop(),F=Object.keys(Z[H]);for(let Z=F.length,P=0;P<Z;P++){const Z=F[P],S=c[Z];-1===S.distance&&(S.distance=c[H].distance+1,S.parent=H,y.unshift(Z))}}return c}function P(H,c){return function(y){return c(H(y))}}function S(H,c){const y=[c[H].parent,H];let F=Z[c[H].parent][H],S=c[H].parent;for(;c[S].parent;)y.unshift(c[S].parent),F=P(Z[c[S].parent][S],F),S=c[S].parent;return F.conversion=y,F}H.exports=function(H){const c=F(H),y={},Z=Object.keys(c);for(let F=Z.length,P=0;P<F;P++){const H=Z[P];null!==c[H].parent&&(y[H]=S(H,c))}return y}},12769:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10684:function(H,c,y){"use strict";var Z=this&&this.__createBinding||(Object.create?function(H,c,y,Z){void 0===Z&&(Z=y);var F=Object.getOwnPropertyDescriptor(c,y);F&&!("get"in F?!c.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return c[y]}}),Object.defineProperty(H,Z,F)}:function(H,c,y,Z){void 0===Z&&(Z=y),H[Z]=c[y]}),F=this&&this.__setModuleDefault||(Object.create?function(H,c){Object.defineProperty(H,"default",{enumerable:!0,value:c})}:function(H,c){H.default=c}),P=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var c={};if(null!=H)for(var y in H)"default"!==y&&Object.prototype.hasOwnProperty.call(H,y)&&Z(c,H,y);return F(c,H),c},S=this&&this.__awaiter||function(H,c,y,Z){return new(y||(y=Promise))((function(F,P){function S(H){try{O(Z.next(H))}catch(c){P(c)}}function n(H){try{O(Z.throw(H))}catch(c){P(c)}}function O(H){var c;H.done?F(H.value):(c=H.value,c instanceof y?c:new y((function(H){H(c)}))).then(S,n)}O((Z=Z.apply(H,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=c.Platform=void 0;const n=P(y(10614)),O=y(10687),a="colyseus-auth-token";!function(H){H.ios="ios",H.android="android"}(c.Platform||(c.Platform={}));c.Auth=class{constructor(H){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=H.replace("ws","http"),(0,O.getItem)(a,(H=>this.token=H))}get hasToken(){return!!this.token}login(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S(this,void 0,void 0,(function*(){const c=Object.assign({},H);this.hasToken&&(c.token=this.token);const y=yield this.request("post","/auth",c);this.token=y.token,(0,O.setItem)(a,this.token);for(let H in y)this.hasOwnProperty(H)&&(this[H]=y[H]);return this.registerPingService(),this}))}save(){return S(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(H){return S(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:H})}))}acceptFriendRequest(H){return S(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:H})}))}declineFriendRequest(H){return S(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:H})}))}blockUser(H){return S(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:H})}))}unblockUser(H){return S(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:H})}))}request(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return S(this,void 0,void 0,(function*(){F.Accept="application/json",this.hasToken&&(F.Authorization="Bearer "+this.token);const P=[];for(const H in y)P.push(`${H}=${y[H]}`);const S=P.length>0?`?${P.join("&")}`:"",O={headers:F};return Z&&(O.body=Z),(yield n[H](`${this.endpoint}${c}${S}`,O)).data}))}logout(){this.token=void 0,(0,O.removeItem)(a),this.unregisterPingService()}registerPingService(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),H)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10611:function(H,c,y){"use strict";var Z,F=this&&this.__awaiter||function(H,c,y,Z){return new(y||(y=Promise))((function(F,P){function S(H){try{O(Z.next(H))}catch(c){P(c)}}function n(H){try{O(Z.throw(H))}catch(c){P(c)}}function O(H){var c;H.done?F(H.value):(c=H.value,c instanceof y?c:new y((function(H){H(c)}))).then(S,n)}O((Z=Z.apply(H,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const P=y(10614),S=y(10620),n=y(10623);class O extends Error{constructor(H,c){super(H),this.code=c,Object.setPrototypeOf(this,O.prototype)}}c.MatchMakeError=O;const a="undefined"!==typeof window&&"undefined"!==typeof(null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if("string"===typeof H){const c=new URL(H),y="https:"===c.protocol||"wss:"===c.protocol,Z=Number(c.port||(y?443:80));this.settings={hostname:c.hostname,pathname:"/"!==c.pathname?c.pathname:"",port:Z,secure:y}}else void 0===H.port&&(H.port=H.secure?443:80),void 0===H.pathname&&(H.pathname=""),this.settings=H}joinOrCreate(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",H,c,y)}))}create(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",H,c,y)}))}join(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",H,c,y)}))}joinById(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",H,c,y)}))}reconnect(H,c){return F(this,void 0,void 0,(function*(){if("string"===typeof H&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[y,Z]=H.split(":");return yield this.createMatchMakeRequest("reconnect",y,{reconnectionToken:Z},c)}))}getAvailableRooms(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return F(this,void 0,void 0,(function*(){return(yield(0,P.get)(this.getHttpEndpoint(`${H}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(H,c,y){return F(this,void 0,void 0,(function*(){const Z=this.createRoom(H.room.name,c);Z.roomId=H.room.roomId,Z.sessionId=H.sessionId;const P={sessionId:Z.sessionId};H.reconnectionToken&&(P.reconnectionToken=H.reconnectionToken);const n=y||Z;return Z.connect(this.buildEndpoint(H.room,P),H.devMode&&(()=>F(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Z.roomId}'...`);let y=0;const P=()=>F(this,void 0,void 0,(function*(){y++;try{yield this.consumeSeatReservation(H,c,n),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Z.roomId}'`)}catch(F){y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${y} out of 8)`),setTimeout(P,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(P,2e3)}))),n),new Promise(((H,c)=>{const y=(H,y)=>c(new S.ServerError(H,y));n.onError.once(y),n.onJoin.once((()=>{n.onError.remove(y),H(n)}))}))}))}createMatchMakeRequest(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;return F(this,void 0,void 0,(function*(){const F=(yield(0,P.post)(this.getHttpEndpoint(`${H}/${c}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y)})).data;if(F.error)throw new O(F.error,F.code);return"reconnect"===H&&(F.reconnectionToken=y.reconnectionToken),yield this.consumeSeatReservation(F,Z,S)}))}createRoom(H,c){return new n.Room(H,c)}buildEndpoint(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=[];for(const F in c)c.hasOwnProperty(F)&&y.push(`${F}=${c[F]}`);let Z=this.settings.secure?"wss://":"ws://";return H.publicAddress?Z+=`${H.publicAddress}`:Z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${Z}/${H.processId}/${H.roomId}?${y.join("&")}`}getHttpEndpoint(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${H}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10631:(H,c,y)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const Z=y(10640);c.Connection=class{constructor(){this.events={},this.transport=new Z.WebSocketTransport(this.events)}send(H){this.transport.send(H)}connect(H){this.transport.connect(H)}close(H,c){this.transport.close(H,c)}get isOpen(){return this.transport.isOpen}}},10650:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(H){H[H.HANDSHAKE=9]="HANDSHAKE",H[H.JOIN_ROOM=10]="JOIN_ROOM",H[H.ERROR=11]="ERROR",H[H.LEAVE_ROOM=12]="LEAVE_ROOM",H[H.ROOM_DATA=13]="ROOM_DATA",H[H.ROOM_STATE=14]="ROOM_STATE",H[H.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",H[H.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",H[H.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(H){H[H.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",H[H.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",H[H.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",H[H.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",H[H.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",H[H.AUTH_FAILED=4215]="AUTH_FAILED",H[H.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(H,c){const y=H[c++];for(var Z="",F=0,P=c,S=c+y;P<S;P++){var n=H[P];if(0!==(128&n))if(192!==(224&n))if(224!==(240&n)){if(240!==(248&n))throw new Error("Invalid byte "+n.toString(16));(F=(7&n)<<18|(63&H[++P])<<12|(63&H[++P])<<6|63&H[++P])>=65536?(F-=65536,Z+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):Z+=String.fromCharCode(F)}else Z+=String.fromCharCode((15&n)<<12|(63&H[++P])<<6|63&H[++P]);else Z+=String.fromCharCode((31&n)<<6|63&H[++P]);else Z+=String.fromCharCode(n)}return Z},c.utf8Length=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,y=0;for(let Z=0,F=H.length;Z<F;Z++)c=H.charCodeAt(Z),c<128?y+=1:c<2048?y+=2:c<55296||c>=57344?y+=3:(Z++,y+=4);return y+1}},10623:function(H,c,y){"use strict";var Z=this&&this.__createBinding||(Object.create?function(H,c,y,Z){void 0===Z&&(Z=y);var F=Object.getOwnPropertyDescriptor(c,y);F&&!("get"in F?!c.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return c[y]}}),Object.defineProperty(H,Z,F)}:function(H,c,y,Z){void 0===Z&&(Z=y),H[Z]=c[y]}),F=this&&this.__setModuleDefault||(Object.create?function(H,c){Object.defineProperty(H,"default",{enumerable:!0,value:c})}:function(H,c){H.default=c}),P=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var c={};if(null!=H)for(var y in H)"default"!==y&&Object.prototype.hasOwnProperty.call(H,y)&&Z(c,H,y);return F(c,H),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const S=P(y(10629)),n=y(10631),O=y(10650),a=y(10657),i=y(10664),C=y(10672),g=y(10675),v=y(10620);class m{constructor(H,c){this.onStateChange=(0,C.createSignal)(),this.onError=(0,C.createSignal)(),this.onLeave=(0,C.createSignal)(),this.onJoin=(0,C.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=H,c&&(this.serializer=new((0,a.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((H,c)=>{var y;return null===(y=console.warn)||void 0===y?void 0:y.call(console,`colyseus.js - onError => (${H}) ${c}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const Z=new n.Connection;y.connection=Z,Z.events.onmessage=m.prototype.onMessageCallback.bind(y),Z.events.onclose=function(H){var Z;if(!y.hasJoined)return null===(Z=console.warn)||void 0===Z||Z.call(console,`Room connection was closed unexpectedly (${H.code}): ${H.reason}`),void y.onError.invoke(H.code,H.reason);H.code===v.CloseCode.DEVMODE_RESTART&&c?c():(y.onLeave.invoke(H.code),y.destroy())},Z.events.onerror=function(H){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${H.code}): ${H.reason}`),y.onError.invoke(H.code,H.reason)},Z.connect(H)}leave(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((H=>c(H))),this.connection?H?this.connection.send([O.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(v.CloseCode.CONSENTED)}))}onMessage(H,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(H),c)}send(H,c){const y=[O.Protocol.ROOM_DATA];let Z;if("string"===typeof H?g.encode.string(y,H):g.encode.number(y,H),void 0!==c){const H=S.encode(c);Z=new Uint8Array(y.length+H.byteLength),Z.set(new Uint8Array(y),0),Z.set(new Uint8Array(H),y.length)}else Z=new Uint8Array(y);this.connection.send(Z.buffer)}sendBytes(H,c){const y=[O.Protocol.ROOM_DATA_BYTES];let Z;"string"===typeof H?g.encode.string(y,H):g.encode.number(y,H),Z=new Uint8Array(y.length+(c.byteLength||c.length)),Z.set(new Uint8Array(y),0),Z.set(new Uint8Array(c),y.length),this.connection.send(Z.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(H){const c=Array.from(new Uint8Array(H.data)),y=c[0];if(y===O.Protocol.JOIN_ROOM){let H=1;const y=(0,O.utf8Read)(c,H);if(H+=(0,O.utf8Length)(y),this.serializerId=(0,O.utf8Read)(c,H),H+=(0,O.utf8Length)(this.serializerId),!this.serializer){const H=(0,a.getSerializer)(this.serializerId);this.serializer=new H}c.length>H&&this.serializer.handshake&&this.serializer.handshake(c,{offset:H}),this.reconnectionToken=`${this.roomId}:${y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([O.Protocol.JOIN_ROOM])}else if(y===O.Protocol.ERROR){const H={offset:1},y=g.decode.number(c,H),Z=g.decode.string(c,H);this.onError.invoke(y,Z)}else if(y===O.Protocol.LEAVE_ROOM)this.leave();else if(y===O.Protocol.ROOM_DATA_SCHEMA){const H={offset:1},y=this.serializer.getState().constructor._context.get(g.decode.number(c,H)),Z=new y;Z.decode(c,H),this.dispatchMessage(y,Z)}else if(y===O.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(y===O.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(y===O.Protocol.ROOM_DATA){const y={offset:1},Z=g.decode.stringCheck(c,y)?g.decode.string(c,y):g.decode.number(c,y),F=c.length>y.offset?S.decode(H.data,y.offset):void 0;this.dispatchMessage(Z,F)}else if(y===O.Protocol.ROOM_DATA_BYTES){const H={offset:1},y=g.decode.stringCheck(c,H)?g.decode.string(c,H):g.decode.number(c,H);this.dispatchMessage(y,new Uint8Array(c.slice(H.offset)))}}setState(H){this.serializer.setState(H),this.onStateChange.invoke(this.serializer.getState())}patch(H){this.serializer.patch(H),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(H,c){var y;const Z=this.getMessageHandlerKey(H);this.onMessageHandlers.events[Z]?this.onMessageHandlers.emit(Z,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",H,c):null===(y=console.warn)||void 0===y||y.call(console,`colyseus.js: onMessage() not registered for type '${H}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(H){switch(typeof H){case"function":return`$${H._typeid}`;case"string":return H;case"number":return`i${H}`;default:throw new Error("invalid message type.")}}}c.Room=m},10687:(H,c)=>{"use strict";let y;function Z(){return y||(y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(H,c){this.cache[H]=c},getItem:function(H){this.cache[H]},removeItem:function(H){delete this.cache[H]}}),y}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(H,c){Z().setItem(H,c)},c.removeItem=function(H){Z().removeItem(H)},c.getItem=function(H,c){const y=Z().getItem(H);"undefined"!==typeof Promise&&y instanceof Promise?y.then((H=>c(H))):c(y)}},10664:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(H){let c=this.events[H]||[];for(var y=arguments.length,Z=new Array(y>1?y-1:0),F=1;F<y;F++)Z[F-1]=arguments[F];for(let P=0,S=c.length;P<S;P++)c[P](...Z)},events:{},on(H,c){var y;return(null===(y=this.events[H])||void 0===y?void 0:y.push(c))||(this.events[H]=[c]),()=>{var y;this.events[H]=null===(y=this.events[H])||void 0===y?void 0:y.filter((H=>c!==H))}}})},10672:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class y{constructor(){this.handlers=[]}register(H){return this.handlers.push(H),this}invoke(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];this.handlers.forEach((H=>H.apply(this,c)))}invokeAsync(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];return Promise.all(this.handlers.map((H=>H.apply(this,c))))}remove(H){const c=this.handlers.indexOf(H);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=y,c.createSignal=function(){const H=new y;function c(c){return H.register(c,null===this)}return c.once=c=>{const y=function(){for(var Z=arguments.length,F=new Array(Z),P=0;P<Z;P++)F[P]=arguments[P];c.apply(this,F),H.remove(y)};H.register(y)},c.remove=c=>H.remove(c),c.invoke=function(){return H.invoke(...arguments)},c.invokeAsync=function(){return H.invokeAsync(...arguments)},c.clear=()=>H.clear(),c}},10620:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(H){H[H.CONSENTED=4e3]="CONSENTED",H[H.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class y extends Error{constructor(H,c){super(c),this.name="ServerError",this.code=H}}c.ServerError=y},10595:(H,c,y)=>{"use strict";c.b=void 0,y(10604);var Z=y(10611);Object.defineProperty(c,"b",{enumerable:!0,get:function(){return Z.Client}});var F=y(10650);var P=y(10623);var S=y(10684);const n=y(10690);const O=y(10692),a=y(10657);(0,a.registerSerializer)("schema",n.SchemaSerializer),(0,a.registerSerializer)("none",O.NoneSerializer)},10604:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=H=>null!==H&&"object"===typeof H&&H.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10629:(H,c)=>{"use strict";function y(H,c){if(this._offset=c,H instanceof ArrayBuffer)this._buffer=H,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(H))throw new Error("Invalid argument");this._buffer=H.buffer,this._view=new DataView(this._buffer,H.byteOffset,H.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,y.prototype._array=function(H){for(var c=new Array(H),y=0;y<H;y++)c[y]=this._parse();return c},y.prototype._map=function(H){for(var c={},y=0;y<H;y++)c[this._parse()]=this._parse();return c},y.prototype._str=function(H){var c=function(H,c,y){for(var Z="",F=0,P=c,S=c+y;P<S;P++){var n=H.getUint8(P);if(0!==(128&n))if(192!==(224&n))if(224!==(240&n)){if(240!==(248&n))throw new Error("Invalid byte "+n.toString(16));(F=(7&n)<<18|(63&H.getUint8(++P))<<12|(63&H.getUint8(++P))<<6|63&H.getUint8(++P))>=65536?(F-=65536,Z+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):Z+=String.fromCharCode(F)}else Z+=String.fromCharCode((15&n)<<12|(63&H.getUint8(++P))<<6|63&H.getUint8(++P));else Z+=String.fromCharCode((31&n)<<6|63&H.getUint8(++P));else Z+=String.fromCharCode(n)}return Z}(this._view,this._offset,H);return this._offset+=H,c},y.prototype._bin=function(H){var c=this._buffer.slice(this._offset,this._offset+H);return this._offset+=H,c},y.prototype._parse=function(){var H,c=this._view.getUint8(this._offset++),y=0,Z=0,F=0,P=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return y=this._view.getUint8(this._offset),this._offset+=1,this._bin(y);case 197:return y=this._view.getUint16(this._offset),this._offset+=2,this._bin(y);case 198:return y=this._view.getUint32(this._offset),this._offset+=4,this._bin(y);case 199:if(y=this._view.getUint8(this._offset),Z=this._view.getInt8(this._offset+1),this._offset+=2,-1===Z){var S=this._view.getUint32(this._offset);return F=this._view.getInt32(this._offset+4),P=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*F+P)+S/1e6)}return[Z,this._bin(y)];case 200:return y=this._view.getUint16(this._offset),Z=this._view.getInt8(this._offset+2),this._offset+=3,[Z,this._bin(y)];case 201:return y=this._view.getUint32(this._offset),Z=this._view.getInt8(this._offset+4),this._offset+=5,[Z,this._bin(y)];case 202:return H=this._view.getFloat32(this._offset),this._offset+=4,H;case 203:return H=this._view.getFloat64(this._offset),this._offset+=8,H;case 204:return H=this._view.getUint8(this._offset),this._offset+=1,H;case 205:return H=this._view.getUint16(this._offset),this._offset+=2,H;case 206:return H=this._view.getUint32(this._offset),this._offset+=4,H;case 207:return F=this._view.getUint32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,F+P;case 208:return H=this._view.getInt8(this._offset),this._offset+=1,H;case 209:return H=this._view.getInt16(this._offset),this._offset+=2,H;case 210:return H=this._view.getInt32(this._offset),this._offset+=4,H;case 211:return F=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,F+P;case 212:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?void(this._offset+=1):[Z,this._bin(1)];case 213:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(2)];case 214:return Z=this._view.getInt8(this._offset),this._offset+=1,-1===Z?(H=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*H)):[Z,this._bin(4)];case 215:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?(F=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(F+P)):-1===Z?(F=this._view.getUint32(this._offset),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&F)+P)+(F>>>2)/1e6)):[Z,this._bin(8)];case 216:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(16)];case 217:return y=this._view.getUint8(this._offset),this._offset+=1,this._str(y);case 218:return y=this._view.getUint16(this._offset),this._offset+=2,this._str(y);case 219:return y=this._view.getUint32(this._offset),this._offset+=4,this._str(y);case 220:return y=this._view.getUint16(this._offset),this._offset+=2,this._array(y);case 221:return y=this._view.getUint32(this._offset),this._offset+=4,this._array(y);case 222:return y=this._view.getUint16(this._offset),this._offset+=2,this._map(y);case 223:return y=this._view.getUint32(this._offset),this._offset+=4,this._map(y)}throw new Error("Could not parse")},c.decode=function(H){var c=new y(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Z=c._parse();if(c._offset!==H.byteLength)throw new Error(H.byteLength-c._offset+" trailing bytes");return Z};function Z(H,c,y){for(var Z=0,F=0,P=y.length;F<P;F++)(Z=y.charCodeAt(F))<128?H.setUint8(c++,Z):Z<2048?(H.setUint8(c++,192|Z>>6),H.setUint8(c++,128|63&Z)):Z<55296||Z>=57344?(H.setUint8(c++,224|Z>>12),H.setUint8(c++,128|Z>>6&63),H.setUint8(c++,128|63&Z)):(F++,Z=65536+((1023&Z)<<10|1023&y.charCodeAt(F)),H.setUint8(c++,240|Z>>18),H.setUint8(c++,128|Z>>12&63),H.setUint8(c++,128|Z>>6&63),H.setUint8(c++,128|63&Z))}function F(H,c,y){var Z=typeof y,P=0,S=0,n=0,O=0,a=0,i=0;if("string"===Z){if(a=function(H){for(var c=0,y=0,Z=0,F=H.length;Z<F;Z++)(c=H.charCodeAt(Z))<128?y+=1:c<2048?y+=2:c<55296||c>=57344?y+=3:(Z++,y+=4);return y}(y),a<32)H.push(160|a),i=1;else if(a<256)H.push(217,a),i=2;else if(a<65536)H.push(218,a>>8,a),i=3;else{if(!(a<4294967296))throw new Error("String too long");H.push(219,a>>24,a>>16,a>>8,a),i=5}return c.push({_str:y,_length:a,_offset:H.length}),i+a}if("number"===Z)return Math.floor(y)===y&&isFinite(y)?y>=0?y<128?(H.push(y),1):y<256?(H.push(204,y),2):y<65536?(H.push(205,y>>8,y),3):y<4294967296?(H.push(206,y>>24,y>>16,y>>8,y),5):(n=y/Math.pow(2,32)|0,O=y>>>0,H.push(207,n>>24,n>>16,n>>8,n,O>>24,O>>16,O>>8,O),9):y>=-32?(H.push(y),1):y>=-128?(H.push(208,y),2):y>=-32768?(H.push(209,y>>8,y),3):y>=-2147483648?(H.push(210,y>>24,y>>16,y>>8,y),5):(n=Math.floor(y/Math.pow(2,32)),O=y>>>0,H.push(211,n>>24,n>>16,n>>8,n,O>>24,O>>16,O>>8,O),9):(H.push(203),c.push({_float:y,_length:8,_offset:H.length}),9);if("object"===Z){if(null===y)return H.push(192),1;if(Array.isArray(y)){if((a=y.length)<16)H.push(144|a),i=1;else if(a<65536)H.push(220,a>>8,a),i=3;else{if(!(a<4294967296))throw new Error("Array too large");H.push(221,a>>24,a>>16,a>>8,a),i=5}for(P=0;P<a;P++)i+=F(H,c,y[P]);return i}if(y instanceof Date){var C=y.getTime(),g=Math.floor(C/1e3),v=1e6*(C-1e3*g);return g>=0&&v>=0&&g<=17179869183?0===v&&g<=4294967295?(H.push(214,255,g>>24,g>>16,g>>8,g),6):(n=g/4294967296,O=4294967295&g,H.push(215,255,v>>22,v>>14,v>>6,n,O>>24,O>>16,O>>8,O),10):(n=Math.floor(g/4294967296),O=g>>>0,H.push(199,12,255,v>>24,v>>16,v>>8,v,n>>24,n>>16,n>>8,n,O>>24,O>>16,O>>8,O),15)}if(y instanceof ArrayBuffer){if((a=y.byteLength)<256)H.push(196,a),i=2;else if(a<65536)H.push(197,a>>8,a),i=3;else{if(!(a<4294967296))throw new Error("Buffer too large");H.push(198,a>>24,a>>16,a>>8,a),i=5}return c.push({_bin:y,_length:a,_offset:H.length}),i+a}if("function"===typeof y.toJSON)return F(H,c,y.toJSON());var m=[],z="",V=Object.keys(y);for(P=0,S=V.length;P<S;P++)void 0!==y[z=V[P]]&&"function"!==typeof y[z]&&m.push(z);if((a=m.length)<16)H.push(128|a),i=1;else if(a<65536)H.push(222,a>>8,a),i=3;else{if(!(a<4294967296))throw new Error("Object too large");H.push(223,a>>24,a>>16,a>>8,a),i=5}for(P=0;P<a;P++)i+=F(H,c,z=m[P]),i+=F(H,c,y[z]);return i}if("boolean"===Z)return H.push(y?195:194),1;if("undefined"===Z)return H.push(192),1;if("function"===typeof y.toJSON)return F(H,c,y.toJSON());throw new Error("Could not encode")}c.encode=function(H){var c=[],y=[],P=F(c,y,H),S=new ArrayBuffer(P),n=new DataView(S),O=0,a=0,i=-1;y.length>0&&(i=y[0]._offset);for(var C,g=0,v=0,m=0,z=c.length;m<z;m++)if(n.setUint8(a+m,c[m]),m+1===i){if(g=(C=y[O])._length,v=a+i,C._bin)for(var V=new Uint8Array(C._bin),h=0;h<g;h++)n.setUint8(v+h,V[h]);else C._str?Z(n,v,C._str):void 0!==C._float&&n.setFloat64(v,C._float);a+=g,y[++O]&&(i=y[O]._offset)}return S}},10692:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(H){}getState(){return null}patch(H){}teardown(){}handshake(H){}}},10690:(H,c,y)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const Z=y(10675);c.SchemaSerializer=class{setState(H){return this.state.decode(H)}getState(){return this.state}patch(H){return this.state.decode(H)}teardown(){var H,c;null===(c=null===(H=this.state)||void 0===H?void 0:H.$changes)||void 0===c||c.root.clearRefs()}handshake(H,c){if(this.state){(new Z.Reflection).decode(H,c)}else this.state=Z.Reflection.decode(H,c)}}},10657:(H,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const y={};c.registerSerializer=function(H,c){y[H]=c},c.getSerializer=function(H){const c=y[H];if(!c)throw new Error("missing serializer: "+H);return c}},10640:function(H,c,y){"use strict";var Z=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const F=Z(y(10642)),P=globalThis.WebSocket||F.default;c.WebSocketTransport=class{constructor(H){this.events=H}send(H){H instanceof ArrayBuffer?this.ws.send(H):Array.isArray(H)&&this.ws.send(new Uint8Array(H).buffer)}connect(H){this.ws=new P(H,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(H,c){this.ws.close(H,c)}get isOpen(){return this.ws.readyState===P.OPEN}}},10642:H=>{"use strict";H.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},10734:H=>{"use strict";H.exports=function(H){for(var c=new Array(H),y=0;y<H;++y)c[y]=y;return c}},10739:H=>{function c(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(c(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&c(H.slice(0,0))}(H)||!!H._isBuffer)}},10729:(H,c,y)=>{var Z=y(10734),F=y(10739),P="undefined"!==typeof Float64Array;function S(H,c){return H[0]-c[0]}function n(){var H,c=this.stride,y=new Array(c.length);for(H=0;H<y.length;++H)y[H]=[Math.abs(c[H]),H];y.sort(S);var Z=new Array(y.length);for(H=0;H<Z.length;++H)Z[H]=y[H][1];return Z}function O(H,c){var y=["View",c,"d",H].join("");c<0&&(y="View_Nil"+H);var F="generic"===H;if(-1===c){var P="function "+y+"(a){this.data=a;};var proto="+y+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+y+"(a){return new "+y+"(a);}";return new Function(P)()}if(0===c){P="function "+y+"(a,d) {this.data = a;this.offset = d};var proto="+y+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+y+"_copy() {return new "+y+"(this.data,this.offset)};proto.pick=function "+y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+y+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+y+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+y+"(a,b,c,d){return new "+y+"(a,d)}";return new Function("TrivialArray",P)(a[H][0])}P=["'use strict'"];var S=Z(c),O=S.map((function(H){return"i"+H})),i="this.offset+"+S.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),C=S.map((function(H){return"b"+H})).join(","),g=S.map((function(H){return"c"+H})).join(",");P.push("function "+y+"(a,"+C+","+g+",d){this.data=a","this.shape=["+C+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+y+".prototype","proto.dtype='"+H+"'","proto.dimension="+c),P.push("Object.defineProperty(proto,'size',{get:function "+y+"_size(){return "+S.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===c?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),c<4?(P.push("function "+y+"_order(){"),2===c?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+y+"_set("+O.join(",")+",v){"),F?P.push("return this.data.set("+i+",v)}"):P.push("return this.data["+i+"]=v}"),P.push("proto.get=function "+y+"_get("+O.join(",")+"){"),F?P.push("return this.data.get("+i+")}"):P.push("return this.data["+i+"]}"),P.push("proto.index=function "+y+"_index(",O.join(),"){return "+i+"}"),P.push("proto.hi=function "+y+"_hi("+O.join(",")+"){return new "+y+"(this.data,"+S.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+S.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var v=S.map((function(H){return"a"+H+"=this.shape["+H+"]"})),m=S.map((function(H){return"c"+H+"=this.stride["+H+"]"}));P.push("proto.lo=function "+y+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+m.join(","));for(var z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");P.push("return new "+y+"(this.data,"+S.map((function(H){return"a"+H})).join(",")+","+S.map((function(H){return"c"+H})).join(",")+",b)}"),P.push("proto.step=function "+y+"_step("+O.join(",")+"){var "+S.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+S.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");P.push("return new "+y+"(this.data,"+S.map((function(H){return"a"+H})).join(",")+","+S.map((function(H){return"b"+H})).join(",")+",c)}");var V=new Array(c),h=new Array(c);for(z=0;z<c;++z)V[z]="a[i"+z+"]",h[z]="b[i"+z+"]";P.push("proto.transpose=function "+y+"_transpose("+O+"){"+O.map((function(H,c){return H+"=("+H+"===undefined?"+c+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+y+"(this.data,"+V.join(",")+","+h.join(",")+",this.offset)}"),P.push("proto.pick=function "+y+"_pick("+O+"){var a=[],b=[],c=this.offset");for(z=0;z<c;++z)P.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+y+"(data,shape,stride,offset){return new "+y+"(data,"+S.map((function(H){return"shape["+H+"]"})).join(",")+","+S.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(a[H],n)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,c,y,Z){if(void 0===H)return(0,a.array[0])([]);"number"===typeof H&&(H=[H]),void 0===c&&(c=[H.length]);var S=c.length;if(void 0===y){y=new Array(S);for(var n=S-1,i=1;n>=0;--n)y[n]=i,i*=c[n]}if(void 0===Z){Z=0;for(n=0;n<S;++n)y[n]<0&&(Z-=(c[n]-1)*y[n])}for(var C=function(H){if(F(H))return"buffer";if(P)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),g=a[C];g.length<=S+1;)g.push(O(C,g.length-1));return(0,g[S+1])(H,c,y,Z)}},10709:H=>{var c;self,c=()=>(()=>{"use strict";var H={d:(c,y)=>{for(var Z in y)H.o(y,Z)&&!H.o(c,Z)&&Object.defineProperty(c,Z,{enumerable:!0,get:y[Z]})},o:(H,c)=>Object.prototype.hasOwnProperty.call(H,c)},c={};H.d(c,{default:()=>o});var y,Z=function(H,c){var y=c.x-H.x,Z=c.y-H.y;return Math.sqrt(y*y+Z*Z)},F=function(H){return H*(Math.PI/180)},P=new Map,S=function(H){P.has(H)&&clearTimeout(P.get(H)),P.set(H,setTimeout(H,100))},n=function(H,c,y){for(var Z,F=c.split(/[ ,]+/g),P=0;P<F.length;P+=1)Z=F[P],H.addEventListener?H.addEventListener(Z,y,!1):H.attachEvent&&H.attachEvent(Z,y)},O=function(H,c,y){for(var Z,F=c.split(/[ ,]+/g),P=0;P<F.length;P+=1)Z=F[P],H.removeEventListener?H.removeEventListener(Z,y):H.detachEvent&&H.detachEvent(Z,y)},a=function(H){return H.preventDefault(),H.type.match(/^touch/)?H.changedTouches:H},i=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},C=function(H,c){c.top||c.right||c.bottom||c.left?(H.style.top=c.top,H.style.right=c.right,H.style.bottom=c.bottom,H.style.left=c.left):(H.style.left=c.x+"px",H.style.top=c.y+"px")},g=function(H,c,y){var Z=v(H);for(var F in Z)if(Z.hasOwnProperty(F))if("string"==typeof c)Z[F]=c+" "+y;else{for(var P="",S=0,n=c.length;S<n;S+=1)P+=c[S]+" "+y+", ";Z[F]=P.slice(0,-2)}return Z},v=function(H){var c={};return c[H]="",["webkit","Moz","o"].forEach((function(y){c[y+H.charAt(0).toUpperCase()+H.slice(1)]=""})),c},m=function(H,c){for(var y in c)c.hasOwnProperty(y)&&(H[y]=c[y]);return H},z=function(H,c){if(H.length)for(var y=0,Z=H.length;y<Z;y+=1)c(H[y]);else c(H)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,Q=!!("ontouchstart"in window),D=!!window.PointerEvent,f=!!window.MSPointerEvent,J={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},l={start:"mousedown",move:"mousemove",end:"mouseup"},d={};function K(){}V&&!h?y=J:D?y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Q?(y=J,d=l):y=l,K.prototype.on=function(H,c){var y,Z=this,F=H.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var P=0;P<F.length;P+=1)y=F[P],Z._handlers_[y]=Z._handlers_[y]||[],Z._handlers_[y].push(c);return Z},K.prototype.off=function(H,c){var y=this;return y._handlers_=y._handlers_||{},void 0===H?y._handlers_={}:void 0===c?y._handlers_[H]=null:y._handlers_[H]&&y._handlers_[H].indexOf(c)>=0&&y._handlers_[H].splice(y._handlers_[H].indexOf(c),1),y},K.prototype.trigger=function(H,c){var y,Z=this,F=H.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var P=0;P<F.length;P+=1)y=F[P],Z._handlers_[y]&&Z._handlers_[y].length&&Z._handlers_[y].forEach((function(H){H.call(Z,{type:y,target:Z},c)}))},K.prototype.config=function(H){var c=this;c.options=c.defaults||{},H&&(c.options=function(H,c){var y={};for(var Z in H)H.hasOwnProperty(Z)&&c.hasOwnProperty(Z)?y[Z]=c[Z]:H.hasOwnProperty(Z)&&(y[Z]=H[Z]);return y}(c.options,H))},K.prototype.bindEvt=function(H,c){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},Z._domHandlers_[c]=function(){"function"==typeof Z["on"+c]?Z["on"+c].apply(Z,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},n(H,y[c],Z._domHandlers_[c]),d[c]&&n(H,d[c],Z._domHandlers_[c]),Z},K.prototype.unbindEvt=function(H,c){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},O(H,y[c],Z._domHandlers_[c]),d[c]&&O(H,d[c],Z._domHandlers_[c]),delete Z._domHandlers_[c],this};const T=K;function u(H,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=H,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=u.id,u.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}u.prototype=new T,u.constructor=u,u.id=0,u.prototype.buildEl=function(H){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},u.prototype.stylize=function(){if(this.options.dataOnly)return this;var H=this.options.fadeTime+"ms",c=function(){var H=v("borderRadius");for(var c in H)H.hasOwnProperty(c)&&(H[c]="50%");return H}(),y=g("transition","opacity",H),Z={};return Z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},m(Z.el,y),"circle"===this.options.shape&&m(Z.back,c),m(Z.front,c),this.applyStyles(Z),this},u.prototype.applyStyles=function(H){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var y in H[c])this.ui[c].style[y]=H[c][y];return this},u.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},u.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},u.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},u.prototype.show=function(H){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof H&&H.call(this)}),c.options.fadeTime)),c},u.prototype.hide=function(H){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var y="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=y,"function"==typeof H&&H.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var y=c.options.restJoystick,Z={};Z.x=!0===y||!1!==y.x?0:c.instance.frontPosition.x,Z.y=!0===y||!1!==y.y?0:c.instance.frontPosition.y,c.setPosition(H,Z)}return c},u.prototype.setPosition=function(H,c){var y=this;y.frontPosition={x:c.x,y:c.y};var Z=y.options.fadeTime+"ms",F={};F.front=g("transition",["transform"],Z);var P={front:{}};P.front={transform:"translate("+y.frontPosition.x+"px,"+y.frontPosition.y+"px)"},y.applyStyles(F),y.applyStyles(P),y.restTimeout=setTimeout((function(){"function"==typeof H&&H.call(y),y.restCallback()}),y.options.fadeTime)},u.prototype.restCallback=function(){var H=this,c={};c.front=g("transition","none",""),H.applyStyles(c),H.trigger("rested",H.instance)},u.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},u.prototype.computeDirection=function(H){var c,y,Z,F=H.angle.radian,P=Math.PI/4,S=Math.PI/2;if(F>P&&F<3*P&&!H.lockX?c="up":F>-P&&F<=P&&!H.lockY?c="left":F>3*-P&&F<=-P&&!H.lockX?c="down":H.lockY||(c="right"),H.lockY||(y=F>-S&&F<S?"left":"right"),H.lockX||(Z=F>0?"up":"down"),H.force>this.options.threshold){var n,O={};for(n in this.direction)this.direction.hasOwnProperty(n)&&(O[n]=this.direction[n]);var a={};for(n in this.direction={x:y,y:Z,angle:c},H.direction=this.direction,O)O[n]===this.direction[n]&&(a[n]=!0);if(a.x&&a.y&&a.angle)return H;a.x&&a.y||this.trigger("plain",H),a.x||this.trigger("plain:"+y,H),a.y||this.trigger("plain:"+Z,H),a.angle||this.trigger("dir dir:"+c,H)}else this.resetDirection();return H};const E=u;function U(H,c){var y=this;y.nipples=[],y.idles=[],y.actives=[],y.ids=[],y.pressureIntervals={},y.manager=H,y.id=U.id,U.id+=1,y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},y.config(c),"static"!==y.options.mode&&"semi"!==y.options.mode||(y.options.multitouch=!1),y.options.multitouch||(y.options.maxNumberOfNipples=1);var Z=getComputedStyle(y.options.zone.parentElement);return Z&&"flex"===Z.display&&(y.parentIsFlex=!0),y.updateBox(),y.prepareNipples(),y.xj(),y.begin(),y.nipples}U.prototype=new T,U.constructor=U,U.id=0,U.prototype.prepareNipples=function(){var H=this,c=H.nipples;c.on=H.on.bind(H),c.off=H.off.bind(H),c.options=H.options,c.destroy=H.destroy.bind(H),c.ids=H.ids,c.id=H.id,c.processOnMove=H.processOnMove.bind(H),c.processOnEnd=H.processOnEnd.bind(H),c.get=function(H){if(void 0===H)return c[0];for(var y=0,Z=c.length;y<Z;y+=1)if(c[y].identifier===H)return c[y];return!1}},U.prototype.xj=function(){var H=this;H.bindEvt(H.options.zone,"start"),H.options.zone.style.touchAction="none",H.options.zone.style.msTouchAction="none"},U.prototype.begin=function(){var H=this,c=H.options;if("static"===c.mode){var y=H.createNipple(c.position,H.manager.getIdentifier());y.add(),H.idles.push(y)}},U.prototype.createNipple=function(H,c){var y=this,Z=y.manager.scroll,F={},P=y.options,S=y.parentIsFlex?Z.x:Z.x+y.box.left,n=y.parentIsFlex?Z.y:Z.y+y.box.top;if(H.x&&H.y)F={x:H.x-S,y:H.y-n};else if(H.top||H.right||H.bottom||H.left){var O=document.createElement("DIV");O.style.display="hidden",O.style.top=H.top,O.style.right=H.right,O.style.bottom=H.bottom,O.style.left=H.left,O.style.position="absolute",P.zone.appendChild(O);var a=O.getBoundingClientRect();P.zone.removeChild(O),F=H,H={x:a.left+Z.x,y:a.top+Z.y}}var i=new E(y,{color:P.color,size:P.size,threshold:P.threshold,fadeTime:P.fadeTime,dataOnly:P.dataOnly,restJoystick:P.restJoystick,restOpacity:P.restOpacity,mode:P.mode,identifier:c,position:H,zone:P.zone,frontPosition:{x:0,y:0},shape:P.shape});return P.dataOnly||(C(i.ui.el,F),C(i.ui.front,i.frontPosition)),y.nipples.push(i),y.trigger("added "+i.identifier+":added",i),y.manager.trigger("added "+i.identifier+":added",i),y.bindNipple(i),i},U.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},U.prototype.bindNipple=function(H){var c,y=this,Z=function(H,Z){c=H.type+" "+Z.id+":"+H.type,y.trigger(c,Z)};H.on("destroyed",y.onDestroyed.bind(y)),H.on("shown hidden rested dir plain",Z),H.on("dir:up dir:right dir:down dir:left",Z),H.on("plain:up plain:right plain:down plain:left",Z)},U.prototype.pressureFn=function(H,c,y){var Z=this,F=0;clearInterval(Z.pressureIntervals[y]),Z.pressureIntervals[y]=setInterval(function(){var y=H.force||H.pressure||H.webkitForce||0;y!==F&&(c.trigger("pressure",y),Z.trigger("pressure "+c.identifier+":pressure",y),F=y)}.bind(Z),100)},U.prototype.onstart=function(H){var c=this,y=c.options,Z=H;return H=a(H),c.updateBox(),z(H,(function(F){c.actives.length<y.maxNumberOfNipples?c.processOnStart(F):Z.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(y){if(Object.values(Z.touches).findIndex((function(H){return H.identifier===y}))<0){var F=[H[0]];F.identifier=y,c.processOnEnd(F)}})),c.actives.length<y.maxNumberOfNipples&&c.processOnStart(F))})),c.manager.bindDocument(),!1},U.prototype.processOnStart=function(H){var c,y=this,F=y.options,P=y.manager.getIdentifier(H),S=H.force||H.pressure||H.webkitForce||0,n={x:H.pageX,y:H.pageY},O=y.getOrCreate(P,n);O.identifier!==P&&y.manager.removeIdentifier(O.identifier),O.identifier=P;var a=function(c){c.trigger("start",c),y.trigger("start "+c.id+":start",c),c.show(),S>0&&y.pressureFn(H,c,c.identifier),y.processOnMove(H)};if((c=y.idles.indexOf(O))>=0&&y.idles.splice(c,1),y.actives.push(O),y.ids.push(O.identifier),"semi"!==F.mode)a(O);else{if(!(Z(n,O.position)<=F.catchDistance))return O.destroy(),void y.processOnStart(H);a(O)}return O},U.prototype.getOrCreate=function(H,c){var y,Z=this,F=Z.options;return/(semi|static)/.test(F.mode)?(y=Z.idles[0])?(Z.idles.splice(0,1),y):"semi"===F.mode?Z.createNipple(c,H):(console.warn("Coudln't find the needed nipple."),!1):y=Z.createNipple(c,H)},U.prototype.processOnMove=function(H){var c=this,y=c.options,P=c.manager.getIdentifier(H),S=c.nipples.get(P),n=c.manager.scroll;if(function(H){return isNaN(H.buttons)?0!==H.pressure:0!==H.buttons}(H)){if(!S)return console.error("Found zombie joystick with ID "+P),void c.manager.removeIdentifier(P);if(y.dynamicPage){var O=S.el.getBoundingClientRect();S.position={x:n.x+O.left,y:n.y+O.top}}S.identifier=P;var a=S.options.size/2,i={x:H.pageX,y:H.pageY};y.lockX&&(i.y=S.position.y),y.lockY&&(i.x=S.position.x);var C,g,v,m,z,V,h,Q,D,f,J=Z(i,S.position),l=(C=i,v=(g=S.position).x-C.x,m=g.y-C.y,function(H){return H*(180/Math.PI)}(Math.atan2(m,v))),d=F(l),K=J/a,T={distance:J,position:i};if("circle"===S.options.shape?(z=Math.min(J,a),h=S.position,Q=z,f={x:0,y:0},D=F(D=l),f.x=h.x-Q*Math.cos(D),f.y=h.y-Q*Math.sin(D),V=f):(V=function(H,c,y){return{x:Math.min(Math.max(H.x,c.x-y),c.x+y),y:Math.min(Math.max(H.y,c.y-y),c.y+y)}}(i,S.position,a),z=Z(V,S.position)),y.follow){if(J>a){var u=i.x-V.x,E=i.y-V.y;S.position.x+=u,S.position.y+=E,S.el.style.top=S.position.y-(c.box.top+n.y)+"px",S.el.style.left=S.position.x-(c.box.left+n.x)+"px",J=Z(i,S.position)}}else i=V,J=z;var U=i.x-S.position.x,G=i.y-S.position.y;S.frontPosition={x:U,y:G},y.dataOnly||(S.ui.front.style.transform="translate("+U+"px,"+G+"px)");var p={identifier:S.identifier,position:i,force:K,pressure:H.force||H.pressure||H.webkitForce||0,distance:J,angle:{radian:d,degree:l},vector:{x:U/a,y:-G/a},raw:T,instance:S,lockX:y.lockX,lockY:y.lockY};(p=S.computeDirection(p)).angle={radian:F(180-l),degree:180-l},S.trigger("move",p),c.trigger("move "+S.id+":move",p)}else this.processOnEnd(H)},U.prototype.processOnEnd=function(H){var c=this,y=c.options,Z=c.manager.getIdentifier(H),F=c.nipples.get(Z),P=c.manager.removeIdentifier(F.identifier);F&&(y.dataOnly||F.hide((function(){"dynamic"===y.mode&&(F.trigger("removed",F),c.trigger("removed "+F.id+":removed",F),c.manager.trigger("removed "+F.id+":removed",F),F.destroy())})),clearInterval(c.pressureIntervals[F.identifier]),F.resetDirection(),F.trigger("end",F),c.trigger("end "+F.id+":end",F),c.ids.indexOf(F.identifier)>=0&&c.ids.splice(c.ids.indexOf(F.identifier),1),c.actives.indexOf(F)>=0&&c.actives.splice(c.actives.indexOf(F),1),/(semi|static)/.test(y.mode)?c.idles.push(F):c.nipples.indexOf(F)>=0&&c.nipples.splice(c.nipples.indexOf(F),1),c.manager.unbindDocument(),/(semi|static)/.test(y.mode)&&(c.manager.ids[P.id]=P.identifier))},U.prototype.onDestroyed=function(H,c){var y=this;y.nipples.indexOf(c)>=0&&y.nipples.splice(y.nipples.indexOf(c),1),y.actives.indexOf(c)>=0&&y.actives.splice(y.actives.indexOf(c),1),y.idles.indexOf(c)>=0&&y.idles.splice(y.idles.indexOf(c),1),y.ids.indexOf(c.identifier)>=0&&y.ids.splice(y.ids.indexOf(c.identifier),1),y.manager.removeIdentifier(c.identifier),y.manager.unbindDocument()},U.prototype.destroy=function(){var H=this;for(var c in H.unbindEvt(H.options.zone,"start"),H.nipples.forEach((function(H){H.destroy()})),H.pressureIntervals)H.pressureIntervals.hasOwnProperty(c)&&clearInterval(H.pressureIntervals[c]);H.trigger("destroyed",H.nipples),H.manager.unbindDocument(),H.off()};const G=U;function p(H){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=i(),c.config(H),c.prepareCollections();var y=function(){var H;c.collections.forEach((function(y){y.forEach((function(y){H=y.el.getBoundingClientRect(),y.position={x:c.scroll.x+H.left,y:c.scroll.y+H.top}}))}))};n(window,"resize",(function(){S(y)}));var Z=function(){c.scroll=i()};return n(window,"scroll",(function(){S(Z)})),c.collections}p.prototype=new T,p.constructor=p,p.prototype.prepareCollections=function(){var H=this;H.collections.create=H.create.bind(H),H.collections.on=H.on.bind(H),H.collections.off=H.off.bind(H),H.collections.destroy=H.destroy.bind(H),H.collections.get=function(c){var y;return H.collections.every((function(H){return!(y=H.get(c))})),y}},p.prototype.create=function(H){return this.createCollection(H)},p.prototype.createCollection=function(H){var c=this,y=new G(c,H);return c.bindCollection(y),c.collections.push(y),y},p.prototype.bindCollection=function(H){var c,y=this,Z=function(H,Z){c=H.type+" "+Z.id+":"+H.type,y.trigger(c,Z)};H.on("destroyed",y.onDestroyed.bind(y)),H.on("shown hidden rested dir plain",Z),H.on("dir:up dir:right dir:down dir:left",Z),H.on("plain:up plain:right plain:down plain:left",Z)},p.prototype.bindDocument=function(){var H=this;H.binded||(H.bindEvt(document,"move").bindEvt(document,"end"),H.binded=!0)},p.prototype.unbindDocument=function(H){var c=this;Object.keys(c.ids).length&&!0!==H||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},p.prototype.getIdentifier=function(H){var c;return H?void 0===(c=void 0===H.identifier?H.pointerId:H.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},p.prototype.removeIdentifier=function(H){var c={};for(var y in this.ids)if(this.ids[y]===H){c.id=y,c.identifier=this.ids[y],delete this.ids[y];break}return c},p.prototype.onmove=function(H){return this.onAny("move",H),!1},p.prototype.onend=function(H){return this.onAny("end",H),!1},p.prototype.oncancel=function(H){return this.onAny("end",H),!1},p.prototype.onAny=function(H,c){var y,Z=this,F="processOn"+H.charAt(0).toUpperCase()+H.slice(1);c=a(c);var P=function(H,c,y){y.ids.indexOf(c)>=0&&(y[F](H),H._found_=!0)};return z(c,(function(H){y=Z.getIdentifier(H),z(Z.collections,P.bind(null,H,y)),H._found_||Z.removeIdentifier(y)})),!1},p.prototype.destroy=function(){var H=this;H.unbindDocument(!0),H.ids={},H.index=0,H.collections.forEach((function(H){H.destroy()})),H.off()},p.prototype.onDestroyed=function(H,c){var y=this;if(y.collections.indexOf(c)<0)return!1;y.collections.splice(y.collections.indexOf(c),1)};var t=new p;const o={create:function(H){return t.create(H)},factory:t};return c.default})(),H.exports=c()},10928:(H,c,y)=>{"use strict";const{Deflate:Z,deflate:F,deflateRaw:P,gzip:S}=y(10930),{Inflate:n,inflate:O,inflateRaw:a,ungzip:i}=y(10996),C=y(10975);H.exports.Deflate=Z,H.exports.deflate=F,H.exports.deflateRaw=P,H.exports.gzip=S,H.exports.Inflate=n,H.exports.inflate=O,H.exports.inflateRaw=a,H.exports.ungzip=i,H.exports.constants=C},10930:(H,c,y)=>{"use strict";const Z=y(10938),F=y(10979),P=y(10984),S=y(10971),n=y(10991),O=Object.prototype.toString,{Z_NO_FLUSH:a,Z_SYNC_FLUSH:i,Z_FULL_FLUSH:C,Z_FINISH:g,Z_OK:v,Z_STREAM_END:m,Z_DEFAULT_COMPRESSION:z,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:h}=y(10975);function Q(H){this.options=F.assign({level:z,method:h,Ja:16384,windowBits:15,memLevel:8,strategy:V},H||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;let y=Z.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(y!==v)throw new Error(S[y]);if(c.header&&Z.deflateSetHeader(this.strm,c.header),c.dictionary){let H;if(H="string"===typeof c.dictionary?P.string2buf(c.dictionary):"[object ArrayBuffer]"===O.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,y=Z.deflateSetDictionary(this.strm,H),y!==v)throw new Error(S[y]);this._dict_set=!0}}function D(H,c){const y=new Q(c);if(y.push(H,!0),y.err)throw y.msg||S[y.err];return y.result}Q.prototype.push=function(H,c){const y=this.strm,F=this.options.Ja;let S,n;if(this.ended)return!1;for(n=c===~~c?c:!0===c?g:a,"string"===typeof H?y.input=P.string2buf(H):"[object ArrayBuffer]"===O.call(H)?y.input=new Uint8Array(H):y.input=H,y.next_in=0,y.avail_in=y.input.length;;)if(0===y.avail_out&&(y.output=new Uint8Array(F),y.next_out=0,y.avail_out=F),(n===i||n===C)&&y.avail_out<=6)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else{if(S=Z.deflate(y,n),S===m)return y.next_out>0&&this.onData(y.output.subarray(0,y.next_out)),S=Z.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===v;if(0!==y.avail_out){if(n>0&&y.next_out>0)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else if(0===y.avail_in)break}else this.onData(y.output)}return!0},Q.prototype.onData=function(H){this.chunks.push(H)},Q.prototype.onEnd=function(H){H===v&&(this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},H.exports.Deflate=Q,H.exports.deflate=D,H.exports.deflateRaw=function(H,c){return(c=c||{}).raw=!0,D(H,c)},H.exports.gzip=function(H,c){return(c=c||{}).gzip=!0,D(H,c)},H.exports.constants=y(10975)},10996:(H,c,y)=>{"use strict";const Z=y(11004),F=y(10979),P=y(10984),S=y(10971),n=y(10991),O=y(11017),a=Object.prototype.toString,{Z_NO_FLUSH:i,Z_FINISH:C,Z_OK:g,Z_STREAM_END:v,Z_NEED_DICT:m,Z_STREAM_ERROR:z,Z_DATA_ERROR:V,Z_MEM_ERROR:h}=y(10975);function Q(H){this.options=F.assign({Ja:65536,windowBits:15,to:""},H||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||H&&H.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;let y=Z.inflateInit2(this.strm,c.windowBits);if(y!==g)throw new Error(S[y]);if(this.header=new O,Z.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=P.string2buf(c.dictionary):"[object ArrayBuffer]"===a.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(y=Z.inflateSetDictionary(this.strm,c.dictionary),y!==g)))throw new Error(S[y])}function D(H,c){const y=new Q(c);if(y.push(H),y.err)throw y.msg||S[y.err];return y.result}Q.prototype.push=function(H,c){const y=this.strm,F=this.options.Ja,S=this.options.dictionary;let n,O,Q;if(this.ended)return!1;for(O=c===~~c?c:!0===c?C:i,"[object ArrayBuffer]"===a.call(H)?y.input=new Uint8Array(H):y.input=H,y.next_in=0,y.avail_in=y.input.length;;){for(0===y.avail_out&&(y.output=new Uint8Array(F),y.next_out=0,y.avail_out=F),n=Z.inflate(y,O),n===m&&S&&(n=Z.inflateSetDictionary(y,S),n===g?n=Z.inflate(y,O):n===V&&(n=m));y.avail_in>0&&n===v&&y.state.wrap>0&&0!==H[y.next_in];)Z.inflateReset(y),n=Z.inflate(y,O);switch(n){case z:case V:case m:case h:return this.onEnd(n),this.ended=!0,!1}if(Q=y.avail_out,y.next_out&&(0===y.avail_out||n===v))if("string"===this.options.to){let H=P.utf8border(y.output,y.next_out),c=y.next_out-H,Z=P.buf2string(y.output,H);y.next_out=c,y.avail_out=F-c,c&&y.output.set(y.output.subarray(H,H+c),0),this.onData(Z)}else this.onData(y.output.length===y.next_out?y.output:y.output.subarray(0,y.next_out));if(n!==g||0!==Q){if(n===v)return n=Z.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===y.avail_in)break}}return!0},Q.prototype.onData=function(H){this.chunks.push(H)},Q.prototype.onEnd=function(H){H===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},H.exports.Inflate=Q,H.exports.inflate=D,H.exports.inflateRaw=function(H,c){return(c=c||{}).raw=!0,D(H,c)},H.exports.ungzip=D,H.exports.constants=y(10975)},10979:H=>{"use strict";const c=(H,c)=>Object.prototype.hasOwnProperty.call(H,c);H.exports.assign=function(H){const y=Array.prototype.slice.call(arguments,1);for(;y.length;){const Z=y.shift();if(Z){if("object"!==typeof Z)throw new TypeError(Z+"must be non-object");for(const y in Z)c(Z,y)&&(H[y]=Z[y])}}return H},H.exports.flattenChunks=H=>{let c=0;for(let Z=0,F=H.length;Z<F;Z++)c+=H[Z].length;const y=new Uint8Array(c);for(let Z=0,F=0,P=H.length;Z<P;Z++){let c=H[Z];y.set(c,F),F+=c.length}return y}},10984:H=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Z){c=!1}const y=new Uint8Array(256);for(let F=0;F<256;F++)y[F]=F>=252?6:F>=248?5:F>=240?4:F>=224?3:F>=192?2:1;y[254]=y[254]=1,H.exports.string2buf=H=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(H);let c,y,Z,F,P,S=H.length,n=0;for(F=0;F<S;F++)y=H.charCodeAt(F),55296===(64512&y)&&F+1<S&&(Z=H.charCodeAt(F+1),56320===(64512&Z)&&(y=65536+(y-55296<<10)+(Z-56320),F++)),n+=y<128?1:y<2048?2:y<65536?3:4;for(c=new Uint8Array(n),P=0,F=0;P<n;F++)y=H.charCodeAt(F),55296===(64512&y)&&F+1<S&&(Z=H.charCodeAt(F+1),56320===(64512&Z)&&(y=65536+(y-55296<<10)+(Z-56320),F++)),y<128?c[P++]=y:y<2048?(c[P++]=192|y>>>6,c[P++]=128|63&y):y<65536?(c[P++]=224|y>>>12,c[P++]=128|y>>>6&63,c[P++]=128|63&y):(c[P++]=240|y>>>18,c[P++]=128|y>>>12&63,c[P++]=128|y>>>6&63,c[P++]=128|63&y);return c};H.exports.buf2string=(H,Z)=>{const F=Z||H.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(H.subarray(0,Z));let P,S;const n=new Array(2*F);for(S=0,P=0;P<F;){let c=H[P++];if(c<128){n[S++]=c;continue}let Z=y[c];if(Z>4)n[S++]=65533,P+=Z-1;else{for(c&=2===Z?31:3===Z?15:7;Z>1&&P<F;)c=c<<6|63&H[P++],Z--;Z>1?n[S++]=65533:c<65536?n[S++]=c:(c-=65536,n[S++]=55296|c>>10&1023,n[S++]=56320|1023&c)}}return((H,y)=>{if(y<65534&&H.subarray&&c)return String.fromCharCode.apply(null,H.length===y?H:H.subarray(0,y));let Z="";for(let c=0;c<y;c++)Z+=String.fromCharCode(H[c]);return Z})(n,S)},H.exports.utf8border=(H,c)=>{(c=c||H.length)>H.length&&(c=H.length);let Z=c-1;for(;Z>=0&&128===(192&H[Z]);)Z--;return Z<0||0===Z?c:Z+y[H[Z]]>c?Z:c}},10955:H=>{"use strict";H.exports=(H,c,y,Z)=>{let F=65535&H,P=H>>>16&65535,S=0;for(;0!==y;){S=y>2e3?2e3:y,y-=S;do{F=F+c[Z++]|0,P=P+F|0}while(--S);F%=65521,P%=65521}return F|P<<16}},10975:H=>{"use strict";H.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10964:H=>{"use strict";const c=new Uint32Array((()=>{let H,c=[];for(var y=0;y<256;y++){H=y;for(var Z=0;Z<8;Z++)H=1&H?3988292384^H>>>1:H>>>1;c[y]=H}return c})());H.exports=(H,y,Z,F)=>{const P=c,S=F+Z;H^=-1;for(let c=F;c<S;c++)H=H>>>8^P[255&(H^y[c])];return~H}},10938:(H,c,y)=>{"use strict";const{_tr_init:Z,_tr_stored_block:F,_tr_flush_block:P,_tr_tally:S,_tr_align:n}=y(10947),O=y(10955),a=y(10964),i=y(10971),{Z_NO_FLUSH:C,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:v,Z_FINISH:m,Z_BLOCK:z,Z_OK:V,Z_STREAM_END:h,Z_STREAM_ERROR:Q,Z_DATA_ERROR:D,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:J,Z_FILTERED:l,Z_HUFFMAN_ONLY:d,Z_RLE:K,Z_FIXED:T,Z_DEFAULT_STRATEGY:u,Z_UNKNOWN:E,Z_DEFLATED:U}=y(10975),G=258,p=262,t=103,o=113,s=666,q=(H,c)=>(H.msg=i[c],c),I=H=>(H<<1)-(H>4?9:0),j=H=>{let c=H.length;for(;--c>=0;)H[c]=0};let k=(H,c,y)=>(c<<H.hash_shift^y)&H.hash_mask;const W=H=>{const c=H.state;let y=c.pending;y>H.avail_out&&(y=H.avail_out),0!==y&&(H.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+y),H.next_out),H.next_out+=y,c.pending_out+=y,H.total_out+=y,H.avail_out-=y,c.pending-=y,0===c.pending&&(c.pending_out=0))},M=(H,c)=>{P(H,H.block_start>=0?H.block_start:-1,H.strstart-H.block_start,c),H.block_start=H.strstart,W(H.strm)},x=(H,c)=>{H.pending_buf[H.pending++]=c},R=(H,c)=>{H.pending_buf[H.pending++]=c>>>8&255,H.pending_buf[H.pending++]=255&c},A=(H,c,y,Z)=>{let F=H.avail_in;return F>Z&&(F=Z),0===F?0:(H.avail_in-=F,c.set(H.input.subarray(H.next_in,H.next_in+F),y),1===H.state.wrap?H.adler=O(H.adler,c,F,y):2===H.state.wrap&&(H.adler=a(H.adler,c,F,y)),H.next_in+=F,H.total_in+=F,F)},e=(H,c)=>{let y,Z,F=H.max_chain_length,P=H.strstart,S=H.prev_length,n=H.nice_match;const O=H.strstart>H.w_size-p?H.strstart-(H.w_size-p):0,a=H.window,i=H.w_mask,C=H.prev,g=H.strstart+G;let v=a[P+S-1],m=a[P+S];H.prev_length>=H.good_match&&(F>>=2),n>H.lookahead&&(n=H.lookahead);do{if(y=c,a[y+S]===m&&a[y+S-1]===v&&a[y]===a[P]&&a[++y]===a[P+1]){P+=2,y++;do{}while(a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&a[++P]===a[++y]&&P<g);if(Z=G-(g-P),P=g-G,Z>S){if(H.match_start=c,S=Z,Z>=n)break;v=a[P+S-1],m=a[P+S]}}}while((c=C[c&i])>O&&0!==--F);return S<=H.lookahead?S:H.lookahead},r=H=>{const c=H.w_size;let y,Z,F,P,S;do{if(P=H.window_size-H.lookahead-H.strstart,H.strstart>=c+(c-p)){H.window.set(H.window.subarray(c,c+c),0),H.match_start-=c,H.strstart-=c,H.block_start-=c,Z=H.hash_size,y=Z;do{F=H.head[--y],H.head[y]=F>=c?F-c:0}while(--Z);Z=c,y=Z;do{F=H.prev[--y],H.prev[y]=F>=c?F-c:0}while(--Z);P+=c}if(0===H.strm.avail_in)break;if(Z=A(H.strm,H.window,H.strstart+H.lookahead,P),H.lookahead+=Z,H.lookahead+H.insert>=3)for(S=H.strstart-H.insert,H.ins_h=H.window[S],H.ins_h=k(H,H.ins_h,H.window[S+1]);H.insert&&(H.ins_h=k(H,H.ins_h,H.window[S+3-1]),H.prev[S&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=S,S++,H.insert--,!(H.lookahead+H.insert<3)););}while(H.lookahead<p&&0!==H.strm.avail_in)},N=(H,c)=>{let y,Z;for(;;){if(H.lookahead<p){if(r(H),H.lookahead<p&&c===C)return 1;if(0===H.lookahead)break}if(y=0,H.lookahead>=3&&(H.ins_h=k(H,H.ins_h,H.window[H.strstart+3-1]),y=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),0!==y&&H.strstart-y<=H.w_size-p&&(H.match_length=e(H,y)),H.match_length>=3)if(Z=S(H,H.strstart-H.match_start,H.match_length-3),H.lookahead-=H.match_length,H.match_length<=H.max_lazy_match&&H.lookahead>=3){H.match_length--;do{H.strstart++,H.ins_h=k(H,H.ins_h,H.window[H.strstart+3-1]),y=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart}while(0!==--H.match_length);H.strstart++}else H.strstart+=H.match_length,H.match_length=0,H.ins_h=H.window[H.strstart],H.ins_h=k(H,H.ins_h,H.window[H.strstart+1]);else Z=S(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++;if(Z&&(M(H,!1),0===H.strm.avail_out))return 1}return H.insert=H.strstart<2?H.strstart:2,c===m?(M(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(M(H,!1),0===H.strm.avail_out)?1:2},w=(H,c)=>{let y,Z,F;for(;;){if(H.lookahead<p){if(r(H),H.lookahead<p&&c===C)return 1;if(0===H.lookahead)break}if(y=0,H.lookahead>=3&&(H.ins_h=k(H,H.ins_h,H.window[H.strstart+3-1]),y=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),H.prev_length=H.match_length,H.prev_match=H.match_start,H.match_length=2,0!==y&&H.prev_length<H.max_lazy_match&&H.strstart-y<=H.w_size-p&&(H.match_length=e(H,y),H.match_length<=5&&(H.strategy===l||3===H.match_length&&H.strstart-H.match_start>4096)&&(H.match_length=2)),H.prev_length>=3&&H.match_length<=H.prev_length){F=H.strstart+H.lookahead-3,Z=S(H,H.strstart-1-H.prev_match,H.prev_length-3),H.lookahead-=H.prev_length-1,H.prev_length-=2;do{++H.strstart<=F&&(H.ins_h=k(H,H.ins_h,H.window[H.strstart+3-1]),y=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart)}while(0!==--H.prev_length);if(H.match_available=0,H.match_length=2,H.strstart++,Z&&(M(H,!1),0===H.strm.avail_out))return 1}else if(H.match_available){if(Z=S(H,0,H.window[H.strstart-1]),Z&&M(H,!1),H.strstart++,H.lookahead--,0===H.strm.avail_out)return 1}else H.match_available=1,H.strstart++,H.lookahead--}return H.match_available&&(Z=S(H,0,H.window[H.strstart-1]),H.match_available=0),H.insert=H.strstart<2?H.strstart:2,c===m?(M(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(M(H,!1),0===H.strm.avail_out)?1:2};function L(H,c,y,Z,F){this.good_length=H,this.max_lazy=c,this.nice_length=y,this.max_chain=Z,this.func=F}const b=[new L(0,0,0,0,((H,c)=>{let y=65535;for(y>H.pending_buf_size-5&&(y=H.pending_buf_size-5);;){if(H.lookahead<=1){if(r(H),0===H.lookahead&&c===C)return 1;if(0===H.lookahead)break}H.strstart+=H.lookahead,H.lookahead=0;const Z=H.block_start+y;if((0===H.strstart||H.strstart>=Z)&&(H.lookahead=H.strstart-Z,H.strstart=Z,M(H,!1),0===H.strm.avail_out))return 1;if(H.strstart-H.block_start>=H.w_size-p&&(M(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,c===m?(M(H,!0),0===H.strm.avail_out?3:4):(H.strstart>H.block_start&&(M(H,!1),H.strm.avail_out),1)})),new L(4,4,8,4,N),new L(4,5,16,8,N),new L(4,6,32,32,N),new L(4,4,16,16,w),new L(8,16,32,32,w),new L(8,16,128,128,w),new L(8,32,128,256,w),new L(32,128,258,1024,w),new L(32,258,258,4096,w)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=U,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=H=>{if(!H||!H.state)return q(H,Q);H.total_in=H.total_out=0,H.data_type=E;const c=H.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:o,H.adler=2===c.wrap?0:1,c.last_flush=C,Z(c),V},Y=H=>{const c=B(H);var y;return c===V&&((y=H.state).window_size=2*y.w_size,j(y.head),y.max_lazy_match=b[y.level].max_lazy,y.good_match=b[y.level].good_length,y.nice_match=b[y.level].nice_length,y.max_chain_length=b[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=2,y.match_available=0,y.ins_h=0),c},HH=(H,c,y,Z,F,P)=>{if(!H)return Q;let S=1;if(c===J&&(c=6),Z<0?(S=0,Z=-Z):Z>15&&(S=2,Z-=16),F<1||F>9||y!==U||Z<8||Z>15||c<0||c>9||P<0||P>T)return q(H,Q);8===Z&&(Z=9);const n=new X;return H.state=n,n.strm=H,n.wrap=S,n.gzhead=null,n.w_bits=Z,n.w_size=1<<n.w_bits,n.w_mask=n.w_size-1,n.hash_bits=F+7,n.hash_size=1<<n.hash_bits,n.hash_mask=n.hash_size-1,n.hash_shift=~~((n.hash_bits+3-1)/3),n.window=new Uint8Array(2*n.w_size),n.head=new Uint16Array(n.hash_size),n.prev=new Uint16Array(n.w_size),n.lit_bufsize=1<<F+6,n.pending_buf_size=4*n.lit_bufsize,n.pending_buf=new Uint8Array(n.pending_buf_size),n.d_buf=1*n.lit_bufsize,n.l_buf=3*n.lit_bufsize,n.level=c,n.strategy=P,n.method=y,Y(H)};H.exports.deflateInit=(H,c)=>HH(H,c,U,15,8,u),H.exports.deflateInit2=HH,H.exports.deflateReset=Y,H.exports.deflateResetKeep=B,H.exports.deflateSetHeader=(H,c)=>H&&H.state?2!==H.state.wrap?Q:(H.state.gzhead=c,V):Q,H.exports.deflate=(H,c)=>{let y,Z;if(!H||!H.state||c>z||c<0)return H?q(H,Q):Q;const P=H.state;if(!H.output||!H.input&&0!==H.avail_in||P.status===s&&c!==m)return q(H,0===H.avail_out?f:Q);P.strm=H;const O=P.last_flush;if(P.last_flush=c,42===P.status)if(2===P.wrap)H.adler=0,x(P,31),x(P,139),x(P,8),P.gzhead?(x(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),x(P,255&P.gzhead.time),x(P,P.gzhead.time>>8&255),x(P,P.gzhead.time>>16&255),x(P,P.gzhead.time>>24&255),x(P,9===P.level?2:P.strategy>=d||P.level<2?4:0),x(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(x(P,255&P.gzhead.extra.length),x(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(H.adler=a(H.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(x(P,0),x(P,0),x(P,0),x(P,0),x(P,0),x(P,9===P.level?2:P.strategy>=d||P.level<2?4:0),x(P,3),P.status=o);else{let c=U+(P.w_bits-8<<4)<<8,y=-1;y=P.strategy>=d||P.level<2?0:P.level<6?1:6===P.level?2:3,c|=y<<6,0!==P.strstart&&(c|=32),c+=31-c%31,P.status=o,R(P,c),0!==P.strstart&&(R(P,H.adler>>>16),R(P,65535&H.adler)),H.adler=1}if(69===P.status)if(P.gzhead.extra){for(y=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),W(H),y=P.pending,P.pending!==P.pending_buf_size));)x(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(73===P.status)if(P.gzhead.name){y=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),W(H),y=P.pending,P.pending===P.pending_buf_size)){Z=1;break}Z=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,x(P,Z)}while(0!==Z);P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),0===Z&&(P.gzindex=0,P.status=91)}else P.status=91;if(91===P.status)if(P.gzhead.comment){y=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),W(H),y=P.pending,P.pending===P.pending_buf_size)){Z=1;break}Z=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,x(P,Z)}while(0!==Z);P.gzhead.hcrc&&P.pending>y&&(H.adler=a(H.adler,P.pending_buf,P.pending-y,y)),0===Z&&(P.status=t)}else P.status=t;if(P.status===t&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&W(H),P.pending+2<=P.pending_buf_size&&(x(P,255&H.adler),x(P,H.adler>>8&255),H.adler=0,P.status=o)):P.status=o),0!==P.pending){if(W(H),0===H.avail_out)return P.last_flush=-1,V}else if(0===H.avail_in&&I(c)<=I(O)&&c!==m)return q(H,f);if(P.status===s&&0!==H.avail_in)return q(H,f);if(0!==H.avail_in||0!==P.lookahead||c!==C&&P.status!==s){let y=P.strategy===d?((H,c)=>{let y;for(;;){if(0===H.lookahead&&(r(H),0===H.lookahead)){if(c===C)return 1;break}if(H.match_length=0,y=S(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,y&&(M(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,c===m?(M(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(M(H,!1),0===H.strm.avail_out)?1:2})(P,c):P.strategy===K?((H,c)=>{let y,Z,F,P;const n=H.window;for(;;){if(H.lookahead<=G){if(r(H),H.lookahead<=G&&c===C)return 1;if(0===H.lookahead)break}if(H.match_length=0,H.lookahead>=3&&H.strstart>0&&(F=H.strstart-1,Z=n[F],Z===n[++F]&&Z===n[++F]&&Z===n[++F])){P=H.strstart+G;do{}while(Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&Z===n[++F]&&F<P);H.match_length=G-(P-F),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=3?(y=S(H,1,H.match_length-3),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(y=S(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),y&&(M(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,c===m?(M(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(M(H,!1),0===H.strm.avail_out)?1:2})(P,c):b[P.level].func(P,c);if(3!==y&&4!==y||(P.status=s),1===y||3===y)return 0===H.avail_out&&(P.last_flush=-1),V;if(2===y&&(c===g?n(P):c!==z&&(F(P,0,0,!1),c===v&&(j(P.head),0===P.lookahead&&(P.strstart=0,P.block_start=0,P.insert=0))),W(H),0===H.avail_out))return P.last_flush=-1,V}return c!==m?V:P.wrap<=0?h:(2===P.wrap?(x(P,255&H.adler),x(P,H.adler>>8&255),x(P,H.adler>>16&255),x(P,H.adler>>24&255),x(P,255&H.total_in),x(P,H.total_in>>8&255),x(P,H.total_in>>16&255),x(P,H.total_in>>24&255)):(R(P,H.adler>>>16),R(P,65535&H.adler)),W(H),P.wrap>0&&(P.wrap=-P.wrap),0!==P.pending?V:h)},H.exports.deflateEnd=H=>{if(!H||!H.state)return Q;const c=H.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==t&&c!==o&&c!==s?q(H,Q):(H.state=null,c===o?q(H,D):V)},H.exports.deflateSetDictionary=(H,c)=>{let y=c.length;if(!H||!H.state)return Q;const Z=H.state,F=Z.wrap;if(2===F||1===F&&42!==Z.status||Z.lookahead)return Q;if(1===F&&(H.adler=O(H.adler,c,y,0)),Z.wrap=0,y>=Z.w_size){0===F&&(j(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0);let H=new Uint8Array(Z.w_size);H.set(c.subarray(y-Z.w_size,y),0),c=H,y=Z.w_size}const P=H.avail_in,S=H.next_in,n=H.input;for(H.avail_in=y,H.next_in=0,H.input=c,r(Z);Z.lookahead>=3;){let H=Z.strstart,c=Z.lookahead-2;do{Z.ins_h=k(Z,Z.ins_h,Z.window[H+3-1]),Z.prev[H&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=H,H++}while(--c);Z.strstart=H,Z.lookahead=2,r(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=2,Z.match_available=0,H.next_in=S,H.input=n,H.avail_in=P,Z.wrap=F,V},H.exports.deflateInfo="pako deflate (from Nodeca project)"},11017:H=>{"use strict";H.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11006:H=>{"use strict";H.exports=function(H,c){let y,Z,F,P,S,n,O,a,i,C,g,v,m,z,V,h,Q,D,f,J,l,d,K,T;const u=H.state;y=H.next_in,K=H.input,Z=y+(H.avail_in-5),F=H.next_out,T=H.output,P=F-(c-H.avail_out),S=F+(H.avail_out-257),n=u.dmax,O=u.wsize,a=u.whave,i=u.wnext,C=u.window,g=u.hold,v=u.bits,m=u.lencode,z=u.distcode,V=(1<<u.lenbits)-1,h=(1<<u.distbits)-1;H:do{v<15&&(g+=K[y++]<<v,v+=8,g+=K[y++]<<v,v+=8),Q=m[g&V];c:for(;;){if(D=Q>>>24,g>>>=D,v-=D,D=Q>>>16&255,0===D)T[F++]=65535&Q;else{if(!(16&D)){if(0===(64&D)){Q=m[(65535&Q)+(g&(1<<D)-1)];continue c}if(32&D){u.mode=12;break H}H.msg="invalid literal/length code",u.mode=30;break H}f=65535&Q,D&=15,D&&(v<D&&(g+=K[y++]<<v,v+=8),f+=g&(1<<D)-1,g>>>=D,v-=D),v<15&&(g+=K[y++]<<v,v+=8,g+=K[y++]<<v,v+=8),Q=z[g&h];y:for(;;){if(D=Q>>>24,g>>>=D,v-=D,D=Q>>>16&255,!(16&D)){if(0===(64&D)){Q=z[(65535&Q)+(g&(1<<D)-1)];continue y}H.msg="invalid distance code",u.mode=30;break H}if(J=65535&Q,D&=15,v<D&&(g+=K[y++]<<v,v+=8,v<D&&(g+=K[y++]<<v,v+=8)),J+=g&(1<<D)-1,J>n){H.msg="invalid distance too far back",u.mode=30;break H}if(g>>>=D,v-=D,D=F-P,J>D){if(D=J-D,D>a&&u.sane){H.msg="invalid distance too far back",u.mode=30;break H}if(l=0,d=C,0===i){if(l+=O-D,D<f){f-=D;do{T[F++]=C[l++]}while(--D);l=F-J,d=T}}else if(i<D){if(l+=O+i-D,D-=i,D<f){f-=D;do{T[F++]=C[l++]}while(--D);if(l=0,i<f){D=i,f-=D;do{T[F++]=C[l++]}while(--D);l=F-J,d=T}}}else if(l+=i-D,D<f){f-=D;do{T[F++]=C[l++]}while(--D);l=F-J,d=T}for(;f>2;)T[F++]=d[l++],T[F++]=d[l++],T[F++]=d[l++],f-=3;f&&(T[F++]=d[l++],f>1&&(T[F++]=d[l++]))}else{l=F-J;do{T[F++]=T[l++],T[F++]=T[l++],T[F++]=T[l++],f-=3}while(f>2);f&&(T[F++]=T[l++],f>1&&(T[F++]=T[l++]))}break}}break}}while(y<Z&&F<S);f=v>>3,y-=f,v-=f<<3,g&=(1<<v)-1,H.next_in=y,H.next_out=F,H.avail_in=y<Z?Z-y+5:5-(y-Z),H.avail_out=F<S?S-F+257:257-(F-S),u.hold=g,u.bits=v}},11004:(H,c,y)=>{"use strict";const Z=y(10955),F=y(10964),P=y(11006),S=y(11013),{Z_FINISH:n,Z_BLOCK:O,Z_TREES:a,Z_OK:i,Z_STREAM_END:C,Z_NEED_DICT:g,Z_STREAM_ERROR:v,Z_DATA_ERROR:m,Z_MEM_ERROR:z,Z_BUF_ERROR:V,Z_DEFLATED:h}=y(10975),Q=12,D=30,f=H=>(H>>>24&255)+(H>>>8&65280)+((65280&H)<<8)+((255&H)<<24);function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const l=H=>{if(!H||!H.state)return v;const c=H.state;return H.total_in=H.total_out=c.total=0,H.msg="",c.wrap&&(H.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,i},d=H=>{if(!H||!H.state)return v;const c=H.state;return c.wsize=0,c.whave=0,c.wnext=0,l(H)},K=(H,c)=>{let y;if(!H||!H.state)return v;const Z=H.state;return c<0?(y=0,c=-c):(y=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?v:(null!==Z.window&&Z.wbits!==c&&(Z.window=null),Z.wrap=y,Z.wbits=c,d(H))},T=(H,c)=>{if(!H)return v;const y=new J;H.state=y,y.window=null;const Z=K(H,c);return Z!==i&&(H.state=null),Z};let u,E,U=!0;const G=H=>{if(U){u=new Int32Array(512),E=new Int32Array(32);let c=0;for(;c<144;)H.lens[c++]=8;for(;c<256;)H.lens[c++]=9;for(;c<280;)H.lens[c++]=7;for(;c<288;)H.lens[c++]=8;for(S(1,H.lens,0,288,u,0,H.work,{bits:9}),c=0;c<32;)H.lens[c++]=5;S(2,H.lens,0,32,E,0,H.work,{bits:5}),U=!1}H.lencode=u,H.lenbits=9,H.distcode=E,H.distbits=5},p=(H,c,y,Z)=>{let F;const P=H.state;return null===P.window&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new Uint8Array(P.wsize)),Z>=P.wsize?(P.window.set(c.subarray(y-P.wsize,y),0),P.wnext=0,P.whave=P.wsize):(F=P.wsize-P.wnext,F>Z&&(F=Z),P.window.set(c.subarray(y-Z,y-Z+F),P.wnext),(Z-=F)?(P.window.set(c.subarray(y-Z,y),0),P.wnext=Z,P.whave=P.wsize):(P.wnext+=F,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=F))),0};H.exports.inflateReset=d,H.exports.inflateReset2=K,H.exports.inflateResetKeep=l,H.exports.inflateInit=H=>T(H,15),H.exports.inflateInit2=T,H.exports.inflate=(H,c)=>{let y,J,l,d,K,T,u,E,U,t,o,s,q,I,j,k,W,M,x,R,A,e,r=0;const N=new Uint8Array(4);let w,L;const b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!H||!H.state||!H.output||!H.input&&0!==H.avail_in)return v;y=H.state,y.mode===Q&&(y.mode=13),K=H.next_out,l=H.output,u=H.avail_out,d=H.next_in,J=H.input,T=H.avail_in,E=y.hold,U=y.bits,t=T,o=u,e=i;H:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;U<16;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(2&y.wrap&&35615===E){y.check=0,N[0]=255&E,N[1]=E>>>8&255,y.check=F(y.check,N,2,0),E=0,U=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&E)<<8)+(E>>8))%31){H.msg="incorrect header check",y.mode=D;break}if((15&E)!==h){H.msg="unknown compression method",y.mode=D;break}if(E>>>=4,U-=4,A=8+(15&E),0===y.wbits)y.wbits=A;else if(A>y.wbits){H.msg="invalid window size",y.mode=D;break}y.dmax=1<<y.wbits,H.adler=y.check=1,y.mode=512&E?10:Q,E=0,U=0;break;case 2:for(;U<16;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(y.flags=E,(255&y.flags)!==h){H.msg="unknown compression method",y.mode=D;break}if(57344&y.flags){H.msg="unknown header flags set",y.mode=D;break}y.head&&(y.head.text=E>>8&1),512&y.flags&&(N[0]=255&E,N[1]=E>>>8&255,y.check=F(y.check,N,2,0)),E=0,U=0,y.mode=3;case 3:for(;U<32;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.head&&(y.head.time=E),512&y.flags&&(N[0]=255&E,N[1]=E>>>8&255,N[2]=E>>>16&255,N[3]=E>>>24&255,y.check=F(y.check,N,4,0)),E=0,U=0,y.mode=4;case 4:for(;U<16;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.head&&(y.head.xflags=255&E,y.head.os=E>>8),512&y.flags&&(N[0]=255&E,N[1]=E>>>8&255,y.check=F(y.check,N,2,0)),E=0,U=0,y.mode=5;case 5:if(1024&y.flags){for(;U<16;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.length=E,y.head&&(y.head.extra_len=E),512&y.flags&&(N[0]=255&E,N[1]=E>>>8&255,y.check=F(y.check,N,2,0)),E=0,U=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(s=y.length,s>T&&(s=T),s&&(y.head&&(A=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Uint8Array(y.head.extra_len)),y.head.extra.set(J.subarray(d,d+s),A)),512&y.flags&&(y.check=F(y.check,J,s,d)),T-=s,d+=s,y.length-=s),y.length))break H;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===T)break H;s=0;do{A=J[d+s++],y.head&&A&&y.length<65536&&(y.head.name+=String.fromCharCode(A))}while(A&&s<T);if(512&y.flags&&(y.check=F(y.check,J,s,d)),T-=s,d+=s,A)break H}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===T)break H;s=0;do{A=J[d+s++],y.head&&A&&y.length<65536&&(y.head.comment+=String.fromCharCode(A))}while(A&&s<T);if(512&y.flags&&(y.check=F(y.check,J,s,d)),T-=s,d+=s,A)break H}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;U<16;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(E!==(65535&y.check)){H.msg="header crc mismatch",y.mode=D;break}E=0,U=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),H.adler=y.check=0,y.mode=Q;break;case 10:for(;U<32;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}H.adler=y.check=f(E),E=0,U=0,y.mode=11;case 11:if(0===y.havedict)return H.next_out=K,H.avail_out=u,H.next_in=d,H.avail_in=T,y.hold=E,y.bits=U,g;H.adler=y.check=1,y.mode=Q;case Q:if(c===O||c===a)break H;case 13:if(y.last){E>>>=7&U,U-=7&U,y.mode=27;break}for(;U<3;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}switch(y.last=1&E,E>>>=1,U-=1,3&E){case 0:y.mode=14;break;case 1:if(G(y),y.mode=20,c===a){E>>>=2,U-=2;break H}break;case 2:y.mode=17;break;case 3:H.msg="invalid block type",y.mode=D}E>>>=2,U-=2;break;case 14:for(E>>>=7&U,U-=7&U;U<32;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if((65535&E)!==(E>>>16^65535)){H.msg="invalid stored block lengths",y.mode=D;break}if(y.length=65535&E,E=0,U=0,y.mode=15,c===a)break H;case 15:y.mode=16;case 16:if(s=y.length,s){if(s>T&&(s=T),s>u&&(s=u),0===s)break H;l.set(J.subarray(d,d+s),K),T-=s,d+=s,u-=s,K+=s,y.length-=s;break}y.mode=Q;break;case 17:for(;U<14;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(y.nlen=257+(31&E),E>>>=5,U-=5,y.ndist=1+(31&E),E>>>=5,U-=5,y.ncode=4+(15&E),E>>>=4,U-=4,y.nlen>286||y.ndist>30){H.msg="too many length or distance symbols",y.mode=D;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;U<3;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.lens[b[y.have++]]=7&E,E>>>=3,U-=3}for(;y.have<19;)y.lens[b[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,w={bits:y.lenbits},e=S(0,y.lens,0,19,y.lencode,0,y.work,w),y.lenbits=w.bits,e){H.msg="invalid code lengths set",y.mode=D;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;r=y.lencode[E&(1<<y.lenbits)-1],j=r>>>24,k=r>>>16&255,W=65535&r,!(j<=U);){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(W<16)E>>>=j,U-=j,y.lens[y.have++]=W;else{if(16===W){for(L=j+2;U<L;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(E>>>=j,U-=j,0===y.have){H.msg="invalid bit length repeat",y.mode=D;break}A=y.lens[y.have-1],s=3+(3&E),E>>>=2,U-=2}else if(17===W){for(L=j+3;U<L;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}E>>>=j,U-=j,A=0,s=3+(7&E),E>>>=3,U-=3}else{for(L=j+7;U<L;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}E>>>=j,U-=j,A=0,s=11+(127&E),E>>>=7,U-=7}if(y.have+s>y.nlen+y.ndist){H.msg="invalid bit length repeat",y.mode=D;break}for(;s--;)y.lens[y.have++]=A}}if(y.mode===D)break;if(0===y.lens[256]){H.msg="invalid code -- missing end-of-block",y.mode=D;break}if(y.lenbits=9,w={bits:y.lenbits},e=S(1,y.lens,0,y.nlen,y.lencode,0,y.work,w),y.lenbits=w.bits,e){H.msg="invalid literal/lengths set",y.mode=D;break}if(y.distbits=6,y.distcode=y.distdyn,w={bits:y.distbits},e=S(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,w),y.distbits=w.bits,e){H.msg="invalid distances set",y.mode=D;break}if(y.mode=20,c===a)break H;case 20:y.mode=21;case 21:if(T>=6&&u>=258){H.next_out=K,H.avail_out=u,H.next_in=d,H.avail_in=T,y.hold=E,y.bits=U,P(H,o),K=H.next_out,l=H.output,u=H.avail_out,d=H.next_in,J=H.input,T=H.avail_in,E=y.hold,U=y.bits,y.mode===Q&&(y.back=-1);break}for(y.back=0;r=y.lencode[E&(1<<y.lenbits)-1],j=r>>>24,k=r>>>16&255,W=65535&r,!(j<=U);){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(k&&0===(240&k)){for(M=j,x=k,R=W;r=y.lencode[R+((E&(1<<M+x)-1)>>M)],j=r>>>24,k=r>>>16&255,W=65535&r,!(M+j<=U);){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}E>>>=M,U-=M,y.back+=M}if(E>>>=j,U-=j,y.back+=j,y.length=W,0===k){y.mode=26;break}if(32&k){y.back=-1,y.mode=Q;break}if(64&k){H.msg="invalid literal/length code",y.mode=D;break}y.extra=15&k,y.mode=22;case 22:if(y.extra){for(L=y.extra;U<L;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.length+=E&(1<<y.extra)-1,E>>>=y.extra,U-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;r=y.distcode[E&(1<<y.distbits)-1],j=r>>>24,k=r>>>16&255,W=65535&r,!(j<=U);){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(0===(240&k)){for(M=j,x=k,R=W;r=y.distcode[R+((E&(1<<M+x)-1)>>M)],j=r>>>24,k=r>>>16&255,W=65535&r,!(M+j<=U);){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}E>>>=M,U-=M,y.back+=M}if(E>>>=j,U-=j,y.back+=j,64&k){H.msg="invalid distance code",y.mode=D;break}y.offset=W,y.extra=15&k,y.mode=24;case 24:if(y.extra){for(L=y.extra;U<L;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}y.offset+=E&(1<<y.extra)-1,E>>>=y.extra,U-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){H.msg="invalid distance too far back",y.mode=D;break}y.mode=25;case 25:if(0===u)break H;if(s=o-u,y.offset>s){if(s=y.offset-s,s>y.whave&&y.sane){H.msg="invalid distance too far back",y.mode=D;break}s>y.wnext?(s-=y.wnext,q=y.wsize-s):q=y.wnext-s,s>y.length&&(s=y.length),I=y.window}else I=l,q=K-y.offset,s=y.length;s>u&&(s=u),u-=s,y.length-=s;do{l[K++]=I[q++]}while(--s);0===y.length&&(y.mode=21);break;case 26:if(0===u)break H;l[K++]=y.length,u--,y.mode=21;break;case 27:if(y.wrap){for(;U<32;){if(0===T)break H;T--,E|=J[d++]<<U,U+=8}if(o-=u,H.total_out+=o,y.total+=o,o&&(H.adler=y.check=y.flags?F(y.check,l,o,K-o):Z(y.check,l,o,K-o)),o=u,(y.flags?E:f(E))!==y.check){H.msg="incorrect data check",y.mode=D;break}E=0,U=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;U<32;){if(0===T)break H;T--,E+=J[d++]<<U,U+=8}if(E!==(4294967295&y.total)){H.msg="incorrect length check",y.mode=D;break}E=0,U=0}y.mode=29;case 29:e=C;break H;case D:e=m;break H;case 31:return z;default:return v}return H.next_out=K,H.avail_out=u,H.next_in=d,H.avail_in=T,y.hold=E,y.bits=U,(y.wsize||o!==H.avail_out&&y.mode<D&&(y.mode<27||c!==n))&&p(H,H.output,H.next_out,o-H.avail_out)?(y.mode=31,z):(t-=H.avail_in,o-=H.avail_out,H.total_in+=t,H.total_out+=o,y.total+=o,y.wrap&&o&&(H.adler=y.check=y.flags?F(y.check,l,o,H.next_out-o):Z(y.check,l,o,H.next_out-o)),H.data_type=y.bits+(y.last?64:0)+(y.mode===Q?128:0)+(20===y.mode||15===y.mode?256:0),(0===t&&0===o||c===n)&&e===i&&(e=V),e)},H.exports.inflateEnd=H=>{if(!H||!H.state)return v;let c=H.state;return c.window&&(c.window=null),H.state=null,i},H.exports.inflateGetHeader=(H,c)=>{if(!H||!H.state)return v;const y=H.state;return 0===(2&y.wrap)?v:(y.head=c,c.done=!1,i)},H.exports.inflateSetDictionary=(H,c)=>{const y=c.length;let F,P,S;return H&&H.state?(F=H.state,0!==F.wrap&&11!==F.mode?v:11===F.mode&&(P=1,P=Z(P,c,y,0),P!==F.check)?m:(S=p(H,c,y,y),S?(F.mode=31,z):(F.havedict=1,i))):v},H.exports.inflateInfo="pako inflate (from Nodeca project)"},11013:H=>{"use strict";const c=15,y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),F=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),P=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);H.exports=(H,S,n,O,a,i,C,g)=>{const v=g.bits;let m,z,V,h,Q,D,f=0,J=0,l=0,d=0,K=0,T=0,u=0,E=0,U=0,G=0,p=null,t=0;const o=new Uint16Array(16),s=new Uint16Array(16);let q,I,j,k=null,W=0;for(f=0;f<=c;f++)o[f]=0;for(J=0;J<O;J++)o[S[n+J]]++;for(K=v,d=c;d>=1&&0===o[d];d--);if(K>d&&(K=d),0===d)return a[i++]=20971520,a[i++]=20971520,g.bits=1,0;for(l=1;l<d&&0===o[l];l++);for(K<l&&(K=l),E=1,f=1;f<=c;f++)if(E<<=1,E-=o[f],E<0)return-1;if(E>0&&(0===H||1!==d))return-1;for(s[1]=0,f=1;f<c;f++)s[f+1]=s[f]+o[f];for(J=0;J<O;J++)0!==S[n+J]&&(C[s[S[n+J]]++]=J);if(0===H?(p=k=C,D=19):1===H?(p=y,t-=257,k=Z,W-=257,D=256):(p=F,k=P,D=-1),G=0,J=0,f=l,Q=i,T=K,u=0,V=-1,U=1<<K,h=U-1,1===H&&U>852||2===H&&U>592)return 1;for(;;){q=f-u,C[J]<D?(I=0,j=C[J]):C[J]>D?(I=k[W+C[J]],j=p[t+C[J]]):(I=96,j=0),m=1<<f-u,z=1<<T,l=z;do{z-=m,a[Q+(G>>u)+z]=q<<24|I<<16|j}while(0!==z);for(m=1<<f-1;G&m;)m>>=1;if(0!==m?(G&=m-1,G+=m):G=0,J++,0===--o[f]){if(f===d)break;f=S[n+C[J]]}if(f>K&&(G&h)!==V){for(0===u&&(u=K),Q+=l,T=f-u,E=1<<T;T+u<d&&(E-=o[T+u],!(E<=0));)T++,E<<=1;if(U+=1<<T,1===H&&U>852||2===H&&U>592)return 1;V=G&h,a[V]=K<<24|T<<16|Q-i}}return 0!==G&&(a[Q+G]=f-u<<24|64<<16),g.bits=K,0}},10971:H=>{"use strict";H.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10947:H=>{"use strict";function c(H){let c=H.length;for(;--c>=0;)H[c]=0}const y=256,Z=286,F=30,P=15,S=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),O=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);c(i);const C=new Array(60);c(C);const g=new Array(512);c(g);const v=new Array(256);c(v);const m=new Array(29);c(m);const z=new Array(F);function V(H,c,y,Z,F){this.static_tree=H,this.extra_bits=c,this.extra_base=y,this.elems=Z,this.max_length=F,this.has_stree=H&&H.length}let h,Q,D;function f(H,c){this.dyn_tree=H,this.max_code=0,this.stat_desc=c}c(z);const J=H=>H<256?g[H]:g[256+(H>>>7)],l=(H,c)=>{H.pending_buf[H.pending++]=255&c,H.pending_buf[H.pending++]=c>>>8&255},d=(H,c,y)=>{H.bi_valid>16-y?(H.bi_buf|=c<<H.bi_valid&65535,l(H,H.bi_buf),H.bi_buf=c>>16-H.bi_valid,H.bi_valid+=y-16):(H.bi_buf|=c<<H.bi_valid&65535,H.bi_valid+=y)},K=(H,c,y)=>{d(H,y[2*c],y[2*c+1])},T=(H,c)=>{let y=0;do{y|=1&H,H>>>=1,y<<=1}while(--c>0);return y>>>1},u=(H,c,y)=>{const Z=new Array(16);let F,S,n=0;for(F=1;F<=P;F++)Z[F]=n=n+y[F-1]<<1;for(S=0;S<=c;S++){let c=H[2*S+1];0!==c&&(H[2*S]=T(Z[c]++,c))}},E=H=>{let c;for(c=0;c<Z;c++)H.dyn_ltree[2*c]=0;for(c=0;c<F;c++)H.dyn_dtree[2*c]=0;for(c=0;c<19;c++)H.bl_tree[2*c]=0;H.dyn_ltree[512]=1,H.opt_len=H.static_len=0,H.last_lit=H.matches=0},U=H=>{H.bi_valid>8?l(H,H.bi_buf):H.bi_valid>0&&(H.pending_buf[H.pending++]=H.bi_buf),H.bi_buf=0,H.bi_valid=0},G=(H,c,y,Z)=>{const F=2*c,P=2*y;return H[F]<H[P]||H[F]===H[P]&&Z[c]<=Z[y]},p=(H,c,y)=>{const Z=H.heap[y];let F=y<<1;for(;F<=H.heap_len&&(F<H.heap_len&&G(c,H.heap[F+1],H.heap[F],H.depth)&&F++,!G(c,Z,H.heap[F],H.depth));)H.heap[y]=H.heap[F],y=F,F<<=1;H.heap[y]=Z},t=(H,c,Z)=>{let F,P,O,a,i=0;if(0!==H.last_lit)do{F=H.pending_buf[H.d_buf+2*i]<<8|H.pending_buf[H.d_buf+2*i+1],P=H.pending_buf[H.l_buf+i],i++,0===F?K(H,P,c):(O=v[P],K(H,O+y+1,c),a=S[O],0!==a&&(P-=m[O],d(H,P,a)),F--,O=J(F),K(H,O,Z),a=n[O],0!==a&&(F-=z[O],d(H,F,a)))}while(i<H.last_lit);K(H,256,c)},o=(H,c)=>{const y=c.dyn_tree,Z=c.stat_desc.static_tree,F=c.stat_desc.has_stree,S=c.stat_desc.elems;let n,O,a,i=-1;for(H.heap_len=0,H.heap_max=573,n=0;n<S;n++)0!==y[2*n]?(H.heap[++H.heap_len]=i=n,H.depth[n]=0):y[2*n+1]=0;for(;H.heap_len<2;)a=H.heap[++H.heap_len]=i<2?++i:0,y[2*a]=1,H.depth[a]=0,H.opt_len--,F&&(H.static_len-=Z[2*a+1]);for(c.max_code=i,n=H.heap_len>>1;n>=1;n--)p(H,y,n);a=S;do{n=H.heap[1],H.heap[1]=H.heap[H.heap_len--],p(H,y,1),O=H.heap[1],H.heap[--H.heap_max]=n,H.heap[--H.heap_max]=O,y[2*a]=y[2*n]+y[2*O],H.depth[a]=(H.depth[n]>=H.depth[O]?H.depth[n]:H.depth[O])+1,y[2*n+1]=y[2*O+1]=a,H.heap[1]=a++,p(H,y,1)}while(H.heap_len>=2);H.heap[--H.heap_max]=H.heap[1],((H,c)=>{const y=c.dyn_tree,Z=c.max_code,F=c.stat_desc.static_tree,S=c.stat_desc.has_stree,n=c.stat_desc.extra_bits,O=c.stat_desc.extra_base,a=c.stat_desc.max_length;let i,C,g,v,m,z,V=0;for(v=0;v<=P;v++)H.bl_count[v]=0;for(y[2*H.heap[H.heap_max]+1]=0,i=H.heap_max+1;i<573;i++)C=H.heap[i],v=y[2*y[2*C+1]+1]+1,v>a&&(v=a,V++),y[2*C+1]=v,C>Z||(H.bl_count[v]++,m=0,C>=O&&(m=n[C-O]),z=y[2*C],H.opt_len+=z*(v+m),S&&(H.static_len+=z*(F[2*C+1]+m)));if(0!==V){do{for(v=a-1;0===H.bl_count[v];)v--;H.bl_count[v]--,H.bl_count[v+1]+=2,H.bl_count[a]--,V-=2}while(V>0);for(v=a;0!==v;v--)for(C=H.bl_count[v];0!==C;)g=H.heap[--i],g>Z||(y[2*g+1]!==v&&(H.opt_len+=(v-y[2*g+1])*y[2*g],y[2*g+1]=v),C--)}})(H,c),u(y,i,H.bl_count)},s=(H,c,y)=>{let Z,F,P=-1,S=c[1],n=0,O=7,a=4;for(0===S&&(O=138,a=3),c[2*(y+1)+1]=65535,Z=0;Z<=y;Z++)F=S,S=c[2*(Z+1)+1],++n<O&&F===S||(n<a?H.bl_tree[2*F]+=n:0!==F?(F!==P&&H.bl_tree[2*F]++,H.bl_tree[32]++):n<=10?H.bl_tree[34]++:H.bl_tree[36]++,n=0,P=F,0===S?(O=138,a=3):F===S?(O=6,a=3):(O=7,a=4))},q=(H,c,y)=>{let Z,F,P=-1,S=c[1],n=0,O=7,a=4;for(0===S&&(O=138,a=3),Z=0;Z<=y;Z++)if(F=S,S=c[2*(Z+1)+1],!(++n<O&&F===S)){if(n<a)do{K(H,F,H.bl_tree)}while(0!==--n);else 0!==F?(F!==P&&(K(H,F,H.bl_tree),n--),K(H,16,H.bl_tree),d(H,n-3,2)):n<=10?(K(H,17,H.bl_tree),d(H,n-3,3)):(K(H,18,H.bl_tree),d(H,n-11,7));n=0,P=F,0===S?(O=138,a=3):F===S?(O=6,a=3):(O=7,a=4)}};let I=!1;const j=(H,c,y,Z)=>{d(H,0+(Z?1:0),3),((H,c,y,Z)=>{U(H),Z&&(l(H,y),l(H,~y)),H.pending_buf.set(H.window.subarray(c,c+y),H.pending),H.pending+=y})(H,c,y,!0)};H.exports._tr_init=H=>{I||((()=>{let H,c,y,a,f;const J=new Array(16);for(y=0,a=0;a<28;a++)for(m[a]=y,H=0;H<1<<S[a];H++)v[y++]=a;for(v[y-1]=a,f=0,a=0;a<16;a++)for(z[a]=f,H=0;H<1<<n[a];H++)g[f++]=a;for(f>>=7;a<F;a++)for(z[a]=f<<7,H=0;H<1<<n[a]-7;H++)g[256+f++]=a;for(c=0;c<=P;c++)J[c]=0;for(H=0;H<=143;)i[2*H+1]=8,H++,J[8]++;for(;H<=255;)i[2*H+1]=9,H++,J[9]++;for(;H<=279;)i[2*H+1]=7,H++,J[7]++;for(;H<=287;)i[2*H+1]=8,H++,J[8]++;for(u(i,287,J),H=0;H<F;H++)C[2*H+1]=5,C[2*H]=T(H,5);h=new V(i,S,257,Z,P),Q=new V(C,n,0,F,P),D=new V(new Array(0),O,0,19,7)})(),I=!0),H.l_desc=new f(H.dyn_ltree,h),H.d_desc=new f(H.dyn_dtree,Q),H.bl_desc=new f(H.bl_tree,D),H.bi_buf=0,H.bi_valid=0,E(H)},H.exports._tr_stored_block=j,H.exports._tr_flush_block=(H,c,Z,F)=>{let P,S,n=0;H.level>0?(2===H.strm.data_type&&(H.strm.data_type=(H=>{let c,Z=4093624447;for(c=0;c<=31;c++,Z>>>=1)if(1&Z&&0!==H.dyn_ltree[2*c])return 0;if(0!==H.dyn_ltree[18]||0!==H.dyn_ltree[20]||0!==H.dyn_ltree[26])return 1;for(c=32;c<y;c++)if(0!==H.dyn_ltree[2*c])return 1;return 0})(H)),o(H,H.l_desc),o(H,H.d_desc),n=(H=>{let c;for(s(H,H.dyn_ltree,H.l_desc.max_code),s(H,H.dyn_dtree,H.d_desc.max_code),o(H,H.bl_desc),c=18;c>=3&&0===H.bl_tree[2*a[c]+1];c--);return H.opt_len+=3*(c+1)+5+5+4,c})(H),P=H.opt_len+3+7>>>3,S=H.static_len+3+7>>>3,S<=P&&(P=S)):P=S=Z+5,Z+4<=P&&-1!==c?j(H,c,Z,F):4===H.strategy||S===P?(d(H,2+(F?1:0),3),t(H,i,C)):(d(H,4+(F?1:0),3),((H,c,y,Z)=>{let F;for(d(H,c-257,5),d(H,y-1,5),d(H,Z-4,4),F=0;F<Z;F++)d(H,H.bl_tree[2*a[F]+1],3);q(H,H.dyn_ltree,c-1),q(H,H.dyn_dtree,y-1)})(H,H.l_desc.max_code+1,H.d_desc.max_code+1,n+1),t(H,H.dyn_ltree,H.dyn_dtree)),E(H),F&&U(H)},H.exports._tr_tally=(H,c,Z)=>(H.pending_buf[H.d_buf+2*H.last_lit]=c>>>8&255,H.pending_buf[H.d_buf+2*H.last_lit+1]=255&c,H.pending_buf[H.l_buf+H.last_lit]=255&Z,H.last_lit++,0===c?H.dyn_ltree[2*Z]++:(H.matches++,c--,H.dyn_ltree[2*(v[Z]+y+1)]++,H.dyn_dtree[2*J(c)]++),H.last_lit===H.lit_bufsize-1),H.exports._tr_align=H=>{d(H,2,3),K(H,256,i),(H=>{16===H.bi_valid?(l(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):H.bi_valid>=8&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)})(H)}},10991:H=>{"use strict";H.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12007:H=>{function c(H,c,y){for(var Z=H.length,F=-1/0,P=1/0,S=0;S<Z;S++){var n=(y[0][S]-H[S])/c[S],O=(y[1][S]-H[S])/c[S];if(n>O){var a=n;n=O,O=a}if(O<F||n>P)return 1/0;n>F&&(F=n),O<P&&(P=O)}return F>P?1/0:F}H.exports=function(H,y,Z,F){var P=c(y,Z,F);if(P===1/0)H=null;else{H=H||[];for(var S=0;S<y.length;S++)H[S]=y[S]+Z[S]*P}return H},H.exports.distance=c},12793:(H,c,y)=>{"use strict";y.d(c,{d:()=>S});var Z=y(26);const F=Z.useLayoutEffect;const P=function(H){var c=(0,Z.useRef)(H);return F((function(){c.current=H})),c};var S=function(H){var c=P(H);(0,Z.useEffect)((function(){var H=function(H){var y;if(null!=c.current&&(y=c.current(H)),H.defaultPrevented&&(H.returnValue=""),"string"===typeof y)return H.returnValue=y,y};return window.addEventListener("beforeunload",H),function(){window.removeEventListener("beforeunload",H)}}),[])}},12749:(H,c,y)=>{"use strict";var Z=y(12755),F=Array.prototype.concat,P=Array.prototype.slice,S=H.exports=function(H){for(var c=[],y=0,S=H.length;y<S;y++){var n=H[y];Z(n)?c=F.call(c,P.call(n)):c.push(n)}return c};S.wrap=function(H){return function(){return H(S(arguments))}}},12755:H=>{H.exports=function(H){return!(!H||"string"===typeof H)&&(H instanceof Array||Array.isArray(H)||H.length>=0&&(H.splice instanceof Function||Object.getOwnPropertyDescriptor(H,H.length-1)&&"String"!==H.constructor.name))}},10723:(H,c,y)=>{var Z=y(10727);function F(H){for(var c,y,F=0,P=H.length,S=0;S<H.length;){for(c=H[S],y=0;S<P&&H[S]===c;)++S,++y;F+=Z.log2(y)/7|0,F+=Z.log2(c>>>0)/7|0,F+=2}return F}c.size=F,c.encode=function(H,c){c||(c=new Uint8Array(F(H)));for(var y,Z,P=0,S=c.length,n=0;n<H.length;){for(y=H[n],Z=0;n<H.length&&H[n]===y;)++n,++Z;for(;P<S&&Z>=128;)c[P++]=128+(127&Z),Z>>>=7;if(P>=S)throw new Error("RLE buffer overflow");for(c[P++]=Z,y>>>=0;P<S&&y>=128;)c[P++]=128+(127&y),y>>>=7;if(P>=S)throw new Error("RLE buffer overflow");c[P++]=y}return c},c.decode=function(H,c){for(var y,Z,F,P,S=c.length,n=H.length,O=0,a=0;a<n;){for(y=0,Z=0;a<n&&H[a]>=128;)y+=(127&H[a++])<<Z,Z+=7;if(y+=H[a++]<<Z,a>=n)throw new Error("RLE buffer underrun");if(O+y>S)throw new Error("Chunk buffer overflow");for(F=0,Z=0;a<n&&H[a]>=128;)F+=(127&H[a++])<<Z,Z+=7;if(a>=n)throw new Error("RLE buffer underrun");for(F+=H[a++]<<Z,P=0;P<y;++P)c[O++]=F}return c}},10727:(H,c)=>{"use strict";function y(H){var c=32;return(H&=-H)&&c--,65535&H&&(c-=16),16711935&H&&(c-=8),252645135&H&&(c-=4),858993459&H&&(c-=2),1431655765&H&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(H){return(H>0)-(H<0)},c.abs=function(H){var c=H>>31;return(H^c)-c},c.min=function(H,c){return c^(H^c)&-(H<c)},c.max=function(H,c){return H^(H^c)&-(H<c)},c.isPow2=function(H){return!(H&H-1)&&!!H},c.log2=function(H){var c,y;return c=(H>65535)<<4,c|=y=((H>>>=c)>255)<<3,c|=y=((H>>>=y)>15)<<2,(c|=y=((H>>>=y)>3)<<1)|(H>>>=y)>>1},c.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},c.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},c.countTrailingZeros=y,c.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},c.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},c.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var Z=new Array(256);!function(H){for(var c=0;c<256;++c){var y=c,Z=c,F=7;for(y>>>=1;y;y>>>=1)Z<<=1,Z|=1&y,--F;H[c]=Z<<F&255}}(Z),c.reverse=function(H){return Z[255&H]<<24|Z[H>>>8&255]<<16|Z[H>>>16&255]<<8|Z[H>>>24&255]},c.interleave2=function(H,c){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(H,c){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>c&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},c.interleave3=function(H,c,y){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},c.deinterleave3=function(H,c){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>c&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},c.nextCombination=function(H){var c=H|H-1;return c+1|(~c&-~c)-1>>>y(H)+1}},10924:H=>{"use strict";H.exports=function(H,c,y,Z){var F=self||window;try{try{var P;try{P=new F.Blob([H])}catch(a){(P=new(F.BlobBuilder||F.WebKitBlobBuilder||F.MozBlobBuilder||F.MSBlobBuilder)).append(H),P=P.getBlob()}var S=F.URL||F.webkitURL,n=S.createObjectURL(P),O=new F[c](n,y);return S.revokeObjectURL(n),O}catch(a){return new F[c]("data:application/javascript,".concat(encodeURIComponent(H)),y)}}catch(a){if(!Z)throw Error("Inline worker is not supported");return new F[c](Z,y)}}},11993:(H,c,y)=>{"use strict";function Z(H,c,y,Z,F){var P={};return Object.keys(Z).forEach((function(H){P[H]=Z[H]})),P.enumerable=!!P.enumerable,P.configurable=!!P.configurable,("value"in P||P.initializer)&&(P.writable=!0),P=y.slice().reverse().reduce((function(y,Z){return Z(H,c,y)||y}),P),F&&void 0!==P.initializer&&(P.value=P.initializer?P.initializer.call(F):void 0,P.initializer=void 0),void 0===P.initializer&&(Object.defineProperty(H,c,P),P=null),P}y.d(c,{d:()=>Z})},11989:(H,c,y)=>{"use strict";function Z(H,c,y,Z){y&&Object.defineProperty(H,c,{enumerable:y.enumerable,configurable:y.configurable,writable:y.writable,value:y.initializer?y.initializer.call(Z):void 0})}y.d(c,{c:()=>Z})},12290:(H,c,y)=>{"use strict";y.d(c,{c:()=>D,d:()=>V,e:()=>h,h:()=>g,j:()=>z,k:()=>m,n:()=>v});var Z=y(11092),F=y(11112),P=y(11106),S=y(10893),n=y(12294),O=y(11364),a=y(11320),i=y(10805),C=y(11118);const g=Object.freeze(new Z.f(0,0,0,0)),v=Object.freeze(Z.n.Zero()),m=Object.freeze(Z.l.Zero()),z=Object.freeze(a.c.Zero()),V=Object.freeze(F.e.Black()),h=Object.freeze(new F.h(0,0,0,0)),Q={key:0,repeatCount:0,loopMode:2};class D{static _PrepareAnimation(H,c,y,P,S,n,O,i){let C;if(!isNaN(parseFloat(S))&&isFinite(S)?C=D.ANIMATIONTYPE_FLOAT:S instanceof Z.f?C=D.ANIMATIONTYPE_QUATERNION:S instanceof Z.n?C=D.ANIMATIONTYPE_VECTOR3:S instanceof Z.l?C=D.ANIMATIONTYPE_VECTOR2:S instanceof F.e?C=D.ANIMATIONTYPE_COLOR3:S instanceof F.h?C=D.ANIMATIONTYPE_COLOR4:S instanceof a.c&&(C=D.ANIMATIONTYPE_SIZE),void 0==C)return null;const g=new D(H,c,y,C,O),v=[{frame:0,value:S},{frame:P,value:n}];return g.setKeys(v),void 0!==i&&g.setEasingFunction(i),g}static CreateAnimation(H,c,y,Z){const F=new D(H+"Animation",H,y,c,D.ANIMATIONLOOPMODE_CONSTANT);return F.setEasingFunction(Z),F}static CreateAndStartAnimation(H,c,y,Z,F,P,S,n,O,a,i){const C=D._PrepareAnimation(H,y,Z,F,P,S,n,O);return C?(c.va&&(i=c.va()),i?i.beginDirectAnimation(c,[C],0,F,1===C.loopMode,1,a):null):null}static CreateAndStartHierarchyAnimation(H,c,y,Z,F,P,S,n,O,a,i){const C=D._PrepareAnimation(H,Z,F,P,S,n,O,a);if(!C)return null;return c.va().beginDirectHierarchyAnimation(c,y,[C],0,P,1===C.loopMode,1,i)}static CreateMergeAndStartAnimation(H,c,y,Z,F,P,S,n,O,a){const i=D._PrepareAnimation(H,y,Z,F,P,S,n,O);return i?(c.animations.push(i),c.va().beginAnimation(c,0,F,1===i.loopMode,1,a)):null}static MakeAnimationAdditive(H,c,y){let F;F="object"===typeof c?c:{referenceFrame:c??0,range:y,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let P=H;if(F.cloneOriginalAnimation&&(P=H.clone(),P.name=F.clonedAnimationName||P.name),!P._keys.length)return P;const S=F.referenceFrame&&F.referenceFrame>=0?F.referenceFrame:0;let n=0;const O=P._keys[0];let a=P._keys.length-1;const i=P._keys[a],C={referenceValue:O.value,referencePosition:Z.h.o[0],referenceQuaternion:Z.h.Quaternion[0],referenceScaling:Z.h.o[1],keyPosition:Z.h.o[2],keyQuaternion:Z.h.Quaternion[1],keyScaling:Z.h.o[3]};let g=O.frame,v=i.frame;if(F.range){const H=P.getRange(F.range);H&&(g=H.from,v=H.to)}else g=F.fromFrame??g,v=F.toFrame??v;if(g!==O.frame&&(n=P.createKeyForFrame(g)),v!==i.frame&&(a=P.createKeyForFrame(v)),1===P._keys.length){const H=P._getKeyValue(P._keys[0]);C.referenceValue=H.clone?H.clone():H}else if(S<=O.frame){const H=P._getKeyValue(O.value);C.referenceValue=H.clone?H.clone():H}else if(S>=i.frame){const H=P._getKeyValue(i.value);C.referenceValue=H.clone?H.clone():H}else{Q.key=0;const H=P._interpolate(S,Q);C.referenceValue=H.clone?H.clone():H}P.dataType===D.ANIMATIONTYPE_QUATERNION?C.referenceValue.normalize().conjugateInPlace():P.dataType===D.ANIMATIONTYPE_MATRIX&&(C.referenceValue.decompose(C.referenceScaling,C.referenceQuaternion,C.referencePosition),C.referenceQuaternion.normalize().conjugateInPlace());let m=Number.MAX_VALUE;const z=F.clipKeys?[]:null;for(let V=n;V<=a;V++){let H=P._keys[V];if((z||F.cloneOriginalAnimation)&&(H={frame:H.frame,value:H.value.clone?H.value.clone():H.value,inTangent:H.inTangent,outTangent:H.outTangent,interpolation:H.interpolation,lockedTangent:H.lockedTangent},z&&(m===Number.MAX_VALUE&&(m=H.frame),H.frame-=m,z.push(H))),!V||P.dataType===D.ANIMATIONTYPE_FLOAT||H.value!==O.value)switch(P.dataType){case D.ANIMATIONTYPE_MATRIX:H.value.decompose(C.keyScaling,C.keyQuaternion,C.keyPosition),C.keyPosition.pi(C.referencePosition),C.keyScaling.divideInPlace(C.referenceScaling),C.referenceQuaternion.multiplyToRef(C.keyQuaternion,C.keyQuaternion),Z.d.ComposeToRef(C.keyScaling,C.keyQuaternion,C.keyPosition,H.value);break;case D.ANIMATIONTYPE_QUATERNION:C.referenceValue.multiplyToRef(H.value,H.value);break;case D.ANIMATIONTYPE_VECTOR2:case D.ANIMATIONTYPE_VECTOR3:case D.ANIMATIONTYPE_COLOR3:case D.ANIMATIONTYPE_COLOR4:H.value.subtractToRef(C.referenceValue,H.value);break;case D.ANIMATIONTYPE_SIZE:H.value.width-=C.referenceValue.width,H.value.height-=C.referenceValue.height;break;default:H.value-=C.referenceValue}}return z&&P.setKeys(z,!0),P}static TransitionTo(H,c,y,Z,F,P,S){let n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(S<=0)return y[H]=c,n&&n(),null;const O=F*(S/1e3);P.setKeys([{frame:0,value:y[H].clone?y[H].clone():y[H]},{frame:O,value:c}]),y.animations||(y.animations=[]),y.animations.push(P);const a=Z.beginAnimation(y,0,O,!1);return a.onAnimationEnd=n,a}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const H of this._runtimeAnimations)if(!H.isStopped())return!0;return!1}constructor(H,c,y,Z,F,P){this.name=H,this.targetProperty=c,this.framePerSecond=y,this.dataType=Z,this.loopMode=F,this.enableBlending=P,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=c.split("."),this.dataType=Z,this.loopMode=void 0===F?D.ANIMATIONLOOPMODE_CYCLE:F,this.uniqueId=D._UniqueIdGenerator++}toString(H){let c="Name: "+this.name+", property: "+this.targetProperty;if(c+=", datatype: "+["Float","o","Quaternion","Matrix","gb","Vector2"][this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),H){c+=", Ranges: {";let H=!0;for(const y in this._ranges)H&&(c+=", ",H=!1),c+=y;c+="}"}return c}addEvent(H){this._events.push(H),this._events.sort(((H,c)=>H.frame-c.frame))}removeEvents(H){for(let c=0;c<this._events.length;c++)this._events[c].frame===H&&(this._events.splice(c,1),c--)}getEvents(){return this._events}createRange(H,c,y){this._ranges[H]||(this._ranges[H]=new n.c(H,c,y))}deleteRange(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this._ranges[H];if(y){if(c){const H=y.from,c=y.to;for(let y=this._keys.length-1;y>=0;y--)this._keys[y].frame>=H&&this._keys[y].frame<=c&&this._keys.splice(y,1)}this._ranges[H]=null}}getRange(H){return this._ranges[H]}getKeys(){return this._keys}getHighestFrame(){let H=0;for(let c=0,y=this._keys.length;c<y;c++)H<this._keys[c].frame&&(H=this._keys[c].frame);return H}getEasingFunction(){return this._easingFunction}setEasingFunction(H){this._easingFunction=H}floatInterpolateFunction(H,c,y){return(0,P.s)(H,c,y)}floatInterpolateFunctionWithTangents(H,c,y,Z,F){return(0,P.i)(H,c,y,Z,F)}quaternionInterpolateFunction(H,c,y){return Z.f.Slerp(H,c,y)}quaternionInterpolateFunctionWithTangents(H,c,y,F,P){return Z.f.Hermite(H,c,y,F,P).normalize()}vector3InterpolateFunction(H,c,y){return Z.n.Lerp(H,c,y)}vector3InterpolateFunctionWithTangents(H,c,y,F,P){return Z.n.Hermite(H,c,y,F,P)}vector2InterpolateFunction(H,c,y){return Z.l.Lerp(H,c,y)}vector2InterpolateFunctionWithTangents(H,c,y,F,P){return Z.l.Hermite(H,c,y,F,P)}sizeInterpolateFunction(H,c,y){return a.c.Lerp(H,c,y)}color3InterpolateFunction(H,c,y){return F.e.Lerp(H,c,y)}color3InterpolateFunctionWithTangents(H,c,y,Z,P){return F.e.Hermite(H,c,y,Z,P)}color4InterpolateFunction(H,c,y){return F.h.Lerp(H,c,y)}color4InterpolateFunctionWithTangents(H,c,y,Z,P){return F.h.Hermite(H,c,y,Z,P)}_getKeyValue(H){return"function"===typeof H?H():H}evaluate(H){return Q.key=0,this._interpolate(H,Q)}_interpolate(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(c.loopMode===D.ANIMATIONLOOPMODE_CONSTANT&&c.repeatCount>0)return c.highLimitValue.clone?c.highLimitValue.clone():c.highLimitValue;const Z=this._keys,F=Z.length;let P=c.key;for(;P>=0&&H<Z[P].frame;)--P;for(;P+1<=F-1&&H>=Z[P+1].frame;)++P;if(c.key=P,P<0)return y?void 0:this._getKeyValue(Z[0].value);if(P+1>F-1)return y?void 0:this._getKeyValue(Z[F-1].value);const S=Z[P],n=Z[P+1];if(y&&(H===S.frame||H===n.frame))return;const O=this._getKeyValue(S.value),a=this._getKeyValue(n.value);if(1===S.interpolation)return n.frame>H?O:a;const i=void 0!==S.outTangent&&void 0!==n.inTangent,C=n.frame-S.frame;let Q=(H-S.frame)/C;const f=S.easingFunction||this.getEasingFunction();switch(null!==f&&(Q=f.ease(Q)),this.dataType){case D.ANIMATIONTYPE_FLOAT:{const H=i?this.floatInterpolateFunctionWithTangents(O,S.outTangent*C,a,n.inTangent*C,Q):this.floatInterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(c.offsetValue??0)*c.repeatCount+H}break}case D.ANIMATIONTYPE_QUATERNION:{const H=i?this.quaternionInterpolateFunctionWithTangents(O,S.outTangent.scale(C),a,n.inTangent.scale(C),Q):this.quaternionInterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return H.addInPlace((c.offsetValue||g).scale(c.repeatCount))}return H}case D.ANIMATIONTYPE_VECTOR3:{const H=i?this.vector3InterpolateFunctionWithTangents(O,S.outTangent.scale(C),a,n.inTangent.scale(C),Q):this.vector3InterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return H.add((c.offsetValue||v).scale(c.repeatCount))}break}case D.ANIMATIONTYPE_VECTOR2:{const H=i?this.vector2InterpolateFunctionWithTangents(O,S.outTangent.scale(C),a,n.inTangent.scale(C),Q):this.vector2InterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return H.add((c.offsetValue||m).scale(c.repeatCount))}break}case D.ANIMATIONTYPE_SIZE:switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(O,a,Q);case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(O,a,Q).add((c.offsetValue||z).scale(c.repeatCount))}break;case D.ANIMATIONTYPE_COLOR3:{const H=i?this.color3InterpolateFunctionWithTangents(O,S.outTangent.scale(C),a,n.inTangent.scale(C),Q):this.color3InterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return H.add((c.offsetValue||V).scale(c.repeatCount))}break}case D.ANIMATIONTYPE_COLOR4:{const H=i?this.color4InterpolateFunctionWithTangents(O,S.outTangent.scale(C),a,n.inTangent.scale(C),Q):this.color4InterpolateFunction(O,a,Q);switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return H;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return H.add((c.offsetValue||h).scale(c.repeatCount))}break}case D.ANIMATIONTYPE_MATRIX:switch(c.loopMode){case D.ANIMATIONLOOPMODE_CYCLE:case D.ANIMATIONLOOPMODE_CONSTANT:case D.ANIMATIONLOOPMODE_YOYO:return D.AllowMatricesInterpolation?this.matrixInterpolateFunction(O,a,Q,c.workValue):O;case D.ANIMATIONLOOPMODE_RELATIVE:case D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O}}return 0}matrixInterpolateFunction(H,c,y,F){return D.AllowMatrixDecomposeForInterpolation?F?(Z.d.DecomposeLerpToRef(H,c,y,F),F):Z.d.DecomposeLerp(H,c,y):F?(Z.d.LerpToRef(H,c,y,F),F):Z.d.Lerp(H,c,y)}clone(){const H=new D(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(H.enableBlending=this.enableBlending,H.blendingSpeed=this.blendingSpeed,this._keys&&H.setKeys(this._keys),this._ranges){H._ranges={};for(const c in this._ranges){const y=this._ranges[c];y&&(H._ranges[c]=y.clone())}}return H}setKeys(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=c?H:H.slice(0)}createKeyForFrame(H){Q.key=0;const c=this._interpolate(H,Q,!0);if(!c)return this._keys[Q.key].frame===H?Q.key:Q.key+1;const y={frame:H,value:c.clone?c.clone():c};return this._keys.splice(Q.key+1,0,y),Q.key+1}serialize(){const H={};H.name=this.name,H.property=this.targetProperty,H.framePerSecond=this.framePerSecond,H.dataType=this.dataType,H.loopBehavior=this.loopMode,H.enableBlending=this.enableBlending,H.blendingSpeed=this.blendingSpeed;const c=this.dataType;H.keys=[];const y=this.getKeys();for(let Z=0;Z<y.length;Z++){const F=y[Z],P={};switch(P.frame=F.frame,c){case D.ANIMATIONTYPE_FLOAT:P.values=[F.value],void 0!==F.inTangent&&P.values.push(F.inTangent),void 0!==F.outTangent&&(void 0===F.inTangent&&P.values.push(void 0),P.values.push(F.outTangent)),void 0!==F.interpolation&&(void 0===F.inTangent&&P.values.push(void 0),void 0===F.outTangent&&P.values.push(void 0),P.values.push(F.interpolation));break;case D.ANIMATIONTYPE_QUATERNION:case D.ANIMATIONTYPE_MATRIX:case D.ANIMATIONTYPE_VECTOR3:case D.ANIMATIONTYPE_COLOR3:case D.ANIMATIONTYPE_COLOR4:P.values=F.value.ij(),void 0!=F.inTangent&&P.values.push(F.inTangent.ij()),void 0!=F.outTangent&&(void 0===F.inTangent&&P.values.push(void 0),P.values.push(F.outTangent.ij())),void 0!==F.interpolation&&(void 0===F.inTangent&&P.values.push(void 0),void 0===F.outTangent&&P.values.push(void 0),P.values.push(F.interpolation))}H.keys.push(P)}H.ranges=[];for(const Z in this._ranges){const c=this._ranges[Z];if(!c)continue;const y={};y.name=Z,y.from=c.from,y.to=c.to,H.ranges.push(y)}return H}static _UniversalLerp(H,c,y){const Z=H.constructor;return Z.Lerp?Z.Lerp(H,c,y):Z.Slerp?Z.Slerp(H,c,y):H.toFixed?H*(1-y)+y*c:c}static Parse(H){const c=new D(H.name,H.property,H.framePerSecond,H.dataType,H.loopBehavior),y=H.dataType,P=[];let S,n;for(H.enableBlending&&(c.enableBlending=H.enableBlending),H.blendingSpeed&&(c.blendingSpeed=H.blendingSpeed),n=0;n<H.keys.length;n++){const c=H.keys[n];let O,a,i;switch(y){case D.ANIMATIONTYPE_FLOAT:S=c.values[0],c.values.length>=2&&(O=c.values[1]),c.values.length>=3&&(a=c.values[2]),c.values.length>=4&&(i=c.values[3]);break;case D.ANIMATIONTYPE_QUATERNION:if(S=Z.f.Tg(c.values),c.values.length>=8){const H=Z.f.Tg(c.values.slice(4,8));H.equals(Z.f.Zero())||(O=H)}if(c.values.length>=12){const H=Z.f.Tg(c.values.slice(8,12));H.equals(Z.f.Zero())||(a=H)}c.values.length>=13&&(i=c.values[12]);break;case D.ANIMATIONTYPE_MATRIX:S=Z.d.Tg(c.values),c.values.length>=17&&(i=c.values[16]);break;case D.ANIMATIONTYPE_COLOR3:S=F.e.Tg(c.values),c.values[3]&&(O=F.e.Tg(c.values[3])),c.values[4]&&(a=F.e.Tg(c.values[4])),c.values[5]&&(i=c.values[5]);break;case D.ANIMATIONTYPE_COLOR4:S=F.h.Tg(c.values),c.values[4]&&(O=F.h.Tg(c.values[4])),c.values[5]&&(a=F.h.Tg(c.values[5])),c.values[6]&&(i=F.h.Tg(c.values[6]));break;case D.ANIMATIONTYPE_VECTOR3:default:S=Z.n.Tg(c.values),c.values[3]&&(O=Z.n.Tg(c.values[3])),c.values[4]&&(a=Z.n.Tg(c.values[4])),c.values[5]&&(i=c.values[5])}const C={};C.frame=c.frame,C.value=S,void 0!=O&&(C.inTangent=O),void 0!=a&&(C.outTangent=a),void 0!=i&&(C.interpolation=i),P.push(C)}if(c.setKeys(P),H.ranges)for(n=0;n<H.ranges.length;n++)S=H.ranges[n],c.createRange(S.name,S.from,S.to);return c}static AppendSerializedAnimations(H,c){C.e.AppendSerializedAnimations(H,c)}static ParseFromFileAsync(H,c){return new Promise(((y,Z)=>{const F=new i.c;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){let c=JSON.parse(F.responseText);if(c.animations&&(c=c.animations),c.length){const H=[];for(const y of c)H.push(this.Parse(y));y(H)}else{const Z=this.Parse(c);H&&(Z.name=H),y(Z)}}else Z("Unable to load the animation")})),F.open("GET",c),F.send()}))}static ParseFromSnippetAsync(H){return new Promise(((c,y)=>{const Z=new i.c;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const y=JSON.parse(JSON.parse(Z.responseText).jsonPayload);if(y.animations){const Z=JSON.parse(y.animations),F=[];for(const c of Z.animations){const y=this.Parse(c);y.snippetId=H,F.push(y)}c(F)}else{const Z=JSON.parse(y.animation),F=this.Parse(Z);F.snippetId=H,c(F)}}else y("Unable to load the snippet "+H)})),Z.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),Z.send()}))}}D._UniqueIdGenerator=0,D.AllowMatricesInterpolation=!1,D.AllowMatrixDecomposeForInterpolation=!0,D.SnippetUrl="https://snippet.babylonjs.com",D.ANIMATIONTYPE_FLOAT=0,D.ANIMATIONTYPE_VECTOR3=1,D.ANIMATIONTYPE_QUATERNION=2,D.ANIMATIONTYPE_MATRIX=3,D.ANIMATIONTYPE_COLOR3=4,D.ANIMATIONTYPE_COLOR4=7,D.ANIMATIONTYPE_VECTOR2=5,D.ANIMATIONTYPE_SIZE=6,D.ANIMATIONLOOPMODE_RELATIVE=0,D.ANIMATIONLOOPMODE_CYCLE=1,D.ANIMATIONLOOPMODE_CONSTANT=2,D.ANIMATIONLOOPMODE_YOYO=4,D.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,D.CreateFromSnippetAsync=D.ParseFromSnippetAsync,(0,S.d)("BABYLON.Animation",D),O.d._AnimationRangeFactory=(H,c,y)=>new n.c(H,c,y)},12294:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(H,c,y){this.name=H,this.from=c,this.to=y}clone(){return new Z(this.name,this.from,this.to)}}},11667:(H,c,y)=>{"use strict";var Z=y(10763),F=y(10773),P=y(10850),S=y(10768);P.e.AudioEngineFactory=(H,c,y)=>new n(H,c,y);class n{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Z.e,this.onAudioLockedObservable=new Z.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,S.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const F=document.createElement("audio");this._hostElement=H,this._audioContext=c,this._audioDestination=y;try{F&&F.canPlayType&&(F.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||F.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(P){}try{F&&F.canPlayType&&F.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(P){}}lock(){this._triggerSuspendedState()}unlock(){var H,c;if("running"===(null===(H=this._audioContext)||void 0===H?void 0:H.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var H;null===(H=this._audioContext)||void 0===H||H.addEventListener("statechange",(()=>{var H;this.unlocked&&"running"!==(null===(H=this._audioContext)||void 0===H?void 0:H.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var H;return null!==(H=this._audioContext)&&void 0!==H&&H.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(H){this.canUseWebAudio=!1,F.d.Error("Web Audio: "+H.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const H=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(H)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(H){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=H)}connectToAnalyser(H){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=H,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12283:(H,c,y)=>{"use strict";y.d(c,{d:()=>S});var Z=y(11092),F=y(11103),P=y(11364);class S extends P.d{get _matrix(){return this._compose(),this.Qj}set _matrix(H){(H.updateFlag!==this.Qj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qj.p(H),this._markAsDirtyAndDecompose())}constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(H,c.va(),!1),this.name=H,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.Qj=(null===F||void 0===F?void 0:F.clone())??Z.d.Identity(),this._restMatrix=P??this.Qj.clone(),this._bindMatrix=S??this.Qj.clone(),this._index=n,this._absoluteMatrix=new Z.d,this._absoluteBindMatrix=new Z.d,this._absoluteInverseBindMatrix=new Z.d,this._finalMatrix=new Z.d,c.bones.push(this),this.setParent(y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(H){this.setParent(H)}setParent(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==H){if(this.parent){const H=this.parent.children.indexOf(this);-1!==H&&this.parent.children.splice(H,1)}this._parentNode=H,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.Fg()}}getLocalMatrix(){return this._compose(),this.Qj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(H){this._restMatrix.p(H)}setRestPose(H){this.setRestMatrix(H)}getBindPose(){return this.getBindMatrix()}setBindMatrix(H){this.Hj(H)}setBindPose(H){this.setBindMatrix(H)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const H=Z.h.o[0],c=Z.h.Quaternion[0],y=Z.h.o[1];this.getRestMatrix().decompose(H,c,y),this._linkedTransformNode.position.p(y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Z.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(c),this._linkedTransformNode.de.p(H)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(H){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=H,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._d}set position(H){this._decompose(),this._d.p(H),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(H){this.setRotation(H)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(H){this.setRotationQuaternion(H)}get de(){return this.getScale()}set de(H){this.setScale(H)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Z.n.Zero(),this._localRotation=Z.f.Zero(),this._d=Z.n.Zero()),this.Qj.decompose(this._localScaling,this._localRotation,this._d))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Z.d.ComposeToRef(this._localScaling,this._localRotation,this._d,this.Qj)):this._needToCompose=!1)}Hj(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(H),c&&this._updateAbsoluteBindMatrices(),y?this._matrix=H:this.Fg()}_updateAbsoluteBindMatrices(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H||(H=this._bindMatrix),this.parent?H.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(H),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let y=0;y<this.children.length;y++)this.children[y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Fg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Fg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Fg(),this._needToDecompose=!0}_updatePosition(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const P=this.getLocalMatrix();if(0==c)F?(P.addAtIndex(12,H.x),P.addAtIndex(13,H.y),P.addAtIndex(14,H.z)):P.setTranslationFromFloats(H.x,H.y,H.z);else{let c=null;y&&(c=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=S._TmpMats[0],O=S._TmpVecs[0];this.parent?y&&c?(n.p(this.parent.getAbsoluteMatrix()),n.multiplyToRef(c,n)):n.p(this.parent.getAbsoluteMatrix()):Z.d.IdentityToRef(n),F&&n.setTranslationFromFloats(0,0,0),n.invert(),Z.n.TransformCoordinatesToRef(H,n,O),F?(P.addAtIndex(12,O.x),P.addAtIndex(13,O.y),P.addAtIndex(14,O.z)):P.setTranslationFromFloats(O.x,O.y,O.z)}this._markAsDirtyAndDecompose()}translate(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,c,y,!0)}setPosition(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,c,y,!1)}setAbsolutePosition(H,c){this.setPosition(H,1,c)}scale(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=this.getLocalMatrix(),n=S._TmpMats[0];Z.d.ScalingToRef(H,c,y,n),n.multiplyToRef(P,P),n.invert();for(const Z of this.children){const F=Z.getLocalMatrix();F.multiplyToRef(n,F),F.multiplyAtIndex(12,H),F.multiplyAtIndex(13,c),F.multiplyAtIndex(14,y),Z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),F)for(const Z of this.children)Z.scale(H,c,y,F)}setScale(H){this._decompose(),this._localScaling.p(H),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(H){this._decompose(),H.p(this._localScaling)}setYawPitchRoll(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4?arguments[4]:void 0;if(0===F){const n=S._TmpQuat;return Z.f.RotationYawPitchRollToRef(H,c,y,n),void this.setRotationQuaternion(n,F,P)}const n=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,P))return;const O=S._TmpMats[1];Z.d.RotationYawPitchRollToRef(H,c,y,O),n.multiplyToRef(O,O),this._rotateWithMatrix(O,F,P)}rotate(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;const P=S._TmpMats[0];P.setTranslationFromFloats(0,0,0),Z.d.RotationAxisToRef(H,c,P),this._rotateWithMatrix(P,y,F)}setAxisAngle(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;if(0===y){const P=S._TmpQuat;return Z.f.RotationAxisToRef(H,c,P),void this.setRotationQuaternion(P,y,F)}const P=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(P,F))return;const n=S._TmpMats[1];Z.d.RotationAxisToRef(H,c,n),P.multiplyToRef(n,n),this._rotateWithMatrix(n,y,F)}setRotation(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(H.y,H.x,H.z,c,y)}setRotationQuaternion(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.p(H),void this._markAsDirtyAndCompose();const F=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,y))return;const P=S._TmpMats[1];Z.d.FromQuaternionToRef(H,P),F.multiplyToRef(P,P),this._rotateWithMatrix(P,c,y)}setRotationMatrix(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===c){const F=S._TmpQuat;return Z.f.FromRotationMatrixToRef(H,F),void this.setRotationQuaternion(F,c,y)}const F=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,y))return;const P=S._TmpMats[1];P.p(H),F.multiplyToRef(H,P),this._rotateWithMatrix(P,c,y)}_rotateWithMatrix(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const Z=this.getLocalMatrix(),F=Z.m[12],P=Z.m[13],n=Z.m[14],O=this.getParent(),a=S._TmpMats[3],i=S._TmpMats[4];O&&1==c?(y?(a.p(y.getWorldMatrix()),O.getAbsoluteMatrix().multiplyToRef(a,a)):a.p(O.getAbsoluteMatrix()),i.p(a),i.invert(),Z.multiplyToRef(a,Z),Z.multiplyToRef(H,Z),Z.multiplyToRef(i,Z)):1==c&&y?(a.p(y.getWorldMatrix()),i.p(a),i.invert(),Z.multiplyToRef(a,Z),Z.multiplyToRef(H,Z),Z.multiplyToRef(i,Z)):Z.multiplyToRef(H,Z),Z.setTranslationFromFloats(F,P,n),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(H,c){const y=S._TmpMats[2];return H.p(this.getAbsoluteMatrix()),c?(H.multiplyToRef(c.getWorldMatrix(),H),Z.d.ScalingToRef(c.de.x,c.de.y,c.de.z,y)):Z.d.IdentityToRef(y),H.invert(),!isNaN(H.m[0])&&(y.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyToRef(y,H),!0)}cb(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.n.Zero();return this.getPositionToRef(H,c,y),y}getPositionToRef(){let H=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const H=this.getLocalMatrix();c.x=H.m[12],c.y=H.m[13],c.z=H.m[14]}else{let y=null;H&&(y=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Z=S._TmpMats[0];H&&y?(Z.p(this.getAbsoluteMatrix()),Z.multiplyToRef(y,Z)):Z=this.getAbsoluteMatrix(),c.x=Z.m[12],c.y=Z.m[13],c.z=Z.m[14]}}getAbsolutePosition(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=Z.n.Zero();return this.getPositionToRef(1,H,c),c}getAbsolutePositionToRef(H,c){this.getPositionToRef(1,H,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Qj);const H=this._skeleton.getPoseMatrix();H&&this._absoluteMatrix.multiplyToRef(H,this._absoluteMatrix)}const H=this.children,c=H.length;for(let y=0;y<c;y++)H[y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Se(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.n.Zero();return this.getDirectionToRef(H,c,y),y}getDirectionToRef(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,F=null;c&&(F=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=S._TmpMats[0];P.p(this.getAbsoluteMatrix()),c&&F&&P.multiplyToRef(F,P),Z.n.TransformNormalToRef(H,P,y),y.normalize()}getRotation(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.n.Zero();return this.getRotationToRef(H,c,y),y}getRotationToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;const Z=S._TmpQuat;this.getRotationQuaternionToRef(H,c,Z),Z.toEulerAnglesToRef(y)}getRotationQuaternion(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.f.Identity();return this.getRotationQuaternionToRef(H,c,y),y}getRotationQuaternionToRef(){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.p(this._localRotation);else{const y=S._TmpMats[0],Z=this.getAbsoluteMatrix();H?Z.multiplyToRef(H.getWorldMatrix(),y):y.p(Z),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.decompose(void 0,c,void 0)}}getRotationMatrix(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const y=Z.d.Identity();return this.getRotationMatrixToRef(H,c,y),y}getRotationMatrixToRef(){let H=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const y=S._TmpMats[0],Z=this.getAbsoluteMatrix();H?Z.multiplyToRef(H.getWorldMatrix(),y):y.p(Z),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.n.Zero();return this.getAbsolutePositionFromLocalToRef(H,c,y),y}getAbsolutePositionFromLocalToRef(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,F=null;c&&(F=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=S._TmpMats[0];P.p(this.getAbsoluteMatrix()),c&&F&&P.multiplyToRef(F,P),Z.n.TransformCoordinatesToRef(H,P,y)}getLocalPositionFromAbsolute(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=Z.n.Zero();return this.getLocalPositionFromAbsoluteToRef(H,c,y),y}getLocalPositionFromAbsoluteToRef(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,F=null;c&&(F=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=S._TmpMats[0];P.p(this.getAbsoluteMatrix()),c&&F&&P.multiplyToRef(F,P),P.invert(),Z.n.TransformCoordinatesToRef(H,P,y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}S._TmpVecs=(0,F.d)(2,Z.n.Zero),S._TmpQuat=Z.f.Identity(),S._TmpMats=(0,F.d)(5,Z.d.Identity)},11153:(H,c,y)=>{"use strict";y.d(c,{d:()=>P,h:()=>S});var Z=y(11159),F=y(10773);class P{get u(){return this._isDisposed}constructor(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,H&&H.va?this._engine=H.va().getEngine():this._engine=H,this._updatable=y,this._instanced=S,this._divisor=O||1,this._label=a,c instanceof Z.d?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=n?F:F*Float32Array.BYTES_PER_ELEMENT,P||this.create()}createVertexBuffer(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6?arguments[6]:void 0;const O=P?c:c*Float32Array.BYTES_PER_ELEMENT,a=Z?P?Z:Z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new S(this._engine,this,H,this._updatable,!0,a,void 0===F?this._instanced:F,O,y,void 0,void 0,!0,this._divisor||n)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!H&&this._buffer||(H=H||this._data,H&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H),this._data=H):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(H,this._label),this._data=H):this._buffer=this._engine.createVertexBuffer(H,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.mb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.mb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.mb,void 0,this._label));F.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(H){this.create(H)}updateDirectly(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H,Z?c:c*Float32Array.BYTES_PER_ELEMENT,y?y*this.byteStride:void 0),this._data=0===c&&void 0===y?H:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class S{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(H){const c=0!=H;this._instanceDivisor=H,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const H=this.getData();return H?Array.isArray(H)?H.length/(this.byteStride/4)-this.byteOffset/4:(H.byteLength-this.byteOffset)/this.byteStride:0}constructor(H,c,y,Z,F,n,O,a,i,C){let g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,z=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let V=!1;if(this.kd=H,"object"===typeof Z&&null!==Z?(V=Z.updatable??!1,F=Z.postponeInternalCreation,n=Z.stride,O=Z.instanced,a=Z.offset,i=Z.size,C=Z.type,g=Z.normalized??!1,v=Z.useBytes??!1,m=Z.divisor??1,z=Z.takeBufferOwnership??!1,this._label=Z.label):V=!!Z,c instanceof P?(this._buffer=c,this._ownsBuffer=z):(this._buffer=new P(H,c,V,n,F,O,v,m,this._label),this._ownsBuffer=!0),this.uniqueId=S._Counter++,this._kind=y,void 0===C){const H=this.getData();this.type=H?S.GetDataType(H):S.FLOAT}else this.type=C;const h=S.GetTypeByteLength(this.type);v?(this._size=i||(n?n/h:S.DeduceStride(y)),this.byteStride=n||this._buffer.byteStride||this._size*h,this.byteOffset=a||0):(this._size=i||n||S.DeduceStride(y),this.byteStride=n?n*h:this._buffer.byteStride||this._size*h,this.byteOffset=(a||0)*h),this.normalized=g,this._instanced=void 0!==O&&O,this._instanceDivisor=O?m:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var H;null===(H=this._buffer)||void 0===H||H._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(H,c){const y=this.getData();return y?S.GetFloatData(y,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,H,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/S.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/S.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*S.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(H){this._buffer.create(H),this._alignBuffer()}update(H){this._buffer.update(H),this._alignBuffer()}updateDirectly(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(H,c,void 0,y),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(H,c){S.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,H,this.normalized,c)}_alignBuffer(){}static DeduceStride(H){switch(H){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.ColorInstanceKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+H+"'")}}static GetDataType(H){return H instanceof Int8Array?S.BYTE:H instanceof Uint8Array?S.UNSIGNED_BYTE:H instanceof Int16Array?S.SHORT:H instanceof Uint16Array?S.UNSIGNED_SHORT:H instanceof Int32Array?S.INT:H instanceof Uint32Array?S.UNSIGNED_INT:S.FLOAT}static GetTypeByteLength(H){switch(H){case S.BYTE:case S.UNSIGNED_BYTE:return 1;case S.SHORT:case S.UNSIGNED_SHORT:return 2;case S.INT:case S.UNSIGNED_INT:case S.FLOAT:return 4;default:throw new Error(`Invalid type '${H}'`)}}static ForEach(H,c,y,Z,F,P,n,O){if(H instanceof Array){let F=c/4;const S=y/4;for(let c=0;c<P;c+=Z){for(let y=0;y<Z;y++)O(H[F+y],c+y);F+=S}}else{const a=H instanceof ArrayBuffer?new DataView(H):new DataView(H.buffer,H.byteOffset,H.byteLength),i=S.GetTypeByteLength(F);for(let H=0;H<P;H+=Z){let P=c;for(let c=0;c<Z;c++){O(S._GetFloatValue(a,F,P,n),H+c),P+=i}c+=y}}}static _GetFloatValue(H,c,y,Z){switch(c){case S.BYTE:{let c=H.getInt8(y);return Z&&(c=Math.max(c/127,-1)),c}case S.UNSIGNED_BYTE:{let c=H.getUint8(y);return Z&&(c/=255),c}case S.SHORT:{let c=H.getInt16(y,!0);return Z&&(c=Math.max(c/32767,-1)),c}case S.UNSIGNED_SHORT:{let c=H.getUint16(y,!0);return Z&&(c/=65535),c}case S.INT:return H.getInt32(y,!0);case S.UNSIGNED_INT:return H.getUint32(y,!0);case S.FLOAT:return H.getFloat32(y,!0);default:throw new Error(`Invalid component type ${c}`)}}static GetFloatData(H,c,y,Z,P,n,O,a){const i=c*S.GetTypeByteLength(y),C=O*c;if(y!==S.FLOAT||P!==i){const F=new Float32Array(C);return S.ForEach(H,Z,P,c,y,C,n,((H,c)=>F[c]=H)),F}if(!(H instanceof Array||H instanceof Float32Array)||0!==Z||H.length!==C){if(H instanceof Array){const c=Z/4;return H.slice(c,c+C)}if(H instanceof ArrayBuffer)return new Float32Array(H,Z,C);{const c=H.byteOffset+Z;if(0!==(3&c)&&(F.d.Warn("Float array must be aligned to 4-bytes border"),a=!0),a){const y=new Uint8Array(C*Float32Array.BYTES_PER_ELEMENT),Z=new Uint8Array(H.buffer,c,y.length);return y.set(Z),new Float32Array(y.buffer)}return new Float32Array(H.buffer,c,C)}}return a?H.slice():H}}S._Counter=0,S.BYTE=5120,S.UNSIGNED_BYTE=5121,S.SHORT=5122,S.UNSIGNED_SHORT=5123,S.INT=5124,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.PositionKind="position",S.NormalKind="normal",S.TangentKind="tangent",S.UVKind="uv",S.UV2Kind="uv2",S.UV3Kind="uv3",S.UV4Kind="uv4",S.UV5Kind="uv5",S.UV6Kind="uv6",S.ColorKind="color",S.ColorInstanceKind="instanceColor",S.MatricesIndicesKind="matricesIndices",S.MatricesWeightsKind="matricesWeights",S.MatricesIndicesExtraKind="matricesIndicesExtra",S.MatricesWeightsExtraKind="matricesWeightsExtra"},11159:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z});class Z{get underlyingResource(){return null}constructor(){this.references=0,this.mb=0,this.is32Bits=!1,this.uniqueId=Z._Counter++}}Z._Counter=0},12780:(H,c,y)=>{"use strict";y.d(c,{d:()=>t});var Z=y(11052),F=y(11061),P=y(10763),S=y(11092),n=y(11364),O=y(11354),a=y(11181),i=y(10790),C=y(11094);class g{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(H){this._idleRotationSpeed=H}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(H){this._idleRotationWaitTime=H}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(H){this._idleRotationSpinupTime=H}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(H){this._attachedCamera=H;const c=this._attachedCamera.va();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((H=>{H.type!==a.e.POINTERDOWN?H.type===a.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const H=i.b.Now;let c=0;null!=this._lastFrameTime&&(c=H-this._lastFrameTime),this._lastFrameTime=H,this._applyUserInteraction();const y=H-this._lastInteractionTime-this._idleRotationWaitTime,Z=Math.max(Math.min(y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.va();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(H){this._lastInteractionTime=H??i.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<C.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let H=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(H=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?H:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=i.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}y(11617);class v{constructor(){this._easingMode=v.EASINGMODE_EASEIN}setEasingMode(H){const c=Math.min(Math.max(H,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(H){throw new Error("You must implement this method")}ease(H){switch(this._easingMode){case v.EASINGMODE_EASEIN:return this.easeInCore(H);case v.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-H)}return H>=.5?.5*(1-this.easeInCore(2*(1-H)))+.5:.5*this.easeInCore(2*H)}}v.EASINGMODE_EASEIN=0,v.EASINGMODE_EASEOUT=1,v.EASINGMODE_EASEINOUT=2;var m=y(12290);class z{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(H){if(this._autoTransitionRange===H)return;this._autoTransitionRange=H;const c=this._attachedCamera;c&&(H?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((H=>{if(H&&(H.Oj(!0),H.getBoundingInfo)){const c=H.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(H){this._attachedCamera=H,this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(H){return!!this._attachedCamera&&(this._attachedCamera.radius===H&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(H){if(!this._attachedCamera)return;this._radiusBounceTransition||(z.EasingFunction.setEasingMode(z.EasingMode),this._radiusBounceTransition=m.c.CreateAnimation("radius",m.c.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=m.c.TransitionTo("radius",this._attachedCamera.radius+H,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}z.EasingFunction=new class extends v{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=H}easeInCore(H){const c=Math.max(0,this.amplitude);return Math.pow(H,3)-H*c*Math.sin(3.141592653589793*H)}}(.3),z.EasingMode=v.EASINGMODE_EASEOUT;class V{constructor(){this.onTargetFramingAnimationEndObservable=new P.e,this._mode=V.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(H){this._mode=H}get mode(){return this._mode}set radiusScale(H){this._radiusScale=H}get radiusScale(){return this._radiusScale}set positionScale(H){this._positionScale=H}get positionScale(){return this._positionScale}set defaultElevation(H){this._defaultElevation=H}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(H){this._elevationReturnTime=H}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(H){this._elevationReturnWaitTime=H}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(H){this._framingTime=H}get framingTime(){return this._framingTime}init(){}attach(H){this._attachedCamera=H;const c=this._attachedCamera.va();V.EasingFunction.setEasingMode(V.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((H=>{H.type!==a.e.POINTERDOWN?H.type===a.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((H=>{H&&H.getBoundingInfo&&this.zoomOnMesh(H,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.va();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.Oj(!0);const Z=H.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Z.minimumWorld,Z.maximumWorld,c,y)}zoomOnMeshHierarchy(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.Oj(!0);const Z=H.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Z.min,Z.max,c,y)}zoomOnMeshesHierarchy(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new S.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let P=0;P<H.length;P++){const c=H[P].getHierarchyBoundingVectors(!0);S.n.CheckExtends(c.min,Z,F),S.n.CheckExtends(c.max,Z,F)}this.zoomOnBoundingInfo(Z,F,c,y)}zoomOnBoundingInfo(H,c){let y,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const P=H.y,n=P+(c.y-P)*this._positionScale,O=c.Rc(H).scale(.5);if(Z)y=new S.n(0,n,0);else{const c=H.add(O);y=new S.n(c.x,n,c.z)}this._vectorTransition||(this._vectorTransition=m.c.CreateAnimation("target",m.c.ANIMATIONTYPE_VECTOR3,60,V.EasingFunction)),this._betaIsAnimating=!0;let a=m.c.TransitionTo("target",y,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);a&&this._animatables.push(a);let i=0;if(this._mode===V.FitFrustumSidesMode){const y=this._calculateLowerRadiusFromModelBoundingSphere(H,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=O.length()+this._attachedCamera.Wi),i=y}else this._mode===V.IgnoreBoundsSizeMode&&(i=this._calculateLowerRadiusFromModelBoundingSphere(H,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Wi));if(this.autoCorrectCameraLimitsAndSensibility){const y=c.Rc(H).length();this._attachedCamera.panningSensibility=5e3/y,this._attachedCamera.wheelPrecision=100/i}return this._radiusTransition||(this._radiusTransition=m.c.CreateAnimation("radius",m.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),a=m.c.TransitionTo("radius",i,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),F&&F(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),a&&this._animatables.push(a),!0}_calculateLowerRadiusFromModelBoundingSphere(H,c){const y=this._attachedCamera;if(!y)return 0;let Z=y._calculateLowerRadiusFromModelBoundingSphere(H,c,this._radiusScale);return y.lowerRadiusLimit&&this._mode===V.IgnoreBoundsSizeMode&&(Z=Z<y.lowerRadiusLimit?y.lowerRadiusLimit:Z),y.upperRadiusLimit&&(Z=Z>y.upperRadiusLimit?y.upperRadiusLimit:Z),Z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const H=i.b.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>y&&H>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=m.c.CreateAnimation("beta",m.c.ANIMATIONTYPE_FLOAT,60,V.EasingFunction));const H=m.c.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));H&&this._animatables.push(H)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=i.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}V.EasingFunction=new class extends v{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=H}easeInCore(H){return this.exponent<=0?H:(Math.exp(this.exponent*H)-1)/(Math.exp(this.exponent)-1)}},V.EasingMode=v.EASINGMODE_EASEINOUT,V.IgnoreBoundsSizeMode=0,V.FitFrustumSidesMode=1;var h=y(11360),Q=y(12279),D=y(12281),f=y(10754);class J{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(H){H=f.c.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),y=c.getInputElement();let Z=0,F=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=P=>{var S,n;const O=P.event,i="touch"===O.pointerType;if(P.type!==a.e.POINTERMOVE&&-1===this.buttons.indexOf(O.button))return;const C=O.target;if(this._altKey=O.altKey,this._ctrlKey=O.ctrlKey,this._metaKey=O.metaKey,this._shiftKey=O.shiftKey,this._buttonsPressed=O.buttons,c.isPointerLock){const H=O.movementX,c=O.movementY;this.onTouch(null,H,c),this._pointA=null,this._pointB=null}else{if(P.type!==a.e.POINTERDOWN&&P.type!==a.e.POINTERDOUBLETAP&&i&&(null===(S=this._pointA)||void 0===S?void 0:S.pointerId)!==O.pointerId&&(null===(n=this._pointB)||void 0===n?void 0:n.pointerId)!==O.pointerId)return;if(P.type!==a.e.POINTERDOWN||-1!==this._currentActiveButton&&!i)if(P.type===a.e.POINTERDOUBLETAP)this.onDoubleTap(O.pointerType);else if(P.type!==a.e.POINTERUP||this._currentActiveButton!==O.button&&!i){if(P.type===a.e.POINTERMOVE)if(H||O.preventDefault(),this._pointA&&null===this._pointB){const H=O.clientX-this._pointA.x,c=O.clientY-this._pointA.y;this._pointA.x=O.clientX,this._pointA.y=O.clientY,this.onTouch(this._pointA,H,c)}else if(this._pointA&&this._pointB){const H=this._pointA.pointerId===O.pointerId?this._pointA:this._pointB;H.x=O.clientX,H.y=O.clientY;const c=this._pointA.x-this._pointB.x,y=this._pointA.y-this._pointB.y,S=c*c+y*y,n={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:O.pointerId,type:P.type};this.onMultiTouch(this._pointA,this._pointB,Z,S,F,n),F=n,Z=S}}else{try{null===C||void 0===C||C.releasePointerCapture(O.pointerId)}catch(g){}i||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==O.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==O.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Z||F)&&(this.onMultiTouch(this._pointA,this._pointB,Z,0,F,null),Z=0,F=null),this._currentActiveButton=-1,this.onButtonUp(O),H||O.preventDefault()}else{try{null===C||void 0===C||C.setPointerCapture(O.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType};else{if(null!==this._pointB)return;this._pointB={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType}}-1!==this._currentActiveButton||i||(this._currentActiveButton=O.button),this.onButtonDown(O),H||(O.preventDefault(),y&&y.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,a.e.POINTERDOWN|a.e.POINTERUP|a.e.POINTERMOVE|a.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Z=0,F=null,this.onLostFocus()},this._contextMenuBind=H=>this.onContextMenu(H),y&&y.addEventListener("contextmenu",this._contextMenuBind,!1);const P=this.camera.va().getEngine().getHostWindow();P&&f.c.RegisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}Si(){if(this._onLostFocus){const H=this.camera.va().getEngine().getHostWindow();H&&f.c.UnregisterTopRootEvents(H,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const H=this.camera.va().getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(H){}onTouch(H,c,y){}onMultiTouch(H,c,y,Z,F,P){}onContextMenu(H){H.preventDefault()}onButtonDown(H){}onButtonUp(H){}onLostFocus(){}}(0,Z.b)([(0,F.P)()],J.prototype,"buttons",void 0);class l extends J{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(H,c){if(0!==this.panningSensibility&&H&&c){const y=c.x-H.x,Z=c.y-H.y;this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility}}_computePinchZoom(H,c){const y=this.camera.radius||l.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=y*Math.sqrt(H)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-H)*y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-H)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(H,c,y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=y/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(H,c,y,Z,F,P){0===y&&null===F||0===Z&&null===P||(this.multiTouchPanAndZoom?(this._computePinchZoom(y,Z),this._computeMultiTouchPanning(F,P)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Z)-Math.sqrt(y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(y,Z),this._isPinching=!0):this._computeMultiTouchPanning(F,P)):this.multiTouchPanning?this._computeMultiTouchPanning(F,P):this.pinchZoom&&this._computePinchZoom(y,Z))}onButtonDown(H){this._isPanClick=H.button===this.camera._panningMouseButton}onButtonUp(H){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}l.MinimumRadiusForPinch=.001,(0,Z.b)([(0,F.P)()],l.prototype,"buttons",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"angularSensibilityX",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"angularSensibilityY",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"pinchPrecision",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"pinchDeltaPercentage",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"useNaturalPinchZoom",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"pinchZoom",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"panningSensibility",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"multiTouchPanning",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"multiTouchPanAndZoom",void 0),D.e.ArcRotateCameraPointersInput=l;var d=y(11184);class K{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(H){H=f.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const y=c.event;if(!y.metaKey)if(c.type===d.e.KEYDOWN){if(this._ctrlPressed=y.ctrlKey,this._altPressed=y.altKey,-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),y.preventDefault&&(H||y.preventDefault())}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){const c=this._keys.indexOf(y.keyCode);c>=0&&this._keys.splice(c,1),y.preventDefault&&(H||y.preventDefault())}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let c=0;c<this._keys.length;c++){const y=this._keys[c];-1!==this.keysLeft.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX-=1/this.panningSensibility:H.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset+=1/this.zoomingSensibility:H.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX+=1/this.panningSensibility:H.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset-=1/this.zoomingSensibility:H.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(y)&&H.useInputToRestoreState&&H.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Z.b)([(0,F.P)()],K.prototype,"keysUp",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"keysDown",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"keysLeft",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"keysRight",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"keysReset",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"panningSensibility",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"zoomingSensibility",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"useAltToZoom",void 0),(0,Z.b)([(0,F.P)()],K.prototype,"angularSpeed",void 0),D.e.ArcRotateCameraKeyboardMoveInput=K;var T=y(11215),u=y(11190),E=y(11106);class U{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new S.n(0,0,0),this._globalOffset=new S.n(0,0,0),this._inertialPanning=S.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(H,c){let y=0;const Z=.01*H*this.wheelDeltaPercentage*c;return y=H>0?Z/(1+this.wheelDeltaPercentage):Z*(1+this.wheelDeltaPercentage),y}attachControl(H){H=f.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==a.e.POINTERWHEEL)return;const y=c.event;let Z=0;const F=y.deltaMode===u.b.DOM_DELTA_LINE?40:1,P=-y.deltaY*F;if(this.customComputeDeltaFromMouseWheel)Z=this.customComputeDeltaFromMouseWheel(P,this,y);else if(this.wheelDeltaPercentage){if(Z=this._computeDeltaFromMouseWheelLegacyEvent(P,this.camera.radius),Z>0){let H=this.camera.radius,c=this.camera.inertialRadiusOffset+Z;for(let y=0;y<20&&Math.abs(c)>.001;y++)H-=c,c*=this.camera.inertia;H=(0,E.e)(H,0,Number.MAX_VALUE),Z=this._computeDeltaFromMouseWheelLegacyEvent(P,H)}}else Z=P/(40*this.wheelPrecision);Z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Z)):this.camera.inertialRadiusOffset+=Z),y.preventDefault&&(H||y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,a.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ae(0)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const H=this.camera;0+H.inertialAlphaOffset+H.inertialBetaOffset+H.inertialRadiusOffset&&(this._updateHitPlane(),H.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(H.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const H=this.camera,c=H.target.Rc(H.position);this._hitPlane=T.b.FromPositionAndNormal(H.target,c)}_getPosition(){const H=this.camera,c=H.va(),y=c.createPickingRay(c.pointerX,c.pointerY,S.d.Identity(),H,!1);0===H.targetScreenOffset.x&&0===H.targetScreenOffset.y||(this._viewOffset.set(H.targetScreenOffset.x,H.targetScreenOffset.y,0),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),this._globalOffset=S.n.TransformNormal(this._viewOffset,H._cameraTransformMatrix),y.origin.addInPlace(this._globalOffset));let Z=0;return this._hitPlane&&(Z=y.intersectsPlane(this._hitPlane)??0),y.origin.addInPlace(y.direction.scaleInPlace(Z))}_zoomToMouse(H){const c=this.camera,y=1-c.inertia;if(c.lowerRadiusLimit){const Z=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+H)/y<Z&&(H=(c.radius-Z)*y-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const Z=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+H)/y>Z&&(H=(c.radius-Z)*y-c.inertialRadiusOffset)}const Z=H/y/c.radius,F=this._getPosition(),P=S.h.o[6];F.subtractToRef(c.target,P),P.scaleInPlace(Z),P.scaleInPlace(y),this._inertialPanning.addInPlace(P),c.inertialRadiusOffset+=H}_zeroIfClose(H){Math.abs(H.x)<C.e&&(H.x=0),Math.abs(H.y)<C.e&&(H.y=0),Math.abs(H.z)<C.e&&(H.z=0)}}(0,Z.b)([(0,F.P)()],U.prototype,"wheelPrecision",void 0),(0,Z.b)([(0,F.P)()],U.prototype,"zoomToMouseLocation",void 0),(0,Z.b)([(0,F.P)()],U.prototype,"wheelDeltaPercentage",void 0),D.e.ArcRotateCameraMouseWheelInput=U;class G extends D.i{constructor(H){super(H)}addMouseWheel(){return this.add(new U),this}addPointers(){return this.add(new l),this}addKeyboard(){return this.add(new K),this}}var p=y(10893);n.d.AddNodeConstructor("ArcRotateCamera",((H,c)=>()=>new t(H,0,0,1,S.n.Zero(),c)));class t extends Q.e{get target(){return this._target}set target(H){this.setTarget(H)}get targetHost(){return this._targetHost}set targetHost(H){H&&this.setTarget(H)}getTarget(){return this.target}get position(){return this._position}set position(H){this.setPosition(H)}set upVector(H){this._upToYMatrix||(this._yToUpMatrix=new S.d,this._upToYMatrix=new S.d,this._upVector=S.n.Zero()),H.normalize(),this._upVector.p(H),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){S.d.RotationAlignToRef(S.n.UpReadOnly,this._upVector,this._yToUpMatrix),S.d.RotationAlignToRef(this._upVector,S.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityX:0}set angularSensibilityX(H){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=H)}get angularSensibilityY(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityY:0}set angularSensibilityY(H){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=H)}get pinchPrecision(){const H=this.inputs.attached.pointers;return H?H.pinchPrecision:0}set pinchPrecision(H){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=H)}get pinchDeltaPercentage(){const H=this.inputs.attached.pointers;return H?H.pinchDeltaPercentage:0}set pinchDeltaPercentage(H){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=H)}get useNaturalPinchZoom(){const H=this.inputs.attached.pointers;return!!H&&H.useNaturalPinchZoom}set useNaturalPinchZoom(H){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=H)}get panningSensibility(){const H=this.inputs.attached.pointers;return H?H.panningSensibility:0}set panningSensibility(H){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const c=this.inputs.attached.keyboard;c&&(c.keysUp=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const c=this.inputs.attached.keyboard;c&&(c.keysDown=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const c=this.inputs.attached.keyboard;c&&(c.keysRight=H)}get wheelPrecision(){const H=this.inputs.attached.mousewheel;return H?H.wheelPrecision:0}set wheelPrecision(H){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=H)}get zoomToMouseLocation(){const H=this.inputs.attached.mousewheel;return!!H&&H.zoomToMouseLocation}set zoomToMouseLocation(H){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=H)}get wheelDeltaPercentage(){const H=this.inputs.attached.mousewheel;return H?H.wheelDeltaPercentage:0}set wheelDeltaPercentage(H){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=H)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(H){H!==this.useBouncingBehavior&&(H?(this._bouncingBehavior=new z,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(H){H!==this.useFramingBehavior&&(H?(this._framingBehavior=new V,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(H){H!==this.useAutoRotationBehavior&&(H?(this._autoRotationBehavior=new g,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(H,c,y,Z,F,n){var O;let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(H,S.n.Zero(),n,a),O=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=S.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=S.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new S.d,this.panningAxis=new S.n(1,1,0),this._transformedDirection=new S.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new P.e,this.checkCollisions=!1,this.collisionRadius=new S.n(.5,.5,.5),this._previousPosition=S.n.Zero(),this._collisionVelocity=S.n.Zero(),this._newPosition=S.n.Zero(),this._computationVector=S.n.Zero(),this._onCollisionPositionChange=function(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y?(O.setPosition(c),O.Ik&&O.Ik(y)):O._previousPosition.p(O._position);const Z=Math.cos(O.alpha),F=Math.sin(O.alpha),P=Math.cos(O.beta);let S=Math.sin(O.beta);0===S&&(S=1e-4);const n=O._getTargetPosition();O._computationVector.be(O.radius*Z*S,O.radius*P,O.radius*F*S),n.addToRef(O._computationVector,O._newPosition),O._position.p(O._newPosition);let a=O.upVector;O.allowUpsideDown&&O.beta<0&&(a=a.clone(),a=a.negate()),O._computeViewMatrix(O._position,n,a),O._viewMatrix.addAtIndex(12,O.targetScreenOffset.x),O._viewMatrix.addAtIndex(13,O.targetScreenOffset.y),O._collisionTriggered=!1},this._target=S.n.Zero(),F&&this.setTarget(F),this.alpha=c,this.beta=y,this.radius=Z,this.getViewMatrix(),this.inputs=new G(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=S.l.Zero()}_updateCache(H){H||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const H=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?H.addToRef(this._targetBoundingCenter,this._target):this._target.p(H)}const H=this._getLockedTargetPosition();return H||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>C.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const F=arguments;c=f.c.BackCompatCameraNoPreventDefault(F),this._useCtrlForPanning=y,this._panningMouseButton=Z,"boolean"===typeof F[0]&&(F.length>1&&(this._useCtrlForPanning=F[1]),F.length>2&&(this._panningMouseButton=F[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Si(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const H=this._scene.getEngine().getDeltaTime()/1e3,c=1-Math.pow(2,-H/this.restoreStateInterpolationFactor);this.setTarget(S.n.Lerp(this.getTarget(),this._storedTarget,c)),S.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,S.h.Quaternion[0]),S.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,S.h.Quaternion[1]),S.f.SlerpToRef(S.h.Quaternion[1],S.h.Quaternion[0],c,S.h.Quaternion[2]),S.h.Quaternion[2].normalize(),S.h.Quaternion[2].toAlphaBetaGammaToRef(S.h.o[0]),this.alpha=S.h.o[0].x,this.beta=S.h.o[0].y,this.radius+=(this._storedRadius-this.radius)*c,S.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,c,this.targetScreenOffset),(S.n.DistanceSquared(this.getTarget(),this._storedTarget)<C.e&&S.h.Quaternion[2].equalsWithEpsilon(S.h.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<C.e&&S.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<C.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const H=this.invertRotation?-1:1,c=this._calculateHandednessMultiplier();let y=this.inertialAlphaOffset*c;this.beta<0&&(y*=-1),this.alpha+=y*H,this.beta+=this.inertialBetaOffset*H,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<C.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<C.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*C.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const H=new S.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),H.multiplyInPlace(this.panningAxis),S.n.TransformNormalToRef(H,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const H=this.upVector,c=S.n.CrossToRef(this._transformedDirection,H,this._transformedDirection);S.n.CrossToRef(H,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);S.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const H=S.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(H),H.transposeToRef(H),S.n.TransformCoordinatesToRef(this._transformedDirection,H,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*C.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*C.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const H=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const c=Math.round((H-this.alpha)/(2*Math.PI));this.alpha+=2*c*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(H){this._position.equals(H)||(this._position.p(H),this.rebuildAnglesAndRadius())}setTarget(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Z=this.overrideCloneAlphaBetaRadius??Z,H.Oj)c&&H.getBoundingInfo?this._targetBoundingCenter=H.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,H.Oj(),this._targetHost=H,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=H,Z=this._getTargetPosition();if(Z&&!y&&Z.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const H=Math.cos(this.alpha),c=Math.sin(this.alpha),y=Math.cos(this.beta);let Z=Math.sin(this.beta);0===Z&&(Z=1e-4),0===this.radius&&(this.radius=1e-4);const F=this._getTargetPosition();if(this._computationVector.be(this.radius*H*Z,this.radius*y,this.radius*c*Z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),F.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const H=this.va().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,H.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let H=this.upVector;this.allowUpsideDown&&Z<0&&(H=H.negate()),this._computeViewMatrix(this._position,F,H),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=F,this._viewMatrix}zoomOn(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H=H||this.va().meshes;const y=O.c.MinMax(H);let Z=this._calculateLowerRadiusFromModelBoundingSphere(y.min,y.max);Z=Math.max(Math.min(Z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Z*this.zoomOnFactor,this.focusOn({min:y.min,max:y.max,distance:Z},c)}focusOn(H){let c,y,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===H.min){const Z=H||this.va().meshes;c=O.c.MinMax(Z),y=S.n.Distance(c.min,c.max)}else{c=H,y=H.distance}this._target=O.c.Center(c),Z||(this.maxZ=2*y)}createRigCamera(H,c){let y=0;switch(this.cameraRigMode){case h.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.b.RIG_MODE_VR:y=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case h.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const Z=new t(H,this.alpha+y,this.beta,this.radius,this._target,this.va());return Z._cameraRigParams={},Z.isRigCamera=!0,Z.rigParent=this,Z.upVector=this.upVector,Z.mode=this.mode,Z.orthoLeft=this.orthoLeft,Z.orthoRight=this.orthoRight,Z.orthoBottom=this.orthoBottom,Z.orthoTop=this.orthoTop,Z}_updateRigCameras(){const H=this._rigCameras[0],c=this._rigCameras[1];switch(H.beta=c.beta=this.beta,this.cameraRigMode){case h.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.b.RIG_MODE_VR:H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case h.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Z=S.n.Distance(H,c),F=this.va().getEngine().getAspectRatio(this),P=Math.tan(this.fov/2),n=P*F,O=.5*Z*y,a=O*Math.sqrt(1+1/(n*n)),i=O*Math.sqrt(1+1/(P*P));return Math.max(a,i)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Z.b)([(0,F.P)()],t.prototype,"alpha",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"beta",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"radius",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Z.b)([(0,F.N)("target")],t.prototype,"_target",void 0),(0,Z.b)([(0,F.B)("targetHost")],t.prototype,"_targetHost",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"inertialAlphaOffset",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"inertialBetaOffset",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"inertialRadiusOffset",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"lowerAlphaLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"upperAlphaLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"lowerBetaLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"upperBetaLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"lowerRadiusLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"upperRadiusLimit",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"inertialPanningX",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"inertialPanningY",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"pinchToPanMaxDistance",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"panningDistanceLimit",void 0),(0,Z.b)([(0,F.N)()],t.prototype,"panningOriginTarget",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"panningInertia",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"zoomToMouseLocation",null),(0,Z.b)([(0,F.P)()],t.prototype,"zoomOnFactor",void 0),(0,Z.b)([(0,F.L)()],t.prototype,"targetScreenOffset",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"allowUpsideDown",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"useInputToRestoreState",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"restoreStateInterpolationFactor",void 0),(0,p.d)("BABYLON.ArcRotateCamera",t)},11360:(H,c,y)=>{"use strict";y.d(c,{b:()=>V});var Z=y(11052),F=y(11061),P=y(11071),S=y(10754),n=y(10763),O=y(11092),a=y(11364),i=y(10773),C=y(10893),g=y(10798),v=y(11372),m=y(11206),z=y(11118);class V extends a.d{get position(){return this._position}set position(H){this._position=H}set upVector(H){this._upVector=H}get upVector(){return this._upVector}get screenArea(){let H=0,c=0;if(this.mode===V.PERSPECTIVE_CAMERA)this.fovMode===V.FOVMODE_VERTICAL_FIXED?(c=2*this.Wi*Math.tan(this.fov/2),H=this.getEngine().getAspectRatio(this)*c):(H=2*this.Wi*Math.tan(this.fov/2),c=H/this.getEngine().getAspectRatio(this));else{const y=this.getEngine().getRenderWidth()/2,Z=this.getEngine().getRenderHeight()/2;H=(this.orthoRight??y)-(this.orthoLeft??-y),c=(this.orthoTop??Z)-(this.orthoBottom??-Z)}return H*c}set orthoLeft(H){this._orthoLeft=H;for(const c of this._rigCameras)c.orthoLeft=H}get orthoLeft(){return this._orthoLeft}set orthoRight(H){this._orthoRight=H;for(const c of this._rigCameras)c.orthoRight=H}get orthoRight(){return this._orthoRight}set orthoBottom(H){this._orthoBottom=H;for(const c of this._rigCameras)c.orthoBottom=H}get orthoBottom(){return this._orthoBottom}set orthoTop(H){this._orthoTop=H;for(const c of this._rigCameras)c.orthoTop=H}get orthoTop(){return this._orthoTop}set mode(H){this._mode=H;for(const c of this._rigCameras)c.mode=H}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(H,c,y){let Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(H,y,!1),this._position=O.n.Zero(),this._upVector=O.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Wi=1,this.maxZ=1e4,this.inertia=.9,this._mode=V.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new v.c(0,0,1,1),this.layerMask=268435455,this.fovMode=V.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=V.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new n.e,this.onProjectionMatrixChangedObservable=new n.e,this.onAfterCheckInputsObservable=new n.e,this.onRestoreStateObservable=new n.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new O.d,this._postProcesses=new Array,this._activeMeshes=new P.c(256),this._globalPosition=O.n.Zero(),this._computedViewMatrix=O.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=O.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=O.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),Z&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=c,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${H}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"rh"}toString(H){let c="Name: "+this.name;if(c+=", type: "+this.getClassName(),this.animations)for(let y=0;y<this.animations.length;y++)c+=", animation[0]: "+this.animations[y].toString(H);return c}applyVerticalCorrection(){const H=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-H.x:H.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(H){return-1!==this._activeMeshes.indexOf(H)}isReady(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(H)for(const c of this._postProcesses)if(c&&!c.isReady())return!1;return super.isReady(H)}_initCache(){super._initCache(),this._cache.position=new O.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new O.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Wi=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(H){H||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let H=this._cache.mode===this.mode&&this._cache.Wi===this.Wi&&this._cache.maxZ===this.maxZ;if(!H)return!1;const c=this.getEngine();return this.mode===V.PERSPECTIVE_CAMERA?H=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===c.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(H=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===c.getRenderWidth()&&this._cache.renderHeight===c.getRenderHeight(),this.oblique&&(H=H&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),H}attachControl(H,c){}Si(H){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==V.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let H=0;H<this._postProcesses.length;H++)if(null!==this._postProcesses[H])return this._postProcesses[H];return null}_cascadePostProcessesToRigCams(){const H=this._getFirstPostProcess();H&&H.markTextureDirty();for(let c=0,y=this._rigCameras.length;c<y;c++){const H=this._rigCameras[c],y=H._rigPostProcess;if(y){"pass"===y.getEffectName()&&(H.isIntermediate=0===this._postProcesses.length),H._postProcesses=this._postProcesses.slice(0).concat(y),y.markTextureDirty()}else H._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!H.isReusable()&&this._postProcesses.indexOf(H)>-1?(i.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==c||c<0?this._postProcesses.push(H):null===this._postProcesses[c]?this._postProcesses[c]=H:this._postProcesses.splice(c,0,H),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fg(),this._postProcesses.indexOf(H))}detachPostProcess(H){const c=this._postProcesses.indexOf(H);-1!==c&&(this._postProcesses[c]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return O.d.Identity()}getViewMatrix(H){return!H&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(H){this._doNotComputeProjectionMatrix=!0,void 0!==H&&(this._projectionMatrix=H)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(H){if(this._doNotComputeProjectionMatrix||!H&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Wi=this.Wi,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),y=this.va(),Z=c.useReverseDepthBuffer;if(this.mode===V.PERSPECTIVE_CAMERA){let H;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Wi<=0&&(this.Wi=.1),H=y.useRightHandedSystem?O.d.PerspectiveFovRHToRef:O.d.PerspectiveFovLHToRef,H(this.fov,c.getAspectRatio(this),Z?this.maxZ:this.Wi,Z?this.Wi:this.maxZ,this._projectionMatrix,this.fovMode===V.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,Z)}else{var F,P,S;const H=c.getRenderWidth()/2,n=c.getRenderHeight()/2;y.useRightHandedSystem?this.oblique?O.d.ObliqueOffCenterRHToRef(this.orthoLeft??-H,this.orthoRight??H,this.orthoBottom??-n,this.orthoTop??n,Z?this.maxZ:this.Wi,Z?this.Wi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):O.d.OrthoOffCenterRHToRef(this.orthoLeft??-H,this.orthoRight??H,this.orthoBottom??-n,this.orthoTop??n,Z?this.maxZ:this.Wi,Z?this.Wi:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):this.oblique?O.d.ObliqueOffCenterLHToRef(this.orthoLeft??-H,this.orthoRight??H,this.orthoBottom??-n,this.orthoTop??n,Z?this.maxZ:this.Wi,Z?this.Wi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):O.d.OrthoOffCenterLHToRef(this.orthoLeft??-H,this.orthoRight??H,this.orthoBottom??-n,this.orthoTop??n,Z?this.maxZ:this.Wi,Z?this.Wi:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(F=this.oblique)||void 0===F?void 0:F.angle,this._cache.obliqueLength=null===(P=this.oblique)||void 0===P?void 0:P.length,this._cache.obliqueOffset=null===(S=this.oblique)||void 0===S?void 0:S.offset,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(H){return(this.radius||(this.target?O.n.Distance(this.position,this.target):this.position.length()))+H}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?m.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=m.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),c&&this.rigCameras.length>0){let c=!1;return this.rigCameras.forEach((y=>{y._updateFrustumPlanes(),c=c||H.isInFrustum(y._frustumPlanes)})),c}return H.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(H){return this._updateFrustumPlanes(),H.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,g.b)("Ray")}getForwardRayToRef(H){throw(0,g.b)("Ray")}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const H=this._rigCameras.pop();H&&H.dispose()}if(this._parentContainer){const H=this._parentContainer.cameras.indexOf(this);H>-1&&this._parentContainer.cameras.splice(H,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==V.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let H=this._postProcesses.length;for(;--H>=0;){const c=this._postProcesses[H];c&&c.dispose(this)}}let y=this.customRenderTargets.length;for(;--y>=0;)this.customRenderTargets[y].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(H,c)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(H,c){if(this.cameraRigMode!==H){for(;this._rigCameras.length>0;){const H=this._rigCameras.pop();H&&H.dispose()}if(this.cameraRigMode=H,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=c.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=S.c.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==V.RIG_MODE_NONE){const H=this.createRigCamera(this.name+"_L",0);H&&(H._isLeftCamera=!0);const c=this.createRigCamera(this.name+"_R",1);c&&(c._isRightCamera=!0),H&&c&&(this._rigCameras.push(H),this._rigCameras.push(c))}this._setRigMode(c),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(H){}_getVRProjectionMatrix(){return O.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Wi,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(H,c){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[H]=c,"interaxialDistance"===H&&(this._cameraRigParams.stereoHalfAngle=S.c.ToRadians(c/.0637))}createRigCamera(H,c){return null}_updateRigCameras(){for(let H=0;H<this._rigCameras.length;H++)this._rigCameras[H].Wi=this.Wi,this._rigCameras[H].maxZ=this.maxZ,this._rigCameras[H].fov=this.fov,this._rigCameras[H].upVector.p(this.upVector);this.cameraRigMode===V.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const H=z.e.Serialize(this);return H.uniqueId=this.uniqueId,H.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(H),this.inputs&&this.inputs.serialize(H),z.e.AppendSerializedAnimations(this,H),H.ranges=this.serializeAnimationRanges(),H.isEnabled=this.isEnabled(),H}clone(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=z.e.Clone(V.GetConstructorFromName(this.getClassName(),H,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return y.name=H,y.parent=c,this.onClonedObservable.notifyObservers(y),y}Se(H){const c=O.n.Zero();return this.getDirectionToRef(H,c),c}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(H,c){O.n.TransformNormalToRef(H,this.getWorldMatrix(),c)}static GetConstructorFromName(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=a.d.Construct(H,c,y,{interaxial_distance:Z,isStereoscopicSideBySide:F});return P||(()=>V._CreateDefaultParsedCamera(c,y))}Oj(){return this.getWorldMatrix()}static Parse(H,c){const y=H.type,Z=V.GetConstructorFromName(y,H.name,c,H.interaxial_distance,H.isStereoscopicSideBySide),F=z.e.Parse(Z,H,c);if(void 0!==H.parentId&&(F._waitingParentId=H.parentId),void 0!==H.parentInstanceIndex&&(F._waitingParentInstanceIndex=H.parentInstanceIndex),F.inputs&&(F.inputs.parse(H),F._setupInputs()),H.upVector&&(F.upVector=O.n.Tg(H.upVector)),F.setPosition&&(F.position.be(0,0,0),F.setPosition(O.n.Tg(H.position))),H.target&&F.setTarget&&F.setTarget(O.n.Tg(H.target)),H.cameraRigMode){const c=H.interaxial_distance?{interaxialDistance:H.interaxial_distance}:{};F.setCameraRigMode(H.cameraRigMode,c)}if(H.animations){for(let c=0;c<H.animations.length;c++){const y=H.animations[c],Z=(0,C.c)("BABYLON.Animation");Z&&F.animations.push(Z.Parse(y))}a.d.ParseAnimationRanges(F,H,c)}return H.autoAnimate&&c.beginAnimation(F,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),void 0!==H.isEnabled&&F.Tb(H.isEnabled),F}_calculateHandednessMultiplier(){let H=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(H*=-1),H}}V._CreateDefaultParsedCamera=(H,c)=>{throw(0,g.b)("UniversalCamera")},V.PERSPECTIVE_CAMERA=0,V.ORTHOGRAPHIC_CAMERA=1,V.FOVMODE_VERTICAL_FIXED=0,V.FOVMODE_HORIZONTAL_FIXED=1,V.RIG_MODE_NONE=0,V.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,V.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,V.RIG_MODE_STEREOSCOPIC_INTERLACED=14,V.RIG_MODE_VR=20,V.RIG_MODE_CUSTOM=22,V.ForceAttachControlToAlwaysPreventDefault=!1,(0,Z.b)([(0,F.N)("position")],V.prototype,"_position",void 0),(0,Z.b)([(0,F.N)("upVector")],V.prototype,"_upVector",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"orthoLeft",null),(0,Z.b)([(0,F.P)()],V.prototype,"orthoRight",null),(0,Z.b)([(0,F.P)()],V.prototype,"orthoBottom",null),(0,Z.b)([(0,F.P)()],V.prototype,"orthoTop",null),(0,Z.b)([(0,F.P)()],V.prototype,"fov",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"projectionPlaneTilt",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"Wi",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"maxZ",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"inertia",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"mode",null),(0,Z.b)([(0,F.P)()],V.prototype,"layerMask",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"fovMode",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"cameraRigMode",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"interaxialDistance",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"isStereoscopicSideBySide",void 0)},12281:(H,c,y)=>{"use strict";y.d(c,{e:()=>S,i:()=>n});var Z=y(10773),F=y(11118),P=y(11360),S={};class n{constructor(H){this.attachedToElement=!1,this.attached={},this.camera=H,this.checkInputs=()=>{}}add(H){const c=H.getSimpleName();this.attached[c]?Z.d.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=H,H.camera=this.camera,H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H))),this.attachedToElement&&H.attachControl(this.noPreventDefault))}remove(H){for(const c in this.attached){const y=this.attached[c];if(y===H)return y.Si(),y.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(H){for(const c in this.attached){const y=this.attached[c];y.getClassName()===H&&(y.Si(),y.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(H){const c=this.checkInputs;return()=>{c(),H()}}attachInput(H){this.attachedToElement&&H.attachControl(this.noPreventDefault)}attachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){H=!P.b.ForceAttachControlToAlwaysPreventDefault&&H,this.attachedToElement=!0,this.noPreventDefault=H;for(const c in this.attached)this.attached[c].attachControl(H)}}detachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].Si(),H&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const H in this.attached){const c=this.attached[H];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(H){const c={};for(const y in this.attached){const H=this.attached[y],Z=F.e.Serialize(H);c[H.getClassName()]=Z}H.inputsmgr=c}parse(H){const c=H.inputsmgr;if(c){this.clear();for(const H in c){const y=S[H];if(y){const Z=c[H],P=F.e.Parse((()=>new y),Z,null);this.add(P)}}}else for(const y in this.attached){const c=S[this.attached[y].getClassName()];if(c){const Z=F.e.Parse((()=>new c),H,null);this.remove(this.attached[y]),this.add(Z)}}}}},12276:(H,c,y)=>{"use strict";y.d(c,{d:()=>l});var Z=y(11052),F=y(11061),P=y(11092),S=y(12279),n=y(12281),O=y(11184),a=y(10754);class i{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(H){H=a.c.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const y=c.event;if(!y.metaKey)if(c.type===O.e.KEYDOWN){if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),H||y.preventDefault()}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){const c=this._keys.indexOf(y.keyCode);c>=0&&this._keys.splice(c,1),H||y.preventDefault()}})))}Si(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let c=0;c<this._keys.length;c++){const y=this._keys[c],Z=H._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(y)?H._localDirection.be(-Z,0,0):-1!==this.keysUp.indexOf(y)?H._localDirection.be(0,0,Z):-1!==this.keysRight.indexOf(y)?H._localDirection.be(Z,0,0):-1!==this.keysDown.indexOf(y)?H._localDirection.be(0,0,-Z):-1!==this.keysUpward.indexOf(y)?H._localDirection.be(0,Z,0):-1!==this.keysDownward.indexOf(y)?H._localDirection.be(0,-Z,0):-1!==this.keysRotateLeft.indexOf(y)?(H._localDirection.be(0,0,0),H.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(y)?(H._localDirection.be(0,0,0),H.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(y)?(H._localDirection.be(0,0,0),H.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(y)&&(H._localDirection.be(0,0,0),H.cameraRotation.x+=this._getLocalRotation()),H.va().useRightHandedSystem&&(H._localDirection.z*=-1),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),P.n.TransformNormalToRef(H._localDirection,H._cameraTransformMatrix,H._transformedDirection),H.cameraDirection.addInPlace(H._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const H=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*H}}(0,Z.b)([(0,F.P)()],i.prototype,"keysUp",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysUpward",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysDown",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysDownward",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysLeft",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysRight",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"rotationSpeed",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysRotateLeft",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysRotateRight",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysRotateUp",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"keysRotateDown",void 0),n.e.FreeCameraKeyboardMoveInput=i;var C=y(10763),g=y(11181);class v{constructor(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=H,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new C.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(H){H=a.c.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),y=c.getInputElement();this._pointerInput||(this._pointerInput=Z=>{const F=Z.event,P="touch"===F.pointerType;if(!this.touchEnabled&&P)return;if(Z.type!==g.e.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const S=F.target;if(Z.type===g.e.POINTERDOWN){if(P&&-1!==this._activePointerId||!P&&-1!==this._currentActiveButton)return;this._activePointerId=F.pointerId;try{null===S||void 0===S||S.setPointerCapture(F.pointerId)}catch(n){}-1===this._currentActiveButton&&(this._currentActiveButton=F.button),this._previousPosition={x:F.clientX,y:F.clientY},H||(F.preventDefault(),y&&y.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(Z.event)}else if(Z.type===g.e.POINTERUP){if(P&&this._activePointerId!==F.pointerId||!P&&this._currentActiveButton!==F.button)return;try{null===S||void 0===S||S.releasePointerCapture(F.pointerId)}catch(n){}this._currentActiveButton=-1,this._previousPosition=null,H||F.preventDefault(),this._activePointerId=-1}else if(Z.type===g.e.POINTERMOVE&&(this._activePointerId===F.pointerId||!P))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(Z.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),y=(F.clientX-this._previousPosition.x)*c,Z=F.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=y/this.angularSensibility,this.camera.cameraRotation.x+=Z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:y,offsetY:Z}),this._previousPosition={x:F.clientX,y:F.clientY},H||F.preventDefault()}}),this._onMouseMove=y=>{if(!c.isPointerLock)return;const Z=this.camera._calculateHandednessMultiplier(),F=y.movementX*Z;this.camera.cameraRotation.y+=F/this.angularSensibility;const P=y.movementY;this.camera.cameraRotation.x+=P/this.angularSensibility,this._previousPosition=null,H||y.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE),y&&(this._contextMenuBind=H=>this.onContextMenu(H),y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(H){H.preventDefault()}Si(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Z.b)([(0,F.P)()],v.prototype,"buttons",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"angularSensibility",void 0),n.e.FreeCameraMouseInput=v;var m,z=y(11190);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new C.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(H){H=a.c.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==g.e.POINTERWHEEL)return;const y=c.event,Z=y.deltaMode===z.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Z*y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Z*y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Z*y.deltaZ/this._normalize,y.preventDefault&&(H||y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,g.e.POINTERWHEEL)}Si(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Z.b)([(0,F.P)()],V.prototype,"wheelPrecisionX",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"wheelPrecisionY",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"wheelPrecisionZ",void 0),function(H){H[H.MoveRelative=0]="MoveRelative",H[H.RotateRelative=1]="RotateRelative",H[H.MoveScene=2]="MoveScene"}(m||(m={}));class h extends V{constructor(){super(...arguments),this._moveRelative=P.n.Zero(),this._rotateRelative=P.n.Zero(),this._moveScene=P.n.Zero(),this._wheelXAction=m.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=m.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(H){null===H&&this._wheelXAction!==m.MoveRelative||(this._wheelXAction=m.MoveRelative,this._wheelXActionCoordinate=H)}get wheelXMoveRelative(){return this._wheelXAction!==m.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(H){null===H&&this._wheelYAction!==m.MoveRelative||(this._wheelYAction=m.MoveRelative,this._wheelYActionCoordinate=H)}get wheelYMoveRelative(){return this._wheelYAction!==m.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(H){null===H&&this._wheelZAction!==m.MoveRelative||(this._wheelZAction=m.MoveRelative,this._wheelZActionCoordinate=H)}get wheelZMoveRelative(){return this._wheelZAction!==m.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(H){null===H&&this._wheelXAction!==m.RotateRelative||(this._wheelXAction=m.RotateRelative,this._wheelXActionCoordinate=H)}get wheelXRotateRelative(){return this._wheelXAction!==m.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(H){null===H&&this._wheelYAction!==m.RotateRelative||(this._wheelYAction=m.RotateRelative,this._wheelYActionCoordinate=H)}get wheelYRotateRelative(){return this._wheelYAction!==m.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(H){null===H&&this._wheelZAction!==m.RotateRelative||(this._wheelZAction=m.RotateRelative,this._wheelZActionCoordinate=H)}get wheelZRotateRelative(){return this._wheelZAction!==m.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(H){null===H&&this._wheelXAction!==m.MoveScene||(this._wheelXAction=m.MoveScene,this._wheelXActionCoordinate=H)}get wheelXMoveScene(){return this._wheelXAction!==m.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(H){null===H&&this._wheelYAction!==m.MoveScene||(this._wheelYAction=m.MoveScene,this._wheelYActionCoordinate=H)}get wheelYMoveScene(){return this._wheelYAction!==m.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(H){null===H&&this._wheelZAction!==m.MoveScene||(this._wheelZAction=m.MoveScene,this._wheelZActionCoordinate=H)}get wheelZMoveScene(){return this._wheelZAction!==m.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ae(0),this._rotateRelative.ae(0),this._moveScene.ae(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const H=P.d.Zero();this.camera.getViewMatrix().invertToRef(H);const c=P.n.Zero();P.n.TransformNormalToRef(this._moveRelative,H,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(H,c,y){if(0===H)return;if(null===c||null===y)return;let Z=null;switch(c){case m.MoveRelative:Z=this._moveRelative;break;case m.RotateRelative:Z=this._rotateRelative;break;case m.MoveScene:Z=this._moveScene}switch(y){case 0:Z.set(H,0,0);break;case 1:Z.set(0,H,0);break;case 2:Z.set(0,0,H)}}}(0,Z.b)([(0,F.P)()],h.prototype,"wheelXMoveRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelYMoveRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelZMoveRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelXRotateRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelYRotateRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelZRotateRelative",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelXMoveScene",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelYMoveScene",null),(0,Z.b)([(0,F.P)()],h.prototype,"wheelZMoveScene",null),n.e.FreeCameraMouseWheelInput=h;class Q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=H,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=a.c.IsSafari()}attachControl(H){H=a.c.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=y=>{const Z=y.event,F="mouse"===Z.pointerType||this._isSafari&&"undefined"===typeof Z.pointerType;if(this.allowMouse||!F)if(y.type===g.e.POINTERDOWN){if(H||Z.preventDefault(),this._pointerPressed.push(Z.pointerId),1!==this._pointerPressed.length)return;c={x:Z.clientX,y:Z.clientY}}else if(y.type===g.e.POINTERUP){H||Z.preventDefault();const y=this._pointerPressed.indexOf(Z.pointerId);if(-1===y)return;if(this._pointerPressed.splice(y,1),0!=y)return;c=null,this._offsetX=null,this._offsetY=null}else if(y.type===g.e.POINTERMOVE){if(H||Z.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(Z.pointerId))return;this._offsetX=Z.clientX-c.x,this._offsetY=-(Z.clientY-c.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.addEventListener("blur",this._onLostFocus)}}Si(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const H=this.camera,c=H._calculateHandednessMultiplier();H.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)H.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=H._computeLocalCameraSpeed(),y=new P.n(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);P.d.RotationYawPitchRollToRef(H.rotation.y,H.rotation.x,0,H._cameraRotationMatrix),H.cameraDirection.addInPlace(P.n.TransformCoordinates(y,H._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Z.b)([(0,F.P)()],Q.prototype,"touchAngularSensibility",void 0),(0,Z.b)([(0,F.P)()],Q.prototype,"touchMoveSensibility",void 0),n.e.FreeCameraTouchInput=Q;class D extends n.i{constructor(H){super(H),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new i),this}addMouse(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new v(H),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Q),this}clear(){super.clear(),this._mouseInput=null}}var f=y(10893),J=y(10850);class l extends S.e{get angularSensibility(){const H=this.inputs.attached.mouse;return H?H.angularSensibility:0}set angularSensibility(H){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const c=this.inputs.attached.keyboard;c&&(c.keysUp=H)}get keysUpward(){const H=this.inputs.attached.keyboard;return H?H.keysUpward:[]}set keysUpward(H){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const c=this.inputs.attached.keyboard;c&&(c.keysDown=H)}get keysDownward(){const H=this.inputs.attached.keyboard;return H?H.keysDownward:[]}set keysDownward(H){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const c=this.inputs.attached.keyboard;c&&(c.keysRight=H)}get keysRotateLeft(){const H=this.inputs.attached.keyboard;return H?H.keysRotateLeft:[]}set keysRotateLeft(H){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=H)}get keysRotateRight(){const H=this.inputs.attached.keyboard;return H?H.keysRotateRight:[]}set keysRotateRight(H){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=H)}get keysRotateUp(){const H=this.inputs.attached.keyboard;return H?H.keysRotateUp:[]}set keysRotateUp(H){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=H)}get keysRotateDown(){const H=this.inputs.attached.keyboard;return H?H.keysRotateDown:[]}set keysRotateDown(H){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=H)}constructor(H,c,y){var Z;super(H,c,y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Z=this,this.ellipsoid=new P.n(.5,1,.5),this.ellipsoidOffset=new P.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=P.n.Zero(),this._diffPosition=P.n.Zero(),this._newPosition=P.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z._newPosition.p(c),Z._newPosition.subtractToRef(Z._oldPosition,Z._diffPosition),Z._diffPosition.length()>J.e.CollisionsEpsilon&&(Z.position.addToRef(Z._diffPosition,Z._deferredPositionUpdate),Z._deferOnly?Z._deferredUpdated=!0:Z.position.p(Z._deferredPositionUpdate),Z.Ik&&y&&Z.Ik(y))},this.inputs=new D(this),this.inputs.addKeyboard().addMouse()}attachControl(H,c){c=a.c.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}Si(){this.inputs.detachElement(),this.cameraDirection=new P.n(0,0,0),this.cameraRotation=new P.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(H){this._collisionMask=isNaN(H)?-1:H}_collideWithWorld(H){let c;c=this.parent?P.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const y=this.va().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Z=H;this.applyGravity&&(Z=H.add(this.va().gravity)),y.getNewPosition(this._oldPosition,Z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=P.n.Zero(),this._transformedDirection=P.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(H){this._needMoveForGravity=H}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,Z.b)([(0,F.N)()],l.prototype,"ellipsoid",void 0),(0,Z.b)([(0,F.N)()],l.prototype,"ellipsoidOffset",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"checkCollisions",void 0),(0,Z.b)([(0,F.P)()],l.prototype,"applyGravity",void 0),(0,f.d)("BABYLON.FreeCamera",l)},12279:(H,c,y)=>{"use strict";y.d(c,{e:()=>a});var Z=y(11052),F=y(11061),P=y(11360),S=y(11092),n=y(11094),O=y(11410);y(11364).d.AddNodeConstructor("TargetCamera",((H,c)=>()=>new a(H,S.n.Zero(),c)));class a extends P.b{constructor(H,c,y){super(H,c,y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=S.n.Zero(),this._tmpTargetVector=S.n.Zero(),this.cameraDirection=new S.n(0,0,0),this.cameraRotation=new S.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new S.f,this.rotation=new S.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=S.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=S.d.Zero(),this._camMatrix=S.d.Zero(),this._cameraTransformMatrix=S.d.Zero(),this._cameraRotationMatrix=S.d.Zero(),this._referencePoint=new S.n(0,0,1),this._transformedReferencePoint=S.n.Zero(),this._deferredPositionUpdate=new S.n,this._deferredRotationQuaternionUpdate=new S.f,this._deferredRotationUpdate=new S.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=S.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(H){this.getWorldMatrix();const c=this.getTarget().Rc(this.position);return c.normalize(),c.scaleInPlace(H),this.globalPosition.add(c)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const H=this.lockedTarget;H.Oj().getTranslationToRef(H.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.be(0,0,0),this.cameraRotation.be(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new S.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new S.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(H){H||super._updateCache();const c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.p(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const H=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(H):!H)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const H=this.getEngine();return this.speed*Math.sqrt(H.getDeltaTime()/(100*H.getFps()))}setTarget(H){this.upVector.normalize(),this._initialFocalDistance=H.Rc(this.position).length(),this.position.z===H.z&&(this.position.z+=n.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),S.d.LookAtLHToRef(this.position,H,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const c=H.Rc(this.position);c.x>=0?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&S.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(H){this.setTarget(H)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(S.h.Matrix[0]),S.n.TransformNormalToRef(this.cameraDirection,S.h.Matrix[0],S.h.o[0]),this._deferredPositionUpdate.addInPlace(S.h.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const H=this.invertRotation?-this.inverseRotationSpeed:1,c=this._decideIfNeedsToMove(),y=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),c&&this._updatePosition(),y){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*H,this._deferredRotationUpdate.y+=this.cameraRotation.y*H,!this.noRotationConstraint){const H=1.570796;this._deferredRotationUpdate.x>H&&(this._deferredRotationUpdate.x=H),this._deferredRotationUpdate.x<-H&&(this._deferredRotationUpdate.x=-H)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(S.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}c&&(Math.abs(this.cameraDirection.x)<this.speed*n.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*n.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*n.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),y&&(Math.abs(this.cameraRotation.x)<this.speed*n.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*n.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):S.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return S.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),S.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?O.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(S.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),O.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(H,c,y){if(this.ignoreParentScaling){if(this.parent){const Z=this.parent.getWorldMatrix();S.n.TransformCoordinatesToRef(H,Z,this._globalPosition),S.n.TransformCoordinatesToRef(c,Z,this._tmpTargetVector),S.n.TransformNormalToRef(y,Z,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(H),this._tmpTargetVector.p(c),this._tmpUpVector.p(y);this.va().useRightHandedSystem?S.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):S.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?S.d.LookAtRHToRef(H,c,y,this._viewMatrix):S.d.LookAtLHToRef(H,c,y,this._viewMatrix),this.parent){const H=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(H,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(H)}createRigCamera(H,c){if(this.cameraRigMode!==P.b.RIG_MODE_NONE){const c=new a(H,this.position.clone(),this.va());return c.isRigCamera=!0,c.rigParent=this,this.cameraRigMode===P.b.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new S.f),c._cameraRigParams={},c.rotationQuaternion=new S.f),c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoTop=this.orthoTop,c.orthoBottom=this.orthoBottom,c}return null}_updateRigCameras(){const H=this._rigCameras[0],c=this._rigCameras[1];switch(this.Oj(),this.cameraRigMode){case P.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case P.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case P.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case P.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case P.b.RIG_MODE_STEREOSCOPIC_INTERLACED:{const y=this.cameraRigMode===P.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,Z=this.cameraRigMode===P.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*y,H),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Z,c);break}case P.b.RIG_MODE_VR:H.rotationQuaternion?(H.rotationQuaternion.p(this.rotationQuaternion),c.rotationQuaternion.p(this.rotationQuaternion)):(H.rotation.p(this.rotation),c.rotation.p(this.rotation)),H.position.p(this.position),c.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(H,c){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const y=a._TargetFocalPoint.addInPlace(this.position);S.d.TranslationToRef(-y.x,-y.y,-y.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(S.d.RotationAxis(c.upVector,H),a._RigCamTransformMatrix),S.d.TranslationToRef(y.x,y.y,y.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),S.n.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,c.position),c.setTarget(y)}getClassName(){return"TargetCamera"}}a._RigCamTransformMatrix=new S.d,a._TargetTransformMatrix=new S.d,a._TargetFocalPoint=new S.n,(0,Z.b)([(0,F.N)()],a.prototype,"rotation",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"speed",void 0),(0,Z.b)([(0,F.B)("lockedTargetId")],a.prototype,"lockedTarget",void 0)},11250:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(H,c,y){this.bu=H,this.bv=c,this.distance=y,this.faceId=0,this.subMeshId=0}}},11146:(H,c,y)=>{"use strict";y.d(c,{d:()=>P});var Z=y(11092),F=y(11153);class P{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var H;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||y&&!this.pickedMesh.isVerticesDataPresent(F.h.NormalKind))return null;let P,S=this.pickedMesh.Vf();0===(null===(H=S)||void 0===H?void 0:H.length)&&(S=null);const n=Z.h.o[0],O=Z.h.o[1],a=Z.h.o[2];if(y){const H=this.pickedMesh.getVerticesData(F.h.NormalKind);let c=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId],n):n.be(H[3*this.faceId*3],H[3*this.faceId*3+1],H[3*this.faceId*3+2]),y=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId+1],O):O.be(H[3*(3*this.faceId+1)],H[3*(3*this.faceId+1)+1],H[3*(3*this.faceId+1)+2]),i=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId+2],a):a.be(H[3*(3*this.faceId+2)],H[3*(3*this.faceId+2)+1],H[3*(3*this.faceId+2)+2]);c=c.scale(this.bu),y=y.scale(this.bv),i=i.scale(1-this.bu-this.bv),P=new Z.n(c.x+y.x+i.x,c.y+y.y+i.y,c.z+y.z+i.z)}else{const H=this.pickedMesh.getVerticesData(F.h.PositionKind),c=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId],n):n.be(H[3*this.faceId*3],H[3*this.faceId*3+1],H[3*this.faceId*3+2]),y=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId+1],O):O.be(H[3*(3*this.faceId+1)],H[3*(3*this.faceId+1)+1],H[3*(3*this.faceId+1)+2]),i=S?Z.n.FromArrayToRef(H,3*S[3*this.faceId+2],a):a.be(H[3*(3*this.faceId+2)],H[3*(3*this.faceId+2)+1],H[3*(3*this.faceId+2)+2]),C=c.Rc(y),g=i.Rc(y);P=Z.n.Cross(C,g)}const i=(H,c)=>{let y=H.getWorldMatrix();H.nonUniformScaling&&(Z.h.Matrix[0].p(y),y=Z.h.Matrix[0],y.setTranslationFromFloats(0,0,0),y.invert(),y.transposeToRef(Z.h.Matrix[1]),y=Z.h.Matrix[1]),Z.n.TransformNormalToRef(c,y,c)};if(c&&i(this.pickedMesh,P),this.ray){const H=Z.h.o[0].p(P);c||i(this.pickedMesh,H),Z.n.Dot(H,this.ray.direction)>0&&P.negateInPlace()}return P.normalize(),P}getTextureCoordinates(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.h.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(H))return null;const c=this.pickedMesh.Vf();if(!c)return null;const y=this.pickedMesh.getVerticesData(H);if(!y)return null;let P=Z.l.Tg(y,2*c[3*this.faceId]),S=Z.l.Tg(y,2*c[3*this.faceId+1]),n=Z.l.Tg(y,2*c[3*this.faceId+2]);return P=P.scale(this.bu),S=S.scale(this.bv),n=n.scale(1-this.bu-this.bv),new Z.l(P.x+S.x+n.x,P.y+S.y+n.y)}}},11324:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z});let Z=!1},12852:(H,c,y)=>{"use strict";y.d(c,{d:()=>P});var Z=y(11071),F=y(12856);class P{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=y,this.mi=[],this._maxBlockCapacity=c||64,this._selectionContent=new Z.b(1024),this._creationFunc=H}update(H,c,y){F.c._CreateBlocks(H,c,y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}li(H){for(let c=0;c<this.Ch.length;c++){this.Ch[c].addEntry(H)}}sd(H){for(let c=0;c<this.Ch.length;c++){this.Ch[c].removeEntry(H)}}select(H,c){this._selectionContent.reset();for(let y=0;y<this.Ch.length;y++){this.Ch[y].select(H,this._selectionContent,c)}return c?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersects(H,c,y){this._selectionContent.reset();for(let Z=0;Z<this.Ch.length;Z++){this.Ch[Z].intersects(H,c,this._selectionContent,y)}return y?this._selectionContent.concat(this.mi):this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}intersectsRay(H){this._selectionContent.reset();for(let c=0;c<this.Ch.length;c++){this.Ch[c].intersectsRay(H,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.mi),this._selectionContent}}P.CreationFuncForMeshes=(H,c)=>{const y=H.getBoundingInfo();!H.isBlocked&&y.boundingBox.intersectsMinMax(c.qi,c.ri)&&c.entries.push(H)},P.CreationFuncForSubMeshes=(H,c)=>{H.getBoundingInfo().boundingBox.intersectsMinMax(c.qi,c.ri)&&c.entries.push(H)}},12856:(H,c,y)=>{"use strict";y.d(c,{c:()=>P});var Z=y(11092),F=y(11263);class P{constructor(H,c,y,Z,F,P){this.entries=[],this.si=new Array,this._capacity=y,this._depth=Z,this._maxDepth=F,this._creationFunc=P,this._minPoint=H,this._maxPoint=c,this.si.push(H.clone()),this.si.push(c.clone()),this.si.push(H.clone()),this.si[2].x=c.x,this.si.push(H.clone()),this.si[3].y=c.y,this.si.push(H.clone()),this.si[4].z=c.z,this.si.push(c.clone()),this.si[5].z=H.z,this.si.push(c.clone()),this.si[6].x=H.x,this.si.push(c.clone()),this.si[7].y=H.y}get mb(){return this._capacity}get qi(){return this._minPoint}get ri(){return this._maxPoint}addEntry(H){if(this.Ch)for(let c=0;c<this.Ch.length;c++){this.Ch[c].addEntry(H)}else this._creationFunc(H,this),this.entries.length>this.mb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(H){if(this.Ch){for(let c=0;c<this.Ch.length;c++){this.Ch[c].removeEntry(H)}return}const c=this.entries.indexOf(H);c>-1&&this.entries.splice(c,1)}addEntries(H){for(let c=0;c<H.length;c++){const y=H[c];this.addEntry(y)}}select(H,c,y){if(F.d.IsInFrustum(this.si,H)){if(this.Ch){for(let Z=0;Z<this.Ch.length;Z++){this.Ch[Z].select(H,c,y)}return}y?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(H,c,y,Z){if(F.d.IntersectsSphere(this._minPoint,this._maxPoint,H,c)){if(this.Ch){for(let F=0;F<this.Ch.length;F++){this.Ch[F].intersects(H,c,y,Z)}return}Z?y.concat(this.entries):y.concatWithNoDuplicate(this.entries)}}intersectsRay(H,c){if(H.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Ch){for(let y=0;y<this.Ch.length;y++){this.Ch[y].intersectsRay(H,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){P._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(H,c,y,F,S,n,O,a){O.Ch=new Array;const i=new Z.n((c.x-H.x)/2,(c.y-H.y)/2,(c.z-H.z)/2);for(let Z=0;Z<2;Z++)for(let c=0;c<2;c++)for(let C=0;C<2;C++){const g=H.add(i.multiplyByFloats(Z,c,C)),v=H.add(i.multiplyByFloats(Z+1,c+1,C+1)),m=new P(g,v,F,S+1,n,a);m.addEntries(y),O.Ch.push(m)}}}},12865:(H,c,y)=>{"use strict";y.d(c,{c:()=>i});var Z=y(11076),F=y(11092),P=y(11399),S=y(11762),n=y(11174),O=y(12852),a=y(10810);Z.d.prototype.createOrUpdateSelectionOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,y=this._getComponent(n.d.NAME_OCTREE);y||(y=new i(this),this.fb(y)),this.ji||(this.ji=new O.d(O.d.CreationFuncForMeshes,H,c));const Z=this.getWorldExtends();return this.ji.update(Z.min,Z.max,this.meshes),this.ji},Object.defineProperty(Z.d.prototype,"selectionOctree",{get:function(){return this.ji},enumerable:!0,configurable:!0}),P.d.prototype.createOrUpdateSubmeshesOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const y=this.va();let Z=y._getComponent(n.d.NAME_OCTREE);Z||(Z=new i(y),y.fb(Z)),this._submeshesOctree||(this._submeshesOctree=new O.d(O.d.CreationFuncForSubMeshes,H,c)),this.Oj(!0);const F=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(F.minimumWorld,F.maximumWorld,this.$f),this._submeshesOctree};class i{constructor(H){this.name=n.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new S.b(F.n.Zero(),new F.n(1,1,1)),(H=H||a.b.LastCreatedScene)&&(this.Gd=H,this.Gd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Gd.getActiveSubMeshCandidates=H=>this.getActiveSubMeshCandidates(H),this.Gd.getCollidingSubMeshCandidates=(H,c)=>this.getCollidingSubMeshCandidates(H,c),this.Gd.getIntersectingSubMeshCandidates=(H,c)=>this.getIntersectingSubMeshCandidates(H,c))}register(){this.Gd.onMeshRemovedObservable.add((H=>{const c=this.Gd.selectionOctree;if(void 0!==c&&null!==c){const y=c.mi.indexOf(H);-1!==y&&c.mi.splice(y,1)}})),this.Gd.onMeshImportedObservable.add((H=>{const c=this.Gd.selectionOctree;void 0!==c&&null!==c&&c.li(H)}))}getActiveMeshCandidates(){var H;return(null===(H=this.Gd.ji)||void 0===H?void 0:H.select(this.Gd.frustumPlanes))||this.Gd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(H){if(H._submeshesOctree&&H.useOctreeForRenderingSelection){return H._submeshesOctree.select(this.Gd.frustumPlanes)}return this.Gd._getDefaultSubMeshCandidates(H)}getIntersectingSubMeshCandidates(H,c){if(H._submeshesOctree&&H.useOctreeForPicking){S.b.TransformToRef(c,H.getWorldMatrix(),this._tempRay);return H._submeshesOctree.intersectsRay(this._tempRay)}return this.Gd._getDefaultSubMeshCandidates(H)}getCollidingSubMeshCandidates(H,c){if(H._submeshesOctree&&H.useOctreeForCollisions){const y=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return H._submeshesOctree.intersects(c._basePointWorld,y)}return this.Gd._getDefaultSubMeshCandidates(H)}rebuild(){}dispose(){}}},11263:(H,c,y)=>{"use strict";y.d(c,{d:()=>S});var Z=y(11103),F=y(11092),P=y(11094);class S{constructor(H,c,y){this.vectors=(0,Z.d)(8,F.n.Zero),this.center=F.n.Zero(),this.centerWorld=F.n.Zero(),this.extendSize=F.n.Zero(),this.extendSizeWorld=F.n.Zero(),this.directions=(0,Z.d)(3,F.n.Zero),this.vectorsWorld=(0,Z.d)(8,F.n.Zero),this.minimumWorld=F.n.Zero(),this.maximumWorld=F.n.Zero(),this.minimum=F.n.Zero(),this.maximum=F.n.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(H,c,y)}reConstruct(H,c,y){const Z=H.x,P=H.y,S=H.z,n=c.x,O=c.y,a=c.z,i=this.vectors;this.minimum.be(Z,P,S),this.maximum.be(n,O,a),i[0].be(Z,P,S),i[1].be(n,O,a),i[2].be(n,P,S),i[3].be(Z,O,S),i[4].be(Z,P,a),i[5].be(n,O,S),i[6].be(Z,O,a),i[7].be(n,P,a),c.addToRef(H,this.center).scaleInPlace(.5),c.subtractToRef(H,this.extendSize).scaleInPlace(.5),this._worldMatrix=y||F.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(H){const c=S._TmpVector3,y=this.maximum.subtractToRef(this.minimum,c[0]),Z=y.length();y.normalizeFromLength(Z);const F=Z*H,P=y.scaleInPlace(.5*F),n=this.center.subtractToRef(P,c[1]),O=this.center.addToRef(P,c[2]);return this.reConstruct(n,O,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(H){const c=this.minimumWorld,y=this.maximumWorld,Z=this.directions,P=this.vectorsWorld,S=this.vectors;if(H.isIdentity()){c.p(this.minimum),y.p(this.maximum);for(let H=0;H<8;++H)P[H].p(S[H]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{c.ae(Number.MAX_VALUE),y.ae(-Number.MAX_VALUE);for(let Z=0;Z<8;++Z){const n=P[Z];F.n.TransformCoordinatesToRef(S[Z],H,n),c.minimizeInPlace(n),y.maximizeInPlace(n)}y.subtractToRef(c,this.extendSizeWorld).scaleInPlace(.5),y.addToRef(c,this.centerWorld).scaleInPlace(.5)}F.n.FromArrayToRef(H.m,0,Z[0]),F.n.FromArrayToRef(H.m,4,Z[1]),F.n.FromArrayToRef(H.m,8,Z[2]),this._worldMatrix=H}isInFrustum(H){return S.IsInFrustum(this.vectorsWorld,H)}isCompletelyInFrustum(H){return S.IsCompletelyInFrustum(this.vectorsWorld,H)}intersectsPoint(H){const c=this.minimumWorld,y=this.maximumWorld,Z=c.x,F=c.y,S=c.z,n=y.x,O=y.y,a=y.z,i=H.x,C=H.y,g=H.z,v=-P.e;return!(n-i<v||v>i-Z)&&(!(O-C<v||v>C-F)&&!(a-g<v||v>g-S))}intersectsSphere(H){return S.IntersectsSphere(this.minimumWorld,this.maximumWorld,H.centerWorld,H.radiusWorld)}intersectsMinMax(H,c){const y=this.minimumWorld,Z=this.maximumWorld,F=y.x,P=y.y,S=y.z,n=Z.x,O=Z.y,a=Z.z,i=H.x,C=H.y,g=H.z,v=c.x,m=c.y,z=c.z;return!(n<i||F>v)&&(!(O<C||P>m)&&!(a<g||S>z))}dispose(){var H,c;null===(H=this._drawWrapperFront)||void 0===H||H.dispose(),null===(c=this._drawWrapperBack)||void 0===c||c.dispose()}static Intersects(H,c){return H.intersectsMinMax(c.minimumWorld,c.maximumWorld)}static IntersectsSphere(H,c,y,Z){const P=S._TmpVector3[0];F.n.ClampToRef(y,H,c,P);return F.n.DistanceSquared(y,P)<=Z*Z}static IsCompletelyInFrustum(H,c){for(let y=0;y<6;++y){const Z=c[y];for(let c=0;c<8;++c)if(Z.dotCoordinate(H[c])<0)return!1}return!0}static IsInFrustum(H,c){for(let y=0;y<6;++y){let Z=!0;const F=c[y];for(let c=0;c<8;++c)if(F.dotCoordinate(H[c])>=0){Z=!1;break}if(Z)return!1}return!0}}S._TmpVector3=(0,Z.d)(3,F.n.Zero)},11256:(H,c,y)=>{"use strict";y.d(c,{b:()=>C});var Z=y(11103),F=y(11092),P=y(11263),S=y(11268);const n={min:0,max:0},O={min:0,max:0},a=(H,c,y)=>{const Z=F.n.Dot(c.centerWorld,H),P=Math.abs(F.n.Dot(c.directions[0],H))*c.extendSize.x+Math.abs(F.n.Dot(c.directions[1],H))*c.extendSize.y+Math.abs(F.n.Dot(c.directions[2],H))*c.extendSize.z;y.min=Z-P,y.max=Z+P},i=(H,c,y)=>(a(H,c,n),a(H,y,O),!(n.min>O.max||O.min>n.max));class C{constructor(H,c,y){this._isLocked=!1,this.boundingBox=new P.d(H,c,y),this.boundingSphere=new S.d(H,c,y)}reConstruct(H,c,y){this.boundingBox.reConstruct(H,c,y),this.boundingSphere.reConstruct(H,c,y)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(H){this._isLocked=H}update(H){this._isLocked||(this.boundingBox._update(H),this.boundingSphere._update(H))}centerOn(H,c){const y=C._TmpVector3[0].p(H).pi(c),Z=C._TmpVector3[1].p(H).addInPlace(c);return this.boundingBox.reConstruct(y,Z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(y,Z,this.boundingBox.getWorldMatrix()),this}encapsulate(H){const c=F.n.Minimize(this.minimum,H),y=F.n.Maximize(this.maximum,H);return this.reConstruct(c,y,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(H){const c=F.h.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(c);const y=F.h.o[0];return F.n.TransformCoordinatesToRef(H.boundingBox.minimumWorld,c,y),this.encapsulate(y),F.n.TransformCoordinatesToRef(H.boundingBox.maximumWorld,c,y),this.encapsulate(y),this}scale(H){return this.boundingBox.scale(H),this.boundingSphere.scale(H),this}isInFrustum(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===c||3===c)&&this.boundingSphere.isCenterInFrustum(H))return!0;if(!this.boundingSphere.isInFrustum(H))return!1;return!(1!==c&&3!==c)||this.boundingBox.isInFrustum(H)}get diagonalLength(){const H=this.boundingBox;return H.maximumWorld.subtractToRef(H.minimumWorld,C._TmpVector3[0]).length()}isCompletelyInFrustum(H){return this.boundingBox.isCompletelyInFrustum(H)}_checkCollision(H){return H._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(H){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(H)&&!!this.boundingBox.intersectsPoint(H))}intersects(H,c){if(!S.d.Intersects(this.boundingSphere,H.boundingSphere))return!1;if(!P.d.Intersects(this.boundingBox,H.boundingBox))return!1;if(!c)return!0;const y=this.boundingBox,Z=H.boundingBox;return!!i(y.directions[0],y,Z)&&(!!i(y.directions[1],y,Z)&&(!!i(y.directions[2],y,Z)&&(!!i(Z.directions[0],y,Z)&&(!!i(Z.directions[1],y,Z)&&(!!i(Z.directions[2],y,Z)&&(!!i(F.n.Cross(y.directions[0],Z.directions[0]),y,Z)&&(!!i(F.n.Cross(y.directions[0],Z.directions[1]),y,Z)&&(!!i(F.n.Cross(y.directions[0],Z.directions[2]),y,Z)&&(!!i(F.n.Cross(y.directions[1],Z.directions[0]),y,Z)&&(!!i(F.n.Cross(y.directions[1],Z.directions[1]),y,Z)&&(!!i(F.n.Cross(y.directions[1],Z.directions[2]),y,Z)&&(!!i(F.n.Cross(y.directions[2],Z.directions[0]),y,Z)&&(!!i(F.n.Cross(y.directions[2],Z.directions[1]),y,Z)&&!!i(F.n.Cross(y.directions[2],Z.directions[2]),y,Z))))))))))))))}}C._TmpVector3=(0,Z.d)(2,F.n.Zero)},11268:(H,c,y)=>{"use strict";y.d(c,{d:()=>P});var Z=y(11103),F=y(11092);class P{constructor(H,c,y){this.center=F.n.Zero(),this.centerWorld=F.n.Zero(),this.minimum=F.n.Zero(),this.maximum=F.n.Zero(),this.reConstruct(H,c,y)}reConstruct(H,c,y){this.minimum.p(H),this.maximum.p(c);const Z=F.n.Distance(H,c);c.addToRef(H,this.center).scaleInPlace(.5),this.radius=.5*Z,this._update(y||F.d.IdentityReadOnly)}scale(H){const c=this.radius*H,y=P._TmpVector3,Z=y[0].ae(c),F=this.center.subtractToRef(Z,y[1]),S=this.center.addToRef(Z,y[2]);return this.reConstruct(F,S,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(H){if(H.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{F.n.TransformCoordinatesToRef(this.center,H,this.centerWorld);const c=P._TmpVector3[0];F.n.TransformNormalFromFloatsToRef(1,1,1,H,c),this.radiusWorld=Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))*this.radius}}isInFrustum(H){const c=this.centerWorld,y=this.radiusWorld;for(let Z=0;Z<6;Z++)if(H[Z].dotCoordinate(c)<=-y)return!1;return!0}isCenterInFrustum(H){const c=this.centerWorld;for(let y=0;y<6;y++)if(H[y].dotCoordinate(c)<0)return!1;return!0}intersectsPoint(H){const c=F.n.DistanceSquared(this.centerWorld,H);return!(this.radiusWorld*this.radiusWorld<c)}static Intersects(H,c){const y=F.n.DistanceSquared(H.centerWorld,c.centerWorld),Z=H.radiusWorld+c.radiusWorld;return!(Z*Z<y)}static CreateFromCenterAndRadius(H,c,y){this._TmpVector3[0].p(H),this._TmpVector3[1].be(0,0,c),this._TmpVector3[2].p(H),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].pi(this._TmpVector3[1]);const Z=new P(this._TmpVector3[0],this._TmpVector3[2]);return Z._worldMatrix=y||F.d.Identity(),Z}}P._TmpVector3=(0,Z.d)(3,F.n.Zero)},11762:(H,c,y)=>{"use strict";y.d(c,{b:()=>v});var Z=y(11076),F=y(11360),P=y(11094),S=y(11092),n=y(11103),O=y(11250),a=y(11146),i=y(10810),C=y(11197);const g={internalPickerForMesh:void 0};class v{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.e;this.origin=H,this.direction=c,this.length=y,this.epsilon=Z}clone(){return new v(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Z=v._TmpVector3[0].be(H.x-y,H.y-y,H.z-y),F=v._TmpVector3[1].be(c.x+y,c.y+y,c.z+y);let P,S,n,O,a=0,i=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Z.x||this.origin.x>F.x)return!1}else if(P=1/this.direction.x,S=(Z.x-this.origin.x)*P,n=(F.x-this.origin.x)*P,n===-1/0&&(n=1/0),S>n&&(O=S,S=n,n=O),a=Math.max(S,a),i=Math.min(n,i),a>i)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Z.y||this.origin.y>F.y)return!1}else if(P=1/this.direction.y,S=(Z.y-this.origin.y)*P,n=(F.y-this.origin.y)*P,n===-1/0&&(n=1/0),S>n&&(O=S,S=n,n=O),a=Math.max(S,a),i=Math.min(n,i),a>i)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Z.z||this.origin.z>F.z)return!1}else if(P=1/this.direction.z,S=(Z.z-this.origin.z)*P,n=(F.z-this.origin.z)*P,n===-1/0&&(n=1/0),S>n&&(O=S,S=n,n=O),a=Math.max(S,a),i=Math.min(n,i),a>i)return!1;return!0}intersectsBox(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(H.minimum,H.maximum,c)}intersectsSphere(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=H.center.x-this.origin.x,Z=H.center.y-this.origin.y,F=H.center.z-this.origin.z,P=y*y+Z*Z+F*F,S=H.radius+c,n=S*S;if(P<=n)return!0;const O=y*this.direction.x+Z*this.direction.y+F*this.direction.z;if(O<0)return!1;return P-O*O<=n}intersectsTriangle(H,c,y){const Z=v._TmpVector3[0],F=v._TmpVector3[1],P=v._TmpVector3[2],n=v._TmpVector3[3],a=v._TmpVector3[4];c.subtractToRef(H,Z),y.subtractToRef(H,F),S.n.CrossToRef(this.direction,F,P);const i=S.n.Dot(Z,P);if(0===i)return null;const C=1/i;this.origin.subtractToRef(H,n);const g=S.n.Dot(n,P)*C;if(g<-this.epsilon||g>1+this.epsilon)return null;S.n.CrossToRef(n,Z,a);const m=S.n.Dot(this.direction,a)*C;if(m<-this.epsilon||g+m>1+this.epsilon)return null;const z=S.n.Dot(F,a)*C;return z>this.length?null:new O.c(1-g-m,g,z)}intersectsPlane(H){let c;const y=S.n.Dot(H.k,this.direction);if(Math.abs(y)<9.99999997475243e-7)return null;{const Z=S.n.Dot(H.k,this.origin);return c=(-H.d-Z)/y,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(H){case"y":{const H=(this.origin.y-c)/this.direction.y;return H>0?null:new S.n(this.origin.x+this.direction.x*-H,c,this.origin.z+this.direction.z*-H)}case"x":{const H=(this.origin.x-c)/this.direction.x;return H>0?null:new S.n(c,this.origin.y+this.direction.y*-H,this.origin.z+this.direction.z*-H)}case"z":{const H=(this.origin.z-c)/this.direction.z;return H>0?null:new S.n(this.origin.x+this.direction.x*-H,this.origin.y+this.direction.y*-H,c)}default:return null}}intersectsMesh(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=S.h.Matrix[0];return H.getWorldMatrix().invertToRef(n),this._tmpRay?v.TransformToRef(this,n,this._tmpRay):this._tmpRay=v.Transform(this,n),H.intersects(this._tmpRay,c,y,Z,F,P)}intersectsMeshes(H,c,y){y?y.length=0:y=[];for(let Z=0;Z<H.length;Z++){const F=this.intersectsMesh(H[Z],c);F.hit&&y.push(F)}return y.sort(this._comparePickingInfo),y}_comparePickingInfo(H,c){return H.distance<c.distance?-1:H.distance>c.distance?1:0}intersectionSegment(H,c,y){const Z=this.origin,F=S.h.o[0],P=S.h.o[1],n=S.h.o[2],O=S.h.o[3];c.subtractToRef(H,F),this.direction.scaleToRef(v._Rayl,n),Z.addToRef(n,P),H.subtractToRef(Z,O);const a=S.n.Dot(F,F),i=S.n.Dot(F,n),C=S.n.Dot(n,n),g=S.n.Dot(F,O),m=S.n.Dot(n,O),z=a*C-i*i;let V,h,Q=z,D=z;z<v._Smallnum?(V=0,Q=1,h=m,D=C):(V=i*m-C*g,h=a*m-i*g,V<0?(V=0,h=m,D=C):V>Q&&(V=Q,h=m+i,D=C)),h<0?(h=0,-g<0?V=0:-g>a?V=Q:(V=-g,Q=a)):h>D&&(h=D,-g+i<0?V=0:-g+i>a?V=Q:(V=-g+i,Q=a));const f=Math.abs(V)<v._Smallnum?0:V/Q,J=Math.abs(h)<v._Smallnum?0:h/D,l=S.h.o[4];n.scaleToRef(J,l);const d=S.h.o[5];F.scaleToRef(f,d),d.addInPlace(O);const K=S.h.o[6];d.subtractToRef(l,K);return J>0&&J<=this.length&&K.lengthSquared()<y*y?d.length():-1}update(H,c,y,Z,F,P,n){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){v._RayDistant||(v._RayDistant=v.Zero()),v._RayDistant.unprojectRayToRef(H,c,y,Z,S.d.IdentityReadOnly,P,n);const O=S.h.Matrix[0];F.invertToRef(O),v.TransformToRef(v._RayDistant,O,this)}else this.unprojectRayToRef(H,c,y,Z,F,P,n);return this}static Zero(){return new v(S.n.Zero(),S.n.Zero())}static CreateNew(H,c,y,Z,F,P,S){return v.Zero().update(H,c,y,Z,F,P,S)}static CreateNewFromTo(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.d.IdentityReadOnly;const Z=new v(new S.n(0,0,0),new S.n(0,0,0));return v.CreateFromToToRef(H,c,Z,y)}static CreateFromToToRef(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.d.IdentityReadOnly;y.origin.p(H);const F=c.subtractToRef(H,y.direction),P=Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);return y.length=P,y.direction.normalize(),v.TransformToRef(y,Z,y)}static Transform(H,c){const y=new v(new S.n(0,0,0),new S.n(0,0,0));return v.TransformToRef(H,c,y),y}static TransformToRef(H,c,y){S.n.TransformCoordinatesToRef(H.origin,c,y.origin),S.n.TransformNormalToRef(H.direction,c,y.direction),y.length=H.length,y.epsilon=H.epsilon;const Z=y.direction,F=Z.length();if(0!==F&&1!==F){const H=1/F;Z.x*=H,Z.y*=H,Z.z*=H,y.length*=F}return y}unprojectRayToRef(H,c,y,Z,F,P,n){const O=S.h.Matrix[0];F.multiplyToRef(P,O),O.multiplyToRef(n,O),O.invert();const a=i.b.LastCreatedEngine,C=S.h.o[0];C.x=H/y*2-1,C.y=-(c/Z*2-1),C.z=null!==a&&void 0!==a&&a.useReverseDepthBuffer?1:null!==a&&void 0!==a&&a.isNDCHalfZRange?0:-1;const g=S.h.o[1].be(C.x,C.y,1-1e-8),v=S.h.o[2],m=S.h.o[3];S.n._UnprojectFromInvertedMatrixToRef(C,O,v),S.n._UnprojectFromInvertedMatrixToRef(g,O,m),this.origin.p(v),m.subtractToRef(v,this.direction),this.direction.normalize()}}function m(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=v.Zero();return z(H,c,y,Z,S,F,P),S}function z(H,c,y,Z,F,P){let n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const a=H.getEngine();if(!P&&!(P=H.activeCamera))return H;const i=P.viewport,C=a.getRenderHeight(),{x:g,y:v,width:m,height:z}=i.toGlobal(a.getRenderWidth(),C),V=1/a.getHardwareScalingLevel();return c=c*V-g,y=y*V-(C-v-z),F.update(c,y,m,z,Z||S.d.IdentityReadOnly,n?S.d.IdentityReadOnly:P.getViewMatrix(),P.getProjectionMatrix(),O),H}function V(H,c,y,Z,F){if(!a.d)return H;const P=H.getEngine();if(!F&&!(F=H.activeCamera))throw new Error("Active camera not set");const n=F.viewport,O=P.getRenderHeight(),{x:i,y:C,width:g,height:v}=n.toGlobal(P.getRenderWidth(),O),m=S.d.Identity(),z=1/P.getHardwareScalingLevel();return c=c*z-i,y=y*z-(O-C-v),Z.update(c,y,g,v,m,m,F.getProjectionMatrix()),H}function h(H,c,y,Z,F,P,S,n){const O=c(Z,y.enableDistantPicking),a=y.intersects(O,F,S,P,Z,n);return a&&a.hit?!F&&null!=H&&a.distance>=H.distance?null:a:null}function Q(H,c,y,Z,F,P){let n=null;const O=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),i=H.cameraToUseForPointers||H.activeCamera,C=g.internalPickerForMesh||h;for(let a=0;a<H.meshes.length;a++){const g=H.meshes[a];if(y){if(!y(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.Qb)continue;const v=O&&g.isWorldMatrixCameraDependent(),m=g.Oj(v,i);if(g.hasThinInstances&&g.thinInstanceEnablePicking){const H=C(n,c,g,m,!0,!0,P);if(H){if(F)return H;const O=S.h.Matrix[1],a=g.thinInstanceGetWorldMatrices();for(let H=0;H<a.length;H++){if(y&&!y(g,H))continue;a[H].multiplyToRef(m,O);const S=C(n,c,g,O,Z,F,P,!0);if(S&&(n=S,n.thinInstanceIndex=H,Z))return n}}}else{const H=C(n,c,g,m,Z,F,P);if(H&&(n=H,Z))return n}}return n||new a.d}function D(H,c,y,Z){if(!a.d)return null;const F=[],P=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),n=H.cameraToUseForPointers||H.activeCamera,O=g.internalPickerForMesh||h;for(let a=0;a<H.meshes.length;a++){const i=H.meshes[a];if(y){if(!y(i,-1))continue}else if(!i.isEnabled()||!i.isVisible||!i.Qb)continue;const C=P&&i.isWorldMatrixCameraDependent(),g=i.Oj(C,n);if(i.hasThinInstances&&i.thinInstanceEnablePicking){if(O(null,c,i,g,!0,!0,Z)){const H=S.h.Matrix[1],P=i.thinInstanceGetWorldMatrices();for(let S=0;S<P.length;S++){if(y&&!y(i,S))continue;P[S].multiplyToRef(g,H);const n=O(null,c,i,H,!1,!1,Z,!0);n&&(n.thinInstanceIndex=S,F.push(n))}}}else{const H=O(null,c,i,g,!1,!1,Z);H&&F.push(H)}}return F}function f(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;Z||(Z=H.getWorldMatrix()),c.length=y,F?c.origin.p(F):c.origin.p(H.position);const P=S.h.o[2];P.set(0,0,H._scene.useRightHandedSystem?-1:1);const n=S.h.o[3];return S.n.TransformNormalToRef(P,Z,n),S.n.NormalizeToRef(n,c.direction),c}var J,l;v._TmpVector3=(0,n.d)(6,S.n.Zero),v._RayDistant=v.Zero(),v._Smallnum=1e-8,v._Rayl=1e9,J=Z.d,(l=F.b)&&(l.prototype.getForwardRay=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;return f(this,new v(S.n.Zero(),S.n.Zero(),H),H,c,y)},l.prototype.getForwardRayToRef=function(H){return f(this,H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),J&&(C.c._IsPickingAvailable=!0,J.prototype.createPickingRay=function(H,c,y,Z){return m(this,H,c,y,Z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Z.d.prototype.createPickingRayToRef=function(H,c,y,Z,F){return z(this,H,c,y,Z,F,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Z.d.prototype.createPickingRayInCameraSpace=function(H,c,y){return function(H,c,y,Z){const F=v.Zero();return V(H,c,y,F,Z),F}(this,H,c,y)},Z.d.prototype.createPickingRayInCameraSpaceToRef=function(H,c,y,Z){return V(this,H,c,y,Z)},Z.d.prototype.pickWithBoundingInfo=function(H,c,y,Z,F){return function(H,c,y,Z,F,P){if(!a.d)return null;const n=Q(H,(Z=>(H._tempPickingRay||(H._tempPickingRay=v.Zero()),z(H,c,y,Z,H._tempPickingRay,P||null),H._tempPickingRay)),Z,F,!0);return n&&(n.ray=m(H,c,y,S.d.Identity(),P||null)),n}(this,H,c,y,Z,F)},Z.d.prototype.Nc=function(H,c,y,Z,F,P){return function(H,c,y,Z,F,P,n){const O=Q(H,((Z,F)=>(H._tempPickingRay||(H._tempPickingRay=v.Zero()),z(H,c,y,Z,H._tempPickingRay,P||null,!1,F),H._tempPickingRay)),Z,F,!1,n);return O&&(O.ray=m(H,c,y,S.d.Identity(),P||null)),O}(this,H,c,y,Z,F,P)},Z.d.prototype.pickWithRay=function(H,c,y,Z){return function(H,c,y,Z,F){const P=Q(H,(y=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=S.d.Identity()),y.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=v.Zero()),v.TransformToRef(c,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),y,Z,!1,F);return P&&(P.ray=c),P}(this,H,c,y,Z)},Z.d.prototype.multiPick=function(H,c,y,Z,F){return function(H,c,y,Z,F,P){return D(H,(Z=>m(H,c,y,Z,F||null)),Z,P)}(this,H,c,y,Z,F)},Z.d.prototype.multiPickWithRay=function(H,c,y){return function(H,c,y,Z){return D(H,(y=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=S.d.Identity()),y.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=v.Zero()),v.TransformToRef(c,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),y,Z)}(this,H,c,y)}},11663:(H,c,y)=>{"use strict";var Z=y(10877),F=y(10773),P=y(10819),S=y(10901),n=y(10850),O=y(10888);n.e.prototype._partialLoadFile=function(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(H,(H=>{y[c]=H,y._internalCount++,6===y._internalCount&&Z(y)}),void 0,void 0,!0,((H,c)=>{F&&H&&F(H.status+" "+H.statusText,c)}))},n.e.prototype._cascadeLoadFiles=function(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const F=[];F._internalCount=0;for(let P=0;P<6;P++)this._partialLoadFile(y[P],P,F,c,Z)},n.e.prototype._cascadeLoadImgs=function(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5?arguments[5]:void 0;const S=[];S._internalCount=0;for(let n=0;n<6;n++)this._partialLoadImg(Z[n],n,S,H,c,y,F,P)},n.e.prototype._partialLoadImg=function(H,c,y,Z,F,n){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0;const i=(0,S.e)();(0,P.q)(H,(H=>{y[c]=H,y._internalCount++,Z&&Z.removePendingData(i),6===y._internalCount&&n&&n(F,y)}),((H,c)=>{Z&&Z.removePendingData(i),O&&O(H,c)}),Z?Z.offlineProvider:null,a),Z&&Z.addPendingData(i)},n.e.prototype.createCubeTextureBase=function(H,c,y,P){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const D=m||new Z.b(this,7);D.isCube=!0,D.url=H,D.generateMipMaps=!P,D._lodGenerationScale=g,D._lodGenerationOffset=v,D._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!P),D!==m&&(D.label=H.substring(0,60)),this._doNotHandleContextLost||(D._extension=i,D._files=y,D._buffer=Q);const f=H;this._transformTextureUrl&&!m&&(H=this._transformTextureUrl(H));const J=H.split("?")[0],l=J.lastIndexOf("."),d=i||(l>-1?J.substring(l).toLowerCase():""),K=(0,O.e)(d),T=(Z,O)=>{H===f?n&&Z&&n(Z.status+" "+Z.statusText,O):(F.d.Warn(`Failed to load ${H}, falling back to the ${f}`),this.createCubeTextureBase(f,c,y,!!P,S,n,a,i,C,g,v,D,z,V,h,Q))};if(K)K.then((Z=>{const P=H=>{z&&z(D,H),Z.loadCubeData(H,D,C,S,n)};Q?P(Q):y&&6===y.length?Z.supportCascades?this._cascadeLoadFiles(c,(H=>P(H.map((H=>new Uint8Array(H))))),y,n):n?n("Textures type does not support cascades."):F.d.Warn("Texture loader does not support cascades."):this._loadFile(H,(H=>P(new Uint8Array(H))),void 0,void 0,!0,T)}));else{if(!y||0===y.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,D,((H,c)=>{V&&V(H,c)}),y,n)}return this._internalTexturesCache.push(D),D}},11594:(H,c,y)=>{"use strict";y(10850).e.prototype.createDepthStencilTexture=function(H,c,y){if(c.isCube){const y=H.width||H;return this._createDepthStencilCubeTexture(y,c)}return this._createDepthStencilTexture(H,c,y)}},11565:(H,c,y)=>{"use strict";y(11534).ThinEngine.prototype.setAlphaMode=function(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==H){switch(H){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}c||(this.depthCullingState.depthMask=0===H),this._alphaMode=H}else if(!c){const c=0===H;this.depthCullingState.depthMask!==c&&(this.depthCullingState.depthMask=c)}}},11526:(H,c,y)=>{"use strict";var Z=y(11534);Z.ThinEngine.prototype.updateDynamicIndexBuffer=function(H,c){let y;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(H),y=H.is32Bits?c instanceof Uint32Array?c:new Uint32Array(c):c instanceof Uint16Array?c:new Uint16Array(c),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,y,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},Z.ThinEngine.prototype.updateDynamicVertexBuffer=function(H,c,y,Z){this.bindArrayBuffer(H),void 0===y&&(y=0);const F=c.byteLength||c.length;void 0===Z||Z>=F&&0===y?c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,y,new Float32Array(c)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,y,c):c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(c).subarray(y,y+Z)):(c=c instanceof ArrayBuffer?new Uint8Array(c,y,Z):new Uint8Array(c.buffer,c.byteOffset+y,Z),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c)),this._resetVertexBufferBinding()}},11580:(H,c,y)=>{"use strict";var Z=y(10877),F=y(10773),P=y(11534),S=y(11585);class n extends S.b{constructor(H,c,y,Z,F){super(H,c,y,Z),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=F}_cloneRenderTargetWrapper(){let H=null;return this._colorTextureArray&&this._depthStencilTextureArray?(H=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),H.texture.isReady=!0):H=super._cloneRenderTargetWrapper(),H}_swapRenderTargetWrapper(H){super._swapRenderTargetWrapper(H),H._framebuffer=this._framebuffer,H._depthStencilBuffer=this._depthStencilBuffer,H._MSAAFramebuffer=this._MSAAFramebuffer,H._colorTextureArray=this._colorTextureArray,H._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,P=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const H=this._engine,c=H._currentFramebuffer,y=this._context;H._bindUnboundFramebuffer(this._framebuffer),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,null),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,null),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.STENCIL_ATTACHMENT,y.RENDERBUFFER,null),H._bindUnboundFramebuffer(c),y.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(H,c,y,Z,F,P)}shareDepth(H){super.shareDepth(H);const c=this._context,y=this._depthStencilBuffer,Z=H._MSAAFramebuffer||H._framebuffer,F=this._engine;H._depthStencilBuffer&&H._depthStencilBuffer!==y&&c.deleteRenderbuffer(H._depthStencilBuffer),H._depthStencilBuffer=y;const P=H._generateStencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT;F._bindUnboundFramebuffer(Z),c.framebufferRenderbuffer(c.FRAMEBUFFER,P,c.RENDERBUFFER,y),F._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!H._hardwareTexture)return;const F=this._framebuffer,P=this._engine,S=P._currentFramebuffer;if(P._bindUnboundFramebuffer(F),P.webGLVersion>1){const F=this._context,P=F["COLOR_ATTACHMENT"+c];var n;if(H.is2DArray||H.is3D)y=y??(null===(n=this.layerIndices)||void 0===n?void 0:n[c])??0,F.framebufferTextureLayer(F.FRAMEBUFFER,P,H._hardwareTexture.underlyingResource,Z,y);else if(H.isCube){var O;y=y??(null===(O=this.faceIndices)||void 0===O?void 0:O[c])??0,F.framebufferTexture2D(F.FRAMEBUFFER,P,F.TEXTURE_CUBE_MAP_POSITIVE_X+y,H._hardwareTexture.underlyingResource,Z)}else F.framebufferTexture2D(F.FRAMEBUFFER,P,F.TEXTURE_2D,H._hardwareTexture.underlyingResource,Z)}else{const F=this._context,P=F["COLOR_ATTACHMENT"+c+"_WEBGL"],S=void 0!==y?F.TEXTURE_CUBE_MAP_POSITIVE_X+y:F.TEXTURE_2D;F.framebufferTexture2D(F.FRAMEBUFFER,P,S,H._hardwareTexture.underlyingResource,Z)}P._bindUnboundFramebuffer(S)}setTexture(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(H,c,y),this._bindTextureRenderTarget(H,c)}setLayerAndFaceIndices(H,c){var y;if(super.setLayerAndFaceIndices(H,c),!this.textures||!this.layerIndices||!this.faceIndices)return;const Z=(null===(y=this._attachments)||void 0===y?void 0:y.length)??this.textures.length;for(let F=0;F<Z;F++){const H=this.textures[F];H&&(H.is2DArray||H.is3D?this._bindTextureRenderTarget(H,F,this.layerIndices[F]):H.isCube?this._bindTextureRenderTarget(H,F,this.faceIndices[F]):this._bindTextureRenderTarget(H,F))}}setLayerAndFaceIndex(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(H,c,y),!this.textures||!this.layerIndices||!this.faceIndices)return;const Z=this.textures[H];Z.is2DArray||Z.is3D?this._bindTextureRenderTarget(this.textures[H],H,this.layerIndices[H]):Z.isCube&&this._bindTextureRenderTarget(this.textures[H],H,this.faceIndices[H])}dispose(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const c=this._context;H||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(c.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(c.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(c.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(H)}}y(11594);P.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(H,c,y){const Z=new n(H,c,y,this,this._gl);return this._renderTargetWrapperCache.push(Z),Z},P.ThinEngine.prototype.createRenderTargetTexture=function(H,c){const y=this._createHardwareRenderTargetWrapper(!1,!1,H);let Z,F,P=!0,S=!1,n=!1,O=1;void 0!==c&&"object"===typeof c&&(P=c.generateDepthBuffer??!0,S=!!c.generateStencilBuffer,n=!!c.noColorAttachment,Z=c.colorAttachment,O=c.samples??1,F=c.label);const a=Z||(n?null:this._createInternalTexture(H,c,!0,5)),i=H.width||H,C=H.height||H,g=this._currentFramebuffer,v=this._gl,m=v.createFramebuffer();if(this._bindUnboundFramebuffer(m),y._depthStencilBuffer=this._setupFramebufferDepthAttachments(S,P,i,C),!a||a.is2DArray||a.is3D||v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,a._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(g),y.label=F??"RenderTargetWrapper",y._framebuffer=m,y._generateDepthBuffer=P,y._generateStencilBuffer=S,y.setTextures(a),Z){if(y._samples=Z.samples,Z.samples>1){const H=Z._hardwareTexture.getMSAARenderBuffer(0);y._MSAAFramebuffer=v.createFramebuffer(),this._bindUnboundFramebuffer(y._MSAAFramebuffer),v.framebufferRenderbuffer(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.RENDERBUFFER,H),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(y,O);return y},P.ThinEngine.prototype._createDepthStencilTexture=function(H,c,y){const P=this._gl,S=H.layers||0,n=H.depth||0;let O=P.TEXTURE_2D;0!==S?O=P.TEXTURE_2D_ARRAY:0!==n&&(O=P.TEXTURE_3D);const a=new Z.b(this,12);if(a.label=c.label,!this._caps.depthTextureExtension)return F.d.Error("Depth texture is not supported by your browser or hardware."),a;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c};if(this._bindTextureDirectly(O,a,!0),this._setupDepthStencilTexture(a,H,0!==i.comparisonFunction&&i.bilinearFiltering,i.comparisonFunction,i.samples),void 0!==i.depthTextureFormat){if(15!==i.depthTextureFormat&&16!==i.depthTextureFormat&&17!==i.depthTextureFormat&&13!==i.depthTextureFormat&&14!==i.depthTextureFormat&&18!==i.depthTextureFormat)return F.d.Error(`Depth texture ${i.depthTextureFormat} format is not supported.`),a;a.format=i.depthTextureFormat}else a.format=i.generateStencil?13:16;const C=17===a.format||13===a.format||18===a.format;let g=P.UNSIGNED_INT;15===a.format?g=P.UNSIGNED_SHORT:17===a.format||13===a.format?g=P.UNSIGNED_INT_24_8:14===a.format?g=P.FLOAT:18===a.format&&(g=P.FLOAT_32_UNSIGNED_INT_24_8_REV);const v=C?P.DEPTH_STENCIL:P.DEPTH_COMPONENT,m=this._getInternalFormatFromDepthTextureFormat(a.format,!0,C);return a.is2DArray?P.texImage3D(O,0,m,a.width,a.height,S,0,v,g,null):a.is3D?P.texImage3D(O,0,m,a.width,a.height,n,0,v,g,null):P.texImage2D(O,0,m,a.width,a.height,0,v,g,null),this._bindTextureDirectly(O,null),this._internalTexturesCache.push(a),y._depthStencilBuffer&&(P.deleteRenderbuffer(y._depthStencilBuffer),y._depthStencilBuffer=null),this._bindUnboundFramebuffer(y._MSAAFramebuffer??y._framebuffer),y._generateStencilBuffer=C,y._depthStencilTextureWithStencil=C,y._depthStencilBuffer=this._setupFramebufferDepthAttachments(y._generateStencilBuffer,y._generateDepthBuffer,y.width,y.height,y.samples,a.format),this._bindUnboundFramebuffer(null),a},P.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(H,c){var y;if(this.webGLVersion<2||!H)return 1;if(H.samples===c)return c;const Z=this._gl;c=Math.min(c,this.getCaps().maxMSAASamples),H._depthStencilBuffer&&(Z.deleteRenderbuffer(H._depthStencilBuffer),H._depthStencilBuffer=null),H._MSAAFramebuffer&&(Z.deleteFramebuffer(H._MSAAFramebuffer),H._MSAAFramebuffer=null);const F=null===(y=H.texture)||void 0===y?void 0:y._hardwareTexture;if(null===F||void 0===F||F.releaseMSAARenderBuffers(),H.texture&&c>1&&"function"===typeof Z.renderbufferStorageMultisample){const y=Z.createFramebuffer();if(!y)throw new Error("Unable to create multi sampled framebuffer");H._MSAAFramebuffer=y,this._bindUnboundFramebuffer(H._MSAAFramebuffer);const P=this._createRenderBuffer(H.texture.width,H.texture.height,c,-1,this._getRGBABufferInternalSizedFormat(H.texture.type,H.texture.format,H.texture._useSRGBBuffer),Z.COLOR_ATTACHMENT0,!1);if(!P)throw new Error("Unable to create multi sampled framebuffer");null===F||void 0===F||F.addMSAARenderBuffer(P)}this._bindUnboundFramebuffer(H._MSAAFramebuffer??H._framebuffer),H.texture&&(H.texture.samples=c),H._samples=c;const P=H._depthStencilTexture?H._depthStencilTexture.format:void 0;return H._depthStencilBuffer=this._setupFramebufferDepthAttachments(H._generateStencilBuffer,H._generateDepthBuffer,H.width,H.height,c,P),this._bindUnboundFramebuffer(null),c},P.ThinEngine.prototype._setupDepthStencilTexture=function(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const P=c.width??c,S=c.height??c,n=c.layers||0,O=c.depth||0;H.baseWidth=P,H.baseHeight=S,H.width=P,H.height=S,H.is2DArray=n>0,H.depth=n||O,H.isReady=!0,H.samples=F,H.generateMipMaps=!1,H.samplingMode=y?2:1,H.type=0,H._comparisonFunction=Z;const a=this._gl,i=this._getTextureTarget(H),C=this._getSamplingParameters(H.samplingMode,!1);a.texParameteri(i,a.TEXTURE_MAG_FILTER,C.mag),a.texParameteri(i,a.TEXTURE_MIN_FILTER,C.min),a.texParameteri(i,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(i,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===Z?(a.texParameteri(i,a.TEXTURE_COMPARE_FUNC,515),a.texParameteri(i,a.TEXTURE_COMPARE_MODE,a.NONE)):(a.texParameteri(i,a.TEXTURE_COMPARE_FUNC,Z),a.texParameteri(i,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE)))}},10836:(H,c,y)=>{"use strict";y.d(c,{b:()=>K,c:()=>l,e:()=>d,f:()=>t,g:()=>o});class Z{constructor(){this.children=[]}isValid(H){return!0}process(H,c){let y="";if(this.line){let a=this.line;const i=c.processor;if(i){var Z,F,P,S,n,O;i.lineProcessor&&(a=i.lineProcessor(a,c.isFragment,c.processingContext));const y=(null===(Z=c.processor)||void 0===Z?void 0:Z.attributeKeywordName)??"attribute",C=c.isFragment&&null!==(F=c.processor)&&void 0!==F&&F.varyingFragmentKeywordName?null===(P=c.processor)||void 0===P?void 0:P.varyingFragmentKeywordName:!c.isFragment&&null!==(S=c.processor)&&void 0!==S&&S.varyingVertexKeywordName?null===(n=c.processor)||void 0===n?void 0:n.varyingVertexKeywordName:"varying";if(!c.isFragment&&i.attributeProcessor&&this.line.startsWith(y))a=i.attributeProcessor(this.line,H,c.processingContext);else if(i.varyingProcessor&&(null!==(O=i.varyingCheck)&&void 0!==O&&O.call(i,this.line,c.isFragment)||!i.varyingCheck&&this.line.startsWith(C)))a=i.varyingProcessor(this.line,c.isFragment,H,c.processingContext);else if(i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(a=i.uniformProcessor(this.line,c.isFragment,H,c.processingContext));else if(i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(a=i.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line))a=i.textureProcessor(this.line,c.isFragment,H,c.processingContext);else if((i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(a=i.uniformProcessor(this.line,c.isFragment,H,c.processingContext)):i.uniformBufferProcessor&&(a=i.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(a=i.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}y+=a+"\n"}return this.children.forEach((Z=>{y+=Z.process(H,c)})),this.additionalDefineKey&&(H[this.additionalDefineKey]=this.additionalDefineValue||"true"),y}}class F{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(H){this._lines.length=0;for(const c of H){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const H=c.trim();if(!H)continue;if(H.startsWith("//")){this._lines.push(c);continue}const y=H.indexOf(";");if(-1===y)this._lines.push(H);else if(y===H.length-1)H.length>1&&this._lines.push(H);else{const H=c.split(";");for(let c=0;c<H.length;c++){let y=H[c];y&&(y=y.trim(),y&&this._lines.push(y+(c!==H.length-1?";":"")))}}}}}class P extends Z{process(H,c){for(let y=0;y<this.children.length;y++){const Z=this.children[y];if(Z.isValid(H))return Z.process(H,c)}return""}}class S extends Z{isValid(H){return this.testExpression.isTrue(H)}}class n{isTrue(H){return!0}static postfixToInfix(H){const c=[];for(const y of H)if(void 0===n._OperatorPriority[y])c.push(y);else{const H=c[c.length-1],Z=c[c.length-2];c.length-=2,c.push(`(${Z}${y}${H})`)}return c[c.length-1]}static infixToPostfix(H){const c=n._InfixToPostfixCache.get(H);if(c)return c.accessTime=Date.now(),c.result;if(!H.includes("&&")&&!H.includes("||")&&!H.includes(")")&&!H.includes("("))return[H];const y=[];let Z=-1;const F=()=>{i=i.trim(),""!==i&&(y.push(i),i="")},P=H=>{Z<n._Stack.length-1&&(n._Stack[++Z]=H)},S=()=>n._Stack[Z],O=()=>-1===Z?"!!INVALID EXPRESSION!!":n._Stack[Z--];let a=0,i="";for(;a<H.length;){const c=H.charAt(a),C=a<H.length-1?H.substring(a,2+a):"";if("("===c)i="",P(c);else if(")"===c){for(F();-1!==Z&&"("!==S();)y.push(O());O()}else if(n._OperatorPriority[C]>1){for(F();-1!==Z&&n._OperatorPriority[S()]>=n._OperatorPriority[C];)y.push(O());P(C),a++}else i+=c;a++}for(F();-1!==Z;)"("===S()?O():y.push(O());return n._InfixToPostfixCache.size>=n.InfixToPostfixCacheLimitSize&&n.ClearCache(),n._InfixToPostfixCache.set(H,{result:y,accessTime:Date.now()}),y}static ClearCache(){const H=Array.from(n._InfixToPostfixCache.entries()).sort(((H,c)=>H[1].accessTime-c[1].accessTime));for(let c=0;c<n.InfixToPostfixCacheCleanupSize;c++)n._InfixToPostfixCache.delete(H[c][0])}}n.InfixToPostfixCacheLimitSize=5e4,n.InfixToPostfixCacheCleanupSize=25e3,n._InfixToPostfixCache=new Map,n._OperatorPriority={")":0,"(":1,"||":2,"&&":3},n._Stack=["","","","","","","","","","","","","","","","","","","",""];class O extends n{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=H,this.not=c}isTrue(H){let c=void 0!==H[this.define];return this.not&&(c=!c),c}}class a extends n{isTrue(H){return this.leftOperand.isTrue(H)||this.rightOperand.isTrue(H)}}class i extends n{isTrue(H){return this.leftOperand.isTrue(H)&&this.rightOperand.isTrue(H)}}class C extends n{constructor(H,c,y){super(),this.define=H,this.operand=c,this.testValue=y}isTrue(H){let c=H[this.define];void 0===c&&(c=this.define);let y=!1;const Z=parseInt(c),F=parseInt(this.testValue);switch(this.operand){case">":y=Z>F;break;case"<":y=Z<F;break;case"<=":y=Z<=F;break;case">=":y=Z>=F;break;case"==":y=Z===F;break;case"!=":y=Z!==F}return y}}var g=y(10798),v=y(10840);const m=/defined\s*?\((.+?)\)/g,z=/defined\s*?\[(.+?)\]/g,V=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,h=/__decl__/,Q=/light\{X\}.(\w*)/g,D=/\{X\}/g,f=[],J=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function l(H){H.processor&&H.processor.initializeShaders&&H.processor.initializeShaders(H.processingContext)}function d(H,c,y,Z){var F;null!==(F=c.processor)&&void 0!==F&&F.preProcessShaderCode&&(H=c.processor.preProcessShaderCode(H,c.isFragment)),t(H,c,(H=>{c.processCodeAfterIncludes&&(H=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",H,c.defines));const F=function(H,c,y){let Z=function(H,c){var y;if(null!==(y=c.processor)&&void 0!==y&&y.noPrecision)return H;const Z=c.shouldUseHighPrecisionShader;-1===H.indexOf("precision highp float")?H=Z?"precision highp float;\n"+H:"precision mediump float;\n"+H:Z||(H=H.replace("precision highp float","precision mediump float"));return H}(H,c);if(!c.processor)return Z;if(0===c.processor.shaderLanguage&&-1!==Z.indexOf("#version 3")&&(Z=Z.replace("#version 300 es",""),!c.processor.parseGLES3))return Z;const F=c.defines,P=p(c,y);c.processor.preProcessor&&(Z=c.processor.preProcessor(Z,F,P,c.isFragment,c.processingContext));Z=G(Z,P,c),c.processor.postProcessor&&(Z=c.processor.postProcessor(Z,F,c.isFragment,c.processingContext,y?{drawBuffersExtensionDisabled:!y.getCaps().drawBuffersExtension}:{}));null!==y&&void 0!==y&&y._features.needShaderCodeInlining&&(Z=y.inlineShaderCode(Z));return Z}(H,c,Z);y(F,H)}))}function K(H,c,y){return y.processor&&y.processor.finalizeShaders?y.processor.finalizeShaders(H,c,y.processingContext):{vertexCode:H,fragmentCode:c}}function T(H){const c=/defined\((.+)\)/.exec(H);if(c&&c.length)return new O(c[1].trim(),"!"===H[0]);const y=["==","!=",">=","<=","<",">"];let Z="",F=0;for(Z of y)if(F=H.indexOf(Z),F>-1)break;if(-1===F)return new O(H);const P=H.substring(0,F).trim(),S=H.substring(F+Z.length).trim();return new C(P,Z,S)}function u(H,c){const y=new S,Z=H.substring(0,c);let F=H.substring(c);return F=F.substring(0,(F.indexOf("//")+1||F.length+1)-1).trim(),y.testExpression="#ifdef"===Z?new O(F):"#ifndef"===Z?new O(F,!0):function(H){H=H.replace(m,"defined[$1]");const c=n.infixToPostfix(H),y=[];for(const F of c)if("||"!==F&&"&&"!==F)y.push(F);else if(y.length>=2){let H=y[y.length-1],c=y[y.length-2];y.length-=2;const Z="&&"==F?new i:new a;"string"===typeof H&&(H=H.replace(z,"defined($1)")),"string"===typeof c&&(c=c.replace(z,"defined($1)")),Z.leftOperand="string"===typeof c?T(c):c,Z.rightOperand="string"===typeof H?T(H):H,y.push(Z)}let Z=y[y.length-1];return"string"===typeof Z&&(Z=Z.replace(z,"defined($1)")),"string"===typeof Z?T(Z):Z}(F),y}function E(H,c,y){let F=H.currentLine;for(;U(H,y);){F=H.currentLine;const P=F.substring(0,5).toLowerCase();if("#else"===P){const y=new Z;return c.children.push(y),void U(H,y)}if("#elif"===P){const H=u(F,5);c.children.push(H),y=H}}}function U(H,c){for(;H.canRead;){H.lineIndex++;const y=H.currentLine;if(y.indexOf("#")>=0){const Z=J.exec(y);if(Z&&Z.length){switch(Z[0]){case"#ifdef":{const Z=new P;c.children.push(Z);const F=u(y,6);Z.children.push(F),E(H,Z,F);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Z=new P;c.children.push(Z);const F=u(y,7);Z.children.push(F),E(H,Z,F);break}case"#if":{const Z=new P,F=u(y,3);c.children.push(Z),Z.children.push(F),E(H,Z,F);break}}continue}}const F=new Z;if(F.line=y,c.children.push(F),"#"===y[0]&&"d"===y[1]){const H=y.replace(";","").split(" ");F.additionalDefineKey=H[1],3===H.length&&(F.additionalDefineValue=H[2])}}return!1}function G(H,c,y){const P=new Z,S=new F;return S.lineIndex=-1,S.lines=H.split("\n"),U(S,P),P.process(c,y)}function p(H,c){var y;const Z=H.defines,F={};for(const P of Z){const H=P.replace("#define","").replace(";","").trim().split(" ");F[H[0]]=H.length>1?H[1]:""}return 0===(null===(y=H.processor)||void 0===y?void 0:y.shaderLanguage)&&(F.GL_ES="true"),F.__VERSION__=H.version,F[H.platformName]="true",(0,v.j)(F,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.useReverseDepthBuffer,null===c||void 0===c?void 0:c.useExactSrgbConversions),F}function t(H,c,y){let Z;for(f.length=0;null!==(Z=V.exec(H));)f.push(Z);let F=String(H),P=[H],S=!1;for(const n of f){let H=n[1];if(-1!==H.indexOf("__decl__")&&(H=H.replace(h,""),c.supportsUniformBuffers&&(H=H.replace("Vertex","Ubo").replace("Fragment","Ubo")),H+="Declaration"),!c.includesShadersStore[H]){const Z=c.shadersRepository+"ShadersInclude/"+H+".fx";return void o.loadFile(Z,(Z=>{c.includesShadersStore[H]=Z,t(P.join(""),c,y)}))}{let y=c.includesShadersStore[H];if(n[2]){const H=n[3].split(",");for(let c=0;c<H.length;c+=2){const Z=new RegExp(H[c],"g"),F=H[c+1];y=y.replace(Z,F)}}if(n[4]){const H=n[5];if(-1!==H.indexOf("..")){const Z=H.split(".."),F=parseInt(Z[0]);let P=parseInt(Z[1]),S=y.slice(0);y="",isNaN(P)&&(P=c.indexParameters[Z[1]]);for(let H=F;H<P;H++)c.supportsUniformBuffers||(S=S.replace(Q,((H,c)=>c+"{X}"))),y+=S.replace(D,H.toString())+"\n"}else c.supportsUniformBuffers||(y=y.replace(Q,((H,c)=>c+"{X}"))),y=y.replace(D,H)}const Z=[];for(const H of P){const c=H.split(n[0]);for(let H=0;H<c.length-1;H++)Z.push(c[H]),Z.push(y);Z.push(c[c.length-1])}P=Z,S=S||y.indexOf("#include<")>=0||y.indexOf("#include <")>=0}}f.length=0,F=P.join(""),S?t(F.toString(),c,y):y(F)}const o={loadFile:(H,c,y,Z,F,P)=>{throw(0,g.b)("FileTools")}}},11552:(H,c,y)=>{"use strict";y.d(c,{e:()=>Z});class Z{get underlyingResource(){return this._webGLTexture}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=c,!H&&(H=c.createTexture(),!H))throw new Error("Unable to create webGL texture");this.set(H)}setUsage(){}set(H){this._webGLTexture=H}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(H){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(H)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const H of this._MSAARenderBuffers)this._context.deleteRenderbuffer(H);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._MSAARenderBuffers)||void 0===H?void 0:H[c])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10840:(H,c,y)=>{"use strict";y.d(c,{c:()=>F,g:()=>P,j:()=>n,k:()=>S,m:()=>O});var Z=y(10798);y(10768);const F={};function P(H,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+H}function S(H,c,y,P,S,n,O){const a=O||F.loadFile;if(a){return a(H,c,y,P,S,n)}throw(0,Z.b)("FileTools")}function n(H,c,y,Z){if(H)return c?H.IS_NDC_HALF_ZRANGE="":delete H.IS_NDC_HALF_ZRANGE,y?H.USE_REVERSE_DEPTHBUFFER="":delete H.USE_REVERSE_DEPTHBUFFER,void(Z?H.USE_EXACT_SRGB_CONVERSIONS="":delete H.USE_EXACT_SRGB_CONVERSIONS);{let H="";return c&&(H+="#define IS_NDC_HALF_ZRANGE"),y&&(H&&(H+="\n"),H+="#define USE_REVERSE_DEPTHBUFFER"),Z&&(H&&(H+="\n"),H+="#define USE_EXACT_SRGB_CONVERSIONS"),H}}function O(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;switch(H){case 3:{const H=(ArrayBuffer,new Int8Array(c));return Z&&H.set(new Int8Array(Z)),H}case 0:{const H=(ArrayBuffer,new Uint8Array(c));return Z&&H.set(new Uint8Array(Z)),H}case 4:{const H=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(y?c/2:c);return Z&&H.set(new Int16Array(Z)),H}case 5:case 8:case 9:case 10:case 2:{const H=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(y?c/2:c);return Z&&H.set(new Uint16Array(Z)),H}case 6:{const H=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(y?c/4:c);return Z&&H.set(new Int32Array(Z)),H}case 7:case 11:case 12:case 13:case 14:case 15:{const H=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(y?c/4:c);return Z&&H.set(new Uint32Array(Z)),H}case 1:{const H=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(y?c/4:c);return Z&&H.set(new Float32Array(Z)),H}}const F=(ArrayBuffer,new Uint8Array(c));return Z&&F.set(new Uint8Array(Z)),F}},10850:(H,c,y)=>{"use strict";y.d(c,{e:()=>D});var Z=y(10810),F=y(10773),P=y(10853),S=y(10872),n=y(10790);class O{constructor(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,H&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(H){this._zOffset!==H&&(this._zOffset=H,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(H){this._zOffsetUnits!==H&&(this._zOffsetUnits=H,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(H){this._cullFace!==H&&(this._cullFace=H,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(H){this._cull!==H&&(this._cull=H,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(H){this._depthFunc!==H&&(this._depthFunc=H,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(H){this._depthMask!==H&&(this._depthMask=H,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(H){this._depthTest!==H&&(this._depthTest=H,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(H){this._frontFace!==H&&(this._frontFace=H,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(H){this.isDirty&&(this._isCullDirty&&(this.cull?H.enable(H.CULL_FACE):H.disable(H.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(H.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(H.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?H.enable(H.DEPTH_TEST):H.disable(H.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(H.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(H.enable(H.POLYGON_OFFSET_FILL),H.polygonOffset(this.zOffset,this.zOffsetUnits)):H.disable(H.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(H.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class a{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(H){this._func!==H&&(this._func=H,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(H){this._funcRef!==H&&(this._funcRef=H,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(H){this._funcMask!==H&&(this._funcMask=H,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(H){this._opStencilFail!==H&&(this._opStencilFail=H,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(H){this._opDepthFail!==H&&(this._opDepthFail=H,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(H){this._opStencilDepthPass!==H&&(this._opStencilDepthPass=H,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(H){this._mask!==H&&(this._mask=H,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(H){this._enabled!==H&&(this._enabled=H,this._isStencilTestDirty=!0)}constructor(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,H&&this.reset()}reset(){var H;this.stencilMaterial=void 0,null===(H=this.stencilGlobal)||void 0===H||H.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(H){var c;if(!H)return;const y=!this.useStencilGlobalOnly&&!(null===(c=this.stencilMaterial)||void 0===c||!c.enabled);this.enabled=y?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=y?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=y?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=y?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=y?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=y?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=y?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=y?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?H.enable(H.STENCIL_TEST):H.disable(H.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(H.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(H.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(H.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class i{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=i.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=i.KEEP,this.opDepthFail=i.KEEP,this.opStencilDepthPass=i.REPLACE}get stencilFunc(){return this.func}set stencilFunc(H){this.func=H}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(H){this.funcRef=H}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(H){this.funcMask=H}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(H){this.opStencilFail=H}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(H){this.opDepthFail=H}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(H){this.opStencilDepthPass=H}get stencilMask(){return this.mask}set stencilMask(H){this.mask=H}get stencilTest(){return this.enabled}set stencilTest(H){this.enabled=H}}i.ALWAYS=519,i.KEEP=7680,i.REPLACE=7681;class C{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(H){this._alphaBlend!==H&&(this._alphaBlend=H,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(H,c,y,Z){this._blendConstants[0]===H&&this._blendConstants[1]===c&&this._blendConstants[2]===y&&this._blendConstants[3]===Z||(this._blendConstants[0]=H,this._blendConstants[1]=c,this._blendConstants[2]=y,this._blendConstants[3]=Z,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(H,c,y,Z){this._blendFunctionParameters[0]===H&&this._blendFunctionParameters[1]===c&&this._blendFunctionParameters[2]===y&&this._blendFunctionParameters[3]===Z||(this._blendFunctionParameters[0]=H,this._blendFunctionParameters[1]=c,this._blendFunctionParameters[2]=y,this._blendFunctionParameters[3]=Z,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(H,c){this._blendEquationParameters[0]===H&&this._blendEquationParameters[1]===c||(this._blendEquationParameters[0]=H,this._blendEquationParameters[1]=c,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(H){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?H.enable(H.BLEND):H.disable(H.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(H.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(H.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(H.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var g=y(10798),v=y(10877),m=y(10768),z=y(10763),V=y(10840),h=y(10888);function Q(H,c){if((0,m.h)()){const{requestAnimationFrame:y}=c||window;if("function"===typeof y)return y(H)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(H);return setTimeout(H,16)}class D{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(H){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(H){H!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=H,this._depthCullingState.depthFunc=H?518:515)}setColorWrite(H){H!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=H)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(H){if(H)return this.isNDCHalfZRange?H.IS_NDC_HALF_ZRANGE="":delete H.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?H.USE_REVERSE_DEPTHBUFFER="":delete H.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?H.USE_EXACT_SRGB_CONVERSIONS="":delete H.USE_EXACT_SRGB_CONVERSIONS);{let H="";return this.isNDCHalfZRange&&(H+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(H&&(H+="\n"),H+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(H&&(H+="\n"),H+="#define USE_EXACT_SRGB_CONVERSIONS"),H}}_rebuildInternalTextures(){const H=this._internalTexturesCache.slice();for(const c of H)c._rebuild()}_rebuildRenderTargetWrappers(){const H=this._renderTargetWrapperCache.slice();for(const c of H)c._rebuild()}_rebuildEffects(){for(const H in this._compiledEffects){const c=this._compiledEffects[H];c._pipelineContext=null,c._prepareEffect()}P.d.ResetCache()}_rebuildGraphicsResources(){var H;this.wipeCaches(!0),this._rebuildEffects(),null===(H=this._rebuildComputeEffects)||void 0===H||H.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){F.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(H){setTimeout((async()=>{this._clearEmptyResources();const c=this._depthCullingState.depthTest,y=this._depthCullingState.depthFunc,Z=this._depthCullingState.depthMask,F=this._stencilState.stencilTest;await H(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=c,this._depthCullingState.depthFunc=y,this._depthCullingState.depthMask=Z,this._stencilState.stencilTest=F,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(H){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(H){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const H=new Uint8Array(4),c=[H,H,H,H,H,H];this._emptyCubeTexture=this.createRawCubeTexture(c,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(H){if(!H)return this._activeRenderLoops.length=0,void this._cancelFrame();const c=this._activeRenderLoops.indexOf(H);c>=0&&(this._activeRenderLoops.splice(c,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const H=this._frameHandler;if(this._frameHandler=0,(0,m.h)()){const{cancelAnimationFrame:c}=this.getHostWindow()||window;if("function"===typeof c)return c(H)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(H);return clearTimeout(H)}}ej(){this.onBeginFrameObservable.notifyObservers(this)}fj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let H=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(H=!1),H&&(this.ej(),this._renderViews()||this._renderFrame(),this.fj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let H=0;H<this._activeRenderLoops.length;H++){(0,this._activeRenderLoops[H])()}}_renderViews(){return!1}_queueNewFrame(H,c){return Q(H,c)}runRenderLoop(H){-1===this._activeRenderLoops.indexOf(H)&&(this._activeRenderLoops.push(H),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(H){this._depthCullingState.depthTest=H}setZOffset(H){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-H:H}getZOffset(){const H=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-H:H}setZOffsetUnits(H){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-H:H}getZOffsetUnits(){const H=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-H:H}getHostWindow(){return(0,m.h)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(H){this._compatibilityMode=!0}_rebuildTextures(){for(const H of this.scenes)H._rebuildTextures();for(const H of this._virtualScenes)H._rebuildTextures()}_releaseRenderTargetWrapper(H){const c=this._renderTargetWrapperCache.indexOf(H);-1!==c&&this._renderTargetWrapperCache.splice(c,1)}get currentViewport(){return this._cachedViewport}setViewport(H,c,y){const Z=c||this.getRenderWidth(),F=y||this.getRenderHeight(),P=H.x||0,S=H.y||0;this._cachedViewport=H,this._viewport(P*Z,S*F,Z*H.width,F*H.height)}createCanvasImage(){return document.createElement("img")}get description(){let H=this.name+this.version;return this._caps.parallelShaderCompile&&(H+=" - Parallel shader compilation"),H}_createTextureBase(H,c,y,P){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,i=arguments.length>8?arguments[8]:void 0,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0,f=arguments.length>15?arguments[15]:void 0;const J="data:"===(H=H||"").substr(0,5),l="blob:"===H.substr(0,5),d=J&&-1!==H.indexOf(";base64,"),K=g||new v.b(this,1);K!==g&&(K.label=H.substring(0,60));const T=H;!this._transformTextureUrl||d||g||C||(H=this._transformTextureUrl(H)),T!==H&&(K._originalUrl=T);const u=H.lastIndexOf(".");let E=z||(u>-1?H.substring(u).toLowerCase():"");E.indexOf("?")>-1&&(E=E.split("?")[0]);const U=(0,h.e)(E,V);P&&P.addPendingData(K),K.url=H,K.generateMipMaps=!c,K.samplingMode=S,K.invertY=y,K._useSRGBBuffer=this._getUseSRGBBuffer(!!f,c),this._doNotHandleContextLost||(K._buffer=C);let G=null;n&&!g&&(G=K.onLoadedObservable.add(n)),g||this._internalTexturesCache.push(K);const p=(y,g)=>{P&&P.removePendingData(K),H===T?(G&&K.onLoadedObservable.remove(G),Z.b.UseFallbackTexture&&H!==Z.b.FallbackTexture&&this._createTextureBase(Z.b.FallbackTexture,c,K.invertY,P,S,null,O,a,i,C,K),y=(y||"Unknown error")+(Z.b.UseFallbackTexture?" - Fallback texture was used":""),K.onErrorObservable.notifyObservers({message:y,exception:g}),O&&O(y,g)):(F.d.Warn(`Failed to load ${H}, falling back to ${T}`),this._createTextureBase(T,c,K.invertY,P,S,n,O,a,i,C,K,m,z,V,Q,f))};if(U){const c=async H=>{(await U).loadData(H,K,((H,c,y,Z,F,n)=>{n?p("TextureLoader failed to load data"):a(K,E,P,{width:H,height:c},K.invertY,!y,Z,(()=>(F(),!1)),S)}),Q)};C?C instanceof ArrayBuffer?c(new Uint8Array(C)):ArrayBuffer.isView(C)?c(C):O&&O("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(H,(H=>c(new Uint8Array(H))),void 0,P?P.offlineProvider:void 0,!0,((H,c)=>{p("Unable to load "+(H&&H.responseURL,c))}))}else{const y=H=>{l&&!this._doNotHandleContextLost&&(K._buffer=H),a(K,E,P,H,K.invertY,c,!1,i,S)};!J||d?C&&("string"===typeof C.decoding||C.close)?y(C):D._FileToolsLoadImage(H||"",y,p,P?P.offlineProvider:null,V,K.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof C||C instanceof ArrayBuffer||ArrayBuffer.isView(C)||C instanceof Blob?D._FileToolsLoadImage(C,y,p,P?P.offlineProvider:null,V,K.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):C&&y(C)}return K}_rebuildBuffers(){for(const H of this._uniformBuffers)H._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,m.e)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const H in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,H)&&(this._boundTexturesCache[H]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(H){this._name=H}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(H){this._hardwareScalingLevel=H,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(H){this._doNotHandleContextLost=H}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(H,c,y){var F,P;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new O,this._stencilStateComposer=new a,this._stencilState=new i,this._alphaState=new C,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new z.e,this.onCanvasFocusObservable=new z.e,this.onNewSceneAddedObservable=new z.e,this.onResizeObservable=new z.e,this.onCanvasPointerOutObservable=new z.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new z.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new z.e,this.onAfterShaderCompilationObservable=new z.e,this.onBeginFrameObservable=new z.e,this.onEndFrameObservable=new z.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new z.e,this.onContextRestoredObservable=new z.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.jj=new z.e,Z.b.Instances.push(this),this.startTime=n.b.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,S.c.SetMatrixPrecision(!!c.useHighPrecisionMatrix),(0,m.f)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=y??!1,c.antialias=H??c.antialias,c.deterministicLockstep=c.deterministicLockstep??!1,c.lockstepMaxSteps=c.lockstepMaxSteps??4,c.timeStep=c.timeStep??1/60,c.audioEngine=c.audioEngine??!0,c.stencil=c.stencil??!0,this._audioContext=(null===(F=c.audioEngineOptions)||void 0===F?void 0:F.audioContext)??null,this._audioDestination=(null===(P=c.audioEngineOptions)||void 0===P?void 0:P.audioDestination)??null,this.premultipliedAlpha=c.premultipliedAlpha??!0,this._doNotHandleContextLost=!!c.doNotHandleContextLost,this._isStencilEnable=!!c.stencil,this.useExactSrgbConversions=c.useExactSrgbConversions??!1;const g=(0,m.h)()&&window.devicePixelRatio||1,v=c.limitDeviceRatio||g;y=y||c.adaptToDeviceRatio||!1,this._hardwareScalingLevel=y?1/Math.min(v,g):1,this._lastDevicePixelRatio=g,this._creationOptions=c}resize(){let H,c,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const H=(0,m.h)()&&window.devicePixelRatio||1,c=this._lastDevicePixelRatio/H;this._lastDevicePixelRatio=H,this._hardwareScalingLevel*=c}if((0,m.h)()&&(0,m.e)())if(this._renderingCanvas){const y=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};H=this._renderingCanvas.clientWidth||y.width||this._renderingCanvas.width||100,c=this._renderingCanvas.clientHeight||y.height||this._renderingCanvas.height||100}else H=window.innerWidth,c=window.innerHeight;else H=this._renderingCanvas?this._renderingCanvas.width:100,c=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(H/this._hardwareScalingLevel,c/this._hardwareScalingLevel,y)}setSize(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(H|=0,c|=0,!y&&this._renderingCanvas.width===H&&this._renderingCanvas.height===c)return!1;if(this._renderingCanvas.width=H,this._renderingCanvas.height=c,this.scenes){for(let H=0;H<this.scenes.length;H++){const c=this.scenes[H];for(let H=0;H<c.cameras.length;H++){c.cameras[H]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(H,c,y,Z,F,P,S,n,O,a,i){throw(0,g.b)("engine.rawTexture")}createRawCubeTexture(H,c,y,Z,F,P,S,n){throw(0,g.b)("engine.rawTexture")}createRawTexture3D(H,c,y,Z,F,P,S,n,O,a,i){throw(0,g.b)("engine.rawTexture")}createRawTexture2DArray(H,c,y,Z,F,P,S,n,O,a,i){throw(0,g.b)("engine.rawTexture")}_sharedInit(H){this._renderingCanvas=H}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const H=navigator.userAgent;this.hostInformation.isMobile=-1!==H.indexOf("Mobile")||-1!==H.indexOf("Mac")&&(0,m.e)()&&"ontouchend"in document},this._checkForMobile(),(0,m.h)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(H){return document.createElement("video")}_reportDrawCall(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(H=this._drawCalls)||void 0===H||H.addCount(c,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(H,c){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(H,c){return createImageBitmap(H,c)}resizeImageBitmap(H,c,y){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(H){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(H,c){if("undefined"===typeof document)return new OffscreenCanvas(H,c);const y=document.createElement("canvas");return y.width=H,y.height=c,y}createCanvas(H,c){return D._CreateCanvas(H,c)}static _FileToolsLoadImage(H,c,y,Z,F,P){throw(0,g.b)("FileTools")}_loadFile(H,c,y,Z,F,P){const S=(0,V.k)(H,c,y,Z,F,P);return this._activeRequests.push(S),S.onCompleteObservable.add((()=>{const H=this._activeRequests.indexOf(S);-1!==H&&this._activeRequests.splice(H,1)})),S}static _FileToolsLoadFile(H,c,y,Z,F,P){if(V.c.loadFile)return V.c.loadFile(H,c,y,Z,F,P);throw(0,g.b)("FileTools")}dispose(){var H;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(H=this.releaseComputeEffects)||void 0===H||H.call(this),P.d.ResetCache();for(const y of this._activeRequests)y.abort();this._boundRenderFunction=null,this.jj.notifyObservers(this),this.jj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,m.h)()&&window.removeEventListener("resize",this._checkForMobile);const c=Z.b.Instances.indexOf(this);c>=0&&Z.b.Instances.splice(c,1),Z.b.Instances.length||(Z.b.OnEnginesDisposedObservable.notifyObservers(this),Z.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(H){throw(0,g.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(H,c){for(let y=0;y<Z.b.Instances.length;y++){const F=Z.b.Instances[y];for(let y=0;y<F.scenes.length;y++)F.scenes[y].markAllMaterialsAsDirty(H,c)}}}D._RenderPassIdCounter=0,D._RescalePostProcessFactory=null,D.CollisionsEpsilon=.001,D.QueueNewFrame=Q},11573:(H,c,y)=>{"use strict";y.d(c,{c:()=>K});var Z=y(10877),F=y(10810),P=y(11534),S=y(10790);class n{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new O(H)}sampleFrame(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.b.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const c=H-this._lastFrameTimeMs;this._rollingFrameTime.add(c)}this._lastFrameTimeMs=H}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const H=this._rollingFrameTime.history(0);return 0===H?0:1e3/H}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class O{constructor(H){this._samples=new Array(H),this.reset()}add(H){let c;if(this.isSaturated()){const H=this._samples[this._pos];c=H-this.average,this.average-=c/(this._sampleCount-1),this._m2-=c*(H-this.average)}else this._sampleCount++;c=H-this.average,this.average+=c/this._sampleCount,this._m2+=c*(H-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=H,this._pos++,this._pos%=this._samples.length}history(H){if(H>=this._sampleCount||H>=this._samples.length)return 0;const c=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(c-H)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(H){const c=this._samples.length;return(H%c+c)%c}}var a=y(11547),i=y(10773),C=y(11552),g=(y(11565),y(10908));function v(H,c,y,Z){let F,P=1;1===Z?F=new Float32Array(c*y*4):2===Z?(F=new Uint16Array(c*y*4),P=15360):F=7===Z?new Uint32Array(c*y*4):new Uint8Array(c*y*4);for(let S=0;S<c;S++)for(let Z=0;Z<y;Z++){const y=3*(Z*c+S),n=4*(Z*c+S);F[n+0]=H[y+0],F[n+1]=H[y+1],F[n+2]=H[y+2],F[n+3]=P}return F}function m(H){return function(c,y,F,P,S,n,O,a){let i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const g=H?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,v=H?10:11,m=new Z.b(this,v);m.baseWidth=y,m.baseHeight=F,m.baseDepth=P,m.width=y,m.height=F,m.depth=P,m.format=S,m.type=C,m.generateMipMaps=n,m.samplingMode=a,H?m.is3D=!0:m.is2DArray=!0,this._doNotHandleContextLost||(m._bufferView=c),H?this.updateRawTexture3D(m,c,S,O,i,C):this.updateRawTexture2DArray(m,c,S,O,i,C),this._bindTextureDirectly(g,m,!0);const z=this._getSamplingParameters(a,n);return this._gl.texParameteri(g,this._gl.TEXTURE_MAG_FILTER,z.mag),this._gl.texParameteri(g,this._gl.TEXTURE_MIN_FILTER,z.min),n&&this._gl.generateMipmap(g),this._bindTextureDirectly(g,null),this._internalTexturesCache.push(m),m}}function z(H){return function(c,y,Z,F){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const n=H?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,O=this._getWebGLTextureType(S),a=this._getInternalFormat(Z),i=this._getRGBABufferInternalSizedFormat(S,Z);this._bindTextureDirectly(n,c,!0),this._unpackFlipY(void 0===F||!!F),this._doNotHandleContextLost||(c._bufferView=y,c.format=Z,c.invertY=F,c._compression=P),c.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),P&&y?this._gl.compressedTexImage3D(n,0,this.getCaps().s3tc[P],c.width,c.height,c.depth,0,y):this._gl.texImage3D(n,0,i,c.width,c.height,c.depth,0,a,O,y),c.generateMipMaps&&this._gl.generateMipmap(n),this._bindTextureDirectly(n,null),c.isReady=!0}}P.ThinEngine.prototype.updateRawTexture=function(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!H)return;const n=this._getRGBABufferInternalSizedFormat(P,y,S),O=this._getInternalFormat(y),a=this._getWebGLTextureType(P);this._bindTextureDirectly(this._gl.TEXTURE_2D,H,!0),this._unpackFlipY(void 0===Z||!!Z),this._doNotHandleContextLost||(H._bufferView=c,H.format=y,H.type=P,H.invertY=Z,H._compression=F),H.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),F&&c?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[F],H.width,H.height,0,c):this._gl.texImage2D(this._gl.TEXTURE_2D,0,n,H.width,H.height,0,O,a,c),H.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),H.isReady=!0},P.ThinEngine.prototype.createRawTexture=function(H,c,y,F,P,S,n){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const C=new Z.b(this,3);C.baseWidth=c,C.baseHeight=y,C.width=c,C.height=y,C.format=F,C.generateMipMaps=P,C.samplingMode=n,C.invertY=S,C._compression=O,C.type=a,C._useSRGBBuffer=this._getUseSRGBBuffer(i,!P),this._doNotHandleContextLost||(C._bufferView=H),this.updateRawTexture(C,H,F,S,O,a,C._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,C,!0);const g=this._getSamplingParameters(n,P);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,g.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,g.min),P&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(C),C},P.ThinEngine.prototype.createRawCubeTexture=function(H,c,y,F,P,S,n){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const a=this._gl,C=new Z.b(this,8);C.isCube=!0,C.format=y,C.type=F,this._doNotHandleContextLost||(C._bufferViewArray=H);const v=this._getWebGLTextureType(F);let m=this._getInternalFormat(y);m===a.RGB&&(m=a.RGBA),v!==a.FLOAT||this._caps.textureFloatLinearFiltering?v!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?v!==a.FLOAT||this._caps.textureFloatRender?v!==a.HALF_FLOAT||this._caps.colorBufferFloat||(P=!1,i.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(P=!1,i.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(P=!1,n=1,i.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(P=!1,n=1,i.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const z=c,V=z;C.width=z,C.height=V,C.invertY=S,C._compression=O;if(!this.needPOTTextures||(0,g.g)(C.width)&&(0,g.g)(C.height)||(P=!1),H)this.updateRawCubeTexture(C,H,y,F,S,O);else{const H=this._getRGBABufferInternalSizedFormat(F),c=0;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,C,!0);for(let y=0;y<6;y++)O?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+y,c,this.getCaps().s3tc[O],C.width,C.height,0,void 0):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+y,c,H,C.width,C.height,0,m,v,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,C,!0),H&&P&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const h=this._getSamplingParameters(n,P);return a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,h.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,h.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),C.generateMipMaps=P,C.samplingMode=n,C.isReady=!0,C},P.ThinEngine.prototype.updateRawCubeTexture=function(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;H._bufferViewArray=c,H.format=y,H.type=Z,H.invertY=F,H._compression=P;const n=this._gl,O=this._getWebGLTextureType(Z);let a=this._getInternalFormat(y);const i=this._getRGBABufferInternalSizedFormat(Z);let C=!1;a===n.RGB&&(a=n.RGBA,C=!0),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,H,!0),this._unpackFlipY(void 0===F||!!F),H.width%4!==0&&n.pixelStorei(n.UNPACK_ALIGNMENT,1);for(let g=0;g<6;g++){let y=c[g];P?n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,S,this.getCaps().s3tc[P],H.width,H.height,0,y):(C&&(y=v(y,H.width,H.height,Z)),n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,S,i,H.width,H.height,0,a,O,y))}(!this.needPOTTextures||(0,g.g)(H.width)&&(0,g.g)(H.height))&&H.generateMipMaps&&0===S&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),H.isReady=!0},P.ThinEngine.prototype.createRawCubeTextureFromUrl=function(H,c,y,Z,F,P,S,n){let O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,C=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const g=this._gl,m=this.createRawCubeTexture(null,y,Z,F,!P,C,i,null);null===c||void 0===c||c.addPendingData(m),m.url=H,m.isReady=!1,this._internalTexturesCache.push(m);const z=H=>{const y=m.width,P=S(H);if(P){if(n){const H=this._getWebGLTextureType(F);let c=this._getInternalFormat(Z);const S=this._getRGBABufferInternalSizedFormat(F);let O=!1;c===g.RGB&&(c=g.RGBA,O=!0),this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,m,!0),this._unpackFlipY(!1);const a=n(P);for(let Z=0;Z<a.length;Z++){const P=y>>Z;for(let y=0;y<6;y++){let n=a[Z][y];O&&(n=v(n,P,P,F)),g.texImage2D(y,Z,S,P,P,0,c,H,n)}}this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(m,P,Z,F,C);m.isReady=!0,null===c||void 0===c||c.removePendingData(m),m.onLoadedObservable.notifyObservers(m),m.onLoadedObservable.clear(),O&&O()}};return this._loadFile(H,(H=>{z(H)}),void 0,null===c||void 0===c?void 0:c.offlineProvider,!0,((H,y)=>{null===c||void 0===c||c.removePendingData(m),a&&H&&a(H.status+" "+H.statusText,y)})),m},P.ThinEngine.prototype.createRawTexture2DArray=m(!1),P.ThinEngine.prototype.createRawTexture3D=m(!0),P.ThinEngine.prototype.updateRawTexture2DArray=z(!1),P.ThinEngine.prototype.updateRawTexture3D=z(!0);var V=y(10840);P.ThinEngine.prototype._readTexturePixelsSync=function(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const i=this._gl;if(!i)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const H=i.createFramebuffer();if(!H)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=H}var C,g;(i.bindFramebuffer(i.FRAMEBUFFER,this._dummyFramebuffer),Z>-1)?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Z,null===(C=H._hardwareTexture)||void 0===C?void 0:C.underlyingResource,F):i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null===(g=H._hardwareTexture)||void 0===g?void 0:g.underlyingResource,F);let v=void 0!==H.type?this._getWebGLTextureType(H.type):i.UNSIGNED_BYTE;if(n)P||(P=(0,V.m)(H.type,4*c*y));else if(v===i.UNSIGNED_BYTE)P||(P=new Uint8Array(4*c*y)),v=i.UNSIGNED_BYTE;else P||(P=new Float32Array(4*c*y)),v=i.FLOAT;return S&&this.flushFramebuffer(),i.readPixels(O,a,c,y,i.RGBA,v,P),i.bindFramebuffer(i.FRAMEBUFFER,this._currentFramebuffer),P},P.ThinEngine.prototype._readTexturePixels=function(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],n=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(H,c,y,Z,F,P,S,n,O,a))};y(11526);P.ThinEngine.prototype._createDepthStencilCubeTexture=function(H,c){const y=new Z.b(this,12);if(y.isCube=!0,1===this.webGLVersion)return i.d.Error("Depth cube texture is not supported by WebGL 1."),y;const F={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c},P=this._gl;this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,y,!0),this._setupDepthStencilTexture(y,H,F.bilinearFiltering,F.comparisonFunction);for(let Z=0;Z<6;Z++)F.generateStencil?P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,P.DEPTH24_STENCIL8,H,H,0,P.DEPTH_STENCIL,P.UNSIGNED_INT_24_8,null):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,P.DEPTH_COMPONENT24,H,H,0,P.DEPTH_COMPONENT,P.UNSIGNED_INT,null);return this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(y),y},P.ThinEngine.prototype._setCubeMapTextureParams=function(H,c,y){const Z=this._gl;Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,c?Z.LINEAR_MIPMAP_LINEAR:Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),H.samplingMode=c?3:2,c&&this.getCaps().textureMaxLevel&&void 0!==y&&y>0&&(Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAX_LEVEL,y),H._maxLodLevel=y),this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,null)},P.ThinEngine.prototype.createCubeTexture=function(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,m=arguments.length>13&&void 0!==arguments[13]&&arguments[13],z=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const V=this._gl;return this.createCubeTextureBase(H,c,y,!!Z,F,P,S,n,O,a,C,v,(H=>this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,H,!0)),((H,c)=>{const y=this.needPOTTextures?(0,g.c)(c[0].width,this._caps.maxCubemapTextureSize):c[0].width,P=y,n=[V.TEXTURE_CUBE_MAP_POSITIVE_X,V.TEXTURE_CUBE_MAP_POSITIVE_Y,V.TEXTURE_CUBE_MAP_POSITIVE_Z,V.TEXTURE_CUBE_MAP_NEGATIVE_X,V.TEXTURE_CUBE_MAP_NEGATIVE_Y,V.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,H,!0),this._unpackFlipY(!1);const O=S?this._getInternalFormat(S,H._useSRGBBuffer):H._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:V.RGBA;let a=S?this._getInternalFormat(S):V.RGBA;H._useSRGBBuffer&&1===this.webGLVersion&&(a=O);for(let Z=0;Z<n.length;Z++)if(c[Z].width!==y||c[Z].height!==P){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void i.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=y,this._workingCanvas.height=P,this._workingContext.drawImage(c[Z],0,0,c[Z].width,c[Z].height,0,0,y,P),V.texImage2D(n[Z],0,O,a,V.UNSIGNED_BYTE,this._workingCanvas)}else V.texImage2D(n[Z],0,O,a,V.UNSIGNED_BYTE,c[Z]);Z||V.generateMipmap(V.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(H,!Z),H.width=y,H.height=P,H.isReady=!0,S&&(H.format=S),H.onLoadedObservable.notifyObservers(H),H.onLoadedObservable.clear(),F&&F()}),!!m,z)},P.ThinEngine.prototype.generateMipMapsForCubemap=function(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H.generateMipMaps){const y=this._gl;this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,H,!0),y.generateMipmap(y.TEXTURE_CUBE_MAP),c&&this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,null)}};y(11580);P.ThinEngine.prototype.setDepthStencilTexture=function(H,c,y,Z){void 0!==H&&(c&&(this._boundUniforms[H]=c),y&&y.depthStencilTexture?this._setTexture(H,y,!1,!0,Z):this._setTexture(H,null,void 0,void 0,Z))},P.ThinEngine.prototype.createRenderTargetCubeTexture=function(H,c){const y=this._createHardwareRenderTargetWrapper(!1,!0,H),F={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...c};F.generateStencilBuffer=F.generateDepthBuffer&&F.generateStencilBuffer,(1!==F.type||this._caps.textureFloatLinearFiltering)&&(2!==F.type||this._caps.textureHalfFloatLinearFiltering)||(F.samplingMode=1);const P=this._gl,S=new Z.b(this,5);this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,S,!0);const n=this._getSamplingParameters(F.samplingMode,F.generateMipMaps);1!==F.type||this._caps.textureFloat||(F.type=0,i.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAG_FILTER,n.mag),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MIN_FILTER,n.min),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);for(let Z=0;Z<6;Z++)P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,this._getRGBABufferInternalSizedFormat(F.type,F.format),H,H,0,this._getInternalFormat(F.format),this._getWebGLTextureType(F.type),null);const O=P.createFramebuffer();return this._bindUnboundFramebuffer(O),y._depthStencilBuffer=this._setupFramebufferDepthAttachments(F.generateStencilBuffer,F.generateDepthBuffer,H,H),F.generateMipMaps&&P.generateMipmap(P.TEXTURE_CUBE_MAP),this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),y._framebuffer=O,y._generateDepthBuffer=F.generateDepthBuffer,y._generateStencilBuffer=F.generateStencilBuffer,S.width=H,S.height=H,S.isReady=!0,S.isCube=!0,S.samples=1,S.generateMipMaps=F.generateMipMaps,S.samplingMode=F.samplingMode,S.type=F.type,S.format=F.format,this._internalTexturesCache.push(S),y.setTextures(S),y};var h=y(11600),Q=y(11313),D=y(11625);P.ThinEngine.prototype.createPrefilteredCubeTexture=function(H,c,y,F){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(H,c,null,!1,(H=>{if(!H)return void(P&&P(null));const S=H.texture;if(a?H.info.sphericalPolynomial&&(S._sphericalPolynomial=H.info.sphericalPolynomial):S._sphericalPolynomial=new h.f,S._source=9,this.getCaps().textureLOD)return void(P&&P(S));const n=this._gl,O=H.width;if(!O)return;const C=[];for(let P=0;P<3;P++){const a=1-P/2,g=F,v=Math.log2(O)*y+F,m=g+(v-g)*a,z=Math.round(Math.min(Math.max(m,0),v)),V=new Z.b(this,2);if(V.type=S.type,V.format=S.format,V.width=Math.pow(2,Math.max(Math.log2(O)-z,0)),V.height=V.width,V.isCube=!0,V._cachedWrapU=0,V._cachedWrapV=0,this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,V,!0),V.samplingMode=2,n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),H.isDDS){const c=H.info,y=H.data;this._unpackFlipY(c.isCompressed),D.c.UploadDDSLevels(this,V,y,c,!0,6,z)}else i.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null);const h=new Q.c(c);h._isCube=!0,h._texture=V,V.isReady=!0,C.push(h)}S._lodTextureHigh=C[2],S._lodTextureMid=C[1],S._lodTextureLow=C[0],P&&P(S)}),S,n,O,a,y,F)},P.ThinEngine.prototype.createUniformBuffer=function(H,c){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create uniform buffer");const Z=new a.e(y);return this.bindUniformBuffer(Z),H instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,H,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(H),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),Z.references=1,Z},P.ThinEngine.prototype.createDynamicUniformBuffer=function(H,c){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create dynamic uniform buffer");const Z=new a.e(y);return this.bindUniformBuffer(Z),H instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,H,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(H),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),Z.references=1,Z},P.ThinEngine.prototype.updateUniformBuffer=function(H,c,y,Z){this.bindUniformBuffer(H),void 0===y&&(y=0),void 0===Z?c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,y,c):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,y,new Float32Array(c)):c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,c.subarray(y,y+Z)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(c).subarray(y,y+Z)),this.bindUniformBuffer(null)},P.ThinEngine.prototype.bindUniformBuffer=function(H){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,H?H.underlyingResource:null)},P.ThinEngine.prototype.bindUniformBufferBase=function(H,c,y){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,c,H?H.underlyingResource:null)},P.ThinEngine.prototype.bindUniformBlock=function(H,c,y){const Z=H.program,F=this._gl.getUniformBlockIndex(Z,c);4294967295!==F&&this._gl.uniformBlockBinding(Z,F,y)};var f=y(10768),J=y(10850);J.e.prototype.displayLoadingUI=function(){if(!(0,f.h)())return;const H=this.loadingScreen;H&&H.displayLoadingUI()},J.e.prototype.hideLoadingUI=function(){if(!(0,f.h)())return;const H=this._loadingScreen;H&&H.hideLoadingUI()},Object.defineProperty(J.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=J.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(H){this._loadingScreen=H},enumerable:!0,configurable:!0}),Object.defineProperty(J.e.prototype,"loadingUIText",{set:function(H){this.loadingScreen.loadingUIText=H},enumerable:!0,configurable:!0}),Object.defineProperty(J.e.prototype,"loadingUIBackgroundColor",{set:function(H){this.loadingScreen.loadingUIBackgroundColor=H},enumerable:!0,configurable:!0}),J.e.prototype.getInputElement=function(){return this._renderingCanvas},J.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},J.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},J.e.prototype.getAspectRatio=function(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=H.viewport;return this.getRenderWidth(c)*y.width/(this.getRenderHeight(c)*y.height)},J.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},J.e.prototype._verifyPointerLock=function(){var H;null===(H=this._onPointerLockChange)||void 0===H||H.call(this)},J.e.prototype.setAlphaEquation=function(H){if(this._alphaEquation!==H){switch(H){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=H}},J.e.prototype.getInputElement=function(){return this._renderingCanvas},J.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},J.e.prototype.setDepthFunction=function(H){this._depthCullingState.depthFunc=H},J.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},J.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},J.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},J.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},J.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},J.e.prototype.setDepthWrite=function(H){this._depthCullingState.depthMask=H},J.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},J.e.prototype.setStencilBuffer=function(H){this._stencilState.stencilTest=H},J.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},J.e.prototype.setStencilMask=function(H){this._stencilState.stencilMask=H},J.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},J.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},J.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},J.e.prototype.setStencilFunction=function(H){this._stencilState.stencilFunc=H},J.e.prototype.setStencilFunctionReference=function(H){this._stencilState.stencilFuncRef=H},J.e.prototype.setStencilFunctionMask=function(H){this._stencilState.stencilFuncMask=H},J.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},J.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},J.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},J.e.prototype.setStencilOperationFail=function(H){this._stencilState.stencilOpStencilFail=H},J.e.prototype.setStencilOperationDepthFail=function(H){this._stencilState.stencilOpDepthFail=H},J.e.prototype.setStencilOperationPass=function(H){this._stencilState.stencilOpStencilDepthPass=H},J.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},J.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},J.e.prototype.setAlphaConstants=function(H,c,y,Z){this._alphaState.setAlphaBlendConstants(H,c,y,Z)},J.e.prototype.getAlphaMode=function(){return this._alphaMode},J.e.prototype.getAlphaEquation=function(){return this._alphaEquation},J.e.prototype.getRenderPassNames=function(){return this._renderPassNames},J.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},J.e.prototype.createRenderPassId=function(H){const c=++J.e._RenderPassIdCounter;return this._renderPassNames[c]=H??"NONAME",c},J.e.prototype.releaseRenderPassId=function(H){this._renderPassNames[H]=void 0;for(let c=0;c<this.scenes.length;++c){const y=this.scenes[c];for(let c=0;c<y.meshes.length;++c){const Z=y.meshes[c];if(Z.$f)for(let c=0;c<Z.$f.length;++c){Z.$f[c]._removeDrawWrapper(H)}}}};y(11594);function l(H){if(H.requestPointerLock){const c=H.requestPointerLock();c instanceof Promise?c.then((()=>{H.focus()})).catch((()=>{})):H.focus()}}var d=y(10916);y(11667);class K extends P.ThinEngine{static get NpmPackage(){return J.e.NpmPackage}static get Version(){return J.e.Version}static get Instances(){return F.b.Instances}static get LastCreatedEngine(){return F.b.LastCreatedEngine}static get LastCreatedScene(){return F.b.LastCreatedScene}static DefaultLoadingScreenFactory(H){return J.e.DefaultLoadingScreenFactory(H)}get _supportsHardwareTextureRescaling(){return!!K._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(H,c,y){if(super(H,c,y,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new n,this._drawCalls=new d.b,H&&(this._features.supportRenderPasses=!0,y=this._creationOptions,H.getContext)){const c=H;this._sharedInit(c)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(H){super._sharedInit(H),function(H,c,y){H._onCanvasFocus=()=>{H.onCanvasFocusObservable.notifyObservers(H)},H._onCanvasBlur=()=>{H.onCanvasBlurObservable.notifyObservers(H)},H._onCanvasContextMenu=c=>{H.disableContextMenu&&c.preventDefault()},c.addEventListener("focus",H._onCanvasFocus),c.addEventListener("blur",H._onCanvasBlur),c.addEventListener("contextmenu",H._onCanvasContextMenu),H._onBlur=()=>{H.disablePerformanceMonitorInBackground&&H.performanceMonitor.disable(),H._windowIsBackground=!0},H._onFocus=()=>{H.disablePerformanceMonitorInBackground&&H.performanceMonitor.enable(),H._windowIsBackground=!1},H._onCanvasPointerOut=y=>{document.elementFromPoint(y.clientX,y.clientY)!==c&&H.onCanvasPointerOutObservable.notifyObservers(y)};const Z=H.getHostWindow();Z&&"function"===typeof Z.addEventListener&&(Z.addEventListener("blur",H._onBlur),Z.addEventListener("focus",H._onFocus)),c.addEventListener("pointerout",H._onCanvasPointerOut),y.doNotHandleTouchAction||function(H){H&&H.setAttribute&&(H.setAttribute("touch-action","none"),H.style.touchAction="none",H.style.webkitTapHighlightColor="transparent")}(c),!J.e.audioEngine&&y.audioEngine&&J.e.AudioEngineFactory&&(J.e.audioEngine=J.e.AudioEngineFactory(H.getRenderingCanvas(),H.getAudioContext(),H.getAudioDestination())),(0,f.e)()&&(H._onFullscreenChange=()=>{H.isFullscreen=!!document.fullscreenElement,H.isFullscreen&&H._pointerLockRequested&&c&&l(c)},document.addEventListener("fullscreenchange",H._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",H._onFullscreenChange,!1),H._onPointerLockChange=()=>{H.isPointerLock=document.pointerLockElement===c},document.addEventListener("pointerlockchange",H._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",H._onPointerLockChange,!1)),H.enableOfflineSupport=void 0!==J.e.OfflineProviderFactory,H._deterministicLockstep=!!y.deterministicLockstep,H._lockstepMaxSteps=y.lockstepMaxSteps||0,H._timeStep=y.timeStep||1/60}(this,H,this._creationOptions)}resizeImageBitmap(H,c,y){return function(H,c,y,Z){const F=H.createCanvas(y,Z).getContext("2d");if(!F)throw new Error("Unable to get 2d context for resizeImageBitmap");return F.drawImage(c,0,0),F.getImageData(0,0,y,Z).data}(this,H,c,y)}_createImageBitmapFromSource(H,c){return function(H,c,y){return new Promise(((Z,F)=>{const P=new Image;P.onload=()=>{P.decode().then((()=>{H.createImageBitmap(P,y).then((H=>{Z(H)}))}))},P.onerror=()=>{F(`Error loading image ${P.src}`)},P.src=c}))}(this,H,c)}switchFullscreen(H){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(H)}enterFullscreen(H){this.isFullscreen||(this._pointerLockRequested=H,this._renderingCanvas&&function(H){const c=H.requestFullscreen||H.webkitRequestFullscreen;c&&c.call(H)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const H=document;document.exitFullscreen?document.exitFullscreen():H.webkitCancelFullScreen&&H.webkitCancelFullScreen()}()}setDitheringState(H){H?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(H){H?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(H,c,y,Z){const F=this._cachedViewport;return this._cachedViewport=null,this._viewport(H,c,y,Z),F}scissorClear(H,c,y,Z,F){this.enableScissor(H,c,y,Z),this.clear(F,!0,!0,!0),this.disableScissor()}enableScissor(H,c,y,Z){const F=this._gl;F.enable(F.SCISSOR_TEST),F.scissor(H,c,y,Z)}disableScissor(){const H=this._gl;H.disable(H.SCISSOR_TEST)}_loadFileAsync(H,c,y){return new Promise(((Z,F)=>{this._loadFile(H,(H=>{Z(H)}),void 0,c,y,((H,c)=>{F(c)}))}))}getVertexShaderSource(H){const c=this._gl.getAttachedShaders(H);return c?this._gl.getShaderSource(c[0]):null}getFragmentShaderSource(H){const c=this._gl.getAttachedShaders(H);return c?this._gl.getShaderSource(c[1]):null}set framebufferDimensionsObject(H){this._framebufferDimensionsObject=H,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const H of this.scenes)H.resetCachedMaterial(),H._rebuildGeometries();for(const H of this._virtualScenes)H.resetCachedMaterial(),H._rebuildGeometries();super._rebuildBuffers()}getFontOffset(H){return function(H){const c=document.createElement("span");c.textContent="Hg",c.style.font=H;const y=document.createElement("div");y.style.display="inline-block",y.style.width="1px",y.style.height="0px",y.style.verticalAlign="bottom";const Z=document.createElement("div");Z.style.whiteSpace="nowrap",Z.appendChild(c),Z.appendChild(y),document.body.appendChild(Z);let F=0,P=0;try{P=y.getBoundingClientRect().top-c.getBoundingClientRect().top,y.style.verticalAlign="baseline",F=y.getBoundingClientRect().top-c.getBoundingClientRect().top}finally{document.body.removeChild(Z)}return{ascent:F,height:P,descent:P-F}}(H)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:H}=this.customAnimationFrameRequester;H&&H(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let H=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(H=!1),H&&(this.ej(),this._renderViews()||this._renderFrame(),this.fj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&l(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}ej(){this._measureFps(),super.ej()}_deletePipelineContext(H){const c=H;c&&c.program&&c.transformFeedback&&(this.deleteTransformFeedback(c.transformFeedback),c.transformFeedback=null),super._deletePipelineContext(H)}createShaderProgram(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;F=F||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const S=super.createShaderProgram(H,c,y,Z,F,P);return this.onAfterShaderCompilationObservable.notifyObservers(this),S}_createShaderProgram(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const P=Z.createProgram();if(H.program=P,!P)throw new Error("Unable to create program");if(Z.attachShader(P,c),Z.attachShader(P,y),this.webGLVersion>1&&F){const c=this.createTransformFeedback();this.bindTransformFeedback(c),this.setTranformFeedbackVaryings(P,F),H.transformFeedback=c}return Z.linkProgram(P),this.webGLVersion>1&&F&&this.bindTransformFeedback(null),H.context=Z,H.vertexShader=c,H.fragmentShader=y,H.isParallelCompiled||this._finalizePipelineContext(H),P}_releaseTexture(H){super._releaseTexture(H)}_releaseRenderTargetWrapper(H){super._releaseRenderTargetWrapper(H),this.scenes.forEach((c=>{c.postProcesses.forEach((c=>{c._outputTexture===H&&(c._outputTexture=null)})),c.cameras.forEach((c=>{c._postProcesses.forEach((c=>{c&&c._outputTexture===H&&(c._outputTexture=null)}))}))}))}_rescaleTexture(H,c,y,Z,F){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const P=this.createRenderTargetTexture({width:c.width,height:c.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&K._RescalePostProcessFactory&&(this._rescalePostProcess=K._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const S=()=>{this._rescalePostProcess.onApply=function(c){c._bindTexture("textureSampler",H)};let S=y;S||(S=this.scenes[this.scenes.length-1]),S.postProcessManager.directRender([this._rescalePostProcess],P,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,Z,0,0,c.width,c.height,0),this.unBindFramebuffer(P),P.dispose(),F&&F()},n=this._rescalePostProcess.getEffect();n?n.executeWhenCompiled(S):this._rescalePostProcess.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled(S)}))}}wrapWebGLTexture(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const S=new C.e(H,this._gl),n=new Z.b(this,0,!0);return n._hardwareTexture=S,n.baseWidth=F,n.baseHeight=P,n.width=F,n.height=P,n.isReady=!0,n.useMipMaps=c,this.updateTextureSamplingMode(y,n),n}_uploadImageToTexture(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const F=this._gl,P=this._getWebGLTextureType(H.type),S=this._getInternalFormat(H.format),n=this._getRGBABufferInternalSizedFormat(H.type,S),O=H.isCube?F.TEXTURE_CUBE_MAP:F.TEXTURE_2D;this._bindTextureDirectly(O,H,!0),this._unpackFlipY(H.invertY);let a=F.TEXTURE_2D;H.isCube&&(a=F.TEXTURE_CUBE_MAP_POSITIVE_X+y),F.texImage2D(a,Z,n,S,P,c),this._bindTextureDirectly(O,null,!0)}updateTextureComparisonFunction(H,c){if(1===this.webGLVersion)return void i.d.Error("WebGL 1 does not support texture comparison.");const y=this._gl;H.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,H,!0),0===c?(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,c),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,H,!0),0===c?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,c),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),H._comparisonFunction=c}createInstancesBuffer(H){const c=this._gl.createBuffer();if(!c)throw new Error("Unable to create instance buffer");const y=new a.e(c);return y.mb=H,this.bindArrayBuffer(y),this._gl.bufferData(this._gl.ARRAY_BUFFER,H,this._gl.DYNAMIC_DRAW),y.references=1,y}deleteInstancesBuffer(H){this._gl.deleteBuffer(H)}_clientWaitAsync(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const Z=this._gl;return new Promise(((F,P)=>{const S=()=>{const n=Z.clientWaitSync(H,c,0);n!=Z.WAIT_FAILED?n!=Z.TIMEOUT_EXPIRED?F():setTimeout(S,y):P()};S()}))}_readPixelsAsync(H,c,y,Z,F,P,S){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const n=this._gl,O=n.createBuffer();n.bindBuffer(n.PIXEL_PACK_BUFFER,O),n.bufferData(n.PIXEL_PACK_BUFFER,S.byteLength,n.STREAM_READ),n.readPixels(H,c,y,Z,F,P,0),n.bindBuffer(n.PIXEL_PACK_BUFFER,null);const a=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);return a?(n.flush(),this._clientWaitAsync(a,0,10).then((()=>(n.deleteSync(a),n.bindBuffer(n.PIXEL_PACK_BUFFER,O),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,S),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),n.deleteBuffer(O),S)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(H,c){1===F.b.Instances.length&&J.e.audioEngine&&(J.e.audioEngine.dispose(),J.e.audioEngine=null);const y=H.getHostWindow();y&&"function"===typeof y.removeEventListener&&(y.removeEventListener("blur",H._onBlur),y.removeEventListener("focus",H._onFocus)),c&&(c.removeEventListener("focus",H._onCanvasFocus),c.removeEventListener("blur",H._onCanvasBlur),c.removeEventListener("pointerout",H._onCanvasPointerOut),c.removeEventListener("contextmenu",H._onCanvasContextMenu)),(0,f.e)()&&(document.removeEventListener("fullscreenchange",H._onFullscreenChange),document.removeEventListener("mozfullscreenchange",H._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",H._onFullscreenChange),document.removeEventListener("msfullscreenchange",H._onFullscreenChange),document.removeEventListener("pointerlockchange",H._onPointerLockChange),document.removeEventListener("mspointerlockchange",H._onPointerLockChange),document.removeEventListener("mozpointerlockchange",H._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",H._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}K.ALPHA_DISABLE=0,K.ALPHA_ADD=1,K.ALPHA_COMBINE=2,K.ALPHA_SUBTRACT=3,K.ALPHA_MULTIPLY=4,K.ALPHA_MAXIMIZED=5,K.ALPHA_ONEONE=6,K.ALPHA_PREMULTIPLIED=7,K.ALPHA_PREMULTIPLIED_PORTERDUFF=8,K.ALPHA_INTERPOLATE=9,K.ALPHA_SCREENMODE=10,K.DELAYLOADSTATE_NONE=0,K.DELAYLOADSTATE_LOADED=1,K.DELAYLOADSTATE_LOADING=2,K.DELAYLOADSTATE_NOTLOADED=4,K.NEVER=512,K.ALWAYS=519,K.LESS=513,K.EQUAL=514,K.LEQUAL=515,K.GREATER=516,K.GEQUAL=518,K.NOTEQUAL=517,K.KEEP=7680,K.REPLACE=7681,K.INCR=7682,K.DECR=7683,K.INVERT=5386,K.INCR_WRAP=34055,K.DECR_WRAP=34056,K.TEXTURE_CLAMP_ADDRESSMODE=0,K.TEXTURE_WRAP_ADDRESSMODE=1,K.TEXTURE_MIRROR_ADDRESSMODE=2,K.TEXTUREFORMAT_ALPHA=0,K.TEXTUREFORMAT_LUMINANCE=1,K.TEXTUREFORMAT_LUMINANCE_ALPHA=2,K.TEXTUREFORMAT_RGB=4,K.TEXTUREFORMAT_RGBA=5,K.TEXTUREFORMAT_RED=6,K.TEXTUREFORMAT_R=6,K.TEXTUREFORMAT_RG=7,K.TEXTUREFORMAT_RED_INTEGER=8,K.TEXTUREFORMAT_R_INTEGER=8,K.TEXTUREFORMAT_RG_INTEGER=9,K.TEXTUREFORMAT_RGB_INTEGER=10,K.TEXTUREFORMAT_RGBA_INTEGER=11,K.TEXTURETYPE_UNSIGNED_BYTE=0,K.TEXTURETYPE_UNSIGNED_INT=0,K.TEXTURETYPE_FLOAT=1,K.TEXTURETYPE_HALF_FLOAT=2,K.TEXTURETYPE_BYTE=3,K.TEXTURETYPE_SHORT=4,K.TEXTURETYPE_UNSIGNED_SHORT=5,K.TEXTURETYPE_INT=6,K.TEXTURETYPE_UNSIGNED_INTEGER=7,K.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,K.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,K.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,K.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,K.TEXTURETYPE_UNSIGNED_INT_24_8=12,K.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,K.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,K.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,K.TEXTURE_NEAREST_SAMPLINGMODE=1,K.TEXTURE_BILINEAR_SAMPLINGMODE=2,K.TEXTURE_TRILINEAR_SAMPLINGMODE=3,K.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,K.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,K.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,K.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,K.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,K.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,K.TEXTURE_NEAREST_LINEAR=7,K.TEXTURE_NEAREST_NEAREST=1,K.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,K.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,K.TEXTURE_LINEAR_LINEAR=2,K.TEXTURE_LINEAR_NEAREST=12,K.TEXTURE_EXPLICIT_MODE=0,K.TEXTURE_SPHERICAL_MODE=1,K.TEXTURE_PLANAR_MODE=2,K.TEXTURE_CUBIC_MODE=3,K.TEXTURE_PROJECTION_MODE=4,K.TEXTURE_SKYBOX_MODE=5,K.TEXTURE_INVCUBIC_MODE=6,K.TEXTURE_EQUIRECTANGULAR_MODE=7,K.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,K.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,K.SCALEMODE_FLOOR=1,K.SCALEMODE_NEAREST=2,K.SCALEMODE_CEILING=3},10810:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});var Z=y(10763);class F{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}F.Instances=[],F.OnEnginesDisposedObservable=new Z.e,F._LastCreatedScene=null,F.UseFallbackTexture=!0,F.FallbackTexture=""},12869:(H,c,y)=>{"use strict";y(10773);var Z=y(11573);y(10877),y(11159),y(10872),y(11585),y(11542);Z.c},10872:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{static SetMatrixPrecision(H){if(Z.MatrixTrackPrecisionChange=!1,H&&!Z.MatrixUse64Bits&&Z.MatrixTrackedMatrices)for(let c=0;c<Z.MatrixTrackedMatrices.length;++c){const H=Z.MatrixTrackedMatrices[c],y=H.Pj;H.Pj=new Array(16);for(let c=0;c<16;++c)H.Pj[c]=y[c]}Z.MatrixUse64Bits=H,Z.MatrixCurrentType=Z.MatrixUse64Bits?Array:Float32Array,Z.MatrixTrackedMatrices=null}}Z.MatrixUse64Bits=!1,Z.MatrixTrackPrecisionChange=!0,Z.MatrixCurrentType=Float32Array,Z.MatrixTrackedMatrices=[]},11585:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});class Z{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var H;return(null===(H=this._textures)||void 0===H?void 0:H[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(H){var c,y;if(!this._textures)return-1;const Z=this._textures[H],F=(null===(c=this._layerIndices)||void 0===c?void 0:c[H])??0,P=(null===(y=this._faceIndices)||void 0===y?void 0:y[H])??0;return Z.isCube?6*F+P:Z.is3D?0:F}get samples(){return this._samples}setSamples(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===H&&!y)return H;const Z=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,H,c):this._engine.updateRenderTargetTextureSampleCount(this,H);return this._samples=H,Z}constructor(H,c,y,Z,F){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=H,this._isCube=c,this._size=y,this._engine=Z,this._depthStencilTexture=null,this.label=F}setTextures(H){Array.isArray(H)?this._textures=H:this._textures=H?[H]:null}setTexture(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[c]!==H&&(this._textures[c]&&y&&this._textures[c].dispose(),this._textures[c]=H)}setLayerAndFaceIndices(H,c){this._layerIndices=H,this._faceIndices=c}setLayerAndFaceIndex(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==c&&c>=0&&(this._layerIndices[H]=c),void 0!==y&&y>=0&&(this._faceIndices[H]=y)}createDepthStencilTexture(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,S=arguments.length>5?arguments[5]:void 0;return null===(H=this._depthStencilTexture)||void 0===H||H.dispose(),this._depthStencilTextureWithStencil=Z,this._depthStencilTextureLabel=S,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:y,comparisonFunction:c,generateStencil:Z,isCube:this._isCube,samples:F,depthTextureFormat:P,label:S},this),this._depthStencilTexture}_shareDepth(H){this.shareDepth(H)}shareDepth(H){this._depthStencilTexture&&(H._depthStencilTexture&&H._depthStencilTexture.dispose(),H._depthStencilTexture=this._depthStencilTexture,H._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(H){this.texture&&this.texture._swapAndDie(H),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let H=null;if(this._isMulti){const c=this.textures;if(c&&c.length>0){let y=!1,Z=c.length,F=-1;const P=c[c.length-1]._source;14!==P&&12!==P||(y=!0,F=c[c.length-1].format,Z--);const S=[],n=[],O=[],a=[],i=[],C=[],g=[],v={};for(let H=0;H<Z;++H){const y=c[H];S.push(y.samplingMode),n.push(y.type),O.push(y.format);void 0!==v[y.uniqueId]?(a.push(-1),g.push(0)):(v[y.uniqueId]=H,y.is2DArray?(a.push(35866),g.push(y.depth)):y.isCube?(a.push(34067),g.push(0)):y.is3D?(a.push(32879),g.push(y.depth)):(a.push(3553),g.push(0))),this._faceIndices&&i.push(this._faceIndices[H]??0),this._layerIndices&&C.push(this._layerIndices[H]??0)}const m={samplingModes:S,generateMipMaps:c[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:y,depthTextureFormat:F,types:n,formats:O,textureCount:Z,targetTypes:a,faceIndex:i,layerIndex:C,layerCounts:g,label:this.label},z={width:this.width,height:this.height,depth:this.depth};H=this._engine.createMultipleRenderTarget(z,m);for(let V=0;V<Z;++V){if(-1!==a[V])continue;const y=v[c[V].uniqueId];H.setTexture(H.textures[y],V)}}}else{var c,y,Z,F;const S={};if(S.generateDepthBuffer=this._generateDepthBuffer,S.generateMipMaps=(null===(c=this.texture)||void 0===c?void 0:c.generateMipMaps)??!1,S.generateStencilBuffer=this._generateStencilBuffer,S.samplingMode=null===(y=this.texture)||void 0===y?void 0:y.samplingMode,S.type=null===(Z=this.texture)||void 0===Z?void 0:Z.type,S.format=null===(F=this.texture)||void 0===F?void 0:F.format,S.noColorAttachment=!this._textures,S.label=this.label,this.isCube)H=this._engine.createRenderTargetCubeTexture(this.width,S);else{var P;const c={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(P=this.texture)||void 0===P?void 0:P.depth:void 0};H=this._engine.createRenderTargetTexture(c,S)}H.texture&&(H.texture.isReady=!0)}return H}_swapRenderTargetWrapper(H){if(this._textures&&H._textures)for(let c=0;c<this._textures.length;++c)this._textures[c]._swapAndDie(H._textures[c],!1),H._textures[c].isReady=!0;this._depthStencilTexture&&H._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(H._depthStencilTexture),H._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const H=this._cloneRenderTargetWrapper();if(H){if(this._depthStencilTexture){const c=this._depthStencilTexture.samplingMode,y=this._depthStencilTexture.format,Z=2===c||3===c||11===c;H.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,Z,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,y,this._depthStencilTextureLabel)}this.samples>1&&H.setSamples(this.samples),H._swapRenderTargetWrapper(this),H.dispose()}}releaseTextures(){if(this._textures)for(let c=0;c<(null===(H=this._textures)||void 0===H?void 0:H.length);++c){var H;this._textures[c].dispose()}this._textures=null}dispose(){var H;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(H=this._depthStencilTexture)||void 0===H||H.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10855:(H,c,y)=>{"use strict";y.d(c,{e:()=>Z});class Z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersRepository:Z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersStore:Z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.IncludesShadersStore:Z.IncludesShadersStoreWGSL}}Z.ShadersRepository="src/Shaders/",Z.ShadersStore={},Z.IncludesShadersStore={},Z.ShadersRepositoryWGSL="src/ShadersWGSL/",Z.ShadersStoreWGSL={},Z.IncludesShadersStoreWGSL={}},10869:(H,c,y)=>{"use strict";y.d(c,{b:()=>g,f:()=>Q,i:()=>v,l:()=>m,n:()=>h,p:()=>C,r:()=>a,u:()=>i,v:()=>O,x:()=>n});class Z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.kd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(H){H&&this.program&&H(this.program)}setEngine(H){this.kd=H}_fillEffectInformation(H,c,y,Z,F,P,S,n){const O=this.kd;if(O.supportsUniformBuffers)for(const i in c)H.bindUniformBlock(i,c[i]);let a;for(this.kd.getUniforms(this,y).forEach(((H,c)=>{Z[y[c]]=H})),this._uniforms=Z,a=0;a<F.length;a++){null==H.getUniform(F[a])&&(F.splice(a,1),a--)}F.forEach(((H,c)=>{P[H]=c}));for(const i of O.getAttributes(this,S))n.push(i)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(H,c){const y=this._valueCache[H],Z=c.updateFlag;return(void 0===y||y!==Z)&&(this._valueCache[H]=Z,!0)}_cacheFloat2(H,c,y){let Z=this._valueCache[H];if(!Z||2!==Z.length)return Z=[c,y],this._valueCache[H]=Z,!0;let F=!1;return Z[0]!==c&&(Z[0]=c,F=!0),Z[1]!==y&&(Z[1]=y,F=!0),F}_cacheFloat3(H,c,y,Z){let F=this._valueCache[H];if(!F||3!==F.length)return F=[c,y,Z],this._valueCache[H]=F,!0;let P=!1;return F[0]!==c&&(F[0]=c,P=!0),F[1]!==y&&(F[1]=y,P=!0),F[2]!==Z&&(F[2]=Z,P=!0),P}_cacheFloat4(H,c,y,Z,F){let P=this._valueCache[H];if(!P||4!==P.length)return P=[c,y,Z,F],this._valueCache[H]=P,!0;let S=!1;return P[0]!==c&&(P[0]=c,S=!0),P[1]!==y&&(P[1]=y,S=!0),P[2]!==Z&&(P[2]=Z,S=!0),P[3]!==F&&(P[3]=F,S=!0),S}setInt(H,c){const y=this._valueCache[H];void 0!==y&&y===c||this.kd.setInt(this._uniforms[H],c)&&(this._valueCache[H]=c)}setInt2(H,c,y){this._cacheFloat2(H,c,y)&&(this.kd.setInt2(this._uniforms[H],c,y)||(this._valueCache[H]=null))}setInt3(H,c,y,Z){this._cacheFloat3(H,c,y,Z)&&(this.kd.setInt3(this._uniforms[H],c,y,Z)||(this._valueCache[H]=null))}setInt4(H,c,y,Z,F){this._cacheFloat4(H,c,y,Z,F)&&(this.kd.setInt4(this._uniforms[H],c,y,Z,F)||(this._valueCache[H]=null))}setIntArray(H,c){this._valueCache[H]=null,this.kd.setIntArray(this._uniforms[H],c)}setIntArray2(H,c){this._valueCache[H]=null,this.kd.setIntArray2(this._uniforms[H],c)}setIntArray3(H,c){this._valueCache[H]=null,this.kd.setIntArray3(this._uniforms[H],c)}setIntArray4(H,c){this._valueCache[H]=null,this.kd.setIntArray4(this._uniforms[H],c)}setUInt(H,c){const y=this._valueCache[H];void 0!==y&&y===c||this.kd.setUInt(this._uniforms[H],c)&&(this._valueCache[H]=c)}setUInt2(H,c,y){this._cacheFloat2(H,c,y)&&(this.kd.setUInt2(this._uniforms[H],c,y)||(this._valueCache[H]=null))}setUInt3(H,c,y,Z){this._cacheFloat3(H,c,y,Z)&&(this.kd.setUInt3(this._uniforms[H],c,y,Z)||(this._valueCache[H]=null))}setUInt4(H,c,y,Z,F){this._cacheFloat4(H,c,y,Z,F)&&(this.kd.setUInt4(this._uniforms[H],c,y,Z,F)||(this._valueCache[H]=null))}setUIntArray(H,c){this._valueCache[H]=null,this.kd.setUIntArray(this._uniforms[H],c)}setUIntArray2(H,c){this._valueCache[H]=null,this.kd.setUIntArray2(this._uniforms[H],c)}setUIntArray3(H,c){this._valueCache[H]=null,this.kd.setUIntArray3(this._uniforms[H],c)}setUIntArray4(H,c){this._valueCache[H]=null,this.kd.setUIntArray4(this._uniforms[H],c)}setArray(H,c){this._valueCache[H]=null,this.kd.setArray(this._uniforms[H],c)}setArray2(H,c){this._valueCache[H]=null,this.kd.setArray2(this._uniforms[H],c)}setArray3(H,c){this._valueCache[H]=null,this.kd.setArray3(this._uniforms[H],c)}setArray4(H,c){this._valueCache[H]=null,this.kd.setArray4(this._uniforms[H],c)}setMatrices(H,c){c&&(this._valueCache[H]=null,this.kd.setMatrices(this._uniforms[H],c))}setMatrix(H,c){this._cacheMatrix(H,c)&&(this.kd.setMatrices(this._uniforms[H],c.ij())||(this._valueCache[H]=null))}setMatrix3x3(H,c){this._valueCache[H]=null,this.kd.setMatrix3x3(this._uniforms[H],c)}setMatrix2x2(H,c){this._valueCache[H]=null,this.kd.setMatrix2x2(this._uniforms[H],c)}setFloat(H,c){const y=this._valueCache[H];void 0!==y&&y===c||this.kd.setFloat(this._uniforms[H],c)&&(this._valueCache[H]=c)}setVector2(H,c){this._cacheFloat2(H,c.x,c.y)&&(this.kd.setFloat2(this._uniforms[H],c.x,c.y)||(this._valueCache[H]=null))}setFloat2(H,c,y){this._cacheFloat2(H,c,y)&&(this.kd.setFloat2(this._uniforms[H],c,y)||(this._valueCache[H]=null))}setVector3(H,c){this._cacheFloat3(H,c.x,c.y,c.z)&&(this.kd.setFloat3(this._uniforms[H],c.x,c.y,c.z)||(this._valueCache[H]=null))}setFloat3(H,c,y,Z){this._cacheFloat3(H,c,y,Z)&&(this.kd.setFloat3(this._uniforms[H],c,y,Z)||(this._valueCache[H]=null))}setVector4(H,c){this._cacheFloat4(H,c.x,c.y,c.z,c.w)&&(this.kd.setFloat4(this._uniforms[H],c.x,c.y,c.z,c.w)||(this._valueCache[H]=null))}setQuaternion(H,c){this._cacheFloat4(H,c.x,c.y,c.z,c.w)&&(this.kd.setFloat4(this._uniforms[H],c.x,c.y,c.z,c.w)||(this._valueCache[H]=null))}setFloat4(H,c,y,Z,F){this._cacheFloat4(H,c,y,Z,F)&&(this.kd.setFloat4(this._uniforms[H],c,y,Z,F)||(this._valueCache[H]=null))}setColor3(H,c){this._cacheFloat3(H,c.r,c.g,c.b)&&(this.kd.setFloat3(this._uniforms[H],c.r,c.g,c.b)||(this._valueCache[H]=null))}setColor4(H,c,y){this._cacheFloat4(H,c.r,c.g,c.b,y)&&(this.kd.setFloat4(this._uniforms[H],c.r,c.g,c.b,y)||(this._valueCache[H]=null))}setDirectColor4(H,c){this._cacheFloat4(H,c.r,c.g,c.b,c.a)&&(this.kd.setFloat4(this._uniforms[H],c.r,c.g,c.b,c.a)||(this._valueCache[H]=null))}_getVertexShaderCode(){return this.vertexShader?this.kd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.kd._getShaderSource(this.fragmentShader):null}}var F=y(10840);const P=new WeakMap,S={_webGLVersion:2,cachedPipelines:{}};function n(H){let c=P.get(H);if(!c){if(!H)return S;c={_webGLVersion:H.TEXTURE_BINDING_3D?2:1,_context:H,cachedPipelines:{}},P.set(H,c)}return c}function O(H){P.delete(H)}function a(H,c,y,Z,F,P){const S=n(Z);P||(P=S._createShaderProgramInjection??g);return P(H,V(c,"vertex",Z,S._contextWasLost),V(y,"fragment",Z,S._contextWasLost),Z,F,S.validateShaderPrograms)}function i(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0;const O=n(F);S||(S=O._createShaderProgramInjection??g);const a=O._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return S(H,z(c,"vertex",Z,a,F,O._contextWasLost),z(y,"fragment",Z,a,F,O._contextWasLost),F,P,O.validateShaderPrograms)}function C(H,c){const y=new Z,F=n(H);return F.parallelShaderCompile&&(y.isParallelCompiled=!0),y.context=F._context,y}function g(H,c,y,Z){let F=arguments.length>5?arguments[5]:void 0;const P=Z.createProgram();if(H.program=P,!P)throw new Error("Unable to create program");return Z.attachShader(P,c),Z.attachShader(P,y),Z.linkProgram(P),H.context=Z,H.vertexShader=c,H.fragmentShader=y,H.isParallelCompiled||v(H,Z,F),P}function v(H,c,y){const Z=H.context,F=H.vertexShader,P=H.fragmentShader,S=H.program;if(!Z.getProgramParameter(S,Z.LINK_STATUS)){if(!c.getShaderParameter(F,c.COMPILE_STATUS)){const y=c.getShaderInfoLog(F);if(y)throw H.vertexCompilationError=y,new Error("VERTEX SHADER "+y)}if(!c.getShaderParameter(P,c.COMPILE_STATUS)){const y=c.getShaderInfoLog(P);if(y)throw H.fragmentCompilationError=y,new Error("FRAGMENT SHADER "+y)}const y=Z.getProgramInfoLog(S);if(y)throw H.programLinkError=y,new Error(y)}if(y){Z.validateProgram(S);if(!Z.getProgramParameter(S,Z.VALIDATE_STATUS)){const c=Z.getProgramInfoLog(S);if(c)throw H.programValidationError=c,new Error(c)}}Z.deleteShader(F),Z.deleteShader(P),H.vertexShader=void 0,H.fragmentShader=void 0,H.onCompiled&&(H.onCompiled(),H.onCompiled=void 0)}function m(H,c,y,Z,F,P,S,O,C){let g=arguments.length>10?arguments[10]:void 0,v=arguments.length>11?arguments[11]:void 0,m=arguments.length>12?arguments[12]:void 0;const z=n(H.context);v||(v=z.createRawShaderProgramInjection??a),m||(m=z.createShaderProgramInjection??i);const V=H;V.program=Z?v(V,c,y,V.context,C):m(V,c,y,O,V.context,C),V.program.__SPECTOR_rebuildProgram=S,g()}function z(H,c,y,Z,P,S){return V((0,F.g)(H,y,Z),c,P,S)}function V(H,c,y,Z){const F=y.createShader("vertex"===c?y.VERTEX_SHADER:y.FRAGMENT_SHADER);if(!F){let H=y.NO_ERROR,F=y.NO_ERROR;for(;(F=y.getError())!==y.NO_ERROR;)H=F;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${H}, gl isContextLost=${y.isContextLost()}, _contextWasLost=${Z}`)}return y.shaderSource(F,H),y.compileShader(F),F}function h(H,c){c.useProgram(H)}function Q(H,c){const y=H;if(!y.isParallelCompiled)return void c(H);const Z=y.onCompiled;y.onCompiled=()=>{null===Z||void 0===Z||Z(),c(H)}}},11534:(H,c,y)=>{"use strict";y.r(c),y.d(c,{ThinEngine:()=>D});var Z=y(10869),F=y(11542),P=y(10773),S=y(10768);class n{constructor(){this.shaderLanguage=0}postProcessor(H,c,y,Z,F){if(F.drawBuffersExtensionDisabled){const c=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;H=H.replace(c,"")}return H}}const O=/(flat\s)?\s*varying\s*.*/;class a{constructor(){this.shaderLanguage=0}attributeProcessor(H){return H.replace("attribute","in")}varyingCheck(H,c){return O.test(H)}varyingProcessor(H,c){return H.replace("varying",c?"in":"out")}postProcessor(H,c,y){const Z=-1!==H.search(/#extension.+GL_EXT_draw_buffers.+require/);if(H=(H=H.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),y){const c=-1!==H.search(/layout *\(location *= *0\) *out/g);H=(H=(H=(H=(H=(H=(H=H.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(Z||c?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==c.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+H}return H}}var i=y(11547),C=y(10908),g=y(10850),v=y(11552),m=y(10877),z=y(10853),V=y(10840),h=y(10864);class Q{}class D extends g.e{get name(){return this._name}set name(H){this._name=H}get version(){return this._webGLVersion}static get ShadersRepository(){return z.d.ShadersRepository}static set ShadersRepository(H){z.d.ShadersRepository=H}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(H){this._framebufferDimensionsObject=H}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(H,c,y,F){if(y=y||{},super(c??y.antialias,y,F),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!H)return;let S=null;if(H.getContext){if(S=H,this._renderingCanvas=S,void 0===y.ph&&(y.ph=!1),void 0===y.xrCompatible&&(y.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const H=navigator.userAgent;for(const c of D.ExceptionList){const Z=c.key,F=c.targets;if(new RegExp(Z).test(H)){if(c.capture&&c.captureConstraint){const y=c.capture,Z=c.captureConstraint,F=new RegExp(y).exec(H);if(F&&F.length>0){if(parseInt(F[F.length-1])>=Z)continue}}for(const H of F)switch(H){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":y.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=H=>{H.preventDefault(),this._contextWasLost=!0,P.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},S.addEventListener("webglcontextlost",this._onContextLost,!1),S.addEventListener("webglcontextrestored",this._onContextRestored,!1),y.powerPreference=y.powerPreference||"high-performance"),this._badDesktopOS&&(y.xrCompatible=!1),!y.disableWebGL2Support)try{this._gl=S.getContext("webgl2",y)||S.getContext("experimental-webgl2",y),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(C){}if(!this._gl){if(!S)throw new Error("The provided canvas is null or undefined.");try{this._gl=S.getContext("webgl",y)||S.getContext("experimental-webgl",y)}catch(C){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=H,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const c=this._gl.getContextAttributes();c&&(y.stencil=c.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==y.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=y.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let Z=0;Z<this._caps.maxVertexAttribs;Z++)this._currentBufferPointers[Z]=new Q;this._shaderProcessor=this.webGLVersion>1?new a:new n;const O=`Babylon.js v${D.Version}`;P.d.Log(O+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",O);const i=(0,Z.x)(this._gl);i.validateShaderPrograms=this.validateShaderPrograms,i.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(H){return null}areAllEffectsReady(){for(const H in this._compiledEffects){if(!this._compiledEffects[H].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const H=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=H&&(this._glRenderer=this._gl.getParameter(H.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(H.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const H=this._gl.getExtension("WEBGL_draw_buffers");if(null!==H){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=H.drawBuffersWEBGL.bind(H),this._caps.maxDrawBuffers=this._gl.getParameter(H.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let c=0;c<16;c++)this._gl["COLOR_ATTACHMENT"+c+"_WEBGL"]=H["COLOR_ATTACHMENT"+c+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const H=this._gl.getExtension("WEBGL_depth_texture");null!=H&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=H.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const H=this._gl.getExtension("OES_vertex_array_object");null!=H&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=H.createVertexArrayOES.bind(H),this._gl.bindVertexArray=H.bindVertexArrayOES.bind(H),this._gl.deleteVertexArray=H.deleteVertexArrayOES.bind(H))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const H=this._gl.getExtension("ANGLE_instanced_arrays");null!=H?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=H.drawArraysInstancedANGLE.bind(H),this._gl.drawElementsInstanced=H.drawElementsInstancedANGLE.bind(H),this._gl.vertexAttribDivisor=H.vertexAttribDivisorANGLE.bind(H)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const H=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),c=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);H&&c&&(this._caps.highPrecisionShaderSupported=0!==H.precision&&0!==c.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const H=this._gl.getExtension("EXT_blend_minmax");null!=H&&(this._caps.blendMinMax=!0,this._gl.MAX=H.MAX_EXT,this._gl.MIN=H.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const H=this._gl.getExtension("EXT_sRGB");null!=H&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:H.SRGB_EXT,SRGB8:H.SRGB_ALPHA_EXT,SRGB8_ALPHA8:H.SRGB_ALPHA_EXT})}if(this._creationOptions){const H=this._creationOptions.forceSRGBBufferSupportState;void 0!==H&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&H)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const H=this._workingCanvas.getContext("2d");H&&(this._workingContext=H)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const H=this.getGlInfo();return H&&H.renderer?H.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=F;let P=0;if(c&&H){let c=!0;if(this._currentRenderTarget){var S;const y=null===(S=this._currentRenderTarget.texture)||void 0===S?void 0:S.format;if(8===y||9===y||10===y||11===y){var n;const y=null===(n=this._currentRenderTarget.texture)||void 0===n?void 0:n.type;7===y||5===y?(D._TempClearColorUint32[0]=255*H.r,D._TempClearColorUint32[1]=255*H.g,D._TempClearColorUint32[2]=255*H.b,D._TempClearColorUint32[3]=255*H.a,this._gl.clearBufferuiv(this._gl.COLOR,0,D._TempClearColorUint32),c=!1):(D._TempClearColorInt32[0]=255*H.r,D._TempClearColorInt32[1]=255*H.g,D._TempClearColorInt32[2]=255*H.b,D._TempClearColorInt32[3]=255*H.a,this._gl.clearBufferiv(this._gl.COLOR,0,D._TempClearColorInt32),c=!1)}}c&&(this._gl.clearColor(H.r,H.g,H.b,void 0!==H.a?H.a:1),P|=this._gl.COLOR_BUFFER_BIT)}y&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),P|=this._gl.DEPTH_BUFFER_BIT),Z&&(this._gl.clearStencil(0),P|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(P)}_viewport(H,c,y,Z){H===this._viewportCached.x&&c===this._viewportCached.y&&y===this._viewportCached.z&&Z===this._viewportCached.w||(this._viewportCached.x=H,this._viewportCached.y=c,this._viewportCached.z=y,this._viewportCached.w=Z,this._gl.viewport(H,c,y,Z))}fj(){super.fj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const O=H;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=H,this._bindUnboundFramebuffer(O._framebuffer);const a=this._gl;var i;if(!H.isMulti)if(H.is2DArray||H.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,null===(i=H.texture._hardwareTexture)||void 0===i?void 0:i.underlyingResource,S,n),O._currentLOD=S;else if(H.isCube){var C;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(C=H.texture._hardwareTexture)||void 0===C?void 0:C.underlyingResource,S)}else if(O._currentLOD!==S){var g;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null===(g=H.texture._hardwareTexture)||void 0===g?void 0:g.underlyingResource,S),O._currentLOD=S}const v=H._depthStencilTexture;if(v){H.is3D&&(H.texture.width===v.width&&H.texture.height===v.height&&H.texture.depth===v.depth||P.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const y=H._depthStencilTextureWithStencil?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;var m;if(H.is2DArray||H.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,y,null===(m=v._hardwareTexture)||void 0===m?void 0:m.underlyingResource,S,n);else if(H.isCube){var z;a.framebufferTexture2D(a.FRAMEBUFFER,y,a.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(z=v._hardwareTexture)||void 0===z?void 0:z.underlyingResource,S)}else{var V;a.framebufferTexture2D(a.FRAMEBUFFER,y,a.TEXTURE_2D,null===(V=v._hardwareTexture)||void 0===V?void 0:V.underlyingResource,S)}}O._MSAAFramebuffer&&this._bindUnboundFramebuffer(O._MSAAFramebuffer),this._cachedViewport&&!F?this.setViewport(this._cachedViewport,y,Z):(y||(y=H.width,S&&(y/=Math.pow(2,S))),Z||(Z=H.height,S&&(Z/=Math.pow(2,S))),this._viewport(0,0,y,Z)),this.wipeCaches()}setState(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==H||y)&&(this._depthCullingState.cull=H);const n=this.cullBackFaces??F??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==n||y)&&(this._depthCullingState.cullFace=n),this.setZOffset(c),this.setZOffsetUnits(S);const O=Z?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==O||y)&&(this._depthCullingState.frontFace=O),this._stencilStateComposer.stencilMaterial=P}_bindUnboundFramebuffer(H){this._currentFramebuffer!==H&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,H),this._currentFramebuffer=H)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(H){const c=this._getTextureTarget(H);this._bindTextureDirectly(c,H,!0),this._gl.generateMipmap(c),this._bindTextureDirectly(c,null)}unBindFramebuffer(H){var c;let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;const F=H;this._currentRenderTarget=null;const P=this._gl;if(F._MSAAFramebuffer){if(H.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(H,y,Z);P.bindFramebuffer(P.READ_FRAMEBUFFER,F._MSAAFramebuffer),P.bindFramebuffer(P.DRAW_FRAMEBUFFER,F._framebuffer),P.blitFramebuffer(0,0,H.width,H.height,0,0,H.width,H.height,P.COLOR_BUFFER_BIT,P.NEAREST)}null===(c=H.texture)||void 0===c||!c.generateMipMaps||y||H.isCube||this.generateMipmaps(H.texture),Z&&(F._MSAAFramebuffer&&this._bindUnboundFramebuffer(F._framebuffer),Z()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(H,c,y){return this._createVertexBuffer(H,this._gl.STATIC_DRAW)}_createVertexBuffer(H,c){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create vertex buffer");const Z=new i.e(y);return this.bindArrayBuffer(Z),"number"!==typeof H?H instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(H),c),Z.mb=4*H.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,H,c),Z.mb=H.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(H),c),Z.mb=H),this._resetVertexBufferBinding(),Z.references=1,Z}createDynamicVertexBuffer(H,c){return this._createVertexBuffer(H,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(H,c,y){const Z=this._gl.createBuffer(),F=new i.e(Z);if(!Z)throw new Error("Unable to create index buffer");this.bindIndexBuffer(F);const P=this._normalizeIndexData(H);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,P,c?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),F.references=1,F.is32Bits=4===P.BYTES_PER_ELEMENT,F}_normalizeIndexData(H){if(2===H.BYTES_PER_ELEMENT)return H;if(this._caps.uintIndices){if(H instanceof Uint32Array)return H;for(let c=0;c<H.length;c++)if(H[c]>=65535)return new Uint32Array(H);return new Uint16Array(H)}return new Uint16Array(H)}bindArrayBuffer(H){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(H,this._gl.ARRAY_BUFFER)}bindUniformBlock(H,c,y){const Z=H.program,F=this._gl.getUniformBlockIndex(Z,c);this._gl.uniformBlockBinding(Z,F,y)}bindIndexBuffer(H){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(H,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(H,c){(this._vaoRecordInProgress||this._currentBoundBuffer[c]!==H)&&(this._gl.bindBuffer(c,H?H.underlyingResource:null),this._currentBoundBuffer[c]=H)}updateArrayBuffer(H){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,H)}_vertexAttribPointer(H,c,y,Z,F,P,S){const n=this._currentBufferPointers[c];if(!n)return;let O=!1;n.active?(n.buffer!==H&&(n.buffer=H,O=!0),n.size!==y&&(n.size=y,O=!0),n.type!==Z&&(n.type=Z,O=!0),n.normalized!==F&&(n.normalized=F,O=!0),n.stride!==P&&(n.stride=P,O=!0),n.offset!==S&&(n.offset=S,O=!0)):(O=!0,n.active=!0,n.index=c,n.size=y,n.type=Z,n.normalized=F,n.stride=P,n.offset=S,n.buffer=H),(O||this._vaoRecordInProgress)&&(this.bindArrayBuffer(H),Z===this._gl.UNSIGNED_INT||Z===this._gl.INT?this._gl.vertexAttribIPointer(c,y,Z,P,S):this._gl.vertexAttribPointer(c,y,Z,F,P,S))}_bindIndexBufferWithCache(H){null!=H&&this._cachedIndexBuffer!==H&&(this._cachedIndexBuffer=H,this.bindIndexBuffer(H),this._uintIndicesCurrentlySet=H.is32Bits)}_bindVertexBuffersAttributes(H,c,y){const Z=c.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let F=0;F<Z.length;F++){const P=c.getAttributeLocation(F);if(P>=0){const c=Z[F];let S=null;if(y&&(S=y[c]),S||(S=H[c]),!S)continue;this._gl.enableVertexAttribArray(P),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[P]=!0);const n=S.getBuffer();n&&(this._vertexAttribPointer(n,P,S.getSize(),S.type,S.normalized,S.byteStride,S.byteOffset),S.getIsInstanced()&&(this._gl.vertexAttribDivisor(P,S.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(P),this._currentInstanceBuffers.push(n))))}}}recordVertexArrayObject(H,c,y,Z){const F=this._gl.createVertexArray();if(!F)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(F),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(H,y,Z),this.bindIndexBuffer(c),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),F}bindVertexArrayObject(H,c){this._cachedVertexArrayObject!==H&&(this._cachedVertexArrayObject=H,this._gl.bindVertexArray(H),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=c&&c.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(H,c,y,Z,F){if(this._cachedVertexBuffers!==H||this._cachedEffectForVertexBuffers!==F){this._cachedVertexBuffers=H,this._cachedEffectForVertexBuffers=F;const c=F.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let P=0;for(let S=0;S<c;S++)if(S<y.length){const c=F.getAttributeLocation(S);c>=0&&(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0,this._vertexAttribPointer(H,c,y[S],this._gl.FLOAT,!1,Z,P)),P+=4*y[S]}}this._bindIndexBufferWithCache(c)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(H,c,y,Z){this._cachedVertexBuffers===H&&this._cachedEffectForVertexBuffers===y||(this._cachedVertexBuffers=H,this._cachedEffectForVertexBuffers=y,this._bindVertexBuffersAttributes(H,y,Z)),this._bindIndexBufferWithCache(c)}unbindInstanceAttributes(){let H;for(let c=0,y=this._currentInstanceLocations.length;c<y;c++){const y=this._currentInstanceBuffers[c];H!=y&&y.references&&(H=y,this.bindArrayBuffer(y));const Z=this._currentInstanceLocations[c];this._gl.vertexAttribDivisor(Z,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(H){this._gl.deleteVertexArray(H)}_releaseBuffer(H){return H.references--,0===H.references&&(this._deleteBuffer(H),!0)}_deleteBuffer(H){this._gl.deleteBuffer(H.underlyingResource)}updateAndBindInstancesBuffer(H,c,y){if(this.bindArrayBuffer(H),c&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c),void 0!==y[0].index)this.bindInstancesBuffer(H,y,!0);else for(let Z=0;Z<4;Z++){const c=y[Z];this._vertexAttribArraysEnabled[c]||(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0),this._vertexAttribPointer(H,c,4,this._gl.FLOAT,!1,64,16*Z),this._gl.vertexAttribDivisor(c,1),this._currentInstanceLocations.push(c),this._currentInstanceBuffers.push(H)}}bindInstancesBuffer(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(H);let Z=0;if(y)for(let F=0;F<c.length;F++){Z+=4*c[F].attributeSize}for(let F=0;F<c.length;F++){const y=c[F];void 0===y.index&&(y.index=this._currentEffect.getAttributeLocationByName(y.attributeName)),y.index<0||(this._vertexAttribArraysEnabled[y.index]||(this._gl.enableVertexAttribArray(y.index),this._vertexAttribArraysEnabled[y.index]=!0),this._vertexAttribPointer(H,y.index,y.attributeSize,y.attributeType||this._gl.FLOAT,y.normalized||!1,Z,y.offset),this._gl.vertexAttribDivisor(y.index,void 0===y.divisor?1:y.divisor),this._currentInstanceLocations.push(y.index),this._currentInstanceBuffers.push(H))}}disableInstanceAttributeByName(H){if(!this._currentEffect)return;const c=this._currentEffect.getAttributeLocationByName(H);this.disableInstanceAttribute(c)}disableInstanceAttribute(H){let c,y=!1;for(;-1!==(c=this._currentInstanceLocations.indexOf(H));)this._currentInstanceLocations.splice(c,1),this._currentInstanceBuffers.splice(c,1),y=!0,c=this._currentInstanceLocations.indexOf(H);y&&(this._gl.vertexAttribDivisor(H,0),this.disableAttributeByIndex(H))}disableAttributeByIndex(H){this._gl.disableVertexAttribArray(H),this._vertexAttribArraysEnabled[H]=!1,this._currentBufferPointers[H].active=!1}draw(H,c,y,Z){this.drawElementsType(H?0:1,c,y,Z)}drawPointClouds(H,c,y){this.drawArraysType(2,H,c,y)}drawUnIndexed(H,c,y,Z){this.drawArraysType(H?0:1,c,y,Z)}drawElementsType(H,c,y,Z){this.applyStates(),this._reportDrawCall();const F=this._drawMode(H),P=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,S=this._uintIndicesCurrentlySet?4:2;Z?this._gl.drawElementsInstanced(F,y,P,c*S,Z):this._gl.drawElements(F,y,P,c*S)}drawArraysType(H,c,y,Z){this.applyStates(),this._reportDrawCall();const F=this._drawMode(H);Z?this._gl.drawArraysInstanced(F,c,y,Z):this._gl.drawArrays(F,c,y)}_drawMode(H){switch(H){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(H){this._compiledEffects[H._key]&&delete this._compiledEffects[H._key];const c=H.getPipelineContext();c&&this._deletePipelineContext(c)}_deletePipelineContext(H){const c=H;c&&c.program&&(c.program.__SPECTOR_rebuildProgram=null,(0,h.h)(c),this._gl.deleteProgram(c.program))}_getGlobalDefines(H){return(0,V.j)(H,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(H,c,y,F,P,S,n,O,a){let i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10?arguments[10]:void 0;const g="string"===typeof H?H:H.vertexToken||H.vertexSource||H.vertexElement||H.vertex,v="string"===typeof H?H:H.fragmentToken||H.fragmentSource||H.fragmentElement||H.fragment,m=this._getGlobalDefines();let V=P??c.defines??"";m&&(V+=m);const h=g+"+"+v+"@"+V;if(this._compiledEffects[h]){const H=this._compiledEffects[h];return n&&H.isReady()&&n(H),H._refCount++,H}this._gl&&(0,Z.x)(this._gl);const Q=new z.d(H,c,y,F,this,P,S,n,O,a,h,c.shaderLanguage??i,c.extraInitializationsAsync??C);return this._compiledEffects[h]=Q,Q}_getShaderSource(H){return this._gl.getShaderSource(H)}createRawShaderProgram(H,c,y,F){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=(0,Z.x)(this._gl);return S._contextWasLost=this._contextWasLost,S.validateShaderPrograms=this.validateShaderPrograms,(0,Z.r)(H,c,y,F||this._gl,P)}createShaderProgram(H,c,y,F,P){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const n=(0,Z.x)(this._gl);return n._contextWasLost=this._contextWasLost,n.validateShaderPrograms=this.validateShaderPrograms,(0,Z.u)(H,c,y,F,P||this._gl,S)}inlineShaderCode(H){return H}createPipelineContext(H){if(this._gl){(0,Z.x)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const c=(0,Z.p)(this._gl,H);return c.kd=this,c}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(H){return(0,Z.i)(H,this._gl,this.validateShaderPrograms)}_preparePipelineContext(H,c,y,F,P,S,n,O,a,i,C){const g=(0,Z.x)(this._gl);return g._contextWasLost=this._contextWasLost,g.validateShaderPrograms=this.validateShaderPrograms,g._createShaderProgramInjection=this._createShaderProgram.bind(this),g.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),g.createShaderProgramInjection=this.createShaderProgram.bind(this),g.loadFileInjection=this._loadFile.bind(this),(0,Z.l)(H,c,y,F,P,S,n,O,a,i,C)}_createShaderProgram(H,c,y,F){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,Z.b)(H,c,y,F,P)}_isRenderingStateCompiled(H){const c=H;return!this._isDisposed&&!c._isDisposed&&(!!this._gl.getProgramParameter(c.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(c),!0))}_executeWhenRenderingStateIsCompiled(H,c){(0,Z.f)(H,c)}getUniforms(H,c){const y=new Array,Z=H;for(let F=0;F<c.length;F++)y.push(this._gl.getUniformLocation(Z.program,c[F]));return y}getAttributes(H,c){const y=[],Z=H;for(let P=0;P<c.length;P++)try{y.push(this._gl.getAttribLocation(Z.program,c[P]))}catch(F){y.push(-1)}return y}enableEffect(H){(H=null!==H&&(0,F.b)(H)?H.effect:H)&&H!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(H),this._currentEffect=H,H.onBind&&H.onBind(H),H._onBindObservable&&H._onBindObservable.notifyObservers(H))}setInt(H,c){return!!H&&(this._gl.uniform1i(H,c),!0)}setInt2(H,c,y){return!!H&&(this._gl.uniform2i(H,c,y),!0)}setInt3(H,c,y,Z){return!!H&&(this._gl.uniform3i(H,c,y,Z),!0)}setInt4(H,c,y,Z,F){return!!H&&(this._gl.uniform4i(H,c,y,Z,F),!0)}setIntArray(H,c){return!!H&&(this._gl.uniform1iv(H,c),!0)}setIntArray2(H,c){return!(!H||c.length%2!==0)&&(this._gl.uniform2iv(H,c),!0)}setIntArray3(H,c){return!(!H||c.length%3!==0)&&(this._gl.uniform3iv(H,c),!0)}setIntArray4(H,c){return!(!H||c.length%4!==0)&&(this._gl.uniform4iv(H,c),!0)}setUInt(H,c){return!!H&&(this._gl.uniform1ui(H,c),!0)}setUInt2(H,c,y){return!!H&&(this._gl.uniform2ui(H,c,y),!0)}setUInt3(H,c,y,Z){return!!H&&(this._gl.uniform3ui(H,c,y,Z),!0)}setUInt4(H,c,y,Z,F){return!!H&&(this._gl.uniform4ui(H,c,y,Z,F),!0)}setUIntArray(H,c){return!!H&&(this._gl.uniform1uiv(H,c),!0)}setUIntArray2(H,c){return!(!H||c.length%2!==0)&&(this._gl.uniform2uiv(H,c),!0)}setUIntArray3(H,c){return!(!H||c.length%3!==0)&&(this._gl.uniform3uiv(H,c),!0)}setUIntArray4(H,c){return!(!H||c.length%4!==0)&&(this._gl.uniform4uiv(H,c),!0)}setArray(H,c){return!!H&&(!(c.length<1)&&(this._gl.uniform1fv(H,c),!0))}setArray2(H,c){return!(!H||c.length%2!==0)&&(this._gl.uniform2fv(H,c),!0)}setArray3(H,c){return!(!H||c.length%3!==0)&&(this._gl.uniform3fv(H,c),!0)}setArray4(H,c){return!(!H||c.length%4!==0)&&(this._gl.uniform4fv(H,c),!0)}setMatrices(H,c){return!!H&&(this._gl.uniformMatrix4fv(H,!1,c),!0)}setMatrix3x3(H,c){return!!H&&(this._gl.uniformMatrix3fv(H,!1,c),!0)}setMatrix2x2(H,c){return!!H&&(this._gl.uniformMatrix2fv(H,!1,c),!0)}setFloat(H,c){return!!H&&(this._gl.uniform1f(H,c),!0)}setFloat2(H,c,y){return!!H&&(this._gl.uniform2f(H,c,y),!0)}setFloat3(H,c,y,Z){return!!H&&(this._gl.uniform3f(H,c,y,Z),!0)}setFloat4(H,c,y,Z,F){return!!H&&(this._gl.uniform4f(H,c,y,Z,F),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const H=this._colorWrite;this._gl.colorMask(H,H,H,H)}}wipeCaches(H){this.preventCacheWipeBetweenFrames&&!H||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),H&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(H,c){const y=this._gl;let Z=y.NEAREST,F=y.NEAREST;switch(H){case 11:Z=y.LINEAR,F=c?y.LINEAR_MIPMAP_NEAREST:y.LINEAR;break;case 3:Z=y.LINEAR,F=c?y.LINEAR_MIPMAP_LINEAR:y.LINEAR;break;case 8:Z=y.NEAREST,F=c?y.NEAREST_MIPMAP_LINEAR:y.NEAREST;break;case 4:Z=y.NEAREST,F=c?y.NEAREST_MIPMAP_NEAREST:y.NEAREST;break;case 5:Z=y.NEAREST,F=c?y.LINEAR_MIPMAP_NEAREST:y.LINEAR;break;case 6:Z=y.NEAREST,F=c?y.LINEAR_MIPMAP_LINEAR:y.LINEAR;break;case 7:Z=y.NEAREST,F=y.LINEAR;break;case 1:Z=y.NEAREST,F=y.NEAREST;break;case 9:Z=y.LINEAR,F=c?y.NEAREST_MIPMAP_NEAREST:y.NEAREST;break;case 10:Z=y.LINEAR,F=c?y.NEAREST_MIPMAP_LINEAR:y.NEAREST;break;case 2:Z=y.LINEAR,F=y.LINEAR;break;case 12:Z=y.LINEAR,F=y.NEAREST}return{min:F,mag:Z}}_createTexture(){const H=this._gl.createTexture();if(!H)throw new Error("Unable to create texture");return H}_createHardwareTexture(){return new v.e(this._createTexture(),this._gl)}_createInternalTexture(H,c){let y,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=!1,S=0,n=3,O=5,a=!1,i=1;void 0!==c&&"object"===typeof c?(F=!!c.generateMipMaps,S=void 0===c.type?0:c.type,n=void 0===c.samplingMode?3:c.samplingMode,O=void 0===c.format?5:c.format,a=void 0!==c.useSRGBBuffer&&c.useSRGBBuffer,i=c.samples??1,y=c.label):F=!!c,a&&(a=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==S||this._caps.textureFloatLinearFiltering)&&(2!==S||this._caps.textureHalfFloatLinearFiltering)||(n=1),1!==S||this._caps.textureFloat||(S=0,P.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const C=this._gl,g=new m.b(this,Z),v=H.width||H,z=H.height||H,V=H.depth||0,h=H.layers||0,Q=this._getSamplingParameters(n,F),D=0!==h?C.TEXTURE_2D_ARRAY:0!==V?C.TEXTURE_3D:C.TEXTURE_2D,f=this._getRGBABufferInternalSizedFormat(S,O,a),J=this._getInternalFormat(O),l=this._getWebGLTextureType(S);return this._bindTextureDirectly(D,g),0!==h?(g.is2DArray=!0,C.texImage3D(D,0,f,v,z,h,0,J,l,null)):0!==V?(g.is3D=!0,C.texImage3D(D,0,f,v,z,V,0,J,l,null)):C.texImage2D(D,0,f,v,z,0,J,l,null),C.texParameteri(D,C.TEXTURE_MAG_FILTER,Q.mag),C.texParameteri(D,C.TEXTURE_MIN_FILTER,Q.min),C.texParameteri(D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),F&&this._gl.generateMipmap(D),this._bindTextureDirectly(D,null),g._useSRGBBuffer=a,g.baseWidth=v,g.baseHeight=z,g.width=v,g.height=z,g.depth=h,g.isReady=!0,g.samples=i,g.generateMipMaps=F,g.samplingMode=n,g.type=S,g.format=O,g.label=y,this._internalTexturesCache.push(g),g}_getUseSRGBBuffer(H,c){return H&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||c)}createTexture(H,c,y,Z){var F=this;let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,g=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0,z=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(H,c,y,Z,P,S,n,(function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];return F._prepareWebGLTexture(...c,i)}),((H,c,y,F,P,S)=>{const n=this._gl,O=y.width===H&&y.height===c;P._creationFlags=z??0;const a=this._getTexImageParametersForCreateTexture(P.format,P._useSRGBBuffer);if(O)return n.texImage2D(n.TEXTURE_2D,0,a.internalFormat,a.format,a.type,y),!1;const i=this._caps.maxTextureSize;if(y.width>i||y.height>i||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=H,this._workingCanvas.height=c,this._workingContext.drawImage(y,0,0,y.width,y.height,0,0,H,c),n.texImage2D(n.TEXTURE_2D,0,a.internalFormat,a.format,a.type,this._workingCanvas),P.width=H,P.height=c,!1);{const H=new m.b(this,2);this._bindTextureDirectly(n.TEXTURE_2D,H,!0),n.texImage2D(n.TEXTURE_2D,0,a.internalFormat,a.format,a.type,y),this._rescaleTexture(H,P,Z,a.format,(()=>{this._releaseTexture(H),this._bindTextureDirectly(n.TEXTURE_2D,P,!0),S()}))}return!0}),O,a,i,C,g,v,V)}_getTexImageParametersForCreateTexture(H,c){let y,Z;return 1===this.webGLVersion?(y=this._getInternalFormat(H,c),Z=y):(y=this._getInternalFormat(H,!1),Z=this._getRGBABufferInternalSizedFormat(0,H,c)),{internalFormat:Z,format:y,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(H,c,y,Z,F){}_unpackFlipY(H){this._unpackFlipYCached!==H&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,H?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=H))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(H){return H.isCube?this._gl.TEXTURE_CUBE_MAP:H.is3D?this._gl.TEXTURE_3D:H.is2DArray||H.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=this._getTextureTarget(c),F=this._getSamplingParameters(H,c.useMipMaps||y);this._setTextureParameterInteger(Z,this._gl.TEXTURE_MAG_FILTER,F.mag,c),this._setTextureParameterInteger(Z,this._gl.TEXTURE_MIN_FILTER,F.min),y&&(c.generateMipMaps=!0,this._gl.generateMipmap(Z)),this._bindTextureDirectly(Z,null),c.samplingMode=H}updateTextureDimensions(H,c,y){}updateTextureWrappingMode(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const F=this._getTextureTarget(H);null!==c&&(this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c),H),H._cachedWrapU=c),null!==y&&(this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(y),H),H._cachedWrapV=y),(H.is2DArray||H.is3D)&&null!==Z&&(this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(Z),H),H._cachedWrapR=Z),this._bindTextureDirectly(F,null)}_uploadCompressedDataToTextureDirectly(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const n=this._gl;let O=n.TEXTURE_2D;if(H.isCube&&(O=n.TEXTURE_CUBE_MAP_POSITIVE_X+P),H._useSRGBBuffer)switch(c){case 37492:case 36196:this._caps.etc2?c=n.COMPRESSED_SRGB8_ETC2:H._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?c=n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:H._useSRGBBuffer=!1;break;case 36492:c=n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:c=n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?c=n.COMPRESSED_SRGB_S3TC_DXT1_EXT:H._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?c=n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:H._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?c=n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:H._useSRGBBuffer=!1;break;default:H._useSRGBBuffer=!1}this._gl.compressedTexImage2D(O,S,c,y,Z,0,F)}_uploadDataToTextureDirectly(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=this._gl,n=this._getWebGLTextureType(H.type),O=this._getInternalFormat(H.format),a=void 0===F?this._getRGBABufferInternalSizedFormat(H.type,H.format,H._useSRGBBuffer):this._getInternalFormat(F,H._useSRGBBuffer);this._unpackFlipY(H.invertY);let i=S.TEXTURE_2D;H.isCube&&(i=S.TEXTURE_CUBE_MAP_POSITIVE_X+y);const C=Math.round(Math.log(H.width)*Math.LOG2E),g=Math.round(Math.log(H.height)*Math.LOG2E),v=P?H.width:Math.pow(2,Math.max(C-Z,0)),m=P?H.height:Math.pow(2,Math.max(g-Z,0));S.texImage2D(i,Z,a,v,m,0,O,n,c)}updateTextureData(H,c,y,Z,F,P){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=this._gl,i=this._getWebGLTextureType(H.type),C=this._getInternalFormat(H.format);this._unpackFlipY(H.invertY);let g=a.TEXTURE_2D,v=a.TEXTURE_2D;H.isCube&&(v=a.TEXTURE_CUBE_MAP_POSITIVE_X+S,g=a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(g,H,!0),a.texSubImage2D(v,n,y,Z,F,P,C,i,c),O&&this._gl.generateMipmap(v),this._bindTextureDirectly(g,null)}_uploadArrayBufferViewToTexture(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const F=this._gl,P=H.isCube?F.TEXTURE_CUBE_MAP:F.TEXTURE_2D;this._bindTextureDirectly(P,H,!0),this._uploadDataToTextureDirectly(H,c,y,Z),this._bindTextureDirectly(P,null,!0)}_prepareWebGLTextureContinuation(H,c,y,Z,F){const P=this._gl;if(!P)return;const S=this._getSamplingParameters(F,!y);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,S.mag),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,S.min),y||Z||P.generateMipmap(P.TEXTURE_2D),this._bindTextureDirectly(P.TEXTURE_2D,null),c&&c.removePendingData(H),H.onLoadedObservable.notifyObservers(H),H.onLoadedObservable.clear()}_prepareWebGLTexture(H,c,y,Z,F,P,S,n,O,a){const i=this.getCaps().maxTextureSize,g=Math.min(i,this.needPOTTextures?(0,C.c)(Z.width,i):Z.width),v=Math.min(i,this.needPOTTextures?(0,C.c)(Z.height,i):Z.height),m=this._gl;m&&(H._hardwareTexture?(this._bindTextureDirectly(m.TEXTURE_2D,H,!0),this._unpackFlipY(void 0===F||!!F),H.baseWidth=Z.width,H.baseHeight=Z.height,H.width=g,H.height=v,H.isReady=!0,H.type=-1!==H.type?H.type:0,H.format=-1!==H.format?H.format:a??(".jpg"!==c||H._useSRGBBuffer?5:4),n(g,v,Z,c,H,(()=>{this._prepareWebGLTextureContinuation(H,y,P,S,O)}))||this._prepareWebGLTextureContinuation(H,y,P,S,O)):y&&y.removePendingData(H))}_getInternalFormatFromDepthTextureFormat(H,c,y){const Z=this._gl;if(!c)return Z.STENCIL_INDEX8;let F=y?Z.DEPTH_STENCIL:Z.DEPTH_COMPONENT;return this.webGLVersion>1?15===H?F=Z.DEPTH_COMPONENT16:16===H?F=Z.DEPTH_COMPONENT24:17===H||13===H?F=y?Z.DEPTH24_STENCIL8:Z.DEPTH_COMPONENT24:14===H?F=Z.DEPTH_COMPONENT32F:18===H&&(F=y?Z.DEPTH32F_STENCIL8:Z.DEPTH_COMPONENT32F):F=Z.DEPTH_COMPONENT16,F}_setupFramebufferDepthAttachments(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,P=arguments.length>5?arguments[5]:void 0;const S=this._gl;P=P??(H?13:14);const n=this._getInternalFormatFromDepthTextureFormat(P,c,H);return H&&c?this._createRenderBuffer(y,Z,F,S.DEPTH_STENCIL,n,S.DEPTH_STENCIL_ATTACHMENT):c?this._createRenderBuffer(y,Z,F,n,n,S.DEPTH_ATTACHMENT):H?this._createRenderBuffer(y,Z,F,n,n,S.STENCIL_ATTACHMENT):null}_createRenderBuffer(H,c,y,Z,F,P){let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const n=this._gl.createRenderbuffer();return this._updateRenderBuffer(n,H,c,y,Z,F,P,S)}_updateRenderBuffer(H,c,y,Z,F,P,S){let n=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this._gl;return O.bindRenderbuffer(O.RENDERBUFFER,H),Z>1&&O.renderbufferStorageMultisample?O.renderbufferStorageMultisample(O.RENDERBUFFER,Z,P,c,y):O.renderbufferStorage(O.RENDERBUFFER,F,c,y),O.framebufferRenderbuffer(O.FRAMEBUFFER,S,O.RENDERBUFFER,H),n&&O.bindRenderbuffer(O.RENDERBUFFER,null),H}_releaseTexture(H){this._deleteTexture(H._hardwareTexture),this.unbindAllTextures();const c=this._internalTexturesCache.indexOf(H);-1!==c&&this._internalTexturesCache.splice(c,1),H._lodTextureHigh&&H._lodTextureHigh.dispose(),H._lodTextureMid&&H._lodTextureMid.dispose(),H._lodTextureLow&&H._lodTextureLow.dispose(),H._irradianceTexture&&H._irradianceTexture.dispose()}_deleteTexture(H){null===H||void 0===H||H.release()}_setProgram(H){this._currentProgram!==H&&((0,Z.n)(H,this._gl),this._currentProgram=H)}bindSamplers(H){const c=H.getPipelineContext();this._setProgram(c.program);const y=H.getSamplers();for(let Z=0;Z<y.length;Z++){const c=H.getUniform(y[Z]);c&&(this._boundUniforms[Z]=c)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=!1;const S=c&&c._associatedChannel>-1;y&&S&&(this._activeChannel=c._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==c||Z){if(this._activateCurrentTexture(),c&&c.isMultiview)throw P.d.Error(["_bindTextureDirectly called with a multiview texture!",H,c]),"_bindTextureDirectly called with a multiview texture!";var n;this._gl.bindTexture(H,(null===c||void 0===c||null===(n=c._hardwareTexture)||void 0===n?void 0:n.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=c,c&&(c._associatedChannel=this._activeChannel)}else y&&(F=!0,this._activateCurrentTexture());return S&&!y&&this._bindSamplerUniformToChannel(c._associatedChannel,this._activeChannel),F}_bindTexture(H,c,y){if(void 0===H)return;c&&(c._associatedChannel=H),this._activeChannel=H;const Z=c?this._getTextureTarget(c):this._gl.TEXTURE_2D;this._bindTextureDirectly(Z,c)}unbindAllTextures(){for(let H=0;H<this._maxSimultaneousTextures;H++)this._activeChannel=H,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(H,c,y,Z){void 0!==H&&(c&&(this._boundUniforms[H]=c),this._setTexture(H,y))}_bindSamplerUniformToChannel(H,c){const y=this._boundUniforms[H];y&&y._currentState!==c&&(this._gl.uniform1i(y,c),y._currentState=c)}_getTextureWrapMode(H){switch(H){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(H,c){let y,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!c)return null!=this._boundTexturesCache[H]&&(this._activeChannel=H,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(c.video){this._activeChannel=H;const y=c.getInternalTexture();y&&(y._associatedChannel=H),c.update()}else if(4===c.delayLoadState)return c.delayLoad(),!1;y=F?c.depthStencilTexture:c.isReady()?c.getInternalTexture():c.isCube?this.emptyCubeTexture:c.is3D?this.emptyTexture3D:c.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!Z&&y&&(y._associatedChannel=H);let P=!0;this._boundTexturesCache[H]===y&&(Z||this._bindSamplerUniformToChannel(y._associatedChannel,H),P=!1),this._activeChannel=H;const S=this._getTextureTarget(y);if(P&&this._bindTextureDirectly(S,y,Z),y&&!y.isMultiview){if(y.isCube&&y._cachedCoordinatesMode!==c.coordinatesMode){y._cachedCoordinatesMode=c.coordinatesMode;const H=3!==c.coordinatesMode&&5!==c.coordinatesMode?1:0;c.wrapU=H,c.wrapV=H}y._cachedWrapU!==c.wrapU&&(y._cachedWrapU=c.wrapU,this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c.wrapU),y)),y._cachedWrapV!==c.wrapV&&(y._cachedWrapV=c.wrapV,this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(c.wrapV),y)),y.is3D&&y._cachedWrapR!==c.wrapR&&(y._cachedWrapR=c.wrapR,this._setTextureParameterInteger(S,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(c.wrapR),y)),this._setAnisotropicLevel(S,y,c.anisotropicFilteringLevel)}return!0}setTextureArray(H,c,y,Z){if(void 0!==H&&c){this._textureUnits&&this._textureUnits.length===y.length||(this._textureUnits=new Int32Array(y.length));for(let c=0;c<y.length;c++){const Z=y[c].getInternalTexture();Z?(this._textureUnits[c]=H+c,Z._associatedChannel=H+c):this._textureUnits[c]=-1}this._gl.uniform1iv(c,this._textureUnits);for(let H=0;H<y.length;H++)this._setTexture(this._textureUnits[H],y[H],!0)}}_setAnisotropicLevel(H,c,y){const Z=this._caps.textureAnisotropicFilterExtension;11!==c.samplingMode&&3!==c.samplingMode&&2!==c.samplingMode&&(y=1),Z&&c._cachedAnisotropicFilteringLevel!==y&&(this._setTextureParameterFloat(H,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(y,this._caps.maxAnisotropy),c),c._cachedAnisotropicFilteringLevel=y)}_setTextureParameterFloat(H,c,y,Z){this._bindTextureDirectly(H,Z,!0,!0),this._gl.texParameterf(H,c,y)}_setTextureParameterInteger(H,c,y,Z){Z&&this._bindTextureDirectly(H,Z,!0,!0),this._gl.texParameteri(H,c,y)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let H=0;H<this._caps.maxVertexAttribs;H++)this.disableAttributeByIndex(H)}else for(let H=0,c=this._vertexAttribArraysEnabled.length;H<c;H++)H>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[H]||this.disableAttributeByIndex(H)}releaseEffects(){const H=Object.keys(this._compiledEffects);for(const c of H){this._compiledEffects[c].dispose()}this._compiledEffects={}}dispose(){var H;((0,S.h)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(H=this._gl.getExtension("WEBGL_lose_context"))||void 0===H||H.loseContext());(0,Z.v)(this._gl)}attachContextLostEvent(H){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",H,!1)}attachContextRestoredEvent(H){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",H,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(H){const c=this._gl;for(;c.getError()!==c.NO_ERROR;);let y=!0;const Z=c.createTexture();c.bindTexture(c.TEXTURE_2D,Z),c.texImage2D(c.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(H),1,1,0,c.RGBA,this._getWebGLTextureType(H),null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);const F=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,F),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,Z,0);const P=c.checkFramebufferStatus(c.FRAMEBUFFER);if(y=y&&P===c.FRAMEBUFFER_COMPLETE,y=y&&c.getError()===c.NO_ERROR,y&&(c.clear(c.COLOR_BUFFER_BIT),y=y&&c.getError()===c.NO_ERROR),y){c.bindFramebuffer(c.FRAMEBUFFER,null);const H=c.RGBA,Z=c.UNSIGNED_BYTE,F=new Uint8Array(4);c.readPixels(0,0,1,1,H,Z,F),y=y&&c.getError()===c.NO_ERROR}for(c.deleteTexture(Z),c.deleteFramebuffer(F),c.bindFramebuffer(c.FRAMEBUFFER,null);!y&&c.getError()!==c.NO_ERROR;);return y}_getWebGLTextureType(H){if(1===this._webGLVersion){switch(H){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(H){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(H){case 0:y=this._gl.ALPHA;break;case 1:y=this._gl.LUMINANCE;break;case 2:y=this._gl.LUMINANCE_ALPHA;break;case 6:y=this._gl.RED;break;case 7:y=this._gl.RG;break;case 4:y=c?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:y=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(H){case 8:y=this._gl.RED_INTEGER;break;case 9:y=this._gl.RG_INTEGER;break;case 10:y=this._gl.RGB_INTEGER;break;case 11:y=this._gl.RGBA_INTEGER}return y}_getRGBABufferInternalSizedFormat(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==c)switch(c){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return y?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(H){case 3:switch(c){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(c){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return y?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(c){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(c){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(c){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(c){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(c){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(c){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(c){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(H,c,y,Z){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const S=F?4:3,n=F?this._gl.RGBA:this._gl.RGB,O=new Uint8Array(Z*y*S);return P&&this.flushFramebuffer(),this._gl.readPixels(H,c,y,Z,n,this._gl.UNSIGNED_BYTE,O),Promise.resolve(O)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const H=g.e._CreateCanvas(1,1),c=H.getContext("webgl")||H.getContext("experimental-webgl");this._IsSupported=null!=c&&!!window.WebGLRenderingContext}catch(H){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const H=g.e._CreateCanvas(1,1),c=H.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||H.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!c}catch(H){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}D._TempClearColorUint32=new Uint32Array(4),D._TempClearColorInt32=new Int32Array(4),D.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],D._ConcatenateShader=V.g,D._IsSupported=null,D._HasMajorPerformanceCaveat=null},11190:(H,c,y)=>{"use strict";var Z;y.d(c,{b:()=>F}),function(H){H[H.PointerMove=0]="PointerMove",H[H.PointerDown=1]="PointerDown",H[H.PointerUp=2]="PointerUp"}(Z||(Z={}));class F{}F.DOM_DELTA_PIXEL=0,F.DOM_DELTA_LINE=1,F.DOM_DELTA_PAGE=2},11184:(H,c,y)=>{"use strict";y.d(c,{e:()=>Z,g:()=>P,k:()=>F});class Z{}Z.KEYDOWN=1,Z.KEYUP=2;class F{constructor(H,c){this.type=H,this.event=c}}class P extends F{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(H){this.skipOnKeyboardObservable=H}constructor(H,c){super(H,c),this.type=H,this.event=c,this.skipOnKeyboardObservable=!1}}},11181:(H,c,y)=>{"use strict";y.d(c,{e:()=>F,h:()=>S,i:()=>n});var Z=y(11092);class F{}F.POINTERDOWN=1,F.POINTERUP=2,F.POINTERMOVE=4,F.POINTERWHEEL=8,F.POINTERPICK=16,F.POINTERTAP=32,F.POINTERDOUBLETAP=64;class P{constructor(H,c){this.type=H,this.event=c}}class S extends P{constructor(H,c,y,F){super(H,c),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new Z.l(y,F)}}class n extends P{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(H,c),this._pickInfo=y,this._inputManager=Z}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10747:(H,c,y)=>{"use strict";y.r(c),y.d(c,{SceneInstrumentation:()=>P});var Z=y(10754),F=y(10916);class P{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(H){H!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=H,H?(this._onBeforeActiveMeshesEvaluationObserver=this.Gd.onBeforeActiveMeshesEvaluationObservable.add((()=>{Z.c.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Gd.onAfterActiveMeshesEvaluationObservable.add((()=>{Z.c.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Gd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Gd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(H){H!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=H,H?(this._onBeforeRenderTargetsRenderObserver=this.Gd.onBeforeRenderTargetsRenderObservable.add((()=>{Z.c.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Gd.onAfterRenderTargetsRenderObservable.add((()=>{Z.c.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Gd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(H){H!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=H,H?(this._onBeforeParticlesRenderingObserver=this.Gd.onBeforeParticlesRenderingObservable.add((()=>{Z.c.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Gd.onAfterParticlesRenderingObservable.add((()=>{Z.c.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Gd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(H){H!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=H,this.Gd.spriteManagers&&(H?(this._onBeforeSpritesRenderingObserver=this.Gd.onBeforeSpritesRenderingObservable.add((()=>{Z.c.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Gd.onAfterSpritesRenderingObservable.add((()=>{Z.c.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Gd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(H){H!==this._capturePhysicsTime&&this.Gd.onBeforePhysicsObservable&&(this._capturePhysicsTime=H,H?(this._onBeforePhysicsObserver=this.Gd.onBeforePhysicsObservable.add((()=>{Z.c.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Gd.onAfterPhysicsObservable.add((()=>{Z.c.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.Gd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Gd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(H){H!==this._captureAnimationsTime&&(this._captureAnimationsTime=H,H?this._onAfterAnimationsObserver=this.Gd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Gd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(H){this._captureFrameTime=H}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(H){this._captureInterFrameTime=H}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(H){H!==this._captureRenderTime&&(this._captureRenderTime=H,H?(this._onBeforeDrawPhaseObserver=this.Gd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Z.c.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Gd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Z.c.EndPerformanceCounter("Main render")}))):(this.Gd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Gd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(H){H!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=H,H?(this._onBeforeCameraRenderObserver=this.Gd.onBeforeCameraRenderObservable.add((H=>{this._cameraRenderTime.beginMonitoring(),Z.c.StartPerformanceCounter(`Rendering camera ${H.name}`)})),this._onAfterCameraRenderObserver=this.Gd.onAfterCameraRenderObservable.add((H=>{this._cameraRenderTime.endMonitoring(!1),Z.c.EndPerformanceCounter(`Rendering camera ${H.name}`)}))):(this.Gd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Gd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Gd.getEngine()._drawCalls}constructor(H){this.Gd=H,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new F.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new F.b,this._captureFrameTime=!1,this._frameTime=new F.b,this._captureRenderTime=!1,this._renderTime=new F.b,this._captureInterFrameTime=!1,this._interFrameTime=new F.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new F.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new F.b,this._capturePhysicsTime=!1,this._physicsTime=new F.b,this._captureAnimationsTime=!1,this._animationsTime=new F.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new F.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=H.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Z.c.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Gd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=H.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Z.c.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fj(),this._captureParticlesRenderTime&&this._particlesRenderTime.fj(),this._captureSpritesRenderTime&&this._spritesRenderTime.fj(),this._captureRenderTime&&this._renderTime.fj(),this._captureCameraRenderTime&&this._cameraRenderTime.fj()}))}dispose(){this.Gd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Gd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Gd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Gd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Gd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Gd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Gd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Gd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Gd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Gd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Gd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Gd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Gd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Gd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Gd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Gd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Gd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Gd=null}}},12374:(H,c,y)=>{"use strict";y.d(c,{e:()=>i});var Z=y(11052),F=y(11061),P=y(11092),S=y(11364),n=y(12336),O=y(12381),a=y(10893);S.d.AddNodeConstructor("Light_Type_1",((H,c)=>()=>new i(H,P.n.Zero(),c)));class i extends O.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(H){this._shadowFrustumSize=H,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(H){this._shadowOrthoScale=H,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(H){this._orthoLeft=H}get orthoRight(){return this._orthoRight}set orthoRight(H){this._orthoRight=H}get orthoTop(){return this._orthoTop}set orthoTop(H){this._orthoTop=H}get orthoBottom(){return this._orthoBottom}set orthoBottom(H){this._orthoBottom=H}constructor(H,c,y){super(H,y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"jb"}getTypeID(){return n.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(H,c,y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(H):this._setDefaultAutoExtendShadowProjectionMatrix(H,c,y)}_setDefaultFixedFrustumShadowProjectionMatrix(H){const c=this.va().activeCamera;c&&P.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.Wi,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,H,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(H,c,y){const Z=this.va().activeCamera;if(!Z)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const H=P.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Z=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(let S=0;S<y.length;S++){const n=y[S];if(!n)continue;const O=n.getBoundingInfo().boundingBox;for(let y=0;y<O.vectorsWorld.length;y++)P.n.TransformCoordinatesToRef(O.vectorsWorld[y],c,H),H.x<this._orthoLeft&&(this._orthoLeft=H.x),H.y<this._orthoBottom&&(this._orthoBottom=H.y),H.x>this._orthoRight&&(this._orthoRight=H.x),H.y>this._orthoTop&&(this._orthoTop=H.y),this.autoCalcShadowZBounds&&(H.z<Z&&(Z=H.z),H.z>F&&(F=H.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Z,this._shadowMaxZ=F)}const F=this._orthoRight-this._orthoLeft,S=this._orthoTop-this._orthoBottom,n=void 0!==this.shadowMinZ?this.shadowMinZ:Z.Wi,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,a=this.va().getEngine().useReverseDepthBuffer;P.d.OrthoOffCenterLHToRef(this._orthoLeft-F*this.shadowOrthoScale,this._orthoRight+F*this.shadowOrthoScale,this._orthoBottom-S*this.shadowOrthoScale,this._orthoTop+S*this.shadowOrthoScale,a?O:n,a?n:O,H,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(H,c){return this.computeTransformedInformation()?(H.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(H.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(H){const c=this._scene.getEngine();return!c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}getDepthMaxZ(H){const c=this._scene.getEngine();return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(H,c){H["DIRLIGHT"+c]=!0}}(0,Z.b)([(0,F.P)()],i.prototype,"shadowFrustumSize",null),(0,Z.b)([(0,F.P)()],i.prototype,"shadowOrthoScale",null),(0,Z.b)([(0,F.P)()],i.prototype,"autoUpdateExtends",void 0),(0,Z.b)([(0,F.P)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,Z.b)([(0,F.P)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,Z.b)([(0,F.P)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,Z.b)([(0,F.P)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,Z.b)([(0,F.P)("orthoBottom")],i.prototype,"_orthoBottom",void 0),(0,a.d)("BABYLON.DirectionalLight",i)},12788:(H,c,y)=>{"use strict";y.d(c,{c:()=>i});var Z=y(11052),F=y(11061),P=y(11092),S=y(11112),n=y(11364),O=y(12336),a=y(10893);n.d.AddNodeConstructor("Light_Type_3",((H,c)=>()=>new i(H,P.n.Zero(),c)));class i extends O.b{constructor(H,c,y){super(H,y),this.groundColor=new S.e(0,0,0),this.direction=c||P.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(H){return this.direction=P.n.Normalize(H.Rc(P.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(H,c){const y=P.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",y.x,y.y,y.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.$i),c),this}transferToNodeMaterialEffect(H,c){const y=P.n.Normalize(this.direction);return H.setFloat3(c,y.x,y.y,y.z),this}Oj(){return this._worldMatrix||(this._worldMatrix=P.d.Identity()),this._worldMatrix}getTypeID(){return O.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(H,c){H["HEMILIGHT"+c]=!0}}(0,Z.b)([(0,F.l)()],i.prototype,"groundColor",void 0),(0,Z.b)([(0,F.N)()],i.prototype,"direction",void 0),(0,a.d)("BABYLON.HemisphericLight",i)},12336:(H,c,y)=>{"use strict";y.d(c,{b:()=>g});var Z=y(11052),F=y(11061),P=y(11092),S=y(11112),n=y(11364),O=y(11140),a=y(10893),i=y(11229),C=y(11118);class g extends n.d{get range(){return this._range}set range(H){this._range=H,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(H){this._intensityMode=H,this._computePhotometricScale()}get radius(){return this._radius}set radius(H){this._radius=H,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(H){this._shadowEnabled!==H&&(this._shadowEnabled=H,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(H){this._includedOnlyMeshes=H,this._hookArrayForIncludedOnly(H)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(H){this._excludedMeshes=H,this._hookArrayForExcluded(H)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(H){this._excludeWithLayerMask=H,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(H){this._includeOnlyWithLayerMask=H,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(H){this._lightmapMode!==H&&(this._lightmapMode=H,this._markMeshesAsLightDirty())}getViewMatrix(H){return null}getProjectionMatrix(H,c){return null}constructor(H,c){super(H,c,!1),this.th=new S.e(1,1,1),this.uh=new S.e(1,1,1),this.falloffType=g.FALLOFF_DEFAULT,this.$i=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=g.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new O.e(this.va().getEngine(),void 0,void 0,H),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(H,c){return this}_bindLight(H,c,y,Z){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=H.toString();let n=!1;if(this._uniformBuffer.bindToEffect(y,"Light"+P),this._renderId!==c.getRenderId()||this._lastUseSpecular!==Z||!this._uniformBuffer.useUbo){this._renderId=c.getRenderId(),this._lastUseSpecular=Z;const H=this.getScaledIntensity();this.transferToEffect(y,P),this.th.scaleToRef(H,S.i.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",S.i.gb[0],this.range,P),Z&&(this.uh.scaleToRef(H,S.i.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",S.i.gb[1],this.radius,P)),n=!0}if(this.transferTexturesToEffect(y,P),c.shadowsEnabled&&this.shadowEnabled&&F){const H=this.getShadowGenerator(c.activeCamera)??this.getShadowGenerator();H&&(H.bindShadowLight(P,y),n=!0)}n?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(H){let c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let y=0;y<this.animations.length;y++)c+=", animation[0]: "+this.animations[y].toString(H);return c}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Tb(H){super.Tb(H),this._resyncMeshes()}getShadowGenerator(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(H)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return P.n.Zero()}canAffectMesh(H){return!H||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(H))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(H))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&H.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&H.layerMask)))}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const H=this._shadowGenerators.values();for(let c=H.next();!0!==c.done;c=H.next()){c.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const H=this._parentContainer.lights.indexOf(this);H>-1&&this._parentContainer.lights.splice(H,1),this._parentContainer=null}for(const y of this.va().meshes)y._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(H,c)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.$i}clone(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=g.GetConstructorFromName(this.getTypeID(),H,this.va());if(!y)return null;const Z=C.e.Clone(y,this);return H&&(Z.name=H),c&&(Z.parent=c),Z.Tb(this.isEnabled()),this.onClonedObservable.notifyObservers(Z),Z}serialize(){const H=C.e.Serialize(this);return H.uniqueId=this.uniqueId,H.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(H),this.excludedMeshes.length>0&&(H.excludedMeshesIds=[],this.excludedMeshes.forEach((c=>{H.excludedMeshesIds.push(c.id)}))),this.includedOnlyMeshes.length>0&&(H.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((c=>{H.includedOnlyMeshesIds.push(c.id)}))),C.e.AppendSerializedAnimations(this,H),H.ranges=this.serializeAnimationRanges(),H.isEnabled=this.isEnabled(),H}static GetConstructorFromName(H,c,y){const Z=n.d.Construct("Light_Type_"+H,c,y);return Z||null}static Parse(H,c){const y=g.GetConstructorFromName(H.type,H.name,c);if(!y)return null;const Z=C.e.Parse(y,H,c);if(H.excludedMeshesIds&&(Z._excludedMeshesIds=H.excludedMeshesIds),H.includedOnlyMeshesIds&&(Z._includedOnlyMeshesIds=H.includedOnlyMeshesIds),void 0!==H.parentId&&(Z._waitingParentId=H.parentId),void 0!==H.parentInstanceIndex&&(Z._waitingParentInstanceIndex=H.parentInstanceIndex),void 0!==H.falloffType&&(Z.falloffType=H.falloffType),void 0!==H.lightmapMode&&(Z.lightmapMode=H.lightmapMode),H.animations){for(let c=0;c<H.animations.length;c++){const y=H.animations[c],F=(0,a.c)("BABYLON.Animation");F&&Z.animations.push(F.Parse(y))}n.d.ParseAnimationRanges(Z,H,c)}return H.autoAnimate&&c.beginAnimation(Z,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),void 0!==H.isEnabled&&Z.Tb(H.isEnabled),Z}_hookArrayForExcluded(H){var c=this;const y=H.push;H.push=function(){for(var Z=arguments.length,F=new Array(Z),P=0;P<Z;P++)F[P]=arguments[P];const S=y.apply(H,F);for(const H of F)H._resyncLightSource(c);return S};const Z=H.splice;H.splice=(c,y)=>{const F=Z.apply(H,[c,y]);for(const H of F)H._resyncLightSource(this);return F};for(const F of H)F._resyncLightSource(this)}_hookArrayForIncludedOnly(H){var c=this;const y=H.push;H.push=function(){for(var Z=arguments.length,F=new Array(Z),P=0;P<Z;P++)F[P]=arguments[P];const S=y.apply(H,F);return c._resyncMeshes(),S};const Z=H.splice;H.splice=(c,y)=>{const F=Z.apply(H,[c,y]);return this._resyncMeshes(),F},this._resyncMeshes()}_resyncMeshes(){for(const H of this.va().meshes)H._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const H of this.va().meshes)-1!==H.lightSources.indexOf(this)&&H._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let H=0;const c=this.getTypeID();let y=this.intensityMode;switch(y===g.INTENSITYMODE_AUTOMATIC&&(y=c===g.LIGHTTYPEID_DIRECTIONALLIGHT?g.INTENSITYMODE_ILLUMINANCE:g.INTENSITYMODE_LUMINOUSINTENSITY),c){case g.LIGHTTYPEID_POINTLIGHT:case g.LIGHTTYPEID_SPOTLIGHT:switch(y){case g.INTENSITYMODE_LUMINOUSPOWER:H=1/(4*Math.PI);break;case g.INTENSITYMODE_LUMINOUSINTENSITY:H=1;break;case g.INTENSITYMODE_LUMINANCE:H=this.radius*this.radius}break;case g.LIGHTTYPEID_DIRECTIONALLIGHT:switch(y){case g.INTENSITYMODE_ILLUMINANCE:H=1;break;case g.INTENSITYMODE_LUMINANCE:{let c=this.radius;c=Math.max(c,.001);H=2*Math.PI*(1-Math.cos(c));break}}break;case g.LIGHTTYPEID_HEMISPHERICLIGHT:H=1}return H}_reorderLightsInScene(){const H=this.va();0!=this._renderPriority&&(H.requireLightSorting=!0),this.va().sortLightsByPriority()}}g.FALLOFF_DEFAULT=i.b.FALLOFF_DEFAULT,g.FALLOFF_PHYSICAL=i.b.FALLOFF_PHYSICAL,g.FALLOFF_GLTF=i.b.FALLOFF_GLTF,g.FALLOFF_STANDARD=i.b.FALLOFF_STANDARD,g.LIGHTMAP_DEFAULT=i.b.LIGHTMAP_DEFAULT,g.LIGHTMAP_SPECULAR=i.b.LIGHTMAP_SPECULAR,g.LIGHTMAP_SHADOWSONLY=i.b.LIGHTMAP_SHADOWSONLY,g.INTENSITYMODE_AUTOMATIC=i.b.INTENSITYMODE_AUTOMATIC,g.INTENSITYMODE_LUMINOUSPOWER=i.b.INTENSITYMODE_LUMINOUSPOWER,g.INTENSITYMODE_LUMINOUSINTENSITY=i.b.INTENSITYMODE_LUMINOUSINTENSITY,g.INTENSITYMODE_ILLUMINANCE=i.b.INTENSITYMODE_ILLUMINANCE,g.INTENSITYMODE_LUMINANCE=i.b.INTENSITYMODE_LUMINANCE,g.LIGHTTYPEID_POINTLIGHT=i.b.LIGHTTYPEID_POINTLIGHT,g.LIGHTTYPEID_DIRECTIONALLIGHT=i.b.LIGHTTYPEID_DIRECTIONALLIGHT,g.LIGHTTYPEID_SPOTLIGHT=i.b.LIGHTTYPEID_SPOTLIGHT,g.LIGHTTYPEID_HEMISPHERICLIGHT=i.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,Z.b)([(0,F.l)()],g.prototype,"diffuse",void 0),(0,Z.b)([(0,F.l)()],g.prototype,"specular",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"falloffType",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"intensity",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"range",null),(0,Z.b)([(0,F.P)()],g.prototype,"intensityMode",null),(0,Z.b)([(0,F.P)()],g.prototype,"radius",null),(0,Z.b)([(0,F.P)()],g.prototype,"_renderPriority",void 0),(0,Z.b)([(0,F.d)("_reorderLightsInScene")],g.prototype,"renderPriority",void 0),(0,Z.b)([(0,F.P)("shadowEnabled")],g.prototype,"_shadowEnabled",void 0),(0,Z.b)([(0,F.P)("excludeWithLayerMask")],g.prototype,"_excludeWithLayerMask",void 0),(0,Z.b)([(0,F.P)("includeOnlyWithLayerMask")],g.prototype,"_includeOnlyWithLayerMask",void 0),(0,Z.b)([(0,F.P)("lightmapMode")],g.prototype,"_lightmapMode",void 0)},11229:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});class Z{static CompareLightsPriority(H,c){return H.shadowEnabled!==c.shadowEnabled?(c.shadowEnabled?1:0)-(H.shadowEnabled?1:0):c.renderPriority-H.renderPriority}}Z.FALLOFF_DEFAULT=0,Z.FALLOFF_PHYSICAL=1,Z.FALLOFF_GLTF=2,Z.FALLOFF_STANDARD=3,Z.LIGHTMAP_DEFAULT=0,Z.LIGHTMAP_SPECULAR=1,Z.LIGHTMAP_SHADOWSONLY=2,Z.INTENSITYMODE_AUTOMATIC=0,Z.INTENSITYMODE_LUMINOUSPOWER=1,Z.INTENSITYMODE_LUMINOUSINTENSITY=2,Z.INTENSITYMODE_ILLUMINANCE=3,Z.INTENSITYMODE_LUMINANCE=4,Z.LIGHTTYPEID_POINTLIGHT=0,Z.LIGHTTYPEID_DIRECTIONALLIGHT=1,Z.LIGHTTYPEID_SPOTLIGHT=2,Z.LIGHTTYPEID_HEMISPHERICLIGHT=3},12381:(H,c,y)=>{"use strict";y.d(c,{b:()=>O});var Z=y(11052),F=y(11061),P=y(11092),S=y(12336),n=y(11410);class O extends S.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=P.d.Identity(),this._projectionMatrix=P.d.Identity()}_setPosition(H){this._position=H}get position(){return this._position}set position(H){this._setPosition(H)}_setDirection(H){this._direction=H}get direction(){return this._direction}set direction(H){this._setDirection(H)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(H){this._shadowMinZ=H,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(H){this._shadowMaxZ=H,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=P.n.Zero()),P.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=P.n.Zero()),P.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(H){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(H){return this.direction=P.n.Normalize(H.Rc(this.position)),this.direction}getRotation(){this.direction.normalize();const H=P.n.Cross(this.direction,n.e.Y),c=P.n.Cross(H,this.direction);return P.n.RotationFromAxis(H,c,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=P.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Oj(H){return!H&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=P.d.Identity()),P.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(H){return void 0!==this.shadowMinZ?this.shadowMinZ:H.Wi}getDepthMaxZ(H){return void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ}setShadowProjectionMatrix(H,c,y){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,y,H):this._setDefaultShadowProjectionMatrix(H,c,y),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(H){const c=P.h.o[0];let y=this.position;this.computeTransformedInformation()&&(y=this.transformedPosition),P.n.NormalizeToRef(this.getShadowDirection(H),c),1===Math.abs(P.n.Dot(c,P.n.Up()))&&(c.z=1e-13);const Z=P.h.o[1];return y.addToRef(c,Z),P.d.LookAtLHToRef(y,Z,P.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(H,c){return this.setShadowProjectionMatrix(this._projectionMatrix,H??this._viewMatrix,c??[]),this._projectionMatrix}}(0,Z.b)([(0,F.N)()],O.prototype,"position",null),(0,Z.b)([(0,F.N)()],O.prototype,"direction",null),(0,Z.b)([(0,F.P)()],O.prototype,"shadowMinZ",null),(0,Z.b)([(0,F.P)()],O.prototype,"shadowMaxZ",null)},11747:(H,c,y)=>{"use strict";y.d(c,{b:()=>S,e:()=>P,i:()=>n});const Z={},F={};function P(H,c){Z[H]=c}function S(H,c){F[H]=c}function n(H){return F[H]?F[H]:null}},11474:(H,c,y)=>{"use strict";y.d(c,{c:()=>o,f:()=>l});var Z,F=y(10754),P=y(10763),S=y(11076),n=y(10810),O=y(10773),a=y(11392),i=y(10819),C=y(10826),g=y(10901),v=y(10850);!function(H){H[H.Clean=0]="Clean",H[H.Stop=1]="Stop",H[H.Sync=2]="Sync",H[H.NoSync=3]="NoSync"}(Z||(Z={}));const m=new P.e,z={};let V=!1;function h(){return z[".babylon"]}function Q(H){const c=z[H];return c||(O.d.Warn("Unable to find a plugin to load "+H+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h())}function D(H,c,y){let Z="Unable to load from "+(H.rawData?"binary data":H.url);return c?Z+=`: ${c}`:y&&(Z+=`: ${y}`),Z}function f(H,c,y,Z,F,P,S,n,O){var a;const C="data:"===(g=H.url).substring(0,5)?g.substring(5):null;var g;if(H.rawData&&!S)throw"When using ArrayBufferView to load data the file extension must be provided.";const V=S?Q(S):C?function(H){for(const c in z){const y=z[c].plugin;if(y.canDirectLoad&&y.canDirectLoad(H))return z[c]}return h()}(H.url):function(H){const c=H.indexOf("?");-1!==c&&(H=H.substring(0,c));const y=H.lastIndexOf(".");return Q(H.substring(y,H.length).toLowerCase())}(H.url);if(!V)throw new Error(`No plugin or fallback for ${S??H.url}`);if(!1===(null===O||void 0===O||null===(a=O[V.plugin.name])||void 0===a?void 0:a.enabled))throw new Error(`The '${V.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(H.rawData&&!V.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(H=>{if(V.plugin.createPlugin){const c=V.plugin.createPlugin(O??{});return c instanceof Promise?(c.then(H).catch((H=>{F("Error instantiating plugin.",H)})),null):(H(c),c)}return H(V.plugin),V.plugin})((O=>{var a;if(!O)throw`The loader plugin corresponding to the '${S}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(m.notifyObservers(O),C&&(O.canDirectLoad&&O.canDirectLoad(H.url)||!(0,i.g)(H.url))){if(O.directLoad){const H=O.directLoad(c,C);H instanceof Promise?H.then((H=>{y(O,H)})).catch((H=>{F("Error in directLoad of _loadData: "+H,H)})):y(O,H)}else y(O,C);return}const g=V.isBinary,z=(H,Z)=>{c.u?F("Scene has been disposed"):y(O,H,Z)};let h=null,Q=!1;null===(a=O.jj)||void 0===a||a.add((()=>{Q=!0,h&&(h.abort(),h=null),P()}));const D=()=>{if(Q)return;const y=(H,c)=>{F(null===H||void 0===H?void 0:H.statusText,c)};if(!O.loadFile&&H.rawData)throw"Plugin does not support loading ArrayBufferView.";h=O.loadFile?O.loadFile(c,H.rawData||H.file||H.url,H.rootUrl,z,Z,g,y,n):c._loadFile(H.file||H.url,z,Z,!0,g,y)},f=c.getEngine();let J=f.enableOfflineSupport;if(J){let y=!1;for(const Z of c.disableOfflineSupportExceptionRules)if(Z.test(H.url)){y=!0;break}J=!y}J&&v.e.OfflineProviderFactory?c.offlineProvider=v.e.OfflineProviderFactory(H.url,D,f.disableManifestCheck):D()}))}function J(H,c){let y,Z,P=null,S=null;if(c)if(c.name)y=`file:${c.name}`,Z=c.name,P=c;else if(ArrayBuffer.isView(c))y="",Z=(0,g.e)(),S=c;else if(c.startsWith("data:"))y=c,Z="";else if(H){const P=c;if("/"===P.substring(0,1))return F.c.Error("Wrong sceneFilename parameter"),null;y=H+P,Z=P}else y=c,Z=F.c.GetFilename(c),H=F.c.GetFolderPath(c);else y=H,Z=F.c.GetFilename(H),H=F.c.GetFolderPath(H);return{url:y,rootUrl:H,name:Z,file:P,rawData:S}}function l(H){if("string"===typeof H.extensions){const c=H.extensions;z[c.toLowerCase()]={plugin:H,isBinary:!1}}else{const c=H.extensions;Object.keys(c).forEach((y=>{z[y.toLowerCase()]={plugin:H,isBinary:c[y].isBinary}}))}}function d(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.b.LastCreatedScene,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Z)return O.d.Error("No scene available to import mesh to"),null;const v=J(c,y);if(!v)return null;const m={};Z.addPendingData(m);const z=()=>{Z.removePendingData(m)},V=(H,c)=>{const y=D(v,H,c);S?S(Z,y,new C.m(y,C.i.SceneLoaderError,c)):O.d.Error(y),z()},h=P?H=>{try{P(H)}catch(c){V("Error in onProgress callback: "+c,c)}}:void 0,Q=(H,c,y,P,S,n,O,a)=>{if(Z.importedMeshesFiles.push(v.url),F)try{F(H,c,y,P,S,n,O,a)}catch(i){V("Error in onSuccess callback: "+i,i)}Z.removePendingData(m)};return f(v,Z,((c,y,F)=>{if(c.rewriteRootURL&&(v.rootUrl=c.rewriteRootURL(v.rootUrl,F)),c.importMesh){const F=[],P=[],S=[];if(!c.importMesh(H,Z,y,v.rootUrl,F,P,S,V))return;Z.loadingPluginName=c.name,Q(F,P,S,[],[],[],[],[])}else{c.importMeshAsync(H,Z,y,v.rootUrl,h,v.name).then((H=>{Z.loadingPluginName=c.name,Q(H.meshes,H.qj,H.skeletons,H.animationGroups,H.transformNodes,H.geometries,H.lights,H.spriteManagers)})).catch((H=>{V(H.message,H)}))}}),h,V,z,a,i,g)}function K(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedEngine,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return y?u(H,c,new S.d(y),Z,P,O,a,i,C):(F.c.Error("No engine available"),null)}function T(H,c,y,Z,F,P,S){return new Promise(((n,O)=>{K(H,c,y,(H=>{n(H)}),Z,((H,c,y)=>{O(y||new Error(c))}),F,P,S)}))}function u(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return O.d.Error("No scene available to append to"),null;const v=J(H,c);if(!v)return null;const m={};y.addPendingData(m);const z=()=>{y.removePendingData(m)};a.c.ShowLoadingScreen&&!V&&(V=!0,y.getEngine().displayLoadingUI(),y.executeWhenReady((()=>{y.getEngine().hideLoadingUI(),V=!1})));const h=(H,c)=>{const Z=D(v,H,c);P?P(y,Z,new C.m(Z,C.i.SceneLoaderError,c)):O.d.Error(Z),z()},Q=F?H=>{try{F(H)}catch(c){h("Error in onProgress callback",c)}}:void 0,l=()=>{if(Z)try{Z(y)}catch(H){h("Error in onSuccess callback",H)}y.removePendingData(m)};return f(v,y,((H,c)=>{if(H.load){if(!H.load(y,c,v.rootUrl,h))return;y.loadingPluginName=H.name,l()}else{H.loadAsync(y,c,v.rootUrl,Q,v.name).then((()=>{y.loadingPluginName=H.name,l()})).catch((H=>{h(H.message,H)}))}}),Q,h,z,S,i,g)}function E(H,c,y,Z,F,P,S){return new Promise(((n,O)=>{u(H,c,y,(H=>{n(H)}),Z,((H,c,y)=>{O(y||new Error(c))}),F,P,S)}))}function U(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return O.d.Error("No scene available to load asset container to"),null;const g=J(H,c);if(!g)return null;const v={};y.addPendingData(v);const m=()=>{y.removePendingData(v)},z=(H,c)=>{const Z=D(g,H,c);P?P(y,Z,new C.m(Z,C.i.SceneLoaderError,c)):O.d.Error(Z),m()},V=F?H=>{try{F(H)}catch(c){z("Error in onProgress callback",c)}}:void 0,h=H=>{if(Z)try{Z(H)}catch(c){z("Error in onSuccess callback",c)}y.removePendingData(v)};return f(g,y,((H,c)=>{if(H.loadAssetContainer){const Z=H.loadAssetContainer(y,c,g.rootUrl,z);if(!Z)return;Z.populateRootNodes(),y.loadingPluginName=H.name,h(Z)}else if(H.loadAssetContainerAsync){H.loadAssetContainerAsync(y,c,g.rootUrl,V,g.name).then((c=>{c.populateRootNodes(),y.loadingPluginName=H.name,h(c)})).catch((H=>{z(H.message,H)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,z,m,S,a,i)}function G(H,c,y,Z,F,P,S){return new Promise(((n,O)=>{U(H,c,y,(H=>{n(H)}),Z,((H,c,y)=>{O(y||new Error(c))}),F,P,S)}))}function p(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.b.LastCreatedScene,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!y)return void O.d.Error("No scene available to load animations to");if(Z){for(const H of y.animatables)H.reset();y.stopAllAnimations(),y.animationGroups.slice().forEach((H=>{H.dispose()}));y.getNodes().forEach((H=>{H.animations&&(H.animations=[])}))}else switch(F){case 0:y.animationGroups.slice().forEach((H=>{H.dispose()}));break;case 1:y.animationGroups.forEach((H=>{H.stop()}));break;case 2:y.animationGroups.forEach((H=>{H.reset(),H.restart()}));break;case 3:break;default:return void O.d.Error("Unknown animation group loading mode value '"+F+"'")}const m=y.animatables.length;U(H,c,y,(H=>{H.mergeAnimationsTo(y,y.animatables.slice(m),P),H.dispose(),y.onAnimationFileImportedObservable.notifyObservers(y),S&&S(y)}),a,i,C,g,v)}function t(H,c,y,Z,F,P,S,n,O,a){return new Promise(((i,C)=>{p(H,c,y,Z,F,P,(H=>{i(H)}),S,((H,c,y)=>{C(y||new Error(c))}),n,O,a)}))}class o{static get ForceFullSceneLoadingForIncremental(){return a.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(H){a.c.ForceFullSceneLoadingForIncremental=H}static get ShowLoadingScreen(){return a.c.ShowLoadingScreen}static set ShowLoadingScreen(H){a.c.ShowLoadingScreen=H}static get loggingLevel(){return a.c.loggingLevel}static set loggingLevel(H){a.c.loggingLevel=H}static get CleanBoneMatrixWeights(){return a.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(H){a.c.CleanBoneMatrixWeights=H}static GetDefaultPlugin(){return h()}static GetPluginForExtension(H){var c;return null===(c=Q(H))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(H){return function(H){return!!z[H]}(H)}static RegisterPlugin(H){l(H)}static ImportMesh(H,c,y,Z,F,P,S,n,O){return d(H,c,y,Z,F,P,S,n,O)}static ImportMeshAsync(H,c,y,Z,F,P,S){return function(H,c,y,Z,F,P,S,n){return new Promise(((O,a)=>{d(H,c,y,Z,((H,c,y,Z,F,P,S,n)=>{O({meshes:H,qj:c,skeletons:y,animationGroups:Z,transformNodes:F,geometries:P,lights:S,spriteManagers:n})}),F,((H,c,y)=>{a(y||new Error(c))}),P,S,n)}))}(H,c,y,Z,F,P,S)}static Load(H,c,y,Z,F,P,S,n){return K(H,c,y,Z,F,P,S,n)}static LoadAsync(H,c,y,Z,F,P){return T(H,c,y,Z,F,P)}static Append(H,c,y,Z,F,P,S,n){return u(H,c,y,Z,F,P,S,n)}static AppendAsync(H,c,y,Z,F,P){return E(H,c,y,Z,F,P)}static LoadAssetContainer(H,c,y,Z,F,P,S,n){return U(H,c,y,Z,F,P,S,n)}static LoadAssetContainerAsync(H,c,y,Z,F,P){return G(H,c,y,Z,F,P)}static ImportAnimations(H,c,y,Z,F,P,S,n,O,a,i){p(H,c,y,Z,F,P,S,n,O,a,i)}static ImportAnimationsAsync(H,c,y,Z,F,P,S,n,O,a,i){return t(H,c,y,Z,F,P,n,a,i)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=m},11392:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{static get ForceFullSceneLoadingForIncremental(){return Z._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(H){Z._ForceFullSceneLoadingForIncremental=H}static get ShowLoadingScreen(){return Z._ShowLoadingScreen}static set ShowLoadingScreen(H){Z._ShowLoadingScreen=H}static get loggingLevel(){return Z._LoggingLevel}static set loggingLevel(H){Z._LoggingLevel=H}static get CleanBoneMatrixWeights(){return Z._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(H){Z._CleanBoneMatrixWeights=H}}Z._ForceFullSceneLoadingForIncremental=!1,Z._ShowLoadingScreen=!0,Z._CleanBoneMatrixWeights=!1,Z._LoggingLevel=0},12315:(H,c,y)=>{"use strict";y.d(c,{b:()=>M});var Z=y(11052),F=y(11061),P=y(10773),S=y(11071),n=y(12302),O=y(11076),a=y(11092),i=y(11153),C=y(11293),g=y(11344);class v extends C.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class m extends g.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"PBRBRDF",90,new v,c),this._useEnergyConservation=m.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=m.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=m.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=m.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=m.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=m.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=m.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=m.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=H._dirtyCallbacks[16],this._enable(!0)}prepareDefines(H){H.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,H.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,H.SPHERICAL_HARMONICS=this._useSphericalHarmonics,H.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}m.DEFAULT_USE_ENERGY_CONSERVATION=!0,m.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,m.DEFAULT_USE_SPHERICAL_HARMONICS=!0,m.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsMiscDirty")],m.prototype,"useEnergyConservation",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsMiscDirty")],m.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsMiscDirty")],m.prototype,"useSphericalHarmonics",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsMiscDirty")],m.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var z=y(11236),V=y(11112),h=y(11108),Q=y(11239),D=y(11301),f=y(11304),J=y(11332),l=(y(12321),y(11334)),d=y(11285);class K extends C.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class T extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"PBRClearCoat",100,new K,c),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.roughness=0,this._indexOfRefraction=T._DefaultIndexOfRefraction,this.indexOfRefraction=T._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=V.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1]}isReadyForSubMesh(H,c,y){if(!this._isEnabled)return!0;const Z=this._material._disableBumpMap;if(H._areTexturesDirty&&c.texturesEnabled){if(this._texture&&J.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&J.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(y.getCaps().standardDerivatives&&this._bumpTexture&&J.b.ClearCoatBumpTextureEnabled&&!Z&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&J.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(H,c){this._isEnabled?(H.CLEARCOAT=!0,H.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,H.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,H._areTexturesDirty&&c.texturesEnabled&&(this._texture&&J.b.ClearCoatTextureEnabled?(0,d.N)(this._texture,H,"CLEARCOAT_TEXTURE"):H.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&J.b.ClearCoatTextureEnabled?(0,d.N)(this._textureRoughness,H,"CLEARCOAT_TEXTURE_ROUGHNESS"):H.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&J.b.ClearCoatBumpTextureEnabled?(0,d.N)(this._bumpTexture,H,"CLEARCOAT_BUMP"):H.CLEARCOAT_BUMP=!1,H.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===T._DefaultIndexOfRefraction,this._isTintEnabled?(H.CLEARCOAT_TINT=!0,this._tintTexture&&J.b.ClearCoatTintTextureEnabled?((0,d.N)(this._tintTexture,H,"CLEARCOAT_TINT_TEXTURE"),H.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):H.CLEARCOAT_TINT_TEXTURE=!1):(H.CLEARCOAT_TINT=!1,H.CLEARCOAT_TINT_TEXTURE=!1))):(H.CLEARCOAT=!1,H.CLEARCOAT_TEXTURE=!1,H.CLEARCOAT_TEXTURE_ROUGHNESS=!1,H.CLEARCOAT_BUMP=!1,H.CLEARCOAT_TINT=!1,H.CLEARCOAT_TINT_TEXTURE=!1,H.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,H.CLEARCOAT_DEFAULTIOR=!1,H.CLEARCOAT_TEXTUREDIRECTUV=0,H.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,H.CLEARCOAT_BUMPDIRECTUV=0,H.CLEARCOAT_REMAP_F0=!1,H.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,H.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(H,c,y,Z){if(!this._isEnabled)return;const F=Z.materialDefines,P=this._material.isFrozen,S=this._material._disableBumpMap,n=this._material._invertNormalMapX,O=this._material._invertNormalMapY;if(!H.useUbo||!P||!H.isSync){var a,i,C,g;if((this._texture||this._textureRoughness)&&J.b.ClearCoatTextureEnabled)H.updateFloat4("vClearCoatInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(i=this._texture)||void 0===i?void 0:i.level)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(g=this._textureRoughness)||void 0===g?void 0:g.level)??0),this._texture&&(0,d.o)(this._texture,H,"clearCoat"),this._textureRoughness&&!F.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,d.o)(this._textureRoughness,H,"clearCoatRoughness");this._bumpTexture&&y.getCaps().standardDerivatives&&J.b.ClearCoatTextureEnabled&&!S&&(H.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,d.o)(this._bumpTexture,H,"clearCoatBump"),c._mirroredCameraPosition?H.updateFloat2("vClearCoatTangentSpaceParams",n?1:-1,O?1:-1):H.updateFloat2("vClearCoatTangentSpaceParams",n?-1:1,O?-1:1)),this._tintTexture&&J.b.ClearCoatTintTextureEnabled&&(H.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,d.o)(this._tintTexture,H,"clearCoatTint")),H.updateFloat2("vClearCoatParams",this.$i,this.roughness);const Z=1-this._indexOfRefraction,P=1+this._indexOfRefraction,v=Math.pow(-Z/P,2),m=1/this._indexOfRefraction;H.updateFloat4("vClearCoatRefractionParams",v,m,Z,P),this._isTintEnabled&&(H.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),H.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}c.texturesEnabled&&(this._texture&&J.b.ClearCoatTextureEnabled&&H.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!F.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&J.b.ClearCoatTextureEnabled&&H.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&y.getCaps().standardDerivatives&&J.b.ClearCoatBumpTextureEnabled&&!S&&H.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&J.b.ClearCoatTintTextureEnabled&&H.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(H){return this._texture===H||(this._textureRoughness===H||(this._bumpTexture===H||this._tintTexture===H))}getActiveTextures(H){this._texture&&H.push(this._texture),this._textureRoughness&&H.push(this._textureRoughness),this._bumpTexture&&H.push(this._bumpTexture),this._tintTexture&&H.push(this._tintTexture)}getAnimatables(H){this._texture&&this._texture.animations&&this._texture.animations.length>0&&H.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&H.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&H.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&H.push(this._tintTexture)}dispose(H){var c,y,Z,F;H&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(y=this._textureRoughness)||void 0===y||y.dispose(),null===(Z=this._bumpTexture)||void 0===Z||Z.dispose(),null===(F=this._tintTexture)||void 0===F||F.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(H,c,y){return H.CLEARCOAT_BUMP&&c.addFallback(y++,"CLEARCOAT_BUMP"),H.CLEARCOAT_TINT&&c.addFallback(y++,"CLEARCOAT_TINT"),H.CLEARCOAT&&c.addFallback(y++,"CLEARCOAT"),y}getSamplers(H){H.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}T._DefaultIndexOfRefraction=1.5,(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isEnabled",void 0),(0,Z.b)([(0,F.P)()],T.prototype,"intensity",void 0),(0,Z.b)([(0,F.P)()],T.prototype,"roughness",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"indexOfRefraction",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"texture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMainTexture",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"textureRoughness",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"remapF0OnInterfaceChange",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"bumpTexture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isTintEnabled",void 0),(0,Z.b)([(0,F.l)()],T.prototype,"tintColor",void 0),(0,Z.b)([(0,F.P)()],T.prototype,"tintColorAtDistance",void 0),(0,Z.b)([(0,F.P)()],T.prototype,"tintThickness",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"tintTexture",void 0);class u extends C.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class E extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"PBRIridescence",110,new u,c),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.minimumThickness=E._DefaultMinimumThickness,this.maximumThickness=E._DefaultMaximumThickness,this.indexOfRefraction=E._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1]}isReadyForSubMesh(H,c){if(!this._isEnabled)return!0;if(H._areTexturesDirty&&c.texturesEnabled){if(this._texture&&J.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&J.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(H,c){this._isEnabled?(H.IRIDESCENCE=!0,H._areTexturesDirty&&c.texturesEnabled&&(this._texture&&J.b.IridescenceTextureEnabled?(0,d.N)(this._texture,H,"IRIDESCENCE_TEXTURE"):H.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&J.b.IridescenceTextureEnabled?(0,d.N)(this._thicknessTexture,H,"IRIDESCENCE_THICKNESS_TEXTURE"):H.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(H.IRIDESCENCE=!1,H.IRIDESCENCE_TEXTURE=!1,H.IRIDESCENCE_THICKNESS_TEXTURE=!1,H.IRIDESCENCE_TEXTUREDIRECTUV=0,H.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(H,c){if(!this._isEnabled)return;const y=this._material.isFrozen;if(!H.useUbo||!y||!H.isSync){var Z,F,P,S;if((this._texture||this._thicknessTexture)&&J.b.IridescenceTextureEnabled)H.updateFloat4("vIridescenceInfos",(null===(Z=this._texture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(F=this._texture)||void 0===F?void 0:F.level)??0,(null===(P=this._thicknessTexture)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(S=this._thicknessTexture)||void 0===S?void 0:S.level)??0),this._texture&&(0,d.o)(this._texture,H,"iridescence"),this._thicknessTexture&&(0,d.o)(this._thicknessTexture,H,"iridescenceThickness");H.updateFloat4("vIridescenceParams",this.$i,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}c.texturesEnabled&&(this._texture&&J.b.IridescenceTextureEnabled&&H.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&J.b.IridescenceTextureEnabled&&H.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(H){return this._texture===H||this._thicknessTexture===H}getActiveTextures(H){this._texture&&H.push(this._texture),this._thicknessTexture&&H.push(this._thicknessTexture)}getAnimatables(H){this._texture&&this._texture.animations&&this._texture.animations.length>0&&H.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&H.push(this._thicknessTexture)}dispose(H){var c,y;H&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(y=this._thicknessTexture)||void 0===y||y.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(H,c,y){return H.IRIDESCENCE&&c.addFallback(y++,"IRIDESCENCE"),y}getSamplers(H){H.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}E._DefaultMinimumThickness=100,E._DefaultMaximumThickness=400,E._DefaultIndexOfRefraction=1.3,(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isEnabled",void 0),(0,Z.b)([(0,F.P)()],E.prototype,"intensity",void 0),(0,Z.b)([(0,F.P)()],E.prototype,"minimumThickness",void 0),(0,Z.b)([(0,F.P)()],E.prototype,"maximumThickness",void 0),(0,Z.b)([(0,F.P)()],E.prototype,"indexOfRefraction",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"texture",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"thicknessTexture",void 0);class U extends C.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class G extends g.c{set angle(H){this.direction.x=Math.cos(H),this.direction.y=Math.sin(H)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"PBRAnisotropic",110,new U,c),this._isEnabled=!1,this.isEnabled=!1,this.$i=1,this.direction=new a.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=H._dirtyCallbacks[16]}isReadyForSubMesh(H,c){return!this._isEnabled||!(H._areTexturesDirty&&c.texturesEnabled&&this._texture&&J.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(H,c,y){this._isEnabled?(H.ANISOTROPIC=this._isEnabled,this._isEnabled&&!y.isVerticesDataPresent(i.h.TangentKind)&&(H._needUVs=!0,H.MAINUV1=!0),H._areTexturesDirty&&c.texturesEnabled&&(this._texture&&J.b.AnisotropicTextureEnabled?(0,d.N)(this._texture,H,"ANISOTROPIC_TEXTURE"):H.ANISOTROPIC_TEXTURE=!1),H._areMiscDirty&&(H.ANISOTROPIC_LEGACY=this._legacy)):(H.ANISOTROPIC=!1,H.ANISOTROPIC_TEXTURE=!1,H.ANISOTROPIC_TEXTUREDIRECTUV=0,H.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(H,c){if(!this._isEnabled)return;const y=this._material.isFrozen;H.useUbo&&y&&H.isSync||(this._texture&&J.b.AnisotropicTextureEnabled&&(H.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,d.o)(this._texture,H,"anisotropy")),H.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.$i)),c.texturesEnabled&&this._texture&&J.b.AnisotropicTextureEnabled&&H.setTexture("anisotropySampler",this._texture)}hasTexture(H){return this._texture===H}getActiveTextures(H){this._texture&&H.push(this._texture)}getAnimatables(H){this._texture&&this._texture.animations&&this._texture.animations.length>0&&H.push(this._texture)}dispose(H){H&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(H,c,y){return H.ANISOTROPIC&&c.addFallback(y++,"ANISOTROPIC"),y}getSamplers(H){H.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(H,c,y){super.parse(H,c,y),void 0===H.legacy&&(this.legacy=!0)}}(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,Z.b)([(0,F.P)()],G.prototype,"intensity",void 0),(0,Z.b)([(0,F.L)()],G.prototype,"direction",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsMiscDirty")],G.prototype,"legacy",void 0);class p extends C.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class t extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"Sheen",120,new p,c),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.$i=1,this.color=V.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1]}isReadyForSubMesh(H,c){if(!this._isEnabled)return!0;if(H._areTexturesDirty&&c.texturesEnabled){if(this._texture&&J.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&J.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(H,c){this._isEnabled?(H.SHEEN=!0,H.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,H.SHEEN_ROUGHNESS=null!==this._roughness,H.SHEEN_ALBEDOSCALING=this._albedoScaling,H.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,H._areTexturesDirty&&c.texturesEnabled&&(this._texture&&J.b.SheenTextureEnabled?((0,d.N)(this._texture,H,"SHEEN_TEXTURE"),H.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):H.SHEEN_TEXTURE=!1,this._textureRoughness&&J.b.SheenTextureEnabled?(0,d.N)(this._textureRoughness,H,"SHEEN_TEXTURE_ROUGHNESS"):H.SHEEN_TEXTURE_ROUGHNESS=!1)):(H.SHEEN=!1,H.SHEEN_TEXTURE=!1,H.SHEEN_TEXTURE_ROUGHNESS=!1,H.SHEEN_LINKWITHALBEDO=!1,H.SHEEN_ROUGHNESS=!1,H.SHEEN_ALBEDOSCALING=!1,H.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,H.SHEEN_GAMMATEXTURE=!1,H.SHEEN_TEXTUREDIRECTUV=0,H.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(H,c,y,Z){if(!this._isEnabled)return;const F=Z.materialDefines,P=this._material.isFrozen;if(!H.useUbo||!P||!H.isSync){var S,n,O,a;if((this._texture||this._textureRoughness)&&J.b.SheenTextureEnabled)H.updateFloat4("vSheenInfos",(null===(S=this._texture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(n=this._texture)||void 0===n?void 0:n.level)??0,(null===(O=this._textureRoughness)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.level)??0),this._texture&&(0,d.o)(this._texture,H,"sheen"),this._textureRoughness&&!F.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,d.o)(this._textureRoughness,H,"sheenRoughness");H.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.$i),null!==this._roughness&&H.updateFloat("vSheenRoughness",this._roughness)}c.texturesEnabled&&(this._texture&&J.b.SheenTextureEnabled&&H.setTexture("sheenSampler",this._texture),this._textureRoughness&&!F.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&J.b.SheenTextureEnabled&&H.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(H){return this._texture===H||this._textureRoughness===H}getActiveTextures(H){this._texture&&H.push(this._texture),this._textureRoughness&&H.push(this._textureRoughness)}getAnimatables(H){this._texture&&this._texture.animations&&this._texture.animations.length>0&&H.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&H.push(this._textureRoughness)}dispose(H){var c,y;H&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(y=this._textureRoughness)||void 0===y||y.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(H,c,y){return H.SHEEN&&c.addFallback(y++,"SHEEN"),y}getSamplers(H){H.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkSheenWithAlbedo",void 0),(0,Z.b)([(0,F.P)()],t.prototype,"intensity",void 0),(0,Z.b)([(0,F.l)()],t.prototype,"color",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMainTexture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"textureRoughness",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoScaling",void 0);class o extends C.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class s extends g.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(H){this._scene.enableSubSurfaceForPrePass()&&H&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(H))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(H){this._volumeIndexOfRefraction=H>=1?H:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"PBRSubSurface",130,new o,c),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=V.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=V.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=H.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=H._dirtyCallbacks[32]}isReadyForSubMesh(H,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(H._areTexturesDirty&&c.texturesEnabled){if(this._thicknessTexture&&J.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&J.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&J.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const H=this._getRefractionTexture(c);if(H&&J.b.RefractionTextureEnabled&&!H.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(H,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return H.SUBSURFACE=!1,H.SS_DISPERSION=!1,H.SS_TRANSLUCENCY=!1,H.SS_SCATTERING=!1,H.SS_REFRACTION=!1,H.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,H.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,H.SS_THICKNESSANDMASK_TEXTURE=!1,H.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,H.SS_HAS_THICKNESS=!1,H.SS_REFRACTIONINTENSITY_TEXTURE=!1,H.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,H.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,H.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,H.SS_REFRACTIONMAP_3D=!1,H.SS_REFRACTIONMAP_OPPOSITEZ=!1,H.SS_LODINREFRACTIONALPHA=!1,H.SS_GAMMAREFRACTION=!1,H.SS_RGBDREFRACTION=!1,H.SS_LINEARSPECULARREFRACTION=!1,H.SS_LINKREFRACTIONTOTRANSPARENCY=!1,H.SS_ALBEDOFORREFRACTIONTINT=!1,H.SS_ALBEDOFORTRANSLUCENCYTINT=!1,H.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,H.SS_USE_THICKNESS_AS_DEPTH=!1,H.SS_USE_GLTF_TEXTURES=!1,H.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(H.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(H._areTexturesDirty){if(H.SUBSURFACE=!0,H.SS_DISPERSION=this._isDispersionEnabled,H.SS_TRANSLUCENCY=this._isTranslucencyEnabled,H.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,H.SS_SCATTERING=this._isScatteringEnabled,H.SS_THICKNESSANDMASK_TEXTURE=!1,H.SS_REFRACTIONINTENSITY_TEXTURE=!1,H.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,H.SS_HAS_THICKNESS=!1,H.SS_USE_GLTF_TEXTURES=!1,H.SS_REFRACTION=!1,H.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,H.SS_REFRACTIONMAP_3D=!1,H.SS_GAMMAREFRACTION=!1,H.SS_RGBDREFRACTION=!1,H.SS_LINEARSPECULARREFRACTION=!1,H.SS_REFRACTIONMAP_OPPOSITEZ=!1,H.SS_LODINREFRACTIONALPHA=!1,H.SS_LINKREFRACTIONTOTRANSPARENCY=!1,H.SS_ALBEDOFORREFRACTIONTINT=!1,H.SS_ALBEDOFORTRANSLUCENCYTINT=!1,H.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,H.SS_USE_THICKNESS_AS_DEPTH=!1,H.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,H._areTexturesDirty&&c.texturesEnabled&&(this._thicknessTexture&&J.b.ThicknessTextureEnabled&&(0,d.N)(this._thicknessTexture,H,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&J.b.RefractionIntensityTextureEnabled&&(0,d.N)(this._refractionIntensityTexture,H,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&J.b.TranslucencyIntensityTextureEnabled&&(0,d.N)(this._translucencyIntensityTexture,H,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&J.b.TranslucencyColorTextureEnabled&&(0,d.N)(this._translucencyColorTexture,H,"SS_TRANSLUCENCYCOLOR_TEXTURE")),H.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,H.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,H.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,H.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&c.texturesEnabled){const y=this._getRefractionTexture(c);y&&J.b.RefractionTextureEnabled&&(H.SS_REFRACTION=!0,H.SS_REFRACTIONMAP_3D=y.isCube,H.SS_GAMMAREFRACTION=y.gammaSpace,H.SS_RGBDREFRACTION=y.isRGBD,H.SS_LINEARSPECULARREFRACTION=y.linearSpecularLOD,H.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&y.isCube?!y.invertZ:y.invertZ,H.SS_LODINREFRACTIONALPHA=y.lodLevelInAlpha,H.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,H.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,H.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=y.isCube&&y.boundingBoxSize,H.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(H.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(H,c,y,Z){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)H.updateFloat2("vThicknessParam",0,0);else{Z.getRenderingMesh().getWorldMatrix().decompose(a.h.o[0]);const c=Math.max(Math.abs(a.h.o[0].x),Math.abs(a.h.o[0].y),Math.abs(a.h.o[0].z));H.updateFloat2("vThicknessParam",this.minimumThickness*c,(this.maximumThickness-this.minimumThickness)*c)}}bindForSubMesh(H,c,y,Z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const F=Z.materialDefines,P=this._material.isFrozen,S=this._material.realTimeFiltering,n=F.LODBASEDMICROSFURACE,O=this._getRefractionTexture(c);if(!H.useUbo||!P||!H.isSync){if(this._thicknessTexture&&J.b.ThicknessTextureEnabled&&(H.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,d.o)(this._thicknessTexture,H,"thickness")),this._refractionIntensityTexture&&J.b.RefractionIntensityTextureEnabled&&F.SS_REFRACTIONINTENSITY_TEXTURE&&(H.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,d.o)(this._refractionIntensityTexture,H,"refractionIntensity")),this._translucencyColorTexture&&J.b.TranslucencyColorTextureEnabled&&F.SS_TRANSLUCENCYCOLOR_TEXTURE&&(H.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,d.o)(this._translucencyColorTexture,H,"translucencyColor")),this._translucencyIntensityTexture&&J.b.TranslucencyIntensityTextureEnabled&&F.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(H.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,d.o)(this._translucencyIntensityTexture,H,"translucencyIntensity")),O&&J.b.RefractionTextureEnabled){H.Hj("refractionMatrix",O.getRefractionTextureMatrix());let c=1;O.isCube||O.depth&&(c=O.depth);const y=O.getSize().width,Z=this.volumeIndexOfRefraction;if(H.updateFloat4("vRefractionInfos",O.level,1/Z,c,this._invertRefractionY?-1:1),H.updateFloat4("vRefractionMicrosurfaceInfos",y,O.lodGenerationScale,O.lodGenerationOffset,1/this.indexOfRefraction),S&&H.updateFloat2("vRefractionFilteringInfo",y,Math.log2(y)),O.boundingBoxSize){const c=O;H.updateVector3("vRefractionPosition",c.boundingBoxPosition),H.updateVector3("vRefractionSize",c.boundingBoxSize)}}this._isScatteringEnabled&&H.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),H.updateColor3("vDiffusionDistance",this.diffusionDistance),H.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),H.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),H.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),H.updateFloat("dispersion",this.dispersion)}c.texturesEnabled&&(this._thicknessTexture&&J.b.ThicknessTextureEnabled&&H.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&J.b.RefractionIntensityTextureEnabled&&F.SS_REFRACTIONINTENSITY_TEXTURE&&H.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&J.b.TranslucencyIntensityTextureEnabled&&F.SS_TRANSLUCENCYINTENSITY_TEXTURE&&H.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&J.b.TranslucencyColorTextureEnabled&&F.SS_TRANSLUCENCYCOLOR_TEXTURE&&H.setTexture("translucencyColorSampler",this._translucencyColorTexture),O&&J.b.RefractionTextureEnabled&&(n?H.setTexture("refractionSampler",O):(H.setTexture("refractionSampler",O._lodTextureMid||O),H.setTexture("refractionSamplerLow",O._lodTextureLow||O),H.setTexture("refractionSamplerHigh",O._lodTextureHigh||O))))}_getRefractionTexture(H){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?H.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(H){J.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&H.push(this._refractionTexture)}hasTexture(H){return this._thicknessTexture===H||(this._refractionTexture===H||(this._refractionIntensityTexture===H||(this._translucencyIntensityTexture===H||this._translucencyColorTexture===H)))}hasRenderTargetTextures(){return!!(J.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(H){this._thicknessTexture&&H.push(this._thicknessTexture),this._refractionTexture&&H.push(this._refractionTexture),this._translucencyColorTexture&&H.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&H.push(this._translucencyIntensityTexture)}getAnimatables(H){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&H.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&H.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&H.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&H.push(this._translucencyIntensityTexture)}dispose(H){H&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(H,c,y){return H.SS_SCATTERING&&c.addFallback(y++,"SS_SCATTERING"),H.SS_TRANSLUCENCY&&c.addFallback(y++,"SS_TRANSLUCENCY"),y}getSamplers(H){H.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isRefractionEnabled",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isTranslucencyEnabled",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isDispersionEnabled",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markScenePrePassDirty")],s.prototype,"isScatteringEnabled",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"refractionIntensity",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"translucencyIntensity",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"useAlbedoToTintRefraction",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"useAlbedoToTintTranslucency",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionTexture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"indexOfRefraction",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"_volumeIndexOfRefraction",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"volumeIndexOfRefraction",null),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertRefractionY",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"linkRefractionWithTransparency",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"minimumThickness",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"maximumThickness",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"useThicknessAsDepth",void 0),(0,Z.b)([(0,F.l)()],s.prototype,"tintColor",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"tintColorAtDistance",void 0),(0,Z.b)([(0,F.P)()],s.prototype,"dispersion",void 0),(0,Z.b)([(0,F.l)()],s.prototype,"diffusionDistance",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useMaskFromThicknessTexture",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionIntensityTexture",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyIntensityTexture",void 0),(0,Z.b)([(0,F.l)()],s.prototype,"translucencyColor",void 0),(0,Z.b)([(0,F.H)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyColorTexture",void 0),(0,Z.b)([(0,F.P)(),(0,F.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useGltfStyleTextures",void 0);var q=y(11340),I=y(11288),j=y(11347);const k={effect:null,subMesh:null};class W extends C.b{constructor(H){super(H),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class M extends D.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(H){this._realTimeFiltering=H,this.Fg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(H){this._realTimeFilteringQuality=H,this.Fg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(H){H!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=H||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(H,c){super(H,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||M.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new a.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=V.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new V.e(0,0,0),this._albedoColor=new V.e(1,1,1),this._reflectivityColor=new V.e(1,1,1),this._reflectionColor=new V.e(1,1,1),this._emissiveColor=new V.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=M.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new S.c(16),this._globalAmbientColor=new V.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new m(this),this.clearCoat=new T(this),this.iridescence=new E(this),this.anisotropy=new G(this),this.sheen=new t(this),this.subSurface=new s(this),this.detailMap=new q.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),J.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,n.b)(this.va()),this.prePassConfiguration=new z.b}get hasRenderTargetTextures(){return!!(J.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var H;return this._transparencyMode===M.PBRMATERIAL_OPAQUE||this._transparencyMode===M.PBRMATERIAL_ALPHATEST||(null===(H=this.subSurface)||void 0===H?void 0:H.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var H;return!!this._forceAlphaTest||(null===(H=this.subSurface)||void 0===H||!H.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===M.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.pe&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==M.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.pe||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(H,c,y){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const Z=c._drawWrapper;if(Z.effect&&this.isFrozen&&Z._wasPreviouslyReady&&Z._wasPreviouslyUsingInstances===y)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new W(this._eventInfo.defineNames));const F=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const S=this.va(),n=S.getEngine();if(F._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,S.texturesEnabled)){if(this._albedoTexture&&J.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&J.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&J.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const H=this._getReflectionTexture();if(H&&J.b.ReflectionTextureEnabled){if(!H.isReadyOrNotBlocking())return!1;var O;if(H.irradianceTexture){if(!H.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!H.sphericalPolynomial&&null!==(O=H.getInternalTexture())&&void 0!==O&&O._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&J.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&J.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(J.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(n.getCaps().standardDerivatives&&this._bumpTexture&&J.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&J.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=F,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;n.getCaps().standardDerivatives||H.isVerticesDataPresent(i.h.NormalKind)||(H.createNormals(!0),P.d.Warn("PBRMaterial: Normals have been created for the mesh: "+H.name));const a=c.effect,C=F._areLightsDisposed;let g=this._prepareEffect(H,F,this.onCompiled,this.onError,y,null,c.getRenderingMesh().hasThinInstances),v=!1;if(g)if(this._onEffectCreatedObservable&&(k.effect=g,k.subMesh=c,this._onEffectCreatedObservable.notifyObservers(k)),this.allowShaderHotSwapping&&a&&!g.isReady()){if(g=a,F.markAsUnprocessed(),v=this.isFrozen,C)return F._areLightsDisposed=!0,!1}else S.resetCachedMaterial(),c.setEffect(g,F,this._materialContext);return!(!c.effect||!c.effect.isReady())&&(F._renderId=S.getRenderId(),Z._wasPreviouslyReady=!v,Z._wasPreviouslyUsingInstances=!!y,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(H,c){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(H,c,P,S,n),!c.isDirty)return null;c.markAsProcessed();const O=this.va().getEngine(),a=new l.c;let C=0;c.USESPHERICALINVERTEX&&a.addFallback(C++,"USESPHERICALINVERTEX"),c.FOG&&a.addFallback(C,"FOG"),c.SPECULARAA&&a.addFallback(C,"SPECULARAA"),c.POINTSIZE&&a.addFallback(C,"POINTSIZE"),c.LOGARITHMICDEPTH&&a.addFallback(C,"LOGARITHMICDEPTH"),c.PARALLAX&&a.addFallback(C,"PARALLAX"),c.PARALLAX_RHS&&a.addFallback(C,"PARALLAX_RHS"),c.PARALLAXOCCLUSION&&a.addFallback(C++,"PARALLAXOCCLUSION"),c.ENVIRONMENTBRDF&&a.addFallback(C++,"ENVIRONMENTBRDF"),c.TANGENT&&a.addFallback(C++,"TANGENT"),c.BUMP&&a.addFallback(C++,"BUMP"),C=(0,d.r)(c,a,this._maxSimultaneousLights,C++),c.SPECULARTERM&&a.addFallback(C++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&a.addFallback(C++,"USESPHERICALFROMREFLECTIONMAP"),c.USEIRRADIANCEMAP&&a.addFallback(C++,"USEIRRADIANCEMAP"),c.LIGHTMAP&&a.addFallback(C++,"LIGHTMAP"),c.NORMAL&&a.addFallback(C++,"NORMAL"),c.AMBIENT&&a.addFallback(C++,"AMBIENT"),c.EMISSIVE&&a.addFallback(C++,"EMISSIVE"),c.VERTEXCOLOR&&a.addFallback(C++,"VERTEXCOLOR"),c.MORPHTARGETS&&a.addFallback(C++,"MORPHTARGETS"),c.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");const g=[i.h.PositionKind];c.NORMAL&&g.push(i.h.NormalKind),c.TANGENT&&g.push(i.h.TangentKind);for(let y=1;y<=6;++y)c["UV"+y]&&g.push(`uv${1===y?"":y}`);c.VERTEXCOLOR&&g.push(i.h.ColorKind),(0,d.x)(g,H,c,a),(0,d.B)(g,c),(0,d.D)(g,H,c),(0,d.v)(g,H,c);let v="pbr";const m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],V=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],Q=["Material","Scene","Mesh"],D={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=a,this._eventInfo.fallbackRank=C,this._eventInfo.defines=c,this._eventInfo.uniforms=m,this._eventInfo.attributes=g,this._eventInfo.samplers=V,this._eventInfo.uniformBuffersNames=Q,this._eventInfo.customCode=void 0,this._eventInfo.mesh=H,this._eventInfo.indexParameters=D,this._callbackPluginEventGeneric(128,this._eventInfo),j.d.AddUniformsAndSamplers(m,V),z.b.AddUniforms(m),z.b.AddSamplers(V),(0,I.c)(m),h.d&&(h.d.PrepareUniforms(m,c),h.d.PrepareSamplers(V,c)),(0,d._)({uniformsNames:m,uniformBuffersNames:Q,samplers:V,defines:c,maxSimultaneousLights:this._maxSimultaneousLights});const f={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,m,Q,V,c,g,f));const J=c.toString(),K=O.createEffect(v,{attributes:g,uniformsNames:m,uniformBuffersNames:Q,samplers:V,defines:J,fallbacks:a,onCompiled:Z,onError:F,indexParameters:D,processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:c.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([y.e(21),y.e(43)]).then(y.bind(y,13629)),Promise.all([y.e(22),y.e(44)]).then(y.bind(y,13642))]):await Promise.all([Promise.all([y.e(25),y.e(45)]).then(y.bind(y,13649)),Promise.all([y.e(27),y.e(46)]).then(y.bind(y,13665))]),this._shadersLoaded=!0}},O);return this._eventInfo.customCode=void 0,K}_prepareDefines(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this.va(),S=P.getEngine();(0,d.K)(P,H,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,(0,d.V)(P,c);const n=this.needAlphaBlendingForMesh(H)&&this.va().useOrderIndependentTransparency;if((0,d.Z)(P,c,this.canRenderToMRT&&!n),(0,d.X)(P,c,n),j.d.PrepareDefines(S.currentRenderPassId,H,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){c._needUVs=!1;for(let H=1;H<=6;++H)c["MAINUV"+H]=!1;if(P.texturesEnabled){c.ALBEDODIRECTUV=0,c.AMBIENTDIRECTUV=0,c.OPACITYDIRECTUV=0,c.EMISSIVEDIRECTUV=0,c.REFLECTIVITYDIRECTUV=0,c.MICROSURFACEMAPDIRECTUV=0,c.METALLIC_REFLECTANCEDIRECTUV=0,c.REFLECTANCEDIRECTUV=0,c.BUMPDIRECTUV=0,c.LIGHTMAPDIRECTUV=0,S.getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&J.b.DiffuseTextureEnabled?((0,d.N)(this._albedoTexture,c,"ALBEDO"),c.GAMMAALBEDO=this._albedoTexture.gammaSpace):c.ALBEDO=!1,this._ambientTexture&&J.b.AmbientTextureEnabled?((0,d.N)(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&J.b.OpacityTextureEnabled?((0,d.N)(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;const H=this._getReflectionTexture();if(H&&J.b.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=H.gammaSpace,c.RGBDREFLECTION=H.isRGBD,c.LODINREFLECTIONALPHA=H.lodLevelInAlpha,c.LINEARSPECULARREFLECTION=H.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(c.NUM_SAMPLES=""+this.realTimeFilteringQuality,S._features.needTypeSuffixInShaderConstants&&(c.NUM_SAMPLES=c.NUM_SAMPLES+"u"),c.REALTIME_FILTERING=!0):c.REALTIME_FILTERING=!1,c.INVERTCUBICMAP=H.coordinatesMode===f.d.INVCUBIC_MODE,c.REFLECTIONMAP_3D=H.isCube,c.REFLECTIONMAP_OPPOSITEZ=c.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!H.invertZ:H.invertZ,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,H.coordinatesMode){case f.d.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case f.d.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case f.d.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case f.d.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case f.d.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case f.d.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case f.d.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case f.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case f.d.CUBIC_MODE:case f.d.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!H.boundingBoxSize}H.coordinatesMode!==f.d.SKYBOX_MODE&&(H.irradianceTexture?(c.USEIRRADIANCEMAP=!0,c.USESPHERICALFROMREFLECTIONMAP=!1):H.isCube&&(c.USESPHERICALFROMREFLECTIONMAP=!0,c.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||S.getCaps().maxVaryingVectors<=8?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0))}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USEIRRADIANCEMAP=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1,c.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&J.b.LightmapTextureEnabled?((0,d.N)(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):c.LIGHTMAP=!1,this._emissiveTexture&&J.b.EmissiveTextureEnabled?((0,d.N)(this._emissiveTexture,c,"EMISSIVE"),c.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):c.EMISSIVE=!1,J.b.SpecularTextureEnabled?(this._metallicTexture?((0,d.N)(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,c.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,d.N)(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,c.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):c.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(c.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,d.N)(this._metallicReflectanceTexture,c,"METALLIC_REFLECTANCE"),c.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):c.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,d.N)(this._reflectanceTexture,c,"REFLECTANCE"),c.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):c.REFLECTANCE=!1):(c.METALLIC_REFLECTANCE=!1,c.REFLECTANCE=!1),this._microSurfaceTexture?(0,d.N)(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),S.getCaps().standardDerivatives&&this._bumpTexture&&J.b.BumpTextureEnabled&&!this._disableBumpMap?((0,d.N)(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&J.b.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAX_RHS=P.useRightHandedSystem,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(c.BUMP=!1,c.PARALLAX=!1,c.PARALLAX_RHS=!1,c.PARALLAXOCCLUSION=!1,c.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&J.b.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===M.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===M.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.dh&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.SPECULARAA=S.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(c._areTexturesDirty||c._areMiscDirty)&&(c.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,c.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,c.ALPHABLEND=this.needAlphaBlendingForMesh(H),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&((0,d.R)(H,P,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(H)||this._forceAlphaTest,c,this._applyDecalMapAfterDetailMap),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!H.isVerticesDataPresent(i.h.NormalKind),c.DEBUGMODE=this._debugMode),(0,d.G)(P,S,this,c,!!y,Z,F),this._eventInfo.defines=c,this._eventInfo.mesh=H,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,d.E)(H,c,!0,!0,!0,this._transparencyMode!==M.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(H,c,y){const Z={clipPlane:!1,useInstances:!1,...y};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const y=new W(this._eventInfo.defineNames),F=this._prepareEffect(H,y,void 0,void 0,Z.useInstances,Z.clipPlane,H.hasThinInstances);this._onEffectCreatedObservable&&(k.effect=F,k.subMesh=null,this._onEffectCreatedObservable.notifyObservers(k)),F.isReady()?c&&c(this):F.onCompileObservable.add((()=>{c&&c(this)}))})()}buildUniformLayout(){const H=this._uniformBuffer;H.addUniform("vAlbedoInfos",2),H.addUniform("vAmbientInfos",4),H.addUniform("vOpacityInfos",2),H.addUniform("vEmissiveInfos",2),H.addUniform("vLightmapInfos",2),H.addUniform("vReflectivityInfos",3),H.addUniform("vMicroSurfaceSamplerInfos",2),H.addUniform("vReflectionInfos",2),H.addUniform("vReflectionFilteringInfo",2),H.addUniform("vReflectionPosition",3),H.addUniform("vReflectionSize",3),H.addUniform("vBumpInfos",3),H.addUniform("albedoMatrix",16),H.addUniform("ambientMatrix",16),H.addUniform("opacityMatrix",16),H.addUniform("emissiveMatrix",16),H.addUniform("lightmapMatrix",16),H.addUniform("reflectivityMatrix",16),H.addUniform("microSurfaceSamplerMatrix",16),H.addUniform("bumpMatrix",16),H.addUniform("vTangentSpaceParams",2),H.addUniform("reflectionMatrix",16),H.addUniform("vReflectionColor",3),H.addUniform("vAlbedoColor",4),H.addUniform("vLightingIntensity",4),H.addUniform("vReflectionMicrosurfaceInfos",3),H.addUniform("pointSize",1),H.addUniform("vReflectivityColor",4),H.addUniform("vEmissiveColor",3),H.addUniform("vAmbientColor",3),H.addUniform("vDebugMode",2),H.addUniform("vMetallicReflectanceFactors",4),H.addUniform("vMetallicReflectanceInfos",2),H.addUniform("metallicReflectanceMatrix",16),H.addUniform("vReflectanceInfos",2),H.addUniform("reflectanceMatrix",16),H.addUniform("vSphericalL00",3),H.addUniform("vSphericalL1_1",3),H.addUniform("vSphericalL10",3),H.addUniform("vSphericalL11",3),H.addUniform("vSphericalL2_2",3),H.addUniform("vSphericalL2_1",3),H.addUniform("vSphericalL20",3),H.addUniform("vSphericalL21",3),H.addUniform("vSphericalL22",3),H.addUniform("vSphericalX",3),H.addUniform("vSphericalY",3),H.addUniform("vSphericalZ",3),H.addUniform("vSphericalXX_ZZ",3),H.addUniform("vSphericalYY_ZZ",3),H.addUniform("vSphericalZZ",3),H.addUniform("vSphericalXY",3),H.addUniform("vSphericalYZ",3),H.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(H,c,y){const Z=this.va(),F=y.materialDefines;if(!F)return;const P=y.effect;if(!P)return;this._activeEffect=P,c.getMeshUniformBuffer().bindToEffect(P,"Mesh"),c.transferToEffect(H);const S=Z.getEngine();this._uniformBuffer.bindToEffect(P,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,Z,c,H,this.isFrozen),j.d.Bind(S.currentRenderPassId,this._activeEffect,c,H),this._eventInfo.subMesh=y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),F.OBJECTSPACE_NORMALMAP&&(H.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const n=this._mustRebind(Z,P,y,c.visibility);(0,d.e)(c,this._activeEffect,this.prePassConfiguration);let a=null;const i=this._uniformBuffer;if(n){if(this.bindViewProjection(P),a=this._getReflectionTexture(),!i.useUbo||!this.isFrozen||!i.isSync||y._drawWrapper._forceRebindOnNextCall){var C;if(Z.texturesEnabled){if(this._albedoTexture&&J.b.DiffuseTextureEnabled&&(i.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,d.o)(this._albedoTexture,i,"albedo")),this._ambientTexture&&J.b.AmbientTextureEnabled&&(i.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,d.o)(this._ambientTexture,i,"ambient")),this._opacityTexture&&J.b.OpacityTextureEnabled&&(i.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,d.o)(this._opacityTexture,i,"opacity")),a&&J.b.ReflectionTextureEnabled){if(i.Hj("reflectionMatrix",a.getReflectionTextureMatrix()),i.updateFloat2("vReflectionInfos",a.level,0),a.boundingBoxSize){const H=a;i.updateVector3("vReflectionPosition",H.boundingBoxPosition),i.updateVector3("vReflectionSize",H.boundingBoxSize)}if(this.realTimeFiltering){const H=a.getSize().width;i.updateFloat2("vReflectionFilteringInfo",H,Math.log2(H))}if(!F.USEIRRADIANCEMAP){const H=a.sphericalPolynomial;if(F.USESPHERICALFROMREFLECTIONMAP&&H)if(F.SPHERICAL_HARMONICS){const c=H.preScaledHarmonics;i.updateVector3("vSphericalL00",c.l00),i.updateVector3("vSphericalL1_1",c.l1_1),i.updateVector3("vSphericalL10",c.l10),i.updateVector3("vSphericalL11",c.l11),i.updateVector3("vSphericalL2_2",c.l2_2),i.updateVector3("vSphericalL2_1",c.l2_1),i.updateVector3("vSphericalL20",c.l20),i.updateVector3("vSphericalL21",c.l21),i.updateVector3("vSphericalL22",c.l22)}else i.updateFloat3("vSphericalX",H.x.x,H.x.y,H.x.z),i.updateFloat3("vSphericalY",H.y.x,H.y.y,H.y.z),i.updateFloat3("vSphericalZ",H.z.x,H.z.y,H.z.z),i.updateFloat3("vSphericalXX_ZZ",H.xx.x-H.zz.x,H.xx.y-H.zz.y,H.xx.z-H.zz.z),i.updateFloat3("vSphericalYY_ZZ",H.yy.x-H.zz.x,H.yy.y-H.zz.y,H.yy.z-H.zz.z),i.updateFloat3("vSphericalZZ",H.zz.x,H.zz.y,H.zz.z),i.updateFloat3("vSphericalXY",H.xy.x,H.xy.y,H.xy.z),i.updateFloat3("vSphericalYZ",H.yz.x,H.yz.y,H.yz.z),i.updateFloat3("vSphericalZX",H.zx.x,H.zx.y,H.zx.z)}i.updateFloat3("vReflectionMicrosurfaceInfos",a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset)}this._emissiveTexture&&J.b.EmissiveTextureEnabled&&(i.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,d.o)(this._emissiveTexture,i,"emissive")),this._lightmapTexture&&J.b.LightmapTextureEnabled&&(i.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,d.o)(this._lightmapTexture,i,"lightmap")),J.b.SpecularTextureEnabled&&(this._metallicTexture?(i.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,d.o)(this._metallicTexture,i,"reflectivity")):this._reflectivityTexture&&(i.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,d.o)(this._reflectivityTexture,i,"reflectivity")),this._metallicReflectanceTexture&&(i.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,d.o)(this._metallicReflectanceTexture,i,"metallicReflectance")),this._reflectanceTexture&&F.REFLECTANCE&&(i.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,d.o)(this._reflectanceTexture,i,"reflectance")),this._microSurfaceTexture&&(i.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,d.o)(this._microSurfaceTexture,i,"microSurfaceSampler"))),this._bumpTexture&&S.getCaps().standardDerivatives&&J.b.BumpTextureEnabled&&!this._disableBumpMap&&(i.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,d.o)(this._bumpTexture,i,"bump"),Z._mirroredCameraPosition?i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&i.updateFloat("pointSize",this.pointSize),F.METALLICWORKFLOW){var g;V.i.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,V.i.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,i.updateColor4("vReflectivityColor",V.i.gb[0],1);const H=(null===(g=this.subSurface)||void 0===g?void 0:g._indexOfRefraction)??1.5,c=1,y=Math.pow((H-c)/(H+c),2);this._metallicReflectanceColor.scaleToRef(y*this._metallicF0Factor,V.i.gb[0]);const Z=this._metallicF0Factor;i.updateColor4("vMetallicReflectanceFactors",V.i.gb[0],Z)}else i.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);i.updateColor3("vEmissiveColor",J.b.EmissiveTextureEnabled?this._emissiveColor:V.e.BlackReadOnly),i.updateColor3("vReflectionColor",this._reflectionColor),!F.SS_REFRACTION&&null!==(C=this.subSurface)&&void 0!==C&&C._linkRefractionWithTransparency?i.updateColor4("vAlbedoColor",this._albedoColor,1):i.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*Z.environmentIntensity,this._lightingInfos.w=this._specularIntensity,i.updateVector4("vLightingIntensity",this._lightingInfos),Z.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),i.updateColor3("vAmbientColor",this._globalAmbientColor),i.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}Z.texturesEnabled&&(this._albedoTexture&&J.b.DiffuseTextureEnabled&&i.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&J.b.AmbientTextureEnabled&&i.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&J.b.OpacityTextureEnabled&&i.setTexture("opacitySampler",this._opacityTexture),a&&J.b.ReflectionTextureEnabled&&(F.LODBASEDMICROSFURACE?i.setTexture("reflectionSampler",a):(i.setTexture("reflectionSampler",a._lodTextureMid||a),i.setTexture("reflectionSamplerLow",a._lodTextureLow||a),i.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),F.USEIRRADIANCEMAP&&i.setTexture("irradianceSampler",a.irradianceTexture)),F.ENVIRONMENTBRDF&&i.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&J.b.EmissiveTextureEnabled&&i.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&J.b.LightmapTextureEnabled&&i.setTexture("lightmapSampler",this._lightmapTexture),J.b.SpecularTextureEnabled&&(this._metallicTexture?i.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&i.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&i.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&F.REFLECTANCE&&i.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&i.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&S.getCaps().standardDerivatives&&J.b.BumpTextureEnabled&&!this._disableBumpMap&&i.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.va().depthPeelingRenderer.bind(P),this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,I.f)(this._activeEffect,this,Z),this.bindEyePosition(P)}else Z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(n||!this.isFrozen){var v;if(Z.lightsEnabled&&!this._disableLighting&&(0,d.i)(Z,c,this._activeEffect,F,this._maxSimultaneousLights),(Z.fogEnabled&&c.applyFog&&Z.fogMode!==O.d.FOGMODE_NONE||a||this.subSurface.refractionTexture||c.receiveShadows||F.PREPASS)&&this.bindView(P),(0,d.h)(Z,c,this._activeEffect,!0),F.NUM_MORPH_INFLUENCERS&&(0,d.l)(c,this._activeEffect),F.BAKED_VERTEX_ANIMATION_TEXTURE)null===(v=c.bakedVertexAnimationManager)||void 0===v||v.bind(P,F.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,d.j)(F,this._activeEffect,Z)}this._afterBind(c,this._activeEffect,y),i.update()}getAnimatables(){const H=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&H.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&H.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&H.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&H.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&H.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?H.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&H.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&H.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&H.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&H.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&H.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&H.push(this._microSurfaceTexture),H}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const H=super.getActiveTextures();return this._albedoTexture&&H.push(this._albedoTexture),this._ambientTexture&&H.push(this._ambientTexture),this._opacityTexture&&H.push(this._opacityTexture),this._reflectionTexture&&H.push(this._reflectionTexture),this._emissiveTexture&&H.push(this._emissiveTexture),this._reflectivityTexture&&H.push(this._reflectivityTexture),this._metallicTexture&&H.push(this._metallicTexture),this._metallicReflectanceTexture&&H.push(this._metallicReflectanceTexture),this._reflectanceTexture&&H.push(this._reflectanceTexture),this._microSurfaceTexture&&H.push(this._microSurfaceTexture),this._bumpTexture&&H.push(this._bumpTexture),this._lightmapTexture&&H.push(this._lightmapTexture),H}hasTexture(H){return!!super.hasTexture(H)||(this._albedoTexture===H||(this._ambientTexture===H||(this._opacityTexture===H||(this._reflectionTexture===H||(this._emissiveTexture===H||(this._reflectivityTexture===H||(this._metallicTexture===H||(this._metallicReflectanceTexture===H||(this._reflectanceTexture===H||(this._microSurfaceTexture===H||(this._bumpTexture===H||this._lightmapTexture===H)))))))))))}setPrePassRenderer(){var H;if(null===(H=this.subSurface)||void 0===H||!H.isScatteringEnabled)return!1;const c=this.va().enableSubSurfaceForPrePass();return c&&(c.enabled=!0),!0}dispose(H,c){var y,Z,F,P,S,n,O,a,i,C,g,v;(this._breakShaderLoadedCheck=!0,c)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(y=this._albedoTexture)||void 0===y||y.dispose(),null===(Z=this._ambientTexture)||void 0===Z||Z.dispose(),null===(F=this._opacityTexture)||void 0===F||F.dispose(),null===(P=this._reflectionTexture)||void 0===P||P.dispose(),null===(S=this._emissiveTexture)||void 0===S||S.dispose(),null===(n=this._metallicTexture)||void 0===n||n.dispose(),null===(O=this._reflectivityTexture)||void 0===O||O.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(i=this._lightmapTexture)||void 0===i||i.dispose(),null===(C=this._metallicReflectanceTexture)||void 0===C||C.dispose(),null===(g=this._reflectanceTexture)||void 0===g||g.dispose(),null===(v=this._microSurfaceTexture)||void 0===v||v.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(H,c)}}M.PBRMATERIAL_OPAQUE=Q.c.MATERIAL_OPAQUE,M.PBRMATERIAL_ALPHATEST=Q.c.MATERIAL_ALPHATEST,M.PBRMATERIAL_ALPHABLEND=Q.c.MATERIAL_ALPHABLEND,M.PBRMATERIAL_ALPHATESTANDBLEND=Q.c.MATERIAL_ALPHATESTANDBLEND,M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,M.LIGHTFALLOFF_PHYSICAL=0,M.LIGHTFALLOFF_GLTF=1,M.LIGHTFALLOFF_STANDARD=2,M.ForceGLSL=!1,(0,Z.b)([(0,F.t)()],M.prototype,"_imageProcessingConfiguration",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsMiscDirty")],M.prototype,"debugMode",void 0)},10888:(H,c,y)=>{"use strict";y.d(c,{e:()=>S});var Z=y(10773);const F=new Map;function P(H,c){(function(H){return F.delete(H)})(H)&&Z.d.Warn(`Extension with the name '${name}' already exists`),F.set(H,c)}function S(H,c){"image/ktx"!==c&&"image/ktx2"!==c||(H=".ktx"),F.has(H)||(H.endsWith(".dds")&&P(".dds",(()=>y.e(12).then(y.bind(y,13090)).then((H=>new H._DDSTextureLoader)))),H.endsWith(".basis")&&P(".basis",(()=>y.e(13).then(y.bind(y,13095)).then((H=>new H._BasisTextureLoader)))),H.endsWith(".env")&&P(".env",(()=>y.e(14).then(y.bind(y,13097)).then((H=>new H._ENVTextureLoader)))),H.endsWith(".hdr")&&P(".hdr",(()=>y.e(15).then(y.bind(y,13102)).then((H=>new H._HDRTextureLoader)))),(H.endsWith(".ktx")||H.endsWith(".ktx2"))&&(P(".ktx",(()=>y.e(16).then(y.bind(y,13109)).then((H=>new H._KTXTextureLoader)))),P(".ktx2",(()=>y.e(16).then(y.bind(y,13109)).then((H=>new H._KTXTextureLoader))))),H.endsWith(".tga")&&P(".tga",(()=>y.e(17).then(y.bind(y,13112)).then((H=>new H._TGATextureLoader)))),H.endsWith(".exr")&&P(".exr",(()=>y.e(18).then(y.bind(y,13114)).then((H=>new H._ExrTextureLoader)))));const Z=F.get(H);return Z?Promise.resolve(Z(c)):null}},11313:(H,c,y)=>{"use strict";y.d(c,{c:()=>g});var Z=y(11052),F=y(11061),P=y(10763),S=y(11092),n=y(10810),O=y(10901),a=(y(10819),y(11320));class i{get wrapU(){return this._wrapU}set wrapU(H){this._wrapU=H}get wrapV(){return this._wrapV}set wrapV(H){this._wrapV=H}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(H){this._texture&&(this._texture.isCube=H)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(H){this._texture&&(this._texture.is3D=H)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(H){this._texture&&(this._texture.is2DArray=H)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(H){return void 0!==(null===H||void 0===H?void 0:H.shareDepth)}constructor(H){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=a.c.Zero(),this._cachedBaseSize=a.c.Zero(),this._initialSamplingMode=2,this._texture=i._IsRenderTargetWrapper(H)?H.texture:H,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(H){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(H,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var C=y(11118);class g extends i{set pe(H){this._hasAlpha!==H&&(this._hasAlpha=H,this._scene&&this._scene.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))))}get pe(){return this._hasAlpha}set getAlphaFromRGB(H){this._getAlphaFromRGB!==H&&(this._getAlphaFromRGB=H,this._scene&&this._scene.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(H){this._coordinatesIndex!==H&&(this._coordinatesIndex=H,this._scene&&this._scene.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(H){this._coordinatesMode!==H&&(this._coordinatesMode=H,this._scene&&this._scene.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(H){this._wrapU=H}get wrapV(){return this._wrapV}set wrapV(H){this._wrapV=H}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(H){this._texture?this._texture.isCube=H:this._isCube=H}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(H){this._texture&&(this._texture.is3D=H)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(H){this._texture&&(this._texture.is2DArray=H)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(H){var c;if(this._texture){if(this._texture._gammaSpace===H)return;this._texture._gammaSpace=H}else{if(this._gammaSpace===H)return;this._gammaSpace=H}null===(c=this.va())||void 0===c||c.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(H){var c;H!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=H),null===(c=this.va())||void 0===c||c.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(H){this._texture&&(this._texture._lodGenerationOffset=H)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(H){this._texture&&(this._texture._lodGenerationScale=H)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(H){this._texture&&(this._texture._linearSpecularLOD=H)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(H){this._texture&&(this._texture._irradianceTexture=H)}get uid(){return this._uid||(this._uid=(0,O.e)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=g.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.jj=new P.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,H?g._IsScene(H)?this._scene=H:this._engine=H:this._scene=n.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=c,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return S.d.IdentityReadOnly}getReflectionTextureMatrix(){return S.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(H){}get canRescale(){return!1}_getFromCache(H,c,y,Z,F,P){const S=this._getEngine();if(!S)return null;const n=S._getUseSRGBBuffer(!!F,c),O=S.getLoadedTexturesCache();for(let a=0;a<O.length;a++){const S=O[a];if((void 0===F||n===S._useSRGBBuffer)&&(void 0===Z||Z===S.invertY)&&S.url===H&&S.generateMipMaps===!c&&(!y||y===S.samplingMode)&&(void 0===P||P===S.isCube))return S.incrementReferences(),S}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const H=this.va();H&&H.markAllMaterialsAsDirty(1)}readPixels(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const a=this._getEngine();if(!a)return null;const i=this.getSize();let C=i.width,g=i.height;0!==c&&(C/=Math.pow(2,c),g/=Math.pow(2,c),C=Math.round(C),g=Math.round(g)),n=Math.min(C,n),O=Math.min(g,O);try{return this._texture.isCube?a._readTexturePixels(this._texture,n,O,H,c,y,Z,F,P,S):a._readTexturePixels(this._texture,n,O,-1,c,y,Z,F,P,S)}catch(v){return null}}_readPixelsSync(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const P=this.getSize();let S=P.width,n=P.height;const O=this._getEngine();if(!O)return null;0!=c&&(S/=Math.pow(2,c),n/=Math.pow(2,c),S=Math.round(S),n=Math.round(n));try{return this._texture.isCube?O._readTexturePixelsSync(this._texture,S,n,H,c,y,Z,F):O._readTexturePixelsSync(this._texture,S,n,-1,c,y,Z,F)}catch(a){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const H=this._scene.textures.indexOf(this);if(H>=0&&this._scene.textures.splice(H,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const H=this._parentContainer.textures.indexOf(this);H>-1&&this._parentContainer.textures.splice(H,1),this._parentContainer=null}}this.jj.notifyObservers(this),this.jj.clear(),this.metadata=null,super.dispose()}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!H)return null;const c=C.e.Serialize(this);return C.e.AppendSerializedAnimations(this,c),c}static WhenAllReady(H,c){let y=H.length;if(0!==y)for(let Z=0;Z<H.length;Z++){const F=H[Z];if(F.isReady())0===--y&&c();else{const H=F.onLoadObservable;H?H.addOnce((()=>{0===--y&&c()})):0===--y&&c()}}else c()}static _IsScene(H){return"Scene"===H.getClassName()}}g.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,Z.b)([(0,F.P)()],g.prototype,"uniqueId",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"name",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"metadata",void 0),(0,Z.b)([(0,F.P)("pe")],g.prototype,"_hasAlpha",void 0),(0,Z.b)([(0,F.P)("getAlphaFromRGB")],g.prototype,"_getAlphaFromRGB",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"level",void 0),(0,Z.b)([(0,F.P)("coordinatesIndex")],g.prototype,"_coordinatesIndex",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"optimizeUVAllocation",void 0),(0,Z.b)([(0,F.P)("coordinatesMode")],g.prototype,"_coordinatesMode",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"wrapU",null),(0,Z.b)([(0,F.P)()],g.prototype,"wrapV",null),(0,Z.b)([(0,F.P)()],g.prototype,"wrapR",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"anisotropicFilteringLevel",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"isCube",null),(0,Z.b)([(0,F.P)()],g.prototype,"is3D",null),(0,Z.b)([(0,F.P)()],g.prototype,"is2DArray",null),(0,Z.b)([(0,F.P)()],g.prototype,"gammaSpace",null),(0,Z.b)([(0,F.P)()],g.prototype,"invertZ",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"lodLevelInAlpha",void 0),(0,Z.b)([(0,F.P)()],g.prototype,"lodGenerationOffset",null),(0,Z.b)([(0,F.P)()],g.prototype,"lodGenerationScale",null),(0,Z.b)([(0,F.P)()],g.prototype,"linearSpecularLOD",null),(0,Z.b)([(0,F.H)()],g.prototype,"irradianceTexture",null),(0,Z.b)([(0,F.P)()],g.prototype,"isRenderTarget",void 0)},12321:(H,c,y)=>{"use strict";var Z=y(11633),F=y(11313);F.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(F.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Z.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((H=>{this._texture._sphericalPolynomial=H,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(H){this._texture&&(this._texture._sphericalPolynomial=H)},enumerable:!0,configurable:!0})},12349:(H,c,y)=>{"use strict";y.d(c,{d:()=>g});var Z=y(11052),F=y(11061),P=y(10754),S=y(11092),n=y(11313),O=y(11304),a=y(10893),i=y(10763),C=y(11118);y(11663);class g extends n.c{set boundingBoxSize(H){if(this._boundingBoxSize&&this._boundingBoxSize.equals(H))return;this._boundingBoxSize=H;const c=this.va();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(H){this._rotationY=H,this.setReflectionTextureMatrix(S.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(H,c,y){let Z="";return H.forEach((H=>Z+=H)),new g(Z,c,null,y,H)}static CreateFromPrefilteredData(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const P=new g(H,c,null,!1,null,null,null,void 0,!0,y,Z);return c.useDelayedTextureLoading=F,P}constructor(H,c){var y;let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new i.e,this.boundingBoxPosition=S.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new S.d,this._buffer=null,this.name=H,this.url=H,this._noMipmap=F,this.pe=!1,this.isCube=!0,this._textureMatrix=S.d.Identity(),this.coordinatesMode=O.d.CUBIC_MODE;let D=null,f=null;null===Z||Array.isArray(Z)?(this._noMipmap=F,this._format=C,this._createPolynomials=m,D=Z,this._loaderOptions=h,this._useSRGBBuffer=Q,this._lodScale=z,this._lodOffset=V):(D=Z.extensions??null,this._noMipmap=Z.noMipmap??!1,P=Z.files??null,f=Z.buffer??null,this._format=Z.format??5,g=Z.prefiltered??!1,v=Z.forcedExtension??null,this._createPolynomials=Z.createPolynomials??!1,this._lodScale=Z.lodScale??.8,this._lodOffset=Z.lodOffset??0,this._loaderOptions=Z.loaderOptions,this._useSRGBBuffer=Z.useSRGBBuffer,n=Z.X??null,a=Z.onError??null),(H||P)&&this.updateURL(H,v,n,g,a,D,null===(y=this.va())||void 0===y?void 0:y.useDelayedTextureLoading,P,f)}getClassName(){return"CubeTexture"}updateURL(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=H),this.url=H,c&&(this._forcedExtension=c);const a=H.lastIndexOf("."),i=c||(a>-1?H.substring(a).toLowerCase():""),C=0===i.indexOf(".dds"),g=0===i.indexOf(".env"),v=0===i.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Z,Z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),n)this._files=n;else if(v||g||C||P||(P=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,P){for(let c=0;c<P.length;c++)this._files.push(H+P[c]);this._extensions=P}this._buffer=O,S?(this.delayLoadState=4,this._delayedOnLoad=y,this._delayedOnError=F):this._loadTexture(y,F)}delayLoad(H){4===this.delayLoadState&&(H&&(this._forcedExtension=H),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(H){var c,y;if(H.updateFlag===this._textureMatrix.updateFlag)return;H.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(y=this.va())||void 0===y||y.markAllMaterialsAsDirty(1,(H=>-1!==H.getActiveTextures().indexOf(this))));if(this._textureMatrix=H,null===(c=this.va())||void 0===c||!c.useRightHandedSystem)return;const Z=S.h.o[0],F=S.h.Quaternion[0],P=S.h.o[1];this._textureMatrix.decompose(Z,F,P),F.z*=-1,F.w*=-1,S.d.ComposeToRef(Z,F,P,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var H;return null!==(H=this.va())&&void 0!==H&&H.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this.va(),Z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const F=()=>{var c;(this.onLoadObservable.notifyObservers(this),Z)&&(Z.dispose(),null===(c=this.va())||void 0===c||c.markAllMaterialsAsDirty(1));H&&H()},S=(H,y)=>{this._loadingError=!0,this._errorObject={message:H,exception:y},c&&c(H,y),O.d.OnTextureLoadErrorObservable.notifyObservers(this)};var n;this._texture?this._texture.isReady?P.c.SetImmediate((()=>F())):this._texture.onLoadedObservable.add((()=>F())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,y,this._lodScale,this._lodOffset,H,S,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,y,this._files,this._noMipmap,H,S,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(n=this._texture)||void 0===n||n.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(H,c,y){const Z=C.e.Parse((()=>{let Z=!1;return H.prefiltered&&(Z=H.prefiltered),new g(y+(H.url??H.name),c,H.extensions,!1,H.files||null,null,null,void 0,Z,H.forcedExtension)}),H,c);if(H.boundingBoxPosition&&(Z.boundingBoxPosition=S.n.Tg(H.boundingBoxPosition)),H.boundingBoxSize&&(Z.boundingBoxSize=S.n.Tg(H.boundingBoxSize)),H.animations)for(let F=0;F<H.animations.length;F++){const c=H.animations[F],y=(0,a.c)("BABYLON.Animation");y&&Z.animations.push(y.Parse(c))}return Z}clone(){let H=0;const c=C.e.Clone((()=>{const c=new g(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return H=c.uniqueId,c}),this);return c.uniqueId=H,c}}(0,Z.b)([(0,F.P)()],g.prototype,"url",void 0),(0,Z.b)([(0,F.N)()],g.prototype,"boundingBoxPosition",void 0),(0,Z.b)([(0,F.N)()],g.prototype,"boundingBoxSize",null),(0,Z.b)([(0,F.P)("rotationY")],g.prototype,"rotationY",null),(0,Z.b)([(0,F.P)("files")],g.prototype,"_files",void 0),(0,Z.b)([(0,F.P)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,Z.b)([(0,F.P)("extensions")],g.prototype,"_extensions",void 0),(0,Z.b)([(0,F.x)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,Z.b)([(0,F.x)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),O.d._CubeTextureParser=g.Parse,(0,a.d)("BABYLON.CubeTexture",g)},12812:(H,c,y)=>{"use strict";y.d(c,{c:()=>O});var Z=y(10773),F=y(11304),P=y(10908),S=y(11534),n=y(10877);S.ThinEngine.prototype.createDynamicTexture=function(H,c,y,Z){const F=new n.b(this,4);return F.baseWidth=H,F.baseHeight=c,y&&(H=this.needPOTTextures?(0,P.c)(H,this._caps.maxTextureSize):H,c=this.needPOTTextures?(0,P.c)(c,this._caps.maxTextureSize):c),F.width=H,F.height=c,F.isReady=!1,F.generateMipMaps=y,F.samplingMode=Z,this.updateTextureSamplingMode(Z,F),this._internalTexturesCache.push(F),F},S.ThinEngine.prototype.updateDynamicTexture=function(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H)return;const S=this._gl,n=S.TEXTURE_2D,O=this._bindTextureDirectly(n,H,!0,P);this._unpackFlipY(void 0===y?H.invertY:y),Z&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const a=this._getWebGLTextureType(H.type),i=this._getInternalFormat(F||H.format),C=this._getRGBABufferInternalSizedFormat(H.type,i);S.texImage2D(n,0,C,i,a,c),H.generateMipMaps&&S.generateMipmap(n),O||this._bindTextureDirectly(n,null),Z&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),F&&(H.format=F),H._dynamicTextureSource=c,H._premulAlpha=Z,H.invertY=y||!1,H.isReady=!0};class O extends F.d{constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,n=arguments.length>6?arguments[6]:void 0;const O=!y||y._isScene;super(null,O?y:null===y||void 0===y?void 0:y.Gd,O?!Z:y,n,P,void 0,void 0,void 0,void 0,S),this.name=H,this.wrapU=F.d.CLAMP_ADDRESSMODE,this.wrapV=F.d.CLAMP_ADDRESSMODE,this._generateMipMaps=Z;const a=this._getEngine();if(!a)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=a.createDynamicTexture(this._canvas.width,this._canvas.height,Z,P);else{this._canvas=a.createCanvas(1,1),this._ownCanvas=!0;const H=c;H.width||0===H.width?this._texture=a.createDynamicTexture(H.width,H.height,Z,P):this._texture=a.createDynamicTexture(c,c,Z,P)}const i=this.getSize();this._canvas.width!==i.width&&(this._canvas.width=i.width),this._canvas.height!==i.height&&(this._canvas.height=i.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(H){this._canvas.width=H.width,this._canvas.height=H.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(H.width,H.height,this._generateMipMaps,this.samplingMode)}scale(H){const c=this.getSize();c.width*=H,c.height*=H,this._recreate(c)}scaleTo(H,c){const y=this.getSize();y.width=H,y.height=c,this._recreate(y)}getContext(){return this._context}clear(H){const c=this.getSize();H&&(this._context.fillStyle=H),this._context.clearRect(0,0,c.width,c.height)}update(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===H||H,c,this._format||void 0,void 0,y)}drawText(H,c,y,Z,F,P,S){let n=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this.getSize();if(P&&(this._context.fillStyle=P,this._context.fillRect(0,0,O.width,O.height)),this._context.font=Z,null===c||void 0===c){const y=this._context.measureText(H);c=(O.width-y.width)/2}if(null===y||void 0===y){const H=parseInt(Z.replace(/\D/g,""));y=O.height/2+H/3.65}this._context.fillStyle=F||"",this._context.fillText(H,c,y),n&&this.update(S)}dispose(){var H,c;(super.dispose(),this._ownCanvas)&&(null===(H=this._canvas)||void 0===H||null===(c=H.remove)||void 0===c||c.call(H));this._canvas=null,this._context=null}clone(){const H=this.va();if(!H)return this;const c=this.getSize(),y=new O(this.name,c,H,this._generateMipMaps);return y.pe=this.pe,y.level=this.level,y.wrapU=this.wrapU,y.wrapV=this.wrapV,y}serialize(){const H=this.va();H&&!H.isReady()&&Z.d.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return O._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(H){return void 0!==H.toDataURL}_rebuild(){this.update()}}},10877:(H,c,y)=>{"use strict";y.d(c,{b:()=>S});var Z,F=y(10763),P=y(10883);!function(H){H[H.Unknown=0]="Unknown",H[H.Url=1]="Url",H[H.Temp=2]="Temp",H[H.Raw=3]="Raw",H[H.Dynamic=4]="Dynamic",H[H.RenderTarget=5]="RenderTarget",H[H.MultiRenderTarget=6]="MultiRenderTarget",H[H.Cube=7]="Cube",H[H.CubeRaw=8]="CubeRaw",H[H.CubePrefiltered=9]="CubePrefiltered",H[H.Raw3D=10]="Raw3D",H[H.Raw2DArray=11]="Raw2DArray",H[H.DepthStencil=12]="DepthStencil",H[H.CubeRawRGBD=13]="CubeRawRGBD",H[H.Depth=14]="Depth"}(Z||(Z={}));class S extends P.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(H){this.generateMipMaps=H}get uniqueId(){return this._uniqueId}_setUniqueId(H){this._uniqueId=H}getEngine(){return this._engine}get source(){return this._source}constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new F.e,this.onErrorObservable=new F.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=H,this._source=c,this._uniqueId=S._Counter++,y||(this._hardwareTexture=H._createHardwareTexture())}incrementReferences(){this._references++}updateSize(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,H,c,y),this.width=H,this.height=c,this.depth=y,this.baseWidth=H,this.baseHeight=c,this.baseDepth=y,this._size=H*c*y}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const H=this.onRebuildCallback(this),c=c=>{c._swapAndDie(this,!1),this.isReady=H.isReady};return void(H.isAsync?H.proxy.then(c):c(H.proxy))}let H;switch(this.source){case 2:case 12:case 14:break;case 1:return void(H=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(H=>{H._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:H=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),H._swapAndDie(this,!1),this.isReady=!0;break;case 10:H=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),H._swapAndDie(this,!1),this.isReady=!0;break;case 11:H=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),H._swapAndDie(this,!1),this.isReady=!0;break;case 4:H=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),H._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(H=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{H._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:H=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),H._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return H=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(H=>{H&&H._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(H._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(H){var c;let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(c=this._hardwareTexture)||void 0===c||c.setUsage(H._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),H._hardwareTexture=this._hardwareTexture,y&&(H._isRGBD=this._isRGBD),this._lodTextureHigh&&(H._lodTextureHigh&&H._lodTextureHigh.dispose(),H._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(H._lodTextureMid&&H._lodTextureMid.dispose(),H._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(H._lodTextureLow&&H._lodTextureLow.dispose(),H._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(H._irradianceTexture&&H._irradianceTexture.dispose(),H._irradianceTexture=this._irradianceTexture);const Z=this._engine.getLoadedTexturesCache();let F=Z.indexOf(this);-1!==F&&Z.splice(F,1),F=Z.indexOf(H),-1===F&&Z.push(H)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}S._Counter=0},11558:(H,c,y)=>{"use strict";y.d(c,{c:()=>F});var Z=y(11304);class F extends Z.d{constructor(H,c,y,F,P){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>9?arguments[9]:void 0,C=arguments.length>10?arguments[10]:void 0;super(null,P,!S,n,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i),this.format=F,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==a||(O=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==a||(O=1),this._texture=this._engine.createRawTexture(H,c,y,F,S,n,O,null,a,i??0,C??!1),this.wrapU=Z.d.CLAMP_ADDRESSMODE,this.wrapV=Z.d.CLAMP_ADDRESSMODE)}update(H){this._getEngine().updateRawTexture(this._texture,H,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const H=new F(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return H._texture=this._texture,this._texture.incrementReferences(),H}static CreateLuminanceTexture(H,c,y,Z){return new F(H,c,y,1,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(H,c,y,Z){return new F(H,c,y,2,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(H,c,y,Z){return new F(H,c,y,0,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(H,c,y,Z){return new F(H,c,y,4,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(H,c,y,Z){return new F(H,c,y,5,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(H,c,y,Z){return new F(H,c,y,5,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(H,c,y,P){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.d.TRILINEAR_SAMPLINGMODE;return new F(H,c,y,6,P,S,n,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(H,c,y,P){let S=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.d.TRILINEAR_SAMPLINGMODE;return new F(H,c,y,6,P,S,n,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11929:(H,c,y)=>{"use strict";y.d(c,{e:()=>F});var Z=y(11304);class F extends Z.d{get depth(){return this._depth}constructor(H,c,y,F,P,S){let n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Z.d.TRILINEAR_SAMPLINGMODE,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10?arguments[10]:void 0;super(null,S,!n,O),this.format=P,this._texture=S.getEngine().createRawTexture2DArray(H,c,y,F,P,n,O,a,null,i,C),this._depth=F,this.is2DArray=!0}update(H){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,H,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(H,c,y,Z,P){return new F(H,c,y,Z,5,P,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11646:(H,c,y)=>{"use strict";y.d(c,{e:()=>g});var Z=y(10763),F=y(11092),P=y(11304),S=y(11165),n=y(11170),O=y(11103),a=y(10908),i=y(10853),C=y(10773);i.d.prototype.setDepthStencilTexture=function(H,c){this._engine.setDepthStencilTexture(this._samplers[H],this._uniforms[H],c,H)};class g extends P.d{get renderList(){return this._renderList}set renderList(H){this._renderList!==H&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),H&&(this._unObserveRenderList=(0,O.j)(H,this._renderListHasChanged)),this._renderList=H)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(H){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(H)}set onBeforeRender(H){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(H)}set onAfterRender(H){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(H)}set onClear(H){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(H)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(H,c){let y;y=Array.isArray(H)?H:[H];for(let Z=0;Z<y.length;++Z)for(let H=0;H<this._renderPassIds.length;++H)y[Z].setMaterialForRenderPass(this._renderPassIds[H],void 0!==c?Array.isArray(c)?c[H]:c:void 0)}get isMulti(){var H;return(null===(H=this._renderTarget)||void 0===H?void 0:H.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(H){if(this._boundingBoxSize&&this._boundingBoxSize.equals(H))return;this._boundingBoxSize=H;const c=this.va();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var H;return(null===(H=this._renderTarget)||void 0===H?void 0:H._depthStencilTexture)??null}constructor(H,c,y){let S,O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:P.d.TRILINEAR_SAMPLINGMODE,v=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],m=arguments.length>9&&void 0!==arguments[9]&&arguments[9],z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,h=arguments.length>12&&void 0!==arguments[12]&&arguments[12],Q=arguments.length>13?arguments[13]:void 0,D=arguments.length>14?arguments[14]:void 0,f=arguments.length>15&&void 0!==arguments[15]&&arguments[15],J=arguments.length>16&&void 0!==arguments[16]&&arguments[16],l=!0;if("object"===typeof O){const H=O;O=!!H.generateMipMaps,a=H.doNotChangeAspectRatio??!0,i=H.type??0,C=!!H.isCube,g=H.samplingMode??P.d.TRILINEAR_SAMPLINGMODE,v=H.generateDepthBuffer??!0,m=!!H.generateStencilBuffer,z=!!H.isMulti,V=H.format??5,h=!!H.delayAllocation,Q=H.samples,D=H.creationFlags,f=!!H.noColorAttachment,J=!!H.useSRGBBuffer,S=H.colorAttachment,l=H.gammaSpace??l}if(super(null,y,!O,void 0,g,void 0,void 0,void 0,void 0,V),this._unObserveRenderList=null,this._renderListHasChanged=(H,c)=>{const y=this._renderList?this._renderList.length:0;var Z;(0===c&&y>0||0===y)&&(null===(Z=this.va())||void 0===Z||Z.meshes.forEach((H=>{H._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new Z.e,this.onAfterUnbindObservable=new Z.e,this.onBeforeRenderObservable=new Z.e,this.onAfterRenderObservable=new Z.e,this.onClearObservable=new Z.e,this.onResizeObservable=new Z.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=F.n.Zero(),this._dumpToolsLoading=!1,!(y=this.va()))return;const d=this.va().getEngine();this._gammaSpace=l,this._coordinatesMode=P.d.PROJECTION_MODE,this.renderList=[],this.name=H,this.isRenderTarget=!0,this._initialSizeParameter=c,this._renderPassIds=[],this._isCubeData=C,this._processSizeParameter(c),this.renderPassId=this._renderPassIds[0],this._resizeObserver=d.onResizeObservable.add((()=>{})),this._generateMipMaps=!!O,this._doNotChangeAspectRatio=a,this._renderingManager=new n.d(y),this._renderingManager._useSceneAutoClearSetup=!0,z||(this._renderTargetOptions={generateMipMaps:O,type:i,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:v,generateStencilBuffer:m,samples:Q,creationFlags:D,noColorAttachment:f,useSRGBBuffer:J,colorAttachment:S,label:this.name},this.samplingMode===P.d.NEAREST_SAMPLINGMODE&&(this.wrapU=P.d.CLAMP_ADDRESSMODE,this.wrapV=P.d.CLAMP_ADDRESSMODE),h||(C?(this._renderTarget=y.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=P.d.INVCUBIC_MODE,this._textureMatrix=F.d.Identity()):this._renderTarget=y.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==Q&&(this.samples=Q)))}createDepthStencilTexture(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,S=arguments.length>5?arguments[5]:void 0;null===(H=this._renderTarget)||void 0===H||H.createDepthStencilTexture(c,y,Z,F,P,S)}_releaseRenderPassId(){if(this._scene){const H=this._scene.getEngine();for(let c=0;c<this._renderPassIds.length;++c)H.releaseRenderPassId(this._renderPassIds[c])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const H=this._scene.getEngine(),c=this._isCubeData?6:this.getRenderLayers()||1;for(let y=0;y<c;++y)this._renderPassIds[y]=H.createRenderPassId(`RenderTargetTexture - ${this.name}#${y}`)}_processSizeParameter(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H.ratio){this._sizeRatio=H.ratio;const c=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(c.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(c.getRenderHeight(),this._sizeRatio)}}else this._size=H;c&&this._createRenderPassId()}get samples(){var H;return(null===(H=this._renderTarget)||void 0===H?void 0:H.samples)??this._samples}set samples(H){this._renderTarget&&(this._samples=this._renderTarget.setSamples(H))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(H){this._refreshRate=H,this.resetRefreshCounter()}addPostProcess(H){if(!this._postProcessManager){const H=this.va();if(!H)return;this._postProcessManager=new S.c(H),this._postProcesses=new Array}this._postProcesses.push(H),this._postProcesses[0].Ti=!1}clearPostProcesses(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(H)for(const H of this._postProcesses)H.dispose();this._postProcesses=[]}}removePostProcess(H){if(!this._postProcesses)return;const c=this._postProcesses.indexOf(H);-1!==c&&(this._postProcesses.splice(c,1),this._postProcesses.length>0&&(this._postProcesses[0].Ti=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const H=this._size.layers;if(H)return H;const c=this._size.depth;return c||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(H){const c=Math.max(1,this.getRenderSize()*H);this.resize(c)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(H){var c;const y=this.isCube;null===(c=this._renderTarget)||void 0===c||c.dispose(),this._renderTarget=null;const Z=this.va();Z&&(this._processSizeParameter(H,!1),this._renderTarget=y?Z.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):Z.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(H,c)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(y.bind(y,12346)).then((H=>this._dumpTools=H))),this._render(!1,!1,!0)}_render(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=this.va();if(!Z)return y;const F=Z.getEngine();if(void 0!==this.useCameraPostProcesses&&(H=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let H=0;H<this._waitingRenderList.length;H++){const c=this._waitingRenderList[H],y=Z.getMeshById(c);y&&this.renderList.push(y)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const H=this.va();if(!H)return y;const c=H.meshes;for(let y=0;y<c.length;y++){const H=c[y];this.renderListPredicate(H)&&this.renderList.push(H)}}const P=F.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const S=this.activeCamera??Z.activeCamera,n=Z.activeCamera;S&&(S!==Z.activeCamera&&(Z.setTransformMatrix(S.getViewMatrix(),S.getProjectionMatrix(!0)),Z.activeCamera=S),F.setViewport(S.rigParent?S.rigParent.viewport:S.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let O=y;if(y){Z.getViewMatrix()||Z.updateTransformMatrix();const H=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let P=0;P<H&&O;P++){let H=null;const c=this.renderList?this.renderList:Z.getActiveMeshes().data,S=this.renderList?this.renderList.length:Z.getActiveMeshes().length;F.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P),this.getCustomRenderList&&(H=this.getCustomRenderList(P,c,S)),H||(H=c),this._doNotChangeAspectRatio||Z.updateTransformMatrix(!0);for(let Z=0;Z<H.length&&O;++Z){const c=H[Z];if(c.isEnabled()&&!c.isBlocked&&c.isVisible&&c.$f)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,y)){O=!1;continue}}else if(!c.isReady(!0)){O=!1;continue}}this.onAfterRenderObservable.notifyObservers(P),(this.is2DArray||this.is3D||this.isCube)&&(Z.incrementRenderId(),Z.resetCachedMaterial())}const c=this.particleSystemList||Z.qj;for(const y of c)y.isReady()||(O=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let a=0;a<6;a++)this._renderToTarget(a,H,c,void 0,S),Z.incrementRenderId(),Z.resetCachedMaterial();else this._renderToTarget(0,H,c,void 0,S);else for(let a=0;a<this.getRenderLayers();a++)this._renderToTarget(0,H,c,a,S),Z.incrementRenderId(),Z.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),F.currentRenderPassId=P,Z.activeCamera=n,n&&(this.activeCamera&&this.activeCamera!==Z.activeCamera&&Z.setTransformMatrix(n.getViewMatrix(),n.getProjectionMatrix(!0)),F.setViewport(n.viewport)),Z.resetCachedMaterial(),O}_bestReflectionRenderTargetDimension(H,c){const y=H*c,Z=(0,a.l)(y+16384/(128+y));return Math.min((0,a.b)(H),Z)}_prepareRenderingManager(H,c,y,Z){const F=this.va();if(!F)return;this._renderingManager.reset();const P=F.getRenderId();for(let n=0;n<c;n++){const c=H[n];if(c&&!c.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!c.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!c._internalAbstractMeshDataInfo._currentLODIsUpToDate&&y&&(c._internalAbstractMeshDataInfo._currentLOD=F.customLODSelector?F.customLODSelector(c,y):c.getLOD(y),c._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!c._internalAbstractMeshDataInfo._currentLOD)continue;let H,S=c._internalAbstractMeshDataInfo._currentLOD;if(S!==c&&0!==S.billboardMode&&S.Oj(),S._preActivateForIntermediateRendering(P),H=!(!Z||!y)&&0===(c.layerMask&y.layerMask),c.isEnabled()&&c.isVisible&&c.$f&&!H){if(S!==c&&S._activate(P,!0),c._activate(P,!0)&&c.$f.length){c.isAnInstance?c._internalAbstractMeshDataInfo._actAsRegularMesh&&(S=c):S._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,S._internalAbstractMeshDataInfo._isActiveIntermediate=!0,F._prepareSkeleton(S);for(let H=0;H<S.$f.length;H++){const c=S.$f[H];this._renderingManager.dispatch(c,S)}}c._postActivate()}}}const S=this.particleSystemList||F.qj;for(let n=0;n<S.length;n++){const H=S[n],c=H.j;H.isStarted()&&c&&(!c.position||c.isEnabled())&&this._renderingManager.dispatchParticles(H)}}_bindFrameBuffer(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.va();if(!y)return;const Z=y.getEngine();this._renderTarget&&Z.bindFramebuffer(this._renderTarget,this.isCube?H:void 0,void 0,void 0,this.ignoreCameraViewport,0,c)}_unbindFrameBuffer(H,c){this._renderTarget&&H.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(c)}))}_prepareFrame(H,c,y,Z){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):Z&&H.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(c,y)}_renderToTarget(H,c,y){var Z,F;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=this.va();if(!n)return;const O=n.getEngine();this._prepareFrame(n,H,P,c),null===(Z=O._debugPushGroup)||void 0===Z||Z.call(O,`render to face #${H} layer #${P}`,2),this.is2DArray||this.is3D?(O.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P)):(O.currentRenderPassId=this._renderPassIds[H],this.onBeforeRenderObservable.notifyObservers(H));if(O.snapshotRendering&&1===O.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||n.clearColor,!0,!0,!0);else{var a;let Z=null;const F=this.renderList?this.renderList:n.getActiveMeshes().data,i=this.renderList?this.renderList.length:n.getActiveMeshes().length;this.getCustomRenderList&&(Z=this.getCustomRenderList(this.is2DArray||this.is3D?P:H,F,i)),Z?this._prepareRenderingManager(Z,Z.length,S,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(F,i,S,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),Z=F);for(const c of n._beforeRenderTargetClearStage)c.action(this,H,P);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||n.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0);for(const c of n._beforeRenderTargetDrawStage)c.action(this,H,P);this._renderingManager.render(this.customRenderFunction,Z,this.renderParticles,this.renderSprites);for(const c of n._afterRenderTargetDrawStage)c.action(this,H,P);const g=(null===(a=this._texture)||void 0===a?void 0:a.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,H,this._postProcesses,this.ignoreCameraViewport):c&&n.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,H);for(const c of n._afterRenderTargetPostProcessStage)c.action(this,H,P);this._texture&&(this._texture.generateMipMaps=g),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),y&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),O):C.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(F=O._debugPopGroup)||void 0===F||F.call(O,2),this._unbindFrameBuffer(O,H),this._texture&&this.isCube&&5===H&&O.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(H,c,y,Z)}setRenderingAutoClearDepthStencil(H,c){this._renderingManager.setRenderingAutoClearDepthStencil(H,c),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const H=this.getSize(),c=new g(this.name,H,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return c.pe=this.pe,c.level=this.level,c.coordinatesMode=this.coordinatesMode,this.renderList&&(c.renderList=this.renderList.slice(0)),c}serialize(){if(!this.name)return null;const H=super.serialize();if(H.renderTargetSize=this.getRenderSize(),H.renderList=[],this.renderList)for(let c=0;c<this.renderList.length;c++)H.renderList.push(this.renderList[c].id);return H}disposeFramebufferObjects(){var H;null===(H=this._renderTarget)||void 0===H||H.dispose(!0)}releaseInternalTexture(){var H;null===(H=this._renderTarget)||void 0===H||H.releaseTextures(),this._texture=null}dispose(){var H;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const c=this.va();if(!c)return;let y=c.customRenderTargets.indexOf(this);y>=0&&c.customRenderTargets.splice(y,1);for(const Z of c.cameras)y=Z.customRenderTargets.indexOf(this),y>=0&&Z.customRenderTargets.splice(y,1);null===(H=this._renderTarget)||void 0===H||H.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===g.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=g.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}g.REFRESHRATE_RENDER_ONCE=0,g.REFRESHRATE_RENDER_ONEVERYFRAME=1,g.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,P.d._CreateRenderTargetTexture=(H,c,y,Z,F)=>new g(H,c,y,Z)},11304:(H,c,y)=>{"use strict";y.d(c,{d:()=>D});var Z=y(11052),F=y(11061),P=y(10763),S=y(11092),n=y(11313),O=y(10893),a=y(10798),i=y(10847),C=y(10890),g=y(11215),v=y(10828);function m(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=c.width,F=c.height;if(H instanceof Float32Array){let c=H.byteLength/H.BYTES_PER_ELEMENT;const y=new Uint8Array(c);for(;--c>=0;){let Z=H[c];Z<0?Z=0:Z>1&&(Z=1),y[c]=255*Z}H=y}const P=document.createElement("canvas");P.width=Z,P.height=F;const S=P.getContext("2d");if(!S)return null;const n=S.createImageData(Z,F);if(n.data.set(H),S.putImageData(n,0,0),y){const H=document.createElement("canvas");H.width=Z,H.height=F;const c=H.getContext("2d");return c?(c.translate(0,F),c.scale(1,-1),c.drawImage(P,0,0),H.toDataURL("image/png")):null}return P.toDataURL("image/png")}function z(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Z=H.getInternalTexture();if(!Z)return null;const F=H._readPixelsSync(c,y);return F?m(F,H.getSize(),Z.invertY):null}async function V(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Z=H.getInternalTexture();if(!Z)return null;const F=await H.readPixels(c,y);return F?m(F,H.getSize(),Z.invertY):null}var h=y(11324),Q=y(11118);class D extends n.c{static _CreateVideoTexture(H,c,y){arguments.length>5&&void 0!==arguments[5]||D.TRILINEAR_SAMPLINGMODE;throw(0,a.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(H){this._isBlocking=H}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(H,c,y,Z){let F,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:D.TRILINEAR_SAMPLINGMODE,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9?arguments[9]:void 0,v=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0,z=arguments.length>12?arguments[12]:void 0,V=arguments.length>13?arguments[13]:void 0;super(c),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new P.e,this._isBlocking=!0,this.name=H||"",this.url=H;let Q=!1,f=null,J=!0;"object"===typeof y&&null!==y?(F=y.noMipmap??!1,Z=y.invertY??!h.d,S=y.samplingMode??D.TRILINEAR_SAMPLINGMODE,n=y.X??null,O=y.onError??null,a=y.buffer??null,C=y.deleteBuffer??!1,g=y.format,v=y.mimeType,m=y.loaderOptions,z=y.creationFlags,Q=y.useSRGBBuffer??!1,f=y.internalTexture??null,J=y.gammaSpace??J):F=!!y,this._gammaSpace=J,this._noMipmap=F,this._invertY=void 0===Z?!h.d:Z,this._initialSamplingMode=S,this._buffer=a,this._deleteBuffer=C,this._mimeType=v,this._loaderOptions=m,this._creationFlags=z,this._useSRGBBuffer=Q,this._forcedExtension=V,g&&(this._format=g);const l=this.va(),d=this._getEngine();if(!d)return;d.onBeforeTextureInitObservable.notifyObservers(this);const K=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),n&&n(),!this.isBlocking&&l&&l.resetCachedMaterial()},T=(H,c)=>{this._loadingError=!0,this._errorObject={message:H,exception:c},O&&O(H,c),D.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!f)return this._delayedOnLoad=K,void(this._delayedOnError=T);if(this._texture=f??this._getFromCache(this.url,F,S,this._invertY,Q,this.isCube),this._texture)if(this._texture.isReady)i.d.SetImmediate((()=>K()));else{const H=this._texture.onLoadedObservable.add(K);this._texture.onErrorObservable.add((c=>{var y;T(c.message,c.exception),null===(y=this._texture)||void 0===y||y.onLoadedObservable.remove(H)}))}else if(l&&l.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=K,this._delayedOnError=T;else{try{this._texture=d.createTexture(this.url,F,this._invertY,l,S,K,T,this._buffer,void 0,this._format,this._forcedExtension,v,m,z,Q)}catch(u){throw T("error loading",u),u}C&&(this._buffer=null)}}updateURL(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(H=>H.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=H),this.url=H,this._buffer=c,this._forcedExtension=Z,this.delayLoadState=4,y&&(this._delayedOnLoad=y),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const H=this.va();H&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?i.d.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=H.getEngine().createTexture(this.url,this._noMipmap,this._invertY,H,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(H,c,y,Z){H*=this._cachedUScale,c*=this._cachedVScale,H-=this.uRotationCenter*this._cachedUScale,c-=this.vRotationCenter*this._cachedVScale,y-=this.wRotationCenter,S.n.TransformCoordinatesFromFloatsToRef(H,c,y,this._rowGenerationMatrix,Z),Z.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,Z.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,Z.z+=this.wRotationCenter}getTextureMatrix(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*H===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*H,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=S.d.Zero(),this._rowGenerationMatrix=new S.d,this._t0=S.n.Zero(),this._t1=S.n.Zero(),this._t2=S.n.Zero()),S.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(S.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,S.h.Matrix[0]),S.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,S.h.Matrix[1]),S.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,S.h.Matrix[2]),S.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,S.h.Matrix[3]),S.h.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.h.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.h.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(S.h.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.pi(this._t0),this._t2.pi(this._t0),S.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const c=this.va();if(!c)return this._cachedTextureMatrix;const y=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&y!==this._cachedIdentity3x2&&c.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const H=this.va();if(!H)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==D.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===H.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=S.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=S.d.Zero());const c=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case D.PLANAR_MODE:S.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case D.PROJECTION_MODE:{S.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const c=H.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=c.updateFlag,c.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:S.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return c&&H.markAllMaterialsAsDirty(1,(H=>H.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const H={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return Q.e.Clone((()=>new D(this._texture?this._texture.url:null,this.va(),H)),this)}serialize(){var H;const c=this.name;D.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const y=super.serialize(D._SerializeInternalTextureUniqueId);if(!y)return null;var Z;((D.SerializeBuffers||D.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(y.base64String=this._buffer,y.name=y.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?y.base64String="data:image/png;base64,"+(0,v.i)(this._buffer):(D.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(y.base64String=!this._engine||this._engine._features.supportSyncTextureRead?z(this):V(this))),y.invertY=this._invertY,y.samplingMode=this.samplingMode,y._creationFlags=this._creationFlags,y._useSRGBBuffer=this._useSRGBBuffer,D._SerializeInternalTextureUniqueId)&&(y.internalTextureUniqueId=null===(Z=this._texture)||void 0===Z?void 0:Z.uniqueId);return y.internalTextureLabel=null===(H=this._texture)||void 0===H?void 0:H.label,y.noMipmap=this._noMipmap,this.name=c,y}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(H,c,y){if(H.customType){const Z=C.b.Instantiate(H.customType).Parse(H,c,y);return H.samplingMode&&Z.updateSamplingMode&&Z._samplingMode&&Z._samplingMode!==H.samplingMode&&Z.updateSamplingMode(H.samplingMode),Z}if(H.isCube&&!H.isRenderTarget)return D._CubeTextureParser(H,c,y);const Z=void 0!==H.internalTextureUniqueId;if(!H.name&&!H.isRenderTarget&&!Z)return null;let F;if(Z){const y=c.getEngine().getLoadedTexturesCache();for(const c of y)if(c.uniqueId===H.internalTextureUniqueId){F=c;break}}const P=c=>{if(c&&c._texture&&(c._texture._cachedWrapU=null,c._texture._cachedWrapV=null,c._texture._cachedWrapR=null),H.samplingMode){const y=H.samplingMode;c&&c.samplingMode!==y&&c.updateSamplingMode(y)}if(c&&H.animations)for(let y=0;y<H.animations.length;y++){const Z=H.animations[y],F=(0,O.c)("BABYLON.Animation");F&&c.animations.push(F.Parse(Z))}c&&c._texture&&(Z&&!F&&c._texture._setUniqueId(H.internalTextureUniqueId),c._texture.label=H.internalTextureLabel)};return Q.e.Parse((()=>{let Z=!0;if(H.noMipmap&&(Z=!1),H.mirrorPlane){const y=D._CreateMirror(H.name,H.renderTargetSize,c,Z);return y._waitingRenderList=H.renderList,y.mirrorPlane=g.b.Tg(H.mirrorPlane),P(y),y}if(H.isRenderTarget){let y=null;if(H.isCube){if(c.reflectionProbes)for(let Z=0;Z<c.reflectionProbes.length;Z++){const y=c.reflectionProbes[Z];if(y.name===H.name)return y.cubeTexture}}else y=D._CreateRenderTargetTexture(H.name,H.renderTargetSize,c,Z,H._creationFlags??0),y._waitingRenderList=H.renderList;return P(y),y}if(H.isVideo){const F=D._CreateVideoTexture(y+(H.url||H.name),y+(H.src||H.url),c,Z,H.invertY,H.samplingMode,H.settings||{});return P(F),F}{let S;if(H.base64String&&!F)S=D.CreateFromBase64String(H.base64String,H.base64String,c,!Z,H.invertY,H.samplingMode,(()=>{P(S)}),H._creationFlags??0,H._useSRGBBuffer??!1),S.name=H.name;else{let n;n=H.name&&(H.name.indexOf("://")>0||H.name.startsWith("data:"))?H.name:y+H.name,H.url&&(H.url.startsWith("data:")||D.UseSerializedUrlIfAny)&&(n=H.url);const O={noMipmap:!Z,invertY:H.invertY,samplingMode:H.samplingMode,X:()=>{P(S)},internalTexture:F};S=new D(n,c,O)}return S}}),H,c)}static CreateFromBase64String(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:D.TRILINEAR_SAMPLINGMODE;return new D("data:"+c,y,Z,F,P,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:D.TRILINEAR_SAMPLINGMODE,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,i=arguments.length>10?arguments[10]:void 0,C=arguments.length>11?arguments[11]:void 0;return"data:"!==H.substring(0,5)&&(H="data:"+H),new D(H,y,F,P,S,n,O,c,Z,a,void 0,void 0,i,C)}}D.SerializeBuffers=!0,D.ForceSerializeBuffers=!1,D.OnTextureLoadErrorObservable=new P.e,D._SerializeInternalTextureUniqueId=!1,D._CubeTextureParser=(H,c,y)=>{throw(0,a.b)("CubeTexture")},D._CreateMirror=(H,c,y,Z)=>{throw(0,a.b)("MirrorTexture")},D._CreateRenderTargetTexture=(H,c,y,Z,F)=>{throw(0,a.b)("RenderTargetTexture")},D.NEAREST_SAMPLINGMODE=1,D.NEAREST_NEAREST_MIPLINEAR=8,D.BILINEAR_SAMPLINGMODE=2,D.LINEAR_LINEAR_MIPNEAREST=11,D.TRILINEAR_SAMPLINGMODE=3,D.LINEAR_LINEAR_MIPLINEAR=3,D.NEAREST_NEAREST_MIPNEAREST=4,D.NEAREST_LINEAR_MIPNEAREST=5,D.NEAREST_LINEAR_MIPLINEAR=6,D.NEAREST_LINEAR=7,D.NEAREST_NEAREST=1,D.LINEAR_NEAREST_MIPNEAREST=9,D.LINEAR_NEAREST_MIPLINEAR=10,D.LINEAR_LINEAR=2,D.LINEAR_NEAREST=12,D.EXPLICIT_MODE=0,D.SPHERICAL_MODE=1,D.PLANAR_MODE=2,D.CUBIC_MODE=3,D.PROJECTION_MODE=4,D.SKYBOX_MODE=5,D.INVCUBIC_MODE=6,D.EQUIRECTANGULAR_MODE=7,D.FIXED_EQUIRECTANGULAR_MODE=8,D.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,D.CLAMP_ADDRESSMODE=0,D.WRAP_ADDRESSMODE=1,D.MIRROR_ADDRESSMODE=2,D.UseSerializedUrlIfAny=!1,(0,Z.b)([(0,F.P)()],D.prototype,"url",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"uOffset",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"vOffset",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"uScale",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"vScale",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"uAng",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"vAng",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"wAng",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"uRotationCenter",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"vRotationCenter",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"wRotationCenter",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"homogeneousRotationInUVTransform",void 0),(0,Z.b)([(0,F.P)()],D.prototype,"isBlocking",null),(0,O.d)("BABYLON.Texture",D),Q.e._TextureParser=D.Parse},10883:(H,c,y)=>{"use strict";y.d(c,{e:()=>Z});class Z{get wrapU(){return this._cachedWrapU}set wrapU(H){this._cachedWrapU=H}get wrapV(){return this._cachedWrapV}set wrapV(H){this._cachedWrapV=H}get wrapR(){return this._cachedWrapR}set wrapR(H){this._cachedWrapR=H}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(H){this._cachedAnisotropicFilteringLevel=H}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(H){this._comparisonFunction=H}get useMipMaps(){return this._useMipMaps}set useMipMaps(H){this._useMipMaps=H}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=H,this._cachedWrapV=c,this._cachedWrapR=y,this._cachedAnisotropicFilteringLevel=Z,this.samplingMode=F,this._comparisonFunction=P,this}compareSampler(H){return this._cachedWrapU===H._cachedWrapU&&this._cachedWrapV===H._cachedWrapV&&this._cachedWrapR===H._cachedWrapR&&this._cachedAnisotropicFilteringLevel===H._cachedAnisotropicFilteringLevel&&this.samplingMode===H.samplingMode&&this._comparisonFunction===H._comparisonFunction&&this._useMipMaps===H._useMipMaps}}},11288:(H,c,y)=>{"use strict";function Z(H){-1===H.indexOf("vClipPlane")&&H.push("vClipPlane"),-1===H.indexOf("vClipPlane2")&&H.push("vClipPlane2"),-1===H.indexOf("vClipPlane3")&&H.push("vClipPlane3"),-1===H.indexOf("vClipPlane4")&&H.push("vClipPlane4"),-1===H.indexOf("vClipPlane5")&&H.push("vClipPlane5"),-1===H.indexOf("vClipPlane6")&&H.push("vClipPlane6")}function F(H,c,y){const Z=!!(H.clipPlane??c.clipPlane),F=!!(H.clipPlane2??c.clipPlane2),P=!!(H.clipPlane3??c.clipPlane3),S=!!(H.clipPlane4??c.clipPlane4),n=!!(H.clipPlane5??c.clipPlane5),O=!!(H.clipPlane6??c.clipPlane6);Z&&y.push("#define CLIPPLANE"),F&&y.push("#define CLIPPLANE2"),P&&y.push("#define CLIPPLANE3"),S&&y.push("#define CLIPPLANE4"),n&&y.push("#define CLIPPLANE5"),O&&y.push("#define CLIPPLANE6")}function P(H,c,y){let Z=!1;const F=!!(H.clipPlane??c.clipPlane),P=!!(H.clipPlane2??c.clipPlane2),S=!!(H.clipPlane3??c.clipPlane3),n=!!(H.clipPlane4??c.clipPlane4),O=!!(H.clipPlane5??c.clipPlane5),a=!!(H.clipPlane6??c.clipPlane6);return y.CLIPPLANE!==F&&(y.CLIPPLANE=F,Z=!0),y.CLIPPLANE2!==P&&(y.CLIPPLANE2=P,Z=!0),y.CLIPPLANE3!==S&&(y.CLIPPLANE3=S,Z=!0),y.CLIPPLANE4!==n&&(y.CLIPPLANE4=n,Z=!0),y.CLIPPLANE5!==O&&(y.CLIPPLANE5=O,Z=!0),y.CLIPPLANE6!==a&&(y.CLIPPLANE6=a,Z=!0),Z}function S(H,c,y){let Z=c.clipPlane??y.clipPlane;n(H,"vClipPlane",Z),Z=c.clipPlane2??y.clipPlane2,n(H,"vClipPlane2",Z),Z=c.clipPlane3??y.clipPlane3,n(H,"vClipPlane3",Z),Z=c.clipPlane4??y.clipPlane4,n(H,"vClipPlane4",Z),Z=c.clipPlane5??y.clipPlane5,n(H,"vClipPlane5",Z),Z=c.clipPlane6??y.clipPlane6,n(H,"vClipPlane6",Z)}function n(H,c,y){y&&H.setFloat4(c,y.k.x,y.k.y,y.k.z,y.d)}y.d(c,{c:()=>Z,f:()=>S,i:()=>P,j:()=>F})},11125:(H,c,y)=>{"use strict";function Z(H){H.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}y.d(c,{d:()=>Z})},11542:(H,c,y)=>{"use strict";function Z(H){return void 0===H.getPipelineContext}y.d(c,{b:()=>Z})},11277:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});class Z{static GetEffect(H){return void 0===H.getPipelineContext?H.effect:H}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=H.createDrawContext(),c&&(this.materialContext=H.createMaterialContext())}setEffect(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Z;(this.effect=H,void 0!==c&&(this.defines=c),y)&&(null===(Z=this.drawContext)||void 0===Z||Z.reset())}dispose(){var H;null===(H=this.drawContext)||void 0===H||H.dispose()}}},10864:(H,c,y)=>{"use strict";y.d(c,{b:()=>C,c:()=>v,e:()=>a,h:()=>i});var Z=y(10768),F=y(10869),P=y(10855),S=y(10773),n=y(10836),O=y(10840);function a(H,c){return(0,F.x)(c).cachedPipelines[H]}function i(H){const c=H._name,y=H.context;if(c&&y){const H=(0,F.x)(y),Z=H.cachedPipelines[c];null===Z||void 0===Z||Z.dispose(),delete H.cachedPipelines[c]}}function C(H,c,y,F,P,S,O){let a,i;const C=(0,Z.h)()?null===S||void 0===S?void 0:S.getHostDocument():null;a="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===C||void 0===C?void 0:C.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,i="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===C||void 0===C?void 0:C.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const v=[void 0,void 0],m=()=>{if(v[0]&&v[1]){H.isFragment=!0;const[Z,a]=v;(0,n.e)(a,H,((S,a)=>{O&&(O._fragmentSourceCodeBeforeMigration=a),y&&(S=y("fragment",S));const i=(0,n.b)(Z,S,H);H=null;const C=function(H,c,y,Z){if(y){return{vertexSourceCode:(1===Z?"//":"")+"#define SHADER_NAME vertex:"+(y.vertexElement||y.vertex||y.spectorName||y)+"\n"+H,fragmentSourceCode:(1===Z?"//":"")+"#define SHADER_NAME fragment:"+(y.fragmentElement||y.fragment||y.spectorName||y)+"\n"+c}}return{vertexSourceCode:H,fragmentSourceCode:c}}(i.vertexCode,i.fragmentCode,c,P);null===F||void 0===F||F(C.vertexSourceCode,C.fragmentSourceCode)}),S)}};g(a,"Vertex","",(c=>{(0,n.c)(H),(0,n.e)(c,H,((H,Z)=>{O&&(O._rawVertexSourceCode=c,O._vertexSourceCodeBeforeMigration=Z),y&&(H=y("vertex",H)),v[0]=H,m()}),S)}),P),g(i,"Fragment","Pixel",(H=>{O&&(O._rawFragmentSourceCode=H),v[1]=H,m()}),P)}function g(H,c,y,F,S,n){if("undefined"!==typeof HTMLElement&&H instanceof HTMLElement){return void F((0,Z.b)(H))}if("source:"===H.substring(0,7))return void F(H.substring(7));if("base64:"===H.substring(0,7)){return void F(window.atob(H.substring(7)))}const a=P.e.GetShadersStore(S);if(a[H+c+"Shader"])return void F(a[H+c+"Shader"]);if(y&&a[H+y+"Shader"])return void F(a[H+y+"Shader"]);let i;if(i="."===H[0]||"/"===H[0]||H.indexOf("http")>-1?H:P.e.GetShadersRepository(S)+H,!(n=n||O.k))throw new Error("loadFileInjection is not defined");n(i+"."+c.toLowerCase()+".fx",F)}const v=(H,c,y,Z)=>{try{const P=H.existingPipelineContext||c(H.shaderProcessingContext);if(P._name=H.name,H.name&&H.context){(0,F.x)(H.context).cachedPipelines[H.name]=P}return y(P,H.vertex,H.fragment,!!H.createAsRaw,"","",H.rebuildRebind,H.defines,H.transformFeedbackVaryings,"",(()=>{Z(P,(()=>{var c;null===(c=H.onRenderingStateCompiled)||void 0===c||c.call(H,P)}))})),P}catch(P){throw S.d.Error("Error compiling effect"),P}}},10853:(H,c,y)=>{"use strict";y.d(c,{d:()=>n});var Z=y(10763),F=y(10773),P=y(10855),S=y(10864);class n{static get ShadersRepository(){return P.e.ShadersRepository}static set ShadersRepository(H){P.e.ShadersRepository=H}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Z.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9?arguments[9]:void 0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,z=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Z.e,this.onErrorObservable=new Z.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=H,this._key=v;const V=this._key.replace(/\r/g,"").replace(/\n/g,"|");let h;if(c.attributes){const H=c;if(this._engine=y,this._attributesNames=H.attributes,this._uniformsNames=H.uniformsNames.concat(H.samplers),this._samplerList=H.samplers.slice(),this.defines=H.defines,this.onError=H.onError,this.onCompiled=H.onCompiled,this._fallbacks=H.fallbacks,this._indexParameters=H.indexParameters,this._transformFeedbackVaryings=H.transformFeedbackVaryings||null,this._multiTarget=!!H.multiTarget,this._shaderLanguage=H.shaderLanguage??0,H.uniformBuffersNames){this._uniformBuffersNamesList=H.uniformBuffersNames.slice();for(let c=0;c<H.uniformBuffersNames.length;c++)this._uniformBuffersNames[H.uniformBuffersNames[c]]=c}this._processFinalCode=H.processFinalCode??null,this._processCodeAfterIncludes=H.processCodeAfterIncludes??void 0,h=H.existingPipelineContext}else this._engine=P,this.defines=null==O?"":O,this._uniformsNames=y.concat(F),this._samplerList=F?F.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=m,this.onError=C,this.onCompiled=i,this._indexParameters=g,this._fallbacks=a;"WEBGL2"===this._engine.shaderPlatformName&&(h=(0,S.e)(V,this._engine._gl)??h),this._attributeLocationByName={},this.uniqueId=n._UniqueIdSeed++,h?(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,z)}async _processShaderCodeAsync(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3?arguments[3]:void 0;Z&&await Z(),this._processingContext=y||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const F={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:H??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:P.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:P.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,S.b)(F,this.name,this._processFinalCode,((H,y)=>{this._vertexSourceCode=H,this._fragmentSourceCode=y,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(H){return this._attributes[H]}getAttributeLocationByName(H){return this._attributeLocationByName[H]}getAttributesCount(){return this._attributes.length}getUniformIndex(H){return this._uniformsNames.indexOf(H)}getUniform(H){return this._uniforms[H]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(H){this.isReady()?H(this):(this.onCompileObservable.add((c=>{H(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(H){try{if(this._isReadyInternal())return}catch(c){return void this._processCompilationErrors(c,H)}this._isDisposed||setTimeout((()=>{this._checkIsReady(H)}),16)}get vertexSourceCode(){var H;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(H=this._pipelineContext)||void 0===H?void 0:H._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var H;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(H=this._pipelineContext)||void 0===H?void 0:H._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(H,c,y,Z){this._isReady=!1,this._vertexSourceCodeOverride=H,this._fragmentSourceCodeOverride=c,this.onError=(H,c)=>{Z&&Z(c)},this.onCompiled=()=>{var H,c;const Z=this.getEngine().scenes;if(Z)for(let y=0;y<Z.length;y++)Z[y].markAllMaterialsAsDirty(63);null===(H=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===H||H.call(c,y)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(H){if(this._pipelineContext=H,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const H=this._attributesNames[c];this._attributeLocationByName[H]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),n.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const y=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Z=y?null:this.defines,F=y?this._vertexSourceCodeOverride:this._vertexSourceCode,P=y?this._fragmentSourceCodeOverride:this._fragmentSourceCode,n=this._engine;this._pipelineContext=(0,S.c)({existingPipelineContext:H?c:null,vertex:F,fragment:P,context:"WEBGL2"===n.shaderPlatformName?n._gl:void 0,rebuildRebind:(H,c,y,Z)=>this._rebuildProgram(H,c,y,Z),defines:Z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:y,parallelShaderCompile:n._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:y=>{c&&!H&&this._engine._deletePipelineContext(c),y&&this._onRenderingStateCompiled(y)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(y){this._processCompilationErrors(y,c)}}_getShaderCodeAndErrorLine(H,c,y){const Z=y?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let F=null;if(c&&H){const P=c.match(Z);if(P&&2===P.length){const c=parseInt(P[1]),Z=H.split("\n",-1);Z.length>=c&&(F=`Offending line [${c}] in ${y?"fragment":"vertex"} code: ${Z[c-1]}`)}}return[H,F]}_processCompilationErrors(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=H.message;const y=this._attributesNames,Z=this._fallbacks;if(F.d.Error("Unable to compile effect:"),F.d.Error("Uniforms: "+this._uniformsNames.map((function(H){return" "+H}))),F.d.Error("Attributes: "+y.map((function(H){return" "+H}))),F.d.Error("Defines:\n"+this.defines),n.LogShaderCodeOnCompilationError){var P,S;let H=null,c=null,y=null;var O;if(null!==(P=this._pipelineContext)&&void 0!==P&&P._getVertexShaderCode()&&([y,H]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),y&&(F.d.Error("Vertex code:"),F.d.Error(y))),null!==(S=this._pipelineContext)&&void 0!==S&&S._getFragmentShaderCode())[y,c]=this._getShaderCodeAndErrorLine(null===(O=this._pipelineContext)||void 0===O?void 0:O._getFragmentShaderCode(),this._compilationError,!0),y&&(F.d.Error("Fragment code:"),F.d.Error(y));H&&F.d.Error(H),c&&F.d.Error(c)}F.d.Error("Error: "+this._compilationError);const a=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};c&&(this._pipelineContext=c,this._isReady=!0,a()),Z?(this._pipelineContext=null,Z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,F.d.Error("Trying next fallback."),this.defines=Z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,a(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||a())}get isSupported(){return""===this._compilationError}_bindTexture(H,c){this._engine._bindTexture(this._samplers[H],c,H)}setTexture(H,c){this._engine.setTexture(this._samplers[H],this._uniforms[H],c,H)}setTextureArray(H,c){const y=H+"Ex";if(-1===this._samplerList.indexOf(y+"0")){const Z=this._samplerList.indexOf(H);for(let H=1;H<c.length;H++){const c=y+(H-1).toString();this._samplerList.splice(Z+H,0,c)}let F=0;for(const H of this._samplerList)this._samplers[H]=F,F+=1}this._engine.setTextureArray(this._samplers[H],this._uniforms[H],c,H)}bindUniformBuffer(H,c){const y=this._uniformBuffersNames[c];void 0===y||n._BaseCache[y]===H&&this._engine._features.useUBOBindingCache||(n._BaseCache[y]=H,this._engine.bindUniformBufferBase(H,y,c))}bindUniformBlock(H,c){this._engine.bindUniformBlock(this._pipelineContext,H,c)}setInt(H,c){return this._pipelineContext.setInt(H,c),this}setInt2(H,c,y){return this._pipelineContext.setInt2(H,c,y),this}setInt3(H,c,y,Z){return this._pipelineContext.setInt3(H,c,y,Z),this}setInt4(H,c,y,Z,F){return this._pipelineContext.setInt4(H,c,y,Z,F),this}setIntArray(H,c){return this._pipelineContext.setIntArray(H,c),this}setIntArray2(H,c){return this._pipelineContext.setIntArray2(H,c),this}setIntArray3(H,c){return this._pipelineContext.setIntArray3(H,c),this}setIntArray4(H,c){return this._pipelineContext.setIntArray4(H,c),this}setUInt(H,c){return this._pipelineContext.setUInt(H,c),this}setUInt2(H,c,y){return this._pipelineContext.setUInt2(H,c,y),this}setUInt3(H,c,y,Z){return this._pipelineContext.setUInt3(H,c,y,Z),this}setUInt4(H,c,y,Z,F){return this._pipelineContext.setUInt4(H,c,y,Z,F),this}setUIntArray(H,c){return this._pipelineContext.setUIntArray(H,c),this}setUIntArray2(H,c){return this._pipelineContext.setUIntArray2(H,c),this}setUIntArray3(H,c){return this._pipelineContext.setUIntArray3(H,c),this}setUIntArray4(H,c){return this._pipelineContext.setUIntArray4(H,c),this}setFloatArray(H,c){return this._pipelineContext.setArray(H,c),this}setFloatArray2(H,c){return this._pipelineContext.setArray2(H,c),this}setFloatArray3(H,c){return this._pipelineContext.setArray3(H,c),this}setFloatArray4(H,c){return this._pipelineContext.setArray4(H,c),this}setArray(H,c){return this._pipelineContext.setArray(H,c),this}setArray2(H,c){return this._pipelineContext.setArray2(H,c),this}setArray3(H,c){return this._pipelineContext.setArray3(H,c),this}setArray4(H,c){return this._pipelineContext.setArray4(H,c),this}setMatrices(H,c){return this._pipelineContext.setMatrices(H,c),this}setMatrix(H,c){return this._pipelineContext.setMatrix(H,c),this}setMatrix3x3(H,c){return this._pipelineContext.setMatrix3x3(H,c),this}setMatrix2x2(H,c){return this._pipelineContext.setMatrix2x2(H,c),this}setFloat(H,c){return this._pipelineContext.setFloat(H,c),this}setBool(H,c){return this._pipelineContext.setInt(H,c?1:0),this}setVector2(H,c){return this._pipelineContext.setVector2(H,c),this}setFloat2(H,c,y){return this._pipelineContext.setFloat2(H,c,y),this}setVector3(H,c){return this._pipelineContext.setVector3(H,c),this}setFloat3(H,c,y,Z){return this._pipelineContext.setFloat3(H,c,y,Z),this}setVector4(H,c){return this._pipelineContext.setVector4(H,c),this}setQuaternion(H,c){return this._pipelineContext.setQuaternion(H,c),this}setFloat4(H,c,y,Z,F){return this._pipelineContext.setFloat4(H,c,y,Z,F),this}setColor3(H,c){return this._pipelineContext.setColor3(H,c),this}setColor4(H,c,y){return this._pipelineContext.setColor4(H,c,y),this}setDirectColor4(H,c){return this._pipelineContext.setDirectColor4(H,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,S.h)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(P.e.GetShadersStore(Z)[`${H}PixelShader`]=c),y&&(P.e.GetShadersStore(Z)[`${H}VertexShader`]=y)}static ResetCache(){n._BaseCache={}}}n.LogShaderCodeOnCompilationError=!0,n.AutomaticallyClearCodeCache=!1,n._UniqueIdSeed=0,n._BaseCache={},n.ShadersStore=P.e.ShadersStore,n.IncludesShadersStore=P.e.IncludesShadersStore},11334:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(H,c){this._defines[H]||(H<this._currentRank&&(this._currentRank=H),H>this._maxRank&&(this._maxRank=H),this._defines[H]=new Array),this._defines[H].push(c)}addCPUSkinningFallback(H,c){this._mesh=c,H<this._currentRank&&(this._currentRank=H),H>this._maxRank&&(this._maxRank=H)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(H,c){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,H=H.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c._bonesComputationForcedToCPU=!0;const y=this._mesh.va();for(let H=0;H<y.meshes.length;H++){const Z=y.meshes[H];if(Z.material){if(Z.computeBonesUsingShaders&&0!==Z.numBoneInfluencers)if(Z.material.getEffect()===c)Z.computeBonesUsingShaders=!1;else if(Z.$f)for(const H of Z.$f){if(H.effect===c){Z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&Z.computeBonesUsingShaders&&Z.numBoneInfluencers>0&&(Z.computeBonesUsingShaders=!1)}}else{const c=this._defines[this._currentRank];if(c)for(let y=0;y<c.length;y++)H=H.replace("#define "+c[y],"");this._currentRank++}return H}}},11655:(H,c,y)=>{"use strict";y.d(c,{e:()=>a,g:()=>i});var Z=y(11153),F=y(11372),P=y(10763),S=y(10853),n=y(11277);y(11658);const O={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class a{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;this._fullscreenViewport=new F.c(0,0,1,1);const y=c.xa??O.xa,P=c.indices??O.indices;this.kd=H,this._vertexBuffers={[Z.h.PositionKind]:new Z.h(H,y,Z.h.PositionKind,!1,!1,2)},this._indexBuffer=H.createIndexBuffer(P),this._onContextRestoredObserver=H.onContextRestoredObservable.add((()=>{this._indexBuffer=H.createIndexBuffer(P);for(const H in this._vertexBuffers){this._vertexBuffers[H]._rebuild()}}))}setViewport(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.kd.setViewport(H)}bindBuffers(H){this.kd.bindBuffers(this._vertexBuffers,this._indexBuffer,H)}applyEffectWrapper(H){this.kd.setState(!0),this.kd.depthCullingState.depthTest=!1,this.kd.stencilState.stencilTest=!1,this.kd.enableEffect(H.drawWrapper),this.bindBuffers(H.effect),H.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.kd.depthCullingState.depthTest,this._savedStateStencilTest=this.kd.stencilState.stencilTest}restoreStates(){this.kd.depthCullingState.depthTest=this._savedStateDepthTest,this.kd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.kd.drawElementsType(0,0,6)}_isRenderTargetTexture(H){return void 0!==H.renderTarget}render(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!H.effect.isReady())return;this.saveStates(),this.setViewport();const y=null===c?null:this._isRenderTargetTexture(c)?c.renderTarget:c;y&&this.kd.bindFramebuffer(y),this.applyEffectWrapper(H),this.draw(),y&&this.kd.unBindFramebuffer(y),this.restoreStates()}dispose(){const H=this._vertexBuffers[Z.h.PositionKind];H&&(H.dispose(),delete this._vertexBuffers[Z.h.PositionKind]),this._indexBuffer&&this.kd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.kd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class i{static RegisterShaderCodeProcessing(H,c){c?i._CustomShaderCodeProcessing[H??""]=c:delete i._CustomShaderCodeProcessing[H??""]}static _GetShaderCodeProcessing(H){return i._CustomShaderCodeProcessing[H]??i._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(H){this.options.name=H}isReady(){var H;return(null===(H=this._drawWrapper.effect)||void 0===H?void 0:H.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(H){this._drawWrapper.effect=H}constructor(H){this.alphaMode=0,this.onEffectCreatedObservable=new P.e(void 0,!0),this.onApplyObservable=new P.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...H,name:H.name||"effectWrapper",kd:H.kd,uniforms:H.uniforms||H.uniformNames||[],uniformNames:void 0,samplers:H.samplers||H.samplerNames||[],samplerNames:void 0,attributeNames:H.attributeNames||["position"],uniformBuffers:H.uniformBuffers||[],defines:H.defines||"",useShaderStore:H.useShaderStore||!1,vertexUrl:H.vertexUrl||H.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:H.fragmentShader||"pass",indexParameters:H.indexParameters,blockCompilation:H.blockCompilation||!1,shaderLanguage:H.shaderLanguage||0,onCompiled:H.onCompiled||void 0,extraInitializations:H.extraInitializations||void 0,extraInitializationsAsync:H.extraInitializationsAsync||void 0,useAsPostProcess:H.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),H.vertexUrl||H.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.kd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new n.b(this.options.kd),this._webGPUReady=1===this.options.shaderLanguage;const c=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,c,this.options.extraInitializations)}_gatherImports(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(H&&this._webGPUReady?c.push(Promise.all([y.e(37).then(y.bind(y,13597))])):c.push(Promise.all([Promise.resolve().then(y.bind(y,11658))])))}_postConstructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,Z&&this._importPromises.push(...Z);const F=this.options.kd.isWebGPU&&!i.ForceGLSL;this._gatherImports(F,this._importPromises),void 0!==y&&y(F,this._importPromises),F&&this._webGPUReady&&(this.options.shaderLanguage=1),H||this.updateEffect(c)}updateEffect(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0;const a=i._GetShaderCodeProcessing(this.name);if(null!==a&&void 0!==a&&a.defineCustomBindings){var C,g;const Z=(null===(C=c)||void 0===C?void 0:C.slice())??[];Z.push(...this.options.uniforms);const F=(null===(g=y)||void 0===g?void 0:g.slice())??[];F.push(...this.options.samplers),H=a.defineCustomBindings(this.name,H,Z,F),c=Z,y=F}this.options.defines=H||"";const v=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let m;m=this.options.extraInitializationsAsync?async()=>{null===v||void 0===v||v(),await this.options.extraInitializationsAsync}:v,this.options.useShaderStore?this._drawWrapper.effect=this.options.kd.createEffect({vertex:n??this._shaderPath.vertex,fragment:O??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:c||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:y||this.options.samplers,defines:null!==H?H:"",fallbacks:null,onCompiled:F??this.options.onCompiled,onError:P??null,indexParameters:Z||this.options.indexParameters,processCodeAfterIncludes:null!==a&&void 0!==a&&a.processCodeAfterIncludes?(H,c)=>a.processCodeAfterIncludes(this.name,H,c):null,processFinalCode:null!==a&&void 0!==a&&a.processFinalCode?(H,c)=>a.processFinalCode(this.name,H,c):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:m},this.options.kd):this._drawWrapper.effect=new S.d(this._shaderPath,this.options.attributeNames,c||this.options.uniforms,y||this.options.samplerNames,this.options.kd,H,void 0,F||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,m),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var H,c;this.options.useAsPostProcess&&(this.options.kd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(H=i._GetShaderCodeProcessing(this.name))||void 0===H||null===(c=H.bindCustomBindings)||void 0===c||c.call(H,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}i.ForceGLSL=!1,i._CustomShaderCodeProcessing={}},11134:(H,c,y)=>{"use strict";y.d(c,{b:()=>P,e:()=>F});var Z=y(11125);function F(H,c){c.EXPOSURE&&H.push("exposureLinear"),c.CONTRAST&&H.push("contrast"),c.COLORGRADING&&H.push("colorTransformSettings"),(c.VIGNETTE||c.DITHER)&&H.push("vInverseScreenSize"),c.VIGNETTE&&(H.push("vignetteSettings1"),H.push("vignetteSettings2")),c.COLORCURVES&&(0,Z.d)(H),c.DITHER&&H.push("ditherIntensity")}function P(H,c){c.COLORGRADING&&H.push("txColorTransform")}},11108:(H,c,y)=>{"use strict";y.d(c,{d:()=>v});var Z=y(11052),F=y(11061),P=y(10763),S=y(11112),n=y(11118),O=y(11125);class a{constructor(){this._dirty=!0,this._tempColor=new S.h(0,0,0,0),this._globalCurve=new S.h(0,0,0,0),this._highlightsCurve=new S.h(0,0,0,0),this._midtonesCurve=new S.h(0,0,0,0),this._shadowsCurve=new S.h(0,0,0,0),this._positiveCurve=new S.h(0,0,0,0),this._negativeCurve=new S.h(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(H){this._globalHue=H,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(H){this._globalDensity=H,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(H){this._globalSaturation=H,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(H){this._globalExposure=H,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(H){this._highlightsHue=H,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(H){this._highlightsDensity=H,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(H){this._highlightsSaturation=H,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(H){this._highlightsExposure=H,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(H){this._midtonesHue=H,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(H){this._midtonesDensity=H,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(H){this._midtonesSaturation=H,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(H){this._midtonesExposure=H,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(H){this._shadowsHue=H,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(H){this._shadowsDensity=H,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(H){this._shadowsSaturation=H,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(H){this._shadowsExposure=H,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";H._dirty&&(H._dirty=!1,H._getColorGradingDataToRef(H._globalHue,H._globalDensity,H._globalSaturation,H._globalExposure,H._globalCurve),H._getColorGradingDataToRef(H._highlightsHue,H._highlightsDensity,H._highlightsSaturation,H._highlightsExposure,H._tempColor),H._tempColor.multiplyToRef(H._globalCurve,H._highlightsCurve),H._getColorGradingDataToRef(H._midtonesHue,H._midtonesDensity,H._midtonesSaturation,H._midtonesExposure,H._tempColor),H._tempColor.multiplyToRef(H._globalCurve,H._midtonesCurve),H._getColorGradingDataToRef(H._shadowsHue,H._shadowsDensity,H._shadowsSaturation,H._shadowsExposure,H._tempColor),H._tempColor.multiplyToRef(H._globalCurve,H._shadowsCurve),H._highlightsCurve.subtractToRef(H._midtonesCurve,H._positiveCurve),H._midtonesCurve.subtractToRef(H._shadowsCurve,H._negativeCurve)),c&&(c.setFloat4(y,H._positiveCurve.r,H._positiveCurve.g,H._positiveCurve.b,H._positiveCurve.a),c.setFloat4(Z,H._midtonesCurve.r,H._midtonesCurve.g,H._midtonesCurve.b,H._midtonesCurve.a),c.setFloat4(F,H._negativeCurve.r,H._negativeCurve.g,H._negativeCurve.b,H._negativeCurve.a))}_getColorGradingDataToRef(H,c,y,Z,F){null!=H&&(H=a._Clamp(H,0,360),c=a._Clamp(c,-100,100),y=a._Clamp(y,-100,100),Z=a._Clamp(Z,-100,100),c=a._ApplyColorGradingSliderNonlinear(c),c*=.5,Z=a._ApplyColorGradingSliderNonlinear(Z),c<0&&(c*=-1,H=(H+180)%360),a._FromHSBToRef(H,c,50+.25*Z,F),F.scaleToRef(2,F),F.a=1+.01*y)}static _ApplyColorGradingSliderNonlinear(H){H/=100;let c=Math.abs(H);return c=Math.pow(c,2),H<0&&(c*=-1),c*=100,c}static _FromHSBToRef(H,c,y,Z){let F=a._Clamp(H,0,360);const P=a._Clamp(c/100,0,1),S=a._Clamp(y/100,0,1);if(0===P)Z.r=S,Z.g=S,Z.b=S;else{F/=60;const H=Math.floor(F),c=F-H,y=S*(1-P),n=S*(1-P*c),O=S*(1-P*(1-c));switch(H){case 0:Z.r=S,Z.g=O,Z.b=y;break;case 1:Z.r=n,Z.g=S,Z.b=y;break;case 2:Z.r=y,Z.g=S,Z.b=O;break;case 3:Z.r=y,Z.g=n,Z.b=S;break;case 4:Z.r=O,Z.g=y,Z.b=S;break;default:Z.r=S,Z.g=y,Z.b=n}}Z.a=1}static _Clamp(H,c,y){return Math.min(Math.max(H,c),y)}clone(){return n.e.Clone((()=>new a),this)}serialize(){return n.e.Serialize(this)}static Parse(H){return n.e.Parse((()=>new a),H,null,null)}}a.PrepareUniforms=O.d,(0,Z.b)([(0,F.P)()],a.prototype,"_globalHue",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_globalDensity",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_globalSaturation",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_globalExposure",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_highlightsHue",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_highlightsDensity",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_highlightsSaturation",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_highlightsExposure",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_midtonesHue",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_midtonesDensity",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_midtonesSaturation",void 0),(0,Z.b)([(0,F.P)()],a.prototype,"_midtonesExposure",void 0),n.e._ColorCurvesParser=a.Parse;var i=y(10908),C=y(11134),g=y(10893);class v{constructor(){this.colorCurves=new a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=v.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new S.h(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=v.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new P.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(H){this._colorCurvesEnabled!==H&&(this._colorCurvesEnabled=H,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(H){this._colorGradingTexture!==H&&(this._colorGradingTexture=H,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(H){this._colorGradingEnabled!==H&&(this._colorGradingEnabled=H,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(H){this._colorGradingWithGreenDepth!==H&&(this._colorGradingWithGreenDepth=H,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(H){this._colorGradingBGR!==H&&(this._colorGradingBGR=H,this._updateParameters())}get exposure(){return this._exposure}set exposure(H){this._exposure!==H&&(this._exposure=H,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(H){this._toneMappingEnabled!==H&&(this._toneMappingEnabled=H,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(H){this._toneMappingType!==H&&(this._toneMappingType=H,this._updateParameters())}get contrast(){return this._contrast}set contrast(H){this._contrast!==H&&(this._contrast=H,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(H){this.vignetteCenterY=H}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(H){this.vignetteCenterX=H}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(H){this._vignetteBlendMode!==H&&(this._vignetteBlendMode=H,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(H){this._vignetteEnabled!==H&&(this._vignetteEnabled=H,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(H){this._ditheringEnabled!==H&&(this._ditheringEnabled=H,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(H){this._ditheringIntensity!==H&&(this._ditheringIntensity=H,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(H){this._skipFinalColorClamp!==H&&(this._skipFinalColorClamp=H,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(H){this._applyByPostProcess!==H&&(this._applyByPostProcess=H,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(H){this._isEnabled!==H&&(this._isEnabled=H,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(H){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return H.VIGNETTE=!1,H.TONEMAPPING=0,H.CONTRAST=!1,H.EXPOSURE=!1,H.COLORCURVES=!1,H.COLORGRADING=!1,H.COLORGRADING3D=!1,H.DITHER=!1,H.IMAGEPROCESSING=!1,H.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(H.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(H.VIGNETTE=this.vignetteEnabled,H.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===v._VIGNETTEMODE_MULTIPLY,H.VIGNETTEBLENDMODEOPAQUE=!H.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case v.TONEMAPPING_KHR_PBR_NEUTRAL:H.TONEMAPPING=3;break;case v.TONEMAPPING_ACES:H.TONEMAPPING=2;break;default:H.TONEMAPPING=1}else H.TONEMAPPING=0;H.CONTRAST=1!==this.contrast,H.EXPOSURE=1!==this.exposure,H.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,H.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,H.COLORGRADING?H.COLORGRADING3D=this.colorGradingTexture.is3D:H.COLORGRADING3D=!1,H.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,H.SAMPLER3DBGRMAP=this.colorGradingBGR,H.DITHER=this._ditheringEnabled,H.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,H.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,H.IMAGEPROCESSING=H.VIGNETTE||!!H.TONEMAPPING||H.CONTRAST||H.EXPOSURE||H.COLORCURVES||H.COLORGRADING||H.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(H,c){if(this._colorCurvesEnabled&&this.colorCurves&&a.Bind(this.colorCurves,H),this._vignetteEnabled||this._ditheringEnabled){const y=1/H.getEngine().getRenderWidth(),Z=1/H.getEngine().getRenderHeight();if(H.setFloat2("vInverseScreenSize",y,Z),this._ditheringEnabled&&H.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const F=null!=c?c:Z/y;let P=Math.tan(.5*this.vignetteCameraFov),S=P*F;const n=Math.sqrt(S*P);S=(0,i.k)(S,n,this.vignetteStretch),P=(0,i.k)(P,n,this.vignetteStretch),H.setFloat4("vignetteSettings1",S,P,-S*this.vignetteCenterX,-P*this.vignetteCenterY);const O=-2*this.vignetteWeight;H.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,O)}}if(H.setFloat("exposureLinear",this.exposure),H.setFloat("contrast",this.contrast),this.colorGradingTexture){H.setTexture("txColorTransform",this.colorGradingTexture);const c=this.colorGradingTexture.getSize().height;H.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}}clone(){return n.e.Clone((()=>new v),this)}serialize(){return n.e.Serialize(this)}static Parse(H){const c=n.e.Parse((()=>new v),H,null,null);return void 0!==H.vignetteCentreX&&(c.vignetteCenterX=H.vignetteCentreX),void 0!==H.vignetteCentreY&&(c.vignetteCenterY=H.vignetteCentreY),c}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}v.TONEMAPPING_STANDARD=0,v.TONEMAPPING_ACES=1,v.TONEMAPPING_KHR_PBR_NEUTRAL=2,v.PrepareUniforms=C.e,v.PrepareSamplers=C.b,v._VIGNETTEMODE_MULTIPLY=0,v._VIGNETTEMODE_OPAQUE=1,(0,Z.b)([(0,F.j)()],v.prototype,"colorCurves",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_colorCurvesEnabled",void 0),(0,Z.b)([(0,F.H)("colorGradingTexture")],v.prototype,"_colorGradingTexture",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_colorGradingEnabled",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_colorGradingWithGreenDepth",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_colorGradingBGR",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_exposure",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_toneMappingEnabled",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_toneMappingType",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_contrast",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"vignetteStretch",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"vignetteCenterX",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"vignetteCenterY",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"vignetteWeight",void 0),(0,Z.b)([(0,F.o)()],v.prototype,"vignetteColor",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"vignetteCameraFov",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_vignetteBlendMode",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_vignetteEnabled",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_ditheringEnabled",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_ditheringIntensity",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_skipFinalColorClamp",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_applyByPostProcess",void 0),(0,Z.b)([(0,F.P)()],v.prototype,"_isEnabled",void 0),n.e._ImageProcessingConfigurationParser=v.Parse,(0,g.d)("BABYLON.ImageProcessingConfiguration",v)},11340:(H,c,y)=>{"use strict";y.d(c,{e:()=>C});var Z=y(11052),F=y(11239),P=y(11061),S=y(11332),n=y(11293),O=y(11344),a=y(11285);class i extends n.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class C extends O.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(H,"DetailMap",140,new i,c),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=F.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=H._dirtyCallbacks[1]}isReadyForSubMesh(H,c,y){return!this._isEnabled||!(H._areTexturesDirty&&c.texturesEnabled&&y.getCaps().standardDerivatives&&this._texture&&S.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(H,c){if(this._isEnabled){H.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const y=c.getEngine();H._areTexturesDirty&&(y.getCaps().standardDerivatives&&this._texture&&S.b.DetailTextureEnabled&&this._isEnabled?((0,a.N)(this._texture,H,"DETAIL"),H.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):H.DETAIL=!1)}else H.DETAIL=!1}bindForSubMesh(H,c){if(!this._isEnabled)return;const y=this._material.isFrozen;H.useUbo&&y&&H.isSync||this._texture&&S.b.DetailTextureEnabled&&(H.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,a.o)(this._texture,H,"detail")),c.texturesEnabled&&this._texture&&S.b.DetailTextureEnabled&&H.setTexture("detailSampler",this._texture)}hasTexture(H){return this._texture===H}getActiveTextures(H){this._texture&&H.push(this._texture)}getAnimatables(H){this._texture&&this._texture.animations&&this._texture.animations.length>0&&H.push(this._texture)}dispose(H){var c;H&&(null===(c=this._texture)||void 0===c||c.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(H){H.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,Z.b)([(0,P.H)("detailTexture"),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],C.prototype,"texture",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"diffuseBlendLevel",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"roughnessBlendLevel",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"bumpLevel",void 0),(0,Z.b)([(0,P.P)(),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],C.prototype,"normalBlendMethod",void 0),(0,Z.b)([(0,P.P)(),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],C.prototype,"isEnabled",void 0)},11239:(H,c,y)=>{"use strict";y.d(c,{c:()=>V});var Z=y(11052),F=y(11061),P=y(10754),S=y(10763),n=y(10810),O=y(11245),a=y(11140),i=y(10773),C=y(11215),g=y(11277),v=y(11118);class m{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(H){this._func=H}get funcRef(){return this._funcRef}set funcRef(H){this._funcRef=H}get funcMask(){return this._funcMask}set funcMask(H){this._funcMask=H}get opStencilFail(){return this._opStencilFail}set opStencilFail(H){this._opStencilFail=H}get opDepthFail(){return this._opDepthFail}set opDepthFail(H){this._opDepthFail=H}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(H){this._opStencilDepthPass=H}get mask(){return this._mask}set mask(H){this._mask=H}get enabled(){return this._enabled}set enabled(H){this._enabled=H}getClassName(){return"MaterialStencilState"}copyTo(H){v.e.Clone((()=>H),this)}serialize(){return v.e.Serialize(this)}parse(H,c,y){v.e.Parse((()=>this),H,c,y)}}(0,Z.b)([(0,F.P)()],m.prototype,"func",null),(0,Z.b)([(0,F.P)()],m.prototype,"funcRef",null),(0,Z.b)([(0,F.P)()],m.prototype,"funcMask",null),(0,Z.b)([(0,F.P)()],m.prototype,"opStencilFail",null),(0,Z.b)([(0,F.P)()],m.prototype,"opDepthFail",null),(0,Z.b)([(0,F.P)()],m.prototype,"opStencilDepthPass",null),(0,Z.b)([(0,F.P)()],m.prototype,"mask",null),(0,Z.b)([(0,F.P)()],m.prototype,"enabled",null);var z=y(11285);class V{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(H){if(this._alpha===H)return;const c=this._alpha;this._alpha=H,1!==c&&1!==H||this.Fg(V.MiscDirtyFlag+V.PrePassDirtyFlag)}get alpha(){return this._alpha}set dh(H){this._backFaceCulling!==H&&(this._backFaceCulling=H,this.Fg(V.TextureDirtyFlag))}get dh(){return this._backFaceCulling}set cullBackFaces(H){this._cullBackFaces!==H&&(this._cullBackFaces=H,this.Fg(V.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(H){this._blockDirtyMechanism!==H&&(this._blockDirtyMechanism=H,H||this.dj())}atomicMaterialsUpdate(H){this.blockDirtyMechanism=!0;try{H(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.e),this._onBindObservable}set onBind(H){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(H)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new S.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new S.e),this._onEffectCreatedObservable}set alphaMode(H){this._alphaMode!==H&&(this._alphaMode=H,this.Fg(V.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(H){this._needDepthPrePass!==H&&(this._needDepthPrePass=H,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(H){this._fogEnabled!==H&&(this._fogEnabled=H,this.Fg(V.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case V.WireFrameFillMode:case V.LineListDrawMode:case V.LineLoopDrawMode:case V.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(H){this.fillMode=H?V.WireFrameFillMode:V.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case V.PointFillMode:case V.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(H){this.fillMode=H?V.PointFillMode:V.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(H){this._fillMode!==H&&(this._fillMode=H,this.Fg(V.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(H){const c=this.va().getEngine().getCaps().fragmentDepthSupported;H&&!c&&i.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=H&&c,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(H){this._drawWrapper=H}constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.jj=new S.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new m,this._useUBO=!1,this._fillMode=V.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=H;const F=c||n.b.LastCreatedScene;F&&(this._scene=F,this._dirtyCallbacks={},this._forceGLSL=Z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=H||P.c.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new g.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new a.e(this._scene.getEngine(),void 0,void 0,H),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),y||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),V.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var H;const c=this.va().getEngine();null===(H=this._uniformBuffer)||void 0===H||H.dispose(),c.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new a.e(c,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new a.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(H){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.dj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.dj(),this.checkReadyOnlyOnce=!1}isReady(H,c){return!0}isReadyForSubMesh(H,c,y){const Z=c.materialDefines;return!!Z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(H){return null!==this.sideOrientation?this.sideOrientation:H.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(H){this._transparencyMode!==H&&(this._transparencyMode=H,this._forceAlphaTest=H===V.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===V.MATERIAL_OPAQUE||this._transparencyMode===V.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(H){return H.visibility<1||!this._disableAlphaBlending&&(H.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(H){return!this.needAlphaBlendingForMesh(H)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}dj(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.va().meshes;for(const y of c)if(y.$f)for(const c of y.$f)if(c.Ha()===this)for(const y of c._drawWrappers)y&&this._materialContext===y.materialContext&&(y._wasPreviouslyReady=!1,y._wasPreviouslyUsingInstances=null,y._forceRebindOnNextCall=H);H&&this.Fg(V.AllDirtyFlag)}_preBind(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.getEngine(),Z=(null==c?this.sideOrientation:c)===V.ClockWiseSideOrientation;return y.enableEffect(H||this._getDrawWrapper()),y.setState(this.dh,this.zOffset,!1,Z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),Z}bind(H,c){}buildUniformLayout(){const H=this._uniformBuffer;this._eventInfo.ubo=H,this._callbackPluginEventGeneric(8,this._eventInfo),H.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(H,c,y){const Z=y._drawWrapper;this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),Z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(H){}bindView(H){this._useUBO?this._needToBindSceneUbo=!0:H.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(H){this._useUBO?this._needToBindSceneUbo=!0:(H.setMatrix("viewProjection",this.va().getTransformMatrix()),H.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(H,c){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(H,c)}_afterBind(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&c&&(this._needToBindSceneUbo=!1,(0,z.m)(c,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=H?H.visibility:1,this._onBindObservable&&H&&this._onBindObservable.notifyObservers(H),this.disableDepthWrite){const H=this._scene.getEngine();this._cachedDepthWriteState=H.getDepthWrite(),H.setDepthWrite(!1)}if(this.disableColorWrite){const H=this._scene.getEngine();this._cachedColorWriteState=H.getColorWrite(),H.setColorWrite(!1)}if(0!==this.depthFunction){const H=this._scene.getEngine();this._cachedDepthFunctionState=H.getDepthFunction()||0,H.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(H){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=H,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(H){return null}_clonePlugins(H,c){const y={};if(this._serializePlugins(y),V._ParsePlugins(y,H,this._scene,c),this.pluginManager)for(const Z of this.pluginManager._plugins){const c=H.pluginManager.getPlugin(Z.name);c&&Z.copyTo(c)}}getBindedMeshes(){if(this.meshMap){const H=[];for(const c in this.meshMap){const y=this.meshMap[c];y&&H.push(y)}return H}return this._scene.meshes.filter((H=>H.material===this))}forceCompilation(H,c,y,Z){const F={clipPlane:!1,useInstances:!1,...y},P=this.va(),S=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const n=()=>{if(!this._scene||!this._scene.getEngine())return;const y=P.clipPlane;if(F.clipPlane&&(P.clipPlane=new C.b(0,0,0,1)),this._storeEffectOnSubMeshes){let y=!0,P=null;if(H.$f){const c=new O.b(0,0,0,0,0,H,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),this.isReadyForSubMesh(H,c,F.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?P=c.effect.getCompilationError():(y=!1,setTimeout(n,16)))}y&&(this.allowShaderHotSwapping=S,P&&Z&&Z(P),c&&c(this))}else this.isReady()?(this.allowShaderHotSwapping=S,c&&c(this)):setTimeout(n,16);F.clipPlane&&(P.clipPlane=y)};n()}forceCompilationAsync(H,c){return new Promise(((y,Z)=>{this.forceCompilation(H,(()=>{y()}),c,(H=>{Z(H)}))}))}Fg(H){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(V._DirtyCallbackArray.length=0,H&V.TextureDirtyFlag&&V._DirtyCallbackArray.push(V._TextureDirtyCallBack),H&V.LightDirtyFlag&&V._DirtyCallbackArray.push(V._LightsDirtyCallBack),H&V.FresnelDirtyFlag&&V._DirtyCallbackArray.push(V._FresnelDirtyCallBack),H&V.AttributesDirtyFlag&&V._DirtyCallbackArray.push(V._AttributeDirtyCallBack),H&V.MiscDirtyFlag&&V._DirtyCallbackArray.push(V._MiscDirtyCallBack),H&V.PrePassDirtyFlag&&V._DirtyCallbackArray.push(V._PrePassDirtyCallBack),V._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(V._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const H=this.va().meshes;for(const c of H)if(c.$f)for(const H of c.$f)H.Ha()===this&&H.resetDrawCache()}_markAllSubMeshesAsDirty(H){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const c=this.va().meshes;for(const y of c)if(y.$f)for(const c of y.$f)if(c.Ha(!1)===this)for(const y of c._drawWrappers)y&&y.defines&&y.defines.markAllAsDirty&&this._materialContext===y.materialContext&&H(y.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const H=this.va().enablePrePassRenderer();H&&H.Fg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(V._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(V._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(V._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(V._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(V._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(V._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(V._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(V._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(V._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(V._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const H=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.jj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(H)}))}}setPrePassRenderer(H){return!1}dispose(H,c,y){const Z=this.va();if(Z.stopAnimation(this),Z.freeProcessedMaterials(),Z.removeMaterial(this),this._eventInfo.forceDisposeTextures=c,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const H=this._parentContainer.materials.indexOf(this);H>-1&&this._parentContainer.materials.splice(H,1),this._parentContainer=null}if(!0!==y)if(this.meshMap)for(const F in this.meshMap){const c=this.meshMap[F];c&&(c.material=null,this.releaseVertexArrayObject(c,H))}else{const c=Z.meshes;for(const y of c)y.material!==this||y.sourceMesh||(y.material=null,this.releaseVertexArrayObject(y,H))}this._uniformBuffer.dispose(),H&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.jj.notifyObservers(this),this.jj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(H,c){const y=H.Dj;if(y)if(this._storeEffectOnSubMeshes){if(H.$f)for(const Z of H.$f)y._releaseVertexArrayObject(Z.effect),c&&Z.effect&&Z.effect.dispose()}else y._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const H=v.e.Serialize(this);return H.stencil=this.stencil.serialize(),H.uniqueId=this.uniqueId,this._serializePlugins(H),H}_serializePlugins(H){if(H.plugins={},this.pluginManager)for(const c of this.pluginManager._plugins)H.plugins[c.getClassName()]=c.serialize()}static Parse(H,c,y){if(H.customType){if("BABYLON.PBRMaterial"===H.customType&&H.overloadedAlbedo&&(H.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return i.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else H.customType="BABYLON.StandardMaterial";const Z=P.c.Instantiate(H.customType).Parse(H,c,y);return Z._loadedUniqueId=H.uniqueId,Z}static _ParsePlugins(H,c,y,Z){if(H.plugins)for(const n in H.plugins){var F,S;const O=H.plugins[n];let a=null===(F=c.pluginManager)||void 0===F?void 0:F.getPlugin(O.name);if(!a){const H=P.c.Instantiate("BABYLON."+n);H&&(a=new H(c))}null===(S=a)||void 0===S||S.parse(O,y,Z)}}}V.TriangleFillMode=0,V.WireFrameFillMode=1,V.PointFillMode=2,V.PointListDrawMode=3,V.LineListDrawMode=4,V.LineLoopDrawMode=5,V.LineStripDrawMode=6,V.TriangleStripDrawMode=7,V.TriangleFanDrawMode=8,V.ClockWiseSideOrientation=0,V.CounterClockWiseSideOrientation=1,V.TextureDirtyFlag=1,V.LightDirtyFlag=2,V.FresnelDirtyFlag=4,V.AttributesDirtyFlag=8,V.MiscDirtyFlag=16,V.PrePassDirtyFlag=32,V.AllDirtyFlag=63,V.MATERIAL_OPAQUE=0,V.MATERIAL_ALPHATEST=1,V.MATERIAL_ALPHABLEND=2,V.MATERIAL_ALPHATESTANDBLEND=3,V.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,V.MATERIAL_NORMALBLENDMETHOD_RNM=1,V.OnEventObservable=new S.e,V._AllDirtyCallBack=H=>H.markAllAsDirty(),V._ImageProcessingDirtyCallBack=H=>H.markAsImageProcessingDirty(),V._TextureDirtyCallBack=H=>H.markAsTexturesDirty(),V._FresnelDirtyCallBack=H=>H.markAsFresnelDirty(),V._MiscDirtyCallBack=H=>H.markAsMiscDirty(),V._PrePassDirtyCallBack=H=>H.markAsPrePassDirty(),V._LightsDirtyCallBack=H=>H.markAsLightDirty(),V._AttributeDirtyCallBack=H=>H.markAsAttributesDirty(),V._FresnelAndMiscDirtyCallBack=H=>{V._FresnelDirtyCallBack(H),V._MiscDirtyCallBack(H)},V._TextureAndMiscDirtyCallBack=H=>{V._TextureDirtyCallBack(H),V._MiscDirtyCallBack(H)},V._DirtyCallbackArray=[],V._RunDirtyCallBacks=H=>{for(const c of V._DirtyCallbackArray)c(H)},(0,Z.b)([(0,F.P)()],V.prototype,"id",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"uniqueId",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"name",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"metadata",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"checkReadyOnEveryCall",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"checkReadyOnlyOnce",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"state",void 0),(0,Z.b)([(0,F.P)("alpha")],V.prototype,"_alpha",void 0),(0,Z.b)([(0,F.P)("dh")],V.prototype,"_backFaceCulling",void 0),(0,Z.b)([(0,F.P)("cullBackFaces")],V.prototype,"_cullBackFaces",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"sideOrientation",void 0),(0,Z.b)([(0,F.P)("alphaMode")],V.prototype,"_alphaMode",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"_needDepthPrePass",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"disableDepthWrite",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"disableColorWrite",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"forceDepthWrite",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"depthFunction",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"separateCullingPass",void 0),(0,Z.b)([(0,F.P)("fogEnabled")],V.prototype,"_fogEnabled",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"pointSize",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"zOffset",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"zOffsetUnits",void 0),(0,Z.b)([(0,F.P)()],V.prototype,"pointsCloud",null),(0,Z.b)([(0,F.P)()],V.prototype,"fillMode",null),(0,Z.b)([(0,F.P)()],V.prototype,"useLogarithmicDepth",null),(0,Z.b)([(0,F.P)()],V.prototype,"transparencyMode",null)},11293:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});class Z{constructor(H){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=H,H)for(const c in H)Object.prototype.hasOwnProperty.call(H,c)&&this._setDefaultValue(c)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||H,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const H of Object.keys(this))"_"!==H[0]&&this._keys.push(H);if(this._externalProperties)for(const H in this._externalProperties)-1===this._keys.indexOf(H)&&this._keys.push(H)}isEqual(H){if(this._keys.length!==H._keys.length)return!1;for(let c=0;c<this._keys.length;c++){const y=this._keys[c];if(this[y]!==H[y])return!1}return!0}cloneTo(H){this._keys.length!==H._keys.length&&(H._keys=this._keys.slice(0));for(let c=0;c<this._keys.length;c++){const y=this._keys[c];H[y]=this[y]}}reset(){this._keys.forEach((H=>this._setDefaultValue(H)))}_setDefaultValue(H){var c,y,Z,F;const P=(null===(c=this._externalProperties)||void 0===c||null===(y=c[H])||void 0===y?void 0:y.type)??typeof this[H],S=null===(Z=this._externalProperties)||void 0===Z||null===(F=Z[H])||void 0===F?void 0:F.default;switch(P){case"number":this[H]=S??0;break;case"string":this[H]=S??"";break;default:this[H]=S??!1}}toString(){let H="";for(let c=0;c<this._keys.length;c++){const y=this._keys[c],Z=this[y];switch(typeof Z){case"number":case"string":H+="#define "+y+" "+Z+"\n";break;default:Z&&(H+="#define "+y+"\n")}}return H}}},11332:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});var Z=y(10850);class F{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(H){this._DiffuseTextureEnabled!==H&&(this._DiffuseTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(H){this._DetailTextureEnabled!==H&&(this._DetailTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(H){this._DecalMapEnabled!==H&&(this._DecalMapEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(H){this._AmbientTextureEnabled!==H&&(this._AmbientTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(H){this._OpacityTextureEnabled!==H&&(this._OpacityTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(H){this._ReflectionTextureEnabled!==H&&(this._ReflectionTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(H){this._EmissiveTextureEnabled!==H&&(this._EmissiveTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(H){this._SpecularTextureEnabled!==H&&(this._SpecularTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(H){this._BumpTextureEnabled!==H&&(this._BumpTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(H){this._LightmapTextureEnabled!==H&&(this._LightmapTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(H){this._RefractionTextureEnabled!==H&&(this._RefractionTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(H){this._ColorGradingTextureEnabled!==H&&(this._ColorGradingTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(H){this._FresnelEnabled!==H&&(this._FresnelEnabled=H,Z.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(H){this._ClearCoatTextureEnabled!==H&&(this._ClearCoatTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(H){this._ClearCoatBumpTextureEnabled!==H&&(this._ClearCoatBumpTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(H){this._ClearCoatTintTextureEnabled!==H&&(this._ClearCoatTintTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(H){this._SheenTextureEnabled!==H&&(this._SheenTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(H){this._AnisotropicTextureEnabled!==H&&(this._AnisotropicTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(H){this._ThicknessTextureEnabled!==H&&(this._ThicknessTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(H){this._RefractionIntensityTextureEnabled!==H&&(this._RefractionIntensityTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(H){this._TranslucencyIntensityTextureEnabled!==H&&(this._TranslucencyIntensityTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(H){this._TranslucencyColorTextureEnabled!==H&&(this._TranslucencyColorTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(H){this._IridescenceTextureEnabled!==H&&(this._IridescenceTextureEnabled=H,Z.e.MarkAllMaterialsAsDirty(1))}}F._DiffuseTextureEnabled=!0,F._DetailTextureEnabled=!0,F._DecalMapEnabled=!0,F._AmbientTextureEnabled=!0,F._OpacityTextureEnabled=!0,F._ReflectionTextureEnabled=!0,F._EmissiveTextureEnabled=!0,F._SpecularTextureEnabled=!0,F._BumpTextureEnabled=!0,F._LightmapTextureEnabled=!0,F._RefractionTextureEnabled=!0,F._ColorGradingTextureEnabled=!0,F._FresnelEnabled=!0,F._ClearCoatTextureEnabled=!0,F._ClearCoatBumpTextureEnabled=!0,F._ClearCoatTintTextureEnabled=!0,F._SheenTextureEnabled=!0,F._AnisotropicTextureEnabled=!0,F._ThicknessTextureEnabled=!0,F._RefractionIntensityTextureEnabled=!0,F._TranslucencyIntensityTextureEnabled=!0,F._TranslucencyColorTextureEnabled=!0,F._IridescenceTextureEnabled=!0},11285:(H,c,y)=>{"use strict";y.d(c,{$:()=>g,B:()=>l,D:()=>C,E:()=>U,G:()=>E,K:()=>T,N:()=>z,R:()=>K,V:()=>G,X:()=>p,Z:()=>t,_:()=>s,e:()=>Q,h:()=>i,i:()=>f,j:()=>a,l:()=>v,m:()=>m,o:()=>V,r:()=>d,v:()=>h,x:()=>J});var Z=y(10773),F=y(11112),P=y(10810),S=y(11229),n=y(11288);const O=F.e.Black();function a(H,c,y){if(!H||H.LOGARITHMICDEPTH||H.indexOf&&H.indexOf("LOGARITHMICDEPTH")>=0){const H=y.activeCamera;1===H.mode&&Z.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),c.setFloat("logarithmicDepthConstant",2/(Math.log(H.maxZ+1)/Math.LN2))}}function i(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];y&&H.fogEnabled&&(!c||c.applyFog)&&0!==H.fogMode&&(y.setFloat4("vFogInfos",H.fogMode,H.fogStart,H.fogEnd,H.fogDensity),Z?(H.fogColor.toLinearSpaceToRef(O,H.getEngine().useExactSrgbConversions),y.setColor3("vFogColor",O)):y.setColor3("vFogColor",H.fogColor))}function C(H,c,y){const F=y.NUM_MORPH_INFLUENCERS;if(F>0&&P.b.LastCreatedEngine){const S=P.b.LastCreatedEngine.getCaps().maxVertexAttribs,n=c.morphTargetManager;if(null!==n&&void 0!==n&&n.isUsingTextureForTargets)return;const O=n&&n.supportsNormals&&y.NORMAL,a=n&&n.supportsTangents&&y.TANGENT,i=n&&n.supportsUVs&&y.UV1;for(let y=0;y<F;y++)H.push("position"+y),O&&H.push("normal"+y),a&&H.push("tangent"+y),i&&H.push("uv_"+y),H.length>S&&Z.d.Error("Cannot add more vertex attributes for mesh "+c.name)}}function g(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H.push("world0"),H.push("world1"),H.push("world2"),H.push("world3"),c&&(H.push("previousWorld0"),H.push("previousWorld1"),H.push("previousWorld2"),H.push("previousWorld3"))}function v(H,c){const y=H.morphTargetManager;H&&y&&c.setFloatArray("morphTargetInfluences",y.influences)}function m(H,c){c.bindToEffect(H,"Scene")}function z(H,c,y){c._needUVs=!0,c[y]=!0,H.optimizeUVAllocation&&H.getTextureMatrix().isIdentityAs3x2()?(c[y+"DIRECTUV"]=H.coordinatesIndex+1,c["MAINUV"+(H.coordinatesIndex+1)]=!0):c[y+"DIRECTUV"]=0}function V(H,c,y){const Z=H.getTextureMatrix();c.Hj(y+"Matrix",Z)}function h(H,c,y){y.BAKED_VERTEX_ANIMATION_TEXTURE&&y.INSTANCES&&H.push("bakedVertexAnimationSettingsInstanced")}function Q(H,c,y){var Z;if(c&&H&&(H.computeBonesUsingShaders&&c._bonesComputationForcedToCPU&&(H.computeBonesUsingShaders=!1),H.useBones&&H.computeBonesUsingShaders&&H.skeleton)){const F=H.skeleton;if(F.isUsingTextureForMatrices&&c.getUniformIndex("boneTextureWidth")>-1){const y=F.getTransformMatrixTexture(H);c.setTexture("boneSampler",y),c.setFloat("boneTextureWidth",4*(F.bones.length+1))}else{const P=F.getTransformMatrices(H);P&&(c.setMatrices("mBones",P),y&&H.va().prePassRenderer&&H.va().prePassRenderer.getIndex(2)&&(y.previousBones[H.uniqueId]||(y.previousBones[H.uniqueId]=P.slice()),c.setMatrices("mPreviousBones",y.previousBones[H.uniqueId]),Z=P,y.previousBones[H.uniqueId].set(Z)))}}}function D(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];H._bindLight(c,y,Z,F,P)}function f(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const P=Math.min(c.lightSources.length,F);for(let S=0;S<P;S++){D(c.lightSources[S],S,H,y,"boolean"===typeof Z?Z:Z.SPECULARTERM,c.receiveShadows)}}function J(H,c,y,Z){y.NUM_BONE_INFLUENCERS>0&&(Z.addCPUSkinningFallback(0,c),H.push("matricesIndices"),H.push("matricesWeights"),y.NUM_BONE_INFLUENCERS>4&&(H.push("matricesIndicesExtra"),H.push("matricesWeightsExtra")))}function l(H,c){(c.INSTANCES||c.THIN_INSTANCES)&&g(H,!!c.PREPASS_VELOCITY),c.INSTANCESCOLOR&&H.push("instanceColor")}function d(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=0;for(let P=0;P<y&&H["LIGHT"+P];P++)P>0&&(F=Z+P,c.addFallback(F,"LIGHT"+P)),H.SHADOWS||(H["SHADOW"+P]&&c.addFallback(Z,"SHADOW"+P),H["SHADOWPCF"+P]&&c.addFallback(Z,"SHADOWPCF"+P),H["SHADOWPCSS"+P]&&c.addFallback(Z,"SHADOWPCSS"+P),H["SHADOWPOISSON"+P]&&c.addFallback(Z,"SHADOWPOISSON"+P),H["SHADOWESM"+P]&&c.addFallback(Z,"SHADOWESM"+P),H["SHADOWCLOSEESM"+P]&&c.addFallback(Z,"SHADOWCLOSEESM"+P));return F++}function K(H,c,y,Z,F,P,S){let n=arguments.length>7&&void 0!==arguments[7]&&arguments[7];S._areMiscDirty&&(S.LOGARITHMICDEPTH=y,S.POINTSIZE=Z,S.FOG=F&&function(H,c){return c.fogEnabled&&H.applyFog&&0!==c.fogMode}(H,c),S.NONUNIFORMSCALING=H.nonUniformScaling,S.ALPHATEST=P,S.DECAL_AFTER_DETAIL=n)}function T(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y._areLightsDirty)return y._needNormals;let S=0;const n={needNormals:y._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(H.lightsEnabled&&!P)for(const a of c.lightSources)if(u(H,c,a,S,y,Z,n),S++,S===F)break;y.SPECULARTERM=n.specularEnabled,y.SHADOWS=n.shadowEnabled;for(let a=S;a<F;a++)void 0!==y["LIGHT"+a]&&(y["LIGHT"+a]=!1,y["HEMILIGHT"+a]=!1,y["POINTLIGHT"+a]=!1,y["DIRLIGHT"+a]=!1,y["SPOTLIGHT"+a]=!1,y["SHADOW"+a]=!1,y["SHADOWCSM"+a]=!1,y["SHADOWCSMDEBUG"+a]=!1,y["SHADOWCSMNUM_CASCADES"+a]=!1,y["SHADOWCSMUSESHADOWMAXZ"+a]=!1,y["SHADOWCSMNOBLEND"+a]=!1,y["SHADOWCSM_RIGHTHANDED"+a]=!1,y["SHADOWPCF"+a]=!1,y["SHADOWPCSS"+a]=!1,y["SHADOWPOISSON"+a]=!1,y["SHADOWESM"+a]=!1,y["SHADOWCLOSEESM"+a]=!1,y["SHADOWCUBE"+a]=!1,y["SHADOWLOWQUALITY"+a]=!1,y["SHADOWMEDIUMQUALITY"+a]=!1);const O=H.getEngine().getCaps();return void 0===y.SHADOWFLOAT&&(n.needRebuild=!0),y.SHADOWFLOAT=n.shadowEnabled&&(O.textureFloatRender&&O.textureFloatLinearFiltering||O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=n.lightmapMode,n.needRebuild&&y.rebuild(),n.needNormals}function u(H,c,y,Z,F,P,n){switch(n.needNormals=!0,void 0===F["LIGHT"+Z]&&(n.needRebuild=!0),F["LIGHT"+Z]=!0,F["SPOTLIGHT"+Z]=!1,F["HEMILIGHT"+Z]=!1,F["POINTLIGHT"+Z]=!1,F["DIRLIGHT"+Z]=!1,y.prepareLightSpecificDefines(F,Z),F["LIGHT_FALLOFF_PHYSICAL"+Z]=!1,F["LIGHT_FALLOFF_GLTF"+Z]=!1,F["LIGHT_FALLOFF_STANDARD"+Z]=!1,y.falloffType){case S.b.FALLOFF_GLTF:F["LIGHT_FALLOFF_GLTF"+Z]=!0;break;case S.b.FALLOFF_PHYSICAL:F["LIGHT_FALLOFF_PHYSICAL"+Z]=!0;break;case S.b.FALLOFF_STANDARD:F["LIGHT_FALLOFF_STANDARD"+Z]=!0}if(P&&!y.uh.equalsFloats(0,0,0)&&(n.specularEnabled=!0),F["SHADOW"+Z]=!1,F["SHADOWCSM"+Z]=!1,F["SHADOWCSMDEBUG"+Z]=!1,F["SHADOWCSMNUM_CASCADES"+Z]=!1,F["SHADOWCSMUSESHADOWMAXZ"+Z]=!1,F["SHADOWCSMNOBLEND"+Z]=!1,F["SHADOWCSM_RIGHTHANDED"+Z]=!1,F["SHADOWPCF"+Z]=!1,F["SHADOWPCSS"+Z]=!1,F["SHADOWPOISSON"+Z]=!1,F["SHADOWESM"+Z]=!1,F["SHADOWCLOSEESM"+Z]=!1,F["SHADOWCUBE"+Z]=!1,F["SHADOWLOWQUALITY"+Z]=!1,F["SHADOWMEDIUMQUALITY"+Z]=!1,c&&c.receiveShadows&&H.shadowsEnabled&&y.shadowEnabled){const c=y.getShadowGenerator(H.activeCamera)??y.getShadowGenerator();if(c){const H=c.getShadowMap();H&&H.renderList&&H.renderList.length>0&&(n.shadowEnabled=!0,c.prepareDefines(F,Z))}}y.lightmapMode!=S.b.LIGHTMAP_DEFAULT?(n.lightmapMode=!0,F["LIGHTMAPEXCLUDED"+Z]=!0,F["LIGHTMAPNOSPECULAR"+Z]=y.lightmapMode==S.b.LIGHTMAP_SHADOWSONLY):(F["LIGHTMAPEXCLUDED"+Z]=!1,F["LIGHTMAPNOSPECULAR"+Z]=!1)}function E(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=function(H,c){let y=!1;if(H.activeCamera){const Z=c.CAMERA_ORTHOGRAPHIC?1:0,F=c.CAMERA_PERSPECTIVE?1:0,P=1===H.activeCamera.mode?1:0,S=0===H.activeCamera.mode?1:0;(Z^P||F^S)&&(c.CAMERA_ORTHOGRAPHIC=1===P,c.CAMERA_PERSPECTIVE=1===S,y=!0)}return y}(H,Z);!1!==P&&(O=(0,n.i)(y,H,Z)),Z.DEPTHPREPASS!==!c.getColorWrite()&&(Z.DEPTHPREPASS=!Z.DEPTHPREPASS,O=!0),Z.INSTANCES!==F&&(Z.INSTANCES=F,O=!0),Z.THIN_INSTANCES!==S&&(Z.THIN_INSTANCES=S,O=!0),O&&Z.markAsUnprocessed()}function U(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!c._areAttributesDirty&&c._needNormals===c._normals&&c._needUVs===c._uvs)return!1;c._normals=c._needNormals,c._uvs=c._needUVs,c.NORMAL=c._needNormals&&H.isVerticesDataPresent("normal"),c._needNormals&&H.isVerticesDataPresent("tangent")&&(c.TANGENT=!0);for(let n=1;n<=6;++n)c["UV"+n]=!!c._needUVs&&H.isVerticesDataPresent(`uv${1===n?"":n}`);if(y){const y=H.useVertexColors&&H.isVerticesDataPresent("color");c.VERTEXCOLOR=y,c.VERTEXALPHA=H.hasVertexAlpha&&y&&P}return H.isVerticesDataPresent("instanceColor")&&(H.hasInstances||H.hasThinInstances)&&(c.INSTANCESCOLOR=!0),Z&&function(H,c){if(H.useBones&&H.computeBonesUsingShaders&&H.skeleton){c.NUM_BONE_INFLUENCERS=H.numBoneInfluencers;const y=void 0!==c.BONETEXTURE;if(H.skeleton.isUsingTextureForMatrices&&y)c.BONETEXTURE=!0;else{c.BonesPerMesh=H.skeleton.bones.length+1,c.BONETEXTURE=!y&&void 0;const Z=H.va().prePassRenderer;if(Z&&Z.enabled){const y=-1===Z.excludedSkinnedMesh.indexOf(H);c.BONES_VELOCITY_ENABLED=y}}}else c.NUM_BONE_INFLUENCERS=0,c.BonesPerMesh=0,void 0!==c.BONETEXTURE&&(c.BONETEXTURE=!1)}(H,c),F&&function(H,c){const y=H.morphTargetManager;y?(c.MORPHTARGETS_UV=y.supportsUVs&&c.UV1,c.MORPHTARGETS_TANGENT=y.supportsTangents&&c.TANGENT,c.MORPHTARGETS_NORMAL=y.supportsNormals&&c.NORMAL,c.NUM_MORPH_INFLUENCERS=y.numMaxInfluencers||y.numInfluencers,c.MORPHTARGETS=c.NUM_MORPH_INFLUENCERS>0,c.MORPHTARGETS_TEXTURE=y.isUsingTextureForTargets):(c.MORPHTARGETS_UV=!1,c.MORPHTARGETS_TANGENT=!1,c.MORPHTARGETS_NORMAL=!1,c.MORPHTARGETS=!1,c.NUM_MORPH_INFLUENCERS=0)}(H,c),S&&function(H,c){const y=H.bakedVertexAnimationManager;c.BAKED_VERTEX_ANIMATION_TEXTURE=!(!y||!y.isEnabled)}(H,c),!0}function G(H,c){if(H.activeCamera){const y=c.MULTIVIEW;c.MULTIVIEW=null!==H.activeCamera.outputRenderTarget&&H.activeCamera.outputRenderTarget.getViewCount()>1,c.MULTIVIEW!=y&&c.markAsUnprocessed()}}function p(H,c,y){const Z=c.ORDER_INDEPENDENT_TRANSPARENCY,F=c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;c.ORDER_INDEPENDENT_TRANSPARENCY=H.useOrderIndependentTransparency&&y,c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!H.getEngine().getCaps().textureFloatLinearFiltering,Z===c.ORDER_INDEPENDENT_TRANSPARENCY&&F===c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||c.markAsUnprocessed()}function t(H,c,y){const Z=c.PREPASS;if(!c._arePrePassDirty)return;const F=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(H.prePassRenderer&&H.prePassRenderer.enabled&&y){c.PREPASS=!0,c.SCENE_MRT_COUNT=H.prePassRenderer.mrtCount,c.PREPASS_NORMAL_WORLDSPACE=H.prePassRenderer.generateNormalsInWorldSpace,c.PREPASS_COLOR=!0,c.PREPASS_COLOR_INDEX=0;for(let y=0;y<F.length;y++){const Z=H.prePassRenderer.getIndex(F[y].type);-1!==Z?(c[F[y].define]=!0,c[F[y].index]=Z):c[F[y].define]=!1}}else{c.PREPASS=!1;for(let H=0;H<F.length;H++)c[F[H].define]=!1}c.PREPASS!=Z&&(c.markAsUnprocessed(),c.markAsImageProcessingDirty())}function o(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];F&&F.push("Light"+H),P||(c.push("vLightData"+H,"vLightDiffuse"+H,"vLightSpecular"+H,"vLightDirection"+H,"vLightFalloff"+H,"vLightGround"+H,"lightMatrix"+H,"shadowsInfo"+H,"depthValues"+H),y.push("shadowTexture"+H),y.push("depthTexture"+H),c.push("viewFrustumZ"+H,"cascadeBlendFactor"+H,"lightSizeUVCorrection"+H,"depthCorrection"+H,"penumbraDarkness"+H,"frustumLengths"+H),Z&&(y.push("projectionLightTexture"+H),c.push("textureProjectionMatrix"+H)))}function s(H,c,y){let Z,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,P=null;if(H.uniformsNames){const S=H;Z=S.uniformsNames,P=S.uniformBuffersNames,c=S.samplers,y=S.defines,F=S.maxSimultaneousLights||0}else Z=H,c||(c=[]);for(let S=0;S<F&&y["LIGHT"+S];S++)o(S,Z,c,y["PROJECTEDLIGHTTEXTURE"+S],P);y.NUM_MORPH_INFLUENCERS&&(Z.push("morphTargetInfluences"),Z.push("morphTargetCount")),y.BAKED_VERTEX_ANIMATION_TEXTURE&&(Z.push("bakedVertexAnimationSettings"),Z.push("bakedVertexAnimationTextureSizeInverted"),Z.push("bakedVertexAnimationTime"),c.push("bakedVertexAnimationTexture"))}},11347:(H,c,y)=>{"use strict";y.d(c,{d:()=>P});var Z,F=y(11092);!function(H){H[H.Zero=0]="Zero",H[H.One=1]="One",H[H.MaxViewZ=2]="MaxViewZ"}(Z||(Z={}));class P{static CreateConfiguration(H){return P._Configurations[H]={defines:{},previousWorldMatrices:{},previousViewProjection:F.d.Zero(),currentViewProjection:F.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},P._Configurations[H]}static DeleteConfiguration(H){delete P._Configurations[H]}static GetConfiguration(H){return P._Configurations[H]}static AddUniformsAndSamplers(H,c){H.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(H,c){for(const y of c)if(y.$f)for(const c of y.$f)c._removeDrawWrapper(H)}static PrepareDefines(H,c,y){if(!y._arePrePassDirty)return;const Z=P._Configurations[H];if(!Z)return;y.PREPASS=!0,y.PREPASS_COLOR=!1,y.PREPASS_COLOR_INDEX=-1;let F=0;for(let S=0;S<P.GeometryTextureDescriptions.length;S++){const H=P.GeometryTextureDescriptions[S],c=H.define,n=H.defineIndex,O=Z.defines[n];void 0!==O?(y[c]=!0,y[n]=O,F++):(y[c]=!1,delete y[n])}y.SCENE_MRT_COUNT=F,y.BONES_VELOCITY_ENABLED=c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&!c.skeleton.isUsingTextureForMatrices&&-1===Z.excludedSkinnedMesh.indexOf(c)}static Bind(H,c,y,Z){const F=P._Configurations[H];if(F&&(void 0!==F.defines.PREPASS_VELOCITY_INDEX||void 0!==F.defines.PREPASS_VELOCITY_LINEAR_INDEX)){F.previousWorldMatrices[y.uniqueId]||(F.previousWorldMatrices[y.uniqueId]=Z.clone());const H=y.va();F.previousViewProjection||(F.previousViewProjection=H.getTransformMatrix().clone(),F.currentViewProjection=H.getTransformMatrix().clone());const P=H.getEngine();if(F.currentViewProjection.updateFlag!==H.getTransformMatrix().updateFlag?(F.lastUpdateFrameId=P.frameId,F.previousViewProjection.p(F.currentViewProjection),F.currentViewProjection.p(H.getTransformMatrix())):F.lastUpdateFrameId!==P.frameId&&(F.lastUpdateFrameId=P.frameId,F.previousViewProjection.p(F.currentViewProjection)),c.setMatrix("previousWorld",F.previousWorldMatrices[y.uniqueId]),c.setMatrix("previousViewProjection",F.previousViewProjection),F.previousWorldMatrices[y.uniqueId]=Z.clone(),y.useBones&&y.computeBonesUsingShaders&&y.skeleton){const H=y.skeleton;if(!H.isUsingTextureForMatrices||-1===c.getUniformIndex("boneTextureWidth")){const Z=H.getTransformMatrices(y);Z&&(F.previousBones[y.uniqueId]||(F.previousBones[y.uniqueId]=Z.slice()),c.setMatrices("mPreviousBones",F.previousBones[y.uniqueId]),F.previousBones[y.uniqueId].set(Z))}}}}}P.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],P._Configurations={}},11344:(H,c,y)=>{"use strict";y.d(c,{c:()=>h});var Z=y(11052),F=y(11061),P=y(11239),S=y(10810),n=y(10836),O=y(10855);const a=new RegExp("^([gimus]+)!");class i{constructor(H){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=H,this._scene=H.va(),this._engine=this._scene.getEngine()}_addPlugin(H){for(let Z=0;Z<this._plugins.length;++Z)if(this._plugins[Z].name===H.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!H.isCompatible(this._material.shaderLanguage))throw`The plugin "${H.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const c=H.getClassName();i._MaterialPluginClassToMainDefine[c]||(i._MaterialPluginClassToMainDefine[c]="MATERIALPLUGIN_"+ ++i._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(H,c)=>this._handlePluginEvent(H,c),this._plugins.push(H),this._plugins.sort(((H,c)=>H.priority-c.priority)),this._codeInjectionPoints={};const y={};y[i._MaterialPluginClassToMainDefine[c]]={type:"boolean",default:!0};for(const Z of this._plugins)Z.collectDefines(y),this._collectPointNames("vertex",Z.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",Z.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=y,!0}_activatePlugin(H){-1===this._activePlugins.indexOf(H)&&(this._activePlugins.push(H),this._activePlugins.sort(((H,c)=>H.priority-c.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),H.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(H),this._activePluginsForExtraEvents.sort(((H,c)=>H.priority-c.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(H){for(let c=0;c<this._plugins.length;++c)if(this._plugins[c].name===H)return this._plugins[c];return null}_handlePluginEventIsReadyForSubMesh(H){let c=!0;for(const y of this._activePlugins)c=c&&y.isReadyForSubMesh(H.defines,this._scene,this._engine,H.subMesh);H.isReadyForSubMesh=c}_handlePluginEventPrepareDefinesBeforeAttributes(H){for(const c of this._activePlugins)c.prepareDefinesBeforeAttributes(H.defines,this._scene,H.mesh)}_handlePluginEventPrepareDefines(H){for(const c of this._activePlugins)c.prepareDefines(H.defines,this._scene,H.mesh)}_handlePluginEventHardBindForSubMesh(H){for(const c of this._activePluginsForExtraEvents)c.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,H.subMesh)}_handlePluginEventBindForSubMesh(H){for(const c of this._activePlugins)c.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,H.subMesh)}_handlePluginEventHasRenderTargetTextures(H){let c=!1;for(const y of this._activePluginsForExtraEvents)if(c=y.hasRenderTargetTextures(),c)break;H.hasRenderTargetTextures=c}_handlePluginEventFillRenderTargetTextures(H){for(const c of this._activePluginsForExtraEvents)c.fillRenderTargetTextures(H.renderTargets)}_handlePluginEvent(H,c){switch(H){case 512:{const H=c;for(const c of this._activePlugins)c.getActiveTextures(H.activeTextures);break}case 256:{const H=c;for(const c of this._activePlugins)c.getAnimatables(H.animatables);break}case 1024:{const H=c;let y=!1;for(const c of this._activePlugins)if(y=c.hasTexture(H.texture),y)break;H.hasTexture=y;break}case 2:{const H=c;for(const c of this._plugins)c.dispose(H.forceDisposeTextures);break}case 4:c.defineNames=this._defineNamesFromPlugins;break;case 128:{const H=c;for(const c of this._activePlugins)H.fallbackRank=c.addFallbacks(H.defines,H.fallbacks,H.fallbackRank),c.getAttributes(H.attributes,this._scene,H.mesh);this._uniformList.length>0&&H.uniforms.push(...this._uniformList),this._samplerList.length>0&&H.samplers.push(...this._samplerList),this._uboList.length>0&&H.uniformBuffersNames.push(...this._uboList),H.customCode=this._injectCustomCode(H,H.customCode);break}case 8:{const H=c;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const y=1===this._material.shaderLanguage;for(const c of this._plugins){const Z=c.getUniforms(this._material.shaderLanguage);if(Z){if(Z.ubo)for(const c of Z.ubo){if(c.size&&c.type){const Z=c.arraySize??0;if(H.ubo.addUniform(c.name,c.size,Z),y){let H;switch(c.type){case"mat4":H="mat4x4f";break;case"float":H="f32";break;default:H=`${c.type}f`}this._uboDeclaration+=`uniform ${c.name}: ${H}${Z>0?`[${Z}]`:""};\n`}else this._uboDeclaration+=`${c.type} ${c.name}${Z>0?`[${Z}]`:""};\n`}this._uniformList.push(c.name)}Z.vertex&&(this._vertexDeclaration+=Z.vertex+"\n"),Z.fragment&&(this._fragmentDeclaration+=Z.fragment+"\n")}c.getSamplers(this._samplerList),c.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(H,c){if(c)for(const y in c)this._codeInjectionPoints[H]||(this._codeInjectionPoints[H]={}),this._codeInjectionPoints[H][y]=!0}_injectCustomCode(H,c){return(y,Z)=>{var F;c&&(Z=c(y,Z)),this._uboDeclaration&&(Z=Z.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(Z=Z.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(Z=Z.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const P=null===(F=this._codeInjectionPoints)||void 0===F?void 0:F[y];if(!P)return Z;let S=null;for(let c in P){let F="";for(const Z of this._activePlugins){var i;let P=null===(i=Z.getCustomCode(y,this._material.shaderLanguage))||void 0===i?void 0:i[c];if(P){if(Z.resolveIncludes){if(null===S){const c=0;S={defines:[],indexParameters:H.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.e.GetShadersRepository(c),includesShadersStore:O.e.GetIncludesShadersStore(c),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}S.isFragment="fragment"===y,(0,n.f)(P,S,(H=>P=H))}F+=P+"\n"}}if(F.length>0)if("!"===c.charAt(0)){c=c.substring(1);let H="g";if("!"===c.charAt(0))H="",c=c.substring(1);else{const y=a.exec(c);y&&y.length>=2&&(H=y[1],c=c.substring(H.length+1))}H.indexOf("g")<0&&(H+="g");const y=Z,P=new RegExp(c,H);let S=P.exec(y);for(;null!==S;){let H=F;for(let c=0;c<S.length;++c)H=H.replace("$"+c,S[c]);Z=Z.replace(S[0],H),S=P.exec(y)}}else{const H="#define "+c;Z=Z.replace(H,"\n"+F+"\n"+H)}}return Z}}}i._MaterialPluginClassToMainDefine={},i._MaterialPluginCounter=0,S.b.OnEnginesDisposedObservable.add((()=>{m()}));const C=[];let g=!1,v=null;function m(){C.length=0,g=!1,P.c.OnEventObservable.remove(v),v=null}var z=y(11118),V=y(10893);class h{isCompatible(H){return 0===H}_enable(H){H&&this._pluginManager._activatePlugin(this)}constructor(H,c,y,Z){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=H,this.name=c,this.priority=y,this.resolveIncludes=S,H.pluginManager||(H.pluginManager=new i(H),H.jj.add((()=>{H.pluginManager=void 0}))),this._pluginDefineNames=Z,this._pluginManager=H.pluginManager,F&&this._pluginManager._addPlugin(this),P&&this._enable(!0),this.markAllDefinesAsDirty=H._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(H,c,y,Z){return!0}hardBindForSubMesh(H,c,y,Z){}bindForSubMesh(H,c,y,Z){}dispose(H){}getCustomCode(H){return null}collectDefines(H){if(this._pluginDefineNames)for(const c of Object.keys(this._pluginDefineNames)){if("_"===c[0])continue;const y=typeof this._pluginDefineNames[c];H[c]={type:"number"===y?"number":"string"===y?"string":"boolean"===y?"boolean":"object",default:this._pluginDefineNames[c]}}}prepareDefinesBeforeAttributes(H,c,y){}prepareDefines(H,c,y){}hasTexture(H){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(H){}getActiveTextures(H){}getAnimatables(H){}addFallbacks(H,c,y){return y}getSamplers(H){}getAttributes(H,c,y){}getUniformBuffersNames(H){}getUniforms(){return{}}copyTo(H){z.e.Clone((()=>H),this)}serialize(){return z.e.Serialize(this)}parse(H,c,y){z.e.Parse((()=>this),H,c,y)}}(0,Z.b)([(0,F.P)()],h.prototype,"name",void 0),(0,Z.b)([(0,F.P)()],h.prototype,"priority",void 0),(0,Z.b)([(0,F.P)()],h.prototype,"resolveIncludes",void 0),(0,Z.b)([(0,F.P)()],h.prototype,"registerForExtraEvents",void 0),(0,V.d)("BABYLON.MaterialPluginBase",h)},11413:(H,c,y)=>{"use strict";y.d(c,{b:()=>S});var Z=y(11239),F=y(11083),P=y(10893);class S extends Z.c{get ag(){return this._subMaterials}set ag(H){this._subMaterials=H,this._hookArray(H)}getChildren(){return this.ag}constructor(H,c){super(H,c,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.ag=[],this._storeEffectOnSubMeshes=!0}_hookArray(H){var c=this;const y=H.push;H.push=function(){for(var Z=arguments.length,F=new Array(Z),P=0;P<Z;P++)F[P]=arguments[P];const S=y.apply(H,F);return c._markAllSubMeshesAsTexturesDirty(),S};const Z=H.splice;H.splice=(c,y)=>{const F=Z.apply(H,[c,y]);return this._markAllSubMeshesAsTexturesDirty(),F}}getSubMaterial(H){return H<0||H>=this.ag.length?this.va().defaultMaterial:this.ag[H]}getActiveTextures(){return super.getActiveTextures().concat(...this.ag.map((H=>H?H.getActiveTextures():[])))}hasTexture(H){if(super.hasTexture(H))return!0;for(let y=0;y<this.ag.length;y++){var c;if(null!==(c=this.ag[y])&&void 0!==c&&c.hasTexture(H))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(H,c,y){for(let Z=0;Z<this.ag.length;Z++){const F=this.ag[Z];if(F){if(F._storeEffectOnSubMeshes){if(!F.isReadyForSubMesh(H,c,y))return!1;continue}if(!F.isReady(H))return!1}}return!0}clone(H,c){const y=new S(H,this.va());for(let Z=0;Z<this.ag.length;Z++){let F=null;const P=this.ag[Z];F=c&&P?P.clone(H+"-"+P.name):this.ag[Z],y.ag.push(F)}return y}serialize(){const H={};H.name=this.name,H.id=this.id,H.uniqueId=this.uniqueId,F.d&&(H.tags=F.d.GetTags(this)),H.materialsUniqueIds=[],H.materials=[];for(let c=0;c<this.ag.length;c++){const y=this.ag[c];y?(H.materialsUniqueIds.push(y.uniqueId),H.materials.push(y.id)):(H.materialsUniqueIds.push(null),H.materials.push(null))}return H}dispose(H,c,y){const Z=this.va();if(!Z)return;if(y)for(let P=0;P<this.ag.length;P++){const y=this.ag[P];y&&y.dispose(H,c)}const F=Z.multiMaterials.indexOf(this);F>=0&&Z.multiMaterials.splice(F,1),super.dispose(H,c)}static ParseMultiMaterial(H,c){const y=new S(H.name,c);return y.id=H.id,y._loadedUniqueId=H.uniqueId,F.d&&F.d.AddTagsTo(y,H.tags),H.materialsUniqueIds?y._waitingSubMaterialsUniqueIds=H.materialsUniqueIds:H.materials.forEach((H=>y.ag.push(c.getLastMaterialById(H)))),y}}(0,P.d)("BABYLON.MultiMaterial",S)},11236:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});class Z{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(H){H.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(H){}bindForSubMesh(H,c,y,Z,F){if(c.prePassRenderer&&c.prePassRenderer.enabled&&c.prePassRenderer.currentRTisSceneRT&&(-1!==c.prePassRenderer.getIndex(2)||-1!==c.prePassRenderer.getIndex(11))){this.previousWorldMatrices[y.uniqueId]||(this.previousWorldMatrices[y.uniqueId]=Z.clone()),this.previousViewProjection||(this.previousViewProjection=c.getTransformMatrix().clone(),this.currentViewProjection=c.getTransformMatrix().clone());const F=c.getEngine();this.currentViewProjection.updateFlag!==c.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=F.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(c.getTransformMatrix())):this._lastUpdateFrameId!==F.frameId&&(this._lastUpdateFrameId=F.frameId,this.previousViewProjection.p(this.currentViewProjection)),H.setMatrix("previousWorld",this.previousWorldMatrices[y.uniqueId]),H.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[y.uniqueId]=Z.clone()}}}},11301:(H,c,y)=>{"use strict";y.d(c,{c:()=>P});var Z=y(11092),F=y(11239);class P extends F.c{constructor(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(H,c,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new Z.d,this._storeEffectOnSubMeshes=y}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(H,c){return!!H&&(!this._storeEffectOnSubMeshes||(!H.$f||0===H.$f.length||this.isReadyForSubMesh(H,H.$f[0],c)))}_isReadyForSubMesh(H){const c=H.materialDefines;return!(this.checkReadyOnEveryCall||!H.effect||!c||c._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(H){this._activeEffect.setMatrix("world",H)}bindOnlyNormalMatrix(H){this._activeEffect.setMatrix("normalMatrix",H)}bind(H,c){c&&this.bindForSubMesh(H,c,c.$f[0])}_afterBind(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;super._afterBind(H,c,y),this.va()._cachedEffect=c,y?y._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return y._drawWrapper._forceRebindOnNextCall||H.isCachedMaterialInvalid(this,c,Z)}dispose(H,c,y){this._activeEffect=void 0,super.dispose(H,c,y)}}},11048:(H,c,y)=>{"use strict";y.d(c,{d:()=>u});var Z=y(11052),F=y(11061),P=y(11071),S=y(11076),n=y(11092),O=y(11112),a=y(11153),i=y(11236),C=y(11108),g=y(11239),v=y(11293),m=y(11301),z=y(11304),V=y(10893),h=y(11332),Q=y(11334),D=y(11340),f=y(11288),J=y(11285),l=y(11118),d=y(11347);const K={effect:null,subMesh:null};class T extends v.b{constructor(H){super(H),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(H){const c=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const y of c)this[y]=y===H}}class u extends m.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(H){this._attachImageProcessingConfiguration(H),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(H){H!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=H||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(H){this.imageProcessingConfiguration.colorCurvesEnabled=H}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(H){this.imageProcessingConfiguration.colorGradingEnabled=H}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(H){this._imageProcessingConfiguration.toneMappingEnabled=H}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(H){this._imageProcessingConfiguration.exposure=H}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(H){this._imageProcessingConfiguration.contrast=H}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(H){this._imageProcessingConfiguration.colorGradingTexture=H}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(H){this._imageProcessingConfiguration.colorCurves=H}get canRenderToMRT(){return!0}constructor(H,c){super(H,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||u.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new O.e(0,0,0),this.diffuseColor=new O.e(1,1,1),this.specularColor=new O.e(1,1,1),this.emissiveColor=new O.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new P.c(16),this._worldViewProjectionMatrix=n.d.Zero(),this._globalAmbientColor=new O.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new D.e(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new i.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),u.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),u.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(u.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(u.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"nb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===g.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.pe&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==g.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.pe||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(H,c){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const F=c._drawWrapper;if(F.effect&&this.isFrozen&&F._wasPreviouslyReady&&F._wasPreviouslyUsingInstances===Z)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new T(this._eventInfo.defineNames));const P=this.va(),S=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const n=P.getEngine();S._needNormals=(0,J.K)(P,H,S,!0,this._maxSimultaneousLights,this._disableLighting),(0,J.V)(P,S);const O=this.needAlphaBlendingForMesh(H)&&this.va().useOrderIndependentTransparency;if((0,J.Z)(P,S,this.canRenderToMRT&&!O),(0,J.X)(P,S,O),d.d.PrepareDefines(n.currentRenderPassId,H,S),S._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,S._needUVs=!1;for(let H=1;H<=6;++H)S["MAINUV"+H]=!1;if(P.texturesEnabled){if(S.DIFFUSEDIRECTUV=0,S.BUMPDIRECTUV=0,S.AMBIENTDIRECTUV=0,S.OPACITYDIRECTUV=0,S.EMISSIVEDIRECTUV=0,S.SPECULARDIRECTUV=0,S.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&u.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._diffuseTexture,S,"DIFFUSE")}else S.DIFFUSE=!1;if(this._ambientTexture&&u.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._ambientTexture,S,"AMBIENT")}else S.AMBIENT=!1;if(this._opacityTexture&&u.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._opacityTexture,S,"OPACITY"),S.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else S.OPACITY=!1;if(this._reflectionTexture&&u.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(S._needNormals=!0,S.REFLECTION=!0,S.ROUGHNESS=this._roughness>0,S.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,S.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===z.d.INVCUBIC_MODE,S.REFLECTIONMAP_3D=this._reflectionTexture.isCube,S.REFLECTIONMAP_OPPOSITEZ=S.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,S.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case z.d.EXPLICIT_MODE:S.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case z.d.PLANAR_MODE:S.setReflectionMode("REFLECTIONMAP_PLANAR");break;case z.d.PROJECTION_MODE:S.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case z.d.SKYBOX_MODE:S.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case z.d.SPHERICAL_MODE:S.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case z.d.EQUIRECTANGULAR_MODE:S.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case z.d.FIXED_EQUIRECTANGULAR_MODE:S.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case z.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:S.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case z.d.CUBIC_MODE:case z.d.INVCUBIC_MODE:default:S.setReflectionMode("REFLECTIONMAP_CUBIC")}S.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else S.REFLECTION=!1,S.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&u.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._emissiveTexture,S,"EMISSIVE")}else S.EMISSIVE=!1;if(this._lightmapTexture&&u.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._lightmapTexture,S,"LIGHTMAP"),S.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,S.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else S.LIGHTMAP=!1;if(this._specularTexture&&u.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,J.N)(this._specularTexture,S,"SPECULAR"),S.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else S.SPECULAR=!1;if(P.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&u.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,J.N)(this._bumpTexture,S,"BUMP"),S.PARALLAX=this._useParallax,S.PARALLAX_RHS=P.useRightHandedSystem,S.PARALLAXOCCLUSION=this._useParallaxOcclusion,S.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else S.BUMP=!1,S.PARALLAX=!1,S.PARALLAX_RHS=!1,S.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&u.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;S._needUVs=!0,S.REFRACTION=!0,S.REFRACTIONMAP_3D=this._refractionTexture.isCube,S.RGBDREFRACTION=this._refractionTexture.isRGBD,S.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else S.REFRACTION=!1;S.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else S.DIFFUSE=!1,S.AMBIENT=!1,S.OPACITY=!1,S.REFLECTION=!1,S.EMISSIVE=!1,S.LIGHTMAP=!1,S.BUMP=!1,S.REFRACTION=!1;S.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),S.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,S.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,S.SPECULAROVERALPHA=this._useSpecularOverAlpha,S.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,S.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,S.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(H)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(S._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(S),S.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,S.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}S._areFresnelDirty&&(u.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(S.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,S.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,S.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,S.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,S.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,S.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,S._needNormals=!0,S.FRESNEL=!0):S.FRESNEL=!1),(0,J.R)(H,P,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(H)||this._forceAlphaTest,S,this._applyDecalMapAfterDetailMap),(0,J.G)(P,n,this,S,Z,null,c.getRenderingMesh().hasThinInstances),this._eventInfo.defines=S,this._eventInfo.mesh=H,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,J.E)(H,S,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let g=!1;if(S.isDirty){const Z=S._areLightsDisposed;S.markAsProcessed();const F=new Q.c;S.REFLECTION&&F.addFallback(0,"REFLECTION"),S.SPECULAR&&F.addFallback(0,"SPECULAR"),S.BUMP&&F.addFallback(0,"BUMP"),S.PARALLAX&&F.addFallback(1,"PARALLAX"),S.PARALLAX_RHS&&F.addFallback(1,"PARALLAX_RHS"),S.PARALLAXOCCLUSION&&F.addFallback(0,"PARALLAXOCCLUSION"),S.SPECULAROVERALPHA&&F.addFallback(0,"SPECULAROVERALPHA"),S.FOG&&F.addFallback(1,"FOG"),S.POINTSIZE&&F.addFallback(0,"POINTSIZE"),S.LOGARITHMICDEPTH&&F.addFallback(0,"LOGARITHMICDEPTH"),(0,J.r)(S,F,this._maxSimultaneousLights),S.SPECULARTERM&&F.addFallback(0,"SPECULARTERM"),S.DIFFUSEFRESNEL&&F.addFallback(1,"DIFFUSEFRESNEL"),S.OPACITYFRESNEL&&F.addFallback(2,"OPACITYFRESNEL"),S.REFLECTIONFRESNEL&&F.addFallback(3,"REFLECTIONFRESNEL"),S.EMISSIVEFRESNEL&&F.addFallback(4,"EMISSIVEFRESNEL"),S.FRESNEL&&F.addFallback(4,"FRESNEL"),S.MULTIVIEW&&F.addFallback(0,"MULTIVIEW");const O=[a.h.PositionKind];S.NORMAL&&O.push(a.h.NormalKind),S.TANGENT&&O.push(a.h.TangentKind);for(let H=1;H<=6;++H)S["UV"+H]&&O.push(`uv${1===H?"":H}`);S.VERTEXCOLOR&&O.push(a.h.ColorKind),(0,J.x)(O,H,S,F),(0,J.B)(O,S),(0,J.D)(O,H,S),(0,J.v)(O,H,S);let v="default";const m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],z=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],V=["Material","Scene","Mesh"],h={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:S.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=F,this._eventInfo.fallbackRank=0,this._eventInfo.defines=S,this._eventInfo.uniforms=m,this._eventInfo.attributes=O,this._eventInfo.samplers=z,this._eventInfo.uniformBuffersNames=V,this._eventInfo.customCode=void 0,this._eventInfo.mesh=H,this._eventInfo.indexParameters=h,this._callbackPluginEventGeneric(128,this._eventInfo),d.d.AddUniformsAndSamplers(m,z),i.b.AddUniforms(m),i.b.AddSamplers(z),C.d&&(C.d.PrepareUniforms(m,S),C.d.PrepareSamplers(z,S)),(0,J._)({uniformsNames:m,uniformBuffersNames:V,samplers:z,defines:S,maxSimultaneousLights:this._maxSimultaneousLights}),(0,f.c)(m);const D={};this.customShaderNameResolve&&(v=this.customShaderNameResolve(v,m,V,z,S,O,D));const l=S.toString(),T=c.effect;let u=P.getEngine().createEffect(v,{attributes:O,uniformsNames:m,uniformBuffersNames:V,samplers:z,defines:l,fallbacks:F,onCompiled:this.onCompiled,onError:this.onError,indexParameters:h,processFinalCode:D.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:S.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([y.e(21),y.e(19)]).then(y.bind(y,13117)),Promise.all([y.e(22),y.e(20)]).then(y.bind(y,13259))]):await Promise.all([Promise.all([y.e(25),y.e(24)]).then(y.bind(y,13318)),Promise.all([y.e(27),y.e(26)]).then(y.bind(y,13478))]),this._shadersLoaded=!0}},n);if(this._eventInfo.customCode=void 0,u)if(this._onEffectCreatedObservable&&(K.effect=u,K.subMesh=c,this._onEffectCreatedObservable.notifyObservers(K)),this.allowShaderHotSwapping&&T&&!u.isReady()){if(u=T,S.markAsUnprocessed(),g=this.isFrozen,Z)return S._areLightsDisposed=!0,!1}else P.resetCachedMaterial(),c.setEffect(u,S,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(S._renderId=P.getRenderId(),F._wasPreviouslyReady=!g,F._wasPreviouslyUsingInstances=Z,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const H=this._uniformBuffer;H.addUniform("diffuseLeftColor",4),H.addUniform("diffuseRightColor",4),H.addUniform("opacityParts",4),H.addUniform("reflectionLeftColor",4),H.addUniform("reflectionRightColor",4),H.addUniform("refractionLeftColor",4),H.addUniform("refractionRightColor",4),H.addUniform("emissiveLeftColor",4),H.addUniform("emissiveRightColor",4),H.addUniform("vDiffuseInfos",2),H.addUniform("vAmbientInfos",2),H.addUniform("vOpacityInfos",2),H.addUniform("vReflectionInfos",2),H.addUniform("vReflectionPosition",3),H.addUniform("vReflectionSize",3),H.addUniform("vEmissiveInfos",2),H.addUniform("vLightmapInfos",2),H.addUniform("vSpecularInfos",2),H.addUniform("vBumpInfos",3),H.addUniform("diffuseMatrix",16),H.addUniform("ambientMatrix",16),H.addUniform("opacityMatrix",16),H.addUniform("reflectionMatrix",16),H.addUniform("emissiveMatrix",16),H.addUniform("lightmapMatrix",16),H.addUniform("specularMatrix",16),H.addUniform("bumpMatrix",16),H.addUniform("vTangentSpaceParams",2),H.addUniform("pointSize",1),H.addUniform("alphaCutOff",1),H.addUniform("refractionMatrix",16),H.addUniform("vRefractionInfos",4),H.addUniform("vRefractionPosition",3),H.addUniform("vRefractionSize",3),H.addUniform("vSpecularColor",4),H.addUniform("vEmissiveColor",3),H.addUniform("vDiffuseColor",4),H.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(H,c,y){const Z=this.va(),F=y.materialDefines;if(!F)return;const P=y.effect;if(!P)return;this._activeEffect=P,c.getMeshUniformBuffer().bindToEffect(P,"Mesh"),c.transferToEffect(H),this._uniformBuffer.bindToEffect(P,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,Z,c,H,this.isFrozen),d.d.Bind(Z.getEngine().currentRenderPassId,this._activeEffect,c,H),this._eventInfo.subMesh=y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),F.OBJECTSPACE_NORMALMAP&&(H.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const n=this._mustRebind(Z,P,y,c.visibility);(0,J.e)(c,P);const a=this._uniformBuffer;if(n){if(this.bindViewProjection(P),!a.useUbo||!this.isFrozen||!a.isSync||y._drawWrapper._forceRebindOnNextCall){if(u.FresnelEnabled&&F.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(a.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),a.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&a.updateColor4("opacityParts",new O.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(a.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),a.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(a.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),a.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(a.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),a.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),Z.texturesEnabled){if(this._diffuseTexture&&u.DiffuseTextureEnabled&&(a.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,J.o)(this._diffuseTexture,a,"diffuse")),this._ambientTexture&&u.AmbientTextureEnabled&&(a.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,J.o)(this._ambientTexture,a,"ambient")),this._opacityTexture&&u.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,J.o)(this._opacityTexture,a,"opacity")),this._hasAlphaChannel()&&a.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&u.ReflectionTextureEnabled&&(a.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),a.Hj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const H=this._reflectionTexture;a.updateVector3("vReflectionPosition",H.boundingBoxPosition),a.updateVector3("vReflectionSize",H.boundingBoxSize)}if(this._emissiveTexture&&u.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,J.o)(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&u.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,J.o)(this._lightmapTexture,a,"lightmap")),this._specularTexture&&u.SpecularTextureEnabled&&(a.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,J.o)(this._specularTexture,a,"specular")),this._bumpTexture&&Z.getEngine().getCaps().standardDerivatives&&u.BumpTextureEnabled&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,J.o)(this._bumpTexture,a,"bump"),Z._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&u.RefractionTextureEnabled){let H=1;if(this._refractionTexture.isCube||(a.Hj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(H=this._refractionTexture.depth)),a.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,H,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const H=this._refractionTexture;a.updateVector3("vRefractionPosition",H.boundingBoxPosition),a.updateVector3("vRefractionSize",H.boundingBoxSize)}}}this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),a.updateColor4("vSpecularColor",this.specularColor,this.specularPower),a.updateColor3("vEmissiveColor",u.EmissiveTextureEnabled?this.emissiveColor:O.e.BlackReadOnly),a.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),Z.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),a.updateColor3("vAmbientColor",this._globalAmbientColor)}Z.texturesEnabled&&(this._diffuseTexture&&u.DiffuseTextureEnabled&&P.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&u.AmbientTextureEnabled&&P.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&u.OpacityTextureEnabled&&P.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&u.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?P.setTexture("reflectionCubeSampler",this._reflectionTexture):P.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&u.EmissiveTextureEnabled&&P.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&u.LightmapTextureEnabled&&P.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&u.SpecularTextureEnabled&&P.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&Z.getEngine().getCaps().standardDerivatives&&u.BumpTextureEnabled&&P.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&u.RefractionTextureEnabled&&(this._refractionTexture.isCube?P.setTexture("refractionCubeSampler",this._refractionTexture):P.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.va().depthPeelingRenderer.bind(P),this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,f.f)(P,this,Z),this.bindEyePosition(P)}else Z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(n||!this.isFrozen){var i;if(Z.lightsEnabled&&!this._disableLighting&&(0,J.i)(Z,c,P,F,this._maxSimultaneousLights),(Z.fogEnabled&&c.applyFog&&Z.fogMode!==S.d.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||c.receiveShadows||F.PREPASS)&&this.bindView(P),(0,J.h)(Z,c,P),F.NUM_MORPH_INFLUENCERS&&(0,J.l)(c,P),F.BAKED_VERTEX_ANIMATION_TEXTURE)null===(i=c.bakedVertexAnimationManager)||void 0===i||i.bind(P,F.INSTANCES);this.useLogarithmicDepth&&(0,J.j)(F,P,Z),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(c,this._activeEffect,y),a.update()}getAnimatables(){const H=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&H.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&H.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&H.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&H.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&H.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&H.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&H.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&H.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&H.push(this._refractionTexture),H}getActiveTextures(){const H=super.getActiveTextures();return this._diffuseTexture&&H.push(this._diffuseTexture),this._ambientTexture&&H.push(this._ambientTexture),this._opacityTexture&&H.push(this._opacityTexture),this._reflectionTexture&&H.push(this._reflectionTexture),this._emissiveTexture&&H.push(this._emissiveTexture),this._specularTexture&&H.push(this._specularTexture),this._bumpTexture&&H.push(this._bumpTexture),this._lightmapTexture&&H.push(this._lightmapTexture),this._refractionTexture&&H.push(this._refractionTexture),H}hasTexture(H){return!!super.hasTexture(H)||(this._diffuseTexture===H||(this._ambientTexture===H||(this._opacityTexture===H||(this._reflectionTexture===H||(this._emissiveTexture===H||(this._specularTexture===H||(this._bumpTexture===H||(this._lightmapTexture===H||this._refractionTexture===H))))))))}dispose(H,c){var y,Z,F,P,S,n,O,a,i;c&&(null===(y=this._diffuseTexture)||void 0===y||y.dispose(),null===(Z=this._ambientTexture)||void 0===Z||Z.dispose(),null===(F=this._opacityTexture)||void 0===F||F.dispose(),null===(P=this._reflectionTexture)||void 0===P||P.dispose(),null===(S=this._emissiveTexture)||void 0===S||S.dispose(),null===(n=this._specularTexture)||void 0===n||n.dispose(),null===(O=this._bumpTexture)||void 0===O||O.dispose(),null===(a=this._lightmapTexture)||void 0===a||a.dispose(),null===(i=this._refractionTexture)||void 0===i||i.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(H,c)}clone(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const Z=l.e.Clone((()=>new u(H,this.va())),this,{cloneTexturesOnlyOnce:c});return Z.name=H,Z.id=H,this.stencil.copyTo(Z.stencil),this._clonePlugins(Z,y),Z}static Parse(H,c,y){const Z=l.e.Parse((()=>new u(H.name,c)),H,c,y);return H.stencil&&Z.stencil.parse(H.stencil,c,y),g.c._ParsePlugins(H,Z,c,y),Z}static get DiffuseTextureEnabled(){return h.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(H){h.b.DiffuseTextureEnabled=H}static get DetailTextureEnabled(){return h.b.DetailTextureEnabled}static set DetailTextureEnabled(H){h.b.DetailTextureEnabled=H}static get AmbientTextureEnabled(){return h.b.AmbientTextureEnabled}static set AmbientTextureEnabled(H){h.b.AmbientTextureEnabled=H}static get OpacityTextureEnabled(){return h.b.OpacityTextureEnabled}static set OpacityTextureEnabled(H){h.b.OpacityTextureEnabled=H}static get ReflectionTextureEnabled(){return h.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(H){h.b.ReflectionTextureEnabled=H}static get EmissiveTextureEnabled(){return h.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(H){h.b.EmissiveTextureEnabled=H}static get SpecularTextureEnabled(){return h.b.SpecularTextureEnabled}static set SpecularTextureEnabled(H){h.b.SpecularTextureEnabled=H}static get BumpTextureEnabled(){return h.b.BumpTextureEnabled}static set BumpTextureEnabled(H){h.b.BumpTextureEnabled=H}static get LightmapTextureEnabled(){return h.b.LightmapTextureEnabled}static set LightmapTextureEnabled(H){h.b.LightmapTextureEnabled=H}static get RefractionTextureEnabled(){return h.b.RefractionTextureEnabled}static set RefractionTextureEnabled(H){h.b.RefractionTextureEnabled=H}static get ColorGradingTextureEnabled(){return h.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(H){h.b.ColorGradingTextureEnabled=H}static get FresnelEnabled(){return h.b.FresnelEnabled}static set FresnelEnabled(H){h.b.FresnelEnabled=H}}u.ForceGLSL=!1,(0,Z.b)([(0,F.H)("diffuseTexture")],u.prototype,"_diffuseTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"diffuseTexture",void 0),(0,Z.b)([(0,F.H)("ambientTexture")],u.prototype,"_ambientTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTexture",void 0),(0,Z.b)([(0,F.H)("opacityTexture")],u.prototype,"_opacityTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"opacityTexture",void 0),(0,Z.b)([(0,F.H)("reflectionTexture")],u.prototype,"_reflectionTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionTexture",void 0),(0,Z.b)([(0,F.H)("emissiveTexture")],u.prototype,"_emissiveTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveTexture",void 0),(0,Z.b)([(0,F.H)("specularTexture")],u.prototype,"_specularTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"specularTexture",void 0),(0,Z.b)([(0,F.H)("bumpTexture")],u.prototype,"_bumpTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"bumpTexture",void 0),(0,Z.b)([(0,F.H)("lightmapTexture")],u.prototype,"_lightmapTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"lightmapTexture",void 0),(0,Z.b)([(0,F.H)("refractionTexture")],u.prototype,"_refractionTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"refractionTexture",void 0),(0,Z.b)([(0,F.l)("ambient")],u.prototype,"ambientColor",void 0),(0,Z.b)([(0,F.l)("diffuse")],u.prototype,"diffuseColor",void 0),(0,Z.b)([(0,F.l)("specular")],u.prototype,"specularColor",void 0),(0,Z.b)([(0,F.l)("emissive")],u.prototype,"emissiveColor",void 0),(0,Z.b)([(0,F.P)()],u.prototype,"specularPower",void 0),(0,Z.b)([(0,F.P)("useAlphaFromDiffuseTexture")],u.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"useAlphaFromDiffuseTexture",void 0),(0,Z.b)([(0,F.P)("useEmissiveAsIllumination")],u.prototype,"_useEmissiveAsIllumination",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useEmissiveAsIllumination",void 0),(0,Z.b)([(0,F.P)("linkEmissiveWithDiffuse")],u.prototype,"_linkEmissiveWithDiffuse",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"linkEmissiveWithDiffuse",void 0),(0,Z.b)([(0,F.P)("useSpecularOverAlpha")],u.prototype,"_useSpecularOverAlpha",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useSpecularOverAlpha",void 0),(0,Z.b)([(0,F.P)("useReflectionOverAlpha")],u.prototype,"_useReflectionOverAlpha",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useReflectionOverAlpha",void 0),(0,Z.b)([(0,F.P)("disableLighting")],u.prototype,"_disableLighting",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsLightsDirty")],u.prototype,"disableLighting",void 0),(0,Z.b)([(0,F.P)("useObjectSpaceNormalMap")],u.prototype,"_useObjectSpaceNormalMap",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useObjectSpaceNormalMap",void 0),(0,Z.b)([(0,F.P)("useParallax")],u.prototype,"_useParallax",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallax",void 0),(0,Z.b)([(0,F.P)("useParallaxOcclusion")],u.prototype,"_useParallaxOcclusion",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallaxOcclusion",void 0),(0,Z.b)([(0,F.P)()],u.prototype,"parallaxScaleBias",void 0),(0,Z.b)([(0,F.P)("roughness")],u.prototype,"_roughness",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,Z.b)([(0,F.P)()],u.prototype,"indexOfRefraction",void 0),(0,Z.b)([(0,F.P)()],u.prototype,"invertRefractionY",void 0),(0,Z.b)([(0,F.P)()],u.prototype,"alphaCutOff",void 0),(0,Z.b)([(0,F.P)("useLightmapAsShadowmap")],u.prototype,"_useLightmapAsShadowmap",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLightmapAsShadowmap",void 0),(0,Z.b)([(0,F.s)("diffuseFresnelParameters")],u.prototype,"_diffuseFresnelParameters",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"diffuseFresnelParameters",void 0),(0,Z.b)([(0,F.s)("opacityFresnelParameters")],u.prototype,"_opacityFresnelParameters",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],u.prototype,"opacityFresnelParameters",void 0),(0,Z.b)([(0,F.s)("reflectionFresnelParameters")],u.prototype,"_reflectionFresnelParameters",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"reflectionFresnelParameters",void 0),(0,Z.b)([(0,F.s)("refractionFresnelParameters")],u.prototype,"_refractionFresnelParameters",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"refractionFresnelParameters",void 0),(0,Z.b)([(0,F.s)("emissiveFresnelParameters")],u.prototype,"_emissiveFresnelParameters",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"emissiveFresnelParameters",void 0),(0,Z.b)([(0,F.P)("useReflectionFresnelFromSpecular")],u.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsFresnelDirty")],u.prototype,"useReflectionFresnelFromSpecular",void 0),(0,Z.b)([(0,F.P)("useGlossinessFromSpecularMapAlpha")],u.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,Z.b)([(0,F.P)("maxSimultaneousLights")],u.prototype,"_maxSimultaneousLights",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsLightsDirty")],u.prototype,"maxSimultaneousLights",void 0),(0,Z.b)([(0,F.P)("invertNormalMapX")],u.prototype,"_invertNormalMapX",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapX",void 0),(0,Z.b)([(0,F.P)("invertNormalMapY")],u.prototype,"_invertNormalMapY",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapY",void 0),(0,Z.b)([(0,F.P)("twoSidedLighting")],u.prototype,"_twoSidedLighting",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"twoSidedLighting",void 0),(0,Z.b)([(0,F.P)("applyDecalMapAfterDetailMap")],u.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,Z.b)([(0,F.d)("_markAllSubMeshesAsMiscDirty")],u.prototype,"applyDecalMapAfterDetailMap",void 0),(0,V.d)("BABYLON.StandardMaterial",u),S.d.DefaultMaterialFactory=H=>new u("default material",H)},11140:(H,c,y)=>{"use strict";y.d(c,{e:()=>P});var Z=y(10773),F=y(10754);class P{constructor(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=H,this._noUBO=!H.supportsUniformBuffers||F,this._dynamic=y,this._name=Z??"no-name",this._data=c||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Hj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Hj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(H){let c;if(c=H<=2?H:4,this._uniformLocationPointer%c!==0){const H=this._uniformLocationPointer;this._uniformLocationPointer+=c-this._uniformLocationPointer%c;const y=this._uniformLocationPointer-H;for(let c=0;c<y;c++)this._data.push(0)}}addUniform(H,c){let y,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[H]){if(Z>0){if(c instanceof Array)throw"addUniform should not be use with Array in UBO: "+H;if(this._fillAlignment(4),this._uniformArraySizes[H]={strideSize:c,arraySize:Z},16==c)c*=Z;else{c=c*Z+(4-c)*Z}y=[];for(let H=0;H<c;H++)y.push(0)}else{if(c instanceof Array)y=c,c=y.length;else{y=[];for(let H=0;H<c;H++)y.push(0)}this._fillAlignment(c)}this._uniformSizes[H]=c,this._uniformLocations[H]=this._uniformLocationPointer,this._uniformLocationPointer+=c;for(let H=0;H<c;H++)this._data.push(y[H]);this._needSync=!0}}addMatrix(H,c){this.addUniform(H,Array.prototype.slice.call(c.ij()))}addFloat2(H,c,y){const Z=[c,y];this.addUniform(H,Z)}addFloat3(H,c,y,Z){const F=[c,y,Z];this.addUniform(H,F)}addColor3(H,c){const y=[c.r,c.g,c.b];this.addUniform(H,y)}addColor4(H,c,y){const Z=[c.r,c.g,c.b,y];this.addUniform(H,Z)}addVector3(H,c){const y=[c.x,c.y,c.z];this.addUniform(H,y)}addMatrix3x3(H){this.addUniform(H,12)}addMatrix2x2(H){this.addUniform(H,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const H=[];let c=0;for(const y in this._uniformLocations)if(H.push(y),10===++c)break;return H.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(H,c){for(let y=0;y<H.length;++y)if(H[y]!==c[y])return!1;return!0}_copyBuffer(H,c){for(let y=0;y<H.length;++y)c[y]=H[y]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(P._UpdatedUbosInFrame[this._name]||(P._UpdatedUbosInFrame[this._name]=0),P._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(H,c,y){this._checkNewFrame();let F=this._uniformLocations[H];if(void 0===F){if(this._buffer)return void Z.d.Error("Cannot add an uniform after UBO has been created. uniformName="+H);this.addUniform(H,y),F=this._uniformLocations[H]}if(this._buffer||this.create(),this._dynamic)for(let Z=0;Z<y;Z++)this._bufferData[F+Z]=c[Z];else{let H=!1;for(let Z=0;Z<y;Z++)(16===y&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[F+Z]!==Math.fround(c[Z]))&&(H=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[F+Z]=c[Z]);this._needSync=this._needSync||H}}updateUniformArray(H,c,y){this._checkNewFrame();const P=this._uniformLocations[H];if(void 0===P)return void Z.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const S=this._uniformArraySizes[H];if(this._dynamic)for(let Z=0;Z<y;Z++)this._bufferData[P+Z]=c[Z];else{let H=!1,Z=0,n=0;for(let O=0;O<y;O++)if(this._bufferData[P+4*n+Z]!==F.c.FloatRound(c[O])&&(H=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[P+4*n+Z]=c[O]),Z++,Z===S.strideSize){for(;Z<4;Z++)this._bufferData[P+4*n+Z]=0;Z=0,n++}this._needSync=this._needSync||H}}_cacheMatrix(H,c){this._checkNewFrame();const y=this._valueCache[H],Z=c.updateFlag;return(void 0===y||y!==Z)&&(this._valueCache[H]=Z,!0)}_updateMatrix3x3ForUniform(H,c){for(let y=0;y<3;y++)P._TempBuffer[4*y]=c[3*y],P._TempBuffer[4*y+1]=c[3*y+1],P._TempBuffer[4*y+2]=c[3*y+2],P._TempBuffer[4*y+3]=0;this.updateUniform(H,P._TempBuffer,12)}_updateMatrix3x3ForEffect(H,c){this._currentEffect.setMatrix3x3(H,c)}_updateMatrix2x2ForEffect(H,c){this._currentEffect.setMatrix2x2(H,c)}_updateMatrix2x2ForUniform(H,c){for(let y=0;y<2;y++)P._TempBuffer[4*y]=c[2*y],P._TempBuffer[4*y+1]=c[2*y+1],P._TempBuffer[4*y+2]=0,P._TempBuffer[4*y+3]=0;this.updateUniform(H,P._TempBuffer,8)}_updateFloatForEffect(H,c){this._currentEffect.setFloat(H,c)}_updateFloatForUniform(H,c){P._TempBuffer[0]=c,this.updateUniform(H,P._TempBuffer,1)}_updateFloat2ForEffect(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(H+Z,c,y)}_updateFloat2ForUniform(H,c,y){P._TempBuffer[0]=c,P._TempBuffer[1]=y,this.updateUniform(H,P._TempBuffer,2)}_updateFloat3ForEffect(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(H+F,c,y,Z)}_updateFloat3ForUniform(H,c,y,Z){P._TempBuffer[0]=c,P._TempBuffer[1]=y,P._TempBuffer[2]=Z,this.updateUniform(H,P._TempBuffer,3)}_updateFloat4ForEffect(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(H+P,c,y,Z,F)}_updateFloat4ForUniform(H,c,y,Z,F){P._TempBuffer[0]=c,P._TempBuffer[1]=y,P._TempBuffer[2]=Z,P._TempBuffer[3]=F,this.updateUniform(H,P._TempBuffer,4)}_updateFloatArrayForEffect(H,c){this._currentEffect.setFloatArray(H,c)}_updateFloatArrayForUniform(H,c){this.updateUniformArray(H,c,c.length)}_updateArrayForEffect(H,c){this._currentEffect.setArray(H,c)}_updateArrayForUniform(H,c){this.updateUniformArray(H,c,c.length)}_updateIntArrayForEffect(H,c){this._currentEffect.setIntArray(H,c)}_updateIntArrayForUniform(H,c){P._TempBufferInt32View.set(c),this.updateUniformArray(H,P._TempBuffer,c.length)}_updateUIntArrayForEffect(H,c){this._currentEffect.setUIntArray(H,c)}_updateUIntArrayForUniform(H,c){P._TempBufferUInt32View.set(c),this.updateUniformArray(H,P._TempBuffer,c.length)}_updateMatrixForEffect(H,c){this._currentEffect.setMatrix(H,c)}_updateMatrixForUniform(H,c){this._cacheMatrix(H,c)&&this.updateUniform(H,c.ij(),16)}_updateMatricesForEffect(H,c){this._currentEffect.setMatrices(H,c)}_updateMatricesForUniform(H,c){this.updateUniform(H,c,c.length)}_updateVector3ForEffect(H,c){this._currentEffect.setVector3(H,c)}_updateVector3ForUniform(H,c){P._TempBuffer[0]=c.x,P._TempBuffer[1]=c.y,P._TempBuffer[2]=c.z,this.updateUniform(H,P._TempBuffer,3)}_updateVector4ForEffect(H,c){this._currentEffect.setVector4(H,c)}_updateVector4ForUniform(H,c){P._TempBuffer[0]=c.x,P._TempBuffer[1]=c.y,P._TempBuffer[2]=c.z,P._TempBuffer[3]=c.w,this.updateUniform(H,P._TempBuffer,4)}_updateColor3ForEffect(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(H+y,c)}_updateColor3ForUniform(H,c){P._TempBuffer[0]=c.r,P._TempBuffer[1]=c.g,P._TempBuffer[2]=c.b,this.updateUniform(H,P._TempBuffer,3)}_updateColor4ForEffect(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(H+Z,c,y)}_updateDirectColor4ForEffect(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(H+y,c)}_updateColor4ForUniform(H,c,y){P._TempBuffer[0]=c.r,P._TempBuffer[1]=c.g,P._TempBuffer[2]=c.b,P._TempBuffer[3]=y,this.updateUniform(H,P._TempBuffer,4)}_updateDirectColor4ForUniform(H,c){P._TempBuffer[0]=c.r,P._TempBuffer[1]=c.g,P._TempBuffer[2]=c.b,P._TempBuffer[3]=c.a,this.updateUniform(H,P._TempBuffer,4)}_updateIntForEffect(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(H+y,c)}_updateIntForUniform(H,c){P._TempBufferInt32View[0]=c,this.updateUniform(H,P._TempBuffer,1)}_updateInt2ForEffect(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(H+Z,c,y)}_updateInt2ForUniform(H,c,y){P._TempBufferInt32View[0]=c,P._TempBufferInt32View[1]=y,this.updateUniform(H,P._TempBuffer,2)}_updateInt3ForEffect(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(H+F,c,y,Z)}_updateInt3ForUniform(H,c,y,Z){P._TempBufferInt32View[0]=c,P._TempBufferInt32View[1]=y,P._TempBufferInt32View[2]=Z,this.updateUniform(H,P._TempBuffer,3)}_updateInt4ForEffect(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(H+P,c,y,Z,F)}_updateInt4ForUniform(H,c,y,Z,F){P._TempBufferInt32View[0]=c,P._TempBufferInt32View[1]=y,P._TempBufferInt32View[2]=Z,P._TempBufferInt32View[3]=F,this.updateUniform(H,P._TempBuffer,4)}_updateUIntForEffect(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(H+y,c)}_updateUIntForUniform(H,c){P._TempBufferUInt32View[0]=c,this.updateUniform(H,P._TempBuffer,1)}_updateUInt2ForEffect(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(H+Z,c,y)}_updateUInt2ForUniform(H,c,y){P._TempBufferUInt32View[0]=c,P._TempBufferUInt32View[1]=y,this.updateUniform(H,P._TempBuffer,2)}_updateUInt3ForEffect(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(H+F,c,y,Z)}_updateUInt3ForUniform(H,c,y,Z){P._TempBufferUInt32View[0]=c,P._TempBufferUInt32View[1]=y,P._TempBufferUInt32View[2]=Z,this.updateUniform(H,P._TempBuffer,3)}_updateUInt4ForEffect(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(H+P,c,y,Z,F)}_updateUInt4ForUniform(H,c,y,Z,F){P._TempBufferUInt32View[0]=c,P._TempBufferUInt32View[1]=y,P._TempBufferUInt32View[2]=Z,P._TempBufferUInt32View[3]=F,this.updateUniform(H,P._TempBuffer,4)}setTexture(H,c){this._currentEffect.setTexture(H,c)}setTextureArray(H,c){this._currentEffect.setTextureArray(H,c)}bindTexture(H,c){this._currentEffect._bindTexture(H,c)}updateUniformDirectly(H,c){this.updateUniform(H,c,c.length),this.update()}bindToEffect(H,c){this._currentEffect=H,this._currentEffectName=c}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(H){if(!this._buffers)return this._buffer===H;for(let c=0;c<this._buffers.length;++c){if(this._buffers[c][0]===H)return this._bufferIndex=c,this._buffer=H,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const H=this._engine._uniformBuffers,c=H.indexOf(this);if(-1!==c&&(H[c]=H[H.length-1],H.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let y=0;y<this._buffers.length;++y){const H=this._buffers[y][0];this._engine._releaseBuffer(H)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}P._UpdatedUbosInFrame={},P._MAX_UNIFORM_SIZE=256,P._TempBuffer=new Float32Array(P._MAX_UNIFORM_SIZE),P._TempBufferInt32View=new Int32Array(P._TempBuffer.buffer),P._TempBufferUInt32View=new Uint32Array(P._TempBuffer.buffer)},11410:(H,c,y)=>{"use strict";y.d(c,{e:()=>S,f:()=>Z});var Z,F,P=y(11092);!function(H){H[H.LOCAL=0]="LOCAL",H[H.WORLD=1]="WORLD",H[H.BONE=2]="BONE"}(Z||(Z={}));class S{}S.X=new P.n(1,0,0),S.Y=new P.n(0,1,0),S.Z=new P.n(0,0,1),function(H){H[H.X=0]="X",H[H.Y=1]="Y",H[H.Z=2]="Z"}(F||(F={}))},11112:(H,c,y)=>{"use strict";y.d(c,{e:()=>C,h:()=>g,i:()=>v});var Z=y(11103),F=y(10893),P=y(11094),S=y(11106);function n(H){return Math.pow(H,P.n)}function O(H){return H<=.04045?.0773993808*H:Math.pow(.947867299*(H+.055),2.4)}function a(H){return Math.pow(H,P.m)}function i(H){return H<=.0031308?12.92*H:1.055*Math.pow(H,.41666)-.055}class C{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=H,this.g=c,this.b=y}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let H=255*this.r|0;return H=397*H^255*this.g,H=397*H^255*this.b,H}toArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H[c]=this.r,H[c+1]=this.g,H[c+2]=this.b,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.FromArrayToRef(H,c,this),this}toColor4(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new g(this.r,this.g,this.b,H)}ij(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(H){return new C(this.r*H.r,this.g*H.g,this.b*H.b)}multiplyToRef(H,c){return c.r=this.r*H.r,c.g=this.g*H.g,c.b=this.b*H.b,c}multiplyInPlace(H){return this.r*=H.r,this.g*=H.g,this.b*=H.b,this}multiplyByFloats(H,c,y){return new C(this.r*H,this.g*c,this.b*y)}divide(H){throw new ReferenceError("Can not divide a color")}divideToRef(H,c){throw new ReferenceError("Can not divide a color")}divideInPlace(H){throw new ReferenceError("Can not divide a color")}minimizeInPlace(H){return this.minimizeInPlaceFromFloats(H.r,H.g,H.b)}maximizeInPlace(H){return this.maximizeInPlaceFromFloats(H.r,H.g,H.b)}minimizeInPlaceFromFloats(H,c,y){return this.r=Math.min(H,this.r),this.g=Math.min(c,this.g),this.b=Math.min(y,this.b),this}maximizeInPlaceFromFloats(H,c,y){return this.r=Math.max(H,this.r),this.g=Math.max(c,this.g),this.b=Math.max(y,this.b),this}floorToRef(H){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(H){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(H){return H&&this.r===H.r&&this.g===H.g&&this.b===H.b}equalsFloats(H,c,y){return this.equalsToFloats(H,c,y)}equalsToFloats(H,c,y){return this.r===H&&this.g===c&&this.b===y}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return(0,S.D)(this.r,H.r,c)&&(0,S.D)(this.g,H.g,c)&&(0,S.D)(this.b,H.b,c)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(H){throw new ReferenceError("Can not negate a color")}scale(H){return new C(this.r*H,this.g*H,this.b*H)}scaleInPlace(H){return this.r*=H,this.g*=H,this.b*=H,this}scaleToRef(H,c){return c.r=this.r*H,c.g=this.g*H,c.b=this.b*H,c}scaleAndAddToRef(H,c){return c.r+=this.r*H,c.g+=this.g*H,c.b+=this.b*H,c}clampToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.r=(0,S.e)(this.r,H,c),y.g=(0,S.e)(this.g,H,c),y.b=(0,S.e)(this.b,H,c),y}add(H){return new C(this.r+H.r,this.g+H.g,this.b+H.b)}addInPlace(H){return this.r+=H.r,this.g+=H.g,this.b+=H.b,this}addInPlaceFromFloats(H,c,y){return this.r+=H,this.g+=c,this.b+=y,this}addToRef(H,c){return c.r=this.r+H.r,c.g=this.g+H.g,c.b=this.b+H.b,c}Rc(H){return new C(this.r-H.r,this.g-H.g,this.b-H.b)}subtractToRef(H,c){return c.r=this.r-H.r,c.g=this.g-H.g,c.b=this.b-H.b,c}pi(H){return this.r-=H.r,this.g-=H.g,this.b-=H.b,this}subtractFromFloats(H,c,y){return new C(this.r-H,this.g-c,this.b-y)}subtractFromFloatsToRef(H,c,y,Z){return Z.r=this.r-H,Z.g=this.g-c,Z.b=this.b-y,Z}clone(){return new C(this.r,this.g,this.b)}p(H){return this.r=H.r,this.g=H.g,this.b=H.b,this}be(H,c,y){return this.r=H,this.g=c,this.b=y,this}set(H,c,y){return this.be(H,c,y)}ae(H){return this.r=this.g=this.b=H,this}toHexString(){const H=Math.round(255*this.r),c=Math.round(255*this.g),y=Math.round(255*this.b);return"#"+(0,S.B)(H)+(0,S.B)(c)+(0,S.B)(y)}fromHexString(H){return"#"!==H.substring(0,1)||7!==H.length||(this.r=parseInt(H.substring(1,3),16)/255,this.g=parseInt(H.substring(3,5),16)/255,this.b=parseInt(H.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new C)}toHSVToRef(H){const c=this.r,y=this.g,Z=this.b,F=Math.max(c,y,Z),P=Math.min(c,y,Z);let S=0,n=0;const O=F,a=F-P;return 0!==F&&(n=a/F),F!=P&&(F==c?(S=(y-Z)/a,y<Z&&(S+=6)):F==y?S=(Z-c)/a+2:F==Z&&(S=(c-y)/a+4),S*=60),H.r=S,H.g=n,H.b=O,H}toLinearSpace(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new C;return this.toLinearSpaceToRef(c,H),c}toLinearSpaceToRef(H){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(H.r=O(this.r),H.g=O(this.g),H.b=O(this.b)):(H.r=n(this.r),H.g=n(this.g),H.b=n(this.b)),this}toGammaSpace(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new C;return this.toGammaSpaceToRef(c,H),c}toGammaSpaceToRef(H){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(H.r=i(this.r),H.g=i(this.g),H.b=i(this.b)):(H.r=a(this.r),H.g=a(this.g),H.b=a(this.b)),this}static HSVtoRGBToRef(H,c,y,Z){const F=y*c,P=H/60,S=F*(1-Math.abs(P%2-1));let n=0,O=0,a=0;P>=0&&P<=1?(n=F,O=S):P>=1&&P<=2?(n=S,O=F):P>=2&&P<=3?(O=F,a=S):P>=3&&P<=4?(O=S,a=F):P>=4&&P<=5?(n=S,a=F):P>=5&&P<=6&&(n=F,a=S);const i=y-F;return Z.r=n+i,Z.g=O+i,Z.b=a+i,Z}static FromHSV(H,c,y){const Z=new C(0,0,0);return C.HSVtoRGBToRef(H,c,y,Z),Z}static FromHexString(H){return new C(0,0,0).fromHexString(H)}static Tg(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(H[c],H[c+1],H[c+2])}static FromArrayToRef(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;y.r=H[c],y.g=H[c+1],y.b=H[c+2]}static FromInts(H,c,y){return new C(H/255,c/255,y/255)}static Lerp(H,c,y){const Z=new C(0,0,0);return C.LerpToRef(H,c,y,Z),Z}static LerpToRef(H,c,y,Z){Z.r=H.r+(c.r-H.r)*y,Z.g=H.g+(c.g-H.g)*y,Z.b=H.b+(c.b-H.b)*y}static Hermite(H,c,y,Z,F){const P=F*F,S=F*P,n=2*S-3*P+1,O=-2*S+3*P,a=S-2*P+F,i=S-P,g=H.r*n+y.r*O+c.r*a+Z.r*i,v=H.g*n+y.g*O+c.g*a+Z.g*i,m=H.b*n+y.b*O+c.b*a+Z.b*i;return new C(g,v,m)}static Hermite1stDerivative(H,c,y,Z,F){const P=C.Black();return this.Hermite1stDerivativeToRef(H,c,y,Z,F,P),P}static Hermite1stDerivativeToRef(H,c,y,Z,F,P){const S=F*F;P.r=6*(S-F)*H.r+(3*S-4*F+1)*c.r+6*(-S+F)*y.r+(3*S-2*F)*Z.r,P.g=6*(S-F)*H.g+(3*S-4*F+1)*c.g+6*(-S+F)*y.g+(3*S-2*F)*Z.g,P.b=6*(S-F)*H.b+(3*S-4*F+1)*c.b+6*(-S+F)*y.b+(3*S-2*F)*Z.b}static Red(){return new C(1,0,0)}static Green(){return new C(0,1,0)}static Blue(){return new C(0,0,1)}static Black(){return new C(0,0,0)}static get BlackReadOnly(){return C._BlackReadOnly}static White(){return new C(1,1,1)}static Purple(){return new C(.5,0,.5)}static Magenta(){return new C(1,0,1)}static Yellow(){return new C(1,1,0)}static Gray(){return new C(.5,.5,.5)}static Teal(){return new C(0,1,1)}static Random(){return new C(Math.random(),Math.random(),Math.random())}}C._BlackReadOnly=C.Black(),Object.defineProperties(C.prototype,{dimension:{value:[3]},rank:{value:1}});class g{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=H,this.g=c,this.b=y,this.a=Z}ij(){return[this.r,this.g,this.b,this.a]}toArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H[c]=this.r,H[c+1]=this.g,H[c+2]=this.b,H[c+3]=this.a,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=H[c],this.g=H[c+1],this.b=H[c+2],this.a=H[c+3],this}equals(H){return H&&this.r===H.r&&this.g===H.g&&this.b===H.b&&this.a===H.a}add(H){return new g(this.r+H.r,this.g+H.g,this.b+H.b,this.a+H.a)}addToRef(H,c){return c.r=this.r+H.r,c.g=this.g+H.g,c.b=this.b+H.b,c.a=this.a+H.a,c}addInPlace(H){return this.r+=H.r,this.g+=H.g,this.b+=H.b,this.a+=H.a,this}addInPlaceFromFloats(H,c,y,Z){return this.r+=H,this.g+=c,this.b+=y,this.a+=Z,this}Rc(H){return new g(this.r-H.r,this.g-H.g,this.b-H.b,this.a-H.a)}subtractToRef(H,c){return c.r=this.r-H.r,c.g=this.g-H.g,c.b=this.b-H.b,c.a=this.a-H.a,c}pi(H){return this.r-=H.r,this.g-=H.g,this.b-=H.b,this.a-=H.a,this}subtractFromFloats(H,c,y,Z){return new g(this.r-H,this.g-c,this.b-y,this.a-Z)}subtractFromFloatsToRef(H,c,y,Z,F){return F.r=this.r-H,F.g=this.g-c,F.b=this.b-y,F.a=this.a-Z,F}scale(H){return new g(this.r*H,this.g*H,this.b*H,this.a*H)}scaleInPlace(H){return this.r*=H,this.g*=H,this.b*=H,this.a*=H,this}scaleToRef(H,c){return c.r=this.r*H,c.g=this.g*H,c.b=this.b*H,c.a=this.a*H,c}scaleAndAddToRef(H,c){return c.r+=this.r*H,c.g+=this.g*H,c.b+=this.b*H,c.a+=this.a*H,c}clampToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.r=(0,S.e)(this.r,H,c),y.g=(0,S.e)(this.g,H,c),y.b=(0,S.e)(this.b,H,c),y.a=(0,S.e)(this.a,H,c),y}multiply(H){return new g(this.r*H.r,this.g*H.g,this.b*H.b,this.a*H.a)}multiplyToRef(H,c){return c.r=this.r*H.r,c.g=this.g*H.g,c.b=this.b*H.b,c.a=this.a*H.a,c}multiplyInPlace(H){return this.r*=H.r,this.g*=H.g,this.b*=H.b,this.a*=H.a,this}multiplyByFloats(H,c,y,Z){return new g(this.r*H,this.g*c,this.b*y,this.a*Z)}divide(H){throw new ReferenceError("Can not divide a color")}divideToRef(H,c){throw new ReferenceError("Can not divide a color")}divideInPlace(H){throw new ReferenceError("Can not divide a color")}minimizeInPlace(H){return this.r=Math.min(this.r,H.r),this.g=Math.min(this.g,H.g),this.b=Math.min(this.b,H.b),this.a=Math.min(this.a,H.a),this}maximizeInPlace(H){return this.r=Math.max(this.r,H.r),this.g=Math.max(this.g,H.g),this.b=Math.max(this.b,H.b),this.a=Math.max(this.a,H.a),this}minimizeInPlaceFromFloats(H,c,y,Z){return this.r=Math.min(H,this.r),this.g=Math.min(c,this.g),this.b=Math.min(y,this.b),this.a=Math.min(Z,this.a),this}maximizeInPlaceFromFloats(H,c,y,Z){return this.r=Math.max(H,this.r),this.g=Math.max(c,this.g),this.b=Math.max(y,this.b),this.a=Math.max(Z,this.a),this}floorToRef(H){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(H){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(H){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return(0,S.D)(this.r,H.r,c)&&(0,S.D)(this.g,H.g,c)&&(0,S.D)(this.b,H.b,c)&&(0,S.D)(this.a,H.a,c)}equalsToFloats(H,c,y,Z){return this.r===H&&this.g===c&&this.b===y&&this.a===Z}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let H=255*this.r|0;return H=397*H^255*this.g,H=397*H^255*this.b,H=397*H^255*this.a,H}clone(){return(new g).p(this)}p(H){return this.r=H.r,this.g=H.g,this.b=H.b,this.a=H.a,this}be(H,c,y,Z){return this.r=H,this.g=c,this.b=y,this.a=Z,this}set(H,c,y,Z){return this.be(H,c,y,Z)}ae(H){return this.r=this.g=this.b=this.a=H,this}toHexString(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=Math.round(255*this.r),y=Math.round(255*this.g),Z=Math.round(255*this.b);if(H)return"#"+(0,S.B)(c)+(0,S.B)(y)+(0,S.B)(Z);const F=Math.round(255*this.a);return"#"+(0,S.B)(c)+(0,S.B)(y)+(0,S.B)(Z)+(0,S.B)(F)}fromHexString(H){return"#"!==H.substring(0,1)||9!==H.length&&7!==H.length||(this.r=parseInt(H.substring(1,3),16)/255,this.g=parseInt(H.substring(3,5),16)/255,this.b=parseInt(H.substring(5,7),16)/255,9===H.length&&(this.a=parseInt(H.substring(7,9),16)/255)),this}toLinearSpace(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new g;return this.toLinearSpaceToRef(c,H),c}toLinearSpaceToRef(H){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(H.r=O(this.r),H.g=O(this.g),H.b=O(this.b)):(H.r=n(this.r),H.g=n(this.g),H.b=n(this.b)),H.a=this.a,this}toGammaSpace(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new g;return this.toGammaSpaceToRef(c,H),c}toGammaSpaceToRef(H){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(H.r=i(this.r),H.g=i(this.g),H.b=i(this.b)):(H.r=a(this.r),H.g=a(this.g),H.b=a(this.b)),H.a=this.a,this}static FromHexString(H){return"#"!==H.substring(0,1)||9!==H.length&&7!==H.length?new g(0,0,0,0):new g(0,0,0,1).fromHexString(H)}static Lerp(H,c,y){return g.LerpToRef(H,c,y,new g)}static LerpToRef(H,c,y,Z){return Z.r=H.r+(c.r-H.r)*y,Z.g=H.g+(c.g-H.g)*y,Z.b=H.b+(c.b-H.b)*y,Z.a=H.a+(c.a-H.a)*y,Z}static Hermite(H,c,y,Z,F){const P=F*F,S=F*P,n=2*S-3*P+1,O=-2*S+3*P,a=S-2*P+F,i=S-P,C=H.r*n+y.r*O+c.r*a+Z.r*i,v=H.g*n+y.g*O+c.g*a+Z.g*i,m=H.b*n+y.b*O+c.b*a+Z.b*i,z=H.a*n+y.a*O+c.a*a+Z.a*i;return new g(C,v,m,z)}static Hermite1stDerivative(H,c,y,Z,F){const P=new g;return this.Hermite1stDerivativeToRef(H,c,y,Z,F,P),P}static Hermite1stDerivativeToRef(H,c,y,Z,F,P){const S=F*F;P.r=6*(S-F)*H.r+(3*S-4*F+1)*c.r+6*(-S+F)*y.r+(3*S-2*F)*Z.r,P.g=6*(S-F)*H.g+(3*S-4*F+1)*c.g+6*(-S+F)*y.g+(3*S-2*F)*Z.g,P.b=6*(S-F)*H.b+(3*S-4*F+1)*c.b+6*(-S+F)*y.b+(3*S-2*F)*Z.b,P.a=6*(S-F)*H.a+(3*S-4*F+1)*c.a+6*(-S+F)*y.a+(3*S-2*F)*Z.a}static FromColor3(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new g(H.r,H.g,H.b,c)}static Tg(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new g(H[c],H[c+1],H[c+2],H[c+3])}static FromArrayToRef(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;y.r=H[c],y.g=H[c+1],y.b=H[c+2],y.a=H[c+3]}static FromInts(H,c,y,Z){return new g(H/255,c/255,y/255,Z/255)}static CheckColors4(H,c){if(H.length===3*c){const c=[];for(let y=0;y<H.length;y+=3){const Z=y/3*4;c[Z]=H[y],c[Z+1]=H[y+1],c[Z+2]=H[y+2],c[Z+3]=1}return c}return H}}Object.defineProperties(g.prototype,{dimension:{value:[4]},rank:{value:1}});class v{}v.gb=(0,Z.d)(3,C.Black),v.ob=(0,Z.d)(3,(()=>new g(0,0,0,0))),(0,F.d)("BABYLON.Color3",C),(0,F.d)("BABYLON.Color4",g)},11094:(H,c,y)=>{"use strict";y.d(c,{e:()=>S,i:()=>P,m:()=>Z,n:()=>F});const Z=1/2.2,F=2.2,P=(1+Math.sqrt(5))/2,S=.001},11206:(H,c,y)=>{"use strict";y.d(c,{e:()=>F});var Z=y(11215);class F{static GetPlanes(H){const c=[];for(let y=0;y<6;y++)c.push(new Z.b(0,0,0,0));return F.GetPlanesToRef(H,c),c}static GetNearPlaneToRef(H,c){const y=H.m;c.k.x=y[3]+y[2],c.k.y=y[7]+y[6],c.k.z=y[11]+y[10],c.d=y[15]+y[14],c.normalize()}static GetFarPlaneToRef(H,c){const y=H.m;c.k.x=y[3]-y[2],c.k.y=y[7]-y[6],c.k.z=y[11]-y[10],c.d=y[15]-y[14],c.normalize()}static GetLeftPlaneToRef(H,c){const y=H.m;c.k.x=y[3]+y[0],c.k.y=y[7]+y[4],c.k.z=y[11]+y[8],c.d=y[15]+y[12],c.normalize()}static GetRightPlaneToRef(H,c){const y=H.m;c.k.x=y[3]-y[0],c.k.y=y[7]-y[4],c.k.z=y[11]-y[8],c.d=y[15]-y[12],c.normalize()}static GetTopPlaneToRef(H,c){const y=H.m;c.k.x=y[3]-y[1],c.k.y=y[7]-y[5],c.k.z=y[11]-y[9],c.d=y[15]-y[13],c.normalize()}static GetBottomPlaneToRef(H,c){const y=H.m;c.k.x=y[3]+y[1],c.k.y=y[7]+y[5],c.k.z=y[11]+y[9],c.d=y[15]+y[13],c.normalize()}static GetPlanesToRef(H,c){F.GetNearPlaneToRef(H,c[0]),F.GetFarPlaneToRef(H,c[1]),F.GetLeftPlaneToRef(H,c[2]),F.GetRightPlaneToRef(H,c[3]),F.GetTopPlaneToRef(H,c[4]),F.GetBottomPlaneToRef(H,c[5])}static IsPointInFrustum(H,c){for(let y=0;y<6;y++)if(c[y].dotCoordinate(H)<0)return!1;return!0}}},11275:(H,c,y)=>{"use strict";y.d(c,{c:()=>n,d:()=>O});var Z=y(11052),F=y(11092),P=y(11061);class S{static extractMinAndMaxIndexed(H,c,y,Z,F,P){for(let S=y;S<y+Z;S++){const y=3*c[S],Z=H[y],n=H[y+1],O=H[y+2];F.minimizeInPlaceFromFloats(Z,n,O),P.maximizeInPlaceFromFloats(Z,n,O)}}static extractMinAndMax(H,c,y,Z,F,P){for(let S=c,n=c*Z;S<c+y;S++,n+=Z){const c=H[n],y=H[n+1],Z=H[n+2];F.minimizeInPlaceFromFloats(c,y,Z),P.maximizeInPlaceFromFloats(c,y,Z)}}}function n(H,c,y,Z){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const n=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new F.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return S.extractMinAndMaxIndexed(H,c,y,Z,n,O),P&&(n.x-=n.x*P.x+P.y,n.y-=n.y*P.x+P.y,n.z-=n.z*P.x+P.y,O.x+=O.x*P.x+P.y,O.y+=O.y*P.x+P.y,O.z+=O.z*P.x+P.y),{minimum:n,maximum:O}}function O(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0;const n=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new F.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return P||(P=3),S.extractMinAndMax(H,c,y,P,n,O),Z&&(n.x-=n.x*Z.x+Z.y,n.y-=n.y*Z.x+Z.y,n.z-=n.z*Z.x+Z.y,O.x+=O.x*Z.x+Z.y,O.y+=O.y*Z.x+Z.y,O.z+=O.z*Z.x+Z.y),{minimum:n,maximum:O}}(0,Z.b)([P.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z,F]=c;return!Array.isArray(Z)&&!Array.isArray(F)}))],S,"extractMinAndMaxIndexed",null),(0,Z.b)([P.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z]=c;return!Array.isArray(Z)}))],S,"extractMinAndMax",null)},11609:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z.h});y(11410),y(11112),y(11094),y(11206),y(11617),y(11215),y(11320);var Z=y(11092);y(11372)},11617:(H,c,y)=>{"use strict";y.d(c,{d:()=>n,f:()=>i,h:()=>C});var Z,F=y(11106),P=y(11092),S=y(11094);!function(H){H[H.CW=0]="CW",H[H.CCW=1]="CCW"}(Z||(Z={}));class n{static Interpolate(H,c,y,Z,F){const P=1-3*Z+3*c,S=3*Z-6*c,n=3*c;let O=H;for(let a=0;a<5;a++){const c=O*O;O-=(P*(c*O)+S*c+n*O-H)*(1/(3*P*c+2*S*O+n)),O=Math.min(1,Math.max(0,O))}return 3*Math.pow(1-O,2)*O*y+3*(1-O)*Math.pow(O,2)*F+Math.pow(O,3)}}class O{constructor(H){this._radians=H,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(H,c){const y=c.Rc(H),Z=Math.atan2(y.y,y.x);return new O(Z)}static BetweenTwoVectors(H,c){let y=H.lengthSquared()*c.lengthSquared();if(0===y)return new O(Math.PI/2);y=Math.sqrt(y);let Z=H.dot(c)/y;Z=(0,F.e)(Z,-1,1);const P=Math.acos(Z);return new O(P)}static FromRadians(H){return new O(H)}static FromDegrees(H){return new O(H*Math.PI/180)}}class a{constructor(H,c,y){this.startPoint=H,this.midPoint=c,this.endPoint=y;const Z=Math.pow(c.x,2)+Math.pow(c.y,2),F=(Math.pow(H.x,2)+Math.pow(H.y,2)-Z)/2,S=(Z-Math.pow(y.x,2)-Math.pow(y.y,2))/2,n=(H.x-c.x)*(c.y-y.y)-(c.x-y.x)*(H.y-c.y);this.centerPoint=new P.l((F*(c.y-y.y)-S*(H.y-c.y))/n,((H.x-c.x)*S-(c.x-y.x)*F)/n),this.radius=this.centerPoint.Rc(this.startPoint).length(),this.startAngle=O.BetweenTwoPoints(this.centerPoint,this.startPoint);const a=this.startAngle.degrees();let i=O.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),C=O.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();i-a>180&&(i-=360),i-a<-180&&(i+=360),C-i>180&&(C-=360),C-i<-180&&(C+=360),this.orientation=i-a<0?0:1,this.angle=O.FromDegrees(0===this.orientation?a-C:C-a)}}class i{constructor(H,c){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new P.l(H,c))}addLineTo(H,c){if(this.closed)return this;const y=new P.l(H,c),Z=this._points[this._points.length-1];return this._points.push(y),this._length+=y.Rc(Z).length(),this}addArcTo(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const S=this._points[this._points.length-1],n=new P.l(H,c),O=new P.l(y,Z),i=new a(S,n,O);let C=i.angle.radians()/F;0===i.orientation&&(C*=-1);let g=i.startAngle.radians()+C;for(let P=0;P<F;P++){const H=Math.cos(g)*i.radius+i.centerPoint.x,c=Math.sin(g)*i.radius+i.centerPoint.y;this.addLineTo(H,c),g+=C}return this}addQuadraticCurveTo(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const P=(H,c,y,Z)=>(1-H)*(1-H)*c+2*H*(1-H)*y+H*H*Z,S=this._points[this._points.length-1];for(let n=0;n<=F;n++){const O=n/F,a=P(O,S.x,H,y),i=P(O,S.y,c,Z);this.addLineTo(a,i)}return this}addBezierCurveTo(H,c,y,Z,F,P){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const n=(H,c,y,Z,F)=>(1-H)*(1-H)*(1-H)*c+3*H*(1-H)*(1-H)*y+3*H*H*(1-H)*Z+H*H*H*F,O=this._points[this._points.length-1];for(let a=0;a<=S;a++){const i=a/S,C=n(i,O.x,H,y,F),g=n(i,O.y,c,Z,P);this.addLineTo(C,g)}return this}isPointInside(H){let c=!1;const y=this._points.length;for(let Z=y-1,F=0;F<y;Z=F++){let y=this._points[Z],P=this._points[F],S=P.x-y.x,n=P.y-y.y;if(Math.abs(n)>Number.EPSILON){if(n<0&&(y=this._points[F],S=-S,P=this._points[Z],n=-n),H.y<y.y||H.y>P.y)continue;if(H.y===y.y&&H.x===y.x)return!0;{const Z=n*(H.x-y.x)-S*(H.y-y.y);if(0===Z)return!0;if(Z<0)continue;c=!c}}else{if(H.y!==y.y)continue;if(P.x<=H.x&&H.x<=y.x||y.x<=H.x&&H.x<=P.x)return!0}}return c}close(){return this.closed=!0,this}length(){let H=this._length;if(this.closed){const c=this._points[this._points.length-1];H+=this._points[0].Rc(c).length()}return H}area(){const H=this._points.length;let c=0;for(let y=H-1,Z=0;Z<H;y=Z++)c+=this._points[y].x*this._points[Z].y-this._points[Z].x*this._points[y].y;return.5*c}getPoints(){return this._points}getPointAtLengthPosition(H){if(H<0||H>1)return P.l.Zero();const c=H*this.length();let y=0;for(let Z=0;Z<this._points.length;Z++){const H=(Z+1)%this._points.length,F=this._points[Z],S=this._points[H].Rc(F),n=S.length()+y;if(c>=y&&c<=n){const H=S.normalize(),Z=c-y;return new P.l(F.x+H.x*Z,F.y+H.y*Z)}y=n}return P.l.Zero()}static StartingAt(H,c){return new i(H,c)}}class C{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=H,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:P.n.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:P.d.Identity()};for(let F=0;F<H.length;F++)this._curve[F]=H[F].clone();this._raw=y||!1,this._alignTangentsWithPath=Z,this._compute(c,Z)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(H){return this._updatePointAtData(H).point}getTangentAt(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(H,c),c?P.n.TransformCoordinates(P.n.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(H,c),c?P.n.TransformCoordinates(P.n.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(H,c),c?P.n.TransformCoordinates(P.n.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(H){return this.length()*H}getPreviousPointIndexAt(H){return this._updatePointAtData(H),this._pointAtData.previousPointArrayIndex}getSubPositionAt(H){return this._updatePointAtData(H),this._pointAtData.subPosition}getClosestPositionTo(H){let c=Number.MAX_VALUE,y=0;for(let Z=0;Z<this._curve.length-1;Z++){const F=this._curve[Z+0],S=this._curve[Z+1].Rc(F).normalize(),n=this._distances[Z+1]-this._distances[Z+0],O=Math.min(Math.max(P.n.Dot(S,H.Rc(F).normalize()),0)*P.n.Distance(F,H)/n,1),a=P.n.Distance(F.add(S.scale(O*n)),H);a<c&&(c=a,y=(this._distances[Z+0]+n*O)/this.length())}return y}slice(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(H<0&&(H=1- -1*H%1),c<0&&(c=1- -1*c%1),H>c){const y=H;H=c,c=y}const y=this.getCurve(),Z=this.getPointAt(H);let F=this.getPreviousPointIndexAt(H);const P=this.getPointAt(c),S=this.getPreviousPointIndexAt(c)+1,n=[];return 0!==H&&(F++,n.push(Z)),n.push(...y.slice(F,S)),1===c&&1!==H||n.push(P),new C(n,this.getNormalAt(H),this._raw,this._alignTangentsWithPath)}update(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let Z=0;Z<H.length;Z++)this._curve[Z].x=H[Z].x,this._curve[Z].y=H[Z].y,this._curve[Z].z=H[Z].z;return this._compute(c,y),this}_compute(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this._curve.length;if(y<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[y-1]=this._curve[y-1].Rc(this._curve[y-2]),this._raw||this._tangents[y-1].normalize();const Z=this._tangents[0],F=this._normalVector(Z,H);let S,n,O,a,i;this._normals[0]=F,this._raw||this._normals[0].normalize(),this._binormals[0]=P.n.Cross(Z,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let C=1;C<y;C++)S=this._getLastNonNullVector(C),C<y-1&&(n=this._getFirstNonNullVector(C),this._tangents[C]=c?n:S.add(n),this._tangents[C].normalize()),this._distances[C]=this._distances[C-1]+this._curve[C].Rc(this._curve[C-1]).length(),O=this._tangents[C],i=this._binormals[C-1],this._normals[C]=P.n.Cross(i,O),this._raw||(0===this._normals[C].length()?(a=this._normals[C-1],this._normals[C]=a.clone()):this._normals[C].normalize()),this._binormals[C]=P.n.Cross(O,this._normals[C]),this._raw||this._binormals[C].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(H){let c=1,y=this._curve[H+c].Rc(this._curve[H]);for(;0===y.length()&&H+c+1<this._curve.length;)c++,y=this._curve[H+c].Rc(this._curve[H]);return y}_getLastNonNullVector(H){let c=1,y=this._curve[H].Rc(this._curve[H-c]);for(;0===y.length()&&H>c+1;)c++,y=this._curve[H].Rc(this._curve[H-c]);return y}_normalVector(H,c){let y,Z=H.length();if(0===Z&&(Z=1),void 0===c||null===c){let c;c=(0,F.D)(Math.abs(H.y)/Z,1,S.e)?(0,F.D)(Math.abs(H.x)/Z,1,S.e)?(0,F.D)(Math.abs(H.z)/Z,1,S.e)?P.n.Zero():new P.n(0,0,1):new P.n(1,0,0):new P.n(0,-1,0),y=P.n.Cross(H,c)}else y=P.n.Cross(H,c),P.n.CrossToRef(y,H,y);return y.normalize(),y}_updatePointAtData(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===H)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=H;const y=this.getPoints();if(H<=0)return this._setPointAtData(0,0,y[0],0,c);if(H>=1)return this._setPointAtData(1,1,y[y.length-1],y.length-1,c);let Z,F=y[0],S=0;const n=H*this.length();for(let O=1;O<y.length;O++){Z=y[O];const a=P.n.Distance(F,Z);if(S+=a,S===n)return this._setPointAtData(H,1,Z,O,c);if(S>n){const y=(S-n)/a,P=F.Rc(Z),i=Z.add(P.scaleInPlace(y));return this._setPointAtData(H,1-y,i,O-1,c)}F=Z}return this._pointAtData}_setPointAtData(H,c,y,Z,F){return this._pointAtData.point=y,this._pointAtData.position=H,this._pointAtData.subPosition=c,this._pointAtData.previousPointArrayIndex=Z,this._pointAtData.interpolateReady=F,F&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=P.d.Identity();const H=this._pointAtData.previousPointArrayIndex;if(H!==this._tangents.length-1){const c=H+1,y=this._tangents[H].clone(),Z=this._normals[H].clone(),F=this._binormals[H].clone(),S=this._tangents[c].clone(),n=this._normals[c].clone(),O=this._binormals[c].clone(),a=P.f.RotationQuaternionFromAxis(Z,F,y),i=P.f.RotationQuaternionFromAxis(n,O,S);P.f.Slerp(a,i,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11215:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});var Z=y(11092);class F{constructor(H,c,y,F){this.k=new Z.n(H,c,y),this.d=F}ij(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new F(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let H=this.k.getHashCode();return H=397*H^this.d,H}normalize(){const H=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let c=0;return 0!==H&&(c=1/H),this.k.x*=c,this.k.y*=c,this.k.z*=c,this.d*=c,this}transform(H){const c=F._TmpMatrix;H.invertToRef(c);const y=c.m,Z=this.k.x,P=this.k.y,S=this.k.z,n=this.d,O=Z*y[0]+P*y[1]+S*y[2]+n*y[3],a=Z*y[4]+P*y[5]+S*y[6]+n*y[7],i=Z*y[8]+P*y[9]+S*y[10]+n*y[11],C=Z*y[12]+P*y[13]+S*y[14]+n*y[15];return new F(O,a,i,C)}dotCoordinate(H){return this.k.x*H.x+this.k.y*H.y+this.k.z*H.z+this.d}copyFromPoints(H,c,y){const Z=c.x-H.x,F=c.y-H.y,P=c.z-H.z,S=y.x-H.x,n=y.y-H.y,O=y.z-H.z,a=F*O-P*n,i=P*S-Z*O,C=Z*n-F*S,g=Math.sqrt(a*a+i*i+C*C);let v;return v=0!==g?1/g:0,this.k.x=a*v,this.k.y=i*v,this.k.z=C*v,this.d=-(this.k.x*H.x+this.k.y*H.y+this.k.z*H.z),this}isFrontFacingTo(H,c){return Z.n.Dot(this.k,H)<=c}signedDistanceTo(H){return Z.n.Dot(H,this.k)+this.d}static Tg(H){return new F(H[0],H[1],H[2],H[3])}static FromPoints(H,c,y){const Z=new F(0,0,0,0);return Z.copyFromPoints(H,c,y),Z}static FromPositionAndNormal(H,c){const y=new F(0,0,0,0);return this.FromPositionAndNormalToRef(H,c,y)}static FromPositionAndNormalToRef(H,c,y){return y.k.p(c),y.k.normalize(),y.d=-H.dot(y.k),y}static SignedDistanceToPlaneFromPositionAndNormal(H,c,y){const F=-(c.x*H.x+c.y*H.y+c.z*H.z);return Z.n.Dot(y,c)+F}}F._TmpMatrix=Z.d.Identity()},11106:(H,c,y)=>{"use strict";function Z(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(H-c)<=y}function F(H,c){return H===c?H:Math.random()*(c-H)+H}function P(H,c,y){return H+(c-H)*y}function S(H,c,y,Z,F){const P=F*F,S=F*P;return H*(2*S-3*P+1)+y*(-2*S+3*P)+c*(S-2*P+F)+Z*(S-P)}function n(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(y,Math.max(c,H))}function O(H){return H-=2*Math.PI*Math.floor((H+Math.PI)/(2*Math.PI))}function a(H){const c=H.toString(16);return H<=15?("0"+c).toUpperCase():c.toUpperCase()}function i(H){if(Math.log2)return Math.floor(Math.log2(H));if(H<0)return NaN;if(0===H)return-1/0;let c=0;if(H<1){for(;H<1;)c++,H*=2;c=-c}else if(H>1)for(;H>1;)c++,H=Math.floor(H/2);return c}function C(H,c){const y=H%c;return 0===y?c:C(c,y)}y.d(c,{B:()=>a,D:()=>Z,e:()=>n,i:()=>S,l:()=>C,p:()=>i,s:()=>P,u:()=>O,x:()=>F})},11320:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(H,c){this.width=H,this.height=c}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let H=0|this.width;return H=397*H^this.height,H}p(H){this.width=H.width,this.height=H.height}be(H,c){return this.width=H,this.height=c,this}set(H,c){return this.be(H,c)}multiplyByFloats(H,c){return new Z(this.width*H,this.height*c)}clone(){return new Z(this.width,this.height)}equals(H){return!!H&&(this.width===H.width&&this.height===H.height)}get surface(){return this.width*this.height}static Zero(){return new Z(0,0)}add(H){return new Z(this.width+H.width,this.height+H.height)}Rc(H){return new Z(this.width-H.width,this.height-H.height)}scale(H){return new Z(this.width*H,this.height*H)}static Lerp(H,c,y){const F=H.width+(c.width-H.width)*y,P=H.height+(c.height-H.height)*y;return new Z(F,P)}}},11092:(H,c,y)=>{"use strict";y.d(c,{d:()=>m,f:()=>v,h:()=>V,l:()=>i,n:()=>C,q:()=>g});var Z=y(11094),F=y(11103),P=y(10893),S=y(10872),n=y(10810),O=y(11106);const a=H=>parseInt(H.toString().replace(/\W/g,""));class i{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=H,this.y=c}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let H=a(this.x);return H=397*H^a(this.y),H}toArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H[c]=this.x,H[c+1]=this.y,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(H,c,this),this}ij(){return[this.x,this.y]}p(H){return this.x=H.x,this.y=H.y,this}be(H,c){return this.x=H,this.y=c,this}set(H,c){return this.be(H,c)}ae(H){return this.be(H,H)}add(H){return new i(this.x+H.x,this.y+H.y)}addToRef(H,c){return c.x=this.x+H.x,c.y=this.y+H.y,c}addInPlace(H){return this.x+=H.x,this.y+=H.y,this}addInPlaceFromFloats(H,c){return this.x+=H,this.y+=c,this}addVector3(H){return new i(this.x+H.x,this.y+H.y)}Rc(H){return new i(this.x-H.x,this.y-H.y)}subtractToRef(H,c){return c.x=this.x-H.x,c.y=this.y-H.y,c}pi(H){return this.x-=H.x,this.y-=H.y,this}multiplyInPlace(H){return this.x*=H.x,this.y*=H.y,this}multiply(H){return new i(this.x*H.x,this.y*H.y)}multiplyToRef(H,c){return c.x=this.x*H.x,c.y=this.y*H.y,c}multiplyByFloats(H,c){return new i(this.x*H,this.y*c)}divide(H){return new i(this.x/H.x,this.y/H.y)}divideToRef(H,c){return c.x=this.x/H.x,c.y=this.y/H.y,c}divideInPlace(H){return this.x=this.x/H.x,this.y=this.y/H.y,this}minimizeInPlace(H){return this.minimizeInPlaceFromFloats(H.x,H.y)}maximizeInPlace(H){return this.maximizeInPlaceFromFloats(H.x,H.y)}minimizeInPlaceFromFloats(H,c){return this.x=Math.min(H,this.x),this.y=Math.min(c,this.y),this}maximizeInPlaceFromFloats(H,c){return this.x=Math.max(H,this.x),this.y=Math.max(c,this.y),this}subtractFromFloats(H,c){return new i(this.x-H,this.y-c)}subtractFromFloatsToRef(H,c,y){return y.x=this.x-H,y.y=this.y-c,y}negate(){return new i(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(H){return H.x=-this.x,H.y=-this.y,H}scaleInPlace(H){return this.x*=H,this.y*=H,this}scale(H){return new i(this.x*H,this.y*H)}scaleToRef(H,c){return c.x=this.x*H,c.y=this.y*H,c}scaleAndAddToRef(H,c){return c.x+=this.x*H,c.y+=this.y*H,c}equals(H){return H&&this.x===H.x&&this.y===H.y}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.e;return H&&(0,O.D)(this.x,H.x,c)&&(0,O.D)(this.y,H.y,c)}equalsToFloats(H,c){return this.x===H&&this.y===c}floor(){return new i(Math.floor(this.x),Math.floor(this.y))}floorToRef(H){return H.x=Math.floor(this.x),H.y=Math.floor(this.y),H}fract(){return new i(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(H){return H.x=this.x-Math.floor(this.x),H.y=this.y-Math.floor(this.y),H}rotateToRef(H,c){const y=Math.cos(H),Z=Math.sin(H),F=y*this.x-Z*this.y,P=Z*this.x+y*this.y;return c.x=F,c.y=P,c}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(H){return 0===H||1===H?this:this.scaleInPlace(1/H)}normalizeToNew(){const H=new i;return this.normalizeToRef(H),H}normalizeToRef(H){const c=this.length();return 0===c&&(H.x=this.x,H.y=this.y),this.scaleToRef(1/c,H)}clone(){return new i(this.x,this.y)}dot(H){return this.x*H.x+this.y*H.y}static Zero(){return new i(0,0)}static One(){return new i(1,1)}static Random(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new i((0,O.x)(H,c),(0,O.x)(H,c))}static RandomToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).be((0,O.x)(H,c),(0,O.x)(H,c))}static get ZeroReadOnly(){return i._ZeroReadOnly}static Tg(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(H[c],H[c+1])}static FromArrayToRef(H,c,y){return y.x=H[c],y.y=H[c+1],y}static FromFloatsToRef(H,c,y){return y.be(H,c),y}static CatmullRom(H,c,y,Z,F){const P=F*F,S=F*P,n=.5*(2*c.x+(-H.x+y.x)*F+(2*H.x-5*c.x+4*y.x-Z.x)*P+(-H.x+3*c.x-3*y.x+Z.x)*S),O=.5*(2*c.y+(-H.y+y.y)*F+(2*H.y-5*c.y+4*y.y-Z.y)*P+(-H.y+3*c.y-3*y.y+Z.y)*S);return new i(n,O)}static ClampToRef(H,c,y,Z){return Z.x=(0,O.e)(H.x,c.x,y.x),Z.y=(0,O.e)(H.y,c.y,y.y),Z}static Clamp(H,c,y){const Z=(0,O.e)(H.x,c.x,y.x),F=(0,O.e)(H.y,c.y,y.y);return new i(Z,F)}static Hermite(H,c,y,Z,F){const P=F*F,S=F*P,n=2*S-3*P+1,O=-2*S+3*P,a=S-2*P+F,C=S-P,g=H.x*n+y.x*O+c.x*a+Z.x*C,v=H.y*n+y.y*O+c.y*a+Z.y*C;return new i(g,v)}static Hermite1stDerivative(H,c,y,Z,F){return this.Hermite1stDerivativeToRef(H,c,y,Z,F,new i)}static Hermite1stDerivativeToRef(H,c,y,Z,F,P){const S=F*F;return P.x=6*(S-F)*H.x+(3*S-4*F+1)*c.x+6*(-S+F)*y.x+(3*S-2*F)*Z.x,P.y=6*(S-F)*H.y+(3*S-4*F+1)*c.y+6*(-S+F)*y.y+(3*S-2*F)*Z.y,P}static Lerp(H,c,y){return i.LerpToRef(H,c,y,new i)}static LerpToRef(H,c,y,Z){return Z.x=H.x+(c.x-H.x)*y,Z.y=H.y+(c.y-H.y)*y,Z}static Dot(H,c){return H.x*c.x+H.y*c.y}static Normalize(H){return i.NormalizeToRef(H,new i)}static NormalizeToRef(H,c){return H.normalizeToRef(c),c}static Minimize(H,c){const y=H.x<c.x?H.x:c.x,Z=H.y<c.y?H.y:c.y;return new i(y,Z)}static Maximize(H,c){const y=H.x>c.x?H.x:c.x,Z=H.y>c.y?H.y:c.y;return new i(y,Z)}static Transform(H,c){return i.TransformToRef(H,c,new i)}static TransformToRef(H,c,y){const Z=c.m,F=H.x*Z[0]+H.y*Z[4]+Z[12],P=H.x*Z[1]+H.y*Z[5]+Z[13];return y.x=F,y.y=P,y}static PointInTriangle(H,c,y,Z){const F=.5*(-y.y*Z.x+c.y*(-y.x+Z.x)+c.x*(y.y-Z.y)+y.x*Z.y),P=F<0?-1:1,S=(c.y*Z.x-c.x*Z.y+(Z.y-c.y)*H.x+(c.x-Z.x)*H.y)*P,n=(c.x*y.y-c.y*y.x+(c.y-y.y)*H.x+(y.x-c.x)*H.y)*P;return S>0&&n>0&&S+n<2*F*P}static Distance(H,c){return Math.sqrt(i.DistanceSquared(H,c))}static DistanceSquared(H,c){const y=H.x-c.x,Z=H.y-c.y;return y*y+Z*Z}static Center(H,c){return i.CenterToRef(H,c,new i)}static CenterToRef(H,c,y){return y.be((H.x+c.x)/2,(H.y+c.y)/2)}static DistanceOfPointFromSegment(H,c,y){const Z=i.DistanceSquared(c,y);if(0===Z)return i.Distance(H,c);const F=y.Rc(c),P=Math.max(0,Math.min(1,i.Dot(H.Rc(c),F)/Z)),S=c.add(F.multiplyByFloats(P,P));return i.Distance(H,S)}}i._ZeroReadOnly=i.Zero(),Object.defineProperties(i.prototype,{dimension:{value:[2]},rank:{value:1}});class C{get x(){return this._x}set x(H){this._x=H,this._isDirty=!0}get y(){return this._y}set y(H){this._y=H,this._isDirty=!0}get z(){return this._z}set z(H){this._z=H,this._isDirty=!0}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=H,this._y=c,this._z=y}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let H=a(this._x);return H=397*H^a(this._y),H=397*H^a(this._z),H}ij(){return[this._x,this._y,this._z]}toArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H[c]=this._x,H[c+1]=this._y,H[c+2]=this._z,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.FromArrayToRef(H,c,this),this}toQuaternion(){return v.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(H){return this._x+=H._x,this._y+=H._y,this._z+=H._z,this._isDirty=!0,this}addInPlaceFromFloats(H,c,y){return this._x+=H,this._y+=c,this._z+=y,this._isDirty=!0,this}add(H){return new C(this._x+H._x,this._y+H._y,this._z+H._z)}addToRef(H,c){return c._x=this._x+H._x,c._y=this._y+H._y,c._z=this._z+H._z,c._isDirty=!0,c}pi(H){return this._x-=H._x,this._y-=H._y,this._z-=H._z,this._isDirty=!0,this}Rc(H){return new C(this._x-H._x,this._y-H._y,this._z-H._z)}subtractToRef(H,c){return this.subtractFromFloatsToRef(H._x,H._y,H._z,c)}subtractFromFloats(H,c,y){return new C(this._x-H,this._y-c,this._z-y)}subtractFromFloatsToRef(H,c,y,Z){return Z._x=this._x-H,Z._y=this._y-c,Z._z=this._z-y,Z._isDirty=!0,Z}negate(){return new C(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(H){return H._x=-1*this._x,H._y=-1*this._y,H._z=-1*this._z,H._isDirty=!0,H}scaleInPlace(H){return this._x*=H,this._y*=H,this._z*=H,this._isDirty=!0,this}scale(H){return new C(this._x*H,this._y*H,this._z*H)}scaleToRef(H,c){return c._x=this._x*H,c._y=this._y*H,c._z=this._z*H,c._isDirty=!0,c}getNormalToRef(H){const c=this.length();let y=Math.acos(this.y/c);const Z=Math.atan2(this.z,this.x);y>Math.PI/2?y-=Math.PI/2:y+=Math.PI/2;const F=c*Math.sin(y)*Math.cos(Z),P=c*Math.cos(y),S=c*Math.sin(y)*Math.sin(Z);return H.set(F,P,S),H}applyRotationQuaternionToRef(H,c){const y=this._x,Z=this._y,F=this._z,P=H._x,S=H._y,n=H._z,O=H._w,a=2*(S*F-n*Z),i=2*(n*y-P*F),C=2*(P*Z-S*y);return c._x=y+O*a+S*C-n*i,c._y=Z+O*i+n*a-P*C,c._z=F+O*C+P*i-S*a,c._isDirty=!0,c}applyRotationQuaternionInPlace(H){return this.applyRotationQuaternionToRef(H,this)}applyRotationQuaternion(H){return this.applyRotationQuaternionToRef(H,new C)}scaleAndAddToRef(H,c){return c._x+=this._x*H,c._y+=this._y*H,c._z+=this._z*H,c._isDirty=!0,c}projectOnPlane(H,c){return this.projectOnPlaneToRef(H,c,new C)}projectOnPlaneToRef(H,c,y){const Z=H.k,F=H.d,P=z.o[0];this.subtractToRef(c,P),P.normalize();const S=C.Dot(P,Z);if(Math.abs(S)<1e-10)y.ae(1/0);else{const H=-(C.Dot(c,Z)+F)/S,n=P.scaleInPlace(H);c.addToRef(n,y)}return y}equals(H){return H&&this._x===H._x&&this._y===H._y&&this._z===H._z}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.e;return H&&(0,O.D)(this._x,H._x,c)&&(0,O.D)(this._y,H._y,c)&&(0,O.D)(this._z,H._z,c)}equalsToFloats(H,c,y){return this._x===H&&this._y===c&&this._z===y}multiplyInPlace(H){return this._x*=H._x,this._y*=H._y,this._z*=H._z,this._isDirty=!0,this}multiply(H){return this.multiplyByFloats(H._x,H._y,H._z)}multiplyToRef(H,c){return c._x=this._x*H._x,c._y=this._y*H._y,c._z=this._z*H._z,c._isDirty=!0,c}multiplyByFloats(H,c,y){return new C(this._x*H,this._y*c,this._z*y)}divide(H){return new C(this._x/H._x,this._y/H._y,this._z/H._z)}divideToRef(H,c){return c._x=this._x/H._x,c._y=this._y/H._y,c._z=this._z/H._z,c._isDirty=!0,c}divideInPlace(H){return this._x=this._x/H._x,this._y=this._y/H._y,this._z=this._z/H._z,this._isDirty=!0,this}minimizeInPlace(H){return this.minimizeInPlaceFromFloats(H._x,H._y,H._z)}maximizeInPlace(H){return this.maximizeInPlaceFromFloats(H._x,H._y,H._z)}minimizeInPlaceFromFloats(H,c,y){return H<this._x&&(this.x=H),c<this._y&&(this.y=c),y<this._z&&(this.z=y),this}maximizeInPlaceFromFloats(H,c,y){return H>this._x&&(this.x=H),c>this._y&&(this.y=c),y>this._z&&(this.z=y),this}isNonUniformWithinEpsilon(H){const c=Math.abs(this._x),y=Math.abs(this._y);if(!(0,O.D)(c,y,H))return!0;const Z=Math.abs(this._z);return!(0,O.D)(c,Z,H)||!(0,O.D)(y,Z,H)}get isNonUniform(){const H=Math.abs(this._x);if(H!==Math.abs(this._y))return!0;return H!==Math.abs(this._z)}floorToRef(H){return H._x=Math.floor(this._x),H._y=Math.floor(this._y),H._z=Math.floor(this._z),H._isDirty=!0,H}floor(){return new C(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(H){return H._x=this.x-Math.floor(this._x),H._y=this.y-Math.floor(this._y),H._z=this.z-Math.floor(this._z),H._isDirty=!0,H}fract(){return new C(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(H){if("xyz"===(H=H.toLowerCase()))return this;const c=z.o[0].p(this);return this.x=c[H[0]],this.y=c[H[1]],this.z=c[H[2]],this}rotateByQuaternionToRef(H,c){return H.toRotationMatrix(z.Matrix[0]),C.TransformCoordinatesToRef(this,z.Matrix[0],c),c}rotateByQuaternionAroundPointToRef(H,c,y){return this.subtractToRef(c,z.o[0]),z.o[0].rotateByQuaternionToRef(H,z.o[0]),c.addToRef(z.o[0],y),y}cross(H){return C.CrossToRef(this,H,new C)}normalizeFromLength(H){return 0===H||1===H?this:this.scaleInPlace(1/H)}normalizeToNew(){return this.normalizeToRef(new C)}normalizeToRef(H){const c=this.length();return 0===c||1===c?(H._x=this._x,H._y=this._y,H._z=this._z,H._isDirty=!0,H):this.scaleToRef(1/c,H)}clone(){return new C(this._x,this._y,this._z)}p(H){return this.be(H._x,H._y,H._z)}be(H,c,y){return this._x=H,this._y=c,this._z=y,this._isDirty=!0,this}set(H,c,y){return this.be(H,c,y)}ae(H){return this._x=this._y=this._z=H,this._isDirty=!0,this}static GetClipFactor(H,c,y,Z){const F=C.Dot(H,y);return(F-Z)/(F-C.Dot(c,y))}static GetAngleBetweenVectors(H,c,y){const Z=H.normalizeToRef(z.o[1]),F=c.normalizeToRef(z.o[2]);let P=C.Dot(Z,F);P=(0,O.e)(P,-1,1);const S=Math.acos(P),n=z.o[3];return C.CrossToRef(Z,F,n),C.Dot(n,y)>0?isNaN(S)?0:S:isNaN(S)?-Math.PI:-Math.acos(P)}static GetAngleBetweenVectorsOnPlane(H,c,y){z.o[0].p(H);const Z=z.o[0];z.o[1].p(c);const F=z.o[1];z.o[2].p(y);const P=z.o[2],S=z.o[3],n=z.o[4];Z.normalize(),F.normalize(),P.normalize(),C.CrossToRef(P,Z,S),C.CrossToRef(S,P,n);const a=Math.atan2(C.Dot(F,S),C.Dot(F,n));return(0,O.u)(a)}static PitchYawRollToMoveBetweenPointsToRef(H,c,y){const Z=V.o[0];return c.subtractToRef(H,Z),y._y=Math.atan2(Z.x,Z.z)||0,y._x=Math.atan2(Math.sqrt(Z.x**2+Z.z**2),Z.y)||0,y._z=0,y._isDirty=!0,y}static PitchYawRollToMoveBetweenPoints(H,c){const y=C.Zero();return C.PitchYawRollToMoveBetweenPointsToRef(H,c,y)}static SlerpToRef(H,c,y,F){y=(0,O.e)(y,0,1);const P=z.o[0],S=z.o[1];P.p(H);const n=P.length();P.normalizeFromLength(n),S.p(c);const a=S.length();S.normalizeFromLength(a);const i=C.Dot(P,S);let g,v;if(i<1-Z.e){const H=Math.acos(i),c=1/Math.sin(H);g=Math.sin((1-y)*H)*c,v=Math.sin(y*H)*c}else g=1-y,v=y;return P.scaleInPlace(g),S.scaleInPlace(v),F.p(P).addInPlace(S),F.scaleInPlace((0,O.s)(n,a,y)),F}static SmoothToRef(H,c,y,Z,F){return C.SlerpToRef(H,c,0===Z?1:y/Z,F),F}static Tg(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(H[c],H[c+1],H[c+2])}static FromFloatArray(H,c){return C.Tg(H,c)}static FromArrayToRef(H,c,y){return y._x=H[c],y._y=H[c+1],y._z=H[c+2],y._isDirty=!0,y}static FromFloatArrayToRef(H,c,y){return C.FromArrayToRef(H,c,y)}static FromFloatsToRef(H,c,y,Z){return Z.be(H,c,y),Z}static Zero(){return new C(0,0,0)}static One(){return new C(1,1,1)}static Up(){return new C(0,1,0)}static get UpReadOnly(){return C._UpReadOnly}static get DownReadOnly(){return C._DownReadOnly}static get RightReadOnly(){return C._RightReadOnly}static get LeftReadOnly(){return C._LeftReadOnly}static get LeftHandedForwardReadOnly(){return C._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return C._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return C._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return C._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return C._ZeroReadOnly}static get OneReadOnly(){return C._OneReadOnly}static Down(){return new C(0,-1,0)}static Forward(){return new C(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new C(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new C(1,0,0)}static Left(){return new C(-1,0,0)}static Random(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new C((0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c))}static RandomToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).be((0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c))}static TransformCoordinates(H,c){const y=C.Zero();return C.TransformCoordinatesToRef(H,c,y),y}static TransformCoordinatesToRef(H,c,y){return C.TransformCoordinatesFromFloatsToRef(H._x,H._y,H._z,c,y),y}static TransformCoordinatesFromFloatsToRef(H,c,y,Z,F){const P=Z.m,S=H*P[0]+c*P[4]+y*P[8]+P[12],n=H*P[1]+c*P[5]+y*P[9]+P[13],O=H*P[2]+c*P[6]+y*P[10]+P[14],a=1/(H*P[3]+c*P[7]+y*P[11]+P[15]);return F._x=S*a,F._y=n*a,F._z=O*a,F._isDirty=!0,F}static TransformNormal(H,c){const y=C.Zero();return C.TransformNormalToRef(H,c,y),y}static TransformNormalToRef(H,c,y){return this.TransformNormalFromFloatsToRef(H._x,H._y,H._z,c,y),y}static TransformNormalFromFloatsToRef(H,c,y,Z,F){const P=Z.m;return F._x=H*P[0]+c*P[4]+y*P[8],F._y=H*P[1]+c*P[5]+y*P[9],F._z=H*P[2]+c*P[6]+y*P[10],F._isDirty=!0,F}static CatmullRom(H,c,y,Z,F){const P=F*F,S=F*P,n=.5*(2*c._x+(-H._x+y._x)*F+(2*H._x-5*c._x+4*y._x-Z._x)*P+(-H._x+3*c._x-3*y._x+Z._x)*S),O=.5*(2*c._y+(-H._y+y._y)*F+(2*H._y-5*c._y+4*y._y-Z._y)*P+(-H._y+3*c._y-3*y._y+Z._y)*S),a=.5*(2*c._z+(-H._z+y._z)*F+(2*H._z-5*c._z+4*y._z-Z._z)*P+(-H._z+3*c._z-3*y._z+Z._z)*S);return new C(n,O,a)}static Clamp(H,c,y){const Z=new C;return C.ClampToRef(H,c,y,Z),Z}static ClampToRef(H,c,y,Z){let F=H._x;F=F>y._x?y._x:F,F=F<c._x?c._x:F;let P=H._y;P=P>y._y?y._y:P,P=P<c._y?c._y:P;let S=H._z;return S=S>y._z?y._z:S,S=S<c._z?c._z:S,Z.be(F,P,S),Z}static CheckExtends(H,c,y){c.minimizeInPlace(H),y.maximizeInPlace(H)}static Hermite(H,c,y,Z,F){const P=F*F,S=F*P,n=2*S-3*P+1,O=-2*S+3*P,a=S-2*P+F,i=S-P,g=H._x*n+y._x*O+c._x*a+Z._x*i,v=H._y*n+y._y*O+c._y*a+Z._y*i,m=H._z*n+y._z*O+c._z*a+Z._z*i;return new C(g,v,m)}static Hermite1stDerivative(H,c,y,Z,F){const P=new C;return this.Hermite1stDerivativeToRef(H,c,y,Z,F,P),P}static Hermite1stDerivativeToRef(H,c,y,Z,F,P){const S=F*F;return P._x=6*(S-F)*H._x+(3*S-4*F+1)*c._x+6*(-S+F)*y._x+(3*S-2*F)*Z._x,P._y=6*(S-F)*H._y+(3*S-4*F+1)*c._y+6*(-S+F)*y._y+(3*S-2*F)*Z._y,P._z=6*(S-F)*H._z+(3*S-4*F+1)*c._z+6*(-S+F)*y._z+(3*S-2*F)*Z._z,P._isDirty=!0,P}static Lerp(H,c,y){const Z=new C(0,0,0);return C.LerpToRef(H,c,y,Z),Z}static LerpToRef(H,c,y,Z){return Z._x=H._x+(c._x-H._x)*y,Z._y=H._y+(c._y-H._y)*y,Z._z=H._z+(c._z-H._z)*y,Z._isDirty=!0,Z}static Dot(H,c){return H._x*c._x+H._y*c._y+H._z*c._z}dot(H){return this._x*H._x+this._y*H._y+this._z*H._z}static Cross(H,c){const y=new C;return C.CrossToRef(H,c,y),y}static CrossToRef(H,c,y){const Z=H._y*c._z-H._z*c._y,F=H._z*c._x-H._x*c._z,P=H._x*c._y-H._y*c._x;return y.be(Z,F,P),y}static Normalize(H){const c=C.Zero();return C.NormalizeToRef(H,c),c}static NormalizeToRef(H,c){return H.normalizeToRef(c),c}static Project(H,c,y,Z){const F=new C;return C.ProjectToRef(H,c,y,Z,F),F}static ProjectToRef(H,c,y,Z,F){var P;const S=Z.width,O=Z.height,a=Z.x,i=Z.y,g=z.Matrix[1],v=null===(P=n.b.LastCreatedEngine)||void 0===P?void 0:P.isNDCHalfZRange,V=v?1:.5,h=v?0:.5;m.FromValuesToRef(S/2,0,0,0,0,-O/2,0,0,0,0,V,0,a+S/2,O/2+i,h,1,g);const Q=z.Matrix[0];return c.multiplyToRef(y,Q),Q.multiplyToRef(g,Q),C.TransformCoordinatesToRef(H,Q,F),F}static Reflect(H,c){return this.ReflectToRef(H,c,new C)}static ReflectToRef(H,c,y){const Z=V.o[0];return Z.p(c).scaleInPlace(2*C.Dot(H,c)),y.p(H).pi(Z)}static _UnprojectFromInvertedMatrixToRef(H,c,y){C.TransformCoordinatesToRef(H,c,y);const Z=c.m,F=H._x*Z[3]+H._y*Z[7]+H._z*Z[11]+Z[15];return(0,O.D)(F,1)&&y.scaleInPlace(1/F),y}static UnprojectFromTransform(H,c,y,Z,F){return this.Unproject(H,c,y,Z,F,m.IdentityReadOnly)}static Unproject(H,c,y,Z,F,P){const S=new C;return C.UnprojectToRef(H,c,y,Z,F,P,S),S}static UnprojectToRef(H,c,y,Z,F,P,S){return C.UnprojectFloatsToRef(H._x,H._y,H._z,c,y,Z,F,P,S),S}static UnprojectFloatsToRef(H,c,y,Z,F,P,S,O,a){var i;const g=z.Matrix[0];P.multiplyToRef(S,g),g.multiplyToRef(O,g),g.invert();const v=z.o[0];return v.x=H/Z*2-1,v.y=-(c/F*2-1),null!==(i=n.b.LastCreatedEngine)&&void 0!==i&&i.isNDCHalfZRange?v.z=y:v.z=2*y-1,C._UnprojectFromInvertedMatrixToRef(v,g,a),a}static Minimize(H,c){const y=new C;return y.p(H),y.minimizeInPlace(c),y}static Maximize(H,c){const y=new C;return y.p(H),y.maximizeInPlace(c),y}static Distance(H,c){return Math.sqrt(C.DistanceSquared(H,c))}static DistanceSquared(H,c){const y=H._x-c._x,Z=H._y-c._y,F=H._z-c._z;return y*y+Z*Z+F*F}static ProjectOnTriangleToRef(H,c,y,F,P){const S=z.o[0],n=z.o[1],a=z.o[2],i=z.o[3],g=z.o[4];y.subtractToRef(c,S),F.subtractToRef(c,n),F.subtractToRef(y,a);const v=S.length(),m=n.length(),V=a.length();if(v<Z.e||m<Z.e||V<Z.e)return P.p(c),C.Distance(H,c);H.subtractToRef(c,g),C.CrossToRef(S,n,i);const h=i.length();if(h<Z.e)return P.p(c),C.Distance(H,c);i.normalizeFromLength(h);let Q=g.length();if(Q<Z.e)return P.p(c),0;g.normalizeFromLength(Q);const D=C.Dot(i,g),f=z.o[5],J=z.o[6];f.p(i).scaleInPlace(-Q*D),J.p(H).addInPlace(f);const l=z.o[4],d=z.o[5],K=z.o[7],T=z.o[8];l.p(S).scaleInPlace(1/v),T.p(n).scaleInPlace(1/m),l.addInPlace(T).scaleInPlace(-1),d.p(S).scaleInPlace(-1/v),T.p(a).scaleInPlace(1/V),d.addInPlace(T).scaleInPlace(-1),K.p(a).scaleInPlace(-1/V),T.p(n).scaleInPlace(-1/m),K.addInPlace(T).scaleInPlace(-1);const u=z.o[9];let E;u.p(J).pi(c),C.CrossToRef(l,u,T),E=C.Dot(T,i);const U=E;u.p(J).pi(y),C.CrossToRef(d,u,T),E=C.Dot(T,i);const G=E;u.p(J).pi(F),C.CrossToRef(K,u,T),E=C.Dot(T,i);const p=E,t=z.o[10];let o,s;U>0&&G<0?(t.p(S),o=c,s=y):G>0&&p<0?(t.p(a),o=y,s=F):(t.p(n).scaleInPlace(-1),o=F,s=c);const q=z.o[9],I=z.o[4];o.subtractToRef(J,T),s.subtractToRef(J,q),C.CrossToRef(T,q,I);if(!(C.Dot(I,i)<0))return P.p(J),Math.abs(Q*D);const j=z.o[5];C.CrossToRef(t,I,j),j.normalize();const k=z.o[9];k.p(o).pi(J);const W=k.length();if(W<Z.e)return P.p(o),C.Distance(H,o);k.normalizeFromLength(W);const M=C.Dot(j,k),x=z.o[7];x.p(J).addInPlace(j.scaleInPlace(W*M)),T.p(x).pi(o),Q=t.length(),t.normalizeFromLength(Q);let R=C.Dot(T,t)/Math.max(Q,Z.e);return R=(0,O.e)(R,0,1),x.p(o).addInPlace(t.scaleInPlace(R*Q)),P.p(x),C.Distance(H,x)}static Center(H,c){return C.CenterToRef(H,c,C.Zero())}static CenterToRef(H,c,y){return y.be((H._x+c._x)/2,(H._y+c._y)/2,(H._z+c._z)/2)}static RotationFromAxis(H,c,y){const Z=new C;return C.RotationFromAxisToRef(H,c,y,Z),Z}static RotationFromAxisToRef(H,c,y,Z){const F=z.Quaternion[0];return v.RotationQuaternionFromAxisToRef(H,c,y,F),F.toEulerAnglesToRef(Z),Z}}C._UpReadOnly=C.Up(),C._DownReadOnly=C.Down(),C._LeftHandedForwardReadOnly=C.Forward(!1),C._RightHandedForwardReadOnly=C.Forward(!0),C._LeftHandedBackwardReadOnly=C.Backward(!1),C._RightHandedBackwardReadOnly=C.Backward(!0),C._RightReadOnly=C.Right(),C._LeftReadOnly=C.Left(),C._ZeroReadOnly=C.Zero(),C._OneReadOnly=C.One(),Object.defineProperties(C.prototype,{dimension:{value:[3]},rank:{value:1}});class g{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=H,this.y=c,this.z=y,this.w=Z}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let H=a(this.x);return H=397*H^a(this.y),H=397*H^a(this.z),H=397*H^a(this.w),H}ij(){return[this.x,this.y,this.z,this.w]}toArray(H,c){return void 0===c&&(c=0),H[c]=this.x,H[c+1]=this.y,H[c+2]=this.z,H[c+3]=this.w,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return g.FromArrayToRef(H,c,this),this}addInPlace(H){return this.x+=H.x,this.y+=H.y,this.z+=H.z,this.w+=H.w,this}addInPlaceFromFloats(H,c,y,Z){return this.x+=H,this.y+=c,this.z+=y,this.w+=Z,this}add(H){return new g(this.x+H.x,this.y+H.y,this.z+H.z,this.w+H.w)}addToRef(H,c){return c.x=this.x+H.x,c.y=this.y+H.y,c.z=this.z+H.z,c.w=this.w+H.w,c}pi(H){return this.x-=H.x,this.y-=H.y,this.z-=H.z,this.w-=H.w,this}Rc(H){return new g(this.x-H.x,this.y-H.y,this.z-H.z,this.w-H.w)}subtractToRef(H,c){return c.x=this.x-H.x,c.y=this.y-H.y,c.z=this.z-H.z,c.w=this.w-H.w,c}subtractFromFloats(H,c,y,Z){return new g(this.x-H,this.y-c,this.z-y,this.w-Z)}subtractFromFloatsToRef(H,c,y,Z,F){return F.x=this.x-H,F.y=this.y-c,F.z=this.z-y,F.w=this.w-Z,F}negate(){return new g(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(H){return H.x=-this.x,H.y=-this.y,H.z=-this.z,H.w=-this.w,H}scaleInPlace(H){return this.x*=H,this.y*=H,this.z*=H,this.w*=H,this}scale(H){return new g(this.x*H,this.y*H,this.z*H,this.w*H)}scaleToRef(H,c){return c.x=this.x*H,c.y=this.y*H,c.z=this.z*H,c.w=this.w*H,c}scaleAndAddToRef(H,c){return c.x+=this.x*H,c.y+=this.y*H,c.z+=this.z*H,c.w+=this.w*H,c}equals(H){return H&&this.x===H.x&&this.y===H.y&&this.z===H.z&&this.w===H.w}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.e;return H&&(0,O.D)(this.x,H.x,c)&&(0,O.D)(this.y,H.y,c)&&(0,O.D)(this.z,H.z,c)&&(0,O.D)(this.w,H.w,c)}equalsToFloats(H,c,y,Z){return this.x===H&&this.y===c&&this.z===y&&this.w===Z}multiplyInPlace(H){return this.x*=H.x,this.y*=H.y,this.z*=H.z,this.w*=H.w,this}multiply(H){return new g(this.x*H.x,this.y*H.y,this.z*H.z,this.w*H.w)}multiplyToRef(H,c){return c.x=this.x*H.x,c.y=this.y*H.y,c.z=this.z*H.z,c.w=this.w*H.w,c}multiplyByFloats(H,c,y,Z){return new g(this.x*H,this.y*c,this.z*y,this.w*Z)}divide(H){return new g(this.x/H.x,this.y/H.y,this.z/H.z,this.w/H.w)}divideToRef(H,c){return c.x=this.x/H.x,c.y=this.y/H.y,c.z=this.z/H.z,c.w=this.w/H.w,c}divideInPlace(H){return this.divideToRef(H,this)}minimizeInPlace(H){return H.x<this.x&&(this.x=H.x),H.y<this.y&&(this.y=H.y),H.z<this.z&&(this.z=H.z),H.w<this.w&&(this.w=H.w),this}maximizeInPlace(H){return H.x>this.x&&(this.x=H.x),H.y>this.y&&(this.y=H.y),H.z>this.z&&(this.z=H.z),H.w>this.w&&(this.w=H.w),this}minimizeInPlaceFromFloats(H,c,y,Z){return this.x=Math.min(H,this.x),this.y=Math.min(c,this.y),this.z=Math.min(y,this.z),this.w=Math.min(Z,this.w),this}maximizeInPlaceFromFloats(H,c,y,Z){return this.x=Math.max(H,this.x),this.y=Math.max(c,this.y),this.z=Math.max(y,this.z),this.w=Math.max(Z,this.w),this}floorToRef(H){return H.x=Math.floor(this.x),H.y=Math.floor(this.y),H.z=Math.floor(this.z),H.w=Math.floor(this.w),H}floor(){return new g(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(H){return H.x=this.x-Math.floor(this.x),H.y=this.y-Math.floor(this.y),H.z=this.z-Math.floor(this.z),H.w=this.w-Math.floor(this.w),H}fract(){return new g(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(H){return 0===H||1===H?this:this.scaleInPlace(1/H)}normalizeToNew(){return this.normalizeToRef(new g)}normalizeToRef(H){const c=this.length();return 0===c||1===c?(H.x=this.x,H.y=this.y,H.z=this.z,H.w=this.w,H):this.scaleToRef(1/c,H)}toVector3(){return new C(this.x,this.y,this.z)}clone(){return new g(this.x,this.y,this.z,this.w)}p(H){return this.x=H.x,this.y=H.y,this.z=H.z,this.w=H.w,this}be(H,c,y,Z){return this.x=H,this.y=c,this.z=y,this.w=Z,this}set(H,c,y,Z){return this.be(H,c,y,Z)}ae(H){return this.x=this.y=this.z=this.w=H,this}dot(H){return this.x*H.x+this.y*H.y+this.z*H.z+this.w*H.w}static Tg(H,c){return c||(c=0),new g(H[c],H[c+1],H[c+2],H[c+3])}static FromArrayToRef(H,c,y){return y.x=H[c],y.y=H[c+1],y.z=H[c+2],y.w=H[c+3],y}static FromFloatArrayToRef(H,c,y){return g.FromArrayToRef(H,c,y),y}static FromFloatsToRef(H,c,y,Z,F){return F.x=H,F.y=c,F.z=y,F.w=Z,F}static Zero(){return new g(0,0,0,0)}static One(){return new g(1,1,1,1)}static Random(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new g((0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c))}static RandomToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.x=(0,O.x)(H,c),y.y=(0,O.x)(H,c),y.z=(0,O.x)(H,c),y.w=(0,O.x)(H,c),y}static Clamp(H,c,y){return g.ClampToRef(H,c,y,new g)}static ClampToRef(H,c,y,Z){return Z.x=(0,O.e)(H.x,c.x,y.x),Z.y=(0,O.e)(H.y,c.y,y.y),Z.z=(0,O.e)(H.z,c.z,y.z),Z.w=(0,O.e)(H.w,c.w,y.w),Z}static CheckExtends(H,c,y){c.minimizeInPlace(H),y.maximizeInPlace(H)}static get ZeroReadOnly(){return g._ZeroReadOnly}static Normalize(H){return g.NormalizeToRef(H,new g)}static NormalizeToRef(H,c){return H.normalizeToRef(c),c}static Minimize(H,c){const y=new g;return y.p(H),y.minimizeInPlace(c),y}static Maximize(H,c){const y=new g;return y.p(H),y.maximizeInPlace(c),y}static Distance(H,c){return Math.sqrt(g.DistanceSquared(H,c))}static DistanceSquared(H,c){const y=H.x-c.x,Z=H.y-c.y,F=H.z-c.z,P=H.w-c.w;return y*y+Z*Z+F*F+P*P}static Center(H,c){return g.CenterToRef(H,c,new g)}static CenterToRef(H,c,y){return y.x=(H.x+c.x)/2,y.y=(H.y+c.y)/2,y.z=(H.z+c.z)/2,y.w=(H.w+c.w)/2,y}static TransformCoordinates(H,c){return g.TransformCoordinatesToRef(H,c,new g)}static TransformCoordinatesToRef(H,c,y){return g.TransformCoordinatesFromFloatsToRef(H._x,H._y,H._z,c,y),y}static TransformCoordinatesFromFloatsToRef(H,c,y,Z,F){const P=Z.m,S=H*P[0]+c*P[4]+y*P[8]+P[12],n=H*P[1]+c*P[5]+y*P[9]+P[13],O=H*P[2]+c*P[6]+y*P[10]+P[14],a=H*P[3]+c*P[7]+y*P[11]+P[15];return F.x=S,F.y=n,F.z=O,F.w=a,F}static TransformNormal(H,c){return g.TransformNormalToRef(H,c,new g)}static TransformNormalToRef(H,c,y){const Z=c.m,F=H.x*Z[0]+H.y*Z[4]+H.z*Z[8],P=H.x*Z[1]+H.y*Z[5]+H.z*Z[9],S=H.x*Z[2]+H.y*Z[6]+H.z*Z[10];return y.x=F,y.y=P,y.z=S,y.w=H.w,y}static TransformNormalFromFloatsToRef(H,c,y,Z,F,P){const S=F.m;return P.x=H*S[0]+c*S[4]+y*S[8],P.y=H*S[1]+c*S[5]+y*S[9],P.z=H*S[2]+c*S[6]+y*S[10],P.w=Z,P}static FromVector3(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new g(H._x,H._y,H._z,c)}static Dot(H,c){return H.x*c.x+H.y*c.y+H.z*c.z+H.w*c.w}}g._ZeroReadOnly=g.Zero(),Object.defineProperties(g.prototype,{dimension:{value:[4]},rank:{value:1}});class v{get x(){return this._x}set x(H){this._x=H,this._isDirty=!0}get y(){return this._y}set y(H){this._y=H,this._isDirty=!0}get z(){return this._z}set z(H){this._z=H,this._isDirty=!0}get w(){return this._w}set w(H){this._w=H,this._isDirty=!0}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=H,this._y=c,this._z=y,this._w=Z}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let H=a(this._x);return H=397*H^a(this._y),H=397*H^a(this._z),H=397*H^a(this._w),H}ij(){return[this._x,this._y,this._z,this._w]}toArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H[c]=this._x,H[c+1]=this._y,H[c+2]=this._z,H[c+3]=this._w,this}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v.FromArrayToRef(H,c,this)}equals(H){return H&&this._x===H._x&&this._y===H._y&&this._z===H._z&&this._w===H._w}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.e;return H&&(0,O.D)(this._x,H._x,c)&&(0,O.D)(this._y,H._y,c)&&(0,O.D)(this._z,H._z,c)&&(0,O.D)(this._w,H._w,c)}clone(){return new v(this._x,this._y,this._z,this._w)}p(H){return this._x=H._x,this._y=H._y,this._z=H._z,this._w=H._w,this._isDirty=!0,this}be(H,c,y,Z){return this._x=H,this._y=c,this._z=y,this._w=Z,this._isDirty=!0,this}set(H,c,y,Z){return this.be(H,c,y,Z)}ae(H){return this.be(H,H,H,H)}add(H){return new v(this._x+H._x,this._y+H._y,this._z+H._z,this._w+H._w)}addInPlace(H){return this._x+=H._x,this._y+=H._y,this._z+=H._z,this._w+=H._w,this._isDirty=!0,this}addToRef(H,c){return c._x=this._x+H._x,c._y=this._y+H._y,c._z=this._z+H._z,c._w=this._w+H._w,c._isDirty=!0,c}addInPlaceFromFloats(H,c,y,Z){return this._x+=H,this._y+=c,this._z+=y,this._w+=Z,this._isDirty=!0,this}subtractToRef(H,c){return c._x=this._x-H._x,c._y=this._y-H._y,c._z=this._z-H._z,c._w=this._w-H._w,c._isDirty=!0,c}subtractFromFloats(H,c,y,Z){return this.subtractFromFloatsToRef(H,c,y,Z,new v)}subtractFromFloatsToRef(H,c,y,Z,F){return F._x=this._x-H,F._y=this._y-c,F._z=this._z-y,F._w=this._w-Z,F._isDirty=!0,F}Rc(H){return new v(this._x-H._x,this._y-H._y,this._z-H._z,this._w-H._w)}pi(H){return this._x-=H._x,this._y-=H._y,this._z-=H._z,this._w-=H._w,this._isDirty=!0,this}scale(H){return new v(this._x*H,this._y*H,this._z*H,this._w*H)}scaleToRef(H,c){return c._x=this._x*H,c._y=this._y*H,c._z=this._z*H,c._w=this._w*H,c._isDirty=!0,c}scaleInPlace(H){return this._x*=H,this._y*=H,this._z*=H,this._w*=H,this._isDirty=!0,this}scaleAndAddToRef(H,c){return c._x+=this._x*H,c._y+=this._y*H,c._z+=this._z*H,c._w+=this._w*H,c._isDirty=!0,c}multiply(H){const c=new v(0,0,0,1);return this.multiplyToRef(H,c),c}multiplyToRef(H,c){const y=this._x*H._w+this._y*H._z-this._z*H._y+this._w*H._x,Z=-this._x*H._z+this._y*H._w+this._z*H._x+this._w*H._y,F=this._x*H._y-this._y*H._x+this._z*H._w+this._w*H._z,P=-this._x*H._x-this._y*H._y-this._z*H._z+this._w*H._w;return c.be(y,Z,F,P),c}multiplyInPlace(H){return this.multiplyToRef(H,this)}multiplyByFloats(H,c,y,Z){return this._x*=H,this._y*=c,this._z*=y,this._w*=Z,this._isDirty=!0,this}divide(H){throw new ReferenceError("Can not divide a quaternion")}divideToRef(H,c){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(H){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new v)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(H){return H._x=-this._x,H._y=-this._y,H._z=-this._z,H._w=-this._w,H._isDirty=!0,H}equalsToFloats(H,c,y,Z){return this._x===H&&this._y===c&&this._z===y&&this._w===Z}floorToRef(H){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(H){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(H){return H.be(-this._x,-this._y,-this._z,this._w),H}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new v(-this._x,-this._y,-this._z,this._w)}invert(){const H=this.conjugate(),c=this.lengthSquared();return 0==c||1==c||H.scaleInPlace(1/c),H}invertInPlace(){this.conjugateInPlace();const H=this.lengthSquared();return 0==H||1==H||this.scaleInPlace(1/H),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(H){return 0===H||1===H?this:this.scaleInPlace(1/H)}normalizeToNew(){const H=new v(0,0,0,1);return this.normalizeToRef(H),H}normalizeToRef(H){const c=this.length();return 0===c||1===c?H.be(this._x,this._y,this._z,this._w):this.scaleToRef(1/c,H)}toEulerAngles(){const H=C.Zero();return this.toEulerAnglesToRef(H),H}toEulerAnglesToRef(H){const c=this._z,y=this._x,Z=this._y,F=this._w,P=Z*c-y*F,S=.4999999;if(P<-S)H._y=2*Math.atan2(Z,F),H._x=Math.PI/2,H._z=0,H._isDirty=!0;else if(P>S)H._y=2*Math.atan2(Z,F),H._x=-Math.PI/2,H._z=0,H._isDirty=!0;else{const S=F*F,n=c*c,O=y*y,a=Z*Z;H._z=Math.atan2(2*(y*Z+c*F),-n-O+a+S),H._x=Math.asin(-2*P),H._y=Math.atan2(2*(c*y+Z*F),n-O-a+S),H._isDirty=!0}return H}toAlphaBetaGammaToRef(H){const c=this._z,y=this._x,Z=this._y,F=this._w,P=Math.sqrt(y*y+Z*Z),S=Math.sqrt(c*c+F*F),n=2*Math.atan2(P,S),O=2*Math.atan2(c,F),a=2*Math.atan2(Z,y),i=(O+a)/2,C=(O-a)/2;return H.set(C,n,i),H}toRotationMatrix(H){return m.FromQuaternionToRef(this,H),H}fromRotationMatrix(H){return v.FromRotationMatrixToRef(H,this),this}dot(H){return this._x*H._x+this._y*H._y+this._z*H._z+this._w*H._w}static FromRotationMatrix(H){const c=new v;return v.FromRotationMatrixToRef(H,c),c}static FromRotationMatrixToRef(H,c){const y=H.m,Z=y[0],F=y[4],P=y[8],S=y[1],n=y[5],O=y[9],a=y[2],i=y[6],C=y[10],g=Z+n+C;let v;return g>0?(v=.5/Math.sqrt(g+1),c._w=.25/v,c._x=(i-O)*v,c._y=(P-a)*v,c._z=(S-F)*v,c._isDirty=!0):Z>n&&Z>C?(v=2*Math.sqrt(1+Z-n-C),c._w=(i-O)/v,c._x=.25*v,c._y=(F+S)/v,c._z=(P+a)/v,c._isDirty=!0):n>C?(v=2*Math.sqrt(1+n-Z-C),c._w=(P-a)/v,c._x=(F+S)/v,c._y=.25*v,c._z=(O+i)/v,c._isDirty=!0):(v=2*Math.sqrt(1+C-Z-n),c._w=(S-F)/v,c._x=(P+a)/v,c._y=(O+i)/v,c._z=.25*v,c._isDirty=!0),c}static Dot(H,c){return H._x*c._x+H._y*c._y+H._z*c._z+H._w*c._w}static AreClose(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const Z=v.Dot(H,c);return 1-Z*Z<=y}static SmoothToRef(H,c,y,Z,F){let P=0===Z?1:y/Z;return P=(0,O.e)(P,0,1),v.SlerpToRef(H,c,P,F),F}static Zero(){return new v(0,0,0,0)}static Inverse(H){return new v(-H._x,-H._y,-H._z,H._w)}static InverseToRef(H,c){return c.set(-H._x,-H._y,-H._z,H._w),c}static Identity(){return new v(0,0,0,1)}static IsIdentity(H){return H&&0===H._x&&0===H._y&&0===H._z&&1===H._w}static RotationAxis(H,c){return v.RotationAxisToRef(H,c,new v)}static RotationAxisToRef(H,c,y){y._w=Math.cos(c/2);const Z=Math.sin(c/2)/H.length();return y._x=H._x*Z,y._y=H._y*Z,y._z=H._z*Z,y._isDirty=!0,y}static Tg(H,c){return c||(c=0),new v(H[c],H[c+1],H[c+2],H[c+3])}static FromArrayToRef(H,c,y){return y._x=H[c],y._y=H[c+1],y._z=H[c+2],y._w=H[c+3],y._isDirty=!0,y}static FromFloatsToRef(H,c,y,Z,F){return F.be(H,c,y,Z),F}static FromEulerAngles(H,c,y){const Z=new v;return v.RotationYawPitchRollToRef(c,H,y,Z),Z}static FromEulerAnglesToRef(H,c,y,Z){return v.RotationYawPitchRollToRef(c,H,y,Z),Z}static FromEulerVector(H){const c=new v;return v.RotationYawPitchRollToRef(H._y,H._x,H._z,c),c}static FromEulerVectorToRef(H,c){return v.RotationYawPitchRollToRef(H._y,H._x,H._z,c),c}static FromUnitVectorsToRef(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.e;const P=C.Dot(H,c)+1;return P<F?Math.abs(H.x)>Math.abs(H.z)?y.set(-H.y,H.x,0,0):y.set(0,-H.z,H.y,0):(C.CrossToRef(H,c,V.o[0]),y.set(V.o[0].x,V.o[0].y,V.o[0].z,P)),y.normalize()}static RotationYawPitchRoll(H,c,y){const Z=new v;return v.RotationYawPitchRollToRef(H,c,y,Z),Z}static RotationYawPitchRollToRef(H,c,y,Z){const F=.5*y,P=.5*c,S=.5*H,n=Math.sin(F),O=Math.cos(F),a=Math.sin(P),i=Math.cos(P),C=Math.sin(S),g=Math.cos(S);return Z._x=g*a*O+C*i*n,Z._y=C*i*O-g*a*n,Z._z=g*i*n-C*a*O,Z._w=g*i*O+C*a*n,Z._isDirty=!0,Z}static RotationAlphaBetaGamma(H,c,y){const Z=new v;return v.RotationAlphaBetaGammaToRef(H,c,y,Z),Z}static RotationAlphaBetaGammaToRef(H,c,y,Z){const F=.5*(y+H),P=.5*(y-H),S=.5*c;return Z._x=Math.cos(P)*Math.sin(S),Z._y=Math.sin(P)*Math.sin(S),Z._z=Math.sin(F)*Math.cos(S),Z._w=Math.cos(F)*Math.cos(S),Z._isDirty=!0,Z}static RotationQuaternionFromAxis(H,c,y){const Z=new v(0,0,0,0);return v.RotationQuaternionFromAxisToRef(H,c,y,Z),Z}static RotationQuaternionFromAxisToRef(H,c,y,Z){const F=z.Matrix[0];return H=H.normalizeToRef(z.o[0]),c=c.normalizeToRef(z.o[1]),y=y.normalizeToRef(z.o[2]),m.FromXYZAxesToRef(H,c,y,F),v.FromRotationMatrixToRef(F,Z),Z}static FromLookDirectionLH(H,c){const y=new v;return v.FromLookDirectionLHToRef(H,c,y),y}static FromLookDirectionLHToRef(H,c,y){const Z=z.Matrix[0];return m.LookDirectionLHToRef(H,c,Z),v.FromRotationMatrixToRef(Z,y),y}static FromLookDirectionRH(H,c){const y=new v;return v.FromLookDirectionRHToRef(H,c,y),y}static FromLookDirectionRHToRef(H,c,y){const Z=z.Matrix[0];return m.LookDirectionRHToRef(H,c,Z),v.FromRotationMatrixToRef(Z,y)}static Slerp(H,c,y){const Z=v.Identity();return v.SlerpToRef(H,c,y,Z),Z}static SlerpToRef(H,c,y,Z){let F,P,S=H._x*c._x+H._y*c._y+H._z*c._z+H._w*c._w,n=!1;if(S<0&&(n=!0,S=-S),S>.999999)P=1-y,F=n?-y:y;else{const H=Math.acos(S),c=1/Math.sin(H);P=Math.sin((1-y)*H)*c,F=n?-Math.sin(y*H)*c:Math.sin(y*H)*c}return Z._x=P*H._x+F*c._x,Z._y=P*H._y+F*c._y,Z._z=P*H._z+F*c._z,Z._w=P*H._w+F*c._w,Z._isDirty=!0,Z}static Hermite(H,c,y,Z,F){const P=F*F,S=F*P,n=2*S-3*P+1,O=-2*S+3*P,a=S-2*P+F,i=S-P,C=H._x*n+y._x*O+c._x*a+Z._x*i,g=H._y*n+y._y*O+c._y*a+Z._y*i,m=H._z*n+y._z*O+c._z*a+Z._z*i,z=H._w*n+y._w*O+c._w*a+Z._w*i;return new v(C,g,m,z)}static Hermite1stDerivative(H,c,y,Z,F){const P=new v;return this.Hermite1stDerivativeToRef(H,c,y,Z,F,P),P}static Hermite1stDerivativeToRef(H,c,y,Z,F,P){const S=F*F;return P._x=6*(S-F)*H._x+(3*S-4*F+1)*c._x+6*(-S+F)*y._x+(3*S-2*F)*Z._x,P._y=6*(S-F)*H._y+(3*S-4*F+1)*c._y+6*(-S+F)*y._y+(3*S-2*F)*Z._y,P._z=6*(S-F)*H._z+(3*S-4*F+1)*c._z+6*(-S+F)*y._z+(3*S-2*F)*Z._z,P._w=6*(S-F)*H._w+(3*S-4*F+1)*c._w+6*(-S+F)*y._w+(3*S-2*F)*Z._w,P._isDirty=!0,P}static Normalize(H){const c=v.Zero();return v.NormalizeToRef(H,c),c}static NormalizeToRef(H,c){return H.normalizeToRef(c),c}static Clamp(H,c,y){const Z=new v;return v.ClampToRef(H,c,y,Z),Z}static ClampToRef(H,c,y,Z){return Z.be((0,O.e)(H.x,c.x,y.x),(0,O.e)(H.y,c.y,y.y),(0,O.e)(H.z,c.z,y.z),(0,O.e)(H.w,c.w,y.w))}static Random(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new v((0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c))}static RandomToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).be((0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c),(0,O.x)(H,c))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(H,c){return Math.sqrt(v.DistanceSquared(H,c))}static DistanceSquared(H,c){const y=H.x-c.x,Z=H.y-c.y,F=H.z-c.z,P=H.w-c.w;return y*y+Z*Z+F*F+P*P}static Center(H,c){return v.CenterToRef(H,c,v.Zero())}static CenterToRef(H,c,y){return y.be((H.x+c.x)/2,(H.y+c.y)/2,(H.z+c.z)/2,(H.w+c.w)/2)}}Object.defineProperties(v.prototype,{dimension:{value:[4]},rank:{value:1}});class m{static get Use64Bits(){return S.c.MatrixUse64Bits}get m(){return this.Pj}markAsUpdated(){this.updateFlag=m._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=H,this._isIdentity3x2=H||y,this._isIdentityDirty=!this._isIdentity&&c,this._isIdentity3x2Dirty=!this._isIdentity3x2&&Z}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,S.c.MatrixTrackPrecisionChange&&S.c.MatrixTrackedMatrices.push(this),this.Pj=new S.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const H=this.Pj;this._isIdentity=1===H[0]&&0===H[1]&&0===H[2]&&0===H[3]&&0===H[4]&&1===H[5]&&0===H[6]&&0===H[7]&&0===H[8]&&0===H[9]&&1===H[10]&&0===H[11]&&0===H[12]&&0===H[13]&&0===H[14]&&1===H[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Pj[0]||1!==this.Pj[5]||1!==this.Pj[15]||0!==this.Pj[1]||0!==this.Pj[2]||0!==this.Pj[3]||0!==this.Pj[4]||0!==this.Pj[6]||0!==this.Pj[7]||0!==this.Pj[8]||0!==this.Pj[9]||0!==this.Pj[10]||0!==this.Pj[11]||0!==this.Pj[12]||0!==this.Pj[13]||0!==this.Pj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const H=this.Pj,c=H[0],y=H[1],Z=H[2],F=H[3],P=H[4],S=H[5],n=H[6],O=H[7],a=H[8],i=H[9],C=H[10],g=H[11],v=H[12],m=H[13],z=H[14],V=H[15],h=C*V-z*g,Q=i*V-m*g,D=i*z-m*C,f=a*V-v*g,J=a*z-C*v,l=a*m-v*i;return c*+(S*h-n*Q+O*D)+y*-(P*h-n*f+O*J)+Z*+(P*Q-S*f+O*l)+F*-(P*D-S*J+n*l)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!H)return this.Pj;const y=this.Pj;for(let Z=0;Z<16;Z++)H[c+Z]=y[Z];return this}ij(){return this.Pj}Sc(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return m.FromArrayToRef(H,c,this)}be(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];return m.FromArrayToRef(c,0,this)}set(){const H=this.Pj;for(let c=0;c<16;c++)H[c]=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}ae(H){const c=this.Pj;for(let y=0;y<16;y++)c[y]=H;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return m.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(H){const c=new m;return this.addToRef(H,c),c}addToRef(H,c){const y=this.Pj,Z=c.Pj,F=H.m;for(let P=0;P<16;P++)Z[P]=y[P]+F[P];return c.markAsUpdated(),c}addToSelf(H){const c=this.Pj,y=H.m;return c[0]+=y[0],c[1]+=y[1],c[2]+=y[2],c[3]+=y[3],c[4]+=y[4],c[5]+=y[5],c[6]+=y[6],c[7]+=y[7],c[8]+=y[8],c[9]+=y[9],c[10]+=y[10],c[11]+=y[11],c[12]+=y[12],c[13]+=y[13],c[14]+=y[14],c[15]+=y[15],this.markAsUpdated(),this}addInPlace(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]+=y[Z];return this.markAsUpdated(),this}addInPlaceFromFloats(){const H=this.Pj;for(let c=0;c<16;c++)H[c]+=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}Rc(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]-=y[Z];return this.markAsUpdated(),this}subtractToRef(H,c){const y=this.Pj,Z=H.m,F=c.Pj;for(let P=0;P<16;P++)F[P]=y[P]-Z[P];return c.markAsUpdated(),c}pi(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]-=y[Z];return this.markAsUpdated(),this}subtractFromFloats(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];return this.subtractFromFloatsToRef(...c,new m)}subtractFromFloatsToRef(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];const Z=c.pop(),F=this.Pj,P=Z.Pj,S=c;for(let n=0;n<16;n++)P[n]=F[n]-S[n];return Z.markAsUpdated(),Z}invertToRef(H){if(!0===this._isIdentity)return m.IdentityToRef(H),H;const c=this.Pj,y=c[0],Z=c[1],F=c[2],P=c[3],S=c[4],n=c[5],O=c[6],a=c[7],i=c[8],C=c[9],g=c[10],v=c[11],z=c[12],V=c[13],h=c[14],Q=c[15],D=g*Q-h*v,f=C*Q-V*v,J=C*h-V*g,l=i*Q-z*v,d=i*h-g*z,K=i*V-z*C,T=+(n*D-O*f+a*J),u=-(S*D-O*l+a*d),E=+(S*f-n*l+a*K),U=-(S*J-n*d+O*K),G=y*T+Z*u+F*E+P*U;if(0===G)return H.p(this),H;const p=1/G,t=O*Q-h*a,o=n*Q-V*a,s=n*h-V*O,q=S*Q-z*a,I=S*h-z*O,j=S*V-z*n,k=O*v-g*a,W=n*v-C*a,M=n*g-C*O,x=S*v-i*a,R=S*g-i*O,A=S*C-i*n,e=-(Z*D-F*f+P*J),r=+(y*D-F*l+P*d),N=-(y*f-Z*l+P*K),w=+(y*J-Z*d+F*K),L=+(Z*t-F*o+P*s),b=-(y*t-F*q+P*I),X=+(y*o-Z*q+P*j),B=-(y*s-Z*I+F*j),Y=-(Z*k-F*W+P*M),HH=+(y*k-F*x+P*R),cH=-(y*W-Z*x+P*A),yH=+(y*M-Z*R+F*A);return m.FromValuesToRef(T*p,e*p,L*p,Y*p,u*p,r*p,b*p,HH*p,E*p,N*p,X*p,cH*p,U*p,w*p,B*p,yH*p,H),H}addAtIndex(H,c){return this.Pj[H]+=c,this.markAsUpdated(),this}multiplyAtIndex(H,c){return this.Pj[H]*=c,this.markAsUpdated(),this}setTranslationFromFloats(H,c,y){return this.Pj[12]=H,this.Pj[13]=c,this.Pj[14]=y,this.markAsUpdated(),this}addTranslationFromFloats(H,c,y){return this.Pj[12]+=H,this.Pj[13]+=c,this.Pj[14]+=y,this.markAsUpdated(),this}setTranslation(H){return this.setTranslationFromFloats(H._x,H._y,H._z)}getTranslation(){return new C(this.Pj[12],this.Pj[13],this.Pj[14])}getTranslationToRef(H){return H.x=this.Pj[12],H.y=this.Pj[13],H.z=this.Pj[14],H}removeRotationAndScaling(){const H=this.m;return m.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,H[12],H[13],H[14],H[15],this),this._updateIdentityStatus(0===H[12]&&0===H[13]&&0===H[14]&&1===H[15]),this}p(H){H.copyToArray(this.Pj);const c=H;return this.updateFlag=c.updateFlag,this._updateIdentityStatus(c._isIdentity,c._isIdentityDirty,c._isIdentity3x2,c._isIdentity3x2Dirty),this}copyToArray(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.Pj;return H[c]=y[0],H[c+1]=y[1],H[c+2]=y[2],H[c+3]=y[3],H[c+4]=y[4],H[c+5]=y[5],H[c+6]=y[6],H[c+7]=y[7],H[c+8]=y[8],H[c+9]=y[9],H[c+10]=y[10],H[c+11]=y[11],H[c+12]=y[12],H[c+13]=y[13],H[c+14]=y[14],H[c+15]=y[15],this}multiply(H){const c=new m;return this.multiplyToRef(H,c),c}multiplyInPlace(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]*=y[Z];return this.markAsUpdated(),this}multiplyByFloats(){const H=this.Pj;for(let c=0;c<16;c++)H[c]*=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];const Z=c.pop(),F=this.Pj,P=Z.Pj,S=c;for(let n=0;n<16;n++)P[n]=F[n]*S[n];return Z.markAsUpdated(),Z}multiplyToRef(H,c){return this._isIdentity?(c.p(H),c):H._isIdentity?(c.p(this),c):(this.multiplyToArray(H,c.Pj,0),c.markAsUpdated(),c)}multiplyToArray(H,c,y){const Z=this.Pj,F=H.m,P=Z[0],S=Z[1],n=Z[2],O=Z[3],a=Z[4],i=Z[5],C=Z[6],g=Z[7],v=Z[8],m=Z[9],z=Z[10],V=Z[11],h=Z[12],Q=Z[13],D=Z[14],f=Z[15],J=F[0],l=F[1],d=F[2],K=F[3],T=F[4],u=F[5],E=F[6],U=F[7],G=F[8],p=F[9],t=F[10],o=F[11],s=F[12],q=F[13],I=F[14],j=F[15];return c[y]=P*J+S*T+n*G+O*s,c[y+1]=P*l+S*u+n*p+O*q,c[y+2]=P*d+S*E+n*t+O*I,c[y+3]=P*K+S*U+n*o+O*j,c[y+4]=a*J+i*T+C*G+g*s,c[y+5]=a*l+i*u+C*p+g*q,c[y+6]=a*d+i*E+C*t+g*I,c[y+7]=a*K+i*U+C*o+g*j,c[y+8]=v*J+m*T+z*G+V*s,c[y+9]=v*l+m*u+z*p+V*q,c[y+10]=v*d+m*E+z*t+V*I,c[y+11]=v*K+m*U+z*o+V*j,c[y+12]=h*J+Q*T+D*G+f*s,c[y+13]=h*l+Q*u+D*p+f*q,c[y+14]=h*d+Q*E+D*t+f*I,c[y+15]=h*K+Q*U+D*o+f*j,this}divide(H){return this.divideToRef(H,new m)}divideToRef(H,c){const y=this.Pj,Z=H.m,F=c.Pj;for(let P=0;P<16;P++)F[P]=y[P]/Z[P];return c.markAsUpdated(),c}divideInPlace(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]/=y[Z];return this.markAsUpdated(),this}minimizeInPlace(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]=Math.min(c[Z],y[Z]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const H=this.Pj;for(let c=0;c<16;c++)H[c]=Math.min(H[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}maximizeInPlace(H){const c=this.Pj,y=H.m;for(let Z=0;Z<16;Z++)c[Z]=Math.min(c[Z],y[Z]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const H=this.Pj;for(let c=0;c<16;c++)H[c]=Math.min(H[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new m)}negateInPlace(){const H=this.Pj;for(let c=0;c<16;c++)H[c]=-H[c];return this.markAsUpdated(),this}negateToRef(H){const c=this.Pj,y=H.Pj;for(let Z=0;Z<16;Z++)y[Z]=-c[Z];return H.markAsUpdated(),H}equals(H){const c=H;if(!c)return!1;if((this._isIdentity||c._isIdentity)&&!this._isIdentityDirty&&!c._isIdentityDirty)return this._isIdentity&&c._isIdentity;const y=this.m,Z=c.m;return y[0]===Z[0]&&y[1]===Z[1]&&y[2]===Z[2]&&y[3]===Z[3]&&y[4]===Z[4]&&y[5]===Z[5]&&y[6]===Z[6]&&y[7]===Z[7]&&y[8]===Z[8]&&y[9]===Z[9]&&y[10]===Z[10]&&y[11]===Z[11]&&y[12]===Z[12]&&y[13]===Z[13]&&y[14]===Z[14]&&y[15]===Z[15]}equalsWithEpsilon(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.Pj,Z=H.m;for(let F=0;F<16;F++)if(!(0,O.D)(y[F],Z[F],c))return!1;return!0}equalsToFloats(){const H=this.Pj;for(let c=0;c<16;c++)if(H[c]!=(c<0||arguments.length<=c?void 0:arguments[c]))return!1;return!0}floor(){return this.floorToRef(new m)}floorToRef(H){const c=this.Pj,y=H.Pj;for(let Z=0;Z<16;Z++)y[Z]=Math.floor(c[Z]);return H.markAsUpdated(),H}fract(){return this.fractToRef(new m)}fractToRef(H){const c=this.Pj,y=H.Pj;for(let Z=0;Z<16;Z++)y[Z]=c[Z]-Math.floor(c[Z]);return H.markAsUpdated(),H}clone(){const H=new m;return H.p(this),H}getClassName(){return"Matrix"}getHashCode(){let H=a(this.Pj[0]);for(let c=1;c<16;c++)H=397*H^a(this.Pj[c]);return H}decomposeToTransformNode(H){return H.rotationQuaternion=H.rotationQuaternion||new v,this.decompose(H.de,H.rotationQuaternion,H.position)}decompose(H,c,y,Z){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return y&&y.ae(0),H&&H.ae(1),c&&c.be(0,0,0,1),!0;const P=this.Pj;if(y&&y.be(P[12],P[13],P[14]),(H=H||z.o[0]).x=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2]),H.y=Math.sqrt(P[4]*P[4]+P[5]*P[5]+P[6]*P[6]),H.z=Math.sqrt(P[8]*P[8]+P[9]*P[9]+P[10]*P[10]),Z){const c=(F?Z.absoluteScaling.x:Z.de.x)<0?-1:1,y=(F?Z.absoluteScaling.y:Z.de.y)<0?-1:1,P=(F?Z.absoluteScaling.z:Z.de.z)<0?-1:1;H.x*=c,H.y*=y,H.z*=P}else this.determinant()<=0&&(H.y*=-1);if(0===H._x||0===H._y||0===H._z)return c&&c.be(0,0,0,1),!1;if(c){const y=1/H._x,Z=1/H._y,F=1/H._z;m.FromValuesToRef(P[0]*y,P[1]*y,P[2]*y,0,P[4]*Z,P[5]*Z,P[6]*Z,0,P[8]*F,P[9]*F,P[10]*F,0,0,0,0,1,z.Matrix[0]),v.FromRotationMatrixToRef(z.Matrix[0],c)}return!0}getRow(H){if(H<0||H>3)return null;const c=4*H;return new g(this.Pj[c+0],this.Pj[c+1],this.Pj[c+2],this.Pj[c+3])}getRowToRef(H,c){if(H>=0&&H<=3){const y=4*H;c.x=this.Pj[y+0],c.y=this.Pj[y+1],c.z=this.Pj[y+2],c.w=this.Pj[y+3]}return c}setRow(H,c){return this.setRowFromFloats(H,c.x,c.y,c.z,c.w)}transpose(){const H=new m;return m.TransposeToRef(this,H),H}transposeToRef(H){return m.TransposeToRef(this,H),H}setRowFromFloats(H,c,y,Z,F){if(H<0||H>3)return this;const P=4*H;return this.Pj[P+0]=c,this.Pj[P+1]=y,this.Pj[P+2]=Z,this.Pj[P+3]=F,this.markAsUpdated(),this}scale(H){const c=new m;return this.scaleToRef(H,c),c}scaleToRef(H,c){for(let y=0;y<16;y++)c.Pj[y]=this.Pj[y]*H;return c.markAsUpdated(),c}scaleAndAddToRef(H,c){for(let y=0;y<16;y++)c.Pj[y]+=this.Pj[y]*H;return c.markAsUpdated(),c}scaleInPlace(H){const c=this.Pj;for(let y=0;y<16;y++)c[y]*=H;return this.markAsUpdated(),this}toNormalMatrix(H){const c=z.Matrix[0];this.invertToRef(c),c.transposeToRef(H);const y=H.Pj;return m.FromValuesToRef(y[0],y[1],y[2],0,y[4],y[5],y[6],0,y[8],y[9],y[10],0,0,0,0,1,H),H}getRotationMatrix(){const H=new m;return this.getRotationMatrixToRef(H),H}getRotationMatrixToRef(H){const c=z.o[0];if(!this.decompose(c))return m.IdentityToRef(H),H;const y=this.Pj,Z=1/c._x,F=1/c._y,P=1/c._z;return m.FromValuesToRef(y[0]*Z,y[1]*Z,y[2]*Z,0,y[4]*F,y[5]*F,y[6]*F,0,y[8]*P,y[9]*P,y[10]*P,0,0,0,0,1,H),H}toggleModelMatrixHandInPlace(){const H=this.Pj;return H[2]*=-1,H[6]*=-1,H[8]*=-1,H[9]*=-1,H[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const H=this.Pj;return H[8]*=-1,H[9]*=-1,H[10]*=-1,H[11]*=-1,this.markAsUpdated(),this}static Tg(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=new m;return m.FromArrayToRef(H,c,y),y}static FromArrayToRef(H,c,y){for(let Z=0;Z<16;Z++)y.Pj[Z]=H[Z+c];return y.markAsUpdated(),y}static FromFloat32ArrayToRefScaled(H,c,y,Z){return Z.Pj[0]=H[0+c]*y,Z.Pj[1]=H[1+c]*y,Z.Pj[2]=H[2+c]*y,Z.Pj[3]=H[3+c]*y,Z.Pj[4]=H[4+c]*y,Z.Pj[5]=H[5+c]*y,Z.Pj[6]=H[6+c]*y,Z.Pj[7]=H[7+c]*y,Z.Pj[8]=H[8+c]*y,Z.Pj[9]=H[9+c]*y,Z.Pj[10]=H[10+c]*y,Z.Pj[11]=H[11+c]*y,Z.Pj[12]=H[12+c]*y,Z.Pj[13]=H[13+c]*y,Z.Pj[14]=H[14+c]*y,Z.Pj[15]=H[15+c]*y,Z.markAsUpdated(),Z}static get IdentityReadOnly(){return m._IdentityReadOnly}static FromValuesToRef(H,c,y,Z,F,P,S,n,O,a,i,C,g,v,m,z,V){const h=V.Pj;h[0]=H,h[1]=c,h[2]=y,h[3]=Z,h[4]=F,h[5]=P,h[6]=S,h[7]=n,h[8]=O,h[9]=a,h[10]=i,h[11]=C,h[12]=g,h[13]=v,h[14]=m,h[15]=z,V.markAsUpdated()}static FromValues(H,c,y,Z,F,P,S,n,O,a,i,C,g,v,z,V){const h=new m,Q=h.Pj;return Q[0]=H,Q[1]=c,Q[2]=y,Q[3]=Z,Q[4]=F,Q[5]=P,Q[6]=S,Q[7]=n,Q[8]=O,Q[9]=a,Q[10]=i,Q[11]=C,Q[12]=g,Q[13]=v,Q[14]=z,Q[15]=V,h.markAsUpdated(),h}static Compose(H,c,y){const Z=new m;return m.ComposeToRef(H,c,y,Z),Z}static ComposeToRef(H,c,y,Z){const F=Z.Pj,P=c._x,S=c._y,n=c._z,O=c._w,a=P+P,i=S+S,C=n+n,g=P*a,v=P*i,m=P*C,z=S*i,V=S*C,h=n*C,Q=O*a,D=O*i,f=O*C,J=H._x,l=H._y,d=H._z;return F[0]=(1-(z+h))*J,F[1]=(v+f)*J,F[2]=(m-D)*J,F[3]=0,F[4]=(v-f)*l,F[5]=(1-(g+h))*l,F[6]=(V+Q)*l,F[7]=0,F[8]=(m+D)*d,F[9]=(V-Q)*d,F[10]=(1-(g+z))*d,F[11]=0,F[12]=y._x,F[13]=y._y,F[14]=y._z,F[15]=1,Z.markAsUpdated(),Z}static Identity(){const H=m.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return H._updateIdentityStatus(!0),H}static IdentityToRef(H){return m.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,H),H._updateIdentityStatus(!0),H}static Zero(){const H=m.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return H._updateIdentityStatus(!1),H}static RotationX(H){const c=new m;return m.RotationXToRef(H,c),c}static Invert(H){const c=new m;return H.invertToRef(c),c}static RotationXToRef(H,c){const y=Math.sin(H),Z=Math.cos(H);return m.FromValuesToRef(1,0,0,0,0,Z,y,0,0,-y,Z,0,0,0,0,1,c),c._updateIdentityStatus(1===Z&&0===y),c}static RotationY(H){const c=new m;return m.RotationYToRef(H,c),c}static RotationYToRef(H,c){const y=Math.sin(H),Z=Math.cos(H);return m.FromValuesToRef(Z,0,-y,0,0,1,0,0,y,0,Z,0,0,0,0,1,c),c._updateIdentityStatus(1===Z&&0===y),c}static RotationZ(H){const c=new m;return m.RotationZToRef(H,c),c}static RotationZToRef(H,c){const y=Math.sin(H),Z=Math.cos(H);return m.FromValuesToRef(Z,y,0,0,-y,Z,0,0,0,0,1,0,0,0,0,1,c),c._updateIdentityStatus(1===Z&&0===y),c}static RotationAxis(H,c){const y=new m;return m.RotationAxisToRef(H,c,y),y}static RotationAxisToRef(H,c,y){const Z=Math.sin(-c),F=Math.cos(-c),P=1-F;H=H.normalizeToRef(z.o[0]);const S=y.Pj;return S[0]=H._x*H._x*P+F,S[1]=H._x*H._y*P-H._z*Z,S[2]=H._x*H._z*P+H._y*Z,S[3]=0,S[4]=H._y*H._x*P+H._z*Z,S[5]=H._y*H._y*P+F,S[6]=H._y*H._z*P-H._x*Z,S[7]=0,S[8]=H._z*H._x*P-H._y*Z,S[9]=H._z*H._y*P+H._x*Z,S[10]=H._z*H._z*P+F,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,y.markAsUpdated(),y}static RotationAlignToRef(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=C.Dot(c,H),S=y.Pj;if(P<-1+Z.e)S[0]=-1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=F?1:-1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=F?-1:1,S[11]=0;else{const y=C.Cross(c,H),Z=1/(1+P);S[0]=y._x*y._x*Z+P,S[1]=y._y*y._x*Z-y._z,S[2]=y._z*y._x*Z+y._y,S[3]=0,S[4]=y._x*y._y*Z+y._z,S[5]=y._y*y._y*Z+P,S[6]=y._z*y._y*Z-y._x,S[7]=0,S[8]=y._x*y._z*Z-y._y,S[9]=y._y*y._z*Z+y._x,S[10]=y._z*y._z*Z+P,S[11]=0}return S[12]=0,S[13]=0,S[14]=0,S[15]=1,y.markAsUpdated(),y}static RotationYawPitchRoll(H,c,y){const Z=new m;return m.RotationYawPitchRollToRef(H,c,y,Z),Z}static RotationYawPitchRollToRef(H,c,y,Z){return v.RotationYawPitchRollToRef(H,c,y,z.Quaternion[0]),z.Quaternion[0].toRotationMatrix(Z),Z}static Scaling(H,c,y){const Z=new m;return m.ScalingToRef(H,c,y,Z),Z}static ScalingToRef(H,c,y,Z){return m.FromValuesToRef(H,0,0,0,0,c,0,0,0,0,y,0,0,0,0,1,Z),Z._updateIdentityStatus(1===H&&1===c&&1===y),Z}static Translation(H,c,y){const Z=new m;return m.TranslationToRef(H,c,y,Z),Z}static TranslationToRef(H,c,y,Z){return m.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,H,c,y,1,Z),Z._updateIdentityStatus(0===H&&0===c&&0===y),Z}static Lerp(H,c,y){const Z=new m;return m.LerpToRef(H,c,y,Z),Z}static LerpToRef(H,c,y,Z){const F=Z.Pj,P=H.m,S=c.m;for(let n=0;n<16;n++)F[n]=P[n]*(1-y)+S[n]*y;return Z.markAsUpdated(),Z}static DecomposeLerp(H,c,y){const Z=new m;return m.DecomposeLerpToRef(H,c,y,Z),Z}static DecomposeLerpToRef(H,c,y,Z){const F=z.o[0],P=z.Quaternion[0],S=z.o[1];H.decompose(F,P,S);const n=z.o[2],O=z.Quaternion[1],a=z.o[3];c.decompose(n,O,a);const i=z.o[4];C.LerpToRef(F,n,y,i);const g=z.Quaternion[2];v.SlerpToRef(P,O,y,g);const V=z.o[5];return C.LerpToRef(S,a,y,V),m.ComposeToRef(i,g,V,Z),Z}static LookAtLH(H,c,y){const Z=new m;return m.LookAtLHToRef(H,c,y,Z),Z}static LookAtLHToRef(H,c,y,Z){const F=z.o[0],P=z.o[1],S=z.o[2];c.subtractToRef(H,S),S.normalize(),C.CrossToRef(y,S,F);const n=F.lengthSquared();0===n?F.x=1:F.normalizeFromLength(Math.sqrt(n)),C.CrossToRef(S,F,P),P.normalize();const O=-C.Dot(F,H),a=-C.Dot(P,H),i=-C.Dot(S,H);return m.FromValuesToRef(F._x,P._x,S._x,0,F._y,P._y,S._y,0,F._z,P._z,S._z,0,O,a,i,1,Z),Z}static LookAtRH(H,c,y){const Z=new m;return m.LookAtRHToRef(H,c,y,Z),Z}static LookAtRHToRef(H,c,y,Z){const F=z.o[0],P=z.o[1],S=z.o[2];H.subtractToRef(c,S),S.normalize(),C.CrossToRef(y,S,F);const n=F.lengthSquared();0===n?F.x=1:F.normalizeFromLength(Math.sqrt(n)),C.CrossToRef(S,F,P),P.normalize();const O=-C.Dot(F,H),a=-C.Dot(P,H),i=-C.Dot(S,H);return m.FromValuesToRef(F._x,P._x,S._x,0,F._y,P._y,S._y,0,F._z,P._z,S._z,0,O,a,i,1,Z),Z}static LookDirectionLH(H,c){const y=new m;return m.LookDirectionLHToRef(H,c,y),y}static LookDirectionLHToRef(H,c,y){const Z=z.o[0];Z.p(H),Z.scaleInPlace(-1);const F=z.o[1];return C.CrossToRef(c,Z,F),m.FromValuesToRef(F._x,F._y,F._z,0,c._x,c._y,c._z,0,Z._x,Z._y,Z._z,0,0,0,0,1,y),y}static LookDirectionRH(H,c){const y=new m;return m.LookDirectionRHToRef(H,c,y),y}static LookDirectionRHToRef(H,c,y){const Z=z.o[2];return C.CrossToRef(c,H,Z),m.FromValuesToRef(Z._x,Z._y,Z._z,0,c._x,c._y,c._z,0,H._x,H._y,H._z,0,0,0,0,1,y),y}static OrthoLH(H,c,y,Z,F){const P=new m;return m.OrthoLHToRef(H,c,y,Z,P,F),P}static OrthoLHToRef(H,c,y,Z,F,P){const S=2/H,n=2/c,O=2/(Z-y),a=-(Z+y)/(Z-y);return m.FromValuesToRef(S,0,0,0,0,n,0,0,0,0,O,0,0,0,a,1,F),P&&F.multiplyToRef(h,F),F._updateIdentityStatus(1===S&&1===n&&1===O&&0===a),F}static OrthoOffCenterLH(H,c,y,Z,F,P,S){const n=new m;return m.OrthoOffCenterLHToRef(H,c,y,Z,F,P,n,S),n}static OrthoOffCenterLHToRef(H,c,y,Z,F,P,S,n){const O=2/(c-H),a=2/(Z-y),i=2/(P-F),C=-(P+F)/(P-F),g=(H+c)/(H-c),v=(Z+y)/(y-Z);return m.FromValuesToRef(O,0,0,0,0,a,0,0,0,0,i,0,g,v,C,1,S),n&&S.multiplyToRef(h,S),S.markAsUpdated(),S}static ObliqueOffCenterLHToRef(H,c,y,Z,F,P,S,n,O,a,i){const C=-S*Math.cos(n),g=-S*Math.sin(n);return m.TranslationToRef(0,0,-O,z.Matrix[1]),m.FromValuesToRef(1,0,0,0,0,1,0,0,C,g,1,0,0,0,0,1,z.Matrix[0]),z.Matrix[1].multiplyToRef(z.Matrix[0],z.Matrix[0]),m.TranslationToRef(0,0,O,z.Matrix[1]),z.Matrix[0].multiplyToRef(z.Matrix[1],z.Matrix[0]),m.OrthoOffCenterLHToRef(H,c,y,Z,F,P,a,i),z.Matrix[0].multiplyToRef(a,a),a}static OrthoOffCenterRH(H,c,y,Z,F,P,S){const n=new m;return m.OrthoOffCenterRHToRef(H,c,y,Z,F,P,n,S),n}static OrthoOffCenterRHToRef(H,c,y,Z,F,P,S,n){return m.OrthoOffCenterLHToRef(H,c,y,Z,F,P,S,n),S.Pj[10]*=-1,S}static ObliqueOffCenterRHToRef(H,c,y,Z,F,P,S,n,O,a,i){const C=S*Math.cos(n),g=S*Math.sin(n);return m.TranslationToRef(0,0,O,z.Matrix[1]),m.FromValuesToRef(1,0,0,0,0,1,0,0,C,g,1,0,0,0,0,1,z.Matrix[0]),z.Matrix[1].multiplyToRef(z.Matrix[0],z.Matrix[0]),m.TranslationToRef(0,0,-O,z.Matrix[1]),z.Matrix[0].multiplyToRef(z.Matrix[1],z.Matrix[0]),m.OrthoOffCenterRHToRef(H,c,y,Z,F,P,a,i),z.Matrix[0].multiplyToRef(a,a),a}static PerspectiveLH(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const S=new m,n=2*y/H,O=2*y/c,a=(Z+y)/(Z-y),i=-2*Z*y/(Z-y),C=Math.tan(P);return m.FromValuesToRef(n,0,0,0,0,O,0,C,0,0,a,1,0,0,i,0,S),F&&S.multiplyToRef(h,S),S._updateIdentityStatus(!1),S}static PerspectiveFovLH(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const n=new m;return m.PerspectiveFovLHToRef(H,c,y,Z,n,!0,F,P,S),n}static PerspectiveFovLHToRef(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=y,i=Z,C=1/Math.tan(.5*H),g=P?C/c:C,v=P?C:C*c,z=O&&0===a?-1:0!==i?(i+a)/(i-a):1,V=O&&0===a?2*i:0!==i?-2*i*a/(i-a):-2*a,Q=Math.tan(n);return m.FromValuesToRef(g,0,0,0,0,v,0,Q,0,0,z,1,0,0,V,0,F),S&&F.multiplyToRef(h,F),F._updateIdentityStatus(!1),F}static PerspectiveFovReverseLHToRef(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const O=1/Math.tan(.5*H),a=P?O/c:O,i=P?O:O*c,C=Math.tan(n);return m.FromValuesToRef(a,0,0,0,0,i,0,C,0,0,-y,1,0,0,1,0,F),S&&F.multiplyToRef(h,F),F._updateIdentityStatus(!1),F}static PerspectiveFovRH(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const n=new m;return m.PerspectiveFovRHToRef(H,c,y,Z,n,!0,F,P,S),n}static PerspectiveFovRHToRef(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=y,i=Z,C=1/Math.tan(.5*H),g=P?C/c:C,v=P?C:C*c,z=O&&0===a?1:0!==i?-(i+a)/(i-a):-1,V=O&&0===a?2*i:0!==i?-2*i*a/(i-a):-2*a,Q=Math.tan(n);return m.FromValuesToRef(g,0,0,0,0,v,0,Q,0,0,z,-1,0,0,V,0,F),S&&F.multiplyToRef(h,F),F._updateIdentityStatus(!1),F}static PerspectiveFovReverseRHToRef(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const O=1/Math.tan(.5*H),a=P?O/c:O,i=P?O:O*c,C=Math.tan(n);return m.FromValuesToRef(a,0,0,0,0,i,0,C,0,0,-y,-1,0,0,-1,0,F),S&&F.multiplyToRef(h,F),F._updateIdentityStatus(!1),F}static GetFinalMatrix(H,c,y,Z,F,P){const S=H.width,n=H.height,O=H.x,a=H.y,i=m.FromValues(S/2,0,0,0,0,-n/2,0,0,0,0,P-F,0,O+S/2,n/2+a,F,1),C=new m;return c.multiplyToRef(y,C),C.multiplyToRef(Z,C),C.multiplyToRef(i,C)}static GetAsMatrix2x2(H){const c=H.m,y=[c[0],c[1],c[4],c[5]];return S.c.MatrixUse64Bits?y:new Float32Array(y)}static GetAsMatrix3x3(H){const c=H.m,y=[c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]];return S.c.MatrixUse64Bits?y:new Float32Array(y)}static Transpose(H){const c=new m;return m.TransposeToRef(H,c),c}static TransposeToRef(H,c){const y=H.m,Z=y[0],F=y[4],P=y[8],S=y[12],n=y[1],O=y[5],a=y[9],i=y[13],C=y[2],g=y[6],v=y[10],m=y[14],z=y[3],V=y[7],h=y[11],Q=y[15],D=c.Pj;return D[0]=Z,D[1]=F,D[2]=P,D[3]=S,D[4]=n,D[5]=O,D[6]=a,D[7]=i,D[8]=C,D[9]=g,D[10]=v,D[11]=m,D[12]=z,D[13]=V,D[14]=h,D[15]=Q,c.markAsUpdated(),c._updateIdentityStatus(H._isIdentity,H._isIdentityDirty),c}static Reflection(H){const c=new m;return m.ReflectionToRef(H,c),c}static ReflectionToRef(H,c){H.normalize();const y=H.k.x,Z=H.k.y,F=H.k.z,P=-2*y,S=-2*Z,n=-2*F;return m.FromValuesToRef(P*y+1,S*y,n*y,0,P*Z,S*Z+1,n*Z,0,P*F,S*F,n*F+1,0,P*H.d,S*H.d,n*H.d,1,c),c}static FromXYZAxesToRef(H,c,y,Z){return m.FromValuesToRef(H._x,H._y,H._z,0,c._x,c._y,c._z,0,y._x,y._y,y._z,0,0,0,0,1,Z),Z}static FromQuaternionToRef(H,c){const y=H._x*H._x,Z=H._y*H._y,F=H._z*H._z,P=H._x*H._y,S=H._z*H._w,n=H._z*H._x,O=H._y*H._w,a=H._y*H._z,i=H._x*H._w;return c.Pj[0]=1-2*(Z+F),c.Pj[1]=2*(P+S),c.Pj[2]=2*(n-O),c.Pj[3]=0,c.Pj[4]=2*(P-S),c.Pj[5]=1-2*(F+y),c.Pj[6]=2*(a+i),c.Pj[7]=0,c.Pj[8]=2*(n+O),c.Pj[9]=2*(a-i),c.Pj[10]=1-2*(Z+y),c.Pj[11]=0,c.Pj[12]=0,c.Pj[13]=0,c.Pj[14]=0,c.Pj[15]=1,c.markAsUpdated(),c}}m._UpdateFlagSeed=0,m._IdentityReadOnly=m.Identity(),Object.defineProperties(m.prototype,{dimension:{value:[4,4]},rank:{value:2}});class z{}z.o=(0,F.g)(11,C.Zero),z.Matrix=(0,F.g)(2,m.Identity),z.Quaternion=(0,F.g)(3,v.Zero);class V{}V.Vector2=(0,F.g)(3,i.Zero),V.o=(0,F.g)(13,C.Zero),V.Vector4=(0,F.g)(3,g.Zero),V.Quaternion=(0,F.g)(3,v.Zero),V.Matrix=(0,F.g)(8,m.Identity),(0,P.d)("BABYLON.Vector2",i),(0,P.d)("BABYLON.Vector3",C),(0,P.d)("BABYLON.Vector4",g),(0,P.d)("BABYLON.Matrix",m);const h=m.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11372:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(H,c,y,Z){this.x=H,this.y=c,this.width=y,this.height=Z}toGlobal(H,c){return new Z(this.x*H,this.y*c,this.width*H,this.height*c)}toGlobalToRef(H,c,y){return y.x=this.x*H,y.y=this.y*c,y.width=this.width*H,y.height=this.height*c,this}clone(){return new Z(this.x,this.y,this.width,this.height)}}},11600:(H,c,y)=>{"use strict";y.d(c,{e:()=>a,f:()=>i});var Z=y(11092),F=y(11609);const P=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],S=[()=>1,H=>H.y,H=>H.z,H=>H.x,H=>H.x*H.y,H=>H.y*H.z,H=>3*H.z*H.z-1,H=>H.x*H.z,H=>H.x*H.x-H.y*H.y],n=(H,c)=>P[H]*S[H](c),O=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class a{constructor(){this.preScaled=!1,this.l00=Z.n.Zero(),this.l1_1=Z.n.Zero(),this.l10=Z.n.Zero(),this.l11=Z.n.Zero(),this.l2_2=Z.n.Zero(),this.l2_1=Z.n.Zero(),this.l20=Z.n.Zero(),this.l21=Z.n.Zero(),this.l22=Z.n.Zero()}addLight(H,c,y){F.d.o[0].set(c.r,c.g,c.b);const Z=F.d.o[0],P=F.d.o[1];Z.scaleToRef(y,P),P.scaleToRef(n(0,H),F.d.o[2]),this.l00.addInPlace(F.d.o[2]),P.scaleToRef(n(1,H),F.d.o[2]),this.l1_1.addInPlace(F.d.o[2]),P.scaleToRef(n(2,H),F.d.o[2]),this.l10.addInPlace(F.d.o[2]),P.scaleToRef(n(3,H),F.d.o[2]),this.l11.addInPlace(F.d.o[2]),P.scaleToRef(n(4,H),F.d.o[2]),this.l2_2.addInPlace(F.d.o[2]),P.scaleToRef(n(5,H),F.d.o[2]),this.l2_1.addInPlace(F.d.o[2]),P.scaleToRef(n(6,H),F.d.o[2]),this.l20.addInPlace(F.d.o[2]),P.scaleToRef(n(7,H),F.d.o[2]),this.l21.addInPlace(F.d.o[2]),P.scaleToRef(n(8,H),F.d.o[2]),this.l22.addInPlace(F.d.o[2])}scaleInPlace(H){this.l00.scaleInPlace(H),this.l1_1.scaleInPlace(H),this.l10.scaleInPlace(H),this.l11.scaleInPlace(H),this.l2_2.scaleInPlace(H),this.l2_1.scaleInPlace(H),this.l20.scaleInPlace(H),this.l21.scaleInPlace(H),this.l22.scaleInPlace(H)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(O[0]),this.l1_1.scaleInPlace(O[1]),this.l10.scaleInPlace(O[2]),this.l11.scaleInPlace(O[3]),this.l2_2.scaleInPlace(O[4]),this.l2_1.scaleInPlace(O[5]),this.l20.scaleInPlace(O[6]),this.l21.scaleInPlace(O[7]),this.l22.scaleInPlace(O[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(P[0]),this.l1_1.scaleInPlace(P[1]),this.l10.scaleInPlace(P[2]),this.l11.scaleInPlace(P[3]),this.l2_2.scaleInPlace(P[4]),this.l2_1.scaleInPlace(P[5]),this.l20.scaleInPlace(P[6]),this.l21.scaleInPlace(P[7]),this.l22.scaleInPlace(P[8])}updateFromArray(H){return Z.n.FromArrayToRef(H[0],0,this.l00),Z.n.FromArrayToRef(H[1],0,this.l1_1),Z.n.FromArrayToRef(H[2],0,this.l10),Z.n.FromArrayToRef(H[3],0,this.l11),Z.n.FromArrayToRef(H[4],0,this.l2_2),Z.n.FromArrayToRef(H[5],0,this.l2_1),Z.n.FromArrayToRef(H[6],0,this.l20),Z.n.FromArrayToRef(H[7],0,this.l21),Z.n.FromArrayToRef(H[8],0,this.l22),this}updateFromFloatsArray(H){return Z.n.FromFloatsToRef(H[0],H[1],H[2],this.l00),Z.n.FromFloatsToRef(H[3],H[4],H[5],this.l1_1),Z.n.FromFloatsToRef(H[6],H[7],H[8],this.l10),Z.n.FromFloatsToRef(H[9],H[10],H[11],this.l11),Z.n.FromFloatsToRef(H[12],H[13],H[14],this.l2_2),Z.n.FromFloatsToRef(H[15],H[16],H[17],this.l2_1),Z.n.FromFloatsToRef(H[18],H[19],H[20],this.l20),Z.n.FromFloatsToRef(H[21],H[22],H[23],this.l21),Z.n.FromFloatsToRef(H[24],H[25],H[26],this.l22),this}static Tg(H){return(new a).updateFromArray(H)}static FromPolynomial(H){const c=new a;return c.l00=H.xx.scale(.376127).add(H.yy.scale(.376127)).add(H.zz.scale(.376126)),c.l1_1=H.y.scale(.977204),c.l10=H.z.scale(.977204),c.l11=H.x.scale(.977204),c.l2_2=H.xy.scale(1.16538),c.l2_1=H.yz.scale(1.16538),c.l20=H.zz.scale(1.34567).Rc(H.xx.scale(.672834)).Rc(H.yy.scale(.672834)),c.l21=H.zx.scale(1.16538),c.l22=H.xx.scale(1.16538).Rc(H.yy.scale(1.16538)),c.l1_1.scaleInPlace(-1),c.l11.scaleInPlace(-1),c.l2_1.scaleInPlace(-1),c.l21.scaleInPlace(-1),c.scaleInPlace(Math.PI),c}}class i{constructor(){this.x=Z.n.Zero(),this.y=Z.n.Zero(),this.z=Z.n.Zero(),this.xx=Z.n.Zero(),this.yy=Z.n.Zero(),this.zz=Z.n.Zero(),this.xy=Z.n.Zero(),this.yz=Z.n.Zero(),this.zx=Z.n.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=a.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(H){F.d.o[0].be(H.r,H.g,H.b);const c=F.d.o[0];this.xx.addInPlace(c),this.yy.addInPlace(c),this.zz.addInPlace(c)}scaleInPlace(H){this.x.scaleInPlace(H),this.y.scaleInPlace(H),this.z.scaleInPlace(H),this.xx.scaleInPlace(H),this.yy.scaleInPlace(H),this.zz.scaleInPlace(H),this.yz.scaleInPlace(H),this.zx.scaleInPlace(H),this.xy.scaleInPlace(H)}updateFromHarmonics(H){return this._harmonics=H,this.x.p(H.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(H.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(H.l10),this.z.scaleInPlace(1.02333),this.xx.p(H.l00),F.d.o[0].p(H.l20).scaleInPlace(.247708),F.d.o[1].p(H.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).pi(F.d.o[0]).addInPlace(F.d.o[1]),this.yy.p(H.l00),this.yy.scaleInPlace(.886277).pi(F.d.o[0]).pi(F.d.o[1]),this.zz.p(H.l00),F.d.o[0].p(H.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(F.d.o[0]),this.yz.p(H.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(H.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(H.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(H){return(new i).updateFromHarmonics(H)}static Tg(H){const c=new i;return Z.n.FromArrayToRef(H[0],0,c.x),Z.n.FromArrayToRef(H[1],0,c.y),Z.n.FromArrayToRef(H[2],0,c.z),Z.n.FromArrayToRef(H[3],0,c.xx),Z.n.FromArrayToRef(H[4],0,c.yy),Z.n.FromArrayToRef(H[5],0,c.zz),Z.n.FromArrayToRef(H[6],0,c.yz),Z.n.FromArrayToRef(H[7],0,c.zx),Z.n.FromArrayToRef(H[8],0,c.xy),c}}},11416:(H,c,y)=>{"use strict";y.d(c,{b:()=>a});var Z=y(11092),F=y(11112),P=y(11354),S=y(11380),n=y(11324);y(11425);function O(H){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],P=[];let O=[];const a=H.width||H.size||1,i=H.height||H.size||1,C=H.depth||H.size||1,g=H.wrap||!1;let v=void 0===H.topBaseAt?1:H.topBaseAt,m=void 0===H.bottomBaseAt?0:H.bottomBaseAt;v=(v+4)%4,m=(m+4)%4;let z=[2,0,3,1][v],V=[2,0,1,3][m],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let H=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Z=[17,18,19,16],F=[22,23,20,21];for(;z>0;)H.unshift(H.pop()),Z.unshift(Z.pop()),z--;for(;V>0;)y.unshift(y.pop()),F.unshift(F.pop()),V--;H=H.flat(),y=y.flat(),h=h.concat(H).concat(y),c.push(Z[0],Z[2],Z[3],Z[0],Z[1],Z[2]),c.push(F[0],F[2],F[3],F[0],F[1],F[2])}const Q=[a/2,i/2,C/2];O=h.reduce(((H,c,y)=>H.concat(c*Q[y%3])),[]);const D=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,f=H.faceUV||new Array(6),J=H.faceColors,l=[];for(let S=0;S<6;S++)void 0===f[S]&&(f[S]=new Z.q(0,0,1,1)),J&&void 0===J[S]&&(J[S]=new F.h(1,1,1,1));for(let Z=0;Z<6;Z++)if(P.push(f[Z].z,n.d?1-f[Z].w:f[Z].w),P.push(f[Z].x,n.d?1-f[Z].w:f[Z].w),P.push(f[Z].x,n.d?1-f[Z].y:f[Z].y),P.push(f[Z].z,n.d?1-f[Z].y:f[Z].y),J)for(let H=0;H<4;H++)l.push(J[Z].r,J[Z].g,J[Z].b,J[Z].a);S.c._ComputeSides(D,O,c,y,P,H.frontUVs,H.backUVs);const d=new S.c;if(d.indices=c,d.xa=O,d.ya=y,d.Aa=P,J){const H=D===S.c.DOUBLESIDE?l.concat(l):l;d.za=H}return d}function a(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new P.c(H,y);c.sideOrientation=P.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return O(c).Ca(Z,c.updatable),Z}S.c.CreateBox=O,P.c.CreateBox=function(H,c){return a(H,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11756:(H,c,y)=>{"use strict";y.d(c,{b:()=>n});var Z=y(11354),F=y(11380),P=y(11324);function S(H){const c=[],y=[],Z=[],S=[],n=H.radius||.5,O=H.tessellation||64,a=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,i=0===H.sideOrientation?0:H.sideOrientation||F.c.DEFAULTSIDE;c.push(0,0,0),S.push(.5,.5);const C=2*Math.PI*a,g=1===a?C/O:C/(O-1);let v=0;for(let F=0;F<O;F++){const H=Math.cos(v),y=Math.sin(v),Z=(H+1)/2,F=(1-y)/2;c.push(n*H,n*y,0),S.push(Z,P.d?1-F:F),v+=g}1===a&&(c.push(c[3],c[4],c[5]),S.push(S[2],P.d?1-S[3]:S[3]));const m=c.length/3;for(let F=1;F<m-1;F++)y.push(F+1,0,F);F.c.ComputeNormals(c,y,Z),F.c._ComputeSides(i,c,y,Z,S,H.frontUVs,H.backUVs);const z=new F.c;return z.indices=y,z.xa=c,z.ya=Z,z.Aa=S,z}function n(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new Z.c(H,y);c.sideOrientation=Z.c._GetDefaultSideOrientation(c.sideOrientation),F._originalBuilderSideOrientation=c.sideOrientation;return S(c).Ca(F,c.updatable),F}F.c.CreateDisc=S,Z.c.CreateDisc=function(H,c,y){return n(H,{radius:c,tessellation:y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11425:(H,c,y)=>{"use strict";y.d(c,{f:()=>V,c:()=>Q,h:()=>h});var Z=y(11092),F=y(11112),P=y(11354),S=y(11380),n=y(11153);P.c._GroundMeshParser=(H,c)=>O.Parse(H,c);class O extends P.c{constructor(H,c){super(H,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=H,this._subdivisionsY=H,this.subdivide(H);const y=this;y.createOrUpdateSubmeshesOctree&&y.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(H,c){const y=this.getWorldMatrix(),F=Z.h.Matrix[5];y.invertToRef(F);const P=Z.h.o[8];if(Z.n.TransformCoordinatesFromFloatsToRef(H,0,c,F,P),H=P.x,c=P.z,H<this._minX||H>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(H,c),n=-(S.x*H+S.z*c+S.w)/S.y;return Z.n.TransformCoordinatesFromFloatsToRef(0,n,0,y,P),P.y}getNormalAtCoordinates(H,c){const y=new Z.n(0,1,0);return this.getNormalAtCoordinatesToRef(H,c,y),y}getNormalAtCoordinatesToRef(H,c,y){const F=this.getWorldMatrix(),P=Z.h.Matrix[5];F.invertToRef(P);const S=Z.h.o[8];if(Z.n.TransformCoordinatesFromFloatsToRef(H,0,c,P,S),H=S.x,c=S.z,H<this._minX||H>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(H,c);return Z.n.TransformNormalFromFloatsToRef(n.x,n.y,n.z,F,y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(H,c){const y=Math.floor((H+this._maxX)*this._subdivisionsX/this._width),Z=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),F=this._heightQuads[Z*this._subdivisionsX+y];let P;return P=c<F.slope.x*H+F.slope.y?F.facet1:F.facet2,P}_initHeightQuads(){const H=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=new Array;for(let y=0;y<c;y++)for(let c=0;c<H;c++){const F={slope:Z.l.Zero(),facet1:new Z.q(0,0,0,0),facet2:new Z.q(0,0,0,0)};this._heightQuads[y*H+c]=F}return this}_computeHeightQuads(){const H=this.getVerticesData(n.h.PositionKind);if(!H)return this;const c=Z.h.o[3],y=Z.h.o[2],F=Z.h.o[1],P=Z.h.o[0],S=Z.h.o[4],O=Z.h.o[5],a=Z.h.o[6],i=Z.h.o[7],C=Z.h.o[8];let g=0,v=0,m=0,z=0,V=0,h=0,Q=0;const D=this._subdivisionsX,f=this._subdivisionsY;for(let n=0;n<f;n++)for(let f=0;f<D;f++){g=3*f,v=n*(D+1)*3,m=(n+1)*(D+1)*3,c.x=H[v+g],c.y=H[v+g+1],c.z=H[v+g+2],y.x=H[v+g+3],y.y=H[v+g+4],y.z=H[v+g+5],F.x=H[m+g],F.y=H[m+g+1],F.z=H[m+g+2],P.x=H[m+g+3],P.y=H[m+g+4],P.z=H[m+g+5],z=(P.z-c.z)/(P.x-c.x),V=c.z-z*c.x,y.subtractToRef(c,S),F.subtractToRef(c,O),P.subtractToRef(c,a),Z.n.CrossToRef(a,O,i),Z.n.CrossToRef(S,a,C),i.normalize(),C.normalize(),h=-(i.x*c.x+i.y*c.y+i.z*c.z),Q=-(C.x*y.x+C.y*y.y+C.z*y.z);const J=this._heightQuads[n*D+f];J.slope.be(z,V),J.facet1.be(i.x,i.y,i.z,h),J.facet2.be(C.x,C.y,C.z,Q)}return this}serialize(H){super.serialize(H),H.subdivisionsX=this._subdivisionsX,H.subdivisionsY=this._subdivisionsY,H.minX=this._minX,H.maxX=this._maxX,H.Wi=this._minZ,H.maxZ=this._maxZ,H.width=this._width,H.height=this._height}static Parse(H,c){const y=new O(H.name,c);return y._subdivisionsX=H.subdivisionsX||1,y._subdivisionsY=H.subdivisionsY||1,y._minX=H.minX,y._maxX=H.maxX,y._minZ=H.Wi,y._maxZ=H.maxZ,y._width=H.width,y._height=H.height,y}}var a=y(10754),i=y(10810),C=y(11094),g=y(11324);function v(H){const c=[],y=[],F=[],P=[];let n,O;const a=H.width||H.size||1,i=H.height||H.size||1,C=0|(H.subdivisionsX||H.subdivisions||1),v=0|(H.subdivisionsY||H.subdivisions||1);for(n=0;n<=v;n++)for(O=0;O<=C;O++){const H=new Z.n(O*a/C-a/2,0,(v-n)*i/v-i/2),c=new Z.n(0,1,0);y.push(H.x,H.y,H.z),F.push(c.x,c.y,c.z),P.push(O/C,g.d?n/v:1-n/v)}for(n=0;n<v;n++)for(O=0;O<C;O++)c.push(O+1+(n+1)*(C+1)),c.push(O+1+n*(C+1)),c.push(O+n*(C+1)),c.push(O+(n+1)*(C+1)),c.push(O+1+(n+1)*(C+1)),c.push(O+n*(C+1));const m=new S.c;return m.indices=c,m.xa=y,m.ya=F,m.Aa=P,m}function m(H){const c=void 0!==H.xmin&&null!==H.xmin?H.xmin:-1,y=void 0!==H.zmin&&null!==H.zmin?H.zmin:-1,F=void 0!==H.xmax&&null!==H.xmax?H.xmax:1,P=void 0!==H.zmax&&null!==H.zmax?H.zmax:1,n=H.subdivisions||{w:1,h:1},O=H.precision||{w:1,h:1},a=[],i=[],C=[],g=[];let v,m,z,V;n.h=n.h<1?1:n.h,n.w=n.w<1?1:n.w,O.w=O.w<1?1:O.w,O.h=O.h<1?1:O.h;const h=(F-c)/n.w,Q=(P-y)/n.h;function D(H,c,y,F){const P=i.length/3,S=O.w+1;for(v=0;v<O.h;v++)for(m=0;m<O.w;m++){const H=[P+m+v*S,P+(m+1)+v*S,P+(m+1)+(v+1)*S,P+m+(v+1)*S];a.push(H[1]),a.push(H[2]),a.push(H[3]),a.push(H[0]),a.push(H[1]),a.push(H[3])}const n=Z.n.Zero(),z=new Z.n(0,1,0);for(v=0;v<=O.h;v++)for(n.z=v*(F-c)/O.h+c,m=0;m<=O.w;m++)n.x=m*(y-H)/O.w+H,n.y=0,i.push(n.x,n.y,n.z),C.push(z.x,z.y,z.z),g.push(m/O.w,v/O.h)}for(z=0;z<n.h;z++)for(V=0;V<n.w;V++)D(c+V*h,y+z*Q,c+(V+1)*h,y+(z+1)*Q);const f=new S.c;return f.indices=a,f.xa=i,f.ya=C,f.Aa=g,f}function z(H){const c=[],y=[],P=[],n=[];let O,a;const i=H.colorFilter||new F.e(.3,.59,.11),g=H.alphaFilter||0;let v=!1;if(H.minHeight>H.maxHeight){v=!0;const c=H.maxHeight;H.maxHeight=H.minHeight,H.minHeight=c}for(O=0;O<=H.subdivisions;O++)for(a=0;a<=H.subdivisions;a++){const c=new Z.n(a*H.width/H.subdivisions-H.width/2,0,(H.subdivisions-O)*H.height/H.subdivisions-H.height/2),F=4*(((c.x+H.width/2)/H.width*(H.bufferWidth-1)|0)+((1-(c.z+H.height/2)/H.height)*(H.bufferHeight-1)|0)*H.bufferWidth);let S=H.buffer[F]/255,m=H.buffer[F+1]/255,z=H.buffer[F+2]/255;const V=H.buffer[F+3]/255;v&&(S=1-S,m=1-m,z=1-z);const h=S*i.r+m*i.g+z*i.b;c.y=V>=g?H.minHeight+(H.maxHeight-H.minHeight)*h:H.minHeight-C.e,H.heightBuffer&&(H.heightBuffer[O*(H.subdivisions+1)+a]=c.y),y.push(c.x,c.y,c.z),P.push(0,0,0),n.push(a/H.subdivisions,1-O/H.subdivisions)}for(O=0;O<H.subdivisions;O++)for(a=0;a<H.subdivisions;a++){const Z=a+1+(O+1)*(H.subdivisions+1),F=a+1+O*(H.subdivisions+1),P=a+O*(H.subdivisions+1),S=a+(O+1)*(H.subdivisions+1),n=y[3*Z+1]>=H.minHeight,i=y[3*F+1]>=H.minHeight,C=y[3*P+1]>=H.minHeight;n&&i&&C&&(c.push(Z),c.push(F),c.push(P));y[3*S+1]>=H.minHeight&&n&&C&&(c.push(S),c.push(Z),c.push(P))}S.c.ComputeNormals(y,c,P);const m=new S.c;return m.indices=c,m.xa=y,m.ya=P,m.Aa=n,m}function V(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=new O(H,arguments.length>2?arguments[2]:void 0);y._setReady(!1),y._subdivisionsX=c.subdivisionsX||c.subdivisions||1,y._subdivisionsY=c.subdivisionsY||c.subdivisions||1,y._width=c.width||1,y._height=c.height||1,y._maxX=y._width/2,y._maxZ=y._height/2,y._minX=-y._maxX,y._minZ=-y._maxZ;return v(c).Ca(y,c.updatable),y._setReady(!0),y}function h(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new P.c(H,y);return m(c).Ca(Z,c.updatable),Z}function Q(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=y.width||10,S=y.height||10,n=y.subdivisions||1,C=y.minHeight||0,g=y.maxHeight||1,v=y.colorFilter||new F.e(.3,.59,.11),m=y.alphaFilter||0,V=y.updatable,h=y.onReady;Z=Z||i.b.LastCreatedScene;const Q=new O(H,Z);let D;Q._subdivisionsX=n,Q._subdivisionsY=n,Q._width=P,Q._height=S,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ,Q._setReady(!1),y.passHeightBufferInCallback&&(D=new Float32Array((n+1)*(n+1)));const f=(H,c,y)=>{z({width:P,height:S,subdivisions:n,minHeight:C,maxHeight:g,colorFilter:v,buffer:H,bufferWidth:c,bufferHeight:y,alphaFilter:m,heightBuffer:D}).Ca(Q,V),h&&h(Q,D),Q._setReady(!0)};if("string"===typeof c){const H=H=>{var c;const y=H.width,F=H.height;if(Z.u)return;const P=null===(c=Z)||void 0===c?void 0:c.getEngine().resizeImageBitmap(H,y,F);f(P,y,F)};a.c.LoadImage(c,H,y.onError?y.onError:()=>{},Z.offlineProvider)}else f(c.data,c.width,c.height);return Q}S.c.CreateGround=v,S.c.CreateTiledGround=m,S.c.CreateGroundFromHeightMap=z,P.c.CreateGround=(H,c,y,Z,F,P)=>V(H,{width:c,height:y,subdivisions:Z,updatable:P},F),P.c.CreateTiledGround=(H,c,y,Z,F,P,S,n,O)=>h(H,{xmin:c,zmin:y,xmax:Z,zmax:F,subdivisions:P,precision:S,updatable:O},n),P.c.CreateGroundFromHeightMap=(H,c,y,Z,F,P,S,n,O,a,i)=>Q(H,c,{width:y,height:Z,subdivisions:F,minHeight:P,maxHeight:S,updatable:O,onReady:a,alphaFilter:i},n)},12806:(H,c,y)=>{"use strict";y.d(c,{c:()=>G,e:()=>E,g:()=>U});var Z=y(11092),F=y(11354),P=y(11380),S=y(11112),n=y(11153),O=y(12330),a=y(11239),i=y(11118),C=y(11076),g=y(11304),v=y(10893),m=y(11334),z=y(10805),V=y(11301),h=y(10810),Q=y(11288),D=y(11285);const f={effect:null,subMesh:null};class J extends V.c{constructor(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(H,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new Z.d,this._cachedWorldViewProjectionMatrix=new Z.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=y,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...F}}get shaderPath(){return this._shaderPath}set shaderPath(H){this._shaderPath=H}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(H){-1===this._options.uniforms.indexOf(H)&&this._options.uniforms.push(H)}setTexture(H,c){return-1===this._options.samplers.indexOf(H)&&this._options.samplers.push(H),this._textures[H]=c,this}removeTexture(H){delete this._textures[H]}setTextureArray(H,c){return-1===this._options.samplers.indexOf(H)&&this._options.samplers.push(H),this._checkUniform(H),this._textureArrays[H]=c,this}setExternalTexture(H,c){return-1===this._options.externalTextures.indexOf(H)&&this._options.externalTextures.push(H),this._externalTextures[H]=c,this}setFloat(H,c){return this._checkUniform(H),this._floats[H]=c,this}setInt(H,c){return this._checkUniform(H),this._ints[H]=c,this}setUInt(H,c){return this._checkUniform(H),this._uints[H]=c,this}setFloats(H,c){return this._checkUniform(H),this._floatsArrays[H]=c,this}setColor3(H,c){return this._checkUniform(H),this._colors3[H]=c,this}setColor3Array(H,c){return this._checkUniform(H),this._colors3Arrays[H]=c.reduce(((H,c)=>(c.toArray(H,H.length),H)),[]),this}setColor4(H,c){return this._checkUniform(H),this._colors4[H]=c,this}setColor4Array(H,c){return this._checkUniform(H),this._colors4Arrays[H]=c.reduce(((H,c)=>(c.toArray(H,H.length),H)),[]),this}setVector2(H,c){return this._checkUniform(H),this._vectors2[H]=c,this}setVector3(H,c){return this._checkUniform(H),this._vectors3[H]=c,this}setVector4(H,c){return this._checkUniform(H),this._vectors4[H]=c,this}setQuaternion(H,c){return this._checkUniform(H),this._quaternions[H]=c,this}setQuaternionArray(H,c){return this._checkUniform(H),this._quaternionsArrays[H]=c.reduce(((H,c)=>(c.toArray(H,H.length),H)),[]),this}setMatrix(H,c){return this._checkUniform(H),this._matrices[H]=c,this}setMatrices(H,c){this._checkUniform(H);const y=new Float32Array(16*c.length);for(let Z=0;Z<c.length;Z++){c[Z].copyToArray(y,16*Z)}return this._matrixArrays[H]=y,this}setMatrix3x3(H,c){return this._checkUniform(H),this._matrices3x3[H]=c,this}setMatrix2x2(H,c){return this._checkUniform(H),this._matrices2x2[H]=c,this}setArray2(H,c){return this._checkUniform(H),this._vectors2Arrays[H]=c,this}setArray3(H,c){return this._checkUniform(H),this._vectors3Arrays[H]=c,this}setArray4(H,c){return this._checkUniform(H),this._vectors4Arrays[H]=c,this}setUniformBuffer(H,c){return-1===this._options.uniformBuffers.indexOf(H)&&this._options.uniformBuffers.push(H),this._uniformBuffers[H]=c,this}setTextureSampler(H,c){return-1===this._options.samplerObjects.indexOf(H)&&this._options.samplerObjects.push(H),this._textureSamplers[H]=c,this}setStorageBuffer(H,c){return-1===this._options.storageBuffers.indexOf(H)&&this._options.storageBuffers.push(H),this._storageBuffers[H]=c,this}setDefine(H,c){const y=H.trimEnd()+" ",Z=this.options.defines.findIndex((c=>c===H||c.startsWith(y)));return Z>=0&&this.options.defines.splice(Z,1),("boolean"!==typeof c||c)&&this.options.defines.push(y+c),this}isReadyForSubMesh(H,c,y){return this.isReady(H,y,c)}isReady(H,c,y){var Z;const F=y&&this._storeEffectOnSubMeshes;if(this.isFrozen){const H=F?y._drawWrapper:this._drawWrapper;if(H.effect&&H._wasPreviouslyReady&&H._wasPreviouslyUsingInstances===c)return!0}const P=this.va(),S=P.getEngine(),O=[],a=[],i=new m.c;let g=this._shaderPath,v=this._options.uniforms,z=this._options.uniformBuffers,V=this._options.samplers;S.getCaps().multiview&&P.activeCamera&&P.activeCamera.outputRenderTarget&&P.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,O.push("#define MULTIVIEW"),-1!==v.indexOf("viewProjection")&&-1===v.indexOf("viewProjectionR")&&v.push("viewProjectionR"));for(let n=0;n<this._options.defines.length;n++){const H=0===this._options.defines[n].indexOf("#define")?this._options.defines[n]:`#define ${this._options.defines[n]}`;O.push(H)}for(let n=0;n<this._options.attributes.length;n++)a.push(this._options.attributes[n]);if(H&&H.isVerticesDataPresent(n.h.ColorKind)&&(-1===a.indexOf(n.h.ColorKind)&&a.push(n.h.ColorKind),O.push("#define VERTEXCOLOR")),c&&(O.push("#define INSTANCES"),(0,D.$)(a,this._materialHelperNeedsPreviousMatrices),null!==H&&void 0!==H&&H.hasThinInstances&&(O.push("#define THIN_INSTANCES"),H&&H.isVerticesDataPresent(n.h.ColorInstanceKind)&&(a.push(n.h.ColorInstanceKind),O.push("#define INSTANCESCOLOR")))),H&&H.useBones&&H.computeBonesUsingShaders&&H.skeleton){a.push(n.h.MatricesIndicesKind),a.push(n.h.MatricesWeightsKind),H.numBoneInfluencers>4&&(a.push(n.h.MatricesIndicesExtraKind),a.push(n.h.MatricesWeightsExtraKind));const c=H.skeleton;O.push("#define NUM_BONE_INFLUENCERS "+H.numBoneInfluencers),i.addCPUSkinningFallback(0,H),c.isUsingTextureForMatrices?(O.push("#define BONETEXTURE"),-1===v.indexOf("boneTextureWidth")&&v.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(O.push("#define BonesPerMesh "+(c.bones.length+1)),-1===v.indexOf("mBones")&&v.push("mBones"))}else O.push("#define NUM_BONE_INFLUENCERS 0");let h=0;const J=H?H.morphTargetManager:null;if(J){const H=J.supportsUVs&&-1!==O.indexOf("#define UV1"),c=J.supportsTangents&&-1!==O.indexOf("#define TANGENT"),y=J.supportsNormals&&-1!==O.indexOf("#define NORMAL");h=J.numMaxInfluencers||J.numInfluencers,H&&O.push("#define MORPHTARGETS_UV"),c&&O.push("#define MORPHTARGETS_TANGENT"),y&&O.push("#define MORPHTARGETS_NORMAL"),h>0&&O.push("#define MORPHTARGETS"),J.isUsingTextureForTargets&&(O.push("#define MORPHTARGETS_TEXTURE"),-1===v.indexOf("morphTargetTextureIndices")&&v.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),O.push("#define NUM_MORPH_INFLUENCERS "+h);for(let Z=0;Z<h;Z++)a.push(n.h.PositionKind+Z),y&&a.push(n.h.NormalKind+Z),c&&a.push(n.h.TangentKind+Z),H&&a.push(n.h.UVKind+"_"+Z);h>0&&(v=v.slice(),v.push("morphTargetInfluences"),v.push("morphTargetCount"),v.push("morphTargetTextureInfo"),v.push("morphTargetTextureIndices"))}else O.push("#define NUM_MORPH_INFLUENCERS 0");if(H){const c=H.bakedVertexAnimationManager;c&&c.isEnabled&&(O.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===v.indexOf("bakedVertexAnimationSettings")&&v.push("bakedVertexAnimationSettings"),-1===v.indexOf("bakedVertexAnimationTextureSizeInverted")&&v.push("bakedVertexAnimationTextureSizeInverted"),-1===v.indexOf("bakedVertexAnimationTime")&&v.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,D.v)(a,H,O)}for(const n in this._textures)if(!this._textures[n].isReady())return!1;H&&this._shouldTurnAlphaTestOn(H)&&O.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,Q.c)(v),(0,Q.j)(this,P,O)),P.fogEnabled&&null!==H&&void 0!==H&&H.applyFog&&P.fogMode!==C.d.FOGMODE_NONE&&(O.push("#define FOG"),-1===v.indexOf("view")&&v.push("view"),-1===v.indexOf("vFogInfos")&&v.push("vFogInfos"),-1===v.indexOf("vFogColor")&&v.push("vFogColor")),this._useLogarithmicDepth&&(O.push("#define LOGARITHMICDEPTH"),-1===v.indexOf("logarithmicDepthConstant")&&v.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(v=v.slice(),z=z.slice(),V=V.slice(),g=this.customShaderNameResolve(this.name,v,z,V,O,a));const l=F?y._getDrawWrapper(void 0,!0):this._drawWrapper,d=(null===l||void 0===l?void 0:l.effect)??null,K=(null===l||void 0===l?void 0:l.defines)??null,T=O.join("\n");let u=d;return K!==T&&(u=S.createEffect(g,{attributes:a,uniformsNames:v,uniformBuffersNames:z,samplers:V,defines:T,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:h},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},S),F?y.setEffect(u,T,this._materialContext):l&&l.setEffect(u,T),this._onEffectCreatedObservable&&(f.effect=u,f.subMesh=y??(null===H||void 0===H?void 0:H.$f[0])??null,this._onEffectCreatedObservable.notifyObservers(f))),l._wasPreviouslyUsingInstances=!!c,!((null===(Z=u)||void 0===Z||!Z.isReady())??1)&&(d!==u&&P.resetCachedMaterial(),l._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(H,c){const y=this.va(),Z=c??this.getEffect();Z&&(-1!==this._options.uniforms.indexOf("world")&&Z.setMatrix("world",H),-1!==this._options.uniforms.indexOf("worldView")&&(H.multiplyToRef(y.getViewMatrix(),this._cachedWorldViewMatrix),Z.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(H.multiplyToRef(y.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),Z.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&Z.setMatrix("view",y.getViewMatrix()))}bindForSubMesh(H,c,y){var Z;this.bind(H,c,null===(Z=y._drawWrapperOverride)||void 0===Z?void 0:Z.effect,y)}bind(H,c,y,Z){const F=Z&&this._storeEffectOnSubMeshes,P=y??(F?Z.effect:this.getEffect());if(!P)return;const S=this.va();this._activeEffect=P,this.bindOnlyWorldMatrix(H,y);const n=this._options.uniformBuffers;let O=!1;if(P&&n&&n.length>0&&S.getEngine().supportsUniformBuffers)for(let C=0;C<n.length;++C){switch(n[C]){case"Mesh":c&&(c.getMeshUniformBuffer().bindToEffect(P,"Mesh"),c.transferToEffect(H));break;case"Scene":(0,D.m)(P,S.getSceneUniformBuffer()),S.finalizeSceneUbo(),O=!0}}const a=c&&F?this._mustRebind(S,P,Z,c.visibility):S.getCachedMaterial()!==this;if(P&&a){let H;for(H in O||-1===this._options.uniforms.indexOf("view")||P.setMatrix("view",S.getViewMatrix()),O||-1===this._options.uniforms.indexOf("projection")||P.setMatrix("projection",S.getProjectionMatrix()),O||-1===this._options.uniforms.indexOf("viewProjection")||(P.setMatrix("viewProjection",S.getTransformMatrix()),this._multiview&&P.setMatrix("viewProjectionR",S._transformMatrixR)),S.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&P.setVector3("cameraPosition",S.activeCamera.globalPosition),(0,D.e)(c,P),(0,Q.f)(P,this,S),this._useLogarithmicDepth&&(0,D.j)(F?Z.materialDefines:P.defines,P,S),c&&(0,D.h)(S,c,P),this._textures)P.setTexture(H,this._textures[H]);for(H in this._textureArrays)P.setTextureArray(H,this._textureArrays[H]);for(H in this._ints)P.setInt(H,this._ints[H]);for(H in this._uints)P.setUInt(H,this._uints[H]);for(H in this._floats)P.setFloat(H,this._floats[H]);for(H in this._floatsArrays)P.setArray(H,this._floatsArrays[H]);for(H in this._colors3)P.setColor3(H,this._colors3[H]);for(H in this._colors3Arrays)P.setArray3(H,this._colors3Arrays[H]);for(H in this._colors4){const c=this._colors4[H];P.setFloat4(H,c.r,c.g,c.b,c.a)}for(H in this._colors4Arrays)P.setArray4(H,this._colors4Arrays[H]);for(H in this._vectors2)P.setVector2(H,this._vectors2[H]);for(H in this._vectors3)P.setVector3(H,this._vectors3[H]);for(H in this._vectors4)P.setVector4(H,this._vectors4[H]);for(H in this._quaternions)P.setQuaternion(H,this._quaternions[H]);for(H in this._matrices)P.setMatrix(H,this._matrices[H]);for(H in this._matrixArrays)P.setMatrices(H,this._matrixArrays[H]);for(H in this._matrices3x3)P.setMatrix3x3(H,this._matrices3x3[H]);for(H in this._matrices2x2)P.setMatrix2x2(H,this._matrices2x2[H]);for(H in this._vectors2Arrays)P.setArray2(H,this._vectors2Arrays[H]);for(H in this._vectors3Arrays)P.setArray3(H,this._vectors3Arrays[H]);for(H in this._vectors4Arrays)P.setArray4(H,this._vectors4Arrays[H]);for(H in this._quaternionsArrays)P.setArray4(H,this._quaternionsArrays[H]);for(H in this._uniformBuffers){const c=this._uniformBuffers[H].getBuffer();c&&P.bindUniformBuffer(c,H)}const y=S.getEngine(),n=y.setExternalTexture;if(n)for(H in this._externalTextures)n.call(y,H,this._externalTextures[H]);const a=y.setTextureSampler;if(a)for(H in this._textureSamplers)a.call(y,H,this._textureSamplers[H]);const i=y.setStorageBuffer;if(i)for(H in this._storageBuffers)i.call(y,H,this._storageBuffers[H])}if(P&&c&&(a||!this.isFrozen)){const H=c.morphTargetManager;H&&H.numInfluencers>0&&(0,D.l)(c,P);const y=c.bakedVertexAnimationManager;if(y&&y.isEnabled){var i;const H=F?Z._drawWrapper:this._drawWrapper;null===(i=c.bakedVertexAnimationManager)||void 0===i||i.bind(P,!!H._wasPreviouslyUsingInstances)}}this._afterBind(c,P,Z)}getActiveTextures(){const H=super.getActiveTextures();for(const c in this._textures)H.push(this._textures[c]);for(const c in this._textureArrays){const y=this._textureArrays[c];for(let c=0;c<y.length;c++)H.push(y[c])}return H}hasTexture(H){if(super.hasTexture(H))return!0;for(const c in this._textures)if(this._textures[c]===H)return!0;for(const c in this._textureArrays){const y=this._textureArrays[c];for(let c=0;c<y.length;c++)if(y[c]===H)return!0}return!1}clone(H){const c=i.e.Clone((()=>new J(H,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);c.name=H,c.id=H,"object"===typeof c._shaderPath&&(c._shaderPath={...c._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((H=>{const c=this._options[H];Array.isArray(c)&&(this._options[H]=c.slice(0))})),this.stencil.copyTo(c.stencil);for(const y in this._textures)c.setTexture(y,this._textures[y]);for(const y in this._textureArrays)c.setTextureArray(y,this._textureArrays[y]);for(const y in this._externalTextures)c.setExternalTexture(y,this._externalTextures[y]);for(const y in this._ints)c.setInt(y,this._ints[y]);for(const y in this._uints)c.setUInt(y,this._uints[y]);for(const y in this._floats)c.setFloat(y,this._floats[y]);for(const y in this._floatsArrays)c.setFloats(y,this._floatsArrays[y]);for(const y in this._colors3)c.setColor3(y,this._colors3[y]);for(const y in this._colors3Arrays)c._colors3Arrays[y]=this._colors3Arrays[y];for(const y in this._colors4)c.setColor4(y,this._colors4[y]);for(const y in this._colors4Arrays)c._colors4Arrays[y]=this._colors4Arrays[y];for(const y in this._vectors2)c.setVector2(y,this._vectors2[y]);for(const y in this._vectors3)c.setVector3(y,this._vectors3[y]);for(const y in this._vectors4)c.setVector4(y,this._vectors4[y]);for(const y in this._quaternions)c.setQuaternion(y,this._quaternions[y]);for(const y in this._quaternionsArrays)c._quaternionsArrays[y]=this._quaternionsArrays[y];for(const y in this._matrices)c.setMatrix(y,this._matrices[y]);for(const y in this._matrixArrays)c._matrixArrays[y]=this._matrixArrays[y].slice();for(const y in this._matrices3x3)c.setMatrix3x3(y,this._matrices3x3[y]);for(const y in this._matrices2x2)c.setMatrix2x2(y,this._matrices2x2[y]);for(const y in this._vectors2Arrays)c.setArray2(y,this._vectors2Arrays[y]);for(const y in this._vectors3Arrays)c.setArray3(y,this._vectors3Arrays[y]);for(const y in this._vectors4Arrays)c.setArray4(y,this._vectors4Arrays[y]);for(const y in this._uniformBuffers)c.setUniformBuffer(y,this._uniformBuffers[y]);for(const y in this._textureSamplers)c.setTextureSampler(y,this._textureSamplers[y]);for(const y in this._storageBuffers)c.setStorageBuffer(y,this._storageBuffers[y]);return c}dispose(H,c,y){if(c){let H;for(H in this._textures)this._textures[H].dispose();for(H in this._textureArrays){const c=this._textureArrays[H];for(let H=0;H<c.length;H++)c[H].dispose()}}this._textures={},super.dispose(H,c,y)}serialize(){const H=i.e.Serialize(this);let c;for(c in H.customType="BABYLON.ShaderMaterial",H.uniqueId=this.uniqueId,H.options=this._options,H.shaderPath=this._shaderPath,H.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,H.stencil=this.stencil.serialize(),H.textures={},this._textures)H.textures[c]=this._textures[c].serialize();for(c in H.textureArrays={},this._textureArrays){H.textureArrays[c]=[];const y=this._textureArrays[c];for(let Z=0;Z<y.length;Z++)H.textureArrays[c].push(y[Z].serialize())}for(c in H.ints={},this._ints)H.ints[c]=this._ints[c];for(c in H.uints={},this._uints)H.uints[c]=this._uints[c];for(c in H.floats={},this._floats)H.floats[c]=this._floats[c];for(c in H.floatsArrays={},this._floatsArrays)H.floatsArrays[c]=this._floatsArrays[c];for(c in H.colors3={},this._colors3)H.colors3[c]=this._colors3[c].ij();for(c in H.colors3Arrays={},this._colors3Arrays)H.colors3Arrays[c]=this._colors3Arrays[c];for(c in H.colors4={},this._colors4)H.colors4[c]=this._colors4[c].ij();for(c in H.colors4Arrays={},this._colors4Arrays)H.colors4Arrays[c]=this._colors4Arrays[c];for(c in H.vectors2={},this._vectors2)H.vectors2[c]=this._vectors2[c].ij();for(c in H.vectors3={},this._vectors3)H.vectors3[c]=this._vectors3[c].ij();for(c in H.vectors4={},this._vectors4)H.vectors4[c]=this._vectors4[c].ij();for(c in H.quaternions={},this._quaternions)H.quaternions[c]=this._quaternions[c].ij();for(c in H.matrices={},this._matrices)H.matrices[c]=this._matrices[c].ij();for(c in H.matrixArray={},this._matrixArrays)H.matrixArray[c]=this._matrixArrays[c];for(c in H.matrices3x3={},this._matrices3x3)H.matrices3x3[c]=this._matrices3x3[c];for(c in H.matrices2x2={},this._matrices2x2)H.matrices2x2[c]=this._matrices2x2[c];for(c in H.vectors2Arrays={},this._vectors2Arrays)H.vectors2Arrays[c]=this._vectors2Arrays[c];for(c in H.vectors3Arrays={},this._vectors3Arrays)H.vectors3Arrays[c]=this._vectors3Arrays[c];for(c in H.vectors4Arrays={},this._vectors4Arrays)H.vectors4Arrays[c]=this._vectors4Arrays[c];for(c in H.quaternionsArrays={},this._quaternionsArrays)H.quaternionsArrays[c]=this._quaternionsArrays[c];return H}static Parse(H,c,y){const F=i.e.Parse((()=>new J(H.name,c,H.shaderPath,H.options,H.storeEffectOnSubMeshes)),H,c,y);let P;for(P in H.stencil&&F.stencil.parse(H.stencil,c,y),H.textures)F.setTexture(P,g.d.Parse(H.textures[P],c,y));for(P in H.textureArrays){const Z=H.textureArrays[P],S=[];for(let H=0;H<Z.length;H++)S.push(g.d.Parse(Z[H],c,y));F.setTextureArray(P,S)}for(P in H.ints)F.setInt(P,H.ints[P]);for(P in H.uints)F.setUInt(P,H.uints[P]);for(P in H.floats)F.setFloat(P,H.floats[P]);for(P in H.floatsArrays)F.setFloats(P,H.floatsArrays[P]);for(P in H.colors3)F.setColor3(P,S.e.Tg(H.colors3[P]));for(P in H.colors3Arrays){const c=H.colors3Arrays[P].reduce(((H,c,y)=>(y%3===0?H.push([c]):H[H.length-1].push(c),H)),[]).map((H=>S.e.Tg(H)));F.setColor3Array(P,c)}for(P in H.colors4)F.setColor4(P,S.h.Tg(H.colors4[P]));for(P in H.colors4Arrays){const c=H.colors4Arrays[P].reduce(((H,c,y)=>(y%4===0?H.push([c]):H[H.length-1].push(c),H)),[]).map((H=>S.h.Tg(H)));F.setColor4Array(P,c)}for(P in H.vectors2)F.setVector2(P,Z.l.Tg(H.vectors2[P]));for(P in H.vectors3)F.setVector3(P,Z.n.Tg(H.vectors3[P]));for(P in H.vectors4)F.setVector4(P,Z.q.Tg(H.vectors4[P]));for(P in H.quaternions)F.setQuaternion(P,Z.f.Tg(H.quaternions[P]));for(P in H.matrices)F.setMatrix(P,Z.d.Tg(H.matrices[P]));for(P in H.matrixArray)F._matrixArrays[P]=new Float32Array(H.matrixArray[P]);for(P in H.matrices3x3)F.setMatrix3x3(P,H.matrices3x3[P]);for(P in H.matrices2x2)F.setMatrix2x2(P,H.matrices2x2[P]);for(P in H.vectors2Arrays)F.setArray2(P,H.vectors2Arrays[P]);for(P in H.vectors3Arrays)F.setArray3(P,H.vectors3Arrays[P]);for(P in H.vectors4Arrays)F.setArray4(P,H.vectors4Arrays[P]);for(P in H.quaternionsArrays)F.setArray4(P,H.quaternionsArrays[P]);return F}static ParseFromFileAsync(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((F,P)=>{const S=new z.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const c=JSON.parse(S.responseText),P=this.Parse(c,y||h.b.LastCreatedScene,Z);H&&(P.name=H),F(P)}else P("Unable to load the ShaderMaterial")})),S.open("GET",c),S.send()}))}static ParseFromSnippetAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((Z,F)=>{const P=new z.c;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const F=JSON.parse(JSON.parse(P.responseText).jsonPayload),S=JSON.parse(F.shaderMaterial),n=this.Parse(S,c||h.b.LastCreatedScene,y);n.snippetId=H,Z(n)}else F("Unable to load the snippet "+H)})),P.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),P.send()}))}}J.SnippetUrl="https://snippet.babylonjs.com",J.CreateFromSnippetAsync=J.ParseFromSnippetAsync,(0,v.d)("BABYLON.ShaderMaterial",J),F.c._LinesMeshParser=(H,c)=>l.Parse(H,c);class l extends F.c{_isShaderMaterial(H){return"ShaderMaterial"===H.getClassName()}constructor(H){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0;super(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c,arguments.length>4?arguments[4]:void 0),this.useVertexColor=Z,this.useVertexAlpha=F,this.color=new S.e(1,1,1),this.alpha=1,this._shaderLanguage=0,c&&(this.color=c.color.clone(),this.alpha=c.alpha,this.useVertexColor=c.useVertexColor,this.useVertexAlpha=c.useVertexAlpha),this.intersectionThreshold=.1;const O={attributes:[n.h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===F?O.needAlphaBlending=!1:O.defines.push("#define VERTEXALPHA"),Z?(O.defines.push("#define VERTEXCOLOR"),O.attributes.push(n.h.ColorKind)):(O.uniforms.push("color"),this._color4=new S.h),P)this.material=P;else{this.va().getEngine().isWebGPU&&!l.ForceGLSL&&(this._shaderLanguage=1),O.shaderLanguage=this._shaderLanguage,O.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([y.e(23).then(y.bind(y,13669)),y.e(47).then(y.bind(y,13678))]):await Promise.all([y.e(28).then(y.bind(y,13684)),y.e(48).then(y.bind(y,13692))])},this.material=new J("colorShader",this.va(),"color",O,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(H){this._lineMaterial=H,this._lineMaterial.fillMode=a.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(H){}_bind(H,c){if(!this._geometry)return this;const y=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(c,y):this._geometry._bind(c,y,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:H,g:c,b:y}=this.color;this._color4.set(H,c,y,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(H,c,y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const Z=this.va().getEngine();return this._unIndexed?Z.drawArraysType(a.c.LineListDrawMode,H.verticesStart,H.verticesCount,y):Z.drawElementsType(a.c.LineListDrawMode,H.indexStart,H.indexCount,y),this}dispose(H){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(H)}clone(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;return new l(H,this.va(),c,this,y)}createInstance(H){const c=new d(H,this);if(this.instancedBuffers){c.instancedBuffers={};for(const H in this.instancedBuffers)c.instancedBuffers[H]=this.instancedBuffers[H]}return c}serialize(H){super.serialize(H),H.color=this.color.ij(),H.alpha=this.alpha}static Parse(H,c){const y=new l(H.name,c);return y.color=S.e.Tg(H.color),y.alpha=H.alpha,y}}l.ForceGLSL=!1;class d extends O.b{constructor(H,c){super(H,c),this.intersectionThreshold=c.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var K=y(10773);function T(H){const c=[],y=[],Z=H.lines,F=H.za,S=[];let n=0;for(let P=0;P<Z.length;P++){const H=Z[P];for(let Z=0;Z<H.length;Z++){const{x:O,y:a,z:i}=H[Z];if(y.push(O,a,i),F){const H=F[P],{r:c,g:y,b:n,a:O}=H[Z];S.push(c,y,n,O)}Z>0&&(c.push(n-1),c.push(n)),n++}}const O=new P.c;return O.indices=c,O.xa=y,F&&(O.za=S),O}function u(H){const c=H.dashSize||3,y=H.gapSize||1,F=H.dashNb||200,S=H.points,n=[],O=[],a=Z.n.Zero();let i=0,C=0,g=0,v=0,m=0,z=0,V=0;for(V=0;V<S.length-1;V++)S[V+1].subtractToRef(S[V],a),i+=a.length();for(g=i/F,v=c*g/(c+y),V=0;V<S.length-1;V++){S[V+1].subtractToRef(S[V],a),C=Math.floor(a.length()/g),a.normalize();for(let H=0;H<C;H++)m=g*H,n.push(S[V].x+m*a.x,S[V].y+m*a.y,S[V].z+m*a.z),n.push(S[V].x+(m+v)*a.x,S[V].y+(m+v)*a.y,S[V].z+(m+v)*a.z),O.push(z,z+1),z+=2}const h=new P.c;return h.xa=n,h.indices=O,h}function E(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=c.instance,F=c.lines,P=c.za;if(Z){const H=Z.getVerticesData(n.h.PositionKind);let c,y;P&&(c=Z.getVerticesData(n.h.ColorKind));let S=0,O=0;for(let Z=0;Z<F.length;Z++){const n=F[Z];for(let F=0;F<n.length;F++)H[S]=n[F].x,H[S+1]=n[F].y,H[S+2]=n[F].z,P&&c&&(y=P[Z],c[O]=y[F].r,c[O+1]=y[F].g,c[O+2]=y[F].b,c[O+3]=y[F].a,O+=4),S+=3}return Z.updateVerticesData(n.h.PositionKind,H,!1,!1),P&&c&&Z.updateVerticesData(n.h.ColorKind,c,!1,!1),Z.refreshBoundingInfo(),Z}const S=new l(H,y,null,void 0,void 0,!!P,c.useVertexAlpha,c.material);return T(c).Ca(S,c.updatable),S}function U(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=c.za?[c.za]:null;return E(H,{lines:[c.points],updatable:c.updatable,instance:c.instance,za:Z,useVertexAlpha:c.useVertexAlpha,material:c.material},y)}function G(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.points,S=c.instance,n=c.gapSize||1,O=c.dashSize||3;if(S){const H=H=>{const c=Z.n.Zero(),y=H.length/6;let F=0,n=0,O=0,a=0,i=0,C=0,g=0,v=0;for(g=0;g<P.length-1;g++)P[g+1].subtractToRef(P[g],c),F+=c.length();O=F/y;const m=S._creationDataStorage.dashSize;for(a=m*O/(m+S._creationDataStorage.gapSize),g=0;g<P.length-1;g++)for(P[g+1].subtractToRef(P[g],c),n=Math.floor(c.length()/O),c.normalize(),v=0;v<n&&C<H.length;)i=O*v,H[C]=P[g].x+i*c.x,H[C+1]=P[g].y+i*c.y,H[C+2]=P[g].z+i*c.z,H[C+3]=P[g].x+(i+a)*c.x,H[C+4]=P[g].y+(i+a)*c.y,H[C+5]=P[g].z+(i+a)*c.z,C+=6,v++;for(;C<H.length;)H[C]=P[g].x,H[C+1]=P[g].y,H[C+2]=P[g].z,C+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&K.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),S.updateMeshPositions(H,!1),S}const a=new l(H,y,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return u(c).Ca(a,c.updatable),a._creationDataStorage=new F.f,a._creationDataStorage.dashSize=O,a._creationDataStorage.gapSize=n,a}P.c.CreateLineSystem=T,P.c.CreateDashedLines=u,F.c.pb=function(H,c){return U(H,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},F.c.CreateDashedLines=function(H,c,y,Z,F){return G(H,{points:c,dashSize:y,gapSize:Z,dashNb:F,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11476:(H,c,y)=>{"use strict";y.d(c,{b:()=>n,f:()=>O});var Z=y(11354),F=y(11380),P=y(11324);function S(H){const c=[],y=[],Z=[],S=[],n=H.width||H.size||1,O=H.height||H.size||1,a=0===H.sideOrientation?0:H.sideOrientation||F.c.DEFAULTSIDE,i=n/2,C=O/2;y.push(-i,-C,0),Z.push(0,0,-1),S.push(0,P.d?1:0),y.push(i,-C,0),Z.push(0,0,-1),S.push(1,P.d?1:0),y.push(i,C,0),Z.push(0,0,-1),S.push(1,P.d?0:1),y.push(-i,C,0),Z.push(0,0,-1),S.push(0,P.d?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),F.c._ComputeSides(a,y,c,Z,S,H.frontUVs,H.backUVs);const g=new F.c;return g.indices=c,g.xa=y,g.ya=Z,g.Aa=S,g}function n(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new Z.c(H,y);c.sideOrientation=Z.c._GetDefaultSideOrientation(c.sideOrientation),F._originalBuilderSideOrientation=c.sideOrientation;return S(c).Ca(F,c.updatable),c.sourcePlane&&(F.translate(c.sourcePlane.k,-c.sourcePlane.d),F.setDirection(c.sourcePlane.k.scale(-1))),F}const O={cg:n};F.c.cg=S,Z.c.cg=(H,c,y,Z,F)=>n(H,{size:c,width:c,height:c,sideOrientation:F,updatable:Z},y)},11744:(H,c,y)=>{"use strict";y.d(c,{d:()=>O});var Z=y(11092),F=y(11354),P=y(11380),S=y(11324);function n(H){const c=0|(H.segments||32),y=H.diameterX||H.diameter||1,F=H.diameterY||H.diameter||1,n=H.diameterZ||H.diameter||1,O=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,a=H.slice&&H.slice<=0?1:H.slice||1,i=0===H.sideOrientation?0:H.sideOrientation||P.c.DEFAULTSIDE,C=!!H.dedupTopBottomIndices,g=new Z.n(y/2,F/2,n/2),v=2+c,m=2*v,z=[],V=[],h=[],Q=[];for(let P=0;P<=v;P++){const H=P/v,c=H*Math.PI*a;for(let y=0;y<=m;y++){const F=y/m,P=F*Math.PI*2*O,n=Z.d.RotationZ(-c),a=Z.d.RotationY(P),i=Z.n.TransformCoordinates(Z.n.Up(),n),C=Z.n.TransformCoordinates(i,a),v=C.multiply(g),z=C.divide(g).normalize();V.push(v.x,v.y,v.z),h.push(z.x,z.y,z.z),Q.push(F,S.d?1-H:H)}if(P>0){const H=V.length/3;for(let c=H-2*(m+1);c+m+2<H;c++)C?(P>1&&(z.push(c),z.push(c+1),z.push(c+m+1)),(P<v||a<1)&&(z.push(c+m+1),z.push(c+1),z.push(c+m+2))):(z.push(c),z.push(c+1),z.push(c+m+1),z.push(c+m+1),z.push(c+1),z.push(c+m+2))}}P.c._ComputeSides(i,V,z,h,Q,H.frontUVs,H.backUVs);const D=new P.c;return D.indices=z,D.xa=V,D.ya=h,D.Aa=Q,D}function O(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return n(c).Ca(Z,c.updatable),Z}P.c.CreateSphere=n,F.c.CreateSphere=(H,c,y,Z,F,P)=>O(H,{segments:c,diameterX:y,diameterY:y,diameterZ:y,sideOrientation:P,updatable:F},Z)},12367:(H,c,y)=>{"use strict";y.d(c,{e:()=>C});var Z=y(10754),F=y(12372),P=y(11385),S=y(11153),n=y(11380),O=y(10773);function a(H,c,y,Z,F){let P=null,S=null,n=null;try{let O;P=new H.Decoder,S=new H.DecoderBuffer,S.Init(c,c.byteLength);const a=P.GetEncodedGeometryType(S);switch(a){case H.TRIANGULAR_MESH:{const c=new H.Mesh;if(O=P.DecodeBufferToMesh(S,c),!O.ok()||0===c.ptr)throw new Error(O.error_msg());const y=3*c.num_faces(),F=4*y,a=H._malloc(F);try{P.GetTrianglesUInt32Array(c,F,a);const S=new Uint32Array(y);S.set(new Uint32Array(H.HEAPF32.buffer,a,y)),Z(S)}finally{H._free(a)}n=c;break}case H.POINT_CLOUD:{const c=new H.PointCloud;if(O=P.DecodeBufferToPointCloud(S,c),!O.ok()||!c.ptr)throw new Error(O.error_msg());n=c;break}default:throw new Error(`Invalid geometry type ${a}`)}const i=n.num_points(),C=(c,y,Z,P)=>{const S=P.data_type(),n=P.num_components(),O=P.normalized(),a=P.byte_stride(),C=P.byte_offset(),g={[H.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:H.HEAPF32},[H.DT_INT8]:{typedArrayConstructor:Int8Array,heap:H.HEAP8},[H.DT_INT16]:{typedArrayConstructor:Int16Array,heap:H.HEAP16},[H.DT_INT32]:{typedArrayConstructor:Int32Array,heap:H.HEAP32},[H.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:H.HEAPU8},[H.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:H.HEAPU16},[H.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:H.HEAPU32}}[S];if(!g)throw new Error(`Invalid data type ${S}`);const v=i*n,m=v*g.typedArrayConstructor.BYTES_PER_ELEMENT,z=H._malloc(m);try{c.GetAttributeDataArrayForAllPoints(y,P,S,m,z);const H=new g.typedArrayConstructor(g.heap.buffer,z,v);F(Z,H.slice(),n,C,a,O)}finally{H._free(z)}};if(y)for(const H in y){const c=y[H],Z=P.GetAttributeByUniqueId(n,c);C(P,n,H,Z)}else{const c={position:H.POSITION,k:H.NORMAL,color:H.COLOR,uv:H.TEX_COORD};for(const H in c){const y=P.GetAttributeId(n,c[H]);if(-1!==y){const c=P.GetAttribute(n,y);C(P,n,H,c)}}}return i}finally{n&&H.destroy(n),S&&H.destroy(S),P&&H.destroy(P)}}function i(){let H;onmessage=c=>{const y=c.data;switch(y.id){case"init":{const c=y.decoder;c.url&&importScripts(c.url);const Z=c.wasmBinary?{wasmBinary:c.wasmBinary}:{};H=DracoDecoderModule(Z),postMessage({id:"initDone"});break}case"decodeMesh":if(!H)throw new Error("Draco decoder module is not available");H.then((H=>{const c=a(H,y.dataView,y.attributes,(H=>{postMessage({id:"indices",data:H},[H.buffer])}),((H,c,y,Z,F,P)=>{postMessage({id:"attribute",kind:H,data:c,size:y,byteOffset:Z,byteStride:F,normalized:P},[c.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:c})}))}}}class C{static get DecoderAvailable(){const H=C.Configuration.decoder;return!!(H.wasmUrl&&H.wasmBinaryUrl&&"object"===typeof WebAssembly||H.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return C._Default||(C._Default=new C),C._Default}static ResetDefault(H){C._Default&&(H||C._Default.dispose(),C._Default=null)}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultNumWorkers;const c=C.Configuration.decoder;if(c.workerPool||"object"===typeof H&&H.workerPool)this._workerPoolPromise=Promise.resolve(c.workerPool||H.workerPool);else{const y=c.wasmBinary||"object"===typeof H&&H.wasmBinary,P="number"===typeof H?H:H.numWorkers,S=P&&"function"===typeof Worker&&"function"===typeof URL,n=S||!S&&!c.jsModule,O=c.wasmUrl&&c.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:n?Z.c.GetBabylonScriptURL(c.wasmUrl,!0):"",wasmBinaryPromise:y?Promise.resolve(y):Z.c.LoadFileAsync(Z.c.GetBabylonScriptURL(c.wasmBinaryUrl,!0))}:{url:n?Z.c.GetBabylonScriptURL(c.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};S?this._workerPoolPromise=O.wasmBinaryPromise.then((H=>{const c=`${a}(${i})()`,y=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));return new F.d(P,(()=>function(H,c,y){return new Promise(((Z,F)=>{const P=c=>{H.removeEventListener("error",P),H.removeEventListener("message",S),F(c)},S=c=>{"initDone"===c.data.id&&(H.removeEventListener("error",P),H.removeEventListener("message",S),Z(H))};if(H.addEventListener("error",P),H.addEventListener("message",S),c){const Z=c.slice(0);H.postMessage({id:"init",decoder:{url:y,wasmBinary:Z}},[Z])}else H.postMessage({id:"init",decoder:{url:y}})}))}(new Worker(y),H,O.url)))})):this._decoderModulePromise=O.wasmBinaryPromise.then((async H=>{if("undefined"===typeof DracoDecoderModule&&!c.jsModule){if(!O.url)throw new Error("Draco decoder module is not available");await Z.c.LoadBabylonScriptAsync(O.url)}return await(y=H,F=c.jsModule,new Promise((H=>{(F||DracoDecoderModule)({wasmBinary:y}).then((c=>{H({module:c})}))})));var y,F}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((H=>{H.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(H,c,y){const Z=H instanceof ArrayBuffer?new Int8Array(H):new Int8Array(H.buffer,H.byteOffset,H.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((H=>new Promise(((F,P)=>{H.push(((H,S)=>{let n=null;const a=[],i=c=>{H.removeEventListener("error",i),H.removeEventListener("message",C),P(c),S()},C=c=>{const Z=c.data;switch(Z.id){case"decodeMeshDone":H.removeEventListener("error",i),H.removeEventListener("message",C),F({indices:n,attributes:a,totalVertices:Z.totalVertices}),S();break;case"indices":n=Z.data;break;case"attribute":a.push({kind:Z.kind,data:Z.data,size:Z.size,byteOffset:Z.byteOffset,byteStride:Z.byteStride,normalized:(P=Z.kind,g=Z.normalized,y&&void 0!==y[P]?(g!==y[P]&&O.d.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${y[P]}). Using flag from glTF accessor.`),y[P]):g)})}var P,g};H.addEventListener("error",i),H.addEventListener("message",C);const g=Z.slice();H.postMessage({id:"decodeMesh",dataView:g,attributes:c},[g.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((H=>{let y=null;const F=[],P=a(H.module,Z,c,(H=>{y=H}),((H,c,y,Z,P,S)=>{F.push({kind:H,data:c,size:y,byteOffset:Z,byteStride:P,normalized:S})}));return{indices:y,attributes:F,totalVertices:P}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(H,c,y,Z){const F=await this.decodeMeshToMeshDataAsync(y,Z),n=new P.d(H,c);F.indices&&n.setIndices(F.indices);for(const P of F.attributes)n.setVerticesBuffer(new S.h(c.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),F.totalVertices);return n}async _decodeMeshToGeometryForGltfAsync(H,c,y,Z,F){const n=await this.decodeMeshToMeshDataAsync(y,Z,F),O=new P.d(H,c);n.indices&&O.setIndices(n.indices);for(const P of n.attributes)O.setVerticesBuffer(new S.h(c.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),n.totalVertices);return O}async decodeMeshAsync(H,c){const y=await this.decodeMeshToMeshDataAsync(H,c),Z=new n.c;y.indices&&(Z.indices=y.indices);for(const F of y.attributes){const H=S.h.GetFloatData(F.data,F.size,S.h.GetDataType(F.data),F.byteOffset,F.byteStride,F.normalized,y.totalVertices);Z.set(H,F.kind)}return Z}}C.Configuration={decoder:{wasmUrl:`${Z.c._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Z.c._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Z.c._DefaultCdnUrl}/draco_decoder_gltf.js`}},C.DefaultNumWorkers=C.GetDefaultNumWorkers(),C._Default=null},11547:(H,c,y)=>{"use strict";y.d(c,{e:()=>F});var Z=y(11159);class F extends Z.d{constructor(H){super(),this._buffer=H}get underlyingResource(){return this._buffer}}},11399:(H,c,y)=>{"use strict";y.d(c,{d:()=>d});var Z=y(11052),F=y(10763),P=y(11092),S=y(11153),n=y(11380),O=y(11403),a=y(11146),i=y(11256),C=y(11140);class g{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new P.n(0,0,0),this._diffPositionForCollisions=new P.n(0,0,0),this._collisionResponse=!0}}var v=y(10798),m=y(11275),z=y(11112),V=y(11094),h=y(11410),Q=y(10893),D=y(11061),f=y(10850);class J{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=P.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class l{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new J,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new g,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class d extends O.c{static get BILLBOARDMODE_NONE(){return O.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return O.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return O.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return O.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return O.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return O.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(H){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=H}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(H){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=H}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(H){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=H}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(H){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=H}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(H){this._internalAbstractMeshDataInfo._collisionRetryCount=H}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(H){this._internalAbstractMeshDataInfo._morphTargetManager!==H&&(this._internalAbstractMeshDataInfo._morphTargetManager=H,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(H){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==H&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=H,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(H){return!!super._updateNonUniformScalingState(H)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(H){this._internalAbstractMeshDataInfo._rawBoundingInfo=H}set Ik(H){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(H)}set onCollisionPositionChange(H){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(H)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(H){if(this._internalAbstractMeshDataInfo._visibility===H)return;const c=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=H,(1===c&&1!==H||1!==c&&1===H)&&this._markSubMeshesAsDirty((H=>{H.markAsMiscDirty(),H.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(H){this._internalAbstractMeshDataInfo._inheritVisibility=H}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let H=this._parentNode;for(;H;){const c=H.isVisible;if("undefined"!==typeof c)return c;H=H.parent}}return this._isVisible}set isVisible(H){this._isVisible=H}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(H){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=H}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(H){this._internalAbstractMeshDataInfo._renderingGroupId=H}get material(){return this._internalAbstractMeshDataInfo._material}set material(H){this._setMaterial(H)}_setMaterial(H){this._internalAbstractMeshDataInfo._material!==H&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=H,H&&H.meshMap&&(H.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.$f&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(H){var c;return null===(c=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===c?void 0:c[H]}setMaterialForRenderPass(H,c){this.resetDrawCache(H),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[H]=c}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(H){this._internalAbstractMeshDataInfo._receiveShadows!==H&&(this._internalAbstractMeshDataInfo._receiveShadows=H,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(H){this._internalAbstractMeshDataInfo._hasVertexAlpha!==H&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=H,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(H){this._internalAbstractMeshDataInfo._useVertexColors!==H&&(this._internalAbstractMeshDataInfo._useVertexColors=H,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(H){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==H&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=H,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(H){this._internalAbstractMeshDataInfo._numBoneInfluencers!==H&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=H,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(H){this._internalAbstractMeshDataInfo._applyFog!==H&&(this._internalAbstractMeshDataInfo._applyFog=H,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(H){this._internalAbstractMeshDataInfo._enableDistantPicking=H}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(H){H!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=H,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(H){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(H)?-1:H}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(H){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=H}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(H){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(H)?-1:H}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(H){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=H}get lightSources(){return this._lightSources}set skeleton(H){const c=this._internalAbstractMeshDataInfo._skeleton;c&&c.needInitialSkinMatrix&&c._unregisterMeshWithPoseMatrix(this),H&&H.needInitialSkinMatrix&&H._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=H,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(H){var c;let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(H,y,!1),c=this,this._internalAbstractMeshDataInfo=new l,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Di=d.Ei,this.onCollideObservable=new F.e,this.onCollisionPositionChangeObservable=new F.e,this.onMaterialChangedObservable=new F.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Qb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=z.e.Red(),this.outlineWidth=.02,this.overlayColor=z.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.tb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new P.n(.5,1,.5),this.ellipsoidOffset=new P.n(0,0,0),this.edgesWidth=1,this.edgesColor=new z.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Kc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new F.e,this._onCollisionPositionChange=function(H,y){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.subtractToRef(c._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>f.e.CollisionsEpsilon&&c.position.addInPlace(c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Z&&c.onCollideObservable.notifyObservers(Z),c.onCollisionPositionChangeObservable.notifyObservers(c.position)},y=this.va(),y.li(this),this._resyncLightSources(),this._uniformBuffer=new C.e(this.va().getEngine(),void 0,void 0,H,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),y.performancePriority){case 2:this.Da=!0;case 1:this.tb=!0,this.Qb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(H){const c=this._uniformBuffer;c.Hj("world",H),c.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),c.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(H){let c="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");c+=", # of submeshes: "+(this.$f?this.$f.length:0);const y=this._internalAbstractMeshDataInfo._skeleton;return y&&(c+=", skeleton: "+y.name),H&&(c+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],c+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Kc?"YES":"NO")),c}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==O.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(c||this.actionManager.isRecursive)){if(!H)return this.actionManager;if(this.actionManager.hasSpecificTrigger(H))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(H,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.$f){for(const H of this.$f)H._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const H of this.va().lights)H.isEnabled()&&H.canAffectMesh(this)&&this._lightSources.push(H);this._markSubMeshesAsLightDirty()}_resyncLightSource(H){const c=H.isEnabled()&&H.canAffectMesh(this),y=this._lightSources.indexOf(H);let Z=!1;if(-1===y){if(!c)return;this._lightSources.push(H)}else{if(c)return;Z=!0,this._lightSources.splice(y,1)}this._markSubMeshesAsLightDirty(Z)}_unBindEffect(){for(const H of this.$f)H.setEffect(null)}_removeLightSource(H,c){const y=this._lightSources.indexOf(H);-1!==y&&(this._lightSources.splice(y,1),this._markSubMeshesAsLightDirty(c))}_markSubMeshesAsDirty(H){if(this.$f)for(const c of this.$f)for(let y=0;y<c._drawWrappers.length;++y){const Z=c._drawWrappers[y];Z&&Z.defines&&Z.defines.markAllAsDirty&&H(Z.defines)}}_markSubMeshesAsLightDirty(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((c=>c.markAsLightDirty(H)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((H=>H.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((H=>H.markAsMiscDirty()))}Fg(H){return this._currentRenderId=Number.MAX_VALUE,super.Fg(H),this._isDirty=!0,this}resetDrawCache(H){if(this.$f)for(const c of this.$f)c.resetDrawCache(H)}get isBlocked(){return!1}getLOD(H){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Vf(){return null}getVerticesData(H){return null}Ga(H,c,y,Z){return this}updateVerticesData(H,c,y,Z){return this}setIndices(H,c){return this}isVerticesDataPresent(H){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(H){return this._boundingInfo=H,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(H,c,y){return this._boundingInfo=new i.b(H,c,y),this._boundingInfo}normalizeToUnitCube(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(H,c,y)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(S.h.MatricesIndicesKind)&&this.isVerticesDataPresent(S.h.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(H){}_activate(H,c){return this._renderId=H,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===O.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(H,c,y){return this.position.addInPlace(this.calcMovePOV(H,c,y)),this}calcMovePOV(H,c,y){const Z=new P.d;(this.rotationQuaternion?this.rotationQuaternion:P.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(Z);const F=P.n.Zero(),S=this.definedFacingForward?-1:1;return P.n.TransformCoordinatesFromFloatsToRef(H*S,c,y*S,Z,F),F}rotatePOV(H,c,y){return this.rotation.addInPlace(this.calcRotatePOV(H,c,y)),this}calcRotatePOV(H,c,y){const Z=this.definedFacingForward?1:-1;return new P.n(H*Z,c,y*Z)}Fa(H,c){if(H){const y=(0,m.d)(H,0,this.getTotalVertices(),c);this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new i.b(y.minimum,y.maximum)}if(this.$f)for(let y=0;y<this.$f.length;y++)this.$f[y].refreshBoundingInfo(H);this.Ea()}_refreshBoundingInfoDirect(H){if(this._boundingInfo?this._boundingInfo.reConstruct(H.minimum,H.maximum):this._boundingInfo=new i.b(H.minimum,H.maximum),this.$f)for(let c=0;c<this.$f.length;c++)this.$f[c].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(H,c,y,Z,F,n,O){!function(H,c,y,Z,F,n,O){const a=P.h.o[0],i=P.h.Matrix[0],C=P.h.Matrix[1],g=c===S.h.NormalKind?P.n.TransformNormalFromFloatsToRef:P.n.TransformCoordinatesFromFloatsToRef;for(let S=0,v=0;S<H.length;S+=3,v+=4){let c,m;for(i.reset(),c=0;c<4;c++)m=F[v+c],m>0&&(P.d.FromFloat32ArrayToRefScaled(y,Math.floor(16*Z[v+c]),m,C),i.addToSelf(C));if(n&&O)for(c=0;c<4;c++)m=O[v+c],m>0&&(P.d.FromFloat32ArrayToRefScaled(y,Math.floor(16*n[v+c]),m,C),i.addToSelf(C));g(H[S],H[S+1],H[S+2],i,a),a.toArray(H,S)}}(H,c,y,Z,F,n,O)}_getData(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.h.PositionKind;const Z=H.cache,F=H=>{if(Z){const c=Z._vertexData||(Z._vertexData={});return c[H]||this.copyVerticesData(H,c),c[H]}return this.getVerticesData(H)};if(c||(c=F(y)),!c)return null;if(Z?(Z._outputData?Z._outputData.set(c):Z._outputData=new Float32Array(c),c=Z._outputData):(H.applyMorph&&this.morphTargetManager||H.applySkeleton&&this.skeleton)&&(c=c.slice()),H.applyMorph&&this.morphTargetManager&&function(H,c,y){let Z=null;switch(c){case S.h.PositionKind:Z=H=>H.getPositions();break;case S.h.NormalKind:Z=H=>H.getNormals();break;case S.h.TangentKind:Z=H=>H.getTangents();break;case S.h.UVKind:Z=H=>H.getUVs();break;default:return}for(let F=0;F<H.length;F++){let c=H[F];for(let P=0;P<y.numTargets;P++){const S=y.getTarget(P),n=S.influence;if(0!==n){const y=Z(S);y&&(c+=(y[F]-H[F])*n)}}H[F]=c}}(c,y,this.morphTargetManager),H.applySkeleton&&this.skeleton){const H=F(S.h.MatricesIndicesKind),Z=F(S.h.MatricesWeightsKind);if(Z&&H){const P=this.numBoneInfluencers>4,n=P?F(S.h.MatricesIndicesExtraKind):null,O=P?F(S.h.MatricesWeightsExtraKind):null,a=this.skeleton.getTransformMatrices(this);d._ApplySkeleton(c,y,a,H,Z,n,O)}}if(!1!==H.updatePositionsArray&&y===S.h.PositionKind){const H=this._internalAbstractMeshDataInfo._positions||[],y=H.length;if(H.length=c.length/3,y<H.length)for(let c=y;c<H.length;c++)H[c]=new P.n;for(let Z=0,F=0;Z<H.length;Z++,F+=3)H[Z].be(c[F],c[F+1],c[F+2]);this._internalAbstractMeshDataInfo._positions=H}return c}getNormalsData(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:H,applyMorph:c,updatePositionsArray:!1},null,S.h.NormalKind)}Od(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:H,applyMorph:c,updatePositionsArray:!1},y,S.h.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new i.b(P.n.Zero(),P.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(H){if(!this.$f)return this;const c=this.$f.length;for(let y=0;y<c;y++){const Z=this.$f[y];(c>1||!Z.IsGlobal)&&Z.updateBoundingInfo(H)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(H){return this.getBoundingInfo().isInFrustum(H,this.Di)}isCompletelyInFrustum(H){return this.getBoundingInfo().isCompletelyInFrustum(H)}intersectsMesh(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;const Z=this.getBoundingInfo(),F=H.getBoundingInfo();if(Z.intersects(F,c))return!0;if(y)for(const P of this.getChildMeshes())if(P.intersectsMesh(H,c,!0))return!0;return!1}intersectsPoint(H){return this.getBoundingInfo().intersectsPoint(H)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(H){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=H}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(H){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const c=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=c.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,c.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,H,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(H,c,y){var Z;if(this._generatePointsArray(),!this._positions)return this;if(!H._lastColliderWorldVertices||!H._lastColliderTransformMatrix.equals(c)){H._lastColliderTransformMatrix=c.clone(),H._lastColliderWorldVertices=[],H._trianglePlanes=[];const y=H.verticesStart,Z=H.verticesStart+H.verticesCount;for(let F=y;F<Z;F++)H._lastColliderWorldVertices.push(P.n.TransformCoordinates(this._positions[F],c))}return y._collide(H._trianglePlanes,H._lastColliderWorldVertices,this.Vf(),H.indexStart,H.indexStart+H.indexCount,H.verticesStart,!!H.Ha(),this,this._shouldConvertRHS(),7===(null===(Z=H.Ha())||void 0===Z?void 0:Z.fillMode)),this}_processCollisionsForSubMeshes(H,c){const y=this._scene.getCollidingSubMeshCandidates(this,H),Z=y.length;for(let F=0;F<Z;F++){const P=y.data[F];Z>1&&!P._checkCollision(H)||this._collideForSubMesh(P,c,H)}return this}_shouldConvertRHS(){return!1}_checkCollision(H){if(!this.getBoundingInfo()._checkCollision(H))return this;const c=P.h.Matrix[0],y=P.h.Matrix[1];return P.d.ScalingToRef(1/H._radius.x,1/H._radius.y,1/H._radius.z,c),this.worldMatrixFromCache.multiplyToRef(c,y),this._processCollisionsForSubMeshes(H,y),this}_generatePointsArray(){return!1}intersects(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=new a.d,O=this.getClassName(),i="InstancedLinesMesh"===O||"LinesMesh"===O||"GreasedLineMesh"===O?this.intersectionThreshold:0,C=this.getBoundingInfo();if(!this.$f)return n;if(!S&&(!H.intersectsSphere(C.boundingSphere,i)||!H.intersectsBox(C.boundingBox,i)))return n;if(Z)return n.hit=!S,n.pickedMesh=S?null:this,n.distance=S?0:P.n.Distance(H.origin,C.boundingSphere.center),n.subMeshId=0,n;if(!this._generatePointsArray())return n;let g=null;const v=this._scene.getIntersectingSubMeshCandidates(this,H),m=v.length;let z=!1;for(let P=0;P<m;P++){const H=v.data[P].Ha();if(H&&(7==H.fillMode||0==H.fillMode||1==H.fillMode||2==H.fillMode||4==H.fillMode)){z=!0;break}}if(!z)return n.hit=!0,n.pickedMesh=this,n.distance=P.n.Distance(H.origin,C.boundingSphere.center),n.subMeshId=-1,n;for(let P=0;P<m;P++){const Z=v.data[P];if(m>1&&!S&&!Z.canIntersects(H))continue;const F=Z.intersects(H,this._positions,this.Vf(),c,y);if(F&&(c||!g||F.distance<g.distance)&&(g=F,g.subMeshId=P,c))break}if(g){const c=F??this.getWorldMatrix(),y=P.h.o[0],Z=P.h.o[1];P.n.TransformCoordinatesToRef(H.origin,c,y),H.direction.scaleToRef(g.distance,Z);const S=P.n.TransformNormal(Z,c).addInPlace(y);return n.hit=!0,n.distance=P.n.Distance(y,S),n.pickedPoint=S,n.pickedMesh=this,n.bu=g.bu||0,n.bv=g.bv||0,n.subMeshFaceId=g.faceId,n.faceId=g.faceId+v.data[g.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),n.subMeshId=g.subMeshId,n}return n}clone(H,c,y){return null}releaseSubMeshes(){if(this.$f)for(;this.$f.length;)this.$f[0].dispose();else this.$f=[];return this}dispose(H){let c,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Z=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),Z.freeActiveMeshes(),Z.freeRenderingGroups(),Z.renderingManager.maintainStateBetweenFrames&&Z.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((H=>H!==this&&H.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),c=0;c<this._intersectionsInProgress.length;c++){const H=this._intersectionsInProgress[c],y=H._intersectionsInProgress.indexOf(this);H._intersectionsInProgress.splice(y,1)}this._intersectionsInProgress.length=0;Z.lights.forEach((H=>{let c=H.includedOnlyMeshes.indexOf(this);-1!==c&&H.includedOnlyMeshes.splice(c,1),c=H.excludedMeshes.indexOf(this),-1!==c&&H.excludedMeshes.splice(c,1);const y=H.getShadowGenerators();if(y){const H=y.values();for(let y=H.next();!0!==y.done;y=H.next()){const H=y.value.getShadowMap();H&&H.renderList&&(c=H.renderList.indexOf(this),-1!==c&&H.renderList.splice(c,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const F=Z.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,F.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),F.wipeCaches(),Z.sd(this),this._parentContainer){const H=this._parentContainer.meshes.indexOf(this);H>-1&&this._parentContainer.meshes.splice(H,1),this._parentContainer=null}if(y&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!H)for(c=0;c<Z.qj.length;c++)Z.qj[c].j===this&&(Z.qj[c].dispose(),c--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(H,y)}_initFacetData(){const H=this._internalAbstractMeshDataInfo._facetData;H.facetNormals||(H.facetNormals=[]),H.facetPositions||(H.facetPositions=[]),H.facetPartitioning||(H.facetPartitioning=new Array),H.facetNb=this.Vf().length/3|0,H.partitioningSubdivisions=H.partitioningSubdivisions?H.partitioningSubdivisions:10,H.partitioningBBoxRatio=H.partitioningBBoxRatio?H.partitioningBBoxRatio:1.01;for(let c=0;c<H.facetNb;c++)H.facetNormals[c]=P.n.Zero(),H.facetPositions[c]=P.n.Zero();return H.facetDataEnabled=!0,this}updateFacetData(){const H=this._internalAbstractMeshDataInfo._facetData;H.facetDataEnabled||this._initFacetData();const c=this.getVerticesData(S.h.PositionKind),y=this.Vf(),Z=this.getVerticesData(S.h.NormalKind),F=this.getBoundingInfo();if(H.facetDepthSort&&!H.facetDepthSortEnabled){if(H.facetDepthSortEnabled=!0,y instanceof Uint16Array)H.depthSortedIndices=new Uint16Array(y);else if(y instanceof Uint32Array)H.depthSortedIndices=new Uint32Array(y);else{let c=!1;for(let H=0;H<y.length;H++)if(y[H]>65535){c=!0;break}H.depthSortedIndices=c?new Uint32Array(y):new Uint16Array(y)}if(H.facetDepthSortFunction=function(H,c){return c.sqDistance-H.sqDistance},!H.facetDepthSortFrom){const c=this.va().activeCamera;H.facetDepthSortFrom=c?c.position:P.n.Zero()}H.depthSortedFacets=[];for(let c=0;c<H.facetNb;c++){const y={ind:3*c,sqDistance:0};H.depthSortedFacets.push(y)}H.invertedMatrix=P.d.Identity(),H.facetDepthSortOrigin=P.n.Zero()}H.bbSize.x=F.maximum.x-F.minimum.x>V.e?F.maximum.x-F.minimum.x:V.e,H.bbSize.y=F.maximum.y-F.minimum.y>V.e?F.maximum.y-F.minimum.y:V.e,H.bbSize.z=F.maximum.z-F.minimum.z>V.e?F.maximum.z-F.minimum.z:V.e;let O=H.bbSize.x>H.bbSize.y?H.bbSize.x:H.bbSize.y;if(O=O>H.bbSize.z?O:H.bbSize.z,H.subDiv.max=H.partitioningSubdivisions,H.subDiv.X=Math.floor(H.subDiv.max*H.bbSize.x/O),H.subDiv.Y=Math.floor(H.subDiv.max*H.bbSize.y/O),H.subDiv.Z=Math.floor(H.subDiv.max*H.bbSize.z/O),H.subDiv.X=H.subDiv.X<1?1:H.subDiv.X,H.subDiv.Y=H.subDiv.Y<1?1:H.subDiv.Y,H.subDiv.Z=H.subDiv.Z<1?1:H.subDiv.Z,H.facetParameters.facetNormals=this.getFacetLocalNormals(),H.facetParameters.facetPositions=this.getFacetLocalPositions(),H.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),H.facetParameters.bInfo=F,H.facetParameters.bbSize=H.bbSize,H.facetParameters.subDiv=H.subDiv,H.facetParameters.ratio=this.partitioningBBoxRatio,H.facetParameters.depthSort=H.facetDepthSort,H.facetDepthSort&&H.facetDepthSortEnabled&&(this.Oj(!0),this._worldMatrix.invertToRef(H.invertedMatrix),P.n.TransformCoordinatesToRef(H.facetDepthSortFrom,H.invertedMatrix,H.facetDepthSortOrigin),H.facetParameters.distanceTo=H.facetDepthSortOrigin),H.facetParameters.depthSortedFacets=H.depthSortedFacets,Z&&n.c.ComputeNormals(c,y,Z,H.facetParameters),H.facetDepthSort&&H.facetDepthSortEnabled){H.depthSortedFacets.sort(H.facetDepthSortFunction);const c=H.depthSortedIndices.length/3|0;for(let Z=0;Z<c;Z++){const c=H.depthSortedFacets[Z].ind;H.depthSortedIndices[3*Z]=y[c],H.depthSortedIndices[3*Z+1]=y[c+1],H.depthSortedIndices[3*Z+2]=y[c+2]}this.updateIndices(H.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const H=this._internalAbstractMeshDataInfo._facetData;return H.facetNormals||this.updateFacetData(),H.facetNormals}getFacetLocalPositions(){const H=this._internalAbstractMeshDataInfo._facetData;return H.facetPositions||this.updateFacetData(),H.facetPositions}getFacetLocalPartitioning(){const H=this._internalAbstractMeshDataInfo._facetData;return H.facetPartitioning||this.updateFacetData(),H.facetPartitioning}getFacetPosition(H){const c=P.n.Zero();return this.getFacetPositionToRef(H,c),c}getFacetPositionToRef(H,c){const y=this.getFacetLocalPositions()[H],Z=this.getWorldMatrix();return P.n.TransformCoordinatesToRef(y,Z,c),this}getFacetNormal(H){const c=P.n.Zero();return this.getFacetNormalToRef(H,c),c}getFacetNormalToRef(H,c){const y=this.getFacetLocalNormals()[H];return P.n.TransformNormalToRef(y,this.getWorldMatrix(),c),this}getFacetsAtLocalCoordinates(H,c,y){const Z=this.getBoundingInfo(),F=this._internalAbstractMeshDataInfo._facetData,P=Math.floor((H-Z.minimum.x*F.partitioningBBoxRatio)*F.subDiv.X*F.partitioningBBoxRatio/F.bbSize.x),S=Math.floor((c-Z.minimum.y*F.partitioningBBoxRatio)*F.subDiv.Y*F.partitioningBBoxRatio/F.bbSize.y),n=Math.floor((y-Z.minimum.z*F.partitioningBBoxRatio)*F.subDiv.Z*F.partitioningBBoxRatio/F.bbSize.z);return P<0||P>F.subDiv.max||S<0||S>F.subDiv.max||n<0||n>F.subDiv.max?null:F.facetPartitioning[P+F.subDiv.max*S+F.subDiv.max*F.subDiv.max*n]}getClosestFacetAtCoordinates(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const n=this.getWorldMatrix(),O=P.h.Matrix[5];n.invertToRef(O);const a=P.h.o[8];P.n.TransformCoordinatesFromFloatsToRef(H,c,y,O,a);const i=this.getClosestFacetAtLocalCoordinates(a.x,a.y,a.z,Z,F,S);return Z&&P.n.TransformCoordinatesFromFloatsToRef(Z.x,Z.y,Z.z,n,Z),i}getClosestFacetAtLocalCoordinates(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=null,n=0,O=0,a=0,i=0,C=0,g=0,v=0,m=0;const z=this.getFacetLocalPositions(),V=this.getFacetLocalNormals(),h=this.getFacetsAtLocalCoordinates(H,c,y);if(!h)return null;let Q,D,f,J=Number.MAX_VALUE,l=J;for(let d=0;d<h.length;d++)Q=h[d],D=V[Q],f=z[Q],i=(H-f.x)*D.x+(c-f.y)*D.y+(y-f.z)*D.z,(!F||F&&P&&i>=0||F&&!P&&i<=0)&&(i=D.x*f.x+D.y*f.y+D.z*f.z,C=-(D.x*H+D.y*c+D.z*y-i)/(D.x*D.x+D.y*D.y+D.z*D.z),g=H+D.x*C,v=c+D.y*C,m=y+D.z*C,n=g-H,O=v-c,a=m-y,l=n*n+O*O+a*a,l<J&&(J=l,S=Q,Z&&(Z.x=g,Z.y=v,Z.z=m)));return S}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const H=this._internalAbstractMeshDataInfo._facetData;return H.facetDataEnabled&&(H.facetDataEnabled=!1,H.facetPositions=[],H.facetNormals=[],H.facetPartitioning=new Array,H.facetParameters=null,H.depthSortedIndices=new Uint32Array(0)),this}updateIndices(H,c){return this}createNormals(H){const c=this.getVerticesData(S.h.PositionKind),y=this.Vf();let Z;return Z=this.isVerticesDataPresent(S.h.NormalKind)?this.getVerticesData(S.h.NormalKind):[],n.c.ComputeNormals(c,y,Z,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(S.h.NormalKind,Z,H),this}alignWithNormal(H,c){c||(c=h.e.Y);const y=P.h.o[0],Z=P.h.o[1];return P.n.CrossToRef(c,H,Z),P.n.CrossToRef(H,Z,y),this.rotationQuaternion?P.f.RotationQuaternionFromAxisToRef(y,H,Z,this.rotationQuaternion):P.n.RotationFromAxisToRef(y,H,Z,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,v.b)("EdgesRenderer")}enableEdgesRendering(H,c,y){throw(0,v.b)("EdgesRenderer")}rj(){return this._scene.qj.filter((H=>H.j===this))}}d.OCCLUSION_TYPE_NONE=0,d.OCCLUSION_TYPE_OPTIMISTIC=1,d.OCCLUSION_TYPE_STRICT=2,d.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,d.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,d.CULLINGSTRATEGY_STANDARD=0,d.Ei=1,d.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,d.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,Z.b)([D.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z,F,P,S,n]=c;return!Array.isArray(Z)&&!Array.isArray(F)&&!Array.isArray(P)&&!Array.isArray(S)&&!Array.isArray(n)}))],d,"_ApplySkeleton",null),(0,Q.d)("BABYLON.AbstractMesh",d)},11385:(H,c,y)=>{"use strict";y.d(c,{d:()=>V});var Z=y(11092),F=y(11112),P=y(11380),S=y(11153),n=y(11245),O=y(11392),a=y(11256),i=y(10754),C=y(11083),g=y(11275),v=y(10810),m=y(11324),z=y(10773);class V{get boundingBias(){return this._boundingBias}set boundingBias(H){this._boundingBias?this._boundingBias.p(H):this._boundingBias=H.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(H){const c=new V(V.RandomId(),H.va());return c.Ca(H),c}get meshes(){return this._meshes}constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=c||v.b.LastCreatedScene,this._scene&&(this.id=H,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=Z,y?this.setAllVerticesData(y,Z):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),F&&(this.Ca(F),F.Oj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let H=0;H<this._meshes.length;H++)if(!this._meshes[H].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const H=new Set;for(const c in this._vertexBuffers)H.add(this._vertexBuffers[c].getWrapperBuffer());H.forEach((H=>{H._rebuild()}))}setAllVerticesData(H,c){H.applyToGeometry(this,c),this._notifyUpdate()}Ga(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;y&&Array.isArray(c)&&(c=new Float32Array(c));const F=new S.h(this._engine,c,H,{updatable:y,postponeInternalCreation:0===this._meshes.length,stride:Z,label:"Geometry_"+this.id+"_"+H});this.setVerticesBuffer(F)}removeVerticesData(H){this._vertexBuffers[H]&&(this._vertexBuffers[H].dispose(),delete this._vertexBuffers[H]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const F=H.getKind();this._vertexBuffers[F]&&y&&this._vertexBuffers[F].dispose(),H._buffer&&H._buffer._increaseReferences(),this._vertexBuffers[F]=H;const P=this._meshes,n=P.length;if(F===S.h.PositionKind){this._totalVertices=c??H._maxVerticesCount,this._updateExtend(H.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const y=this._extend&&this._extend.minimum||new Z.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),F=this._extend&&this._extend.maximum||new Z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let H=0;H<n;H++){const c=P[H];c.buildBoundingInfo(y,F),c._createGlobalSubMesh(c.isUnIndexed),c.Oj(!0),c.synchronizeInstances()}}this._notifyUpdate(F)}updateVerticesDataDirectly(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=this.getVertexBuffer(H);F&&(F.updateDirectly(c,y,Z),this._notifyUpdate(H))}updateVerticesData(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=this.getVertexBuffer(H);Z&&(Z.update(c),H===S.h.PositionKind&&this.Ea(y,c),this._notifyUpdate(H))}Ea(H,c){if(H&&this._updateExtend(c),this._resetPointsArrayCache(),H){const H=this._meshes;for(const c of H){c.hasBoundingInfo?c.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):c.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const H=c.$f;for(const c of H)c.refreshBoundingInfo()}}}_bind(H,c,y,Z){if(!H)return;void 0===c&&(c=this._indexBuffer);const F=this.getVertexBuffers();if(!F)return;if(c!=this._indexBuffer||!this._vertexArrayObjects&&!Z)return void this._engine.bindBuffers(F,c,H,y);const P=Z||this._vertexArrayObjects,S=this._engine;P[H.key]||(P[H.key]=S.recordVertexArrayObject(F,c,H,y)),S.bindVertexArrayObject(P[H.key],c)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(H,c,y){const Z=this.getVertexBuffer(H);return Z?Z.getFloatData(this._totalVertices,y||c&&1!==this._meshes.length):null}copyVerticesData(H,c){const y=this.getVertexBuffer(H);if(!y)return;c[H]||(c[H]=new Float32Array(this._totalVertices*y.getSize()));const Z=y.getData();Z&&function(H,c,y,Z,F,P,n,O){const a=c*S.h.GetTypeByteLength(y),i=n*c;if(O.length!==i)throw new Error("Output length is not valid");if(y===S.h.FLOAT&&F===a)if(H instanceof Array){const c=Z/4;O.set(H,c)}else if(H instanceof ArrayBuffer){const c=new Float32Array(H,Z,i);O.set(c)}else{const c=H.byteOffset+Z;if(c%4)return z.d.Warn("CopyFloatData: copied misaligned data."),void O.set(new Float32Array(H.buffer.slice(c,c+4*i)));const y=new Float32Array(H.buffer,c,i);O.set(y)}else S.h.ForEach(H,Z,F,c,y,i,P,((H,c)=>O[c]=H))}(Z,y.getSize(),y.type,y.byteOffset,y.byteStride,y.normalized,this._totalVertices,c[H])}isVertexBufferUpdatable(H){const c=this._vertexBuffers[H];return!!c&&c.isUpdatable()}getVertexBuffer(H){return this.isReady()?this._vertexBuffers[H]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(H){return this._vertexBuffers?void 0!==this._vertexBuffers[H]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(H)}getVerticesDataKinds(){const H=[];let c;if(!this._vertexBuffers&&this._delayInfo)for(c in this._delayInfo)H.push(c);else for(c in this._vertexBuffers)H.push(c);return H}updateIndices(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const Z=H.length!==this._indices.length;if(y||(this._indices=H.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,H,c),Z)for(const H of this._meshes)H._createGlobalSubMesh(!0)}else this.setIndices(H,null,!0)}setIndexBuffer(H,c,y){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=H,this._totalVertices=c,this._totalIndices=y,H.is32Bits||(H.is32Bits=this._totalIndices>65535);for(const Z of this._meshes)Z._createGlobalSubMesh(!0),Z.synchronizeInstances();this._notifyUpdate()}setIndices(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=H,this._indexBufferIsUpdatable=y,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,y,"Geometry_"+this.id+"_IndexBuffer")),void 0!=c&&(this._totalVertices=c);for(const F of this._meshes)F._createGlobalSubMesh(!Z),F.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Vf(H,c){if(!this.isReady())return null;const y=this._indices;return c||H&&1!==this._meshes.length?y.slice():y}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;H&&this._vertexArrayObjects&&this._vertexArrayObjects[H.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[H.key]),delete this._vertexArrayObjects[H.key])}releaseForMesh(H,c){const y=this._meshes,Z=y.indexOf(H);-1!==Z&&(y.splice(Z,1),this._vertexArrayObjects&&H._invalidateInstanceVertexArrayObject(),H._geometry=null,0===y.length&&c&&this.dispose())}Ca(H){if(H._geometry===this)return;const c=H._geometry;c&&c.releaseForMesh(H),this._vertexArrayObjects&&H._invalidateInstanceVertexArrayObject();const y=this._meshes;H._geometry=this,H._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),y.push(H),this.isReady()?this._applyToMesh(H):this._boundingInfo&&H.setBoundingInfo(this._boundingInfo)}_updateExtend(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!H&&(H=this.getVerticesData(S.h.PositionKind),!H))return;this._extend=(0,g.d)(H,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(H){const c=this._meshes.length;for(const y in this._vertexBuffers)1===c&&this._vertexBuffers[y].create(),y===S.h.PositionKind&&(this._extend||this._updateExtend(),H.buildBoundingInfo(this._extend.minimum,this._extend.maximum),H._createGlobalSubMesh(H.isUnIndexed),H.Ea());1===c&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),H._syncGeometryWithMorphTargetManager(),H.synchronizeInstances()}_notifyUpdate(H){this.onGeometryUpdated&&this.onGeometryUpdated(this,H),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const c of this._meshes)c._markSubMeshesAsAttributesDirty()}load(H,c){2!==this.delayLoadState&&(this.isReady()?c&&c():(this.delayLoadState=2,this._queueLoad(H,c)))}_queueLoad(H,c){this.delayLoadingFile&&(H.addPendingData(this),H._loadFile(this.delayLoadingFile,(y=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(y),this),this.delayLoadState=1,this._delayInfo=[],H.removePendingData(this);const Z=this._meshes,F=Z.length;for(let H=0;H<F;H++)this._applyToMesh(Z[H]);c&&c()}),void 0,!0))}toLeftHanded(){const H=this.Vf(!1);if(null!=H&&H.length>0){for(let c=0;c<H.length;c+=3){const y=H[c+0];H[c+0]=H[c+2],H[c+2]=y}this.setIndices(H)}const c=this.getVerticesData(S.h.PositionKind,!1);if(null!=c&&c.length>0){for(let H=0;H<c.length;H+=3)c[H+2]=-c[H+2];this.Ga(S.h.PositionKind,c,!1)}const y=this.getVerticesData(S.h.NormalKind,!1);if(null!=y&&y.length>0){for(let H=0;H<y.length;H+=3)y[H+2]=-y[H+2];this.Ga(S.h.NormalKind,y,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const H=this.getVerticesData(S.h.PositionKind);if(!H||0===H.length)return!1;for(let c=3*this._positionsCache.length,y=this._positionsCache.length;c<H.length;c+=3,++y)this._positionsCache[y]=Z.n.Tg(H,c);for(let c=0,y=0;c<H.length;c+=3,++y)this._positionsCache[y].set(H[0+c],H[1+c],H[2+c]);return this._positionsCache.length=H.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const y in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[y]);this._vertexArrayObjects={};const H=this._meshes,c=H.length;for(let y=0;y<c;y++)H[y]._invalidateInstanceVertexArrayObject()}}dispose(){const H=this._meshes,c=H.length;let y;for(y=0;y<c;y++)this.releaseForMesh(H[y]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const Z in this._vertexBuffers)this._vertexBuffers[Z].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const H=this._parentContainer.geometries.indexOf(this);H>-1&&this._parentContainer.geometries.splice(H,1),this._parentContainer=null}this._isDisposed=!0}i(H){const c=new P.c;c.indices=[];const y=this.Vf();if(y)for(let P=0;P<y.length;P++)c.indices.push(y[P]);let Z,F=!1,S=!1;for(Z in this._vertexBuffers){const H=this.getVerticesData(Z);if(H&&(H instanceof Float32Array?c.set(new Float32Array(H),Z):c.set(H.slice(0),Z),!S)){const H=this.getVertexBuffer(Z);H&&(F=H.isUpdatable(),S=!F)}}const n=new V(H,this._scene,c,F);for(Z in n.delayLoadState=this.delayLoadState,n.delayLoadingFile=this.delayLoadingFile,n._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)n._delayInfo=n._delayInfo||[],n._delayInfo.push(Z);return n._boundingInfo=new a.b(this._extend.minimum,this._extend.maximum),n}serialize(){const H={};return H.id=this.id,H.uniqueId=this.uniqueId,H.updatable=this._updatable,C.d&&C.d.HasTags(this)&&(H.tags=C.d.GetTags(this)),H}_toNumberArray(H){return Array.isArray(H)?H:Array.prototype.slice.call(H)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const H in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,H)&&(this._vertexBuffers[H]._buffer._data=null)}serializeVerticeData(){const H=this.serialize();return this.isVerticesDataPresent(S.h.PositionKind)&&(H.xa=this._toNumberArray(this.getVerticesData(S.h.PositionKind)),this.isVertexBufferUpdatable(S.h.PositionKind)&&(H.xa._updatable=!0)),this.isVerticesDataPresent(S.h.NormalKind)&&(H.ya=this._toNumberArray(this.getVerticesData(S.h.NormalKind)),this.isVertexBufferUpdatable(S.h.NormalKind)&&(H.ya._updatable=!0)),this.isVerticesDataPresent(S.h.TangentKind)&&(H.tangents=this._toNumberArray(this.getVerticesData(S.h.TangentKind)),this.isVertexBufferUpdatable(S.h.TangentKind)&&(H.tangents._updatable=!0)),this.isVerticesDataPresent(S.h.UVKind)&&(H.Aa=this._toNumberArray(this.getVerticesData(S.h.UVKind)),this.isVertexBufferUpdatable(S.h.UVKind)&&(H.Aa._updatable=!0)),this.isVerticesDataPresent(S.h.UV2Kind)&&(H.uvs2=this._toNumberArray(this.getVerticesData(S.h.UV2Kind)),this.isVertexBufferUpdatable(S.h.UV2Kind)&&(H.uvs2._updatable=!0)),this.isVerticesDataPresent(S.h.UV3Kind)&&(H.uvs3=this._toNumberArray(this.getVerticesData(S.h.UV3Kind)),this.isVertexBufferUpdatable(S.h.UV3Kind)&&(H.uvs3._updatable=!0)),this.isVerticesDataPresent(S.h.UV4Kind)&&(H.uvs4=this._toNumberArray(this.getVerticesData(S.h.UV4Kind)),this.isVertexBufferUpdatable(S.h.UV4Kind)&&(H.uvs4._updatable=!0)),this.isVerticesDataPresent(S.h.UV5Kind)&&(H.uvs5=this._toNumberArray(this.getVerticesData(S.h.UV5Kind)),this.isVertexBufferUpdatable(S.h.UV5Kind)&&(H.uvs5._updatable=!0)),this.isVerticesDataPresent(S.h.UV6Kind)&&(H.uvs6=this._toNumberArray(this.getVerticesData(S.h.UV6Kind)),this.isVertexBufferUpdatable(S.h.UV6Kind)&&(H.uvs6._updatable=!0)),this.isVerticesDataPresent(S.h.ColorKind)&&(H.za=this._toNumberArray(this.getVerticesData(S.h.ColorKind)),this.isVertexBufferUpdatable(S.h.ColorKind)&&(H.za._updatable=!0)),this.isVerticesDataPresent(S.h.MatricesIndicesKind)&&(H.matricesIndices=this._toNumberArray(this.getVerticesData(S.h.MatricesIndicesKind)),H.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(S.h.MatricesIndicesKind)&&(H.matricesIndices._updatable=!0)),this.isVerticesDataPresent(S.h.MatricesWeightsKind)&&(H.matricesWeights=this._toNumberArray(this.getVerticesData(S.h.MatricesWeightsKind)),this.isVertexBufferUpdatable(S.h.MatricesWeightsKind)&&(H.matricesWeights._updatable=!0)),H.indices=this._toNumberArray(this.Vf()),H}static ExtractFromMesh(H,c){const y=H._geometry;return y?y.i(c):null}static RandomId(){return i.c.RandomId()}static _GetGeometryByLoadedUniqueId(H,c){for(let y=0;y<c.geometries.length;y++)if(c.geometries[y]._loadedUniqueId===H)return c.geometries[y];return null}static _ImportGeometry(H,c){const y=c.va(),Z=H.geometryUniqueId,P=H.geometryId;if(Z||P){const H=Z?this._GetGeometryByLoadedUniqueId(Z,y):y.getGeometryById(P);H&&H.Ca(c)}else if(H instanceof ArrayBuffer){const y=c._binaryInfo;if(y.positionsAttrDesc&&y.positionsAttrDesc.count>0){const Z=new Float32Array(H,y.positionsAttrDesc.offset,y.positionsAttrDesc.count);c.Ga(S.h.PositionKind,Z,!1)}if(y.normalsAttrDesc&&y.normalsAttrDesc.count>0){const Z=new Float32Array(H,y.normalsAttrDesc.offset,y.normalsAttrDesc.count);c.Ga(S.h.NormalKind,Z,!1)}if(y.tangetsAttrDesc&&y.tangetsAttrDesc.count>0){const Z=new Float32Array(H,y.tangetsAttrDesc.offset,y.tangetsAttrDesc.count);c.Ga(S.h.TangentKind,Z,!1)}if(y.uvsAttrDesc&&y.uvsAttrDesc.count>0){const Z=new Float32Array(H,y.uvsAttrDesc.offset,y.uvsAttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UVKind,Z,!1)}if(y.uvs2AttrDesc&&y.uvs2AttrDesc.count>0){const Z=new Float32Array(H,y.uvs2AttrDesc.offset,y.uvs2AttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UV2Kind,Z,!1)}if(y.uvs3AttrDesc&&y.uvs3AttrDesc.count>0){const Z=new Float32Array(H,y.uvs3AttrDesc.offset,y.uvs3AttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UV3Kind,Z,!1)}if(y.uvs4AttrDesc&&y.uvs4AttrDesc.count>0){const Z=new Float32Array(H,y.uvs4AttrDesc.offset,y.uvs4AttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UV4Kind,Z,!1)}if(y.uvs5AttrDesc&&y.uvs5AttrDesc.count>0){const Z=new Float32Array(H,y.uvs5AttrDesc.offset,y.uvs5AttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UV5Kind,Z,!1)}if(y.uvs6AttrDesc&&y.uvs6AttrDesc.count>0){const Z=new Float32Array(H,y.uvs6AttrDesc.offset,y.uvs6AttrDesc.count);if(m.d)for(let H=1;H<Z.length;H+=2)Z[H]=1-Z[H];c.Ga(S.h.UV6Kind,Z,!1)}if(y.colorsAttrDesc&&y.colorsAttrDesc.count>0){const Z=new Float32Array(H,y.colorsAttrDesc.offset,y.colorsAttrDesc.count);c.Ga(S.h.ColorKind,Z,!1,y.colorsAttrDesc.stride)}if(y.matricesIndicesAttrDesc&&y.matricesIndicesAttrDesc.count>0){const Z=new Int32Array(H,y.matricesIndicesAttrDesc.offset,y.matricesIndicesAttrDesc.count),F=[];for(let H=0;H<Z.length;H++){const c=Z[H];F.push(255&c),F.push((65280&c)>>8),F.push((16711680&c)>>16),F.push(c>>24&255)}c.Ga(S.h.MatricesIndicesKind,F,!1)}if(y.matricesIndicesExtraAttrDesc&&y.matricesIndicesExtraAttrDesc.count>0){const Z=new Int32Array(H,y.matricesIndicesExtraAttrDesc.offset,y.matricesIndicesExtraAttrDesc.count),F=[];for(let H=0;H<Z.length;H++){const c=Z[H];F.push(255&c),F.push((65280&c)>>8),F.push((16711680&c)>>16),F.push(c>>24&255)}c.Ga(S.h.MatricesIndicesExtraKind,F,!1)}if(y.matricesWeightsAttrDesc&&y.matricesWeightsAttrDesc.count>0){const Z=new Float32Array(H,y.matricesWeightsAttrDesc.offset,y.matricesWeightsAttrDesc.count);c.Ga(S.h.MatricesWeightsKind,Z,!1)}if(y.indicesAttrDesc&&y.indicesAttrDesc.count>0){const Z=new Int32Array(H,y.indicesAttrDesc.offset,y.indicesAttrDesc.count);c.setIndices(Z,null)}if(y.subMeshesAttrDesc&&y.subMeshesAttrDesc.count>0){const Z=new Int32Array(H,y.subMeshesAttrDesc.offset,5*y.subMeshesAttrDesc.count);c.$f=[];for(let H=0;H<y.subMeshesAttrDesc.count;H++){const y=Z[5*H+0],F=Z[5*H+1],P=Z[5*H+2],S=Z[5*H+3],O=Z[5*H+4];n.b.AddToMesh(y,F,P,S,O,c)}}}else if(H.xa&&H.ya&&H.indices){if(c.Ga(S.h.PositionKind,H.xa,H.xa._updatable),c.Ga(S.h.NormalKind,H.ya,H.ya._updatable),H.tangents&&c.Ga(S.h.TangentKind,H.tangents,H.tangents._updatable),H.Aa&&c.Ga(S.h.UVKind,H.Aa,H.Aa._updatable),H.uvs2&&c.Ga(S.h.UV2Kind,H.uvs2,H.uvs2._updatable),H.uvs3&&c.Ga(S.h.UV3Kind,H.uvs3,H.uvs3._updatable),H.uvs4&&c.Ga(S.h.UV4Kind,H.uvs4,H.uvs4._updatable),H.uvs5&&c.Ga(S.h.UV5Kind,H.uvs5,H.uvs5._updatable),H.uvs6&&c.Ga(S.h.UV6Kind,H.uvs6,H.uvs6._updatable),H.za&&c.Ga(S.h.ColorKind,F.h.CheckColors4(H.za,H.xa.length/3),H.za._updatable),H.matricesIndices)if(H.matricesIndices._isExpanded)delete H.matricesIndices._isExpanded,c.Ga(S.h.MatricesIndicesKind,H.matricesIndices,H.matricesIndices._updatable);else{const y=[];for(let c=0;c<H.matricesIndices.length;c++){const Z=H.matricesIndices[c];y.push(255&Z),y.push((65280&Z)>>8),y.push((16711680&Z)>>16),y.push(Z>>24&255)}c.Ga(S.h.MatricesIndicesKind,y,H.matricesIndices._updatable)}if(H.matricesIndicesExtra)if(H.matricesIndicesExtra._isExpanded)delete H.matricesIndices._isExpanded,c.Ga(S.h.MatricesIndicesExtraKind,H.matricesIndicesExtra,H.matricesIndicesExtra._updatable);else{const y=[];for(let c=0;c<H.matricesIndicesExtra.length;c++){const Z=H.matricesIndicesExtra[c];y.push(255&Z),y.push((65280&Z)>>8),y.push((16711680&Z)>>16),y.push(Z>>24&255)}c.Ga(S.h.MatricesIndicesExtraKind,y,H.matricesIndicesExtra._updatable)}H.matricesWeights&&(V._CleanMatricesWeights(H,c),c.Ga(S.h.MatricesWeightsKind,H.matricesWeights,H.matricesWeights._updatable)),H.matricesWeightsExtra&&c.Ga(S.h.MatricesWeightsExtraKind,H.matricesWeightsExtra,H.matricesWeights._updatable),c.setIndices(H.indices,null)}if(H.$f){c.$f=[];for(let y=0;y<H.$f.length;y++){const Z=H.$f[y];n.b.AddToMesh(Z.materialIndex,Z.verticesStart,Z.verticesCount,Z.indexStart,Z.indexCount,c)}}c._shouldGenerateFlatShading&&(c.convertToFlatShadedMesh(),c._shouldGenerateFlatShading=!1),c.Oj(!0),y.onMeshImportedObservable.notifyObservers(c)}static _CleanMatricesWeights(H,c){const y=.001;if(!O.c.CleanBoneMatrixWeights)return;let Z=0;if(!(H.skeletonId>-1))return;{const y=c.va().getLastSkeletonById(H.skeletonId);if(!y)return;Z=y.bones.length}const F=c.getVerticesData(S.h.MatricesIndicesKind),P=c.getVerticesData(S.h.MatricesIndicesExtraKind),n=H.matricesWeights,a=H.matricesWeightsExtra,i=H.numBoneInfluencer,C=n.length;for(let S=0;S<C;S+=4){let H=0,c=-1;for(let Z=0;Z<4;Z++){const F=n[S+Z];H+=F,F<y&&c<0&&(c=Z)}if(a)for(let Z=0;Z<4;Z++){const F=a[S+Z];H+=F,F<y&&c<0&&(c=Z+4)}if((c<0||c>i-1)&&(c=i-1),H>y){const c=1/H;for(let H=0;H<4;H++)n[S+H]*=c;if(a)for(let H=0;H<4;H++)a[S+H]*=c}else c>=4?(a[S+c-4]=1-H,P[S+c-4]=Z):(n[S+c]=1-H,F[S+c]=Z)}c.Ga(S.h.MatricesIndicesKind,F),H.matricesWeightsExtra&&c.Ga(S.h.MatricesIndicesExtraKind,P)}static Parse(H,c,y){const F=new V(H.id,c,void 0,H.updatable);return F._loadedUniqueId=H.uniqueId,C.d&&C.d.AddTagsTo(F,H.tags),H.delayLoadingFile?(F.delayLoadState=4,F.delayLoadingFile=y+H.delayLoadingFile,F._boundingInfo=new a.b(Z.n.Tg(H.boundingBoxMinimum),Z.n.Tg(H.boundingBoxMaximum)),F._delayInfo=[],H.hasUVs&&F._delayInfo.push(S.h.UVKind),H.hasUVs2&&F._delayInfo.push(S.h.UV2Kind),H.hasUVs3&&F._delayInfo.push(S.h.UV3Kind),H.hasUVs4&&F._delayInfo.push(S.h.UV4Kind),H.hasUVs5&&F._delayInfo.push(S.h.UV5Kind),H.hasUVs6&&F._delayInfo.push(S.h.UV6Kind),H.hasColors&&F._delayInfo.push(S.h.ColorKind),H.hasMatricesIndices&&F._delayInfo.push(S.h.MatricesIndicesKind),H.hasMatricesWeights&&F._delayInfo.push(S.h.MatricesWeightsKind),F._delayLoadingFunction=P.c.ImportVertexData):P.c.ImportVertexData(H,F),c.pushGeometry(F,!0),F}}},12330:(H,c,y)=>{"use strict";y.d(c,{b:()=>g});var Z=y(11092),F=y(10773),P=y(11399),S=y(11354),n=y(10781),O=y(11403),a=y(11153),i=y(10754),C=y(10893);S.c._instancedMeshFactory=(H,c)=>{const y=new g(H,c);if(c.instancedBuffers){y.instancedBuffers={};for(const H in c.instancedBuffers)y.instancedBuffers[H]=c.instancedBuffers[H]}return y};class g extends P.d{constructor(H,c){super(H,c.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,c.Gj(this),this._sourceMesh=c,this._unIndexed=c._unIndexed,this.position.p(c.position),this.rotation.p(c.rotation),this.de.p(c.de),c.rotationQuaternion&&(this.rotationQuaternion=c.rotationQuaternion.clone()),this.animations=c.animations.slice();for(const y of c.getAnimationRanges())null!=y&&this.createAnimationRange(y.name,y.from,y.to);this.infiniteDistance=c.infiniteDistance,this.setPivotMatrix(c.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(H){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.receiveShadows)!==H&&i.c.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(H){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.material)!==H&&i.c.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(H){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.visibility)!==H&&i.c.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(H){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.skeleton)!==H&&i.c.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(H){this._sourceMesh&&H!==this._sourceMesh.renderingGroupId&&F.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(H){return this._sourceMesh.createInstance(H)}isReady(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(H,!0)}getVerticesData(H,c,y){return this._sourceMesh.getVerticesData(H,c,y)}copyVerticesData(H,c){this._sourceMesh.copyVerticesData(H,c)}Ga(H,c,y,Z){return this.sourceMesh&&this.sourceMesh.Ga(H,c,y,Z),this.sourceMesh}updateVerticesData(H,c,y,Z){return this.sourceMesh&&this.sourceMesh.updateVerticesData(H,c,y,Z),this.sourceMesh}setIndices(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(H,c),this.sourceMesh}isVerticesDataPresent(H){return this._sourceMesh.isVerticesDataPresent(H)}Vf(){return this._sourceMesh.Vf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let H,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;H="object"===typeof c?c:{applySkeleton:c,applyMorph:y};const Z=this._sourceMesh.Dj?this._sourceMesh.Dj.boundingBias:null;return this.Fa(this._sourceMesh._getData(H,null,a.h.PositionKind),Z),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(H,c){if(super._activate(H,c),this._sourceMesh.$f||F.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,H),c){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==O.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new Z.d);const H=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,Z.h.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Oj(!0)),this._currentLOD.position.p(Z.h.o[7]),this._currentLOD._masterMesh=H,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(H){if(!H)return this;const c=this.sourceMesh.getLODLevels();if(c&&0!==c.length){const c=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(H,c.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(H){return this.sourceMesh._preActivateForIntermediateRendering(H)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.$f)for(let H=0;H<this._sourceMesh.$f.length;H++)this._sourceMesh.$f[H].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;const Z=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(H);if(n.c.DeepCopy(this,Z,["name","$f","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),c&&(Z.parent=c),!y)for(let F=0;F<this.va().meshes.length;F++){const H=this.va().meshes[F];H.parent===this&&H.clone(H.name,Z)}return Z.Oj(!0),this.onClonedObservable.notifyObservers(Z),Z}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Fj(this),super.dispose(H,c)}_serializeAsParent(H){super._serializeAsParent(H),H.parentId=this._sourceMesh.uniqueId,H.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const Z=this.clone("Clone of "+(this.name||this.id),H||this.parent,!0,c&&c.newSourcedMesh);Z&&y&&y(this,Z);for(const F of this.getChildTransformNodes(!0))F.instantiateHierarchy(Z,c,y);return Z}}S.c.prototype.registerInstancedBuffer=function(H,c){var y,Z;if(null===(y=this._userInstancedBuffersStorage)||void 0===y||null===(Z=y.vertexBuffers[H])||void 0===Z||Z.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const H of this.instances)H.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[H]=null,this._userInstancedBuffersStorage.strides[H]=c,this._userInstancedBuffersStorage.sizes[H]=32*c,this._userInstancedBuffersStorage.data[H]=new Float32Array(this._userInstancedBuffersStorage.sizes[H]),this._userInstancedBuffersStorage.vertexBuffers[H]=new a.h(this.getEngine(),this._userInstancedBuffersStorage.data[H],H,!0,!1,c,!0);for(const F of this.instances)F.instancedBuffers[H]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},S.c.prototype._processInstancedBuffers=function(H,c){const y=H?H.length:0;for(const Z in this.instancedBuffers){let F=this._userInstancedBuffersStorage.sizes[Z];const P=this._userInstancedBuffersStorage.strides[Z],S=(y+1)*P;for(;F<S;)F*=2;this._userInstancedBuffersStorage.data[Z].length!=F&&(this._userInstancedBuffersStorage.data[Z]=new Float32Array(F),this._userInstancedBuffersStorage.sizes[Z]=F,this._userInstancedBuffersStorage.vertexBuffers[Z]&&(this._userInstancedBuffersStorage.vertexBuffers[Z].dispose(),this._userInstancedBuffersStorage.vertexBuffers[Z]=null));const n=this._userInstancedBuffersStorage.data[Z];let O=0;if(c){const H=this.instancedBuffers[Z];H.toArray?H.toArray(n,O):H.copyToArray?H.copyToArray(n,O):n[O]=H,O+=P}for(let c=0;c<y;c++){const y=H[c].instancedBuffers[Z];y.toArray?y.toArray(n,O):y.copyToArray?y.copyToArray(n,O):n[O]=y,O+=P}this._userInstancedBuffersStorage.vertexBuffers[Z]?this._userInstancedBuffersStorage.vertexBuffers[Z].updateDirectly(n,0):(this._userInstancedBuffersStorage.vertexBuffers[Z]=new a.h(this.getEngine(),this._userInstancedBuffersStorage.data[Z],Z,!0,!1,P,!0),this._invalidateInstanceVertexArrayObject())}},S.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const H in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[H]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},S.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const H in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[H]&&this._userInstancedBuffersStorage.vertexBuffers[H].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,C.d)("BABYLON.InstancedMesh",g)},11354:(H,c,y)=>{"use strict";y.d(c,{c:()=>t,f:()=>u});var Z=y(10763),F=y(10754),P=y(10781),S=y(11083),n=y(11358),O=y(11360),a=y(11092),i=y(11112),C=y(11364),g=y(11153),v=y(11380),m=y(11385),z=y(11399),V=y(11245),h=y(11239),Q=y(11413),D=y(11392),f=y(11118),J=y(10773),l=y(10893),d=y(10798),K=y(11174);class T{constructor(H,c){this.distanceOrScreenCoverage=H,this.mesh=c}}class u{}class E{constructor(){this.visibleInstances={},this.batchCache=new U,this.batchCacheReplacementModeInFrozenMode=new U,this.instancesBufferSize=2048}}class U{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class G{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class p{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class t extends z.d{static _GetDefaultSideOrientation(H){return H||t.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(H){this._internalMeshDataInfo._useLODScreenCoverage=H,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(H){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==H&&(H&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(g.h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(g.h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=H,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new Z.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new Z.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new Z.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new Z.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new Z.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(H){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(H)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(H){this._internalMeshDataInfo._forcedInstanceCount=H}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(H){this._internalMeshDataInfo._sideOrientation=H,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===H||!this._scene.useRightHandedSystem&&0===H}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(H){this.sideOrientation=H,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(H){this._internalMeshDataInfo._overrideRenderingFillMode=H}get material(){return this._internalAbstractMeshDataInfo._material}set material(H){H&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(H.sideOrientation=null),this._setMaterial(H)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(H){this._unIndexed!==H&&(this._unIndexed=H,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(H){this._instanceDataStorage.manualUpdate=H}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(H){this._instanceDataStorage.previousManualUpdate=H}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(H){this._instanceDataStorage.forceMatrixUpdates=H}_copySource(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Z=this.va();if(H._geometry&&H._geometry.Ca(this),P.c.DeepCopy(H,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Dj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=H,Z.useClonedMeshMap&&(H._internalMeshDataInfo.meshMap||(H._internalMeshDataInfo.meshMap={}),H._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=H._originalBuilderSideOrientation,this._creationDataStorage=H._creationDataStorage,H._ranges){const c=H._ranges;for(const H in c)Object.prototype.hasOwnProperty.call(c,H)&&c[H]&&this.createAnimationRange(H,c[H].from,c[H].to)}if(H.metadata&&H.metadata.clone?this.metadata=H.metadata.clone():this.metadata=H.metadata,this._internalMetadata=H._internalMetadata,S.d&&S.d.HasTags(H)&&S.d.AddTagsTo(this,S.d.GetTags(H,!0)),this.Tb(H.isEnabled(!1)),this.parent=H.parent,this.setPivotMatrix(H.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+H.id,this.material=H.material,!c){const c=H.getDescendants(!0);for(let H=0;H<c.length;H++){const y=c[H];y.clone&&y.clone(this.name+"."+y.name,this)}}if(H.morphTargetManager&&(this.morphTargetManager=H.morphTargetManager),Z.getPhysicsEngine){const c=Z.getPhysicsEngine();if(y&&c)if(1===c.getPluginVersion()){const y=c.getImpostorForPhysicsObject(H);y&&(this.physicsImpostor=y.clone(this))}else 2===c.getPluginVersion()&&H.physicsBody&&H.physicsBody.clone(this)}for(let F=0;F<Z.qj.length;F++){const c=Z.qj[F];c.j===H&&c.clone(c.name,this)}this.skeleton=H.skeleton,this.refreshBoundingInfo(!0,!0),this.Oj(!0)}constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(H,c),this._internalMeshDataInfo=new p,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new E,this._thinInstanceDataStorage=new G,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=t.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,c=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(H,c,y)=>{H&&y&&(this._uniformBuffer?this.transferToEffect(c):y.bindOnlyWorldMatrix(c))},F&&this._copySource(F,P,S),null!==y&&(this.parent=y),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=H=>{H.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new Z.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),F&&F.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const Z=0===this.getTotalVertices()||c&&c.doNotInstantiate&&(!0===c.doNotInstantiate||c.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),H||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));Z.parent=H||this.parent,Z.position=this.position.clone(),Z.de=this.de.clone(),this.rotationQuaternion?Z.rotationQuaternion=this.rotationQuaternion.clone():Z.rotation=this.rotation.clone(),y&&y(this,Z);for(const F of this.getChildTransformNodes(!0))"InstancedMesh"===F.getClassName()&&"Mesh"===Z.getClassName()&&F.sourceMesh===this?F.instantiateHierarchy(Z,{doNotInstantiate:c&&c.doNotInstantiate||!1,newSourcedMesh:Z},y):F.instantiateHierarchy(Z,c,y);return Z}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(H){let c=super.toString(H);if(c+=", n vertices: "+this.getTotalVertices(),c+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let y=0;y<this.animations.length;y++)c+=", animation[0]: "+this.animations[y].toString(H);if(H)if(this._geometry){const H=this.Vf(),y=this.getVerticesData(g.h.PositionKind);y&&H&&(c+=", flat shading: "+(y.length/3===H.length?"YES":"NO"))}else c+=", flat shading: UNKNOWN";return c}_unBindEffect(){super._unBindEffect();for(const H of this.instances)H._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const H=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((c,y)=>c.distanceOrScreenCoverage<y.distanceOrScreenCoverage?H:c.distanceOrScreenCoverage>y.distanceOrScreenCoverage?-H:0))}addLODLevel(H,c){if(c&&c._masterMesh)return J.d.Warn("You cannot use a mesh as LOD level twice"),this;const y=new T(H,c);return this._internalMeshDataInfo._LODLevels.push(y),c&&(c._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(H){const c=this._internalMeshDataInfo;for(let y=0;y<c._LODLevels.length;y++){const Z=c._LODLevels[y];if(Z.distanceOrScreenCoverage===H)return Z.mesh}return null}removeLODLevel(H){const c=this._internalMeshDataInfo;for(let y=0;y<c._LODLevels.length;y++)c._LODLevels[y].mesh===H&&(c._LODLevels.splice(y,1),H&&(H._masterMesh=null));return this._sortLODLevels(),this}getLOD(H,c){const y=this._internalMeshDataInfo;if(!y._LODLevels||0===y._LODLevels.length)return this;const Z=c||this.getBoundingInfo().boundingSphere,F=H.mode===O.b.ORTHOGRAPHIC_CAMERA?H.Wi:Z.centerWorld.Rc(H.globalPosition).length();let P=F,S=1;if(y._useLODScreenCoverage){const c=H.screenArea;let y=Z.radiusWorld*H.Wi/F;y=y*y*Math.PI,P=y/c,S=-1}if(S*y._LODLevels[y._LODLevels.length-1].distanceOrScreenCoverage>S*P)return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,this),this;for(let n=0;n<y._LODLevels.length;n++){const H=y._LODLevels[n];if(S*H.distanceOrScreenCoverage<S*P){if(H.mesh){if(4===H.mesh.delayLoadState)return H.mesh._checkDelayState(),this;if(2===H.mesh.delayLoadState)return this;H.mesh._preActivate(),H.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,H.mesh),H.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,this),this}get Dj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(H,c,y,Z){var F,P;if(!this._geometry)return null;let S=Z||null===(F=this._userInstancedBuffersStorage)||void 0===F||null===(P=F.vertexBuffers[H])||void 0===P?void 0:P.getFloatData(this.instances.length+1,y||c&&1!==this._geometry.meshes.length);return S||(S=this._geometry.getVerticesData(H,c,y)),S}copyVerticesData(H,c){this._geometry&&this._geometry.copyVerticesData(H,c)}getVertexBuffer(H,c){var y;return this._geometry?(c||null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[H])??this._geometry.getVertexBuffer(H):null}isVerticesDataPresent(H,c){var y;return this._geometry?!c&&void 0!==(null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[H])||this._geometry.isVerticesDataPresent(H):!!this._delayInfo&&-1!==this._delayInfo.indexOf(H)}isVertexBufferUpdatable(H,c){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(H);if(!c){var y;const c=null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[H];if(c)return c.isUpdatable()}return this._geometry.isVertexBufferUpdatable(H)}getVerticesDataKinds(H){if(!this._geometry){const H=[];return this._delayInfo&&this._delayInfo.forEach((function(c){H.push(c)})),H}const c=this._geometry.getVerticesDataKinds();if(!H&&this._userInstancedBuffersStorage)for(const y in this._userInstancedBuffersStorage.vertexBuffers)-1===c.indexOf(y)&&c.push(y);return c}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Vf(H,c){return this._geometry?this._geometry.Vf(H,c):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(H))return!1;if(!this.$f||0===this.$f.length)return!0;if(!H)return!0;const y=this.getEngine(),Z=this.va(),F=c||y.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Oj();const P=this.material||Z.defaultMaterial;if(P)if(P._storeEffectOnSubMeshes)for(const g of this.$f){const H=g.Ha();if(H)if(H._storeEffectOnSubMeshes){if(!H.isReadyForSubMesh(this,g,F))return!1}else if(!H.isReady(this,F))return!1}else if(!P.isReady(this,F))return!1;const S=y.currentRenderPassId;for(const g of this.lightSources){const H=g.getShadowGenerators();if(!H)continue;const c=H.values();for(let Z=c.next();!0!==Z.done;Z=c.next()){var n,O,a,i;const H=Z.value;if(H&&(null===(n=H.getShadowMap())||void 0===n||!n.renderList||null!==(O=H.getShadowMap())&&void 0!==O&&O.renderList&&-1!==(null===(a=H.getShadowMap())||void 0===a||null===(i=a.renderList)||void 0===i?void 0:i.indexOf(this)))){const c=H.getShadowMap().renderPassIds??[y.currentRenderPassId];for(let Z=0;Z<c.length;++Z){y.currentRenderPassId=c[Z];for(const c of this.$f){var C;if(!H.isReady(c,F,(null===(C=c.Ha())||void 0===C?void 0:C.needAlphaBlendingForMesh(this))??!1))return y.currentRenderPassId=S,!1}}y.currentRenderPassId=S}}}for(const g of this._internalMeshDataInfo._LODLevels)if(g.mesh&&!g.mesh.isReady(F))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Nh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(H){this._instanceDataStorage.overridenInstanceCount=H}_preActivate(){const H=this._internalMeshDataInfo,c=this.va().getRenderId();return H._preActivateId===c||(H._preActivateId=c,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(H){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=H),this}_registerInstanceForRenderId(H,c){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:c,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[c]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=c,this._instanceDataStorage.visibleInstances[c]=new Array),this._instanceDataStorage.visibleInstances[c].push(H),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let H,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;H="object"===typeof c?c:{applySkeleton:c,applyMorph:y};const Z=this.Dj?this.Dj.boundingBias:null;return this.Fa(this._getData(H,null,g.h.PositionKind),Z),this}_createGlobalSubMesh(H){const c=this.getTotalVertices();if(!c||!this.Vf())return null;if(this.$f&&this.$f.length>0){const y=this.Vf();if(!y)return null;const Z=y.length;let F=!1;if(H)F=!0;else for(const H of this.$f){if(H.indexStart+H.indexCount>Z){F=!0;break}if(H.verticesStart+H.verticesCount>c){F=!0;break}}if(!F)return this.$f[0]}return this.releaseSubMeshes(),new V.b(0,0,c,0,this.getTotalIndices(),this)}subdivide(H){if(H<1)return;const c=this.getTotalIndices();let y=c/H|0,Z=0;for(;y%3!==0;)y++;this.releaseSubMeshes();for(let F=0;F<H&&!(Z>=c);F++)V.b.CreateFromIndices(0,Z,F===H-1?c-Z:y,this,void 0,!1),Z+=y;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(H,c,y,Z);else{const Z=new v.c;Z.set(c,H);const F=this.va();new m.d(m.d.RandomId(),F,Z,y,this)}return this}removeVerticesData(H){this._geometry&&this._geometry.removeVerticesData(H)}markVerticesDataAsUpdatable(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this.getVertexBuffer(H);y&&y.isUpdatable()!==c&&this.Ga(H,this.getVerticesData(H),c)}setVerticesBuffer(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=m.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(H,null,c),this}updateVerticesData(H,c,y,Z){return this._geometry?(Z?(this.makeGeometryUnique(),this.updateVerticesData(H,c,y,!1)):this._geometry.updateVerticesData(H,c,y),this):this}updateMeshPositions(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this.getVerticesData(g.h.PositionKind);if(!y)return this;if(H(y),this.updateVerticesData(g.h.PositionKind,y,!1,!1),c){const H=this.Vf(),c=this.getVerticesData(g.h.NormalKind);if(!c)return this;v.c.ComputeNormals(y,H,c),this.updateVerticesData(g.h.NormalKind,c,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const H=this._geometry,c=this._geometry.i(m.d.RandomId());return H.releaseForMesh(this,!0),c.Ca(this),this}setIndexBuffer(H,c,y){let Z=this._geometry;Z||(Z=new m.d(m.d.RandomId(),this.va(),void 0,void 0,this)),Z.setIndexBuffer(H,c,y)}setIndices(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(H,c,y,Z);else{const c=new v.c;c.indices=H;const Z=this.va();new m.d(m.d.RandomId(),Z,c,y,this)}return this}updateIndices(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(H,c,y),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(H,c,y){let Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const F=this.va().getEngine();let P;if(this._unIndexed)if(this._getRenderingFillMode(y)===h.c.WireFrameFillMode)P=H._getLinesIndexBuffer(this.Vf(),F);else P=null;else switch(this._getRenderingFillMode(y)){case h.c.PointFillMode:P=null;break;case h.c.WireFrameFillMode:P=H._getLinesIndexBuffer(this.Vf(),F);break;default:case h.c.TriangleFillMode:P=this._geometry.getIndexBuffer()}return this._bindDirect(c,P,Z)}_bindDirect(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(H),y&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(H,c,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(H,c),this):this}_draw(H,c,y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const Z=this.va().getEngine();return this._unIndexed&&c!==h.c.WireFrameFillMode||c==h.c.PointFillMode?Z.drawArraysType(c,H.verticesStart,H.verticesCount,this.forcedInstanceCount||y):c==h.c.WireFrameFillMode?Z.drawElementsType(c,0,H._linesIndexCount,this.forcedInstanceCount||y):Z.drawElementsType(c,H.indexStart,H.indexCount,this.forcedInstanceCount||y),this}registerBeforeRender(H){return this.onBeforeRenderObservable.add(H),this}unregisterBeforeRender(H){return this.onBeforeRenderObservable.removeCallback(H),this}registerAfterRender(H){return this.onAfterRenderObservable.add(H),this}unregisterAfterRender(H){return this.onAfterRenderObservable.removeCallback(H),this}_getInstancesRenderList(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(c)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[H]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[H]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const y=this.va(),Z=y._isInIntermediateRendering(),F=Z?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,P=this._instanceDataStorage.batchCache;if(P.mustReturn=!1,P.renderSelf[H]=c||!F&&this.isEnabled()&&this.isVisible,P.visibleInstances[H]=null,this._instanceDataStorage.visibleInstances&&!c){const c=this._instanceDataStorage.visibleInstances,F=y.getRenderId(),S=Z?c.intermediateDefaultRenderId:c.defaultRenderId;P.visibleInstances[H]=c[F],!P.visibleInstances[H]&&S&&(P.visibleInstances[H]=c[S])}return P.hardwareInstancedRendering[H]=!c&&this._instanceDataStorage.hardwareInstancedRendering&&null!==P.visibleInstances[H]&&void 0!==P.visibleInstances[H],this._instanceDataStorage.previousBatch=P,P}_renderWithInstances(H,c,y,Z,F){const P=y.visibleInstances[H._id],S=P?P.length:0,n=this._instanceDataStorage,O=n.instancesBufferSize;let i=n.instancesBuffer,C=n.instancesPreviousBuffer;const v=16*(S+1)*4;for(;n.instancesBufferSize<v;)n.instancesBufferSize*=2;n.instancesData&&O==n.instancesBufferSize||(n.instancesData=new Float32Array(n.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousData||O!=n.instancesBufferSize)&&(n.instancesPreviousData=new Float32Array(n.instancesBufferSize/4));let m=0,z=0;const V=y.renderSelf[H._id],h=!i||O!==n.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||n.isFrozen&&!h)z=(V?1:0)+S;else{const c=this.getWorldMatrix();if(V&&(this._scene.needsPreviousWorldMatrices&&(n.masterMeshPreviousWorldMatrix?(n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,m),n.masterMeshPreviousWorldMatrix.p(c)):(n.masterMeshPreviousWorldMatrix=c.clone(),n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,m))),c.copyToArray(n.instancesData,m),m+=16,z++),P){var Q;if(t.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(Q=H.Ha())&&void 0!==Q&&Q.needAlphaBlendingForMesh(H.getRenderingMesh())){const H=this._scene.activeCamera.globalPosition;for(let c=0;c<P.length;c++){const y=P[c];y._distanceToCamera=a.n.Distance(y.getBoundingInfo().boundingSphere.centerWorld,H)}P.sort(((H,c)=>H._distanceToCamera>c._distanceToCamera?-1:H._distanceToCamera<c._distanceToCamera?1:0))}for(let H=0;H<P.length;H++){const c=P[H],y=c.getWorldMatrix();y.copyToArray(n.instancesData,m),this._scene.needsPreviousWorldMatrices&&(c._previousWorldMatrix?(c._previousWorldMatrix.copyToArray(n.instancesPreviousData,m),c._previousWorldMatrix.p(y)):(c._previousWorldMatrix=y.clone(),c._previousWorldMatrix.copyToArray(n.instancesPreviousData,m))),m+=16,z++}}}return h?(i&&i.dispose(),C&&C.dispose(),i=new g.d(F,n.instancesData,!0,16,!1,!0),n.instancesBuffer=i,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=i.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=i.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=i.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=i.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(C=new g.d(F,n.instancesPreviousData,!0,16,!1,!0),n.instancesPreviousBuffer=C,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=C.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=C.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=C.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=C.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(i.updateDirectly(n.instancesData,0,z),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||C.updateDirectly(n.instancesPreviousData,0,z)),this._processInstancedBuffers(P,V),this.va()._activeIndices.addCount(H.indexCount*z,!1),F._currentDrawContext&&(F._currentDrawContext.useInstancing=!0),this._bind(H,Z,c),this._draw(H,c,z),!this._scene.needsPreviousWorldMatrices||h||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||C.updateDirectly(n.instancesData,0,z),F.unbindInstanceAttributes(),this}_renderWithThinInstances(H,c,y,Z){var F;const P=(null===(F=this._thinInstanceDataStorage)||void 0===F?void 0:F.instancesCount)??0;this.va()._activeIndices.addCount(H.indexCount*P,!1),Z._currentDrawContext&&(Z._currentDrawContext.useInstancing=!0),this._bind(H,y,c),this._draw(H,c,P),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,P):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),Z.unbindInstanceAttributes()}_processInstancedBuffers(H,c){}_processRendering(H,c,y,Z,F,P,S,n){const O=this.va(),a=O.getEngine();if(Z=this._getRenderingFillMode(Z),P&&c.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(c,Z,y,a),this;if(P)this._renderWithInstances(c,Z,F,y,a);else{a._currentDrawContext&&(a._currentDrawContext.useInstancing=!1);let y=0;F.renderSelf[c._id]&&(S&&S(!1,H.getWorldMatrix(),n),y++,this._draw(c,Z,this._instanceDataStorage.overridenInstanceCount));const P=F.visibleInstances[c._id];if(P){const H=P.length;y+=H;for(let y=0;y<H;y++){const H=P[y].getWorldMatrix();S&&S(!0,H,n),this._draw(c,Z)}}O._activeIndices.addCount(c.indexCount*y,!1)}return this}_rebuild(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(H&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const c in this._userInstancedBuffersStorage.vertexBuffers){const y=this._userInstancedBuffersStorage.vertexBuffers[c];y&&(H&&y.dispose(),this._userInstancedBuffersStorage.vertexBuffers[c]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(H)}_freeze(){if(this.$f){for(let H=0;H<this.$f.length;H++)this._getInstancesRenderList(H);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(H,c,y,Z){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=this._scene.getEngine(),S=P.currentRenderPassId;if(void 0!==H&&(P.currentRenderPassId=H),Z)(!F||F&&Z.isInFrustum(this._scene._frustumPlanes))&&this.render(Z,!!c,y);else for(let n=0;n<this.$f.length;n++){const H=this.$f[n];(!F||F&&H.isInFrustum(this._scene._frustumPlanes))&&this.render(H,!!c,y)}return void 0!==H&&(P.currentRenderPassId=S),this}directRender(){if(!this.$f)return this;for(const H of this.$f)this.render(H,!1);return this}render(H,c,y){var Z,F,P;const S=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const n=(null===(Z=S.activeCameras)||void 0===Z?void 0:Z.length)??0;if((n>1&&S.activeCamera===S.activeCameras[0]||n<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const O=this._getInstancesRenderList(H._id,!!y);if(O.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=S.getEngine();let i=0,C=null;this.ignoreCameraMaxZ&&S.activeCamera&&!S._isInIntermediateRendering()&&(i=S.activeCamera.maxZ,C=S.activeCamera,S.activeCamera.maxZ=0,S.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const g=H.getRenderingMesh(),v=O.hardwareInstancedRendering[H._id]||g.hasThinInstances||!!this._userInstancedBuffersStorage&&!H.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,m=this._instanceDataStorage,z=H.Ha();if(!z)return C&&(C.maxZ=i,S.updateTransformMatrix(!0)),this;if(m.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===z){if(z._storeEffectOnSubMeshes&&(null===(F=H._drawWrapper)||void 0===F||!F._wasPreviouslyReady)||!z._storeEffectOnSubMeshes&&!z._getDrawWrapper()._wasPreviouslyReady)return C&&(C.maxZ=i,S.updateTransformMatrix(!0)),this}else{if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(this,H,v))return C&&(C.maxZ=i,S.updateTransformMatrix(!0)),this}else if(!z.isReady(this,v))return C&&(C.maxZ=i,S.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=z}let V;c&&a.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),V=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?H._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const Q=(null===(P=V)||void 0===P?void 0:P.effect)??null;for(const h of S._beforeRenderingMeshStage)h.action(this,H,O,Q);if(!V||!Q)return C&&(C.maxZ=i,S.updateTransformMatrix(!0)),this;const D=y||this;let f;if(m.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.dh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)f=m.sideOrientation;else{const H=D._getWorldMatrixDeterminant();f=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),H<0&&(f=f===h.c.ClockWiseSideOrientation?h.c.CounterClockWiseSideOrientation:h.c.ClockWiseSideOrientation),m.sideOrientation=f}const J=this._internalMeshDataInfo._effectiveMaterial._preBind(V,f);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);const l=this._internalMeshDataInfo._effectiveMaterial,d=l.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),v||this._bind(H,Q,d,!1);const K=D.getWorldMatrix();l._storeEffectOnSubMeshes?l.bindForSubMesh(K,this,H):l.bind(K,this),!l.dh&&l.separateCullingPass&&(a.setState(!0,l.zOffset,!1,!J,l.cullBackFaces,l.stencil,l.zOffsetUnits),this._processRendering(this,H,Q,d,O,v,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),a.setState(!0,l.zOffset,!1,J,l.cullBackFaces,l.stencil,l.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(H)),this._processRendering(this,H,Q,d,O,v,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const h of S._afterRenderingMeshStage)h.action(this,H,O,Q);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),C&&(C.maxZ=i,S.updateTransformMatrix(!0)),2!==S.performancePriority||m.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(g.h.MatricesWeightsKind)&&(this.isVerticesDataPresent(g.h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const H=this.getVerticesData(g.h.MatricesWeightsKind),c=H.length;for(let y=0;y<c;y+=4){const c=H[y]+H[y+1]+H[y+2]+H[y+3];if(0===c)H[y]=1;else{const Z=1/c;H[y]*=Z,H[y+1]*=Z,H[y+2]*=Z,H[y+3]*=Z}}this.Ga(g.h.MatricesWeightsKind,H)}_normalizeSkinWeightsAndExtra(){const H=this.getVerticesData(g.h.MatricesWeightsExtraKind),c=this.getVerticesData(g.h.MatricesWeightsKind),y=c.length;for(let Z=0;Z<y;Z+=4){let y=c[Z]+c[Z+1]+c[Z+2]+c[Z+3];if(y+=H[Z]+H[Z+1]+H[Z+2]+H[Z+3],0===y)c[Z]=1;else{const F=1/y;c[Z]*=F,c[Z+1]*=F,c[Z+2]*=F,c[Z+3]*=F,H[Z]*=F,H[Z+1]*=F,H[Z+2]*=F,H[Z+3]*=F}}this.Ga(g.h.MatricesWeightsKind,c),this.Ga(g.h.MatricesWeightsKind,H)}validateSkinning(){const H=this.getVerticesData(g.h.MatricesWeightsExtraKind),c=this.getVerticesData(g.h.MatricesWeightsKind);if(null===c||null==this.skeleton)return{skinned:!1,valid:!0,km:"not skinned"};const y=c.length;let Z=0,F=0,P=0,S=0;const n=null===H?4:8,O=[];for(let g=0;g<=n;g++)O[g]=0;for(let g=0;g<y;g+=4){let y=c[g],a=y,i=0===a?0:1;for(let F=1;F<n;F++){const P=F<4?c[g+F]:H[g+F-4];P>y&&Z++,0!==P&&i++,a+=P,y=P}if(O[i]++,i>P&&(P=i),0===a)F++;else{const y=1/a;let Z=0;for(let F=0;F<n;F++)Z+=F<4?Math.abs(c[g+F]-c[g+F]*y):Math.abs(H[g+F-4]-H[g+F-4]*y);Z>.001&&S++}}const a=this.skeleton.bones.length,i=this.getVerticesData(g.h.MatricesIndicesKind),C=this.getVerticesData(g.h.MatricesIndicesExtraKind);let v=0;for(let g=0;g<y;g+=4)for(let H=0;H<n;H++){const c=H<4?i[g+H]:C[g+H-4];(c>=a||c<0)&&v++}return{skinned:!0,valid:0===F&&0===S&&0===v,km:"Number of Weights = "+y/4+"\nMaximum influences = "+P+"\nMissing Weights = "+F+"\nNot Sorted = "+Z+"\nNot Normalized = "+S+"\nWeightCounts = ["+O+"]\nNumber of bones = "+a+"\nBad Bone Indices = "+v}}_checkDelayState(){const H=this.va();return this._geometry?this._geometry.load(H):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(H)),this}_queueLoad(H){H.addPendingData(this);const c=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return F.c.LoadFile(this.delayLoadingFile,(c=>{c instanceof ArrayBuffer?this._delayLoadingFunction(c,this):this._delayLoadingFunction(JSON.parse(c),this),this.instances.forEach((H=>{H.refreshBoundingInfo(),H._syncSubMeshes()})),this.delayLoadState=1,H.removePendingData(this)}),(()=>{}),H.offlineProvider,c),this}isInFrustum(H){return 2!==this.delayLoadState&&(!!super.isInFrustum(H)&&(this._checkDelayState(),!0))}setMaterialById(H){const c=this.va().materials;let y;for(y=c.length-1;y>-1;y--)if(c[y].id===H)return this.material=c[y],this;const Z=this.va().multiMaterials;for(y=Z.length-1;y>-1;y--)if(Z[y].id===H)return this.material=Z[y],this;return this}getAnimatables(){const H=[];return this.material&&H.push(this.material),this.skeleton&&H.push(this.skeleton),H}bakeTransformIntoVertices(H){if(!this.isVerticesDataPresent(g.h.PositionKind))return this;const c=this.$f.splice(0);this._resetPointsArrayCache();let y=this.getVerticesData(g.h.PositionKind);const Z=a.n.Zero();let F;for(F=0;F<y.length;F+=3)a.n.TransformCoordinatesFromFloatsToRef(y[F],y[F+1],y[F+2],H,Z).toArray(y,F);if(this.Ga(g.h.PositionKind,y,this.getVertexBuffer(g.h.PositionKind).isUpdatable()),this.isVerticesDataPresent(g.h.NormalKind)){for(y=this.getVerticesData(g.h.NormalKind),F=0;F<y.length;F+=3)a.n.TransformNormalFromFloatsToRef(y[F],y[F+1],y[F+2],H,Z).normalize().toArray(y,F);this.Ga(g.h.NormalKind,y,this.getVertexBuffer(g.h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(g.h.TangentKind)){for(y=this.getVerticesData(g.h.TangentKind),F=0;F<y.length;F+=4)a.n.TransformNormalFromFloatsToRef(y[F],y[F+1],y[F+2],H,Z).normalize().toArray(y,F);this.Ga(g.h.TangentKind,y,this.getVertexBuffer(g.h.TangentKind).isUpdatable())}return H.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.$f=c,this}bakeCurrentTransformIntoVertices(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Oj(!0)),this.resetLocalMatrix(H),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),H,this,c,y)}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const y=this._internalMeshDataInfo;if(y._onBeforeDrawObservable&&y._onBeforeDrawObservable.clear(),y._onBeforeBindObservable&&y._onBeforeBindObservable.clear(),y._onBeforeRenderObservable&&y._onBeforeRenderObservable.clear(),y._onAfterRenderObservable&&y._onAfterRenderObservable.clear(),y._onBetweenPassObservable&&y._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(y.meshMap)for(const H in y.meshMap){const c=y.meshMap[H];c&&(c._internalMeshDataInfo._source=null,y.meshMap[H]=void 0)}y._source&&y._source._internalMeshDataInfo.meshMap&&(y._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const H=this.va().meshes;for(const c of H){const H=c;H._internalMeshDataInfo&&H._internalMeshDataInfo._source&&H._internalMeshDataInfo._source===this&&(H._internalMeshDataInfo._source=null)}}y._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(H,c)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(H,c,y,Z,P,S){let n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0;const a=this.va();return F.c.LoadImage(H,(H=>{const F=H.width,O=H.height,a=this.getEngine().createCanvas(F,O).getContext("2d");a.drawImage(H,0,0);const i=a.getImageData(0,0,F,O).data;this.applyDisplacementMapFromBuffer(i,F,O,c,y,P,S,n),Z&&Z(this)}),O||(()=>{}),a.offlineProvider),this}applyDisplacementMapFromBuffer(H,c,y,Z,F,P,S){let n=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(g.h.PositionKind)||!this.isVerticesDataPresent(g.h.NormalKind)||!this.isVerticesDataPresent(g.h.UVKind))return J.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const O=this.getVerticesData(g.h.PositionKind,!0,!0),i=this.getVerticesData(g.h.NormalKind),C=this.getVerticesData(g.h.UVKind);let m=a.n.Zero();const z=a.n.Zero(),V=a.l.Zero();P=P||a.l.Zero(),S=S||new a.l(1,1);for(let g=0;g<O.length;g+=3){a.n.FromArrayToRef(O,g,m),a.n.FromArrayToRef(i,g,z),a.l.FromArrayToRef(C,g/3*2,V);const n=4*((Math.abs(V.x*S.x+P.x%1)*(c-1)%c|0)+(Math.abs(V.y*S.y+P.y%1)*(y-1)%y|0)*c),v=.3*(H[n]/255)+.59*(H[n+1]/255)+.11*(H[n+2]/255);z.normalize(),z.scaleInPlace(Z+(F-Z)*v),m=m.add(z),m.toArray(O,g)}return v.c.ComputeNormals(O,this.Vf(),i),n?(this.Ga(g.h.PositionKind,O),this.Ga(g.h.NormalKind,i),this.Ga(g.h.UVKind,C)):(this.updateVerticesData(g.h.PositionKind,O),this.updateVerticesData(g.h.NormalKind,i)),this}_getFlattenedNormals(H,c){const y=new Float32Array(3*H.length);let Z=0;const F=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let P=0;P<H.length;P+=3){const S=a.n.Tg(c,3*H[P]),n=a.n.Tg(c,3*H[P+1]),O=a.n.Tg(c,3*H[P+2]),i=S.Rc(n),C=O.Rc(n),g=a.n.Normalize(a.n.Cross(i,C));F&&g.scaleInPlace(-1);for(let H=0;H<3;H++)y[Z++]=g.x,y[Z++]=g.y,y[Z++]=g.z}return y}_convertToUnIndexedMesh(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.getVerticesDataKinds().filter((H=>{var c;return!(null!==(c=this.getVertexBuffer(H))&&void 0!==c&&c.getIsInstanced())})),y=this.Vf(),Z={},F=(H,c)=>{const Z=new Float32Array(y.length*c);let F=0;for(let P=0;P<y.length;P++)for(let S=0;S<c;S++)Z[F++]=H[y[P]*c+S];return Z},P=this.getBoundingInfo(),S=this.Dj?this.$f.slice(0):[];for(const n of c)Z[n]=this.getVerticesData(n);for(const n of c){const c=this.getVertexBuffer(n),P=c.getSize();if(H&&n===g.h.NormalKind){const H=this._getFlattenedNormals(y,Z[g.h.PositionKind]);this.Ga(g.h.NormalKind,H,c.isUpdatable(),P)}else this.Ga(n,F(Z[n],P),c.isUpdatable(),P)}if(this.morphTargetManager){for(let c=0;c<this.morphTargetManager.numTargets;c++){const Z=this.morphTargetManager.getTarget(c),P=Z.getPositions();Z.setPositions(F(P,3));const S=Z.getNormals();S&&Z.setNormals(H?this._getFlattenedNormals(y,P):F(S,3));const n=Z.getTangents();n&&Z.setTangents(F(n,3));const O=Z.getUVs();O&&Z.setUVs(F(O,2))}this.morphTargetManager.synchronize()}for(let n=0;n<y.length;n++)y[n]=n;this.setIndices(y),this._unIndexed=!0,this.releaseSubMeshes();for(const n of S){const H=n.getBoundingInfo();V.b.AddToMesh(n.materialIndex,n.indexStart,n.indexCount,n.indexStart,n.indexCount,this).setBoundingInfo(H)}return this.setBoundingInfo(P),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=v.c.ExtractFromMesh(this);let y;if(H&&this.isVerticesDataPresent(g.h.NormalKind)&&c.ya){for(y=0;y<c.ya.length;y++)c.ya[y]*=-1;this.Ga(g.h.NormalKind,c.ya,this.isVertexBufferUpdatable(g.h.NormalKind))}if(c.indices){let H;for(y=0;y<c.indices.length;y+=3)H=c.indices[y+1],c.indices[y+1]=c.indices[y+2],c.indices[y+2]=H;this.setIndices(c.indices,null,this.isVertexBufferUpdatable(g.h.PositionKind),!0)}return this}increaseVertices(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const c=v.c.ExtractFromMesh(this),y=c.indices&&!Array.isArray(c.indices)&&Array.from?Array.from(c.indices):c.indices,Z=c.xa&&!Array.isArray(c.xa)&&Array.from?Array.from(c.xa):c.xa,F=c.Aa&&!Array.isArray(c.Aa)&&Array.from?Array.from(c.Aa):c.Aa,P=c.ya&&!Array.isArray(c.ya)&&Array.from?Array.from(c.ya):c.ya;if(y&&Z){c.indices=y,c.xa=Z,F&&(c.Aa=F),P&&(c.ya=P);const S=H+1,n=new Array;for(let H=0;H<S+1;H++)n[H]=new Array;let O,i;const C=new a.n(0,0,0),v=new a.n(0,0,0),m=new a.l(0,0),z=new Array,V=new Array,h=new Array;let Q,D,f,J=Z.length;F&&(D=F.length),P&&(f=P.length);for(let H=0;H<y.length;H+=3){V[0]=y[H],V[1]=y[H+1],V[2]=y[H+2];for(let H=0;H<3;H++)if(O=V[H],i=V[(H+1)%3],void 0===h[O]&&void 0===h[i]?(h[O]=new Array,h[i]=new Array):(void 0===h[O]&&(h[O]=new Array),void 0===h[i]&&(h[i]=new Array)),void 0===h[O][i]&&void 0===h[i][O]){h[O][i]=[],C.x=(Z[3*i]-Z[3*O])/S,C.y=(Z[3*i+1]-Z[3*O+1])/S,C.z=(Z[3*i+2]-Z[3*O+2])/S,P&&(v.x=(P[3*i]-P[3*O])/S,v.y=(P[3*i+1]-P[3*O+1])/S,v.z=(P[3*i+2]-P[3*O+2])/S),F&&(m.x=(F[2*i]-F[2*O])/S,m.y=(F[2*i+1]-F[2*O+1])/S),h[O][i].push(O);for(let H=1;H<S;H++)h[O][i].push(Z.length/3),Z[J++]=Z[3*O]+H*C.x,Z[J++]=Z[3*O+1]+H*C.y,Z[J++]=Z[3*O+2]+H*C.z,P&&(P[f++]=P[3*O]+H*v.x,P[f++]=P[3*O+1]+H*v.y,P[f++]=P[3*O+2]+H*v.z),F&&(F[D++]=F[2*O]+H*m.x,F[D++]=F[2*O+1]+H*m.y);h[O][i].push(i),h[i][O]=new Array,Q=h[O][i].length;for(let H=0;H<Q;H++)h[i][O][H]=h[O][i][Q-1-H]}n[0][0]=y[H],n[1][0]=h[y[H]][y[H+1]][1],n[1][1]=h[y[H]][y[H+2]][1];for(let c=2;c<S;c++){n[c][0]=h[y[H]][y[H+1]][c],n[c][c]=h[y[H]][y[H+2]][c],C.x=(Z[3*n[c][c]]-Z[3*n[c][0]])/c,C.y=(Z[3*n[c][c]+1]-Z[3*n[c][0]+1])/c,C.z=(Z[3*n[c][c]+2]-Z[3*n[c][0]+2])/c,P&&(v.x=(P[3*n[c][c]]-P[3*n[c][0]])/c,v.y=(P[3*n[c][c]+1]-P[3*n[c][0]+1])/c,v.z=(P[3*n[c][c]+2]-P[3*n[c][0]+2])/c),F&&(m.x=(F[2*n[c][c]]-F[2*n[c][0]])/c,m.y=(F[2*n[c][c]+1]-F[2*n[c][0]+1])/c);for(let H=1;H<c;H++)n[c][H]=Z.length/3,Z[J++]=Z[3*n[c][0]]+H*C.x,Z[J++]=Z[3*n[c][0]+1]+H*C.y,Z[J++]=Z[3*n[c][0]+2]+H*C.z,P&&(P[f++]=P[3*n[c][0]]+H*v.x,P[f++]=P[3*n[c][0]+1]+H*v.y,P[f++]=P[3*n[c][0]+2]+H*v.z),F&&(F[D++]=F[2*n[c][0]]+H*m.x,F[D++]=F[2*n[c][0]+1]+H*m.y)}n[S]=h[y[H+1]][y[H+2]],z.push(n[0][0],n[1][0],n[1][1]);for(let H=1;H<S;H++){let c;for(c=0;c<H;c++)z.push(n[H][c],n[H+1][c],n[H+1][c+1]),z.push(n[H][c],n[H+1][c+1],n[H][c+1]);z.push(n[H][c],n[H+1][c],n[H+1][c+1])}}c.indices=z,c.Ca(this,this.isVertexBufferUpdatable(g.h.PositionKind))}else J.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const H=v.c.ExtractFromMesh(this),c=H.Aa,y=H.indices,Z=H.xa,F=H.za,P=H.matricesIndices,S=H.matricesWeights,n=H.matricesIndicesExtra,O=H.matricesWeightsExtra;if(void 0===y||void 0===Z||null===y||null===Z)J.d.Warn("VertexData contains empty entries");else{const a=new Array,i=new Array,C=new Array,m=new Array,z=new Array,V=new Array,h=new Array,Q=new Array;let D=new Array,f=0;const J={};let l,d;for(let H=0;H<y.length;H+=3){d=[y[H],y[H+1],y[H+2]],D=[];for(let H=0;H<3;H++){D[H]="";for(let c=0;c<3;c++)Math.abs(Z[3*d[H]+c])<1e-8&&(Z[3*d[H]+c]=0),D[H]+=Z[3*d[H]+c]+"|"}if(D[0]!=D[1]&&D[0]!=D[2]&&D[1]!=D[2])for(let H=0;H<3;H++){if(l=J[D[H]],void 0===l){J[D[H]]=f,l=f++;for(let c=0;c<3;c++)a.push(Z[3*d[H]+c]);if(null!==F&&void 0!==F)for(let c=0;c<4;c++)m.push(F[4*d[H]+c]);if(null!==c&&void 0!==c)for(let y=0;y<2;y++)C.push(c[2*d[H]+y]);if(null!==P&&void 0!==P)for(let c=0;c<4;c++)z.push(P[4*d[H]+c]);if(null!==S&&void 0!==S)for(let c=0;c<4;c++)V.push(S[4*d[H]+c]);if(null!==n&&void 0!==n)for(let c=0;c<4;c++)h.push(n[4*d[H]+c]);if(null!==O&&void 0!==O)for(let c=0;c<4;c++)Q.push(O[4*d[H]+c])}i.push(l)}}const K=new Array;v.c.ComputeNormals(a,i,K),H.xa=a,H.indices=i,H.ya=K,null!==c&&void 0!==c&&(H.Aa=C),null!==F&&void 0!==F&&(H.za=m),null!==P&&void 0!==P&&(H.matricesIndices=z),null!==S&&void 0!==S&&(H.matricesWeights=V),null!==n&&void 0!==n&&(H.matricesIndicesExtra=h),null!==S&&void 0!==S&&(H.matricesWeightsExtra=Q),H.Ca(this,this.isVertexBufferUpdatable(g.h.PositionKind))}}static _instancedMeshFactory(H,c){throw(0,d.b)("InstancedMesh")}static _PhysicsImpostorParser(H,c,y){throw(0,d.b)("PhysicsImpostor")}createInstance(H){const c=t._instancedMeshFactory(H,this);return c.parent=this.parent,c}synchronizeInstances(){for(let H=0;H<this.instances.length;H++){this.instances[H]._syncSubMeshes()}return this}optimizeIndices(H){const c=this.Vf(),y=this.getVerticesData(g.h.PositionKind);if(!y||!c)return this;const Z=[];for(let F=0;F<y.length;F+=3)Z.push(a.n.Tg(y,F));const P=[];return F.b.SyncAsyncForLoop(Z.length,40,(H=>{const c=Z.length-1-H,y=Z[c];for(let F=0;F<c;++F){const H=Z[F];if(y.equals(H)){P[c]=F;break}}}),(()=>{for(let H=0;H<c.length;++H)c[H]=P[c[H]]||c[H];const y=this.$f.slice(0);this.setIndices(c),this.$f=y,H&&H(this)})),this}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H.name=this.name,H.id=this.id,H.uniqueId=this.uniqueId,H.type=this.getClassName(),S.d&&S.d.HasTags(this)&&(H.tags=S.d.GetTags(this)),H.position=this.position.ij(),this.rotationQuaternion?H.rotationQuaternion=this.rotationQuaternion.ij():this.rotation&&(H.rotation=this.rotation.ij()),H.de=this.de.ij(),this._postMultiplyPivotMatrix?H.pivotMatrix=this.getPivotMatrix().ij():H.localMatrix=this.getPivotMatrix().ij(),H.isEnabled=this.isEnabled(!1),H.isVisible=this.isVisible,H.infiniteDistance=this.infiniteDistance,H.pickable=this.Qb,H.receiveShadows=this.receiveShadows,H.billboardMode=this.billboardMode,H.visibility=this.visibility,H.tb=this.tb,H.checkCollisions=this.checkCollisions,H.ellipsoid=this.ellipsoid.ij(),H.ellipsoidOffset=this.ellipsoidOffset.ij(),H.Da=this.Da,H.isBlocker=this.isBlocker,H.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(H),H.isUnIndexed=this.isUnIndexed;const c=this._geometry;if(c&&this.$f){H.geometryUniqueId=c.uniqueId,H.geometryId=c.id,H.$f=[];for(let c=0;c<this.$f.length;c++){const y=this.$f[c];H.$f.push({materialIndex:y.materialIndex,verticesStart:y.verticesStart,verticesCount:y.verticesCount,indexStart:y.indexStart,indexCount:y.indexCount})}}if(this.material?this.material.doNotSerialize||(H.materialUniqueId=this.material.uniqueId,H.materialId=this.material.id):(this.material=null,H.materialUniqueId=this._scene.defaultMaterial.uniqueId,H.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(H.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(H.skeletonId=this.skeleton.id,H.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(K.d.NAME_PHYSICSENGINE)){const c=this.getPhysicsImpostor();c&&(H.physicsMass=c.getParam("mass"),H.physicsFriction=c.getParam("friction"),H.physicsRestitution=c.getParam("mass"),H.physicsImpostor=c.type)}this.metadata&&(H.metadata=this.metadata),H.instances=[];for(let y=0;y<this.instances.length;y++){const c=this.instances[y];if(c.doNotSerialize)continue;const Z={name:c.name,id:c.id,isEnabled:c.isEnabled(!1),isVisible:c.isVisible,Qb:c.Qb,checkCollisions:c.checkCollisions,position:c.position.ij(),de:c.de.ij()};if(c.parent&&c.parent._serializeAsParent(Z),c.rotationQuaternion?Z.rotationQuaternion=c.rotationQuaternion.ij():c.rotation&&(Z.rotation=c.rotation.ij()),this.va()._getComponent(K.d.NAME_PHYSICSENGINE)){const H=c.getPhysicsImpostor();H&&(Z.physicsMass=H.getParam("mass"),Z.physicsFriction=H.getParam("friction"),Z.physicsRestitution=H.getParam("mass"),Z.physicsImpostor=H.type)}c.metadata&&(Z.metadata=c.metadata),c.actionManager&&(Z.actions=c.actionManager.serialize(c.name)),H.instances.push(Z),f.e.AppendSerializedAnimations(c,Z),Z.ranges=c.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(H.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const c={data:{},sizes:{},strides:{}};for(const H in this._userThinInstanceBuffersStorage.data)c.data[H]=Array.from(this._userThinInstanceBuffersStorage.data[H]),c.sizes[H]=this._userThinInstanceBuffersStorage.sizes[H],c.strides[H]=this._userThinInstanceBuffersStorage.strides[H];H.thinInstances.userThinInstance=c}return f.e.AppendSerializedAnimations(this,H),H.ranges=this.serializeAnimationRanges(),H.layerMask=this.layerMask,H.alphaIndex=this.alphaIndex,H.hasVertexAlpha=this.hasVertexAlpha,H.overlayAlpha=this.overlayAlpha,H.overlayColor=this.overlayColor.ij(),H.renderOverlay=this.renderOverlay,H.applyFog=this.applyFog,this.actionManager&&(H.actions=this.actionManager.serialize(this.name)),H}_syncGeometryWithMorphTargetManager(){if(!this.Dj)return;this._markSubMeshesAsAttributesDirty();const H=this._internalAbstractMeshDataInfo._morphTargetManager;if(H&&H.vertexCount){if(H.vertexCount!==this.getTotalVertices())return J.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(H.isUsingTextureForTargets)return;for(let c=0;c<H.numInfluencers;c++){const y=H.getActiveTarget(c),Z=y.getPositions();if(!Z)return void J.d.Error("Invalid morph target. Target must have positions.");this.Dj.Ga(g.h.PositionKind+c,Z,!1,3);const F=y.getNormals();F&&this.Dj.Ga(g.h.NormalKind+c,F,!1,3);const P=y.getTangents();P&&this.Dj.Ga(g.h.TangentKind+c,P,!1,3);const S=y.getUVs();S&&this.Dj.Ga(g.h.UVKind+"_"+c,S,!1,2)}}else{let H=0;for(;this.Dj.isVerticesDataPresent(g.h.PositionKind+H);)this.Dj.removeVerticesData(g.h.PositionKind+H),this.Dj.isVerticesDataPresent(g.h.NormalKind+H)&&this.Dj.removeVerticesData(g.h.NormalKind+H),this.Dj.isVerticesDataPresent(g.h.TangentKind+H)&&this.Dj.removeVerticesData(g.h.TangentKind+H),this.Dj.isVerticesDataPresent(g.h.UVKind+H)&&this.Dj.removeVerticesData(g.h.UVKind+"_"+H),H++}}static Parse(H,c,y){let Z;if(Z=H.type&&"LinesMesh"===H.type?t._LinesMeshParser(H,c):H.type&&"GroundMesh"===H.type?t._GroundMeshParser(H,c):H.type&&"GoldbergMesh"===H.type?t._GoldbergMeshParser(H,c):H.type&&"GreasedLineMesh"===H.type?t._GreasedLineMeshParser(H,c):H.type&&"TrailMesh"===H.type?t._TrailMeshParser(H,c):new t(H.name,c),Z.id=H.id,Z._waitingParsedUniqueId=H.uniqueId,S.d&&S.d.AddTagsTo(Z,H.tags),Z.position=a.n.Tg(H.position),void 0!==H.metadata&&(Z.metadata=H.metadata),H.rotationQuaternion?Z.rotationQuaternion=a.f.Tg(H.rotationQuaternion):H.rotation&&(Z.rotation=a.n.Tg(H.rotation)),Z.de=a.n.Tg(H.de),H.localMatrix?Z.setPreTransformMatrix(a.d.Tg(H.localMatrix)):H.pivotMatrix&&Z.setPivotMatrix(a.d.Tg(H.pivotMatrix)),Z.Tb(H.isEnabled),Z.isVisible=H.isVisible,Z.infiniteDistance=H.infiniteDistance,Z.tb=!!H.tb,Z.showBoundingBox=H.showBoundingBox,Z.showSubMeshesBoundingBox=H.showSubMeshesBoundingBox,void 0!==H.applyFog&&(Z.applyFog=H.applyFog),void 0!==H.pickable&&(Z.Qb=H.pickable),void 0!==H.alphaIndex&&(Z.alphaIndex=H.alphaIndex),Z.receiveShadows=H.receiveShadows,void 0!==H.billboardMode&&(Z.billboardMode=H.billboardMode),void 0!==H.visibility&&(Z.visibility=H.visibility),Z.checkCollisions=H.checkCollisions,Z.Da=!!H.Da,H.ellipsoid&&(Z.ellipsoid=a.n.Tg(H.ellipsoid)),H.ellipsoidOffset&&(Z.ellipsoidOffset=a.n.Tg(H.ellipsoidOffset)),null!=H.overrideMaterialSideOrientation&&(Z.sideOrientation=H.overrideMaterialSideOrientation),void 0!==H.sideOrientation&&(Z.sideOrientation=H.sideOrientation),void 0!==H.isBlocker&&(Z.isBlocker=H.isBlocker),Z._shouldGenerateFlatShading=H.useFlatShading,H.Kc&&(Z._waitingData.Kc=H.Kc),void 0!==H.parentId&&(Z._waitingParentId=H.parentId),void 0!==H.parentInstanceIndex&&(Z._waitingParentInstanceIndex=H.parentInstanceIndex),void 0!==H.actions&&(Z._waitingData.actions=H.actions),void 0!==H.overlayAlpha&&(Z.overlayAlpha=H.overlayAlpha),void 0!==H.overlayColor&&(Z.overlayColor=i.e.Tg(H.overlayColor)),void 0!==H.renderOverlay&&(Z.renderOverlay=H.renderOverlay),Z.isUnIndexed=!!H.isUnIndexed,Z.hasVertexAlpha=H.hasVertexAlpha,H.delayLoadingFile?(Z.delayLoadState=4,Z.delayLoadingFile=y+H.delayLoadingFile,Z.buildBoundingInfo(a.n.Tg(H.boundingBoxMinimum),a.n.Tg(H.boundingBoxMaximum)),H._binaryInfo&&(Z._binaryInfo=H._binaryInfo),Z._delayInfo=[],H.hasUVs&&Z._delayInfo.push(g.h.UVKind),H.hasUVs2&&Z._delayInfo.push(g.h.UV2Kind),H.hasUVs3&&Z._delayInfo.push(g.h.UV3Kind),H.hasUVs4&&Z._delayInfo.push(g.h.UV4Kind),H.hasUVs5&&Z._delayInfo.push(g.h.UV5Kind),H.hasUVs6&&Z._delayInfo.push(g.h.UV6Kind),H.hasColors&&Z._delayInfo.push(g.h.ColorKind),H.hasMatricesIndices&&Z._delayInfo.push(g.h.MatricesIndicesKind),H.hasMatricesWeights&&Z._delayInfo.push(g.h.MatricesWeightsKind),Z._delayLoadingFunction=m.d._ImportGeometry,D.c.ForceFullSceneLoadingForIncremental&&Z._checkDelayState()):m.d._ImportGeometry(H,Z),H.materialUniqueId?Z._waitingMaterialId=H.materialUniqueId:H.materialId&&(Z._waitingMaterialId=H.materialId),H.morphTargetManagerId>-1&&(Z._waitingMorphTargetManagerId=H.morphTargetManagerId),void 0!==H.skeletonId&&null!==H.skeletonId&&(Z.skeleton=c.getLastSkeletonById(H.skeletonId),H.numBoneInfluencers&&(Z.numBoneInfluencers=H.numBoneInfluencers)),H.animations){for(let c=0;c<H.animations.length;c++){const y=H.animations[c],F=(0,l.c)("BABYLON.Animation");F&&Z.animations.push(F.Parse(y))}C.d.ParseAnimationRanges(Z,H,c)}if(H.autoAnimate&&c.beginAnimation(Z,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),H.layerMask&&!isNaN(H.layerMask)?Z.layerMask=Math.abs(parseInt(H.layerMask)):Z.layerMask=268435455,H.physicsImpostor&&(Z.physicsImpostor=t._PhysicsImpostorParser(c,Z,H)),H.lodMeshIds&&(Z._waitingData.lods={ids:H.lodMeshIds,distances:H.lodDistances?H.lodDistances:null,coverages:H.lodCoverages?H.lodCoverages:null}),H.instances)for(let F=0;F<H.instances.length;F++){const y=H.instances[F],P=Z.createInstance(y.name);if(y.id&&(P.id=y.id),S.d&&(y.tags?S.d.AddTagsTo(P,y.tags):S.d.AddTagsTo(P,H.tags)),P.position=a.n.Tg(y.position),void 0!==y.metadata&&(P.metadata=y.metadata),void 0!==y.parentId&&(P._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(P._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.isEnabled&&null!==y.isEnabled&&P.Tb(y.isEnabled),void 0!==y.isVisible&&null!==y.isVisible&&(P.isVisible=y.isVisible),void 0!==y.Qb&&null!==y.Qb&&(P.Qb=y.Qb),y.rotationQuaternion?P.rotationQuaternion=a.f.Tg(y.rotationQuaternion):y.rotation&&(P.rotation=a.n.Tg(y.rotation)),P.de=a.n.Tg(y.de),void 0!=y.checkCollisions&&null!=y.checkCollisions&&(P.checkCollisions=y.checkCollisions),void 0!=y.pickable&&null!=y.pickable&&(P.Qb=y.pickable),void 0!=y.showBoundingBox&&null!=y.showBoundingBox&&(P.showBoundingBox=y.showBoundingBox),void 0!=y.showSubMeshesBoundingBox&&null!=y.showSubMeshesBoundingBox&&(P.showSubMeshesBoundingBox=y.showSubMeshesBoundingBox),void 0!=y.alphaIndex&&null!=y.showSubMeshesBoundingBox&&(P.alphaIndex=y.alphaIndex),y.physicsImpostor&&(P.physicsImpostor=t._PhysicsImpostorParser(c,P,y)),void 0!==y.actions&&(P._waitingData.actions=y.actions),y.animations){for(let H=0;H<y.animations.length;H++){const c=y.animations[H],Z=(0,l.c)("BABYLON.Animation");Z&&P.animations.push(Z.Parse(c))}C.d.ParseAnimationRanges(P,y,c),y.autoAnimate&&c.beginAnimation(P,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1)}}if(H.thinInstances){const c=H.thinInstances;if(Z.thinInstanceEnablePicking=!!c.enablePicking,c.matrixData?(Z.Wb("matrix",new Float32Array(c.matrixData),16,!1),Z._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,Z._thinInstanceDataStorage.instancesCount=c.instancesCount):Z._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,H.thinInstances.userThinInstance){const c=H.thinInstances.userThinInstance;for(const H in c.data)Z.Wb(H,new Float32Array(c.data[H]),c.strides[H],!1),Z._userThinInstanceBuffersStorage.sizes[H]=c.sizes[H]}}return Z}setPositionsForCPUSkinning(){const H=this._internalMeshDataInfo;if(!H._sourcePositions){const c=this.getVerticesData(g.h.PositionKind);if(!c)return H._sourcePositions;H._sourcePositions=new Float32Array(c),this.isVertexBufferUpdatable(g.h.PositionKind)||this.Ga(g.h.PositionKind,c,!0)}return H._sourcePositions}setNormalsForCPUSkinning(){const H=this._internalMeshDataInfo;if(!H._sourceNormals){const c=this.getVerticesData(g.h.NormalKind);if(!c)return H._sourceNormals;H._sourceNormals=new Float32Array(c),this.isVertexBufferUpdatable(g.h.NormalKind)||this.Ga(g.h.NormalKind,c,!0)}return H._sourceNormals}applySkeleton(H){if(!this.Dj)return this;if(this.Dj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Dj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(g.h.PositionKind))return this;if(!this.isVerticesDataPresent(g.h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(g.h.MatricesWeightsKind))return this;const c=this.isVerticesDataPresent(g.h.NormalKind),y=this._internalMeshDataInfo;if(!y._sourcePositions){const H=this.$f.slice();this.setPositionsForCPUSkinning(),this.$f=H}c&&!y._sourceNormals&&this.setNormalsForCPUSkinning();let Z=this.getVerticesData(g.h.PositionKind);if(!Z)return this;Z instanceof Float32Array||(Z=new Float32Array(Z));let F=this.getVerticesData(g.h.NormalKind);if(c){if(!F)return this;F instanceof Float32Array||(F=new Float32Array(F))}const P=this.getVerticesData(g.h.MatricesIndicesKind),S=this.getVerticesData(g.h.MatricesWeightsKind);if(!S||!P)return this;const n=this.numBoneInfluencers>4,O=n?this.getVerticesData(g.h.MatricesIndicesExtraKind):null,i=n?this.getVerticesData(g.h.MatricesWeightsExtraKind):null,C=H.getTransformMatrices(this),v=a.n.Zero(),m=new a.d,z=new a.d;let V,h=0;for(let g=0;g<Z.length;g+=3,h+=4){let H;for(V=0;V<4;V++)H=S[h+V],H>0&&(a.d.FromFloat32ArrayToRefScaled(C,Math.floor(16*P[h+V]),H,z),m.addToSelf(z));if(n)for(V=0;V<4;V++)H=i[h+V],H>0&&(a.d.FromFloat32ArrayToRefScaled(C,Math.floor(16*O[h+V]),H,z),m.addToSelf(z));a.n.TransformCoordinatesFromFloatsToRef(y._sourcePositions[g],y._sourcePositions[g+1],y._sourcePositions[g+2],m,v),v.toArray(Z,g),c&&(a.n.TransformNormalFromFloatsToRef(y._sourceNormals[g],y._sourceNormals[g+1],y._sourceNormals[g+2],m,v),v.toArray(F,g)),m.reset()}return this.updateVerticesData(g.h.PositionKind,Z),c&&this.updateVerticesData(g.h.NormalKind,F),this}static MinMax(H){let c=null,y=null;return H.forEach((function(H){const Z=H.getBoundingInfo().boundingBox;c&&y?(c.minimizeInPlace(Z.minimumWorld),y.maximizeInPlace(Z.maximumWorld)):(c=Z.minimumWorld,y=Z.maximumWorld)})),c&&y?{min:c,max:y}:{min:a.n.Zero(),max:a.n.Zero()}}static Center(H){const c=H instanceof Array?t.MinMax(H):H;return a.n.Center(c.min,c.max)}static MergeMeshes(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;return(0,n.l)(t._MergeMeshesCoroutine(H,c,y,Z,F,P,!1))}static MergeMeshesAsync(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;return(0,n.i)(t._MergeMeshesCoroutine(H,c,y,Z,F,P,!0),(0,n.d)())}static*_MergeMeshesCoroutine(H){let c,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2?arguments[2]:void 0,F=arguments.length>3?arguments[3]:void 0,P=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0;if(0===(H=H.filter(Boolean)).length)return null;if(!Z){let y=0;for(c=0;c<H.length;c++)if(y+=H[c].getTotalVertices(),y>=65536)return J.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}S&&(P=!1);const O=new Array,a=new Array,i=new Array,C=H[0].sideOrientation;for(c=0;c<H.length;c++){const y=H[c];if(y.isAnInstance)return J.d.Warn("Cannot merge instance meshes."),null;if(C!==y.sideOrientation)return J.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(P&&i.push(y.getTotalIndices()),S)if(y.material){const H=y.material;if(H instanceof Q.b){for(let c=0;c<H.ag.length;c++)O.indexOf(H.ag[c])<0&&O.push(H.ag[c]);for(let c=0;c<y.$f.length;c++)a.push(O.indexOf(H.ag[y.$f[c].materialIndex])),i.push(y.$f[c].indexCount)}else{O.indexOf(H)<0&&O.push(H);for(let c=0;c<y.$f.length;c++)a.push(O.indexOf(H)),i.push(y.$f[c].indexCount)}}else for(let H=0;H<y.$f.length;H++)a.push(0),i.push(y.$f[H].indexCount)}const g=H[0],m=H=>{const c=H.Oj(!0);return{vertexData:v.c.ExtractFromMesh(H,!1,!1),transform:c}},{vertexData:z,transform:h}=m(g);n&&(yield);const D=new Array(H.length-1);for(let v=1;v<H.length;v++)D[v-1]=m(H[v]),n&&(yield);const f=z._mergeCoroutine(h,D,Z,n,!y);let l=f.next();for(;!l.done;)n&&(yield),l=f.next();const d=l.value;F||(F=new t(g.name+"_merged",g.va()));const K=d._applyToCoroutine(F,void 0,n);let T=K.next();for(;!T.done;)n&&(yield),T=K.next();if(F.checkCollisions=g.checkCollisions,F.sideOrientation=g.sideOrientation,y)for(c=0;c<H.length;c++)H[c].dispose();if(P||S){F.releaseSubMeshes(),c=0;let H=0;for(;c<i.length;)V.b.CreateFromIndices(0,H,i[c],F,void 0,!1),H+=i[c],c++;for(const c of F.$f)c.refreshBoundingInfo();F.Oj(!0)}if(S){const H=new Q.b(g.name+"_merged",g.va());H.ag=O;for(let c=0;c<F.$f.length;c++)F.$f[c].materialIndex=a[c];F.material=H}else F.material=g.material;return F}Gj(H){H._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(H)}Fj(H){const c=H._indexInSourceMeshInstanceArray;if(-1!=c){if(c!==this.instances.length-1){const H=this.instances[this.instances.length-1];this.instances[c]=H,H._indexInSourceMeshInstanceArray=c}H._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===h.c.CounterClockWiseSideOrientation}_getRenderingFillMode(H){const c=this.va();return c.forcePointsCloud?h.c.PointFillMode:c.forceWireframe?h.c.WireFrameFillMode:this.overrideRenderingFillMode??H}setMaterialByID(H){return this.setMaterialById(H)}static CreateRibbon(H,c,y,Z,F,P,S,n,O){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(H,c,y,Z,F,P){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(H,c,y,Z,F){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(H,c,y,Z,F,P){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(H,c,y,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(H,c,y,Z,F,P,S,n,O){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(H,c,y,Z,F,P,S){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(H,c,y,Z,F,P,S,n,O,a){throw new Error("Import MeshBuilder to populate this function")}static pb(H,c,y,Z,F){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(H,c,y,Z,F,P,S,n){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(H,c,y,Z,F,P,S){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(H,c,y,Z,F,P,S,n){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(H,c,y,Z,F,P,S,n,O,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(H,c,y,Z,F,P,S,n,O,a,i,C){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(H,c,y,Z,F,P,S){throw new Error("Import MeshBuilder to populate this function")}static cg(H,c,y,Z,F){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(H,c,y,Z,F,P){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(H,c,y,Z,F,P,S,n,O){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(H,c,y,Z,F,P,S,n,O,a,i){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(H,c,y,Z,F,P,S,n,O,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(H,c,y){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(H,c,y){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(H,c,y,Z,F,P){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(H,c,y){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(H){throw new Error("Import MeshBuilder to populate this function")}}t.FRONTSIDE=v.c.FRONTSIDE,t.BACKSIDE=v.c.BACKSIDE,t.DOUBLESIDE=v.c.DOUBLESIDE,t.DEFAULTSIDE=v.c.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t.INSTANCEDMESH_SORT_TRANSPARENT=!1,t._GroundMeshParser=(H,c)=>{throw(0,d.b)("GroundMesh")},t._GoldbergMeshParser=(H,c)=>{throw(0,d.b)("GoldbergMesh")},t._LinesMeshParser=(H,c)=>{throw(0,d.b)("LinesMesh")},t._GreasedLineMeshParser=(H,c)=>{throw(0,d.b)("GreasedLineMesh")},t._GreasedLineRibbonMeshParser=(H,c)=>{throw(0,d.b)("GreasedLineRibbonMesh")},t._TrailMeshParser=(H,c)=>{throw(0,d.b)("TrailMesh")},(0,l.d)("BABYLON.Mesh",t)},11380:(H,c,y)=>{"use strict";y.d(c,{c:()=>m});var Z=y(11052),F=y(11092),P=y(11153),S=y(10798),n=y(11112),O=y(10773),a=y(11061),i=y(11358),C=y(10826),g=y(11245);class v{}class m{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,i.e)(this._applyToCoroutine.bind(this)),this.uniqueId=m._UniqueIDGenerator,m._UniqueIDGenerator++}set(H,c){switch(H.length||O.d.Warn(`Setting vertex data kind '${c}' with an empty array`),c){case P.h.PositionKind:this.xa=H;break;case P.h.NormalKind:this.ya=H;break;case P.h.TangentKind:this.tangents=H;break;case P.h.UVKind:this.Aa=H;break;case P.h.UV2Kind:this.uvs2=H;break;case P.h.UV3Kind:this.uvs3=H;break;case P.h.UV4Kind:this.uvs4=H;break;case P.h.UV5Kind:this.uvs5=H;break;case P.h.UV6Kind:this.uvs6=H;break;case P.h.ColorKind:this.za=H;break;case P.h.MatricesIndicesKind:this.matricesIndices=H;break;case P.h.MatricesWeightsKind:this.matricesWeights=H;break;case P.h.MatricesIndicesExtraKind:this.matricesIndicesExtra=H;break;case P.h.MatricesWeightsExtraKind:this.matricesWeightsExtra=H}}Ca(H,c){return this._applyTo(H,c,!1),this}applyToGeometry(H,c){return this._applyTo(H,c,!1),this}updateMesh(H){return this._update(H),this}updateGeometry(H){return this._update(H),this}*_applyToCoroutine(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;if(this.xa&&(H.Ga(P.h.PositionKind,this.xa,c),y&&(yield)),this.ya&&(H.Ga(P.h.NormalKind,this.ya,c),y&&(yield)),this.tangents&&(H.Ga(P.h.TangentKind,this.tangents,c),y&&(yield)),this.Aa&&(H.Ga(P.h.UVKind,this.Aa,c),y&&(yield)),this.uvs2&&(H.Ga(P.h.UV2Kind,this.uvs2,c),y&&(yield)),this.uvs3&&(H.Ga(P.h.UV3Kind,this.uvs3,c),y&&(yield)),this.uvs4&&(H.Ga(P.h.UV4Kind,this.uvs4,c),y&&(yield)),this.uvs5&&(H.Ga(P.h.UV5Kind,this.uvs5,c),y&&(yield)),this.uvs6&&(H.Ga(P.h.UV6Kind,this.uvs6,c),y&&(yield)),this.za&&(H.Ga(P.h.ColorKind,this.za,c),this.hasVertexAlpha&&void 0!==H.hasVertexAlpha&&(H.hasVertexAlpha=!0),y&&(yield)),this.matricesIndices&&(H.Ga(P.h.MatricesIndicesKind,this.matricesIndices,c),y&&(yield)),this.matricesWeights&&(H.Ga(P.h.MatricesWeightsKind,this.matricesWeights,c),y&&(yield)),this.matricesIndicesExtra&&(H.Ga(P.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,c),y&&(yield)),this.matricesWeightsExtra&&(H.Ga(P.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,c),y&&(yield)),this.indices?(H.setIndices(this.indices,null,c),y&&(yield)):H.setIndices([],null),H.$f&&this.materialInfos&&this.materialInfos.length>1){const c=H;c.$f=[];for(const H of this.materialInfos)new g.b(H.materialIndex,H.verticesStart,H.verticesCount,H.indexStart,H.indexCount,c)}return this}_update(H,c,y){return this.xa&&H.updateVerticesData(P.h.PositionKind,this.xa,c,y),this.ya&&H.updateVerticesData(P.h.NormalKind,this.ya,c,y),this.tangents&&H.updateVerticesData(P.h.TangentKind,this.tangents,c,y),this.Aa&&H.updateVerticesData(P.h.UVKind,this.Aa,c,y),this.uvs2&&H.updateVerticesData(P.h.UV2Kind,this.uvs2,c,y),this.uvs3&&H.updateVerticesData(P.h.UV3Kind,this.uvs3,c,y),this.uvs4&&H.updateVerticesData(P.h.UV4Kind,this.uvs4,c,y),this.uvs5&&H.updateVerticesData(P.h.UV5Kind,this.uvs5,c,y),this.uvs6&&H.updateVerticesData(P.h.UV6Kind,this.uvs6,c,y),this.za&&H.updateVerticesData(P.h.ColorKind,this.za,c,y),this.matricesIndices&&H.updateVerticesData(P.h.MatricesIndicesKind,this.matricesIndices,c,y),this.matricesWeights&&H.updateVerticesData(P.h.MatricesWeightsKind,this.matricesWeights,c,y),this.matricesIndicesExtra&&H.updateVerticesData(P.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,c,y),this.matricesWeightsExtra&&H.updateVerticesData(P.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,c,y),this.indices&&H.setIndices(this.indices,null),this}static _TransformVector3Coordinates(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.length;const P=F.h.o[0],S=F.h.o[1];for(let n=y;n<y+Z;n+=3)F.n.FromArrayToRef(H,n,P),F.n.TransformCoordinatesToRef(P,c,S),H[n]=S.x,H[n+1]=S.y,H[n+2]=S.z}static _TransformVector3Normals(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.length;const P=F.h.o[0],S=F.h.o[1];for(let n=y;n<y+Z;n+=3)F.n.FromArrayToRef(H,n,P),F.n.TransformNormalToRef(P,c,S),H[n]=S.x,H[n+1]=S.y,H[n+2]=S.z}static _TransformVector4Normals(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.length;const P=F.h.Vector4[0],S=F.h.Vector4[1];for(let n=y;n<y+Z;n+=4)F.q.FromArrayToRef(H,n,P),F.q.TransformNormalToRef(P,c,S),H[n]=S.x,H[n+1]=S.y,H[n+2]=S.z,H[n+3]=S.w}static _FlipFaces(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.length;for(let Z=c;Z<c+y;Z+=3){const c=H[Z+1];H[Z+1]=H[Z+2],H[Z+2]=c}}transform(H){const c=H.determinant()<0;return this.xa&&m._TransformVector3Coordinates(this.xa,H),this.ya&&m._TransformVector3Normals(this.ya,H),this.tangents&&m._TransformVector4Normals(this.tangents,H),c&&this.indices&&m._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const H=[];for(const c of this.materialInfos){const y=new m;if(this.xa&&(y.xa=this.xa.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.ya&&(y.ya=this.ya.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.tangents&&(y.tangents=this.tangents.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.za&&(y.za=this.za.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.Aa&&(y.Aa=this.Aa.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs2&&(y.uvs2=this.uvs2.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs3&&(y.uvs3=this.uvs3.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs4&&(y.uvs4=this.uvs4.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs5&&(y.uvs5=this.uvs5.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs6&&(y.uvs6=this.uvs6.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.matricesIndices&&(y.matricesIndices=this.matricesIndices.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesIndicesExtra&&(y.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeights&&(y.matricesWeights=this.matricesWeights.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeightsExtra&&(y.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.indices){y.indices=[];for(let H=c.indexStart;H<c.indexStart+c.indexCount;H++)y.indices.push(this.indices[H]-c.verticesStart)}const Z=new v;Z.indexStart=0,Z.indexCount=y.indices?y.indices.length:0,Z.materialIndex=c.materialIndex,Z.verticesStart=0,Z.verticesCount=(y.xa?y.xa.length:0)/3,y.materialInfos=[Z],H.push(y)}return H}merge(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=Array.isArray(H)?H.map((H=>({vertexData:H}))):[{vertexData:H}];return(0,i.l)(this._mergeCoroutine(void 0,P,c,!1,y,Z,F))}*_mergeCoroutine(H,c){var y,Z;let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let i=c.map((H=>H.vertexData)),C=this;if(a)for(const P of i)P&&(P._validate(),!this.ya&&P.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&P.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&P.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&P.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&P.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&P.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&P.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&P.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&P.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&P.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&P.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&P.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&P.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const P of i)if(P)if(a)this.ya&&!P.ya&&(P.ya=new Float32Array(P.xa.length)),this.tangents&&!P.tangents&&(P.tangents=new Float32Array(P.xa.length/3*4)),this.Aa&&!P.Aa&&(P.Aa=new Float32Array(P.xa.length/3*2)),this.uvs2&&!P.uvs2&&(P.uvs2=new Float32Array(P.xa.length/3*2)),this.uvs3&&!P.uvs3&&(P.uvs3=new Float32Array(P.xa.length/3*2)),this.uvs4&&!P.uvs4&&(P.uvs4=new Float32Array(P.xa.length/3*2)),this.uvs5&&!P.uvs5&&(P.uvs5=new Float32Array(P.xa.length/3*2)),this.uvs6&&!P.uvs6&&(P.uvs6=new Float32Array(P.xa.length/3*2)),this.za&&!P.za&&(P.za=new Float32Array(P.xa.length/3*4),P.za.fill(1)),this.matricesIndices&&!P.matricesIndices&&(P.matricesIndices=new Float32Array(P.xa.length/3*4)),this.matricesWeights&&!P.matricesWeights&&(P.matricesWeights=new Float32Array(P.xa.length/3*4)),this.matricesIndicesExtra&&!P.matricesIndicesExtra&&(P.matricesIndicesExtra=new Float32Array(P.xa.length/3*4)),this.matricesWeightsExtra&&!P.matricesWeightsExtra&&(P.matricesWeightsExtra=new Float32Array(P.xa.length/3*4));else if(P._validate(),!this.ya!==!P.ya||!this.tangents!==!P.tangents||!this.Aa!==!P.Aa||!this.uvs2!==!P.uvs2||!this.uvs3!==!P.uvs3||!this.uvs4!==!P.uvs4||!this.uvs5!==!P.uvs5||!this.uvs6!==!P.uvs6||!this.za!==!P.za||!this.matricesIndices!==!P.matricesIndices||!this.matricesWeights!==!P.matricesWeights||!this.matricesIndicesExtra!==!P.matricesIndicesExtra||!this.matricesWeightsExtra!==!P.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(O){let y=0,Z=0,F=0;const P=[];let S=null;const n=[];for(const c of this.splitBasedOnMaterialID())n.push({vertexData:c,transform:H});for(const H of c)if(H.vertexData)for(const c of H.vertexData.splitBasedOnMaterialID())n.push({vertexData:c,transform:H.transform});n.sort(((H,c)=>{const y=H.vertexData.materialInfos?H.vertexData.materialInfos[0].materialIndex:0,Z=c.vertexData.materialInfos?c.vertexData.materialInfos[0].materialIndex:0;return y>Z?1:y===Z?0:-1}));for(const H of n){const c=H.vertexData;if(y=c.materialInfos?c.materialInfos[0].materialIndex:0,S&&S.materialIndex===y)S.indexCount+=c.indices.length,S.verticesCount+=c.xa.length/3;else{const H=new v;H.materialIndex=y,H.indexStart=Z,H.indexCount=c.indices.length,H.verticesStart=F,H.verticesCount=c.xa.length/3,P.push(H),S=H}Z+=c.indices.length,F+=c.xa.length/3}const O=n.splice(0,1)[0];C=O.vertexData,H=O.transform,i=n.map((H=>H.vertexData)),c=n,this.materialInfos=P}const g=i.reduce(((H,c)=>{var y;return H+((null===(y=c.indices)||void 0===y?void 0:y.length)??0)}),(null===(y=C.indices)||void 0===y?void 0:y.length)??0);let z=n||i.some((H=>H.indices===C.indices))?null===(Z=C.indices)||void 0===Z?void 0:Z.slice():C.indices;if(g>0){var V;let y=(null===(V=z)||void 0===V?void 0:V.length)??0;if(z||(z=new Array(g)),z.length!==g){if(Array.isArray(z))z.length=g;else{const H=F||z instanceof Uint32Array?new Uint32Array(g):new Uint16Array(g);H.set(z),z=H}H&&H.determinant()<0&&m._FlipFaces(z,0,y)}let Z=C.xa?C.xa.length/3:0;for(const{vertexData:H,transform:F}of c)if(H.indices){for(let c=0;c<H.indices.length;c++)z[y+c]=H.indices[c]+Z;F&&F.determinant()<0&&m._FlipFaces(z,y,H.indices.length),Z+=H.xa.length/3,y+=H.indices.length,S&&(yield)}}return this.indices=z,this.xa=m._MergeElement(P.h.PositionKind,C.xa,H,c.map((H=>[H.vertexData.xa,H.transform]))),S&&(yield),C.ya&&(this.ya=m._MergeElement(P.h.NormalKind,C.ya,H,c.map((H=>[H.vertexData.ya,H.transform]))),S&&(yield)),C.tangents&&(this.tangents=m._MergeElement(P.h.TangentKind,C.tangents,H,c.map((H=>[H.vertexData.tangents,H.transform]))),S&&(yield)),C.Aa&&(this.Aa=m._MergeElement(P.h.UVKind,C.Aa,H,c.map((H=>[H.vertexData.Aa,H.transform]))),S&&(yield)),C.uvs2&&(this.uvs2=m._MergeElement(P.h.UV2Kind,C.uvs2,H,c.map((H=>[H.vertexData.uvs2,H.transform]))),S&&(yield)),C.uvs3&&(this.uvs3=m._MergeElement(P.h.UV3Kind,C.uvs3,H,c.map((H=>[H.vertexData.uvs3,H.transform]))),S&&(yield)),C.uvs4&&(this.uvs4=m._MergeElement(P.h.UV4Kind,C.uvs4,H,c.map((H=>[H.vertexData.uvs4,H.transform]))),S&&(yield)),C.uvs5&&(this.uvs5=m._MergeElement(P.h.UV5Kind,C.uvs5,H,c.map((H=>[H.vertexData.uvs5,H.transform]))),S&&(yield)),C.uvs6&&(this.uvs6=m._MergeElement(P.h.UV6Kind,C.uvs6,H,c.map((H=>[H.vertexData.uvs6,H.transform]))),S&&(yield)),C.za&&(this.za=m._MergeElement(P.h.ColorKind,C.za,H,c.map((H=>[H.vertexData.za,H.transform]))),(void 0!==C.hasVertexAlpha||c.some((H=>void 0!==H.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=C.hasVertexAlpha||c.some((H=>H.vertexData.hasVertexAlpha))),S&&(yield)),C.matricesIndices&&(this.matricesIndices=m._MergeElement(P.h.MatricesIndicesKind,C.matricesIndices,H,c.map((H=>[H.vertexData.matricesIndices,H.transform]))),S&&(yield)),C.matricesWeights&&(this.matricesWeights=m._MergeElement(P.h.MatricesWeightsKind,C.matricesWeights,H,c.map((H=>[H.vertexData.matricesWeights,H.transform]))),S&&(yield)),C.matricesIndicesExtra&&(this.matricesIndicesExtra=m._MergeElement(P.h.MatricesIndicesExtraKind,C.matricesIndicesExtra,H,c.map((H=>[H.vertexData.matricesIndicesExtra,H.transform]))),S&&(yield)),C.matricesWeightsExtra&&(this.matricesWeightsExtra=m._MergeElement(P.h.MatricesWeightsExtraKind,C.matricesWeightsExtra,H,c.map((H=>[H.vertexData.matricesWeightsExtra,H.transform])))),this}static _MergeElement(H,c,y,Z){const F=Z.filter((H=>null!==H[0]&&void 0!==H[0]));if(!c&&0==F.length)return c;if(!c)return this._MergeElement(H,F[0][0],F[0][1],F.slice(1));const S=F.reduce(((H,c)=>H+c[0].length),c.length),n=H===P.h.PositionKind?m._TransformVector3Coordinates:H===P.h.NormalKind?m._TransformVector3Normals:H===P.h.TangentKind?m._TransformVector4Normals:()=>{};if(c instanceof Float32Array){const H=new Float32Array(S);H.set(c),y&&n(H,y,0,c.length);let Z=c.length;for(const[c,y]of F)H.set(c,Z),y&&n(H,y,Z,c.length),Z+=c.length;return H}{const H=new Array(S);for(let y=0;y<c.length;y++)H[y]=c[y];y&&n(H,y,0,c.length);let Z=c.length;for(const[c,y]of F){for(let y=0;y<c.length;y++)H[Z+y]=c[y];y&&n(H,y,Z,c.length),Z+=c.length}return H}}_validate(){if(!this.xa)throw new C.m("Positions are required",C.i.MeshInvalidPositionsError);const H=(H,c)=>{const y=P.h.DeduceStride(H);if(c.length%y!==0)throw new Error("The "+H+"s array count must be a multiple of "+y);return c.length/y},c=H(P.h.PositionKind,this.xa),y=(y,Z)=>{const F=H(y,Z);if(F!==c)throw new Error("The "+y+"s element count ("+F+") does not match the positions count ("+c+")")};this.ya&&y(P.h.NormalKind,this.ya),this.tangents&&y(P.h.TangentKind,this.tangents),this.Aa&&y(P.h.UVKind,this.Aa),this.uvs2&&y(P.h.UV2Kind,this.uvs2),this.uvs3&&y(P.h.UV3Kind,this.uvs3),this.uvs4&&y(P.h.UV4Kind,this.uvs4),this.uvs5&&y(P.h.UV5Kind,this.uvs5),this.uvs6&&y(P.h.UV6Kind,this.uvs6),this.za&&y(P.h.ColorKind,this.za),this.matricesIndices&&y(P.h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&y(P.h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&y(P.h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&y(P.h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const H=this.serialize();return m.Parse(H)}serialize(){const H={};if(this.xa&&(H.xa=Array.from(this.xa)),this.ya&&(H.ya=Array.from(this.ya)),this.tangents&&(H.tangents=Array.from(this.tangents)),this.Aa&&(H.Aa=Array.from(this.Aa)),this.uvs2&&(H.uvs2=Array.from(this.uvs2)),this.uvs3&&(H.uvs3=Array.from(this.uvs3)),this.uvs4&&(H.uvs4=Array.from(this.uvs4)),this.uvs5&&(H.uvs5=Array.from(this.uvs5)),this.uvs6&&(H.uvs6=Array.from(this.uvs6)),this.za&&(H.za=Array.from(this.za),H.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(H.matricesIndices=Array.from(this.matricesIndices),H.matricesIndices._isExpanded=!0),this.matricesWeights&&(H.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(H.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),H.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(H.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),H.indices=Array.from(this.indices),this.materialInfos){H.materialInfos=[];for(const c of this.materialInfos){const y={indexStart:c.indexStart,indexCount:c.indexCount,materialIndex:c.materialIndex,verticesStart:c.verticesStart,verticesCount:c.verticesCount};H.materialInfos.push(y)}}return H}static ExtractFromMesh(H,c,y){return m._ExtractFrom(H,c,y)}static ExtractFromGeometry(H,c,y){return m._ExtractFrom(H,c,y)}static _ExtractFrom(H,c,y){const Z=new m;if(H.isVerticesDataPresent(P.h.PositionKind)&&(Z.xa=H.getVerticesData(P.h.PositionKind,c,y)),H.isVerticesDataPresent(P.h.NormalKind)&&(Z.ya=H.getVerticesData(P.h.NormalKind,c,y)),H.isVerticesDataPresent(P.h.TangentKind)&&(Z.tangents=H.getVerticesData(P.h.TangentKind,c,y)),H.isVerticesDataPresent(P.h.UVKind)&&(Z.Aa=H.getVerticesData(P.h.UVKind,c,y)),H.isVerticesDataPresent(P.h.UV2Kind)&&(Z.uvs2=H.getVerticesData(P.h.UV2Kind,c,y)),H.isVerticesDataPresent(P.h.UV3Kind)&&(Z.uvs3=H.getVerticesData(P.h.UV3Kind,c,y)),H.isVerticesDataPresent(P.h.UV4Kind)&&(Z.uvs4=H.getVerticesData(P.h.UV4Kind,c,y)),H.isVerticesDataPresent(P.h.UV5Kind)&&(Z.uvs5=H.getVerticesData(P.h.UV5Kind,c,y)),H.isVerticesDataPresent(P.h.UV6Kind)&&(Z.uvs6=H.getVerticesData(P.h.UV6Kind,c,y)),H.isVerticesDataPresent(P.h.ColorKind)){const F=H.Dj||H,S=F.getVertexBuffer(P.h.ColorKind),n=F.getVerticesData(P.h.ColorKind,c,y);if(3===S.getSize()){const H=new Float32Array(4*n.length/3);for(let c=0,y=0;c<n.length;c+=3,y+=4)H[y]=n[c],H[y+1]=n[c+1],H[y+2]=n[c+2],H[y+3]=1;Z.za=H}else{if(4!==S.getSize())throw new Error(`Unexpected number of color components: ${S.getSize()}`);Z.za=n}}return H.isVerticesDataPresent(P.h.MatricesIndicesKind)&&(Z.matricesIndices=H.getVerticesData(P.h.MatricesIndicesKind,c,y)),H.isVerticesDataPresent(P.h.MatricesWeightsKind)&&(Z.matricesWeights=H.getVerticesData(P.h.MatricesWeightsKind,c,y)),H.isVerticesDataPresent(P.h.MatricesIndicesExtraKind)&&(Z.matricesIndicesExtra=H.getVerticesData(P.h.MatricesIndicesExtraKind,c,y)),H.isVerticesDataPresent(P.h.MatricesWeightsExtraKind)&&(Z.matricesWeightsExtra=H.getVerticesData(P.h.MatricesWeightsExtraKind,c,y)),Z.indices=H.Vf(c,y),Z}static CreateRibbon(H){throw(0,S.b)("ribbonBuilder")}static CreateBox(H){throw(0,S.b)("boxBuilder")}static CreateTiledBox(H){throw(0,S.b)("tiledBoxBuilder")}static CreateTiledPlane(H){throw(0,S.b)("tiledPlaneBuilder")}static CreateSphere(H){throw(0,S.b)("sphereBuilder")}static CreateCylinder(H){throw(0,S.b)("cylinderBuilder")}static CreateTorus(H){throw(0,S.b)("torusBuilder")}static CreateLineSystem(H){throw(0,S.b)("linesBuilder")}static CreateDashedLines(H){throw(0,S.b)("linesBuilder")}static CreateGround(H){throw(0,S.b)("groundBuilder")}static CreateTiledGround(H){throw(0,S.b)("groundBuilder")}static CreateGroundFromHeightMap(H){throw(0,S.b)("groundBuilder")}static cg(H){throw(0,S.b)("planeBuilder")}static CreateDisc(H){throw(0,S.b)("discBuilder")}static CreatePolygon(H,c,y,Z,F,P,n){throw(0,S.b)("polygonBuilder")}static CreateIcoSphere(H){throw(0,S.b)("icoSphereBuilder")}static CreatePolyhedron(H){throw(0,S.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||F.n.Up();throw(0,S.b)("capsuleBuilder")}static CreateTorusKnot(H){throw(0,S.b)("torusKnotBuilder")}static ComputeNormals(H,c,y,Z){let P=0,S=0,n=0,O=0,a=0,i=0,C=0,g=0,v=0,m=0,z=0,V=0,h=0,Q=0,D=0,f=0,J=0,l=0,d=0,K=0,T=!1,u=!1,E=!1,U=!1,G=1,p=0,t=null;Z&&(T=!!Z.facetNormals,u=!!Z.facetPositions,E=!!Z.facetPartitioning,G=!0===Z.useRightHandedSystem?-1:1,p=Z.ratio||0,U=!!Z.depthSort,t=Z.distanceTo,U&&void 0===t&&(t=F.n.Zero()));let o=0,s=0,q=0,I=0;for(E&&Z&&Z.bbSize&&(o=Z.subDiv.X*p/Z.bbSize.x,s=Z.subDiv.Y*p/Z.bbSize.y,q=Z.subDiv.Z*p/Z.bbSize.z,I=Z.subDiv.max*Z.subDiv.max,Z.facetPartitioning.length=0),P=0;P<H.length;P++)y[P]=0;const j=c.length/3|0;for(P=0;P<j;P++){if(V=3*c[3*P],h=V+1,Q=V+2,D=3*c[3*P+1],f=D+1,J=D+2,l=3*c[3*P+2],d=l+1,K=l+2,S=H[V]-H[D],n=H[h]-H[f],O=H[Q]-H[J],a=H[l]-H[D],i=H[d]-H[f],C=H[K]-H[J],g=G*(n*C-O*i),v=G*(O*a-S*C),m=G*(S*i-n*a),z=Math.sqrt(g*g+v*v+m*m),z=0===z?1:z,g/=z,v/=z,m/=z,T&&Z&&(Z.facetNormals[P].x=g,Z.facetNormals[P].y=v,Z.facetNormals[P].z=m),u&&Z&&(Z.facetPositions[P].x=(H[V]+H[D]+H[l])/3,Z.facetPositions[P].y=(H[h]+H[f]+H[d])/3,Z.facetPositions[P].z=(H[Q]+H[J]+H[K])/3),E&&Z){const c=Math.floor((Z.facetPositions[P].x-Z.bInfo.minimum.x*p)*o),y=Math.floor((Z.facetPositions[P].y-Z.bInfo.minimum.y*p)*s),F=Math.floor((Z.facetPositions[P].z-Z.bInfo.minimum.z*p)*q),S=Math.floor((H[V]-Z.bInfo.minimum.x*p)*o),n=Math.floor((H[h]-Z.bInfo.minimum.y*p)*s),O=Math.floor((H[Q]-Z.bInfo.minimum.z*p)*q),a=Math.floor((H[D]-Z.bInfo.minimum.x*p)*o),i=Math.floor((H[f]-Z.bInfo.minimum.y*p)*s),C=Math.floor((H[J]-Z.bInfo.minimum.z*p)*q),g=Math.floor((H[l]-Z.bInfo.minimum.x*p)*o),v=Math.floor((H[d]-Z.bInfo.minimum.y*p)*s),m=Math.floor((H[K]-Z.bInfo.minimum.z*p)*q),z=S+Z.subDiv.max*n+I*O,T=a+Z.subDiv.max*i+I*C,u=g+Z.subDiv.max*v+I*m,E=c+Z.subDiv.max*y+I*F;Z.facetPartitioning[E]=Z.facetPartitioning[E]?Z.facetPartitioning[E]:new Array,Z.facetPartitioning[z]=Z.facetPartitioning[z]?Z.facetPartitioning[z]:new Array,Z.facetPartitioning[T]=Z.facetPartitioning[T]?Z.facetPartitioning[T]:new Array,Z.facetPartitioning[u]=Z.facetPartitioning[u]?Z.facetPartitioning[u]:new Array,Z.facetPartitioning[z].push(P),T!=z&&Z.facetPartitioning[T].push(P),u!=T&&u!=z&&Z.facetPartitioning[u].push(P),E!=z&&E!=T&&E!=u&&Z.facetPartitioning[E].push(P)}if(U&&Z&&Z.facetPositions){const H=Z.depthSortedFacets[P];H.ind=3*P,H.sqDistance=F.n.DistanceSquared(Z.facetPositions[P],t)}y[V]+=g,y[h]+=v,y[Q]+=m,y[D]+=g,y[f]+=v,y[J]+=m,y[l]+=g,y[d]+=v,y[K]+=m}for(P=0;P<y.length/3;P++)g=y[3*P],v=y[3*P+1],m=y[3*P+2],z=Math.sqrt(g*g+v*v+m*m),z=0===z?1:z,g/=z,v/=z,m/=z,y[3*P]=g,y[3*P+1]=v,y[3*P+2]=m}static _ComputeSides(H,c,y,Z,P,S,n){const O=y.length,a=Z.length;let i,C;switch(H=H||m.DEFAULTSIDE){case m.FRONTSIDE:break;case m.BACKSIDE:for(i=0;i<O;i+=3){const H=y[i];y[i]=y[i+2],y[i+2]=H}for(C=0;C<a;C++)Z[C]=-Z[C];break;case m.DOUBLESIDE:{const H=c.length,g=H/3;for(let y=0;y<H;y++)c[H+y]=c[y];for(i=0;i<O;i+=3)y[i+O]=y[i+2]+g,y[i+1+O]=y[i+1]+g,y[i+2+O]=y[i]+g;for(C=0;C<a;C++)Z[a+C]=-Z[C];const v=P.length;let m=0;for(m=0;m<v;m++)P[m+v]=P[m];for(S=S||new F.q(0,0,1,1),n=n||new F.q(0,0,1,1),m=0,i=0;i<v/2;i++)P[m]=S.x+(S.z-S.x)*P[m],P[m+1]=S.y+(S.w-S.y)*P[m+1],P[m+v]=n.x+(n.z-n.x)*P[m+v],P[m+v+1]=n.y+(n.w-n.y)*P[m+v+1],m+=2;break}}}static Parse(H){const c=new m,y=H.xa;y&&c.set(y,P.h.PositionKind);const Z=H.ya;Z&&c.set(Z,P.h.NormalKind);const F=H.tangents;F&&c.set(F,P.h.TangentKind);const S=H.Aa;S&&c.set(S,P.h.UVKind);const O=H.uvs2;O&&c.set(O,P.h.UV2Kind);const a=H.uvs3;a&&c.set(a,P.h.UV3Kind);const i=H.uvs4;i&&c.set(i,P.h.UV4Kind);const C=H.uvs5;C&&c.set(C,P.h.UV5Kind);const g=H.uvs6;g&&c.set(g,P.h.UV6Kind);const z=H.za;z&&(c.set(n.h.CheckColors4(z,y.length/3),P.h.ColorKind),void 0!==H.hasVertexAlpha&&(c.hasVertexAlpha=H.hasVertexAlpha));const V=H.matricesIndices;V&&c.set(V,P.h.MatricesIndicesKind);const h=H.matricesWeights;h&&c.set(h,P.h.MatricesWeightsKind);const Q=H.indices;Q&&(c.indices=Q);const D=H.materialInfos;if(D){c.materialInfos=[];for(const H of D){const y=new v;y.indexCount=H.indexCount,y.indexStart=H.indexStart,y.verticesCount=H.verticesCount,y.verticesStart=H.verticesStart,y.materialIndex=H.materialIndex,c.materialInfos.push(y)}}return c}static ImportVertexData(H,c){const y=m.Parse(H);c.setAllVerticesData(y,H.updatable)}}m.FRONTSIDE=0,m.BACKSIDE=1,m.DOUBLESIDE=2,m.DEFAULTSIDE=0,m._UniqueIDGenerator=0,(0,Z.b)([a.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z]=c;return!Array.isArray(Z)}))],m,"_TransformVector3Coordinates",null),(0,Z.b)([a.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z]=c;return!Array.isArray(Z)}))],m,"_TransformVector3Normals",null),(0,Z.b)([a.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z]=c;return!Array.isArray(Z)}))],m,"_TransformVector4Normals",null),(0,Z.b)([a.f.filter((function(){for(var H=arguments.length,c=new Array(H),y=0;y<H;y++)c[y]=arguments[y];let[Z]=c;return!Array.isArray(Z)}))],m,"_FlipFaces",null)},12798:(H,c,y)=>{"use strict";y.d(c,{e:()=>zH});var Z=y(11092),F=y(11354),P=y(11153),S=y(11380),n=y(11324);function O(H){let c=H.pathArray;const y=H.closeArray||!1,Z=H.closePath||!1,F=H.invertUV||!1,O=Math.floor(c[0].length/2);let a=H.offset||O;a=a>O?O:Math.floor(a);const i=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,C=H.Aa,g=H.za,v=[],m=[],z=[],V=[],h=[],Q=[],D=[],f=[];let J;const l=[],d=[];let K,T,u;if(c.length<2){const H=[],y=[];for(T=0;T<c[0].length-a;T++)H.push(c[0][T]),y.push(c[0][T+a]);c=[H,y]}let E=0;const U=Z?1:0,G=y?1:0;let p,t,o,s,q,I;for(J=c[0].length,K=0;K<c.length+G;K++){for(D[K]=0,h[K]=[0],p=K===c.length?c[0]:c[K],t=p.length,J=J<t?J:t,u=0;u<t;)v.push(p[u].x,p[u].y,p[u].z),u>0&&(o=p[u].Rc(p[u-1]).length(),s=o+D[K],h[K].push(s),D[K]=s),u++;Z&&(u--,v.push(p[0].x,p[0].y,p[0].z),o=p[u].Rc(p[0]).length(),s=o+D[K],h[K].push(s),D[K]=s),l[K]=t+U,d[K]=E,E+=t+U}let j,k,W=null,M=null;for(T=0;T<J+U;T++)for(f[T]=0,Q[T]=[0],K=0;K<c.length-1+G;K++)q=c[K],I=K===c.length-1?c[0]:c[K+1],T===J?(W=q[0],M=I[0]):(W=q[T],M=I[T]),o=M.Rc(W).length(),s=o+f[T],Q[T].push(s),f[T]=s;if(C)for(K=0;K<C.length;K++)V.push(C[K].x,n.d?1-C[K].y:C[K].y);else for(K=0;K<c.length+G;K++)for(T=0;T<J+U;T++)j=0!=D[K]?h[K][T]/D[K]:0,k=0!=f[T]?Q[T][K]/f[T]:0,F?V.push(k,j):V.push(j,n.d?1-k:k);K=0;let x=0,R=l[K]-1,A=l[K+1]-1,e=R<A?R:A,r=d[1]-d[0];const N=l.length-1;for(;x<=e&&K<N;)m.push(x,x+r,x+1),m.push(x+r+1,x+1,x+r),x+=1,x===e&&(K++,r=d[K+1]-d[K],R=l[K]-1,A=l[K+1]-1,x=d[K],e=R<A?R+x:A+x);if(S.c.ComputeNormals(v,m,z),Z){let H=0,y=0;for(K=0;K<c.length;K++){H=3*d[K],y=K+1<c.length?3*(d[K+1]-1):z.length-3,z[H]=.5*(z[H]+z[y]),z[H+1]=.5*(z[H+1]+z[y+1]),z[H+2]=.5*(z[H+2]+z[y+2]);const Z=Math.sqrt(z[H]*z[H]+z[H+1]*z[H+1]+z[H+2]*z[H+2]);z[H]/=Z,z[H+1]/=Z,z[H+2]/=Z,z[y]=z[H],z[y+1]=z[H+1],z[y+2]=z[H+2]}}if(y){let H=3*d[0],y=3*d[c.length];for(T=0;T<J+U;T++){z[H]=.5*(z[H]+z[y]),z[H+1]=.5*(z[H+1]+z[y+1]),z[H+2]=.5*(z[H+2]+z[y+2]);const c=Math.sqrt(z[H]*z[H]+z[H+1]*z[H+1]+z[H+2]*z[H+2]);z[H]/=c,z[H+1]/=c,z[H+2]/=c,z[y]=z[H],z[y+1]=z[H+1],z[y+2]=z[H+2],H+=3,y+=3}}S.c._ComputeSides(i,v,m,z,V,H.frontUVs,H.backUVs);let w=null;if(g){w=new Float32Array(4*g.length);for(let H=0;H<g.length;H++)w[4*H]=g[H].r,w[4*H+1]=g[H].g,w[4*H+2]=g[H].b,w[4*H+3]=g[H].a}const L=new S.c,b=new Float32Array(v),X=new Float32Array(z),B=new Float32Array(V);return L.indices=m,L.xa=b,L.ya=X,L.Aa=B,w&&L.set(w,P.h.ColorKind),Z&&(L._idx=d),L}function a(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=c.pathArray,i=c.closeArray,C=c.closePath,g=F.c._GetDefaultSideOrientation(c.sideOrientation),v=c.instance,m=c.updatable;if(v){const H=Z.h.o[0].ae(Number.MAX_VALUE),y=Z.h.o[1].ae(-Number.MAX_VALUE),O=c=>{let Z=a[0].length;const P=v;let S=0;const n=P._originalBuilderSideOrientation===F.c.DOUBLESIDE?2:1;for(let F=1;F<=n;++F)for(let n=0;n<a.length;++n){const F=a[n],O=F.length;Z=Z<O?Z:O;for(let P=0;P<Z;++P){const Z=F[P];c[S]=Z.x,c[S+1]=Z.y,c[S+2]=Z.z,H.minimizeInPlaceFromFloats(Z.x,Z.y,Z.z),y.maximizeInPlaceFromFloats(Z.x,Z.y,Z.z),S+=3}if(P._creationDataStorage&&P._creationDataStorage.closePath){const H=F[0];c[S]=H.x,c[S+1]=H.y,c[S+2]=H.z,S+=3}}},i=v.getVerticesData(P.h.PositionKind);if(O(i),v.hasBoundingInfo?v.getBoundingInfo().reConstruct(H,y,v._worldMatrix):v.buildBoundingInfo(H,y,v._worldMatrix),v.updateVerticesData(P.h.PositionKind,i,!1,!1),c.za){const H=v.getVerticesData(P.h.ColorKind);for(let y=0,Z=0;y<c.za.length;y++,Z+=4){const F=c.za[y];H[Z]=F.r,H[Z+1]=F.g,H[Z+2]=F.b,H[Z+3]=F.a}v.updateVerticesData(P.h.ColorKind,H,!1,!1)}if(c.Aa){const H=v.getVerticesData(P.h.UVKind);for(let y=0;y<c.Aa.length;y++)H[2*y]=c.Aa[y].x,H[2*y+1]=n.d?1-c.Aa[y].y:c.Aa[y].y;v.updateVerticesData(P.h.UVKind,H,!1,!1)}if(!v.areNormalsFrozen||v.isFacetDataEnabled){const H=v.Vf(),c=v.getVerticesData(P.h.NormalKind),y=v.isFacetDataEnabled?v.getFacetDataParameters():null;if(S.c.ComputeNormals(i,H,c,y),v._creationDataStorage&&v._creationDataStorage.closePath){let H=0,y=0;for(let Z=0;Z<a.length;Z++)H=3*v._creationDataStorage.idx[Z],y=Z+1<a.length?3*(v._creationDataStorage.idx[Z+1]-1):c.length-3,c[H]=.5*(c[H]+c[y]),c[H+1]=.5*(c[H+1]+c[y+1]),c[H+2]=.5*(c[H+2]+c[y+2]),c[y]=c[H],c[y+1]=c[H+1],c[y+2]=c[H+2]}v.areNormalsFrozen||v.updateVerticesData(P.h.NormalKind,c,!1,!1)}return v}{const Z=new F.c(H,y);Z._originalBuilderSideOrientation=g,Z._creationDataStorage=new F.f;const P=O(c);return C&&(Z._creationDataStorage.idx=P._idx),Z._creationDataStorage.closePath=C,Z._creationDataStorage.closeArray=i,P.Ca(Z,m),Z}}S.c.CreateRibbon=O,F.c.CreateRibbon=function(H,c){return a(H,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var i=y(11756),C=y(11416),g=y(11112);function v(H){const c=H.pattern||F.c.NO_FLIP,y=H.tileWidth||H.tileSize||1,Z=H.tileHeight||H.tileSize||1,P=H.alignHorizontal||0,n=H.alignVertical||0,O=H.width||H.size||1,a=Math.floor(O/y);let i=O-a*y;const C=H.height||H.size||1,g=Math.floor(C/Z);let v=C-g*Z;const m=y*a/2,z=Z*g/2;let V=0,h=0,Q=0,D=0,f=0,J=0;if(i>0||v>0){switch(Q=-m,D=-z,f=m,J=z,P){case F.c.CENTER:i/=2,Q-=i,f+=i;break;case F.c.LEFT:f+=i,V=-i/2;break;case F.c.RIGHT:Q-=i,V=i/2}switch(n){case F.c.CENTER:v/=2,D-=v,J+=v;break;case F.c.BOTTOM:J+=v,h=-v/2;break;case F.c.TOP:D-=v,h=v/2}}const l=[],d=[],K=[];K[0]=[0,0,1,0,1,1,0,1],K[1]=[0,0,1,0,1,1,0,1],c!==F.c.ROTATE_TILE&&c!==F.c.ROTATE_ROW||(K[1]=[1,1,0,1,0,0,1,0]),c!==F.c.FLIP_TILE&&c!==F.c.FLIP_ROW||(K[1]=[1,0,0,0,0,1,1,1]),c!==F.c.FLIP_N_ROTATE_TILE&&c!==F.c.FLIP_N_ROTATE_ROW||(K[1]=[0,1,1,1,1,0,0,0]);let T=[];const u=[],E=[];let U=0;for(let S=0;S<g;S++)for(let H=0;H<a;H++)l.push(H*y-m+V,S*Z-z+h,0),l.push((H+1)*y-m+V,S*Z-z+h,0),l.push((H+1)*y-m+V,(S+1)*Z-z+h,0),l.push(H*y-m+V,(S+1)*Z-z+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),T=c===F.c.FLIP_TILE||c===F.c.ROTATE_TILE||c===F.c.FLIP_N_ROTATE_TILE?T.concat(K[(H%2+S%2)%2]):c===F.c.FLIP_ROW||c===F.c.ROTATE_ROW||c===F.c.FLIP_N_ROTATE_ROW?T.concat(K[S%2]):T.concat(K[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),U+=4;if(i>0||v>0){const H=v>0&&(n===F.c.CENTER||n===F.c.TOP),S=v>0&&(n===F.c.CENTER||n===F.c.BOTTOM),O=i>0&&(P===F.c.CENTER||P===F.c.RIGHT),C=i>0&&(P===F.c.CENTER||P===F.c.LEFT);let K,G,p,t,o=[];if(H&&O&&(l.push(Q+V,D+h,0),l.push(-m+V,D+h,0),l.push(-m+V,D+v+h,0),l.push(Q+V,D+v+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,K=1-i/y,G=1-v/Z,p=1,t=1,o=[K,G,p,G,p,t,K,t],c===F.c.ROTATE_ROW&&(o=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),c===F.c.FLIP_ROW&&(o=[1-K,G,1-p,G,1-p,t,1-K,t]),c===F.c.FLIP_N_ROTATE_ROW&&(o=[K,1-G,p,1-G,p,1-t,K,1-t]),T=T.concat(o),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&C&&(l.push(m+V,D+h,0),l.push(f+V,D+h,0),l.push(f+V,D+v+h,0),l.push(m+V,D+v+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,K=0,G=1-v/Z,p=i/y,t=1,o=[K,G,p,G,p,t,K,t],(c===F.c.ROTATE_ROW||c===F.c.ROTATE_TILE&&a%2===0)&&(o=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),(c===F.c.FLIP_ROW||c===F.c.FLIP_TILE&&a%2===0)&&(o=[1-K,G,1-p,G,1-p,t,1-K,t]),(c===F.c.FLIP_N_ROTATE_ROW||c===F.c.FLIP_N_ROTATE_TILE&&a%2===0)&&(o=[K,1-G,p,1-G,p,1-t,K,1-t]),T=T.concat(o),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&O&&(l.push(Q+V,z+h,0),l.push(-m+V,z+h,0),l.push(-m+V,J+h,0),l.push(Q+V,J+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,K=1-i/y,G=0,p=1,t=v/Z,o=[K,G,p,G,p,t,K,t],(c===F.c.ROTATE_ROW&&g%2===1||c===F.c.ROTATE_TILE&&g%1===0)&&(o=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),(c===F.c.FLIP_ROW&&g%2===1||c===F.c.FLIP_TILE&&g%2===0)&&(o=[1-K,G,1-p,G,1-p,t,1-K,t]),(c===F.c.FLIP_N_ROTATE_ROW&&g%2===1||c===F.c.FLIP_N_ROTATE_TILE&&g%2===0)&&(o=[K,1-G,p,1-G,p,1-t,K,1-t]),T=T.concat(o),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&C&&(l.push(m+V,z+h,0),l.push(f+V,z+h,0),l.push(f+V,J+h,0),l.push(m+V,J+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,K=0,G=0,p=i/y,t=v/Z,o=[K,G,p,G,p,t,K,t],(c===F.c.ROTATE_ROW&&g%2===1||c===F.c.ROTATE_TILE&&(g+a)%2===1)&&(o=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),(c===F.c.FLIP_ROW&&g%2===1||c===F.c.FLIP_TILE&&(g+a)%2===1)&&(o=[1-K,G,1-p,G,1-p,t,1-K,t]),(c===F.c.FLIP_N_ROTATE_ROW&&g%2===1||c===F.c.FLIP_N_ROTATE_TILE&&(g+a)%2===1)&&(o=[K,1-G,p,1-G,p,1-t,K,1-t]),T=T.concat(o),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H){const H=[];K=0,G=1-v/Z,p=1,t=1,H[0]=[K,G,p,G,p,t,K,t],H[1]=[K,G,p,G,p,t,K,t],c!==F.c.ROTATE_TILE&&c!==F.c.ROTATE_ROW||(H[1]=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),c!==F.c.FLIP_TILE&&c!==F.c.FLIP_ROW||(H[1]=[1-K,G,1-p,G,1-p,t,1-K,t]),c!==F.c.FLIP_N_ROTATE_TILE&&c!==F.c.FLIP_N_ROTATE_ROW||(H[1]=[K,1-G,p,1-G,p,1-t,K,1-t]);for(let Z=0;Z<a;Z++)l.push(Z*y-m+V,D+h,0),l.push((Z+1)*y-m+V,D+h,0),l.push((Z+1)*y-m+V,D+v+h,0),l.push(Z*y-m+V,D+v+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=c===F.c.FLIP_TILE||c===F.c.ROTATE_TILE||c===F.c.FLIP_N_ROTATE_TILE?T.concat(H[(Z+1)%2]):c===F.c.FLIP_ROW||c===F.c.ROTATE_ROW||c===F.c.FLIP_N_ROTATE_ROW?T.concat(H[1]):T.concat(H[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const H=[];K=0,G=0,p=1,t=v/Z,H[0]=[K,G,p,G,p,t,K,t],H[1]=[K,G,p,G,p,t,K,t],c!==F.c.ROTATE_TILE&&c!==F.c.ROTATE_ROW||(H[1]=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),c!==F.c.FLIP_TILE&&c!==F.c.FLIP_ROW||(H[1]=[1-K,G,1-p,G,1-p,t,1-K,t]),c!==F.c.FLIP_N_ROTATE_TILE&&c!==F.c.FLIP_N_ROTATE_ROW||(H[1]=[K,1-G,p,1-G,p,1-t,K,1-t]);for(let Z=0;Z<a;Z++)l.push(Z*y-m+V,J-v+h,0),l.push((Z+1)*y-m+V,J-v+h,0),l.push((Z+1)*y-m+V,J+h,0),l.push(Z*y-m+V,J+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=c===F.c.FLIP_TILE||c===F.c.ROTATE_TILE||c===F.c.FLIP_N_ROTATE_TILE?T.concat(H[(Z+g)%2]):c===F.c.FLIP_ROW||c===F.c.ROTATE_ROW||c===F.c.FLIP_N_ROTATE_ROW?T.concat(H[g%2]):T.concat(H[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const H=[];K=1-i/y,G=0,p=1,t=1,H[0]=[K,G,p,G,p,t,K,t],H[1]=[K,G,p,G,p,t,K,t],c!==F.c.ROTATE_TILE&&c!==F.c.ROTATE_ROW||(H[1]=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),c!==F.c.FLIP_TILE&&c!==F.c.FLIP_ROW||(H[1]=[1-K,G,1-p,G,1-p,t,1-K,t]),c!==F.c.FLIP_N_ROTATE_TILE&&c!==F.c.FLIP_N_ROTATE_ROW||(H[1]=[K,1-G,p,1-G,p,1-t,K,1-t]);for(let y=0;y<g;y++)l.push(Q+V,y*Z-z+h,0),l.push(Q+i+V,y*Z-z+h,0),l.push(Q+i+V,(y+1)*Z-z+h,0),l.push(Q+V,(y+1)*Z-z+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=c===F.c.FLIP_TILE||c===F.c.ROTATE_TILE||c===F.c.FLIP_N_ROTATE_TILE?T.concat(H[(y+1)%2]):c===F.c.FLIP_ROW||c===F.c.ROTATE_ROW||c===F.c.FLIP_N_ROTATE_ROW?T.concat(H[y%2]):T.concat(H[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const H=[];K=0,G=0,p=i/Z,t=1,H[0]=[K,G,p,G,p,t,K,t],H[1]=[K,G,p,G,p,t,K,t],c!==F.c.ROTATE_TILE&&c!==F.c.ROTATE_ROW||(H[1]=[1-K,1-G,1-p,1-G,1-p,1-t,1-K,1-t]),c!==F.c.FLIP_TILE&&c!==F.c.FLIP_ROW||(H[1]=[1-K,G,1-p,G,1-p,t,1-K,t]),c!==F.c.FLIP_N_ROTATE_TILE&&c!==F.c.FLIP_N_ROTATE_ROW||(H[1]=[K,1-G,p,1-G,p,1-t,K,1-t]);for(let y=0;y<g;y++)l.push(f-i+V,y*Z-z+h,0),l.push(f+V,y*Z-z+h,0),l.push(f+V,(y+1)*Z-z+h,0),l.push(f-i+V,(y+1)*Z-z+h,0),E.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,T=c===F.c.FLIP_TILE||c===F.c.ROTATE_TILE||c===F.c.FLIP_N_ROTATE_TILE?T.concat(H[(y+a)%2]):c===F.c.FLIP_ROW||c===F.c.ROTATE_ROW||c===F.c.FLIP_N_ROTATE_ROW?T.concat(H[y%2]):T.concat(H[0]),u.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const G=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE;S.c._ComputeSides(G,l,E,d,T,H.frontUVs,H.backUVs);const p=new S.c;p.indices=E,p.xa=l,p.ya=d,p.Aa=T;const t=G===S.c.DOUBLESIDE?u.concat(u):u;return p.za=t,p}function m(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return v(c).Ca(Z,c.updatable),Z}function z(H){const c=H.faceUV||new Array(6),y=H.faceColors,P=H.pattern||F.c.NO_FLIP,O=H.width||H.size||1,a=H.height||H.size||1,i=H.depth||H.size||1,C=H.tileWidth||H.tileSize||1,m=H.tileHeight||H.tileSize||1,z=H.alignHorizontal||0,V=H.alignVertical||0,h=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE;for(let F=0;F<6;F++)void 0===c[F]&&(c[F]=new Z.q(0,0,1,1)),y&&void 0===y[F]&&(y[F]=new g.h(1,1,1,1));const Q=O/2,D=a/2,f=i/2,J=[];for(let Z=0;Z<2;Z++)J[Z]=v({pattern:P,tileWidth:C,tileHeight:m,width:O,height:a,alignVertical:V,alignHorizontal:z,sideOrientation:h});for(let Z=2;Z<4;Z++)J[Z]=v({pattern:P,tileWidth:C,tileHeight:m,width:i,height:a,alignVertical:V,alignHorizontal:z,sideOrientation:h});let l=V;V===F.c.BOTTOM?l=F.c.TOP:V===F.c.TOP&&(l=F.c.BOTTOM);for(let Z=4;Z<6;Z++)J[Z]=v({pattern:P,tileWidth:C,tileHeight:m,width:O,height:i,alignVertical:l,alignHorizontal:z,sideOrientation:h});let d=[],K=[],T=[],u=[];const E=[],U=[],G=[],p=[];let t=0,o=0;for(let F=0;F<6;F++){const H=J[F].xa.length;U[F]=[],G[F]=[];for(let c=0;c<H/3;c++)U[F].push(new Z.n(J[F].xa[3*c],J[F].xa[3*c+1],J[F].xa[3*c+2])),G[F].push(new Z.n(J[F].ya[3*c],J[F].ya[3*c+1],J[F].ya[3*c+2]));t=J[F].Aa.length,p[F]=[];for(let y=0;y<t;y+=2)p[F][y]=c[F].x+(c[F].z-c[F].x)*J[F].Aa[y],p[F][y+1]=c[F].y+(c[F].w-c[F].y)*J[F].Aa[y+1],n.d&&(p[F][y+1]=1-p[F][y+1]);if(T=T.concat(p[F]),u=u.concat(J[F].indices.map((H=>H+o))),o+=U[F].length,y)for(let c=0;c<4;c++)E.push(y[F].r,y[F].g,y[F].b,y[F].a)}const s=new Z.n(0,0,f),q=Z.d.RotationY(Math.PI);d=U[0].map((H=>Z.n.TransformNormal(H,q).add(s))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]),K=G[0].map((H=>Z.n.TransformNormal(H,q))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]),d=d.concat(U[1].map((H=>H.Rc(s))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),K=K.concat(G[1].map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]));const I=new Z.n(Q,0,0),j=Z.d.RotationY(-Math.PI/2);d=d.concat(U[2].map((H=>Z.n.TransformNormal(H,j).add(I))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),K=K.concat(G[2].map((H=>Z.n.TransformNormal(H,j))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]));const k=Z.d.RotationY(Math.PI/2);d=d.concat(U[3].map((H=>Z.n.TransformNormal(H,k).Rc(I))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),K=K.concat(G[3].map((H=>Z.n.TransformNormal(H,k))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]));const W=new Z.n(0,D,0),M=Z.d.RotationX(Math.PI/2);d=d.concat(U[4].map((H=>Z.n.TransformNormal(H,M).add(W))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),K=K.concat(G[4].map((H=>Z.n.TransformNormal(H,M))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[]));const x=Z.d.RotationX(-Math.PI/2);d=d.concat(U[5].map((H=>Z.n.TransformNormal(H,x).Rc(W))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),K=K.concat(G[5].map((H=>Z.n.TransformNormal(H,x))).map((H=>[H.x,H.y,H.z])).reduce(((H,c)=>H.concat(c)),[])),S.c._ComputeSides(h,d,u,K,T);const R=new S.c;if(R.indices=u,R.xa=d,R.ya=K,R.Aa=T,y){const H=h===S.c.DOUBLESIDE?E.concat(E):E;R.za=H}return R}function V(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return z(c).Ca(Z,c.updatable),Z}S.c.CreateTiledPlane=v;S.c.CreateTiledBox=z;var h=y(11744),Q=y(11076),D=y(11410);function f(H){const c=H.height||2;let y=0===H.diameterTop?0:H.diameterTop||H.diameter||1,P=0===H.diameterBottom?0:H.diameterBottom||H.diameter||1;y=y||1e-5,P=P||1e-5;const O=0|(H.tessellation||24),a=0|(H.subdivisions||1),i=!!H.hasRings,C=!!H.enclose,v=0===H.cap?0:H.cap||F.c.CAP_ALL,m=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,z=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,V=H.faceUV||new Array(3),h=H.faceColors,Q=2+(1+(1!==m&&C?2:0))*(i?a:1);let f;for(f=0;f<Q;f++)h&&void 0===h[f]&&(h[f]=new g.h(1,1,1,1));for(f=0;f<Q;f++)V&&void 0===V[f]&&(V[f]=new Z.q(0,0,1,1));const J=[],l=[],d=[],K=[],T=[],u=2*Math.PI*m/O;let E,U,G;const p=(P-y)/2/c,t=Z.n.Zero(),o=Z.n.Zero(),s=Z.n.Zero(),q=Z.n.Zero(),I=Z.n.Zero(),j=D.e.Y;let k,W,M,x=1,R=1,A=0,e=0;for(k=0;k<=a;k++)for(U=k/a,G=(U*(y-P)+P)/2,x=i&&0!==k&&k!==a?2:1,M=0;M<x;M++){for(i&&(R+=M),C&&(R+=2*M),W=0;W<=O;W++)E=W*u,t.x=Math.cos(-E)*G,t.y=-c/2+U*c,t.z=Math.sin(-E)*G,0===y&&k===a?(o.x=d[d.length-3*(O+1)],o.y=d[d.length-3*(O+1)+1],o.z=d[d.length-3*(O+1)+2]):(o.x=t.x,o.z=t.z,o.y=Math.sqrt(o.x*o.x+o.z*o.z)*p,o.normalize()),0===W&&(s.p(t),q.p(o)),l.push(t.x,t.y,t.z),d.push(o.x,o.y,o.z),e=i?A!==R?V[R].y:V[R].w:V[R].y+(V[R].w-V[R].y)*U,K.push(V[R].x+(V[R].z-V[R].x)*W/O,n.d?1-e:e),h&&T.push(h[R].r,h[R].g,h[R].b,h[R].a);1!==m&&C&&(l.push(t.x,t.y,t.z),l.push(0,t.y,0),l.push(0,t.y,0),l.push(s.x,s.y,s.z),Z.n.CrossToRef(j,o,I),I.normalize(),d.push(I.x,I.y,I.z,I.x,I.y,I.z),Z.n.CrossToRef(q,j,I),I.normalize(),d.push(I.x,I.y,I.z,I.x,I.y,I.z),e=i?A!==R?V[R+1].y:V[R+1].w:V[R+1].y+(V[R+1].w-V[R+1].y)*U,K.push(V[R+1].x,n.d?1-e:e),K.push(V[R+1].z,n.d?1-e:e),e=i?A!==R?V[R+2].y:V[R+2].w:V[R+2].y+(V[R+2].w-V[R+2].y)*U,K.push(V[R+2].x,n.d?1-e:e),K.push(V[R+2].z,n.d?1-e:e),h&&(T.push(h[R+1].r,h[R+1].g,h[R+1].b,h[R+1].a),T.push(h[R+1].r,h[R+1].g,h[R+1].b,h[R+1].a),T.push(h[R+2].r,h[R+2].g,h[R+2].b,h[R+2].a),T.push(h[R+2].r,h[R+2].g,h[R+2].b,h[R+2].a))),A!==R&&(A=R)}const r=1!==m&&C?O+4:O;for(k=0,R=0;R<a;R++){let H=0,c=0,y=0,Z=0;for(W=0;W<O;W++)H=k*(r+1)+W,c=(k+1)*(r+1)+W,y=k*(r+1)+(W+1),Z=(k+1)*(r+1)+(W+1),J.push(H,c,y),J.push(Z,y,c);1!==m&&C&&(J.push(H+2,c+2,y+2),J.push(Z+2,y+2,c+2),J.push(H+4,c+4,y+4),J.push(Z+4,y+4,c+4)),k=i?k+2:k+1}const N=H=>{const F=H?y/2:P/2;if(0===F)return;let S,a,i;const C=H?V[Q-1]:V[0];let g=null;h&&(g=H?h[Q-1]:h[0]);const v=l.length/3,z=H?c/2:-c/2,D=new Z.n(0,z,0);l.push(D.x,D.y,D.z),d.push(0,H?1:-1,0);const f=C.y+.5*(C.w-C.y);K.push(C.x+.5*(C.z-C.x),n.d?1-f:f),g&&T.push(g.r,g.g,g.b,g.a);const u=new Z.l(.5,.5);for(i=0;i<=O;i++){S=2*Math.PI*i*m/O;const c=Math.cos(-S),y=Math.sin(-S);a=new Z.n(c*F,z,y*F);const P=new Z.l(c*u.x+.5,y*u.y+.5);l.push(a.x,a.y,a.z),d.push(0,H?1:-1,0);const v=C.y+(C.w-C.y)*P.y;K.push(C.x+(C.z-C.x)*P.x,n.d?1-v:v),g&&T.push(g.r,g.g,g.b,g.a)}for(i=0;i<O;i++)H?(J.push(v),J.push(v+(i+2)),J.push(v+(i+1))):(J.push(v),J.push(v+(i+1)),J.push(v+(i+2)))};v!==F.c.CAP_START&&v!==F.c.CAP_ALL||N(!1),v!==F.c.CAP_END&&v!==F.c.CAP_ALL||N(!0),S.c._ComputeSides(z,l,J,d,K,H.frontUVs,H.backUVs);const w=new S.c;return w.indices=J,w.xa=l,w.ya=d,w.Aa=K,h&&(w.za=T),w}function J(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return f(c).Ca(Z,c.updatable),Z}function l(H){const c=[],y=[],F=[],P=[],O=H.diameter||1,a=H.thickness||.5,i=0|(H.tessellation||16),C=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,g=i+1;for(let S=0;S<=i;S++){const H=S/i,C=S*Math.PI*2/i-Math.PI/2,v=Z.d.Translation(O/2,0,0).multiply(Z.d.RotationY(C));for(let O=0;O<=i;O++){const C=1-O/i,m=O*Math.PI*2/i+Math.PI,z=Math.cos(m),V=Math.sin(m);let h=new Z.n(z,V,0),Q=h.scale(a/2);const D=new Z.l(H,C);Q=Z.n.TransformCoordinates(Q,v),h=Z.n.TransformNormal(h,v),y.push(Q.x,Q.y,Q.z),F.push(h.x,h.y,h.z),P.push(D.x,n.d?1-D.y:D.y);const f=(S+1)%g,J=(O+1)%g;c.push(S*g+O),c.push(S*g+J),c.push(f*g+O),c.push(S*g+J),c.push(f*g+J),c.push(f*g+O)}}S.c._ComputeSides(C,y,c,F,P,H.frontUVs,H.backUVs);const v=new S.c;return v.indices=c,v.xa=y,v.ya=F,v.Aa=P,v}function d(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return l(c).Ca(Z,c.updatable),Z}S.c.CreateCylinder=f,F.c.CreateCylinder=(H,c,y,Z,P,S,n,O,a)=>{void 0!==n&&n instanceof Q.d||(void 0!==n&&(a=O||F.c.DEFAULTSIDE,O=n),n=S,S=1);return J(H,{height:c,diameterTop:y,diameterBottom:Z,tessellation:P,subdivisions:S,sideOrientation:a,updatable:O},n)};function K(H){const c=[],y=[],F=[],P=[],O=H.radius||2,a=H.tube||.5,i=H.radialSegments||32,C=H.tubularSegments||32,g=H.p||2,v=H.q||3,m=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,z=H=>{const c=Math.cos(H),y=Math.sin(H),F=v/g*H,P=Math.cos(F),S=O*(2+P)*.5*c,n=O*(2+P)*y*.5,a=O*Math.sin(F)*.5;return new Z.n(S,n,a)};let V,h;for(V=0;V<=i;V++){const H=V%i/i*2*g*Math.PI,c=z(H),F=z(H+.01),S=F.Rc(c);let O=F.add(c);const v=Z.n.Cross(S,O);for(O=Z.n.Cross(v,S),v.normalize(),O.normalize(),h=0;h<C;h++){const H=h%C/C*2*Math.PI,Z=-a*Math.cos(H),F=a*Math.sin(H);y.push(c.x+Z*O.x+F*v.x),y.push(c.y+Z*O.y+F*v.y),y.push(c.z+Z*O.z+F*v.z),P.push(V/i),P.push(n.d?1-h/C:h/C)}}for(V=0;V<i;V++)for(h=0;h<C;h++){const H=(h+1)%C,y=V*C+h,Z=(V+1)*C+h,F=(V+1)*C+H,P=V*C+H;c.push(P),c.push(Z),c.push(y),c.push(P),c.push(F),c.push(Z)}S.c.ComputeNormals(y,c,F),S.c._ComputeSides(m,y,c,F,P,H.frontUVs,H.backUVs);const Q=new S.c;return Q.indices=c,Q.xa=y,Q.ya=F,Q.Aa=P,Q}function T(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return K(c).Ca(Z,c.updatable),Z}S.c.CreateTorus=l,F.c.CreateTorus=(H,c,y,Z,F,P,S)=>d(H,{diameter:c,thickness:y,tessellation:Z,sideOrientation:S,updatable:P},F);S.c.CreateTorusKnot=K,F.c.CreateTorusKnot=(H,c,y,Z,F,P,S,n,O,a)=>T(H,{radius:c,tube:y,radialSegments:Z,tubularSegments:F,p:P,q:S,sideOrientation:a,updatable:O},n);var u=y(12806),E=y(10773),U=y(11617),G=y(11094),p=y(10810);class t extends Z.l{constructor(H,c){super(H.x,H.y),this.index=c}}class o{constructor(){this.elements=[]}add(H){const c=[];return H.forEach((H=>{const y=new t(H,this.elements.length);c.push(y),this.elements.push(y)})),c}computeBounds(){const H=new Z.l(this.elements[0].x,this.elements[0].y),c=new Z.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((y=>{y.x<H.x?H.x=y.x:y.x>c.x&&(c.x=y.x),y.y<H.y?H.y=y.y:y.y>c.y&&(c.y=y.y)})),{min:H,max:c,width:c.x-H.x,height:c.y-H.y}}}class s{_addToepoint(H){for(const c of H)this._epoints.push(c.x,c.y)}constructor(H,c,y){let Z,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new o,this._outlinepoints=new o,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=F,this._name=H,this._scene=y||p.b.LastCreatedScene,Z=c instanceof U.f?c.getPoints():c,this._addToepoint(Z),this._points.add(Z),this._outlinepoints.add(Z),"undefined"===typeof this.bjsEarcut&&E.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(H){this._points.add(H);const c=new o;return c.add(H),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(H),this}build(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const Z=new F.c(this._name,this._scene),S=this.buildVertexData(c,y);return Z.Ga(P.h.PositionKind,S.xa,H),Z.Ga(P.h.NormalKind,S.ya,H),Z.Ga(P.h.UVKind,S.Aa,H),Z.setIndices(S.indices),Z}buildVertexData(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const y=new S.c,Z=[],F=[],P=[],n=this._points.computeBounds();this._points.elements.forEach((H=>{Z.push(0,1,0),F.push(H.x,0,H.y),P.push((H.x-n.min.x)/n.width,(H.y-n.min.y)/n.height)}));const O=[],a=this.bjsEarcut(this._epoints,this._eholes,2);for(let S=0;S<a.length;S++)O.push(a[S]);if(H>0){const y=F.length/3;this._points.elements.forEach((c=>{Z.push(0,-1,0),F.push(c.x,-H,c.y),P.push(1-(c.x-n.min.x)/n.width,1-(c.y-n.min.y)/n.height)}));const S=O.length;for(let H=0;H<S;H+=3){const c=O[H+0],Z=O[H+1],F=O[H+2];O.push(F+y),O.push(Z+y),O.push(c+y)}this._addSide(F,Z,P,O,n,this._outlinepoints,H,!1,c),this._holes.forEach((y=>{this._addSide(F,Z,P,O,n,y,H,!0,c)}))}return y.indices=O,y.xa=F,y.ya=Z,y.Aa=P,y}_addSide(H,c,y,F,P,S,n,O,a){let i=H.length/3,C=0;for(let g=0;g<S.elements.length;g++){const v=S.elements[g],m=S.elements[(g+1)%S.elements.length];H.push(v.x,0,v.y),H.push(v.x,-n,v.y),H.push(m.x,0,m.y),H.push(m.x,-n,m.y);const z=S.elements[(g+S.elements.length-1)%S.elements.length],V=S.elements[(g+2)%S.elements.length];let h=new Z.n(-(m.y-v.y),0,m.x-v.x),Q=new Z.n(-(v.y-z.y),0,v.x-z.x),D=new Z.n(-(V.y-m.y),0,V.x-m.x);O||(h=h.scale(-1),Q=Q.scale(-1),D=D.scale(-1));const f=h.normalizeToNew();let J=Q.normalizeToNew(),l=D.normalizeToNew();const d=Z.n.Dot(J,f);J=d>a?d<G.e-1?new Z.n(v.x,0,v.y).Rc(new Z.n(m.x,0,m.y)).normalize():Q.add(h).normalize():f;const K=Z.n.Dot(D,h);l=K>a?K<G.e-1?new Z.n(m.x,0,m.y).Rc(new Z.n(v.x,0,v.y)).normalize():D.add(h).normalize():f,y.push(C/P.width,0),y.push(C/P.width,1),C+=h.length(),y.push(C/P.width,0),y.push(C/P.width,1),c.push(J.x,J.y,J.z),c.push(J.x,J.y,J.z),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z),O?(F.push(i),F.push(i+2),F.push(i+1),F.push(i+1),F.push(i+2),F.push(i+3)):(F.push(i),F.push(i+1),F.push(i+2),F.push(i+1),F.push(i+3),F.push(i+2)),i+=4}}}function q(H,c,y,F,O,a,i){const C=y||new Array(3),v=F,m=[],z=i||!1;for(let P=0;P<3;P++)void 0===C[P]&&(C[P]=new Z.q(0,0,1,1)),v&&void 0===v[P]&&(v[P]=new g.h(1,1,1,1));const V=H.getVerticesData(P.h.PositionKind),h=H.getVerticesData(P.h.NormalKind),Q=H.getVerticesData(P.h.UVKind),D=H.Vf(),f=V.length/9;let J=0,l=0,d=0,K=0,T=0;const u=[0];if(z)for(let Z=f;Z<V.length/3;Z+=4)l=V[3*(Z+2)]-V[3*Z],d=V[3*(Z+2)+2]-V[3*Z+2],K=Math.sqrt(l*l+d*d),T+=K,u.push(T);let E=0,U=0;for(let Z=0;Z<h.length;Z+=3)Math.abs(h[Z+1])<.001&&(U=1),Math.abs(h[Z+1]-1)<.001&&(U=0),Math.abs(h[Z+1]+1)<.001&&(U=2),E=Z/3,1===U?(J=E-f,Q[2*E]=J%4<1.5?z?C[U].x+(C[U].z-C[U].x)*u[Math.floor(J/4)]/T:C[U].x:z?C[U].x+(C[U].z-C[U].x)*u[Math.floor(J/4)+1]/T:C[U].z,Q[2*E+1]=J%2===0?n.d?1-C[U].w:C[U].w:n.d?1-C[U].y:C[U].y):(Q[2*E]=(1-Q[2*E])*C[U].x+Q[2*E]*C[U].z,Q[2*E+1]=(1-Q[2*E+1])*C[U].y+Q[2*E+1]*C[U].w,n.d&&(Q[2*E+1]=1-Q[2*E+1])),v&&m.push(v[U].r,v[U].g,v[U].b,v[U].a);S.c._ComputeSides(c,V,D,h,Q,O,a);const G=new S.c;if(G.indices=D,G.xa=V,G.ya=h,G.Aa=Q,v){const H=c===S.c.DOUBLESIDE?m.concat(m):m;G.za=H}return G}function I(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation);const S=c.shape,n=c.holes||[],O=c.depth||0,a=c.smoothingThreshold||2,i=[];let C=[];for(let F=0;F<S.length;F++)i[F]=new Z.l(S[F].x,S[F].z);i[0].equalsWithEpsilon(i[i.length-1],1e-8)&&i.pop();const g=new s(H,i,y||p.b.LastCreatedScene,P);for(let F=0;F<n.length;F++){C=[];for(let H=0;H<n[F].length;H++)C.push(new Z.l(n[F][H].x,n[F][H].z));g.addHole(C)}const v=g.build(!1,O,a);v._originalBuilderSideOrientation=c.sideOrientation;return q(v,c.sideOrientation,c.faceUV,c.faceColors,c.frontUVs,c.backUVs,c.wrap).Ca(v,c.updatable),v}function j(H,c){return I(H,c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function k(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=c.path,P=c.shape,S=c.scale||1,n=c.rotation||0,O=0===c.cap?0:c.cap||F.c.NO_CAP,a=c.updatable,i=F.c._GetDefaultSideOrientation(c.sideOrientation),C=c.instance||null,g=c.invertUV||!1,v=c.closeShape||!1;return M(H,P,Z,S,n,null,null,c.closePath||!1,v,O,!1,y,!!a,i,C,g,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame)}function W(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=c.path,P=c.shape,S=c.scaleFunction||(()=>1),n=c.rotationFunction||(()=>0),O=c.closePath||c.ribbonCloseArray||!1,a=c.closeShape||c.ribbonClosePath||!1,i=0===c.cap?0:c.cap||F.c.NO_CAP,C=c.updatable,g=c.firstNormal||null,v=c.adjustFrame||!1;return M(H,P,Z,null,null,S,n,O,a,i,!0,y,!!C,F.c._GetDefaultSideOrientation(c.sideOrientation),c.instance||null,c.invertUV||!1,c.frontUVs||null,c.backUVs||null,g,v)}function M(H,c,y,P,S,n,O,i,C,g,v,m,z,V,h,Q,D,f,J,l){const d=(H,c,y,P,S,n,O,a,i,C,g)=>{const v=y.getTangents(),m=y.getNormals(),z=y.getBinormals(),V=y.getDistances();if(g)for(let F=0;F<v.length;F++)if(0==v[F].x&&0==v[F].y&&0==v[F].z&&v[F].p(v[F-1]),0==m[F].x&&0==m[F].y&&0==m[F].z&&m[F].p(m[F-1]),0==z[F].x&&0==z[F].y&&0==z[F].z&&z[F].p(z[F-1]),F>0){let H=v[F-1];Z.n.Dot(H,v[F])<0&&v[F].scaleInPlace(-1),H=m[F-1],Z.n.Dot(H,m[F])<0&&m[F].scaleInPlace(-1),H=z[F-1],Z.n.Dot(H,z[F])<0&&z[F].scaleInPlace(-1)}let h=0;const Q=C&&a?a:()=>null!==n?n:0,D=C&&O?O:()=>null!==S?S:1;let f=i===F.c.NO_CAP||i===F.c.CAP_END?0:2;const J=Z.h.Matrix[0];for(let F=0;F<c.length;F++){const y=[],S=Q(F,V[F]),n=D(F,V[F]);Z.d.RotationAxisToRef(v[F],h,J);for(let P=0;P<H.length;P++){const S=v[F].scale(H[P].z).add(m[F].scale(H[P].x)).add(z[F].scale(H[P].y)),O=Z.n.Zero();Z.n.TransformCoordinatesToRef(S,J,O),O.scaleInPlace(n).addInPlace(c[F]),y[P]=O}P[f]=y,h+=S,f++}const l=H=>{const c=Array(),y=Z.n.Zero();let F;for(F=0;F<H.length;F++)y.addInPlace(H[F]);for(y.scaleInPlace(1/H.length),F=0;F<H.length;F++)c.push(y);return c};switch(i){case F.c.NO_CAP:break;case F.c.CAP_START:P[0]=l(P[2]),P[1]=P[2];break;case F.c.CAP_END:P[f]=P[f-1],P[f+1]=l(P[f-1]);break;case F.c.CAP_ALL:P[0]=l(P[2]),P[1]=P[2],P[f]=P[f-1],P[f+1]=l(P[f-1])}return P};let K,T;if(h){const H=h._creationDataStorage;return K=J?H.path3D.update(y,J):H.path3D.update(y),T=d(c,y,H.path3D,H.pathArray,P,S,n,O,H.cap,v,l),h=a("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},m||void 0)}K=J?new U.h(y,J):new U.h(y);T=d(c,y,K,new Array,P,S,n,O,g=g<0||g>3?0:g,v,l);const u=a(H,{pathArray:T,closeArray:i,closePath:C,updatable:z,sideOrientation:V,invertUV:Q,frontUVs:D||void 0,backUVs:f||void 0},m);return u._creationDataStorage.pathArray=T,u._creationDataStorage.path3D=K,u._creationDataStorage.cap=g,u}S.c.CreatePolygon=q,F.c.CreatePolygon=function(H,c,y,Z,F,P){return I(H,{shape:c,holes:Z,updatable:F,sideOrientation:P},y,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},F.c.ExtrudePolygon=function(H,c,y,Z,F,P,S){return j(H,{shape:c,holes:F,depth:y,updatable:P,sideOrientation:S},Z,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function x(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,S=void 0===c.closed||c.closed,n=c.shape,O=c.radius||1,i=c.tessellation||64,C=c.clip||0,g=c.updatable,v=F.c._GetDefaultSideOrientation(c.sideOrientation),m=c.cap||F.c.NO_CAP,z=2*Math.PI,V=[],h=c.invertUV||!1;let Q=0,D=0;const f=z/i*P;let J,l;for(Q=0;Q<=i-C;Q++){for(l=[],m!=F.c.CAP_START&&m!=F.c.CAP_ALL||(l.push(new Z.n(0,n[0].y,0)),l.push(new Z.n(Math.cos(Q*f)*n[0].x*O,n[0].y,Math.sin(Q*f)*n[0].x*O))),D=0;D<n.length;D++)J=new Z.n(Math.cos(Q*f)*n[D].x*O,n[D].y,Math.sin(Q*f)*n[D].x*O),l.push(J);m!=F.c.CAP_END&&m!=F.c.CAP_ALL||(l.push(new Z.n(Math.cos(Q*f)*n[n.length-1].x*O,n[n.length-1].y,Math.sin(Q*f)*n[n.length-1].x*O)),l.push(new Z.n(0,n[n.length-1].y,0))),V.push(l)}return a(H,{pathArray:V,closeArray:S,sideOrientation:v,updatable:g,invertUV:h,frontUVs:c.frontUVs,backUVs:c.backUVs},y)}F.c.ExtrudeShape=function(H,c,y,Z,P,S){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0,i=arguments.length>9?arguments[9]:void 0;return k(H,{shape:c,path:y,scale:Z,rotation:P,cap:0===S?0:S||F.c.NO_CAP,sideOrientation:a,instance:i,updatable:O},n)},F.c.ExtrudeShapeCustom=(H,c,y,Z,P,S,n,O,a,i,C,g)=>W(H,{shape:c,path:y,scaleFunction:Z,rotationFunction:P,ribbonCloseArray:S,ribbonClosePath:n,cap:0===O?0:O||F.c.NO_CAP,sideOrientation:C,instance:g,updatable:i},a);F.c.CreateLathe=(H,c,y,Z,F,P,S)=>x(H,{shape:c,radius:y,tessellation:Z,sideOrientation:S,updatable:P},F);var R=y(11476),A=y(11425);function e(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.path;let S=c.instance,n=1;void 0!==c.radius?n=c.radius:S&&(n=S._creationDataStorage.radius);const O=c.tessellation||64,i=c.radiusFunction||null;let C=c.cap||F.c.NO_CAP;const g=c.invertUV||!1,v=c.updatable,m=F.c._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const z=(H,c,y,P,S,n,O,a)=>{const i=c.getTangents(),C=c.getNormals(),g=c.getDistances(),v=2*Math.PI/S*a,m=n||(()=>P);let z,V,h,Q;const D=Z.h.Matrix[0];let f=O===F.c.NO_CAP||O===F.c.CAP_END?0:2;for(let F=0;F<H.length;F++){V=m(F,g[F]),z=Array(),h=C[F];for(let c=0;c<S;c++)Z.d.RotationAxisToRef(i[F],v*c,D),Q=z[c]?z[c]:Z.n.Zero(),Z.n.TransformCoordinatesToRef(h,D,Q),Q.scaleInPlace(V).addInPlace(H[F]),z[c]=Q;y[f]=z,f++}const J=(c,y)=>{const Z=Array();for(let F=0;F<c;F++)Z.push(H[y]);return Z};switch(O){case F.c.NO_CAP:break;case F.c.CAP_START:y[0]=J(S,0),y[1]=y[2].slice(0);break;case F.c.CAP_END:y[f]=y[f-1].slice(0),y[f+1]=J(S,H.length-1);break;case F.c.CAP_ALL:y[0]=J(S,0),y[1]=y[2].slice(0),y[f]=y[f-1].slice(0),y[f+1]=J(S,H.length-1)}return y};let V,h;if(S){const H=S._creationDataStorage,y=c.arc||H.arc;return V=H.path3D.update(P),h=z(P,V,H.pathArray,n,H.tessellation,i,H.cap,y),S=a("",{pathArray:h,instance:S}),H.path3D=V,H.pathArray=h,H.arc=y,H.radius=n,S}V=new U.h(P);C=C<0||C>3?0:C,h=z(P,V,new Array,n,O,i,C,c.arc);const Q=a(H,{pathArray:h,closePath:!0,closeArray:!1,updatable:v,sideOrientation:m,invertUV:g,frontUVs:c.frontUVs,backUVs:c.backUVs},y);return Q._creationDataStorage.pathArray=h,Q._creationDataStorage.path3D=V,Q._creationDataStorage.tessellation=O,Q._creationDataStorage.cap=C,Q._creationDataStorage.arc=c.arc,Q._creationDataStorage.radius=n,Q}function r(H){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const y=H.type&&(H.type<0||H.type>=c.length)?0:H.type||0,F=H.size,P=H.sizeX||F||1,O=H.sizeY||F||1,a=H.sizeZ||F||1,i=H.custom||c[y],C=i.face.length,v=H.faceUV||new Array(C),m=H.faceColors,z=void 0===H.flat||H.flat,V=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,h=[],Q=[],D=[],f=[],J=[];let l=0,d=0;const K=[];let T,u,E,U,G,p,t=0,o=0;if(z)for(o=0;o<C;o++)m&&void 0===m[o]&&(m[o]=new g.h(1,1,1,1)),v&&void 0===v[o]&&(v[o]=new Z.q(0,0,1,1));if(z)for(o=0;o<C;o++){const H=i.face[o].length;for(E=2*Math.PI/H,U=.5*Math.tan(E/2),G=.5,t=0;t<H;t++)h.push(i.vertex[i.face[o][t]][0]*P,i.vertex[i.face[o][t]][1]*O,i.vertex[i.face[o][t]][2]*a),K.push(l),l++,T=v[o].x+(v[o].z-v[o].x)*(.5+U),u=v[o].y+(v[o].w-v[o].y)*(G-.5),f.push(T,n.d?1-u:u),p=U*Math.cos(E)-G*Math.sin(E),G=U*Math.sin(E)+G*Math.cos(E),U=p,m&&J.push(m[o].r,m[o].g,m[o].b,m[o].a);for(t=0;t<H-2;t++)Q.push(K[0+d],K[t+2+d],K[t+1+d]);d+=H}else{for(t=0;t<i.vertex.length;t++)h.push(i.vertex[t][0]*P,i.vertex[t][1]*O,i.vertex[t][2]*a),f.push(0,n.d?1:0);for(o=0;o<C;o++)for(t=0;t<i.face[o].length-2;t++)Q.push(i.face[o][0],i.face[o][t+2],i.face[o][t+1])}S.c.ComputeNormals(h,Q,D),S.c._ComputeSides(V,h,Q,D,f,H.frontUVs,H.backUVs);const s=new S.c;return s.xa=h,s.indices=Q,s.ya=D,s.Aa=f,m&&z&&(s.za=J),s}function N(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return r(c).Ca(Z,c.updatable),Z}F.c.CreateTube=(H,c,y,Z,F,P,S,n,O,a)=>e(H,{path:c,radius:y,tessellation:Z,radiusFunction:F,arc:1,cap:P,updatable:n,sideOrientation:O,instance:a},S);function w(H){const c=H.sideOrientation||S.c.DEFAULTSIDE,y=H.radius||1,F=void 0===H.flat||H.flat,P=0|(H.subdivisions||4),O=H.radiusX||y,a=H.radiusY||y,i=H.radiusZ||y,C=(1+Math.sqrt(5))/2,g=[-1,C,-0,1,C,0,-1,-C,0,1,-C,0,0,-1,-C,0,1,-C,0,-1,C,0,1,C,C,0,1,C,0,-1,-C,0,1,-C,0,-1],v=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],m=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],Q=[],D=[],f=[];let J=0;const l=new Array(3),d=new Array(3);let K;for(K=0;K<3;K++)l[K]=Z.n.Zero(),d[K]=Z.l.Zero();for(let S=0;S<20;S++){for(K=0;K<3;K++){const H=v[3*S+K];l[K].be(g[3*m[H]],g[3*m[H]+1],g[3*m[H]+2]),l[K].normalize(),d[K].be(.134765625*z[2*H]+.05859375+-.0390625*V[S],.2333984375*z[2*H+1]+.025390625+.01953125*V[S])}const H=(H,c,y,S)=>{const C=Z.n.Lerp(l[0],l[2],c/P),g=Z.n.Lerp(l[1],l[2],c/P),v=P===c?l[2]:Z.n.Lerp(C,g,H/(P-c));let m;if(v.normalize(),F){const H=Z.n.Lerp(l[0],l[2],S/P),c=Z.n.Lerp(l[1],l[2],S/P);m=Z.n.Lerp(H,c,y/(P-S))}else m=new Z.n(v.x,v.y,v.z);m.x/=O,m.y/=a,m.z/=i,m.normalize();const z=Z.l.Lerp(d[0],d[2],c/P),V=Z.l.Lerp(d[1],d[2],c/P),K=P===c?d[2]:Z.l.Lerp(z,V,H/(P-c));Q.push(v.x*O,v.y*a,v.z*i),D.push(m.x,m.y,m.z),f.push(K.x,n.d?1-K.y:K.y),h.push(J),J++};for(let c=0;c<P;c++)for(let y=0;y+c<P;y++)H(y,c,y+1/3,c+1/3),H(y+1,c,y+1/3,c+1/3),H(y,c+1,y+1/3,c+1/3),y+c+1<P&&(H(y+1,c,y+2/3,c+2/3),H(y+1,c+1,y+2/3,c+2/3),H(y,c+1,y+2/3,c+2/3))}S.c._ComputeSides(c,Q,h,D,f,H.frontUVs,H.backUVs);const T=new S.c;return T.indices=h,T.xa=Q,T.ya=D,T.Aa=f,T}function L(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new F.c(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),Z._originalBuilderSideOrientation=c.sideOrientation;return w(c).Ca(Z,c.updatable),Z}S.c.CreatePolyhedron=r,F.c.CreatePolyhedron=(H,c,y)=>N(H,c,y);S.c.CreateIcoSphere=w,F.c.CreateIcoSphere=(H,c,y)=>L(H,c,y);var b=y(11106);const X=new Z.n(1,0,0),B=new Z.n(-1,0,0),Y=new Z.n(0,1,0),HH=new Z.n(0,-1,0),cH=new Z.n(0,0,1),yH=new Z.n(0,0,-1);class ZH{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.n.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.n.Up(),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.l.Zero(),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=H,this.k=c,this.uv=y,this.vertexIdx=F,this.vertexIdxForBones=P,this.localPositionOverride=S,this.localNormalOverride=n,this.matrixIndicesOverride=O,this.matrixWeightsOverride=a}clone(){var H,c,y,Z;return new ZH(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(H=this.localPositionOverride)||void 0===H?void 0:H.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(y=this.matrixIndicesOverride)||void 0===y?void 0:y.slice(),null===(Z=this.matrixWeightsOverride)||void 0===Z?void 0:Z.slice())}}function FH(H,c,y){var O,a,i,C;const g=!!c.skeleton,v=y.localMode||g,m=c.Vf(),z=g?c.Od(!0,!0):c.getVerticesData(P.h.PositionKind),V=g?c.getNormalsData(!0,!0):c.getVerticesData(P.h.NormalKind),h=v?g?c.getVerticesData(P.h.PositionKind):z:null,Q=v?g?c.getVerticesData(P.h.NormalKind):V:null,D=c.getVerticesData(P.h.UVKind),f=g?c.getVerticesData(P.h.MatricesIndicesKind):null,J=g?c.getVerticesData(P.h.MatricesWeightsKind):null,l=g?c.getVerticesData(P.h.MatricesIndicesExtraKind):null,d=g?c.getVerticesData(P.h.MatricesWeightsExtraKind):null,K=y.position||Z.n.Zero();let T=y.k||Z.n.Up();const u=y.size||Z.n.One(),E=y.angle||0;if(!T){const H=new Z.n(0,0,1),y=c.va().activeCamera,F=Z.n.TransformCoordinates(H,y.getWorldMatrix());T=y.globalPosition.Rc(F)}const U=-Math.atan2(T.z,T.x)-Math.PI/2,G=Math.sqrt(T.x*T.x+T.z*T.z),p=Math.atan2(T.y,G),t=new S.c;t.indices=[],t.xa=[],t.ya=[],t.Aa=[],t.matricesIndices=g?[]:null,t.matricesWeights=g?[]:null,t.matricesIndicesExtra=l?[]:null,t.matricesWeightsExtra=d?[]:null;let o=0;const s=(H,c)=>{const F=new ZH;if(!m||!z||!V)return F;const P=m[H];if(F.vertexIdx=3*P,F.vertexIdxForBones=4*P,F.position=new Z.n(z[3*P],z[3*P+1],z[3*P+2]),Z.n.TransformCoordinatesToRef(F.position,c,F.position),F.k=new Z.n(V[3*P],V[3*P+1],V[3*P+2]),Z.n.TransformNormalToRef(F.k,c,F.k),y.captureUVS&&D){const H=D[2*P+1];F.uv=new Z.l(D[2*P],n.d?1-H:H)}return F},q=[0,0,0,0],I=(H,c)=>{if(0===H.length)return H;const y=.5*Math.abs(Z.n.Dot(u,c)),F=(H,c,y,Z)=>{for(let F=0;F<Z;++F)if(H[y+F]===c)return y+F;return-1},P=(H,P)=>{const S=Z.n.GetClipFactor(H.position,P.position,c,y);let n=q,O=q;if(f&&J){const c=H.matrixIndicesOverride?0:H.vertexIdxForBones,y=H.matrixIndicesOverride??f,Z=H.matrixWeightsOverride??J,a=P.matrixIndicesOverride?0:P.vertexIdxForBones,i=P.matrixIndicesOverride??f,C=P.matrixWeightsOverride??J;n=[0,0,0,0],O=[0,0,0,0];let g=0;for(let H=0;H<4;++H)if(Z[c+H]>0){const P=F(i,y[c+H],a,4);n[g]=y[c+H],O[g]=(0,b.s)(Z[c+H],P>=0?C[P]:0,S),g++}for(let H=0;H<4&&g<4;++H){const Z=i[a+H];-1===F(y,Z,c,4)&&(n[g]=Z,O[g]=(0,b.s)(0,C[a+H],S),g++)}const v=O[0]+O[1]+O[2]+O[3];O[0]/=v,O[1]/=v,O[2]/=v,O[3]/=v}const a=H.localPositionOverride?H.localPositionOverride[0]:(null===h||void 0===h?void 0:h[H.vertexIdx])??0,i=H.localPositionOverride?H.localPositionOverride[1]:(null===h||void 0===h?void 0:h[H.vertexIdx+1])??0,C=H.localPositionOverride?H.localPositionOverride[2]:(null===h||void 0===h?void 0:h[H.vertexIdx+2])??0,g=P.localPositionOverride?P.localPositionOverride[0]:(null===h||void 0===h?void 0:h[P.vertexIdx])??0,v=P.localPositionOverride?P.localPositionOverride[1]:(null===h||void 0===h?void 0:h[P.vertexIdx+1])??0,m=P.localPositionOverride?P.localPositionOverride[2]:(null===h||void 0===h?void 0:h[P.vertexIdx+2])??0,z=H.localNormalOverride?H.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[H.vertexIdx])??0,V=H.localNormalOverride?H.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[H.vertexIdx+1])??0,D=H.localNormalOverride?H.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[H.vertexIdx+2])??0,l=z+((P.localNormalOverride?P.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[P.vertexIdx])??0)-z)*S,d=V+((P.localNormalOverride?P.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[P.vertexIdx+1])??0)-V)*S,K=D+((P.localNormalOverride?P.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[P.vertexIdx+2])??0)-D)*S,T=Math.sqrt(l*l+d*d+K*K);return new ZH(Z.n.Lerp(H.position,P.position,S),Z.n.Lerp(H.k,P.k,S).normalize(),Z.l.Lerp(H.uv,P.uv,S),-1,-1,h?[a+(g-a)*S,i+(v-i)*S,C+(m-C)*S]:null,Q?[l/T,d/T,K/T]:null,n,O)};let S=null;H.length>3&&(S=[]);for(let n=0;n<H.length;n+=3){let F=0,O=null,a=null,i=null,C=null;const g=Z.n.Dot(H[n].position,c)-y>0,v=Z.n.Dot(H[n+1].position,c)-y>0,m=Z.n.Dot(H[n+2].position,c)-y>0;switch(F=(g?1:0)+(v?1:0)+(m?1:0),F){case 0:H.length>3?(S.push(H[n]),S.push(H[n+1]),S.push(H[n+2])):S=H;break;case 1:if(S=S??new Array,g&&(O=H[n+1],a=H[n+2],i=P(H[n],O),C=P(H[n],a)),v){O=H[n],a=H[n+2],i=P(H[n+1],O),C=P(H[n+1],a),S.push(i),S.push(a.clone()),S.push(O.clone()),S.push(a.clone()),S.push(i.clone()),S.push(C);break}m&&(O=H[n],a=H[n+1],i=P(H[n+2],O),C=P(H[n+2],a)),O&&a&&i&&C&&(S.push(O.clone()),S.push(a.clone()),S.push(i),S.push(C),S.push(i.clone()),S.push(a.clone()));break;case 2:S=S??new Array,g||(O=H[n].clone(),a=P(O,H[n+1]),i=P(O,H[n+2]),S.push(O),S.push(a),S.push(i)),v||(O=H[n+1].clone(),a=P(O,H[n+2]),i=P(O,H[n]),S.push(O),S.push(a),S.push(i)),m||(O=H[n+2].clone(),a=P(O,H[n]),i=P(O,H[n+1]),S.push(O),S.push(a),S.push(i))}}return S},j=c instanceof F.c?c:null,k=null===j||void 0===j?void 0:j._thinInstanceDataStorage.matrixData,W=(null===j||void 0===j?void 0:j.oc)||1,M=Z.h.Matrix[0];M.p(Z.d.IdentityReadOnly);for(let F=0;F<W;++F){if(null!==j&&void 0!==j&&j.hasThinInstances&&k){const H=16*F;M.setRowFromFloats(0,k[H+0],k[H+1],k[H+2],k[H+3]),M.setRowFromFloats(1,k[H+4],k[H+5],k[H+6],k[H+7]),M.setRowFromFloats(2,k[H+8],k[H+9],k[H+10],k[H+11]),M.setRowFromFloats(3,k[H+12],k[H+13],k[H+14],k[H+15])}const H=Z.d.RotationYawPitchRoll(U,p,E).multiply(Z.d.Translation(K.x,K.y,K.z)),P=Z.d.Invert(H),S=c.getWorldMatrix(),O=M.multiply(S).multiply(P),a=new Array(3);for(let c=0;c<m.length;c+=3){let H=a;if(H[0]=s(c,O),H[1]=s(c+1,O),H[2]=s(c+2,O),!(y.cullBackFaces&&-H[0].k.z<=0&&-H[1].k.z<=0&&-H[2].k.z<=0)&&(H=I(H,X),H&&(H=I(H,B),H&&(H=I(H,Y),H&&(H=I(H,HH),H&&(H=I(H,cH),H&&(H=I(H,yH),H)))))))for(let c=0;c<H.length;c++){const Z=H[c];if(t.indices.push(o),v?(Z.localPositionOverride?(t.xa[3*o]=Z.localPositionOverride[0],t.xa[3*o+1]=Z.localPositionOverride[1],t.xa[3*o+2]=Z.localPositionOverride[2]):h&&(t.xa[3*o]=h[Z.vertexIdx],t.xa[3*o+1]=h[Z.vertexIdx+1],t.xa[3*o+2]=h[Z.vertexIdx+2]),Z.localNormalOverride?(t.ya[3*o]=Z.localNormalOverride[0],t.ya[3*o+1]=Z.localNormalOverride[1],t.ya[3*o+2]=Z.localNormalOverride[2]):Q&&(t.ya[3*o]=Q[Z.vertexIdx],t.ya[3*o+1]=Q[Z.vertexIdx+1],t.ya[3*o+2]=Q[Z.vertexIdx+2])):(Z.position.toArray(t.xa,3*o),Z.k.toArray(t.ya,3*o)),t.matricesIndices&&t.matricesWeights&&(Z.matrixIndicesOverride?(t.matricesIndices[4*o]=Z.matrixIndicesOverride[0],t.matricesIndices[4*o+1]=Z.matrixIndicesOverride[1],t.matricesIndices[4*o+2]=Z.matrixIndicesOverride[2],t.matricesIndices[4*o+3]=Z.matrixIndicesOverride[3]):(f&&(t.matricesIndices[4*o]=f[Z.vertexIdxForBones],t.matricesIndices[4*o+1]=f[Z.vertexIdxForBones+1],t.matricesIndices[4*o+2]=f[Z.vertexIdxForBones+2],t.matricesIndices[4*o+3]=f[Z.vertexIdxForBones+3]),l&&t.matricesIndicesExtra&&(t.matricesIndicesExtra[4*o]=l[Z.vertexIdxForBones],t.matricesIndicesExtra[4*o+1]=l[Z.vertexIdxForBones+1],t.matricesIndicesExtra[4*o+2]=l[Z.vertexIdxForBones+2],t.matricesIndicesExtra[4*o+3]=l[Z.vertexIdxForBones+3])),Z.matrixWeightsOverride?(t.matricesWeights[4*o]=Z.matrixWeightsOverride[0],t.matricesWeights[4*o+1]=Z.matrixWeightsOverride[1],t.matricesWeights[4*o+2]=Z.matrixWeightsOverride[2],t.matricesWeights[4*o+3]=Z.matrixWeightsOverride[3]):(J&&(t.matricesWeights[4*o]=J[Z.vertexIdxForBones],t.matricesWeights[4*o+1]=J[Z.vertexIdxForBones+1],t.matricesWeights[4*o+2]=J[Z.vertexIdxForBones+2],t.matricesWeights[4*o+3]=J[Z.vertexIdxForBones+3]),d&&t.matricesWeightsExtra&&(t.matricesWeightsExtra[4*o]=d[Z.vertexIdxForBones],t.matricesWeightsExtra[4*o+1]=d[Z.vertexIdxForBones+1],t.matricesWeightsExtra[4*o+2]=d[Z.vertexIdxForBones+2],t.matricesWeightsExtra[4*o+3]=d[Z.vertexIdxForBones+3]))),y.captureUVS)Z.uv.toArray(t.Aa,2*o);else{t.Aa.push(.5+Z.position.x/u.x);const H=.5+Z.position.y/u.y;t.Aa.push(n.d?1-H:H)}o++}}}0===t.indices.length&&(t.indices=null),0===t.xa.length&&(t.xa=null),0===t.ya.length&&(t.ya=null),0===t.Aa.length&&(t.Aa=null),0===(null===(O=t.matricesIndices)||void 0===O?void 0:O.length)&&(t.matricesIndices=null),0===(null===(a=t.matricesWeights)||void 0===a?void 0:a.length)&&(t.matricesWeights=null),0===(null===(i=t.matricesIndicesExtra)||void 0===i?void 0:i.length)&&(t.matricesIndicesExtra=null),0===(null===(C=t.matricesWeightsExtra)||void 0===C?void 0:C.length)&&(t.matricesWeightsExtra=null);const x=new F.c(H,c.va());return t.Ca(x),v?(x.skeleton=c.skeleton,x.parent=c):(x.position=K.clone(),x.rotation=new Z.n(p,U,E)),x.Oj(!0),x.refreshBoundingInfo(!0,!0),x}function PH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(H.subdivisions?H.subdivisions:2,1),y=0|Math.max(H.tessellation?H.tessellation:16,3),F=Math.max(H.height?H.height:1,0),P=Math.max(H.radius?H.radius:.25,0),O=0|Math.max(H.capSubdivisions?H.capSubdivisions:6,1),a=y,i=c,C=Math.max(H.radiusTop?H.radiusTop:P,0),g=Math.max(H.radiusBottom?H.radiusBottom:P,0),v=F-(C+g),m=2*Math.PI,z=Math.max(H.topCapSubdivisions?H.topCapSubdivisions:O,1),V=Math.max(H.bottomCapSubdivisions?H.bottomCapSubdivisions:O,1),h=Math.acos((g-C)/F);let Q=[];const D=[],f=[],J=[];let l=0;const d=[],K=.5*v,T=.5*Math.PI;let u,E;const U=Z.n.Zero(),G=Z.n.Zero(),p=Math.cos(h),t=Math.sin(h),o=new Z.l(C*t,K+C*p).Rc(new Z.l(g*t,g*p-K)).length(),s=C*h+o+g*(T-h);let q=0;for(E=0;E<=z;E++){const H=[],c=T-h*(E/z);q+=C*h/z;const y=Math.cos(c),Z=Math.sin(c),F=y*C;for(u=0;u<=a;u++){const c=u/a,P=c*m+0,S=Math.sin(P),O=Math.cos(P);G.x=F*S,G.y=K+Z*C,G.z=F*O,D.push(G.x,G.y,G.z),U.set(y*S,Z,y*O),f.push(U.x,U.y,U.z),J.push(c,n.d?q/s:1-q/s),H.push(l),l++}d.push(H)}const I=F-C-g+p*C-p*g,j=t*(g-C)/I;for(E=1;E<=i;E++){const H=[];q+=o/i;const c=t*(E*(g-C)/i+C);for(u=0;u<=a;u++){const y=u/a,Z=y*m+0,F=Math.sin(Z),P=Math.cos(Z);G.x=c*F,G.y=K+p*C-E*I/i,G.z=c*P,D.push(G.x,G.y,G.z),U.set(F,j,P).normalize(),f.push(U.x,U.y,U.z),J.push(y,n.d?q/s:1-q/s),H.push(l),l++}d.push(H)}for(E=1;E<=V;E++){const H=[],c=T-h-(Math.PI-h)*(E/V);q+=g*h/V;const y=Math.cos(c),Z=Math.sin(c),F=y*g;for(u=0;u<=a;u++){const c=u/a,P=c*m+0,S=Math.sin(P),O=Math.cos(P);G.x=F*S,G.y=Z*g-K,G.z=F*O,D.push(G.x,G.y,G.z),U.set(y*S,Z,y*O),f.push(U.x,U.y,U.z),J.push(c,n.d?q/s:1-q/s),H.push(l),l++}d.push(H)}for(u=0;u<a;u++)for(E=0;E<z+i+V;E++){const H=d[E][u],c=d[E+1][u],y=d[E+1][u+1],Z=d[E][u+1];Q.push(H),Q.push(c),Q.push(Z),Q.push(c),Q.push(y),Q.push(Z)}if(Q=Q.reverse(),H.orientation&&!H.orientation.equals(Z.n.Up())){const c=new Z.d;H.orientation.clone().scale(.5*Math.PI).cross(Z.n.Up()).toQuaternion().toRotationMatrix(c);const y=Z.n.Zero();for(let H=0;H<D.length;H+=3)y.set(D[H],D[H+1],D[H+2]),Z.n.TransformCoordinatesToRef(y.clone(),c,y),D[H]=y.x,D[H+1]=y.y,D[H+2]=y.z}const k=new S.c;return k.xa=D,k.ya=f,k.Aa=J,k.indices=Q,k}function SH(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Z.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new F.c(H,y);return PH(c).Ca(P,c.updatable),P}F.c.CreateDecal=(H,c,y,Z,F,P)=>FH(H,c,{position:y,k:Z,size:F,angle:P});F.c.CreateCapsule=(H,c,y)=>SH(H,c,y),S.c.CreateCapsule=PH;class nH{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=H,this.y=c,H!==Math.floor(H)&&(H=Math.floor(H),E.d.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.d.Warn("y is not an integer, floor(y) used"))}clone(){return new nH(this.x,this.y)}rotate60About(H){const c=this.x;return this.x=H.x+H.y-this.y,this.y=c+this.y-H.x,this}rotateNeg60About(H){const c=this.x;return this.x=c+this.y-H.y,this.y=H.x+H.y-c,this}rotate120(H,c){H!==Math.floor(H)&&(H=Math.floor(H),E.d.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.d.Warn("n not an integer only floor(n) used"));const y=this.x;return this.x=H-y-this.y,this.y=c+y,this}rotateNeg120(H,c){H!==Math.floor(H)&&(H=Math.floor(H),E.d.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),E.d.Warn("n is not an integer,   floor(n) used"));const y=this.x;return this.x=this.y-c,this.y=H+c-y-this.y,this}toCartesianOrigin(H,c){const y=Z.n.Zero();return y.x=H.x+2*this.x*c+this.y*c,y.y=H.y+Math.sqrt(3)*this.y*c,y}static Zero(){return new nH(0,0)}}class OH{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new aH("icosahedron","Regular",[[0,G.i,-1],[-G.i,1,0],[-1,0,-G.i],[1,0,-G.i],[G.i,1,0],[0,G.i,1],[-1,0,G.i],[-G.i,-1,0],[0,-G.i,-1],[G.i,-1,0],[1,0,G.i],[0,-G.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let H=12;const c={},y=this.m,Z=this.n;let F,P,S,n,O,a=y,i=1,C=0;0!==Z&&(a=(0,b.l)(y,Z)),i=y/a,C=Z/a;const g=nH.Zero(),v=new nH(y,Z),m=new nH(-Z,y+Z),z=nH.Zero(),V=nH.Zero(),h=nH.Zero();let Q,D,f,J,l=[];const d=[],K=this.vertByDist,T=(y,Z,F,P)=>{Q=y+"|"+F,D=Z+"|"+P,Q in c||D in c?Q in c&&!(D in c)?c[D]=c[Q]:D in c&&!(Q in c)&&(c[Q]=c[D]):(c[Q]=H,c[D]=H,H++),K[F][0]>2?d[c[Q]]=[-K[F][0],K[F][1],c[Q]]:d[c[Q]]=[l[K[F][0]],K[F][1],c[Q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let u=0;u<20;u++){if(l=this.IDATA.face[u],S=l[2],n=l[1],O=l[0],f=g.x+"|"+g.y,Q=u+"|"+f,Q in c||(c[Q]=S,d[S]=[l[K[f][0]],K[f][1]]),f=v.x+"|"+v.y,Q=u+"|"+f,Q in c||(c[Q]=n,d[n]=[l[K[f][0]],K[f][1]]),f=m.x+"|"+m.y,Q=u+"|"+f,Q in c||(c[Q]=O,d[O]=[l[K[f][0]],K[f][1]]),F=this.IDATA.edgematch[u][0],P=this.IDATA.edgematch[u][1],"B"===P)for(let H=1;H<a;H++)V.x=y-H*(i+C),V.y=Z+H*i,h.x=-H*C,h.y=H*(i+C),f=V.x+"|"+V.y,J=h.x+"|"+h.y,T(u,F,f,J);if("O"===P)for(let H=1;H<a;H++)h.x=-H*C,h.y=H*(i+C),z.x=H*i,z.y=H*C,f=h.x+"|"+h.y,J=z.x+"|"+z.y,T(u,F,f,J);if(F=this.IDATA.edgematch[u][2],P=this.IDATA.edgematch[u][3],P&&"A"===P)for(let H=1;H<a;H++)z.x=H*i,z.y=H*C,V.x=y-(a-H)*(i+C),V.y=Z+(a-H)*i,f=z.x+"|"+z.y,J=V.x+"|"+V.y,T(u,F,f,J);for(let y=0;y<this.vertices.length;y++)f=this.vertices[y].x+"|"+this.vertices[y].y,Q=u+"|"+f,Q in c||(c[Q]=H++,K[f][0]>2?d[c[Q]]=[-K[f][0],K[f][1],c[Q]]:d[c[Q]]=[l[K[f][0]],K[f][1],c[Q]])}this.closestTo=d,this.vecToidx=c}calcCoeffs(){const H=this.m,c=this.n,y=Math.sqrt(3)/3,Z=H*H+c*c+H*c;this.coau=(H+c)/Z,this.cobu=-c/Z,this.coav=-y*(H-c)/Z,this.cobv=y*(2*H+c)/Z}createInnerFacets(){const H=this.m,c=this.n;for(let y=0;y<c+H+1;y++)for(let H=this.min[y];H<this.max[y]+1;H++)H<this.max[y]&&H<this.max[y+1]+1&&this.innerFacets.push(["|"+H+"|"+y,"|"+H+"|"+(y+1),"|"+(H+1)+"|"+y]),y>0&&H<this.max[y-1]&&H+1<this.max[y]+1&&this.innerFacets.push(["|"+H+"|"+y,"|"+(H+1)+"|"+y,"|"+(H+1)+"|"+(y-1)])}edgeVecsABOB(){const H=this.m,c=this.n,y=new nH(-c,H+c);for(let Z=1;Z<H+c;Z++){const H=new nH(this.min[Z],Z),c=new nH(this.min[Z-1],Z-1),F=new nH(this.min[Z+1],Z+1),P=H.clone(),S=c.clone(),n=F.clone();P.rotate60About(y),S.rotate60About(y),n.rotate60About(y);const O=new nH(this.max[P.y],P.y),a=new nH(this.max[P.y-1],P.y-1),i=new nH(this.max[P.y-1]-1,P.y-1);P.x===O.x&&P.y===O.y||(P.x!==a.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,a,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,i,O])):P.y===n.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,c,a]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([H,a,F])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,c,a]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,a,O])))}}mapABOBtoOBOA(){const H=new nH(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const y=[];for(let Z=0;Z<3;Z++)H.x=this.isoVecsABOB[c][Z].x,H.y=this.isoVecsABOB[c][Z].y,0===this.vertexTypes[c][Z]&&H.rotateNeg120(this.m,this.n),y.push(H.clone());this.isoVecsOBOA.push(y)}}mapABOBtoBAOA(){const H=new nH(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const y=[];for(let Z=0;Z<3;Z++)H.x=this.isoVecsABOB[c][Z].x,H.y=this.isoVecsABOB[c][Z].y,1===this.vertexTypes[c][Z]&&H.rotate120(this.m,this.n),y.push(H.clone());this.isoVecsBAOA.push(y)}}MapToFace(H,c){const y=this.IDATA.face[H],F=y[2],P=y[1],S=y[0],n=Z.n.Tg(this.IDATA.vertex[F]),O=Z.n.Tg(this.IDATA.vertex[P]),a=Z.n.Tg(this.IDATA.vertex[S]),i=O.Rc(n),C=a.Rc(n),g=i.scale(this.coau).add(C.scale(this.cobu)),v=i.scale(this.coav).add(C.scale(this.cobv)),m=[];let z,V=Z.h.o[0];for(let Z=0;Z<this.cartesian.length;Z++)V=g.scale(this.cartesian[Z].x).add(v.scale(this.cartesian[Z].y)).add(n),m[Z]=[V.x,V.y,V.z],z=H+"|"+this.vertices[Z].x+"|"+this.vertices[Z].y,c.vertex[this.vecToidx[z]]=[V.x,V.y,V.z]}build(H,c){const y=[],Z=nH.Zero(),F=new nH(H,c),P=new nH(-c,H+c);y.push(Z,F,P);for(let f=c;f<H+1;f++)for(let c=0;c<H+1-f;c++)y.push(new nH(c,f));if(c>0){const Z=(0,b.l)(H,c),F=H/Z,P=c/Z;for(let n=1;n<Z;n++)y.push(new nH(n*F,n*P)),y.push(new nH(-n*P,n*(F+P))),y.push(new nH(H-n*(F+P),c+n*F));const S=H/c;for(let n=1;n<c;n++)for(let Z=0;Z<n*S;Z++)y.push(new nH(Z,n)),y.push(new nH(Z,n).rotate120(H,c)),y.push(new nH(Z,n).rotateNeg120(H,c))}y.sort(((H,c)=>H.x-c.x)),y.sort(((H,c)=>H.y-c.y));const S=new Array(H+c+1),n=new Array(H+c+1);for(let f=0;f<S.length;f++)S[f]=1/0,n[f]=-1/0;let O=0,a=0;const i=y.length;for(let f=0;f<i;f++)a=y[f].x,O=y[f].y,S[O]=Math.min(a,S[O]),n[O]=Math.max(a,n[O]);const C=(y,Z)=>{const F=y.clone();return"A"===Z&&F.rotateNeg120(H,c),"B"===Z&&F.rotate120(H,c),F.x<0?F.y:F.x+F.y},g=[],v=[],m=[],z=[],V={},h=[];let Q=-1,D=-1;for(let f=0;f<i;f++)g[f]=y[f].toCartesianOrigin(new nH(0,0),.5),v[f]=C(y[f],"O"),m[f]=C(y[f],"A"),z[f]=C(y[f],"B"),v[f]===m[f]&&m[f]===z[f]?(Q=3,D=v[f]):v[f]===m[f]?(Q=4,D=v[f]):m[f]===z[f]?(Q=5,D=m[f]):z[f]===v[f]&&(Q=6,D=v[f]),v[f]<m[f]&&v[f]<z[f]&&(Q=2,D=v[f]),m[f]<v[f]&&m[f]<z[f]&&(Q=1,D=m[f]),z[f]<m[f]&&z[f]<v[f]&&(Q=0,D=z[f]),h.push([Q,D,y[f].x,y[f].y]);h.sort(((H,c)=>H[2]-c[2])),h.sort(((H,c)=>H[3]-c[3])),h.sort(((H,c)=>H[1]-c[1])),h.sort(((H,c)=>H[0]-c[0]));for(let f=0;f<h.length;f++)V[h[f][2]+"|"+h[f][3]]=[h[f][0],h[f][1],f];return this.m=H,this.n=c,this.vertices=y,this.vertByDist=V,this.cartesian=g,this.min=S,this.max=n,this}}class aH{constructor(H,c,y,Z){this.name=H,this.category=c,this.vertex=y,this.face=Z}}class iH extends aH{innerToData(H,c){for(let y=0;y<c.innerFacets.length;y++)this.face.push(c.innerFacets[y].map((y=>c.vecToidx[H+y])))}mapABOBtoDATA(H,c){const y=c.IDATA.edgematch[H][0];for(let Z=0;Z<c.isoVecsABOB.length;Z++){const F=[];for(let P=0;P<3;P++)0===c.vertexTypes[Z][P]?F.push(H+"|"+c.isoVecsABOB[Z][P].x+"|"+c.isoVecsABOB[Z][P].y):F.push(y+"|"+c.isoVecsABOB[Z][P].x+"|"+c.isoVecsABOB[Z][P].y);this.face.push([c.vecToidx[F[0]],c.vecToidx[F[1]],c.vecToidx[F[2]]])}}mapOBOAtoDATA(H,c){const y=c.IDATA.edgematch[H][0];for(let Z=0;Z<c.isoVecsOBOA.length;Z++){const F=[];for(let P=0;P<3;P++)1===c.vertexTypes[Z][P]?F.push(H+"|"+c.isoVecsOBOA[Z][P].x+"|"+c.isoVecsOBOA[Z][P].y):F.push(y+"|"+c.isoVecsOBOA[Z][P].x+"|"+c.isoVecsOBOA[Z][P].y);this.face.push([c.vecToidx[F[0]],c.vecToidx[F[1]],c.vecToidx[F[2]]])}}mapBAOAtoDATA(H,c){const y=c.IDATA.edgematch[H][2];for(let Z=0;Z<c.isoVecsBAOA.length;Z++){const F=[];for(let P=0;P<3;P++)1===c.vertexTypes[Z][P]?F.push(H+"|"+c.isoVecsBAOA[Z][P].x+"|"+c.isoVecsBAOA[Z][P].y):F.push(y+"|"+c.isoVecsBAOA[Z][P].x+"|"+c.isoVecsBAOA[Z][P].y);this.face.push([c.vecToidx[F[0]],c.vecToidx[F[1]],c.vecToidx[F[2]]])}}orderData(H){const c=[];for(let P=0;P<13;P++)c[P]=[];const y=H.closestTo;for(let P=0;P<y.length;P++)y[P][0]>-1?y[P][1]>0&&c[y[P][0]].push([P,y[P][1]]):c[12].push([P,y[P][0]]);const Z=[];for(let P=0;P<12;P++)Z[P]=P;let F=12;for(let P=0;P<12;P++){c[P].sort(((H,c)=>H[1]-c[1]));for(let H=0;H<c[P].length;H++)Z[c[P][H][0]]=F++}for(let P=0;P<c[12].length;P++)Z[c[12][P][0]]=F++;for(let P=0;P<this.vertex.length;P++)this.vertex[P].push(Z[P]);this.vertex.sort(((H,c)=>H[3]-c[3]));for(let P=0;P<this.vertex.length;P++)this.vertex[P].pop();for(let P=0;P<this.face.length;P++)for(let H=0;H<this.face[P].length;H++)this.face[P][H]=Z[this.face[P][H]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(H,c){const y=[],Z=[];let F=c.pop();Z.push(F);let P=this.face[F].indexOf(H);P=(P+2)%3;let S=this.face[F][P];y.push(S);let n=0;for(;c.length>0;)F=c[n],this.face[F].indexOf(S)>-1?(P=(this.face[F].indexOf(S)+1)%3,S=this.face[F][P],y.push(S),Z.push(F),c.splice(n,1),n=0):n++;return this.adjacentFaces.push(y),Z}toGoldbergPolyhedronData(){const H=new aH("GeoDual","Goldberg",[],[]);H.name="GD dual";const c=this.vertex.length,y=new Array(c);for(let O=0;O<c;O++)y[O]=[];for(let O=0;O<this.face.length;O++)for(let H=0;H<3;H++)y[this.face[O][H]].push(O);let Z=0,F=0,P=0,S=[],n=[];this.adjacentFaces=[];for(let O=0;O<y.length;O++)H.face[O]=this.setOrder(O,y[O].concat([])),y[O].forEach((c=>{Z=0,F=0,P=0,S=this.face[c];for(let H=0;H<3;H++)n=this.vertex[S[H]],Z+=n[0],F+=n[1],P+=n[2];H.vertex[c]=[Z/3,F/3,P/3]}));return H}static BuildGeodesicData(H){const c=new iH("Geodesic-m-n","Geodesic",[[0,G.i,-1],[-G.i,1,0],[-1,0,-G.i],[1,0,-G.i],[G.i,1,0],[0,G.i,1],[-1,0,G.i],[-G.i,-1,0],[0,-G.i,-1],[G.i,-1,0],[1,0,G.i],[0,-G.i,1]],[]);H.setIndices(),H.calcCoeffs(),H.createInnerFacets(),H.edgeVecsABOB(),H.mapABOBtoOBOA(),H.mapABOBtoBAOA();for(let y=0;y<H.IDATA.face.length;y++)H.MapToFace(y,c),c.innerToData(y,H),"B"===H.IDATA.edgematch[y][1]&&c.mapABOBtoDATA(y,H),"O"===H.IDATA.edgematch[y][1]&&c.mapOBOAtoDATA(y,H),"A"===H.IDATA.edgematch[y][3]&&c.mapBAOAtoDATA(y,H);c.orderData(H);return c.vertex=c.vertex.map((function(H){const c=H[0],y=H[1],Z=H[2],F=Math.sqrt(c*c+y*y+Z*Z);return H[0]*=1/F,H[1]*=1/F,H[2]*=1/F,H})),c}}F.c._GoldbergMeshParser=(H,c)=>CH.Parse(H,c);class CH extends F.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(H,c){return void 0===c?(H>this.goldbergData.nbUnsharedFaces-1&&(E.d.Warn("Maximum number of unshared faces used"),H=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+H):(H>11&&(E.d.Warn("Last pole used"),H=11),c>this.goldbergData.nbFacesAtPole-1&&(E.d.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+H*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(H){for(let y=0;y<H.length;y++){const c=H[y][0],Z=H[y][1],F=H[y][2];for(let H=c;H<Z+1;H++)this.goldbergData.faceColors[H]=F}const c=[];for(let y=0;y<12;y++)for(let H=0;H<5;H++)c.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);for(let y=12;y<this.goldbergData.faceColors.length;y++)for(let H=0;H<6;H++)c.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);return c}setGoldbergFaceColors(H){const c=this._changeGoldbergFaceColors(H);this.Ga(P.h.ColorKind,c)}updateGoldbergFaceColors(H){const c=this._changeGoldbergFaceColors(H);this.updateVerticesData(P.h.ColorKind,c)}_changeGoldbergFaceUVs(H){const c=this.getVerticesData(P.h.UVKind);for(let y=0;y<H.length;y++){const Z=H[y][0],F=H[y][1],P=H[y][2],S=H[y][3],n=H[y][4],O=[],a=[];let i,C;for(let H=0;H<5;H++)i=P.x+S*Math.cos(n+H*Math.PI/2.5),C=P.y+S*Math.sin(n+H*Math.PI/2.5),i<0&&(i=0),i>1&&(i=1),O.push(i,C);for(let H=0;H<6;H++)i=P.x+S*Math.cos(n+H*Math.PI/3),C=P.y+S*Math.sin(n+H*Math.PI/3),i<0&&(i=0),i>1&&(i=1),a.push(i,C);for(let H=Z;H<Math.min(12,F+1);H++)for(let y=0;y<5;y++)c[10*H+2*y]=O[2*y],c[10*H+2*y+1]=O[2*y+1];for(let H=Math.max(12,Z);H<F+1;H++)for(let y=0;y<6;y++)c[12*H-24+2*y]=a[2*y],c[12*H-23+2*y]=a[2*y+1]}return c}setGoldbergFaceUVs(H){const c=this._changeGoldbergFaceUVs(H);this.Ga(P.h.UVKind,c)}updateGoldbergFaceUVs(H){const c=this._changeGoldbergFaceUVs(H);this.updateVerticesData(P.h.UVKind,c)}placeOnGoldbergFaceAt(H,c,y){const F=Z.n.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);H.rotation=F,H.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(y.x)).add(this.goldbergData.faceYaxis[c].scale(y.y)).add(this.goldbergData.faceZaxis[c].scale(y.z))}serialize(H){super.serialize(H),H.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const H of this.goldbergData.faceColors)c.faceColors.push(H.ij())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const H of this.goldbergData.faceCenters)c.faceCenters.push(H.ij())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const H of this.goldbergData.faceZaxis)c.faceZaxis.push(H.ij())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const H of this.goldbergData.faceYaxis)c.faceYaxis.push(H.ij())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const H of this.goldbergData.faceXaxis)c.faceXaxis.push(H.ij())}H.goldbergData=c}static Parse(H,c){const y=H.goldbergData;y.faceColors=y.faceColors.map((H=>g.h.Tg(H))),y.faceCenters=y.faceCenters.map((H=>Z.n.Tg(H))),y.faceZaxis=y.faceZaxis.map((H=>Z.n.Tg(H))),y.faceXaxis=y.faceXaxis.map((H=>Z.n.Tg(H))),y.faceYaxis=y.faceYaxis.map((H=>Z.n.Tg(H)));const F=new CH(H.name,c);return F.goldbergData=y,F}}var gH=y(11403);class vH{constructor(H){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=H}moveTo(H,c){this._currentPath=new U.f(H,c),this._tempPaths.push(this._currentPath)}lineTo(H,c){this._currentPath.addLineTo(H,c)}quadraticCurveTo(H,c,y,Z){this._currentPath.addQuadraticCurveTo(H,c,y,Z,this._resolution)}bezierCurveTo(H,c,y,Z,F,P){this._currentPath.addBezierCurveTo(H,c,y,Z,F,P,this._resolution)}extractHoles(){for(const H of this._tempPaths)H.area()>0?this._holes.push(H):this._paths.push(H);if(!this._paths.length&&this._holes.length){const H=this._holes;this._holes=this._paths,this._paths=H}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function mH(H,c,y,Z,F,P){const S=P.glyphs[H]||P.glyphs["?"];if(!S)return null;const n=new vH(F);if(S.o){const H=S.o.split(" ");for(let F=0,P=H.length;F<P;){switch(H[F++]){case"m":{const P=parseInt(H[F++])*c+y,S=parseInt(H[F++])*c+Z;n.moveTo(P,S);break}case"l":{const P=parseInt(H[F++])*c+y,S=parseInt(H[F++])*c+Z;n.lineTo(P,S);break}case"q":{const P=parseInt(H[F++])*c+y,S=parseInt(H[F++])*c+Z,O=parseInt(H[F++])*c+y,a=parseInt(H[F++])*c+Z;n.quadraticCurveTo(O,a,P,S);break}case"b":{const P=parseInt(H[F++])*c+y,S=parseInt(H[F++])*c+Z,O=parseInt(H[F++])*c+y,a=parseInt(H[F++])*c+Z,i=parseInt(H[F++])*c+y,C=parseInt(H[F++])*c+Z;n.bezierCurveTo(O,a,i,C,P,S);break}}}}return n.extractHoles(),{offsetX:S.ha*c,shapePath:n}}const zH={CreateBox:C.b,CreateTiledBox:V,CreateSphere:h.d,CreateDisc:i.b,CreateIcoSphere:L,CreateRibbon:a,CreateCylinder:J,CreateTorus:d,CreateTorusKnot:T,CreateLineSystem:u.e,pb:u.g,CreateDashedLines:u.c,ExtrudeShape:k,ExtrudeShapeCustom:W,CreateLathe:x,CreateTiledPlane:m,cg:R.b,CreateGround:A.f,CreateTiledGround:A.h,CreateGroundFromHeightMap:A.c,CreatePolygon:I,ExtrudePolygon:j,CreateTube:e,CreatePolyhedron:N,CreateGeodesic:function(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=c.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),E.d.Warn("m not an integer only floor(m) used"));let F=c.n||0;if(F!==Math.floor(F)&&(F=Math.floor(F),E.d.Warn("n not an integer only floor(n) used")),F>Z){const H=F;F=Z,Z=H,E.d.Warn("n > m therefore m and n swapped")}const P=new OH;return P.build(Z,F),N(H,{custom:iH.BuildGeodesicData(P),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},y)},CreateGoldberg:function(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=c.size,O=c.sizeX||P||1,a=c.sizeY||P||1,i=c.sizeZ||P||1;let C=c.m||1;C!==Math.floor(C)&&(C=Math.floor(C),E.d.Warn("m not an integer only floor(m) used"));let v=c.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),E.d.Warn("n not an integer only floor(n) used")),v>C){const H=v;v=C,C=H,E.d.Warn("n > m therefore m and n swapped")}const m=new OH;m.build(C,v);const z=iH.BuildGeodesicData(m),V=z.toGoldbergPolyhedronData(),h=new CH(H,y);c.sideOrientation=F.c._GetDefaultSideOrientation(c.sideOrientation),h._originalBuilderSideOrientation=c.sideOrientation;(function(H,c){const y=H.size,F=H.sizeX||y||1,P=H.sizeY||y||1,O=H.sizeZ||y||1,a=0===H.sideOrientation?0:H.sideOrientation||S.c.DEFAULTSIDE,i=[],C=[],g=[],v=[];let m=1/0,z=-1/0,V=1/0,h=-1/0;for(let Z=0;Z<c.vertex.length;Z++)m=Math.min(m,c.vertex[Z][0]*F),z=Math.max(z,c.vertex[Z][0]*F),V=Math.min(V,c.vertex[Z][1]*P),h=Math.max(h,c.vertex[Z][1]*P);let Q=0;for(let S=0;S<c.face.length;S++){const H=c.face[S],y=Z.n.Tg(c.vertex[H[0]]),a=Z.n.Tg(c.vertex[H[2]]),D=Z.n.Tg(c.vertex[H[1]]),f=a.Rc(y),J=D.Rc(y),l=Z.n.Cross(J,f).normalize();for(let Z=0;Z<H.length;Z++){g.push(l.x,l.y,l.z);const y=c.vertex[H[Z]];i.push(y[0]*F,y[1]*P,y[2]*O);const S=(y[1]*P-V)/(h-V);v.push((y[0]*F-m)/(z-m),n.d?1-S:S)}for(let c=0;c<H.length-2;c++)C.push(Q,Q+c+2,Q+c+1);Q+=H.length}S.c._ComputeSides(a,i,C,g,v);const D=new S.c;return D.xa=i,D.indices=C,D.ya=g,D.Aa=v,D})(c,V).Ca(h,c.updatable),h.goldbergData.nbSharedFaces=z.sharedNodes,h.goldbergData.nbUnsharedFaces=z.poleNodes,h.goldbergData.adjacentFaces=z.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let F=0;F<z.vertex.length;F++)h.goldbergData.faceCenters.push(Z.n.Tg(z.vertex[F])),h.goldbergData.faceCenters[F].x*=O,h.goldbergData.faceCenters[F].y*=a,h.goldbergData.faceCenters[F].z*=i,h.goldbergData.faceColors.push(new g.h(1,1,1,1));for(let F=0;F<V.face.length;F++){const H=V.face[F],c=Z.n.Tg(V.vertex[H[0]]),y=Z.n.Tg(V.vertex[H[2]]),P=Z.n.Tg(V.vertex[H[1]]),S=y.Rc(c),n=P.Rc(c),O=Z.n.Cross(n,S).normalize(),a=Z.n.Cross(n,O).normalize();h.goldbergData.faceXaxis.push(n.normalize()),h.goldbergData.faceYaxis.push(O),h.goldbergData.faceZaxis.push(a)}return h},CreateDecal:FH,CreateCapsule:SH,CreateText:function(H,c,y){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const O=function(H,c,y,Z){const F=Array.from(H),P=c/Z.resolution,S=(Z.boundingBox.yMax-Z.boundingBox.yMin+Z.underlineThickness)*P,n=[];let O=0,a=0;for(let i=0;i<F.length;i++){const H=F[i];if("\n"===H)O=0,a-=S;else{const c=mH(H,P,O,a,y,Z);c&&(O+=c.offsetX,n.push(c.shapePath))}}return n}(c,P.size||50,P.resolution||8,y),a=[];let i=0;for(const m of O){if(!m.paths.length)continue;const c=m.holes.slice();for(const y of m.paths){var C,g;const O=[],v=[],m=y.getPoints();for(const H of m)v.push(new Z.n(H.x,0,H.y));const z=c.slice();for(const H of z){const F=H.getPoints();let P=!1;for(const H of F)if(y.isPointInside(H)){P=!0;break}if(!P)continue;const S=[];for(const H of F)S.push(new Z.n(H.x,0,H.y));O.push(S),c.splice(c.indexOf(H),1)}if(!O.length&&c.length)for(const H of c){const c=H.getPoints(),y=[];for(const H of c)y.push(new Z.n(H.x,0,H.y));O.push(y)}const V=j(H,{shape:v,holes:O.length?O:void 0,depth:P.depth||1,faceUV:P.faceUV||(null===(C=P.perLetterFaceUV)||void 0===C?void 0:C.call(P,i)),faceColors:P.faceColors||(null===(g=P.perLetterFaceColors)||void 0===g?void 0:g.call(P,i)),sideOrientation:F.c._GetDefaultSideOrientation(P.sideOrientation||F.c.DOUBLESIDE)},S,n);a.push(V),i++}}const v=F.c.MergeMeshes(a,!0,!0);if(v){const c=v.getBoundingInfo().boundingBox;v.position.x+=-(c.minimumWorld.x+c.maximumWorld.x)/2,v.position.y+=-(c.minimumWorld.y+c.maximumWorld.y)/2,v.position.z+=-(c.minimumWorld.z+c.maximumWorld.z)/2+c.extendSize.z,v.name=H;const y=new gH.c("pivot",S);y.rotation.x=-Math.PI/2,v.parent=y,v.bakeCurrentTransformIntoVertices(),v.parent=null,y.dispose()}return v}}},11245:(H,c,y)=>{"use strict";y.d(c,{b:()=>O});var Z=y(11153),F=y(11250),P=y(11256),S=y(11275),n=y(11277);class O{get materialDefines(){var H;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(H=this._getDrawWrapper())||void 0===H?void 0:H.defines}set materialDefines(H){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=H}_getDrawWrapper(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H=H??this._engine.currentRenderPassId;let y=this._drawWrappers[H];return!y&&c&&(this._drawWrappers[H]=y=new n.b(this._mesh.va().getEngine())),y}_removeDrawWrapper(H){var c;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(c=this._drawWrappers[H])||void 0===c||c.dispose());this._drawWrappers[H]=void 0}get effect(){var H;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(H=this._getDrawWrapper())||void 0===H?void 0:H.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(H){this._mainDrawWrapperOverride=H}setEffect(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=this._drawWrapper;F.setEffect(H,c,Z),void 0!==y&&(F.materialContext=y),H||(F.defines=null,F.materialContext=void 0)}resetDrawCache(H){if(this._drawWrappers){if(void 0!==H)return void this._removeDrawWrapper(H);for(const H of this._drawWrappers)null===H||void 0===H||H.dispose()}this._drawWrappers=[]}static AddToMesh(H,c,y,Z,F,P,S){return new O(H,c,y,Z,F,P,S,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(H,c,y,Z,F,P,S){let n=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],O=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=H,this.verticesStart=c,this.verticesCount=y,this.indexStart=Z,this.indexCount=F,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=P,this._renderingMesh=S||P,O&&P.$f.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=P.$f.length-1,n&&(this.refreshBoundingInfo(),P.Oj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(H){return this._boundingInfo=H,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const H=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return H||this._renderingMesh}Ha(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!c)return H?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(c)){const H=c.getSubMaterial(this.materialIndex);return this._currentMaterial!==H&&(this._currentMaterial=H,this.resetDrawCache()),H}return c}_isMultiMaterial(H){return void 0!==H.getSubMaterial}refreshBoundingInfo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Dj)return this;if(H||(H=this._renderingMesh.getVerticesData(Z.h.PositionKind)),!H)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const c=this._renderingMesh.Vf();let y;if(0===this.indexStart&&this.indexCount===c.length){const H=this._renderingMesh.getBoundingInfo();y={minimum:H.minimum.clone(),maximum:H.maximum.clone()}}else y=(0,S.c)(H,c,this.indexStart,this.indexCount,this._renderingMesh.Dj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new P.b(y.minimum,y.maximum),this}_checkCollision(H){return this.getBoundingInfo()._checkCollision(H)}updateBoundingInfo(H){let c=this.getBoundingInfo();return c||(this.refreshBoundingInfo(),c=this.getBoundingInfo()),c&&c.update(H),this}isInFrustum(H){const c=this.getBoundingInfo();return!!c&&c.isInFrustum(H,this._mesh.Di)}isCompletelyInFrustum(H){const c=this.getBoundingInfo();return!!c&&c.isCompletelyInFrustum(H)}render(H){return this._renderingMesh.render(this,H,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(H,c){if(!this._linesIndexBuffer){const y=[];for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)y.push(H[c],H[c+1],H[c+1],H[c+2],H[c+2],H[c]);this._linesIndexBuffer=c.createIndexBuffer(y),this._linesIndexCount=y.length}return this._linesIndexBuffer}canIntersects(H){const c=this.getBoundingInfo();return!!c&&H.intersectsBox(c.boundingBox)}intersects(H,c,y,Z,F){const P=this.Ha();if(!P)return null;let S=3,n=!1;switch(P.fillMode){case 3:case 5:case 6:case 8:return null;case 7:S=1,n=!0}return 4===P.fillMode?y.length?this._intersectLines(H,c,y,this._mesh.intersectionThreshold,Z):this._intersectUnIndexedLines(H,c,y,this._mesh.intersectionThreshold,Z):!y.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(H,c,y,Z,F):this._intersectTriangles(H,c,y,S,n,Z,F)}_intersectLines(H,c,y,Z,P){let S=null;for(let n=this.indexStart;n<this.indexStart+this.indexCount;n+=2){const O=c[y[n]],a=c[y[n+1]],i=H.intersectionSegment(O,a,Z);if(!(i<0)&&((P||!S||i<S.distance)&&(S=new F.c(null,null,i),S.faceId=n/2,P)))break}return S}_intersectUnIndexedLines(H,c,y,Z,P){let S=null;for(let n=this.verticesStart;n<this.verticesStart+this.verticesCount;n+=2){const y=c[n],O=c[n+1],a=H.intersectionSegment(y,O,Z);if(!(a<0)&&((P||!S||a<S.distance)&&(S=new F.c(null,null,a),S.faceId=n/2,P)))break}return S}_intersectTriangles(H,c,y,Z,F,P,S){let n=null,O=-1;for(let a=this.indexStart;a<this.indexStart+this.indexCount-(3-Z);a+=Z){O++;const Z=y[a],i=y[a+1],C=y[a+2];if(F&&4294967295===C){a+=2;continue}const g=c[Z],v=c[i],m=c[C];if(!g||!v||!m)continue;if(S&&!S(g,v,m,H,Z,i,C))continue;const z=H.intersectsTriangle(g,v,m);if(z){if(z.distance<0)continue;if((P||!n||z.distance<n.distance)&&(n=z,n.faceId=O,P))break}}return n}_intersectUnIndexedTriangles(H,c,y,Z,F){let P=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=3){const y=c[S],n=c[S+1],O=c[S+2];if(F&&!F(y,n,O,H,-1,-1,-1))continue;const a=H.intersectsTriangle(y,n,O);if(a){if(a.distance<0)continue;if((Z||!P||a.distance<P.distance)&&(P=a,P.faceId=S/3,Z))break}}return P}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(H,c){const y=new O(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,H,c,!1);if(!this.IsGlobal){const H=this.getBoundingInfo();if(!H)return y;y._boundingInfo=new P.b(H.minimum,H.maximum)}return y}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const H=this._mesh.$f.indexOf(this);this._mesh.$f.splice(H,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(H,c,y,Z,F){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=Number.MAX_VALUE,n=-Number.MAX_VALUE;const a=(F||Z).Vf();for(let O=c;O<c+y;O++){const H=a[O];H<S&&(S=H),H>n&&(n=H)}return new O(H,S,n-S+1,c,y,Z,F,P)}}},12358:(H,c,y)=>{"use strict";var Z=y(11354),F=y(11153),P=y(11092),S=y(10773),n=y(11256);Z.c.prototype.thinInstanceAdd=function(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return S.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(H)?H.length:1);const y=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(H))for(let Z=0;Z<H.length;++Z)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,H[Z],Z===H.length-1&&c);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,H,c);return y},Z.c.prototype.thinInstanceAddSelf=function(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(P.d.IdentityReadOnly,H)},Z.c.prototype.thinInstanceRegisterAttribute=function(H,c){H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),this.removeVerticesData(H),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[H]=c,this._userThinInstanceBuffersStorage.sizes[H]=c*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[H]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[H]),this._userThinInstanceBuffersStorage.vertexBuffers[H]=new F.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[H],H,!0,!1,c,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[H])},Z.c.prototype.thinInstanceSetMatrixAt=function(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||H>=this._thinInstanceDataStorage.instancesCount)return!1;const Z=this._thinInstanceDataStorage.matrixData;return c.copyToArray(Z,16*H),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[H]=c),y&&(this.vc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},Z.c.prototype.thinInstanceSetAttributeAt=function(H,c,y){let Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[H]||c>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(H,0),this._userThinInstanceBuffersStorage.data[H].set(y,c*this._userThinInstanceBuffersStorage.strides[H]),Z&&this.vc(H),!0)},Object.defineProperty(Z.c.prototype,"oc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(H){var c;const y=this._thinInstanceDataStorage.matrixData??(null===(c=this.source)||void 0===c?void 0:c._thinInstanceDataStorage.matrixData);H<=(y?y.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=H)},enumerable:!0,configurable:!0}),Z.c.prototype._thinInstanceCreateMatrixBuffer=function(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Z=new F.d(this.getEngine(),c,!y,16,!1,!0);for(let F=0;F<4;F++)this.setVerticesBuffer(Z.createVertexBuffer(H+F,4*F,4));return Z},Z.c.prototype.Wb=function(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var P;if(y=y||16,"matrix"===H)null===(P=this._thinInstanceDataStorage.matrixBuffer)||void 0===P||P.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=c?c.length:32*y,this._thinInstanceDataStorage.matrixData=c,this._thinInstanceDataStorage.worldMatrices=null,null!==c?(this._thinInstanceDataStorage.instancesCount=c.length/y,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",c,Z),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===H){var S;null===(S=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=c,null!==c&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",c,Z))}else{var n;if(H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),null===c)null!==(n=this._userThinInstanceBuffersStorage)&&void 0!==n&&n.data[H]&&(this.removeVerticesData(H),delete this._userThinInstanceBuffersStorage.data[H],delete this._userThinInstanceBuffersStorage.strides[H],delete this._userThinInstanceBuffersStorage.sizes[H],delete this._userThinInstanceBuffersStorage.vertexBuffers[H]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[H]=c,this._userThinInstanceBuffersStorage.strides[H]=y,this._userThinInstanceBuffersStorage.sizes[H]=c.length,this._userThinInstanceBuffersStorage.vertexBuffers[H]=new F.h(this.getEngine(),c,H,!Z,!1,y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[H])}},Z.c.prototype.vc=function(H){var c;if("matrix"===H)this.Mj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(H),null===(c=this._thinInstanceDataStorage.matrixBuffer)||void 0===c||c.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===H){var y;this.Mj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(H),null===(y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===y||y.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var Z;H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),null!==(Z=this._userThinInstanceBuffersStorage)&&void 0!==Z&&Z.vertexBuffers[H]&&(this.Mj&&!this._userThinInstanceBuffersStorage.vertexBuffers[H].isUpdatable()&&this._thinInstanceRecreateBuffer(H),this._userThinInstanceBuffersStorage.vertexBuffers[H].updateDirectly(this._userThinInstanceBuffersStorage.data[H],0))}},Z.c.prototype.thinInstancePartialBufferUpdate=function(H,c,y){var Z;"matrix"===H?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(c,y):(H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),null!==(Z=this._userThinInstanceBuffersStorage)&&void 0!==Z&&Z.vertexBuffers[H]&&this._userThinInstanceBuffersStorage.vertexBuffers[H].updateDirectly(c,y))},Z.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const H=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let c=0;c<this._thinInstanceDataStorage.instancesCount;++c)this._thinInstanceDataStorage.worldMatrices[c]=P.d.Tg(H,16*c)}return this._thinInstanceDataStorage.worldMatrices},Z.c.prototype.thinInstanceRefreshBoundingInfo=function(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const Z=this._thinInstanceDataStorage.boundingVectors;if(H||!this.rawBoundingInfo){Z.length=0,this.refreshBoundingInfo(c,y);const H=this.getBoundingInfo();this.rawBoundingInfo=new n.b(H.minimum,H.maximum)}const F=this.getBoundingInfo(),S=this._thinInstanceDataStorage.matrixData;if(0===Z.length)for(let P=0;P<F.boundingBox.vectors.length;++P)Z.push(F.boundingBox.vectors[P].clone());P.h.o[0].ae(Number.POSITIVE_INFINITY),P.h.o[1].ae(Number.NEGATIVE_INFINITY);for(let n=0;n<this._thinInstanceDataStorage.instancesCount;++n){P.d.FromArrayToRef(S,16*n,P.h.Matrix[0]);for(let H=0;H<Z.length;++H)P.n.TransformCoordinatesToRef(Z[H],P.h.Matrix[0],P.h.o[2]),P.h.o[0].minimizeInPlace(P.h.o[2]),P.h.o[1].maximizeInPlace(P.h.o[2])}F.reConstruct(P.h.o[0],P.h.o[1]),this.Ea()},Z.c.prototype._thinInstanceRecreateBuffer=function(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var y;if("matrix"===H)null===(y=this._thinInstanceDataStorage.matrixBuffer)||void 0===y||y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,c);else if("previousMatrix"===H){var Z;if(this._scene.needsPreviousWorldMatrices)null===(Z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,c)}else{var P;H===F.h.ColorKind&&(H=F.h.ColorInstanceKind),null===(P=this._userThinInstanceBuffersStorage.vertexBuffers[H])||void 0===P||P.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[H]=new F.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[H],H,!c,!1,this._userThinInstanceBuffersStorage.strides[H],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[H])}},Z.c.prototype._thinInstanceUpdateBufferSize=function(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;H===F.h.ColorKind&&(H=F.h.ColorInstanceKind);const y="matrix"===H;if(!y&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[H]))return;const Z=y?16:this._userThinInstanceBuffersStorage.strides[H],P=y?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[H];let S=y?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[H];const n=(this._thinInstanceDataStorage.instancesCount+c)*Z;let O=P;for(;O<n;)O*=2;if(!S||P!=O){if(S){const H=new Float32Array(O);H.set(S,0),S=H}else S=new Float32Array(O);var a,i,C;if(y){if(null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",S,!1),this._thinInstanceDataStorage.matrixData=S,this._thinInstanceDataStorage.matrixBufferSize=O,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(i=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===i||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",S,!1)}else null===(C=this._userThinInstanceBuffersStorage.vertexBuffers[H])||void 0===C||C.dispose(),this._userThinInstanceBuffersStorage.data[H]=S,this._userThinInstanceBuffersStorage.sizes[H]=O,this._userThinInstanceBuffersStorage.vertexBuffers[H]=new F.h(this.getEngine(),S,H,!0,!1,Z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[H])}},Z.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Z.c.prototype._disposeThinInstanceSpecificData=function(){var H;null!==(H=this._thinInstanceDataStorage)&&void 0!==H&&H.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11403:(H,c,y)=>{"use strict";y.d(c,{c:()=>C});var Z=y(11052),F=y(11061),P=y(11118),S=y(10763),n=y(11092),O=y(11364),a=y(10893);const i=n.d.Compose(n.n.One(),n.f.FromEulerAngles(0,Math.PI,0),n.n.Zero());class C extends O.d{get billboardMode(){return this._billboardMode}set billboardMode(H){this._billboardMode!==H&&(this._billboardMode=H,this._cache.useBillboardPosition=0!==(this._billboardMode&C.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(H){H!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=H,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==C.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(H){this._infiniteDistance!==H&&(this._infiniteDistance=H)}constructor(H){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new n.n(0,0,1),this._up=new n.n(0,1,0),this._right=new n.n(1,0,0),this._position=n.n.Zero(),this._rotation=n.n.Zero(),this._rotationQuaternion=null,this._scaling=n.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=C.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Qj=n.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=n.n.Zero(),this._absoluteScaling=n.n.Zero(),this._absoluteRotationQuaternion=n.f.Identity(),this._pivotMatrix=n.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new S.e,this._nonUniformScaling=!1,c&&this.va().addTransformNode(this)}getClassName(){return"qb"}get position(){return this._position}set position(H){this._position=H,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(H){this._rotation=H,this._rotationQuaternion=null,this._markAsDirtyInternal()}get de(){return this._scaling}set de(H){this._scaling=H,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(H){this._rotationQuaternion=H,H&&this._rotation.ae(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return n.n.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return n.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return n.n.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(H){return this._poseMatrix?(this._poseMatrix.p(H),this):(this._poseMatrix=H.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=n.d.Identity()),this._poseMatrix}_isSynchronized(){const H=this._cache;return this._billboardMode===H.billboardMode&&this._billboardMode===C.BILLBOARDMODE_NONE&&(!H.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const H=this._cache;H.localMatrixUpdated=!1,H.billboardMode=-1,H.infiniteDistance=!1,H.useBillboardPosition=!1,H.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(H){return this.setPivotMatrix(H,!1)}setPivotMatrix(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(H),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=c,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=n.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const Z=this.clone("Clone of "+(this.name||this.id),H||this.parent,!0);Z&&y&&y(this,Z);for(const F of this.getChildTransformNodes(!0))F.instantiateHierarchy(Z,c,y);return Z}Kc(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return H?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.ae(0),this._rotationQuaternion=this._rotationQuaternion||n.f.Identity(),H.decompose(this._scaling,this._rotationQuaternion,this._position),this.Oj(!0)):(this._worldMatrix=H,this._absolutePosition.be(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Oj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Oj(!0),this}get pj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Oj(),this._absolutePosition}setAbsolutePosition(H){if(!H)return this;let c,y,Z;if(void 0===H.x){if(arguments.length<3)return this;c=arguments[0],y=arguments[1],Z=arguments[2]}else c=H.x,y=H.y,Z=H.z;if(this.parent){const H=n.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(H),n.n.TransformCoordinatesFromFloatsToRef(c,y,Z,H,this.position)}else this.position.x=c,this.position.y=y,this.position.z=Z;return this._absolutePosition.p(H),this}setPositionWithLocalVector(H){return this.Oj(),this.position=n.n.TransformNormal(H,this.Qj),this}getPositionExpressedInLocalSpace(){this.Oj();const H=n.h.Matrix[0];return this.Qj.invertToRef(H),n.n.TransformNormal(this.position,H)}locallyTranslate(H){return this.Oj(!0),this.position=n.n.TransformCoordinates(H,this.Qj),this}lookAt(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const P=C._LookAtVectorCache,S=0===F?this.position:this.getAbsolutePosition();if(H.subtractToRef(S,P),this.setDirection(P,c,y,Z),1===F&&this.parent)if(this.rotationQuaternion){const H=n.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(H);const c=n.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),H.multiplyToRef(c,H),this.rotationQuaternion.fromRotationMatrix(H)}else{const H=n.h.Quaternion[0];n.f.FromEulerVectorToRef(this.rotation,H);const c=n.h.Matrix[0];H.toRotationMatrix(c);const y=n.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.invert(),c.multiplyToRef(y,c),H.fromRotationMatrix(c),H.toEulerAnglesToRef(this.rotation)}return this}Se(H){const c=n.n.Zero();return this.getDirectionToRef(H,c),c}getDirectionToRef(H,c){return n.n.TransformNormalToRef(H,this.getWorldMatrix(),c),this}setDirection(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const F=-Math.atan2(H.z,H.x)+Math.PI/2,P=Math.sqrt(H.x*H.x+H.z*H.z),S=-Math.atan2(H.y,P);return this.rotationQuaternion?n.f.RotationYawPitchRollToRef(F+c,S+y,Z,this.rotationQuaternion):(this.rotation.x=S+y,this.rotation.y=F+c,this.rotation.z=Z),this}setPivotPoint(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Oj(!0);const y=this.getWorldMatrix();if(1==c){const c=n.h.Matrix[0];y.invertToRef(c),H=n.n.TransformCoordinates(H,c)}return this.setPivotMatrix(n.d.Translation(-H.x,-H.y,-H.z),!0)}getPivotPoint(){const H=n.n.Zero();return this.getPivotPointToRef(H),H}getPivotPointToRef(H){return H.x=-this._pivotMatrix.m[12],H.y=-this._pivotMatrix.m[13],H.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const H=n.n.Zero();return this.getAbsolutePivotPointToRef(H),H}getAbsolutePivotPointToRef(H){return this.getPivotPointToRef(H),n.n.TransformCoordinatesToRef(H,this.getWorldMatrix(),H),this}Fg(H){if(this._isDirty)return this;if(this._children)for(const c of this._children)c.Fg(H);return super.Fg(H)}setParent(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!H&&!this.parent)return this;const Z=n.h.Quaternion[0],F=n.h.o[0],P=n.h.o[1],S=n.h.Matrix[1];n.d.IdentityToRef(S);const O=n.h.Matrix[0];this.Oj(!0);let a=this.rotationQuaternion;return a||(a=C._TmpRotation,n.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a)),n.d.ComposeToRef(this.de,a,this.position,O),this.parent&&O.multiplyToRef(this.parent.Oj(!0),O),H&&(H.Oj(!0).invertToRef(S),O.multiplyToRef(S,O)),O.decompose(P,Z,F,c?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(Z):Z.toEulerAnglesToRef(this.rotation),this.de.p(P),this.position.p(F),this.parent=H,y&&this.setPivotMatrix(n.d.Identity()),this}addChild(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return H.setParent(this,c),this}removeChild(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return H.setParent(null,c),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(H){return this._nonUniformScaling!==H&&(this._nonUniformScaling=H,!0)}attachToBone(H,c){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=c,this.parent=H,H.getSkeleton().prepare(!0),H.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=H?this._currentParentWhenAttachingToBone:null,this):(H&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(H,c,y){let Z;if(H.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.ae(0)),y&&0!==y){if(this.parent){const y=this.parent.getWorldMatrix(),Z=n.h.Matrix[0];y.invertToRef(Z),H=n.n.TransformNormal(H,Z),y.determinant()<0&&(c*=-1)}Z=n.f.RotationAxisToRef(H,c,C._RotationAxisCache),Z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else Z=n.f.RotationAxisToRef(H,c,C._RotationAxisCache),this.rotationQuaternion.multiplyToRef(Z,this.rotationQuaternion);return this}rotateAround(H,c,y){c.normalize(),this.rotationQuaternion||(this.rotationQuaternion=n.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.ae(0));const Z=n.h.o[0],F=n.h.o[1],P=n.h.o[2],S=n.h.Quaternion[0],O=n.h.Matrix[0],a=n.h.Matrix[1],i=n.h.Matrix[2],C=n.h.Matrix[3];return H.subtractToRef(this.position,Z),n.d.TranslationToRef(Z.x,Z.y,Z.z,O),n.d.TranslationToRef(-Z.x,-Z.y,-Z.z,a),n.d.RotationAxisToRef(c,y,i),a.multiplyToRef(i,C),C.multiplyToRef(O,C),C.decompose(F,S,P),this.position.addInPlace(P),S.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(H,c,y){const Z=H.scale(c);if(y&&0!==y)this.setAbsolutePosition(this.getAbsolutePosition().add(Z));else{const H=this.getPositionExpressedInLocalSpace().add(Z);this.setPositionWithLocalVector(H)}return this}addRotation(H,c,y){let Z;this.rotationQuaternion?Z=this.rotationQuaternion:(Z=n.h.Quaternion[1],n.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,Z));const F=n.h.Quaternion[0];return n.f.RotationYawPitchRollToRef(c,H,y,F),Z.multiplyInPlace(F),this.rotationQuaternion||Z.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==C.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Oj(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const y=this.va().getRenderId();if(!this._isDirty&&!H&&(this._currentRenderId===y||this.isSynchronized()))return this._currentRenderId=y,this._worldMatrix;c=c||this.va().activeCamera,this._updateCache();const Z=this._cache;Z.pivotMatrixUpdated=!1,Z.billboardMode=this.billboardMode,Z.infiniteDistance=this.infiniteDistance,Z.parent=this._parentNode,this._currentRenderId=y,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const F=this._getEffectiveParent(),P=C._TmpScaling;let S,O=this._position;if(this._infiniteDistance&&!this.parent&&c){const H=c.getWorldMatrix(),y=new n.n(H.m[12],H.m[13],H.m[14]);O=C._TmpTranslation,O.be(this._position.x+y.x,this._position.y+y.y,this._position.z+y.z)}if(P.be(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,S=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(n.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.be(0,0,0))}}else S=C._TmpRotation,n.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,S);if(this._usePivotMatrix){const H=n.h.Matrix[1];n.d.ScalingToRef(P.x,P.y,P.z,H);const c=n.h.Matrix[0];S.toRotationMatrix(c),this._pivotMatrix.multiplyToRef(H,n.h.Matrix[4]),n.h.Matrix[4].multiplyToRef(c,this.Qj),this._postMultiplyPivotMatrix&&this.Qj.multiplyToRef(this._pivotMatrixInverse,this.Qj),this.Qj.addTranslationFromFloats(O.x,O.y,O.z)}else n.d.ComposeToRef(P,S,O,this.Qj);if(F&&F.getWorldMatrix){if(H&&F.Oj(H),Z.useBillboardPath){if(this._transformToBoneReferal){const H=this.parent;H.getSkeleton().prepare(),H.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),n.h.Matrix[7])}else n.h.Matrix[7].p(F.getWorldMatrix());const H=n.h.o[5],c=n.h.o[6],y=n.h.Quaternion[0];n.h.Matrix[7].decompose(c,y,H),n.d.ScalingToRef(c.x,c.y,c.z,n.h.Matrix[7]),n.h.Matrix[7].setTranslation(H),C.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(y,H),this.Qj.setTranslation(H)),this.Qj.multiplyToRef(n.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const H=this.parent;H.getSkeleton().prepare(),this.Qj.multiplyToRef(H.getFinalMatrix(),n.h.Matrix[6]),n.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Qj.multiplyToRef(F.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Qj);if(Z.useBillboardPath&&c&&this.billboardMode&&!Z.useBillboardPosition){const H=n.h.o[0];if(this._worldMatrix.getTranslationToRef(H),n.h.Matrix[1].p(c.getViewMatrix()),this._scene.useRightHandedSystem&&n.h.Matrix[1].multiplyToRef(i,n.h.Matrix[1]),n.h.Matrix[1].setTranslationFromFloats(0,0,0),n.h.Matrix[1].invertToRef(n.h.Matrix[0]),(this.billboardMode&C.BILLBOARDMODE_ALL)!==C.BILLBOARDMODE_ALL){n.h.Matrix[0].decompose(void 0,n.h.Quaternion[0],void 0);const H=n.h.o[1];n.h.Quaternion[0].toEulerAnglesToRef(H),(this.billboardMode&C.BILLBOARDMODE_X)!==C.BILLBOARDMODE_X&&(H.x=0),(this.billboardMode&C.BILLBOARDMODE_Y)!==C.BILLBOARDMODE_Y&&(H.y=0),(this.billboardMode&C.BILLBOARDMODE_Z)!==C.BILLBOARDMODE_Z&&(H.z=0),n.d.RotationYawPitchRollToRef(H.y,H.x,H.z,n.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(n.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(n.h.o[0])}else if(Z.useBillboardPath&&c&&Z.useBillboardPosition){const H=n.h.o[0];this._worldMatrix.getTranslationToRef(H);const y=c.globalPosition;this._worldMatrix.invertToRef(n.h.Matrix[1]);const Z=n.h.o[1];n.n.TransformCoordinatesToRef(y,n.h.Matrix[1],Z),Z.normalize();const F=-Math.atan2(Z.z,Z.x)+Math.PI/2,P=Math.sqrt(Z.x*Z.x+Z.z*Z.z),S=-Math.atan2(Z.y,P);if(n.f.RotationYawPitchRollToRef(F,S,0,n.h.Quaternion[0]),(this.billboardMode&C.BILLBOARDMODE_ALL)!==C.BILLBOARDMODE_ALL){const H=n.h.o[1];n.h.Quaternion[0].toEulerAnglesToRef(H),(this.billboardMode&C.BILLBOARDMODE_X)!==C.BILLBOARDMODE_X&&(H.x=0),(this.billboardMode&C.BILLBOARDMODE_Y)!==C.BILLBOARDMODE_Y&&(H.y=0),(this.billboardMode&C.BILLBOARDMODE_Z)!==C.BILLBOARDMODE_Z&&(H.z=0),n.d.RotationYawPitchRollToRef(H.y,H.x,H.z,n.h.Matrix[0])}else n.d.FromQuaternionToRef(n.h.Quaternion[0],n.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(n.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(n.h.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):F&&F._nonUniformScaling?this._updateNonUniformScalingState(F._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.be(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=n.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Oj(),H){const H=this.getChildren();for(let c=0;c<H.length;++c){const y=H[c];if(y){y.Oj();const H=n.h.Matrix[0];y.Qj.multiplyToRef(this.Qj,H);const c=n.h.Quaternion[0];H.decompose(y.de,c,y.position),y.rotationQuaternion?y.rotationQuaternion.p(c):c.toEulerAnglesToRef(y.rotation)}}}this.de.be(1,1,1),this.position.be(0,0,0),this.rotation.be(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=n.f.Identity()),this._worldMatrix=n.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(H){return this.onAfterWorldMatrixUpdateObservable.add(H),this}unregisterAfterWorldMatrixUpdate(H){return this.onAfterWorldMatrixUpdateObservable.removeCallback(H),this}getPositionInCameraSpace(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return H||(H=this.va().activeCamera),n.n.TransformCoordinates(this.getAbsolutePosition(),H.getViewMatrix())}getDistanceToCamera(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return H||(H=this.va().activeCamera),this.getAbsolutePosition().Rc(H.globalPosition).length()}clone(H,c,y){const Z=P.e.Clone((()=>new C(H,this.va())),this);if(Z.name=H,Z.id=H,c&&(Z.parent=c),!y){const c=this.getDescendants(!0);for(let y=0;y<c.length;y++){const F=c[y];F.clone&&F.clone(H+"."+F.name,Z)}}return Z}serialize(H){const c=P.e.Serialize(this,H);return c.type=this.getClassName(),c.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(c),c.localMatrix=this.getPivotMatrix().ij(),c.isEnabled=this.isEnabled(),P.e.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c}static Parse(H,c,y){const Z=P.e.Parse((()=>new C(H.name,c)),H,c,y);if(H.localMatrix?Z.setPreTransformMatrix(n.d.Tg(H.localMatrix)):H.pivotMatrix&&Z.setPivotMatrix(n.d.Tg(H.pivotMatrix)),Z.Tb(H.isEnabled),Z._waitingParsedUniqueId=H.uniqueId,void 0!==H.parentId&&(Z._waitingParentId=H.parentId),void 0!==H.parentInstanceIndex&&(Z._waitingParentInstanceIndex=H.parentInstanceIndex),H.animations){for(let c=0;c<H.animations.length;c++){const y=H.animations[c],F=(0,a.c)("BABYLON.Animation");F&&Z.animations.push(F.Parse(y))}O.d.ParseAnimationRanges(Z,H,c)}return H.autoAnimate&&c.beginAnimation(Z,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),Z}getChildTransformNodes(H,c){const y=[];return this._getDescendants(y,H,(H=>(!c||c(H))&&H instanceof C)),y}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const H=this._parentContainer.transformNodes.indexOf(this);H>-1&&this._parentContainer.transformNodes.splice(H,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),H){const H=this.getChildTransformNodes(!0);for(const c of H)c.parent=null,c.Oj(!0)}super.dispose(H,c)}normalizeToUnitCube(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,Z=null,F=null;c&&(this.rotationQuaternion?(F=this.rotationQuaternion.clone(),this.rotationQuaternion.be(0,0,0,1)):this.rotation&&(Z=this.rotation.clone(),this.rotation.be(0,0,0)));const P=this.getHierarchyBoundingVectors(H,y),S=P.max.Rc(P.min),n=Math.max(S.x,S.y,S.z);if(0===n)return this;const O=1/n;return this.de.scaleInPlace(O),c&&(this.rotationQuaternion&&F?this.rotationQuaternion.p(F):this.rotation&&Z&&this.rotation.p(Z)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}C.BILLBOARDMODE_NONE=0,C.BILLBOARDMODE_X=1,C.BILLBOARDMODE_Y=2,C.BILLBOARDMODE_Z=4,C.BILLBOARDMODE_ALL=7,C.BILLBOARDMODE_USE_POSITION=128,C.BillboardUseParentOrientation=!1,C._TmpRotation=n.f.Zero(),C._TmpScaling=n.n.Zero(),C._TmpTranslation=n.n.Zero(),C._LookAtVectorCache=new n.n(0,0,0),C._RotationAxisCache=new n.f,(0,Z.b)([(0,F.N)("position")],C.prototype,"_position",void 0),(0,Z.b)([(0,F.N)("rotation")],C.prototype,"_rotation",void 0),(0,Z.b)([(0,F.E)("rotationQuaternion")],C.prototype,"_rotationQuaternion",void 0),(0,Z.b)([(0,F.N)("de")],C.prototype,"_scaling",void 0),(0,Z.b)([(0,F.P)("billboardMode")],C.prototype,"_billboardMode",void 0),(0,Z.b)([(0,F.P)()],C.prototype,"scalingDeterminant",void 0),(0,Z.b)([(0,F.P)("infiniteDistance")],C.prototype,"_infiniteDistance",void 0),(0,Z.b)([(0,F.P)()],C.prototype,"ignoreNonUniformScaling",void 0),(0,Z.b)([(0,F.P)()],C.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11633:(H,c,y)=>{"use strict";y.d(c,{e:()=>a});var Z=y(11092),F=y(11106),P=y(11600),S=y(11094),n=y(11112);class O{constructor(H,c,y,Z){this.name=H,this.worldAxisForNormal=c,this.worldAxisForFileX=y,this.worldAxisForFileY=Z}}class a{static ConvertCubeMapTextureToSphericalPolynomial(H){var c;if(!H.isCube)return null;null===(c=H.va())||void 0===c||c.getEngine().flushFramebuffer();const y=H.getSize().width,Z=H.readPixels(0,void 0,void 0,!1),F=H.readPixels(1,void 0,void 0,!1);let P,S;H.isRenderTarget?(P=H.readPixels(3,void 0,void 0,!1),S=H.readPixels(2,void 0,void 0,!1)):(P=H.readPixels(2,void 0,void 0,!1),S=H.readPixels(3,void 0,void 0,!1));const n=H.readPixels(4,void 0,void 0,!1),O=H.readPixels(5,void 0,void 0,!1),a=H.gammaSpace;let i=0;return 1!=H.textureType&&2!=H.textureType||(i=1),new Promise((H=>{Promise.all([F,Z,P,S,n,O]).then((c=>{let[Z,F,P,S,n,O]=c;const C={size:y,right:F,left:Z,up:P,down:S,front:n,back:O,format:5,type:i,gammaSpace:a};H(this.ConvertCubeMapToSphericalPolynomial(C))}))}))}static _AreaElement(H,c){return Math.atan2(H*c,Math.sqrt(H*H+c*c+1))}static ConvertCubeMapToSphericalPolynomial(H){const c=new P.e;let y=0;const Z=2/H.size,O=Z,a=.5*Z,i=a-1;for(let P=0;P<6;P++){const C=this._FileFaces[P],g=H[C.name];let v=i;const m=5===H.format?4:3;for(let P=0;P<H.size;P++){let z=i;for(let O=0;O<H.size;O++){const i=C.worldAxisForFileX.scale(z).add(C.worldAxisForFileY.scale(v)).add(C.worldAxisForNormal);i.normalize();const V=this._AreaElement(z-a,v-a)-this._AreaElement(z-a,v+a)-this._AreaElement(z+a,v-a)+this._AreaElement(z+a,v+a);let h=g[P*H.size*m+O*m+0],Q=g[P*H.size*m+O*m+1],D=g[P*H.size*m+O*m+2];isNaN(h)&&(h=0),isNaN(Q)&&(Q=0),isNaN(D)&&(D=0),0===H.type&&(h/=255,Q/=255,D/=255),H.gammaSpace&&(h=Math.pow((0,F.e)(h),S.n),Q=Math.pow((0,F.e)(Q),S.n),D=Math.pow((0,F.e)(D),S.n));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const H=Math.max(h,Q,D);if(H>f){const c=f/H;h*=c,Q*=c,D*=c}}else h=(0,F.e)(h,0,f),Q=(0,F.e)(Q,0,f),D=(0,F.e)(D,0,f);const J=new n.e(h,Q,D);c.addLight(i,J,V),y+=V,z+=Z}v+=O}}const C=6*(4*Math.PI)/6/y;return c.scaleInPlace(C),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),P.f.FromHarmonics(c)}}a._FileFaces=[new O("right",new Z.n(1,0,0),new Z.n(0,0,-1),new Z.n(0,-1,0)),new O("left",new Z.n(-1,0,0),new Z.n(0,0,1),new Z.n(0,-1,0)),new O("up",new Z.n(0,1,0),new Z.n(1,0,0),new Z.n(0,0,1)),new O("down",new Z.n(0,-1,0),new Z.n(1,0,0),new Z.n(0,0,-1)),new O("front",new Z.n(0,0,1),new Z.n(1,0,0),new Z.n(0,-1,0)),new O("back",new Z.n(0,0,-1),new Z.n(-1,0,0),new Z.n(0,-1,0))],a.MAX_HDRI_VALUE=4096,a.PRESERVE_CLAMPED_COLORS=!1},11103:(H,c,y)=>{"use strict";function Z(H,c){const y=[];for(let Z=0;Z<H;++Z)y.push(c());return y}function F(H,c){return Z(H,c)}y.d(c,{d:()=>Z,g:()=>F,j:()=>S});const P=["push","splice","pop","shift","unshift"];function S(H,c){const y=P.map((y=>function(H,c,y){const Z=H[c];if("function"!==typeof Z)return null;const F=function(){const Z=H.length,P=F.previous.apply(H,arguments);return y(c,Z),P};return Z.next=F,F.previous=Z,H[c]=F,()=>{const y=F.previous;if(!y)return;const Z=F.next;Z?(y.next=Z,Z.previous=y):(y.next=void 0,H[c]=y),F.next=void 0,F.previous=void 0}}(H,y,c)));return()=>{y.forEach((H=>{null===H||void 0===H||H()}))}}},12302:(H,c,y)=>{"use strict";y.d(c,{b:()=>S});var Z=y(11304),F=y(12306);let P=0;const S=H=>{if(!H.environmentBRDFTexture){const c=H.useDelayedTextureLoading;H.useDelayedTextureLoading=!1;const y=H._blockEntityCollection;H._blockEntityCollection=!1;const S=Z.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+P++,H,!0,!1,Z.d.BILINEAR_SAMPLINGMODE);H._blockEntityCollection=y;const n=H.getEngine().getLoadedTexturesCache(),O=n.indexOf(S.getInternalTexture());-1!==O&&n.splice(O,1),S.isRGBD=!0,S.wrapU=Z.d.CLAMP_ADDRESSMODE,S.wrapV=Z.d.CLAMP_ADDRESSMODE,H.environmentBRDFTexture=S,H.useDelayedTextureLoading=c,F.e.ExpandRGBDTexture(S);const a=H.getEngine().onContextRestoredObservable.add((()=>{S.isRGBD=!0;const c=H.onBeforeRenderObservable.add((()=>{S.isReady()&&(H.onBeforeRenderObservable.remove(c),F.e.ExpandRGBDTexture(S))}))}));H.jj.add((()=>{H.getEngine().onContextRestoredObservable.remove(a)}))}return H.environmentBRDFTexture}},11358:(H,c,y)=>{"use strict";function Z(H,c,y){try{const Z=H.next();Z.done?c(Z):Z.value?Z.value.then((()=>{Z.value=void 0,c(Z)}),y):c(Z)}catch(Z){y(Z)}}function F(){let H,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(y,F,P)=>{const S=performance.now();void 0===H||S-H>c?(H=S,setTimeout((()=>{Z(y,F,P)}),0)):Z(y,F,P)}}function P(H,c,y,Z,F){const P=()=>{let S;const n=H=>{H.done?y(H.value):void 0===S?S=!0:P()};do{S=void 0,F&&F.aborted?Z(new Error("Aborted")):c(H,n,Z),void 0===S&&(S=!1)}while(S)};P()}function S(H,c){let y;return P(H,Z,(H=>y=H),(H=>{throw H}),c),y}function n(H,c,y){return new Promise(((Z,F)=>{P(H,c,Z,F,y)}))}function O(H,c){return function(){return S(H(...arguments),c)}}y.d(c,{d:()=>F,e:()=>O,i:()=>n,l:()=>S})},11625:(H,c,y)=>{"use strict";y.d(c,{c:()=>m});var Z=y(11106),F=y(10773),P=y(11633),S=y(11642);y(11663);const n=131072,O=131072;function a(H){return H.charCodeAt(0)+(H.charCodeAt(1)<<8)+(H.charCodeAt(2)<<16)+(H.charCodeAt(3)<<24)}const i=a("DXT1"),C=a("DXT3"),g=a("DXT5"),v=a("DX10");class m{static GetDDSInfo(H){const c=new Int32Array(H.buffer,H.byteOffset,31),y=new Int32Array(H.buffer,H.byteOffset,35);let Z=1;c[2]&n&&(Z=Math.max(1,c[7]));const F=c[21],P=F===v?y[32]:0;let S=0;switch(F){case 113:S=2;break;case 116:S=1;break;case v:if(10===P){S=2;break}if(2===P){S=1;break}}return{width:c[4],height:c[3],mipmapCount:Z,isFourCC:4===(4&c[20]),isRGB:64===(64&c[20]),isLuminance:(c[20]&O)===O,isCube:512===(512&c[28]),isCompressed:F===i||F===C||F===g,dxgiFormat:P,textureType:S}}static _GetHalfFloatAsFloatRGBAArrayBuffer(H,c,y,Z,F,P){const n=new Float32Array(Z),O=new Uint16Array(F,y);let a=0;for(let i=0;i<c;i++)for(let c=0;c<H;c++){const y=4*(c+i*H);n[a]=(0,S.i)(O[y]),n[a+1]=(0,S.i)(O[y+1]),n[a+2]=(0,S.i)(O[y+2]),m.StoreLODInAlphaChannel?n[a+3]=P:n[a+3]=(0,S.i)(O[y+3]),a+=4}return n}static _GetHalfFloatRGBAArrayBuffer(H,c,y,Z,F,P){if(m.StoreLODInAlphaChannel){const n=new Uint16Array(Z),O=new Uint16Array(F,y);let a=0;for(let y=0;y<c;y++)for(let c=0;c<H;c++){const Z=4*(c+y*H);n[a]=O[Z],n[a+1]=O[Z+1],n[a+2]=O[Z+2],n[a+3]=(0,S.m)(P),a+=4}return n}return new Uint16Array(F,y,Z)}static _GetFloatRGBAArrayBuffer(H,c,y,Z,F,P){if(m.StoreLODInAlphaChannel){const S=new Float32Array(Z),n=new Float32Array(F,y);let O=0;for(let y=0;y<c;y++)for(let c=0;c<H;c++){const Z=4*(c+y*H);S[O]=n[Z],S[O+1]=n[Z+1],S[O+2]=n[Z+2],S[O+3]=P,O+=4}return S}return new Float32Array(F,y,Z)}static _GetFloatAsHalfFloatRGBAArrayBuffer(H,c,y,Z,F,P){const n=new Uint16Array(Z),O=new Float32Array(F,y);let a=0;for(let i=0;i<c;i++)for(let c=0;c<H;c++)n[a]=(0,S.m)(O[a]),n[a+1]=(0,S.m)(O[a+1]),n[a+2]=(0,S.m)(O[a+2]),m.StoreLODInAlphaChannel?n[a+3]=(0,S.m)(P):n[a+3]=(0,S.m)(O[a+3]),a+=4;return n}static _GetFloatAsUIntRGBAArrayBuffer(H,c,y,F,P,S){const n=new Uint8Array(F),O=new Float32Array(P,y);let a=0;for(let i=0;i<c;i++)for(let c=0;c<H;c++){const y=4*(c+i*H);n[a]=255*(0,Z.e)(O[y]),n[a+1]=255*(0,Z.e)(O[y+1]),n[a+2]=255*(0,Z.e)(O[y+2]),m.StoreLODInAlphaChannel?n[a+3]=S:n[a+3]=255*(0,Z.e)(O[y+3]),a+=4}return n}static _GetHalfFloatAsUIntRGBAArrayBuffer(H,c,y,F,P,n){const O=new Uint8Array(F),a=new Uint16Array(P,y);let i=0;for(let C=0;C<c;C++)for(let c=0;c<H;c++){const y=4*(c+C*H);O[i]=255*(0,Z.e)((0,S.i)(a[y])),O[i+1]=255*(0,Z.e)((0,S.i)(a[y+1])),O[i+2]=255*(0,Z.e)((0,S.i)(a[y+2])),m.StoreLODInAlphaChannel?O[i+3]=n:O[i+3]=255*(0,Z.e)((0,S.i)(a[y+3])),i+=4}return O}static _GetRGBAArrayBuffer(H,c,y,Z,F,P,S,n,O){const a=new Uint8Array(Z),i=new Uint8Array(F,y);let C=0;for(let g=0;g<c;g++)for(let c=0;c<H;c++){const y=4*(c+g*H);a[C]=i[y+P],a[C+1]=i[y+S],a[C+2]=i[y+n],a[C+3]=i[y+O],C+=4}return a}static _ExtractLongWordOrder(H){return 0===H||255===H||-16777216===H?0:1+m._ExtractLongWordOrder(H>>8)}static _GetRGBArrayBuffer(H,c,y,Z,F,P,S,n){const O=new Uint8Array(Z),a=new Uint8Array(F,y);let i=0;for(let C=0;C<c;C++)for(let c=0;c<H;c++){const y=3*(c+C*H);O[i]=a[y+P],O[i+1]=a[y+S],O[i+2]=a[y+n],i+=3}return O}static _GetLuminanceArrayBuffer(H,c,y,Z,F){const P=new Uint8Array(Z),S=new Uint8Array(F,y);let n=0;for(let O=0;O<c;O++)for(let c=0;c<H;c++){const y=c+O*H;P[n]=S[y],n++}return P}static UploadDDSLevels(H,c,y,Z,S,O){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,z=arguments.length>7?arguments[7]:void 0,V=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=null;Z.sphericalPolynomial&&(h=[]);const Q=!!H.getCaps().s3tc;c.generateMipMaps=S;const D=new Int32Array(y.buffer,y.byteOffset,31);let f,J,l,d,K,T,u,E=0,U=0,G=1;if(542327876!==D[0])return void F.d.Error("Invalid magic number in DDS header");if(!Z.isFourCC&&!Z.isRGB&&!Z.isLuminance)return void F.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(Z.isCompressed&&!Q)return void F.d.Error("Compressed textures are not supported on this platform.");let p=D[22];d=D[1]+4;let t=!1;if(Z.isFourCC)switch(f=D[21],f){case i:G=8,U=33777;break;case C:G=16,U=33778;break;case g:G=16,U=33779;break;case 113:t=!0,p=64;break;case 116:t=!0,p=128;break;case v:{d+=20;let H=!1;switch(Z.dxgiFormat){case 10:t=!0,p=64,H=!0;break;case 2:t=!0,p=128,H=!0;break;case 88:Z.isRGB=!0,Z.isFourCC=!1,p=32,H=!0}if(H)break}default:return void F.d.Error(["Unsupported FourCC code:",(o=f,String.fromCharCode(255&o,o>>8&255,o>>16&255,o>>24&255))])}var o;const s=m._ExtractLongWordOrder(D[23]),q=m._ExtractLongWordOrder(D[24]),I=m._ExtractLongWordOrder(D[25]),j=m._ExtractLongWordOrder(D[26]);t&&(U=H._getRGBABufferInternalSizedFormat(Z.textureType)),T=1,D[2]&n&&!1!==S&&(T=Math.max(1,D[7]));const k=z||0,W=H.getCaps();for(let F=k;F<O;F++){for(J=D[4],l=D[3],u=0;u<T;++u){if(-1===a||a===u){const P=-1===a?u:0;if(!Z.isCompressed&&Z.isFourCC){c.format=5,E=J*l*4;let Z=null;if(H._badOS||H._badDesktopOS||!W.textureHalfFloat&&!W.textureFloat)128===p?(Z=m._GetFloatAsUIntRGBAArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,P),h&&0==P&&h.push(m._GetFloatRGBAArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,P))):64===p&&(Z=m._GetHalfFloatAsUIntRGBAArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,P),h&&0==P&&h.push(m._GetHalfFloatAsFloatRGBAArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,P))),c.type=0;else{const H=W.textureFloat&&(V&&W.textureFloatLinearFiltering||!V),F=W.textureHalfFloat&&(V&&W.textureHalfFloatLinearFiltering||!V),S=(128===p||64===p&&!F)&&H?1:(64===p||128===p&&!H)&&F?2:0;let n,O=null;if(128===p)switch(S){case 1:n=m._GetFloatRGBAArrayBuffer,O=null;break;case 2:n=m._GetFloatAsHalfFloatRGBAArrayBuffer,O=m._GetFloatRGBAArrayBuffer;break;case 0:n=m._GetFloatAsUIntRGBAArrayBuffer,O=m._GetFloatRGBAArrayBuffer}else switch(S){case 1:n=m._GetHalfFloatAsFloatRGBAArrayBuffer,O=null;break;case 2:n=m._GetHalfFloatRGBAArrayBuffer,O=m._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:n=m._GetHalfFloatAsUIntRGBAArrayBuffer,O=m._GetHalfFloatAsFloatRGBAArrayBuffer}c.type=S,Z=n(J,l,y.byteOffset+d,E,y.buffer,P),h&&0==P&&h.push(O?O(J,l,y.byteOffset+d,E,y.buffer,P):Z)}Z&&H._uploadDataToTextureDirectly(c,Z,F,P)}else if(Z.isRGB)c.type=0,24===p?(c.format=4,E=J*l*3,K=m._GetRGBArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,s,q,I),H._uploadDataToTextureDirectly(c,K,F,P)):(c.format=5,E=J*l*4,K=m._GetRGBAArrayBuffer(J,l,y.byteOffset+d,E,y.buffer,s,q,I,j),H._uploadDataToTextureDirectly(c,K,F,P));else if(Z.isLuminance){const Z=H._getUnpackAlignement(),S=J;E=Math.floor((J+Z-1)/Z)*Z*(l-1)+S,K=m._GetLuminanceArrayBuffer(J,l,y.byteOffset+d,E,y.buffer),c.format=1,c.type=0,H._uploadDataToTextureDirectly(c,K,F,P)}else E=Math.max(4,J)/4*Math.max(4,l)/4*G,K=new Uint8Array(y.buffer,y.byteOffset+d,E),c.type=0,H._uploadCompressedDataToTextureDirectly(c,U,J,l,K,F,P)}d+=p?J*l*(p/8):E,J*=.5,l*=.5,J=Math.max(1,J),l=Math.max(1,l)}if(void 0!==z)break}h&&h.length>0?Z.sphericalPolynomial=P.e.ConvertCubeMapToSphericalPolynomial({size:D[4],right:h[0],left:h[1],up:h[2],down:h[3],front:h[4],back:h[5],format:5,type:1,gammaSpace:!1}):Z.sphericalPolynomial=void 0}}m.StoreLODInAlphaChannel=!1},11066:(H,c,y)=>{"use strict";y.d(c,{e:()=>P,h:()=>S});const Z={},F={};function P(H){const c=H.getClassName();return F[c]||(F[c]={}),F[c]}function S(H){const c=H.getClassName();if(Z[c])return Z[c];Z[c]={};const y=Z[c];let P=H,S=c;for(;S;){const H=F[S];for(const F in H)y[F]=H[F];let c,Z=!1;do{if(c=Object.getPrototypeOf(P),!c.getClassName){Z=!0;break}if(c.getClassName()!==S)break;P=c}while(c);if(Z)break;S=c.getClassName(),P=c}return y}},11061:(H,c,y)=>{"use strict";y.d(c,{B:()=>g,E:()=>V,H:()=>n,L:()=>i,N:()=>C,P:()=>S,d:()=>P,f:()=>Q,j:()=>v,l:()=>O,o:()=>m,s:()=>a,t:()=>z,x:()=>h});var Z=y(11066);function F(H,c){return(y,F)=>{const P=(0,Z.e)(y);P[F]||(P[F]={type:H,sourceName:c})}}function P(H){return function(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(y,Z)=>{const F=c||"_"+Z;Object.defineProperty(y,Z,{get:function(){return this[F]},set:function(c){"function"===typeof this.equals&&this.equals(c)||this[F]!==c&&(this[F]=c,y[H].apply(this))},enumerable:!0,configurable:!0})}}(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function S(H){return F(0,H)}function n(H){return F(1,H)}function O(H){return F(2,H)}function a(H){return F(3,H)}function i(H){return F(4,H)}function C(H){return F(5,H)}function g(H){return F(6,H)}function v(H){return F(7,H)}function m(H){return F(8,H)}function z(H){return F(9,H)}function V(H){return F(10,H)}function h(H){return F(12,H)}function Q(H,c,y,Z){const F=y.value;y.value=function(){let y=F;if("undefined"!==typeof _native&&_native[c]){const H=_native[c];y=Z?function(){return Z(...arguments)?H(...arguments):F(...arguments)}:H}return H[c]=y,y(...arguments)}}Q.filter=function(H){return(c,y,Z)=>Q(c,y,Z,H)}},11118:(H,c,y)=>{"use strict";y.d(c,{e:()=>a});var Z=y(10798),F=y(11083),P=y(11112),S=y(11092),n=y(11066);const O=function(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const P=H();F.d&&F.d.HasTags(c)&&F.d.AddTagsTo(P,F.d.GetTags(c,!0));const S=(0,n.h)(P),O={};for(const F in S){const H=S[F],n=c[F],i=H.type;if(void 0!==n&&null!==n&&("uniqueId"!==F||a.AllowLoadingUniqueId))switch(i){case 0:case 6:case 11:P[F]=n;break;case 1:Z.cloneTexturesOnlyOnce&&O[n.uniqueId]?P[F]=O[n.uniqueId]:(P[F]=y||n.isRenderTarget?n:n.clone(),O[n.uniqueId]=P[F]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:P[F]=y?n:n.clone()}}return P};class a{static AppendSerializedAnimations(H,c){if(H.animations){c.animations=[];for(let y=0;y<H.animations.length;y++){const Z=H.animations[y];c.animations.push(Z.serialize())}}}static Serialize(H,c){c||(c={}),F.d&&(c.tags=F.d.GetTags(H));const y=(0,n.h)(H);for(const Z in y){const F=y[Z],P=F.sourceName||Z,S=F.type,n=H[Z];if(void 0!==n&&null!==n&&("uniqueId"!==Z||a.AllowLoadingUniqueId))switch(S){case 0:c[P]=n;break;case 1:case 3:case 7:case 9:c[P]=n.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:c[P]=n.ij();break;case 6:case 11:c[P]=n.id}}return c}static ParseProperties(H,c,y,Z){Z||(Z="");const F=(0,n.h)(c);for(const n in F){const O=F[n],i=H[O.sourceName||n],C=O.type;if(void 0!==i&&null!==i&&("uniqueId"!==n||a.AllowLoadingUniqueId)){const H=c;switch(C){case 0:H[n]=i;break;case 1:y&&(H[n]=a._TextureParser(i,y,Z));break;case 2:H[n]=P.e.Tg(i);break;case 3:H[n]=a._FresnelParametersParser(i);break;case 4:H[n]=S.l.Tg(i);break;case 5:H[n]=S.n.Tg(i);break;case 6:y&&(H[n]=y.getLastMeshById(i));break;case 7:H[n]=a._ColorCurvesParser(i);break;case 8:H[n]=P.h.Tg(i);break;case 9:H[n]=a._ImageProcessingConfigurationParser(i);break;case 10:H[n]=S.f.Tg(i);break;case 11:y&&(H[n]=y.getCameraById(i));break;case 12:H[n]=S.d.Tg(i)}}}}static Parse(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=H();return F.d&&F.d.AddTagsTo(P,c.tags),a.ParseProperties(c,P,y,Z),P}static Clone(H,c){return O(H,c,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(H,c){return O(H,c,!0)}}a.AllowLoadingUniqueId=!1,a._ImageProcessingConfigurationParser=H=>{throw(0,Z.b)("ImageProcessingConfiguration")},a._FresnelParametersParser=H=>{throw(0,Z.b)("FresnelParameters")},a._ColorCurvesParser=H=>{throw(0,Z.b)("ColorCurves")},a._TextureParser=(H,c,y)=>{throw(0,Z.b)("Texture")}},10781:(H,c,y)=>{"use strict";y.d(c,{c:()=>P});var Z=y(10773);const F=(H,c,y)=>H?H.getClassName&&"Mesh"===H.getClassName()?null:!H.getClassName||"SubMesh"!==H.getClassName()&&"PhysicsBody"!==H.getClassName()?H.clone?H.clone():Array.isArray(H)?H.slice():y&&"object"===typeof H?{...H}:null:H.clone(c):null;class P{static DeepCopy(H,c,y,P){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=function(H){const c=[];do{Object.getOwnPropertyNames(H).forEach((function(H){-1===c.indexOf(H)&&c.push(H)}))}while(H=Object.getPrototypeOf(H));return c}(H);for(const a of n){if("_"===a[0]&&(!P||-1===P.indexOf(a)))continue;if(a.endsWith("Observable"))continue;if(y&&-1!==y.indexOf(a))continue;const n=H[a],i=typeof n;if("function"!==i)try{if("object"===i)if(n instanceof Uint8Array)c[a]=Uint8Array.from(n);else if(n instanceof Array){if(c[a]=[],n.length>0)if("object"==typeof n[0])for(let H=0;H<n.length;H++){const y=F(n[H],c,S);-1===c[a].indexOf(y)&&c[a].push(y)}else c[a]=n.slice(0)}else c[a]=F(n,c,S);else c[a]=n}catch(O){Z.d.Warn(O.message)}}}}},10798:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});const Z={};function F(H){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Z[H])return Z[H]=!0,`${H} needs to be imported before as it contains a side-effect required by your code.`}},10768:(H,c,y)=>{"use strict";function Z(){return"undefined"!==typeof window}function F(){return"undefined"!==typeof navigator}function P(){return"undefined"!==typeof document}function S(H){let c="",y=H.firstChild;for(;y;)3===y.nodeType&&(c+=y.textContent),y=y.nextSibling;return c}y.d(c,{b:()=>S,e:()=>P,f:()=>F,h:()=>Z})},12346:(H,c,y)=>{"use strict";y.r(c),y.d(c,{Dispose:()=>g,DumpData:()=>C,DumpDataAsync:()=>i,DumpFramebuffer:()=>a,DumpTools:()=>v});var Z=y(11655),F=y(10754),P=y(11106),S=y(10810);let n,O=null;async function a(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;const n=await y.readPixels(0,0,H,c);C(H,c,new Uint8Array(n.buffer),Z,F,P,!0,void 0,S)}function i(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0;return new Promise((O=>{C(H,c,y,(H=>O(H)),Z,F,P,S,n)}))}function C(H,c,a,i){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8?arguments[8]:void 0;(async function(){return O||(O=new Promise(((H,c)=>{let F,P=null;const O={ph:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(y.bind(y,11534)).then((a=>{let{ThinEngine:i}=a;try{F=new OffscreenCanvas(100,100),P=new i(F,!1,O)}catch(v){F=document.createElement("canvas"),P=new i(F,!1,O)}S.b.Instances.pop(),S.b.OnEnginesDisposedObservable.add((H=>{P&&H!==P&&!P.u&&0===S.b.Instances.length&&g()})),P.getCaps().parallelShaderCompile=void 0;const C=new Z.e(P);y.e(34).then(y.bind(y,13584)).then((y=>{let{passPixelShader:S}=y;if(!P)return void c("Engine is not defined");const O=new Z.g({kd:P,name:S.name,fragmentShader:S.shader,samplerNames:["textureSampler"]});n={canvas:F,kd:P,renderer:C,wrapper:O},H(n)}))})).catch(c)}))),await O})().then((y=>{if(y.kd.setSize(H,c,!0),a instanceof Float32Array){const H=new Uint8Array(a.length);let c=a.length;for(;c--;){const y=a[c];H[c]=Math.round(255*(0,P.e)(y))}a=H}const Z=y.kd.createRawTexture(a,H,c,5,!1,!m,1);y.renderer.setViewport(),y.renderer.applyEffectWrapper(y.wrapper),y.wrapper.effect._bindTexture("textureSampler",Z),y.renderer.draw(),z?F.c.ToBlob(y.canvas,(H=>{const c=new FileReader;c.onload=H=>{const c=H.target.result;i&&i(c)},c.readAsArrayBuffer(H)}),C,V):F.c.EncodeScreenshotCanvasData(y.canvas,i,C,v,V),Z.dispose()}))}function g(){var H;n?(n.wrapper.dispose(),n.renderer.dispose(),n.kd.dispose()):null===(H=O)||void 0===H||H.then((H=>{H.wrapper.dispose(),H.renderer.dispose(),H.kd.dispose()}));O=null,n=null}const v={DumpData:C,DumpDataAsync:i,DumpFramebuffer:a,Dispose:g};F.c.DumpData=C,F.c.DumpDataAsync=i,F.c.DumpFramebuffer=a},12343:(H,c,y)=>{"use strict";y.d(c,{c:()=>m,e:()=>h,h:()=>f,j:()=>J});var Z=y(10754),F=y(11092),P=y(11106),S=y(11600),n=y(10877),O=y(11313),a=(y(11076),y(11650)),i=y(10773);y(12306),y(12321),y(12346);const C="image/png",g=2,v=[134,22,135,150,246,214,150,54];function m(H){const c=new DataView(H.buffer,H.byteOffset,H.byteLength);let y=0;for(let S=0;S<v.length;S++)if(c.getUint8(y++)!==v[S])return i.d.Error("Not a babylon environment map"),null;let Z="",F=0;for(;F=c.getUint8(y++);)Z+=String.fromCharCode(F);let P=JSON.parse(Z);return P=z(P),P.uh&&(P.uh.specularDataPosition=y,P.uh.lodGenerationScale=P.uh.lodGenerationScale||.8),P}function z(H){if(H.version>g)throw new Error(`Unsupported babylon environment map version "${H.version}". Latest supported version is "${g}".`);return 2===H.version?H:H={...H,version:2,imageType:C}}function V(H,c){const y=(c=z(c)).uh;let Z=Math.log2(c.width);if(Z=Math.round(Z)+1,y.mipmaps.length!==6*Z)throw new Error(`Unsupported specular mipmaps number "${y.mipmaps.length}"`);const F=new Array(Z);for(let P=0;P<Z;P++){F[P]=new Array(6);for(let c=0;c<6;c++){const Z=y.mipmaps[6*P+c];F[P][c]=new Uint8Array(H.buffer,H.byteOffset+y.specularDataPosition+Z.position,Z.length)}}return F}function h(H,c,y){const Z=(y=z(y)).uh;if(!Z)return Promise.resolve();H._lodGenerationScale=Z.lodGenerationScale;return D(H,V(c,y),y.imageType)}function Q(H,c,y,Z,F,P,S,n,O,a,i){return new Promise(((C,g)=>{if(y){const y=c.createTexture(null,!0,!0,null,1,null,(H=>{g(H)}),H);null===Z||void 0===Z||Z.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{Z.externalTextureSamplerBinding=!0,Z.onApply=Z=>{Z._bindTexture("textureSampler",y),Z.setFloat2("scale",1,c._features.needsInvertingBitmap&&H instanceof ImageBitmap?-1:1)},c.scenes.length&&(c.scenes[0].postProcessManager.directRender([Z],a,!0,P,S),c.restoreDefaultFramebuffer(),y.dispose(),URL.revokeObjectURL(F),C())}))}))}else{if(c._uploadImageToTexture(i,H,P,S),n){const y=O[S];y&&c._uploadImageToTexture(y._texture,H,P,0)}C()}}))}async function D(H,c){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C;if(!Z.c.IsExponentOfTwo(H.width))throw new Error("Texture size must be a power of two");const S=(0,P.p)(H.width)+1,i=H.getEngine();let g=!1,v=!1,m=null,z=null,V=null;const h=i.getCaps();H.format=5,H.type=0,H.generateMipMaps=!0,H._cachedAnisotropicFilteringLevel=null,i.updateTextureSamplingMode(3,H),h.textureLOD?i._features.supportRenderAndCopyToLodForFloatTextures?h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(g=!0,H.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(g=!0,H.type=1):g=!1:(g=!1,v=!0,V={});let D=0;if(g)i.isWebGPU?(D=1,await y.e(39).then(y.bind(y,13614))):await y.e(41).then(y.bind(y,13621)),m=new a.e("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,H.type,void 0,null,!1,void 0,D),H._isRGBD=!1,H.invertY=!1,z=i.createRenderTargetCubeTexture(H.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:H.type,format:5});else if(H._isRGBD=!0,H.invertY=!0,v){const c=3,y=H._lodGenerationScale,Z=H._lodGenerationOffset;for(let F=0;F<c;F++){const P=(S-1)*y+Z,a=Z+(P-Z)*(1-F/(c-1)),C=Math.round(Math.min(Math.max(a,0),P)),g=new n.b(i,2);g.isCube=!0,g.invertY=!0,g.generateMipMaps=!1,i.updateTextureSamplingMode(2,g);const v=new O.c(null);switch(v._isCube=!0,v._texture=g,V[C]=v,F){case 0:H._lodTextureLow=v;break;case 1:H._lodTextureMid=v;break;case 2:H._lodTextureHigh=v}}}const f=[];for(let y=0;y<c.length;y++)for(let Z=0;Z<6;Z++){const P=c[y][Z],S=new Blob([P],{type:F}),n=URL.createObjectURL(S);let O;if(i._features.forceBitmapOverHTMLImageElement)O=i.createImageBitmap(S,{premultiplyAlpha:"none"}).then((c=>Q(c,i,g,m,n,Z,y,v,V,z,H)));else{const c=new Image;c.src=n,O=new Promise(((F,P)=>{c.onload=()=>{Q(c,i,g,m,n,Z,y,v,V,z,H).then((()=>F())).catch((H=>{P(H)}))},c.onerror=H=>{P(H)}}))}f.push(O)}if(c.length<S){let y;const Z=Math.pow(2,S-1-c.length),F=Z*Z*4;switch(H.type){case 0:y=new Uint8Array(F);break;case 2:y=new Uint16Array(F);break;case 1:y=new Float32Array(F)}for(let P=c.length;P<S;P++)for(let c=0;c<6;c++)i._uploadArrayBufferViewToTexture(H,y,c,P)}return Promise.all(f).then((()=>{z&&(i._releaseTexture(H),z._swapAndDie(H)),m&&m.dispose(),v&&(H._lodTextureHigh&&H._lodTextureHigh._texture&&(H._lodTextureHigh._texture.isReady=!0),H._lodTextureMid&&H._lodTextureMid._texture&&(H._lodTextureMid._texture.isReady=!0),H._lodTextureLow&&H._lodTextureLow._texture&&(H._lodTextureLow._texture.isReady=!0))}))}function f(H,c){const y=(c=z(c)).irradiance;if(!y)return;const Z=new S.f;F.n.FromArrayToRef(y.x,0,Z.x),F.n.FromArrayToRef(y.y,0,Z.y),F.n.FromArrayToRef(y.z,0,Z.z),F.n.FromArrayToRef(y.xx,0,Z.xx),F.n.FromArrayToRef(y.yy,0,Z.yy),F.n.FromArrayToRef(y.zz,0,Z.zz),F.n.FromArrayToRef(y.yz,0,Z.yz),F.n.FromArrayToRef(y.zx,0,Z.zx),F.n.FromArrayToRef(y.xy,0,Z.xy),H._sphericalPolynomial=Z}function J(H,c,y,Z,F){const P=D(H.getEngine().createRawCubeTexture(null,H.width,H.format,H.type,H.generateMipMaps,H.invertY,H.samplingMode,H._compression),c).then((()=>H));return H.onRebuildCallback=H=>({proxy:P,isReady:!0,isAsync:!0}),H._source=13,H._bufferViewArrayArray=c,H._lodGenerationScale=Z,H._lodGenerationOffset=F,H._sphericalPolynomial=y,D(H,c).then((()=>(H.isReady=!0,H)))}},10826:(H,c,y)=>{"use strict";y.d(c,{e:()=>Z,i:()=>F,m:()=>P});class Z extends Error{}Z._setPrototypeOf=Object.setPrototypeOf||((H,c)=>(H.__proto__=c,H));const F={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class P extends Z{constructor(H,c,y){super(H),this.errorCode=c,this.innerError=y,this.name="RuntimeError",Z._setPrototypeOf(this,P.prototype)}}},10819:(H,c,y)=>{"use strict";y.d(c,{c:()=>G,f:()=>D,g:()=>E,n:()=>K,k:()=>V,q:()=>l,u:()=>d,v:()=>T,x:()=>f});var Z=y(10805),F=y(10768),P=y(10763);class S{}S.FilesToLoad={};var n=y(10826),O=y(10828),a=y(10836),i=y(10810),C=y(10773),g=y(10847),v=y(10840),m=y(10850);const z=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class V extends n.m{constructor(H,c){super(H,n.i.LoadFileError),this.name="LoadFileError",n.e._setPrototypeOf(this,V.prototype),c instanceof Z.c?this.request=c:this.file=c}}class h extends n.m{constructor(H,c){super(H,n.i.RequestFileError),this.request=c,this.name="RequestFileError",n.e._setPrototypeOf(this,h.prototype)}}class Q extends n.m{constructor(H,c){super(H,n.i.ReadFileError),this.file=c,this.name="ReadFileError",n.e._setPrototypeOf(this,Q.prototype)}}const D={DefaultRetryStrategy:class{static ExponentialBackoff(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(y,Z,F)=>0!==Z.status||F>=H||-1!==y.indexOf("file:")?-1:Math.pow(2,F)*c}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:H=>H,ScriptBaseUrl:"",ScriptPreprocessUrl:H=>H,CleanUrl:H=>H=H.replace(/#/gm,"%23")},f=(H,c)=>{if((!H||0!==H.indexOf("data:"))&&D.CorsBehavior)if("string"===typeof D.CorsBehavior||D.CorsBehavior instanceof String)c.crossOrigin=D.CorsBehavior;else{const y=D.CorsBehavior(H);y&&(c.crossOrigin=y)}},J={getRequiredSize:null},l=function(H,c,y,F){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;const a=i.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===a||void 0===a||!a._features.forceBitmapOverHTMLImageElement))return y("LoadImage is only supported in web or BabylonNative environments."),null;let C,g=!1;H instanceof ArrayBuffer||ArrayBuffer.isView(H)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(C=URL.createObjectURL(new Blob([H],{type:P})),g=!0):C=`data:${P};base64,`+(0,O.i)(H):H instanceof Blob?(C=URL.createObjectURL(H),g=!0):(C=D.CleanUrl(H),C=D.PreprocessUrl(C));const v=c=>{if(y){const Z=C||H.toString();y(`Error while trying to load image: ${0===Z.indexOf("http")||Z.length<=128?Z:Z.slice(0,128)+"..."}`,c)}};if(null!==a&&void 0!==a&&a._features.forceBitmapOverHTMLImageElement)return K(C,(Z=>{a.createImageBitmap(new Blob([Z],{type:P}),{premultiplyAlpha:"none",...n}).then((H=>{c(H),g&&URL.revokeObjectURL(C)})).catch((c=>{y&&y("Error while trying to load image: "+H,c)}))}),void 0,F||void 0,!0,((H,c)=>{v(c)})),null;const m=new Image;if(J.getRequiredSize){const c=J.getRequiredSize(H);c.width&&(m.width=c.width),c.height&&(m.height=c.height)}f(C,m);const z=[],V=()=>{z.forEach((H=>{H.target.removeEventListener(H.name,H.handler)})),z.length=0};z.push({target:m,name:"load",handler:()=>{V(),c(m),g&&m.src&&URL.revokeObjectURL(m.src)}}),z.push({target:m,name:"error",handler:H=>{V(),v(H),g&&m.src&&URL.revokeObjectURL(m.src)}}),z.push({target:document,name:"securitypolicyviolation",handler:H=>{if(H.blockedURI!==m.src||"km"===H.disposition)return;V();const c=new Error(`CSP violation of policy ${H.effectiveDirective} ${H.blockedURI}. Current policy is ${H.originalPolicy}`);i.b.UseFallbackTexture=!1,v(c),g&&m.src&&URL.revokeObjectURL(m.src),m.src=""}}),z.forEach((H=>{H.target.addEventListener(H.name,H.handler)}));const h="blob:"===C.substring(0,5),Q="data:"===C.substring(0,5),l=()=>{h||Q||!Z.c.IsCustomRequestAvailable?m.src=C:K(C,((H,c,y)=>{const Z=new Blob([H],{type:!P&&y?y:P}),F=URL.createObjectURL(Z);g=!0,m.src=F}),void 0,F||void 0,!0,((H,c)=>{v(c)}))},d=()=>{F&&F.loadImage(C,m)};if(!h&&!Q&&F&&F.enableTexturesOffline)F.open(d,l);else{if(-1!==C.indexOf("file:")){const H=decodeURIComponent(C.substring(5).toLowerCase());if(S.FilesToLoad[H]&&"undefined"!==typeof URL){try{let c;try{c=URL.createObjectURL(S.FilesToLoad[H])}catch(T){c=URL.createObjectURL(S.FilesToLoad[H])}m.src=c,g=!0}catch(u){m.src=""}return m}}l()}return m},d=(H,c,y,Z,F)=>{const S=new FileReader,n={onCompleteObservable:new P.e,abort:()=>S.abort()};return S.onloadend=()=>n.onCompleteObservable.notifyObservers(n),F&&(S.onerror=()=>{F(new Q(`Unable to read ${H.name}`,H))}),S.onload=H=>{c(H.target.result)},y&&(S.onprogress=y),Z?S.readAsArrayBuffer(H):S.readAsText(H),n},K=(H,c,y,Z,F,O,a)=>{if(H.name)return d(H,c,y,F,O?H=>{O(void 0,H)}:void 0);const i=H;if(-1!==i.indexOf("file:")){let H=decodeURIComponent(i.substring(5).toLowerCase());0===H.indexOf("./")&&(H=H.substring(2));const Z=S.FilesToLoad[H];if(Z)return d(Z,c,y,F,O?H=>O(void 0,new V(H.message,H.file)):void 0)}const{match:v,type:m}=U(i);if(v){const H={onCompleteObservable:new P.e,abort:()=>()=>{}};try{const H=F?G(i):p(i);c(H,void 0,m)}catch(n){O?O(void 0,n):C.d.Error(n.message||"Failed to parse the Data URL")}return g.d.SetImmediate((()=>{H.onCompleteObservable.notifyObservers(H)})),H}return T(i,((H,y)=>{c(H,null===y||void 0===y?void 0:y.responseURL,null===y||void 0===y?void 0:y.getResponseHeader("content-type"))}),y,Z,F,O?H=>{O(H.request,new V(H.message,H.request))}:void 0,a)},T=(H,c,y,S,n,O,a)=>{H=D.CleanUrl(H),H=D.PreprocessUrl(H);const i=D.BaseUrl+H;let g=!1;const v={onCompleteObservable:new P.e,abort:()=>g=!0},m=()=>{let H,P=new Z.c,S=null;const m=()=>{P&&(y&&P.removeEventListener("progress",y),H&&P.removeEventListener("readystatechange",H),P.removeEventListener("loadend",z))};let z=()=>{m(),v.onCompleteObservable.notifyObservers(v),v.onCompleteObservable.clear(),y=void 0,H=null,z=null,O=void 0,a=void 0,c=void 0};v.abort=()=>{g=!0,z&&z(),P&&P.readyState!==(XMLHttpRequest.DONE||4)&&P.abort(),null!==S&&(clearTimeout(S),S=null),P=null};const V=H=>{const c=H.message||"Unknown error";O&&P?O(new h(c,P)):C.d.Error(c)},Q=C=>{if(P){if(P.open("GET",i),a)try{a(P)}catch(v){return void V(v)}n&&(P.responseType="arraybuffer"),y&&P.addEventListener("progress",y),z&&P.addEventListener("loadend",z),H=()=>{if(!g&&P&&P.readyState===(XMLHttpRequest.DONE||4)){if(H&&P.removeEventListener("readystatechange",H),P.status>=200&&P.status<300||0===P.status&&(!(0,F.h)()||u())){try{c&&c(n?P.response:P.responseText,P)}catch(v){V(v)}return}const y=D.DefaultRetryStrategy;if(y){const H=y(i,P,C);if(-1!==H)return m(),P=new Z.c,void(S=setTimeout((()=>Q(C+1)),H))}const a=new h("Error status: "+P.status+" "+P.statusText+" - Unable to load "+i,P);O&&O(a)}},P.addEventListener("readystatechange",H),P.send()}};Q(0)};if(S&&S.enableSceneOffline){const Z=H=>{H&&H.status>400?O&&O(H):m()},F=()=>{S&&S.loadFile(D.BaseUrl+H,(H=>{!g&&c&&c(H),v.onCompleteObservable.notifyObservers(v)}),y?H=>{!g&&y&&y(H)}:void 0,Z,n)};S.open(F,Z)}else m();return v},u=()=>"undefined"!==typeof location&&"file:"===location.protocol,E=H=>z.test(H),U=H=>{const c=z.exec(H);if(null===c||0===c.length)return{match:!1,type:""};return{match:!0,type:c[0].replace("data:","").replace("base64,","")}};function G(H){return(0,O.c)(H.split(",")[1])}const p=H=>(0,O.d)(H.split(",")[1]);let t;m.e._FileToolsLoadImage=l,v.c.loadFile=K,a.g.loadFile=K;((H,c,y,Z,F,P,S,n,O,a)=>{t={DecodeBase64UrlToBinary:H,DecodeBase64UrlToString:c,DefaultRetryStrategy:y.DefaultRetryStrategy,BaseUrl:y.BaseUrl,CorsBehavior:y.CorsBehavior,PreprocessUrl:y.PreprocessUrl,IsBase64DataUrl:Z,IsFileURL:F,LoadFile:P,LoadImage:S,ReadFile:n,RequestFile:O,SetCorsBehavior:a},Object.defineProperty(t,"DefaultRetryStrategy",{get:function(){return y.DefaultRetryStrategy},set:function(H){y.DefaultRetryStrategy=H}}),Object.defineProperty(t,"BaseUrl",{get:function(){return y.BaseUrl},set:function(H){y.BaseUrl=H}}),Object.defineProperty(t,"PreprocessUrl",{get:function(){return y.PreprocessUrl},set:function(H){y.PreprocessUrl=H}}),Object.defineProperty(t,"CorsBehavior",{get:function(){return y.CorsBehavior},set:function(H){y.CorsBehavior=H}})})(G,p,D,E,u,K,l,d,T,f)},10901:(H,c,y)=>{"use strict";function Z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(H=>{const c=16*Math.random()|0;return("x"===H?c:3&c|8).toString(16)}))}y.d(c,{e:()=>Z})},10890:(H,c,y)=>{"use strict";y.d(c,{b:()=>P});var Z=y(10773),F=y(10893);class P{static Instantiate(H){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[H])return this.RegisteredExternalClasses[H];const c=(0,F.c)(H);if(c)return c;Z.d.Warn(H+" not found, you may have missed an import.");const y=H.split(".");let P=window||this;for(let Z=0,F=y.length;Z<F;Z++)P=P[y[Z]];return"function"!==typeof P?null:P}}P.RegisteredExternalClasses={}},10773:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z});class Z{static _CheckLimit(H,c){let y=Z._LogLimitOutputs[H];return y?y.current++:(y={limit:c,current:1},Z._LogLimitOutputs[H]=y),y.current<=y.limit}static _GenerateLimitMessage(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const y=Z._LogLimitOutputs[H];if(!y||!Z.MessageLimitReached)return;const F=this._Levels[c];y.current===y.limit&&Z[F.name](Z.MessageLimitReached.replace(/%LIMIT%/g,""+y.limit).replace(/%TYPE%/g,F.name??""))}static _AddLogEntry(H){Z._LogCache=H+Z._LogCache,Z.OnNewCacheEntry&&Z.OnNewCacheEntry(H)}static _FormatMessage(H){const c=H=>H<10?"0"+H:""+H,y=new Date;return"["+c(y.getHours())+":"+c(y.getMinutes())+":"+c(y.getSeconds())+"]: "+H}static _LogDisabled(H,c){}static _LogEnabled(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const F=Array.isArray(c)?c[0]:c;if(void 0!==y&&!Z._CheckLimit(F,y))return;const P=Z._FormatMessage(F),S=this._Levels[H],n=Array.isArray(c)?c.slice(1):[];S.logFunc&&S.logFunc("BJS - "+P,...n);const O=`<div style='color:${S.color}'>${P}</div><br>`;Z._AddLogEntry(O),Z._GenerateLimitMessage(F,H)}static get LogCache(){return Z._LogCache}static ClearLogCache(){Z._LogCache="",Z._LogLimitOutputs={},Z.errorsCount=0}static set LogLevels(H){Z.Log=Z._LogDisabled,Z.Warn=Z._LogDisabled,Z.Error=Z._LogDisabled,[Z.MessageLogLevel,Z.WarningLogLevel,Z.ErrorLogLevel].forEach((c=>{if((H&c)===c){const H=this._Levels[c];Z[H.name]=Z._LogEnabled.bind(Z,c)}}))}}Z.NoneLogLevel=0,Z.MessageLogLevel=1,Z.WarningLogLevel=2,Z.ErrorLogLevel=4,Z.AllLogLevel=7,Z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Z._LogCache="",Z._LogLimitOutputs={},Z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Z.errorsCount=0,Z.Log=Z._LogEnabled.bind(Z,Z.MessageLogLevel),Z.Warn=Z._LogEnabled.bind(Z,Z.WarningLogLevel),Z.Error=Z._LogEnabled.bind(Z,Z.ErrorLogLevel)},10763:(H,c,y)=>{"use strict";y.d(c,{e:()=>P});class Z{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;this.initialize(H,c,y,Z)}initialize(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;return this.mask=H,this.skipNextObservers=c,this.target=y,this.currentTarget=Z,this}}class F{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=H,this.mask=c,this.scope=y,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class P{static FromPromise(H,c){const y=new P;return H.then((H=>{y.notifyObservers(H)})).catch((H=>{if(!c)throw H;c.notifyObservers(H)})),y}get observers(){return this._observers}constructor(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Z(0),H&&(this._onObserverAdded=H)}add(H){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!H)return null;const Z=new F(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return Z.unregisterOnNextCall=y,c?this._observers.unshift(Z):this._observers.push(Z),this._onObserverAdded&&this._onObserverAdded(Z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(Z,this._lastNotifiedValue),Z._remove=()=>{this.remove(Z)},Z}addOnce(H){return this.add(H,void 0,void 0,void 0,!0)}remove(H){if(!H)return!1;H._remove=null;return-1!==this._observers.indexOf(H)&&(this._deferUnregister(H),!0)}removeCallback(H,c){for(let y=0;y<this._observers.length;y++){const Z=this._observers[y];if(!Z._willBeUnregistered&&(Z.callback===H&&(!c||c===Z.scope)))return this._deferUnregister(Z),!0}return!1}_deferUnregister(H){H._willBeUnregistered||(this._numObserversMarkedAsDeleted++,H.unregisterOnNextCall=!1,H._willBeUnregistered=!0,setTimeout((()=>{this._remove(H)}),0))}_remove(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!H)return!1;const y=this._observers.indexOf(H);return-1!==y&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(y,1),!0)}makeObserverTopPriority(H){this._remove(H,!1),this._observers.unshift(H)}makeObserverBottomPriority(H){this._remove(H,!1),this._observers.push(H)}notifyObservers(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=H),!this._observers.length)return!0;const P=this._eventState;P.mask=c,P.target=y,P.currentTarget=Z,P.skipNextObservers=!1,P.lastReturnValue=H,P.userInfo=F;for(const S of this._observers)if(!S._willBeUnregistered&&(S.mask&c&&(S.unregisterOnNextCall&&this._deferUnregister(S),S.scope?P.lastReturnValue=S.callback.apply(S.scope,[H,P]):P.lastReturnValue=S.callback(H,P)),P.skipNextObservers))return!1;return!0}notifyObserver(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),H._willBeUnregistered)return;const Z=this._eventState;Z.mask=y,Z.skipNextObservers=!1,H.unregisterOnNextCall&&this._deferUnregister(H),H.callback(c,Z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const H=this._observers.pop();H&&(H._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const H=new P;return H._observers=this._observers.slice(0),H}hasSpecificMask(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&H||c.mask===H)return!0;return!1}}},10916:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});var Z=y(10790);class F{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(H,c){F.Enabled&&(this._current+=H,c&&this._fetchResult())}beginMonitoring(){F.Enabled&&(this._startMonitoringTime=Z.b.Now)}endMonitoring(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!F.Enabled)return;H&&this.fetchNewFrame();const c=Z.b.Now;this._current=c-this._startMonitoringTime,H&&this._fetchResult()}fj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const H=Z.b.Now;H-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=H,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}F.Enabled=!0},10790:(H,c,y)=>{"use strict";y.d(c,{b:()=>F});var Z=y(10768);class F{static get Now(){return(0,Z.h)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12306:(H,c,y)=>{"use strict";y.d(c,{e:()=>P});var Z=y(11650),F=y(11642);class P{static ExpandRGBDTexture(H){const c=H._texture;if(!c||!H.isRGBD)return;const F=c.getEngine(),P=F.getCaps(),S=c.isReady;let n=!1;P.textureHalfFloatRender&&P.textureHalfFloatLinearFiltering?(n=!0,c.type=2):P.textureFloatRender&&P.textureFloatLinearFiltering&&(n=!0,c.type=1),n&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const O=async()=>{const P=F.isWebGPU,S=P?1:0;c.isReady=!1,P?await Promise.all([y.e(39).then(y.bind(y,13614)),y.e(40).then(y.bind(y,13616))]):await Promise.all([y.e(41).then(y.bind(y,13621)),y.e(42).then(y.bind(y,13625))]);const n=new Z.e("rgbdDecode","rgbdDecode",null,null,1,null,3,F,!1,void 0,c.type,void 0,null,!1,void 0,S);n.externalTextureSamplerBinding=!0;const O=F.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});n.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled((()=>{n.onApply=H=>{H._bindTexture("textureSampler",c),H.setFloat2("scale",1,1)},H.va().postProcessManager.directRender([n],O,!0),F.restoreDefaultFramebuffer(),F._releaseTexture(c),n&&n.dispose(),O._swapAndDie(c),c.isReady=!0}))}))};n&&(S?O():H.onLoadObservable.addOnce(O))}static EncodeTextureToRGBD(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,F.e)("rgbdEncode",H,c,y,1,5)}}},11071:(H,c,y)=>{"use strict";y.d(c,{b:()=>F,c:()=>Z});class Z{constructor(H){this.length=0,this.data=new Array(H),this._id=Z._GlobalId++}push(H){this.data[this.length++]=H,this.length>this.data.length&&(this.data.length*=2)}forEach(H){for(let c=0;c<this.length;c++)H(this.data[c])}sort(H){this.data.sort(H)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let c=0;c<H.length;c++)this.data[this.length++]=(H.data||H)[c]}}indexOf(H){const c=this.data.indexOf(H);return c>=this.length?-1:c}contains(H){return-1!==this.indexOf(H)}}Z._GlobalId=0;class F extends Z{constructor(){super(...arguments),this._duplicateId=0}push(H){super.push(H),H.__smartArrayFlags||(H.__smartArrayFlags={}),H.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(H){return(!H.__smartArrayFlags||H.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(H),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let c=0;c<H.length;c++){const y=(H.data||H)[c];this.pushNoDuplicate(y)}}}}},10828:(H,c,y)=>{"use strict";y.d(c,{c:()=>S,d:()=>P,g:()=>Z,i:()=>F});const Z=H=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(H);let c="";for(let y=0;y<H.byteLength;y++)c+=String.fromCharCode(H[y]);return c},F=H=>{const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let y,Z,F,P,S,n,O,a="",i=0;const C=ArrayBuffer.isView(H)?new Uint8Array(H.buffer,H.byteOffset,H.byteLength):new Uint8Array(H);for(;i<C.length;)y=C[i++],Z=i<C.length?C[i++]:Number.NaN,F=i<C.length?C[i++]:Number.NaN,P=y>>2,S=(3&y)<<4|Z>>4,n=(15&Z)<<2|F>>6,O=63&F,isNaN(Z)?n=O=64:isNaN(F)&&(O=64),a+=c.charAt(P)+c.charAt(S)+c.charAt(n)+c.charAt(O);return a},P=H=>atob(H),S=H=>{const c=P(H),y=c.length,Z=new Uint8Array(new ArrayBuffer(y));for(let F=0;F<y;F++)Z[F]=c.charCodeAt(F);return Z.buffer}},11083:(H,c,y)=>{"use strict";y.d(c,{d:()=>F});class Z{static Eval(H,c){return"true"===(H=H.match(/\([^()]*\)/g)?H.replace(/\([^()]*\)/g,(H=>(H=H.slice(1,H.length-1),Z._HandleParenthesisContent(H,c)))):Z._HandleParenthesisContent(H,c))||"false"!==H&&Z.Eval(H,c)}static _HandleParenthesisContent(H,c){let y;c=c||(H=>"true"===H);const F=H.split("||");for(const P in F)if(Object.prototype.hasOwnProperty.call(F,P)){let H=Z._SimplifyNegation(F[P].trim());const S=H.split("&&");if(S.length>1)for(let F=0;F<S.length;++F){const P=Z._SimplifyNegation(S[F].trim());if(y="true"!==P&&"false"!==P?"!"===P[0]?!c(P.substring(1)):c(P):"true"===P,!y){H="false";break}}if(y||"true"===H){y=!0;break}y="true"!==H&&"false"!==H?"!"===H[0]?!c(H.substring(1)):c(H):"true"===H}return y?"true":"false"}static _SimplifyNegation(H){return"!true"===(H=(H=H.replace(/^[\s!]+/,(H=>(H=H.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?H="false":"!false"===H&&(H="true"),H}}class F{static EnableFor(H){H._tags=H._tags||{},H.hasTags=()=>F.HasTags(H),H.addTags=c=>F.AddTagsTo(H,c),H.removeTags=c=>F.RemoveTagsFrom(H,c),H.matchesTagsQuery=c=>F.MatchesQuery(H,c)}static DisableFor(H){delete H._tags,delete H.hasTags,delete H.addTags,delete H.removeTags,delete H.matchesTagsQuery}static HasTags(H){if(!H._tags)return!1;const c=H._tags;for(const y in c)if(Object.prototype.hasOwnProperty.call(c,y))return!0;return!1}static GetTags(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!H._tags)return null;if(c){const c=[];for(const y in H._tags)Object.prototype.hasOwnProperty.call(H._tags,y)&&!0===H._tags[y]&&c.push(y);return c.join(" ")}return H._tags}static AddTagsTo(H,c){if(!c)return;if("string"!==typeof c)return;c.split(" ").forEach((function(c){F._AddTagTo(H,c)}))}static _AddTagTo(H,c){""!==(c=c.trim())&&"true"!==c&&"false"!==c&&(c.match(/[\s]/)||c.match(/^([!]|([|]|[&]){2})/)||(F.EnableFor(H),H._tags[c]=!0))}static RemoveTagsFrom(H,c){if(!F.HasTags(H))return;const y=c.split(" ");for(const Z in y)F._RemoveTagFrom(H,y[Z])}static _RemoveTagFrom(H,c){delete H._tags[c]}static MatchesQuery(H,c){return void 0===c||(""===c?F.HasTags(H):Z.Eval(c,(c=>F.HasTags(H)&&H._tags[c])))}}},11642:(H,c,y)=>{"use strict";y.d(c,{e:()=>O,i:()=>g,m:()=>C});y(11304),y(11646);var Z=y(11650),F=y(10850),P=y(10893),S=y(11118);class n extends Z.e{getClassName(){return"PassPostProcess"}constructor(H,c){super(H,"pass",null,null,c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(H,c){H?(this._webGPUReady=!0,c.push(Promise.all([y.e(33).then(y.bind(y,13579))]))):c.push(Promise.all([y.e(34).then(y.bind(y,13584))])),super._gatherImports(H,c)}static _Parse(H,c,y,Z){return S.e.Parse((()=>new n(H.name,H.options,c,H.renderTargetSamplingMode,H._engine,H.reusable)),H,y,Z)}}(0,P.d)("BABYLON.PassPostProcess",n);Z.e;function O(H,c,y,F,P,S,n,O){const a=c.getEngine();return c.isReady=!1,P=P??c.samplingMode,F=F??c.type,S=S??c.format,n=n??c.width,O=O??c.height,-1===F&&(F=0),new Promise((i=>{const C=new Z.e("postprocess",H,null,null,1,null,P,a,!1,void 0,F,void 0,null,!1,S);C.externalTextureSamplerBinding=!0;const g=a.createRenderTargetTexture({width:n,height:O},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:P,type:F,format:S});C.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled((()=>{C.onApply=H=>{H._bindTexture("textureSampler",c),H.setFloat2("scale",1,1)},y.postProcessManager.directRender([C],g,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(c),C&&C.dispose(),g._swapAndDie(c),c.type=F,c.format=5,c.isReady=!0,i(c)}))}))}))}let a,i;function C(H){a||(a=new Float32Array(1),i=new Int32Array(a.buffer)),a[0]=H;const c=i[0];let y=c>>16&32768,Z=c>>12&2047;const F=c>>23&255;return F<103?y:F>142?(y|=31744,y|=(255==F?0:1)&&8388607&c,y):F<113?(Z|=2048,y|=(Z>>114-F)+(Z>>113-F&1),y):(y|=F-112<<10|Z>>1,y+=1&Z,y)}function g(H){const c=(32768&H)>>15,y=(31744&H)>>10,Z=1023&H;return 0===y?(c?-1:1)*Math.pow(2,-14)*(Z/Math.pow(2,10)):31==y?Z?NaN:1/0*(c?-1:1):(c?-1:1)*Math.pow(2,y-15)*(1+Z/Math.pow(2,10))}F.e._RescalePostProcessFactory=H=>new n("rescale",1,null,2,H,!1,0)},10847:(H,c,y)=>{"use strict";y.d(c,{d:()=>F});var Z=y(10768);class F{static SetImmediate(H){(0,Z.h)()&&window.setImmediate?window.setImmediate(H):setTimeout(H,1)}}},10908:(H,c,y)=>{"use strict";function Z(H){let c=1;do{c*=2}while(c<H);return c===H}function F(H,c,y){return H*(1-y)+c*y}function P(H){const c=S(H),y=n(H);return c-H>H-y?y:c}function S(H){return H--,H|=H>>1,H|=H>>2,H|=H>>4,H|=H>>8,H|=H>>16,++H}function n(H){return H|=H>>1,H|=H>>2,H|=H>>4,H|=H>>8,(H|=H>>16)-(H>>1)}function O(H,c){let y;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:y=n(H);break;case 2:y=P(H);break;default:y=S(H)}return Math.min(y,c)}y.d(c,{b:()=>n,c:()=>O,g:()=>Z,k:()=>F,l:()=>P})},10754:(H,c,y)=>{"use strict";y.d(c,{b:()=>h,c:()=>V});var Z=y(10763),F=y(10768),P=y(10773),S=y(10781),n=y(10790),O=y(10798),a=y(10805),i=y(10810),C=y(10819),g=y(10847),v=y(10890),m=y(10901),z=y(10908);class V{static get BaseUrl(){return C.f.BaseUrl}static set BaseUrl(H){C.f.BaseUrl=H}static get CleanUrl(){return C.f.CleanUrl}static set CleanUrl(H){C.f.CleanUrl=H}static IsAbsoluteUrl(H){return 0===H.indexOf("//")||-1!==H.indexOf("://")&&(-1!==H.indexOf(".")&&(-1!==H.indexOf("/")&&(!(H.indexOf(":")>H.indexOf("/"))&&(H.indexOf("://")<H.indexOf(".")||(0===H.indexOf("data:")||0===H.indexOf("blob:"))))))}static set ScriptBaseUrl(H){C.f.ScriptBaseUrl=H}static get ScriptBaseUrl(){return C.f.ScriptBaseUrl}static set ScriptPreprocessUrl(H){C.f.ScriptPreprocessUrl=H}static get ScriptPreprocessUrl(){return C.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return C.f.DefaultRetryStrategy}static set DefaultRetryStrategy(H){C.f.DefaultRetryStrategy=H}static get CorsBehavior(){return C.f.CorsBehavior}static set CorsBehavior(H){C.f.CorsBehavior=H}static get UseFallbackTexture(){return i.b.UseFallbackTexture}static set UseFallbackTexture(H){i.b.UseFallbackTexture=H}static get RegisteredExternalClasses(){return v.b.RegisteredExternalClasses}static set RegisteredExternalClasses(H){v.b.RegisteredExternalClasses=H}static get fallbackTexture(){return i.b.FallbackTexture}static set fallbackTexture(H){i.b.FallbackTexture=H}static FetchToRef(H,c,y,Z,F,P){const S=4*((Math.abs(H)*y%y|0)+(Math.abs(c)*Z%Z|0)*y);P.r=F[S]/255,P.g=F[S+1]/255,P.b=F[S+2]/255,P.a=F[S+3]/255}static Mix(H,c,y){return 0}static Instantiate(H){return v.b.Instantiate(H)}static SetImmediate(H){g.d.SetImmediate(H)}static IsExponentOfTwo(H){return!0}static FloatRound(H){return Math.fround(H)}static GetFilename(H){const c=H.lastIndexOf("/");return c<0?H:H.substring(c+1)}static GetFolderPath(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=H.lastIndexOf("/");return y<0?c?H:"":H.substring(0,y+1)}static ToDegrees(H){return 180*H/Math.PI}static ToRadians(H){return H*Math.PI/180}static SmoothAngleChange(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const Z=this.ToRadians(H),F=this.ToRadians(c);return this.ToDegrees(Math.atan2((1-y)*Math.sin(F)+y*Math.sin(Z),(1-y)*Math.cos(F)+y*Math.cos(Z)))}static MakeArray(H,c){return!0===c||void 0!==H&&null!=H?Array.isArray(H)?H:[H]:null}static GetPointerPrefix(H){return(0,F.h)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(H,c){(0,C.x)(H,c)}static SetReferrerPolicyBehavior(H,c){c.referrerPolicy=H}static get PreprocessUrl(){return C.f.PreprocessUrl}static set PreprocessUrl(H){C.f.PreprocessUrl=H}static LoadImage(H,c,y,Z,F,P){return(0,C.q)(H,c,y,Z,F,P)}static LoadFile(H,c,y,Z,F,P){return(0,C.n)(H,c,y,Z,F,P)}static LoadFileAsync(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((y,Z)=>{(0,C.n)(H,(H=>{y(H)}),void 0,void 0,c,((H,c)=>{Z(c)}))}))}static GetBabylonScriptURL(H,c){if(!H)return"";if(V.ScriptBaseUrl&&H.startsWith(V._DefaultCdnUrl)){const c="/"===V.ScriptBaseUrl[V.ScriptBaseUrl.length-1]?V.ScriptBaseUrl.substring(0,V.ScriptBaseUrl.length-1):V.ScriptBaseUrl;H=H.replace(V._DefaultCdnUrl,c)}return H=V.ScriptPreprocessUrl(H),c&&(H=V.GetAbsoluteUrl(H)),H}static LoadBabylonScript(H,c,y,Z){H=V.GetBabylonScriptURL(H),V.LoadScript(H,c,y)}static LoadBabylonScriptAsync(H){return H=V.GetBabylonScriptURL(H),V.LoadScriptAsync(H)}static LoadScript(H,c,y,Z){let P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(H),c&&c()}catch(O){null===y||void 0===y||y(`Unable to load script '${H}' in worker`,O)}return}if(!(0,F.h)())return void(null===y||void 0===y||y(`Cannot load script '${H}' outside of a window or a worker`));const S=document.getElementsByTagName("head")[0],n=document.createElement("script");P?(n.setAttribute("type","module"),n.innerText=H):(n.setAttribute("type","text/javascript"),n.setAttribute("src",H)),Z&&(n.id=Z),n.onload=()=>{c&&c()},n.onerror=c=>{y&&y(`Unable to load script '${H}'`,c)},S.appendChild(n)}static LoadScriptAsync(H,c){return new Promise(((y,Z)=>{this.LoadScript(H,(()=>{y()}),((H,c)=>{Z(c||new Error(H))}),c)}))}static ReadFileAsDataURL(H,c,y){const F=new FileReader,P={onCompleteObservable:new Z.e,abort:()=>F.abort()};return F.onloadend=()=>{P.onCompleteObservable.notifyObservers(P)},F.onload=H=>{c(H.target.result)},F.onprogress=y,F.readAsDataURL(H),P}static ReadFile(H,c,y,Z,F){return(0,C.u)(H,c,y,Z,F)}static FileAsURL(H){const c=new Blob([H]);return window.URL.createObjectURL(c)}static Format(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return H.toFixed(c)}static DeepCopy(H,c,y,Z){S.c.DeepCopy(H,c,y,Z)}static IsEmpty(H){for(const c in H)if(Object.prototype.hasOwnProperty.call(H,c))return!1;return!0}static RegisterTopRootEvents(H,c){for(let Z=0;Z<c.length;Z++){const F=c[Z];H.addEventListener(F.name,F.handler,!1);try{window.parent&&window.parent.addEventListener(F.name,F.handler,!1)}catch(y){}}}static UnregisterTopRootEvents(H,c){for(let Z=0;Z<c.length;Z++){const F=c[Z];H.removeEventListener(F.name,F.handler);try{H.parent&&H.parent.removeEventListener(F.name,F.handler)}catch(y){}}}static async DumpFramebuffer(H,c,y,Z){throw(0,O.b)("DumpTools")}static DumpData(H,c,y,Z){throw(0,O.b)("DumpTools")}static DumpDataAsync(H,c,y){throw(0,O.b)("DumpTools")}static _IsOffScreenCanvas(H){return void 0!==H.convertToBlob}static ToBlob(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",Z=arguments.length>3?arguments[3]:void 0;V._IsOffScreenCanvas(H)||H.toBlob||(H.toBlob=function(H,c,y){setTimeout((()=>{const Z=atob(this.toDataURL(c,y).split(",")[1]),F=Z.length,P=new Uint8Array(F);for(let H=0;H<F;H++)P[H]=Z.charCodeAt(H);H(new Blob([P]))}))}),V._IsOffScreenCanvas(H)?H.convertToBlob({type:y,quality:Z}).then((H=>c(H))):H.toBlob((function(H){c(H)}),y,Z)}static DownloadBlob(H,c){if("download"in document.createElement("a")){if(!c){const H=new Date;c="screenshot_"+((H.getFullYear()+"-"+(H.getMonth()+1)).slice(2)+"-"+H.getDate()+"_"+H.getHours()+"-"+("0"+H.getMinutes()).slice(-2))+".png"}V.Download(H,c)}else if(H&&"undefined"!==typeof URL){const c=URL.createObjectURL(H),y=window.open("");if(!y)return;const Z=y.document.createElement("img");Z.onload=function(){URL.revokeObjectURL(c)},Z.src=c,y.document.body.appendChild(Z)}}static EncodeScreenshotCanvasData(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;if("string"!==typeof Z&&c){if(c){if(V._IsOffScreenCanvas(H))return void H.convertToBlob({type:y,quality:F}).then((H=>{const y=new FileReader;y.readAsDataURL(H),y.onloadend=()=>{const H=y.result;c(H)}}));const Z=H.toDataURL(y,F);c(Z)}}else this.ToBlob(H,(function(H){H&&V.DownloadBlob(H,Z),c&&c("")}),y,F)}static Download(H,c){if("undefined"===typeof URL)return;const y=window.URL.createObjectURL(H),Z=document.createElement("a");document.body.appendChild(Z),Z.style.display="none",Z.href=y,Z.download=c,Z.addEventListener("click",(()=>{Z.parentElement&&Z.parentElement.removeChild(Z)})),Z.click(),window.URL.revokeObjectURL(y)}static BackCompatCameraNoPreventDefault(H){return"boolean"===typeof H[0]?H[0]:"boolean"===typeof H[1]&&H[1]}static CreateScreenshot(H,c,y,Z){throw(0,O.b)("ScreenshotTools")}static CreateScreenshotAsync(H,c,y){throw(0,O.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(H,c,y,Z){throw(0,O.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(H,c,y){throw(0,O.b)("ScreenshotTools")}static RandomId(){return(0,m.e)()}static IsBase64(H){return(0,C.g)(H)}static DecodeBase64(H){return(0,C.c)(H)}static get errorsCount(){return P.d.errorsCount}static Log(H){P.d.Log(H)}static Warn(H){P.d.Warn(H)}static Error(H){P.d.Error(H)}static get LogCache(){return P.d.LogCache}static ClearLogCache(){P.d.ClearLogCache()}static set LogLevels(H){P.d.LogLevels=H}static set PerformanceLogLevel(H){return(H&V.PerformanceUserMarkLogLevel)===V.PerformanceUserMarkLogLevel?(V.StartPerformanceCounter=V._StartUserMark,void(V.EndPerformanceCounter=V._EndUserMark)):(H&V.PerformanceConsoleLogLevel)===V.PerformanceConsoleLogLevel?(V.StartPerformanceCounter=V._StartPerformanceConsole,void(V.EndPerformanceCounter=V._EndPerformanceConsole)):(V.StartPerformanceCounter=V._StartPerformanceCounterDisabled,void(V.EndPerformanceCounter=V._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(H,c){}static _EndPerformanceCounterDisabled(H,c){}static _StartUserMark(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V._Performance){if(!(0,F.h)())return;V._Performance=window.performance}c&&V._Performance.mark&&V._Performance.mark(H+"-Begin")}static _EndUserMark(H){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&V._Performance.mark&&(V._Performance.mark(H+"-End"),V._Performance.measure(H,H+"-Begin",H+"-End"))}static _StartPerformanceConsole(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(V._StartUserMark(H,c),console.time&&console.time(H))}static _EndPerformanceConsole(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(V._EndUserMark(H,c),console.timeEnd(H))}static get Now(){return n.b.Now}static GetClassName(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=null;if(!c&&H.getClassName)y=H.getClassName();else{if(H instanceof Object){y=(c?H:Object.getPrototypeOf(H)).constructor.__bjsclassName__}y||(y=typeof H)}return y}static First(H,c){for(const y of H)if(c(y))return y;return null}static getFullClassName(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=null,Z=null;if(!c&&H.getClassName)y=H.getClassName();else{if(H instanceof Object){const F=c?H:Object.getPrototypeOf(H);y=F.constructor.__bjsclassName__,Z=F.constructor.__bjsmoduleName__}y||(y=typeof H)}return y?(null!=Z?Z+".":"")+y:null}static DelayAsync(H){return new Promise((c=>{setTimeout((()=>{c()}),H)}))}static IsSafari(){return!!(0,F.f)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}V.UseCustomRequestHeaders=!1,V.CustomRequestHeaders=a.c.CustomRequestHeaders,V.GetDOMTextContent=F.b,V._DefaultCdnUrl="https://cdn.babylonjs.com",V.GetAbsoluteUrl="object"===typeof document?H=>{const c=document.createElement("a");return c.href=H,c.href}:"function"===typeof URL&&"object"===typeof location?H=>new URL(H,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},V.NoneLogLevel=P.d.NoneLogLevel,V.MessageLogLevel=P.d.MessageLogLevel,V.WarningLogLevel=P.d.WarningLogLevel,V.ErrorLogLevel=P.d.ErrorLogLevel,V.AllLogLevel=P.d.AllLogLevel,V.IsWindowObjectExist=F.h,V.PerformanceNoneLogLevel=0,V.PerformanceUserMarkLogLevel=1,V.PerformanceConsoleLogLevel=2,V.StartPerformanceCounter=V._StartPerformanceCounterDisabled,V.EndPerformanceCounter=V._EndPerformanceCounterDisabled;class h{constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=H,this.index=Z-1,this._done=!1,this._fn=c,this._successCallback=y}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(H,c,y){const Z=new h(H,c,y,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return Z.executeNext(),Z}static SyncAsyncForLoop(H,c,y,Z,F){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return h.Run(Math.ceil(H/c),(Z=>{F&&F()?Z.breakLoop():setTimeout((()=>{for(let P=0;P<c;++P){const S=Z.index*c+P;if(S>=H)break;if(y(S),F&&F()){Z.breakLoop();break}}Z.executeNext()}),P)}),Z)}}V.Mix=z.k,V.IsExponentOfTwo=z.g,i.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10893:(H,c,y)=>{"use strict";y.d(c,{c:()=>P,d:()=>F});const Z={};function F(H,c){Z[H]=c}function P(H){return Z[H]}},11220:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{static get UniqueId(){const H=this._UniqueIdCounter;return this._UniqueIdCounter++,H}}Z._UniqueIdCounter=1},10805:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(Z.CustomRequestHeaders).length>0||Z.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const H in Z.CustomRequestHeaders){const c=Z.CustomRequestHeaders[H];c&&this._xhr.setRequestHeader(H,c)}}_shouldSkipRequestModifications(H){return Z.SkipRequestModificationForBabylonCDN&&(H.includes("preview.babylonjs.com")||H.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(H){this._xhr.onprogress=H}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(H){this._xhr.responseType=H}get timeout(){return this._xhr.timeout}set timeout(H){this._xhr.timeout=H}addEventListener(H,c,y){this._xhr.addEventListener(H,c,y)}removeEventListener(H,c,y){this._xhr.removeEventListener(H,c,y)}abort(){this._xhr.abort()}send(H){Z.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(H)}open(H,c){for(const y of Z.CustomRequestModifiers){if(this._shouldSkipRequestModifications(c))return;y(this._xhr,c)}c=(c=c.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=c,this._xhr.open(H,c,!0)}setRequestHeader(H,c){this._xhr.setRequestHeader(H,c)}getResponseHeader(H){return this._xhr.getResponseHeader(H)}}Z.CustomRequestHeaders={},Z.CustomRequestModifiers=new Array,Z.SkipRequestModificationForBabylonCDN=!0},12372:(H,c,y)=>{"use strict";y.d(c,{d:()=>F});class Z{constructor(H){this._pendingActions=new Array,this._workerInfos=H.map((H=>({workerPromise:Promise.resolve(H),idle:!0})))}dispose(){for(const H of this._workerInfos)H.workerPromise.then((H=>{H.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(H){this._executeOnIdleWorker(H)||this._pendingActions.push(H)}_executeOnIdleWorker(H){for(const c of this._workerInfos)if(c.idle)return this._execute(c,H),!0;return!1}_execute(H,c){H.idle=!1,H.workerPromise.then((y=>{c(y,(()=>{const c=this._pendingActions.shift();c?this._execute(H,c):H.idle=!0}))}))}}class F extends Z{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.DefaultOptions;super([]),this._maxWorkers=H,this._createWorkerAsync=c,this._options=y}push(H){if(!this._executeOnIdleWorker(H))if(this._workerInfos.length<this._maxWorkers){const c={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(c),this._execute(c,H)}else this._pendingActions.push(H)}_execute(H,c){H.timeoutId&&(clearTimeout(H.timeoutId),delete H.timeoutId),super._execute(H,((y,Z)=>{c(y,(()=>{Z(),H.idle&&(H.timeoutId=setTimeout((()=>{H.workerPromise.then((H=>{H.terminate()}));const c=this._workerInfos.indexOf(H);-1!==c&&this._workerInfos.splice(c,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}F.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11521:(H,c,y)=>{"use strict";y.d(c,{e:()=>hH});var Z=y(11092),F=y(11293);class P extends F.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var S=y(11112),n=(y(11526),y(10893));class O{get noiseTexture(){return this._noiseTexture}set noiseTexture(H){this._noiseTexture!==H&&(this._noiseTexture=H,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(H){this._isAnimationSheetEnabled!=H&&(this._isAnimationSheetEnabled=H,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(H){this._useLogarithmicDepth=H&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Z.n.Zero()}set direction1(H){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=H)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Z.n.Zero()}set direction2(H){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=H)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Z.n.Zero()}set minEmitBox(H){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=H)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Z.n.Zero()}set maxEmitBox(H){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=H)}get billboardMode(){return this._billboardMode}set billboardMode(H){this._billboardMode!==H&&(this._billboardMode=H,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(H){this._isBillboardBased!==H&&(this._isBillboardBased=H,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(H){this._attachImageProcessingConfiguration(H)}_attachImageProcessingConfiguration(H){H!==this._imageProcessingConfiguration&&(!H&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=H)}_reset(){}_removeGradientAndTexture(H,c,y){if(!c)return this;let Z=0;for(const F of c){if(F.gradient===H){c.splice(Z,1);break}Z++}return y&&y.dispose(),this}constructor(H){this.animations=[],this.renderingGroupId=0,this.j=Z.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Z.n(10,10,10),this.onAnimationEnd=null,this.blendMode=O.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Z.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Uf=new Z.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Z.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new S.h(1,1,1,1),this.color2=new S.h(1,1,1,1),this.colorDead=new S.h(0,0,0,1),this.textureMask=new S.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new P,this.id=H,this.name=H}createPointEmitter(H,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Z.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Z.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Z.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Z.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Z.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Z.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(H,c,y,Z){throw new Error("Method not implemented.")}}O.BLENDMODE_ONEONE=0,O.BLENDMODE_STANDARD=1,O.BLENDMODE_ADD=2,O.BLENDMODE_MULTIPLY=3,O.BLENDMODE_MULTIPLYADD=4,(0,n.d)("BABYLON.BaseParticleSystem",O);var a=y(11106),i=y(10781);class C{constructor(){this.direction1=new Z.n(0,1,0),this.direction2=new Z.n(0,1,0),this.minEmitBox=new Z.n(-.5,-.5,-.5),this.maxEmitBox=new Z.n(.5,.5,.5)}startDirectionFunction(H,c,y,F){const P=(0,a.x)(this.direction1.x,this.direction2.x),S=(0,a.x)(this.direction1.y,this.direction2.y),n=(0,a.x)(this.direction1.z,this.direction2.z);if(F)return c.x=P,c.y=S,void(c.z=n);Z.n.TransformNormalFromFloatsToRef(P,S,n,H,c)}startPositionFunction(H,c,y,F){const P=(0,a.x)(this.minEmitBox.x,this.maxEmitBox.x),S=(0,a.x)(this.minEmitBox.y,this.maxEmitBox.y),n=(0,a.x)(this.minEmitBox.z,this.maxEmitBox.z);if(F)return c.x=P,c.y=S,void(c.z=n);Z.n.TransformCoordinatesFromFloatsToRef(P,S,n,H,c)}clone(){const H=new C;return i.c.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2),H.setVector3("minEmitBox",this.minEmitBox),H.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3),H.addUniform("minEmitBox",3),H.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.ij(),H.direction2=this.direction2.ij(),H.minEmitBox=this.minEmitBox.ij(),H.maxEmitBox=this.maxEmitBox.ij(),H}parse(H){Z.n.FromArrayToRef(H.direction1,0,this.direction1),Z.n.FromArrayToRef(H.direction2,0,this.direction2),Z.n.FromArrayToRef(H.minEmitBox,0,this.minEmitBox),Z.n.FromArrayToRef(H.maxEmitBox,0,this.maxEmitBox)}}class g{get radius(){return this._radius}set radius(H){this._radius=H,this._buildHeight()}get angle(){return this._angle}set angle(H){this._angle=H,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=H}startDirectionFunction(H,c,y,F){F?Z.h.o[0].p(y._d).normalize():y.position.subtractToRef(H.getTranslation(),Z.h.o[0]).normalize();const P=(0,a.x)(0,this.directionRandomizer),S=(0,a.x)(0,this.directionRandomizer),n=(0,a.x)(0,this.directionRandomizer);c.x=Z.h.o[0].x+P,c.y=Z.h.o[0].y+S,c.z=Z.h.o[0].z+n,c.normalize()}startPositionFunction(H,c,y,F){const P=(0,a.x)(0,2*Math.PI);let S;this.emitFromSpawnPointOnly?S=1e-4:(S=(0,a.x)(0,this.heightRange),S=1-S*S);let n=this._radius-(0,a.x)(0,this._radius*this.radiusRange);n*=S;const O=n*Math.sin(P),i=n*Math.cos(P),C=S*this._height;if(F)return c.x=O,c.y=C,void(c.z=i);Z.n.TransformCoordinatesFromFloatsToRef(O,C,i,H,c)}clone(){const H=new g(this._radius,this._angle,this.directionRandomizer);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat2("radius",this._radius,this.radiusRange),H.setFloat("coneAngle",this._angle),H.setFloat2("height",this._height,this.heightRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",2),H.addUniform("coneAngle",1),H.addUniform("height",2),H.addUniform("directionRandomizer",1)}getEffectDefines(){let H="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(H+="\n#define CONEEMITTERSPAWNPOINT"),H}getClassName(){return"ConeParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this._radius,H.angle=this._angle,H.directionRandomizer=this.directionRandomizer,H.radiusRange=this.radiusRange,H.heightRange=this.heightRange,H.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,H}parse(H){this.radius=H.radius,this.angle=H.angle,this.directionRandomizer=H.directionRandomizer,this.radiusRange=void 0!==H.radiusRange?H.radiusRange:1,this.heightRange=void 0!==H.radiusRange?H.heightRange:1,this.emitFromSpawnPointOnly=void 0!==H.emitFromSpawnPointOnly&&H.emitFromSpawnPointOnly}}class v extends g{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0);super(H,c),this.direction1=y,this.direction2=F}startDirectionFunction(H,c){const y=(0,a.x)(this.direction1.x,this.direction2.x),F=(0,a.x)(this.direction1.y,this.direction2.y),P=(0,a.x)(this.direction1.z,this.direction2.z);Z.n.TransformNormalFromFloatsToRef(y,F,P,H,c)}clone(){const H=new v(this.radius,this.angle,this.direction1,this.direction2);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.ij(),H.direction2=this.direction2.ij(),H}parse(H){super.parse(H),this.direction1.p(H.direction1),this.direction2.p(H.direction2)}}class m{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=H,this.height=c,this.radiusRange=y,this.directionRandomizer=F,this._tempVector=Z.n.Zero()}startDirectionFunction(H,c,y,F,P){y.position.subtractToRef(H.getTranslation(),this._tempVector),this._tempVector.normalize(),Z.n.TransformNormalToRef(this._tempVector,P,this._tempVector);const S=(0,a.x)(-this.directionRandomizer/2,this.directionRandomizer/2);let n=Math.atan2(this._tempVector.x,this._tempVector.z);n+=(0,a.x)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=S,this._tempVector.x=Math.sin(n),this._tempVector.z=Math.cos(n),this._tempVector.normalize(),F?c.p(this._tempVector):Z.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,H,c)}startPositionFunction(H,c,y,F){const P=(0,a.x)(-this.height/2,this.height/2),S=(0,a.x)(0,2*Math.PI),n=(0,a.x)((1-this.radiusRange)*(1-this.radiusRange),1),O=Math.sqrt(n)*this.radius,i=O*Math.cos(S),C=O*Math.sin(S);F?c.be(i,P,C):Z.n.TransformCoordinatesFromFloatsToRef(i,P,C,H,c)}clone(){const H=new m(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.height=this.height,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.height=H.height,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class z extends m{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.n(0,1,0);super(H,c,y),this.direction1=F,this.direction2=P}startDirectionFunction(H,c,y,F){const P=(0,a.x)(this.direction1.x,this.direction2.x),S=(0,a.x)(this.direction1.y,this.direction2.y),n=(0,a.x)(this.direction1.z,this.direction2.z);F?c.be(P,S,n):Z.n.TransformNormalFromFloatsToRef(P,S,n,H,c)}clone(){const H=new z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.ij(),H.direction2=this.direction2.ij(),H}parse(H){super.parse(H),Z.n.FromArrayToRef(H.direction1,0,this.direction1),Z.n.FromArrayToRef(H.direction2,0,this.direction2)}}class V{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=c,this.directionRandomizer=y}startDirectionFunction(H,c,y,F){const P=y.position.Rc(H.getTranslation()).normalize(),S=(0,a.x)(0,this.directionRandomizer),n=(0,a.x)(0,this.directionRandomizer),O=(0,a.x)(0,this.directionRandomizer);P.x+=S,P.y+=n,P.z+=O,P.normalize(),F?c.p(P):Z.n.TransformNormalFromFloatsToRef(P.x,P.y,P.z,H,c)}startPositionFunction(H,c,y,F){const P=this.radius-(0,a.x)(0,this.radius*this.radiusRange),S=(0,a.x)(0,1),n=(0,a.x)(0,2*Math.PI),O=Math.acos(2*S-1),i=P*Math.cos(n)*Math.sin(O),C=P*Math.cos(O),g=P*Math.sin(n)*Math.sin(O);F?c.be(i,Math.abs(C),g):Z.n.TransformCoordinatesFromFloatsToRef(i,Math.abs(C),g,H,c)}clone(){const H=new V(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class h{constructor(){this.direction1=new Z.n(0,1,0),this.direction2=new Z.n(0,1,0)}startDirectionFunction(H,c,y,F){const P=(0,a.x)(this.direction1.x,this.direction2.x),S=(0,a.x)(this.direction1.y,this.direction2.y),n=(0,a.x)(this.direction1.z,this.direction2.z);F?c.be(P,S,n):Z.n.TransformNormalFromFloatsToRef(P,S,n,H,c)}startPositionFunction(H,c,y,F){F?c.be(0,0,0):Z.n.TransformCoordinatesFromFloatsToRef(0,0,0,H,c)}clone(){const H=new h;return i.c.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.ij(),H.direction2=this.direction2.ij(),H}parse(H){Z.n.FromArrayToRef(H.direction1,0,this.direction1),Z.n.FromArrayToRef(H.direction2,0,this.direction2)}}class Q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=c,this.directionRandomizer=y}startDirectionFunction(H,c,y,F){const P=y.position.Rc(H.getTranslation()).normalize(),S=(0,a.x)(0,this.directionRandomizer),n=(0,a.x)(0,this.directionRandomizer),O=(0,a.x)(0,this.directionRandomizer);P.x+=S,P.y+=n,P.z+=O,P.normalize(),F?c.p(P):Z.n.TransformNormalFromFloatsToRef(P.x,P.y,P.z,H,c)}startPositionFunction(H,c,y,F){const P=this.radius-(0,a.x)(0,this.radius*this.radiusRange),S=(0,a.x)(0,1),n=(0,a.x)(0,2*Math.PI),O=Math.acos(2*S-1),i=P*Math.cos(n)*Math.sin(O),C=P*Math.cos(O),g=P*Math.sin(n)*Math.sin(O);F?c.be(i,C,g):Z.n.TransformCoordinatesFromFloatsToRef(i,C,g,H,c)}clone(){const H=new Q(this.radius,this.directionRandomizer);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class D extends Q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.n(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0);super(H),this.direction1=c,this.direction2=y}startDirectionFunction(H,c){const y=(0,a.x)(this.direction1.x,this.direction2.x),F=(0,a.x)(this.direction1.y,this.direction2.y),P=(0,a.x)(this.direction1.z,this.direction2.z);Z.n.TransformNormalFromFloatsToRef(y,F,P,H,c)}clone(){const H=new D(this.radius,this.direction1,this.direction2);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.ij(),H.direction2=this.direction2.ij(),H}parse(H){super.parse(H),this.direction1.p(H.direction1),this.direction2.p(H.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(H,c,y,F){const P=Z.h.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,y,P);const H=Z.h.o[1];P.subtractToRef(y.position,H),H.scaleToRef(1/y.lifeTime,P)}else P.set(0,0,0);F?c.p(P):Z.n.TransformNormalToRef(P,H,c)}startPositionFunction(H,c,y,F){const P=Z.h.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,y,P):P.set(0,0,0),F?c.p(P):Z.n.TransformCoordinatesToRef(P,H,c)}clone(){const H=new f;return i.c.DeepCopy(this,H),H}applyToShader(H){}buildUniformLayout(H){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.particlePositionGenerator=this.particlePositionGenerator,H.particleDestinationGenerator=this.particleDestinationGenerator,H}parse(H){H.particlePositionGenerator&&(this.particlePositionGenerator=H.particlePositionGenerator),H.particleDestinationGenerator&&(this.particleDestinationGenerator=H.particleDestinationGenerator)}}var J=y(11153);class l{get mesh(){return this._mesh}set mesh(H){this._mesh!==H&&(this._mesh=H,H?(this._indices=H.Vf(),this._positions=H.getVerticesData(J.h.PositionKind),this._normals=H.getVerticesData(J.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Z.n.Zero(),this._mesh=null,this.direction1=new Z.n(0,1,0),this.direction2=new Z.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=H}startDirectionFunction(H,c,y,F){if(this.useMeshNormalsForDirection&&this._normals)return void Z.n.TransformNormalToRef(this._storedNormal,H,c);const P=(0,a.x)(this.direction1.x,this.direction2.x),S=(0,a.x)(this.direction1.y,this.direction2.y),n=(0,a.x)(this.direction1.z,this.direction2.z);F?c.be(P,S,n):Z.n.TransformNormalFromFloatsToRef(P,S,n,H,c)}startPositionFunction(H,c,y,F){if(!this._indices||!this._positions)return;const P=3*Math.random()*(this._indices.length/3)|0,S=Math.random(),n=Math.random()*(1-S),O=1-S-n,a=this._indices[P],i=this._indices[P+1],C=this._indices[P+2],g=Z.h.o[0],v=Z.h.o[1],m=Z.h.o[2],z=Z.h.o[3];Z.n.FromArrayToRef(this._positions,3*a,g),Z.n.FromArrayToRef(this._positions,3*i,v),Z.n.FromArrayToRef(this._positions,3*C,m),z.x=S*g.x+n*v.x+O*m.x,z.y=S*g.y+n*v.y+O*m.y,z.z=S*g.z+n*v.z+O*m.z,F?c.be(z.x,z.y,z.z):Z.n.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,H,c),this.useMeshNormalsForDirection&&this._normals&&(Z.n.FromArrayToRef(this._normals,3*a,g),Z.n.FromArrayToRef(this._normals,3*i,v),Z.n.FromArrayToRef(this._normals,3*C,m),this._storedNormal.x=S*g.x+n*v.x+O*m.x,this._storedNormal.y=S*g.y+n*v.y+O*m.y,this._storedNormal.z=S*g.z+n*v.z+O*m.z)}clone(){const H=new l(this.mesh);return i.c.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var H;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.ij(),c.direction2=this.direction2.ij(),c.meshId=null===(H=this.mesh)||void 0===H?void 0:H.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(H,c){Z.n.FromArrayToRef(H.direction1,0,this.direction1),Z.n.FromArrayToRef(H.direction2,0,this.direction2),H.meshId&&c&&(this.mesh=c.getLastMeshById(H.meshId)),this.useMeshNormalsForDirection=H.useMeshNormalsForDirection}}var d=y(10853);class K{_isUbo(H){return void 0!==H.addUniform}constructor(H){this._isUbo(H)?(this.setMatrix3x3=H.updateMatrix3x3.bind(H),this.setMatrix2x2=H.updateMatrix2x2.bind(H),this.setFloat=H.updateFloat.bind(H),this.setFloat2=H.updateFloat2.bind(H),this.setFloat3=H.updateFloat3.bind(H),this.setFloat4=H.updateFloat4.bind(H),this.setFloatArray=H.updateFloatArray.bind(H),this.setArray=H.updateArray.bind(H),this.setIntArray=H.updateIntArray.bind(H),this.setMatrix=H.Hj.bind(H),this.setMatrices=H.updateMatrices.bind(H),this.setVector3=H.updateVector3.bind(H),this.setVector4=H.updateVector4.bind(H),this.setColor3=H.updateColor3.bind(H),this.setColor4=H.updateColor4.bind(H),this.setDirectColor4=H.updateDirectColor4.bind(H),this.setInt=H.updateInt.bind(H),this.setInt2=H.updateInt2.bind(H),this.setInt3=H.updateInt3.bind(H),this.setInt4=H.updateInt4.bind(H)):(this.setMatrix3x3=H.setMatrix3x3.bind(H),this.setMatrix2x2=H.setMatrix2x2.bind(H),this.setFloat=H.setFloat.bind(H),this.setFloat2=H.setFloat2.bind(H),this.setFloat3=H.setFloat3.bind(H),this.setFloat4=H.setFloat4.bind(H),this.setFloatArray=H.setFloatArray.bind(H),this.setArray=H.setArray.bind(H),this.setIntArray=H.setIntArray.bind(H),this.setMatrix=H.setMatrix.bind(H),this.setMatrices=H.setMatrices.bind(H),this.setVector3=H.setVector3.bind(H),this.setVector4=H.setVector4.bind(H),this.setColor3=H.setColor3.bind(H),this.setColor4=H.setColor4.bind(H),this.setDirectColor4=H.setDirectColor4.bind(H),this.setInt=H.setInt.bind(H),this.setInt2=H.setInt2.bind(H),this.setInt3=H.setInt3.bind(H),this.setInt4=H.setInt4.bind(H))}}var T=y(10855);const u="gpuUpdateParticlesPixelShader",E="#version 300 es\nvoid main() {discard;}\n";T.e.ShadersStore[u]=E;const U="gpuUpdateParticlesVertexShader",G="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.e.ShadersStore[U]=G;(0,n.d)("BABYLON.WebGL2ParticleSystem",class{constructor(H,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=H,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var H;return(null===(H=this._updateEffect)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=H,this._updateEffect=new d.d("gpuUpdateParticles",this._updateEffectOptions,this._engine),new K(this._updateEffect)}createVertexBuffers(H,c){this._updateVAO.push(this._createUpdateVAO(H)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(H){return H}bindDrawBuffers(H,c,y){y?this._engine.bindBuffers(this._renderVertexBuffers,y,c):this._engine.bindVertexArrayObject(this._renderVAO[H],null)}preUpdateParticleBuffer(){const H=this._engine;if(this._engine.enableEffect(this._updateEffect),!H.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(H,c,y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[H],null);const Z=this._engine;Z.bindTransformFeedbackBuffer(c.getBuffer()),Z.setRasterizerState(!1),Z.beginTransformFeedback(!0),Z.drawArraysType(3,0,y),Z.endTransformFeedback(),Z.setRasterizerState(!0),Z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let H=0;H<this._updateVAO.length;H++)this._engine.releaseVertexArrayObject(this._updateVAO[H]);this._updateVAO.length=0;for(let H=0;H<this._renderVAO.length;H++)this._engine.releaseVertexArrayObject(this._renderVAO[H]);this._renderVAO.length=0}_createUpdateVAO(H){const c={};c.position=H.createVertexBuffer("position",0,3);let y=3;c.age=H.createVertexBuffer("age",y,1),y+=1,c.size=H.createVertexBuffer("size",y,3),y+=3,c.life=H.createVertexBuffer("life",y,1),y+=1,c.seed=H.createVertexBuffer("seed",y,4),y+=4,c.direction=H.createVertexBuffer("direction",y,3),y+=3,this._parent.particleEmitterType instanceof f&&(c.initialPosition=H.createVertexBuffer("initialPosition",y,3),y+=3),this._parent._colorGradientsTexture||(c.color=H.createVertexBuffer("color",y,4),y+=4),this._parent._isBillboardBased||(c.initialDirection=H.createVertexBuffer("initialDirection",y,3),y+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",y,3),y+=3,c.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",y,3),y+=3),this._parent._angularSpeedGradientsTexture?(c.angle=H.createVertexBuffer("angle",y,1),y+=1):(c.angle=H.createVertexBuffer("angle",y,2),y+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=H.createVertexBuffer("cellIndex",y,1),y+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=H.createVertexBuffer("cellStartOffset",y,1),y+=1));const Z=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Z}});class p{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Z=arguments.length>3?arguments[3]:void 0;this._engine=H,this._label=Z,this._engine._storageBuffers.push(this),this._create(c,y)}_create(H,c){this._bufferSize=H,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(H,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(H,c,y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,H,c,y)}read(H,c,y,Z){return this._engine.readFromStorageBuffer(this._buffer,H,c,y,Z)}dispose(){const H=this._engine._storageBuffers,c=H.indexOf(this);-1!==c&&(H[c]=H[H.length-1],H.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var t=y(11052),o=y(11061),s=y(11118),q=y(11304),I=y(11220),j=y(10773),k=y(10883),W=y(10916);class M{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.b}_addDuration(H,c){H<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==H?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=H):this.counter.addCount(c,!1))}}class x{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=H,this._engine=c,this.uniqueId=I.c.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new M),this._engine.getCaps().supportComputeShaders?Z.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=y,this._options={bindingsMapping:{},defines:[],...Z}):j.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):j.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Z=this._bindings[H];this._bindings[H]={type:y?0:4,object:c,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==c||Z.type!==this._bindings[H].type)}setStorageTexture(H,c){const y=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==c),this._bindings[H]={type:1,object:c,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setExternalTexture(H,c){const y=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==c),this._bindings[H]={type:6,object:c,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setVideoTexture(H,c){return!!c.externalTexture&&(this.setExternalTexture(H,c.externalTexture),!0)}setUniformBuffer(H,c){const y=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==c),this._bindings[H]={type:x._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setStorageBuffer(H,c){const y=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==c),this._bindings[H]={type:x._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setTextureSampler(H,c){const y=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!y||!c.compareSampler(y.object)),this._bindings[H]={type:5,object:c,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}isReady(){let H=this._effect;for(const F in this._bindings){const H=this._bindings[F],c=H.type,y=H.object;switch(c){case 0:case 4:case 1:if(!y.isReady())return!1;break;case 6:if(!y.isReady())return!1;break}}const c=[],y=this._shaderPath;if(this._options.defines)for(let F=0;F<this._options.defines.length;F++)c.push(this._options.defines[F]);const Z=c.join("\n");return this._cachedDefines!==Z&&(this._cachedDefines=Z,H=this._engine.createComputeEffect(y,{defines:Z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=H),!!H.isReady()}dispatch(H,c,y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,H,c,y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const y=x._BufferIsDataBuffer(H)?H:H.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,y,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const y=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(y.type){case 0:{const Z=this._samplers[c],F=y.object;var H;if(!Z||!F._texture||!Z.compareSampler(F._texture))this._samplers[c]=(new k.e).setParameters(F.wrapU,F.wrapV,F.wrapR,F.anisotropicFilteringLevel,F._texture.samplingMode,null===(H=F._texture)||void 0===H?void 0:H._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const H=y.object;H.getBuffer()!==y.buffer&&(y.buffer=H.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((F=>{const P=()=>{this.dispatch(H,c,y)?F():setTimeout(P,Z)};P()}))}serialize(){const H=s.e.Serialize(this);H.options=this._options,H.shaderPath=this._shaderPath,H.xj={},H.textures={};for(const c in this._bindings){const y=this._bindings[c],Z=y.object;switch(y.type){case 0:case 4:case 1:{const F=Z.serialize();F&&(H.textures[c]=F,H.xj[c]={type:y.type});break}}}return H}static Parse(H,c,y){const Z=s.e.Parse((()=>new x(H.name,c.getEngine(),H.shaderPath,H.options)),H,c,y);for(const F in H.textures){const P=H.xj[F],S=q.d.Parse(H.textures[F],c,y);0===P.type?Z.setTexture(F,S):4===P.type?Z.setTexture(F,S,!1):Z.setStorageTexture(F,S)}return Z}static _BufferIsDataBuffer(H){return void 0!==H.underlyingResource}}(0,t.b)([(0,o.P)()],x.prototype,"name",void 0),(0,t.b)([(0,o.P)()],x.prototype,"fastMode",void 0),(0,n.d)("BABYLON.ComputeShader",x);var R=y(11140);const A="gpuUpdateParticlesComputeShader",e="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.e.ShadersStoreWGSL[A]=e;(0,n.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(H,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=H,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var H;return(null===(H=this._updateComputeShader)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){var c;const y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(y.noiseTexture={group:1,binding:11}),this._updateComputeShader=new x("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:y,defines:H.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new R.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new K(this._simParamsComputeShader)}createVertexBuffers(H,c){this._renderVertexBuffers.push(c)}createParticleBuffer(H){const c=new p(this._engine,4*H.length,11,"ComputeShaderParticleSystemBuffer");return c.update(H),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(H,c,y){this._engine.bindBuffers(this._renderVertexBuffers[H],y,c)}preUpdateParticleBuffer(){}updateParticleBuffer(H,c,y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[H]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^H]),this._updateComputeShader.dispatch(Math.ceil(y/64))}releaseBuffers(){var H;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class r{constructor(H,c,y){this.gradient=H,this.color1=c,this.color2=y}getColorToRef(H){this.color2?S.h.LerpToRef(this.color1,this.color2,Math.random(),H):H.p(this.color1)}}class N{constructor(H,c){this.gradient=H,this.color=c}}class w{constructor(H,c,y){this.gradient=H,this.factor1=c,this.factor2=y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class L{static GetCurrentGradient(H,c,y){if(c[0].gradient>H)return void y(c[0],c[0],1);for(let F=0;F<c.length-1;F++){const Z=c[F],P=c[F+1];if(H>=Z.gradient&&H<=P.gradient){return void y(Z,P,(H-Z.gradient)/(P.gradient-Z.gradient))}}const Z=c.length-1;y(c[Z],c[Z],1)}}var b=y(10763),X=y(11558),B=y(10810);class Y{constructor(H){this.particleSystem=H,this.position=Z.n.Zero(),this.direction=Z.n.Zero(),this.color=new S.h(0,0,0,0),this.colorStep=new S.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Z.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new S.h(0,0,0,0),this._currentColor2=new S.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Y._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let H=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,H=this._randomCellOffset):H+=this._randomCellOffset);const y=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let Z;Z=this._initialSpriteCellLoop?(0,a.e)(H*c%this.lifeTime/this.lifeTime):(0,a.e)(H*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+Z*y|0}_inheritParticleInfoToSubEmitter(H){if(H.particleSystem.j.position){const c=H.particleSystem.j;if(c.position.p(this.position),H.inheritDirection){const H=Z.h.o[0];this.direction.normalizeToRef(H),c.setDirection(H,0,Math.PI/2)}}else{H.particleSystem.j.p(this.position)}this.direction.scaleToRef(H.inheritedVelocityAmount/2,Z.h.o[0]),H.particleSystem._inheritedVelocityOffset.p(Z.h.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((H=>{this._inheritParticleInfoToSubEmitter(H)}))}_reset(){this.age=0,this.id=Y._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(H){H.position.p(this.position),this._initialDirection?H._initialDirection?H._initialDirection.p(this._initialDirection):H._initialDirection=this._initialDirection.clone():H._initialDirection=null,H.direction.p(this.direction),this._d&&(H._d?H._d.p(this._d):H._d=this._d.clone()),H.color.p(this.color),H.colorStep.p(this.colorStep),H.lifeTime=this.lifeTime,H.age=this.age,H._randomCellOffset=this._randomCellOffset,H.size=this.size,H.scale.p(this.scale),H.angle=this.angle,H.angularSpeed=this.angularSpeed,H.particleSystem=this.particleSystem,H.cellIndex=this.cellIndex,H.id=this.id,H._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(H._currentColorGradient=this._currentColorGradient,H._currentColor1.p(this._currentColor1),H._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(H._currentSizeGradient=this._currentSizeGradient,H._currentSize1=this._currentSize1,H._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(H._currentAngularSpeedGradient=this._currentAngularSpeedGradient,H._currentAngularSpeed1=this._currentAngularSpeed1,H._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(H._currentVelocityGradient=this._currentVelocityGradient,H._currentVelocity1=this._currentVelocity1,H._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(H._currentLimitVelocityGradient=this._currentLimitVelocityGradient,H._currentLimitVelocity1=this._currentLimitVelocity1,H._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(H._currentDragGradient=this._currentDragGradient,H._currentDrag1=this._currentDrag1,H._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(H._initialStartSpriteCellID=this._initialStartSpriteCellID,H._initialEndSpriteCellID=this._initialEndSpriteCellID,H._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(H.remapData&&this.remapData?H.remapData.p(this.remapData):H.remapData=new Z.q(0,0,0,0)),this._randomNoiseCoordinates1&&(H._randomNoiseCoordinates1?(H._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),H._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(H._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),H._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Y._Count=0;var HH=y(11277),cH=(y(11565),y(11288)),yH=y(11285),ZH=y(11134);class FH extends O{set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}get useRampGradients(){return this._useRampGradients}set useRampGradients(H){this._useRampGradients!==H&&(this._useRampGradients=H,this._resetEffect())}get particles(){return this.sj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.sj.length}getClassName(){return"rb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[c])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new HH.b(this._engine),this._customWrappers[c].effect=H,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(H),this._emitterInverseWorldMatrix=Z.d.Identity(),this._inheritedVelocityOffset=new Z.n,this.jj=new b.e,this.onStoppedObservable=new b.e,this.sj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new S.h(0,0,0,0),this._colorDiff=new S.h(0,0,0,0),this._scaledDirection=Z.n.Zero(),this._scaledGravity=Z.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=H=>{},this.recycleParticle=H=>{const c=this.sj.pop();c!==H&&c.copyTo(H),this._stockParticles.push(c)},this._createParticle=()=>{let H;return 0!==this._stockParticles.length?(H=this._stockParticles.pop(),H._reset()):H=new Y(this),this._prepareParticle(H),H},this._shadersLoaded=!1,this._capacity=c,this._epsilon=n,this._isAnimationSheetEnabled=P,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=Z.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new HH.b(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new C;let O=null;this.updateFunction=H=>{let c=null;var y;this.noiseTexture&&(c=this.noiseTexture.getSize(),null===(y=this.noiseTexture.getContent())||void 0===y||y.then((H=>{O=H})));const F=H===this.sj;for(let P=0;P<H.length;P++){const y=H[P];let n=this._scaledUpdateSpeed;const i=y.age;if(y.age+=n,y.age>y.lifeTime){const H=y.age-i;n=(y.lifeTime-i)*n/H,y.age=y.lifeTime}const C=y.age/y.lifeTime;this._colorGradients&&this._colorGradients.length>0?L.GetCurrentGradient(C,this._colorGradients,((H,c,Z)=>{H!==y._currentColorGradient&&(y._currentColor1.p(y._currentColor2),c.getColorToRef(y._currentColor2),y._currentColorGradient=H),S.h.LerpToRef(y._currentColor1,y._currentColor2,Z,y.color)})):(y.colorStep.scaleToRef(n,this._scaledColorStep),y.color.addInPlace(this._scaledColorStep),y.color.a<0&&(y.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&L.GetCurrentGradient(C,this._angularSpeedGradients,((H,c,Z)=>{H!==y._currentAngularSpeedGradient&&(y._currentAngularSpeed1=y._currentAngularSpeed2,y._currentAngularSpeed2=c.getFactor(),y._currentAngularSpeedGradient=H),y.angularSpeed=(0,a.s)(y._currentAngularSpeed1,y._currentAngularSpeed2,Z)})),y.angle+=y.angularSpeed*n;let g=n;if(this._velocityGradients&&this._velocityGradients.length>0&&L.GetCurrentGradient(C,this._velocityGradients,((H,c,Z)=>{H!==y._currentVelocityGradient&&(y._currentVelocity1=y._currentVelocity2,y._currentVelocity2=c.getFactor(),y._currentVelocityGradient=H),g*=(0,a.s)(y._currentVelocity1,y._currentVelocity2,Z)})),y.direction.scaleToRef(g,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&L.GetCurrentGradient(C,this._limitVelocityGradients,((H,c,Z)=>{H!==y._currentLimitVelocityGradient&&(y._currentLimitVelocity1=y._currentLimitVelocity2,y._currentLimitVelocity2=c.getFactor(),y._currentLimitVelocityGradient=H);const F=(0,a.s)(y._currentLimitVelocity1,y._currentLimitVelocity2,Z);y.direction.length()>F&&y.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&L.GetCurrentGradient(C,this._dragGradients,((H,c,Z)=>{H!==y._currentDragGradient&&(y._currentDrag1=y._currentDrag2,y._currentDrag2=c.getFactor(),y._currentDragGradient=H);const F=(0,a.s)(y._currentDrag1,y._currentDrag2,Z);this._scaledDirection.scaleInPlace(1-F)})),this.isLocal&&y._d?(y._d.addInPlace(this._scaledDirection),Z.n.TransformCoordinatesToRef(y._d,this._emitterWorldMatrix,y.position)):y.position.addInPlace(this._scaledDirection),O&&c&&y._randomNoiseCoordinates1){const H=this._fetchR(y._randomNoiseCoordinates1.x,y._randomNoiseCoordinates1.y,c.width,c.height,O),F=this._fetchR(y._randomNoiseCoordinates1.z,y._randomNoiseCoordinates2.x,c.width,c.height,O),P=this._fetchR(y._randomNoiseCoordinates2.y,y._randomNoiseCoordinates2.z,c.width,c.height,O),S=Z.h.o[0],a=Z.h.o[1];S.be((2*H-1)*this.noiseStrength.x,(2*F-1)*this.noiseStrength.y,(2*P-1)*this.noiseStrength.z),S.scaleToRef(n,a),y.direction.addInPlace(a)}this.gravity.scaleToRef(n,this._scaledGravity),y.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&L.GetCurrentGradient(C,this._sizeGradients,((H,c,Z)=>{H!==y._currentSizeGradient&&(y._currentSize1=y._currentSize2,y._currentSize2=c.getFactor(),y._currentSizeGradient=H),y.size=(0,a.s)(y._currentSize1,y._currentSize2,Z)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&L.GetCurrentGradient(C,this._colorRemapGradients,((H,c,Z)=>{const F=(0,a.s)(H.factor1,c.factor1,Z),P=(0,a.s)(H.factor2,c.factor2,Z);y.remapData.x=F,y.remapData.y=P-F})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&L.GetCurrentGradient(C,this._alphaRemapGradients,((H,c,Z)=>{const F=(0,a.s)(H.factor1,c.factor1,Z),P=(0,a.s)(H.factor2,c.factor2,Z);y.remapData.z=F,y.remapData.w=P-F}))),this._isAnimationSheetEnabled&&y.updateCellIndex(),y._inheritParticleInfoToSubEmitters(),y.age>=y.lifeTime&&(this._emitFromParticle(y),y._attachedSubEmitters&&(y._attachedSubEmitters.forEach((H=>{H.particleSystem.disposeOnStop=!0,H.particleSystem.stop()})),y._attachedSubEmitters=null),this.recycleParticle(y),F&&P--)}}}serialize(H){throw new Error("Method not implemented.")}clone(H,c){throw new Error("Method not implemented.")}_addFactorGradient(H,c,y,Z){const F=new w(c,y,Z);H.push(F),H.sort(((H,c)=>H.gradient<c.gradient?-1:H.gradient>c.gradient?1:0))}_removeFactorGradient(H,c){if(!H)return;let y=0;for(const Z of H){if(Z.gradient===c){H.splice(y,1);break}y++}}addLifeTimeGradient(H,c,y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,H,c,y),this}removeLifeTimeGradient(H){return this._removeFactorGradient(this._lifeTimeGradients,H),this}addSizeGradient(H,c,y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,H,c,y),this}removeSizeGradient(H){return this._removeFactorGradient(this._sizeGradients,H),this}addColorRemapGradient(H,c,y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,H,c,y),this}removeColorRemapGradient(H){return this._removeFactorGradient(this._colorRemapGradients,H),this}addAlphaRemapGradient(H,c,y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,H,c,y),this}removeAlphaRemapGradient(H){return this._removeFactorGradient(this._alphaRemapGradients,H),this}addAngularSpeedGradient(H,c,y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,H,c,y),this}removeAngularSpeedGradient(H){return this._removeFactorGradient(this._angularSpeedGradients,H),this}addVelocityGradient(H,c,y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,H,c,y),this}removeVelocityGradient(H){return this._removeFactorGradient(this._velocityGradients,H),this}addLimitVelocityGradient(H,c,y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,H,c,y),this}removeLimitVelocityGradient(H){return this._removeFactorGradient(this._limitVelocityGradients,H),this}addDragGradient(H,c,y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,H,c,y),this}removeDragGradient(H){return this._removeFactorGradient(this._dragGradients,H),this}addEmitRateGradient(H,c,y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,H,c,y),this}removeEmitRateGradient(H){return this._removeFactorGradient(this._emitRateGradients,H),this}addStartSizeGradient(H,c,y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,H,c,y),this}removeStartSizeGradient(H){return this._removeFactorGradient(this._startSizeGradients,H),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const H=new Uint8Array(4*this._rawTextureWidth),c=S.i.gb[0];for(let y=0;y<this._rawTextureWidth;y++){const Z=y/this._rawTextureWidth;L.GetCurrentGradient(Z,this._rampGradients,((Z,F,P)=>{S.e.LerpToRef(Z.color,F.color,P,c),H[4*y]=255*c.r,H[4*y+1]=255*c.g,H[4*y+2]=255*c.b,H[4*y+3]=255}))}this._rampGradientsTexture=X.c.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((H,c)=>H.gradient<c.gradient?-1:H.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(H,c){this._rampGradients||(this._rampGradients=[]);const y=new N(H,c);return this._rampGradients.push(y),this._syncRampGradientTexture(),this}removeRampGradient(H){return this._removeGradientAndTexture(H,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(H,c,y){this._colorGradients||(this._colorGradients=[]);const Z=new r(H,c,y);return this._colorGradients.push(Z),this._colorGradients.sort(((H,c)=>H.gradient<c.gradient?-1:H.gradient>c.gradient?1:0)),this}removeColorGradient(H){if(!this._colorGradients)return this;let c=0;for(const y of this._colorGradients){if(y.gradient===H){this._colorGradients.splice(c,1);break}c++}return this}resetDrawCache(){for(const H of this._drawWrappers)if(H)for(const c of H)null===c||void 0===c||c.dispose();this._drawWrappers=[]}_fetchR(H,c,y,Z,F){return F[4*(((H=.5*Math.abs(H)+.5)*y%y|0)+((c=.5*Math.abs(c)+.5)*Z%Z|0)*y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const H=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new J.d(H,this._vertexData,!0,c);let y=0;const Z=this._vertexBuffer.createVertexBuffer(J.h.PositionKind,y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.h.PositionKind]=Z,y+=3;const F=this._vertexBuffer.createVertexBuffer(J.h.ColorKind,y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.h.ColorKind]=F,y+=4;const P=this._vertexBuffer.createVertexBuffer("angle",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=P,y+=1;const S=this._vertexBuffer.createVertexBuffer("size",y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=S,y+=2,this._isAnimationSheetEnabled){const H=this._vertexBuffer.createVertexBuffer("cellIndex",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=H,y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const H=this._vertexBuffer.createVertexBuffer("direction",y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=H,y+=3}if(this._useRampGradients){const H=this._vertexBuffer.createVertexBuffer("remapData",y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=H,y+=4}let n;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new J.d(H,c,!1,2),n=this._spriteBuffer.createVertexBuffer("offset",0,2)}else n=this._vertexBuffer.createVertexBuffer("offset",y,2,this._vertexBufferSize,this._useInstancing),y+=2;this._vertexBuffers.offset=n,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const H=[],c=[];let y=0;for(let Z=0;Z<this._capacity;Z++)H.push(y),H.push(y+1),H.push(y+2),H.push(y),H.push(y+2),H.push(y+3),c.push(y,y+1,y+1,y+2,y+2,y+3,y+3,y,y,y+3),y+=4;this._indexBuffer=this._engine.createIndexBuffer(H),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(H)setTimeout((()=>{this.start(0)}),H);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.j)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.j.Oj(!0);const H=this.noiseTexture;if(H&&H.onGeneratedObservable)H.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),H.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(H))}_postStop(H){}reset(){this._stockParticles.length=0,this.sj.length=0}_appendParticleVertex(H,c,y,F){let P=H*this._vertexBufferSize;if(this._vertexData[P++]=c.position.x+this.Uf.x,this._vertexData[P++]=c.position.y+this.Uf.y,this._vertexData[P++]=c.position.z+this.Uf.z,this._vertexData[P++]=c.color.r,this._vertexData[P++]=c.color.g,this._vertexData[P++]=c.color.b,this._vertexData[P++]=c.color.a,this._vertexData[P++]=c.angle,this._vertexData[P++]=c.scale.x*c.size,this._vertexData[P++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[P++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[P++]=c.direction.x,this._vertexData[P++]=c.direction.y,this._vertexData[P++]=c.direction.z);else if(c._initialDirection){let H=c._initialDirection;this.isLocal&&(Z.n.TransformNormalToRef(H,this._emitterWorldMatrix,Z.h.o[0]),H=Z.h.o[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[P++]=H.x,this._vertexData[P++]=H.y,this._vertexData[P++]=H.z}else{let H=c.direction;this.isLocal&&(Z.n.TransformNormalToRef(H,this._emitterWorldMatrix,Z.h.o[0]),H=Z.h.o[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[P++]=H.x,this._vertexData[P++]=H.y,this._vertexData[P++]=H.z}this._useRampGradients&&c.remapData&&(this._vertexData[P++]=c.remapData.x,this._vertexData[P++]=c.remapData.y,this._vertexData[P++]=c.remapData.z,this._vertexData[P++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===y?y=this._epsilon:1===y&&(y=1-this._epsilon),0===F?F=this._epsilon:1===F&&(F=1-this._epsilon)),this._vertexData[P++]=y,this._vertexData[P++]=F)}_prepareParticle(H){}_update(H){if(this._alive=this.sj.length>0,this.j.position){const H=this.j;this._emitterWorldMatrix=H.getWorldMatrix()}else{const H=this.j;this._emitterWorldMatrix=Z.d.Translation(H.x,H.y,H.z)}let c;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.sj);for(let y=0;y<H&&this.sj.length!==this._capacity;y++){if(c=this._createParticle(),this.sj.push(c),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const H=(0,a.e)(this._actualFrame/this.targetStopDuration);L.GetCurrentGradient(H,this._lifeTimeGradients,((y,Z)=>{const F=y,P=Z,S=F.getFactor(),n=P.getFactor(),O=(H-F.gradient)/(P.gradient-F.gradient);c.lifeTime=(0,a.s)(S,n,O)}))}else c.lifeTime=(0,a.x)(this.minLifeTime,this.maxLifeTime);const H=(0,a.x)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,c.position,c,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,c.position,c,this.isLocal),this.isLocal&&(c._d?c._d.p(c.position):c._d=c.position.clone(),Z.n.TransformCoordinatesToRef(c._d,this._emitterWorldMatrix,c.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,c.direction,c,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,c.direction,c,this.isLocal,this._emitterInverseWorldMatrix),0===H?c._initialDirection?c._initialDirection.p(c.direction):c._initialDirection=c.direction.clone():c._initialDirection=null,c.direction.scaleInPlace(H),this._sizeGradients&&0!==this._sizeGradients.length?(c._currentSizeGradient=this._sizeGradients[0],c._currentSize1=c._currentSizeGradient.getFactor(),c.size=c._currentSize1,this._sizeGradients.length>1?c._currentSize2=this._sizeGradients[1].getFactor():c._currentSize2=c._currentSize1):c.size=(0,a.x)(this.minSize,this.maxSize),c.scale.be((0,a.x)(this.minScaleX,this.maxScaleX),(0,a.x)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const H=this._actualFrame/this.targetStopDuration;L.GetCurrentGradient(H,this._startSizeGradients,((H,y,Z)=>{H!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=y.getFactor(),this._currentStartSizeGradient=H);const F=(0,a.s)(this._currentStartSize1,this._currentStartSize2,Z);c.scale.scaleInPlace(F)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(c._currentAngularSpeedGradient=this._angularSpeedGradients[0],c.angularSpeed=c._currentAngularSpeedGradient.getFactor(),c._currentAngularSpeed1=c.angularSpeed,this._angularSpeedGradients.length>1?c._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():c._currentAngularSpeed2=c._currentAngularSpeed1):c.angularSpeed=(0,a.x)(this.minAngularSpeed,this.maxAngularSpeed),c.angle=(0,a.x)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(c._currentVelocityGradient=this._velocityGradients[0],c._currentVelocity1=c._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?c._currentVelocity2=this._velocityGradients[1].getFactor():c._currentVelocity2=c._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(c._currentLimitVelocityGradient=this._limitVelocityGradients[0],c._currentLimitVelocity1=c._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?c._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():c._currentLimitVelocity2=c._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(c._currentDragGradient=this._dragGradients[0],c._currentDrag1=c._currentDragGradient.getFactor(),this._dragGradients.length>1?c._currentDrag2=this._dragGradients[1].getFactor():c._currentDrag2=c._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)c._currentColorGradient=this._colorGradients[0],c._currentColorGradient.getColorToRef(c.color),c._currentColor1.p(c.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(c._currentColor2):c._currentColor2.p(c.color);else{const H=(0,a.x)(0,1);S.h.LerpToRef(this.color1,this.color2,H,c.color),this.colorDead.subtractToRef(c.color,this._colorDiff),this._colorDiff.scaleToRef(1/c.lifeTime,c.colorStep)}this._isAnimationSheetEnabled&&(c._initialStartSpriteCellID=this.startSpriteCellID,c._initialEndSpriteCellID=this.endSpriteCellID,c._initialSpriteCellLoop=this.spriteCellLoop),c.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(c.remapData=new Z.q(0,1,0,1)),this.noiseTexture&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.be(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2.be(Math.random(),Math.random(),Math.random())):(c._randomNoiseCoordinates1=new Z.n(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2=new Z.n(Math.random(),Math.random(),Math.random()))),c._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=[J.h.PositionKind,J.h.ColorKind,"angle","offset","size"];return H&&Z.push("cellIndex"),c||Z.push("direction"),y&&Z.push("remapData"),Z}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cH.c)(Z),H&&Z.push("particlesInfos"),c&&Z.push("logarithmicDepthConstant"),y&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cH.j)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&H.push("#define FOG")),this._isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),c===O.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&H.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case 2:H.push("#define BILLBOARDY");break;case 8:case 9:H.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&H.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:H.push("#define BILLBOARDMODE_ALL")}y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,c,y){c.push(...FH._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),H.push(...FH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ZH.e)(H,this._imageProcessingConfigurationDefines),(0,ZH.b)(y,this._imageProcessingConfigurationDefines))}_getWrapper(H){const c=this._getCustomDrawWrapper(H);if(null!==c&&void 0!==c&&c.effect)return c;const y=[];this.fillDefines(y,H);const Z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let F=this._drawWrappers[Z];F||(F=this._drawWrappers[Z]=[]);let P=F[H];P||(P=new HH.b(this._engine),P.drawContext&&(P.drawContext.useInstancing=this._useInstancing),F[H]=P);const S=y.join("\n");if(P.defines!==S){const H=[],c=[],y=[];this.fillUniformsAttributesAndSamplerNames(c,H,y),P.setEffect(this._engine.createEffect("particles",H,c,y,S,void 0,void 0,void 0,void 0,this._shaderLanguage),S)}return P}animate(){var H;let c,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(y?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let H=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;L.GetCurrentGradient(c,this._emitRateGradients,((c,y,Z)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=y.getFactor(),this._currentEmitRateGradient=c),H=(0,a.s)(this._currentEmitRate1,this._currentEmitRate2,Z)}))}c=H*this._scaledUpdateSpeed|0,this._newPartsExcess+=H*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!y){let H=0;for(let c=0;c<this.sj.length;c++){const y=this.sj[c];this._appendParticleVertices(H,y),H+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.sj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(H,c){this._appendParticleVertex(H++,c,0,0),this._useInstancing||(this._appendParticleVertex(H++,c,1,0),this._appendParticleVertex(H++,c,1,1),this._appendParticleVertex(H++,c,0,1))}rebuild(){var H;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(H=this._spriteBuffer)||void 0===H||H._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!FH.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(y.bind(y,11840)),Promise.resolve().then(y.bind(y,11783))])):await Promise.all([Promise.resolve().then(y.bind(y,11774)),Promise.resolve().then(y.bind(y,11767))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==O.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(O.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(O.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(H){const c=this._getWrapper(H),y=c.effect,F=this._engine;F.enableEffect(c);const P=this.defaultViewMatrix??this._scene.getViewMatrix();if(y.setTexture("diffuseSampler",this.particleTexture),y.setMatrix("view",P),y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();y.setFloat3("particlesInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,this.spriteCellWidth/H.width)}if(y.setVector2("translationPivot",this.translationPivot),y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;y.setVector3("eyePosition",H.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),y.setTexture("rampSampler",this._rampGradientsTexture));const S=y.defines;var n,a,i,C,g,v;(this._scene&&((0,cH.f)(y,this,this._scene),this.applyFog&&(0,yH.h)(this._scene,void 0,y)),S.indexOf("#define BILLBOARDMODE_ALL")>=0&&(P.invertToRef(Z.h.Matrix[0]),y.setMatrix("invView",Z.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?F.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?F.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBuffer:this._indexBuffer,y):F.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null,y);switch(this.useLogarithmicDepth&&this._scene&&(0,yH.j)(S,y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(y),H){case O.BLENDMODE_ADD:F.setAlphaMode(1);break;case O.BLENDMODE_ONEONE:F.setAlphaMode(6);break;case O.BLENDMODE_STANDARD:F.setAlphaMode(2);break;case O.BLENDMODE_MULTIPLY:F.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(y),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?F.drawElementsType(6,0,10,this.sj.length):F.drawArraysType(7,0,4,this.sj.length):null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?F.drawElementsType(1,0,10*this.sj.length):F.drawElementsType(0,0,6*this.sj.length);return this.sj.length}render(){if(!this.isReady()||!this.sj.length)return 0;const H=this._engine;H.setState&&(H.setState(!1),this.forceDepthWrite&&H.setDepthWrite(!0));let c=0;return c=this.blendMode===O.BLENDMODE_MULTIPLYADD?this._render(O.BLENDMODE_MULTIPLY)+this._render(O.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const H=this._scene.qj.indexOf(this);H>-1&&this._scene.qj.splice(H,1),this._scene._activeParticleSystems.dispose()}this.jj.notifyObservers(this),this.jj.clear(),this.onStoppedObservable.clear(),this.reset()}}FH.ForceGLSL=!1;var PH,SH=y(10798);!function(H){H[H.ATTACHED=0]="ATTACHED",H[H.END=1]="END"}(PH||(PH={}));class nH{constructor(H){if(this.particleSystem=H,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!H.j||!H.j.dispose){const c=(0,n.c)("BABYLON.AbstractMesh");H.j=new c("SubemitterSystemEmitter",H.va()),H._disposeEmitterOnDispose=!0}}clone(){let H=this.particleSystem.j;if(H){if(H instanceof Z.n)H=H.clone();else if(-1!==H.getClassName().indexOf("Mesh")){H=new((0,n.c)("BABYLON.Mesh"))("",H.va()),H.isVisible=!1}}else H=new Z.n;const c=new nH(this.particleSystem.clone(this.particleSystem.name,H));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(H),c}static _ParseParticleSystem(H,c,y){throw(0,SH.b)("ParseParticle")}static Parse(H,c,y){const Z=H.particleSystem,F=new nH(nH._ParseParticleSystem(Z,c,y,!0));return F.type=H.type,F.inheritDirection=H.inheritDirection,F.inheritedVelocityAmount=H.inheritedVelocityAmount,F.particleSystem._isSubEmitter=!0,F}dispose(){this.particleSystem.dispose()}}var OH=y(10850);function aH(H,c){const y=new h;return y.direction1=H,y.direction2=c,y}function iH(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function CH(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.n(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0);return new D(H,c,y)}function vH(){return new m(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function mH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.n(0,1,0);return new z(H,c,y,F,P)}function zH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(H,c)}function VH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0);return new v(H,c,y,F)}class hH extends FH{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=H=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[c].forEach((c=>{if(1===c.type){const y=c.clone();H._inheritParticleInfoToSubEmitter(y),y.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(y.particleSystem),y.particleSystem.start()}}))}}createPointEmitter(H,c){const y=aH(H,c);return this.particleEmitterType=y,y}createHemisphericEmitter(){const H=iH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=CH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=gH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=vH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=mH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=zH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=VH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,c,y,Z){const F=new C;return this.particleEmitterType=F,this.direction1=H,this.direction2=c,this.minEmitBox=y,this.maxEmitBox=Z,F}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((H=>{H instanceof hH?this._subEmitters.push([new nH(H)]):H instanceof nH?this._subEmitters.push([H]):H instanceof Array&&this._subEmitters.push(H)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((H=>{H.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const H=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==H&&this._rootParticleSystem.activeSubSystems.splice(H,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(H){H&&this._stopSubEmitters()}_prepareParticle(H){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];H._attachedSubEmitters=[],c.forEach((c=>{if(0===c.type){const y=c.clone();H._attachedSubEmitters.push(y),y.particleSystem.start()}}))}}_onDispose(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var y;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),H)&&(null===(y=this.particles)||void 0===y||y.forEach((H=>{if(H._attachedSubEmitters)for(let c=H._attachedSubEmitters.length-1;c>=0;c-=1)H._attachedSubEmitters[c].dispose()})));if(c&&this.activeSubSystems)for(let Z=this.activeSubSystems.length-1;Z>=0;Z-=1)this.activeSubSystems[Z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let H=0;H<this._subEmitters.length;H++)for(const c of this._subEmitters[H])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(H,c,y,F){let P;P=y instanceof OH.e?null:y;const O=(0,n.c)("BABYLON.Texture");if(O&&P&&(H.texture?c.particleTexture=O.Parse(H.texture,P,F):H.textureName&&(c.particleTexture=new O(F+H.textureName,P,!1,void 0===H.invertY||H.invertY),c.particleTexture.name=H.textureName)),H.emitterId||0===H.emitterId||void 0!==H.j?H.emitterId&&P?c.j=P.getLastMeshById(H.emitterId):c.j=Z.n.Tg(H.j):c.j=Z.n.Zero(),c.isLocal=!!H.isLocal,void 0!==H.renderingGroupId&&(c.renderingGroupId=H.renderingGroupId),void 0!==H.isBillboardBased&&(c.isBillboardBased=H.isBillboardBased),void 0!==H.billboardMode&&(c.billboardMode=H.billboardMode),void 0!==H.useLogarithmicDepth&&(c.useLogarithmicDepth=H.useLogarithmicDepth),H.animations){for(let y=0;y<H.animations.length;y++){const Z=H.animations[y],F=(0,n.c)("BABYLON.Animation");F&&c.animations.push(F.Parse(Z))}c.beginAnimationOnStart=H.beginAnimationOnStart,c.beginAnimationFrom=H.beginAnimationFrom,c.beginAnimationTo=H.beginAnimationTo,c.beginAnimationLoop=H.beginAnimationLoop}if(H.autoAnimate&&P&&P.beginAnimation(c,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),c.startDelay=0|H.startDelay,c.minAngularSpeed=H.minAngularSpeed,c.maxAngularSpeed=H.maxAngularSpeed,c.minSize=H.minSize,c.maxSize=H.maxSize,H.minScaleX&&(c.minScaleX=H.minScaleX,c.maxScaleX=H.maxScaleX,c.minScaleY=H.minScaleY,c.maxScaleY=H.maxScaleY),void 0!==H.preWarmCycles&&(c.preWarmCycles=H.preWarmCycles,c.preWarmStepOffset=H.preWarmStepOffset),void 0!==H.minInitialRotation&&(c.minInitialRotation=H.minInitialRotation,c.maxInitialRotation=H.maxInitialRotation),c.minLifeTime=H.minLifeTime,c.maxLifeTime=H.maxLifeTime,c.minEmitPower=H.minEmitPower,c.maxEmitPower=H.maxEmitPower,c.emitRate=H.emitRate,c.gravity=Z.n.Tg(H.gravity),H.noiseStrength&&(c.noiseStrength=Z.n.Tg(H.noiseStrength)),c.color1=S.h.Tg(H.color1),c.color2=S.h.Tg(H.color2),c.colorDead=S.h.Tg(H.colorDead),c.updateSpeed=H.updateSpeed,c.targetStopDuration=H.targetStopDuration,c.blendMode=H.blendMode,H.colorGradients)for(const Z of H.colorGradients)c.addColorGradient(Z.gradient,S.h.Tg(Z.color1),Z.color2?S.h.Tg(Z.color2):void 0);if(H.rampGradients){for(const y of H.rampGradients)c.addRampGradient(y.gradient,S.e.Tg(y.color));c.useRampGradients=H.useRampGradients}if(H.colorRemapGradients)for(const Z of H.colorRemapGradients)c.addColorRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.alphaRemapGradients)for(const Z of H.alphaRemapGradients)c.addAlphaRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.sizeGradients)for(const Z of H.sizeGradients)c.addSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.angularSpeedGradients)for(const Z of H.angularSpeedGradients)c.addAngularSpeedGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.velocityGradients)for(const Z of H.velocityGradients)c.addVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.dragGradients)for(const Z of H.dragGradients)c.addDragGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.emitRateGradients)for(const Z of H.emitRateGradients)c.addEmitRateGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.startSizeGradients)for(const Z of H.startSizeGradients)c.addStartSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.lifeTimeGradients)for(const Z of H.lifeTimeGradients)c.addLifeTimeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(H.limitVelocityGradients){for(const y of H.limitVelocityGradients)c.addLimitVelocityGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);c.limitVelocityDamping=H.limitVelocityDamping}if(H.noiseTexture&&P){const y=(0,n.c)("BABYLON.ProceduralTexture");c.noiseTexture=y.Parse(H.noiseTexture,P,F)}let a;if(H.particleEmitterType){switch(H.particleEmitterType.type){case"SphereParticleEmitter":a=new Q;break;case"SphereDirectedParticleEmitter":a=new D;break;case"ConeEmitter":case"ConeParticleEmitter":a=new g;break;case"ConeDirectedParticleEmitter":a=new v;break;case"CylinderParticleEmitter":a=new m;break;case"CylinderDirectedParticleEmitter":a=new z;break;case"HemisphericParticleEmitter":a=new V;break;case"PointParticleEmitter":a=new h;break;case"MeshParticleEmitter":a=new l;break;case"CustomParticleEmitter":a=new f;break;default:a=new C}a.parse(H.particleEmitterType,P)}else a=new C,a.parse(H,P);c.particleEmitterType=a,c.startSpriteCellID=H.startSpriteCellID,c.endSpriteCellID=H.endSpriteCellID,c.spriteCellLoop=H.spriteCellLoop??!0,c.spriteCellWidth=H.spriteCellWidth,c.spriteCellHeight=H.spriteCellHeight,c.spriteCellChangeSpeed=H.spriteCellChangeSpeed,c.spriteRandomStartCell=H.spriteRandomStartCell,c.disposeOnStop=H.disposeOnStop??!1,c.manualEmitCount=H.manualEmitCount??-1}static Parse(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4?arguments[4]:void 0;const n=H.name;let O,a,i=null,C=null;if(c instanceof OH.e?O=c:(a=c,O=a.getEngine()),H.customShader&&O.createEffectForParticles){C=H.customShader;const c=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"";i=O.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,c)}const g=new hH(n,P||H.mb,c,i,H.isAnimationSheetEnabled);if(g.customShader=C,g._rootUrl=y,H.id&&(g.id=H.id),H.subEmitters){g.subEmitters=[];for(const Z of H.subEmitters){const H=[];for(const F of Z)H.push(nH.Parse(F,c,y));g.subEmitters.push(H)}}return hH._Parse(H,g,c,y),H.textureMask&&(g.textureMask=S.h.Tg(H.textureMask)),H.Uf&&(g.Uf=Z.n.Tg(H.Uf)),H.preventAutoStart&&(g.preventAutoStart=H.preventAutoStart),F||g.preventAutoStart||g.start(),g}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(hH._Serialize(c,this,H),c.textureMask=this.textureMask.ij(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.Uf=this.Uf.ij(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const y of this._subEmitters){const Z=[];for(const c of y)Z.push(c.serialize(H));c.subEmitters.push(Z)}}return c}static _Serialize(H,c,y){if(H.name=c.name,H.id=c.id,H.mb=c.getCapacity(),H.disposeOnStop=c.disposeOnStop,H.manualEmitCount=c.manualEmitCount,c.j.position){const y=c.j;H.emitterId=y.id}else{const y=c.j;H.j=y.ij()}c.particleEmitterType&&(H.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(y?H.texture=c.particleTexture.serialize():(H.textureName=c.particleTexture.name,H.invertY=!!c.particleTexture._invertY)),H.isLocal=c.isLocal,s.e.AppendSerializedAnimations(c,H),H.beginAnimationOnStart=c.beginAnimationOnStart,H.beginAnimationFrom=c.beginAnimationFrom,H.beginAnimationTo=c.beginAnimationTo,H.beginAnimationLoop=c.beginAnimationLoop,H.startDelay=c.startDelay,H.renderingGroupId=c.renderingGroupId,H.isBillboardBased=c.isBillboardBased,H.billboardMode=c.billboardMode,H.minAngularSpeed=c.minAngularSpeed,H.maxAngularSpeed=c.maxAngularSpeed,H.minSize=c.minSize,H.maxSize=c.maxSize,H.minScaleX=c.minScaleX,H.maxScaleX=c.maxScaleX,H.minScaleY=c.minScaleY,H.maxScaleY=c.maxScaleY,H.minEmitPower=c.minEmitPower,H.maxEmitPower=c.maxEmitPower,H.minLifeTime=c.minLifeTime,H.maxLifeTime=c.maxLifeTime,H.emitRate=c.emitRate,H.gravity=c.gravity.ij(),H.noiseStrength=c.noiseStrength.ij(),H.color1=c.color1.ij(),H.color2=c.color2.ij(),H.colorDead=c.colorDead.ij(),H.updateSpeed=c.updateSpeed,H.targetStopDuration=c.targetStopDuration,H.blendMode=c.blendMode,H.preWarmCycles=c.preWarmCycles,H.preWarmStepOffset=c.preWarmStepOffset,H.minInitialRotation=c.minInitialRotation,H.maxInitialRotation=c.maxInitialRotation,H.startSpriteCellID=c.startSpriteCellID,H.spriteCellLoop=c.spriteCellLoop,H.endSpriteCellID=c.endSpriteCellID,H.spriteCellChangeSpeed=c.spriteCellChangeSpeed,H.spriteCellWidth=c.spriteCellWidth,H.spriteCellHeight=c.spriteCellHeight,H.spriteRandomStartCell=c.spriteRandomStartCell,H.isAnimationSheetEnabled=c.isAnimationSheetEnabled,H.useLogarithmicDepth=c.useLogarithmicDepth;const Z=c.getColorGradients();if(Z){H.colorGradients=[];for(const c of Z){const y={gradient:c.gradient,color1:c.color1.ij()};c.color2?y.color2=c.color2.ij():y.color2=c.color1.ij(),H.colorGradients.push(y)}}const F=c.getRampGradients();if(F){H.rampGradients=[];for(const c of F){const y={gradient:c.gradient,color:c.color.ij()};H.rampGradients.push(y)}H.useRampGradients=c.useRampGradients}const P=c.getColorRemapGradients();if(P){H.colorRemapGradients=[];for(const c of P){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.colorRemapGradients.push(y)}}const S=c.getAlphaRemapGradients();if(S){H.alphaRemapGradients=[];for(const c of S){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.alphaRemapGradients.push(y)}}const n=c.getSizeGradients();if(n){H.sizeGradients=[];for(const c of n){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.sizeGradients.push(y)}}const O=c.getAngularSpeedGradients();if(O){H.angularSpeedGradients=[];for(const c of O){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.angularSpeedGradients.push(y)}}const a=c.getVelocityGradients();if(a){H.velocityGradients=[];for(const c of a){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.velocityGradients.push(y)}}const i=c.getDragGradients();if(i){H.dragGradients=[];for(const c of i){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.dragGradients.push(y)}}const C=c.getEmitRateGradients();if(C){H.emitRateGradients=[];for(const c of C){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.emitRateGradients.push(y)}}const g=c.getStartSizeGradients();if(g){H.startSizeGradients=[];for(const c of g){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.startSizeGradients.push(y)}}const v=c.getLifeTimeGradients();if(v){H.lifeTimeGradients=[];for(const c of v){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.lifeTimeGradients.push(y)}}const m=c.getLimitVelocityGradients();if(m){H.limitVelocityGradients=[];for(const c of m){const y={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?y.factor2=c.factor2:y.factor2=c.factor1,H.limitVelocityGradients.push(y)}H.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(H.noiseTexture=c.noiseTexture.serialize())}clone(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let F=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){F=this.customShader;const H=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"",c=P.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,H);Z[0]?Z[0].effect=c:this.setCustomEffect(c,0)}const S=this.serialize(y),n=hH.Parse(S,this._scene||this._engine,this._rootUrl);return n.name=H,n.customShader=F,n._customWrappers=Z,void 0===c&&(c=this.j),this.noiseTexture&&(n.noiseTexture=this.noiseTexture.clone()),n.j=c,this.preventAutoStart||n.start(),n}}hH.BILLBOARDMODE_Y=2,hH.BILLBOARDMODE_ALL=7,hH.BILLBOARDMODE_STRETCHED=8,hH.BILLBOARDMODE_STRETCHED_LOCAL=9,nH._ParseParticleSystem=hH.Parse;var QH=y(11108),DH=y(11076),fH=y(11573);fH.c.prototype.createTransformFeedback=function(){const H=this._gl.createTransformFeedback();if(!H)throw new Error("Unable to create Transform Feedback");return H},fH.c.prototype.deleteTransformFeedback=function(H){this._gl.deleteTransformFeedback(H)},fH.c.prototype.bindTransformFeedback=function(H){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,H)},fH.c.prototype.beginTransformFeedback=function(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(H?this._gl.POINTS:this._gl.TRIANGLES)},fH.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},fH.c.prototype.setTranformFeedbackVaryings=function(H,c){this._gl.transformFeedbackVaryings(H,c,this._gl.INTERLEAVED_ATTRIBS)},fH.c.prototype.bindTransformFeedbackBuffer=function(H){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H?H.underlyingResource:null)},fH.c.prototype.readTransformFeedbackBuffer=function(H){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H)};const JH="clipPlaneFragmentDeclaration2",lH="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.e.IncludesShadersStore[JH]=lH;y(11675),y(11684),y(11691),y(11698),y(11704),y(11708),y(11710),y(11712);const dH="gpuRenderParticlesPixelShader",KH="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.e.ShadersStore[dH]=KH;const TH="clipPlaneVertexDeclaration2",uH="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.e.IncludesShadersStore[TH]=uH;y(11719),y(11722),y(11730),y(11737);const EH="gpuRenderParticlesVertexShader",UH="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.e.ShadersStore[EH]=UH;class GH extends O{static get IsSupported(){if(!B.b.LastCreatedEngine)return!1;const H=B.b.LastCreatedEngine.getCaps();return H.supportTransformFeedbacks||H.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(H){this._maxActiveParticleCount=Math.min(H,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(H){this.maxActiveParticleCount=H}createPointEmitter(H,c){const y=aH(H,c);return this.particleEmitterType=y,y}createHemisphericEmitter(){const H=iH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=CH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=gH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=vH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=mH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=zH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=VH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.n(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,c,y,Z){const F=new C;return this.particleEmitterType=F,this.direction1=H,this.direction2=c,this.minEmitBox=y,this.maxEmitBox=Z,F}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==hH.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hH.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hH.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";H?setTimeout((()=>{this.start(0)}),H):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var H;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[c])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new HH.b(this._engine),this._customWrappers[c].effect=H}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(H,c,y){return super._removeGradientAndTexture(H,c,y),this._releaseBuffers(),this}addColorGradient(H,c){this._colorGradients||(this._colorGradients=[]);const y=new r(H,c);return this._colorGradients.push(y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(H&&this._colorGradients.sort(((H,c)=>H.gradient<c.gradient?-1:H.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(H){return this._removeGradientAndTexture(H,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var H;null===(H=this._drawWrappers[c].drawContext)||void 0===H||H.reset()}}_addFactorGradient(H,c,y){const Z=new w(c,y);H.push(Z),this._releaseBuffers()}addSizeGradient(H,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,H,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(H){return this._removeGradientAndTexture(H,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(H,c){if(!H)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&H.sort(((H,c)=>H.gradient<c.gradient?-1:H.gradient>c.gradient?1:0));const y=this;y[c]&&(y[c].dispose(),y[c]=null)}addAngularSpeedGradient(H,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,H,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(H){return this._removeGradientAndTexture(H,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(H,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,H,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(H){return this._removeGradientAndTexture(H,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(H,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,H,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(H){return this._removeGradientAndTexture(H,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(H,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,H,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(H){return this._removeGradientAndTexture(H,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(H){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(H),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.jj=new b.e,this.onStoppedObservable=new b.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=Z.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,n.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,n.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,n.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,n.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new HH.b(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers={0:new HH.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const S={mb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},O=c;isFinite(O)&&(S.mb=O),this._capacity=S.mb,this._maxActiveParticleCount=S.mb,this._currentActiveCount=0,this._isAnimationSheetEnabled=P,this.particleEmitterType=new C;const a=Math.min(this._engine.getCaps().maxTextureSize,S.randomTextureSize);let i=[];for(let Z=0;Z<a;++Z)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture=new X.c(new Float32Array(i),a,1,5,y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,i=[];for(let Z=0;Z<a;++Z)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture2=new X.c(new Float32Array(i),a,1,5,y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=a}_reset(){this._releaseBuffers()}_createVertexBuffers(H,c,y){const Z={};Z.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let F=3;Z.age=c.createVertexBuffer("age",F,1,this._attributesStrideSize,!0),F+=1,Z.size=c.createVertexBuffer("size",F,3,this._attributesStrideSize,!0),F+=3,Z.life=c.createVertexBuffer("life",F,1,this._attributesStrideSize,!0),F+=1,F+=4,this.billboardMode===hH.BILLBOARDMODE_STRETCHED&&(Z.direction=c.createVertexBuffer("direction",F,3,this._attributesStrideSize,!0)),F+=3,this._platform.alignDataInBuffer&&(F+=1),this.particleEmitterType instanceof f&&(F+=3,this._platform.alignDataInBuffer&&(F+=1)),this._colorGradientsTexture||(Z.color=c.createVertexBuffer("color",F,4,this._attributesStrideSize,!0),F+=4),this._isBillboardBased||(Z.initialDirection=c.createVertexBuffer("initialDirection",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),this.noiseTexture&&(Z.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1),Z.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),Z.angle=c.createVertexBuffer("angle",F,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?F++:F+=2,this._isAnimationSheetEnabled&&(Z.cellIndex=c.createVertexBuffer("cellIndex",F,1,this._attributesStrideSize,!0),F+=1,this.spriteRandomStartCell&&(Z.cellStartOffset=c.createVertexBuffer("cellStartOffset",F,1,this._attributesStrideSize,!0),F+=1)),Z.offset=y.createVertexBuffer("offset",0,2),Z.uv=y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Z),this._platform.createVertexBuffers(H,Z),this.resetDrawCache()}_initialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!H)return;const c=this._engine,y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const F=this.particleEmitterType instanceof f,P=Z.h.o[0];let S=0;for(let Z=0;Z<this._capacity;Z++)if(y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),F?(this.particleEmitterType.particleDestinationGenerator(Z,null,P),y.push(P.x),y.push(P.y),y.push(P.z)):(y.push(0),y.push(0),y.push(0)),this._platform.alignDataInBuffer&&y.push(0),S+=16,F&&(this.particleEmitterType.particlePositionGenerator(Z,null,P),y.push(P.x),y.push(P.y),y.push(P.z),this._platform.alignDataInBuffer&&y.push(0),S+=4),this._colorGradientsTexture||(y.push(0),y.push(0),y.push(0),y.push(0),S+=4),this.isBillboardBased||(y.push(0),y.push(0),y.push(0),this._platform.alignDataInBuffer&&y.push(0),S+=4),this.noiseTexture&&(y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),S+=8),y.push(0),S+=1,this._angularSpeedGradientsTexture||(y.push(0),S+=1),this._isAnimationSheetEnabled&&(y.push(0),S+=1,this.spriteRandomStartCell&&(y.push(0),S+=1)),this._platform.alignDataInBuffer){let H=3-(S+3&3);for(S+=H;H-- >0;)y.push(0)}const n=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),O=this._platform.createParticleBuffer(y),a=this._platform.createParticleBuffer(y);this._buffer0=new J.d(c,O,!1,this._attributesStrideSize),this._buffer1=new J.d(c,a,!1,this._attributesStrideSize),this._spriteBuffer=new J.d(c,n,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let H=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(H+="\n#define BILLBOARD"),this._colorGradientsTexture&&(H+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(H+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(H+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(H+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(H+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(H+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(H+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(H+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(H+="\n#define NOISE"),this.isLocal&&(H+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===H||(this._cachedUpdateDefines=H,this._updateBuffer=this._platform.createUpdateBuffer(H)),this._platform.isUpdateBufferReady()}_getWrapper(H){const c=this._getCustomDrawWrapper(H);if(null!==c&&void 0!==c&&c.effect)return c;const y=[];this.fillDefines(y,H);let Z=this._drawWrappers[H];Z||(Z=new HH.b(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=!0),this._drawWrappers[H]=Z);const F=y.join("\n");if(Z.defines!==F){const H=[],c=[],y=[];this.fillUniformsAttributesAndSamplerNames(c,H,y),Z.setEffect(this._engine.createEffect("gpuRenderParticles",H,c,y,F),F)}return Z}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=[J.h.PositionKind,"age","life","size","angle"];return H||F.push(J.h.ColorKind),c&&F.push("cellIndex"),y||F.push("initialDirection"),Z&&F.push("direction"),F.push("offset",J.h.UVKind),F}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["emitterWM","Uf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cH.c)(Z),H&&Z.push("sheetInfos"),c&&Z.push("logarithmicDepthConstant"),y&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cH.j)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==DH.d.FOGMODE_NONE&&H.push("#define FOG")),c===hH.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this.isLocal&&H.push("#define LOCAL"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case hH.BILLBOARDMODE_Y:H.push("#define BILLBOARDY");break;case hH.BILLBOARDMODE_STRETCHED:H.push("#define BILLBOARDSTRETCHED");break;case hH.BILLBOARDMODE_ALL:H.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&H.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,c,y){c.push(...GH._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hH.BILLBOARDMODE_STRETCHED)),H.push(...GH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(QH.d.PrepareUniforms(H,this._imageProcessingConfigurationDefines),QH.d.PrepareSamplers(y,this._imageProcessingConfigurationDefines))}animate(){var H;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(H,c){const y=this[c];if(!H||!H.length||y)return;const Z=new Float32Array(this._rawTextureWidth);for(let F=0;F<this._rawTextureWidth;F++){const c=F/this._rawTextureWidth;L.GetCurrentGradient(c,H,((H,c,y)=>{Z[F]=(0,a.s)(H.factor1,c.factor1,y)}))}this[c]=X.c.CreateRTexture(Z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const H=new Uint8Array(4*this._rawTextureWidth),c=S.i.ob[0];for(let y=0;y<this._rawTextureWidth;y++){const Z=y/this._rawTextureWidth;L.GetCurrentGradient(Z,this._colorGradients,((Z,F,P)=>{S.h.LerpToRef(Z.color1,F.color1,P,c),H[4*y]=255*c.r,H[4*y+1]=255*c.g,H[4*y+2]=255*c.b,H[4*y+3]=255*c.a}))}this._colorGradientsTexture=X.c.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(H,c){var y,F,P,S;const n=this._getWrapper(H),O=n.effect;this._engine.enableEffect(n);const a=(null===(y=this._scene)||void 0===y?void 0:y.getViewMatrix())||Z.d.IdentityReadOnly;if(O.setMatrix("view",a),O.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),O.setTexture("diffuseSampler",this.particleTexture),O.setVector2("translationPivot",this.translationPivot),O.setVector3("Uf",this.Uf),this.isLocal&&O.setMatrix("emitterWM",c),this._colorGradientsTexture?O.setTexture("colorGradientSampler",this._colorGradientsTexture):O.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();O.setFloat3("sheetInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,H.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;O.setVector3("eyePosition",H.globalPosition)}const i=O.defines;if(this._scene&&((0,cH.f)(O,this,this._scene),this.applyFog&&(0,yH.h)(this._scene,void 0,O)),i.indexOf("#define BILLBOARDMODE_ALL")>=0){const H=a.clone();H.invert(),O.setMatrix("invView",H)}switch(this.useLogarithmicDepth&&this._scene&&(0,yH.j)(i,O,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),H){case hH.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case hH.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case hH.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case hH.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,O,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(S=this._scene)&&void 0!==S&&S.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(H){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!H)if(this.j.position){H=this.j.getWorldMatrix()}else{const c=this.j;H=Z.h.Matrix[0],Z.d.TranslationToRef(c.x,c.y,c.z,H)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",H),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const c=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=c}render(){let H,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const H=0|this._accumulatedCount;this._accumulatedCount-=H,this._currentActiveCount+=H}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){H=this.j.getWorldMatrix()}else{const c=this.j;H=Z.h.Matrix[0],Z.d.TranslationToRef(c.x,c.y,c.z,H)}const F=this._engine;this.updateInAnimate||this._update(H);let P=0;return c||y||(F.setState(!1),this.forceDepthWrite&&F.setDepthWrite(!0),P=this.blendMode===hH.BLENDMODE_MULTIPLYADD?this._render(hH.BLENDMODE_MULTIPLY,H)+this._render(hH.BLENDMODE_ADD,H):this._render(this.blendMode,H),this._engine.setAlphaMode(0)),P}rebuild(){const H=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(H,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,H()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const H=this._scene.qj.indexOf(this);H>-1&&this._scene.qj.splice(H,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const H=this._renderVertexBuffers[c];for(const c in H)H[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.jj.notifyObservers(this),this.jj.clear()}clone(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let F=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){F=this.customShader;const H=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";Z[0]=P.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,H,void 0,void 0,void 0,this)}const S=this.serialize(y),n=GH.Parse(S,this._scene||this._engine,this._rootUrl);return n.name=H,n.customShader=F,n._customWrappers=Z,void 0===c&&(c=this.j),this.noiseTexture&&(n.noiseTexture=this.noiseTexture.clone()),n.j=c,n}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return hH._Serialize(c,this,H),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0;const P=H.name;let S,n;c instanceof OH.e?S=c:(n=c,S=n.getEngine());const O=new GH(P,{mb:F||H.mb,randomTextureSize:H.randomTextureSize},c,null,H.isAnimationSheetEnabled);if(O._rootUrl=y,H.customShader&&S.createEffectForParticles){const c=H.customShader,y=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",Z=S.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,y,void 0,void 0,void 0,O);O.setCustomEffect(Z,0),O.customShader=c}return H.id&&(O.id=H.id),H.activeParticleCount&&(O.activeParticleCount=H.activeParticleCount),hH._Parse(H,O,c,y),H.preventAutoStart&&(O.preventAutoStart=H.preventAutoStart),Z||O.preventAutoStart||O.start(),O}}var pH=y(10754),tH=y(11744),oH=y(11048);class sH{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(H){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.j=H;this._emitterNode=H}setEmitterAsSphere(H,c,y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:H,renderingGroupId:c};const Z=(0,tH.d)("emitterSphere",{diameter:H.diameter,segments:H.segments},y);Z.renderingGroupId=c;const F=new oH.d("emitterSphereMaterial",y);F.emissiveColor=H.color,Z.material=F;for(const P of this.systems)P.j=Z;this._emitterNode=Z}start(H){for(const c of this.systems)H&&(c.j=H),c.start()}dispose(){for(const H of this.systems)H.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const y of this.systems)c.systems.push(y.serialize(H));return this._emitterNode&&(c.j=this._emitterCreationOptions),c}static Parse(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;const F=new sH,P=this.BaseAssetsUrl+"/textures/";c=c||B.b.LastCreatedScene;for(const S of H.systems)F.systems.push(y?GH.Parse(S,c,P,!0,Z):hH.Parse(S,c,P,!0,Z));if(H.j){const y=H.j.options;if("Sphere"===H.j.kind)F.setEmitterAsSphere({diameter:y.diameter,segments:y.segments,color:S.e.Tg(y.color)},H.j.renderingGroupId,c)}return F}}sH.BaseAssetsUrl="https://assets.babylonjs.com/particles";var qH=y(10805);class IH{static CreateDefault(H){let c,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Z=arguments.length>2?arguments[2]:void 0;return c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new GH("default system",{mb:y},Z):new hH("default system",y,Z),c.j=H,c.particleTexture=new q.d("https://assets.babylonjs.com/textures/flare.png",c.va()),c.createConeEmitter(.1,Math.PI/4),c.color1=new S.h(1,1,1,1),c.color2=new S.h(1,1,1,1),c.colorDead=new S.h(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;c||(c=B.b.LastCreatedScene);const F={};return c.addPendingData(F),new Promise(((P,S)=>{if(y&&!GH.IsSupported)return c.removePendingData(F),S("Particle system with GPU is not supported.");pH.c.LoadFile(`${IH.BaseAssetsUrl}/systems/${H}.json`,(H=>{c.removePendingData(F);const S=JSON.parse(H.toString());return P(sH.Parse(S,c,y,Z))}),void 0,void 0,void 0,(()=>(c.removePendingData(F),S(`An error occurred with the creation of your particle system. Check if your type '${H}' exists.`))))}))}static ExportSet(H){const c=new sH;for(const y of H)c.systems.push(y);return c}static ParseFromFileAsync(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",P=arguments.length>5?arguments[5]:void 0;return new Promise(((S,n)=>{const O=new qH.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const c=JSON.parse(O.responseText);let n;n=Z?GH.Parse(c,y,F,!1,P):hH.Parse(c,y,F,!1,P),H&&(n.name=H),S(n)}else n("Unable to load the particle system")})),O.open("GET",c),O.send()}))}static ParseFromSnippetAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",F=arguments.length>4?arguments[4]:void 0;if("_BLANK"===H){const H=this.CreateDefault(null);return H.start(),Promise.resolve(H)}return new Promise(((P,S)=>{const n=new qH.c;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const S=JSON.parse(JSON.parse(n.responseText).jsonPayload),O=JSON.parse(S.particleSystem);let a;a=y?GH.Parse(O,c,Z,!1,F):hH.Parse(O,c,Z,!1,F),a.snippetId=H,P(a)}else S("Unable to load the snippet "+H)})),n.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),n.send()}))}}IH.BaseAssetsUrl=sH.BaseAssetsUrl,IH.SnippetUrl="https://snippet.babylonjs.com",IH.CreateFromSnippetAsync=IH.ParseFromSnippetAsync;var jH=y(11354),kH=y(11174),WH=y(11747);(0,WH.e)(kH.d.NAME_PARTICLESYSTEM,((H,c,y,Z)=>{const F=(0,WH.i)(kH.d.NAME_PARTICLESYSTEM);if(F&&void 0!==H.qj&&null!==H.qj)for(let P=0,S=H.qj.length;P<S;P++){const S=H.qj[P];y.qj.push(F(S,c,Z))}})),(0,WH.b)(kH.d.NAME_PARTICLESYSTEM,((H,c,y)=>{if(H.activeParticleCount){return GH.Parse(H,c,y)}return hH.Parse(H,c,y)})),OH.e.prototype.createEffectForParticles=function(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",P=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=[],C=[];const g=[];return O?O.fillUniformsAttributesAndSamplerNames(C,i,g):(i=hH._GetAttributeNamesOrOptions(),C=hH._GetEffectCreationOptions()),-1===F.indexOf(" BILLBOARD")&&(F+="\n#define BILLBOARD\n"),null!==O&&void 0!==O&&O.isAnimationSheetEnabled&&-1===F.indexOf(" ANIMATESHEET")&&(F+="\n#define ANIMATESHEET\n"),-1===Z.indexOf("diffuseSampler")&&Z.push("diffuseSampler"),this.createEffect({vertex:(null===O||void 0===O?void 0:O.vertexShaderName)??"particles",fragmentElement:H},i,C.concat(c),g.concat(Z),F,P,S,n,void 0,a,(async()=>{0===a?await Promise.resolve().then(y.bind(y,11774)):await Promise.resolve().then(y.bind(y,11840))}))},jH.c.prototype.getEmittedParticleSystems=function(){const H=[];for(let c=0;c<this.va().qj.length;c++){const y=this.va().qj[c];y.j===this&&H.push(y)}return H},jH.c.prototype.getHierarchyEmittedParticleSystems=function(){const H=[],c=this.getDescendants();c.push(this);for(let y=0;y<this.va().qj.length;y++){const Z=this.va().qj[y],F=Z.j;F.position&&-1!==c.indexOf(F)&&H.push(Z)}return H};y(11256),y(11268),y(11399);y(11380),y(11756),y(11410),y(11245),y(11413);y(11609);var MH;y(11762),y(11313);!function(H){H[H.Color=2]="Color",H[H.UV=1]="UV",H[H.Random=0]="Random",H[H.Stated=3]="Stated"}(MH||(MH={}));y(11767),y(11774),y(11783),y(11840)},11650:(H,c,y)=>{"use strict";y.d(c,{e:()=>m});var Z=y(11052),F=y(11071),P=y(10763),S=y(11092),n=y(10853),O=y(11061),a=y(11118),i=y(10893),C=y(10850),g=y(10908),v=y(11655);C.e.prototype.setTextureFromPostProcess=function(H,c,y){var Z;let F=null;c&&(c._forcedOutputTexture?F=c._forcedOutputTexture:c._textures.data[c._currentRenderTextureInd]&&(F=c._textures.data[c._currentRenderTextureInd])),this._bindTexture(H,(null===(Z=F)||void 0===Z?void 0:Z.texture)??null,y)},C.e.prototype.setTextureFromPostProcessOutput=function(H,c,y){var Z;this._bindTexture(H,(null===c||void 0===c||null===(Z=c._outputTexture)||void 0===Z?void 0:Z.texture)??null,y)},n.d.prototype.setTextureFromPostProcess=function(H,c){this._engine.setTextureFromPostProcess(this._samplers[H],c,H)},n.d.prototype.setTextureFromPostProcessOutput=function(H,c){this._engine.setTextureFromPostProcessOutput(this._samplers[H],c,H)};class m{static get ForceGLSL(){return v.g.ForceGLSL}static set ForceGLSL(H){v.g.ForceGLSL=H}static RegisterShaderCodeProcessing(H,c){v.g.RegisterShaderCodeProcessing(H,c)}get name(){return this._effectWrapper.name}set name(H){this._effectWrapper.name=H}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(H){this._effectWrapper.alphaMode=H}get samples(){return this._samples}set samples(H){this._samples=Math.min(H,this._engine.getCaps().maxMSAASamples),this._textures.forEach((H=>{H.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(H){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),H&&(this._onActivateObserver=this.onActivateObservable.add(H))}set onSizeChanged(H){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(H)}set onApply(H){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(H)}set onBeforeRender(H){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(H)}set onAfterRender(H){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(H)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(H){this._forcedOutputTexture=H}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.be(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(H,c,y,Z,n,O){var a;let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,C=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",Q=arguments.length>12?arguments[12]:void 0,D=arguments.length>13&&void 0!==arguments[13]&&arguments[13],f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,J=arguments.length>15?arguments[15]:void 0,l=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ti=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new F.c(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new S.l(1,1),this._texelSize=S.l.Zero(),this.onActivateObservable=new P.e,this.onSizeChangedObservable=new P.e,this.onApplyObservable=new P.e,this.onBeforeRenderObservable=new P.e,this.onAfterRenderObservable=new P.e;let d,K=1,T=null;if(y&&!Array.isArray(y)){const H=y;y=H.uniforms??null,Z=H.samplers??null,K=H.size??1,O=H.camera??null,i=H.samplingMode??1,C=H.kd,g=H.reusable,z=Array.isArray(H.defines)?H.defines.join("\n"):H.defines??null,V=H.textureType??0,h=H.vertexUrl??"postprocess",Q=H.indexParameters,D=H.blockCompilation??!1,f=H.textureFormat??5,J=H.shaderLanguage??0,T=H.uniformBuffers??null,l=H.extraInitializations,d=H.effectWrapper}else n&&(K="number"===typeof n?n:{width:n.width,height:n.height});const u=!!d;if(this._effectWrapper=d??new v.g({name:H,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:c,kd:C||(null===(a=O)||void 0===a?void 0:a.va().getEngine()),uniforms:y,samplers:Z,uniformBuffers:T,defines:z,vertexUrl:h,indexParameters:Q,blockCompilation:D,shaderLanguage:J,extraInitializations:l}),this.name=H,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=O?(this._camera=O,this._scene=O.va(),O.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):C&&(this._engine=C,this._engine.postProcesses.push(this)),this._options=K,this.renderTargetSamplingMode=i||1,this._reusable=g||!1,this._textureType=V,this._textureFormat=f,this._shaderLanguage=J||0,this._samplers=Z||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=c,this._vertexUrl=h,this._parameters=y||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=T||[],this._indexParameters=Q,!u){this._webGPUReady=1===this._shaderLanguage;const H=[];this._gatherImports(this._engine.isWebGPU&&!m.ForceGLSL,H),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(D,z,l,H)}}_gatherImports(){let H=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?H.push(Promise.all([y.e(37).then(y.bind(y,13597))])):H.push(Promise.all([Promise.resolve().then(y.bind(y,11658))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(H){return this._disposeTextures(),this._shareOutputWithPostProcess=H,this}useOwnOutput(){0==this._textures.length&&(this._textures=new F.c(2)),this._shareOutputWithPostProcess=null}updateEffect(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(H,c,y,Z,F,P,S,n),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let F=0;F<this._textureCache.length;F++)if(this._textureCache[F].texture.width===H.width&&this._textureCache[F].texture.height===H.height&&this._textureCache[F].postProcessChannel===y&&this._textureCache[F].texture._generateDepthBuffer===c.generateDepthBuffer&&this._textureCache[F].texture.samples===c.samples)return this._textureCache[F].texture;const Z=this._engine.createRenderTargetTexture(H,c);return this._textureCache.push({texture:Z,postProcessChannel:y,lastUsedRenderId:-1}),Z}_flushTextureCache(){const H=this._renderId;for(let c=this._textureCache.length-1;c>=0;c--)if(H-this._textureCache[c].lastUsedRenderId>100){let H=!1;for(let y=0;y<this._textures.length;y++)if(this._textures.data[y]===this._textureCache[c].texture){H=!0;break}H||(this._textureCache[c].texture.dispose(),this._textureCache.splice(c,1))}}resize(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=H,this.height=c;let P=null;if(y)for(let O=0;O<y._postProcesses.length;O++)if(null!==y._postProcesses[O]){P=y._postProcesses[O];break}const S={width:this.width,height:this.height},n={generateMipMaps:Z,generateDepthBuffer:F||P===this,generateStencilBuffer:(F||P===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(S,n,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(S,n,1)),this._texelSize.be(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let H;if(this._shareOutputWithPostProcess)H=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)H=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let c;H=this.inputTexture;for(let y=0;y<this._textureCache.length;y++)if(this._textureCache[y].texture===H){c=this._textureCache[y];break}c&&(c.lastUsedRenderId=this._renderId)}return H}activate(H){var c,y;let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;const P=(H=H||this._camera).va(),S=P.getEngine(),n=S.getCaps().maxTextureSize,O=(Z?Z.width:this._engine.getRenderWidth(!0))*this._options|0,a=(Z?Z.height:this._engine.getRenderHeight(!0))*this._options|0;let i=this._options.width||O,C=this._options.height||a;const v=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let m=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const H=S.currentViewport;H&&(i*=H.width,C*=H.height)}(v||this.alwaysForcePOT)&&(this._options.width||(i=S.needPOTTextures?(0,g.c)(i,n,this.scaleMode):i),this._options.height||(C=S.needPOTTextures?(0,g.c)(C,n,this.scaleMode):C)),this.width===i&&this.height===C&&(m=this._getTarget())||this.resize(i,C,H,v,F),this._textures.forEach((H=>{H.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(H,this.samples)})),this._flushTextureCache(),this._renderId++}return m||(m=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.be(O/i,a/C),this._engine.bindFramebuffer(m,0,O,a,this.forceFullscreenViewport)):(this._scaleRatio.be(1,1),this._engine.bindFramebuffer(m,0,void 0,void 0,this.forceFullscreenViewport)),null===(c=(y=this._engine)._debugInsertMarker)||void 0===c||c.call(y,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(H),this.Ti&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:P.clearColor,P._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),m}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let H;var c;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),H=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(c=H)||void 0===c?void 0:c.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let H=this._textureCache.length-1;H>=0;H--)this._textureCache[H].texture.dispose();this._textureCache.length=0}setPrePassRenderer(H){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=H.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(H){let c;if(H=H||this._camera,this._disposeTextures(),this._scene&&(c=this._scene.postProcesses.indexOf(this),-1!==c&&this._scene.postProcesses.splice(c,1)),this._parentContainer){const H=this._parentContainer.postProcesses.indexOf(this);H>-1&&this._parentContainer.postProcesses.splice(H,1),this._parentContainer=null}if(c=this._engine.postProcesses.indexOf(this),-1!==c&&this._engine.postProcesses.splice(c,1),H){if(H.detachPostProcess(this),c=H._postProcesses.indexOf(this),0===c&&H._postProcesses.length>0){const H=this._camera._getFirstPostProcess();H&&H.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const H=a.e.Serialize(this),c=this.getCamera()||this._scene&&this._scene.activeCamera;return H.customType="BABYLON."+this.getClassName(),H.cameraId=c?c.id:null,H.reusable=this._reusable,H.textureType=this._textureType,H.fragmentUrl=this._fragmentUrl,H.parameters=this._parameters,H.samplers=this._samplers,H.uniformBuffers=this._uniformBuffers,H.options=this._options,H.defines=this._postProcessDefines,H.textureFormat=this._textureFormat,H.vertexUrl=this._vertexUrl,H.indexParameters=this._indexParameters,H}clone(){const H=this.serialize();H._engine=this._engine,H.cameraId=null;const c=m.Parse(H,this._scene,"");return c?(c.onActivateObservable=this.onActivateObservable.clone(),c.onSizeChangedObservable=this.onSizeChangedObservable.clone(),c.onApplyObservable=this.onApplyObservable.clone(),c.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),c.onAfterRenderObservable=this.onAfterRenderObservable.clone(),c._prePassEffectConfiguration=this._prePassEffectConfiguration,c):null}static Parse(H,c,y){const Z=(0,i.c)(H.customType);if(!Z||!Z._Parse)return null;const F=c?c.getCameraById(H.cameraId):null;return Z._Parse(H,F,c,y)}static _Parse(H,c,y,Z){return a.e.Parse((()=>new m(H.name,H.fragmentUrl,H.parameters,H.samplers,H.options,c,H.renderTargetSamplingMode,H._engine,H.reusable,H.defines,H.textureType,H.vertexUrl,H.indexParameters,!1,H.textureFormat)),H,y,Z)}}(0,Z.b)([(0,O.P)()],m.prototype,"uniqueId",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"name",null),(0,Z.b)([(0,O.P)()],m.prototype,"width",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"height",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"renderTargetSamplingMode",void 0),(0,Z.b)([(0,O.o)()],m.prototype,"clearColor",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"Ti",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"forceAutoClearInAlphaMode",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"alphaMode",null),(0,Z.b)([(0,O.P)()],m.prototype,"alphaConstants",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"enablePixelPerfectMode",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"forceFullscreenViewport",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"scaleMode",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"alwaysForcePOT",void 0),(0,Z.b)([(0,O.P)("samples")],m.prototype,"_samples",void 0),(0,Z.b)([(0,O.P)()],m.prototype,"adaptScaleToCurrentViewport",void 0),(0,i.d)("BABYLON.PostProcess",m)},11165:(H,c,y)=>{"use strict";y.d(c,{c:()=>P});var Z=y(11153),F=y(10763);class P{constructor(H){this._vertexBuffers={},this.onBeforeRenderObservable=new F.e,this._scene=H}_prepareBuffers(){if(this._vertexBuffers[Z.h.PositionKind])return;const H=[];H.push(1,1),H.push(-1,1),H.push(-1,-1),H.push(1,-1),this._vertexBuffers[Z.h.PositionKind]=new Z.h(this._scene.getEngine(),H,Z.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const H=[];H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(H)}_rebuild(){const H=this._vertexBuffers[Z.h.PositionKind];H&&(H._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.activeCamera;return!!y&&(c=c||y._postProcesses.filter((H=>null!=H)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(y,H,null!==c&&void 0!==c),!0))}directRender(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=this._scene.getEngine();for(let O=0;O<H.length;O++){var n;if(O<H.length-1)H[O+1].activate(this._scene.activeCamera,null===c||void 0===c?void 0:c.texture);else c?S.bindFramebuffer(c,Z,void 0,void 0,y,F):P||S.restoreDefaultFramebuffer(),null===(n=S._debugInsertMarker)||void 0===n||n.call(S,`post process ${H[O].name} output`);const a=H[O],i=a.apply();i&&(a.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,i),S.drawElementsType(0,0,6),a.onAfterRenderObservable.notifyObservers(i))}S.setDepthBuffer(!0),S.setDepthWrite(!0)}_finalizeFrame(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this._scene.activeCamera;if(!P)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Z=Z||P._postProcesses.filter((H=>null!=H))).length||!this._scene.postProcessesEnabled)return;const S=this._scene.getEngine();for(let O=0,a=Z.length;O<a;O++){const i=Z[O];var n;if(O<a-1)i._outputTexture=Z[O+1].activate(P,null===c||void 0===c?void 0:c.texture);else c?(S.bindFramebuffer(c,y,void 0,void 0,F),i._outputTexture=c):(S.restoreDefaultFramebuffer(),i._outputTexture=null),null===(n=S._debugInsertMarker)||void 0===n||n.call(S,`post process ${Z[O].name} output`);if(H)break;const C=i.apply();C&&(i.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,C),S.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(C))}S.setDepthBuffer(!0),S.setDepthWrite(!0),S.setAlphaMode(0)}dispose(){const H=this._vertexBuffers[Z.h.PositionKind];H&&(H.dispose(),this._vertexBuffers[Z.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11170:(H,c,y)=>{"use strict";y.d(c,{d:()=>n});var Z=y(11071),F=y(11092);class P{set opaqueSortCompareFn(H){this._opaqueSortCompareFn=H||P.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(H){this._alphaTestSortCompareFn=H||P.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(H){this._transparentSortCompareFn=H||P.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=H,this._opaqueSubMeshes=new Z.c(256),this._transparentSubMeshes=new Z.c(256),this._alphaTestSubMeshes=new Z.c(256),this._depthOnlySubMeshes=new Z.c(256),this._particleSystems=new Z.c(256),this._spriteManagers=new Z.c(256),this._empty=!0,this._edgesRenderers=new Z.b(16),this._scene=c,this.opaqueSortCompareFn=y,this.alphaTestSortCompareFn=F,this.transparentSortCompareFn=P}render(H,c,y,Z){if(H)return void H(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const F=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(F.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),F.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const P=F.getStencilBuffer();if(F.setStencilBuffer(!1),c&&this._renderSprites(),y&&this._renderParticles(Z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(F.setStencilBuffer(P),this._scene.useOrderIndependentTransparency){const H=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);H.length&&this._renderTransparent(H)}else this._renderTransparent(this._transparentSubMeshes);F.setAlphaMode(0)}if(F.setStencilBuffer(!1),this._edgesRenderers.length){for(let H=0;H<this._edgesRenderers.length;H++)this._edgesRenderers.data[H].render();F.setAlphaMode(0)}F.setStencilBuffer(P)}_renderOpaqueSorted(H){P._RenderSorted(H,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(H){P._RenderSorted(H,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(H){P._RenderSorted(H,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(H,c,y,Z){let S,n=0;const O=y?y.globalPosition:P._ZeroVector;if(Z)for(;n<H.length;n++)S=H.data[n],S._alphaIndex=S.getMesh().alphaIndex,S._distanceToCamera=F.n.Distance(S.getBoundingInfo().boundingSphere.centerWorld,O);const a=H.length===H.data.length?H.data:H.data.slice(0,H.length);c&&a.sort(c);const i=a[0].getMesh().va();for(n=0;n<a.length;n++)if(S=a[n],!i._activeMeshesFrozenButKeepClipping||S.isInFrustum(i._frustumPlanes)){if(Z){const H=S.Ha();if(H&&H.needDepthPrePass){const c=H.va().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),S.render(!1),c.setColorWrite(!0)}}S.render(Z)}}static defaultTransparentSortCompare(H,c){return H._alphaIndex>c._alphaIndex?1:H._alphaIndex<c._alphaIndex?-1:P.backToFrontSortCompare(H,c)}static backToFrontSortCompare(H,c){return H._distanceToCamera<c._distanceToCamera?1:H._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(H,c){return H._distanceToCamera<c._distanceToCamera?-1:H._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(H,c){const y=H.getMesh(),Z=c.getMesh();return y.material&&Z.material?y.material.uniqueId-Z.material.uniqueId:y.uniqueId-Z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(H,c,y){void 0===c&&(c=H.getMesh()),void 0===y&&(y=H.Ha()),null!==y&&void 0!==y&&(y.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(H):y.needAlphaTesting()?(y.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._alphaTestSubMeshes.push(H)):(y.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._opaqueSubMeshes.push(H)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(H){this._spriteManagers.push(H),this._empty=!1}dispatchParticles(H){this._particleSystems.push(H),this._empty=!1}_renderParticles(H){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let y=0;y<this._particleSystems.length;y++){const Z=this._particleSystems.data[y];if(0===(c&&c.layerMask&Z.layerMask))continue;const F=Z.j;F.position&&H&&-1===H.indexOf(F)||this._scene._activeParticles.addCount(Z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const H=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const y=this._spriteManagers.data[c];0!==(H&&H.layerMask&y.layerMask)&&y.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}P._ZeroVector=F.n.Zero();class S{}class n{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(H){H!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=H,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const H of this._scene.meshes)if(H.$f)for(const c of H.$f)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const H of this._scene.spriteManagers)H._wasDispatched=!1;for(const H of this._scene.qj)H._wasDispatched=!1}constructor(H){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new S,this._maintainStateBetweenFrames=!1,this._scene=H;for(let c=n.MIN_RENDERINGGROUPS;c<n.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={Ti:!0,depth:!0,stencil:!0}}getRenderingGroup(H){const c=H||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,H,c),this._depthStencilBufferAlreadyCleaned=!0)}render(H,c,y,Z){const F=this._renderingGroupInfo;if(F.Gd=this._scene,F.camera=this._scene.activeCamera,this._scene.spriteManagers&&Z)for(let P=0;P<this._scene.spriteManagers.length;P++){const H=this._scene.spriteManagers[P];this.dispatchSprites(H)}for(let P=n.MIN_RENDERINGGROUPS;P<n.MAX_RENDERINGGROUPS;P++){this._depthStencilBufferAlreadyCleaned=P===n.MIN_RENDERINGGROUPS;const S=this._renderingGroups[P];if(!S||S._empty)continue;const O=1<<P;if(F.renderingGroupId=P,this._scene.onBeforeRenderingGroupObservable.notifyObservers(F,O),n.AUTOCLEAR){const H=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(P):this._autoClearDepthStencil[P];H&&H.Ti&&this._clearDepthStencilBuffer(H.depth,H.stencil)}for(const H of this._scene._beforeRenderingGroupDrawStage)H.action(P);S.render(H,Z,y,c);for(const H of this._scene._afterRenderingGroupDrawStage)H.action(P);this._scene.onAfterRenderingGroupObservable.notifyObservers(F,O)}}reset(){if(!this.maintainStateBetweenFrames)for(let H=n.MIN_RENDERINGGROUPS;H<n.MAX_RENDERINGGROUPS;H++){const c=this._renderingGroups[H];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let H=n.MIN_RENDERINGGROUPS;H<n.MAX_RENDERINGGROUPS;H++){const c=this._renderingGroups[H];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let H=n.MIN_RENDERINGGROUPS;H<n.MAX_RENDERINGGROUPS;H++){const c=this._renderingGroups[H];c&&c.dispose()}}_prepareRenderingGroup(H){void 0===this._renderingGroups[H]&&(this._renderingGroups[H]=new P(H,this._scene,this._customOpaqueSortCompareFn[H],this._customAlphaTestSortCompareFn[H],this._customTransparentSortCompareFn[H]))}dispatchSprites(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchSprites(H))}dispatchParticles(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchParticles(H))}dispatch(H,c,y){void 0===c&&(c=H.getMesh()),this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(H,c,y))}setRenderingOrder(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[H]=c,this._customAlphaTestSortCompareFn[H]=y,this._customTransparentSortCompareFn[H]=Z,this._renderingGroups[H]){const c=this._renderingGroups[H];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[H],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[H],c.transparentSortCompareFn=this._customTransparentSortCompareFn[H]}}setRenderingAutoClearDepthStencil(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[H]={Ti:c,depth:y,stencil:Z}}getAutoClearDepthStencilSetup(H){return this._autoClearDepthStencil[H]}}n.MAX_RENDERINGGROUPS=4,n.MIN_RENDERINGGROUPS=0,n.AUTOCLEAR=!0},11829:(H,c,y)=>{"use strict";const Z="clipPlaneFragment",F="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11789:(H,c,y)=>{"use strict";const Z="clipPlaneFragmentDeclaration",F="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11854:(H,c,y)=>{"use strict";const Z="clipPlaneVertex",F="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11845:(H,c,y)=>{"use strict";const Z="clipPlaneVertexDeclaration",F="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11835:(H,c,y)=>{"use strict";const Z="fogFragment",F="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11822:(H,c,y)=>{"use strict";const Z="fogFragmentDeclaration",F="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11858:(H,c,y)=>{"use strict";const Z="fogVertex",F="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11847:(H,c,y)=>{"use strict";const Z="fogVertexDeclaration",F="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11808:(H,c,y)=>{"use strict";const Z="helperFunctions",F="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11792:(H,c,y)=>{"use strict";const Z="imageProcessingDeclaration",F="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11817:(H,c,y)=>{"use strict";const Z="imageProcessingFunctions",F="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11799:(H,c,y)=>{"use strict";const Z="logDepthDeclaration",F="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11832:(H,c,y)=>{"use strict";const Z="logDepthFragment",F="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11860:(H,c,y)=>{"use strict";const Z="logDepthVertex",F="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";y(10855).e.IncludesShadersStoreWGSL[Z]=F},11783:(H,c,y)=>{"use strict";y.r(c),y.d(c,{particlesPixelShaderWGSL:()=>S});var Z=y(10855);y(11789),y(11792),y(11799),y(11808),y(11817),y(11822),y(11829),y(11832),y(11835);const F="particlesPixelShader",P="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.e.ShadersStoreWGSL[F]=P;const S={name:F,shader:P}},11840:(H,c,y)=>{"use strict";y.r(c),y.d(c,{particlesVertexShaderWGSL:()=>S});var Z=y(10855);y(11845),y(11847),y(11799),y(11854),y(11858),y(11860);const F="particlesVertexShader",P="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.e.ShadersStoreWGSL[F]=P;const S={name:F,shader:P}},11708:(H,c,y)=>{"use strict";const Z="clipPlaneFragment",F="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11771:(H,c,y)=>{"use strict";const Z="clipPlaneFragmentDeclaration",F="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11722:(H,c,y)=>{"use strict";const Z="clipPlaneVertex",F="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11781:(H,c,y)=>{"use strict";const Z="clipPlaneVertexDeclaration",F="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11712:(H,c,y)=>{"use strict";const Z="fogFragment",F="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11704:(H,c,y)=>{"use strict";const Z="fogFragmentDeclaration",F="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11730:(H,c,y)=>{"use strict";const Z="fogVertex",F="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11719:(H,c,y)=>{"use strict";const Z="fogVertexDeclaration",F="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11691:(H,c,y)=>{"use strict";const Z="helperFunctions",F="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";y(10855).e.IncludesShadersStore[Z]=F},11675:(H,c,y)=>{"use strict";const Z="imageProcessingDeclaration",F="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11698:(H,c,y)=>{"use strict";const Z="imageProcessingFunctions",F="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";y(10855).e.IncludesShadersStore[Z]=F},11684:(H,c,y)=>{"use strict";const Z="logDepthDeclaration",F="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11710:(H,c,y)=>{"use strict";const Z="logDepthFragment",F="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11737:(H,c,y)=>{"use strict";const Z="logDepthVertex",F="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";y(10855).e.IncludesShadersStore[Z]=F},11767:(H,c,y)=>{"use strict";y.r(c),y.d(c,{particlesPixelShader:()=>S});var Z=y(10855);y(11771),y(11675),y(11684),y(11691),y(11698),y(11704),y(11708),y(11710),y(11712);const F="particlesPixelShader",P="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.e.ShadersStore[F]=P;const S={name:F,shader:P}},11774:(H,c,y)=>{"use strict";y.r(c),y.d(c,{particlesVertexShader:()=>S});var Z=y(10855);y(11781),y(11719),y(11684),y(11722),y(11730),y(11737);const F="particlesVertexShader",P="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.e.ShadersStore[F]=P;const S={name:F,shader:P}},11658:(H,c,y)=>{"use strict";y.r(c),y.d(c,{postprocessVertexShader:()=>P});const Z="postprocessVertexShader",F="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";y(10855).e.ShadersStore[Z]=F;const P={name:Z,shader:F}},11197:(H,c,y)=>{"use strict";y.d(c,{c:()=>Z});class Z{}Z._IsPickingAvailable=!1},11364:(H,c,y)=>{"use strict";y.d(c,{d:()=>C});var Z=y(11052),F=y(11092),P=y(11061),S=y(10763),n=y(10810),O=y(10798),a=y(11118);class i{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new S.e,this._onClonedObservable=new S.e}}class C{static AddNodeConstructor(H,c){this._NodeConstructors[H]=c}static Construct(H,c,y,Z){const F=this._NodeConstructors[H];return F?F(c,y,Z):null}set accessibilityTag(H){this._accessibilityTag=H,this.onAccessibilityTagChangedObservable.notifyObservers(H)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(H){this._nodeDataStorage._doNotSerialize=H}u(){return this._nodeDataStorage._isDisposed}set parent(H){if(this._parentNode===H)return;const c=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1),H||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=H,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),c||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(H){H.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const H=this._scene.rootNodes,c=H.length-1;H[this._nodeDataStorage._sceneRootNodesIndex]=H[c],H[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}getClassName(){return"Node"}set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new i,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new S.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=F.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.jj=new S.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=H,this.id=H,this._scene=c||n.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),y&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(H)||(H.init(),this._scene.isLoading&&!c?this._scene.onDataLoadedObservable.addOnce((()=>{H.attach(this)})):H.attach(this),this._behaviors.push(H)),this}removeBehavior(H){const c=this._behaviors.indexOf(H);return-1===c||(this._behaviors[c].detach(),this._behaviors.splice(c,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(H){for(const c of this._behaviors)if(c.name===H)return c;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Oj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(H){!H&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(H){return this.parent?this.parent._getActionManagerForTrigger(H,!1):null}_updateCache(H){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Fg(H){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((H=>{H._syncParentEnabledState()}))}Tb(H){this._nodeDataStorage._isEnabled!==H&&(this._nodeDataStorage._isEnabled=H,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(H))}isDescendantOf(H){return!!this.parent&&(this.parent===H||this.parent.isDescendantOf(H))}_getDescendants(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;if(this._children)for(let Z=0;Z<this._children.length;Z++){const F=this._children[Z];y&&!y(F)||H.push(F),c||F._getDescendants(H,!1,y)}}getDescendants(H,c){const y=[];return this._getDescendants(y,H,c),y}getChildMeshes(H,c){const y=[];return this._getDescendants(y,H,(H=>(!c||c(H))&&void 0!==H.Di)),y}getChildren(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(c,H)}_setReady(H){H!==this._nodeDataStorage._isReady&&(H?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(H){for(let c=0;c<this.animations.length;c++){const y=this.animations[c];if(y.name===H)return y}return null}createAnimationRange(H,c,y){if(!this._ranges[H]){this._ranges[H]=C._AnimationRangeFactory(H,c,y);for(let Z=0,F=this.animations.length;Z<F;Z++)this.animations[Z]&&this.animations[Z].createRange(H,c,y)}}deleteAnimationRange(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let y=0,Z=this.animations.length;y<Z;y++)this.animations[y]&&this.animations[y].deleteRange(H,c);this._ranges[H]=null}getAnimationRange(H){return this._ranges[H]||null}clone(H,c,y){const Z=a.e.Clone((()=>new C(H,this.va())),this);if(c&&(Z.parent=c),!y){const c=this.getDescendants(!0);for(let y=0;y<c.length;y++){const F=c[y];F.clone(H+"."+F.name,Z)}}return Z}getAnimationRanges(){const H=[];let c;for(c in this._ranges)H.push(this._ranges[c]);return H}beginAnimation(H,c,y,Z){const F=this.getAnimationRange(H);return F?this._scene.beginAnimation(this,F.from,F.to,c,y,Z):null}serializeAnimationRanges(){const H=[];for(const c in this._ranges){const y=this._ranges[c];if(!y)continue;const Z={};Z.name=c,Z.from=y.from,Z.to=y.to,H.push(Z)}return H}Oj(H){return this._worldMatrix||(this._worldMatrix=F.d.Identity()),this._worldMatrix}dispose(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!H){const y=this.getDescendants(!0);for(const Z of y)Z.dispose(H,c)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.jj.notifyObservers(this),this.jj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const y of this._behaviors)y.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(H,c,y){if(c.ranges)for(let Z=0;Z<c.ranges.length;Z++){const y=c.ranges[Z];H.createAnimationRange(y.name,y.from,y.to)}}getHierarchyBoundingVectors(){let H,c,y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Oj(!0);const P=this;if(P.getBoundingInfo&&P.$f){const y=P.getBoundingInfo();H=y.boundingBox.minimumWorld.clone(),c=y.boundingBox.maximumWorld.clone()}else H=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new F.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(y){const y=this.getDescendants(!1);for(const P of y){const y=P;if(y.Oj(!0),Z&&!Z(y))continue;if(!y.getBoundingInfo||0===y.getTotalVertices())continue;const S=y.getBoundingInfo().boundingBox,n=S.minimumWorld,O=S.maximumWorld;F.n.CheckExtends(n,H,c),F.n.CheckExtends(O,H,c)}}return{min:H,max:c}}}C._AnimationRangeFactory=(H,c,y)=>{throw(0,O.b)("AnimationRange")},C._NodeConstructors={},(0,Z.b)([(0,P.P)()],C.prototype,"name",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"id",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"uniqueId",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"state",void 0),(0,Z.b)([(0,P.P)()],C.prototype,"metadata",void 0)},11076:(H,c,y)=>{"use strict";y.d(c,{d:()=>HH});var Z=y(10754),F=y(10790),P=y(10763),S=y(11071);class n{constructor(){this._count=0,this._data={}}p(H){this.clear(),H.forEach(((H,c)=>this.add(H,c)))}get(H){const c=this._data[H];if(void 0!==c)return c}getOrAddWithFactory(H,c){let y=this.get(H);return void 0!==y||(y=c(H),y&&this.add(H,y)),y}getOrAdd(H,c){const y=this.get(H);return void 0!==y?y:(this.add(H,c),c)}contains(H){return void 0!==this._data[H]}add(H,c){return void 0===this._data[H]&&(this._data[H]=c,++this._count,!0)}set(H,c){return void 0!==this._data[H]&&(this._data[H]=c,!0)}getAndRemove(H){const c=this.get(H);return void 0!==c?(delete this._data[H],--this._count,c):null}remove(H){return!!this.contains(H)&&(delete this._data[H],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(H){for(const c in this._data){H(c,this._data[c])}}first(H){for(const c in this._data){const y=H(c,this._data[c]);if(y)return y}return null}}var O=y(11083),a=y(11092),i=y(11108),C=y(11140),g=y(11146);class v{constructor(H,c,y,Z,F,P){this.source=H,this.pointerX=c,this.pointerY=y,this.meshUnderPointer=Z,this.sourceEvent=F,this.additionalData=P}static CreateNew(H,c,y){const Z=H.va();return new v(H,Z.pointerX,Z.pointerY,Z.meshUnderPointer||H,c,y)}static CreateNewFromSprite(H,c,y,Z){return new v(H,c.pointerX,c.pointerY,c.meshUnderPointer,y,Z)}static CreateNewFromScene(H,c){return new v(null,H.pointerX,H.pointerY,H.meshUnderPointer,c)}static CreateNewFromPrimitive(H,c,y,Z){return new v(H,c.x,c.y,null,y,Z)}}var m=y(11165),z=y(11170),V=y(11174),h=y(10768),Q=y(10810),D=y(10798),f=y(11181);class J{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const H in J.Triggers)if(Object.prototype.hasOwnProperty.call(J.Triggers,H))return!0;return!1}static get HasPickTriggers(){for(const H in J.Triggers)if(Object.prototype.hasOwnProperty.call(J.Triggers,H)){const c=parseInt(H);if(c>=1&&c<=7)return!0}return!1}static HasSpecificTrigger(H){for(const c in J.Triggers)if(Object.prototype.hasOwnProperty.call(J.Triggers,c)){if(parseInt(c)===H)return!0}return!1}}J.Triggers={};var l,d,K,T,u,E,U,G=y(11184);!function(H){H[H.Generic=0]="Generic",H[H.Keyboard=1]="Keyboard",H[H.Mouse=2]="Mouse",H[H.Touch=3]="Touch",H[H.DualShock=4]="DualShock",H[H.Xbox=5]="Xbox",H[H.Switch=6]="Switch",H[H.DualSense=7]="DualSense"}(l||(l={})),function(H){H[H.Horizontal=0]="Horizontal",H[H.Vertical=1]="Vertical",H[H.LeftClick=2]="LeftClick",H[H.MiddleClick=3]="MiddleClick",H[H.RightClick=4]="RightClick",H[H.BrowserBack=5]="BrowserBack",H[H.BrowserForward=6]="BrowserForward",H[H.MouseWheelX=7]="MouseWheelX",H[H.MouseWheelY=8]="MouseWheelY",H[H.MouseWheelZ=9]="MouseWheelZ",H[H.Move=12]="Move"}(d||(d={})),function(H){H[H.Horizontal=0]="Horizontal",H[H.Vertical=1]="Vertical",H[H.LeftClick=2]="LeftClick",H[H.MiddleClick=3]="MiddleClick",H[H.RightClick=4]="RightClick",H[H.BrowserBack=5]="BrowserBack",H[H.BrowserForward=6]="BrowserForward",H[H.MouseWheelX=7]="MouseWheelX",H[H.MouseWheelY=8]="MouseWheelY",H[H.MouseWheelZ=9]="MouseWheelZ",H[H.DeltaHorizontal=10]="DeltaHorizontal",H[H.DeltaVertical=11]="DeltaVertical"}(K||(K={})),function(H){H[H.Cross=0]="Cross",H[H.Circle=1]="Circle",H[H.Square=2]="Square",H[H.Triangle=3]="Triangle",H[H.L1=4]="L1",H[H.R1=5]="R1",H[H.L2=6]="L2",H[H.R2=7]="R2",H[H.Share=8]="Share",H[H.Options=9]="Options",H[H.L3=10]="L3",H[H.R3=11]="R3",H[H.DPadUp=12]="DPadUp",H[H.DPadDown=13]="DPadDown",H[H.DPadLeft=14]="DPadLeft",H[H.DPadRight=15]="DPadRight",H[H.Home=16]="Home",H[H.TouchPad=17]="TouchPad",H[H.LStickXAxis=18]="LStickXAxis",H[H.LStickYAxis=19]="LStickYAxis",H[H.RStickXAxis=20]="RStickXAxis",H[H.RStickYAxis=21]="RStickYAxis"}(T||(T={})),function(H){H[H.Cross=0]="Cross",H[H.Circle=1]="Circle",H[H.Square=2]="Square",H[H.Triangle=3]="Triangle",H[H.L1=4]="L1",H[H.R1=5]="R1",H[H.L2=6]="L2",H[H.R2=7]="R2",H[H.Create=8]="Create",H[H.Options=9]="Options",H[H.L3=10]="L3",H[H.R3=11]="R3",H[H.DPadUp=12]="DPadUp",H[H.DPadDown=13]="DPadDown",H[H.DPadLeft=14]="DPadLeft",H[H.DPadRight=15]="DPadRight",H[H.Home=16]="Home",H[H.TouchPad=17]="TouchPad",H[H.LStickXAxis=18]="LStickXAxis",H[H.LStickYAxis=19]="LStickYAxis",H[H.RStickXAxis=20]="RStickXAxis",H[H.RStickYAxis=21]="RStickYAxis"}(u||(u={})),function(H){H[H.A=0]="A",H[H.B=1]="B",H[H.X=2]="X",H[H.Y=3]="Y",H[H.LB=4]="LB",H[H.RB=5]="RB",H[H.LT=6]="LT",H[H.RT=7]="RT",H[H.Back=8]="Back",H[H.Start=9]="Start",H[H.LS=10]="LS",H[H.RS=11]="RS",H[H.DPadUp=12]="DPadUp",H[H.DPadDown=13]="DPadDown",H[H.DPadLeft=14]="DPadLeft",H[H.DPadRight=15]="DPadRight",H[H.Home=16]="Home",H[H.LStickXAxis=17]="LStickXAxis",H[H.LStickYAxis=18]="LStickYAxis",H[H.RStickXAxis=19]="RStickXAxis",H[H.RStickYAxis=20]="RStickYAxis"}(E||(E={})),function(H){H[H.B=0]="B",H[H.A=1]="A",H[H.Y=2]="Y",H[H.X=3]="X",H[H.L=4]="L",H[H.R=5]="R",H[H.ZL=6]="ZL",H[H.ZR=7]="ZR",H[H.Minus=8]="Minus",H[H.Plus=9]="Plus",H[H.LS=10]="LS",H[H.RS=11]="RS",H[H.DPadUp=12]="DPadUp",H[H.DPadDown=13]="DPadDown",H[H.DPadLeft=14]="DPadLeft",H[H.DPadRight=15]="DPadRight",H[H.Home=16]="Home",H[H.Capture=17]="Capture",H[H.LStickXAxis=18]="LStickXAxis",H[H.LStickYAxis=19]="LStickYAxis",H[H.RStickXAxis=20]="RStickXAxis",H[H.RStickYAxis=21]="RStickYAxis"}(U||(U={}));var p=y(11190);class t{static CreateDeviceEvent(H,c,y,Z,F,P,S){switch(H){case l.Keyboard:return this._CreateKeyboardEvent(y,Z,F,P);case l.Mouse:if(y===d.MouseWheelX||y===d.MouseWheelY||y===d.MouseWheelZ)return this._CreateWheelEvent(H,c,y,Z,F,P);case l.Touch:return this._CreatePointerEvent(H,c,y,Z,F,P,S);default:throw`Unable to generate event for device ${l[H]}`}}static _CreatePointerEvent(H,c,y,Z,F,P,S){const n=this._CreateMouseEvent(H,c,y,Z,F,P);H===l.Mouse?(n.deviceType=l.Mouse,n.pointerId=1,n.pointerType="mouse"):(n.deviceType=l.Touch,n.pointerId=S??c,n.pointerType="touch");let O=0;return O+=F.pollInput(H,c,d.LeftClick),O+=2*F.pollInput(H,c,d.RightClick),O+=4*F.pollInput(H,c,d.MiddleClick),n.buttons=O,y===d.Move?n.type="pointermove":y>=d.LeftClick&&y<=d.RightClick&&(n.type=1===Z?"pointerdown":"pointerup",n.button=y-2),n}static _CreateWheelEvent(H,c,y,Z,F,P){const S=this._CreateMouseEvent(H,c,y,Z,F,P);switch(S.pointerId=1,S.type="wheel",S.deltaMode=p.b.DOM_DELTA_PIXEL,S.deltaX=0,S.deltaY=0,S.deltaZ=0,y){case d.MouseWheelX:S.deltaX=Z;break;case d.MouseWheelY:S.deltaY=Z;break;case d.MouseWheelZ:S.deltaZ=Z}return S}static _CreateMouseEvent(H,c,y,Z,F,P){const S=this._CreateEvent(P),n=F.pollInput(H,c,d.Horizontal),O=F.pollInput(H,c,d.Vertical);return P?(S.movementX=0,S.movementY=0,S.offsetX=S.movementX-P.getBoundingClientRect().x,S.offsetY=S.movementY-P.getBoundingClientRect().y):(S.movementX=F.pollInput(H,c,10),S.movementY=F.pollInput(H,c,11),S.offsetX=0,S.offsetY=0),this._CheckNonCharacterKeys(S,F),S.clientX=n,S.clientY=O,S.x=n,S.y=O,S.deviceType=H,S.deviceSlot=c,S.inputIndex=y,S}static _CreateKeyboardEvent(H,c,y,Z){const F=this._CreateEvent(Z);return this._CheckNonCharacterKeys(F,y),F.deviceType=l.Keyboard,F.deviceSlot=0,F.inputIndex=H,F.type=1===c?"keydown":"keyup",F.key=String.fromCharCode(H),F.keyCode=H,F}static _CheckNonCharacterKeys(H,c){const y=c.isDeviceAvailable(l.Keyboard),Z=y&&1===c.pollInput(l.Keyboard,0,18),F=y&&1===c.pollInput(l.Keyboard,0,17),P=y&&(1===c.pollInput(l.Keyboard,0,91)||1===c.pollInput(l.Keyboard,0,92)||1===c.pollInput(l.Keyboard,0,93)),S=y&&1===c.pollInput(l.Keyboard,0,16);H.altKey=Z,H.ctrlKey=F,H.metaKey=P,H.shiftKey=S}static _CreateEvent(H){const c={preventDefault:()=>{}};return c.target=H,c}}class o{constructor(H,c,y){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(H,c,((H,c,Z,F)=>{const P=t.CreateDeviceEvent(H,c,Z,F,this);y(H,c,P)})):this._createDummyNativeInput()}pollInput(H,c,y){return this._nativeInput.pollInput(H,c,y)}isDeviceAvailable(H){return H===l.Mouse||H===l.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const s=Object.keys(d).length/2;class q{constructor(H,c,y,F){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Z.c.IsSafari(),this._usingMacOS=(0,h.f)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=H=>{},this._keyboardUpEvent=H=>{},this._keyboardBlurEvent=H=>{},this._pointerMoveEvent=H=>{},this._pointerDownEvent=H=>{},this._pointerUpEvent=H=>{},this._pointerCancelEvent=H=>{},this._pointerWheelEvent=H=>{},this._pointerBlurEvent=H=>{},this._pointerMacOSChromeOutEvent=H=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,h.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,h.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=H=>{},this._gamepadDisconnectedEvent=H=>{},this._eventPrefix=Z.c.GetPointerPrefix(H),this._engine=H,this._onDeviceConnected=c,this._onDeviceDisconnected=y,this._onInputChanged=F,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(H,c,y){const F=this._inputs[H][c];if(!F)throw`Unable to find device ${l[H]}`;H>=l.DualShock&&H<=l.DualSense&&this._updateDevice(H,c,y);const P=F[y];if(void 0===P)throw`Unable to find input ${y} for device ${l[H]} in slot ${c}`;return y===d.Move&&Z.c.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),P}isDeviceAvailable(H){return void 0!==this._inputs[H]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const H=null===this||void 0===this?void 0:this._engine.getInputElement();if(H&&(!this._eventsAttached||this._elementToAttachTo!==H)){if(this._disableEvents(),this._inputs)for(const H of this._inputs)if(H)for(const c in H){const y=H[+c];if(y)for(let H=0;H<y.length;H++)y[H]=0}this._elementToAttachTo=H,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const H=navigator.getGamepads();for(const c of H)c&&this._addGamePad(c)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(l.Mouse,0,0,0)}_addGamePad(H){const c=this._getGamepadDeviceType(H.id),y=H.index;this._gamepads=this._gamepads||new Array(H.index+1),this._registerDevice(c,y,H.buttons.length+H.axes.length),this._gamepads[y]=c}_addPointerDevice(H,c,y,Z){this._pointerActive||(this._pointerActive=!0),this._registerDevice(H,c,s);const F=this._inputs[H][c];F[0]=y,F[1]=Z}_registerDevice(H,c,y){if(void 0===c)throw`Unable to register device ${l[H]} to undefined slot.`;if(this._inputs[H]||(this._inputs[H]={}),!this._inputs[H][c]){const Z=new Array(y);Z.fill(0),this._inputs[H][c]=Z,this._onDeviceConnected(H,c)}}_unregisterDevice(H,c){this._inputs[H][c]&&(delete this._inputs[H][c],this._onDeviceDisconnected(H,c))}_handleKeyActions(){this._keyboardDownEvent=H=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(l.Keyboard,0,255));const c=this._inputs[l.Keyboard][0];if(c){c[H.keyCode]=1;const y=H;y.inputIndex=H.keyCode,this._usingMacOS&&H.metaKey&&"Meta"!==H.key&&(this._metaKeys.includes(H.keyCode)||this._metaKeys.push(H.keyCode)),this._onInputChanged(l.Keyboard,0,y)}},this._keyboardUpEvent=H=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(l.Keyboard,0,255));const c=this._inputs[l.Keyboard][0];if(c){c[H.keyCode]=0;const y=H;if(y.inputIndex=H.keyCode,this._usingMacOS&&"Meta"===H.key&&this._metaKeys.length>0){for(const H of this._metaKeys){const y=t.CreateDeviceEvent(l.Keyboard,0,H,0,this,this._elementToAttachTo);c[H]=0,this._onInputChanged(l.Keyboard,0,y)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(l.Keyboard,0,y)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const H=this._inputs[l.Keyboard][0];for(let c=0;c<H.length;c++)if(0!==H[c]){H[c]=0;const y=t.CreateDeviceEvent(l.Keyboard,0,c,0,this,this._elementToAttachTo);this._onInputChanged(l.Keyboard,0,y)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,h.f)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let Z=0;Z<this._maxTouchPoints;Z++)this._activeTouchIds[Z]=-1;this._pointerMoveEvent=H=>{const c=this._getPointerType(H);let y=c===l.Mouse?0:this._activeTouchIds.indexOf(H.pointerId);if(c===l.Touch&&-1===y){const F=this._activeTouchIds.indexOf(-1);if(!(F>=0))return void Z.c.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=F,this._activeTouchIds[F]=H.pointerId,this._onDeviceConnected(c,y)}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][y]||this._addPointerDevice(c,y,H.clientX,H.clientY);const F=this._inputs[c][y];if(F){const Z=H;Z.inputIndex=d.Move,F[d.Horizontal]=H.clientX,F[d.Vertical]=H.clientY,c===l.Touch&&0===F[d.LeftClick]&&(F[d.LeftClick]=1),void 0===H.pointerId&&(H.pointerId=this._mouseId),this._onInputChanged(c,y,Z),this._usingSafari||-1===H.button||(Z.inputIndex=H.button+2,F[H.button+2]=F[H.button+2]?0:1,this._onInputChanged(c,y,Z))}},this._pointerDownEvent=H=>{const c=this._getPointerType(H);let y=c===l.Mouse?0:H.pointerId;if(c===l.Touch){let c=this._activeTouchIds.indexOf(H.pointerId);if(-1===c&&(c=this._activeTouchIds.indexOf(-1)),!(c>=0))return void Z.c.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=c,this._activeTouchIds[c]=H.pointerId}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][y]?c===l.Touch&&this._onDeviceConnected(c,y):this._addPointerDevice(c,y,H.clientX,H.clientY);const F=this._inputs[c][y];if(F){const Z=F[d.Horizontal],S=F[d.Vertical];if(c===l.Mouse){if(void 0===H.pointerId&&(H.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(P){}}else if(H.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(H.pointerId)}catch(P){}F[d.Horizontal]=H.clientX,F[d.Vertical]=H.clientY,F[H.button+2]=1;const n=H;n.inputIndex=H.button+2,this._onInputChanged(c,y,n),Z===H.clientX&&S===H.clientY||(n.inputIndex=d.Move,this._onInputChanged(c,y,n))}},this._pointerUpEvent=H=>{var c;const y=this._getPointerType(H),Z=y===l.Mouse?0:this._activeTouchIds.indexOf(H.pointerId);if(y===l.Touch){if(-1===Z)return;this._activeTouchIds[Z]=-1}const F=null===(c=this._inputs[y])||void 0===c?void 0:c[Z];if(F&&0!==F[H.button+2]){var P,S,n,O;const c=F[d.Horizontal],a=F[d.Vertical];F[d.Horizontal]=H.clientX,F[d.Vertical]=H.clientY,F[H.button+2]=0;const i=H;void 0===H.pointerId&&(H.pointerId=this._mouseId),c===H.clientX&&a===H.clientY||(i.inputIndex=d.Move,this._onInputChanged(y,Z,i)),i.inputIndex=H.button+2,y===l.Mouse&&this._mouseId>=0&&null!==(P=(S=this._elementToAttachTo).hasPointerCapture)&&void 0!==P&&P.call(S,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):H.pointerId&&null!==(n=(O=this._elementToAttachTo).hasPointerCapture)&&void 0!==n&&n.call(O,H.pointerId)&&this._elementToAttachTo.releasePointerCapture(H.pointerId),this._onInputChanged(y,Z,i),y===l.Touch&&this._onDeviceDisconnected(y,Z)}},this._pointerCancelEvent=H=>{if("mouse"===H.pointerType){var c,y;const H=this._inputs[l.Mouse][0];this._mouseId>=0&&null!==(c=(y=this._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(y,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let c=d.LeftClick;c<=d.BrowserForward;c++)if(1===H[c]){H[c]=0;const y=t.CreateDeviceEvent(l.Mouse,0,c,0,this,this._elementToAttachTo);this._onInputChanged(l.Mouse,0,y)}}else{var Z,F;const c=this._activeTouchIds.indexOf(H.pointerId);if(-1===c)return;null!==(Z=(F=this._elementToAttachTo).hasPointerCapture)&&void 0!==Z&&Z.call(F,H.pointerId)&&this._elementToAttachTo.releasePointerCapture(H.pointerId),this._inputs[l.Touch][c][d.LeftClick]=0;const y=t.CreateDeviceEvent(l.Touch,c,d.LeftClick,0,this,this._elementToAttachTo,H.pointerId);this._onInputChanged(l.Touch,c,y),this._activeTouchIds[c]=-1,this._onDeviceDisconnected(l.Touch,c)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let H=!1;const c=function(){};try{const y=Object.defineProperty({},"passive",{get:function(){H=!0}});this._elementToAttachTo.addEventListener("test",c,y),this._elementToAttachTo.removeEventListener("test",c,y)}catch(y){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(l.Mouse)){var H,c;const y=this._inputs[l.Mouse][0];this._mouseId>=0&&null!==(H=(c=this._elementToAttachTo).hasPointerCapture)&&void 0!==H&&H.call(c,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let H=d.LeftClick;H<=d.BrowserForward;H++)if(1===y[H]){y[H]=0;const c=t.CreateDeviceEvent(l.Mouse,0,H,0,this,this._elementToAttachTo);this._onInputChanged(l.Mouse,0,c)}}if(this.isDeviceAvailable(l.Touch)){const H=this._inputs[l.Touch];for(let c=0;c<this._activeTouchIds.length;c++){var y,Z,F;const P=this._activeTouchIds[c];if(null!==(y=(Z=this._elementToAttachTo).hasPointerCapture)&&void 0!==y&&y.call(Z,P)&&this._elementToAttachTo.releasePointerCapture(P),-1!==P&&1===(null===(F=H[c])||void 0===F?void 0:F[d.LeftClick])){H[c][d.LeftClick]=0;const y=t.CreateDeviceEvent(l.Touch,c,d.LeftClick,0,this,this._elementToAttachTo,P);this._onInputChanged(l.Touch,c,y),this._activeTouchIds[c]=-1,this._onDeviceDisconnected(l.Touch,c)}}}},this._pointerWheelEvent=H=>{const c=l.Mouse;this._inputs[c]||(this._inputs[c]=[]),this._inputs[c][0]||(this._pointerActive=!0,this._registerDevice(c,0,s));const y=this._inputs[c][0];if(y){y[d.MouseWheelX]=H.deltaX||0,y[d.MouseWheelY]=H.deltaY||H.wheelDelta||0,y[d.MouseWheelZ]=H.deltaZ||0;const Z=H;void 0===H.pointerId&&(H.pointerId=this._mouseId),0!==y[d.MouseWheelX]&&(Z.inputIndex=d.MouseWheelX,this._onInputChanged(c,0,Z)),0!==y[d.MouseWheelY]&&(Z.inputIndex=d.MouseWheelY,this._onInputChanged(c,0,Z)),0!==y[d.MouseWheelZ]&&(Z.inputIndex=d.MouseWheelZ,this._onInputChanged(c,0,Z))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=H=>{H.buttons>1&&this._pointerCancelEvent(H)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!H&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(l.Mouse)){const H=this._inputs[l.Mouse][0];H[d.MouseWheelX]=0,H[d.MouseWheelY]=0,H[d.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=H=>{this._addGamePad(H.gamepad)},this._gamepadDisconnectedEvent=H=>{if(this._gamepads){const c=this._getGamepadDeviceType(H.gamepad.id),y=H.gamepad.index;this._unregisterDevice(c,y),delete this._gamepads[y]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(H,c,y){const Z=navigator.getGamepads()[c];if(Z&&H===this._gamepads[c]){const F=this._inputs[H][c];y>=Z.buttons.length?F[y]=Z.axes[y-Z.buttons.length].valueOf():F[y]=Z.buttons[y].value}}_getGamepadDeviceType(H){return-1!==H.indexOf("054c")?-1!==H.indexOf("0ce6")?l.DualSense:l.DualShock:-1!==H.indexOf("Xbox One")||-1!==H.search("Xbox 360")||-1!==H.search("xinput")?l.Xbox:-1!==H.indexOf("057e")?l.Switch:l.Generic}_getPointerType(H){let c=l.Mouse;return("touch"===H.pointerType||"pen"===H.pointerType||H.touches)&&(c=l.Touch),c}}class I{constructor(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=c,this.deviceSlot=y,this.onInputChangedObservable=new P.e,this._deviceInputSystem=H}getInput(H){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,H)}}class j{constructor(H){this._registeredManagers=new Array,this._refCount=0,this.registerManager=H=>{for(let c=0;c<this._devices.length;c++){const y=this._devices[c];for(const Z in y){const y=+Z;H._addDevice(new I(this._deviceInputSystem,c,y))}}this._registeredManagers.push(H)},this.unregisterManager=H=>{const c=this._registeredManagers.indexOf(H);c>-1&&this._registeredManagers.splice(c,1)};const c=Object.keys(l).length/2;this._devices=new Array(c);const y=(H,c)=>{this._devices[H]||(this._devices[H]=new Array),this._devices[H][c]||(this._devices[H][c]=c);for(const y of this._registeredManagers){const Z=new I(this._deviceInputSystem,H,c);y._addDevice(Z)}},Z=(H,c)=>{var y;null!==(y=this._devices[H])&&void 0!==y&&y[c]&&delete this._devices[H][c];for(const Z of this._registeredManagers)Z._removeDevice(H,c)},F=(H,c,y)=>{if(y)for(const Z of this._registeredManagers)Z._onInputChanged(H,c,y)};"undefined"!==typeof _native?this._deviceInputSystem=new o(y,Z,F):this._deviceInputSystem=new q(H,y,Z,F)}dispose(){this._deviceInputSystem.dispose()}}class k{getDeviceSource(H,c){if(void 0===c){if(void 0===this._firstDevice[H])return null;c=this._firstDevice[H]}return this._devices[H]&&void 0!==this._devices[H][c]?this._devices[H][c]:null}getDeviceSources(H){return this._devices[H]?this._devices[H].filter((H=>!!H)):[]}constructor(H){const c=Object.keys(l).length/2;this._devices=new Array(c),this._firstDevice=new Array(c),this._engine=H,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new j(H)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new P.e((H=>{for(const c of this._devices)if(c)for(const y of c)y&&this.onDeviceConnectedObservable.notifyObserver(H,y)})),this.onDeviceDisconnectedObservable=new P.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=H.jj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.jj.remove(this._onDisposeObserver)}_addDevice(H){this._devices[H.deviceType]||(this._devices[H.deviceType]=new Array),this._devices[H.deviceType][H.deviceSlot]||(this._devices[H.deviceType][H.deviceSlot]=H,this._updateFirstDevices(H.deviceType)),this.onDeviceConnectedObservable.notifyObservers(H)}_removeDevice(H,c){var y,Z;const F=null===(y=this._devices[H])||void 0===y?void 0:y[c];this.onDeviceDisconnectedObservable.notifyObservers(F),null!==(Z=this._devices[H])&&void 0!==Z&&Z[c]&&delete this._devices[H][c],this._updateFirstDevices(H)}_onInputChanged(H,c,y){var Z,F;null===(Z=this._devices[H])||void 0===Z||null===(F=Z[c])||void 0===F||F.onInputChangedObservable.notifyObservers(y)}_updateFirstDevices(H){switch(H){case l.Keyboard:case l.Mouse:this._firstDevice[H]=0;break;case l.Touch:case l.DualSense:case l.DualShock:case l.Xbox:case l.Switch:case l.Generic:{delete this._firstDevice[H];const c=this._devices[H];if(c)for(let y=0;y<c.length;y++)if(c[y]){this._firstDevice[H]=y;break}break}}}}var W=y(11197);class M{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(H){this._singleClick=H}set doubleClick(H){this._doubleClick=H}set hasSwiped(H){this._hasSwiped=H}set ignore(H){this._ignore=H}}class x{constructor(H){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new a.l(0,0),this._previousStartingPointerPosition=new a.l(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=H||Q.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(H){return this._meshUnderPointerId[H]||null}get unTranslatedPointer(){return new a.l(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(H){this._pointerX=H}get pointerY(){return this._pointerY}set pointerY(H){this._pointerY=H}_updatePointerPosition(H){const c=this._scene.getEngine().getInputElementClientRect();c&&(this._pointerX=H.clientX-c.left,this._pointerY=H.clientY-c.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(H,c){const y=this._scene,Z=y.getEngine(),F=Z.getInputElement();F&&(F.tabIndex=Z.canvasTabIndex,y.doNotHandleCursors||(F.style.cursor=y.defaultCursor)),this._setCursorAndPointerOverMesh(H,c,y);for(const O of y._pointerMoveStage){var P;const y=!(null===(P=H=H||this._pickMove(c))||void 0===P||!P.pickedMesh);H=O.action(this._unTranslatedPointerX,this._unTranslatedPointerY,H,y,F)}const S=c.inputIndex>=d.MouseWheelX&&c.inputIndex<=d.MouseWheelZ?f.e.POINTERWHEEL:f.e.POINTERMOVE;let n;y.onPointerMove&&(H=H||this._pickMove(c),y.onPointerMove(c,H,S)),H?(n=new f.i(S,c,H),this._setRayOnPointerInfo(H,c)):(n=new f.i(S,c,null,this),this._movePointerInfo=n),y.onPointerObservable.hasObservers()&&y.onPointerObservable.notifyObservers(n,S)}_setRayOnPointerInfo(H,c){const y=this._scene;H&&W.c._IsPickingAvailable&&(H.ray||(H.ray=y.createPickingRay(c.offsetX,c.offsetY,a.d.Identity(),y.activeCamera)))}_addCameraPointerObserver(H,c){return this._cameraObserverCount++,this._scene.onPointerObservable.add(H,c)}_removeCameraPointerObserver(H){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(H)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(H,c,y){const Z=this._scene,F=new f.h(y,c,this._unTranslatedPointerX,this._unTranslatedPointerY);return H&&(F.originalPickingInfo=H,F.ray=H.ray,"xr-near"===c.pointerType&&H.originMesh&&(F.nearInteractionPickingInfo=H)),Z.onPrePointerObservable.notifyObservers(F,y),!!F.skipOnPointerObservable}_pickMove(H){const c=this._scene,y=c.Nc(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerMovePredicate,c.pointerMoveFastCheck,c.cameraToUseForPointers,c.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(y,H,c),y}_setCursorAndPointerOverMesh(H,c,y){const Z=y.getEngine().getInputElement();if(null!==H&&void 0!==H&&H.pickedMesh){if(this.setPointerOverMesh(H.pickedMesh,c.pointerId,H,c),!y.doNotHandleCursors&&Z&&this._pointerOverMesh){const H=this._pointerOverMesh._getActionManagerForTrigger();H&&H.hasPointerTriggers&&(Z.style.cursor=H.hoverCursor||y.hoverCursor)}}else this.setPointerOverMesh(null,c.pointerId,H,c)}simulatePointerMove(H,c){const y=new PointerEvent("pointermove",c);y.inputIndex=d.Move,this._checkPrePointerObservable(H,y,f.e.POINTERMOVE)||this._processPointerMove(H,y)}simulatePointerDown(H,c){const y=new PointerEvent("pointerdown",c);y.inputIndex=y.button+2,this._checkPrePointerObservable(H,y,f.e.POINTERDOWN)||this._processPointerDown(H,y)}_processPointerDown(H,c){var y;const Z=this._scene;if(null!==(y=H)&&void 0!==y&&y.pickedMesh){this._pickedDownMesh=H.pickedMesh;const y=H.pickedMesh._getActionManagerForTrigger();if(y){if(y.hasPickTriggers)switch(y.processTrigger(5,v.CreateNew(H.pickedMesh,c,H)),c.button){case 0:y.processTrigger(2,v.CreateNew(H.pickedMesh,c,H));break;case 1:y.processTrigger(4,v.CreateNew(H.pickedMesh,c,H));break;case 2:y.processTrigger(3,v.CreateNew(H.pickedMesh,c,H))}y.hasSpecificTrigger(8)&&window.setTimeout((()=>{const H=Z.Nc(this._unTranslatedPointerX,this._unTranslatedPointerY,(H=>H.Qb&&H.isVisible&&H.isReady()&&H.actionManager&&H.actionManager.hasSpecificTrigger(8)&&H===this._pickedDownMesh),!1,Z.cameraToUseForPointers);null!==H&&void 0!==H&&H.pickedMesh&&y&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>x.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,y.processTrigger(8,v.CreateNew(H.pickedMesh,c)))}),x.LongPressDelay)}}else for(const S of Z._pointerDownStage)H=S.action(this._unTranslatedPointerX,this._unTranslatedPointerY,H,c,!1);let F;const P=f.e.POINTERDOWN;H?(Z.onPointerDown&&Z.onPointerDown(c,H,P),F=new f.i(P,c,H),this._setRayOnPointerInfo(H,c)):F=new f.i(P,c,null,this),Z.onPointerObservable.hasObservers()&&Z.onPointerObservable.notifyObservers(F,P)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(H,c,y){const Z=new PointerEvent("pointerup",c);Z.inputIndex=d.Move;const F=new M;y?F.doubleClick=!0:F.singleClick=!0,this._checkPrePointerObservable(H,Z,f.e.POINTERUP)||this._processPointerUp(H,Z,F)}_processPointerUp(H,c,y){var Z;const F=this._scene;if(null!==(Z=H)&&void 0!==Z&&Z.pickedMesh){if(this._pickedUpMesh=H.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(F.onPointerPick&&F.onPointerPick(c,H),y.singleClick&&!y.ignore&&F.onPointerObservable.observers.length>this._cameraObserverCount)){const y=f.e.POINTERPICK,Z=new f.i(y,c,H);this._setRayOnPointerInfo(H,c),F.onPointerObservable.notifyObservers(Z,y)}const Z=H.pickedMesh._getActionManagerForTrigger();if(Z&&!y.ignore){Z.processTrigger(7,v.CreateNew(H.pickedMesh,c,H)),!y.hasSwiped&&y.singleClick&&Z.processTrigger(1,v.CreateNew(H.pickedMesh,c,H));const F=H.pickedMesh._getActionManagerForTrigger(6);y.doubleClick&&F&&F.processTrigger(6,v.CreateNew(H.pickedMesh,c,H))}}else if(!y.ignore)for(const P of F._pointerUpStage)H=P.action(this._unTranslatedPointerX,this._unTranslatedPointerY,H,c,y.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const H=this._pickedDownMesh._getActionManagerForTrigger(16);H&&H.processTrigger(16,v.CreateNew(this._pickedDownMesh,c))}if(!y.ignore){const Z=new f.i(f.e.POINTERUP,c,H);if(this._setRayOnPointerInfo(H,c),F.onPointerObservable.notifyObservers(Z,f.e.POINTERUP),F.onPointerUp&&F.onPointerUp(c,H,f.e.POINTERUP),!y.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let Z=0;if(y.singleClick?Z=f.e.POINTERTAP:y.doubleClick&&(Z=f.e.POINTERDOUBLETAP),Z){const y=new f.i(Z,c,H);F.onPointerObservable.hasObservers()&&F.onPointerObservable.hasSpecificMask(Z)&&F.onPointerObservable.notifyObservers(y,Z)}}}}isPointerCaptured(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[H]}attachControl(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const F=this._scene,P=F.getEngine();Z||(Z=P.getInputElement()),this._alreadyAttached&&this.Si(),Z&&(this._alreadyAttachedTo=Z),this._deviceSourceManager=new k(P),this._initActionManager=H=>{if(!this._meshPickProceed){const c=F.skipPointerUpPicking||0===F._registeredActions&&!this._checkForPicking()&&!F.onPointerUp?null:F.Nc(this._unTranslatedPointerX,this._unTranslatedPointerY,F.pointerUpPredicate,F.pointerUpFastCheck,F.cameraToUseForPointers,F.pointerUpTrianglePredicate);this._currentPickResult=c,c&&(H=c.hit&&c.pickedMesh?c.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return H},this._delayedSimpleClick=(H,c,y)=>{if((Date.now()-this._previousStartingPointerTime>x.DoubleClickDelay&&!this._doubleClickOccured||H!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,this._delayedClicks[H])){const c=this._delayedClicks[H].evt,y=f.e.POINTERTAP,Z=new f.i(y,c,this._currentPickResult);F.onPointerObservable.hasObservers()&&F.onPointerObservable.hasSpecificMask(y)&&F.onPointerObservable.notifyObservers(Z,y),this._delayedClicks[H]=null}},this._initClickEvent=(H,c,y,Z)=>{const F=new M;this._currentPickResult=null;let P=null,S=H.hasSpecificMask(f.e.POINTERPICK)||c.hasSpecificMask(f.e.POINTERPICK)||H.hasSpecificMask(f.e.POINTERTAP)||c.hasSpecificMask(f.e.POINTERTAP)||H.hasSpecificMask(f.e.POINTERDOUBLETAP)||c.hasSpecificMask(f.e.POINTERDOUBLETAP);!S&&J&&(P=this._initActionManager(P,F),P&&(S=P.hasPickTriggers));let n=!1;if(S){const S=y.button;if(F.hasSwiped=this._isPointerSwiping(),!F.hasSwiped){let i=!x.ExclusiveDoubleClickMode;if(i||(i=!H.hasSpecificMask(f.e.POINTERDOUBLETAP)&&!c.hasSpecificMask(f.e.POINTERDOUBLETAP),i&&!J.HasSpecificTrigger(6)&&(P=this._initActionManager(P,F),P&&(i=!P.hasSpecificTrigger(6)))),i)(Date.now()-this._previousStartingPointerTime>x.DoubleClickDelay||S!==this._previousButtonPressed)&&(F.singleClick=!0,Z(F,this._currentPickResult),n=!0);else{const H={evt:y,clickInfo:F,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,S,F,Z),x.DoubleClickDelay)};this._delayedClicks[S]=H}let C=H.hasSpecificMask(f.e.POINTERDOUBLETAP)||c.hasSpecificMask(f.e.POINTERDOUBLETAP);if(!C&&J.HasSpecificTrigger(6)&&(P=this._initActionManager(P,F),P&&(C=P.hasSpecificTrigger(6))),C)if(S===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<x.DoubleClickDelay&&!this._doubleClickOccured){if(F.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=S,x.ExclusiveDoubleClickMode){var O;if(this._delayedClicks[S])clearTimeout(null===(O=this._delayedClicks[S])||void 0===O?void 0:O.timeoutId),this._delayedClicks[S]=null;Z(F,this._previousPickResult)}else Z(F,this._currentPickResult);else{var a;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,F.doubleClick=!0,F.ignore=!1,x.ExclusiveDoubleClickMode&&this._delayedClicks[S])clearTimeout(null===(a=this._delayedClicks[S])||void 0===a?void 0:a.timeoutId),this._delayedClicks[S]=null;Z(F,this._currentPickResult)}n=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=S}}n||Z(F,this._currentPickResult)},this._onPointerMove=H=>{if(this._updatePointerPosition(H),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>x.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>x.DragMovementThreshold),P.isPointerLock&&P._verifyPointerLock(),this._checkPrePointerObservable(null,H,H.inputIndex>=d.MouseWheelX&&H.inputIndex<=d.MouseWheelZ?f.e.POINTERWHEEL:f.e.POINTERMOVE))return;if(!F.cameraToUseForPointers&&!F.activeCamera)return;if(F._i)return void this._processPointerMove(new g.d,H);F.pointerMovePredicate||(F.pointerMovePredicate=H=>H.Qb&&H.isVisible&&H.isReady()&&H.isEnabled()&&(H.enablePointerMoveEvents||F.constantlyUpdateMeshUnderPointer||null!==H._getActionManagerForTrigger())&&(!F.cameraToUseForPointers||0!==(F.cameraToUseForPointers.layerMask&H.layerMask)));const c=F._registeredActions>0||F.constantlyUpdateMeshUnderPointer?this._pickMove(H):null;this._processPointerMove(c,H)},this._onPointerDown=H=>{const c=this._activePointerIds.indexOf(-1);if(-1===c?this._activePointerIds.push(H.pointerId):this._activePointerIds[c]=H.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,x.ExclusiveDoubleClickMode)for(let Z=0;Z<this._delayedClicks.length;Z++)if(this._delayedClicks[Z])if(H.button===Z){var y;clearTimeout(null===(y=this._delayedClicks[Z])||void 0===y?void 0:y.timeoutId)}else{const H=this._delayedClicks[Z].clickInfo;this._doubleClickOccured=!1,H.singleClick=!0,H.ignore=!1;const c=this._delayedClicks[Z].evt,y=f.e.POINTERTAP,P=new f.i(y,c,this._currentPickResult);F.onPointerObservable.hasObservers()&&F.onPointerObservable.hasSpecificMask(y)&&F.onPointerObservable.notifyObservers(P,y),this._delayedClicks[Z]=null}if(this._updatePointerPosition(H),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=H.button),F.preventDefaultOnPointerDown&&Z&&(H.preventDefault(),Z.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,H,f.e.POINTERDOWN))return;if(!F.cameraToUseForPointers&&!F.activeCamera)return;let P;this._pointerCaptures[H.pointerId]=!0,F.pointerDownPredicate||(F.pointerDownPredicate=H=>H.Qb&&H.isVisible&&H.isReady()&&H.isEnabled()&&(!F.cameraToUseForPointers||0!==(F.cameraToUseForPointers.layerMask&H.layerMask))),this._pickedDownMesh=null,P=F.skipPointerDownPicking||0===F._registeredActions&&!this._checkForPicking()&&!F.onPointerDown?new g.d:F.Nc(this._unTranslatedPointerX,this._unTranslatedPointerY,F.pointerDownPredicate,F.pointerDownFastCheck,F.cameraToUseForPointers,F.pointerDownTrianglePredicate),this._processPointerDown(P,H)},this._onPointerUp=H=>{const c=this._activePointerIds.indexOf(H.pointerId);-1!==c&&(this._activePointerIds[c]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(H),F.preventDefaultOnPointerUp&&Z&&(H.preventDefault(),Z.focus()),this._initClickEvent(F.onPrePointerObservable,F.onPointerObservable,H,((c,y)=>{if(F.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!c.ignore)){if(this._checkPrePointerObservable(null,H,f.e.POINTERUP))return this._swipeButtonPressed===H.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===H.buttons&&(this._pointerCaptures[H.pointerId]=!1));c.hasSwiped||(c.singleClick&&F.onPrePointerObservable.hasSpecificMask(f.e.POINTERTAP)&&this._checkPrePointerObservable(null,H,f.e.POINTERTAP)&&(this._skipPointerTap=!0),c.doubleClick&&F.onPrePointerObservable.hasSpecificMask(f.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,H,f.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[H.pointerId]?(0===H.buttons&&(this._pointerCaptures[H.pointerId]=!1),(F.cameraToUseForPointers||F.activeCamera)&&(F.pointerUpPredicate||(F.pointerUpPredicate=H=>H.Qb&&H.isVisible&&H.isReady()&&H.isEnabled()&&(!F.cameraToUseForPointers||0!==(F.cameraToUseForPointers.layerMask&H.layerMask))),!this._meshPickProceed&&(J&&J.HasTriggers||this._checkForPicking()||F.onPointerUp)&&this._initActionManager(null,c),y||(y=this._currentPickResult),this._processPointerUp(y,H,c),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===H.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===H.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=H=>{const c=G.e.KEYDOWN;if(F.onPreKeyboardObservable.hasObservers()){const y=new G.g(c,H);if(F.onPreKeyboardObservable.notifyObservers(y,c),y.skipOnKeyboardObservable)return}if(F.onKeyboardObservable.hasObservers()){const y=new G.k(c,H);F.onKeyboardObservable.notifyObservers(y,c)}F.actionManager&&F.actionManager.processTrigger(14,v.CreateNewFromScene(F,H))},this._onKeyUp=H=>{const c=G.e.KEYUP;if(F.onPreKeyboardObservable.hasObservers()){const y=new G.g(c,H);if(F.onPreKeyboardObservable.notifyObservers(y,c),y.skipOnKeyboardObservable)return}if(F.onKeyboardObservable.hasObservers()){const y=new G.k(c,H);F.onKeyboardObservable.notifyObservers(y,c)}F.actionManager&&F.actionManager.processTrigger(15,v.CreateNewFromScene(F,H))},this._deviceSourceManager.onDeviceConnectedObservable.add((Z=>{Z.deviceType===l.Mouse?Z.onInputChangedObservable.add((F=>{this._originMouseEvent=F,F.inputIndex===d.LeftClick||F.inputIndex===d.MiddleClick||F.inputIndex===d.RightClick||F.inputIndex===d.BrowserBack||F.inputIndex===d.BrowserForward?c&&1===Z.getInput(F.inputIndex)?this._onPointerDown(F):H&&0===Z.getInput(F.inputIndex)&&this._onPointerUp(F):y&&(F.inputIndex===d.Move?this._onPointerMove(F):F.inputIndex!==d.MouseWheelX&&F.inputIndex!==d.MouseWheelY&&F.inputIndex!==d.MouseWheelZ||this._onPointerMove(F))})):Z.deviceType===l.Touch?Z.onInputChangedObservable.add((F=>{F.inputIndex===d.LeftClick&&(c&&1===Z.getInput(F.inputIndex)?(this._onPointerDown(F),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):H&&0===Z.getInput(F.inputIndex)&&(this._onPointerUp(F),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),y&&F.inputIndex===d.Move&&this._onPointerMove(F)})):Z.deviceType===l.Keyboard&&Z.onInputChangedObservable.add((H=>{"keydown"===H.type?this._onKeyDown(H):"keyup"===H.type&&this._onKeyUp(H)}))})),this._alreadyAttached=!0}Si(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[c]===H&&(!H||!H._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const F=this._meshUnderPointerId[c];let P;F&&(P=F._getActionManagerForTrigger(10),P&&P.processTrigger(10,v.CreateNew(F,Z,{pointerId:c}))),H?(this._meshUnderPointerId[c]=H,this._pointerOverMesh=H,P=H._getActionManagerForTrigger(9),P&&P.processTrigger(9,v.CreateNew(H,Z,{pointerId:c,pickResult:y}))):(delete this._meshUnderPointerId[c],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(H){this._pointerOverMesh===H&&(this._pointerOverMesh=null),this._pickedDownMesh===H&&(this._pickedDownMesh=null),this._pickedUpMesh===H&&(this._pickedUpMesh=null);for(const c in this._meshUnderPointerId)this._meshUnderPointerId[c]===H&&delete this._meshUnderPointerId[c]}}x.DragMovementThreshold=10,x.LongPressDelay=500,x.DoubleClickDelay=300,x.ExclusiveDoubleClickMode=!1;var R=y(10916),A=y(11112),e=y(11206),r=y(11220),N=y(10819),w=y(11229),L=y(11103);class b{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this._i=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var X,B=y(10773),Y=y(10893);!function(H){H[H.BackwardCompatible=0]="BackwardCompatible",H[H.Intermediate=1]="Intermediate",H[H.Aggressive=2]="Aggressive"}(X||(X={}));class HH{static DefaultMaterialFactory(H){throw(0,D.b)("nb")}static CollisionCoordinatorFactory(){throw(0,D.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(H){H!==this._clearColor&&(this._clearColor=H,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(H){if(H!==this._performancePriority){switch(this._performancePriority=H,H){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this._i=!1,this.Ti=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this._i=!0,this.Ti=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this._i=!0,this.Ti=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(H)}}set forceWireframe(H){this._forceWireframe!==H&&(this._forceWireframe=H,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(H){this._skipFrustumClipping!==H&&(this._skipFrustumClipping=H)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(H){this._forcePointsCloud!==H&&(this._forcePointsCloud=H,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(H){this._environmentTexture!==H&&(this._environmentTexture=H,this.markAllMaterialsAsDirty(1))}getNodes(){let H=[];return H=H.concat(this.meshes),H=H.concat(this.lights),H=H.concat(this.cameras),H=H.concat(this.transformNodes),this.skeletons.forEach((c=>H=H.concat(c.bones))),H}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}set beforeRender(H){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),H&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(H))}set afterRender(H){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),H&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(H))}set beforeCameraRender(H){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(H)}set afterCameraRender(H){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(H)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(H){this._pointerPickingConfiguration.pointerDownPredicate=H}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(H){this._pointerPickingConfiguration.pointerUpPredicate=H}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(H){this._pointerPickingConfiguration.pointerMovePredicate=H}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(H){this._pointerPickingConfiguration.pointerDownFastCheck=H}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(H){this._pointerPickingConfiguration.pointerUpFastCheck=H}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(H){this._pointerPickingConfiguration.pointerMoveFastCheck=H}get _i(){return this._pointerPickingConfiguration._i}set _i(H){this._pointerPickingConfiguration._i=H}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(H){this._pointerPickingConfiguration.skipPointerDownPicking=H}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(H){this._pointerPickingConfiguration.skipPointerUpPicking=H}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return x.DragMovementThreshold}static set DragMovementThreshold(H){x.DragMovementThreshold=H}static get LongPressDelay(){return x.LongPressDelay}static set LongPressDelay(H){x.LongPressDelay=H}static get DoubleClickDelay(){return x.DoubleClickDelay}static set DoubleClickDelay(H){x.DoubleClickDelay=H}static get ExclusiveDoubleClickMode(){return x.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(H){x.ExclusiveDoubleClickMode=H}bindEyePosition(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,F=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return a.h.Vector4[0].set(Z.x,Z.y,Z.z,F?-1:1),H&&(y?H.setFloat3(c,a.h.Vector4[0].x,a.h.Vector4[0].y,a.h.Vector4[0].z):H.setVector4(c,a.h.Vector4[0])),a.h.Vector4[0]}finalizeSceneUbo(){const H=this.getSceneUniformBuffer(),c=this.bindEyePosition(null);return H.updateFloat4("vEyePosition",c.x,c.y,c.z,c.w),H.update(),H}set useRightHandedSystem(H){this._useRightHandedSystem!==H&&(this._useRightHandedSystem=H,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(H){this._currentStepId=H}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(H){this._fogEnabled!==H&&(this._fogEnabled=H,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(H){this._fogMode!==H&&(this._fogMode=H,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(H){this._shadowsEnabled!==H&&(this._shadowsEnabled=H,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(H){this._lightsEnabled!==H&&(this._lightsEnabled=H,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(H){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),H&&(this._unObserveActiveCameras=(0,L.j)(H,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=H}get activeCamera(){return this._activeCamera}set activeCamera(H){H!==this._activeCamera&&(this._activeCamera=H,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.ui||(this.ui=HH.DefaultMaterialFactory(this)),this.ui}set defaultMaterial(H){this.ui=H}set texturesEnabled(H){this._texturesEnabled!==H&&(this._texturesEnabled=H,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(H){if(this._frameGraph)return this._frameGraph=H,void(H||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=H,H&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(H){this._skeletonsEnabled!==H&&(this._skeletonsEnabled=H,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=HH.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const H of this._transientComponents)H.register();this._transientComponents.length=0}}fb(H){this._components.push(H),this._transientComponents.push(H);const c=H;c.addFromContainer&&c.serialize&&this._serializableComponents.push(c)}_getComponent(H){for(const c of this._components)if(c.name===H)return c;return null}constructor(H,c){this._inputManager=new x(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ti=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new A.h(.2,.2,.3,1),this.onClearColorChangedObservable=new P.e,this.ambientColor=new A.e(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new P.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this._j=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.jj=new P.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new P.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new P.e,this.onAfterRenderCameraObservable=new P.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new P.e,this.onAfterAnimationsObservable=new P.e,this.onBeforeDrawPhaseObservable=new P.e,this.onAfterDrawPhaseObservable=new P.e,this.onReadyObservable=new P.e,this.onBeforeCameraRenderObservable=new P.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new P.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new P.e,this.onAfterActiveMeshesEvaluationObservable=new P.e,this.onBeforeParticlesRenderingObservable=new P.e,this.onAfterParticlesRenderingObservable=new P.e,this.onDataLoadedObservable=new P.e,this.onNewCameraAddedObservable=new P.e,this.onCameraRemovedObservable=new P.e,this.onNewLightAddedObservable=new P.e,this.onLightRemovedObservable=new P.e,this.onNewGeometryAddedObservable=new P.e,this.onGeometryRemovedObservable=new P.e,this.onNewTransformNodeAddedObservable=new P.e,this.onTransformNodeRemovedObservable=new P.e,this.onNewMeshAddedObservable=new P.e,this.onMeshRemovedObservable=new P.e,this.onNewSkeletonAddedObservable=new P.e,this.onSkeletonRemovedObservable=new P.e,this.onNewMaterialAddedObservable=new P.e,this.onNewMultiMaterialAddedObservable=new P.e,this.onMaterialRemovedObservable=new P.e,this.onMultiMaterialRemovedObservable=new P.e,this.onNewTextureAddedObservable=new P.e,this.onTextureRemovedObservable=new P.e,this.onBeforeRenderTargetsRenderObservable=new P.e,this.onAfterRenderTargetsRenderObservable=new P.e,this.onBeforeStepObservable=new P.e,this.onAfterStepObservable=new P.e,this.onActiveCameraChanged=new P.e,this.onActiveCamerasChanged=new P.e,this.onBeforeRenderingGroupObservable=new P.e,this.onAfterRenderingGroupObservable=new P.e,this.onMeshImportedObservable=new P.e,this.onAnimationFileImportedObservable=new P.e,this._registeredForLateAnimationBindings=new S.b(256),this._pointerPickingConfiguration=new b,this.onPrePointerObservable=new P.e,this.onPointerObservable=new P.e,this.onPreKeyboardObservable=new P.e,this.onKeyboardObservable=new P.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=HH.FOGMODE_NONE,this.fogColor=new A.e(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new a.n(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new S.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new R.b,this._activeIndices=new R.b,this._activeParticles=new R.b,this._activeBones=new R.b,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new S.c(256),this._processedMaterials=new S.c(256),this._renderTargets=new S.b(256),this._materialsRenderTargets=new S.b(256),this._activeParticleSystems=new S.c(256),this._activeSkeletons=new S.b(32),this._softwareSkinnedMeshes=new S.b(32),this._activeAnimatables=new Array,this._transformMatrix=a.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=V.f.Create(),this._beforeClearStage=V.f.Create(),this._beforeRenderTargetClearStage=V.f.Create(),this._gatherRenderTargetsStage=V.f.Create(),this._gatherActiveCameraRenderTargetsStage=V.f.Create(),this._isReadyForMeshStage=V.f.Create(),this._beforeEvaluateActiveMeshStage=V.f.Create(),this._evaluateSubMeshStage=V.f.Create(),this._preActiveMeshStage=V.f.Create(),this._cameraDrawRenderTargetStage=V.f.Create(),this._beforeCameraDrawStage=V.f.Create(),this._beforeRenderTargetDrawStage=V.f.Create(),this._beforeRenderingGroupDrawStage=V.f.Create(),this._beforeRenderingMeshStage=V.f.Create(),this._afterRenderingMeshStage=V.f.Create(),this._afterRenderingGroupDrawStage=V.f.Create(),this._afterCameraDrawStage=V.f.Create(),this._afterCameraPostProcessStage=V.f.Create(),this._afterRenderTargetDrawStage=V.f.Create(),this._afterRenderTargetPostProcessStage=V.f.Create(),this._afterRenderStage=V.f.Create(),this._pointerMoveStage=V.f.Create(),this._pointerDownStage=V.f.Create(),this._pointerUpStage=V.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const y={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...c};H=this._engine=H||Q.b.LastCreatedEngine,y.virtual?H._virtualScenes.push(this):(Q.b._LastCreatedScene=this,H.scenes.push(this)),this._uid=null,this._renderingManager=new z.d(this),m.c&&(this.postProcessManager=new m.c(this)),(0,h.h)()&&this.attachControl(),this._createUbo(),i.d&&(this._imageProcessingConfiguration=new i.d),this.setDefaultCandidateProviders(),y.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=y.useMaterialMeshMap,this.useClonedMeshMap=y.useClonedMeshMap,c&&c.virtual||H.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(H){return this._defaultSubMeshCandidates.data=H.$f,this._defaultSubMeshCandidates.length=H.$f.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=H=>this._getDefaultSubMeshCandidates(H),this.getIntersectingSubMeshCandidates=(H,c)=>this._getDefaultSubMeshCandidates(H),this.getCollidingSubMeshCandidates=(H,c)=>this._getDefaultSubMeshCandidates(H)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(H){this._inputManager.pointerX=H}get pointerY(){return this._inputManager.pointerY}set pointerY(H){this._inputManager.pointerY=H}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==c||this._cachedMaterial!==H||this._cachedVisibility!==y}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(H,c){return this._inputManager.simulatePointerMove(H,c),this}simulatePointerDown(H,c){return this._inputManager.simulatePointerDown(H,c),this}simulatePointerUp(H,c,y){return this._inputManager.simulatePointerUp(H,c,y),this}isPointerCaptured(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(H)}attachControl(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(H,c,y)}Si(){this._inputManager.Si()}isReady(){var H,c;let y,Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const F=this.getEngine(),P=F.currentRenderPassId;F.currentRenderPassId=(null===(H=this.activeCamera)||void 0===H?void 0:H.renderPassId)??P;let S=!0;for(this._pendingData.length>0&&(S=!1),null===(c=this.prePassRenderer)||void 0===c||c.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&S&&(S=this.depthPeelingRenderer.isReady()),Z&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),y=0;y<this.meshes.length;y++){const H=this.meshes[y];if(!H.$f||0===H.$f.length)continue;if(!H.isReady(!0)){S=!1;continue}const c=H.hasThinInstances||"InstancedMesh"===H.getClassName()||"InstancedLinesMesh"===H.getClassName()||F.getCaps().instancedArrays&&H.instances.length>0;for(const y of this._isReadyForMeshStage)y.action(H,c)||(S=!1);if(!Z)continue;const P=H.material||this.defaultMaterial;if(P)if(P._storeEffectOnSubMeshes)for(const y of H.$f){const H=y.Ha();H&&H.hasRenderTargetTextures&&null!=H.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(H)&&(this._processedMaterials.push(H),this._materialsRenderTargets.concatWithNoDuplicate(H.getRenderTargetTextures()))}else P.hasRenderTargetTextures&&null!=P.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(P)&&(this._processedMaterials.push(P),this._materialsRenderTargets.concatWithNoDuplicate(P.getRenderTargetTextures()))}if(Z)for(y=0;y<this._materialsRenderTargets.length;++y){this._materialsRenderTargets.data[y].isReadyForRendering()||(S=!1)}for(y=0;y<this.geometries.length;y++){2===this.geometries[y].delayLoadState&&(S=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const n of this.activeCameras)n.isReady(!0)||(S=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(S=!1));for(const n of this.qj)n.isReady()||(S=!1);if(this.layers)for(const n of this.layers)n.isReady()||(S=!1);return F.areAllEffectsReady()||(S=!1),F.currentRenderPassId=P,S}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(H){this.onBeforeRenderObservable.add(H)}unregisterBeforeRender(H){this.onBeforeRenderObservable.removeCallback(H)}registerAfterRender(H){this.onAfterRenderObservable.add(H)}unregisterAfterRender(H){this.onAfterRenderObservable.removeCallback(H)}_executeOnceBeforeRender(H){const c=()=>{H(),setTimeout((()=>{this.unregisterBeforeRender(c)}))};this.registerBeforeRender(c)}executeOnceBeforeRender(H,c){void 0!==c?setTimeout((()=>{this._executeOnceBeforeRender(H)}),c):this._executeOnceBeforeRender(H)}addPendingData(H){this._pendingData.push(H)}removePendingData(H){const c=this.isLoading,y=this._pendingData.indexOf(H);-1!==y&&this._pendingData.splice(y,1),c&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(H),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(c)}whenReadyAsync(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((c=>{this.executeWhenReady((()=>{c()}),H)}))}_checkIsReady(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(H)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(H)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=F.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(H,c,y,Z){y||Z||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===H.updateFlag&&this._projectionUpdateFlag===c.updateFlag||(this._viewUpdateFlag=H.updateFlag,this._projectionUpdateFlag=c.updateFlag,this._viewMatrix=H,this._projectionMatrix=c,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?e.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(y,Z):this._sceneUbo.useUbo&&(this._sceneUbo.Hj("viewProjection",this._transformMatrix),this._sceneUbo.Hj("view",this._viewMatrix),this._sceneUbo.Hj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(H){const c=new C.e(this._engine,void 0,!1,H??"Gd");return c.addUniform("viewProjection",16),c.addUniform("view",16),c.addUniform("projection",16),c.addUniform("vEyePosition",4),c}setSceneUniformBuffer(H){this._sceneUbo=H,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return r.c.UniqueId}li(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(H),H._resyncLightSources(),H.parent||H._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(H),c&&H.getChildMeshes().forEach((H=>{this.li(H)})))}sd(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this.meshes.indexOf(H);return-1!==y&&(this.meshes.splice(y,1),H.parent||H._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(H),this.onMeshRemovedObservable.notifyObservers(H),c&&H.getChildMeshes().forEach((H=>{this.sd(H)})),y}addTransformNode(H){this._blockEntityCollection||H.va()===this&&-1!==H._indexInSceneTransformNodesArray||(H._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(H),H.parent||H._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(H))}removeTransformNode(H){const c=H._indexInSceneTransformNodesArray;if(-1!==c){if(c!==this.transformNodes.length-1){const H=this.transformNodes[this.transformNodes.length-1];this.transformNodes[c]=H,H._indexInSceneTransformNodesArray=c}H._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),H.parent||H._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(H),c}removeSkeleton(H){const c=this.skeletons.indexOf(H);return-1!==c&&(this.skeletons.splice(c,1),this.onSkeletonRemovedObservable.notifyObservers(H),this._executeActiveContainerCleanup(this._activeSkeletons)),c}removeMorphTargetManager(H){const c=this.morphTargetManagers.indexOf(H);return-1!==c&&this.morphTargetManagers.splice(c,1),c}removeLight(H){const c=this.lights.indexOf(H);if(-1!==c){for(const c of this.meshes)c._removeLightSource(H,!1);this.lights.splice(c,1),this.sortLightsByPriority(),H.parent||H._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(H),c}removeCamera(H){const c=this.cameras.indexOf(H);if(-1!==c&&(this.cameras.splice(c,1),H.parent||H._removeFromSceneRootNodes()),this.activeCameras){const c=this.activeCameras.indexOf(H);-1!==c&&this.activeCameras.splice(c,1)}return this.activeCamera===H&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(H),c}removeParticleSystem(H){const c=this.qj.indexOf(H);return-1!==c&&(this.qj.splice(c,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),c}removeAnimation(H){const c=this.animations.indexOf(H);return-1!==c&&this.animations.splice(c,1),c}stopAnimation(H,c,y){}removeAnimationGroup(H){const c=this.animationGroups.indexOf(H);return-1!==c&&this.animationGroups.splice(c,1),c}removeMultiMaterial(H){const c=this.multiMaterials.indexOf(H);return-1!==c&&this.multiMaterials.splice(c,1),this.onMultiMaterialRemovedObservable.notifyObservers(H),c}removeMaterial(H){const c=H._indexInSceneMaterialArray;if(-1!==c&&c<this.materials.length){if(c!==this.materials.length-1){const H=this.materials[this.materials.length-1];this.materials[c]=H,H._indexInSceneMaterialArray=c}H._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(H),c}removeActionManager(H){const c=this.actionManagers.indexOf(H);return-1!==c&&this.actionManagers.splice(c,1),c}removeTexture(H){const c=this.textures.indexOf(H);return-1!==c&&this.textures.splice(c,1),this.onTextureRemovedObservable.notifyObservers(H),c}addLight(H){if(!this._blockEntityCollection){this.lights.push(H),this.sortLightsByPriority(),H.parent||H._addToSceneRootNodes();for(const c of this.meshes)-1===c.lightSources.indexOf(H)&&(c.lightSources.push(H),c._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(H)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(w.b.CompareLightsPriority)}addCamera(H){this._blockEntityCollection||(this.cameras.push(H),this.onNewCameraAddedObservable.notifyObservers(H),H.parent||H._addToSceneRootNodes())}addSkeleton(H){this._blockEntityCollection||(this.skeletons.push(H),this.onNewSkeletonAddedObservable.notifyObservers(H))}addParticleSystem(H){this._blockEntityCollection||this.qj.push(H)}addAnimation(H){this._blockEntityCollection||this.animations.push(H)}addAnimationGroup(H){this._blockEntityCollection||this.animationGroups.push(H)}addMultiMaterial(H){this._blockEntityCollection||(this.multiMaterials.push(H),this.onNewMultiMaterialAddedObservable.notifyObservers(H))}addMaterial(H){this._blockEntityCollection||H.va()===this&&-1!==H._indexInSceneMaterialArray||(H._indexInSceneMaterialArray=this.materials.length,this.materials.push(H),this.onNewMaterialAddedObservable.notifyObservers(H))}addMorphTargetManager(H){this._blockEntityCollection||this.morphTargetManagers.push(H)}addGeometry(H){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[H.uniqueId]=this.geometries.length),this.geometries.push(H))}addActionManager(H){this.actionManagers.push(H)}addTexture(H){this._blockEntityCollection||(this.textures.push(H),this.onNewTextureAddedObservable.notifyObservers(H))}switchActiveCamera(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Si(),this.activeCamera=H,c&&H.attachControl())}setActiveCameraById(H){const c=this.getCameraById(H);return c?(this.activeCamera=c,c):null}setActiveCameraByName(H){const c=this.getCameraByName(H);return c?(this.activeCamera=c,c):null}getAnimationGroupByName(H){for(let c=0;c<this.animationGroups.length;c++)if(this.animationGroups[c].name===H)return this.animationGroups[c];return null}_getMaterial(H,c){for(let y=0;y<this.materials.length;y++){const H=this.materials[y];if(c(H))return H}if(H)for(let y=0;y<this.multiMaterials.length;y++){const H=this.multiMaterials[y];if(c(H))return H}return null}getMaterialByUniqueID(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.uniqueId===H))}getMaterialById(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.id===H))}getMaterialByName(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.name===H))}getLastMaterialById(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let y=this.materials.length-1;y>=0;y--)if(this.materials[y].id===H)return this.materials[y];if(c)for(let y=this.multiMaterials.length-1;y>=0;y--)if(this.multiMaterials[y].id===H)return this.multiMaterials[y];return null}getTextureByUniqueId(H){for(let c=0;c<this.textures.length;c++)if(this.textures[c].uniqueId===H)return this.textures[c];return null}getTextureByName(H){for(let c=0;c<this.textures.length;c++)if(this.textures[c].name===H)return this.textures[c];return null}getCameraById(H){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].id===H)return this.cameras[c];return null}getCameraByUniqueId(H){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].uniqueId===H)return this.cameras[c];return null}getCameraByName(H){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].name===H)return this.cameras[c];return null}getBoneById(H){for(let c=0;c<this.skeletons.length;c++){const y=this.skeletons[c];for(let c=0;c<y.bones.length;c++)if(y.bones[c].id===H)return y.bones[c]}return null}getBoneByName(H){for(let c=0;c<this.skeletons.length;c++){const y=this.skeletons[c];for(let c=0;c<y.bones.length;c++)if(y.bones[c].name===H)return y.bones[c]}return null}getLightByName(H){for(let c=0;c<this.lights.length;c++)if(this.lights[c].name===H)return this.lights[c];return null}getLightById(H){for(let c=0;c<this.lights.length;c++)if(this.lights[c].id===H)return this.lights[c];return null}getLightByUniqueId(H){for(let c=0;c<this.lights.length;c++)if(this.lights[c].uniqueId===H)return this.lights[c];return null}getParticleSystemById(H){for(let c=0;c<this.qj.length;c++)if(this.qj[c].id===H)return this.qj[c];return null}getGeometryById(H){for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].id===H)return this.geometries[c];return null}_getGeometryByUniqueId(H){if(this._geometriesByUniqueId){const c=this._geometriesByUniqueId[H];if(void 0!==c)return this.geometries[c]}else for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].uniqueId===H)return this.geometries[c];return null}pushGeometry(H,c){return!(!c&&this._getGeometryByUniqueId(H.uniqueId))&&(this.addGeometry(H),this.onNewGeometryAddedObservable.notifyObservers(H),!0)}removeGeometry(H){let c;if(this._geometriesByUniqueId){if(c=this._geometriesByUniqueId[H.uniqueId],void 0===c)return!1}else if(c=this.geometries.indexOf(H),c<0)return!1;if(c!==this.geometries.length-1){const H=this.geometries[this.geometries.length-1];H&&(this.geometries[c]=H,this._geometriesByUniqueId&&(this._geometriesByUniqueId[H.uniqueId]=c))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[H.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(H),!0}getGeometries(){return this.geometries}getMeshById(H){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].id===H)return this.meshes[c];return null}getMeshesById(H){return this.meshes.filter((function(c){return c.id===H}))}getTransformNodeById(H){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].id===H)return this.transformNodes[c];return null}getTransformNodeByUniqueId(H){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].uniqueId===H)return this.transformNodes[c];return null}getTransformNodesById(H){return this.transformNodes.filter((function(c){return c.id===H}))}getMeshByUniqueId(H){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].uniqueId===H)return this.meshes[c];return null}getLastMeshById(H){for(let c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===H)return this.meshes[c];return null}getLastTransformNodeById(H){for(let c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===H)return this.transformNodes[c];return null}getLastEntryById(H){let c;for(c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===H)return this.meshes[c];for(c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===H)return this.transformNodes[c];for(c=this.cameras.length-1;c>=0;c--)if(this.cameras[c].id===H)return this.cameras[c];for(c=this.lights.length-1;c>=0;c--)if(this.lights[c].id===H)return this.lights[c];return null}getNodeById(H){const c=this.getMeshById(H);if(c)return c;const y=this.getTransformNodeById(H);if(y)return y;const Z=this.getLightById(H);if(Z)return Z;const F=this.getCameraById(H);if(F)return F;const P=this.getBoneById(H);return P||null}getNodeByName(H){const c=this.getMeshByName(H);if(c)return c;const y=this.getTransformNodeByName(H);if(y)return y;const Z=this.getLightByName(H);if(Z)return Z;const F=this.getCameraByName(H);if(F)return F;const P=this.getBoneByName(H);return P||null}getMeshByName(H){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].name===H)return this.meshes[c];return null}getTransformNodeByName(H){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].name===H)return this.transformNodes[c];return null}getLastSkeletonById(H){for(let c=this.skeletons.length-1;c>=0;c--)if(this.skeletons[c].id===H)return this.skeletons[c];return null}getSkeletonByUniqueId(H){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].uniqueId===H)return this.skeletons[c];return null}getSkeletonById(H){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].id===H)return this.skeletons[c];return null}getSkeletonByName(H){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].name===H)return this.skeletons[c];return null}getMorphTargetManagerById(H){for(let c=0;c<this.morphTargetManagers.length;c++)if(this.morphTargetManagers[c].uniqueId===H)return this.morphTargetManagers[c];return null}getMorphTargetById(H){for(let c=0;c<this.morphTargetManagers.length;++c){const y=this.morphTargetManagers[c];for(let c=0;c<y.numTargets;++c){const Z=y.getTarget(c);if(Z.id===H)return Z}}return null}getMorphTargetByName(H){for(let c=0;c<this.morphTargetManagers.length;++c){const y=this.morphTargetManagers[c];for(let c=0;c<y.numTargets;++c){const Z=y.getTarget(c);if(Z.name===H)return Z}}return null}getPostProcessByName(H){for(let c=0;c<this.postProcesses.length;++c){const y=this.postProcesses[c];if(y.name===H)return y}return null}isActiveMesh(H){return-1!==this._activeMeshes.indexOf(H)}get uid(){return this._uid||(this._uid=Z.c.RandomId()),this._uid}addExternalData(H,c){return this._externalData||(this._externalData=new n),this._externalData.add(H,c)}getExternalData(H){return this._externalData?this._externalData.get(H):null}getOrAddExternalDataWithFactory(H,c){return this._externalData||(this._externalData=new n),this._externalData.getOrAddWithFactory(H,c)}removeExternalData(H){return this._externalData.remove(H)}_evaluateSubMesh(H,c,y,Z){if(Z||H.isInFrustum(this._frustumPlanes)){for(const Z of this._evaluateSubMeshStage)Z.action(c,H);const y=H.Ha();null!==y&&void 0!==y&&(y.hasRenderTargetTextures&&null!=y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(y)&&(this._processedMaterials.push(y),this._materialsRenderTargets.concatWithNoDuplicate(y.getRenderTargetTextures())),this._renderingManager.dispatch(H,c,y))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(H){this._preventFreeActiveMeshesAndRenderingGroups!==H&&(H&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=H)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let H=0;H<this.activeCameras.length;H++){const c=this.activeCameras[H];c&&c._activeMeshes&&c._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let H=0;H<this.textures.length;H++){const c=this.textures[H];c&&c.renderList&&c.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=F,this._skipEvaluateActiveMeshesCompletely=H,Z)for(let H=0;H<this._activeMeshes.length;H++)this._activeMeshes.data[H]._freeze();c&&c()}else y&&y("No active camera found")})),this}unfreezeActiveMeshes(){for(let H=0;H<this.meshes.length;H++){const c=this.meshes[H];c._internalAbstractMeshDataInfo&&(c._internalAbstractMeshDataInfo._isActive=!1)}for(let H=0;H<this._activeMeshes.length;H++)this._activeMeshes.data[H]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(H){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>H.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var H;if(this._activeMeshes.length>0)null===(H=this.activeCamera)||void 0===H||H._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const H=this._activeMeshes.length;for(let c=0;c<H;c++){this._activeMeshes.data[c].Oj()}}if(this._activeParticleSystems){const H=this._activeParticleSystems.length;for(let c=0;c<H;c++)this._activeParticleSystems.data[c].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const Z of this._beforeEvaluateActiveMeshStage)Z.action();const c=this.getActiveMeshCandidates(),y=c.length;for(let Z=0;Z<y;Z++){const H=c.data[Z];if(H._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,H.isBlocked)continue;if(this._totalVertices.addCount(H.getTotalVertices(),!1),!H.isReady()||!H.isEnabled()||H.de.hasAZeroComponent)continue;H.Oj(),H.actionManager&&H.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(H);let y=this.customLODSelector?this.customLODSelector(H,this.activeCamera):H.getLOD(this.activeCamera);if(H._internalAbstractMeshDataInfo._currentLOD=y,H._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==y&&null!==y&&(y!==H&&0!==y.billboardMode&&y.Oj(),H._preActivate(),H.isVisible&&H.visibility>0&&0!==(H.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||H.tb||H.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(H),this.activeCamera._activeMeshes.push(H),y!==H&&y._activate(this._renderId,!1);for(const c of this._preActiveMeshStage)c.action(H);H._activate(this._renderId,!1)&&(H.isAnInstance?H._internalAbstractMeshDataInfo._actAsRegularMesh&&(y=H):y._internalAbstractMeshDataInfo._onlyForInstances=!1,y._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(H,y)),H._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let H=0;H<this.qj.length;H++){const c=this.qj[H];if(!c.isStarted()||!c.j)continue;const y=c.j;y.position&&!y.isEnabled()||(this._activeParticleSystems.push(c),c.animate(),this._renderingManager.dispatchParticles(c))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(H){this._skeletonsEnabled&&H.skeleton&&(this._activeSkeletons.pushNoDuplicate(H.skeleton)&&(H.skeleton.prepare(),this._activeBones.addCount(H.skeleton.bones.length,!1)),H.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(H)&&this.frameGraph&&H.applySkeleton(H.skeleton))}_activeMesh(H,c){this._prepareSkeleton(c);let y=H.hasInstances||H.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||c.tb;if(c&&c.$f&&c.$f.length>0){const Z=this.getActiveSubMeshCandidates(c),F=Z.length;y=y||1===F;for(let P=0;P<F;P++){const F=Z.data[P];this._evaluateSubMesh(F,c,H,y)}}}updateTransformMatrix(H){const c=this.activeCamera;if(c)if(c._renderingMultiview){const y=c._rigCameras[0],Z=c._rigCameras[1];this.setTransformMatrix(y.getViewMatrix(),y.getProjectionMatrix(H),Z.getViewMatrix(),Z.getProjectionMatrix(H))}else this.setTransformMatrix(c.getViewMatrix(),c.getProjectionMatrix(H))}_bindFrameBuffer(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];H&&H._multiviewTexture?H._multiviewTexture._bindFrameBuffer():H&&H.outputRenderTarget?H.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),c&&this._clearFrameBuffer(H)}_clearFrameBuffer(H){if(H&&H._multiviewTexture);else if(H&&H.outputRenderTarget&&!H._renderingMultiview){const c=H.outputRenderTarget;c.onClearObservable.hasObservers()?c.onClearObservable.notifyObservers(this._engine):c.skipInitialClear||H.isRightCamera||(this.Ti&&this._engine.clear(c.clearColor||this._clearColor,!c._cleared,!0,!0),c._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(H,c){var y;let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(H&&H._skipRendering)return;const P=this._engine;if(this._activeCamera=H,!this.activeCamera)throw new Error("Active camera not set");if(P.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&F){let c=!0;H._renderingMultiview&&H.outputRenderTarget&&(c=H.outputRenderTarget.skipInitialClear,this.Ti&&(this._defaultFrameBufferCleared=!1,H.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),H._renderingMultiview&&H.outputRenderTarget&&(H.outputRenderTarget.skipInitialClear=c)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let Z=0;Z<this._softwareSkinnedMeshes.length;Z++){const H=this._softwareSkinnedMeshes.data[Z];H.applySkeleton(H.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),H.customRenderTargets&&H.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(H.customRenderTargets),c&&c.customRenderTargets&&c.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(c.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const Z of this._gatherActiveCameraRenderTargetsStage)Z.action(this._renderTargets);let S=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){Z.c.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let H=0;H<this._renderTargets.length;H++){const c=this._renderTargets.data[H];if(c._shouldRender()){this._renderId++;const H=c.activeCamera&&c.activeCamera!==this.activeCamera;c.render(H,this.dumpNextRenderTargets),S=!0}}Z.c.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const H of this._cameraDrawRenderTargetStage)S=H.action(this.activeCamera)||S;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(y=H.outputRenderTarget)||void 0===y?void 0:y.renderPassId)??H.renderPassId??0,S&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||H._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const Z of this._beforeCameraDrawStage)Z.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),P.snapshotRendering&&1===P.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const Z of this._afterCameraDrawStage)Z.action(this.activeCamera);if(this.postProcessManager&&!H._multiviewTexture){const c=H.outputRenderTarget?H.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(H.isIntermediate,c)}for(const Z of this._afterCameraPostProcessStage)Z.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===H.cameraRigMode||H._renderingMultiview)return H._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(H,void 0,c),void this.onAfterRenderCameraObservable.notifyObservers(H);if(H._useMultiviewToSingleView)this._renderMultiviewToSingleView(H);else{this.onBeforeCameraRenderObservable.notifyObservers(H);for(let c=0;c<H._rigCameras.length;c++)this._renderForCamera(H._rigCameras[c],H)}this._activeCamera=H,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(H)}_checkIntersections(){for(let H=0;H<this._meshesForIntersections.length;H++){const c=this._meshesForIntersections.data[H];if(c.actionManager)for(let H=0;c.actionManager&&H<c.actionManager.actions.length;H++){const y=c.actionManager.actions[H];if(12===y.trigger||13===y.trigger){const H=y.getTriggerParameter(),Z=H.mesh?H.mesh:H,F=Z.intersectsMesh(c,H.usePreciseIntersection),P=c._intersectionsInProgress.indexOf(Z);F&&-1===P?12===y.trigger?(y._executeCurrent(v.CreateNew(c,void 0,Z)),c._intersectionsInProgress.push(Z)):13===y.trigger&&c._intersectionsInProgress.push(Z):!F&&P>-1&&(13===y.trigger&&y._executeCurrent(v.CreateNew(c,void 0,Z)),c.actionManager.hasSpecificTrigger(13,(H=>{const c=H.mesh?H.mesh:H;return Z===c}))&&13!==y.trigger||c._intersectionsInProgress.splice(P,1))}}}}_advancePhysicsEngineStep(H){}_animate(H){}animate(){if(this._engine.isDeterministicLockStep()){let H=Math.max(HH.MinDeltaTime,Math.min(this._engine.getDeltaTime(),HH.MaxDeltaTime))+this._timeAccumulator;const c=this._engine.getTimeStep(),y=1e3/c/1e3;let Z=0;const F=this._engine.getLockstepMaxSteps();let P=Math.floor(H/c);for(P=Math.min(P,F);H>0&&Z<P;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=c*y,this._animate(c),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(c),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,Z++,H-=c;this._timeAccumulator=H<0?0:H}else{const H=this.useConstantAnimationDeltaTime?16:Math.max(HH.MinDeltaTime,Math.min(this._engine.getDeltaTime(),HH.MaxDeltaTime));this._animationRatio=.06*H,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(H)}}_clear(){(this.autoClearDepthAndStencil||this.Ti)&&this._engine.clear(this._clearColor,this.Ti||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(H){var c;if(null===H||void 0===H||!H.outputRenderTarget||null!==H&&void 0!==H&&H.isRigCamera||(H.outputRenderTarget._cleared=!1),null!==H&&void 0!==H&&null!==(c=H.rigCameras)&&void 0!==c&&c.length)for(let y=0;y<H.rigCameras.length;++y){const c=H.rigCameras[y].outputRenderTarget;c&&(c._cleared=!1)}}resetDrawCache(H){if(this.meshes)for(const c of this.meshes)c.resetDrawCache(H)}_renderWithFrameGraph(){var H;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),c)for(const F of this.cameras)if(F.update(),0!==F.cameraRigMode)for(let H=0;H<F._rigCameras.length;H++)F._rigCameras[H].update();for(const F of this._beforeClearStage)F.action();const y=this.getActiveMeshCandidates(),Z=y.length;for(let F=0;F<Z;F++){const H=y.data[F];H.isBlocked||(this._totalVertices.addCount(H.getTotalVertices(),!1),H.isReady()&&H.isEnabled()&&!H.de.hasAZeroComponent&&(H.Oj(),H.actionManager&&H.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(H)))}if(this.particlesEnabled)for(let F=0;F<this.qj.length;F++){const H=this.qj[F];if(!H.isStarted()||!H.j)continue;const c=H.j;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(H),H.animate())}null===(H=this.frameGraph)||void 0===H||H.execute()}render(){var H;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(H=this.activeCameras)&&void 0!==H&&H.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),y||this.animate();for(const H of this._beforeCameraUpdateStage)H.action();if(c)if(this.activeCameras&&this.activeCameras.length>0)for(let H=0;H<this.activeCameras.length;H++){const c=this.activeCameras[H];if(c.update(),0!==c.cameraRigMode)for(let H=0;H<c._rigCameras.length;H++)c._rigCameras[H].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let H=0;H<this.activeCamera._rigCameras.length;H++)this.activeCamera._rigCameras[H].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(c,y);else{var F;const H=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const c=null!==(F=this.activeCameras)&&void 0!==F&&F.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Z.c.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let y=0;y<this.customRenderTargets.length;y++){const Z=this.customRenderTargets[y];if(Z._shouldRender()){if(this._renderId++,this.activeCamera=Z.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");H.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),Z.render(c!==this.activeCamera,this.dumpNextRenderTargets)}}Z.c.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===c||void 0===c?void 0:c.renderPassId)??0,this.activeCamera=c,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const y of this._beforeClearStage)y.action();this._clearFrameBuffer(this.activeCamera);for(const y of this._gatherRenderTargetsStage)y.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let y=0;y<this.activeCameras.length;y++)this._processSubCameras(this.activeCameras[y],y>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const H of this._afterRenderStage)H.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let H=0;H<this._toBeDisposed.length;H++){const c=this._toBeDisposed[H];c&&c.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let H=0;H<this.materials.length;H++)this.materials[H].freeze()}unfreezeMaterials(){for(let H=0;H<this.materials.length;H++)this.materials[H].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((H=>{H.onAnimationEndObservable.clear(),H.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const H=this._activeRequests.slice();for(const F of H)F.abort();this._activeRequests.length=0;try{this.jj.notifyObservers(this)}catch(Z){B.d.Error("An error occurred while calling onDisposeObservable!",Z)}this.Si();if(this._engine.getInputElement())for(let F=0;F<this.cameras.length;F++)this.cameras[F].Si();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(H=>H.dispose(!0))),this._disposeList(this.transformNodes,(H=>H.dispose(!0)));const c=this.cameras;this._disposeList(c),this.ui&&this.ui.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.qj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let y=this._engine.scenes.indexOf(this);y>-1&&this._engine.scenes.splice(y,1),Q.b._LastCreatedScene===this&&(this._engine.scenes.length>0?Q.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:Q.b._LastCreatedScene=null),y=this._engine._virtualScenes.indexOf(this),y>-1&&this._engine._virtualScenes.splice(y,1),this._engine.wipeCaches(!0),this.jj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(H,c){const y=H.slice(0);c=c??(H=>H.dispose());for(const Z of y)c(Z);H.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let H=0;H<this.meshes.length;H++){const c=this.meshes[H].Dj;c&&c.clearCachedData()}}cleanCachedTextureBuffer(){for(const H of this.textures){H._buffer&&(H._buffer=null)}}getWorldExtends(H){const c=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new a.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return H=H||(()=>!0),this.meshes.filter(H).forEach((H=>{if(H.Oj(!0),!H.$f||0===H.$f.length||H.infiniteDistance)return;const Z=H.getBoundingInfo(),F=Z.boundingBox.minimumWorld,P=Z.boundingBox.maximumWorld;a.n.CheckExtends(F,c,y),a.n.CheckExtends(P,c,y)})),{min:c,max:y}}createPickingRay(H,c,y,Z){throw(0,D.b)("Ray")}createPickingRayToRef(H,c,y,Z,F){throw(0,D.b)("Ray")}createPickingRayInCameraSpace(H,c,y){throw(0,D.b)("Ray")}createPickingRayInCameraSpaceToRef(H,c,y,Z){throw(0,D.b)("Ray")}Nc(H,c,y,Z,F,P){const S=(0,D.b)("Ray",!0);return S&&B.d.Warn(S),new g.d}pickWithBoundingInfo(H,c,y,Z,F){const P=(0,D.b)("Ray",!0);return P&&B.d.Warn(P),new g.d}pickWithRay(H,c,y,Z){throw(0,D.b)("Ray")}multiPick(H,c,y,Z,F){throw(0,D.b)("Ray")}multiPickWithRay(H,c,y){throw(0,D.b)("Ray")}setPointerOverMesh(H,c,y){this._inputManager.setPointerOverMesh(H,c,y)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const H of this.geometries)H._rebuild();for(const H of this.meshes)H._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const H of this._components)H.rebuild();for(const H of this.qj)H.rebuild();if(this.spriteManagers)for(const H of this.spriteManagers)H.rebuild()}_rebuildTextures(){for(const H of this.textures)H._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(H,c,y){if(void 0===c)return H;const Z=[];for(const F in H){const P=H[F];O.d&&O.d.MatchesQuery(P,c)&&(!y||y(P))&&Z.push(P)}return Z}getMeshesByTags(H,c){return this._getByTags(this.meshes,H,c)}getCamerasByTags(H,c){return this._getByTags(this.cameras,H,c)}getLightsByTags(H,c){return this._getByTags(this.lights,H,c)}getMaterialByTags(H,c){return this._getByTags(this.materials,H,c).concat(this._getByTags(this.multiMaterials,H,c))}getTransformNodesByTags(H,c){return this._getByTags(this.transformNodes,H,c)}setRenderingOrder(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(H,c,y,Z)}setRenderingAutoClearDepthStencil(H,c){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(H,c,y,Z)}getAutoClearDepthStencilSetup(H){return this._renderingManager.getAutoClearDepthStencilSetup(H)}_forceBlockMaterialDirtyMechanism(H){this._blockMaterialDirtyMechanism=H}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(H){this._blockMaterialDirtyMechanism!==H&&(this._blockMaterialDirtyMechanism=H,H||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(H,c){if(!this._blockMaterialDirtyMechanism)for(const y of this.materials)c&&!c(y)||y.Fg(H)}_loadFile(H,c,y,Z,F,P,S){const n=(0,N.n)(H,c,y,Z?this.offlineProvider:void 0,F,P,S);return this._activeRequests.push(n),n.onCompleteObservable.add((H=>{this._activeRequests.splice(this._activeRequests.indexOf(H),1)})),n}_loadFileAsync(H,c,y,Z,F){return new Promise(((P,S)=>{this._loadFile(H,(H=>{P(H)}),c,y,Z,((H,c)=>{S(c)}),F)}))}_requestFile(H,c,y,Z,F,P,S){const n=(0,N.v)(H,c,y,Z?this.offlineProvider:void 0,F,P,S);return this._activeRequests.push(n),n.onCompleteObservable.add((H=>{this._activeRequests.splice(this._activeRequests.indexOf(H),1)})),n}_requestFileAsync(H,c,y,Z,F){return new Promise(((P,S)=>{this._requestFile(H,(H=>{P(H)}),c,y,Z,(H=>{S(H)}),F)}))}_readFile(H,c,y,Z,F){const P=(0,N.u)(H,c,y,Z,F);return this._activeRequests.push(P),P.onCompleteObservable.add((H=>{this._activeRequests.splice(this._activeRequests.indexOf(H),1)})),P}_readFileAsync(H,c,y){return new Promise(((Z,F)=>{this._readFile(H,(H=>{Z(H)}),c,y,(H=>{F(H)}))}))}getPerfCollector(){throw(0,D.b)("performanceViewerSceneExtension")}setActiveCameraByID(H){return this.setActiveCameraById(H)}getMaterialByID(H){return this.getMaterialById(H)}getLastMaterialByID(H){return this.getLastMaterialById(H)}getTextureByUniqueID(H){return this.getTextureByUniqueId(H)}getCameraByID(H){return this.getCameraById(H)}getCameraByUniqueID(H){return this.getCameraByUniqueId(H)}getBoneByID(H){return this.getBoneById(H)}getLightByID(H){return this.getLightById(H)}getLightByUniqueID(H){return this.getLightByUniqueId(H)}getParticleSystemByID(H){return this.getParticleSystemById(H)}getGeometryByID(H){return this.getGeometryById(H)}getMeshByID(H){return this.getMeshById(H)}getMeshByUniqueID(H){return this.getMeshByUniqueId(H)}getLastMeshByID(H){return this.getLastMeshById(H)}getMeshesByID(H){return this.getMeshesById(H)}getTransformNodeByID(H){return this.getTransformNodeById(H)}getTransformNodeByUniqueID(H){return this.getTransformNodeByUniqueId(H)}getTransformNodesByID(H){return this.getTransformNodesById(H)}getNodeByID(H){return this.getNodeById(H)}getLastEntryByID(H){return this.getLastEntryById(H)}getLastSkeletonByID(H){return this.getLastSkeletonById(H)}}HH.FOGMODE_NONE=0,HH.FOGMODE_EXP=1,HH.FOGMODE_EXP2=2,HH.FOGMODE_LINEAR=3,HH.MinDeltaTime=1,HH.MaxDeltaTime=1e3,(0,Y.d)("BABYLON.Scene",HH)},11174:(H,c,y)=>{"use strict";y.d(c,{d:()=>Z,f:()=>F});class Z{}Z.NAME_EFFECTLAYER="EffectLayer",Z.NAME_LAYER="Layer",Z.NAME_LENSFLARESYSTEM="LensFlareSystem",Z.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",Z.NAME_PARTICLESYSTEM="rb",Z.NAME_GAMEPAD="Gamepad",Z.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",Z.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",Z.NAME_PREPASSRENDERER="PrePassRenderer",Z.NAME_DEPTHRENDERER="DepthRenderer",Z.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",Z.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",Z.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",Z.NAME_SPRITE="Sprite",Z.NAME_SUBSURFACE="SubSurface",Z.NAME_OUTLINERENDERER="Outline",Z.NAME_PROCEDURALTEXTURE="ProceduralTexture",Z.NAME_SHADOWGENERATOR="ShadowGenerator",Z.NAME_OCTREE="sb",Z.NAME_PHYSICSENGINE="PhysicsEngine",Z.NAME_AUDIO="Audio",Z.NAME_FLUIDRENDERER="FluidRenderer",Z.STEP_ISREADYFORMESH_EFFECTLAYER=0,Z.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,Z.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,Z.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,Z.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,Z.STEP_BEFORECAMERADRAW_PREPASS=0,Z.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,Z.STEP_BEFORECAMERADRAW_LAYER=2,Z.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,Z.STEP_BEFORERENDERTARGETDRAW_LAYER=1,Z.STEP_BEFORERENDERINGMESH_PREPASS=0,Z.STEP_BEFORERENDERINGMESH_OUTLINE=1,Z.STEP_AFTERRENDERINGMESH_PREPASS=0,Z.STEP_AFTERRENDERINGMESH_OUTLINE=1,Z.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,Z.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,Z.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,Z.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,Z.STEP_BEFORECLEAR_PREPASS=1,Z.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,Z.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,Z.STEP_AFTERRENDERTARGETDRAW_LAYER=1,Z.STEP_AFTERCAMERADRAW_PREPASS=0,Z.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,Z.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,Z.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,Z.STEP_AFTERCAMERADRAW_LAYER=4,Z.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,Z.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,Z.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,Z.STEP_AFTERRENDER_AUDIO=0,Z.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,Z.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,Z.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,Z.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,Z.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,Z.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,Z.STEP_POINTERMOVE_SPRITE=0,Z.STEP_POINTERDOWN_SPRITE=0,Z.STEP_POINTERUP_SPRITE=0;class F extends Array{constructor(H){super(...H)}static Create(){return Object.create(F.prototype)}registerStep(H,c,y){let Z=0,F=Number.MAX_VALUE;for(;Z<this.length;Z++){if(F=this[Z].index,H<F)break}this.splice(Z,0,{index:H,component:c,action:y.bind(c)})}clear(){this.length=0}}},11052:(H,c,y)=>{"use strict";y.d(c,{b:()=>Z});function Z(H,c,y,Z){var F,P=arguments.length,S=P<3?c:null===Z?Z=Object.getOwnPropertyDescriptor(c,y):Z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)S=Reflect.decorate(H,c,y,Z);else for(var n=H.length-1;n>=0;n--)(F=H[n])&&(S=(P<3?F(S):P>3?F(c,y,S):F(c,y))||S);return P>3&&S&&Object.defineProperty(c,y,S),S}Object.create;Object.create},12267:(H,c,y)=>{"use strict";class Z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((H,c)=>{this._resolve=H,this._reject=c}))}}var F=y(11092),P=y(11112),S=y(10754),n=y(11360),O=y(12276),a=y(12283),i=y(10763),C=y(11558),g=y(12290),v=y(12294),m=y(10810),z=y(10773),V=y(10781);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(H){this._useTextureToStoreBoneMatrices=H,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(H,c,y){this.name=H,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=F.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.e,this.bones=[],this._scene=y||m.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Z=this._scene.getEngine().getCaps();this._canUseTextureForBones=Z.textureFloat&&Z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((H=>!H.getParent()))}getTransformMatrices(H){if(this.needInitialSkinMatrix){if(!H)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return H._bonesTransformMatrices||this.prepare(!0),H._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(H){return this.needInitialSkinMatrix&&H._transformMatrixTexture?H._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(H){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,H){c+=", Ranges: {";let H=!0;for(const y in this._ranges)H&&(c+=", ",H=!1),c+=y;c+="}"}return c}getBoneIndexByName(H){for(let c=0,y=this.bones.length;c<y;c++)if(this.bones[c].name===H)return c;return-1}createAnimationRange(H,c,y){if(!this._ranges[H]){this._ranges[H]=new v.c(H,c,y);for(let Z=0,F=this.bones.length;Z<F;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].createRange(H,c,y)}}deleteAnimationRange(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let y=0,Z=this.bones.length;y<Z;y++)this.bones[y].animations[0]&&this.bones[y].animations[0].deleteRange(H,c);this._ranges[H]=null}getAnimationRange(H){return this._ranges[H]||null}getAnimationRanges(){const H=[];let c;for(c in this._ranges)H.push(this._ranges[c]);return H}copyAnimationRange(H,c){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!H.getAnimationRange(c))return!1;let Z=!0;const F=this._getHighestAnimationFrame()+1,P={},S=H.bones;let n,O;for(O=0,n=S.length;O<n;O++)P[S[O].name]=S[O];this.bones.length!==S.length&&(z.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${S.length}`),Z=!1);const a=y&&this.dimensionsAtRest&&H.dimensionsAtRest?this.dimensionsAtRest.divide(H.dimensionsAtRest):null;for(O=0,n=this.bones.length;O<n;O++){const H=this.bones[O].name,S=P[H];S?Z=Z&&this.bones[O].copyAnimationRange(S,c,F,y,a):(z.d.Warn("copyAnimationRange: not same rig, missing source bone "+H),Z=!1)}const i=H.getAnimationRange(c);return i&&(this._ranges[c]=new v.c(c,i.from+F,i.to+F)),Z}returnToRest(){for(const H of this.bones)-1!==H._index&&H.returnToRest()}_getHighestAnimationFrame(){let H=0;for(let c=0,y=this.bones.length;c<y;c++)if(this.bones[c].animations[0]){const y=this.bones[c].animations[0].getHighestFrame();H<y&&(H=y)}return H}beginAnimation(H,c,y,Z){const F=this.getAnimationRange(H);return F?this._scene.beginAnimation(this,F.from,F.to,c,y,Z):null}static MakeAnimationAdditive(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const Z=H.getAnimationRange(y);if(!Z)return null;const F=H._scene.getAllAnimatablesByTarget(H);let P=null;for(let n=0;n<F.length;n++){const H=F[n];if(H.fromFrame===(null===Z||void 0===Z?void 0:Z.from)&&H.toFrame===(null===Z||void 0===Z?void 0:Z.to)){P=H;break}}const S=H.getAnimatables();for(let n=0;n<S.length;n++){const H=S[n].animations;if(H)for(let Z=0;Z<H.length;Z++)g.c.MakeAnimationAdditive(H[Z],c,y)}return P&&(P.isAdditive=!0),H}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(H){this._meshesWithPoseMatrix.push(H)}_unregisterMeshWithPoseMatrix(H){const c=this._meshesWithPoseMatrix.indexOf(H);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(H,c){this.onBeforeComputeObservable.notifyObservers(this);for(let y=0;y<this.bones.length;y++){const Z=this.bones[y];Z._childUpdateId++;const F=Z.getParent();if(F?Z.getLocalMatrix().multiplyToRef(F.getFinalMatrix(),Z.getFinalMatrix()):c?Z.getLocalMatrix().multiplyToRef(c,Z.getFinalMatrix()):Z.getFinalMatrix().p(Z.getLocalMatrix()),-1!==Z._index){const c=null===Z._index?y:Z._index;Z.getAbsoluteInverseBindMatrix().multiplyToArray(Z.getFinalMatrix(),H,16*c)}}this._identity.copyToArray(H,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const H=this.va().getRenderId();if(this._currentRenderId===H)return;this._currentRenderId=H}if(this._numBonesWithLinkedTransformNode>0)for(const H of this.bones)if(H._linkedTransformNode){const c=H._linkedTransformNode;H.position=c.position,c.rotationQuaternion?H.rotationQuaternion=c.rotationQuaternion:H.rotation=c.rotation,H.de=c.de}if(this.needInitialSkinMatrix)for(const H of this._meshesWithPoseMatrix){const c=H.getPoseMatrix();let y=this._isDirty;if(H._bonesTransformMatrices&&H._bonesTransformMatrices.length===16*(this.bones.length+1)||(H._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),y=!0),y){if(this._synchronizedWithMesh!==H){this._synchronizedWithMesh=H;for(const H of this.bones)if(!H.getParent()){H.getBindMatrix().multiplyToRef(c,F.h.Matrix[1]),H._updateAbsoluteBindMatrices(F.h.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);H._transformMatrixTexture&&H._transformMatrixTexture.getSize().width===c||(H._transformMatrixTexture&&H._transformMatrixTexture.dispose(),H._transformMatrixTexture=C.c.CreateRGBATexture(H._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(H._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&H._transformMatrixTexture&&H._transformMatrixTexture.update(H._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=C.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let H=0;H<this.bones.length;H++)this._animatables.push(this.bones[H])}return this._animatables}clone(H,c){const y=new h(H,c||H,this._scene);y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){const H=this.bones[Z];let c=null;const F=H.getParent();if(F){const H=this.bones.indexOf(F);c=y.bones[H]}const P=new a.d(H.name,y,c,H.getBindMatrix().clone(),H.getRestMatrix().clone());P._index=H._index,H._linkedTransformNode&&P.linkTransformNode(H._linkedTransformNode),V.c.DeepCopy(H.animations,P.animations)}if(this._ranges){y._ranges={};for(const H in this._ranges){const c=this._ranges[H];c&&(y._ranges[H]=c.clone())}}return this._isDirty=!0,y.prepare(!0),y}enableBlending(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((c=>{c.animations.forEach((c=>{c.enableBlending=!0,c.blendingSpeed=H}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const H=this._parentContainer.skeletons.indexOf(this);H>-1&&this._parentContainer.skeletons.splice(H,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const H={};H.name=this.name,H.id=this.id,this.dimensionsAtRest&&(H.dimensionsAtRest=this.dimensionsAtRest.ij()),H.bones=[],H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let y=0;y<this.bones.length;y++){var c;const Z=this.bones[y],F=Z.getParent(),P={parentBoneIndex:F?this.bones.indexOf(F):-1,index:Z.getIndex(),name:Z.name,id:Z.id,matrix:Z.getBindMatrix().ij(),rest:Z.getRestMatrix().ij(),linkedTransformNodeId:null===(c=Z.getTransformNode())||void 0===c?void 0:c.id};H.bones.push(P),Z.length&&(P.length=Z.length),Z.metadata&&(P.metadata=Z.metadata),Z.animations&&Z.animations.length>0&&(P.animation=Z.animations[0].serialize()),H.ranges=[];for(const c in this._ranges){const y=this._ranges[c];if(!y)continue;const Z={};Z.name=c,Z.from=y.from,Z.to=y.to,H.ranges.push(Z)}}return H}static Parse(H,c){const y=new h(H.name,H.id,c);let Z;for(H.dimensionsAtRest&&(y.dimensionsAtRest=F.n.Tg(H.dimensionsAtRest)),y.needInitialSkinMatrix=H.needInitialSkinMatrix,Z=0;Z<H.bones.length;Z++){const c=H.bones[Z],P=H.bones[Z].index;let S=null;c.parentBoneIndex>-1&&(S=y.bones[c.parentBoneIndex]);const n=c.rest?F.d.Tg(c.rest):null,O=new a.d(c.name,y,S,F.d.Tg(c.matrix),n,null,P);void 0!==c.id&&null!==c.id&&(O.id=c.id),c.length&&(O.length=c.length),c.metadata&&(O.metadata=c.metadata),c.animation&&O.animations.push(g.c.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(y._hasWaitingData=!0,O._waitingTransformNodeId=c.linkedTransformNodeId)}if(H.ranges)for(Z=0;Z<H.ranges.length;Z++){const c=H.ranges[Z];y.createAnimationRange(c.name,c.from,c.to)}return y}computeAbsoluteMatrices(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||H)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(H)}getPoseMatrix(){let H=null;return this._meshesWithPoseMatrix.length>0&&(H=this._meshesWithPoseMatrix[0].getPoseMatrix()),H}sortBones(){const H=[],c=new Array(this.bones.length);for(let y=0;y<this.bones.length;y++)this._sortBones(y,H,c);this.bones=H}_sortBones(H,c,y){if(y[H])return;y[H]=!0;const Z=this.bones[H];if(!Z)return;void 0===Z._index&&(Z._index=H);const F=Z.getParent();F&&this._sortBones(this.bones.indexOf(F),c,y),c.push(Z)}setCurrentPoseAsRest(){this.bones.forEach((H=>{H.setCurrentPoseAsRest()}))}}var Q=y(11239),D=y(11052),f=y(11061),J=y(12302),l=y(12315),d=y(10893),K=y(11118);class T extends l.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(H){this.subSurface.refractionTexture=H,H?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(H){this.subSurface.indexOfRefraction=H}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(H){this.subSurface.invertRefractionY=H}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(H){this.subSurface.linkRefractionWithTransparency=H,H&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===l.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(H){H!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=H?l.b.LIGHTFALLOFF_PHYSICAL:l.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===l.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(H){H!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=H?l.b.LIGHTFALLOFF_GLTF:l.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(H){this._attachImageProcessingConfiguration(H),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(H){this.imageProcessingConfiguration.colorCurvesEnabled=H}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(H){this.imageProcessingConfiguration.colorGradingEnabled=H}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(H){this._imageProcessingConfiguration.toneMappingEnabled=H}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(H){this._imageProcessingConfiguration.exposure=H}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(H){this._imageProcessingConfiguration.contrast=H}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(H){this._imageProcessingConfiguration.colorGradingTexture=H}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(H){this._imageProcessingConfiguration.colorCurves=H}constructor(H,c){super(H,c,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=P.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new P.e(0,0,0),this.albedoColor=new P.e(1,1,1),this.reflectivityColor=new P.e(1,1,1),this.reflectionColor=new P.e(1,1,1),this.emissiveColor=new P.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,J.b)(this.va())}getClassName(){return"PBRMaterial"}clone(H){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const Z=K.e.Clone((()=>new T(H,this.va())),this,{cloneTexturesOnlyOnce:c});return Z.id=H,Z.name=H,this.stencil.copyTo(Z.stencil),this._clonePlugins(Z,y),Z}serialize(){const H=super.serialize();return H.customType="BABYLON.PBRMaterial",H}static Parse(H,c,y){const Z=K.e.Parse((()=>new T(H.name,c)),H,c,y);return H.stencil&&Z.stencil.parse(H.stencil,c,y),Q.c._ParsePlugins(H,Z,c,y),H.clearCoat&&Z.clearCoat.parse(H.clearCoat,c,y),H.anisotropy&&Z.anisotropy.parse(H.anisotropy,c,y),H.brdf&&Z.brdf.parse(H.brdf,c,y),H.sheen&&Z.sheen.parse(H.sheen,c,y),H.subSurface&&Z.subSurface.parse(H.subSurface,c,y),H.iridescence&&Z.iridescence.parse(H.iridescence,c,y),Z}}T.PBRMATERIAL_OPAQUE=l.b.PBRMATERIAL_OPAQUE,T.PBRMATERIAL_ALPHATEST=l.b.PBRMATERIAL_ALPHATEST,T.PBRMATERIAL_ALPHABLEND=l.b.PBRMATERIAL_ALPHABLEND,T.PBRMATERIAL_ALPHATESTANDBLEND=l.b.PBRMATERIAL_ALPHATESTANDBLEND,T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=l.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"directIntensity",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveIntensity",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"environmentIntensity",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"specularIntensity",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"disableBumpMap",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"albedoTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTexture",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTextureStrength",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"opacityTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectionTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectivityTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicTexture",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallic",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"roughness",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicF0Factor",void 0),(0,D.b)([(0,f.l)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicReflectanceColor",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicReflectanceTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectanceTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"microSurfaceTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"bumpTexture",void 0),(0,D.b)([(0,f.H)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty",null)],T.prototype,"lightmapTexture",void 0),(0,D.b)([(0,f.l)("ambient"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientColor",void 0),(0,D.b)([(0,f.l)("albedo"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"albedoColor",void 0),(0,D.b)([(0,f.l)("reflectivity"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectivityColor",void 0),(0,D.b)([(0,f.l)("reflection"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectionColor",void 0),(0,D.b)([(0,f.l)("emissive"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveColor",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"microSurface",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useLightmapAsShadowmap",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"useAlphaFromAlbedoTexture",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"forceAlphaTest",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"alphaCutOff",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useSpecularOverAlpha",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAmbientInGrayScale",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,D.b)([(0,f.P)()],T.prototype,"usePhysicalLightFalloff",null),(0,D.b)([(0,f.P)()],T.prototype,"useGLTFLightFalloff",null),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRadianceOverAlpha",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useObjectSpaceNormalMap",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useParallax",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useParallaxOcclusion",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"parallaxScaleBias",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsLightsDirty")],T.prototype,"disableLighting",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"forceIrradianceInFragment",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsLightsDirty")],T.prototype,"maxSimultaneousLights",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"invertNormalMapX",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"invertNormalMapY",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"twoSidedLighting",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAlphaFresnel",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useLinearAlphaFresnel",void 0),(0,D.b)([(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"environmentBRDFTexture",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"forceNormalForward",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"enableSpecularAntiAliasing",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useHorizonOcclusion",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRadianceOcclusion",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsMiscDirty")],T.prototype,"unlit",void 0),(0,D.b)([(0,f.P)(),(0,f.d)("_markAllSubMeshesAsMiscDirty")],T.prototype,"applyDecalMapAfterDetailMap",void 0),(0,d.d)("BABYLON.PBRMaterial",T);var u=y(11304),E=y(11403),U=y(11153),G=y(11385),p=y(11399),t=y(11354);class o{get influence(){return this._influence}set influence(H){if(this._influence===H)return;const c=this._influence;this._influence=H,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===c||0===H)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=H,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new i.e,this._onDataLayoutChanged=new i.e,this._animationPropertiesOverride=null,this.id=H,this._scene=y||m.b.LastCreatedScene,this.influence=c,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(H){const c=this.hasPositions;this._positions=H,c!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(H){const c=this.hasNormals;this._normals=H,c!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(H){const c=this.hasTangents;this._tangents=H,c!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(H){const c=this.hasUVs;this._uvs=H,c!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const H=K.e.Clone((()=>new o(this.name,this.influence,this._scene)),this);return H._positions=this._positions,H._normals=this._normals,H._tangents=this._tangents,H._uvs=this._uvs,H}serialize(){const H={};return H.name=this.name,H.influence=this.influence,H.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(H.id=this.id),this.hasNormals&&(H.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(H.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(H.Aa=Array.prototype.slice.call(this.getUVs())),K.e.AppendSerializedAnimations(this,H),H}getClassName(){return"MorphTarget"}static Parse(H,c){const y=new o(H.name,H.influence);if(y.setPositions(H.xa),null!=H.id&&(y.id=H.id),H.ya&&y.setNormals(H.ya),H.tangents&&y.setTangents(H.tangents),H.Aa&&y.setUVs(H.Aa),H.animations){for(let c=0;c<H.animations.length;c++){const Z=H.animations[c],F=(0,d.c)("BABYLON.Animation");F&&y.animations.push(F.Parse(Z))}H.autoAnimate&&c&&c.beginAnimation(y,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1)}return y}static FromMesh(H,c,y){c||(c=H.name);const Z=new o(c,y,H.va());return Z.setPositions(H.getVerticesData(U.h.PositionKind)),H.isVerticesDataPresent(U.h.NormalKind)&&Z.setNormals(H.getVerticesData(U.h.NormalKind)),H.isVerticesDataPresent(U.h.TangentKind)&&Z.setTangents(H.getVerticesData(U.h.TangentKind)),H.isVerticesDataPresent(U.h.UVKind)&&Z.setUVs(H.getVerticesData(U.h.UVKind)),Z}}(0,D.b)([(0,f.P)()],o.prototype,"id",void 0);var s=y(11071),q=y(11929);class I{set areUpdatesFrozen(H){H?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new s.c(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,H||(H=m.b.LastCreatedScene),this._scene=H,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const H=this._scene.getEngine().getCaps();this._canUseTextureForTargets=H.canUseGLVertexID&&H.textureFloat&&H.maxVertexTextureImageUnits>0&&H.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(H){this._numMaxInfluencers!==H&&(this._numMaxInfluencers=H,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(H){this._useTextureToStoreTargets=H}get isUsingTextureForTargets(){var H;return I.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(H=this._scene)&&void 0!==H&&H.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(H){return this._activeTargets.data[H]}getTarget(H){return this._targets[H]}getTargetByName(H){for(const c of this._targets)if(c.name===H)return c;return null}addTarget(H){this._targets.push(H),this._targetInfluenceChangedObservers.push(H.onInfluenceChanged.add((H=>{this._syncActiveTargets(H)}))),this._targetDataLayoutChangedObservers.push(H._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(H){const c=this._targets.indexOf(H);c>=0&&(this._targets.splice(c,1),H.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),H._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(H)}_bind(H){H.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),H.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),H.setTexture("morphTargets",this._targetStoreTexture),H.setInt("morphTargetCount",this.numInfluencers)}clone(){const H=new I(this._scene);for(const c of this._targets)H.addTarget(c.clone());return H.enableNormalMorphing=this.enableNormalMorphing,H.enableTangentMorphing=this.enableTangentMorphing,H.enableUVMorphing=this.enableUVMorphing,H}serialize(){const H={};H.id=this.uniqueId,H.targets=[];for(const c of this._targets)H.targets.push(c.serialize());return H}_syncActiveTargets(H){if(this.areUpdatesFrozen)return;let c=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let y=-1;for(const Z of this._targets){if(y++,0===Z.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=I.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Z),this._morphTargetTextureIndices[c]=y,this._tempInfluences[c++]=Z.influence,this._supportsNormals=this._supportsNormals&&Z.hasNormals,this._supportsTangents=this._supportsTangents&&Z.hasTangents,this._supportsUVs=this._supportsUVs&&Z.hasUVs;const H=Z.getPositions();if(H){const c=H.length/3;if(0===this._vertexCount)this._vertexCount=c;else if(this._vertexCount!==c)return void z.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==c&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,c)),this._influences&&this._influences.length===c||(this._influences=new Float32Array(c));for(let Z=0;Z<c;Z++)this._influences[Z]=this._tempInfluences[Z];H&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const H=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>H&&(this._textureHeight=Math.ceil(this._textureWidth/H),this._textureWidth=H);let c=!0;if(this._targetStoreTexture){const H=this._targetStoreTexture.getSize();H.width===this._textureWidth&&H.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(c=!1)}if(c){this._targetStoreTexture&&this._targetStoreTexture.dispose();const H=this._targets.length,c=new Float32Array(H*this._textureWidth*this._textureHeight*4);let y=0;for(let Z=0;Z<H;Z++){const H=this._targets[Z],F=H.getPositions(),P=H.getNormals(),S=H.getUVs(),n=H.getTangents();if(!F)return void(0===Z&&z.d.Error("Invalid morph target. Target must have positions."));y=Z*this._textureWidth*this._textureHeight*4;for(let Z=0;Z<this._vertexCount;Z++)c[y]=F[3*Z],c[y+1]=F[3*Z+1],c[y+2]=F[3*Z+2],y+=4,this._supportsNormals&&P&&(c[y]=P[3*Z],c[y+1]=P[3*Z+1],c[y+2]=P[3*Z+2],y+=4),this._supportsUVs&&S&&(c[y]=S[2*Z],c[y+1]=S[2*Z+1],y+=4),this._supportsTangents&&n&&(c[y]=n[3*Z],c[y+1]=n[3*Z+1],c[y+2]=n[3*Z+2],y+=4)}this._targetStoreTexture=q.e.CreateRGBATexture(c,this._textureWidth,this._textureHeight,H,this._scene,!1,!1,1,1)}}for(const H of this._scene.meshes)H.morphTargetManager===this&&H._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const H=this._parentContainer.morphTargetManagers.indexOf(this);H>-1&&this._parentContainer.morphTargetManagers.splice(H,1),this._parentContainer=null}for(const H of this._targets)this._scene.stopAnimation(H)}}static Parse(H,c){const y=new I(c);for(const Z of H.targets)y.addTarget(o.Parse(Z,c));return y}}I.EnableTextureStorage=!0,I.MaxActiveMorphTargetsInVertexAttributeMode=8;var j=y(12325),k=y(10819),W=y(11256);function M(H,c,y,Z){return F.n.Tg(c,y).scaleInPlace(Z)}class x{constructor(H,c,y,Z){this.type=H,this.name=c,this.getValue=y,this.getStride=Z}_buildAnimation(H,c,y){const Z=new g.c(H,this.name,c,this.type);return Z.setKeys(y),Z}}class R extends x{buildAnimations(H,c,y,Z,F){F(H._babylonTransformNode,this._buildAnimation(c,y,Z))}}const A={translation:[new R(g.c.ANIMATIONTYPE_VECTOR3,"position",M,(()=>3))],rotation:[new R(g.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(H,c,y,Z){return F.f.Tg(c,y).scaleInPlace(Z)}),(()=>4))],scale:[new R(g.c.ANIMATIONTYPE_VECTOR3,"de",M,(()=>3))],weights:[new class extends x{buildAnimations(H,c,y,Z,F){if(H._numMorphTargets)for(let P=0;P<H._numMorphTargets;P++){const S=new g.c(`${c}_${P}`,this.name,y,this.type);if(S.setKeys(Z.map((H=>({frame:H.frame,inTangent:H.inTangent?H.inTangent[P]:void 0,value:H.value[P],outTangent:H.outTangent?H.outTangent[P]:void 0,interpolation:H.interpolation})))),H._primitiveBabylonMeshes)for(const c of H._primitiveBabylonMeshes)if(c.morphTargetManager){const H=c.morphTargetManager.getTarget(P),y=S.clone();H.animations.push(y),F(H,y)}}}}(g.c.ANIMATIONTYPE_FLOAT,"influence",(function(H,c,y,Z){const F=new Array(H._numMorphTargets);for(let P=0;P<F.length;P++)F[P]=c[y++]*Z;return F}),(H=>H._numMorphTargets))]},e=new Map,r=e;function N(H,c,y){w(H)&&z.d.Warn(`Extension with the name '${H}' already exists`),e.set(H,{isGLTFExtension:c,factory:y})}function w(H){return e.delete(H)}function L(){const H=H=>H&&"object"===typeof H;for(var c=arguments.length,y=new Array(c),Z=0;Z<c;Z++)y[Z]=arguments[Z];return y.reduce(((c,y)=>(Object.keys(y).forEach((Z=>{const F=c[Z],P=y[Z];Array.isArray(F)&&Array.isArray(P)?c[Z]=F.concat(...P):H(F)&&H(P)?c[Z]=L(F,P):c[Z]=P})),c)),{})}class b{static Get(H,c,y){if(!c||void 0==y||!c[y])throw new Error(`${H}: Failed to find index (${y})`);return c[y]}static TryGet(H,c){return H&&void 0!=c&&H[c]?H[c]:null}static Assign(H){if(H)for(let c=0;c<H.length;c++)H[c].index=c}}class X{static RegisterExtension(H,c){N(H,!1,c)}static UnregisterExtension(H){return w(H)}get Oi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(H){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=H}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((H=>H.dispose&&H.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(H,c,y,Z,F,P){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=c,this._assetContainer=y,this._loadData(Z);let P=null;if(H){const c={};if(this._gltf.nodes)for(const H of this._gltf.nodes)H.name&&(c[H.name]=H.index);P=(H instanceof Array?H:[H]).map((H=>{const y=c[H];if(void 0===y)throw new Error(`Failed to find node '${H}'`);return y}))}return this._loadAsync(F,S,P,(()=>({meshes:this._getMeshes(),qj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=H,this._loadData(c),this._loadAsync(y,F,null,(()=>{})))))}_loadAsync(H,c,y,Z){return Promise.resolve().then((async()=>{this._rootUrl=H,this._uniqueRootUrl=!H.startsWith("file:")&&c?H:`${H}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const F=`${j.k[j.k.LOADING]} => ${j.k[j.k.READY]}`,P=`${j.k[j.k.LOADING]} => ${j.k[j.k.COMPLETE]}`;this._parent._startPerformanceCounter(F),this._parent._startPerformanceCounter(P),this._parent._setState(j.k.LOADING),this._extensionsOnLoading();const n=new Array;if(!this.parent.loadOnlyMaterials)if(y)n.push(this.loadSceneAsync("/nodes",{nodes:y,index:-1}));else if(void 0!=this._gltf.Gd||this._gltf.scenes&&this._gltf.scenes[0]){const H=b.Get("/scene",this._gltf.scenes,this._gltf.Gd||0);n.push(this.loadSceneAsync(`/scenes/${H.index}`,H))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let H=0;H<this._gltf.materials.length;++H){const c=this._gltf.materials[H],y="/materials/"+H,Z=Q.c.TriangleFillMode;n.push(this._loadMaterialAsync(y,c,null,Z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&n.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&n.push(this._compileShadowGeneratorsAsync());return Promise.all(n).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Tb(!0),this._extensionsOnReady(),this._parent._setState(j.k.READY),this._startAnimations(),Z()))).then((H=>(this._parent._endPerformanceCounter(F),S.c.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(P),this._parent._setState(j.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(H=>{this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()}))})),H)))})).catch((H=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()),H}))}_loadData(H){if(this._gltf=H.json,this._setupData(),H.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const y=c[0];(y.byteLength<H.bin.byteLength-3||y.byteLength>H.bin.byteLength)&&z.d.Warn(`Binary buffer length (${y.byteLength}) from JSON does not match chunk length (${H.bin.byteLength})`),this._bin=H.bin}else z.d.Warn("Unexpected BIN chunk")}}_setupData(){if(b.Assign(this._gltf.accessors),b.Assign(this._gltf.animations),b.Assign(this._gltf.buffers),b.Assign(this._gltf.bufferViews),b.Assign(this._gltf.cameras),b.Assign(this._gltf.images),b.Assign(this._gltf.materials),b.Assign(this._gltf.meshes),b.Assign(this._gltf.nodes),b.Assign(this._gltf.samplers),b.Assign(this._gltf.scenes),b.Assign(this._gltf.skins),b.Assign(this._gltf.textures),this._gltf.nodes){const H={};for(const y of this._gltf.nodes)if(y.children)for(const c of y.children)H[c]=y.index;const c=this._createRootNode();for(const y of this._gltf.nodes){const Z=H[y.index];y.parent=void 0===Z?c:this._gltf.nodes[Z]}}}async _loadExtensionsAsync(){const H=[];if(r.forEach(((c,y)=>{var Z;!1===(null===(Z=this.parent.extensionOptions[y])||void 0===Z?void 0:Z.enabled)?c.isGLTFExtension&&this.isExtensionUsed(y)&&z.d.Warn(`Extension ${y} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(y)||H.push((async()=>{const H=await c.factory(this);return H.name!==y&&z.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${H.name} !== ${y}`),this._parent.onExtensionLoadedObservable.notifyObservers(H),H})())})),this._extensions.push(...await Promise.all(H)),this._extensions.sort(((H,c)=>(H.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const y of this._gltf.extensionsRequired){if(!this._extensions.some((H=>H.name===y&&H.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[y])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${y} is disabled`);throw new Error(`Required extension ${y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new t.c("__root__",this._babylonScene);this._rootBabylonMesh=H,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Tb(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case j.i.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],X._LoadTransform(c,this._rootBabylonMesh));break;case j.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(H),c}loadSceneAsync(H,c){const y=this._extensionsLoadSceneAsync(H,c);if(y)return y;const Z=new Array;if(this.logOpen(`${H} ${c.name||""}`),c.nodes)for(const F of c.nodes){const c=b.Get(`${H}/nodes/${F}`,this._gltf.nodes,F);Z.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(H=>{H.parent=this._rootBabylonMesh})))}for(const F of this._postSceneLoadActions)F();return Z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Z).then((()=>{}))}_forEachPrimitive(H,c){if(H._primitiveBabylonMeshes)for(const y of H._primitiveBabylonMeshes)c(y)}_getGeometries(){const H=[],c=this._gltf.nodes;if(c)for(const y of c)this._forEachPrimitive(y,(c=>{const y=c.Dj;y&&-1===H.indexOf(y)&&H.push(y)}));return H}_getMeshes(){const H=[];this._rootBabylonMesh instanceof p.d&&H.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const y of c)this._forEachPrimitive(y,(c=>{H.push(c)}));return H}_getTransformNodes(){const H=[],c=this._gltf.nodes;if(c)for(const y of c)y._babylonTransformNode&&"qb"===y._babylonTransformNode.getClassName()&&H.push(y._babylonTransformNode),y._babylonTransformNodeForSkin&&H.push(y._babylonTransformNodeForSkin);return H}_getSkeletons(){const H=[],c=this._gltf.skins;if(c)for(const y of c)y._data&&H.push(y._data.babylonSkeleton);return H}_getAnimationGroups(){const H=[],c=this._gltf.animations;if(c)for(const y of c)y._babylonAnimationGroup&&H.push(y._babylonAnimationGroup);return H}_startAnimations(){switch(this._parent.animationStartMode){case j.e.NONE:break;case j.e.FIRST:{const H=this._getAnimationGroups();0!==H.length&&H[0].start(!0);break}case j.e.ALL:{const H=this._getAnimationGroups();for(const c of H)c.start(!0);break}default:return void z.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadNodeAsync(H,c,y);if(Z)return Z;if(c._babylonTransformNode)throw new Error(`${H}: Invalid recursive node hierarchy`);const F=new Array;this.logOpen(`${H} ${c.name||""}`);const P=Z=>{if(X.AddPointerMetadata(Z,H),X._LoadTransform(c,Z),void 0!=c.camera){const y=b.Get(`${H}/camera`,this._gltf.cameras,c.camera);F.push(this.loadCameraAsync(`/cameras/${y.index}`,y,(H=>{H.parent=Z})))}if(c.children)for(const y of c.children){const c=b.Get(`${H}/children/${y}`,this._gltf.nodes,y);F.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(H=>{H.parent=Z})))}y(Z)},S=void 0!=c.mesh,n=this._parent.loadSkins&&void 0!=c.skin;if(!S||n){const H=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new E.c(H,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=y:c._babylonTransformNodeForSkin=y,P(y)}if(S)if(n){const y=b.Get(`${H}/mesh`,this._gltf.meshes,c.mesh);F.push(this._loadMeshAsync(`/meshes/${y.index}`,c,y,(y=>{const Z=c._babylonTransformNodeForSkin;y.metadata=L(Z.metadata,y.metadata||{});const P=b.Get(`${H}/skin`,this._gltf.skins,c.skin);F.push(this._loadSkinAsync(`/skins/${P.index}`,c,P,(H=>{this._forEachPrimitive(c,(c=>{c.skeleton=H})),this._postSceneLoadActions.push((()=>{if(void 0!=P.skeleton){const H=b.Get(`/skins/${P.index}/skeleton`,this._gltf.nodes,P.skeleton).parent;c.index===H.index?y.parent=Z.parent:y.parent=H._babylonTransformNode}else y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Z,skinnedNode:y})}))})))})))}else{const y=b.Get(`${H}/mesh`,this._gltf.meshes,c.mesh);F.push(this._loadMeshAsync(`/meshes/${y.index}`,c,y,P))}return this.logClose(),Promise.all(F).then((()=>(this._forEachPrimitive(c,(H=>{H.Dj&&H.Dj.useBoundingInfoFromGeometry?H.Ea():H.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(H,c,y,Z){const F=y.primitives;if(!F||!F.length)throw new Error(`${H}: Primitives are missing`);void 0==F[0].index&&b.Assign(F);const P=new Array;this.logOpen(`${H} ${y.name||""}`);const S=c.name||`node${c.index}`;if(1===F.length){const Z=y.primitives[0];P.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${Z.index}`,S,c,y,Z,(H=>{c._babylonTransformNode=H,c._primitiveBabylonMeshes=[H]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new E.c(S,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const Z of F)P.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${Z.index}`,`${S}_primitive${Z.index}`,c,y,Z,(H=>{H.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(H)})))}return Z(c._babylonTransformNode),this.logClose(),Promise.all(P).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(H,c,y,Z,F,P){const S=this._extensionsLoadMeshPrimitiveAsync(H,c,y,Z,F,P);if(S)return S;this.logOpen(`${H}`);const n=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==y.skin&&!Z.primitives[0].targets;let O,a;if(n&&F._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,O=F._instanceData.babylonSourceMesh.createInstance(c),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a=F._instanceData.promise;else{const P=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new t.c(c,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.sideOrientation=this._babylonScene.useRightHandedSystem?Q.c.CounterClockWiseSideOrientation:Q.c.ClockWiseSideOrientation,this._createMorphTargets(H,y,Z,F,S),P.push(this._loadVertexDataAsync(H,F,S).then((c=>this._loadMorphTargetsAsync(H,F,S,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.Ca(S),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const i=X._GetDrawMode(H,F.mode);if(void 0==F.material){let H=this._defaultBabylonMaterialData[i];H||(H=this._createDefaultMaterial("__GLTFLoader._default",i),this._parent.onMaterialLoadedObservable.notifyObservers(H),this._defaultBabylonMaterialData[i]=H),S.material=H}else if(!this.parent.skipMaterials){const c=b.Get(`${H}/material`,this._gltf.materials,F.material);P.push(this._loadMaterialAsync(`/materials/${c.index}`,c,S,i,(H=>{S.material=H})))}a=Promise.all(P),n&&(F._instanceData={babylonSourceMesh:S,promise:a}),O=S}return X.AddPointerMetadata(O,H),this._parent.onMeshLoadedObservable.notifyObservers(O),P(O),this.logClose(),a.then((()=>O))}_loadVertexDataAsync(H,c,y){const Z=this._extensionsLoadVertexDataAsync(H,c,y);if(Z)return Z;const P=c.attributes;if(!P)throw new Error(`${H}: Attributes are missing`);const S=new Array,n=new G.d(y.name,this._babylonScene);if(void 0==c.indices)y.isUnIndexed=!0;else{const y=b.Get(`${H}/indices`,this._gltf.accessors,c.indices);S.push(this._loadIndicesAccessorAsync(`/accessors/${y.index}`,y).then((H=>{n.setIndices(H)})))}const O=(c,Z,O)=>{if(void 0==P[c])return;y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(Z)&&y._delayInfo.push(Z);const a=b.Get(`${H}/attributes/${c}`,this._gltf.accessors,P[c]);S.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,Z).then((H=>{if(H.getKind()===U.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!y.skeleton&&a.min&&a.max){const H=F.h.o[0].be(...a.min),c=F.h.o[1].be(...a.max);if(a.normalized&&5126!==a.componentType){let y=1;switch(a.componentType){case 5120:y=127;break;case 5121:y=255;break;case 5122:y=32767;break;case 5123:y=65535}const Z=1/y;H.scaleInPlace(Z),c.scaleInPlace(Z)}n._boundingInfo=new W.b(H,c),n.useBoundingInfoFromGeometry=!0}n.setVerticesBuffer(H,a.count)}))),Z==U.h.MatricesIndicesExtraKind&&(y.numBoneInfluencers=8),O&&O(a)};return O("POSITION",U.h.PositionKind),O("NORMAL",U.h.NormalKind),O("TANGENT",U.h.TangentKind),O("TEXCOORD_0",U.h.UVKind),O("TEXCOORD_1",U.h.UV2Kind),O("TEXCOORD_2",U.h.UV3Kind),O("TEXCOORD_3",U.h.UV4Kind),O("TEXCOORD_4",U.h.UV5Kind),O("TEXCOORD_5",U.h.UV6Kind),O("JOINTS_0",U.h.MatricesIndicesKind),O("WEIGHTS_0",U.h.MatricesWeightsKind),O("JOINTS_1",U.h.MatricesIndicesExtraKind),O("WEIGHTS_1",U.h.MatricesWeightsExtraKind),O("COLOR_0",U.h.ColorKind,(H=>{"VEC4"===H.type&&(y.hasVertexAlpha=!0)})),Promise.all(S).then((()=>n))}_createMorphTargets(H,c,y,Z,F){if(!Z.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=Z.targets.length;else if(Z.targets.length!==c._numMorphTargets)throw new Error(`${H}: Primitives do not have the same number of targets`);const P=y.extras?y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,F.morphTargetManager=new I(this._babylonScene),F.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.morphTargetManager.areUpdatesFrozen=!0;for(let S=0;S<Z.targets.length;S++){const H=c.weights?c.weights[S]:y.weights?y.weights[S]:0,Z=P?P[S]:`morphTarget${S}`;F.morphTargetManager.addTarget(new o(Z,H,F.va()))}}_loadMorphTargetsAsync(H,c,y,Z){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const F=new Array,P=y.morphTargetManager;for(let S=0;S<P.numTargets;S++){const y=P.getTarget(S);F.push(this._loadMorphTargetVertexDataAsync(`${H}/targets/${S}`,Z,c.targets[S],y))}return Promise.all(F).then((()=>{P.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(H,c,y,Z){const F=new Array,P=(Z,P,S)=>{if(void 0==y[Z])return;const n=c.getVertexBuffer(P);if(!n)return;const O=b.Get(`${H}/${Z}`,this._gltf.accessors,y[Z]);F.push(this._loadFloatAccessorAsync(`/accessors/${O.index}`,O).then((H=>{S(n,H)})))};return P("POSITION",U.h.PositionKind,((H,c)=>{const y=new Float32Array(c.length);H.forEach(c.length,((H,Z)=>{y[Z]=c[Z]+H})),Z.setPositions(y)})),P("NORMAL",U.h.NormalKind,((H,c)=>{const y=new Float32Array(c.length);H.forEach(y.length,((H,Z)=>{y[Z]=c[Z]+H})),Z.setNormals(y)})),P("TANGENT",U.h.TangentKind,((H,c)=>{const y=new Float32Array(c.length/3*4);let F=0;H.forEach(c.length/3*4,((H,Z)=>{(Z+1)%4!==0&&(y[F]=c[F]+H,F++)})),Z.setTangents(y)})),Promise.all(F).then((()=>{}))}static _LoadTransform(H,c){if(void 0!=H.skin)return;let y=F.n.Zero(),Z=F.f.Identity(),P=F.n.One();if(H.matrix){F.d.Tg(H.matrix).decompose(P,Z,y)}else H.translation&&(y=F.n.Tg(H.translation)),H.rotation&&(Z=F.f.Tg(H.rotation)),H.scale&&(P=F.n.Tg(H.scale));c.position=y,c.rotationQuaternion=Z,c.de=P}_loadSkinAsync(H,c,y,Z){if(!this._parent.loadSkins)return Promise.resolve();const F=this._extensionsLoadSkinAsync(H,c,y);if(F)return F;if(y._data)return Z(y._data.babylonSkeleton),y._data.promise;const P=`skeleton${y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new h(y.name||P,P,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(H,y,S);const n=this._loadSkinInverseBindMatricesDataAsync(H,y).then((H=>{this._updateBoneMatrices(S,H)}));return y._data={babylonSkeleton:S,promise:n},Z(S),n}_loadBones(H,c,y){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const y=this._findSkeletonRootNode(`${H}/joints`,c.joints);if(y)if(void 0===c.skeleton)c.skeleton=y.index;else{const Z=(H,c)=>{for(;c.parent;c=c.parent)if(c.parent===H)return!0;return!1},F=b.Get(`${H}/skeleton`,this._gltf.nodes,c.skeleton);F===y||Z(F,y)||(z.d.Warn(`${H}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=y.index)}else z.d.Warn(`${H}: Failed to find common root`)}const Z={};for(const F of c.joints){const P=b.Get(`${H}/joints/${F}`,this._gltf.nodes,F);this._loadBone(P,c,y,Z)}}_findSkeletonRootNode(H,c){if(0===c.length)return null;const y={};for(const F of c){const c=[];let Z=b.Get(`${H}/${F}`,this._gltf.nodes,F);for(;-1!==Z.index;)c.unshift(Z),Z=Z.parent;y[F]=c}let Z=null;for(let F=0;;++F){let H=y[c[0]];if(F>=H.length)return Z;const P=H[F];for(let S=1;S<c.length;++S)if(H=y[c[S]],F>=H.length||P!==H[F])return Z;Z=P}}_loadBone(H,c,y,Z){H._isJoint=!0;let F=Z[H.index];if(F)return F;let P=null;H.index!==c.skeleton&&(H.parent&&-1!==H.parent.index?P=this._loadBone(H.parent,c,y,Z):void 0!==c.skeleton&&z.d.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const S=c.joints.indexOf(H.index);return F=new a.d(H.name||`joint${H.index}`,y,P,this._getNodeMatrix(H),null,null,S),Z[H.index]=F,this._postSceneLoadActions.push((()=>{F.linkTransformNode(H._babylonTransformNode)})),F}_loadSkinInverseBindMatricesDataAsync(H,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const y=b.Get(`${H}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${y.index}`,y)}_updateBoneMatrices(H,c){for(const y of H.bones){const H=F.d.Identity(),Z=y._index;c&&-1!==Z&&(F.d.FromArrayToRef(c,16*Z,H),H.invertToRef(H));const P=y.getParent();P&&H.multiplyToRef(P.getAbsoluteInverseBindMatrix(),H),y.Hj(H,!1,!1),y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(H){return H.matrix?F.d.Tg(H.matrix):F.d.Compose(H.scale?F.n.Tg(H.scale):F.n.One(),H.rotation?F.f.Tg(H.rotation):F.f.Identity(),H.translation?F.n.Tg(H.translation):F.n.Zero())}loadCameraAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadCameraAsync(H,c,y);if(Z)return Z;const P=new Array;this.logOpen(`${H} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new O.d(c.name||`camera${c.index}`,F.n.Zero(),this._babylonScene,!1);switch(S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.ignoreParentScaling=!0,c._babylonCamera=S,S.rotation.set(0,Math.PI,0),c.type){case"perspective":{const y=c.perspective;if(!y)throw new Error(`${H}: Camera perspective properties are missing`);S.fov=y.yfov,S.Wi=y.znear,S.maxZ=y.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${H}: Camera orthographic properties are missing`);S.mode=n.b.ORTHOGRAPHIC_CAMERA,S.orthoLeft=-c.orthographic.xmag,S.orthoRight=c.orthographic.xmag,S.orthoBottom=-c.orthographic.ymag,S.orthoTop=c.orthographic.ymag,S.Wi=c.orthographic.znear,S.maxZ=c.orthographic.zfar;break;default:throw new Error(`${H}: Invalid camera type (${c.type})`)}return X.AddPointerMetadata(S,H),this._parent.onCameraLoadedObservable.notifyObservers(S),y(S),this.logClose(),Promise.all(P).then((()=>S))}_loadAnimationsAsync(){const H=this._gltf.animations;if(!H)return Promise.resolve();const c=new Array;for(let y=0;y<H.length;y++){const Z=H[y];c.push(this.loadAnimationAsync(`/animations/${Z.index}`,Z).then((H=>{0===H.targetedAnimations.length&&H.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(H,c){const Z=this._extensionsLoadAnimationAsync(H,c);return Z||y.e(38).then(y.bind(y,13605)).then((y=>{let{AnimationGroup:Z}=y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new Z(c.name||`animation${c.index}`,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=F;const P=new Array;b.Assign(c.channels),b.Assign(c.samplers);for(const S of c.channels)P.push(this._loadAnimationChannelAsync(`${H}/channels/${S.index}`,H,c,S,((H,c)=>{H.animations=H.animations||[],H.animations.push(c),F.addTargetedAnimation(c,H)})));return Promise.all(P).then((()=>(F.normalize(0),F)))}))}_loadAnimationChannelAsync(H,c,y,Z,F){const P=this._extensionsLoadAnimationChannelAsync(H,c,y,Z,F);if(P)return P;if(void 0==Z.target.node)return Promise.resolve();const S=b.Get(`${H}/target/node`,this._gltf.nodes,Z.target.node),n=Z.target.path,O="weights"===n;if(O&&!S._numMorphTargets||!O&&!S._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!S._isJoint)return Promise.resolve();let a;switch(n){case"translation":a=A.translation;break;case"rotation":a=A.rotation;break;case"scale":a=A.scale;break;case"weights":a=A.weights;break;default:throw new Error(`${H}/target/path: Invalid value (${Z.target.path})`)}const i={object:S,info:a};return this._loadAnimationChannelFromTargetInfoAsync(H,c,y,Z,i,F)}_loadAnimationChannelFromTargetInfoAsync(H,c,y,Z,F,P){const S=this.parent.targetFps,n=1/S,O=b.Get(`${H}/sampler`,y.samplers,Z.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${Z.sampler}`,O).then((H=>{let c=0;const O=F.object,a=F.info;for(const F of a){const a=F.getStride(O),i=H.input,C=H.output,g=new Array(i.length);let v=0;switch(H.interpolation){case"STEP":for(let H=0;H<i.length;H++){const c=F.getValue(O,C,v,1);v+=a,g[H]={frame:i[H]*S,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let H=0;H<i.length;H++){const c=F.getValue(O,C,v,n);v+=a;const y=F.getValue(O,C,v,1);v+=a;const Z=F.getValue(O,C,v,n);v+=a,g[H]={frame:i[H]*S,inTangent:c,value:y,outTangent:Z}}break;case"LINEAR":for(let H=0;H<i.length;H++){const c=F.getValue(O,C,v,1);v+=a,g[H]={frame:i[H]*S,value:c}}}if(v>0){const H=`${y.name||`animation${y.index}`}_channel${Z.index}_${c}`;F.buildAnimations(O,H,S,g,((H,y)=>{++c,P(H,y)}))}}}))}_loadAnimationSamplerAsync(H,c){if(c._data)return c._data;const y=c.interpolation||"LINEAR";switch(y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${H}/interpolation: Invalid value (${c.interpolation})`)}const Z=b.Get(`${H}/input`,this._gltf.accessors,c.input),F=b.Get(`${H}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z),this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)]).then((H=>{let[c,Z]=H;return{input:c,interpolation:y,output:Z}})),c._data}loadBufferAsync(H,c,y,Z){const F=this._extensionsLoadBufferAsync(H,c,y,Z);if(F)return F;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${H}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+y,Z)}catch(F){throw new Error(`${H}: ${F.message}`)}}))}loadBufferViewAsync(H,c){const y=this._extensionsLoadBufferViewAsync(H,c);if(y)return y;if(c._data)return c._data;const Z=b.Get(`${H}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${Z.index}`,Z,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(H,c,y){if(c._data)return c._data;const Z=X._GetNumComponents(H,c.type),F=Z*U.h.GetTypeByteLength(c.componentType),P=Z*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new y(P));else{const S=b.Get(`${H}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((n=>{if(5126!==c.componentType||c.normalized||S.byteStride&&S.byteStride!==F){const H=new y(P);return U.h.ForEach(n,c.byteOffset||0,S.byteStride||F,Z,c.componentType,H.length,c.normalized||!1,((c,y)=>{H[y]=c})),H}return X._GetTypedArray(H,c.componentType,n,c.byteOffset,P)}))}if(c.sparse){const P=c.sparse;c._data=c._data.then((S=>{const n=S,O=b.Get(`${H}/sparse/indices/bufferView`,this._gltf.bufferViews,P.indices.bufferView),a=b.Get(`${H}/sparse/values/bufferView`,this._gltf.bufferViews,P.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${O.index}`,O),this.loadBufferViewAsync(`/bufferViews/${a.index}`,a)]).then((S=>{let[O,a]=S;const i=X._GetTypedArray(`${H}/sparse/indices`,P.indices.componentType,O,P.indices.byteOffset,P.count),C=Z*P.count;let g;if(5126!==c.componentType||c.normalized){const S=X._GetTypedArray(`${H}/sparse/values`,c.componentType,a,P.values.byteOffset,C);g=new y(C),U.h.ForEach(S,0,F,Z,c.componentType,g.length,c.normalized||!1,((H,c)=>{g[c]=H}))}else g=X._GetTypedArray(`${H}/sparse/values`,c.componentType,a,P.values.byteOffset,C);let v=0;for(let H=0;H<i.length;H++){let c=i[H]*Z;for(let H=0;H<Z;H++)n[c++]=g[v++]}return n}))}))}return c._data}_loadFloatAccessorAsync(H,c){return this._loadAccessorAsync(H,c,Float32Array)}_loadIndicesAccessorAsync(H,c){if("SCALAR"!==c.type)throw new Error(`${H}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${H}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const y=X._GetTypedArrayConstructor(`${H}/componentType`,c.componentType);c._data=this._loadAccessorAsync(H,c,y)}else{const y=b.Get(`${H}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>X._GetTypedArray(H,c.componentType,y,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(H){if(H._babylonBuffer)return H._babylonBuffer;const c=this._babylonScene.getEngine();return H._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>new U.d(c,H,!1))),H._babylonBuffer}_loadVertexAccessorAsync(H,c,y){var Z;if(null!==(Z=c._babylonVertexBuffer)&&void 0!==Z&&Z[y])return c._babylonVertexBuffer[y];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const F=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[y]=this._loadFloatAccessorAsync(H,c).then((H=>new U.h(F,H,y,!1)));else{const Z=b.Get(`${H}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[y]=this._loadVertexBufferViewAsync(Z).then((P=>{const S=X._GetNumComponents(H,c.type);return new U.h(F,P,y,!1,void 0,Z.byteStride,void 0,c.byteOffset,S,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[y]}_loadMaterialMetallicRoughnessPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return c&&(c.baseColorFactor?(y.albedoColor=P.e.Tg(c.baseColorFactor),y.alpha=c.baseColorFactor[3]):y.albedoColor=P.e.White(),y.metallic=void 0==c.metallicFactor?1:c.metallicFactor,y.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&Z.push(this.loadTextureInfoAsync(`${H}/baseColorTexture`,c.baseColorTexture,(H=>{H.name=`${y.name} (Base Color)`,y.albedoTexture=H}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${H}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(H=>{H.name=`${y.name} (Metallic Roughness)`,y.metallicTexture=H}))),y.useMetallnessFromMetallicTextureBlue=!0,y.useRoughnessFromMetallicTextureGreen=!0,y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Z).then((()=>{}))}_loadMaterialAsync(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const P=this._extensionsLoadMaterialAsync(H,c,y,Z,F);if(P)return P;c._data=c._data||{};let S=c._data[Z];if(!S){this.logOpen(`${H} ${c.name||""}`);const y=this.createMaterial(H,c,Z);S={babylonMaterial:y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(H,c,y)},c._data[Z]=S,X.AddPointerMetadata(y,H),this._parent.onMaterialLoadedObservable.notifyObservers(y),this.logClose()}return y&&(S.babylonMeshes.push(y),y.jj.addOnce((()=>{const H=S.babylonMeshes.indexOf(y);-1!==H&&S.babylonMeshes.splice(H,1)}))),F(S.babylonMaterial),S.promise.then((()=>S.babylonMaterial))}_createDefaultMaterial(H,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new T(H,this._babylonScene);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.fillMode=c,y.enableSpecularAntiAliasing=!0,y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,y.transparencyMode=T.PBRMATERIAL_OPAQUE,y.metallic=1,y.roughness=1,y}createMaterial(H,c,y){const Z=this._extensionsCreateMaterial(H,c,y);if(Z)return Z;const F=c.name||`material${c.index}`;return this._createDefaultMaterial(F,y)}loadMaterialPropertiesAsync(H,c,y){const Z=this._extensionsLoadMaterialPropertiesAsync(H,c,y);if(Z)return Z;const F=new Array;return F.push(this.loadMaterialBasePropertiesAsync(H,c,y)),c.pbrMetallicRoughness&&F.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${H}/pbrMetallicRoughness`,c.pbrMetallicRoughness,y)),this.loadMaterialAlphaProperties(H,c,y),Promise.all(F).then((()=>{}))}loadMaterialBasePropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.emissiveColor=c.emissiveFactor?P.e.Tg(c.emissiveFactor):new P.e(0,0,0),c.doubleSided&&(y.dh=!1,y.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${H}/normalTexture`,c.normalTexture,(H=>{H.name=`${y.name} (Normal)`,y.bumpTexture=H}))),y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&y.bumpTexture&&(y.bumpTexture.level=c.normalTexture.scale),y.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${H}/occlusionTexture`,c.occlusionTexture,(H=>{H.name=`${y.name} (Occlusion)`,y.ambientTexture=H}))),y.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(y.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&Z.push(this.loadTextureInfoAsync(`${H}/emissiveTexture`,c.emissiveTexture,(H=>{H.name=`${y.name} (Emissive)`,y.emissiveTexture=H}))),Promise.all(Z).then((()=>{}))}loadMaterialAlphaProperties(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":y.transparencyMode=T.PBRMATERIAL_OPAQUE,y.alpha=1;break;case"MASK":y.transparencyMode=T.PBRMATERIAL_ALPHATEST,y.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,y.albedoTexture&&(y.albedoTexture.pe=!0);break;case"BLEND":y.transparencyMode=T.PBRMATERIAL_ALPHABLEND,y.albedoTexture&&(y.albedoTexture.pe=!0,y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${H}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureInfoAsync(H,c,y);if(Z)return Z;if(this.logOpen(`${H}`),c.texCoord>=6)throw new Error(`${H}/texCoord: Invalid value (${c.texCoord})`);const F=b.Get(`${H}/index`,this._gltf.textures,c.index);F._textureInfo=c;const P=this._loadTextureAsync(`/textures/${c.index}`,F,(Z=>{Z.coordinatesIndex=c.texCoord||0,X.AddPointerMetadata(Z,H),this._parent.onTextureLoadedObservable.notifyObservers(Z),y(Z)}));return this.logClose(),P}_loadTextureAsync(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureAsync(H,c,y);if(Z)return Z;this.logOpen(`${H} ${c.name||""}`);const F=void 0==c.sampler?X.DefaultSampler:b.Get(`${H}/sampler`,this._gltf.samplers,c.sampler),P=b.Get(`${H}/source`,this._gltf.images,c.source),S=this._createTextureAsync(H,F,P,y,void 0,!c._textureInfo.nonColorData);return this.logClose(),S}_createTextureAsync(H,c,y){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},P=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;const n=this._loadSampler(`/samplers/${c.index}`,c),O=new Array,a=new Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i={noMipmap:n.noMipMaps,invertY:!1,samplingMode:n.samplingMode,X:()=>{this._disposed||a.resolve()},onError:(c,y)=>{this._disposed||a.reject(new Error(`${H}: ${y&&y.message?y.message:c||"Failed to load texture"}`))},mimeType:y.mimeType,loaderOptions:P,useSRGBBuffer:!!S&&this._parent.useSRGBBuffers},C=new u.d(null,this._babylonScene,i);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(a.promise),O.push(this.loadImageAsync(`/images/${y.index}`,y).then((H=>{const c=y.uri||`${this._fileName}#image${y.index}`,Z=`data:${this._uniqueRootUrl}${c}`;C.updateURL(Z,H);const F=C.getInternalTexture();F&&(F.label=y.name)}))),C.wrapU=n.wrapU,C.wrapV=n.wrapV,F(C),this._parent.useGltfTextureNames&&(C.name=y.name||y.uri||`image${y.index}`),Promise.all(O).then((()=>C))}_loadSampler(H,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:X._GetTextureSamplingMode(H,c),wrapU:X._GetTextureWrapMode(`${H}/wrapS`,c.wrapS),wrapV:X._GetTextureWrapMode(`${H}/wrapT`,c.wrapT)}),c._data}loadImageAsync(H,c){if(!c._data){if(this.logOpen(`${H} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${H}/uri`,c,c.uri);else{const y=b.Get(`${H}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y)}this.logClose()}return c._data}loadUriAsync(H,c,y){const Z=this._extensionsLoadUriAsync(H,c,y);if(Z)return Z;if(!X._ValidateUri(y))throw new Error(`${H}: '${y}' is invalid`);if((0,k.g)(y)){const c=new Uint8Array((0,k.c)(y));return this.log(`${H}: Decoded ${y.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${H}: Loading ${y}`),this._parent.preprocessUrlAsync(this._rootUrl+y).then((c=>new Promise(((Z,F)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${H}: Loaded ${y} (${c.byteLength} bytes)`),Z(new Uint8Array(c)))}),!0,(c=>{F(new k.k(`${H}: Failed to load '${y}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(H,c){H.metadata=H.metadata||{};const y=H._internalMetadata=H._internalMetadata||{},Z=y.Oi=y.Oi||{};(Z.pointers=Z.pointers||[]).push(c)}static _GetTextureWrapMode(H,c){switch(c=void 0==c?10497:c){case 33071:return u.d.CLAMP_ADDRESSMODE;case 33648:return u.d.MIRROR_ADDRESSMODE;case 10497:return u.d.WRAP_ADDRESSMODE;default:return z.d.Warn(`${H}: Invalid value (${c})`),u.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(H,c){const y=void 0==c.magFilter?9729:c.magFilter,Z=void 0==c.minFilter?9987:c.minFilter;if(9729===y)switch(Z){case 9728:return u.d.LINEAR_NEAREST;case 9729:return u.d.LINEAR_LINEAR;case 9984:return u.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return u.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return u.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return u.d.LINEAR_LINEAR_MIPLINEAR;default:return z.d.Warn(`${H}/minFilter: Invalid value (${Z})`),u.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==y&&z.d.Warn(`${H}/magFilter: Invalid value (${y})`),Z){case 9728:return u.d.NEAREST_NEAREST;case 9729:return u.d.NEAREST_LINEAR;case 9984:return u.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return u.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return u.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return u.d.NEAREST_LINEAR_MIPLINEAR;default:return z.d.Warn(`${H}/minFilter: Invalid value (${Z})`),u.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(H,c){switch(c){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${H}: Invalid component type ${c}`)}}static _GetTypedArray(H,c,y,Z,F){const P=y.buffer;Z=y.byteOffset+(Z||0);const S=X._GetTypedArrayConstructor(`${H}/componentType`,c),n=U.h.GetTypeByteLength(c);return Z%n!==0?(z.d.Warn(`${H}: Copying buffer as byte offset (${Z}) is not a multiple of component type byte length (${n})`),new S(P.slice(Z,Z+F*n),0)):new S(P,Z,F)}static _GetNumComponents(H,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${H}: Invalid type (${c})`)}static _ValidateUri(H){return S.c.IsBase64(H)||-1===H.indexOf("..")}static _GetDrawMode(H,c){switch(void 0==c&&(c=4),c){case 0:return Q.c.PointListDrawMode;case 1:return Q.c.LineListDrawMode;case 2:return Q.c.LineLoopDrawMode;case 3:return Q.c.LineStripDrawMode;case 4:return Q.c.TriangleFillMode;case 5:return Q.c.TriangleStripDrawMode;case 6:return Q.c.TriangleFanDrawMode}throw new Error(`${H}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const H=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const y in c._data){const Z=c._data[y];for(const c of Z.babylonMeshes){c.Oj(!0);const y=Z.babylonMaterial;H.push(y.forceCompilationAsync(c)),H.push(y.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(H.push(y.forceCompilationAsync(c,{clipPlane:!0})),H.push(y.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const H=new Array,c=this._babylonScene.lights;for(const y of c){const c=y.getShadowGenerator();c&&H.push(c.forceCompilationAsync())}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(H){for(const c of this._extensions)c.enabled&&H(c)}_applyExtensions(H,c,y){for(const Z of this._extensions)if(Z.enabled){const F=`${Z.name}.${c}`,P=H;P._activeLoaderExtensionFunctions=P._activeLoaderExtensionFunctions||{};const S=P._activeLoaderExtensionFunctions;if(!S[F]){S[F]=!0;try{const H=y(Z);if(H)return H}finally{delete S[F]}}}return null}_extensionsOnLoading(){this._forEachExtensions((H=>H.onLoading&&H.onLoading()))}_extensionsOnReady(){this._forEachExtensions((H=>H.onReady&&H.onReady()))}_extensionsLoadSceneAsync(H,c){return this._applyExtensions(c,"loadScene",(y=>y.loadSceneAsync&&y.loadSceneAsync(H,c)))}_extensionsLoadNodeAsync(H,c,y){return this._applyExtensions(c,"loadNode",(Z=>Z.loadNodeAsync&&Z.loadNodeAsync(H,c,y)))}_extensionsLoadCameraAsync(H,c,y){return this._applyExtensions(c,"loadCamera",(Z=>Z.loadCameraAsync&&Z.loadCameraAsync(H,c,y)))}_extensionsLoadVertexDataAsync(H,c,y){return this._applyExtensions(c,"loadVertexData",(Z=>Z._loadVertexDataAsync&&Z._loadVertexDataAsync(H,c,y)))}_extensionsLoadMeshPrimitiveAsync(H,c,y,Z,F,P){return this._applyExtensions(F,"loadMeshPrimitive",(S=>S._loadMeshPrimitiveAsync&&S._loadMeshPrimitiveAsync(H,c,y,Z,F,P)))}_extensionsLoadMaterialAsync(H,c,y,Z,F){return this._applyExtensions(c,"loadMaterial",(P=>P._loadMaterialAsync&&P._loadMaterialAsync(H,c,y,Z,F)))}_extensionsCreateMaterial(H,c,y){return this._applyExtensions(c,"createMaterial",(Z=>Z.createMaterial&&Z.createMaterial(H,c,y)))}_extensionsLoadMaterialPropertiesAsync(H,c,y){return this._applyExtensions(c,"loadMaterialProperties",(Z=>Z.loadMaterialPropertiesAsync&&Z.loadMaterialPropertiesAsync(H,c,y)))}_extensionsLoadTextureInfoAsync(H,c,y){return this._applyExtensions(c,"loadTextureInfo",(Z=>Z.loadTextureInfoAsync&&Z.loadTextureInfoAsync(H,c,y)))}_extensionsLoadTextureAsync(H,c,y){return this._applyExtensions(c,"loadTexture",(Z=>Z._loadTextureAsync&&Z._loadTextureAsync(H,c,y)))}_extensionsLoadAnimationAsync(H,c){return this._applyExtensions(c,"loadAnimation",(y=>y.loadAnimationAsync&&y.loadAnimationAsync(H,c)))}_extensionsLoadAnimationChannelAsync(H,c,y,Z,F){return this._applyExtensions(y,"loadAnimationChannel",(P=>P._loadAnimationChannelAsync&&P._loadAnimationChannelAsync(H,c,y,Z,F)))}_extensionsLoadSkinAsync(H,c,y){return this._applyExtensions(y,"loadSkin",(Z=>Z._loadSkinAsync&&Z._loadSkinAsync(H,c,y)))}_extensionsLoadUriAsync(H,c,y){return this._applyExtensions(c,"loadUri",(Z=>Z._loadUriAsync&&Z._loadUriAsync(H,c,y)))}_extensionsLoadBufferViewAsync(H,c){return this._applyExtensions(c,"loadBufferView",(y=>y.loadBufferViewAsync&&y.loadBufferViewAsync(H,c)))}_extensionsLoadBufferAsync(H,c,y,Z){return this._applyExtensions(c,"loadBuffer",(F=>F.loadBufferAsync&&F.loadBufferAsync(H,c,y,Z)))}static LoadExtensionAsync(H,c,y,Z){if(!c.extensions)return null;const F=c.extensions[y];return F?Z(`${H}/extensions/${y}`,F):null}static LoadExtraAsync(H,c,y,Z){if(!c.extras)return null;const F=c.extras[y];return F?Z(`${H}/extras/${y}`,F):null}isExtensionUsed(H){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(H)}logOpen(H){this._parent._logOpen(H)}logClose(){this._parent._logClose()}log(H){this._parent._log(H)}startPerformanceCounter(H){this._parent._startPerformanceCounter(H)}endPerformanceCounter(H){this._parent._endPerformanceCounter(H)}}X.DefaultSampler={index:-1},j.b._CreateGLTF2Loader=H=>new X(H);var B=y(11600),Y=y(12343),HH=y(12349);class cH extends HH.d{constructor(H,c,y){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",H),this._texture=H.getEngine().createRawCubeTexture(c,y,Z,F,P,S,n,O)}update(H,c,y,Z){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,H,c,y,Z,F)}updateRGBDAsync(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,Y.j)(this._texture,H,c,y,Z).then((()=>{}))}clone(){return K.e.Clone((()=>{const H=this.va(),c=this._texture,y=new cH(H,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&y.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),y}),this)}}const yH="EXT_lights_image_based";class ZH{constructor(H){this.name=yH,this._loader=H,this.enabled=this._loader.isExtensionUsed(yH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.Oi.extensions;if(H&&H[this.name]){const c=H[this.name];this._lights=c.lights}}loadSceneAsync(H,c){return X.LoadExtensionAsync(H,c,this.name,((y,Z)=>{this._loader._allMaterialsDirtyRequired=!0;const F=new Array;F.push(this._loader.loadSceneAsync(H,c)),this._loader.logOpen(`${y}`);const P=b.Get(`${y}/light`,this._lights,Z.eb);return F.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Z.eb}`,P).then((H=>{this._loader.babylonScene.environmentTexture=H}))),this._loader.logClose(),Promise.all(F).then((()=>{}))}))}_loadLightAsync(H,c){if(!c._loaded){const y=new Array;this._loader.logOpen(`${H}`);const Z=new Array(c.specularImages.length);for(let F=0;F<c.specularImages.length;F++){const P=c.specularImages[F];Z[F]=new Array(P.length);for(let c=0;c<P.length;c++){const S=`${H}/specularImages/${F}/${c}`;this._loader.logOpen(`${S}`);const n=P[c],O=b.Get(S,this._loader.Oi.images,n);y.push(this._loader.loadImageAsync(`/images/${n}`,O).then((H=>{Z[F][c]=H}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(y).then((()=>{const y=new cH(this._loader.babylonScene,null,c.specularImageSize);if(y.name=c.name||"environment",c._babylonTexture=y,void 0!=c.$i&&(y.level=c.$i),c.rotation){let H=F.f.Tg(c.rotation);this._loader.babylonScene.useRightHandedSystem||(H=F.f.Inverse(H)),F.d.FromQuaternionToRef(H,y.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${H}: Irradiance coefficients are missing`);const P=B.e.Tg(c.irradianceCoefficients);P.scaleInPlace(c.$i),P.convertIrradianceToLambertianRadiance();const S=B.f.FromHarmonics(P),n=(Z.length-1)/Math.log2(c.specularImageSize);return y.updateRGBDAsync(Z,S,n)}))}return c._loaded.then((()=>c._babylonTexture))}}w(yH),N(yH,!0,(H=>new ZH(H)));y(12358);const FH="EXT_mesh_gpu_instancing";class PH{constructor(H){this.name=FH,this._loader=H,this.enabled=this._loader.isExtensionUsed(FH)}dispose(){this._loader=null}loadNodeAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((H,Z)=>{this._loader._disableInstancedMesh++;const P=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,y);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return P;const S=new Array;let n=0;const O=c=>{if(void 0==Z.attributes[c])return void S.push(Promise.resolve(null));const y=b.Get(`${H}/attributes/${c}`,this._loader.Oi.accessors,Z.attributes[c]);if(S.push(this._loader._loadFloatAccessorAsync(`/accessors/${y.bufferView}`,y)),0===n)n=y.count;else if(n!==y.count)throw new Error(`${H}/attributes: Instance buffer accessors do not have the same count.`)};return O("TRANSLATION"),O("ROTATION"),O("SCALE"),P.then((H=>Promise.all(S).then((y=>{let[Z,P,S]=y;const O=new Float32Array(16*n);F.h.o[0].be(0,0,0),F.h.Quaternion[0].be(0,0,0,1),F.h.o[1].be(1,1,1);for(let H=0;H<n;++H)Z&&F.n.FromArrayToRef(Z,3*H,F.h.o[0]),P&&F.f.FromArrayToRef(P,4*H,F.h.Quaternion[0]),S&&F.n.FromArrayToRef(S,3*H,F.h.o[1]),F.d.ComposeToRef(F.h.o[1],F.h.Quaternion[0],F.h.o[0],F.h.Matrix[0]),F.h.Matrix[0].copyToArray(O,16*H);for(const H of c._primitiveBabylonMeshes)H.Wb("matrix",O,16,!0);return H}))))}))}}w(FH),N(FH,!0,(H=>new PH(H)));class SH{static get Default(){return SH._Default||(SH._Default=new SH),SH._Default}constructor(){const H=SH.Configuration.decoder;this._decoderModulePromise=S.c.LoadBabylonScriptAsync(H.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(H,c,y,Z,F){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const P=await MeshoptDecoder.decodeGltfBufferAsync(c,y,H,Z,F);return MeshoptDecoder.useWorkers(0),P}))}}SH.Configuration={decoder:{url:`${S.c._DefaultCdnUrl}/meshopt_decoder.js`}},SH._Default=null;const nH="EXT_meshopt_compression";class OH{constructor(H){this.name=nH,this.enabled=H.isExtensionUsed(nH),this._loader=H}dispose(){this._loader=null}loadBufferViewAsync(H,c){return X.LoadExtensionAsync(H,c,this.name,((y,Z)=>{const F=c;if(F._meshOptData)return F._meshOptData;const P=b.Get(`${H}/buffer`,this._loader.Oi.buffers,Z.buffer);return F._meshOptData=this._loader.loadBufferAsync(`/buffers/${P.index}`,P,Z.byteOffset||0,Z.byteLength).then((H=>SH.Default.decodeGltfBufferAsync(H,Z.count,Z.byteStride,Z.mode,Z.filter))),F._meshOptData}))}}w(nH),N(nH,!0,(H=>new OH(H)));const aH="EXT_texture_webp";class iH{constructor(H){this.name=aH,this._loader=H,this.enabled=H.isExtensionUsed(aH)}dispose(){this._loader=null}_loadTextureAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=void 0==c.sampler?X.DefaultSampler:b.Get(`${H}/sampler`,this._loader.Oi.samplers,c.sampler),S=b.Get(`${Z}/source`,this._loader.Oi.images,F.source);return this._loader._createTextureAsync(H,P,S,(H=>{y(H)}),void 0,!c._textureInfo.nonColorData)}))}}w(aH),N(aH,!0,(H=>new iH(H)));const CH="EXT_texture_avif";class gH{constructor(H){this.name=CH,this._loader=H,this.enabled=H.isExtensionUsed(CH)}dispose(){this._loader=null}_loadTextureAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=void 0==c.sampler?X.DefaultSampler:b.Get(`${H}/sampler`,this._loader.Oi.samplers,c.sampler),S=b.Get(`${Z}/source`,this._loader.Oi.images,F.source);return this._loader._createTextureAsync(H,P,S,(H=>{y(H)}),void 0,!c._textureInfo.nonColorData)}))}}w(CH),N(CH,!0,(H=>new gH(H)));var vH=y(12367);const mH="KHR_draco_mesh_compression";class zH{constructor(H){this.name=mH,this.useNormalizedFlagFromAccessor=!0,this._loader=H,this.enabled=vH.e.DecoderAvailable&&this._loader.isExtensionUsed(mH)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${H}: Unsupported mode ${c.mode}`);const P={},S={},n=(H,Z)=>{const n=F.attributes[H];if(void 0!=n&&(y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(Z)&&y._delayInfo.push(Z),P[Z]=n,this.useNormalizedFlagFromAccessor)){const y=b.TryGet(this._loader.Oi.accessors,c.attributes[H]);y&&(S[Z]=y.normalized||!1)}};n("POSITION",U.h.PositionKind),n("NORMAL",U.h.NormalKind),n("TANGENT",U.h.TangentKind),n("TEXCOORD_0",U.h.UVKind),n("TEXCOORD_1",U.h.UV2Kind),n("TEXCOORD_2",U.h.UV3Kind),n("TEXCOORD_3",U.h.UV4Kind),n("TEXCOORD_4",U.h.UV5Kind),n("TEXCOORD_5",U.h.UV6Kind),n("JOINTS_0",U.h.MatricesIndicesKind),n("WEIGHTS_0",U.h.MatricesWeightsKind),n("COLOR_0",U.h.ColorKind);const O=b.Get(Z,this._loader.Oi.bufferViews,F.bufferView);return O._dracoBabylonGeometry||(O._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((c=>(this.dracoCompression||vH.e.Default)._decodeMeshToGeometryForGltfAsync(y.name,this._loader.babylonScene,c,P,S).catch((c=>{throw new Error(`${H}: ${c.message}`)}))))),O._dracoBabylonGeometry}))}}w(mH),N(mH,!0,(H=>new zH(H)));var VH=y(12374),hH=y(11364),QH=y(12336),DH=y(12381);hH.d.AddNodeConstructor("Light_Type_0",((H,c)=>()=>new fH(H,F.n.Zero(),c)));class fH extends DH.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(H){this._shadowAngle=H,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(H){const c=this.needCube();if(this._direction=H,this.needCube()!==c&&this._shadowGenerators){const H=this._shadowGenerators.values();for(let c=H.next();!0!==c.done;c=H.next()){c.value.recreateShadowMap()}}}constructor(H,c,y){super(H,y),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return QH.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(H){if(this.direction)return super.getShadowDirection(H);switch(H){case 0:return new F.n(1,0,0);case 1:return new F.n(-1,0,0);case 2:return new F.n(0,-1,0);case 3:return new F.n(0,1,0);case 4:return new F.n(0,0,1);case 5:return new F.n(0,0,-1)}return F.n.Zero()}_setDefaultShadowProjectionMatrix(H,c,y){const Z=this.va().activeCamera;if(!Z)return;const P=void 0!==this.shadowMinZ?this.shadowMinZ:Z.Wi,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,n=this.va().getEngine().useReverseDepthBuffer;F.d.PerspectiveFovLHToRef(this.shadowAngle,1,n?S:P,n?P:S,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,n)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(H,c){return this.computeTransformedInformation()?H.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):H.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(H,c){H["POINTLIGHT"+c]=!0}}(0,D.b)([(0,f.P)()],fH.prototype,"shadowAngle",null),(0,d.d)("BABYLON.PointLight",fH),hH.d.AddNodeConstructor("Light_Type_2",((H,c)=>()=>new JH(H,F.n.Zero(),F.n.Zero(),0,0,c)));class JH extends DH.b{get angle(){return this._angle}set angle(H){this._angle=H,this._cosHalfAngle=Math.cos(.5*H),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(H){this._innerAngle=H,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(H){this._shadowAngleScale=H,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(H){this._projectionTextureLightNear=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(H){this._projectionTextureLightFar=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(H){this._projectionTextureUpDirection=H,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(H){this._projectionTexture!==H&&(this._projectionTexture=H,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(JH._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):JH._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(H){return void 0!==H.onGeneratedObservable}static _IsTexture(H){return void 0!==H.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(H){this._projectionTextureProjectionLightMatrix=H,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(H,c,y,Z,P,S){super(H,S),this._innerAngle=0,this._projectionTextureMatrix=F.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=F.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=F.n.Zero(),this._projectionTextureViewLightMatrix=F.d.Zero(),this._projectionTextureProjectionLightMatrix=F.d.Zero(),this._projectionTextureScalingMatrix=F.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=y,this.angle=Z,this.exponent=P}getClassName(){return"SpotLight"}getTypeID(){return QH.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(H){super._setDirection(H),this._projectionTextureViewLightDirty=!0}_setPosition(H){super._setPosition(H),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(H,c,y){const Z=this.va().activeCamera;if(!Z)return;this._shadowAngleScale=this._shadowAngleScale||1;const P=this._shadowAngleScale*this._angle,S=void 0!==this.shadowMinZ?this.shadowMinZ:Z.Wi,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,O=this.va().getEngine().useReverseDepthBuffer;F.d.PerspectiveFovLHToRef(P,1,O?n:S,O?S:n,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),F.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const H=this.projectionTextureLightFar,c=this.projectionTextureLightNear,y=H/(H-c),Z=-y*c,P=1/Math.tan(this._angle/2);F.d.FromValuesToRef(P/1,0,0,0,0,P,0,0,0,0,y,1,0,0,Z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof u.d){const H=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;F.d.FromValuesToRef(H,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(H,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),H.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),H.setTexture("projectionLightTexture"+c,this.projectionTexture)),this}transferToEffect(H,c){let y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),y=F.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),y=F.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",y.x,y.y,y.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(H,c){let y;return y=this.computeTransformedInformation()?F.n.Normalize(this.transformedDirection):F.n.Normalize(this.direction),this.va().useRightHandedSystem?H.setFloat3(c,-y.x,-y.y,-y.z):H.setFloat3(c,y.x,y.y,y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(H){const c=this._scene.getEngine(),y=void 0!==this.shadowMinZ?this.shadowMinZ:H.Wi;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?y:this._scene.getEngine().isNDCHalfZRange?0:y}getDepthMaxZ(H){const c=this._scene.getEngine(),y=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ;return c.useReverseDepthBuffer&&c.isNDCHalfZRange?0:y}prepareLightSpecificDefines(H,c){H["SPOTLIGHT"+c]=!0,H["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,D.b)([(0,f.P)()],JH.prototype,"angle",null),(0,D.b)([(0,f.P)()],JH.prototype,"innerAngle",null),(0,D.b)([(0,f.P)()],JH.prototype,"shadowAngleScale",null),(0,D.b)([(0,f.P)()],JH.prototype,"exponent",void 0),(0,D.b)([(0,f.P)()],JH.prototype,"projectionTextureLightNear",null),(0,D.b)([(0,f.P)()],JH.prototype,"projectionTextureLightFar",null),(0,D.b)([(0,f.P)()],JH.prototype,"projectionTextureUpDirection",null),(0,D.b)([(0,f.H)("projectedLightTexture")],JH.prototype,"_projectionTexture",void 0),(0,d.d)("BABYLON.SpotLight",JH);const lH="KHR_lights_punctual";class dH{constructor(H){this.name=lH,this._loader=H,this.enabled=this._loader.isExtensionUsed(lH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.Oi.extensions;if(H&&H[this.name]){const c=H[this.name];this._lights=c.lights,b.Assign(this._lights)}}loadNodeAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,S)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(H,c,(H=>{let c;const n=b.Get(Z,this._lights,S.eb),O=n.name||H.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,n.type){case"directional":{const H=new VH.e(O,F.n.Backward(),this._loader.babylonScene);H.position.ae(0),c=H;break}case"point":c=new fH(O,F.n.Zero(),this._loader.babylonScene);break;case"spot":{const H=new JH(O,F.n.Zero(),F.n.Backward(),0,1,this._loader.babylonScene);H.angle=2*(n.spot&&n.spot.outerConeAngle||Math.PI/4),H.innerAngle=2*(n.spot&&n.spot.innerConeAngle||0),c=H;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Z}: Invalid light type (${n.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,n._babylonLight=c,c.falloffType=QH.b.FALLOFF_GLTF,c.th=n.color?P.e.Tg(n.color):P.e.White(),c.$i=void 0==n.$i?1:n.$i,c.range=void 0==n.range?Number.MAX_VALUE:n.range,c.parent=H,this._loader._babylonLights.push(c),X.AddPointerMetadata(c,Z),y(H)})))))}}w(lH),N(lH,!0,(H=>new dH(H)));const KH="KHR_materials_pbrSpecularGlossiness";class TH{constructor(H){this.name=KH,this.order=200,this._loader=H,this.enabled=this._loader.isExtensionUsed(KH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialBasePropertiesAsync(H,c,y)),P.push(this._loadSpecularGlossinessPropertiesAsync(Z,F,y)),this._loader.loadMaterialAlphaProperties(H,c,y),Promise.all(P).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.metallic=null,y.roughness=null,c.diffuseFactor?(y.albedoColor=P.e.Tg(c.diffuseFactor),y.alpha=c.diffuseFactor[3]):y.albedoColor=P.e.White(),y.reflectivityColor=c.specularFactor?P.e.Tg(c.specularFactor):P.e.White(),y.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTexture`,c.diffuseTexture,(H=>{H.name=`${y.name} (Diffuse)`,y.albedoTexture=H}))),c.specularGlossinessTexture&&(Z.push(this._loader.loadTextureInfoAsync(`${H}/specularGlossinessTexture`,c.specularGlossinessTexture,(H=>{H.name=`${y.name} (Specular Glossiness)`,y.reflectivityTexture=H,y.reflectivityTexture.pe=!0}))),y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Z).then((()=>{}))}}w(KH),N(KH,!0,(H=>new TH(H)));const uH="KHR_materials_unlit";class EH{constructor(H){this.name=uH,this.order=210,this._loader=H,this.enabled=this._loader.isExtensionUsed(uH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,(()=>this._loadUnlitPropertiesAsync(H,c,y)))}_loadUnlitPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;y.unlit=!0;const F=c.pbrMetallicRoughness;return F&&(F.baseColorFactor?(y.albedoColor=P.e.Tg(F.baseColorFactor),y.alpha=F.baseColorFactor[3]):y.albedoColor=P.e.White(),F.baseColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/baseColorTexture`,F.baseColorTexture,(H=>{H.name=`${y.name} (Base Color)`,y.albedoTexture=H})))),c.doubleSided&&(y.dh=!1,y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(H,c,y),Promise.all(Z).then((()=>{}))}}w(uH),N(uH,!0,(H=>new EH(H)));const UH="KHR_materials_clearcoat";class GH{constructor(H){this.name=UH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(UH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadClearCoatPropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadClearCoatPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.clearCoat.isEnabled=!0,y.clearCoat.useRoughnessFromMainTexture=!1,y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?y.clearCoat.$i=c.clearcoatFactor:y.clearCoat.$i=0,c.clearcoatTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatTexture`,c.clearcoatTexture,(H=>{H.name=`${y.name} (ClearCoat)`,y.clearCoat.texture=H}))),void 0!=c.clearcoatRoughnessFactor?y.clearCoat.roughness=c.clearcoatRoughnessFactor:y.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(H=>{H.name=`${y.name} (ClearCoat Roughness)`,y.clearCoat.textureRoughness=H})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(H=>{H.name=`${y.name} (ClearCoat Normal)`,y.clearCoat.bumpTexture=H}))),y.invertNormalMapX=!y.va().useRightHandedSystem,y.invertNormalMapY=y.va().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(y.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(Z).then((()=>{}))}}w(UH),N(UH,!0,(H=>new GH(H)));const pH="KHR_materials_iridescence";class tH{constructor(H){this.name=pH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(pH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadIridescencePropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.iridescence.isEnabled=!0,y.iridescence.$i=c.iridescenceFactor??0,y.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,y.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,y.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceTexture`,c.iridescenceTexture,(H=>{H.name=`${y.name} (Iridescence)`,y.iridescence.texture=H}))),c.iridescenceThicknessTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(H=>{H.name=`${y.name} (Iridescence Thickness)`,y.iridescence.thicknessTexture=H}))),Promise.all(Z).then((()=>{}))}}w(pH),N(pH,!0,(H=>new tH(H)));const oH="KHR_materials_anisotropy";class sH{constructor(H){this.name=oH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(oH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadIridescencePropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.anisotropy.isEnabled=!0,y.anisotropy.$i=c.anisotropyStrength??0,y.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${H}/anisotropyTexture`,c.anisotropyTexture,(H=>{H.name=`${y.name} (Anisotropy Intensity)`,y.anisotropy.texture=H})))),Promise.all(Z).then((()=>{}))}}w(oH),N(oH,!0,(H=>new sH(H)));const qH="KHR_materials_emissive_strength";class IH{constructor(H){this.name=qH,this.order=170,this._loader=H,this.enabled=this._loader.isExtensionUsed(qH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>this._loader.loadMaterialPropertiesAsync(H,c,y).then((()=>{this._loadEmissiveProperties(Z,F,y)}))))}_loadEmissiveProperties(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);void 0!==c.emissiveStrength&&(y.emissiveIntensity=c.emissiveStrength)}}w(qH),N(qH,!0,(H=>new IH(H)));const jH="KHR_materials_sheen";class kH{constructor(H){this.name=jH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(jH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadSheenPropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadSheenPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return y.sheen.isEnabled=!0,y.sheen.$i=1,void 0!=c.sheenColorFactor?y.sheen.color=P.e.Tg(c.sheenColorFactor):y.sheen.color=P.e.Black(),c.sheenColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/sheenColorTexture`,c.sheenColorTexture,(H=>{H.name=`${y.name} (Sheen Color)`,y.sheen.texture=H}))),void 0!==c.sheenRoughnessFactor?y.sheen.roughness=c.sheenRoughnessFactor:y.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${H}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(H=>{H.name=`${y.name} (Sheen Roughness)`,y.sheen.textureRoughness=H})))),y.sheen.albedoScaling=!0,y.sheen.useRoughnessFromMainTexture=!1,Promise.all(Z).then((()=>{}))}}w(jH),N(jH,!0,(H=>new kH(H)));const WH="KHR_materials_specular";class MH{constructor(H){this.name=WH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(WH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadSpecularPropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadSpecularPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const Z=new Array;return void 0!==c.specularFactor&&(y.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(y.metallicReflectanceColor=P.e.Tg(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${H}/specularTexture`,c.specularTexture,(H=>{H.name=`${y.name} (Specular)`,y.metallicReflectanceTexture=H,y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${H}/specularColorTexture`,c.specularColorTexture,(H=>{H.name=`${y.name} (Specular Color)`,y.reflectanceTexture=H}))),Promise.all(Z).then((()=>{}))}}w(WH),N(WH,!0,(H=>new MH(H)));const xH="KHR_materials_ior";class RH{constructor(H){this.name=xH,this.order=180,this._loader=H,this.enabled=this._loader.isExtensionUsed(xH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadIorPropertiesAsync(Z,F,y)),Promise.all(P).then((()=>{}))}))}_loadIorPropertiesAsync(H,c,y){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);return void 0!==c.ior?y.indexOfRefraction=c.ior:y.indexOfRefraction=RH._DEFAULT_IOR,Promise.resolve()}}RH._DEFAULT_IOR=1.5,w(xH),N(xH,!0,(H=>new RH(H)));const AH="KHR_materials_variants";class eH{constructor(H){this.name=AH,this._loader=H,this.enabled=this._loader.isExtensionUsed(AH)}dispose(){this._loader=null}static GetAvailableVariants(H){const c=this._GetExtensionMetadata(H);return c?Object.keys(c.variants):[]}getAvailableVariants(H){return eH.GetAvailableVariants(H)}static SelectVariant(H,c){const y=this._GetExtensionMetadata(H);if(!y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${AH} extension`);const Z=H=>{const c=y.variants[H];if(c)for(const y of c)y.mesh.material=y.material};if(c instanceof Array)for(const F of c)Z(F);else Z(c);y.lastSelected=c}selectVariant(H,c){eH.SelectVariant(H,c)}static Reset(H){const c=this._GetExtensionMetadata(H);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${AH} extension`);for(const y of c.original)y.mesh.material=y.material;c.lastSelected=null}reset(H){eH.Reset(H)}static GetLastSelectedVariant(H){const c=this._GetExtensionMetadata(H);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${AH} extension`);return c.lastSelected}getLastSelectedVariant(H){return eH.GetLastSelectedVariant(H)}static _GetExtensionMetadata(H){var c,y;return(null===H||void 0===H||null===(c=H._internalMetadata)||void 0===c||null===(y=c.Oi)||void 0===y?void 0:y[AH])||null}onLoading(){const H=this._loader.Oi.extensions;if(H&&H[this.name]){const c=H[this.name];this._variants=c.variants}}_loadMeshPrimitiveAsync(H,c,y,Z,F,P){return X.LoadExtensionAsync(H,F,this.name,((S,n)=>{const O=new Array;return O.push(this._loader._loadMeshPrimitiveAsync(H,c,y,Z,F,(c=>{if(P(c),c instanceof t.c){const y=X._GetDrawMode(H,F.mode),Z=this._loader.rootBabylonMesh,P=Z?Z._internalMetadata=Z._internalMetadata||{}:{},a=P.Oi=P.Oi||{},i=a[AH]=a[AH]||{lastSelected:null,original:[],variants:{}};i.original.push({mesh:c,material:c.material});for(let H=0;H<n.mappings.length;++H){const F=n.mappings[H],P=b.Get(`${S}/mappings/${H}/material`,this._loader.Oi.materials,F.material);O.push(this._loader._loadMaterialAsync(`#/materials/${F.material}`,P,c,y,(H=>{for(let y=0;y<F.variants.length;++y){const P=F.variants[y],S=b.Get(`/extensions/${AH}/variants/${P}`,this._variants,P);i.variants[S.name]=i.variants[S.name]||[],i.variants[S.name].push({mesh:c,material:H}),c.onClonedObservable.add((H=>{const y=H;let F=null,P=y;do{if(P=P.parent,!P)return;F=eH._GetExtensionMetadata(P)}while(null===F);if(Z&&F===eH._GetExtensionMetadata(Z)){P._internalMetadata={};for(const H in Z._internalMetadata)P._internalMetadata[H]=Z._internalMetadata[H];P._internalMetadata.Oi=[];for(const H in Z._internalMetadata.Oi)P._internalMetadata.Oi[H]=Z._internalMetadata.Oi[H];P._internalMetadata.Oi[AH]={lastSelected:null,original:[],variants:{}};for(const H of F.original)P._internalMetadata.Oi[AH].original.push({mesh:H.mesh,material:H.material});for(const H in F.variants)if(Object.prototype.hasOwnProperty.call(F.variants,H)){P._internalMetadata.Oi[AH].variants[H]=[];for(const c of F.variants[H])P._internalMetadata.Oi[AH].variants[H].push({mesh:c.mesh,material:c.material})}F=P._internalMetadata.Oi[AH]}for(const Z of F.original)Z.mesh===c&&(Z.mesh=y);for(const Z of F.variants[S.name])Z.mesh===c&&(Z.mesh=y)}))}})))}}}))),Promise.all(O).then((H=>{let[c]=H;return c}))}))}}w(AH),N(AH,!0,(H=>new eH(H)));var rH=y(11646);class NH{}NH.AUTOSAMPLERSUFFIX="Sampler",NH.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",NH.ALPHA_DISABLE=0,NH.ALPHA_ADD=1,NH.ALPHA_COMBINE=2,NH.ALPHA_SUBTRACT=3,NH.ALPHA_MULTIPLY=4,NH.ALPHA_MAXIMIZED=5,NH.ALPHA_ONEONE=6,NH.ALPHA_PREMULTIPLIED=7,NH.ALPHA_PREMULTIPLIED_PORTERDUFF=8,NH.ALPHA_INTERPOLATE=9,NH.ALPHA_SCREENMODE=10,NH.ALPHA_ONEONE_ONEONE=11,NH.ALPHA_ALPHATOCOLOR=12,NH.ALPHA_REVERSEONEMINUS=13,NH.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,NH.ALPHA_ONEONE_ONEZERO=15,NH.ALPHA_EXCLUSION=16,NH.ALPHA_LAYER_ACCUMULATE=17,NH.ALPHA_EQUATION_ADD=0,NH.ALPHA_EQUATION_SUBSTRACT=1,NH.ALPHA_EQUATION_REVERSE_SUBTRACT=2,NH.ALPHA_EQUATION_MAX=3,NH.ALPHA_EQUATION_MIN=4,NH.ALPHA_EQUATION_DARKEN=5,NH.DELAYLOADSTATE_NONE=0,NH.DELAYLOADSTATE_LOADED=1,NH.DELAYLOADSTATE_LOADING=2,NH.DELAYLOADSTATE_NOTLOADED=4,NH.NEVER=512,NH.ALWAYS=519,NH.LESS=513,NH.EQUAL=514,NH.LEQUAL=515,NH.GREATER=516,NH.GEQUAL=518,NH.NOTEQUAL=517,NH.KEEP=7680,NH.ZERO=0,NH.REPLACE=7681,NH.INCR=7682,NH.DECR=7683,NH.INVERT=5386,NH.INCR_WRAP=34055,NH.DECR_WRAP=34056,NH.TEXTURE_CLAMP_ADDRESSMODE=0,NH.TEXTURE_WRAP_ADDRESSMODE=1,NH.TEXTURE_MIRROR_ADDRESSMODE=2,NH.TEXTURE_CREATIONFLAG_STORAGE=1,NH.TEXTUREFORMAT_ALPHA=0,NH.TEXTUREFORMAT_LUMINANCE=1,NH.TEXTUREFORMAT_LUMINANCE_ALPHA=2,NH.TEXTUREFORMAT_RGB=4,NH.TEXTUREFORMAT_RGBA=5,NH.TEXTUREFORMAT_RED=6,NH.TEXTUREFORMAT_R=6,NH.TEXTUREFORMAT_RG=7,NH.TEXTUREFORMAT_RED_INTEGER=8,NH.TEXTUREFORMAT_R_INTEGER=8,NH.TEXTUREFORMAT_RG_INTEGER=9,NH.TEXTUREFORMAT_RGB_INTEGER=10,NH.TEXTUREFORMAT_RGBA_INTEGER=11,NH.TEXTUREFORMAT_BGRA=12,NH.TEXTUREFORMAT_DEPTH24_STENCIL8=13,NH.TEXTUREFORMAT_DEPTH32_FLOAT=14,NH.TEXTUREFORMAT_DEPTH16=15,NH.TEXTUREFORMAT_DEPTH24=16,NH.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,NH.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,NH.TEXTUREFORMAT_STENCIL8=19,NH.TEXTUREFORMAT_UNDEFINED=4294967295,NH.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,NH.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,NH.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,NH.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,NH.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,NH.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,NH.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,NH.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,NH.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,NH.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,NH.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,NH.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,NH.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,NH.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,NH.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,NH.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,NH.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,NH.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,NH.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,NH.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,NH.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,NH.TEXTURETYPE_UNSIGNED_BYTE=0,NH.TEXTURETYPE_UNSIGNED_INT=0,NH.TEXTURETYPE_FLOAT=1,NH.TEXTURETYPE_HALF_FLOAT=2,NH.TEXTURETYPE_BYTE=3,NH.TEXTURETYPE_SHORT=4,NH.TEXTURETYPE_UNSIGNED_SHORT=5,NH.TEXTURETYPE_INT=6,NH.TEXTURETYPE_UNSIGNED_INTEGER=7,NH.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,NH.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,NH.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,NH.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,NH.TEXTURETYPE_UNSIGNED_INT_24_8=12,NH.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,NH.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,NH.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,NH.TEXTURETYPE_UNDEFINED=16,NH.TEXTURE_2D=3553,NH.TEXTURE_2D_ARRAY=35866,NH.TEXTURE_CUBE_MAP=34067,NH.TEXTURE_CUBE_MAP_ARRAY=3735928559,NH.TEXTURE_3D=32879,NH.TEXTURE_NEAREST_SAMPLINGMODE=1,NH.TEXTURE_NEAREST_NEAREST=1,NH.TEXTURE_BILINEAR_SAMPLINGMODE=2,NH.TEXTURE_LINEAR_LINEAR=2,NH.TEXTURE_TRILINEAR_SAMPLINGMODE=3,NH.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,NH.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,NH.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,NH.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,NH.TEXTURE_NEAREST_LINEAR=7,NH.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,NH.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,NH.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,NH.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,NH.TEXTURE_LINEAR_NEAREST=12,NH.TEXTURE_EXPLICIT_MODE=0,NH.TEXTURE_SPHERICAL_MODE=1,NH.TEXTURE_PLANAR_MODE=2,NH.TEXTURE_CUBIC_MODE=3,NH.TEXTURE_PROJECTION_MODE=4,NH.TEXTURE_SKYBOX_MODE=5,NH.TEXTURE_INVCUBIC_MODE=6,NH.TEXTURE_EQUIRECTANGULAR_MODE=7,NH.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,NH.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,NH.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,NH.TEXTURE_FILTERING_QUALITY_HIGH=64,NH.TEXTURE_FILTERING_QUALITY_MEDIUM=16,NH.TEXTURE_FILTERING_QUALITY_LOW=8,NH.SCALEMODE_FLOOR=1,NH.SCALEMODE_NEAREST=2,NH.SCALEMODE_CEILING=3,NH.MATERIAL_TextureDirtyFlag=1,NH.MATERIAL_LightDirtyFlag=2,NH.MATERIAL_FresnelDirtyFlag=4,NH.MATERIAL_AttributesDirtyFlag=8,NH.MATERIAL_MiscDirtyFlag=16,NH.MATERIAL_PrePassDirtyFlag=32,NH.MATERIAL_AllDirtyFlag=63,NH.MATERIAL_TriangleFillMode=0,NH.MATERIAL_WireFrameFillMode=1,NH.MATERIAL_PointFillMode=2,NH.MATERIAL_PointListDrawMode=3,NH.MATERIAL_LineListDrawMode=4,NH.MATERIAL_LineLoopDrawMode=5,NH.MATERIAL_LineStripDrawMode=6,NH.MATERIAL_TriangleStripDrawMode=7,NH.MATERIAL_TriangleFanDrawMode=8,NH.MATERIAL_ClockWiseSideOrientation=0,NH.MATERIAL_CounterClockWiseSideOrientation=1,NH.ACTION_NothingTrigger=0,NH.ACTION_OnPickTrigger=1,NH.ACTION_OnLeftPickTrigger=2,NH.ACTION_OnRightPickTrigger=3,NH.ACTION_OnCenterPickTrigger=4,NH.ACTION_OnPickDownTrigger=5,NH.ACTION_OnDoublePickTrigger=6,NH.ACTION_OnPickUpTrigger=7,NH.ACTION_OnPickOutTrigger=16,NH.ACTION_OnLongPressTrigger=8,NH.ACTION_OnPointerOverTrigger=9,NH.ACTION_OnPointerOutTrigger=10,NH.ACTION_OnEveryFrameTrigger=11,NH.ACTION_OnIntersectionEnterTrigger=12,NH.ACTION_OnIntersectionExitTrigger=13,NH.ACTION_OnKeyDownTrigger=14,NH.ACTION_OnKeyUpTrigger=15,NH.PARTICLES_BILLBOARDMODE_Y=2,NH.PARTICLES_BILLBOARDMODE_ALL=7,NH.PARTICLES_BILLBOARDMODE_STRETCHED=8,NH.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,NH.MESHES_CULLINGSTRATEGY_STANDARD=0,NH.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,NH.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,NH.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,NH.SCENELOADER_NO_LOGGING=0,NH.SCENELOADER_MINIMAL_LOGGING=1,NH.SCENELOADER_SUMMARY_LOGGING=2,NH.SCENELOADER_DETAILED_LOGGING=3,NH.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,NH.PREPASS_POSITION_TEXTURE_TYPE=1,NH.PREPASS_VELOCITY_TEXTURE_TYPE=2,NH.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,NH.PREPASS_COLOR_TEXTURE_TYPE=4,NH.PREPASS_DEPTH_TEXTURE_TYPE=5,NH.PREPASS_NORMAL_TEXTURE_TYPE=6,NH.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,NH.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,NH.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,NH.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,NH.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,NH.PREPASS_ALBEDO_TEXTURE_TYPE=12,NH.BUFFER_CREATIONFLAG_READ=1,NH.BUFFER_CREATIONFLAG_WRITE=2,NH.BUFFER_CREATIONFLAG_READWRITE=3,NH.BUFFER_CREATIONFLAG_UNIFORM=4,NH.BUFFER_CREATIONFLAG_VERTEX=8,NH.BUFFER_CREATIONFLAG_INDEX=16,NH.BUFFER_CREATIONFLAG_STORAGE=32,NH.BUFFER_CREATIONFLAG_INDIRECT=64,NH.RENDERPASS_MAIN=0,NH.INPUT_ALT_KEY=18,NH.INPUT_CTRL_KEY=17,NH.INPUT_META_KEY1=91,NH.INPUT_META_KEY2=92,NH.INPUT_META_KEY3=93,NH.INPUT_SHIFT_KEY=16,NH.SNAPSHOTRENDERING_STANDARD=0,NH.SNAPSHOTRENDERING_FAST=1,NH.PERSPECTIVE_CAMERA=0,NH.ORTHOGRAPHIC_CAMERA=1,NH.FOVMODE_VERTICAL_FIXED=0,NH.FOVMODE_HORIZONTAL_FIXED=1,NH.RIG_MODE_NONE=0,NH.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,NH.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,NH.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,NH.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,NH.RIG_MODE_STEREOSCOPIC_INTERLACED=14,NH.RIG_MODE_VR=20,NH.RIG_MODE_CUSTOM=22,NH.MAX_SUPPORTED_UV_SETS=6,NH.GL_ALPHA_EQUATION_ADD=32774,NH.GL_ALPHA_EQUATION_MIN=32775,NH.GL_ALPHA_EQUATION_MAX=32776,NH.GL_ALPHA_EQUATION_SUBTRACT=32778,NH.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,NH.GL_ALPHA_FUNCTION_SRC=768,NH.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,NH.GL_ALPHA_FUNCTION_SRC_ALPHA=770,NH.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,NH.GL_ALPHA_FUNCTION_DST_ALPHA=772,NH.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,NH.GL_ALPHA_FUNCTION_DST_COLOR=774,NH.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,NH.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,NH.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,NH.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,NH.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,NH.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,NH.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,NH.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,NH.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,NH.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,NH.SnippetUrl="https://snippet.babylonjs.com",NH.FOGMODE_NONE=0,NH.FOGMODE_EXP=1,NH.FOGMODE_EXP2=2,NH.FOGMODE_LINEAR=3,NH.BYTE=5120,NH.UNSIGNED_BYTE=5121,NH.SHORT=5122,NH.UNSIGNED_SHORT=5123,NH.INT=5124,NH.UNSIGNED_INT=5125,NH.FLOAT=5126,NH.PositionKind="position",NH.NormalKind="k",NH.TangentKind="tangent",NH.UVKind="uv",NH.UV2Kind="uv2",NH.UV3Kind="uv3",NH.UV4Kind="uv4",NH.UV5Kind="uv5",NH.UV6Kind="uv6",NH.ColorKind="color",NH.ColorInstanceKind="instanceColor",NH.MatricesIndicesKind="matricesIndices",NH.MatricesWeightsKind="matricesWeights",NH.MatricesIndicesExtraKind="matricesIndicesExtra",NH.MatricesWeightsExtraKind="matricesWeightsExtra";class wH{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:NH.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(H,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...wH._GetDefaultOptions(),...H},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new i.e,this._scene.jj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(H){if(!Object.keys(H).filter((c=>this._options[c]!==H[c])).length)return;const c={...this._options,...H},y=this._options;this._options=c,c.renderSize===y.renderSize&&c.renderTargetTextureType===y.renderTargetTextureType&&c.generateMipmaps===y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(H){return!!H&&!!(H instanceof T&&H.subSurface.isRefractionEnabled)}_addMesh(H){this._materialObservers[H.uniqueId]=H.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),S.c.SetImmediate((()=>{this._shouldRenderAsTransmission(H.material)?(H.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(H)&&this._transparentMeshesCache.push(H)):-1===this._opaqueMeshesCache.indexOf(H)&&this._opaqueMeshesCache.push(H)}))}_removeMesh(H){H.onMaterialChangedObservable.remove(this._materialObservers[H.uniqueId]),delete this._materialObservers[H.uniqueId];let c=this._transparentMeshesCache.indexOf(H);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(H),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(H){const c=this._transparentMeshesCache.indexOf(H),y=this._opaqueMeshesCache.indexOf(H);this._shouldRenderAsTransmission(H.material)?(H.material instanceof T&&(H.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==y?(this._opaqueMeshesCache.splice(y,1),this._transparentMeshesCache.push(H)):-1===c&&this._transparentMeshesCache.push(H)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(H)):-1===y&&this._opaqueMeshesCache.push(H)}_isRenderTargetValid(){var H;return null!==(null===(H=this._opaqueRenderTarget)||void 0===H?void 0:H.getInternalTexture())}_setupRenderTargets(){var H;let c,y;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new rH.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(H=this._options.clearColor)||void 0===H?void 0:H.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((H=>{y=this._scene.environmentIntensity,this._scene.environmentIntensity=1,c=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?H.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(H.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=y,this._scene.imageProcessingConfiguration._applyByPostProcess=c})),this._transparentMeshesCache.forEach((H=>{this._shouldRenderAsTransmission(H.material)&&(H.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const LH="KHR_materials_transmission";class bH{constructor(H){this.name=LH,this.order=175,this._loader=H,this.enabled=this._loader.isExtensionUsed(LH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadTransparentPropertiesAsync(Z,c,y,F)),Promise.all(P).then((()=>{}))}))}_loadTransparentPropertiesAsync(H,c,y,Z){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const F=y;if(F.subSurface.isRefractionEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.useAlbedoToTintRefraction=!0,void 0===Z.transmissionFactor)return F.subSurface.refractionIntensity=0,F.subSurface.isRefractionEnabled=!1,Promise.resolve();{var P;F.subSurface.refractionIntensity=Z.transmissionFactor;const H=F.va();if(F.subSurface.refractionIntensity&&!H._transmissionHelper)new wH({},F.va());else if(F.subSurface.refractionIntensity&&(null===(P=H._transmissionHelper)||void 0===P||!P._isRenderTargetValid())){var S;null===(S=H._transmissionHelper)||void 0===S||S._setupRenderTargets()}}return F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,Z.transmissionTexture?(Z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/transmissionTexture`,Z.transmissionTexture,void 0).then((H=>{H.name=`${y.name} (Transmission)`,F.subSurface.refractionIntensityTexture=H,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(LH),N(LH,!0,(H=>new bH(H)));const XH="KHR_materials_diffuse_transmission";class BH{constructor(H){this.name=XH,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(XH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadTranslucentPropertiesAsync(Z,c,y,F)),Promise.all(P).then((()=>{}))}))}_loadTranslucentPropertiesAsync(H,c,y,Z){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);const F=y;if(F.subSurface.isTranslucencyEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,F.subSurface.useAlbedoToTintTranslucency=!1,void 0===Z.diffuseTransmissionFactor)return F.subSurface.translucencyIntensity=0,F.subSurface.isTranslucencyEnabled=!1,Promise.resolve();F.subSurface.translucencyIntensity=Z.diffuseTransmissionFactor;const S=new Array;return F.subSurface.useGltfStyleTextures=!0,Z.diffuseTransmissionTexture&&(Z.diffuseTransmissionTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionTexture`,Z.diffuseTransmissionTexture).then((H=>{H.name=`${y.name} (Diffuse Transmission)`,F.subSurface.translucencyIntensityTexture=H})))),void 0!==Z.diffuseTransmissionColorFactor?F.subSurface.translucencyColor=P.e.Tg(Z.diffuseTransmissionColorFactor):F.subSurface.translucencyColor=P.e.White(),Z.diffuseTransmissionColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionColorTexture`,Z.diffuseTransmissionColorTexture).then((H=>{H.name=`${y.name} (Diffuse Transmission Color)`,F.subSurface.translucencyColorTexture=H}))),Promise.all(S).then((()=>{}))}}w(XH),N(XH,!0,(H=>new BH(H)));const YH="KHR_materials_volume";class Hc{constructor(H){this.name=YH,this.order=173,this._loader=H,this.enabled=this._loader.isExtensionUsed(YH),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadVolumePropertiesAsync(Z,c,y,F)),Promise.all(P).then((()=>{}))}))}_loadVolumePropertiesAsync(H,c,y,Z){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);if(!y.subSurface.isRefractionEnabled&&!y.subSurface.isTranslucencyEnabled||!Z.thicknessFactor)return Promise.resolve();y.subSurface.volumeIndexOfRefraction=y.indexOfRefraction;const F=void 0!==Z.attenuationDistance?Z.attenuationDistance:Number.MAX_VALUE;return y.subSurface.tintColorAtDistance=F,void 0!==Z.attenuationColor&&3==Z.attenuationColor.length&&y.subSurface.tintColor.be(Z.attenuationColor[0],Z.attenuationColor[1],Z.attenuationColor[2]),y.subSurface.minimumThickness=0,y.subSurface.maximumThickness=Z.thicknessFactor,y.subSurface.useThicknessAsDepth=!0,Z.thicknessTexture?(Z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/thicknessTexture`,Z.thicknessTexture).then((H=>{H.name=`${y.name} (Thickness)`,y.subSurface.thicknessTexture=H,y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(YH),N(YH,!0,(H=>new Hc(H)));const cc="KHR_materials_dispersion";class yc{constructor(H){this.name=cc,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(cc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(H,c,y)),P.push(this._loadDispersionPropertiesAsync(Z,c,y,F)),Promise.all(P).then((()=>{}))}))}_loadDispersionPropertiesAsync(H,c,y,Z){if(!(y instanceof T))throw new Error(`${H}: Material type not supported`);return y.subSurface.isRefractionEnabled&&Z.dispersion?(y.subSurface.isDispersionEnabled=!0,y.subSurface.dispersion=Z.dispersion,Promise.resolve()):Promise.resolve()}}w(cc),N(cc,!0,(H=>new yc(H)));const Zc="KHR_mesh_quantization";class Fc{constructor(H){this.name=Zc,this.enabled=H.isExtensionUsed(Zc)}dispose(){}}w(Zc),N(Zc,!0,(H=>new Fc(H)));const Pc="KHR_texture_basisu";class Sc{constructor(H){this.name=Pc,this._loader=H,this.enabled=H.isExtensionUsed(Pc)}dispose(){this._loader=null}_loadTextureAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>{const P=void 0==c.sampler?X.DefaultSampler:b.Get(`${H}/sampler`,this._loader.Oi.samplers,c.sampler),S=b.Get(`${Z}/source`,this._loader.Oi.images,F.source);return this._loader._createTextureAsync(H,P,S,(H=>{y(H)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}w(Pc),N(Pc,!0,(H=>new Sc(H)));const nc="KHR_texture_transform";class Oc{constructor(H){this.name=nc,this._loader=H,this.enabled=this._loader.isExtensionUsed(nc)}dispose(){this._loader=null}loadTextureInfoAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((Z,F)=>this._loader.loadTextureInfoAsync(H,c,(H=>{if(!(H instanceof u.d))throw new Error(`${Z}: Texture type not supported`);F.offset&&(H.uOffset=F.offset[0],H.vOffset=F.offset[1]),H.uRotationCenter=0,H.vRotationCenter=0,F.rotation&&(H.wAng=-F.rotation),F.scale&&(H.uScale=F.scale[0],H.vScale=F.scale[1]),void 0!=F.texCoord&&(H.coordinatesIndex=F.texCoord),y(H)}))))}}w(nc),N(nc,!0,(H=>new Oc(H)));const ac="KHR_xmp_json_ld";class ic{constructor(H){this.name=ac,this.order=100,this._loader=H,this.enabled=this._loader.isExtensionUsed(ac)}dispose(){this._loader=null}onLoading(){var H,c,y;if(null===this._loader.rootBabylonMesh)return;const Z=null===(H=this._loader.Oi.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld,F=null===(c=this._loader.Oi.asset)||void 0===c||null===(y=c.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld;if(Z&&F){const H=+F.packet;Z.packets&&H<Z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Z.packets[H])}}}function Cc(H,c,y,Z){return P.e.Tg(c,y).scale(Z)}function gc(H,c,y,Z){return c[y]*Z}function vc(H,c,y,Z){return-c[y]*Z}function mc(H,c,y,Z){return c[y+1]*Z}function zc(H,c,y,Z){return c[y]*Z*2}function Vc(H){return{scale:[new Qc(g.c.ANIMATIONTYPE_FLOAT,`${H}.uScale`,gc,(()=>2)),new Qc(g.c.ANIMATIONTYPE_FLOAT,`${H}.vScale`,mc,(()=>2))],offset:[new Qc(g.c.ANIMATIONTYPE_FLOAT,`${H}.uOffset`,gc,(()=>2)),new Qc(g.c.ANIMATIONTYPE_FLOAT,`${H}.vOffset`,mc,(()=>2))],rotation:[new Qc(g.c.ANIMATIONTYPE_FLOAT,`${H}.wAng`,vc,(()=>1))]}}w(ac),N(ac,!0,(H=>new ic(H)));class hc extends x{buildAnimations(H,c,y,Z,F){F(H._babylonCamera,this._buildAnimation(c,y,Z))}}class Qc extends x{buildAnimations(H,c,y,Z,F){for(const P in H._data)F(H._data[P].babylonMaterial,this._buildAnimation(c,y,Z))}}class Dc extends x{buildAnimations(H,c,y,Z,F){F(H._babylonLight,this._buildAnimation(c,y,Z))}}const fc={__array__:{__target__:!0,...A}},Jc={__array__:{__target__:!0,orthographic:{xmag:[new hc(g.c.ANIMATIONTYPE_FLOAT,"orthoLeft",vc,(()=>1)),new hc(g.c.ANIMATIONTYPE_FLOAT,"orthoRight",mc,(()=>1))],ymag:[new hc(g.c.ANIMATIONTYPE_FLOAT,"orthoBottom",vc,(()=>1)),new hc(g.c.ANIMATIONTYPE_FLOAT,"orthoTop",mc,(()=>1))],zfar:[new hc(g.c.ANIMATIONTYPE_FLOAT,"maxZ",gc,(()=>1))],znear:[new hc(g.c.ANIMATIONTYPE_FLOAT,"Wi",gc,(()=>1))]},perspective:{yfov:[new hc(g.c.ANIMATIONTYPE_FLOAT,"fov",gc,(()=>1))],zfar:[new hc(g.c.ANIMATIONTYPE_FLOAT,"maxZ",gc,(()=>1))],znear:[new hc(g.c.ANIMATIONTYPE_FLOAT,"Wi",gc,(()=>1))]}}},lc={nodes:fc,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"albedoColor",Cc,(()=>4)),new Qc(g.c.ANIMATIONTYPE_FLOAT,"alpha",(function(H,c,y,Z){return c[y+3]*Z}),(()=>4))],metallicFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"metallic",gc,(()=>1))],roughnessFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"roughness",gc,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Vc("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Vc("metallicTexture")}}},emissiveFactor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Cc,(()=>3))],normalTexture:{scale:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",gc,(()=>1))],extensions:{KHR_texture_transform:Vc("bumpTexture")}},occlusionTexture:{strength:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",gc,(()=>1))],extensions:{KHR_texture_transform:Vc("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Vc("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",gc,(()=>1))],anisotropyRotation:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",gc,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Vc("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",gc,(()=>1))],clearcoatRoughnessFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",gc,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Vc("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",gc,(()=>1))],extensions:{KHR_texture_transform:Vc("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Vc("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",gc,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",gc,(()=>1))]},KHR_materials_ior:{ior:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",gc,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",gc,(()=>1))],iridescenceIor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",gc,(()=>1))],iridescenceThicknessMinimum:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",gc,(()=>1))],iridescenceThicknessMaximum:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",gc,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Vc("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Vc("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"sheen.color",Cc,(()=>3))],sheenRoughnessFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",gc,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Vc("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Vc("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",gc,(()=>1))],specularColorFactor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Cc,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Vc("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Vc("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",gc,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Vc("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Cc,(()=>3))],attenuationDistance:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",gc,(()=>1))],thicknessFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",gc,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Vc("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Qc(g.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",gc,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Vc("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Qc(g.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Cc,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Vc("subSurface.translucencyColorTexture")}}}}}},cameras:Jc,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Dc(g.c.ANIMATIONTYPE_COLOR3,"diffuse",Cc,(()=>3))],$i:[new Dc(g.c.ANIMATIONTYPE_FLOAT,"intensity",gc,(()=>1))],range:[new Dc(g.c.ANIMATIONTYPE_FLOAT,"range",gc,(()=>1))],spot:{innerConeAngle:[new Dc(g.c.ANIMATIONTYPE_FLOAT,"innerAngle",zc,(()=>1))],outerConeAngle:[new Dc(g.c.ANIMATIONTYPE_FLOAT,"angle",zc,(()=>1))]}}}}}};class dc{constructor(H,c){this._gltf=H,this._infoTree=c}convert(H){let c,y=this._gltf,Z=this._infoTree;if(!H.startsWith("/"))throw new Error("Path must start with a /");const F=H.split("/");F.shift();for(const P of F){if(Z.__array__)Z=Z.__array__;else if(Z=Z[P],!Z)throw new Error(`Path ${H} is invalid`);if(void 0===y)throw new Error(`Path ${H} is invalid`);y=y[P],Z.__target__&&(c=y)}return{object:c,info:Z}}}const Kc="KHR_animation_pointer";class Tc extends dc{constructor(H){super(H,lc)}}class uc{constructor(H){this.name=Kc,this._loader=H,this._pathToObjectConverter=new Tc(this._loader.Oi)}get enabled(){return this._loader.isExtensionUsed(Kc)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(H,c,y,Z,F){var P;const S=null===(P=Z.target.extensions)||void 0===P?void 0:P.KHR_animation_pointer;if(!S||!this._pathToObjectConverter)return null;"pointer"!==Z.target.path&&z.d.Warn(`${H}/target/path: Value (${Z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Z.target.node&&z.d.Warn(`${H}/target/node: Value (${Z.target.node}) must not be present when using the ${this.name} extension`);const n=`${H}/extensions/${this.name}`,O=S.pointer;if(!O)throw new Error(`${n}: Pointer is missing`);try{const P=this._pathToObjectConverter.convert(O);return this._loader._loadAnimationChannelFromTargetInfoAsync(H,c,y,Z,P,F)}catch(a){return z.d.Warn(`${n}/pointer: Invalid pointer (${O}) skipped`),null}}}w(Kc),N(Kc,!0,(H=>new uc(H)));class Ec{constructor(H,c,y){this.frame=H,this.action=c,this.onlyOnce=y,this.isDone=!1}_clone(){return new Ec(this.frame,this.action,this.onlyOnce)}}var Uc=y(10798),Gc=y(10850);class pc{get loop(){return this._loop}set loop(H){H!==this._loop&&(this._loop=H,this.updateOptions({loop:H}))}get currentTime(){var H;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.audioContext&&(this.isPlaying||this.isPaused)){const H=this.isPaused?0:Gc.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+H}return 0}get spatialSound(){return this._spatialSound}set spatialSound(H){if(H==this._spatialSound)return;const c=this.isPlaying;this.pause(),H?(this._spatialSound=H,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(H,c,y){var Z;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new i.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=F.n.Zero(),this._localDirection=new F.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=H,y=y||m.b.LastCreatedScene)if(this._scene=y,pc._SceneComponentInitialization(y),this._readyToPlayCallback=P,this._customAttenuationFunction=(H,c,y,Z,F)=>c<y?H*(1-c/y):0,n&&(this.autoplay=n.autoplay||!1,this._loop=n.loop||!1,void 0!==n.volume&&(this._volume=n.volume),this._spatialSound=n.spatialSound??!1,this.maxDistance=n.maxDistance??100,this.useCustomAttenuation=n.useCustomAttenuation??!1,this.rolloffFactor=n.rolloffFactor||1,this.refDistance=n.refDistance||1,this.distanceModel=n.distanceModel||"linear",this._playbackRate=n.playbackRate||1,this._streaming=n.streaming??!1,this._length=n.length,this._offset=n.offset),null!==(Z=Gc.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Gc.e.audioEngine.audioContext){this._soundGain=Gc.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let H=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let y=[],Z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gc.e.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gc.e.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(Z=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":y.push(c);case"Array":0===y.length&&(y=c);for(let H=0;H<y.length;H++){const c=y[H];if(Z=n&&n.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&Gc.e.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&Gc.e.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),Z){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,S.c.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(H=>{this._soundLoaded(H)}),void 0,!0,!0,(H=>{H&&z.d.Error("XHR "+H.status+" error on: "+c+"."),z.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:H=!1}H?Z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):z.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(O){z.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Gc.e.audioEngine&&!Gc.e.audioEngine.WarnedWebAudioUnsupported&&(z.d.Error("Web Audio is not supported by your browser."),Gc.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var H;null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(H){var c;null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=H,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(H){var c;null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.audioContext&&Gc.e.audioEngine.audioContext.decodeAudioData(H,(H=>{this._audioBufferLoaded(H)}),(H=>{z.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+H)}))}setAudioBuffer(H){var c;null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=H,this._isReadyToPlay=!0)}updateOptions(H){H&&(this.loop=H.loop??this.loop,this.maxDistance=H.maxDistance??this.maxDistance,this.useCustomAttenuation=H.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=H.rolloffFactor??this.rolloffFactor,this.refDistance=H.refDistance??this.refDistance,this.distanceModel=H.distanceModel??this.distanceModel,this._playbackRate=H.playbackRate??this._playbackRate,this._length=H.length??void 0,this.spatialSound=H.spatialSound??this._spatialSound,this._setOffset(H.offset??void 0),this.setVolume(H.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var H;null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&Gc.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Gc.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var H;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(H=this._soundPanner)||void 0===H||H.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var H;null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(H){var c;null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(H),this._isOutputConnected=!0)}setDirectionalCone(H,c,y){c<H?z.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=H,this._coneOuterAngle=c,this._coneOuterGain=y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!=this._coneInnerAngle){var c;if(this._coneOuterAngle<H)return void z.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H,null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!=this._coneOuterAngle){var c;if(H<this._coneInnerAngle)return void z.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H,null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(H){var c;H.equals(this._position)||(this._position.p(H),null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(H){var c;this._localDirection=H,null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const H=this._connectedTransformNode.getWorldMatrix(),c=F.n.TransformNormal(this._localDirection,H);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var H;if(null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const H=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Rc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,H,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(H){this._customAttenuationFunction=H}play(H,c,y){var Z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Z=Gc.e.audioEngine)&&void 0!==Z&&Z.audioContext)try{var F,P;this._clearTimeoutsAndObservers();let Z=H?(null===(F=Gc.e.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+H:null===(P=Gc.e.audioEngine)||void 0===P?void 0:P.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Gc.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const H=()=>{var y;if(null!==(y=Gc.e.audioEngine)&&void 0!==y&&y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const y=this._htmlAudioElement.play();void 0!==y&&y.catch((()=>{var c,y;(null===(c=Gc.e.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(y=Gc.e.audioEngine)||void 0===y?void 0:y.onAudioUnlockedObservable.addOnce((()=>{H()})))}))}else{var Z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Z=Gc.e.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{H()}))}};H()}}else{var S;const F=()=>{var F;if(null!==(F=Gc.e.audioEngine)&&void 0!==F&&F.audioContext){var P;if(y=y||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const H=this._soundSource;H.onended=()=>{H.disconnect()}}if(this._soundSource=null===(P=Gc.e.audioEngine)||void 0===P?void 0:P.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var S;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==y&&(this._soundSource.loopEnd=(0|c)+y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Z=H?(null===(S=Gc.e.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+H:Gc.e.audioEngine.audioContext.currentTime;const F=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Z,F,this.loop?void 0:y)}}};"suspended"===(null===(S=Gc.e.audioEngine)||void 0===S?void 0:S.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var H;"suspended"===(null===(H=Gc.e.audioEngine)||void 0===H?void 0:H.audioContext.state)?(Gc.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Gc.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{F()})))):F()}),500):F()}this._startTime=Z,this.isPlaying=!0,this.isPaused=!1}catch(n){z.d.Error("Error while trying to play audio: "+this.name+", "+n.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(H){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(y=this._streamingSource)||void 0===y||y.disconnect();this.isPlaying=!1}else if(null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=H?Gc.e.audioEngine.audioContext.currentTime+H:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Gc.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(H,c){var y;null!==(y=Gc.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._soundGain&&(c&&Gc.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Gc.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Gc.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(H,Gc.e.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=H),this._volume=H}setPlaybackRate(H){this._playbackRate=H,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(H){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=H,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=H=>this._onRegisterAfterWorldMatrixUpdate(H),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(H){var c;if(H.getBoundingInfo){const c=H.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(H.absolutePosition);null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const H=()=>{this._isReadyToPlay?(y._audioBuffer=this.getAudioBuffer(),y._isReadyToPlay=!0,y.autoplay&&y.play(0,this._offset,this._length)):setTimeout(H,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},y=new pc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&y.setAttenuationFunction(this._customAttenuationFunction),y.setPosition(this._position),y.setPlaybackRate(this._playbackRate),H(),y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const H={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(H.connectedMeshId=this._connectedTransformNode.id),H.position=this._position.ij(),H.refDistance=this.refDistance,H.distanceModel=this.distanceModel,H.isDirectional=this._isDirectional,H.localDirectionToMesh=this._localDirection.ij(),H.coneInnerAngle=this._coneInnerAngle,H.coneOuterAngle=this._coneOuterAngle,H.coneOuterGain=this._coneOuterGain),H}static Parse(H,c,y,Z){const P=H.name;let S;S=H.url?y+H.url:y+P;const n={autoplay:H.autoplay,loop:H.loop,volume:H.volume,spatialSound:H.spatialSound,maxDistance:H.maxDistance,rolloffFactor:H.rolloffFactor,refDistance:H.refDistance,distanceModel:H.distanceModel,playbackRate:H.playbackRate};let O;if(Z){const H=()=>{Z._isReadyToPlay?(O._audioBuffer=Z.getAudioBuffer(),O._isReadyToPlay=!0,O.autoplay&&O.play(0,O._offset,O._length)):setTimeout(H,300)};O=new pc(P,new ArrayBuffer(0),c,null,n),H()}else O=new pc(P,S,c,(()=>{c.removePendingData(O)}),n),c.addPendingData(O);if(H.position){const c=F.n.Tg(H.position);O.setPosition(c)}if(H.isDirectional&&(O.setDirectionalCone(H.coneInnerAngle||360,H.coneOuterAngle||360,H.coneOuterGain||0),H.localDirectionToMesh)){const c=F.n.Tg(H.localDirectionToMesh);O.setLocalDirectionToMesh(c)}if(H.connectedMeshId){const y=c.getMeshById(H.connectedMeshId);y&&O.attachToMesh(y)}return H.metadata&&(O.metadata=H.metadata),O}_setOffset(H){this._offset!==H&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=H)}_clearTimeoutsAndObservers(){var H;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(H=Gc.e.audioEngine)||void 0===H||H.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}pc._SceneComponentInitialization=H=>{throw(0,Uc.b)("AudioSceneComponent")},(0,d.d)("BABYLON.Sound",pc);class tc{constructor(H,c,y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==y.length)throw new Error("Sounds length does not equal weights length");this.loop=H,this._weights=y;let Z=0;for(const P of y)Z+=P;const F=Z>0?1/Z:0;for(let P=0;P<this._weights.length;P++)this._weights[P]*=F;this._sounds=c;for(const P of this._sounds)P.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!==this._coneInnerAngle){if(this._coneOuterAngle<H)return void z.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H;for(const c of this._sounds)c.directionalConeInnerAngle=H}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!==this._coneOuterAngle){if(H<this._coneInnerAngle)return void z.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H;for(const c of this._sounds)c.directionalConeOuterAngle=H}}get volume(){return this._volume}set volume(H){if(H!==this._volume)for(const c of this._sounds)c.setVolume(H)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(H){if(!this.isPaused){this.stop();const H=Math.random();let c=0;for(let y=0;y<this._weights.length;y++)if(c+=this._weights[y],H<=c){this._currentIndex=y;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:H):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class oc{constructor(H){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(H=H||m.b.LastCreatedScene)&&(this._scene=H,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var H;null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&Gc.e.audioEngine.audioContext&&(this._outputAudioNode=Gc.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Gc.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Gc.e.audioEngine&&Gc.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(H){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&H.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==H.soundTrackId&&(-1===H.soundTrackId?this._scene.mainSoundTrack.removeSound(H):this._scene.soundTracks&&this._scene.soundTracks[H.soundTrackId].removeSound(H)),this.soundCollection.push(H),H.soundTrackId=this.id}removeSound(H){const c=this.soundCollection.indexOf(H);-1!==c&&this.soundCollection.splice(c,1)}setVolume(H){var c;null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=H)}switchPanningModelToHRTF(){var H;if(null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var H;if(null!==(H=Gc.e.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(H){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=H,null!==(c=Gc.e.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Gc.e.audioEngine.masterGain))}}var sc=y(11174),qc=y(11076),Ic=(y(11667),y(10790));(0,y(11747).e)(sc.d.NAME_AUDIO,((H,c,y,Z)=>{let F,P=[];if(y._j=y._j||[],void 0!==H._j&&null!==H._j)for(let n=0,O=H._j.length;n<O;n++){var S;const O=H._j[n];null!==(S=Gc.e.audioEngine)&&void 0!==S&&S.canUseWebAudio?(O.url||(O.url=O.name),P[O.url]?y._j.push(pc.Parse(O,c,Z,P[O.url])):(F=pc.Parse(O,c,Z),P[O.url]=F,y._j.push(F))):y._j.push(new pc(O.name,null,c))}P=[]})),Object.defineProperty(qc.d.prototype,"mainSoundTrack",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),this._mainSoundTrack||(this._mainSoundTrack=new oc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),qc.d.prototype.getSoundByName=function(H){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===H)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let y=0;y<this.soundTracks.length;y++)for(c=0;c<this.soundTracks[y].soundCollection.length;c++)if(this.soundTracks[y].soundCollection[c].name===H)return this.soundTracks[y].soundCollection[c];return null},Object.defineProperty(qc.d.prototype,"audioEnabled",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),H.audioEnabled},set:function(H){let c=this._getComponent(sc.d.NAME_AUDIO);c||(c=new jc(this),this.fb(c)),H?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(qc.d.prototype,"headphone",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),H.headphone},set:function(H){let c=this._getComponent(sc.d.NAME_AUDIO);c||(c=new jc(this),this.fb(c)),H?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(qc.d.prototype,"audioListenerPositionProvider",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),H.audioListenerPositionProvider},set:function(H){let c=this._getComponent(sc.d.NAME_AUDIO);if(c||(c=new jc(this),this.fb(c)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(qc.d.prototype,"audioListenerRotationProvider",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),H.audioListenerRotationProvider},set:function(H){let c=this._getComponent(sc.d.NAME_AUDIO);if(c||(c=new jc(this),this.fb(c)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(qc.d.prototype,"audioPositioningRefreshRate",{get:function(){let H=this._getComponent(sc.d.NAME_AUDIO);return H||(H=new jc(this),this.fb(H)),H.audioPositioningRefreshRate},set:function(H){let c=this._getComponent(sc.d.NAME_AUDIO);c||(c=new jc(this),this.fb(c)),c.audioPositioningRefreshRate=H},enumerable:!0,configurable:!0});class jc{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(H){this.name=sc.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new F.n,this._cachedCameraPosition=new F.n,this._lastCheck=0,this._invertMatrixTemp=new F.d,this._cameraDirectionTemp=new F.n,(H=H||m.b.LastCreatedScene)&&(this.Gd=H,H.soundTracks=[],H._j=[])}register(){this.Gd._afterRenderStage.registerStep(sc.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(H){if(H._j=[],this.Gd.soundTracks)for(let c=0;c<this.Gd.soundTracks.length;c++){const y=this.Gd.soundTracks[c];for(let c=0;c<y.soundCollection.length;c++)H._j.push(y.soundCollection[c].serialize())}}addFromContainer(H){H._j&&H._j.forEach((H=>{H.play(),H.autoplay=!0,this.Gd.mainSoundTrack.addSound(H)}))}removeFromContainer(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H._j&&H._j.forEach((H=>{H.stop(),H.autoplay=!1,this.Gd.mainSoundTrack.removeSound(H),c&&H.dispose()}))}dispose(){const H=this.Gd;if(H._mainSoundTrack&&H.mainSoundTrack.dispose(),H.soundTracks)for(let c=0;c<H.soundTracks.length;c++)H.soundTracks[c].dispose()}disableAudio(){const H=this.Gd;let c;for(this._audioEnabled=!1,Gc.e.audioEngine&&Gc.e.audioEngine.audioContext&&Gc.e.audioEngine.audioContext.suspend(),c=0;c<H.mainSoundTrack.soundCollection.length;c++)H.mainSoundTrack.soundCollection[c].pause();if(H.soundTracks)for(c=0;c<H.soundTracks.length;c++)for(let y=0;y<H.soundTracks[c].soundCollection.length;y++)H.soundTracks[c].soundCollection[y].pause()}enableAudio(){const H=this.Gd;let c;for(this._audioEnabled=!0,Gc.e.audioEngine&&Gc.e.audioEngine.audioContext&&Gc.e.audioEngine.audioContext.resume(),c=0;c<H.mainSoundTrack.soundCollection.length;c++)H.mainSoundTrack.soundCollection[c].isPaused&&H.mainSoundTrack.soundCollection[c].play();if(H.soundTracks)for(c=0;c<H.soundTracks.length;c++)for(let y=0;y<H.soundTracks[c].soundCollection.length;y++)H.soundTracks[c].soundCollection[y].isPaused&&H.soundTracks[c].soundCollection[y].play()}switchAudioModeForHeadphones(){const H=this.Gd;if(this._headphone=!0,H.mainSoundTrack.switchPanningModelToHRTF(),H.soundTracks)for(let c=0;c<H.soundTracks.length;c++)H.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const H=this.Gd;if(this._headphone=!1,H.mainSoundTrack.switchPanningModelToEqualPower(),H.soundTracks)for(let c=0;c<H.soundTracks.length;c++)H.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const H=Ic.b.Now;if(this._lastCheck&&H-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=H;const c=this.Gd;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const y=Gc.e.audioEngine;if(y&&y.audioContext){let H,Z=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(Z=c.activeCameras[0]),this.audioListenerPositionProvider){const H=this.audioListenerPositionProvider();y.audioContext.listener.setPosition(H.x||0,H.y||0,H.z||0)}else Z?this._cachedCameraPosition.equals(Z.globalPosition)||(this._cachedCameraPosition.p(Z.globalPosition),y.audioContext.listener.setPosition(Z.globalPosition.x,Z.globalPosition.y,Z.globalPosition.z)):y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const H=this.audioListenerRotationProvider();y.audioContext.listener.setOrientation(H.x||0,H.y||0,H.z||0,0,1,0)}else Z?(Z.rigCameras&&Z.rigCameras.length>0&&(Z=Z.rigCameras[0]),Z.getViewMatrix().invertToRef(this._invertMatrixTemp),F.n.TransformNormalToRef(jc._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(H=0;H<c.mainSoundTrack.soundCollection.length;H++){const y=c.mainSoundTrack.soundCollection[H];y.useCustomAttenuation&&y.updateDistanceFromListener()}if(c.soundTracks)for(H=0;H<c.soundTracks.length;H++)for(let y=0;y<c.soundTracks[H].soundCollection.length;y++){const Z=c.soundTracks[H].soundCollection[y];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}}}}jc._CameraDirection=new F.n(0,0,-1),pc._SceneComponentInitialization=H=>{let c=H._getComponent(sc.d.NAME_AUDIO);c||(c=new jc(H),H.fb(c))};const kc="MSFT_audio_emitter";class Wc{constructor(H){this.name=kc,this._loader=H,this.enabled=this._loader.isExtensionUsed(kc)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const H=this._loader.Oi.extensions;if(H&&H[this.name]){const c=H[this.name];this._clips=c.clips,this._emitters=c.emitters,b.Assign(this._clips),b.Assign(this._emitters)}}loadSceneAsync(H,c){return X.LoadExtensionAsync(H,c,this.name,((y,Z)=>{const F=new Array;F.push(this._loader.loadSceneAsync(H,c));for(const H of Z.emitters){const c=b.Get(`${y}/emitters`,this._emitters,H);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${y}: Direction or Distance properties are not allowed on emitters attached to a scene`);F.push(this._loadEmitterAsync(`${y}/emitters/${c.index}`,c))}return Promise.all(F).then((()=>{}))}))}loadNodeAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((H,Z)=>{const P=new Array;return this._loader.loadNodeAsync(H,c,(c=>{for(const y of Z.emitters){const Z=b.Get(`${H}/emitters`,this._emitters,y);P.push(this._loadEmitterAsync(`${H}/emitters/${Z.index}`,Z).then((()=>{for(const H of Z._babylonSounds)H.attachToMesh(c),void 0==Z.innerAngle&&void 0==Z.outerAngle||(H.setLocalDirectionToMesh(F.n.Forward()),H.setDirectionalCone(2*S.c.ToDegrees(void 0==Z.innerAngle?Math.PI:Z.innerAngle),2*S.c.ToDegrees(void 0==Z.outerAngle?Math.PI:Z.outerAngle),0))})))}y(c)})).then((H=>Promise.all(P).then((()=>H))))}))}loadAnimationAsync(H,c){return X.LoadExtensionAsync(H,c,this.name,((y,Z)=>this._loader.loadAnimationAsync(H,c).then((F=>{const P=new Array;b.Assign(Z.events);for(const S of Z.events)P.push(this._loadAnimationEventAsync(`${y}/events/${S.index}`,H,c,S,F));return Promise.all(P).then((()=>F))}))))}_loadClipAsync(H,c){if(c._objectURL)return c._objectURL;let y;if(c.uri)y=this._loader.loadUriAsync(H,c,c.uri);else{const Z=b.Get(`${H}/bufferView`,this._loader.Oi.bufferViews,c.bufferView);y=this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}return c._objectURL=y.then((H=>URL.createObjectURL(new Blob([H],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(H,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const H=new Array,y=c.name||`emitter${c.index}`,Z={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let P=0;P<c.clips.length;P++){const F=`/extensions/${this.name}/clips`,S=b.Get(F,this._clips,c.clips[P].clip);H.push(this._loadClipAsync(`${F}/${c.clips[P].clip}`,S).then((H=>{const F=c._babylonSounds[P]=new pc(y,H,this._loader.babylonScene,null,Z);F.refDistance=c.refDistance||1,F.maxDistance=c.maxDistance||256,F.rolloffFactor=c.rolloffFactor||1,F.distanceModel=c.distanceModel||"exponential"})))}const F=Promise.all(H).then((()=>{const H=c.clips.map((H=>H.weight||1)),y=new tc(c.loop||!1,c._babylonSounds,H);c.innerAngle&&(y.directionalConeInnerAngle=2*S.c.ToDegrees(c.innerAngle)),c.outerAngle&&(y.directionalConeOuterAngle=2*S.c.ToDegrees(c.outerAngle)),c.volume&&(y.volume=c.volume),c._babylonData.sound=y}));c._babylonData={loaded:F}}return c._babylonData.loaded}_getEventAction(H,c,y,Z,F){switch(y){case"play":return H=>{const y=(F||0)+(H-Z);c.play(y)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${H}: Unsupported action ${y}`)}}_loadAnimationEventAsync(H,c,y,Z,F){if(0==F.targetedAnimations.length)return Promise.resolve();const P=F.targetedAnimations[0],S=Z.j,n=b.Get(`/extensions/${this.name}/emitters`,this._emitters,S);return this._loadEmitterAsync(H,n).then((()=>{const c=n._babylonData.sound;if(c){const y=new Ec(Z.time,this._getEventAction(H,c,Z.action,Z.time,Z.startOffset));P.animation.addEvent(y),F.onAnimationGroupEndObservable.add((()=>{c.stop()})),F.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}w(kc),N(kc,!0,(H=>new Wc(H)));const Mc="MSFT_lod";class xc{constructor(H){var c;this.name=Mc,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.e,this.onMaterialLODsLoadedObservable=new i.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=H,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[Mc])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Mc)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let H=0;H<this._nodePromiseLODs.length;H++){const c=Promise.all(this._nodePromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Node LOD ${H}`),this._loader.log(`Loaded node LOD ${H}`)),this.onNodeLODsLoadedObservable.notifyObservers(H),H!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${H+1}`),this._loadBufferLOD(this._nodeBufferLODs,H+1),this._nodeSignalLODs[H]&&this._nodeSignalLODs[H].resolve())}));this._loader._completePromises.push(c)}for(let H=0;H<this._materialPromiseLODs.length;H++){const c=Promise.all(this._materialPromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Material LOD ${H}`),this._loader.log(`Loaded material LOD ${H}`)),this.onMaterialLODsLoadedObservable.notifyObservers(H),H!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${H+1}`),this._loadBufferLOD(this._materialBufferLODs,H+1),this._materialSignalLODs[H]&&this._materialSignalLODs[H].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(H,c){const y=this._loader.loadSceneAsync(H,c);return this._loadBufferLOD(this._bufferLODs,0),y}loadNodeAsync(H,c,y){return X.LoadExtensionAsync(H,c,this.name,((H,F)=>{let P;const S=this._getLODs(H,c,this._loader.Oi.nodes,F.ids);this._loader.logOpen(`${H}`);for(let c=0;c<S.length;c++){const H=S[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new Z);const F=H=>{y(H),H.Tb(!1)},n=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,F).then((H=>{if(0!==c){const H=S[c-1];H._babylonTransformNode&&(this._disposeTransformNode(H._babylonTransformNode),delete H._babylonTransformNode)}return H.Tb(!0),H}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?P=n:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(n))}return this._loader.logClose(),P}))}_loadMaterialAsync(H,c,y,Z,F){return this._nodeIndexLOD?null:X.LoadExtensionAsync(H,c,this.name,((H,P)=>{let S;const n=this._getLODs(H,c,this._loader.Oi.materials,P.ids);this._loader.logOpen(`${H}`);for(let c=0;c<n.length;c++){const H=n[c];0!==c&&(this._materialIndexLOD=c);const P=this._loader._loadMaterialAsync(`/materials/${H.index}`,H,y,Z,(H=>{0===c&&F(H)})).then((H=>{if(0!==c){F(H);const y=n[c-1]._data;y[Z]&&(this._disposeMaterials([y[Z].babylonMaterial]),delete y[Z])}return H}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?S=P:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(P))}return this._loader.logClose(),S}))}_loadUriAsync(H,c,y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const F=this._nodeIndexLOD-1;return this._nodeSignalLODs[F]=this._nodeSignalLODs[F]||new Z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(H,c,y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const F=this._materialIndexLOD-1;return this._materialSignalLODs[F]=this._materialSignalLODs[F]||new Z,this._materialSignalLODs[F].promise.then((()=>this._loader.loadUriAsync(H,c,y)))}return null}loadBufferAsync(H,c,y,F){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);const c=(H,c)=>{const P=y,S=P+F-1;let n=H[c];return n?(n.start=Math.min(n.start,P),n.end=Math.max(n.end,S)):(n={start:P,end:S,loaded:new Z},H[c]=n),n.loaded.promise.then((H=>new Uint8Array(H.buffer,H.byteOffset+y-n.start,F)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(H,c){const y=H[c];y&&(this._loader.log(`Loading buffer range [${y.start}-${y.end}]`),this._loader.bin.readAsync(y.start,y.end-y.start+1).then((H=>{y.loaded.resolve(H)}),(H=>{y.loaded.reject(H)})))}_getLODs(H,c,y,Z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const F=[];for(let P=Z.length-1;P>=0;P--)if(F.push(b.Get(`${H}/ids/${Z[P]}`,y,Z[P])),F.length===this.maxLODsToLoad)return F;return F.push(c),F}_disposeTransformNode(H){const c=[],y=H.material;y&&c.push(y);for(const F of H.getChildMeshes())F.material&&c.push(F.material);H.dispose();const Z=c.filter((H=>this._loader.babylonScene.meshes.every((c=>c.material!=H))));this._disposeMaterials(Z)}_disposeMaterials(H){const c={};for(const y of H){for(const H of y.getActiveTextures())c[H.uniqueId]=H;y.dispose()}for(const y in c)for(const H of this._loader.babylonScene.materials)H.hasTexture(c[y])&&delete c[y];for(const y in c)c[y].dispose()}}w(Mc),N(Mc,!0,(H=>new xc(H)));const Rc="MSFT_minecraftMesh";class Ac{constructor(H){this.name=Rc,this._loader=H,this.enabled=this._loader.isExtensionUsed(Rc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtraAsync(H,c,this.name,((Z,F)=>{if(F){if(!(y instanceof T))throw new Error(`${Z}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(H,c,y);return y.needAlphaBlending()&&(y.forceDepthWrite=!0,y.separateCullingPass=!0),y.dh=y.forceDepthWrite,y.twoSidedLighting=!0,F}return null}))}}w(Rc),N(Rc,!0,(H=>new Ac(H)));const ec="MSFT_sRGBFactors";class rc{constructor(H){this.name=ec,this._loader=H,this.enabled=this._loader.isExtensionUsed(ec)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,c,y){return X.LoadExtraAsync(H,c,this.name,((Z,F)=>{if(F){if(!(y instanceof T))throw new Error(`${Z}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(H,c,y),P=y.va().getEngine().useExactSrgbConversions;return y.albedoTexture||y.albedoColor.toLinearSpaceToRef(y.albedoColor,P),y.reflectivityTexture||y.reflectivityColor.toLinearSpaceToRef(y.reflectivityColor,P),F}return null}))}}w(ec),N(ec,!0,(H=>new rc(H)));var Nc,wc=y(10901);!function(H){H[H.Input=0]="Input",H[H.Output=1]="Output"}(Nc||(Nc={}));class Lc{constructor(H,c,y){this._ownerBlock=y,this._connectedPoint=[],this.uniqueId=(0,wc.e)(),this.connectedPointIds=[],this.name=H,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(H){if(this._connectionType===H._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||H._isSingularConnection()&&H._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(H),H._connectedPoint.push(this)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H.uniqueId=this.uniqueId,H.name=this.name,H._connectionType=this._connectionType,H.connectedPointIds=[],H.className=this.getClassName();for(const c of this._connectedPoint)H.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(H){this.uniqueId=H.uniqueId,this.name=H.name,this._connectionType=H._connectionType,this.connectedPointIds=H.connectedPointIds}static Parse(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;const y=new(S.c.Instantiate(H.className))(H.name,H._connectionType,c);return y.deserialize(H),y}}class bc{constructor(H){this.value=this._toInt(H)}_toInt(H){return 0|H}add(H){return new bc(this.value+H.value)}Rc(H){return new bc(this.value-H.value)}multiply(H){return new bc(Math.imul(this.value,H.value))}divide(H){return new bc(this.value/H.value)}getClassName(){return bc.ClassName}equals(H){return this.value===H.value}static Parse(H){return new bc(H.value)}}bc.ClassName="FlowGraphInteger",(0,d.d)("FlowGraphInteger",bc);class Xc{constructor(H,c){this.typeName=H,this.defaultValue=c}serialize(H){H.typeName=this.typeName,H.defaultValue=this.defaultValue}static Parse(H){return new Xc(H.typeName,H.defaultValue)}}const Bc=new Xc("any",void 0),Yc=(new Xc("string",""),new Xc("number",0)),Hy=new Xc("boolean",!1),cy=new Xc("Vector2",F.l.Zero()),yy=new Xc("o",F.n.Zero()),Zy=(new Xc("Vector4",F.q.Zero()),new Xc("Matrix",F.d.Identity())),Fy=(new Xc("gb",P.e.Black()),new Xc("ob",new P.h(0,0,0,0)),new Xc("Quaternion",F.f.Identity()),new Xc("FlowGraphInteger",new bc(0)));class Py extends Lc{constructor(H,c,y,Z){super(H,c,y),this.richType=Z}_isSingularConnection(){return 0===this.connectionType}setValue(H,c){c._setConnectionValue(this,H)}connectTo(H){super.connectTo(H)}_getValueOrDefault(H){return H._hasConnectionValue(this)?H._getConnectionValue(this):this.richType.defaultValue}getValue(H){return 1===this.connectionType?(H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(H),this._getValueOrDefault(H)):this.isConnected()?this._connectedPoint[0].getValue(H):this._getValueOrDefault(H)}getClassName(){return"FGDataConnection"}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.richType={},this.richType.serialize(H.richType)}static Parse(H,c){const y=Lc.Parse(H,c);return y.richType=Xc.Parse(H.richType),y}}function Sy(H){return"Mesh"===H||"AbstractMesh"===H||"GroundMesh"===H||"InstanceMesh"===H||"LinesMesh"===H||"GoldbergMesh"===H||"GreasedLineMesh"===H||"TrailMesh"===H}function ny(H){return"Vector2"===H||"o"===H||"Vector4"===H||"Quaternion"===H||"gb"===H||"ob"===H}function Oy(H,c,y){var Z;const F=(null===c||void 0===c||null===(Z=c.getClassName)||void 0===Z?void 0:Z.call(c))??"";Sy(F)?y[H]={name:c.name,className:F}:ny(F)?y[H]={value:c.ij(),className:F}:y[H]=c}function ay(H,c,y){const Z=c[H];let S;const n=null===Z||void 0===Z?void 0:Z.className;return S=Sy(n)?y.getMeshByName(Z.name):ny(n)?function(H,c){if("Vector2"===H)return F.l.Tg(c);if("o"===H)return F.n.Tg(c);if("Vector4"===H)return F.q.Tg(c);if("Quaternion"===H)return F.f.Tg(c);if("gb"===H)return new P.e(c[0],c[1],c[2]);if("ob"===H)return new P.h(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${H}`)}(n,Z.value):"Matrix"===n?F.d.Tg(Z.value):n===bc.ClassName?bc.Parse(Z):Z&&void 0!==Z.value?Z.value:Z,S}(0,d.d)("FGDataConnection",Py);class iy{constructor(H){var c;this.config=H,this.uniqueId=(0,wc.e)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(H){}registerDataInput(H,c){const y=new Py(H,0,this,c);return this.dataInputs.push(y),y}registerDataOutput(H,c){const y=new Py(H,1,this,c);return this.dataOutputs.push(y),y}getDataInput(H){return this.dataInputs.find((c=>c.name===H))}getDataOutput(H){return this.dataOutputs.find((c=>c.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H.uniqueId=this.uniqueId,H.config={},this.config&&(H.config.name=this.config.name),H.dataInputs=[],H.dataOutputs=[],H.className=this.getClassName();for(const c of this.dataInputs){const y={};c.serialize(y),H.dataInputs.push(y)}for(const c of this.dataOutputs){const y={};c.serialize(y),H.dataOutputs.push(y)}}getClassName(){return"FGBlock"}static Parse(H,c){const y=S.c.Instantiate(H.className),Z={},F=c.valueParseFunction??ay;if(H.config)for(const S in H.config)Z[S]=F(S,H.config,c.Gd);var P;("FGSetPropertyBlock"===(P=H.className)||"FGGetPropertyBlock"===P||"FGPlayAnimationBlock"===P||"FGMeshPickEventBlock"===P)&&(Z.pathConverter=c.pathConverter);const n=new y(Z);n.uniqueId=H.uniqueId;for(let S=0;S<H.dataInputs.length;S++){const c=n.getDataInput(H.dataInputs[S].name);if(!c)throw new Error("Could not find data input with name "+H.dataInputs[S].name+" in block "+H.className);c.deserialize(H.dataInputs[S])}for(let S=0;S<H.dataOutputs.length;S++){const c=n.getDataOutput(H.dataOutputs[S].name);if(!c)throw new Error("Could not find data output with name "+H.dataOutputs[S].name+" in block "+H.className);c.deserialize(H.dataOutputs[S])}return n.metadata=H.metadata,n.deserialize&&n.deserialize(H),n}}class Cy extends Lc{_isSingularConnection(){return 1===this.connectionType}_activateSignal(H){var c;0===this.connectionType?(H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(H,this),H._increaseExecutionId()):null===(c=this._connectedPoint[0])||void 0===c||c._activateSignal(H)}}(0,d.d)("FlowGraphSignalConnection",Cy);class gy extends iy{constructor(H){super(H),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(H){const c=new Cy(H,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(H){const c=new Cy(H,1,this);return this.signalOutputs.push(c),c}getSignalInput(H){return this.signalInputs.find((c=>c.name===H))}getSignalOutput(H){return this.signalOutputs.find((c=>c.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.signalInputs=[],H.signalOutputs=[];for(const c of this.signalInputs){const y={};c.serialize(y),H.signalInputs.push(y)}for(const c of this.signalOutputs){const y={};c.serialize(y),H.signalOutputs.push(y)}}deserialize(H){for(let c=0;c<H.signalInputs.length;c++){const y=this.getSignalInput(H.signalInputs[c].name);if(!y)throw new Error("Could not find signal input with name "+H.signalInputs[c].name+" in block "+H.className);y.deserialize(H.signalInputs[c])}for(let c=0;c<H.signalOutputs.length;c++){const y=this.getSignalOutput(H.signalOutputs[c].name);if(!y)throw new Error("Could not find signal output with name "+H.signalOutputs[c].name+" in block "+H.className);y.deserialize(H.signalOutputs[c])}}getClassName(){return"FGExecutionBlock"}}class vy extends gy{constructor(H){super(H),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(H){this._preparePendingTasks(H),H._addPendingBlock(this)}}class my extends vy{_execute(H){H._notifyExecuteNode(this),this.out._activateSignal(H)}}class zy{constructor(H){this.uniqueId=(0,wc.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new i.e,this._configuration=H}hasVariable(H){return H in this._userVariables}setVariable(H,c){this._userVariables[H]=c}getVariable(H){return this._userVariables[H]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(H,c){return`${H.uniqueId}_${c}`}_setExecutionVariable(H,c,y){this._executionVariables[this._getUniqueIdPrefixedName(H,c)]=y}_getExecutionVariable(H,c,y){return this._hasExecutionVariable(H,c)?this._executionVariables[this._getUniqueIdPrefixedName(H,c)]:y}_deleteExecutionVariable(H,c){delete this._executionVariables[this._getUniqueIdPrefixedName(H,c)]}_hasExecutionVariable(H,c){return this._getUniqueIdPrefixedName(H,c)in this._executionVariables}_hasConnectionValue(H){return H.uniqueId in this._connectionValues}_setConnectionValue(H,c){this._connectionValues[H.uniqueId]=c}_getConnectionValue(H){return this._connectionValues[H.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(H){this._pendingBlocks.push(H)}_removePendingBlock(H){const c=this._pendingBlocks.indexOf(H);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const H of this._pendingBlocks)H._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(H){this.onNodeExecutedObservable.notifyObservers(H)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oy;H.uniqueId=this.uniqueId,H._userVariables={};for(const y in this._userVariables)c(y,this._userVariables[y],H._userVariables);H._connectionValues={};for(const y in this._connectionValues)c(y,this._connectionValues[y],H._connectionValues)}getClassName(){return"FGContext"}static Parse(H,c){const y=c.graph.createContext(),Z=c.valueParseFunction??ay;y.uniqueId=H.uniqueId;for(const F in H._userVariables){const c=Z(F,H._userVariables,y._configuration.Gd);y._userVariables[F]=c}for(const F in H._connectionValues){const c=Z(F,H._connectionValues,y._configuration.Gd);y._connectionValues[F]=c}return y}}(0,D.b)([(0,f.P)()],zy.prototype,"uniqueId",void 0);var Vy,hy,Qy=y(11181);function Dy(H,c){return!(!H.parent||H.parent!==c&&!Dy(H.parent,c))}class fy extends my{constructor(H){super(H),this.config=H}_getReferencedMesh(){const H=this.config.pathConverter.convert(this.config.path),c=H.info.getObject(H.object);if(!c||!(c instanceof p.d))throw new Error("Mesh pick event block requires a valid mesh");return c}_preparePendingTasks(H){let c=H._getExecutionVariable(this,"meshPickObserver");if(!c){const y=this._getReferencedMesh();H._setExecutionVariable(this,"mesh",y),c=y.va().onPointerObservable.add((c=>{var Z,F,P;c.type===Qy.e.POINTERPICK&&null!==(Z=c.pickInfo)&&void 0!==Z&&Z.pickedMesh&&((null===(F=c.pickInfo)||void 0===F?void 0:F.pickedMesh)===y||Dy(null===(P=c.pickInfo)||void 0===P?void 0:P.pickedMesh,y))&&this._execute(H)}));const Z=y.jj.add((()=>this._onDispose));H._setExecutionVariable(this,"meshPickObserver",c),H._setExecutionVariable(this,"meshDisposeObserver",Z)}}_onDispose(H){this._cancelPendingTasks(H),H._removePendingBlock(this)}_cancelPendingTasks(H){const c=H._getExecutionVariable(this,"mesh"),y=H._getExecutionVariable(this,"meshPickObserver"),Z=H._getExecutionVariable(this,"meshDisposeObserver");c.va().onPointerObservable.remove(y),c.jj.remove(Z),H._deleteExecutionVariable(this,"mesh"),H._deleteExecutionVariable(this,"meshPickObserver"),H._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return fy.ClassName}serialize(H){super.serialize(H),H.config.path=this.config.path}}fy.ClassName="FGMeshPickEventBlock",(0,d.d)(fy.ClassName,fy),function(H){H[H.Stopped=0]="Stopped",H[H.Started=1]="Started"}(Vy||(Vy={}));class Jy{constructor(H){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=H.Gd,this._coordinator=H.coordinator,this._sceneDisposeObserver=this._scene.jj.add((()=>this.dispose()))}createContext(){const H=new zy({Gd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(H),H}getContext(H){return this._executionContexts[H]}addEventBlock(H){this._eventBlocks.push(H)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const H of this._executionContexts){const c=this._getContextualOrder();for(const y of c)y._startPendingTasks(H)}}}_getContextualOrder(){const H=[];for(const c of this._eventBlocks)if(c.getClassName()===fy.ClassName){const y=c._getReferencedMesh();let Z=0;for(;Z<H.length;Z++){const c=H[Z]._getReferencedMesh();if(y&&c&&Dy(y,c))break}H.splice(Z,0,c)}else H.push(c);return H}dispose(){if(0!==this.state){this.state=0;for(const H of this._executionContexts)H._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.jj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(H){const c=[],y=new Set;for(const Z of this._eventBlocks)c.push(Z),y.add(Z.uniqueId);for(;c.length>0;){const Z=c.pop();H(Z);for(const H of Z.dataInputs)for(const Z of H._connectedPoint)y.has(Z._ownerBlock.uniqueId)||(c.push(Z._ownerBlock),y.add(Z._ownerBlock.uniqueId));if(Z instanceof gy)for(const H of Z.signalOutputs)for(const Z of H._connectedPoint)y.has(Z._ownerBlock.uniqueId)||(c.push(Z._ownerBlock),y.add(Z._ownerBlock.uniqueId))}}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;H.allBlocks=[],this.visitAllBlocks((c=>{const y={};c.serialize(y),H.allBlocks.push(y)})),H.executionContexts=[];for(const y of this._executionContexts){const Z={};y.serialize(Z,c),H.executionContexts.push(Z)}}static GetDataOutConnectionByUniqueId(H,c){for(const y of H)for(const H of y.dataOutputs)if(H.uniqueId===c)return H;throw new Error("Could not find data out connection with unique id "+c)}static GetSignalInConnectionByUniqueId(H,c){for(const y of H)if(y instanceof gy)for(const H of y.signalInputs)if(H.uniqueId===c)return H;throw new Error("Could not find signal in connection with unique id "+c)}static Parse(H,c){const y=c.coordinator.createGraph(),Z=[],F=c.valueParseFunction??ay;for(const P of H.allBlocks){const H=iy.Parse(P,{Gd:c.coordinator.config.Gd,pathConverter:c.pathConverter,valueParseFunction:F});Z.push(H),H instanceof my&&y.addEventBlock(H)}for(const P of Z){for(const H of P.dataInputs)for(const c of H.connectedPointIds){const y=Jy.GetDataOutConnectionByUniqueId(Z,c);H.connectTo(y)}if(P instanceof gy)for(const H of P.signalOutputs)for(const c of H.connectedPointIds){const y=Jy.GetSignalInConnectionByUniqueId(Z,c);H.connectTo(y)}}for(const P of H.executionContexts)zy.Parse(P,{graph:y,valueParseFunction:F});return y}}class ly{constructor(H){this.config=H,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Gd.jj.add((()=>{this.dispose()}));(ly.SceneCoordinators.get(this.config.Gd)??[]).push(this)}createGraph(){const H=new Jy({Gd:this.config.Gd,coordinator:this});return this._flowGraphs.push(H),H}removeGraph(H){const c=this._flowGraphs.indexOf(H);-1!==c&&(H.dispose(),this._flowGraphs.splice(c,1))}start(){this._flowGraphs.forEach((H=>H.start()))}dispose(){this._flowGraphs.forEach((H=>H.dispose())),this._flowGraphs.length=0;const H=ly.SceneCoordinators.get(this.config.Gd)??[],c=H.indexOf(this);-1!==c&&H.splice(c,1)}serialize(H,c){H._flowGraphs=[],this._flowGraphs.forEach((y=>{const Z={};y.serialize(Z,c),H._flowGraphs.push(Z)}))}static Parse(H,c){var y;const Z=c.valueParseFunction??ay,F=new ly({Gd:c.Gd});return null===(y=H._flowGraphs)||void 0===y||y.forEach((H=>{Jy.Parse(H,{coordinator:F,valueParseFunction:Z,pathConverter:c.pathConverter})})),F}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(H){let c=this._customEventsMap.get(H);return c||(c=new i.e,this._customEventsMap.set(H,c)),c}notifyCustomEvent(H,c){const y=this._customEventsMap.get(H);y&&y.notifyObservers(c)}}ly.SceneCoordinators=new Map;class dy extends my{_preparePendingTasks(H){if(!H._getExecutionVariable(this,"sceneReadyObserver")){const c=H.configuration.Gd.onReadyObservable.add((()=>{this._execute(H)}));H._setExecutionVariable(this,"sceneReadyObserver",c)}}_cancelPendingTasks(H){const c=H._getExecutionVariable(this,"sceneReadyObserver");H.configuration.Gd.onReadyObservable.remove(c),H._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return dy.ClassName}}dy.ClassName="FGSceneReadyEventBlock",(0,d.d)("FGSceneReadyEventBlock",dy);class Ky extends my{_preparePendingTasks(H){if(!H._getExecutionVariable(this,"sceneBeforeRender")){const c=H.configuration.Gd.onBeforeRenderObservable.add((()=>{this._execute(H)}));H._setExecutionVariable(this,"sceneBeforeRender",c)}}_cancelPendingTasks(H){const c=H._getExecutionVariable(this,"sceneBeforeRender");H.configuration.Gd.onBeforeRenderObservable.remove(c),H._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return Ky.ClassName}}Ky.ClassName="FGSceneTickEventBlock",(0,d.d)(Ky.ClassName,Ky);class Ty extends gy{constructor(H){super(H),this.out=this._registerSignalOutput("out")}}class uy extends Ty{constructor(H){super(H),this.message=this.registerDataInput("message",Bc)}_execute(H){const c=this.message.getValue(H);z.d.Log(c),this.out._activateSignal(H)}getClassName(){return uy.ClassName}}uy.ClassName="FGConsoleLogBlock",(0,d.d)(uy.ClassName,uy),function(H){H[H.INIT=0]="INIT",H[H.STARTED=1]="STARTED",H[H.ENDED=2]="ENDED"}(hy||(hy={}));class Ey{constructor(H){this.onEachCountObservable=new i.e,this.onTimerAbortedObservable=new i.e,this.onTimerEndedObservable=new i.e,this.onStateChangedObservable=new i.e,this._observer=null,this._breakOnNextTick=!1,this._tick=H=>{const c=Date.now();this._timer=c-this._startTime;const y={startTime:this._startTime,currentTime:c,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:H},Z=this._breakOnNextTick||this._breakCondition(y);Z||this._timer>=this._timeToEnd?this._stop(y,Z):this.onEachCountObservable.notifyObservers(y)},this._setState(0),this._contextObservable=H.contextObservable,this._observableParameters=H.observableParameters??{},this._breakCondition=H.breakCondition??(()=>!1),this._timeToEnd=H.timeout,H.onEnded&&this.onTimerEndedObservable.add(H.onEnded),H.ci&&this.onEachCountObservable.add(H.ci),H.onAborted&&this.onTimerAbortedObservable.add(H.onAborted)}set breakCondition(H){this._breakCondition=H}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=H,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(H){this._state=H,this.onStateChangedObservable.notifyObservers(this._state)}_stop(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),c?this.onTimerAbortedObservable.notifyObservers(H):this.onTimerEndedObservable.notifyObservers(H)}}class Uy extends vy{constructor(H){super(H),this.timeout=this.registerDataInput("timeout",Yc)}_preparePendingTasks(H){const c=this.timeout.getValue(H);if(void 0!==c&&c>=0){const y=H._getExecutionVariable(this,"runningTimers")||[],Z=H.configuration.Gd,F=new Ey({timeout:c,contextObservable:Z.onBeforeRenderObservable,onEnded:()=>this._onEnded(F,H)});F.start(),y.push(F),H._setExecutionVariable(this,"runningTimers",y)}}_execute(H){this._startPendingTasks(H),this.out._activateSignal(H)}_onEnded(H,c){const y=c._getExecutionVariable(this,"runningTimers")||[],Z=y.indexOf(H);-1!==Z?y.splice(Z,1):S.c.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),c._removePendingBlock(this),this.done._activateSignal(c)}_cancelPendingTasks(H){const c=H._getExecutionVariable(this,"runningTimers")||[];for(const y of c)y.dispose();H._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Uy.ClassName}}Uy.ClassName="FGTimerBlock",(0,d.d)("FGTimerBlock",Uy);class Gy extends Ty{constructor(H){super(H),this.config=H;for(let c=0;c<this.config.eventData.length;c++){const H=this.config.eventData[c];this.registerDataInput(H,Bc)}}_execute(H){const c=this.config.eventId,y=this.dataInputs.map((c=>c.getValue(H)));H.configuration.coordinator.notifyCustomEvent(c,y),this.out._activateSignal(H)}getClassName(){return Gy.ClassName}}Gy.ClassName="FGSendCustomEventBlock",(0,d.d)("FGSendCustomEventBlock",Gy);class py extends my{constructor(H){super(H),this.config=H;for(let c=0;c<this.config.eventData.length;c++){const H=this.config.eventData[c];this.registerDataOutput(H,Bc)}}_preparePendingTasks(H){const c=H.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=c.add((c=>{for(let y=0;y<c.length;y++)this.dataOutputs[y].setValue(c[y],H);this._execute(H)}))}_cancelPendingTasks(H){const c=H.configuration.coordinator.getCustomEventObservable(this.config.eventId);c?c.remove(this._eventObserver):S.c.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return py.ClassName}serialize(H){super.serialize(H),H.eventId=this.config.eventId,H.eventData=this.config.eventData}}py.ClassName="FGReceiveCustomEventBlock",(0,d.d)(py.ClassName,py);class ty extends gy{constructor(H){super(H),this.config=H,this.outFlows=[];for(let c=0;c<this.config.numberOutputFlows;c++)this.outFlows.push(this._registerSignalOutput(`${c}`))}_execute(H){for(let c=0;c<this.config.numberOutputFlows;c++)this.outFlows[c]._activateSignal(H)}getClassName(){return ty.ClassName}}ty.ClassName="FGSequenceBlock",(0,d.d)(ty.ClassName,ty);const oy=new RegExp(/\{(\w+)\}/g);class sy{constructor(H,c){this.path=H,this.ownerBlock=c,this.templatedInputs=[];let y=oy.exec(H);for(;y;){const[,Z]=y;this.templatedInputs.push(c.registerDataInput(Z,Fy)),y=oy.exec(H)}}getAccessor(H,c){let y=this.path;for(const Z of this.templatedInputs){const H=Z.getValue(c).value;y=y.replace(`{${Z.name}}`,H.toString())}return H.convert(y)}}class qy extends iy{constructor(H){super(H),this.config=H,this.value=this.registerDataOutput("value",Bc),this.templateComponent=new sy(H.path,this)}_updateOutputs(H){const c=this.templateComponent.getAccessor(this.config.pathConverter,H),y=c.info.get(c.object);this.value.setValue(y,H)}getClassName(){return qy.ClassName}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.config.path=this.config.path}}qy.ClassName="FGGetPropertyBlock",(0,d.d)(qy.ClassName,qy);class Iy extends Ty{constructor(H){super(H),this.config=H,this.a=this.registerDataInput("a",Bc),this.templateComponent=new sy(H.path,this)}_execute(H){const c=this.a.getValue(H),y=this.templateComponent.getAccessor(this.config.pathConverter,H);y.info.set(c,y.object),this.out._activateSignal(H)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.config.path=this.config.path}getClassName(){return Iy.ClassName}}Iy.ClassName="FGSetPropertyBlock",(0,d.d)("FGSetPropertyBlock",Iy);const jy="cachedOperationValue",ky="cachedExecutionId";class Wy extends iy{constructor(H,c){super(c),this.value=this.registerDataOutput("value",H)}_updateOutputs(H){const c=H._getExecutionVariable(this,ky),y=H._getExecutionVariable(this,jy);if(void 0!==y&&c===H.executionId)this.value.setValue(y,H);else{const c=this._doOperation(H);H._setExecutionVariable(this,jy,c),H._setExecutionVariable(this,ky,H.executionId),this.value.setValue(c,H)}}}class My extends Wy{constructor(H,c,y,Z,F,P){super(y,P),this._operation=Z,this._className=F,this.a=this.registerDataInput("a",H),this.b=this.registerDataInput("b",c)}_doOperation(H){return this._operation(this.a.getValue(H),this.b.getValue(H))}getClassName(){return this._className}}class xy extends Wy{constructor(H,c,y,Z){super(H,Z),this._operation=c,this._className=y}_doOperation(H){return this._operation()}getClassName(){return this._className}}class Ry extends Wy{constructor(H,c,y,Z,F){super(c,F),this._operation=y,this._className=Z,this.a=this.registerDataInput("a",H)}_doOperation(H){return this._operation(this.a.getValue(H))}getClassName(){return this._className}}class Ay extends Wy{constructor(H,c,y,Z,F,P,S){super(Z,S),this._operation=F,this._className=P,this.a=this.registerDataInput("a",H),this.b=this.registerDataInput("b",c),this.c=this.registerDataInput("c",y)}_doOperation(H){return this._operation(this.a.getValue(H),this.b.getValue(H),this.c.getValue(H))}getClassName(){return this._className}}function ey(H){return H.getClassName?H.getClassName():""}function ry(H,c){return"Vector2"===H&&"Vector2"===c||"o"===H&&"o"===c||"Vector4"===H&&"Vector4"===c}function Ny(H,c){return"Matrix"===H&&"Matrix"===c}function wy(H,c){return"FlowGraphInteger"===H&&"FlowGraphInteger"===c}class Ly extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicAdd(H,c)),Ly.ClassName,H)}_polymorphicAdd(H,c){const y=ey(H),Z=ey(c);return ry(y,Z)||Ny(y,Z)||wy(y,Z)?H.add(c):H+c}}Ly.ClassName="FGAddBlock",(0,d.d)(Ly.ClassName,Ly);class by extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicAdd(H,c)),by.ClassName,H)}_polymorphicAdd(H,c){const y=ey(H),Z=ey(c);return ry(y,Z)||wy(y,Z)?H.Rc(c):Ny(y,Z)?H.add(c.scale(-1)):H-c}}by.ClassName="FGSubBlock",(0,d.d)(by.ClassName,by);class Xy extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicMultiply(H,c)),Xy.ClassName,H)}_polymorphicMultiply(H,c){const y=ey(H),Z=ey(c);return ry(y,Z)||wy(y,Z)?H.multiply(c):Ny(y,Z)?F.d.FromValues(H.m[0]*c.m[0],H.m[4]*c.m[4],H.m[8]*c.m[8],H.m[12]*c.m[12],H.m[1]*c.m[1],H.m[5]*c.m[5],H.m[9]*c.m[9],H.m[13]*c.m[13],H.m[2]*c.m[2],H.m[6]*c.m[6],H.m[10]*c.m[10],H.m[14]*c.m[14],H.m[3]*c.m[3],H.m[7]*c.m[7],H.m[11]*c.m[11],H.m[15]*c.m[15]):H*c}}Xy.ClassName="FGMultiplyBlock",(0,d.d)(Xy.ClassName,Xy);class By extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicDivide(H,c)),By.ClassName,H)}_polymorphicDivide(H,c){const y=ey(H),Z=ey(c);return ry(y,Z)||wy(y,Z)?H.divide(c):Ny(y,Z)?F.d.FromValues(H.m[0]/c.m[0],H.m[4]/c.m[4],H.m[8]/c.m[8],H.m[12]/c.m[12],H.m[1]/c.m[1],H.m[5]/c.m[5],H.m[9]/c.m[9],H.m[13]/c.m[13],H.m[2]/c.m[2],H.m[6]/c.m[6],H.m[10]/c.m[10],H.m[14]/c.m[14],H.m[3]/c.m[3],H.m[7]/c.m[7],H.m[11]/c.m[11],H.m[15]/c.m[15]):H/c}}By.ClassName="FGDivideBlock",(0,d.d)(By.ClassName,By);class Yy extends xy{constructor(H){super(Yc,(()=>Math.random()),Yy.ClassName,H)}}Yy.ClassName="FGRandomBlock",(0,d.d)(Yy.ClassName,Yy);class HZ extends My{constructor(H){super(Bc,Bc,Yc,((H,c)=>this._polymorphicDot(H,c)),HZ.ClassName,H)}_polymorphicDot(H,c){switch(ey(H)){case"Vector2":return F.l.Dot(H,c);case"o":return F.n.Dot(H,c);case"Vector4":return F.q.Dot(H,c);default:throw new Error(`Cannot get dot product of ${H} and ${c}`)}}}HZ.ClassName="FGDotBlock",(0,d.d)(HZ.ClassName,HZ);class cZ extends xy{constructor(H){super(Yc,(()=>Math.E),cZ.ClassName,H)}}cZ.ClassName="FGEBlock",(0,d.d)(cZ.ClassName,cZ);class yZ extends xy{constructor(H){super(Yc,(()=>Math.PI),yZ.ClassName,H)}}yZ.ClassName="FGPIBlock",(0,d.d)(yZ.ClassName,yZ);class ZZ extends xy{constructor(H){super(Yc,(()=>Number.POSITIVE_INFINITY),ZZ.ClassName,H)}}ZZ.ClassName="FGInfBlock",(0,d.d)(ZZ.ClassName,ZZ);class FZ extends xy{constructor(H){super(Yc,(()=>Number.NaN),FZ.ClassName,H)}}function PZ(H,c){switch(ey(H)){case"FlowGraphInteger":return new bc(c(H.value));case"Vector2":return new F.l(c(H.x),c(H.y));case"o":return new F.n(c(H.x),c(H.y),c(H.z));case"Vector4":return new F.q(c(H.x),c(H.y),c(H.z),c(H.w));case"Matrix":return F.d.FromValues(c(H.m[0]),c(H.m[4]),c(H.m[8]),c(H.m[12]),c(H.m[1]),c(H.m[5]),c(H.m[9]),c(H.m[13]),c(H.m[2]),c(H.m[6]),c(H.m[10]),c(H.m[14]),c(H.m[3]),c(H.m[7]),c(H.m[11]),c(H.m[15]));default:return c(H)}}FZ.ClassName="FGNaNBlock",(0,d.d)(FZ.ClassName,FZ);class SZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicAbs(H)),SZ.ClassName,H)}_polymorphicAbs(H){return PZ(H,Math.abs)}}SZ.ClassName="FGAbsBlock",(0,d.d)(SZ.ClassName,SZ);class nZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicSign(H)),nZ.ClassName,H)}_polymorphicSign(H){return PZ(H,Math.sign)}}nZ.ClassName="FGSignBlock",(0,d.d)(nZ.ClassName,nZ);class OZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicTrunc(H)),OZ.ClassName,H)}_polymorphicTrunc(H){return PZ(H,Math.trunc)}}OZ.ClassName="FGTruncBlock",(0,d.d)(OZ.ClassName,OZ);class aZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicFloor(H)),aZ.ClassName,H)}_polymorphicFloor(H){return PZ(H,Math.floor)}}aZ.ClassName="FGFloorBlock",(0,d.d)(aZ.ClassName,aZ);class iZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicCeiling(H)),iZ.ClassName,H)}_polymorphicCeiling(H){return PZ(H,Math.ceil)}}iZ.ClassName="FGCeilBlock",(0,d.d)(iZ.ClassName,iZ);class CZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicFract(H)),CZ.ClassName,H)}_polymorphicFract(H){return PZ(H,(H=>H-Math.floor(H)))}}CZ.ClassName="FGFractBlock",(0,d.d)(CZ.ClassName,CZ);class gZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicNeg(H)),gZ.ClassName,H)}_polymorphicNeg(H){return PZ(H,(H=>-H))}}function vZ(H,c,y){switch(ey(H)){case"FlowGraphInteger":return new bc(y(H.value,c.value));case"Vector2":return new F.l(y(H.x,c.x),y(H.y,c.y));case"o":return new F.n(y(H.x,c.x),y(H.y,c.y),y(H.z,c.z));case"Vector4":return new F.q(y(H.x,c.x),y(H.y,c.y),y(H.z,c.z),y(H.w,c.w));case"Matrix":return F.d.FromValues(y(H.m[0],c.m[0]),y(H.m[4],c.m[4]),y(H.m[8],c.m[8]),y(H.m[12],c.m[12]),y(H.m[1],c.m[1]),y(H.m[5],c.m[5]),y(H.m[9],c.m[9]),y(H.m[13],c.m[13]),y(H.m[2],c.m[2]),y(H.m[6],c.m[6]),y(H.m[10],c.m[10]),y(H.m[14],c.m[14]),y(H.m[3],c.m[3]),y(H.m[7],c.m[7]),y(H.m[11],c.m[11]),y(H.m[15],c.m[15]));default:return y(H,c)}}gZ.ClassName="FGNegBlock",(0,d.d)(gZ.ClassName,gZ);class mZ extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicRemainder(H,c)),mZ.ClassName,H)}_polymorphicRemainder(H,c){return vZ(H,c,((H,c)=>H%c))}}mZ.ClassName="FGRemainderBlock",(0,d.d)(mZ.ClassName,mZ);class zZ extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicMin(H,c)),zZ.ClassName,H)}_polymorphicMin(H,c){return vZ(H,c,Math.min)}}zZ.ClassName="FGMinBlock",(0,d.d)(zZ.ClassName,zZ);class VZ extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicMax(H,c)),VZ.ClassName,H)}_polymorphicMax(H,c){return vZ(H,c,Math.max)}}function hZ(H,c,y){return Math.min(Math.max(H,Math.min(c,y)),Math.max(c,y))}function QZ(H,c,y,Z){switch(ey(H)){case"FlowGraphInteger":return new bc(Z(H.value,c.value,y.value));case"Vector2":return new F.l(Z(H.x,c.x,y.x),Z(H.y,c.y,y.y));case"o":return new F.n(Z(H.x,c.x,y.x),Z(H.y,c.y,y.y),Z(H.z,c.z,y.z));case"Vector4":return new F.q(Z(H.x,c.x,y.x),Z(H.y,c.y,y.y),Z(H.z,c.z,y.z),Z(H.w,c.w,y.w));case"Matrix":return F.d.FromValues(Z(H.m[0],c.m[0],y.m[0]),Z(H.m[4],c.m[4],y.m[4]),Z(H.m[8],c.m[8],y.m[8]),Z(H.m[12],c.m[12],y.m[12]),Z(H.m[1],c.m[1],y.m[1]),Z(H.m[5],c.m[5],y.m[5]),Z(H.m[9],c.m[9],y.m[9]),Z(H.m[13],c.m[13],y.m[13]),Z(H.m[2],c.m[2],y.m[2]),Z(H.m[6],c.m[6],y.m[6]),Z(H.m[10],c.m[10],y.m[10]),Z(H.m[14],c.m[14],y.m[14]),Z(H.m[3],c.m[3],y.m[3]),Z(H.m[7],c.m[7],y.m[7]),Z(H.m[11],c.m[11],y.m[11]),Z(H.m[15],c.m[15],y.m[15]));default:return Z(H,c,y)}}VZ.ClassName="FGMaxBlock",(0,d.d)(VZ.ClassName,VZ);class DZ extends Ay{constructor(H){super(Bc,Bc,Bc,Bc,((H,c,y)=>this._polymorphicClamp(H,c,y)),DZ.ClassName,H)}_polymorphicClamp(H,c,y){return QZ(H,c,y,hZ)}}function fZ(H){return Math.min(Math.max(H,0),1)}DZ.ClassName="FGClampBlock",(0,d.d)(DZ.ClassName,DZ);class JZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicSaturate(H)),JZ.ClassName,H)}_polymorphicSaturate(H){return PZ(H,fZ)}}JZ.ClassName="FGSaturateBlock",(0,d.d)(JZ.ClassName,JZ);class lZ extends Ay{constructor(H){super(Bc,Bc,Bc,Bc,((H,c,y)=>this._polymorphicInterpolate(H,c,y)),lZ.ClassName,H)}_interpolate(H,c,y){return(1-y)*H+y*c}_polymorphicInterpolate(H,c,y){return QZ(H,c,y,this._interpolate)}}lZ.ClassName="FGInterpolateBlock",(0,d.d)(lZ.ClassName,lZ);class dZ extends My{constructor(H){super(Bc,Bc,Hy,((H,c)=>this._polymorphicEq(H,c)),dZ.ClassName,H)}_polymorphicEq(H,c){const y=ey(H),Z=ey(c);return ry(y,Z)||Ny(y,Z)||wy(y,Z)?H.equals(c):H===c}}function KZ(H,c,y){const Z=ey(H);if(Z===ey(c)){if(""===Z)return y(H,c);if("FlowGraphInteger"===Z)return y(H.value,c.value);throw new Error(`Cannot compare ${H} and ${c}`)}throw new Error(`${H} and ${c} are of different types.`)}dZ.ClassName="FGEqBlock",(0,d.d)(dZ.ClassName,dZ);class TZ extends My{constructor(H){super(Bc,Bc,Hy,((H,c)=>this._polymorphicLessThan(H,c)),TZ.ClassName,H)}_polymorphicLessThan(H,c){return KZ(H,c,((H,c)=>H<c))}}TZ.ClassName="FGLessThanBlock",(0,d.d)(TZ.ClassName,TZ);class uZ extends My{constructor(H){super(Bc,Bc,Hy,((H,c)=>this._polymorphicLessThanOrEqual(H,c)),uZ.ClassName,H)}_polymorphicLessThanOrEqual(H,c){return KZ(H,c,((H,c)=>H<=c))}}uZ.ClassName="FGLessThanOrEqualBlock";class EZ extends My{constructor(H){super(Bc,Bc,Hy,((H,c)=>this._polymorphicGreaterThan(H,c)),EZ.ClassName,H)}_polymorphicGreaterThan(H,c){return KZ(H,c,((H,c)=>H>c))}}EZ.ClassName="FGGreaterThanBlock",(0,d.d)(EZ.ClassName,EZ);class UZ extends My{constructor(H){super(Bc,Bc,Hy,((H,c)=>this._polymorphicGreaterThanOrEqual(H,c)),UZ.ClassName,H)}_polymorphicGreaterThanOrEqual(H,c){return KZ(H,c,((H,c)=>H>=c))}}UZ.ClassName="FGGreaterThanOrEqualBlock",(0,d.d)(UZ.ClassName,UZ);class GZ extends Ry{constructor(H){super(Bc,Hy,(H=>this._polymorphicIsNan(H)),GZ.ClassName,H)}_polymorphicIsNan(H){const c=ey(H);if(""===c)return isNaN(H);if("FlowGraphInteger"===c)return isNaN(H.value);throw new Error(`Cannot get NaN of ${H}`)}}GZ.ClassName="FGIsNanBlock",(0,d.d)(GZ.ClassName,GZ);class pZ extends Ry{constructor(H){super(Bc,Hy,(H=>this._polymorphicIsInf(H)),pZ.ClassName,H)}_polymorphicIsInf(H){const c=ey(H);if(""===c)return!isFinite(H);if("FlowGraphInteger"===c)return!isFinite(H.value);throw new Error(`Cannot get isInf of ${H}`)}}pZ.ClassName="FGIsInfBlock";class tZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicDegToRad(H)),tZ.ClassName,H)}_degToRad(H){return H*Math.PI/180}_polymorphicDegToRad(H){return PZ(H,this._degToRad)}}tZ.ClassName="FGDegToRadBlock",(0,d.d)(tZ.ClassName,tZ);class oZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicRadToDeg(H)),oZ.ClassName,H)}_radToDeg(H){return 180*H/Math.PI}_polymorphicRadToDeg(H){return PZ(H,this._radToDeg)}}oZ.ClassName="FGRadToDegBlock",(0,d.d)(oZ.ClassName,oZ);class sZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicSin(H)),sZ.ClassName,H)}_polymorphicSin(H){return PZ(H,Math.sin)}}sZ.ClassName="FGSinBlock",(0,d.d)(sZ.ClassName,sZ);class qZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicCos(H)),qZ.ClassName,H)}_polymorphicCos(H){return PZ(H,Math.cos)}}qZ.ClassName="FGCosBlock",(0,d.d)(qZ.ClassName,qZ);class IZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicTan(H)),IZ.ClassName,H)}_polymorphicTan(H){return PZ(H,Math.tan)}}IZ.ClassName="FGTanBlock",(0,d.d)(IZ.ClassName,IZ);class jZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicAsin(H)),jZ.ClassName,H)}_polymorphicAsin(H){return PZ(H,Math.asin)}}jZ.ClassName="FGAsinBlock",(0,d.d)(jZ.ClassName,jZ);class kZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicAcos(H)),kZ.ClassName,H)}_polymorphicAcos(H){return PZ(H,Math.acos)}}kZ.ClassName="FGAcosBlock",(0,d.d)(kZ.ClassName,kZ);class WZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicAtan(H)),WZ.ClassName,H)}_polymorphicAtan(H){return PZ(H,Math.atan)}}WZ.ClassName="FGAtanBlock",(0,d.d)(WZ.ClassName,WZ);class MZ extends My{constructor(H){super(Bc,Bc,Bc,((H,c)=>this._polymorphicAtan2(H,c)),MZ.ClassName,H)}_polymorphicAtan2(H,c){return vZ(H,c,Math.atan2)}}MZ.ClassName="FGAtan2Block",(0,d.d)(MZ.ClassName,MZ);class xZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicSinh(H)),xZ.ClassName,H)}_polymorphicSinh(H){return PZ(H,Math.sinh)}}xZ.ClassName="FGSinhBlock",(0,d.d)(xZ.ClassName,xZ);class RZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicCosh(H)),RZ.ClassName,H)}_polymorphicCosh(H){return PZ(H,Math.cosh)}}RZ.ClassName="FGCoshBlock",(0,d.d)(RZ.ClassName,RZ);class AZ extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicTanh(H)),AZ.ClassName,H)}_polymorphicTanh(H){return PZ(H,Math.tanh)}}AZ.ClassName="FGTanhBlock",(0,d.d)(AZ.ClassName,AZ);class eZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicAsinh(H)),eZ.ClassName,H)}_polymorphicAsinh(H){return PZ(H,Math.asinh)}}eZ.ClassName="FGAsinhBlock",(0,d.d)(eZ.ClassName,eZ);class rZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicAcosh(H)),rZ.ClassName,H)}_polymorphicAcosh(H){return PZ(H,Math.acosh)}}rZ.ClassName="FGAcoshBlock",(0,d.d)(rZ.ClassName,rZ);class NZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicAtanh(H)),NZ.ClassName,H)}_polymorphicAtanh(H){return PZ(H,Math.atanh)}}NZ.ClassName="FGAtanhBlock",(0,d.d)(NZ.ClassName,NZ);class wZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicExp(H)),wZ.ClassName,H)}_polymorphicExp(H){return PZ(H,Math.exp)}}wZ.ClassName="FGExpBlock",(0,d.d)(wZ.ClassName,wZ);class LZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicLog(H)),LZ.ClassName,H)}_polymorphicLog(H){return PZ(H,Math.log)}}LZ.ClassName="FGLogBlock",(0,d.d)(LZ.ClassName,LZ);class bZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicLog2(H)),bZ.ClassName,H)}_polymorphicLog2(H){return PZ(H,Math.log2)}}bZ.ClassName="FGLog2Block",(0,d.d)(bZ.ClassName,bZ);class XZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicLog10(H)),XZ.ClassName,H)}_polymorphicLog10(H){return PZ(H,Math.log10)}}XZ.ClassName="FGLog10Block",(0,d.d)(XZ.ClassName,XZ);class BZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicSqrt(H)),BZ.ClassName,H)}_polymorphicSqrt(H){return PZ(H,Math.sqrt)}}BZ.ClassName="FGSqrtBlock",(0,d.d)(BZ.ClassName,BZ);class YZ extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicCubeRoot(H)),YZ.ClassName,H)}_polymorphicCubeRoot(H){return PZ(H,Math.cbrt)}}YZ.ClassName="FGCubeRootBlock",(0,d.d)(YZ.ClassName,YZ);class HF extends My{constructor(H){super(Bc,Yc,Yc,((H,c)=>this._polymorphicPow(H,c)),HF.ClassName,H)}_polymorphicPow(H,c){return vZ(H,c,Math.pow)}}HF.ClassName="FGPowBlock",(0,d.d)(HF.ClassName,HF);class cF extends Ry{constructor(H){super(Bc,Yc,(H=>this._polymorphicLength(H)),cF.ClassName,H)}_polymorphicLength(H){switch(ey(H)){case"Vector2":case"o":case"Vector4":return H.length();default:throw new Error(`Cannot compute length of value ${H}`)}}}cF.ClassName="FGLengthBlock",(0,d.d)(cF.ClassName,cF);class yF extends Ry{constructor(H){super(Bc,Bc,(H=>this._polymorphicNormalize(H)),yF.ClassName,H)}_polymorphicNormalize(H){switch(ey(H)){case"Vector2":case"o":case"Vector4":return H.normalize();default:throw new Error(`Cannot normalize value ${H}`)}}}yF.ClassName="FGNormalizeBlock",(0,d.d)(yF.ClassName,yF);class ZF extends My{constructor(H){super(yy,yy,yy,((H,c)=>F.n.Cross(H,c)),ZF.ClassName,H)}}ZF.ClassName="FGCrossBlock",(0,d.d)(ZF.ClassName,ZF);class FF extends My{constructor(H){super(cy,Yc,cy,((H,c)=>F.l.Transform(H,F.d.RotationZ(c))),FF.ClassName,H)}}FF.ClassName="FGRotate2DBlock",(0,d.d)(FF.ClassName,FF);class PF extends Ay{constructor(H){super(yy,yy,Yc,yy,((H,c,y)=>F.n.TransformCoordinates(H,F.d.RotationAxis(c,y))),PF.ClassName,H)}}PF.ClassName="FGRotate3DBlock",(0,d.d)(PF.ClassName,PF);class SF extends Ry{constructor(H){super(Zy,Zy,(H=>F.d.Transpose(H)),SF.ClassName,H)}}SF.ClassName="FGTransposeBlock",(0,d.d)(SF.ClassName,SF);class nF extends Ry{constructor(H){super(Zy,Yc,(H=>H.determinant()),nF.ClassName,H)}}nF.ClassName="FGDeterminantBlock",(0,d.d)(nF.ClassName,nF);class OF extends Ry{constructor(H){super(Zy,Zy,(H=>F.d.Invert(H)),OF.ClassName,H)}}OF.ClassName="FGInvertMatrixBlock",(0,d.d)(OF.ClassName,OF);class aF extends My{constructor(H){super(Zy,Zy,Zy,((H,c)=>c.multiply(H)),aF.ClassName,H)}}aF.ClassName="FGMatMulBlock",(0,d.d)(aF.ClassName,aF);class iF extends Ry{constructor(H){super(Fy,Fy,(H=>new bc(~H.value)),iF.ClassName,H)}}iF.ClassName="FGBitwiseNotBlock",(0,d.d)(iF.ClassName,iF);class CF extends My{constructor(H){super(Fy,Fy,Fy,((H,c)=>new bc(H.value&c.value)),CF.ClassName,H)}}CF.ClassName="FGBitwiseAndBlock",(0,d.d)(CF.ClassName,CF);class gF extends My{constructor(H){super(Fy,Fy,Fy,((H,c)=>new bc(H.value|c.value)),gF.ClassName,H)}}gF.ClassName="FGBitwiseOrBlock",(0,d.d)(gF.ClassName,gF);class vF extends My{constructor(H){super(Fy,Fy,Fy,((H,c)=>new bc(H.value^c.value)),vF.ClassName,H)}}vF.ClassName="FGBitwiseXorBlock",(0,d.d)(vF.ClassName,vF);class mF extends My{constructor(H){super(Fy,Fy,Fy,((H,c)=>new bc(H.value<<c.value)),mF.ClassName,H)}}mF.ClassName="FGBitwiseLeftShiftBlock",(0,d.d)(mF.ClassName,mF);class zF extends My{constructor(H){super(Fy,Fy,Fy,((H,c)=>new bc(H.value>>c.value)),zF.ClassName,H)}}zF.ClassName="FGBitwiseRightShiftBlock",(0,d.d)(zF.ClassName,zF);class VF extends Ry{constructor(H){super(Fy,Fy,(H=>new bc(Math.clz32(H.value))),VF.ClassName,H)}}VF.ClassName="FGCountLeadingZerosBlock",(0,d.d)(VF.ClassName,VF);class hF extends Ry{constructor(H){super(Fy,Fy,(H=>new bc(H.value?31-Math.clz32(H.value&-H.value):32)),hF.ClassName,H)}}hF.ClassName="FGCountTrailingZerosBlock",(0,d.d)(hF.ClassName,hF);class QF extends Ry{constructor(H){super(Fy,Fy,(H=>new bc(function(H){let c=0;for(;H;)c+=1&H,H>>=1;return c}(H.value))),QF.ClassName,H)}}QF.ClassName="FGCountOneBitsBlock",(0,d.d)(QF.ClassName,QF);class DF extends Ty{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new bc(0)};super(H),this.config=H,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Fy),this.value=this.registerDataOutput("value",Fy)}_execute(H,c){if(c===this.reset)this.value.setValue(this.config.startIndex,H);else{const c=this.value.getValue(H);c.value<this.n.getValue(H).value&&(this.value.setValue(new bc(c.value+1),H),this.out._activateSignal(H))}}getClassName(){return DF.ClassName}}DF.ClassName="FGDoNBlock",(0,d.d)(DF.ClassName,DF);class fF extends iy{constructor(H){super(H),this.config=H,this.output=this.registerDataOutput(H.variableName,Bc)}_updateOutputs(H){const c=this.config.variableName;H.hasVariable(c)&&this.output.setValue(H.getVariable(c),H)}getClassName(){return fF.ClassName}serialize(H){super.serialize(H),H.config.variableName=this.config.variableName}}fF.ClassName="FGGetVariableBlock",(0,d.d)(fF.ClassName,fF);class JF extends Ty{constructor(H){super(H),this.config=H,this.input=this.registerDataInput(H.variableName,Bc)}_execute(H){const c=this.config.variableName,y=this.input.getValue(H);H.setVariable(c,y),this.out._activateSignal(H)}getClassName(){return JF.ClassName}}JF.ClassName="FGSetVariableBlock",(0,d.d)(JF.ClassName,JF);class lF extends Ty{constructor(H){super(H),this.config=H,this.condition=this.registerDataInput("condition",Hy),this.loopBody=this._registerSignalOutput("loopBody")}_execute(H,c){var y;let Z=this.condition.getValue(H);for(null!==(y=this.config)&&void 0!==y&&y.isDo&&!Z&&this.loopBody._activateSignal(H);Z;)this.loopBody._activateSignal(H),Z=this.condition.getValue(H);this.out._activateSignal(H)}getClassName(){return lF.ClassName}serialize(H){var c;super.serialize(H),H.isDo=null===(c=this.config)||void 0===c?void 0:c.isDo}}lF.ClassName="FGWhileLoopBlock",(0,d.d)(lF.ClassName,lF);const dF={"lifecycle/onStart":dy.ClassName,"lifecycle/onTick":Ky.ClassName,log:uy.ClassName,"flow/delay":Uy.ClassName,"customEvent/send":Gy.ClassName,"customEvent/receive":py.ClassName,"flow/sequence":ty.ClassName,"world/get":qy.ClassName,"world/set":Iy.ClassName,"flow/doN":DF.ClassName,"variable/get":fF.ClassName,"variable/set":JF.ClassName,"flow/whileLoop":lF.ClassName,"math/random":Yy.ClassName,"math/e":cZ.ClassName,"math/pi":yZ.ClassName,"math/inf":ZZ.ClassName,"math/nan":FZ.ClassName,"math/abs":SZ.ClassName,"math/sign":nZ.ClassName,"math/trunc":OZ.ClassName,"math/floor":aZ.ClassName,"math/ceil":iZ.ClassName,"math/fract":CZ.ClassName,"math/neg":gZ.ClassName,"math/add":Ly.ClassName,"math/sub":by.ClassName,"math/mul":Xy.ClassName,"math/div":By.ClassName,"math/rem":mZ.ClassName,"math/min":zZ.ClassName,"math/max":VZ.ClassName,"math/clamp":DZ.ClassName,"math/saturate":JZ.ClassName,"math/mix":lZ.ClassName,"math/eq":dZ.ClassName,"math/lt":TZ.ClassName,"math/le":uZ.ClassName,"math/gt":EZ.ClassName,"math/ge":UZ.ClassName,"math/isnan":GZ.ClassName,"math/isinf":pZ.ClassName,"math/rad":tZ.ClassName,"math/deg":oZ.ClassName,"math/sin":sZ.ClassName,"math/cos":qZ.ClassName,"math/tan":IZ.ClassName,"math/asin":jZ.ClassName,"math/acos":kZ.ClassName,"math/atan":WZ.ClassName,"math/atan2":MZ.ClassName,"math/sinh":xZ.ClassName,"math/cosh":RZ.ClassName,"math/tanh":AZ.ClassName,"math/asinh":eZ.ClassName,"math/acosh":rZ.ClassName,"math/atanh":NZ.ClassName,"math/exp":wZ.ClassName,"math/log":LZ.ClassName,"math/log2":bZ.ClassName,"math/log10":XZ.ClassName,"math/sqrt":BZ.ClassName,"math/cbrt":YZ.ClassName,"math/pow":HF.ClassName,"math/length":cF.ClassName,"math/normalize":yF.ClassName,"math/dot":HZ.ClassName,"math/cross":ZF.ClassName,"math/rotate2d":FF.ClassName,"math/rotate3d":PF.ClassName,"math/transpose":SF.ClassName,"math/determinant":nF.ClassName,"math/inverse":OF.ClassName,"math/matmul":aF.ClassName,"math/not":iF.ClassName,"math/and":CF.ClassName,"math/or":gF.ClassName,"math/xor":vF.ClassName,"math/asr":zF.ClassName,"math/lsl":mF.ClassName,"math/clz":VF.ClassName,"math/ctz":hF.ClassName,"math/popcnt":QF.ClassName},KF={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function TF(H,c,y){if(void 0!==H.type){const Z=c.types&&c.types[H.type];if(!Z)throw new Error(`${y}: Unknown type: ${H.type}`);const F=Z.signature;if(!F)throw new Error(`${y}: Type ${H.type} has no signature`);const P=KF[F];return{value:H.value,className:P}}return H.value}function uF(H,c,y){const Z=dF[c.type];if(!Z)throw new Error(`/extensions/KHR_interactivity/nodes/${H}: Unknown block type: ${c.type}`);const F=H.toString(),P=function(H,c,y){const Z={},F=H.configuration??[];for(const P of F)if("customEvent"===P.id){const H=c.customEvents&&c.customEvents[P.value];if(!H)throw new Error(`/extensions/KHR_interactivity/nodes/${y}: Unknown custom event: ${P.value}`);Z.eventId=H.id,Z.eventData=H.values.map((H=>H.id))}else if("variable"===P.id){const H=c.variables&&c.variables[P.value];if(!H)throw new Error(`/extensions/KHR_interactivity/nodes/${y}: Unknown variable: ${P.value}`);Z.variableName=H.id}else if("path"===P.id){const H=P.value;Z.path=H}else Z[P.id]=TF(P,c,`/extensions/KHR_interactivity/nodes/${y}`);return Z}(c,y,F);return{className:Z,config:P,uniqueId:F,metadata:c.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class EF extends dc{constructor(H){super(H,GF)}}const UF={__array__:{__target__:!0,translation:{type:"o",get:H=>H._babylonTransformNode.position,set:(H,c)=>{c._babylonTransformNode.position=H},getObject:H=>H._babylonTransformNode}}},GF={nodes:UF},pF="KHR_interactivity";class tF{constructor(H){this._loader=H,this.name=pF,this.enabled=this._loader.isExtensionUsed(pF),this._pathConverter=new EF(this._loader.Oi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var H;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,y=function(H){const c={uniqueId:(0,wc.e)(),_userVariables:{},_connectionValues:{}},y=[c],Z=[];for(let P=0;P<H.nodes.length;P++){const c=uF(P,H.nodes[P],H);Z.push(c)}for(let P=0;P<H.nodes.length;P++){const y=H.nodes[P],F=Z[P],S=y.flows??[];for(const H of S){const c=H.id,y={uniqueId:(0,wc.e)(),name:c,_connectionType:1,connectedPointIds:[]};F.signalOutputs.push(y);const S=H.node,n=H.socket,O=Z[S];if(!O)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Could not find node with id ${S} that connects its input with with node ${P}'s output ${c}`);let a=O.signalInputs.find((H=>H.name===n));a||(a={uniqueId:(0,wc.e)(),name:n,_connectionType:0,connectedPointIds:[]},O.signalInputs.push(a)),a.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(a.uniqueId)}const n=y.values??[];for(const O of n){const y=O.id,S={uniqueId:(0,wc.e)(),name:y,_connectionType:0,connectedPointIds:[]};if(F.dataInputs.push(S),void 0!==O.value){const y=TF(O,H,`/extensions/KHR_interactivity/nodes/${P}`);c._connectionValues[S.uniqueId]=y}else{if(void 0===O.node||void 0===O.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Invalid socket ${y} in node ${P}`);{const H=O.node,c=O.socket,F=Z[H];if(!F)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Could not find node with id ${H} that connects its output with node${P}'s input ${y}`);let n=F.dataOutputs.find((H=>H.name===c));n||(n={uniqueId:(0,wc.e)(),name:c,_connectionType:1,connectedPointIds:[]},F.dataOutputs.push(n)),S.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(S.uniqueId)}}}}const F=H.variables??[];for(let P=0;P<F.length;P++){const y=F[P],Z=y.id;c._userVariables[Z]=TF(y,H,`/extensions/KHR_interactivity/variables/${P}`)}return{allBlocks:Z,executionContexts:y}}(null===(H=this._loader.Oi.extensions)||void 0===H?void 0:H.KHR_interactivity),Z=new ly({Gd:c});Jy.Parse(y,{coordinator:Z,pathConverter:this._pathConverter}),Z.start()}}w(pF),N(pF,!0,(H=>new tF(H)));const oF="KHR_node_visibility";class sF{constructor(H){this.name=oF,this._loader=H,this.enabled=H.isExtensionUsed(oF)}async onReady(){var H;null===(H=this._loader.Oi.nodes)||void 0===H||H.forEach((H=>{var c,y,Z,F;(null===(c=H._primitiveBabylonMeshes)||void 0===c||c.forEach((H=>{H.inheritVisibility=!0})),null!==(y=H.extensions)&&void 0!==y&&y.KHR_node_visibility)&&(!1===(null===(Z=H.extensions)||void 0===Z?void 0:Z.KHR_node_visibility.visible)&&(H._babylonTransformNode&&(H._babylonTransformNode.isVisible=!1),null===(F=H._primitiveBabylonMeshes)||void 0===F||F.forEach((H=>{H.isVisible=!1}))))}))}dispose(){this._loader=null}}w(oF),N(oF,!0,(H=>new sF(H)));const qF="ExtrasAsMetadata";class IF{_assignExtras(H,c){if(c.extras&&Object.keys(c.extras).length>0){const y=H.metadata=H.metadata||{};(y.Oi=y.Oi||{}).extras=c.extras}}constructor(H){this.name=qF,this.enabled=!0,this._loader=H}dispose(){this._loader=null}loadNodeAsync(H,c,y){return this._loader.loadNodeAsync(H,c,(H=>{this._assignExtras(H,c),y(H)}))}loadCameraAsync(H,c,y){return this._loader.loadCameraAsync(H,c,(H=>{this._assignExtras(H,c),y(H)}))}createMaterial(H,c,y){const Z=this._loader.createMaterial(H,c,y);return this._assignExtras(Z,c),Z}}w(qF),N(qF,!1,(H=>new IF(H)))},12325:(H,c,y)=>{"use strict";y.d(c,{b:()=>p,e:()=>K,i:()=>d,k:()=>T});var Z=y(10763),F=y(10754),P=y(11474),S=y(11354),n=y(11403),O=y(11399),a=y(10773),i=y(10810),C=y(12330),g=y(12336),v=y(11360);class m{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this._j=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(H){this._environmentTexture=H}getNodes(){let H=[];return H=H.concat(this.meshes),H=H.concat(this.lights),H=H.concat(this.cameras),H=H.concat(this.transformNodes),this.skeletons.forEach((c=>H=H.concat(c.bones))),H}}class z extends m{}class V{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((H=>{H.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((H=>{H.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((H=>{H.dispose()})),this.animationGroups.length=0}}class h extends m{constructor(H){super(),this._wasAddedToScene=!1,(H=H||i.b.LastCreatedScene)&&(this.Gd=H,this.proceduralTextures=[],H.jj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=H.getEngine().onContextRestoredObservable.add((()=>{for(const H of this.geometries)H._rebuild();for(const H of this.meshes)H._rebuild();for(const H of this.qj)H.rebuild();for(const H of this.textures)H._rebuild()})))}_topologicalSort(H){const c=new Map;for(const S of H)c.set(S.uniqueId,S);const y={dependsOn:new Map,dependedBy:new Map};for(const S of H){const H=S.uniqueId;y.dependsOn.set(H,new Set),y.dependedBy.set(H,new Set)}for(const S of H){const H=S.uniqueId,Z=y.dependsOn.get(H);if(S instanceof C.b){const F=S.sourceMesh;c.has(F.uniqueId)&&(Z.add(F.uniqueId),y.dependedBy.get(F.uniqueId).add(H))}const F=y.dependedBy.get(H);for(const P of S.getDescendants()){const Z=P.uniqueId;if(c.has(Z)){F.add(Z);y.dependsOn.get(Z).add(H)}}}const Z=[],F=[];for(const S of H){const H=S.uniqueId;0===y.dependsOn.get(H).size&&(F.push(S),c.delete(H))}const P=F;for(;P.length>0;){const H=P.shift();Z.push(H);const F=y.dependedBy.get(H.uniqueId);for(const Z of Array.from(F.values())){const F=y.dependsOn.get(Z);F.delete(H.uniqueId),0===F.size&&c.get(Z)&&(P.push(c.get(Z)),c.delete(Z))}}return c.size>0&&(a.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((H=>a.d.Error(H.name)))),Z}_addNodeAndDescendantsToList(H,c,y,Z){if(y&&(!Z||Z(y))&&!c.has(y.uniqueId)){H.push(y),c.add(y.uniqueId);for(const F of y.getDescendants(!0))this._addNodeAndDescendantsToList(H,c,F,Z)}}_isNodeInContainer(H){return H instanceof O.d&&-1!==this.meshes.indexOf(H)||(H instanceof n.c&&-1!==this.transformNodes.indexOf(H)||(H instanceof g.b&&-1!==this.lights.indexOf(H)||H instanceof v.b&&-1!==this.cameras.indexOf(H)))}_isValidHierarchy(){for(const H of this.meshes)if(H.parent&&!this._isNodeInContainer(H.parent))return a.d.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.transformNodes)if(H.parent&&!this._isNodeInContainer(H.parent))return a.d.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.lights)if(H.parent&&!this._isNodeInContainer(H.parent))return a.d.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.cameras)if(H.parent&&!this._isNodeInContainer(H.parent))return a.d.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(H){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||F.c.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Z={},P={},n=new V,O=[],a=[],i={doNotInstantiate:!0,...y},C=[],g=new Set;for(const F of this.transformNodes)null===F.parent&&this._addNodeAndDescendantsToList(C,g,F,i.predicate);for(const F of this.meshes)null===F.parent&&this._addNodeAndDescendantsToList(C,g,F,i.predicate);const v=this._topologicalSort(C),m=(y,F)=>{if(((c,y)=>{if(Z[c.uniqueId]=y.uniqueId,P[y.uniqueId]=y,H&&(y.name=H(c.name)),y instanceof S.c){const H=y;if(H.morphTargetManager){const y=c.morphTargetManager;H.morphTargetManager=y.clone();for(let c=0;c<y.numTargets;c++){const F=y.getTarget(c),S=H.morphTargetManager.getTarget(c);Z[F.uniqueId]=S.uniqueId,P[S.uniqueId]=S}}}})(y,F),y.parent){const H=Z[y.parent.uniqueId],c=P[H];F.parent=c||y.parent}if(F.position&&y.position&&F.position.p(y.position),F.rotationQuaternion&&y.rotationQuaternion&&F.rotationQuaternion.p(y.rotationQuaternion),F.rotation&&y.rotation&&F.rotation.p(y.rotation),F.de&&y.de&&F.de.p(y.de),F.material){const S=F;if(S.material)if(c){const c=y.material;if(-1===a.indexOf(c)){let y=c.clone(H?H(c.name):"Clone of "+c.name);if(a.push(c),Z[c.uniqueId]=y.uniqueId,P[y.uniqueId]=y,"MultiMaterial"===c.getClassName()){const F=c;for(const c of F.ag)c&&(y=c.clone(H?H(c.name):"Clone of "+c.name),a.push(c),Z[c.uniqueId]=y.uniqueId,P[y.uniqueId]=y);F.ag=F.ag.map((H=>H&&P[Z[H.uniqueId]]))}}"InstancedMesh"!==S.getClassName()&&(S.material=P[Z[c.uniqueId]])}else"MultiMaterial"===S.material.getClassName()?-1===this.Gd.multiMaterials.indexOf(S.material)&&this.Gd.addMultiMaterial(S.material):-1===this.Gd.materials.indexOf(S.material)&&this.Gd.addMaterial(S.material)}null===F.parent&&n.rootNodes.push(F)};return v.forEach((H=>{if("InstancedMesh"===H.getClassName()){const c=H,y=c.sourceMesh,F=Z[y.uniqueId],S=("number"===typeof F?P[F]:y).createInstance(c.name);m(c,S)}else{let c=!0;"qb"===H.getClassName()||"Node"===H.getClassName()||H.skeleton||!H.getTotalVertices||0===H.getTotalVertices()?c=!1:i.doNotInstantiate&&(c="function"===typeof i.doNotInstantiate?!i.doNotInstantiate(H):!i.doNotInstantiate);const y=c?H.createInstance(`instance of ${H.name}`):H.clone(`Clone of ${H.name}`,null,!0);if(!y)throw new Error(`Could not clone or instantiate node on Asset Container ${H.name}`);m(H,y)}})),this.skeletons.forEach((c=>{if(i.predicate&&!i.predicate(c))return;const y=c.clone(H?H(c.name):"Clone of "+c.name);for(const H of this.meshes)if(H.skeleton===c&&!H.isAnInstance){const c=P[Z[H.uniqueId]];if(!c||c.isAnInstance)continue;if(c.skeleton=y,-1!==O.indexOf(y))continue;O.push(y);for(const H of y.bones)H._linkedTransformNode&&(H._linkedTransformNode=P[Z[H._linkedTransformNode.uniqueId]])}n.skeletons.push(y)})),this.animationGroups.forEach((c=>{if(i.predicate&&!i.predicate(c))return;const y=c.clone(H?H(c.name):"Clone of "+c.name,(H=>P[Z[H.uniqueId]]||H));n.animationGroups.push(y)})),n}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||F.c.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Gd.environmentTexture=this.environmentTexture);for(const H of this.Gd._serializableComponents)H.addFromContainer(this);this.Gd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];this.cameras.forEach((y=>{H&&!H(y)||(this.Gd.addCamera(y),c.push(y))})),this.lights.forEach((y=>{H&&!H(y)||(this.Gd.addLight(y),c.push(y))})),this.meshes.forEach((y=>{H&&!H(y)||(this.Gd.li(y),c.push(y))})),this.skeletons.forEach((c=>{H&&!H(c)||this.Gd.addSkeleton(c)})),this.animations.forEach((c=>{H&&!H(c)||this.Gd.addAnimation(c)})),this.animationGroups.forEach((c=>{H&&!H(c)||this.Gd.addAnimationGroup(c)})),this.multiMaterials.forEach((c=>{H&&!H(c)||this.Gd.addMultiMaterial(c)})),this.materials.forEach((c=>{H&&!H(c)||this.Gd.addMaterial(c)})),this.morphTargetManagers.forEach((c=>{H&&!H(c)||this.Gd.addMorphTargetManager(c)})),this.geometries.forEach((c=>{H&&!H(c)||this.Gd.addGeometry(c)})),this.transformNodes.forEach((y=>{H&&!H(y)||(this.Gd.addTransformNode(y),c.push(y))})),this.actionManagers.forEach((c=>{H&&!H(c)||this.Gd.addActionManager(c)})),this.textures.forEach((c=>{H&&!H(c)||this.Gd.addTexture(c)})),this.reflectionProbes.forEach((c=>{H&&!H(c)||this.Gd.addReflectionProbe(c)}));for(const y of c)y.parent&&-1===this.Gd.getNodes().indexOf(y.parent)&&(y.setParent?y.setParent(null):y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||F.c.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Gd.environmentTexture&&(this.Gd.environmentTexture=null);for(const H of this.Gd._serializableComponents)H.removeFromContainer(this)}removeFromScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((c=>{H&&!H(c)||this.Gd.removeCamera(c)})),this.lights.forEach((c=>{H&&!H(c)||this.Gd.removeLight(c)})),this.meshes.forEach((c=>{H&&!H(c)||this.Gd.sd(c,!0)})),this.skeletons.forEach((c=>{H&&!H(c)||this.Gd.removeSkeleton(c)})),this.animations.forEach((c=>{H&&!H(c)||this.Gd.removeAnimation(c)})),this.animationGroups.forEach((c=>{H&&!H(c)||this.Gd.removeAnimationGroup(c)})),this.multiMaterials.forEach((c=>{H&&!H(c)||this.Gd.removeMultiMaterial(c)})),this.materials.forEach((c=>{H&&!H(c)||this.Gd.removeMaterial(c)})),this.morphTargetManagers.forEach((c=>{H&&!H(c)||this.Gd.removeMorphTargetManager(c)})),this.geometries.forEach((c=>{H&&!H(c)||this.Gd.removeGeometry(c)})),this.transformNodes.forEach((c=>{H&&!H(c)||this.Gd.removeTransformNode(c)})),this.actionManagers.forEach((c=>{H&&!H(c)||this.Gd.removeActionManager(c)})),this.textures.forEach((c=>{H&&!H(c)||this.Gd.removeTexture(c)})),this.reflectionProbes.forEach((c=>{H&&!H(c)||this.Gd.removeReflectionProbe(c)}))}dispose(){this.cameras.slice(0).forEach((H=>{H.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((H=>{H.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((H=>{H.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((H=>{H.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((H=>{H.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((H=>{H.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((H=>{H.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((H=>{H.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((H=>{H.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((H=>{H.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((H=>{H.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((H=>{H.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((H=>{H.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const H of this.Gd._serializableComponents)H.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Gd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(H,c,y){if(H&&c)for(const Z of H){let H=!0;if(y)for(const c of y)if(Z===c){H=!1;break}H&&(c.push(Z),Z._parentContainer=this)}}moveAllFromScene(H){this._wasAddedToScene=!1,void 0===H&&(H=new z);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.Gd[c],this[c],H[c]));this.environmentTexture=this.Gd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const H=new S.c("assetContainerRootMesh",this.Gd);return this.meshes.forEach((c=>{c.parent||H.addChild(c)})),this.meshes.unshift(H),H}mergeAnimationsTo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.b.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!H)return a.d.Error("No scene available to merge animations to"),[];const Z=y||(c=>{let y=null;const Z=c.animations.length?c.animations[0].targetProperty:"",F=c.name.split(".").join("").split("_primitive")[0];switch(Z){case"position":case"rotationQuaternion":y=H.getTransformNodeByName(c.name)||H.getTransformNodeByName(F);break;case"influence":y=H.getMorphTargetByName(c.name)||H.getMorphTargetByName(F);break;default:y=H.getNodeByName(c.name)||H.getNodeByName(F)}return y});this.getNodes().forEach((H=>{const c=Z(H);if(null!==c){for(const y of H.animations){const H=c.animations.filter((H=>H.targetProperty===y.targetProperty));for(const y of H){const H=c.animations.indexOf(y,0);H>-1&&c.animations.splice(H,1)}}c.animations=c.animations.concat(H.animations)}}));const F=[];return this.animationGroups.slice().forEach((H=>{F.push(H.clone(H.name,Z)),H.animatables.forEach((H=>{H.stop()}))})),c.forEach((c=>{const y=Z(c.target);y&&(H.beginAnimation(y,c.fromFrame,c.toFrame,c.loopAnimation,c.speedRatio,c.onAnimationEnd?c.onAnimationEnd:void 0,void 0,!0,void 0,c.onAnimationLoop?c.onAnimationLoop:void 0),H.stopAnimation(c.target))})),F}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((H=>{H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)})),this.transformNodes.forEach((H=>{H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)})),this.lights.forEach((H=>{H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)})),this.cameras.forEach((H=>{H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)}))}addAllAssetsToContainer(H){if(!H)return;const c=[],y=new Set;for(c.push(H);c.length>0;){const H=c.pop();if(H instanceof S.c?(H.Dj&&-1===this.geometries.indexOf(H.Dj)&&this.geometries.push(H.Dj),this.meshes.push(H)):H instanceof n.c?this.transformNodes.push(H):H instanceof g.b?this.lights.push(H):H instanceof v.b&&this.cameras.push(H),H instanceof O.d){if(H.material&&-1===this.materials.indexOf(H.material)){this.materials.push(H.material);for(const c of H.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}H.skeleton&&-1===this.skeletons.indexOf(H.skeleton)&&this.skeletons.push(H.skeleton),H.morphTargetManager&&-1===this.morphTargetManagers.indexOf(H.morphTargetManager)&&this.morphTargetManagers.push(H.morphTargetManager)}for(const Z of H.getChildren())y.has(Z)||c.push(Z);y.add(H)}this.populateRootNodes()}}var Q=y(10828);class D{constructor(H){this.byteOffset=0,this.buffer=H}loadAsync(H){return this.buffer.readAsync(this.byteOffset,H).then((H=>{this._dataView=new DataView(H.buffer,H.byteOffset,H.byteLength),this._dataByteOffset=0}))}readUint32(){const H=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,H}readUint8Array(H){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,H);return this._dataByteOffset+=H,this.byteOffset+=H,c}readString(H){return(0,Q.g)(this.readUint8Array(H))}skipBytes(H){this._dataByteOffset+=H,this.byteOffset+=H}}var f=y(12340);const J="Z2xURg",l={name:"Oi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:H=>-1!==H.indexOf("asset")&&-1!==H.indexOf("version")||H.startsWith("data:base64,"+J)||H.startsWith("data:;base64,"+J)||H.startsWith("data:application/octet-stream;base64,"+J)||H.startsWith("data:model/gltf-binary;base64,"+J)};var d,K,T,u=y(10819),E=y(10826);function U(H,c,y){try{return Promise.resolve(new Uint8Array(H,c,y))}catch(Z){return Promise.reject(Z)}}!function(H){H[H.AUTO=0]="AUTO",H[H.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(d||(d={})),function(H){H[H.NONE=0]="NONE",H[H.FIRST=1]="FIRST",H[H.ALL=2]="ALL"}(K||(K={})),function(H){H[H.LOADING=0]="LOADING",H[H.READY=1]="READY",H[H.COMPLETE=2]="COMPLETE"}(T||(T={}));class G{constructor(){this.coordinateSystemMode=d.AUTO,this.animationStartMode=K.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=H=>Promise.resolve(H),this.extensionOptions={}}p(H){H&&(this.onParsed=H.onParsed,this.coordinateSystemMode=H.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=H.animationStartMode??this.animationStartMode,this.loadNodeAnimations=H.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=H.loadSkins??this.loadSkins,this.loadMorphTargets=H.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=H.compileMaterials??this.compileMaterials,this.useClipPlane=H.useClipPlane??this.useClipPlane,this.compileShadowGenerators=H.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=H.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=H.useRangeRequests??this.useRangeRequests,this.createInstances=H.createInstances??this.createInstances,this.alwaysComputeBoundingBox=H.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=H.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=H.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=H.skipMaterials??this.skipMaterials,this.useSRGBBuffers=H.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=H.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=H.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=H.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=H.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=H.customRootNode,this.onMeshLoaded=H.onMeshLoaded,this.onSkinLoaded=H.onSkinLoaded,this.onTextureLoaded=H.onTextureLoaded,this.onMaterialLoaded=H.onMaterialLoaded,this.onCameraLoaded=H.onCameraLoaded,this.extensionOptions=H.extensionOptions??this.extensionOptions)}}class p extends G{constructor(H){super(),this.onParsedObservable=new Z.e,this.onMeshLoadedObservable=new Z.e,this.onSkinLoadedObservable=new Z.e,this.onTextureLoadedObservable=new Z.e,this.onMaterialLoadedObservable=new Z.e,this.onCameraLoadedObservable=new Z.e,this.onCompleteObservable=new Z.e,this.onErrorObservable=new Z.e,this.jj=new Z.e,this.onExtensionLoadedObservable=new Z.e,this.validate=!1,this.onValidatedObservable=new Z.e,this._loader=null,this._state=null,this._requests=new Array,this.name=l.name,this.extensions=l.extensions,this.onLoaderStateChangedObservable=new Z.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(H)}set onParsed(H){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),H&&(this._onParsedObserver=this.onParsedObservable.add(H))}set onMeshLoaded(H){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),H&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(H))}set onSkinLoaded(H){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),H&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>H(c.node,c.skinnedNode))))}set onTextureLoaded(H){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),H&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(H))}set onMaterialLoaded(H){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),H&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(H))}set onCameraLoaded(H){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),H&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(H))}set onComplete(H){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(H)}set onError(H){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(H)}set onDispose(H){this._onDisposeObserver&&this.jj.remove(this._onDisposeObserver),this._onDisposeObserver=this.jj.add(H)}set onExtensionLoaded(H){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(H)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(H){this._loggingEnabled!==H&&(this._loggingEnabled=H,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(H){this._capturePerformanceCounters!==H&&(this._capturePerformanceCounters=H,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(H){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(H)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const H of this._requests)H.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=H=>Promise.resolve(H),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.jj.notifyObservers(void 0),this.jj.clear()}loadFile(H,c,y,P,S,n,O,i){if(ArrayBuffer.isView(c))return this._loadBinary(H,c,y,P,O,i),null;this._progressCallback=S;const C=c.name||F.c.GetFilename(c);if(n){if(this.useRangeRequests){this.validate&&a.d.Warn("glTF validation is not supported when range requests are enabled");const y={abort:()=>{},onCompleteObservable:new Z.e},F={readAsync:(y,Z)=>new Promise(((F,P)=>{this._loadFile(H,c,(H=>{F(new Uint8Array(H))}),!0,(H=>{P(H)}),(H=>{H.setRequestHeader("Range",`bytes=${y}-${y+Z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new D(F)).then((H=>{y.onCompleteObservable.notifyObservers(y),P(H)}),O?H=>O(void 0,H):void 0),y}return this._loadFile(H,c,(c=>{this._validate(H,new Uint8Array(c,0,c.byteLength),y,C),this._unpackBinaryAsync(new D({readAsync:(H,y)=>U(c,H,y),byteLength:c.byteLength})).then((H=>{P(H)}),O?H=>O(void 0,H):void 0)}),!0,O)}return this._loadFile(H,c,(c=>{try{this._validate(H,c,y,C),P({json:this._parseJson(c)})}catch{O&&O()}}),!1,O)}_loadBinary(H,c,y,Z,F,P){this._validate(H,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),y,P),this._unpackBinaryAsync(new D({readAsync:(H,y)=>function(H,c,y){try{if(c<0||c>=H.byteLength)throw new RangeError("Offset is out of range.");if(c+y>H.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(H.buffer,H.byteOffset+c,y))}catch(Z){return Promise.reject(Z)}}(c,H,y),byteLength:c.byteLength})).then((H=>{Z(H)}),F?H=>F(void 0,H):void 0)}importMeshAsync(H,c,y,Z,F,P){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${P||""}`),this._loader=this._getLoader(y),this._loader.importMeshAsync(H,c,null,y,Z,F,P))))}loadAsync(H,c,y,Z,F){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(H,c,y,Z,F))))}loadAssetContainerAsync(H,c,y,Z,F){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(c);const P=new h(H),S=[];this.onMaterialLoadedObservable.add((H=>{S.push(H)}));const n=[];this.onTextureLoadedObservable.add((H=>{n.push(H)}));const O=[];this.onCameraLoadedObservable.add((H=>{O.push(H)}));const a=[];return this.onMeshLoadedObservable.add((H=>{H.morphTargetManager&&a.push(H.morphTargetManager)})),this._loader.importMeshAsync(null,H,P,c,y,Z,F).then((H=>(Array.prototype.push.apply(P.geometries,H.geometries),Array.prototype.push.apply(P.meshes,H.meshes),Array.prototype.push.apply(P.qj,H.qj),Array.prototype.push.apply(P.skeletons,H.skeletons),Array.prototype.push.apply(P.animationGroups,H.animationGroups),Array.prototype.push.apply(P.materials,S),Array.prototype.push.apply(P.textures,n),Array.prototype.push.apply(P.lights,H.lights),Array.prototype.push.apply(P.transformNodes,H.transformNodes),Array.prototype.push.apply(P.cameras,O),Array.prototype.push.apply(P.morphTargetManagers,a),P)))}))}canDirectLoad(H){return l.canDirectLoad(H)}directLoad(H,c){if(c.startsWith("base64,"+J)||c.startsWith(";base64,"+J)||c.startsWith("application/octet-stream;base64,"+J)||c.startsWith("model/gltf-binary;base64,"+J)){const y=(0,u.c)(c);return this._validate(H,new Uint8Array(y,0,y.byteLength)),this._unpackBinaryAsync(new D({readAsync:(H,c)=>U(y,H,c),byteLength:y.byteLength}))}return this._validate(H,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(H){return new p(H[l.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((H,c)=>{this.onCompleteObservable.addOnce((()=>{H()})),this.onErrorObservable.addOnce((H=>{c(H)}))}))}_setState(H){this._state!==H&&(this._state=H,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(T[this._state]))}_loadFile(H,c,y,Z,F,P){const S=H._loadFile(c,y,(H=>{this._onProgress(H,S)}),!0,Z,F,P);return S.onCompleteObservable.add((()=>{S._lengthComputable=!0,S._total=S._loaded})),this._requests.push(S),S}_onProgress(H,c){if(!this._progressCallback)return;c._lengthComputable=H.lengthComputable,c._loaded=H.loaded,c._total=H.total;let y=!0,Z=0,F=0;for(const P of this._requests){if(void 0===P._lengthComputable||void 0===P._loaded||void 0===P._total)return;y=y&&P._lengthComputable,Z+=P._loaded,F+=P._total}this._progressCallback({lengthComputable:y,loaded:Z,total:y?F:0})}_validate(H,c){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),f.e.ValidateAsync(c,y,Z,(c=>this.preprocessUrlAsync(y+c).then((c=>H._loadFileAsync(c,void 0,!0,!0).then((H=>new Uint8Array(H,0,H.byteLength))))))).then((H=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(H),this.onValidatedObservable.clear()}),(H=>{this._endPerformanceCounter("Validate JSON"),F.c.Warn(`Failed to validate: ${H.message}`),this.onValidatedObservable.clear()})))}_getLoader(H){const c=H.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const y=p._parseVersion(c.version);if(!y)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const H=p._parseVersion(c.minVersion);if(!H)throw new Error("Invalid minimum version: "+c.minVersion);if(p._compareVersion(H,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const Z={1:p._CreateGLTF1Loader,2:p._CreateGLTF2Loader}[y.major];if(!Z)throw new Error("Unsupported version: "+c.version);return Z(this)}_parseJson(H){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${H.length}`);const c=JSON.parse(H);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(H){return this._startPerformanceCounter("Unpack Binary"),H.loadAsync(20).then((()=>{const c=H.readUint32();if(1179937895!==c)throw new E.m("Unexpected magic: "+c,E.i.GLTFLoaderUnexpectedMagicError);const y=H.readUint32();this.loggingEnabled&&this._log(`Binary version: ${y}`);const Z=H.readUint32();let F;switch(this.useRangeRequests||Z===H.buffer.byteLength||a.d.Warn(`Length in header does not match actual data length: ${Z} != ${H.buffer.byteLength}`),y){case 1:F=this._unpackBinaryV1Async(H,Z);break;case 2:F=this._unpackBinaryV2Async(H,Z);break;default:throw new Error("Unsupported version: "+y)}return this._endPerformanceCounter("Unpack Binary"),F}))}_unpackBinaryV1Async(H,c){const y=H.readUint32(),Z=H.readUint32();if(0!==Z)throw new Error(`Unexpected content format: ${Z}`);const F=c-H.byteOffset,P={json:this._parseJson(H.readString(y)),bin:null};if(0!==F){const c=H.byteOffset;P.bin={readAsync:(y,Z)=>H.buffer.readAsync(c+y,Z),byteLength:F}}return Promise.resolve(P)}_unpackBinaryV2Async(H,c){const y=1313821514,Z=5130562,F=H.readUint32();if(H.readUint32()!==y)throw new Error("First chunk format is not JSON");return H.byteOffset+F===c?H.loadAsync(F).then((()=>({json:this._parseJson(H.readString(F)),bin:null}))):H.loadAsync(F+8).then((()=>{const P={json:this._parseJson(H.readString(F)),bin:null},S=()=>{const F=H.readUint32();switch(H.readUint32()){case y:throw new Error("Unexpected JSON chunk");case Z:{const c=H.byteOffset;P.bin={readAsync:(y,Z)=>H.buffer.readAsync(c+y,Z),byteLength:F},H.skipBytes(F);break}default:H.skipBytes(F)}return H.byteOffset!==c?H.loadAsync(8).then(S):Promise.resolve(P)};return S()}))}static _parseVersion(H){if("1.0"===H||"1.0.1"===H)return{major:1,minor:0};const c=(H+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(H,c){return H.major>c.major?1:H.major<c.major?-1:H.minor>c.minor?1:H.minor<c.minor?-1:0}_logOpen(H){this._log(H),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(H){const c=p._logSpaces.substring(0,2*this._logIndentLevel);a.d.Log(`${c}${H}`)}_logDisabled(H){}_startPerformanceCounterEnabled(H){F.c.StartPerformanceCounter(H)}_startPerformanceCounterDisabled(H){}_endPerformanceCounterEnabled(H){F.c.EndPerformanceCounter(H)}_endPerformanceCounterDisabled(H){}}p.IncrementalLoading=!0,p.HomogeneousCoordinates=!1,p._logSpaces="                                ",(0,P.f)(new p)},12340:(H,c,y)=>{"use strict";y.d(c,{e:()=>S});var Z=y(10754);function F(H,c,y,Z){const F={externalResourceFunction:Z};return y&&(F.uri="file:"===c?y:c+y),ArrayBuffer.isView(H)?GLTFValidator.validateBytes(H,F):GLTFValidator.validateString(H,F)}function P(){const H=[];onmessage=c=>{const y=c.data;switch(y.id){case"init":importScripts(y.url);break;case"validate":F(y.data,y.rootUrl,y.fileName,(c=>new Promise(((y,Z)=>{const F=H.length;H.push({resolve:y,reject:Z}),postMessage({id:"getExternalResource",index:F,uri:c})})))).then((H=>{postMessage({id:"validate.resolve",value:H})}),(H=>{postMessage({id:"validate.reject",reason:H})}));break;case"getExternalResource.resolve":H[y.index].resolve(y.value);break;case"getExternalResource.reject":H[y.index].reject(y.reason)}}}class S{static ValidateAsync(H,c,y,S){return"function"===typeof Worker?new Promise(((n,O)=>{const a=`${F}(${P})()`,i=URL.createObjectURL(new Blob([a],{type:"application/javascript"})),C=new Worker(i),g=H=>{C.removeEventListener("error",g),C.removeEventListener("message",v),O(H)},v=H=>{const c=H.data;switch(c.id){case"getExternalResource":S(c.uri).then((H=>{C.postMessage({id:"getExternalResource.resolve",index:c.index,value:H},[H.buffer])}),(H=>{C.postMessage({id:"getExternalResource.reject",index:c.index,reason:H})}));break;case"validate.resolve":C.removeEventListener("error",g),C.removeEventListener("message",v),n(c.value),C.terminate();break;case"validate.reject":C.removeEventListener("error",g),C.removeEventListener("message",v),O(c.reason),C.terminate()}};if(C.addEventListener("error",g),C.addEventListener("message",v),C.postMessage({id:"init",url:Z.c.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(H)){const Z=H.slice();C.postMessage({id:"validate",data:Z,rootUrl:c,fileName:y},[Z.buffer])}else C.postMessage({id:"validate",data:H,rootUrl:c,fileName:y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Z.c.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>F(H,c,y,S))))}}S.Configuration={url:`${Z.c._DefaultCdnUrl}/gltf_validator.js`}},12821:(H,c,y)=>{"use strict";y.d(c,{b:()=>d});var Z=y(11052),F=y(11061),P=y(11118),S=y(11092),n=y(11293),O=y(11301),a=y(11153),i=y(11076),C=y(10893),g=y(10855);y(11771),y(11684),y(11704),y(11691),y(11708),y(11710),y(11712);const v="imageProcessingCompatibility",m="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.e.IncludesShadersStore[v]=m;const z="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.e.ShadersStore[z]=V;y(11781),y(11719),y(11722),y(11737),y(11730);const h="skyVertexShader",Q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.e.ShadersStore[h]=Q;var D=y(11334),f=y(11288),J=y(11285);class l extends n.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class d extends O.c{constructor(H,c){super(H,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new S.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=S.n.Zero(),this.up=S.n.Up(),this.dithering=!1,this._cameraPosition=S.n.Zero(),this._skyOrientation=new S.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(H,c){const y=c._drawWrapper;if(this.isFrozen&&y.effect&&y._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new l);const Z=c.materialDefines,F=this.va();if(this._isReadyForSubMesh(c))return!0;if((0,J.R)(H,F,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Z),(0,J.E)(H,Z,!0,!1),Z.IMAGEPROCESSINGPOSTPROCESS!==F.imageProcessingConfiguration.applyByPostProcess&&Z.markAsMiscDirty(),Z.DITHER!==this.dithering&&Z.markAsMiscDirty(),Z.isDirty){Z.markAsProcessed(),F.resetCachedMaterial();const H=new D.c;Z.FOG&&H.addFallback(1,"FOG"),Z.IMAGEPROCESSINGPOSTPROCESS=F.imageProcessingConfiguration.applyByPostProcess,Z.DITHER=this.dithering;const y=[a.h.PositionKind];Z.VERTEXCOLOR&&y.push(a.h.ColorKind);const P="sky",S=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.c)(S);const n=Z.toString();c.setEffect(F.getEngine().createEffect(P,y,S,[],n,H,this.onCompiled,this.onError),Z,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(Z._renderId=F.getRenderId(),y._wasPreviouslyReady=!0,!0)}bindForSubMesh(H,c,y){const Z=this.va(),F=y.materialDefines;if(!F)return;const P=y.effect;if(!P)return;this._activeEffect=P,this.bindOnlyWorldMatrix(H),this._activeEffect.setMatrix("viewProjection",Z.getTransformMatrix()),this._mustRebind(Z,P,y)&&((0,f.f)(P,this,Z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,J.j)(F,P,Z)),Z.fogEnabled&&c.applyFog&&Z.fogMode!==i.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Z.getViewMatrix()),(0,J.h)(Z,c,this._activeEffect);const n=Z.activeCamera;if(n){const H=n.getWorldMatrix();this._cameraPosition.x=H.m[12],this._cameraPosition.y=H.m[13],this._cameraPosition.z=H.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const H=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(H),this.sunPosition.y=this.distance*Math.sin(-H),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(H),S.f.FromUnitVectorsToRef(S.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,y)}getAnimatables(){return[]}dispose(H){super.dispose(H)}clone(H){return P.e.Clone((()=>new d(H,this.va())),this)}serialize(){const H=super.serialize();return H.customType="BABYLON.SkyMaterial",H}getClassName(){return"SkyMaterial"}static Parse(H,c,y){return P.e.Parse((()=>new d(H.name,c)),H,c,y)}}(0,Z.b)([(0,F.P)()],d.prototype,"luminance",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"turbidity",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"rayleigh",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"mieCoefficient",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"mieDirectionalG",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"distance",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"inclination",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"azimuth",void 0),(0,Z.b)([(0,F.N)()],d.prototype,"sunPosition",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"useSunPosition",void 0),(0,Z.b)([(0,F.N)()],d.prototype,"cameraOffset",void 0),(0,Z.b)([(0,F.N)()],d.prototype,"up",void 0),(0,Z.b)([(0,F.P)()],d.prototype,"dithering",void 0),(0,C.d)("BABYLON.SkyMaterial",d)},10614:(H,c,y)=>{"use strict";function Z(H,c){c.headers=H.headers||{},c.statusMessage=H.statusText,c.statusCode=H.status,c.data=H.response}function F(H,c,y){return new Promise((function(F,P){y=y||{};var S,n,O,a=new XMLHttpRequest,i=y.body,C=y.headers||{};for(S in y.timeout&&(a.timeout=y.timeout),a.ontimeout=a.onerror=function(H){H.timeout="timeout"==H.type,P(H)},a.open(H,c.href||c),a.onload=function(){for(O=a.getAllResponseHeaders().trim().split(/[\r\n]+/),Z(a,a);n=O.shift();)n=n.split(": "),a.headers[n.shift().toLowerCase()]=n.join(": ");if((n=a.headers["content-type"])&&~n.indexOf("application/json"))try{a.data=JSON.parse(a.data,y.reviver)}catch(H){return Z(a,H),P(H)}(a.status>=400?P:F)(a)},typeof FormData<"u"&&i instanceof FormData||i&&"object"==typeof i&&(C["content-type"]="application/json",i=JSON.stringify(i)),a.withCredentials=!!y.withCredentials,C)a.setRequestHeader(S,C[S]);a.send(i)}))}y.r(c),y.d(c,{del:()=>O,get:()=>P,patch:()=>n,post:()=>S,put:()=>a,send:()=>F});var P=F.bind(F,"GET"),S=F.bind(F,"POST"),n=F.bind(F,"PATCH"),O=F.bind(F,"DELETE"),a=F.bind(F,"PUT")},12933:(H,c,y)=>{"use strict";y.d(c,{b:()=>C});const Z=.5*(Math.sqrt(3)-1),F=(3-Math.sqrt(3))/6,P=1/3,S=1/6,n=(Math.sqrt(5)-1)/4,O=(5-Math.sqrt(5))/20,a=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),i=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const C=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof H?H:function(H){let c=0,y=0,Z=0,F=1;const P=function(){let H=4022871197;return function(c){c=c.toString();for(let y=0;y<c.length;y++){H+=c.charCodeAt(y);let Z=.02519603282416938*H;H=Z>>>0,Z-=H,Z*=H,H=Z>>>0,Z-=H,H+=4294967296*Z}return 2.3283064365386963e-10*(H>>>0)}}();c=P(" "),y=P(" "),Z=P(" "),c-=P(H),c<0&&(c+=1);y-=P(H),y<0&&(y+=1);Z-=P(H),Z<0&&(Z+=1);return function(){const H=2091639*c+2.3283064365386963e-10*F;return c=y,y=Z,Z=H-(F=0|H)}}(H);this.p=function(H){const c=new Uint8Array(256);for(let y=0;y<256;y++)c[y]=y;for(let y=0;y<255;y++){const Z=y+~~(H()*(256-y)),F=c[y];c[y]=c[Z],c[Z]=F}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let y=0;y<512;y++)this.perm[y]=this.p[255&y],this.permMod12[y]=this.perm[y]%12}noise2D(H,c){const y=this.permMod12,P=this.perm;let S=0,n=0,O=0;const i=(H+c)*Z,C=Math.floor(H+i),g=Math.floor(c+i),v=(C+g)*F,m=H-(C-v),z=c-(g-v);let V,h;m>z?(V=1,h=0):(V=0,h=1);const Q=m-V+F,D=z-h+F,f=m-1+2*F,J=z-1+2*F,l=255&C,d=255&g;let K=.5-m*m-z*z;if(K>=0){const H=3*y[l+P[d]];K*=K,S=K*K*(a[H]*m+a[H+1]*z)}let T=.5-Q*Q-D*D;if(T>=0){const H=3*y[l+V+P[d+h]];T*=T,n=T*T*(a[H]*Q+a[H+1]*D)}let u=.5-f*f-J*J;if(u>=0){const H=3*y[l+1+P[d+1]];u*=u,O=u*u*(a[H]*f+a[H+1]*J)}return 70*(S+n+O)}noise3D(H,c,y){const Z=this.permMod12,F=this.perm;let n,O,i,C;const g=(H+c+y)*P,v=Math.floor(H+g),m=Math.floor(c+g),z=Math.floor(y+g),V=(v+m+z)*S,h=H-(v-V),Q=c-(m-V),D=y-(z-V);let f,J,l,d,K,T;h>=Q?Q>=D?(f=1,J=0,l=0,d=1,K=1,T=0):h>=D?(f=1,J=0,l=0,d=1,K=0,T=1):(f=0,J=0,l=1,d=1,K=0,T=1):Q<D?(f=0,J=0,l=1,d=0,K=1,T=1):h<D?(f=0,J=1,l=0,d=0,K=1,T=1):(f=0,J=1,l=0,d=1,K=1,T=0);const u=h-f+S,E=Q-J+S,U=D-l+S,G=h-d+2*S,p=Q-K+2*S,t=D-T+2*S,o=h-1+.5,s=Q-1+.5,q=D-1+.5,I=255&v,j=255&m,k=255&z;let W=.6-h*h-Q*Q-D*D;if(W<0)n=0;else{const H=3*Z[I+F[j+F[k]]];W*=W,n=W*W*(a[H]*h+a[H+1]*Q+a[H+2]*D)}let M=.6-u*u-E*E-U*U;if(M<0)O=0;else{const H=3*Z[I+f+F[j+J+F[k+l]]];M*=M,O=M*M*(a[H]*u+a[H+1]*E+a[H+2]*U)}let x=.6-G*G-p*p-t*t;if(x<0)i=0;else{const H=3*Z[I+d+F[j+K+F[k+T]]];x*=x,i=x*x*(a[H]*G+a[H+1]*p+a[H+2]*t)}let R=.6-o*o-s*s-q*q;if(R<0)C=0;else{const H=3*Z[I+1+F[j+1+F[k+1]]];R*=R,C=R*R*(a[H]*o+a[H+1]*s+a[H+2]*q)}return 32*(n+O+i+C)}noise4D(H,c,y,Z){const F=this.perm;let P,S,a,C,g;const v=(H+c+y+Z)*n,m=Math.floor(H+v),z=Math.floor(c+v),V=Math.floor(y+v),h=Math.floor(Z+v),Q=(m+z+V+h)*O,D=H-(m-Q),f=c-(z-Q),J=y-(V-Q),l=Z-(h-Q);let d=0,K=0,T=0,u=0;D>f?d++:K++,D>J?d++:T++,D>l?d++:u++,f>J?K++:T++,f>l?K++:u++,J>l?T++:u++;const E=d>=3?1:0,U=K>=3?1:0,G=T>=3?1:0,p=u>=3?1:0,t=d>=2?1:0,o=K>=2?1:0,s=T>=2?1:0,q=u>=2?1:0,I=d>=1?1:0,j=K>=1?1:0,k=T>=1?1:0,W=u>=1?1:0,M=D-E+O,x=f-U+O,R=J-G+O,A=l-p+O,e=D-t+2*O,r=f-o+2*O,N=J-s+2*O,w=l-q+2*O,L=D-I+3*O,b=f-j+3*O,X=J-k+3*O,B=l-W+3*O,Y=D-1+4*O,HH=f-1+4*O,cH=J-1+4*O,yH=l-1+4*O,ZH=255&m,FH=255&z,PH=255&V,SH=255&h;let nH=.6-D*D-f*f-J*J-l*l;if(nH<0)P=0;else{const H=F[ZH+F[FH+F[PH+F[SH]]]]%32*4;nH*=nH,P=nH*nH*(i[H]*D+i[H+1]*f+i[H+2]*J+i[H+3]*l)}let OH=.6-M*M-x*x-R*R-A*A;if(OH<0)S=0;else{const H=F[ZH+E+F[FH+U+F[PH+G+F[SH+p]]]]%32*4;OH*=OH,S=OH*OH*(i[H]*M+i[H+1]*x+i[H+2]*R+i[H+3]*A)}let aH=.6-e*e-r*r-N*N-w*w;if(aH<0)a=0;else{const H=F[ZH+t+F[FH+o+F[PH+s+F[SH+q]]]]%32*4;aH*=aH,a=aH*aH*(i[H]*e+i[H+1]*r+i[H+2]*N+i[H+3]*w)}let iH=.6-L*L-b*b-X*X-B*B;if(iH<0)C=0;else{const H=F[ZH+I+F[FH+j+F[PH+k+F[SH+W]]]]%32*4;iH*=iH,C=iH*iH*(i[H]*L+i[H+1]*b+i[H+2]*X+i[H+3]*B)}let CH=.6-Y*Y-HH*HH-cH*cH-yH*yH;if(CH<0)g=0;else{const H=F[ZH+1+F[FH+1+F[PH+1+F[SH+1]]]]%32*4;CH*=CH,g=CH*CH*(i[H]*Y+i[H+1]*HH+i[H+2]*cH+i[H+3]*yH)}return 27*(P+S+a+C+g)}}}}]);