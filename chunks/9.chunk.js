"use strict";(self.rvold1i0ywi=self.rvold1i0ywi||[]).push([[9],{11182:(F,b,Q)=>{Q.d(b,{e:()=>p,i:()=>m,m:()=>R,j:()=>s,q:()=>V});class C{constructor(){this.children=[]}isValid(F){return!0}process(F,b,Q){let C="";if(this.line){let Q=this.line;const G=b.processor;if(G){var z,t,g,W,Z,q;G.lineProcessor&&(Q=G.lineProcessor(Q,b.isFragment,b.processingContext));const C=(null===(z=b.processor)||void 0===z?void 0:z.attributeKeywordName)??"attribute",K=b.isFragment&&null!==(t=b.processor)&&void 0!==t&&t.varyingFragmentKeywordName?null===(g=b.processor)||void 0===g?void 0:g.varyingFragmentKeywordName:!b.isFragment&&null!==(W=b.processor)&&void 0!==W&&W.varyingVertexKeywordName?null===(Z=b.processor)||void 0===Z?void 0:Z.varyingVertexKeywordName:"varying";if(!b.isFragment&&G.attributeProcessor&&this.line.startsWith(C))Q=G.attributeProcessor(this.line,F,b.processingContext);else if(G.varyingProcessor&&(null!==(q=G.varyingCheck)&&void 0!==q&&q.call(G,this.line,b.isFragment)||!G.varyingCheck&&this.line.startsWith(K)))Q=G.varyingProcessor(this.line,b.isFragment,F,b.processingContext);else if(G.uniformProcessor&&G.uniformRegexp&&G.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Q=G.uniformProcessor(this.line,b.isFragment,F,b.processingContext));else if(G.uniformBufferProcessor&&G.uniformBufferRegexp&&G.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Q=G.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(G.textureProcessor&&G.textureRegexp&&G.textureRegexp.test(this.line))Q=G.textureProcessor(this.line,b.isFragment,F,b.processingContext);else if((G.uniformProcessor||G.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?G.uniformProcessor&&(Q=G.uniformProcessor(this.line,b.isFragment,F,b.processingContext)):G.uniformBufferProcessor&&(Q=G.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,G.endOfUniformBufferProcessor&&(Q=G.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}C+=Q+"\n"}for(const G of this.children)C+=G.process(F,b,Q);return this.additionalDefineKey&&(F[this.additionalDefineKey]=this.additionalDefineValue||"true",Q[this.additionalDefineKey]=F[this.additionalDefineKey]),C}}class z{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(F){this._lines.length=0;for(const b of F){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const F=b.trim();if(!F)continue;if(F.startsWith("//")){this._lines.push(b);continue}const Q=F.indexOf(";");if(-1===Q)this._lines.push(F);else if(Q===F.length-1)F.length>1&&this._lines.push(F);else{const F=b.split(";");for(let b=0;b<F.length;b++){let Q=F[b];Q&&(Q=Q.trim(),Q&&this._lines.push(Q+(b!==F.length-1?";":"")))}}}}}class t extends C{process(F,b,Q){for(let C=0;C<this.children.length;C++){const z=this.children[C];if(z.isValid(F))return z.process(F,b,Q)}return""}}class g extends C{isValid(F){return this.testExpression.isTrue(F)}}class W{isTrue(F){return!0}static postfixToInfix(F){const b=[];for(const Q of F)if(void 0===W._OperatorPriority[Q])b.push(Q);else{const F=b[b.length-1],C=b[b.length-2];b.length-=2,b.push(`(${C}${Q}${F})`)}return b[b.length-1]}static infixToPostfix(F){const b=W._InfixToPostfixCache.get(F);if(b)return b.accessTime=Date.now(),b.result;if(!F.includes("&&")&&!F.includes("||")&&!F.includes(")")&&!F.includes("("))return[F];const Q=[];let C=-1;const z=()=>{G=G.trim(),""!==G&&(Q.push(G),G="")},t=F=>{C<W._Stack.length-1&&(W._Stack[++C]=F)},g=()=>W._Stack[C],Z=()=>-1===C?"!!INVALID EXPRESSION!!":W._Stack[C--];let q=0,G="";for(;q<F.length;){const b=F.charAt(q),K=q<F.length-1?F.substring(q,2+q):"";if("("===b)G="",t(b);else if(")"===b){for(z();-1!==C&&"("!==g();)Q.push(Z());Z()}else if(W._OperatorPriority[K]>1){for(z();-1!==C&&W._OperatorPriority[g()]>=W._OperatorPriority[K];)Q.push(Z());t(K),q++}else G+=b;q++}for(z();-1!==C;)"("===g()?Z():Q.push(Z());return W._InfixToPostfixCache.size>=W.InfixToPostfixCacheLimitSize&&W.ClearCache(),W._InfixToPostfixCache.set(F,{result:Q,accessTime:Date.now()}),Q}static ClearCache(){const F=Array.from(W._InfixToPostfixCache.entries()).sort(((F,b)=>F[1].accessTime-b[1].accessTime));for(let b=0;b<W.InfixToPostfixCacheCleanupSize;b++)W._InfixToPostfixCache.delete(F[b][0])}}W.InfixToPostfixCacheLimitSize=5e4,W.InfixToPostfixCacheCleanupSize=25e3,W._InfixToPostfixCache=new Map,W._OperatorPriority={")":0,"(":1,"||":2,"&&":3},W._Stack=["","","","","","","","","","","","","","","","","","","",""];class Z extends W{constructor(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=F,this.not=b}isTrue(F){let b=void 0!==F[this.define];return this.not&&(b=!b),b}}class q extends W{isTrue(F){return this.leftOperand.isTrue(F)||this.rightOperand.isTrue(F)}}class G extends W{isTrue(F){return this.leftOperand.isTrue(F)&&this.rightOperand.isTrue(F)}}class K extends W{constructor(F,b,Q){super(),this.define=F,this.operand=b,this.testValue=Q}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(F){let b=!1;const Q=parseInt(void 0!=F[this.define]?F[this.define]:this.define),C=parseInt(void 0!=F[this.testValue]?F[this.testValue]:this.testValue);if(isNaN(Q)||isNaN(C))return!1;switch(this.operand){case">":b=Q>C;break;case"<":b=Q<C;break;case"<=":b=Q<=C;break;case">=":b=Q>=C;break;case"==":b=Q===C;break;case"!=":b=Q!==C}return b}}var e=Q(11155),N=Q(11190);const y=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,X=/__decl__/,L=/light\{X\}.(\w*)/g,i=/\{X\}/g,f=[],k=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function m(F){F.processor&&F.processor.initializeShaders&&F.processor.initializeShaders(F.processingContext)}function R(F,b,Q,C){var z;null!==(z=b.processor)&&void 0!==z&&z.preProcessShaderCode&&(F=b.processor.preProcessShaderCode(F,b.isFragment)),s(F,b,(F=>{b.processCodeAfterIncludes&&(F=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",F,b.defines));const z=function(F,b,Q){let C=function(F,b){var Q;if(null!==(Q=b.processor)&&void 0!==Q&&Q.noPrecision)return F;const C=b.shouldUseHighPrecisionShader;-1===F.indexOf("precision highp float")?F=C?"precision highp float;\n"+F:"precision mediump float;\n"+F:C||(F=F.replace("precision highp float","precision mediump float"));return F}(F,b);if(!b.processor)return C;if(0===b.processor.shaderLanguage&&-1!==C.indexOf("#version 3")&&(C=C.replace("#version 300 es",""),!b.processor.parseGLES3))return C;const z=b.defines,t=Y(b,Q);b.processor.preProcessor&&(C=b.processor.preProcessor(C,z,t,b.isFragment,b.processingContext));const g={};C=w(C,t,b,g),b.processor.postProcessor&&(C=b.processor.postProcessor(C,z,b.isFragment,b.processingContext,Q?{drawBuffersExtensionDisabled:!Q.getCaps().drawBuffersExtension}:{},t,g));null!==Q&&void 0!==Q&&Q._features.needShaderCodeInlining&&(C=Q.inlineShaderCode(C));return C}(F,b,C);Q(z,F)}))}function p(F,b,Q){return Q.processor&&Q.processor.finalizeShaders?Q.processor.finalizeShaders(F,b,Q.processingContext):{vertexCode:F,fragmentCode:b}}function D(F){const b=/defined\((.+)\)/.exec(F);if(b&&b.length)return new Z(b[1].trim(),"!"===F[0]);const Q=["==","!=",">=","<=","<",">"];let C="",z=0;for(C of Q)if(z=F.indexOf(C),z>-1)break;if(-1===z)return new Z(F);const t=F.substring(0,z).trim(),g=F.substring(z+C.length).trim();return new K(t,C,g)}function P(F,b){const Q=new g,C=F.substring(0,b);let z=F.substring(b);return z=z.substring(0,(z.indexOf("//")+1||z.length+1)-1).trim(),Q.testExpression="#ifdef"===C?new Z(z):"#ifndef"===C?new Z(z,!0):function(F){F=F.replace(y,"defined[$1]");const b=W.infixToPostfix(F),Q=[];for(const z of b)if("||"!==z&&"&&"!==z)Q.push(z);else if(Q.length>=2){let F=Q[Q.length-1],b=Q[Q.length-2];Q.length-=2;const C="&&"==z?new G:new q;"string"===typeof F&&(F=F.replace(E,"defined($1)")),"string"===typeof b&&(b=b.replace(E,"defined($1)")),C.leftOperand="string"===typeof b?D(b):b,C.rightOperand="string"===typeof F?D(F):F,Q.push(C)}let C=Q[Q.length-1];return"string"===typeof C&&(C=C.replace(E,"defined($1)")),"string"===typeof C?D(C):C}(z),Q}function n(F,b,Q,z){let t=F.currentLine;for(;j(F,Q,z);){t=F.currentLine;const g=t.substring(0,5).toLowerCase();if("#else"===g){const Q=new C;return b.children.push(Q),void j(F,Q,z)}if("#elif"===g){const F=P(t,5);b.children.push(F),Q=F}}}function j(F,b,Q){for(;F.canRead;){F.lineIndex++;const z=F.currentLine;if(z.indexOf("#")>=0){const C=k.exec(z);if(C&&C.length){switch(C[0]){case"#ifdef":{const C=new t;b.children.push(C);const g=P(z,6);C.children.push(g),n(F,C,g,Q);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const C=new t;b.children.push(C);const g=P(z,7);C.children.push(g),n(F,C,g,Q);break}case"#if":{const C=new t,g=P(z,3);b.children.push(C),C.children.push(g),n(F,C,g,Q);break}}continue}}const g=new C;if(g.line=z,b.children.push(g),"#"===z[0]&&"d"===z[1]){const F=z.replace(";","").split(" ");g.additionalDefineKey=F[1],3===F.length&&(g.additionalDefineValue=F[2])}}return!1}function w(F,b,Q,t){const g=new C,W=new z;return W.lineIndex=-1,W.lines=F.split("\n"),j(W,g,t),g.process(b,Q,t)}function Y(F,b){var Q;const C=F.defines,z={};for(const t of C){const F=t.replace("#define","").replace(";","").trim().split(" ");z[F[0]]=F.length>1?F[1]:""}return 0===(null===(Q=F.processor)||void 0===Q?void 0:Q.shaderLanguage)&&(z.GL_ES="true"),z.__VERSION__=F.version,z[F.platformName]="true",(0,N.h)(z,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.useReverseDepthBuffer,null===b||void 0===b?void 0:b.useExactSrgbConversions),z}function s(F,b,Q){let C;for(f.length=0;null!==(C=c.exec(F));)f.push(C);let z=String(F),t=[F],g=!1;for(const W of f){let F=W[1];if(-1!==F.indexOf("__decl__")&&(F=F.replace(X,""),b.supportsUniformBuffers&&(F=F.replace("Vertex","Ubo").replace("Fragment","Ubo")),F+="Declaration"),!b.includesShadersStore[F]){const C=b.shadersRepository+"ShadersInclude/"+F+".fx";return void V.loadFile(C,(C=>{b.includesShadersStore[F]=C,s(t.join(""),b,Q)}))}{let Q=b.includesShadersStore[F];if(W[2]){const F=W[3].split(",");for(let b=0;b<F.length;b+=2){const C=new RegExp(F[b],"g"),z=F[b+1];Q=Q.replace(C,z)}}if(W[4]){const F=W[5];if(-1!==F.indexOf("..")){const C=F.split(".."),z=parseInt(C[0]);let t=parseInt(C[1]),g=Q.slice(0);Q="",isNaN(t)&&(t=b.indexParameters[C[1]]);for(let F=z;F<t;F++)b.supportsUniformBuffers||(g=g.replace(L,((F,b)=>b+"{X}"))),Q+=g.replace(i,F.toString())+"\n"}else b.supportsUniformBuffers||(Q=Q.replace(L,((F,b)=>b+"{X}"))),Q=Q.replace(i,F)}const C=[];for(const F of t){const b=F.split(W[0]);for(let F=0;F<b.length-1;F++)C.push(b[F]),C.push(Q);C.push(b[b.length-1])}t=C,g=g||Q.indexOf("#include<")>=0||Q.indexOf("#include <")>=0}}f.length=0,z=t.join(""),g?s(z.toString(),b,Q):Q(z)}const V={loadFile:(F,b,Q,C,z,t)=>{throw(0,e.c)("FileTools")}}},11190:(F,b,Q)=>{Q.d(b,{b:()=>z,f:()=>t,h:()=>W,l:()=>g,p:()=>Z});var C=Q(11155);Q(11140);const z={};function t(F,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+F}function g(F,b,Q,t,g,W,Z){const q=Z||z.loadFile;if(q){return q(F,b,Q,t,g,W)}throw(0,C.c)("FileTools")}function W(F,b,Q,C){if(F)return b?F.IS_NDC_HALF_ZRANGE="":delete F.IS_NDC_HALF_ZRANGE,Q?F.USE_REVERSE_DEPTHBUFFER="":delete F.USE_REVERSE_DEPTHBUFFER,void(C?F.USE_EXACT_SRGB_CONVERSIONS="":delete F.USE_EXACT_SRGB_CONVERSIONS);{let F="";return b&&(F+="#define IS_NDC_HALF_ZRANGE"),Q&&(F&&(F+="\n"),F+="#define USE_REVERSE_DEPTHBUFFER"),C&&(F&&(F+="\n"),F+="#define USE_EXACT_SRGB_CONVERSIONS"),F}}function Z(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;switch(F){case 3:{const F=(ArrayBuffer,new Int8Array(b));return C&&F.set(new Int8Array(C)),F}case 0:{const F=(ArrayBuffer,new Uint8Array(b));return C&&F.set(new Uint8Array(C)),F}case 4:{const F=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(Q?b/2:b);return C&&F.set(new Int16Array(C)),F}case 5:case 8:case 9:case 10:case 2:{const F=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(Q?b/2:b);return C&&F.set(new Uint16Array(C)),F}case 6:{const F=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(Q?b/4:b);return C&&F.set(new Int32Array(C)),F}case 7:case 11:case 12:case 13:case 14:case 15:{const F=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(Q?b/4:b);return C&&F.set(new Uint32Array(C)),F}case 1:{const F=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(Q?b/4:b);return C&&F.set(new Float32Array(C)),F}}const z=(ArrayBuffer,new Uint8Array(b));return C&&z.set(new Uint8Array(C)),z}},11219:(F,b,Q)=>{Q.d(b,{e:()=>C});class C{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersRepository:C.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersStore:C.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.IncludesShadersStore:C.IncludesShadersStoreWGSL}}C.ShadersRepository="src/Shaders/",C.ShadersStore={},C.IncludesShadersStore={},C.ShadersRepositoryWGSL="src/ShadersWGSL/",C.ShadersStoreWGSL={},C.IncludesShadersStoreWGSL={}},11230:(F,b,Q)=>{Q.d(b,{d:()=>e,g:()=>i,k:()=>y,o:()=>N,p:()=>E,t:()=>L,u:()=>K,w:()=>q,A:()=>G,C:()=>Z,G:()=>W});class C{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.tQ._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(F){F&&this.program&&F(this.program)}setEngine(F){this.tQ=F}_fillEffectInformation(F,b,Q,C,z,t,g,W){const Z=this.tQ;if(Z.supportsUniformBuffers)for(const G in b)F.bindUniformBlock(G,b[G]);let q;for(this.tQ.getUniforms(this,Q).forEach(((F,b)=>{C[Q[b]]=F})),this._uniforms=C,q=0;q<z.length;q++){null==F.getUniform(z[q])&&(z.splice(q,1),q--)}z.forEach(((F,b)=>{t[F]=b}));for(const G of Z.getAttributes(this,g))W.push(G)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(F,b){const Q=this._valueCache[F],C=b.updateFlag;return(void 0===Q||Q!==C)&&(this._valueCache[F]=C,!0)}_cacheFloat2(F,b,Q){let C=this._valueCache[F];if(!C||2!==C.length)return C=[b,Q],this._valueCache[F]=C,!0;let z=!1;return C[0]!==b&&(C[0]=b,z=!0),C[1]!==Q&&(C[1]=Q,z=!0),z}_cacheFloat3(F,b,Q,C){let z=this._valueCache[F];if(!z||3!==z.length)return z=[b,Q,C],this._valueCache[F]=z,!0;let t=!1;return z[0]!==b&&(z[0]=b,t=!0),z[1]!==Q&&(z[1]=Q,t=!0),z[2]!==C&&(z[2]=C,t=!0),t}_cacheFloat4(F,b,Q,C,z){let t=this._valueCache[F];if(!t||4!==t.length)return t=[b,Q,C,z],this._valueCache[F]=t,!0;let g=!1;return t[0]!==b&&(t[0]=b,g=!0),t[1]!==Q&&(t[1]=Q,g=!0),t[2]!==C&&(t[2]=C,g=!0),t[3]!==z&&(t[3]=z,g=!0),g}setInt(F,b){const Q=this._valueCache[F];void 0!==Q&&Q===b||this.tQ.setInt(this._uniforms[F],b)&&(this._valueCache[F]=b)}setInt2(F,b,Q){this._cacheFloat2(F,b,Q)&&(this.tQ.setInt2(this._uniforms[F],b,Q)||(this._valueCache[F]=null))}setInt3(F,b,Q,C){this._cacheFloat3(F,b,Q,C)&&(this.tQ.setInt3(this._uniforms[F],b,Q,C)||(this._valueCache[F]=null))}setInt4(F,b,Q,C,z){this._cacheFloat4(F,b,Q,C,z)&&(this.tQ.setInt4(this._uniforms[F],b,Q,C,z)||(this._valueCache[F]=null))}setIntArray(F,b){this._valueCache[F]=null,this.tQ.setIntArray(this._uniforms[F],b)}setIntArray2(F,b){this._valueCache[F]=null,this.tQ.setIntArray2(this._uniforms[F],b)}setIntArray3(F,b){this._valueCache[F]=null,this.tQ.setIntArray3(this._uniforms[F],b)}setIntArray4(F,b){this._valueCache[F]=null,this.tQ.setIntArray4(this._uniforms[F],b)}setUInt(F,b){const Q=this._valueCache[F];void 0!==Q&&Q===b||this.tQ.setUInt(this._uniforms[F],b)&&(this._valueCache[F]=b)}setUInt2(F,b,Q){this._cacheFloat2(F,b,Q)&&(this.tQ.setUInt2(this._uniforms[F],b,Q)||(this._valueCache[F]=null))}setUInt3(F,b,Q,C){this._cacheFloat3(F,b,Q,C)&&(this.tQ.setUInt3(this._uniforms[F],b,Q,C)||(this._valueCache[F]=null))}setUInt4(F,b,Q,C,z){this._cacheFloat4(F,b,Q,C,z)&&(this.tQ.setUInt4(this._uniforms[F],b,Q,C,z)||(this._valueCache[F]=null))}setUIntArray(F,b){this._valueCache[F]=null,this.tQ.setUIntArray(this._uniforms[F],b)}setUIntArray2(F,b){this._valueCache[F]=null,this.tQ.setUIntArray2(this._uniforms[F],b)}setUIntArray3(F,b){this._valueCache[F]=null,this.tQ.setUIntArray3(this._uniforms[F],b)}setUIntArray4(F,b){this._valueCache[F]=null,this.tQ.setUIntArray4(this._uniforms[F],b)}setArray(F,b){this._valueCache[F]=null,this.tQ.setArray(this._uniforms[F],b)}setArray2(F,b){this._valueCache[F]=null,this.tQ.setArray2(this._uniforms[F],b)}setArray3(F,b){this._valueCache[F]=null,this.tQ.setArray3(this._uniforms[F],b)}setArray4(F,b){this._valueCache[F]=null,this.tQ.setArray4(this._uniforms[F],b)}setMatrices(F,b){b&&(this._valueCache[F]=null,this.tQ.setMatrices(this._uniforms[F],b))}setMatrix(F,b){this._cacheMatrix(F,b)&&(this.tQ.setMatrices(this._uniforms[F],b.Lb())||(this._valueCache[F]=null))}setMatrix3x3(F,b){this._valueCache[F]=null,this.tQ.setMatrix3x3(this._uniforms[F],b)}setMatrix2x2(F,b){this._valueCache[F]=null,this.tQ.setMatrix2x2(this._uniforms[F],b)}setFloat(F,b){const Q=this._valueCache[F];void 0!==Q&&Q===b||this.tQ.setFloat(this._uniforms[F],b)&&(this._valueCache[F]=b)}setVector2(F,b){this._cacheFloat2(F,b.x,b.y)&&(this.tQ.setFloat2(this._uniforms[F],b.x,b.y)||(this._valueCache[F]=null))}setFloat2(F,b,Q){this._cacheFloat2(F,b,Q)&&(this.tQ.setFloat2(this._uniforms[F],b,Q)||(this._valueCache[F]=null))}setVector3(F,b){this._cacheFloat3(F,b.x,b.y,b.z)&&(this.tQ.setFloat3(this._uniforms[F],b.x,b.y,b.z)||(this._valueCache[F]=null))}setFloat3(F,b,Q,C){this._cacheFloat3(F,b,Q,C)&&(this.tQ.setFloat3(this._uniforms[F],b,Q,C)||(this._valueCache[F]=null))}setVector4(F,b){this._cacheFloat4(F,b.x,b.y,b.z,b.w)&&(this.tQ.setFloat4(this._uniforms[F],b.x,b.y,b.z,b.w)||(this._valueCache[F]=null))}setQuaternion(F,b){this._cacheFloat4(F,b.x,b.y,b.z,b.w)&&(this.tQ.setFloat4(this._uniforms[F],b.x,b.y,b.z,b.w)||(this._valueCache[F]=null))}setFloat4(F,b,Q,C,z){this._cacheFloat4(F,b,Q,C,z)&&(this.tQ.setFloat4(this._uniforms[F],b,Q,C,z)||(this._valueCache[F]=null))}setColor3(F,b){this._cacheFloat3(F,b.r,b.g,b.b)&&(this.tQ.setFloat3(this._uniforms[F],b.r,b.g,b.b)||(this._valueCache[F]=null))}setColor4(F,b,Q){this._cacheFloat4(F,b.r,b.g,b.b,Q)&&(this.tQ.setFloat4(this._uniforms[F],b.r,b.g,b.b,Q)||(this._valueCache[F]=null))}setDirectColor4(F,b){this._cacheFloat4(F,b.r,b.g,b.b,b.a)&&(this.tQ.setFloat4(this._uniforms[F],b.r,b.g,b.b,b.a)||(this._valueCache[F]=null))}_getVertexShaderCode(){return this.vertexShader?this.tQ._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.tQ._getShaderSource(this.fragmentShader):null}}var z=Q(11190);const t=new WeakMap,g={_webGLVersion:2,cachedPipelines:{}};function W(F){let b=t.get(F);if(!b){if(!F)return g;b={_webGLVersion:F.TEXTURE_BINDING_3D?2:1,_context:F,parallelShaderCompile:F.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},t.set(F,b)}return b}function Z(F){t.delete(F)}function q(F,b,Q,C,z,t){const g=W(C);t||(t=g._createShaderProgramInjection??e);return t(F,X(b,"vertex",C,g._contextWasLost),X(Q,"fragment",C,g._contextWasLost),C,z,g.validateShaderPrograms)}function G(F,b,Q,C,z){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0;const Z=W(z);g||(g=Z._createShaderProgramInjection??e);const q=Z._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return g(F,c(b,"vertex",C,q,z,Z._contextWasLost),c(Q,"fragment",C,q,z,Z._contextWasLost),z,t,Z.validateShaderPrograms)}function K(F,b){const Q=new C,z=W(F);return z.parallelShaderCompile&&!z.disableParallelShaderCompile&&(Q.isParallelCompiled=!0),Q.context=z._context,Q}function e(F,b,Q,C){let z=arguments.length>5?arguments[5]:void 0;const t=C.createProgram();if(F.program=t,!t)throw new Error("Unable to create program");return C.attachShader(t,b),C.attachShader(t,Q),C.linkProgram(t),F.context=C,F.vertexShader=b,F.fragmentShader=Q,F.isParallelCompiled||y(F,C,z),t}function N(F,b,Q){const C=F;if(C._isDisposed)return!1;const z=W(b);return!!(z&&z.parallelShaderCompile&&z.parallelShaderCompile.COMPLETION_STATUS_KHR&&C.program&&b.getProgramParameter(C.program,z.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(y(C,b,Q),!0)}function y(F,b,Q){const C=F.context,z=F.vertexShader,t=F.fragmentShader,g=F.program;if(!C.getProgramParameter(g,C.LINK_STATUS)){if(!b.getShaderParameter(z,b.COMPILE_STATUS)){const Q=b.getShaderInfoLog(z);if(Q)throw F.vertexCompilationError=Q,new Error("VERTEX SHADER "+Q)}if(!b.getShaderParameter(t,b.COMPILE_STATUS)){const Q=b.getShaderInfoLog(t);if(Q)throw F.fragmentCompilationError=Q,new Error("FRAGMENT SHADER "+Q)}const Q=C.getProgramInfoLog(g);if(Q)throw F.programLinkError=Q,new Error(Q)}if(Q){C.validateProgram(g);if(!C.getProgramParameter(g,C.VALIDATE_STATUS)){const b=C.getProgramInfoLog(g);if(b)throw F.programValidationError=b,new Error(b)}}C.deleteShader(z),C.deleteShader(t),F.vertexShader=void 0,F.fragmentShader=void 0,F.onCompiled&&(F.onCompiled(),F.onCompiled=void 0)}function E(F,b,Q,C,z,t,g,Z,K){let e=arguments.length>10?arguments[10]:void 0,N=arguments.length>11?arguments[11]:void 0,y=arguments.length>12?arguments[12]:void 0;const E=W(F.context);N||(N=E.createRawShaderProgramInjection??q),y||(y=E.createShaderProgramInjection??G);const c=F;c.program=C?N(c,b,Q,c.context,K):y(c,b,Q,Z,c.context,K),c.program.__SPECTOR_rebuildProgram=g,e()}function c(F,b,Q,C,t,g){return X((0,z.f)(F,Q,C),b,t,g)}function X(F,b,Q,C){const z=Q.createShader("vertex"===b?Q.VERTEX_SHADER:Q.FRAGMENT_SHADER);if(!z){let F=Q.NO_ERROR,z=Q.NO_ERROR;for(;(z=Q.getError())!==Q.NO_ERROR;)F=z;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${F}, gl isContextLost=${Q.isContextLost()}, _contextWasLost=${C}`)}return Q.shaderSource(z,F),Q.compileShader(z),z}function L(F,b){b.useProgram(F)}function i(F,b){const Q=F;if(!Q.isParallelCompiled)return void b(F);const C=Q.onCompiled;Q.onCompiled=()=>{null===C||void 0===C||C(),b(F)}}},11222:(F,b,Q)=>{Q.d(b,{c:()=>K,f:()=>N,g:()=>q,h:()=>G});var C=Q(11140),z=Q(11230),t=Q(11219),g=Q(11146),W=Q(11182),Z=Q(11190);function q(F,b){return(0,z.G)(b).cachedPipelines[F]}function G(F){const b=F._name,Q=F.context;if(b&&Q){const F=(0,z.G)(Q),C=F.cachedPipelines[b];null===C||void 0===C||C.dispose(),delete F.cachedPipelines[b]}}function K(F,b,Q,z,t,g,Z){let q,G;const K=(0,C.k)()?null===g||void 0===g?void 0:g.getHostDocument():null;q="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===K||void 0===K?void 0:K.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,G="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===K||void 0===K?void 0:K.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const N=[void 0,void 0],y=()=>{if(N[0]&&N[1]){F.isFragment=!0;const[C,q]=N;(0,W.m)(q,F,((g,q)=>{Z&&(Z._fragmentSourceCodeBeforeMigration=q),Q&&(g=Q("fragment",g));const G=(0,W.e)(C,g,F);F=null;const K=function(F,b,Q,C){if(Q){return{vertexSourceCode:(1===C?"//":"")+"#define SHADER_NAME vertex:"+(Q.vertexElement||Q.vertex||Q.spectorName||Q)+"\n"+F,fragmentSourceCode:(1===C?"//":"")+"#define SHADER_NAME fragment:"+(Q.fragmentElement||Q.fragment||Q.spectorName||Q)+"\n"+b}}return{vertexSourceCode:F,fragmentSourceCode:b}}(G.vertexCode,G.fragmentCode,b,t);null===z||void 0===z||z(K.vertexSourceCode,K.fragmentSourceCode)}),g)}};e(q,"Vertex","",(b=>{(0,W.i)(F),(0,W.m)(b,F,((F,C)=>{Z&&(Z._rawVertexSourceCode=b,Z._vertexSourceCodeBeforeMigration=C),Q&&(F=Q("vertex",F)),N[0]=F,y()}),g)}),t),e(G,"Fragment","Pixel",(F=>{Z&&(Z._rawFragmentSourceCode=F),N[1]=F,y()}),t)}function e(F,b,Q,z,g,W){if("undefined"!==typeof HTMLElement&&F instanceof HTMLElement){return void z((0,C.b)(F))}if("source:"===F.substring(0,7))return void z(F.substring(7));if("base64:"===F.substring(0,7)){return void z(window.atob(F.substring(7)))}const q=t.e.GetShadersStore(g);if(q[F+b+"Shader"])return void z(q[F+b+"Shader"]);if(Q&&q[F+Q+"Shader"])return void z(q[F+Q+"Shader"]);let G;if(G="."===F[0]||"/"===F[0]||F.indexOf("http")>-1?F:t.e.GetShadersRepository(g)+F,!(W=W||Z.l))throw new Error("loadFileInjection is not defined");W(G+"."+b.toLowerCase()+".fx",z)}const N=(F,b,Q,C)=>{try{const t=F.context?(0,z.G)(F.context):null;t&&(t.disableParallelShaderCompile=F.disableParallelCompilation);const g=F.existingPipelineContext||b(F.shaderProcessingContext);return g._name=F.name,F.name&&t&&(t.cachedPipelines[F.name]=g),Q(g,F.vertex,F.fragment,!!F.createAsRaw,"","",F.rebuildRebind,F.defines,F.transformFeedbackVaryings,"",(()=>{C(g,(()=>{var b;null===(b=F.onRenderingStateCompiled)||void 0===b||b.call(F,g)}))})),g}catch(t){throw g.e.Error("Error compiling effect"),t}}},11211:(F,b,Q)=>{Q.r(b),Q.d(b,{Effect:()=>Z});var C=Q(11133),z=Q(11146),t=Q(11219),g=Q(11222),W=Q(11198);class Z{static get ShadersRepository(){return t.e.ShadersRepository}static set ShadersRepository(F){t.e.ShadersRepository=F}get G(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new C.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9?arguments[9]:void 0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new C.c,this.onErrorObservable=new C.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=F,this._key=N;const c=this._key.replace(/\r/g,"").replace(/\n/g,"|");let X;if(b.attributes){const F=b;if(this._engine=Q,this._attributesNames=F.attributes,this._uniformsNames=F.uniformsNames.concat(F.samplers),this._samplerList=F.samplers.slice(),this.defines=F.defines,this.onError=F.onError,this.onCompiled=F.onCompiled,this._fallbacks=F.fallbacks,this._indexParameters=F.indexParameters,this._transformFeedbackVaryings=F.transformFeedbackVaryings||null,this._multiTarget=!!F.multiTarget,this._shaderLanguage=F.shaderLanguage??0,this._disableParallelShaderCompilation=!!F.disableParallelShaderCompilation,F.uniformBuffersNames){this._uniformBuffersNamesList=F.uniformBuffersNames.slice();for(let b=0;b<F.uniformBuffersNames.length;b++)this._uniformBuffersNames[F.uniformBuffersNames[b]]=b}this._processFinalCode=F.processFinalCode??null,this._processCodeAfterIncludes=F.processCodeAfterIncludes??void 0,E=F.extraInitializationsAsync,X=F.existingPipelineContext}else this._engine=t,this.defines=null==W?"":W,this._uniformsNames=Q.concat(z),this._samplerList=z?z.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=y,this.onError=K,this.onCompiled=G,this._indexParameters=e,this._fallbacks=q;"WEBGL2"===this._engine.shaderPlatformName&&(X=(0,g.g)(c,this._engine._gl)??X),this._attributeLocationByName={},this.uniqueId=Z._UniqueIdSeed++,X?(this._pipelineContext=X,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.G||this.dispose(!0)}))}async _processShaderCodeAsync(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0;C&&await C(),this._processingContext=Q||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const z={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:F??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:t.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:t.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,g.c)(z,this.name,this._processFinalCode,((F,Q)=>{this._vertexSourceCode=F,this._fragmentSourceCode=Q,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.G||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(F){return this._attributes[F]}getAttributeLocationByName(F){return this._attributeLocationByName[F]}getAttributesCount(){return this._attributes.length}getUniformIndex(F){return this._uniformsNames.indexOf(F)}getUniform(F){return this._uniforms[F]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((F=>{this.executeWhenCompiled(F)}))}executeWhenCompiled(F){this.isReady()?F(this):(this.onCompileObservable.add((b=>{F(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(F){(0,W.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(b=>{this._processCompilationErrors(b,F)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var F;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(F=this._pipelineContext)||void 0===F?void 0:F._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var F;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(F=this._pipelineContext)||void 0===F?void 0:F._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(F,b,Q,C){this._isReady=!1,this._vertexSourceCodeOverride=F,this._fragmentSourceCodeOverride=b,this.onError=(F,b)=>{C&&C(b)},this.onCompiled=()=>{var F,b;const C=this.getEngine().scenes;if(C)for(let Q=0;Q<C.length;Q++)C[Q].markAllMaterialsAsDirty(127);null===(F=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===F||F.call(b,Q)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(F){if(this._pipelineContext=F,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const F=this._attributesNames[b];this._attributeLocationByName[F]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),Z.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const Q=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),C=Q?null:this.defines,z=Q?this._vertexSourceCodeOverride:this._vertexSourceCode,t=Q?this._fragmentSourceCodeOverride:this._fragmentSourceCode,W=this._engine;this._pipelineContext=(0,g.f)({existingPipelineContext:F?b:null,vertex:z,fragment:t,context:"WEBGL2"===W.shaderPlatformName||"WEBGL1"===W.shaderPlatformName?W._gl:void 0,rebuildRebind:(F,b,Q,C)=>this._rebuildProgram(F,b,Q,C),defines:C,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Q,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Q=>{b&&!F&&this._engine._deletePipelineContext(b),Q&&this._onRenderingStateCompiled(Q)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(Q){this._processCompilationErrors(Q,b)}}_getShaderCodeAndErrorLine(F,b,Q){const C=Q?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let z=null;if(b&&F){const t=b.match(C);if(t&&2===t.length){const b=parseInt(t[1]),C=F.split("\n",-1);C.length>=b&&(z=`Offending line [${b}] in ${Q?"fragment":"vertex"} code: ${C[b-1]}`)}}return[F,z]}_processCompilationErrors(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=F.message;const Q=this._attributesNames,C=this._fallbacks;if(z.e.Error("Unable to compile effect:"),z.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),z.e.Error(`Attributes: ${Q.join(" ")}`),z.e.Error("Defines:\n"+this.defines),Z.LogShaderCodeOnCompilationError){var t,g;let F=null,b=null,Q=null;var W;if(null!==(t=this._pipelineContext)&&void 0!==t&&t._getVertexShaderCode()&&([Q,F]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Q&&(z.e.Error("Vertex code:"),z.e.Error(Q))),null!==(g=this._pipelineContext)&&void 0!==g&&g._getFragmentShaderCode())[Q,b]=this._getShaderCodeAndErrorLine(null===(W=this._pipelineContext)||void 0===W?void 0:W._getFragmentShaderCode(),this._compilationError,!0),Q&&(z.e.Error("Fragment code:"),z.e.Error(Q));F&&z.e.Error(F),b&&z.e.Error(b)}z.e.Error("Error: "+this._compilationError);const q=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};b&&(this._pipelineContext=b,this._isReady=!0,q()),C?(this._pipelineContext=null,C.hasMoreFallbacks?(this._allFallbacksProcessed=!1,z.e.Error("Trying next fallback."),this.defines=C.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,q(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||q())}get isSupported(){return""===this._compilationError}_bindTexture(F,b){this._engine._bindTexture(this._samplers[F],b,F)}setTexture(F,b){this._engine.setTexture(this._samplers[F],this._uniforms[F],b,F)}setTextureArray(F,b){const Q=F+"Ex";if(-1===this._samplerList.indexOf(Q+"0")){const C=this._samplerList.indexOf(F);for(let F=1;F<b.length;F++){const b=Q+(F-1).toString();this._samplerList.splice(C+F,0,b)}let z=0;for(const F of this._samplerList)this._samplers[F]=z,z+=1}this._engine.setTextureArray(this._samplers[F],this._uniforms[F],b,F)}bindUniformBuffer(F,b){const Q=this._uniformBuffersNames[b];void 0===Q||Z._BaseCache[Q]===F&&this._engine._features.useUBOBindingCache||(Z._BaseCache[Q]=F,this._engine.bindUniformBufferBase(F,Q,b))}bindUniformBlock(F,b){this._engine.bindUniformBlock(this._pipelineContext,F,b)}setInt(F,b){return this._pipelineContext.setInt(F,b),this}setInt2(F,b,Q){return this._pipelineContext.setInt2(F,b,Q),this}setInt3(F,b,Q,C){return this._pipelineContext.setInt3(F,b,Q,C),this}setInt4(F,b,Q,C,z){return this._pipelineContext.setInt4(F,b,Q,C,z),this}setIntArray(F,b){return this._pipelineContext.setIntArray(F,b),this}setIntArray2(F,b){return this._pipelineContext.setIntArray2(F,b),this}setIntArray3(F,b){return this._pipelineContext.setIntArray3(F,b),this}setIntArray4(F,b){return this._pipelineContext.setIntArray4(F,b),this}setUInt(F,b){return this._pipelineContext.setUInt(F,b),this}setUInt2(F,b,Q){return this._pipelineContext.setUInt2(F,b,Q),this}setUInt3(F,b,Q,C){return this._pipelineContext.setUInt3(F,b,Q,C),this}setUInt4(F,b,Q,C,z){return this._pipelineContext.setUInt4(F,b,Q,C,z),this}setUIntArray(F,b){return this._pipelineContext.setUIntArray(F,b),this}setUIntArray2(F,b){return this._pipelineContext.setUIntArray2(F,b),this}setUIntArray3(F,b){return this._pipelineContext.setUIntArray3(F,b),this}setUIntArray4(F,b){return this._pipelineContext.setUIntArray4(F,b),this}setFloatArray(F,b){return this._pipelineContext.setArray(F,b),this}setFloatArray2(F,b){return this._pipelineContext.setArray2(F,b),this}setFloatArray3(F,b){return this._pipelineContext.setArray3(F,b),this}setFloatArray4(F,b){return this._pipelineContext.setArray4(F,b),this}setArray(F,b){return this._pipelineContext.setArray(F,b),this}setArray2(F,b){return this._pipelineContext.setArray2(F,b),this}setArray3(F,b){return this._pipelineContext.setArray3(F,b),this}setArray4(F,b){return this._pipelineContext.setArray4(F,b),this}setMatrices(F,b){return this._pipelineContext.setMatrices(F,b),this}setMatrix(F,b){return this._pipelineContext.setMatrix(F,b),this}setMatrix3x3(F,b){return this._pipelineContext.setMatrix3x3(F,b),this}setMatrix2x2(F,b){return this._pipelineContext.setMatrix2x2(F,b),this}setFloat(F,b){return this._pipelineContext.setFloat(F,b),this}setBool(F,b){return this._pipelineContext.setInt(F,b?1:0),this}setVector2(F,b){return this._pipelineContext.setVector2(F,b),this}setFloat2(F,b,Q){return this._pipelineContext.setFloat2(F,b,Q),this}setVector3(F,b){return this._pipelineContext.setVector3(F,b),this}setFloat3(F,b,Q,C){return this._pipelineContext.setFloat3(F,b,Q,C),this}setVector4(F,b){return this._pipelineContext.setVector4(F,b),this}setQuaternion(F,b){return this._pipelineContext.setQuaternion(F,b),this}setFloat4(F,b,Q,C,z){return this._pipelineContext.setFloat4(F,b,Q,C,z),this}setColor3(F,b){return this._pipelineContext.setColor3(F,b),this}setColor4(F,b,Q){return this._pipelineContext.setColor4(F,b,Q),this}setDirectColor4(F,b){return this._pipelineContext.setDirectColor4(F,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(Z.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,g.h)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(t.e.GetShadersStore(C)[`${F}PixelShader`]=b),Q&&(t.e.GetShadersStore(C)[`${F}VertexShader`]=Q)}static ResetCache(){Z._BaseCache={}}}Z.LogShaderCodeOnCompilationError=!0,Z.PersistentMode=!1,Z.AutomaticallyClearCodeCache=!1,Z._UniqueIdSeed=0,Z._BaseCache={},Z.ShadersStore=t.e.ShadersStore,Z.IncludesShadersStore=t.e.IncludesShadersStore},11155:(F,b,Q)=>{Q.d(b,{c:()=>z});const C={};function z(F){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!C[F])return C[F]=!0,`${F} needs to be imported before as it contains a side-effect required by your code.`}},11140:(F,b,Q)=>{function C(){return"undefined"!==typeof window}function z(){return"undefined"!==typeof navigator}function t(){return"undefined"!==typeof document}function g(F){let b="",Q=F.firstChild;for(;Q;)3===Q.nodeType&&(b+=Q.textContent),Q=Q.nextSibling;return b}Q.d(b,{b:()=>g,d:()=>t,h:()=>z,k:()=>C})},11146:(F,b,Q)=>{Q.d(b,{e:()=>C});class C{static _CheckLimit(F,b){let Q=C._LogLimitOutputs[F];return Q?Q.current++:(Q={limit:b,current:1},C._LogLimitOutputs[F]=Q),Q.current<=Q.limit}static _GenerateLimitMessage(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Q=C._LogLimitOutputs[F];if(!Q||!C.MessageLimitReached)return;const z=this._Levels[b];Q.current===Q.limit&&C[z.name](C.MessageLimitReached.replace(/%LIMIT%/g,""+Q.limit).replace(/%TYPE%/g,z.name??""))}static _AddLogEntry(F){C._LogCache=F+C._LogCache,C.OnNewCacheEntry&&C.OnNewCacheEntry(F)}static _FormatMessage(F){const b=F=>F<10?"0"+F:""+F,Q=new Date;return"["+b(Q.getHours())+":"+b(Q.getMinutes())+":"+b(Q.getSeconds())+"]: "+F}static _LogDisabled(F,b){}static _LogEnabled(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;const z=Array.isArray(b)?b[0]:b;if(void 0!==Q&&!C._CheckLimit(z,Q))return;const t=C._FormatMessage(z),g=this._Levels[F],W=Array.isArray(b)?b.slice(1):[];g.logFunc&&g.logFunc("BJS - "+t,...W);const Z=`<div style='color:${g.color}'>${t}</div><br>`;C._AddLogEntry(Z),C._GenerateLimitMessage(z,F)}static get LogCache(){return C._LogCache}static ClearLogCache(){C._LogCache="",C._LogLimitOutputs={},C.errorsCount=0}static set LogLevels(F){C.Log=C._LogDisabled,C.Warn=C._LogDisabled,C.Error=C._LogDisabled;const b=[C.MessageLogLevel,C.WarningLogLevel,C.ErrorLogLevel];for(const Q of b)if((F&Q)===Q){const F=this._Levels[Q];C[F.name]=C._LogEnabled.bind(C,Q)}}}C.NoneLogLevel=0,C.MessageLogLevel=1,C.WarningLogLevel=2,C.ErrorLogLevel=4,C.AllLogLevel=7,C.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",C._LogCache="",C._LogLimitOutputs={},C._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],C.errorsCount=0,C.Log=C._LogEnabled.bind(C,C.MessageLogLevel),C.Warn=C._LogEnabled.bind(C,C.WarningLogLevel),C.Error=C._LogEnabled.bind(C,C.ErrorLogLevel)},11133:(F,b,Q)=>{Q.d(b,{c:()=>g});const C="undefined"!==typeof WeakRef;class z{constructor(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this.initialize(F,b,Q,C)}initialize(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;return this.mask=F,this.skipNextObservers=b,this.target=Q,this.currentTarget=C,this}}class t{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=F,this.mask=b,this.scope=Q,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(F)}}class g{static FromPromise(F,b){const Q=new g;return F.then((F=>{Q.notifyObservers(F)})).catch((F=>{if(!b)throw F;b.notifyObservers(F)})),Q}get observers(){return this._observers}constructor(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new z(0),F&&(this._onObserverAdded=F)}add(F){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!F)return null;const z=new t(F,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);z.unregisterOnNextCall=Q,b?this._observers.unshift(z):this._observers.push(z),this._onObserverAdded&&this._onObserverAdded(z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(z,this._lastNotifiedValue);const g=C?new WeakRef(this):{deref:()=>this};return z._remove=function(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=g.deref();b&&(F?b.remove(z):b._remove(z))},z}addOnce(F){return this.add(F,void 0,void 0,void 0,!0)}remove(F){if(!F)return!1;F._remove=null;return-1!==this._observers.indexOf(F)&&(this._deferUnregister(F),!0)}removeCallback(F,b){for(let Q=0;Q<this._observers.length;Q++){const C=this._observers[Q];if(!C._willBeUnregistered&&(C.callback===F&&(!b||b===C.scope)))return this._deferUnregister(C),!0}return!1}_deferUnregister(F){F._willBeUnregistered||(this._numObserversMarkedAsDeleted++,F.unregisterOnNextCall=!1,F._willBeUnregistered=!0,setTimeout((()=>{this._remove(F)}),0))}_remove(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!F)return!1;const Q=this._observers.indexOf(F);return-1!==Q&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(Q,1),!0)}makeObserverTopPriority(F){this._remove(F,!1),this._observers.unshift(F)}makeObserverBottomPriority(F){this._remove(F,!1),this._observers.push(F)}notifyObservers(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Q=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=F),!this._observers.length)return!0;const t=this._eventState;t.mask=b,t.target=Q,t.currentTarget=C,t.skipNextObservers=!1,t.lastReturnValue=F,t.userInfo=z;for(const g of this._observers)if(!g._willBeUnregistered&&(g.mask&b&&(g.unregisterOnNextCall&&this._deferUnregister(g),g.scope?t.lastReturnValue=g.callback.apply(g.scope,[F,t]):t.lastReturnValue=g.callback(F,t)),t.skipNextObservers))return!1;return!0}notifyObserver(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),F._willBeUnregistered)return;const C=this._eventState;C.mask=Q,C.skipNextObservers=!1,F.unregisterOnNextCall&&this._deferUnregister(F),F.callback(b,C)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const F=this._observers.pop();F&&(F._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const F=new g;return F._observers=this._observers.slice(0),F}hasSpecificMask(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&F||b.mask===F)return!0;return!1}}},11198:(F,b,Q)=>{Q.d(b,{c:()=>z,f:()=>g});let C=[];class z{static SetImmediate(F){0===C.length&&setTimeout((()=>{const F=C;C=[];for(const b of F)b()}),1),C.push(F)}}function t(F,b,Q){try{if(F())return b(),!0}catch(C){return null===Q||void 0===Q||Q(C),!0}return!1}const g=function(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,g=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&t(F,b,Q))return null;const W=setInterval((()=>{t(F,b,Q)?clearInterval(W):(z-=C,z<0&&(clearInterval(W),null===Q||void 0===Q||Q(new Error("Operation timed out after maximum retries. "+(g||"")),!0)))}),C);return()=>clearInterval(W)}}}]);