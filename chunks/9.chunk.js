"use strict";(self.fkqm0epoq5=self.fkqm0epoq5||[]).push([[9],{11595:(D,l,G)=>{G.d(l,{c:()=>B,f:()=>L,l:()=>u,i:()=>s,m:()=>U});class V{constructor(){this.children=[]}isValid(D){return!0}process(D,l,G){let V="";if(this.line){let G=this.line;const n=l.processor;if(n){var N,M,b,X,t,R;n.lineProcessor&&(G=n.lineProcessor(G,l.isFragment,l.processingContext));const V=(null===(N=l.processor)||void 0===N?void 0:N.attributeKeywordName)??"attribute",g=l.isFragment&&null!==(M=l.processor)&&void 0!==M&&M.varyingFragmentKeywordName?null===(b=l.processor)||void 0===b?void 0:b.varyingFragmentKeywordName:!l.isFragment&&null!==(X=l.processor)&&void 0!==X&&X.varyingVertexKeywordName?null===(t=l.processor)||void 0===t?void 0:t.varyingVertexKeywordName:"varying";if(!l.isFragment&&n.attributeProcessor&&this.line.startsWith(V))G=n.attributeProcessor(this.line,D,l.processingContext);else if(n.varyingProcessor&&(null!==(R=n.varyingCheck)&&void 0!==R&&R.call(n,this.line,l.isFragment)||!n.varyingCheck&&this.line.startsWith(g)))G=n.varyingProcessor(this.line,l.isFragment,D,l.processingContext);else if(n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line))l.lookForClosingBracketForUniformBuffer||(G=n.uniformProcessor(this.line,l.isFragment,D,l.processingContext));else if(n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line))l.lookForClosingBracketForUniformBuffer||(G=n.uniformBufferProcessor(this.line,l.isFragment,l.processingContext),l.lookForClosingBracketForUniformBuffer=!0);else if(n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line))G=n.textureProcessor(this.line,l.isFragment,D,l.processingContext);else if((n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!l.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?n.uniformProcessor&&(G=n.uniformProcessor(this.line,l.isFragment,D,l.processingContext)):n.uniformBufferProcessor&&(G=n.uniformBufferProcessor(this.line,l.isFragment,l.processingContext),l.lookForClosingBracketForUniformBuffer=!0)}l.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(l.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(G=n.endOfUniformBufferProcessor(this.line,l.isFragment,l.processingContext)))}V+=G+"\n"}for(const n of this.children)V+=n.process(D,l,G);return this.additionalDefineKey&&(D[this.additionalDefineKey]=this.additionalDefineValue||"true",G[this.additionalDefineKey]=D[this.additionalDefineKey]),V}}class N{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(D){this._lines.length=0;for(const l of D){if(!l||"\r"===l)continue;if("#"===l[0]){this._lines.push(l);continue}const D=l.trim();if(!D)continue;if(D.startsWith("//")){this._lines.push(l);continue}const G=D.indexOf(";");if(-1===G)this._lines.push(D);else if(G===D.length-1)D.length>1&&this._lines.push(D);else{const D=l.split(";");for(let l=0;l<D.length;l++){let G=D[l];G&&(G=G.trim(),G&&this._lines.push(G+(l!==D.length-1?";":"")))}}}}}class M extends V{process(D,l,G){for(let V=0;V<this.children.length;V++){const N=this.children[V];if(N.isValid(D))return N.process(D,l,G)}return""}}class b extends V{isValid(D){return this.testExpression.isTrue(D)}}class X{isTrue(D){return!0}static postfixToInfix(D){const l=[];for(const G of D)if(void 0===X._OperatorPriority[G])l.push(G);else{const D=l[l.length-1],V=l[l.length-2];l.length-=2,l.push(`(${V}${G}${D})`)}return l[l.length-1]}static infixToPostfix(D){const l=X._InfixToPostfixCache.get(D);if(l)return l.accessTime=Date.now(),l.result;if(!D.includes("&&")&&!D.includes("||")&&!D.includes(")")&&!D.includes("("))return[D];const G=[];let V=-1;const N=()=>{n=n.trim(),""!==n&&(G.push(n),n="")},M=D=>{V<X._Stack.length-1&&(X._Stack[++V]=D)},b=()=>X._Stack[V],t=()=>-1===V?"!!INVALID EXPRESSION!!":X._Stack[V--];let R=0,n="";for(;R<D.length;){const l=D.charAt(R),g=R<D.length-1?D.substring(R,2+R):"";if("("===l)n="",M(l);else if(")"===l){for(N();-1!==V&&"("!==b();)G.push(t());t()}else if(X._OperatorPriority[g]>1){for(N();-1!==V&&X._OperatorPriority[b()]>=X._OperatorPriority[g];)G.push(t());M(g),R++}else n+=l;R++}for(N();-1!==V;)"("===b()?t():G.push(t());return X._InfixToPostfixCache.size>=X.InfixToPostfixCacheLimitSize&&X.ClearCache(),X._InfixToPostfixCache.set(D,{result:G,accessTime:Date.now()}),G}static ClearCache(){const D=Array.from(X._InfixToPostfixCache.entries()).sort(((D,l)=>D[1].accessTime-l[1].accessTime));for(let l=0;l<X.InfixToPostfixCacheCleanupSize;l++)X._InfixToPostfixCache.delete(D[l][0])}}X.InfixToPostfixCacheLimitSize=5e4,X.InfixToPostfixCacheCleanupSize=25e3,X._InfixToPostfixCache=new Map,X._OperatorPriority={")":0,"(":1,"||":2,"&&":3},X._Stack=["","","","","","","","","","","","","","","","","","","",""];class t extends X{constructor(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=D,this.not=l}isTrue(D){let l=void 0!==D[this.define];return this.not&&(l=!l),l}}class R extends X{isTrue(D){return this.leftOperand.isTrue(D)||this.rightOperand.isTrue(D)}}class n extends X{isTrue(D){return this.leftOperand.isTrue(D)&&this.rightOperand.isTrue(D)}}class g extends X{constructor(D,l,G){super(),this.define=D,this.operand=l,this.testValue=G}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(D){let l=!1;const G=parseInt(void 0!=D[this.define]?D[this.define]:this.define),V=parseInt(void 0!=D[this.testValue]?D[this.testValue]:this.testValue);if(isNaN(G)||isNaN(V))return!1;switch(this.operand){case">":l=G>V;break;case"<":l=G<V;break;case"<=":l=G<=V;break;case">=":l=G>=V;break;case"==":l=G===V;break;case"!=":l=G!==V}return l}}var j=G(11563),e=G(11603);const K=/defined\s*?\((.+?)\)/g,F=/defined\s*?\[(.+?)\]/g,d=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,H=/__decl__/,h=/light\{X\}.(\w*)/g,x=/\{X\}/g,r=[],o=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function L(D){D.processor&&D.processor.initializeShaders&&D.processor.initializeShaders(D.processingContext)}function u(D,l,G,V){var N;null!==(N=l.processor)&&void 0!==N&&N.preProcessShaderCode&&(D=l.processor.preProcessShaderCode(D,l.isFragment)),s(D,l,(D=>{l.processCodeAfterIncludes&&(D=l.processCodeAfterIncludes(l.isFragment?"fragment":"vertex",D,l.defines));const N=function(D,l,G){let V=function(D,l){var G;if(null!==(G=l.processor)&&void 0!==G&&G.noPrecision)return D;const V=l.shouldUseHighPrecisionShader;-1===D.indexOf("precision highp float")?D=V?"precision highp float;\n"+D:"precision mediump float;\n"+D:V||(D=D.replace("precision highp float","precision mediump float"));return D}(D,l);if(!l.processor)return V;if(0===l.processor.shaderLanguage&&-1!==V.indexOf("#version 3")&&(V=V.replace("#version 300 es",""),!l.processor.parseGLES3))return V;const N=l.defines,M=O(l,G);l.processor.preProcessor&&(V=l.processor.preProcessor(V,N,M,l.isFragment,l.processingContext));const b={};V=S(V,M,l,b),l.processor.postProcessor&&(V=l.processor.postProcessor(V,N,l.isFragment,l.processingContext,G?{drawBuffersExtensionDisabled:!G.getCaps().drawBuffersExtension}:{},M,b));null!==G&&void 0!==G&&G._features.needShaderCodeInlining&&(V=G.inlineShaderCode(V));return V}(D,l,V);G(N,D)}))}function B(D,l,G){return G.processor&&G.processor.finalizeShaders?G.processor.finalizeShaders(D,l,G.processingContext):{vertexCode:D,fragmentCode:l}}function I(D){const l=/defined\((.+)\)/.exec(D);if(l&&l.length)return new t(l[1].trim(),"!"===D[0]);const G=["==","!=",">=","<=","<",">"];let V="",N=0;for(V of G)if(N=D.indexOf(V),N>-1)break;if(-1===N)return new t(D);const M=D.substring(0,N).trim(),b=D.substring(N+V.length).trim();return new g(M,V,b)}function W(D,l){const G=new b,V=D.substring(0,l);let N=D.substring(l);return N=N.substring(0,(N.indexOf("//")+1||N.length+1)-1).trim(),G.testExpression="#ifdef"===V?new t(N):"#ifndef"===V?new t(N,!0):function(D){D=D.replace(K,"defined[$1]");const l=X.infixToPostfix(D),G=[];for(const N of l)if("||"!==N&&"&&"!==N)G.push(N);else if(G.length>=2){let D=G[G.length-1],l=G[G.length-2];G.length-=2;const V="&&"==N?new n:new R;"string"===typeof D&&(D=D.replace(F,"defined($1)")),"string"===typeof l&&(l=l.replace(F,"defined($1)")),V.leftOperand="string"===typeof l?I(l):l,V.rightOperand="string"===typeof D?I(D):D,G.push(V)}let V=G[G.length-1];return"string"===typeof V&&(V=V.replace(F,"defined($1)")),"string"===typeof V?I(V):V}(N),G}function i(D,l,G,N){let M=D.currentLine;for(;y(D,G,N);){M=D.currentLine;const b=M.substring(0,5).toLowerCase();if("#else"===b){const G=new V;return l.children.push(G),void y(D,G,N)}if("#elif"===b){const D=W(M,5);l.children.push(D),G=D}}}function y(D,l,G){for(;D.canRead;){D.lineIndex++;const N=D.currentLine;if(N.indexOf("#")>=0){const V=o.exec(N);if(V&&V.length){switch(V[0]){case"#ifdef":{const V=new M;l.children.push(V);const b=W(N,6);V.children.push(b),i(D,V,b,G);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const V=new M;l.children.push(V);const b=W(N,7);V.children.push(b),i(D,V,b,G);break}case"#if":{const V=new M,b=W(N,3);l.children.push(V),V.children.push(b),i(D,V,b,G);break}}continue}}const b=new V;if(b.line=N,l.children.push(b),"#"===N[0]&&"d"===N[1]){const D=N.replace(";","").split(" ");b.additionalDefineKey=D[1],3===D.length&&(b.additionalDefineValue=D[2])}}return!1}function S(D,l,G,M){const b=new V,X=new N;return X.lineIndex=-1,X.lines=D.split("\n"),y(X,b,M),b.process(l,G,M)}function O(D,l){var G;const V=D.defines,N={};for(const M of V){const D=M.replace("#define","").replace(";","").trim().split(" ");N[D[0]]=D.length>1?D[1]:""}return 0===(null===(G=D.processor)||void 0===G?void 0:G.shaderLanguage)&&(N.GL_ES="true"),N.__VERSION__=D.version,N[D.platformName]="true",(0,e.i)(N,null===l||void 0===l?void 0:l.isNDCHalfZRange,null===l||void 0===l?void 0:l.useReverseDepthBuffer,null===l||void 0===l?void 0:l.useExactSrgbConversions),N}function s(D,l,G){let V;for(r.length=0;null!==(V=d.exec(D));)r.push(V);let N=String(D),M=[D],b=!1;for(const X of r){let D=X[1];if(-1!==D.indexOf("__decl__")&&(D=D.replace(H,""),l.supportsUniformBuffers&&(D=D.replace("Vertex","Ubo").replace("Fragment","Ubo")),D+="Declaration"),!l.includesShadersStore[D]){const V=l.shadersRepository+"ShadersInclude/"+D+".fx";return void U.loadFile(V,(V=>{l.includesShadersStore[D]=V,s(M.join(""),l,G)}))}{let G=l.includesShadersStore[D];if(X[2]){const D=X[3].split(",");for(let l=0;l<D.length;l+=2){const V=new RegExp(D[l],"g"),N=D[l+1];G=G.replace(V,N)}}if(X[4]){const D=X[5];if(-1!==D.indexOf("..")){const V=D.split(".."),N=parseInt(V[0]);let M=parseInt(V[1]),b=G.slice(0);G="",isNaN(M)&&(M=l.indexParameters[V[1]]);for(let D=N;D<M;D++)l.supportsUniformBuffers||(b=b.replace(h,((D,l)=>l+"{X}"))),G+=b.replace(x,D.toString())+"\n"}else l.supportsUniformBuffers||(G=G.replace(h,((D,l)=>l+"{X}"))),G=G.replace(x,D)}const V=[];for(const D of M){const l=D.split(X[0]);for(let D=0;D<l.length-1;D++)V.push(l[D]),V.push(G);V.push(l[l.length-1])}M=V,b=b||G.indexOf("#include<")>=0||G.indexOf("#include <")>=0}}r.length=0,N=M.join(""),b?s(N.toString(),l,G):G(N)}const U={loadFile:(D,l,G,V,N,M)=>{throw(0,j.d)("FileTools")}}},11603:(D,l,G)=>{G.d(l,{c:()=>N,f:()=>M,i:()=>X,m:()=>b,n:()=>t});var V=G(11563);G(11538);const N={};function M(D,l){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(l?l+"\n":"")+D}function b(D,l,G,M,b,X,t){const R=t||N.loadFile;if(R){return R(D,l,G,M,b,X)}throw(0,V.d)("FileTools")}function X(D,l,G,V){if(D)return l?D.IS_NDC_HALF_ZRANGE="":delete D.IS_NDC_HALF_ZRANGE,G?D.USE_REVERSE_DEPTHBUFFER="":delete D.USE_REVERSE_DEPTHBUFFER,void(V?D.USE_EXACT_SRGB_CONVERSIONS="":delete D.USE_EXACT_SRGB_CONVERSIONS);{let D="";return l&&(D+="#define IS_NDC_HALF_ZRANGE"),G&&(D&&(D+="\n"),D+="#define USE_REVERSE_DEPTHBUFFER"),V&&(D&&(D+="\n"),D+="#define USE_EXACT_SRGB_CONVERSIONS"),D}}function t(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;switch(D){case 3:{const D=(ArrayBuffer,new Int8Array(l));return V&&D.set(new Int8Array(V)),D}case 0:{const D=(ArrayBuffer,new Uint8Array(l));return V&&D.set(new Uint8Array(V)),D}case 4:{const D=l instanceof ArrayBuffer?new Int16Array(l):new Int16Array(G?l/2:l);return V&&D.set(new Int16Array(V)),D}case 5:case 8:case 9:case 10:case 2:{const D=l instanceof ArrayBuffer?new Uint16Array(l):new Uint16Array(G?l/2:l);return V&&D.set(new Uint16Array(V)),D}case 6:{const D=l instanceof ArrayBuffer?new Int32Array(l):new Int32Array(G?l/4:l);return V&&D.set(new Int32Array(V)),D}case 7:case 11:case 12:case 13:case 14:case 15:{const D=l instanceof ArrayBuffer?new Uint32Array(l):new Uint32Array(G?l/4:l);return V&&D.set(new Uint32Array(V)),D}case 1:{const D=l instanceof ArrayBuffer?new Float32Array(l):new Float32Array(G?l/4:l);return V&&D.set(new Float32Array(V)),D}}const N=(ArrayBuffer,new Uint8Array(l));return V&&N.set(new Uint8Array(V)),N}},11621:(D,l,G)=>{G.d(l,{b:()=>V});class V{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.ShadersRepository:V.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.ShadersStore:V.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?V.IncludesShadersStore:V.IncludesShadersStoreWGSL}}V.ShadersRepository="src/Shaders/",V.ShadersStore={},V.IncludesShadersStore={},V.ShadersRepositoryWGSL="src/ShadersWGSL/",V.ShadersStoreWGSL={},V.IncludesShadersStoreWGSL={}},11629:(D,l,G)=>{G.d(l,{c:()=>j,e:()=>x,i:()=>K,j:()=>e,m:()=>F,o:()=>h,p:()=>g,s:()=>R,t:()=>n,w:()=>t,A:()=>X});class V{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.el._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(D){D&&this.program&&D(this.program)}setEngine(D){this.el=D}_fillEffectInformation(D,l,G,V,N,M,b,X){const t=this.el;if(t.supportsUniformBuffers)for(const n in l)D.bindUniformBlock(n,l[n]);let R;for(this.el.getUniforms(this,G).forEach(((D,l)=>{V[G[l]]=D})),this._uniforms=V,R=0;R<N.length;R++){null==D.getUniform(N[R])&&(N.splice(R,1),R--)}N.forEach(((D,l)=>{M[D]=l}));for(const n of t.getAttributes(this,b))X.push(n)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(D,l){const G=this._valueCache[D],V=l.updateFlag;return(void 0===G||G!==V)&&(this._valueCache[D]=V,!0)}_cacheFloat2(D,l,G){let V=this._valueCache[D];if(!V||2!==V.length)return V=[l,G],this._valueCache[D]=V,!0;let N=!1;return V[0]!==l&&(V[0]=l,N=!0),V[1]!==G&&(V[1]=G,N=!0),N}_cacheFloat3(D,l,G,V){let N=this._valueCache[D];if(!N||3!==N.length)return N=[l,G,V],this._valueCache[D]=N,!0;let M=!1;return N[0]!==l&&(N[0]=l,M=!0),N[1]!==G&&(N[1]=G,M=!0),N[2]!==V&&(N[2]=V,M=!0),M}_cacheFloat4(D,l,G,V,N){let M=this._valueCache[D];if(!M||4!==M.length)return M=[l,G,V,N],this._valueCache[D]=M,!0;let b=!1;return M[0]!==l&&(M[0]=l,b=!0),M[1]!==G&&(M[1]=G,b=!0),M[2]!==V&&(M[2]=V,b=!0),M[3]!==N&&(M[3]=N,b=!0),b}setInt(D,l){const G=this._valueCache[D];void 0!==G&&G===l||this.el.setInt(this._uniforms[D],l)&&(this._valueCache[D]=l)}setInt2(D,l,G){this._cacheFloat2(D,l,G)&&(this.el.setInt2(this._uniforms[D],l,G)||(this._valueCache[D]=null))}setInt3(D,l,G,V){this._cacheFloat3(D,l,G,V)&&(this.el.setInt3(this._uniforms[D],l,G,V)||(this._valueCache[D]=null))}setInt4(D,l,G,V,N){this._cacheFloat4(D,l,G,V,N)&&(this.el.setInt4(this._uniforms[D],l,G,V,N)||(this._valueCache[D]=null))}setIntArray(D,l){this._valueCache[D]=null,this.el.setIntArray(this._uniforms[D],l)}setIntArray2(D,l){this._valueCache[D]=null,this.el.setIntArray2(this._uniforms[D],l)}setIntArray3(D,l){this._valueCache[D]=null,this.el.setIntArray3(this._uniforms[D],l)}setIntArray4(D,l){this._valueCache[D]=null,this.el.setIntArray4(this._uniforms[D],l)}setUInt(D,l){const G=this._valueCache[D];void 0!==G&&G===l||this.el.setUInt(this._uniforms[D],l)&&(this._valueCache[D]=l)}setUInt2(D,l,G){this._cacheFloat2(D,l,G)&&(this.el.setUInt2(this._uniforms[D],l,G)||(this._valueCache[D]=null))}setUInt3(D,l,G,V){this._cacheFloat3(D,l,G,V)&&(this.el.setUInt3(this._uniforms[D],l,G,V)||(this._valueCache[D]=null))}setUInt4(D,l,G,V,N){this._cacheFloat4(D,l,G,V,N)&&(this.el.setUInt4(this._uniforms[D],l,G,V,N)||(this._valueCache[D]=null))}setUIntArray(D,l){this._valueCache[D]=null,this.el.setUIntArray(this._uniforms[D],l)}setUIntArray2(D,l){this._valueCache[D]=null,this.el.setUIntArray2(this._uniforms[D],l)}setUIntArray3(D,l){this._valueCache[D]=null,this.el.setUIntArray3(this._uniforms[D],l)}setUIntArray4(D,l){this._valueCache[D]=null,this.el.setUIntArray4(this._uniforms[D],l)}setArray(D,l){this._valueCache[D]=null,this.el.setArray(this._uniforms[D],l)}setArray2(D,l){this._valueCache[D]=null,this.el.setArray2(this._uniforms[D],l)}setArray3(D,l){this._valueCache[D]=null,this.el.setArray3(this._uniforms[D],l)}setArray4(D,l){this._valueCache[D]=null,this.el.setArray4(this._uniforms[D],l)}setMatrices(D,l){l&&(this._valueCache[D]=null,this.el.setMatrices(this._uniforms[D],l))}setMatrix(D,l){this._cacheMatrix(D,l)&&(this.el.setMatrices(this._uniforms[D],l.gb())||(this._valueCache[D]=null))}setMatrix3x3(D,l){this._valueCache[D]=null,this.el.setMatrix3x3(this._uniforms[D],l)}setMatrix2x2(D,l){this._valueCache[D]=null,this.el.setMatrix2x2(this._uniforms[D],l)}setFloat(D,l){const G=this._valueCache[D];void 0!==G&&G===l||this.el.setFloat(this._uniforms[D],l)&&(this._valueCache[D]=l)}setVector2(D,l){this._cacheFloat2(D,l.x,l.y)&&(this.el.setFloat2(this._uniforms[D],l.x,l.y)||(this._valueCache[D]=null))}setFloat2(D,l,G){this._cacheFloat2(D,l,G)&&(this.el.setFloat2(this._uniforms[D],l,G)||(this._valueCache[D]=null))}setVector3(D,l){this._cacheFloat3(D,l.x,l.y,l.z)&&(this.el.setFloat3(this._uniforms[D],l.x,l.y,l.z)||(this._valueCache[D]=null))}setFloat3(D,l,G,V){this._cacheFloat3(D,l,G,V)&&(this.el.setFloat3(this._uniforms[D],l,G,V)||(this._valueCache[D]=null))}setVector4(D,l){this._cacheFloat4(D,l.x,l.y,l.z,l.w)&&(this.el.setFloat4(this._uniforms[D],l.x,l.y,l.z,l.w)||(this._valueCache[D]=null))}setQuaternion(D,l){this._cacheFloat4(D,l.x,l.y,l.z,l.w)&&(this.el.setFloat4(this._uniforms[D],l.x,l.y,l.z,l.w)||(this._valueCache[D]=null))}setFloat4(D,l,G,V,N){this._cacheFloat4(D,l,G,V,N)&&(this.el.setFloat4(this._uniforms[D],l,G,V,N)||(this._valueCache[D]=null))}setColor3(D,l){this._cacheFloat3(D,l.r,l.g,l.b)&&(this.el.setFloat3(this._uniforms[D],l.r,l.g,l.b)||(this._valueCache[D]=null))}setColor4(D,l,G){this._cacheFloat4(D,l.r,l.g,l.b,G)&&(this.el.setFloat4(this._uniforms[D],l.r,l.g,l.b,G)||(this._valueCache[D]=null))}setDirectColor4(D,l){this._cacheFloat4(D,l.r,l.g,l.b,l.a)&&(this.el.setFloat4(this._uniforms[D],l.r,l.g,l.b,l.a)||(this._valueCache[D]=null))}_getVertexShaderCode(){return this.vertexShader?this.el._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.el._getShaderSource(this.fragmentShader):null}}var N=G(11603);const M=new WeakMap,b={_webGLVersion:2,cachedPipelines:{}};function X(D){let l=M.get(D);if(!l){if(!D)return b;l={_webGLVersion:D.TEXTURE_BINDING_3D?2:1,_context:D,parallelShaderCompile:D.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},M.set(D,l)}return l}function t(D){M.delete(D)}function R(D,l,G,V,N,M){const b=X(V);M||(M=b._createShaderProgramInjection??j);return M(D,H(l,"vertex",V,b._contextWasLost),H(G,"fragment",V,b._contextWasLost),V,N,b.validateShaderPrograms)}function n(D,l,G,V,N){let M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0;const t=X(N);b||(b=t._createShaderProgramInjection??j);const R=t._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return b(D,d(l,"vertex",V,R,N,t._contextWasLost),d(G,"fragment",V,R,N,t._contextWasLost),N,M,t.validateShaderPrograms)}function g(D,l){const G=new V,N=X(D);return N.parallelShaderCompile&&!N.disableParallelShaderCompile&&(G.isParallelCompiled=!0),G.context=N._context,G}function j(D,l,G,V){let N=arguments.length>5?arguments[5]:void 0;const M=V.createProgram();if(D.program=M,!M)throw new Error("Unable to create program");return V.attachShader(M,l),V.attachShader(M,G),V.linkProgram(M),D.context=V,D.vertexShader=l,D.fragmentShader=G,D.isParallelCompiled||K(D,V,N),M}function e(D,l,G){const V=D;if(V._isDisposed)return!1;const N=X(l);return!!(N&&N.parallelShaderCompile&&N.parallelShaderCompile.COMPLETION_STATUS_KHR&&V.program&&l.getProgramParameter(V.program,N.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(K(V,l,G),!0)}function K(D,l,G){const V=D.context,N=D.vertexShader,M=D.fragmentShader,b=D.program;if(!V.getProgramParameter(b,V.LINK_STATUS)){if(!l.getShaderParameter(N,l.COMPILE_STATUS)){const G=l.getShaderInfoLog(N);if(G)throw D.vertexCompilationError=G,new Error("VERTEX SHADER "+G)}if(!l.getShaderParameter(M,l.COMPILE_STATUS)){const G=l.getShaderInfoLog(M);if(G)throw D.fragmentCompilationError=G,new Error("FRAGMENT SHADER "+G)}const G=V.getProgramInfoLog(b);if(G)throw D.programLinkError=G,new Error(G)}if(G){V.validateProgram(b);if(!V.getProgramParameter(b,V.VALIDATE_STATUS)){const l=V.getProgramInfoLog(b);if(l)throw D.programValidationError=l,new Error(l)}}V.deleteShader(N),V.deleteShader(M),D.vertexShader=void 0,D.fragmentShader=void 0,D.onCompiled&&(D.onCompiled(),D.onCompiled=void 0)}function F(D,l,G,V,N,M,b,t,g){let j=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0;const F=X(D.context);e||(e=F.createRawShaderProgramInjection??R),K||(K=F.createShaderProgramInjection??n);const d=D;d.program=V?e(d,l,G,d.context,g):K(d,l,G,t,d.context,g),d.program.__SPECTOR_rebuildProgram=b,j()}function d(D,l,G,V,M,b){return H((0,N.f)(D,G,V),l,M,b)}function H(D,l,G,V){const N=G.createShader("vertex"===l?G.VERTEX_SHADER:G.FRAGMENT_SHADER);if(!N){let D=G.NO_ERROR,N=G.NO_ERROR;for(;(N=G.getError())!==G.NO_ERROR;)D=N;throw new Error(`Something went wrong while creating a gl ${l} shader object. gl error=${D}, gl isContextLost=${G.isContextLost()}, _contextWasLost=${V}`)}return G.shaderSource(N,D),G.compileShader(N),N}function h(D,l){l.useProgram(D)}function x(D,l){const G=D;if(!G.isParallelCompiled)return void l(D);const V=G.onCompiled;G.onCompiled=()=>{null===V||void 0===V||V(),l(D)}}},11623:(D,l,G)=>{G.d(l,{b:()=>g,d:()=>e,h:()=>R,i:()=>n});var V=G(11538),N=G(11629),M=G(11621),b=G(11546),X=G(11595),t=G(11603);function R(D,l){return(0,N.A)(l).cachedPipelines[D]}function n(D){const l=D._name,G=D.context;if(l&&G){const D=(0,N.A)(G),V=D.cachedPipelines[l];null===V||void 0===V||V.dispose(),delete D.cachedPipelines[l]}}function g(D,l,G,N,M,b,t){let R,n;const g=(0,V.k)()?null===b||void 0===b?void 0:b.getHostDocument():null;R="string"===typeof l?l:l.vertexSource?"source:"+l.vertexSource:l.vertexElement?(null===g||void 0===g?void 0:g.getElementById(l.vertexElement))||l.vertexElement:l.vertex||l,n="string"===typeof l?l:l.fragmentSource?"source:"+l.fragmentSource:l.fragmentElement?(null===g||void 0===g?void 0:g.getElementById(l.fragmentElement))||l.fragmentElement:l.fragment||l;const e=[void 0,void 0],K=()=>{if(e[0]&&e[1]){D.isFragment=!0;const[V,R]=e;(0,X.l)(R,D,((b,R)=>{t&&(t._fragmentSourceCodeBeforeMigration=R),G&&(b=G("fragment",b));const n=(0,X.c)(V,b,D);D=null;const g=function(D,l,G,V){if(G){return{vertexSourceCode:(1===V?"//":"")+"#define SHADER_NAME vertex:"+(G.vertexElement||G.vertex||G.spectorName||G)+"\n"+D,fragmentSourceCode:(1===V?"//":"")+"#define SHADER_NAME fragment:"+(G.fragmentElement||G.fragment||G.spectorName||G)+"\n"+l}}return{vertexSourceCode:D,fragmentSourceCode:l}}(n.vertexCode,n.fragmentCode,l,M);null===N||void 0===N||N(g.vertexSourceCode,g.fragmentSourceCode)}),b)}};j(R,"Vertex","",(l=>{(0,X.f)(D),(0,X.l)(l,D,((D,V)=>{t&&(t._rawVertexSourceCode=l,t._vertexSourceCodeBeforeMigration=V),G&&(D=G("vertex",D)),e[0]=D,K()}),b)}),M),j(n,"Fragment","Pixel",(D=>{t&&(t._rawFragmentSourceCode=D),e[1]=D,K()}),M)}function j(D,l,G,N,b,X){if("undefined"!==typeof HTMLElement&&D instanceof HTMLElement){return void N((0,V.c)(D))}if("source:"===D.substring(0,7))return void N(D.substring(7));if("base64:"===D.substring(0,7)){return void N(window.atob(D.substring(7)))}const R=M.b.GetShadersStore(b);if(R[D+l+"Shader"])return void N(R[D+l+"Shader"]);if(G&&R[D+G+"Shader"])return void N(R[D+G+"Shader"]);let n;if(n="."===D[0]||"/"===D[0]||D.indexOf("http")>-1?D:M.b.GetShadersRepository(b)+D,!(X=X||t.m))throw new Error("loadFileInjection is not defined");X(n+"."+l.toLowerCase()+".fx",N)}const e=(D,l,G,V)=>{try{const M=D.context?(0,N.A)(D.context):null;M&&(M.disableParallelShaderCompile=D.disableParallelCompilation);const b=D.existingPipelineContext||l(D.shaderProcessingContext);return b._name=D.name,D.name&&M&&(M.cachedPipelines[D.name]=b),G(b,D.vertex,D.fragment,!!D.createAsRaw,"","",D.rebuildRebind,D.defines,D.transformFeedbackVaryings,"",(()=>{V(b,(()=>{var l;null===(l=D.onRenderingStateCompiled)||void 0===l||l.call(D,b)}))})),b}catch(M){throw b.d.Error("Error compiling effect"),M}}},11617:(D,l,G)=>{G.r(l),G.d(l,{Effect:()=>t});var V=G(11532),N=G(11546),M=G(11621),b=G(11623),X=G(11609);class t{static get ShadersRepository(){return M.b.ShadersRepository}static set ShadersRepository(D){M.b.ShadersRepository=D}get X(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new V.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9?arguments[9]:void 0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,F=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new V.e,this.onErrorObservable=new V.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=D,this._key=e;const d=this._key.replace(/\r/g,"").replace(/\n/g,"|");let H;if(l.attributes){const D=l;if(this._engine=G,this._attributesNames=D.attributes,this._uniformsNames=D.uniformsNames.concat(D.samplers),this._samplerList=D.samplers.slice(),this.defines=D.defines,this.onError=D.onError,this.onCompiled=D.onCompiled,this._fallbacks=D.fallbacks,this._indexParameters=D.indexParameters,this._transformFeedbackVaryings=D.transformFeedbackVaryings||null,this._multiTarget=!!D.multiTarget,this._shaderLanguage=D.shaderLanguage??0,this._disableParallelShaderCompilation=!!D.disableParallelShaderCompilation,D.uniformBuffersNames){this._uniformBuffersNamesList=D.uniformBuffersNames.slice();for(let l=0;l<D.uniformBuffersNames.length;l++)this._uniformBuffersNames[D.uniformBuffersNames[l]]=l}this._processFinalCode=D.processFinalCode??null,this._processCodeAfterIncludes=D.processCodeAfterIncludes??void 0,F=D.extraInitializationsAsync,H=D.existingPipelineContext}else this._engine=M,this.defines=null==X?"":X,this._uniformsNames=G.concat(N),this._samplerList=N?N.slice():[],this._attributesNames=l,this._uniformBuffersNamesList=[],this._shaderLanguage=K,this.onError=g,this.onCompiled=n,this._indexParameters=j,this._fallbacks=R;"WEBGL2"===this._engine.shaderPlatformName&&(H=(0,b.h)(d,this._engine._gl)??H),this._attributeLocationByName={},this.uniqueId=t._UniqueIdSeed++,H?(this._pipelineContext=H,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,F),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.X||this.dispose(!0)}))}async _processShaderCodeAsync(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3?arguments[3]:void 0;V&&await V(),this._processingContext=G||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const N={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:D??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:M.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:M.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,b.b)(N,this.name,this._processFinalCode,((D,G)=>{this._vertexSourceCode=D,this._fragmentSourceCode=G,this._prepareEffect(l)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.X||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(D){return this._attributes[D]}getAttributeLocationByName(D){return this._attributeLocationByName[D]}getAttributesCount(){return this._attributes.length}getUniformIndex(D){return this._uniformsNames.indexOf(D)}getUniform(D){return this._uniforms[D]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((D=>{this.executeWhenCompiled(D)}))}executeWhenCompiled(D){this.isReady()?D(this):(this.onCompileObservable.add((l=>{D(l)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(D){(0,X.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(l=>{this._processCompilationErrors(l,D)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var D;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(D=this._pipelineContext)||void 0===D?void 0:D._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var D;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(D=this._pipelineContext)||void 0===D?void 0:D._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(D,l,G,V){this._isReady=!1,this._vertexSourceCodeOverride=D,this._fragmentSourceCodeOverride=l,this.onError=(D,l)=>{V&&V(l)},this.onCompiled=()=>{var D,l;const V=this.getEngine().scenes;if(V)for(let G=0;G<V.length;G++)V[G].markAllMaterialsAsDirty(127);null===(D=(l=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===D||D.call(l,G)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(D){if(this._pipelineContext=D,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let l=0;l<this._attributesNames.length;l++){const D=this._attributesNames[l];this._attributeLocationByName[D]=this._attributes[l]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),t.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l=this._pipelineContext;this._isReady=!1;try{const G=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),V=G?null:this.defines,N=G?this._vertexSourceCodeOverride:this._vertexSourceCode,M=G?this._fragmentSourceCodeOverride:this._fragmentSourceCode,X=this._engine;this._pipelineContext=(0,b.d)({existingPipelineContext:D?l:null,vertex:N,fragment:M,context:"WEBGL2"===X.shaderPlatformName||"WEBGL1"===X.shaderPlatformName?X._gl:void 0,rebuildRebind:(D,l,G,V)=>this._rebuildProgram(D,l,G,V),defines:V,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:G,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:G=>{l&&!D&&this._engine._deletePipelineContext(l),G&&this._onRenderingStateCompiled(G)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(l)}catch(G){this._processCompilationErrors(G,l)}}_getShaderCodeAndErrorLine(D,l,G){const V=G?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let N=null;if(l&&D){const M=l.match(V);if(M&&2===M.length){const l=parseInt(M[1]),V=D.split("\n",-1);V.length>=l&&(N=`Offending line [${l}] in ${G?"fragment":"vertex"} code: ${V[l-1]}`)}}return[D,N]}_processCompilationErrors(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=D.message;const G=this._attributesNames,V=this._fallbacks;if(N.d.Error("Unable to compile effect:"),N.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),N.d.Error(`Attributes: ${G.join(" ")}`),N.d.Error("Defines:\n"+this.defines),t.LogShaderCodeOnCompilationError){var M,b;let D=null,l=null,G=null;var X;if(null!==(M=this._pipelineContext)&&void 0!==M&&M._getVertexShaderCode()&&([G,D]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),G&&(N.d.Error("Vertex code:"),N.d.Error(G))),null!==(b=this._pipelineContext)&&void 0!==b&&b._getFragmentShaderCode())[G,l]=this._getShaderCodeAndErrorLine(null===(X=this._pipelineContext)||void 0===X?void 0:X._getFragmentShaderCode(),this._compilationError,!0),G&&(N.d.Error("Fragment code:"),N.d.Error(G));D&&N.d.Error(D),l&&N.d.Error(l)}N.d.Error("Error: "+this._compilationError);const R=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};l&&(this._pipelineContext=l,this._isReady=!0,R()),V?(this._pipelineContext=null,V.hasMoreFallbacks?(this._allFallbacksProcessed=!1,N.d.Error("Trying next fallback."),this.defines=V.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,R(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,l||R())}get isSupported(){return""===this._compilationError}_bindTexture(D,l){this._engine._bindTexture(this._samplers[D],l,D)}setTexture(D,l){this._engine.setTexture(this._samplers[D],this._uniforms[D],l,D)}setTextureArray(D,l){const G=D+"Ex";if(-1===this._samplerList.indexOf(G+"0")){const V=this._samplerList.indexOf(D);for(let D=1;D<l.length;D++){const l=G+(D-1).toString();this._samplerList.splice(V+D,0,l)}let N=0;for(const D of this._samplerList)this._samplers[D]=N,N+=1}this._engine.setTextureArray(this._samplers[D],this._uniforms[D],l,D)}bindUniformBuffer(D,l){const G=this._uniformBuffersNames[l];void 0===G||t._BaseCache[G]===D&&this._engine._features.useUBOBindingCache||(t._BaseCache[G]=D,this._engine.bindUniformBufferBase(D,G,l))}bindUniformBlock(D,l){this._engine.bindUniformBlock(this._pipelineContext,D,l)}setInt(D,l){return this._pipelineContext.setInt(D,l),this}setInt2(D,l,G){return this._pipelineContext.setInt2(D,l,G),this}setInt3(D,l,G,V){return this._pipelineContext.setInt3(D,l,G,V),this}setInt4(D,l,G,V,N){return this._pipelineContext.setInt4(D,l,G,V,N),this}setIntArray(D,l){return this._pipelineContext.setIntArray(D,l),this}setIntArray2(D,l){return this._pipelineContext.setIntArray2(D,l),this}setIntArray3(D,l){return this._pipelineContext.setIntArray3(D,l),this}setIntArray4(D,l){return this._pipelineContext.setIntArray4(D,l),this}setUInt(D,l){return this._pipelineContext.setUInt(D,l),this}setUInt2(D,l,G){return this._pipelineContext.setUInt2(D,l,G),this}setUInt3(D,l,G,V){return this._pipelineContext.setUInt3(D,l,G,V),this}setUInt4(D,l,G,V,N){return this._pipelineContext.setUInt4(D,l,G,V,N),this}setUIntArray(D,l){return this._pipelineContext.setUIntArray(D,l),this}setUIntArray2(D,l){return this._pipelineContext.setUIntArray2(D,l),this}setUIntArray3(D,l){return this._pipelineContext.setUIntArray3(D,l),this}setUIntArray4(D,l){return this._pipelineContext.setUIntArray4(D,l),this}setFloatArray(D,l){return this._pipelineContext.setArray(D,l),this}setFloatArray2(D,l){return this._pipelineContext.setArray2(D,l),this}setFloatArray3(D,l){return this._pipelineContext.setArray3(D,l),this}setFloatArray4(D,l){return this._pipelineContext.setArray4(D,l),this}setArray(D,l){return this._pipelineContext.setArray(D,l),this}setArray2(D,l){return this._pipelineContext.setArray2(D,l),this}setArray3(D,l){return this._pipelineContext.setArray3(D,l),this}setArray4(D,l){return this._pipelineContext.setArray4(D,l),this}setMatrices(D,l){return this._pipelineContext.setMatrices(D,l),this}setMatrix(D,l){return this._pipelineContext.setMatrix(D,l),this}setMatrix3x3(D,l){return this._pipelineContext.setMatrix3x3(D,l),this}setMatrix2x2(D,l){return this._pipelineContext.setMatrix2x2(D,l),this}setFloat(D,l){return this._pipelineContext.setFloat(D,l),this}setBool(D,l){return this._pipelineContext.setInt(D,l?1:0),this}setVector2(D,l){return this._pipelineContext.setVector2(D,l),this}setFloat2(D,l,G){return this._pipelineContext.setFloat2(D,l,G),this}setVector3(D,l){return this._pipelineContext.setVector3(D,l),this}setFloat3(D,l,G,V){return this._pipelineContext.setFloat3(D,l,G,V),this}setVector4(D,l){return this._pipelineContext.setVector4(D,l),this}setQuaternion(D,l){return this._pipelineContext.setQuaternion(D,l),this}setFloat4(D,l,G,V,N){return this._pipelineContext.setFloat4(D,l,G,V,N),this}setColor3(D,l){return this._pipelineContext.setColor3(D,l),this}setColor4(D,l,G){return this._pipelineContext.setColor4(D,l,G),this}setDirectColor4(D,l){return this._pipelineContext.setDirectColor4(D,l),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(t.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,b.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l&&(M.b.GetShadersStore(V)[`${D}PixelShader`]=l),G&&(M.b.GetShadersStore(V)[`${D}VertexShader`]=G)}static ResetCache(){t._BaseCache={}}}t.LogShaderCodeOnCompilationError=!0,t.PersistentMode=!1,t.AutomaticallyClearCodeCache=!1,t._UniqueIdSeed=0,t._BaseCache={},t.ShadersStore=M.b.ShadersStore,t.IncludesShadersStore=M.b.IncludesShadersStore},11563:(D,l,G)=>{G.d(l,{d:()=>N});const V={};function N(D){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!V[D])return V[D]=!0,`${D} needs to be imported before as it contains a side-effect required by your code.`}},11538:(D,l,G)=>{function V(){return"undefined"!==typeof window}function N(){return"undefined"!==typeof navigator}function M(){return"undefined"!==typeof document}function b(D){let l="",G=D.firstChild;for(;G;)3===G.nodeType&&(l+=G.textContent),G=G.nextSibling;return l}G.d(l,{c:()=>b,f:()=>M,h:()=>N,k:()=>V})},11546:(D,l,G)=>{G.d(l,{d:()=>V});class V{static _CheckLimit(D,l){let G=V._LogLimitOutputs[D];return G?G.current++:(G={limit:l,current:1},V._LogLimitOutputs[D]=G),G.current<=G.limit}static _GenerateLimitMessage(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const G=V._LogLimitOutputs[D];if(!G||!V.MessageLimitReached)return;const N=this._Levels[l];G.current===G.limit&&V[N.name](V.MessageLimitReached.replace(/%LIMIT%/g,""+G.limit).replace(/%TYPE%/g,N.name??""))}static _AddLogEntry(D){V._LogCache=D+V._LogCache,V.OnNewCacheEntry&&V.OnNewCacheEntry(D)}static _FormatMessage(D){const l=D=>D<10?"0"+D:""+D,G=new Date;return"["+l(G.getHours())+":"+l(G.getMinutes())+":"+l(G.getSeconds())+"]: "+D}static _LogDisabled(D,l){}static _LogEnabled(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;const N=Array.isArray(l)?l[0]:l;if(void 0!==G&&!V._CheckLimit(N,G))return;const M=V._FormatMessage(N),b=this._Levels[D],X=Array.isArray(l)?l.slice(1):[];b.logFunc&&b.logFunc("BJS - "+M,...X);const t=`<div style='color:${b.color}'>${M}</div><br>`;V._AddLogEntry(t),V._GenerateLimitMessage(N,D)}static get LogCache(){return V._LogCache}static ClearLogCache(){V._LogCache="",V._LogLimitOutputs={},V.errorsCount=0}static set LogLevels(D){V.Log=V._LogDisabled,V.Warn=V._LogDisabled,V.Error=V._LogDisabled;const l=[V.MessageLogLevel,V.WarningLogLevel,V.ErrorLogLevel];for(const G of l)if((D&G)===G){const D=this._Levels[G];V[D.name]=V._LogEnabled.bind(V,G)}}}V.NoneLogLevel=0,V.MessageLogLevel=1,V.WarningLogLevel=2,V.ErrorLogLevel=4,V.AllLogLevel=7,V.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",V._LogCache="",V._LogLimitOutputs={},V._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],V.errorsCount=0,V.Log=V._LogEnabled.bind(V,V.MessageLogLevel),V.Warn=V._LogEnabled.bind(V,V.WarningLogLevel),V.Error=V._LogEnabled.bind(V,V.ErrorLogLevel)},11532:(D,l,G)=>{G.d(l,{e:()=>b});const V="undefined"!==typeof WeakRef;class N{constructor(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0;this.initialize(D,l,G,V)}initialize(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0;return this.mask=D,this.skipNextObservers=l,this.target=G,this.currentTarget=V,this}}class M{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=D,this.mask=l,this.scope=G,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(D)}}class b{static FromPromise(D,l){const G=new b;return D.then((D=>{G.notifyObservers(D)})).catch((D=>{if(!l)throw D;l.notifyObservers(D)})),G}get observers(){return this._observers}constructor(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=l,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new N(0),D&&(this._onObserverAdded=D)}add(D){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!D)return null;const N=new M(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);N.unregisterOnNextCall=G,l?this._observers.unshift(N):this._observers.push(N),this._onObserverAdded&&this._onObserverAdded(N),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(N,this._lastNotifiedValue);const b=V?new WeakRef(this):{deref:()=>this};return N._remove=function(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l=b.deref();l&&(D?l.remove(N):l._remove(N))},N}addOnce(D){return this.add(D,void 0,void 0,void 0,!0)}remove(D){if(!D)return!1;D._remove=null;return-1!==this._observers.indexOf(D)&&(this._deferUnregister(D),!0)}removeCallback(D,l){for(let G=0;G<this._observers.length;G++){const V=this._observers[G];if(!V._willBeUnregistered&&(V.callback===D&&(!l||l===V.scope)))return this._deferUnregister(V),!0}return!1}_deferUnregister(D){D._willBeUnregistered||(this._numObserversMarkedAsDeleted++,D.unregisterOnNextCall=!1,D._willBeUnregistered=!0,setTimeout((()=>{this._remove(D)}),0))}_remove(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!D)return!1;const G=this._observers.indexOf(D);return-1!==G&&(l&&this._numObserversMarkedAsDeleted--,this._observers.splice(G,1),!0)}makeObserverTopPriority(D){this._remove(D,!1),this._observers.unshift(D)}makeObserverBottomPriority(D){this._remove(D,!1),this._observers.push(D)}notifyObservers(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,G=arguments.length>2?arguments[2]:void 0,V=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=D),!this._observers.length)return!0;const M=this._eventState;M.mask=l,M.target=G,M.currentTarget=V,M.skipNextObservers=!1,M.lastReturnValue=D,M.userInfo=N;for(const b of this._observers)if(!b._willBeUnregistered&&(b.mask&l&&(b.unregisterOnNextCall&&this._deferUnregister(b),b.scope?M.lastReturnValue=b.callback.apply(b.scope,[D,M]):M.lastReturnValue=b.callback(D,M)),M.skipNextObservers))return!1;return!0}notifyObserver(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=l),D._willBeUnregistered)return;const V=this._eventState;V.mask=G,V.skipNextObservers=!1,D.unregisterOnNextCall&&this._deferUnregister(D),D.callback(l,V)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const D=this._observers.pop();D&&(D._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const D=new b;return D._observers=this._observers.slice(0),D}hasSpecificMask(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const l of this._observers)if(l.mask&D||l.mask===D)return!0;return!1}}},11609:(D,l,G)=>{G.d(l,{d:()=>N,g:()=>b});let V=[];class N{static SetImmediate(D){0===V.length&&setTimeout((()=>{const D=V;V=[];for(const l of D)l()}),1),V.push(D)}}function M(D,l,G){try{if(D())return l(),!0}catch(V){return null===G||void 0===G||G(V),!0}return!1}const b=function(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,b=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&M(D,l,G))return null;const X=setInterval((()=>{M(D,l,G)?clearInterval(X):(N-=V,N<0&&(clearInterval(X),null===G||void 0===G||G(new Error("Operation timed out after maximum retries. "+(b||"")),!0)))}),V);return()=>clearInterval(X)}}}]);