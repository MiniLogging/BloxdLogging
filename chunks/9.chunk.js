"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[9],{12704:(a,c,o)=>{o.d(c,{e:()=>h,i:()=>w,p:()=>Z,l:()=>X,s:()=>W});class s{constructor(){this.children=[]}isValid(a){return!0}process(a,c,o){let s="";if(this.line){let o=this.line;const C=c.processor;if(C){var q,t,i,p,G,T;C.lineProcessor&&(o=C.lineProcessor(o,c.isFragment,c.processingContext));const s=(null===(q=c.processor)||void 0===q?void 0:q.attributeKeywordName)??"attribute",j=c.isFragment&&null!==(t=c.processor)&&void 0!==t&&t.varyingFragmentKeywordName?null===(i=c.processor)||void 0===i?void 0:i.varyingFragmentKeywordName:!c.isFragment&&null!==(p=c.processor)&&void 0!==p&&p.varyingVertexKeywordName?null===(G=c.processor)||void 0===G?void 0:G.varyingVertexKeywordName:"varying";if(!c.isFragment&&C.attributeProcessor&&this.line.startsWith(s))o=C.attributeProcessor(this.line,a,c.processingContext);else if(C.varyingProcessor&&(null!==(T=C.varyingCheck)&&void 0!==T&&T.call(C,this.line,c.isFragment)||!C.varyingCheck&&this.line.startsWith(j)))o=C.varyingProcessor(this.line,c.isFragment,a,c.processingContext);else if(C.uniformProcessor&&C.uniformRegexp&&C.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(o=C.uniformProcessor(this.line,c.isFragment,a,c.processingContext));else if(C.uniformBufferProcessor&&C.uniformBufferRegexp&&C.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(o=C.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(C.textureProcessor&&C.textureRegexp&&C.textureRegexp.test(this.line))o=C.textureProcessor(this.line,c.isFragment,a,c.processingContext);else if((C.uniformProcessor||C.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?C.uniformProcessor&&(o=C.uniformProcessor(this.line,c.isFragment,a,c.processingContext)):C.uniformBufferProcessor&&(o=C.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,C.endOfUniformBufferProcessor&&(o=C.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}s+=o+"\n"}for(const C of this.children)s+=C.process(a,c,o);return this.additionalDefineKey&&(a[this.additionalDefineKey]=this.additionalDefineValue||"true",o[this.additionalDefineKey]=a[this.additionalDefineKey]),s}}class q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(a){this._lines.length=0;for(const c of a){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const a=c.trim();if(!a)continue;if(a.startsWith("//")){this._lines.push(c);continue}const o=a.indexOf(";");if(-1===o)this._lines.push(a);else if(o===a.length-1)a.length>1&&this._lines.push(a);else{const a=c.split(";");for(let c=0;c<a.length;c++){let o=a[c];o&&(o=o.trim(),o&&this._lines.push(o+(c!==a.length-1?";":"")))}}}}}class t extends s{process(a,c,o){for(let s=0;s<this.children.length;s++){const q=this.children[s];if(q.isValid(a))return q.process(a,c,o)}return""}}class i extends s{isValid(a){return this.testExpression.isTrue(a)}}class p{isTrue(a){return!0}static postfixToInfix(a){const c=[];for(const o of a)if(void 0===p._OperatorPriority[o])c.push(o);else{const a=c[c.length-1],s=c[c.length-2];c.length-=2,c.push(`(${s}${o}${a})`)}return c[c.length-1]}static infixToPostfix(a){const c=p._InfixToPostfixCache.get(a);if(c)return c.accessTime=Date.now(),c.result;if(!a.includes("&&")&&!a.includes("||")&&!a.includes(")")&&!a.includes("("))return[a];const o=[];let s=-1;const q=()=>{C=C.trim(),""!==C&&(o.push(C),C="")},t=a=>{s<p._Stack.length-1&&(p._Stack[++s]=a)},i=()=>p._Stack[s],G=()=>-1===s?"!!INVALID EXPRESSION!!":p._Stack[s--];let T=0,C="";for(;T<a.length;){const c=a.charAt(T),j=T<a.length-1?a.substring(T,2+T):"";if("("===c)C="",t(c);else if(")"===c){for(q();-1!==s&&"("!==i();)o.push(G());G()}else if(p._OperatorPriority[j]>1){for(q();-1!==s&&p._OperatorPriority[i()]>=p._OperatorPriority[j];)o.push(G());t(j),T++}else C+=c;T++}for(q();-1!==s;)"("===i()?G():o.push(G());return p._InfixToPostfixCache.size>=p.InfixToPostfixCacheLimitSize&&p.ClearCache(),p._InfixToPostfixCache.set(a,{result:o,accessTime:Date.now()}),o}static ClearCache(){const a=Array.from(p._InfixToPostfixCache.entries()).sort(((a,c)=>a[1].accessTime-c[1].accessTime));for(let c=0;c<p.InfixToPostfixCacheCleanupSize;c++)p._InfixToPostfixCache.delete(a[c][0])}}p.InfixToPostfixCacheLimitSize=5e4,p.InfixToPostfixCacheCleanupSize=25e3,p._InfixToPostfixCache=new Map,p._OperatorPriority={")":0,"(":1,"||":2,"&&":3},p._Stack=["","","","","","","","","","","","","","","","","","","",""];class G extends p{constructor(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=a,this.not=c}isTrue(a){let c=void 0!==a[this.define];return this.not&&(c=!c),c}}class T extends p{isTrue(a){return this.leftOperand.isTrue(a)||this.rightOperand.isTrue(a)}}class C extends p{isTrue(a){return this.leftOperand.isTrue(a)&&this.rightOperand.isTrue(a)}}class j extends p{constructor(a,c,o){super(),this.define=a,this.operand=c,this.testValue=o}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(a){let c=!1;const o=parseInt(void 0!=a[this.define]?a[this.define]:this.define),s=parseInt(void 0!=a[this.testValue]?a[this.testValue]:this.testValue);if(isNaN(o)||isNaN(s))return!1;switch(this.operand){case">":c=o>s;break;case"<":c=o<s;break;case"<=":c=o<=s;break;case">=":c=o>=s;break;case"==":c=o===s;break;case"!=":c=o!==s}return c}}var L=o(12667),e=o(12706);const g=/defined\s*?\((.+?)\)/g,M=/defined\s*?\[(.+?)\]/g,N=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,y=/__decl__/,k=/light\{X\}.(\w*)/g,n=/\{X\}/g,f=[],J=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function w(a){a.processor&&a.processor.initializeShaders&&a.processor.initializeShaders(a.processingContext)}function Z(a,c,o,s){var q;null!==(q=c.processor)&&void 0!==q&&q.preProcessShaderCode&&(a=c.processor.preProcessShaderCode(a,c.isFragment)),X(a,c,(a=>{c.processCodeAfterIncludes&&(a=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",a,c.defines));const q=function(a,c,o){let s=function(a,c){var o;if(null!==(o=c.processor)&&void 0!==o&&o.noPrecision)return a;const s=c.shouldUseHighPrecisionShader;-1===a.indexOf("precision highp float")?a=s?"precision highp float;\n"+a:"precision mediump float;\n"+a:s||(a=a.replace("precision highp float","precision mediump float"));return a}(a,c);if(!c.processor)return s;if(0===c.processor.shaderLanguage&&-1!==s.indexOf("#version 3")&&(s=s.replace("#version 300 es",""),!c.processor.parseGLES3))return s;const q=c.defines,t=d(c,o);c.processor.preProcessor&&(s=c.processor.preProcessor(s,q,t,c.isFragment,c.processingContext));const i={};s=R(s,t,c,i),c.processor.postProcessor&&(s=c.processor.postProcessor(s,q,c.isFragment,c.processingContext,o?{drawBuffersExtensionDisabled:!o.getCaps().drawBuffersExtension}:{},t,i));null!==o&&void 0!==o&&o._features.needShaderCodeInlining&&(s=o.inlineShaderCode(s));return s}(a,c,s);o(q,a)}))}function h(a,c,o){return o.processor&&o.processor.finalizeShaders?o.processor.finalizeShaders(a,c,o.processingContext):{vertexCode:a,fragmentCode:c}}function U(a){const c=/defined\((.+)\)/.exec(a);if(c&&c.length)return new G(c[1].trim(),"!"===a[0]);const o=["==","!=",">=","<=","<",">"];let s="",q=0;for(s of o)if(q=a.indexOf(s),q>-1)break;if(-1===q)return new G(a);const t=a.substring(0,q).trim(),i=a.substring(q+s.length).trim();return new j(t,s,i)}function S(a,c){const o=new i,s=a.substring(0,c);let q=a.substring(c);return q=q.substring(0,(q.indexOf("//")+1||q.length+1)-1).trim(),o.testExpression="#ifdef"===s?new G(q):"#ifndef"===s?new G(q,!0):function(a){a=a.replace(g,"defined[$1]");const c=p.infixToPostfix(a),o=[];for(const q of c)if("||"!==q&&"&&"!==q)o.push(q);else if(o.length>=2){let a=o[o.length-1],c=o[o.length-2];o.length-=2;const s="&&"==q?new C:new T;"string"===typeof a&&(a=a.replace(M,"defined($1)")),"string"===typeof c&&(c=c.replace(M,"defined($1)")),s.leftOperand="string"===typeof c?U(c):c,s.rightOperand="string"===typeof a?U(a):a,o.push(s)}let s=o[o.length-1];return"string"===typeof s&&(s=s.replace(M,"defined($1)")),"string"===typeof s?U(s):s}(q),o}function r(a,c,o,q){let t=a.currentLine;for(;x(a,o,q);){t=a.currentLine;const i=t.substring(0,5).toLowerCase();if("#else"===i){const o=new s;return c.children.push(o),void x(a,o,q)}if("#elif"===i){const a=S(t,5);c.children.push(a),o=a}}}function x(a,c,o){for(;a.canRead;){a.lineIndex++;const q=a.currentLine;if(q.indexOf("#")>=0){const s=J.exec(q);if(s&&s.length){switch(s[0]){case"#ifdef":{const s=new t;c.children.push(s);const i=S(q,6);s.children.push(i),r(a,s,i,o);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const s=new t;c.children.push(s);const i=S(q,7);s.children.push(i),r(a,s,i,o);break}case"#if":{const s=new t,i=S(q,3);c.children.push(s),s.children.push(i),r(a,s,i,o);break}}continue}}const i=new s;if(i.line=q,c.children.push(i),"#"===q[0]&&"d"===q[1]){const a=q.replace(";","").split(" ");i.additionalDefineKey=a[1],3===a.length&&(i.additionalDefineValue=a[2])}}return!1}function R(a,c,o,t){const i=new s,p=new q;return p.lineIndex=-1,p.lines=a.split("\n"),x(p,i,t),i.process(c,o,t)}function d(a,c){var o;const s=a.defines,q={};for(const t of s){const a=t.replace("#define","").replace(";","").trim().split(" ");q[a[0]]=a.length>1?a[1]:""}return 0===(null===(o=a.processor)||void 0===o?void 0:o.shaderLanguage)&&(q.GL_ES="true"),q.__VERSION__=a.version,q[a.platformName]="true",(0,e.k)(q,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.o,null===c||void 0===c?void 0:c.useExactSrgbConversions),q}function X(a,c,o){let s;for(f.length=0;null!==(s=N.exec(a));)f.push(s);let q=String(a),t=[a],i=!1;for(const p of f){let a=p[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(y,""),c.supportsUniformBuffers&&(a=a.replace("Vertex","Ubo").replace("Fragment","Ubo")),a+="Declaration"),!c.includesShadersStore[a]){const s=c.shadersRepository+"ShadersInclude/"+a+".fx";return void W.loadFile(s,(s=>{c.includesShadersStore[a]=s,X(t.join(""),c,o)}))}{let o=c.includesShadersStore[a];if(p[2]){const a=p[3].split(",");for(let c=0;c<a.length;c+=2){const s=new RegExp(a[c],"g"),q=a[c+1];o=o.replace(s,q)}}if(p[4]){const a=p[5];if(-1!==a.indexOf("..")){const s=a.split(".."),q=parseInt(s[0]);let t=parseInt(s[1]),i=o.slice(0);o="",isNaN(t)&&(t=c.indexParameters[s[1]]);for(let a=q;a<t;a++)c.supportsUniformBuffers||(i=i.replace(k,((a,c)=>c+"{X}"))),o+=i.replace(n,a.toString())+"\n"}else c.supportsUniformBuffers||(o=o.replace(k,((a,c)=>c+"{X}"))),o=o.replace(n,a)}const s=[];for(const a of t){const c=a.split(p[0]);for(let a=0;a<c.length-1;a++)s.push(c[a]),s.push(o);s.push(c[c.length-1])}t=s,i=i||o.indexOf("#include<")>=0||o.indexOf("#include <")>=0}}f.length=0,q=t.join(""),i?X(q.toString(),c,o):o(q)}const W={loadFile:(a,c,o,s,q,t)=>{throw(0,L.b)("FileTools")}}},12706:(a,c,o)=>{o.d(c,{e:()=>q,h:()=>t,k:()=>p,m:()=>i,p:()=>G});var s=o(12667);o(12642);const q={};function t(a,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+a}function i(a,c,o,t,i,p,G){const T=G||q.loadFile;if(T){return T(a,c,o,t,i,p)}throw(0,s.b)("FileTools")}function p(a,c,o,s){if(a)return c?a.IS_NDC_HALF_ZRANGE="":delete a.IS_NDC_HALF_ZRANGE,o?a.USE_REVERSE_DEPTHBUFFER="":delete a.USE_REVERSE_DEPTHBUFFER,void(s?a.USE_EXACT_SRGB_CONVERSIONS="":delete a.USE_EXACT_SRGB_CONVERSIONS);{let a="";return c&&(a+="#define IS_NDC_HALF_ZRANGE"),o&&(a&&(a+="\n"),a+="#define USE_REVERSE_DEPTHBUFFER"),s&&(a&&(a+="\n"),a+="#define USE_EXACT_SRGB_CONVERSIONS"),a}}function G(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;switch(a){case 3:{const a=(ArrayBuffer,new Int8Array(c));return s&&a.set(new Int8Array(s)),a}case 0:{const a=(ArrayBuffer,new Uint8Array(c));return s&&a.set(new Uint8Array(s)),a}case 4:{const a=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(o?c/2:c);return s&&a.set(new Int16Array(s)),a}case 5:case 8:case 9:case 10:case 2:{const a=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(o?c/2:c);return s&&a.set(new Uint16Array(s)),a}case 6:{const a=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(o?c/4:c);return s&&a.set(new Int32Array(s)),a}case 7:case 11:case 12:case 13:case 14:case 15:{const a=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(o?c/4:c);return s&&a.set(new Uint32Array(s)),a}case 1:{const a=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(o?c/4:c);return s&&a.set(new Float32Array(s)),a}}const q=(ArrayBuffer,new Uint8Array(c));return s&&q.set(new Uint8Array(s)),q}},12732:(a,c,o)=>{o.d(c,{c:()=>s});class s{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?s.ShadersRepository:s.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?s.ShadersStore:s.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?s.IncludesShadersStore:s.IncludesShadersStoreWGSL}}s.ShadersRepository="src/Shaders/",s.ShadersStore={},s.IncludesShadersStore={},s.ShadersRepositoryWGSL="src/ShadersWGSL/",s.ShadersStoreWGSL={},s.IncludesShadersStoreWGSL={}},12744:(a,c,o)=>{o.d(c,{e:()=>L,f:()=>n,i:()=>g,l:()=>e,p:()=>M,t:()=>k,x:()=>j,A:()=>T,E:()=>C,G:()=>G,J:()=>p});class s{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.mo._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(a){a&&this.program&&a(this.program)}setEngine(a){this.mo=a}_fillEffectInformation(a,c,o,s,q,t,i,p){const G=this.mo;if(G.supportsUniformBuffers)for(const C in c)a.bindUniformBlock(C,c[C]);let T;for(this.mo.getUniforms(this,o).forEach(((a,c)=>{s[o[c]]=a})),this._uniforms=s,T=0;T<q.length;T++){null==a.getUniform(q[T])&&(q.splice(T,1),T--)}q.forEach(((a,c)=>{t[a]=c}));for(const C of G.getAttributes(this,i))p.push(C)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(a,c){const o=this._valueCache[a],s=c.updateFlag;return(void 0===o||o!==s)&&(this._valueCache[a]=s,!0)}_cacheFloat2(a,c,o){let s=this._valueCache[a];if(!s||2!==s.length)return s=[c,o],this._valueCache[a]=s,!0;let q=!1;return s[0]!==c&&(s[0]=c,q=!0),s[1]!==o&&(s[1]=o,q=!0),q}_cacheFloat3(a,c,o,s){let q=this._valueCache[a];if(!q||3!==q.length)return q=[c,o,s],this._valueCache[a]=q,!0;let t=!1;return q[0]!==c&&(q[0]=c,t=!0),q[1]!==o&&(q[1]=o,t=!0),q[2]!==s&&(q[2]=s,t=!0),t}_cacheFloat4(a,c,o,s,q){let t=this._valueCache[a];if(!t||4!==t.length)return t=[c,o,s,q],this._valueCache[a]=t,!0;let i=!1;return t[0]!==c&&(t[0]=c,i=!0),t[1]!==o&&(t[1]=o,i=!0),t[2]!==s&&(t[2]=s,i=!0),t[3]!==q&&(t[3]=q,i=!0),i}setInt(a,c){const o=this._valueCache[a];void 0!==o&&o===c||this.mo.setInt(this._uniforms[a],c)&&(this._valueCache[a]=c)}setInt2(a,c,o){this._cacheFloat2(a,c,o)&&(this.mo.setInt2(this._uniforms[a],c,o)||(this._valueCache[a]=null))}setInt3(a,c,o,s){this._cacheFloat3(a,c,o,s)&&(this.mo.setInt3(this._uniforms[a],c,o,s)||(this._valueCache[a]=null))}setInt4(a,c,o,s,q){this._cacheFloat4(a,c,o,s,q)&&(this.mo.setInt4(this._uniforms[a],c,o,s,q)||(this._valueCache[a]=null))}setIntArray(a,c){this._valueCache[a]=null,this.mo.setIntArray(this._uniforms[a],c)}setIntArray2(a,c){this._valueCache[a]=null,this.mo.setIntArray2(this._uniforms[a],c)}setIntArray3(a,c){this._valueCache[a]=null,this.mo.setIntArray3(this._uniforms[a],c)}setIntArray4(a,c){this._valueCache[a]=null,this.mo.setIntArray4(this._uniforms[a],c)}setUInt(a,c){const o=this._valueCache[a];void 0!==o&&o===c||this.mo.setUInt(this._uniforms[a],c)&&(this._valueCache[a]=c)}setUInt2(a,c,o){this._cacheFloat2(a,c,o)&&(this.mo.setUInt2(this._uniforms[a],c,o)||(this._valueCache[a]=null))}setUInt3(a,c,o,s){this._cacheFloat3(a,c,o,s)&&(this.mo.setUInt3(this._uniforms[a],c,o,s)||(this._valueCache[a]=null))}setUInt4(a,c,o,s,q){this._cacheFloat4(a,c,o,s,q)&&(this.mo.setUInt4(this._uniforms[a],c,o,s,q)||(this._valueCache[a]=null))}setUIntArray(a,c){this._valueCache[a]=null,this.mo.setUIntArray(this._uniforms[a],c)}setUIntArray2(a,c){this._valueCache[a]=null,this.mo.setUIntArray2(this._uniforms[a],c)}setUIntArray3(a,c){this._valueCache[a]=null,this.mo.setUIntArray3(this._uniforms[a],c)}setUIntArray4(a,c){this._valueCache[a]=null,this.mo.setUIntArray4(this._uniforms[a],c)}setArray(a,c){this._valueCache[a]=null,this.mo.setArray(this._uniforms[a],c)}setArray2(a,c){this._valueCache[a]=null,this.mo.setArray2(this._uniforms[a],c)}setArray3(a,c){this._valueCache[a]=null,this.mo.setArray3(this._uniforms[a],c)}setArray4(a,c){this._valueCache[a]=null,this.mo.setArray4(this._uniforms[a],c)}setMatrices(a,c){c&&(this._valueCache[a]=null,this.mo.setMatrices(this._uniforms[a],c))}setMatrix(a,c){this._cacheMatrix(a,c)&&(this.mo.setMatrices(this._uniforms[a],c.hc())||(this._valueCache[a]=null))}setMatrix3x3(a,c){this._valueCache[a]=null,this.mo.setMatrix3x3(this._uniforms[a],c)}setMatrix2x2(a,c){this._valueCache[a]=null,this.mo.setMatrix2x2(this._uniforms[a],c)}setFloat(a,c){const o=this._valueCache[a];void 0!==o&&o===c||this.mo.setFloat(this._uniforms[a],c)&&(this._valueCache[a]=c)}setVector2(a,c){this._cacheFloat2(a,c.x,c.y)&&(this.mo.setFloat2(this._uniforms[a],c.x,c.y)||(this._valueCache[a]=null))}setFloat2(a,c,o){this._cacheFloat2(a,c,o)&&(this.mo.setFloat2(this._uniforms[a],c,o)||(this._valueCache[a]=null))}setVector3(a,c){this._cacheFloat3(a,c.x,c.y,c.z)&&(this.mo.setFloat3(this._uniforms[a],c.x,c.y,c.z)||(this._valueCache[a]=null))}setFloat3(a,c,o,s){this._cacheFloat3(a,c,o,s)&&(this.mo.setFloat3(this._uniforms[a],c,o,s)||(this._valueCache[a]=null))}setVector4(a,c){this._cacheFloat4(a,c.x,c.y,c.z,c.w)&&(this.mo.setFloat4(this._uniforms[a],c.x,c.y,c.z,c.w)||(this._valueCache[a]=null))}setQuaternion(a,c){this._cacheFloat4(a,c.x,c.y,c.z,c.w)&&(this.mo.setFloat4(this._uniforms[a],c.x,c.y,c.z,c.w)||(this._valueCache[a]=null))}setFloat4(a,c,o,s,q){this._cacheFloat4(a,c,o,s,q)&&(this.mo.setFloat4(this._uniforms[a],c,o,s,q)||(this._valueCache[a]=null))}setColor3(a,c){this._cacheFloat3(a,c.r,c.g,c.b)&&(this.mo.setFloat3(this._uniforms[a],c.r,c.g,c.b)||(this._valueCache[a]=null))}setColor4(a,c,o){this._cacheFloat4(a,c.r,c.g,c.b,o)&&(this.mo.setFloat4(this._uniforms[a],c.r,c.g,c.b,o)||(this._valueCache[a]=null))}setDirectColor4(a,c){this._cacheFloat4(a,c.r,c.g,c.b,c.a)&&(this.mo.setFloat4(this._uniforms[a],c.r,c.g,c.b,c.a)||(this._valueCache[a]=null))}_getVertexShaderCode(){return this.vertexShader?this.mo._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.mo._getShaderSource(this.fragmentShader):null}}var q=o(12706);const t=new WeakMap,i={_webGLVersion:2,cachedPipelines:{}};function p(a){let c=t.get(a);if(!c){if(!a)return i;c={_webGLVersion:a.TEXTURE_BINDING_3D?2:1,_context:a,parallelShaderCompile:a.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},t.set(a,c)}return c}function G(a){t.delete(a)}function T(a,c,o,s,q,t){const i=p(s);t||(t=i._createShaderProgramInjection??L);return t(a,y(c,"vertex",s,i._contextWasLost),y(o,"fragment",s,i._contextWasLost),s,q,i.validateShaderPrograms)}function C(a,c,o,s,q){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6?arguments[6]:void 0;const G=p(q);i||(i=G._createShaderProgramInjection??L);const T=G._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return i(a,N(c,"vertex",s,T,q,G._contextWasLost),N(o,"fragment",s,T,q,G._contextWasLost),q,t,G.validateShaderPrograms)}function j(a,c){const o=new s,q=p(a);return q.parallelShaderCompile&&!q.disableParallelShaderCompile&&(o.isParallelCompiled=!0),o.context=q._context,o}function L(a,c,o,s){let q=arguments.length>5?arguments[5]:void 0;const t=s.createProgram();if(a.program=t,!t)throw new Error("Unable to create program");return s.attachShader(t,c),s.attachShader(t,o),s.linkProgram(t),a.context=s,a.vertexShader=c,a.fragmentShader=o,a.isParallelCompiled||g(a,s,q),t}function e(a,c,o){const s=a;if(s._isDisposed)return!1;const q=p(c);return!!(q&&q.parallelShaderCompile&&q.parallelShaderCompile.COMPLETION_STATUS_KHR&&s.program&&c.getProgramParameter(s.program,q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(g(s,c,o),!0)}function g(a,c,o){const s=a.context,q=a.vertexShader,t=a.fragmentShader,i=a.program;if(!s.getProgramParameter(i,s.LINK_STATUS)){if(!c.getShaderParameter(q,c.COMPILE_STATUS)){const o=c.getShaderInfoLog(q);if(o)throw a.vertexCompilationError=o,new Error("VERTEX SHADER "+o)}if(!c.getShaderParameter(t,c.COMPILE_STATUS)){const o=c.getShaderInfoLog(t);if(o)throw a.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o)}const o=s.getProgramInfoLog(i);if(o)throw a.programLinkError=o,new Error(o)}if(o){s.validateProgram(i);if(!s.getProgramParameter(i,s.VALIDATE_STATUS)){const c=s.getProgramInfoLog(i);if(c)throw a.programValidationError=c,new Error(c)}}s.deleteShader(q),s.deleteShader(t),a.vertexShader=void 0,a.fragmentShader=void 0,a.onCompiled&&(a.onCompiled(),a.onCompiled=void 0)}function M(a,c,o,s,q,t,i,G,j){let L=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0,g=arguments.length>12?arguments[12]:void 0;const M=p(a.context);e||(e=M.createRawShaderProgramInjection??T),g||(g=M.createShaderProgramInjection??C);const N=a;N.program=s?e(N,c,o,N.context,j):g(N,c,o,G,N.context,j),N.program.__SPECTOR_rebuildProgram=i,L()}function N(a,c,o,s,t,i){return y((0,q.h)(a,o,s),c,t,i)}function y(a,c,o,s){const q=o.createShader("vertex"===c?o.VERTEX_SHADER:o.FRAGMENT_SHADER);if(!q){let a=o.NO_ERROR,q=o.NO_ERROR;for(;(q=o.getError())!==o.NO_ERROR;)a=q;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${a}, gl isContextLost=${o.isContextLost()}, _contextWasLost=${s}`)}return o.shaderSource(q,a),o.compileShader(q),q}function k(a,c){c.useProgram(a)}function n(a,c){const o=a;if(!o.isParallelCompiled)return void c(a);const s=o.onCompiled;o.onCompiled=()=>{null===s||void 0===s||s(),c(a)}}},12736:(a,c,o)=>{o.d(c,{d:()=>j,h:()=>e,l:()=>T,m:()=>C});var s=o(12642),q=o(12744),t=o(12732),i=o(12649),p=o(12704),G=o(12706);function T(a,c){return(0,q.J)(c).cachedPipelines[a]}function C(a){const c=a._name,o=a.context;if(c&&o){const a=(0,q.J)(o),s=a.cachedPipelines[c];null===s||void 0===s||s.dispose(),delete a.cachedPipelines[c]}}function j(a,c,o,q,t,i,G){let T,C;const j=(0,s.k)()?null===i||void 0===i?void 0:i.getHostDocument():null;T="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===j||void 0===j?void 0:j.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,C="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===j||void 0===j?void 0:j.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const e=[void 0,void 0],g=()=>{if(e[0]&&e[1]){a.isFragment=!0;const[s,T]=e;(0,p.p)(T,a,((i,T)=>{G&&(G._fragmentSourceCodeBeforeMigration=T),o&&(i=o("fragment",i));const C=(0,p.e)(s,i,a);a=null;const j=function(a,c,o,s){if(o){return{vertexSourceCode:(1===s?"//":"")+"#define SHADER_NAME vertex:"+(o.vertexElement||o.vertex||o.spectorName||o)+"\n"+a,fragmentSourceCode:(1===s?"//":"")+"#define SHADER_NAME fragment:"+(o.fragmentElement||o.fragment||o.spectorName||o)+"\n"+c}}return{vertexSourceCode:a,fragmentSourceCode:c}}(C.vertexCode,C.fragmentCode,c,t);null===q||void 0===q||q(j.vertexSourceCode,j.fragmentSourceCode)}),i)}};L(T,"Vertex","",(c=>{(0,p.i)(a),(0,p.p)(c,a,((a,s)=>{G&&(G._rawVertexSourceCode=c,G._vertexSourceCodeBeforeMigration=s),o&&(a=o("vertex",a)),e[0]=a,g()}),i)}),t),L(C,"Fragment","Pixel",(a=>{G&&(G._rawFragmentSourceCode=a),e[1]=a,g()}),t)}function L(a,c,o,q,i,p){if("undefined"!==typeof HTMLElement&&a instanceof HTMLElement){return void q((0,s.b)(a))}if("source:"===a.substring(0,7))return void q(a.substring(7));if("base64:"===a.substring(0,7)){return void q(window.atob(a.substring(7)))}const T=t.c.GetShadersStore(i);if(T[a+c+"Shader"])return void q(T[a+c+"Shader"]);if(o&&T[a+o+"Shader"])return void q(T[a+o+"Shader"]);let C;if(C="."===a[0]||"/"===a[0]||a.indexOf("http")>-1?a:t.c.GetShadersRepository(i)+a,!(p=p||G.m))throw new Error("loadFileInjection is not defined");p(C+"."+c.toLowerCase()+".fx",q)}const e=(a,c,o,s)=>{try{const t=a.context?(0,q.J)(a.context):null;t&&(t.disableParallelShaderCompile=a.disableParallelCompilation);const i=a.existingPipelineContext||c(a.shaderProcessingContext);return i._name=a.name,a.name&&t&&(t.cachedPipelines[a.name]=i),o(i,a.vertex,a.fragment,!!a.createAsRaw,"","",a.rebuildRebind,a.defines,a.transformFeedbackVaryings,"",(()=>{s(i,(()=>{var c;null===(c=a.onRenderingStateCompiled)||void 0===c||c.call(a,i)}))})),i}catch(t){throw i.c.Error("Error compiling effect"),t}}},12728:(a,c,o)=>{o.r(c),o.d(c,{Effect:()=>G});var s=o(12639),q=o(12649),t=o(12732),i=o(12736),p=o(12712);class G{static get ShadersRepository(){return t.c.ShadersRepository}static set ShadersRepository(a){t.c.ShadersRepository=a}get L(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new s.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9?arguments[9]:void 0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,M=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new s.d,this.onErrorObservable=new s.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=a,this._key=e;const N=this._key.replace(/\r/g,"").replace(/\n/g,"|");let y;if(c.attributes){const a=c;if(this._engine=o,this._attributesNames=a.attributes,this._uniformsNames=a.uniformsNames.concat(a.samplers),this._samplerList=a.samplers.slice(),this.defines=a.defines,this.onError=a.onError,this.onCompiled=a.onCompiled,this._fallbacks=a.fallbacks,this._indexParameters=a.indexParameters,this._transformFeedbackVaryings=a.transformFeedbackVaryings||null,this._multiTarget=!!a.multiTarget,this._shaderLanguage=a.shaderLanguage??0,this._disableParallelShaderCompilation=!!a.disableParallelShaderCompilation,a.uniformBuffersNames){this._uniformBuffersNamesList=a.uniformBuffersNames.slice();for(let c=0;c<a.uniformBuffersNames.length;c++)this._uniformBuffersNames[a.uniformBuffersNames[c]]=c}this._processFinalCode=a.processFinalCode??null,this._processCodeAfterIncludes=a.processCodeAfterIncludes??void 0,M=a.extraInitializationsAsync,y=a.existingPipelineContext}else this._engine=t,this.defines=null==p?"":p,this._uniformsNames=o.concat(q),this._samplerList=q?q.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=g,this.onError=j,this.onCompiled=C,this._indexParameters=L,this._fallbacks=T;"WEBGL2"===this._engine.shaderPlatformName&&(y=(0,i.l)(N,this._engine._gl)??y),this._attributeLocationByName={},this.uniqueId=G._UniqueIdSeed++,y?(this._pipelineContext=y,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,M),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.L||this.dispose(!0)}))}async _processShaderCodeAsync(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0;s&&await s(),this._processingContext=o||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:a??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:t.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:t.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,i.d)(q,this.name,this._processFinalCode,((a,o)=>{this._vertexSourceCode=a,this._fragmentSourceCode=o,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.L||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(a){return this._attributes[a]}getAttributeLocationByName(a){return this._attributeLocationByName[a]}getAttributesCount(){return this._attributes.length}getUniformIndex(a){return this._uniformsNames.indexOf(a)}getUniform(a){return this._uniforms[a]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((a=>{this.executeWhenCompiled(a)}))}executeWhenCompiled(a){this.isReady()?a(this):(this.onCompileObservable.add((c=>{a(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(a){(0,p.h)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(c=>{this._processCompilationErrors(c,a)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var a;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(a=this._pipelineContext)||void 0===a?void 0:a._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var a;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(a,c,o,s){this._isReady=!1,this._vertexSourceCodeOverride=a,this._fragmentSourceCodeOverride=c,this.onError=(a,c)=>{s&&s(c)},this.onCompiled=()=>{var a,c;const s=this.getEngine().scenes;if(s)for(let o=0;o<s.length;o++)s[o].markAllMaterialsAsDirty(127);null===(a=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===a||a.call(c,o)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(a){if(this._pipelineContext=a,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const a=this._attributesNames[c];this._attributeLocationByName[a]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),G.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const o=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),s=o?null:this.defines,q=o?this._vertexSourceCodeOverride:this._vertexSourceCode,t=o?this._fragmentSourceCodeOverride:this._fragmentSourceCode,p=this._engine;this._pipelineContext=(0,i.h)({existingPipelineContext:a?c:null,vertex:q,fragment:t,context:"WEBGL2"===p.shaderPlatformName||"WEBGL1"===p.shaderPlatformName?p._gl:void 0,rebuildRebind:(a,c,o,s)=>this._rebuildProgram(a,c,o,s),defines:s,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:o,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:o=>{c&&!a&&this._engine._deletePipelineContext(c),o&&this._onRenderingStateCompiled(o)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(o){this._processCompilationErrors(o,c)}}_getShaderCodeAndErrorLine(a,c,o){const s=o?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let q=null;if(c&&a){const t=c.match(s);if(t&&2===t.length){const c=parseInt(t[1]),s=a.split("\n",-1);s.length>=c&&(q=`Offending line [${c}] in ${o?"fragment":"vertex"} code: ${s[c-1]}`)}}return[a,q]}_processCompilationErrors(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=a.message;const o=this._attributesNames,s=this._fallbacks;if(q.c.Error("Unable to compile effect:"),q.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),q.c.Error(`Attributes: ${o.join(" ")}`),q.c.Error("Defines:\n"+this.defines),G.LogShaderCodeOnCompilationError){var t,i;let a=null,c=null,o=null;var p;if(null!==(t=this._pipelineContext)&&void 0!==t&&t._getVertexShaderCode()&&([o,a]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),o&&(q.c.Error("Vertex code:"),q.c.Error(o))),null!==(i=this._pipelineContext)&&void 0!==i&&i._getFragmentShaderCode())[o,c]=this._getShaderCodeAndErrorLine(null===(p=this._pipelineContext)||void 0===p?void 0:p._getFragmentShaderCode(),this._compilationError,!0),o&&(q.c.Error("Fragment code:"),q.c.Error(o));a&&q.c.Error(a),c&&q.c.Error(c)}q.c.Error("Error: "+this._compilationError);const T=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};c&&(this._pipelineContext=c,this._isReady=!0,T()),s?(this._pipelineContext=null,s.hasMoreFallbacks?(this._allFallbacksProcessed=!1,q.c.Error("Trying next fallback."),this.defines=s.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,T(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||T())}get isSupported(){return""===this._compilationError}_bindTexture(a,c){this._engine._bindTexture(this._samplers[a],c,a)}setTexture(a,c){this._engine.setTexture(this._samplers[a],this._uniforms[a],c,a)}setTextureArray(a,c){const o=a+"Ex";if(-1===this._samplerList.indexOf(o+"0")){const s=this._samplerList.indexOf(a);for(let a=1;a<c.length;a++){const c=o+(a-1).toString();this._samplerList.splice(s+a,0,c)}let q=0;for(const a of this._samplerList)this._samplers[a]=q,q+=1}this._engine.setTextureArray(this._samplers[a],this._uniforms[a],c,a)}bindUniformBuffer(a,c){const o=this._uniformBuffersNames[c];void 0===o||G._BaseCache[o]===a&&this._engine._features.useUBOBindingCache||(G._BaseCache[o]=a,this._engine.bindUniformBufferBase(a,o,c))}bindUniformBlock(a,c){this._engine.bindUniformBlock(this._pipelineContext,a,c)}setInt(a,c){return this._pipelineContext.setInt(a,c),this}setInt2(a,c,o){return this._pipelineContext.setInt2(a,c,o),this}setInt3(a,c,o,s){return this._pipelineContext.setInt3(a,c,o,s),this}setInt4(a,c,o,s,q){return this._pipelineContext.setInt4(a,c,o,s,q),this}setIntArray(a,c){return this._pipelineContext.setIntArray(a,c),this}setIntArray2(a,c){return this._pipelineContext.setIntArray2(a,c),this}setIntArray3(a,c){return this._pipelineContext.setIntArray3(a,c),this}setIntArray4(a,c){return this._pipelineContext.setIntArray4(a,c),this}setUInt(a,c){return this._pipelineContext.setUInt(a,c),this}setUInt2(a,c,o){return this._pipelineContext.setUInt2(a,c,o),this}setUInt3(a,c,o,s){return this._pipelineContext.setUInt3(a,c,o,s),this}setUInt4(a,c,o,s,q){return this._pipelineContext.setUInt4(a,c,o,s,q),this}setUIntArray(a,c){return this._pipelineContext.setUIntArray(a,c),this}setUIntArray2(a,c){return this._pipelineContext.setUIntArray2(a,c),this}setUIntArray3(a,c){return this._pipelineContext.setUIntArray3(a,c),this}setUIntArray4(a,c){return this._pipelineContext.setUIntArray4(a,c),this}setFloatArray(a,c){return this._pipelineContext.setArray(a,c),this}setFloatArray2(a,c){return this._pipelineContext.setArray2(a,c),this}setFloatArray3(a,c){return this._pipelineContext.setArray3(a,c),this}setFloatArray4(a,c){return this._pipelineContext.setArray4(a,c),this}setArray(a,c){return this._pipelineContext.setArray(a,c),this}setArray2(a,c){return this._pipelineContext.setArray2(a,c),this}setArray3(a,c){return this._pipelineContext.setArray3(a,c),this}setArray4(a,c){return this._pipelineContext.setArray4(a,c),this}setMatrices(a,c){return this._pipelineContext.setMatrices(a,c),this}setMatrix(a,c){return this._pipelineContext.setMatrix(a,c),this}setMatrix3x3(a,c){return this._pipelineContext.setMatrix3x3(a,c),this}setMatrix2x2(a,c){return this._pipelineContext.setMatrix2x2(a,c),this}setFloat(a,c){return this._pipelineContext.setFloat(a,c),this}setBool(a,c){return this._pipelineContext.setInt(a,c?1:0),this}setVector2(a,c){return this._pipelineContext.setVector2(a,c),this}setFloat2(a,c,o){return this._pipelineContext.setFloat2(a,c,o),this}setVector3(a,c){return this._pipelineContext.setVector3(a,c),this}setFloat3(a,c,o,s){return this._pipelineContext.setFloat3(a,c,o,s),this}setVector4(a,c){return this._pipelineContext.setVector4(a,c),this}setQuaternion(a,c){return this._pipelineContext.setQuaternion(a,c),this}setFloat4(a,c,o,s,q){return this._pipelineContext.setFloat4(a,c,o,s,q),this}setColor3(a,c){return this._pipelineContext.setColor3(a,c),this}setColor4(a,c,o){return this._pipelineContext.setColor4(a,c,o),this}setDirectColor4(a,c){return this._pipelineContext.setDirectColor4(a,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(G.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,i.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(t.c.GetShadersStore(s)[`${a}PixelShader`]=c),o&&(t.c.GetShadersStore(s)[`${a}VertexShader`]=o)}static ResetCache(){G._BaseCache={}}}G.LogShaderCodeOnCompilationError=!0,G.PersistentMode=!1,G.AutomaticallyClearCodeCache=!1,G._UniqueIdSeed=0,G._BaseCache={},G.ShadersStore=t.c.ShadersStore,G.IncludesShadersStore=t.c.IncludesShadersStore},12667:(a,c,o)=>{o.d(c,{b:()=>q});const s={};function q(a){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!s[a])return s[a]=!0,`${a} needs to be imported before as it contains a side-effect required by your code.`}},12642:(a,c,o)=>{function s(){return"undefined"!==typeof window}function q(){return"undefined"!==typeof navigator}function t(){return"undefined"!==typeof document}function i(a){let c="",o=a.firstChild;for(;o;)3===o.nodeType&&(c+=o.textContent),o=o.nextSibling;return c}o.d(c,{b:()=>i,d:()=>t,h:()=>q,k:()=>s})},12649:(a,c,o)=>{o.d(c,{c:()=>s});class s{static _CheckLimit(a,c){let o=s._LogLimitOutputs[a];return o?o.current++:(o={limit:c,current:1},s._LogLimitOutputs[a]=o),o.current<=o.limit}static _GenerateLimitMessage(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const o=s._LogLimitOutputs[a];if(!o||!s.MessageLimitReached)return;const q=this._Levels[c];o.current===o.limit&&s[q.name](s.MessageLimitReached.replace(/%LIMIT%/g,""+o.limit).replace(/%TYPE%/g,q.name??""))}static _AddLogEntry(a){s._LogCache=a+s._LogCache,s.OnNewCacheEntry&&s.OnNewCacheEntry(a)}static _FormatMessage(a){const c=a=>a<10?"0"+a:""+a,o=new Date;return"["+c(o.getHours())+":"+c(o.getMinutes())+":"+c(o.getSeconds())+"]: "+a}static _LogDisabled(a,c){}static _LogEnabled(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const q=Array.isArray(c)?c[0]:c;if(void 0!==o&&!s._CheckLimit(q,o))return;const t=s._FormatMessage(q),i=this._Levels[a],p=Array.isArray(c)?c.slice(1):[];i.logFunc&&i.logFunc("BJS - "+t,...p);const G=`<div style='color:${i.color}'>${t}</div><br>`;s._AddLogEntry(G),s._GenerateLimitMessage(q,a)}static get LogCache(){return s._LogCache}static ClearLogCache(){s._LogCache="",s._LogLimitOutputs={},s.errorsCount=0}static set LogLevels(a){s.Log=s._LogDisabled,s.Warn=s._LogDisabled,s.Error=s._LogDisabled;const c=[s.MessageLogLevel,s.WarningLogLevel,s.ErrorLogLevel];for(const o of c)if((a&o)===o){const a=this._Levels[o];s[a.name]=s._LogEnabled.bind(s,o)}}}s.NoneLogLevel=0,s.MessageLogLevel=1,s.WarningLogLevel=2,s.ErrorLogLevel=4,s.AllLogLevel=7,s.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",s._LogCache="",s._LogLimitOutputs={},s._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],s.errorsCount=0,s.Log=s._LogEnabled.bind(s,s.MessageLogLevel),s.Warn=s._LogEnabled.bind(s,s.WarningLogLevel),s.Error=s._LogEnabled.bind(s,s.ErrorLogLevel)},12639:(a,c,o)=>{o.d(c,{d:()=>i});const s="undefined"!==typeof WeakRef;class q{constructor(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.initialize(a,c,o,s)}initialize(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return this.mask=a,this.skipNextObservers=c,this.target=o,this.currentTarget=s,this}}class t{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=a,this.mask=c,this.scope=o,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(a)}}class i{static FromPromise(a,c){const o=new i;return a.then((a=>{o.notifyObservers(a)})).catch((a=>{if(!c)throw a;c.notifyObservers(a)})),o}get observers(){return this._observers}constructor(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new q(0),a&&(this._onObserverAdded=a)}add(a){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!a)return null;const q=new t(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);q.unregisterOnNextCall=o,c?this._observers.unshift(q):this._observers.push(q),this._onObserverAdded&&this._onObserverAdded(q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(q,this._lastNotifiedValue);const i=s?new WeakRef(this):{deref:()=>this};return q._remove=function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=i.deref();c&&(a?c.remove(q):c._remove(q))},q}addOnce(a){return this.add(a,void 0,void 0,void 0,!0)}remove(a){if(!a)return!1;a._remove=null;return-1!==this._observers.indexOf(a)&&(this._deferUnregister(a),!0)}removeCallback(a,c){for(let o=0;o<this._observers.length;o++){const s=this._observers[o];if(!s._willBeUnregistered&&(s.callback===a&&(!c||c===s.scope)))return this._deferUnregister(s),!0}return!1}_deferUnregister(a){a._willBeUnregistered||(this._numObserversMarkedAsDeleted++,a.unregisterOnNextCall=!1,a._willBeUnregistered=!0,setTimeout((()=>{this._remove(a)}),0))}_remove(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!a)return!1;const o=this._observers.indexOf(a);return-1!==o&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(o,1),!0)}makeObserverTopPriority(a){this._remove(a,!1),this._observers.unshift(a)}makeObserverBottomPriority(a){this._remove(a,!1),this._observers.push(a)}notifyObservers(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),!this._observers.length)return!0;const t=this._eventState;t.mask=c,t.target=o,t.currentTarget=s,t.skipNextObservers=!1,t.lastReturnValue=a,t.userInfo=q;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&c&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?t.lastReturnValue=i.callback.apply(i.scope,[a,t]):t.lastReturnValue=i.callback(a,t)),t.skipNextObservers))return!1;return!0}notifyObserver(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),a._willBeUnregistered)return;const s=this._eventState;s.mask=o,s.skipNextObservers=!1,a.unregisterOnNextCall&&this._deferUnregister(a),a.callback(c,s)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const a=this._observers.pop();a&&(a._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const a=new i;return a._observers=this._observers.slice(0),a}hasSpecificMask(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&a||c.mask===a)return!0;return!1}}},12712:(a,c,o)=>{o.d(c,{d:()=>q,h:()=>i});let s=[];class q{static SetImmediate(a){0===s.length&&setTimeout((()=>{const a=s;s=[];for(const c of a)c()}),1),s.push(a)}}function t(a,c,o){try{if(a())return c(),!0}catch(s){return null===o||void 0===o||o(s),!0}return!1}const i=function(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,i=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&t(a,c,o))return null;const p=setInterval((()=>{t(a,c,o)?clearInterval(p):(q-=s,q<0&&(clearInterval(p),null===o||void 0===o||o(new Error("Operation timed out after maximum retries. "+(i||"")),!0)))}),s);return()=>clearInterval(p)}}}]);