"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[9],{11564:(c,r,D)=>{D.d(r,{e:()=>U,f:()=>e,k:()=>y,h:()=>A,n:()=>h});class W{constructor(){this.children=[]}isValid(c){return!0}process(c,r,D){let W="";if(this.line){let D=this.line;const M=r.processor;if(M){var B,t,u,a,H,x;M.lineProcessor&&(D=M.lineProcessor(D,r.isFragment,r.processingContext));const W=(null===(B=r.processor)||void 0===B?void 0:B.attributeKeywordName)??"attribute",E=r.isFragment&&null!==(t=r.processor)&&void 0!==t&&t.varyingFragmentKeywordName?null===(u=r.processor)||void 0===u?void 0:u.varyingFragmentKeywordName:!r.isFragment&&null!==(a=r.processor)&&void 0!==a&&a.varyingVertexKeywordName?null===(H=r.processor)||void 0===H?void 0:H.varyingVertexKeywordName:"varying";if(!r.isFragment&&M.attributeProcessor&&this.line.startsWith(W))D=M.attributeProcessor(this.line,c,r.processingContext);else if(M.varyingProcessor&&(null!==(x=M.varyingCheck)&&void 0!==x&&x.call(M,this.line,r.isFragment)||!M.varyingCheck&&this.line.startsWith(E)))D=M.varyingProcessor(this.line,r.isFragment,c,r.processingContext);else if(M.uniformProcessor&&M.uniformRegexp&&M.uniformRegexp.test(this.line))r.lookForClosingBracketForUniformBuffer||(D=M.uniformProcessor(this.line,r.isFragment,c,r.processingContext));else if(M.uniformBufferProcessor&&M.uniformBufferRegexp&&M.uniformBufferRegexp.test(this.line))r.lookForClosingBracketForUniformBuffer||(D=M.uniformBufferProcessor(this.line,r.isFragment,r.processingContext),r.lookForClosingBracketForUniformBuffer=!0);else if(M.textureProcessor&&M.textureRegexp&&M.textureRegexp.test(this.line))D=M.textureProcessor(this.line,r.isFragment,c,r.processingContext);else if((M.uniformProcessor||M.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!r.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?M.uniformProcessor&&(D=M.uniformProcessor(this.line,r.isFragment,c,r.processingContext)):M.uniformBufferProcessor&&(D=M.uniformBufferProcessor(this.line,r.isFragment,r.processingContext),r.lookForClosingBracketForUniformBuffer=!0)}r.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(r.lookForClosingBracketForUniformBuffer=!1,M.endOfUniformBufferProcessor&&(D=M.endOfUniformBufferProcessor(this.line,r.isFragment,r.processingContext)))}W+=D+"\n"}for(const M of this.children)W+=M.process(c,r,D);return this.additionalDefineKey&&(c[this.additionalDefineKey]=this.additionalDefineValue||"true",D[this.additionalDefineKey]=c[this.additionalDefineKey]),W}}class B{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(c){this._lines.length=0;for(const r of c){if(!r||"\r"===r)continue;if("#"===r[0]){this._lines.push(r);continue}const c=r.trim();if(!c)continue;if(c.startsWith("//")){this._lines.push(r);continue}const D=c.indexOf(";");if(-1===D)this._lines.push(c);else if(D===c.length-1)c.length>1&&this._lines.push(c);else{const c=r.split(";");for(let r=0;r<c.length;r++){let D=c[r];D&&(D=D.trim(),D&&this._lines.push(D+(r!==c.length-1?";":"")))}}}}}class t extends W{process(c,r,D){for(let W=0;W<this.children.length;W++){const B=this.children[W];if(B.isValid(c))return B.process(c,r,D)}return""}}class u extends W{isValid(c){return this.testExpression.isTrue(c)}}class a{isTrue(c){return!0}static postfixToInfix(c){const r=[];for(const D of c)if(void 0===a._OperatorPriority[D])r.push(D);else{const c=r[r.length-1],W=r[r.length-2];r.length-=2,r.push(`(${W}${D}${c})`)}return r[r.length-1]}static infixToPostfix(c){const r=a._InfixToPostfixCache.get(c);if(r)return r.accessTime=Date.now(),r.result;if(!c.includes("&&")&&!c.includes("||")&&!c.includes(")")&&!c.includes("("))return[c];const D=[];let W=-1;const B=()=>{M=M.trim(),""!==M&&(D.push(M),M="")},t=c=>{W<a._Stack.length-1&&(a._Stack[++W]=c)},u=()=>a._Stack[W],H=()=>-1===W?"!!INVALID EXPRESSION!!":a._Stack[W--];let x=0,M="";for(;x<c.length;){const r=c.charAt(x),E=x<c.length-1?c.substring(x,2+x):"";if("("===r)M="",t(r);else if(")"===r){for(B();-1!==W&&"("!==u();)D.push(H());H()}else if(a._OperatorPriority[E]>1){for(B();-1!==W&&a._OperatorPriority[u()]>=a._OperatorPriority[E];)D.push(H());t(E),x++}else M+=r;x++}for(B();-1!==W;)"("===u()?H():D.push(H());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(c,{result:D,accessTime:Date.now()}),D}static ClearCache(){const c=Array.from(a._InfixToPostfixCache.entries()).sort(((c,r)=>c[1].accessTime-r[1].accessTime));for(let r=0;r<a.InfixToPostfixCacheCleanupSize;r++)a._InfixToPostfixCache.delete(c[r][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class H extends a{constructor(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=c,this.not=r}isTrue(c){let r=void 0!==c[this.define];return this.not&&(r=!r),r}}class x extends a{isTrue(c){return this.leftOperand.isTrue(c)||this.rightOperand.isTrue(c)}}class M extends a{isTrue(c){return this.leftOperand.isTrue(c)&&this.rightOperand.isTrue(c)}}class E extends a{constructor(c,r,D){super(),this.define=c,this.operand=r,this.testValue=D}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(c){let r=!1;const D=parseInt(void 0!=c[this.define]?c[this.define]:this.define),W=parseInt(void 0!=c[this.testValue]?c[this.testValue]:this.testValue);if(isNaN(D)||isNaN(W))return!1;switch(this.operand){case">":r=D>W;break;case"<":r=D<W;break;case"<=":r=D<=W;break;case">=":r=D>=W;break;case"==":r=D===W;break;case"!=":r=D!==W}return r}}var m=D(11524),Y=D(11572);const v=/defined\s*?\((.+?)\)/g,k=/defined\s*?\[(.+?)\]/g,w=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,Z=/__decl__/,J=/light\{X\}.(\w*)/g,q=/\{X\}/g,j=[],X=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function e(c){c.processor&&c.processor.initializeShaders&&c.processor.initializeShaders(c.processingContext)}function y(c,r,D,W){var B;null!==(B=r.processor)&&void 0!==B&&B.preProcessShaderCode&&(c=r.processor.preProcessShaderCode(c,r.isFragment)),A(c,r,(c=>{r.processCodeAfterIncludes&&(c=r.processCodeAfterIncludes(r.isFragment?"fragment":"vertex",c,r.defines));const B=function(c,r,D){let W=function(c,r){var D;if(null!==(D=r.processor)&&void 0!==D&&D.noPrecision)return c;const W=r.shouldUseHighPrecisionShader;-1===c.indexOf("precision highp float")?c=W?"precision highp float;\n"+c:"precision mediump float;\n"+c:W||(c=c.replace("precision highp float","precision mediump float"));return c}(c,r);if(!r.processor)return W;if(0===r.processor.shaderLanguage&&-1!==W.indexOf("#version 3")&&(W=W.replace("#version 300 es",""),!r.processor.parseGLES3))return W;const B=r.defines,t=f(r,D);r.processor.preProcessor&&(W=r.processor.preProcessor(W,B,t,r.isFragment,r.processingContext));const u={};W=K(W,t,r,u),r.processor.postProcessor&&(W=r.processor.postProcessor(W,B,r.isFragment,r.processingContext,D?{drawBuffersExtensionDisabled:!D.getCaps().drawBuffersExtension}:{},t,u));null!==D&&void 0!==D&&D._features.needShaderCodeInlining&&(W=D.inlineShaderCode(W));return W}(c,r,W);D(B,c)}))}function U(c,r,D){return D.processor&&D.processor.finalizeShaders?D.processor.finalizeShaders(c,r,D.processingContext):{vertexCode:c,fragmentCode:r}}function N(c){const r=/defined\((.+)\)/.exec(c);if(r&&r.length)return new H(r[1].trim(),"!"===c[0]);const D=["==","!=",">=","<=","<",">"];let W="",B=0;for(W of D)if(B=c.indexOf(W),B>-1)break;if(-1===B)return new H(c);const t=c.substring(0,B).trim(),u=c.substring(B+W.length).trim();return new E(t,W,u)}function g(c,r){const D=new u,W=c.substring(0,r);let B=c.substring(r);return B=B.substring(0,(B.indexOf("//")+1||B.length+1)-1).trim(),D.testExpression="#ifdef"===W?new H(B):"#ifndef"===W?new H(B,!0):function(c){c=c.replace(v,"defined[$1]");const r=a.infixToPostfix(c),D=[];for(const B of r)if("||"!==B&&"&&"!==B)D.push(B);else if(D.length>=2){let c=D[D.length-1],r=D[D.length-2];D.length-=2;const W="&&"==B?new M:new x;"string"===typeof c&&(c=c.replace(k,"defined($1)")),"string"===typeof r&&(r=r.replace(k,"defined($1)")),W.leftOperand="string"===typeof r?N(r):r,W.rightOperand="string"===typeof c?N(c):c,D.push(W)}let W=D[D.length-1];return"string"===typeof W&&(W=W.replace(k,"defined($1)")),"string"===typeof W?N(W):W}(B),D}function z(c,r,D,B){let t=c.currentLine;for(;S(c,D,B);){t=c.currentLine;const u=t.substring(0,5).toLowerCase();if("#else"===u){const D=new W;return r.children.push(D),void S(c,D,B)}if("#elif"===u){const c=g(t,5);r.children.push(c),D=c}}}function S(c,r,D){for(;c.canRead;){c.lineIndex++;const B=c.currentLine;if(B.indexOf("#")>=0){const W=X.exec(B);if(W&&W.length){switch(W[0]){case"#ifdef":{const W=new t;r.children.push(W);const u=g(B,6);W.children.push(u),z(c,W,u,D);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const W=new t;r.children.push(W);const u=g(B,7);W.children.push(u),z(c,W,u,D);break}case"#if":{const W=new t,u=g(B,3);r.children.push(W),W.children.push(u),z(c,W,u,D);break}}continue}}const u=new W;if(u.line=B,r.children.push(u),"#"===B[0]&&"d"===B[1]){const c=B.replace(";","").split(" ");u.additionalDefineKey=c[1],3===c.length&&(u.additionalDefineValue=c[2])}}return!1}function K(c,r,D,t){const u=new W,a=new B;return a.lineIndex=-1,a.lines=c.split("\n"),S(a,u,t),u.process(r,D,t)}function f(c,r){var D;const W=c.defines,B={};for(const t of W){const c=t.replace("#define","").replace(";","").trim().split(" ");B[c[0]]=c.length>1?c[1]:""}return 0===(null===(D=c.processor)||void 0===D?void 0:D.shaderLanguage)&&(B.GL_ES="true"),B.__VERSION__=c.version,B[c.platformName]="true",(0,Y.g)(B,null===r||void 0===r?void 0:r.isNDCHalfZRange,null===r||void 0===r?void 0:r.useReverseDepthBuffer,null===r||void 0===r?void 0:r.useExactSrgbConversions),B}function A(c,r,D){let W;for(j.length=0;null!==(W=w.exec(c));)j.push(W);let B=String(c),t=[c],u=!1;for(const a of j){let c=a[1];if(-1!==c.indexOf("__decl__")&&(c=c.replace(Z,""),r.supportsUniformBuffers&&(c=c.replace("Vertex","Ubo").replace("Fragment","Ubo")),c+="Declaration"),!r.includesShadersStore[c]){const W=r.shadersRepository+"ShadersInclude/"+c+".fx";return void h.loadFile(W,(W=>{r.includesShadersStore[c]=W,A(t.join(""),r,D)}))}{let D=r.includesShadersStore[c];if(a[2]){const c=a[3].split(",");for(let r=0;r<c.length;r+=2){const W=new RegExp(c[r],"g"),B=c[r+1];D=D.replace(W,B)}}if(a[4]){const c=a[5];if(-1!==c.indexOf("..")){const W=c.split(".."),B=parseInt(W[0]);let t=parseInt(W[1]),u=D.slice(0);D="",isNaN(t)&&(t=r.indexParameters[W[1]]);for(let c=B;c<t;c++)r.supportsUniformBuffers||(u=u.replace(J,((c,r)=>r+"{X}"))),D+=u.replace(q,c.toString())+"\n"}else r.supportsUniformBuffers||(D=D.replace(J,((c,r)=>r+"{X}"))),D=D.replace(q,c)}const W=[];for(const c of t){const r=c.split(a[0]);for(let c=0;c<r.length-1;c++)W.push(r[c]),W.push(D);W.push(r[r.length-1])}t=W,u=u||D.indexOf("#include<")>=0||D.indexOf("#include <")>=0}}j.length=0,B=t.join(""),u?A(B.toString(),r,D):D(B)}const h={loadFile:(c,r,D,W,B,t)=>{throw(0,m.e)("FileTools")}}},11572:(c,r,D)=>{D.d(r,{b:()=>B,e:()=>t,g:()=>a,i:()=>u,j:()=>H});var W=D(11524);D(11501);const B={};function t(c,r){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(r?r+"\n":"")+c}function u(c,r,D,t,u,a,H){const x=H||B.loadFile;if(x){return x(c,r,D,t,u,a)}throw(0,W.e)("FileTools")}function a(c,r,D,W){if(c)return r?c.IS_NDC_HALF_ZRANGE="":delete c.IS_NDC_HALF_ZRANGE,D?c.USE_REVERSE_DEPTHBUFFER="":delete c.USE_REVERSE_DEPTHBUFFER,void(W?c.USE_EXACT_SRGB_CONVERSIONS="":delete c.USE_EXACT_SRGB_CONVERSIONS);{let c="";return r&&(c+="#define IS_NDC_HALF_ZRANGE"),D&&(c&&(c+="\n"),c+="#define USE_REVERSE_DEPTHBUFFER"),W&&(c&&(c+="\n"),c+="#define USE_EXACT_SRGB_CONVERSIONS"),c}}function H(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3?arguments[3]:void 0;switch(c){case 3:{const c=(ArrayBuffer,new Int8Array(r));return W&&c.set(new Int8Array(W)),c}case 0:{const c=(ArrayBuffer,new Uint8Array(r));return W&&c.set(new Uint8Array(W)),c}case 4:{const c=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(D?r/2:r);return W&&c.set(new Int16Array(W)),c}case 5:case 8:case 9:case 10:case 2:{const c=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(D?r/2:r);return W&&c.set(new Uint16Array(W)),c}case 6:{const c=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(D?r/4:r);return W&&c.set(new Int32Array(W)),c}case 7:case 11:case 12:case 13:case 14:case 15:{const c=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(D?r/4:r);return W&&c.set(new Uint32Array(W)),c}case 1:{const c=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(D?r/4:r);return W&&c.set(new Float32Array(W)),c}}const B=(ArrayBuffer,new Uint8Array(r));return W&&B.set(new Uint8Array(W)),B}},11595:(c,r,D)=>{D.d(r,{d:()=>W});class W{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?W.ShadersRepository:W.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?W.ShadersStore:W.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?W.IncludesShadersStore:W.IncludesShadersStoreWGSL}}W.ShadersRepository="src/Shaders/",W.ShadersStore={},W.IncludesShadersStore={},W.ShadersRepositoryWGSL="src/ShadersWGSL/",W.ShadersStoreWGSL={},W.IncludesShadersStoreWGSL={}},11601:(c,r,D)=>{D.d(r,{b:()=>m,c:()=>q,f:()=>v,j:()=>Y,m:()=>k,p:()=>J,q:()=>E,u:()=>x,w:()=>M,A:()=>H,C:()=>a});class W{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.wr._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(c){c&&this.program&&c(this.program)}setEngine(c){this.wr=c}_fillEffectInformation(c,r,D,W,B,t,u,a){const H=this.wr;if(H.supportsUniformBuffers)for(const M in r)c.bindUniformBlock(M,r[M]);let x;for(this.wr.getUniforms(this,D).forEach(((c,r)=>{W[D[r]]=c})),this._uniforms=W,x=0;x<B.length;x++){null==c.getUniform(B[x])&&(B.splice(x,1),x--)}B.forEach(((c,r)=>{t[c]=r}));for(const M of H.getAttributes(this,u))a.push(M)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(c,r){const D=this._valueCache[c],W=r.updateFlag;return(void 0===D||D!==W)&&(this._valueCache[c]=W,!0)}_cacheFloat2(c,r,D){let W=this._valueCache[c];if(!W||2!==W.length)return W=[r,D],this._valueCache[c]=W,!0;let B=!1;return W[0]!==r&&(W[0]=r,B=!0),W[1]!==D&&(W[1]=D,B=!0),B}_cacheFloat3(c,r,D,W){let B=this._valueCache[c];if(!B||3!==B.length)return B=[r,D,W],this._valueCache[c]=B,!0;let t=!1;return B[0]!==r&&(B[0]=r,t=!0),B[1]!==D&&(B[1]=D,t=!0),B[2]!==W&&(B[2]=W,t=!0),t}_cacheFloat4(c,r,D,W,B){let t=this._valueCache[c];if(!t||4!==t.length)return t=[r,D,W,B],this._valueCache[c]=t,!0;let u=!1;return t[0]!==r&&(t[0]=r,u=!0),t[1]!==D&&(t[1]=D,u=!0),t[2]!==W&&(t[2]=W,u=!0),t[3]!==B&&(t[3]=B,u=!0),u}setInt(c,r){const D=this._valueCache[c];void 0!==D&&D===r||this.wr.setInt(this._uniforms[c],r)&&(this._valueCache[c]=r)}setInt2(c,r,D){this._cacheFloat2(c,r,D)&&(this.wr.setInt2(this._uniforms[c],r,D)||(this._valueCache[c]=null))}setInt3(c,r,D,W){this._cacheFloat3(c,r,D,W)&&(this.wr.setInt3(this._uniforms[c],r,D,W)||(this._valueCache[c]=null))}setInt4(c,r,D,W,B){this._cacheFloat4(c,r,D,W,B)&&(this.wr.setInt4(this._uniforms[c],r,D,W,B)||(this._valueCache[c]=null))}setIntArray(c,r){this._valueCache[c]=null,this.wr.setIntArray(this._uniforms[c],r)}setIntArray2(c,r){this._valueCache[c]=null,this.wr.setIntArray2(this._uniforms[c],r)}setIntArray3(c,r){this._valueCache[c]=null,this.wr.setIntArray3(this._uniforms[c],r)}setIntArray4(c,r){this._valueCache[c]=null,this.wr.setIntArray4(this._uniforms[c],r)}setUInt(c,r){const D=this._valueCache[c];void 0!==D&&D===r||this.wr.setUInt(this._uniforms[c],r)&&(this._valueCache[c]=r)}setUInt2(c,r,D){this._cacheFloat2(c,r,D)&&(this.wr.setUInt2(this._uniforms[c],r,D)||(this._valueCache[c]=null))}setUInt3(c,r,D,W){this._cacheFloat3(c,r,D,W)&&(this.wr.setUInt3(this._uniforms[c],r,D,W)||(this._valueCache[c]=null))}setUInt4(c,r,D,W,B){this._cacheFloat4(c,r,D,W,B)&&(this.wr.setUInt4(this._uniforms[c],r,D,W,B)||(this._valueCache[c]=null))}setUIntArray(c,r){this._valueCache[c]=null,this.wr.setUIntArray(this._uniforms[c],r)}setUIntArray2(c,r){this._valueCache[c]=null,this.wr.setUIntArray2(this._uniforms[c],r)}setUIntArray3(c,r){this._valueCache[c]=null,this.wr.setUIntArray3(this._uniforms[c],r)}setUIntArray4(c,r){this._valueCache[c]=null,this.wr.setUIntArray4(this._uniforms[c],r)}setArray(c,r){this._valueCache[c]=null,this.wr.setArray(this._uniforms[c],r)}setArray2(c,r){this._valueCache[c]=null,this.wr.setArray2(this._uniforms[c],r)}setArray3(c,r){this._valueCache[c]=null,this.wr.setArray3(this._uniforms[c],r)}setArray4(c,r){this._valueCache[c]=null,this.wr.setArray4(this._uniforms[c],r)}setMatrices(c,r){r&&(this._valueCache[c]=null,this.wr.setMatrices(this._uniforms[c],r))}setMatrix(c,r){this._cacheMatrix(c,r)&&(this.wr.setMatrices(this._uniforms[c],r.Ma())||(this._valueCache[c]=null))}setMatrix3x3(c,r){this._valueCache[c]=null,this.wr.setMatrix3x3(this._uniforms[c],r)}setMatrix2x2(c,r){this._valueCache[c]=null,this.wr.setMatrix2x2(this._uniforms[c],r)}setFloat(c,r){const D=this._valueCache[c];void 0!==D&&D===r||this.wr.setFloat(this._uniforms[c],r)&&(this._valueCache[c]=r)}setVector2(c,r){this._cacheFloat2(c,r.x,r.y)&&(this.wr.setFloat2(this._uniforms[c],r.x,r.y)||(this._valueCache[c]=null))}setFloat2(c,r,D){this._cacheFloat2(c,r,D)&&(this.wr.setFloat2(this._uniforms[c],r,D)||(this._valueCache[c]=null))}setVector3(c,r){this._cacheFloat3(c,r.x,r.y,r.z)&&(this.wr.setFloat3(this._uniforms[c],r.x,r.y,r.z)||(this._valueCache[c]=null))}setFloat3(c,r,D,W){this._cacheFloat3(c,r,D,W)&&(this.wr.setFloat3(this._uniforms[c],r,D,W)||(this._valueCache[c]=null))}setVector4(c,r){this._cacheFloat4(c,r.x,r.y,r.z,r.w)&&(this.wr.setFloat4(this._uniforms[c],r.x,r.y,r.z,r.w)||(this._valueCache[c]=null))}setQuaternion(c,r){this._cacheFloat4(c,r.x,r.y,r.z,r.w)&&(this.wr.setFloat4(this._uniforms[c],r.x,r.y,r.z,r.w)||(this._valueCache[c]=null))}setFloat4(c,r,D,W,B){this._cacheFloat4(c,r,D,W,B)&&(this.wr.setFloat4(this._uniforms[c],r,D,W,B)||(this._valueCache[c]=null))}setColor3(c,r){this._cacheFloat3(c,r.r,r.g,r.b)&&(this.wr.setFloat3(this._uniforms[c],r.r,r.g,r.b)||(this._valueCache[c]=null))}setColor4(c,r,D){this._cacheFloat4(c,r.r,r.g,r.b,D)&&(this.wr.setFloat4(this._uniforms[c],r.r,r.g,r.b,D)||(this._valueCache[c]=null))}setDirectColor4(c,r){this._cacheFloat4(c,r.r,r.g,r.b,r.a)&&(this.wr.setFloat4(this._uniforms[c],r.r,r.g,r.b,r.a)||(this._valueCache[c]=null))}_getVertexShaderCode(){return this.vertexShader?this.wr._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.wr._getShaderSource(this.fragmentShader):null}}var B=D(11572);const t=new WeakMap,u={_webGLVersion:2,cachedPipelines:{}};function a(c){let r=t.get(c);if(!r){if(!c)return u;r={_webGLVersion:c.TEXTURE_BINDING_3D?2:1,_context:c,parallelShaderCompile:c.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},t.set(c,r)}return r}function H(c){t.delete(c)}function x(c,r,D,W,B,t){const u=a(W);t||(t=u._createShaderProgramInjection??m);return t(c,Z(r,"vertex",W,u._contextWasLost),Z(D,"fragment",W,u._contextWasLost),W,B,u.validateShaderPrograms)}function M(c,r,D,W,B){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6?arguments[6]:void 0;const H=a(B);u||(u=H._createShaderProgramInjection??m);const x=H._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return u(c,w(r,"vertex",W,x,B,H._contextWasLost),w(D,"fragment",W,x,B,H._contextWasLost),B,t,H.validateShaderPrograms)}function E(c,r){const D=new W,B=a(c);return B.parallelShaderCompile&&!B.disableParallelShaderCompile&&(D.isParallelCompiled=!0),D.context=B._context,D}function m(c,r,D,W){let B=arguments.length>5?arguments[5]:void 0;const t=W.createProgram();if(c.program=t,!t)throw new Error("Unable to create program");return W.attachShader(t,r),W.attachShader(t,D),W.linkProgram(t),c.context=W,c.vertexShader=r,c.fragmentShader=D,c.isParallelCompiled||v(c,W,B),t}function Y(c,r,D){const W=c;if(W._isDisposed)return!1;const B=a(r);return!!(B&&B.parallelShaderCompile&&B.parallelShaderCompile.COMPLETION_STATUS_KHR&&W.program&&r.getProgramParameter(W.program,B.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(v(W,r,D),!0)}function v(c,r,D){const W=c.context,B=c.vertexShader,t=c.fragmentShader,u=c.program;if(!W.getProgramParameter(u,W.LINK_STATUS)){if(!r.getShaderParameter(B,r.COMPILE_STATUS)){const D=r.getShaderInfoLog(B);if(D)throw c.vertexCompilationError=D,new Error("VERTEX SHADER "+D)}if(!r.getShaderParameter(t,r.COMPILE_STATUS)){const D=r.getShaderInfoLog(t);if(D)throw c.fragmentCompilationError=D,new Error("FRAGMENT SHADER "+D)}const D=W.getProgramInfoLog(u);if(D)throw c.programLinkError=D,new Error(D)}if(D){W.validateProgram(u);if(!W.getProgramParameter(u,W.VALIDATE_STATUS)){const r=W.getProgramInfoLog(u);if(r)throw c.programValidationError=r,new Error(r)}}W.deleteShader(B),W.deleteShader(t),c.vertexShader=void 0,c.fragmentShader=void 0,c.onCompiled&&(c.onCompiled(),c.onCompiled=void 0)}function k(c,r,D,W,B,t,u,H,E){let m=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0;const k=a(c.context);Y||(Y=k.createRawShaderProgramInjection??x),v||(v=k.createShaderProgramInjection??M);const w=c;w.program=W?Y(w,r,D,w.context,E):v(w,r,D,H,w.context,E),w.program.__SPECTOR_rebuildProgram=u,m()}function w(c,r,D,W,t,u){return Z((0,B.e)(c,D,W),r,t,u)}function Z(c,r,D,W){const B=D.createShader("vertex"===r?D.VERTEX_SHADER:D.FRAGMENT_SHADER);if(!B){let c=D.NO_ERROR,B=D.NO_ERROR;for(;(B=D.getError())!==D.NO_ERROR;)c=B;throw new Error(`Something went wrong while creating a gl ${r} shader object. gl error=${c}, gl isContextLost=${D.isContextLost()}, _contextWasLost=${W}`)}return D.shaderSource(B,c),D.compileShader(B),B}function J(c,r){r.useProgram(c)}function q(c,r){const D=c;if(!D.isParallelCompiled)return void r(c);const W=D.onCompiled;D.onCompiled=()=>{null===W||void 0===W||W(),r(c)}}},11597:(c,r,D)=>{D.d(r,{e:()=>E,i:()=>Y,k:()=>x,l:()=>M});var W=D(11501),B=D(11601),t=D(11595),u=D(11509),a=D(11564),H=D(11572);function x(c,r){return(0,B.C)(r).cachedPipelines[c]}function M(c){const r=c._name,D=c.context;if(r&&D){const c=(0,B.C)(D),W=c.cachedPipelines[r];null===W||void 0===W||W.dispose(),delete c.cachedPipelines[r]}}function E(c,r,D,B,t,u,H){let x,M;const E=(0,W.f)()?null===u||void 0===u?void 0:u.getHostDocument():null;x="string"===typeof r?r:r.vertexSource?"source:"+r.vertexSource:r.vertexElement?(null===E||void 0===E?void 0:E.getElementById(r.vertexElement))||r.vertexElement:r.vertex||r,M="string"===typeof r?r:r.fragmentSource?"source:"+r.fragmentSource:r.fragmentElement?(null===E||void 0===E?void 0:E.getElementById(r.fragmentElement))||r.fragmentElement:r.fragment||r;const Y=[void 0,void 0],v=()=>{if(Y[0]&&Y[1]){c.isFragment=!0;const[W,x]=Y;(0,a.k)(x,c,((u,x)=>{H&&(H._fragmentSourceCodeBeforeMigration=x),D&&(u=D("fragment",u));const M=(0,a.e)(W,u,c);c=null;const E=function(c,r,D,W){if(D){return{vertexSourceCode:(1===W?"//":"")+"#define SHADER_NAME vertex:"+(D.vertexElement||D.vertex||D.spectorName||D)+"\n"+c,fragmentSourceCode:(1===W?"//":"")+"#define SHADER_NAME fragment:"+(D.fragmentElement||D.fragment||D.spectorName||D)+"\n"+r}}return{vertexSourceCode:c,fragmentSourceCode:r}}(M.vertexCode,M.fragmentCode,r,t);null===B||void 0===B||B(E.vertexSourceCode,E.fragmentSourceCode)}),u)}};m(x,"Vertex","",(r=>{(0,a.f)(c),(0,a.k)(r,c,((c,W)=>{H&&(H._rawVertexSourceCode=r,H._vertexSourceCodeBeforeMigration=W),D&&(c=D("vertex",c)),Y[0]=c,v()}),u)}),t),m(M,"Fragment","Pixel",(c=>{H&&(H._rawFragmentSourceCode=c),Y[1]=c,v()}),t)}function m(c,r,D,B,u,a){if("undefined"!==typeof HTMLElement&&c instanceof HTMLElement){return void B((0,W.c)(c))}if("source:"===c.substring(0,7))return void B(c.substring(7));if("base64:"===c.substring(0,7)){return void B(window.atob(c.substring(7)))}const x=t.d.GetShadersStore(u);if(x[c+r+"Shader"])return void B(x[c+r+"Shader"]);if(D&&x[c+D+"Shader"])return void B(x[c+D+"Shader"]);let M;if(M="."===c[0]||"/"===c[0]||c.indexOf("http")>-1?c:t.d.GetShadersRepository(u)+c,!(a=a||H.i))throw new Error("loadFileInjection is not defined");a(M+"."+r.toLowerCase()+".fx",B)}const Y=(c,r,D,W)=>{try{const t=c.context?(0,B.C)(c.context):null;t&&(t.disableParallelShaderCompile=c.disableParallelCompilation);const u=c.existingPipelineContext||r(c.shaderProcessingContext);return u._name=c.name,c.name&&t&&(t.cachedPipelines[c.name]=u),D(u,c.vertex,c.fragment,!!c.createAsRaw,"","",c.rebuildRebind,c.defines,c.transformFeedbackVaryings,"",(()=>{W(u,(()=>{var r;null===(r=c.onRenderingStateCompiled)||void 0===r||r.call(c,u)}))})),u}catch(t){throw u.e.Error("Error compiling effect"),t}}},11586:(c,r,D)=>{D.r(r),D.d(r,{Effect:()=>H});var W=D(11494),B=D(11509),t=D(11595),u=D(11597),a=D(11581);class H{static get ShadersRepository(){return t.d.ShadersRepository}static set ShadersRepository(c){t.d.ShadersRepository=c}get M(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new W.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9?arguments[9]:void 0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,k=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new W.c,this.onErrorObservable=new W.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=c,this._key=Y;const w=this._key.replace(/\r/g,"").replace(/\n/g,"|");let Z;if(r.attributes){const c=r;if(this._engine=D,this._attributesNames=c.attributes,this._uniformsNames=c.uniformsNames.concat(c.samplers),this._samplerList=c.samplers.slice(),this.defines=c.defines,this.onError=c.onError,this.onCompiled=c.onCompiled,this._fallbacks=c.fallbacks,this._indexParameters=c.indexParameters,this._transformFeedbackVaryings=c.transformFeedbackVaryings||null,this._multiTarget=!!c.multiTarget,this._shaderLanguage=c.shaderLanguage??0,this._disableParallelShaderCompilation=!!c.disableParallelShaderCompilation,c.uniformBuffersNames){this._uniformBuffersNamesList=c.uniformBuffersNames.slice();for(let r=0;r<c.uniformBuffersNames.length;r++)this._uniformBuffersNames[c.uniformBuffersNames[r]]=r}this._processFinalCode=c.processFinalCode??null,this._processCodeAfterIncludes=c.processCodeAfterIncludes??void 0,k=c.extraInitializationsAsync,Z=c.existingPipelineContext}else this._engine=t,this.defines=null==a?"":a,this._uniformsNames=D.concat(B),this._samplerList=B?B.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this._shaderLanguage=v,this.onError=E,this.onCompiled=M,this._indexParameters=m,this._fallbacks=x;"WEBGL2"===this._engine.shaderPlatformName&&(Z=(0,u.k)(w,this._engine._gl)??Z),this._attributeLocationByName={},this.uniqueId=H._UniqueIdSeed++,Z?(this._pipelineContext=Z,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,k),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.M||this.dispose(!0)}))}async _processShaderCodeAsync(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3?arguments[3]:void 0;W&&await W(),this._processingContext=D||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const B={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:c??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:t.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:t.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,u.e)(B,this.name,this._processFinalCode,((c,D)=>{this._vertexSourceCode=c,this._fragmentSourceCode=D,this._prepareEffect(r)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.M||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(c){return this._attributes[c]}getAttributeLocationByName(c){return this._attributeLocationByName[c]}getAttributesCount(){return this._attributes.length}getUniformIndex(c){return this._uniformsNames.indexOf(c)}getUniform(c){return this._uniforms[c]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((c=>{this.executeWhenCompiled(c)}))}executeWhenCompiled(c){this.isReady()?c(this):(this.onCompileObservable.add((r=>{c(r)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(c){(0,a.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(r=>{this._processCompilationErrors(r,c)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var c;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(c=this._pipelineContext)||void 0===c?void 0:c._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var c;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(c=this._pipelineContext)||void 0===c?void 0:c._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(c,r,D,W){this._isReady=!1,this._vertexSourceCodeOverride=c,this._fragmentSourceCodeOverride=r,this.onError=(c,r)=>{W&&W(r)},this.onCompiled=()=>{var c,r;const W=this.getEngine().scenes;if(W)for(let D=0;D<W.length;D++)W[D].markAllMaterialsAsDirty(127);null===(c=(r=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===c||c.call(r,D)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(c){if(this._pipelineContext=c,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let r=0;r<this._attributesNames.length;r++){const c=this._attributesNames[r];this._attributeLocationByName[c]=this._attributes[r]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),H.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=this._pipelineContext;this._isReady=!1;try{const D=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),W=D?null:this.defines,B=D?this._vertexSourceCodeOverride:this._vertexSourceCode,t=D?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,u.i)({existingPipelineContext:c?r:null,vertex:B,fragment:t,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(c,r,D,W)=>this._rebuildProgram(c,r,D,W),defines:W,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:D,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:D=>{r&&!c&&this._engine._deletePipelineContext(r),D&&this._onRenderingStateCompiled(D)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(r)}catch(D){this._processCompilationErrors(D,r)}}_getShaderCodeAndErrorLine(c,r,D){const W=D?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let B=null;if(r&&c){const t=r.match(W);if(t&&2===t.length){const r=parseInt(t[1]),W=c.split("\n",-1);W.length>=r&&(B=`Offending line [${r}] in ${D?"fragment":"vertex"} code: ${W[r-1]}`)}}return[c,B]}_processCompilationErrors(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=c.message;const D=this._attributesNames,W=this._fallbacks;if(B.e.Error("Unable to compile effect:"),B.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),B.e.Error(`Attributes: ${D.join(" ")}`),B.e.Error("Defines:\n"+this.defines),H.LogShaderCodeOnCompilationError){var t,u;let c=null,r=null,D=null;var a;if(null!==(t=this._pipelineContext)&&void 0!==t&&t._getVertexShaderCode()&&([D,c]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),D&&(B.e.Error("Vertex code:"),B.e.Error(D))),null!==(u=this._pipelineContext)&&void 0!==u&&u._getFragmentShaderCode())[D,r]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),D&&(B.e.Error("Fragment code:"),B.e.Error(D));c&&B.e.Error(c),r&&B.e.Error(r)}B.e.Error("Error: "+this._compilationError);const x=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};r&&(this._pipelineContext=r,this._isReady=!0,x()),W?(this._pipelineContext=null,W.hasMoreFallbacks?(this._allFallbacksProcessed=!1,B.e.Error("Trying next fallback."),this.defines=W.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,x(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,r||x())}get isSupported(){return""===this._compilationError}_bindTexture(c,r){this._engine._bindTexture(this._samplers[c],r,c)}setTexture(c,r){this._engine.setTexture(this._samplers[c],this._uniforms[c],r,c)}setTextureArray(c,r){const D=c+"Ex";if(-1===this._samplerList.indexOf(D+"0")){const W=this._samplerList.indexOf(c);for(let c=1;c<r.length;c++){const r=D+(c-1).toString();this._samplerList.splice(W+c,0,r)}let B=0;for(const c of this._samplerList)this._samplers[c]=B,B+=1}this._engine.setTextureArray(this._samplers[c],this._uniforms[c],r,c)}bindUniformBuffer(c,r){const D=this._uniformBuffersNames[r];void 0===D||H._BaseCache[D]===c&&this._engine._features.useUBOBindingCache||(H._BaseCache[D]=c,this._engine.bindUniformBufferBase(c,D,r))}bindUniformBlock(c,r){this._engine.bindUniformBlock(this._pipelineContext,c,r)}setInt(c,r){return this._pipelineContext.setInt(c,r),this}setInt2(c,r,D){return this._pipelineContext.setInt2(c,r,D),this}setInt3(c,r,D,W){return this._pipelineContext.setInt3(c,r,D,W),this}setInt4(c,r,D,W,B){return this._pipelineContext.setInt4(c,r,D,W,B),this}setIntArray(c,r){return this._pipelineContext.setIntArray(c,r),this}setIntArray2(c,r){return this._pipelineContext.setIntArray2(c,r),this}setIntArray3(c,r){return this._pipelineContext.setIntArray3(c,r),this}setIntArray4(c,r){return this._pipelineContext.setIntArray4(c,r),this}setUInt(c,r){return this._pipelineContext.setUInt(c,r),this}setUInt2(c,r,D){return this._pipelineContext.setUInt2(c,r,D),this}setUInt3(c,r,D,W){return this._pipelineContext.setUInt3(c,r,D,W),this}setUInt4(c,r,D,W,B){return this._pipelineContext.setUInt4(c,r,D,W,B),this}setUIntArray(c,r){return this._pipelineContext.setUIntArray(c,r),this}setUIntArray2(c,r){return this._pipelineContext.setUIntArray2(c,r),this}setUIntArray3(c,r){return this._pipelineContext.setUIntArray3(c,r),this}setUIntArray4(c,r){return this._pipelineContext.setUIntArray4(c,r),this}setFloatArray(c,r){return this._pipelineContext.setArray(c,r),this}setFloatArray2(c,r){return this._pipelineContext.setArray2(c,r),this}setFloatArray3(c,r){return this._pipelineContext.setArray3(c,r),this}setFloatArray4(c,r){return this._pipelineContext.setArray4(c,r),this}setArray(c,r){return this._pipelineContext.setArray(c,r),this}setArray2(c,r){return this._pipelineContext.setArray2(c,r),this}setArray3(c,r){return this._pipelineContext.setArray3(c,r),this}setArray4(c,r){return this._pipelineContext.setArray4(c,r),this}setMatrices(c,r){return this._pipelineContext.setMatrices(c,r),this}setMatrix(c,r){return this._pipelineContext.setMatrix(c,r),this}setMatrix3x3(c,r){return this._pipelineContext.setMatrix3x3(c,r),this}setMatrix2x2(c,r){return this._pipelineContext.setMatrix2x2(c,r),this}setFloat(c,r){return this._pipelineContext.setFloat(c,r),this}setBool(c,r){return this._pipelineContext.setInt(c,r?1:0),this}setVector2(c,r){return this._pipelineContext.setVector2(c,r),this}setFloat2(c,r,D){return this._pipelineContext.setFloat2(c,r,D),this}setVector3(c,r){return this._pipelineContext.setVector3(c,r),this}setFloat3(c,r,D,W){return this._pipelineContext.setFloat3(c,r,D,W),this}setVector4(c,r){return this._pipelineContext.setVector4(c,r),this}setQuaternion(c,r){return this._pipelineContext.setQuaternion(c,r),this}setFloat4(c,r,D,W,B){return this._pipelineContext.setFloat4(c,r,D,W,B),this}setColor3(c,r){return this._pipelineContext.setColor3(c,r),this}setColor4(c,r,D){return this._pipelineContext.setColor4(c,r,D),this}setDirectColor4(c,r){return this._pipelineContext.setDirectColor4(c,r),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(H.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,u.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r&&(t.d.GetShadersStore(W)[`${c}PixelShader`]=r),D&&(t.d.GetShadersStore(W)[`${c}VertexShader`]=D)}static ResetCache(){H._BaseCache={}}}H.LogShaderCodeOnCompilationError=!0,H.PersistentMode=!1,H.AutomaticallyClearCodeCache=!1,H._UniqueIdSeed=0,H._BaseCache={},H.ShadersStore=t.d.ShadersStore,H.IncludesShadersStore=t.d.IncludesShadersStore},11524:(c,r,D)=>{D.d(r,{e:()=>B});const W={};function B(c){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!W[c])return W[c]=!0,`${c} needs to be imported before as it contains a side-effect required by your code.`}},11501:(c,r,D)=>{function W(){return"undefined"!==typeof window}function B(){return"undefined"!==typeof navigator}function t(){return"undefined"!==typeof document}function u(c){let r="",D=c.firstChild;for(;D;)3===D.nodeType&&(r+=D.textContent),D=D.nextSibling;return r}D.d(r,{c:()=>u,d:()=>t,e:()=>B,f:()=>W})},11509:(c,r,D)=>{D.d(r,{e:()=>W});class W{static _CheckLimit(c,r){let D=W._LogLimitOutputs[c];return D?D.current++:(D={limit:r,current:1},W._LogLimitOutputs[c]=D),D.current<=D.limit}static _GenerateLimitMessage(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const D=W._LogLimitOutputs[c];if(!D||!W.MessageLimitReached)return;const B=this._Levels[r];D.current===D.limit&&W[B.name](W.MessageLimitReached.replace(/%LIMIT%/g,""+D.limit).replace(/%TYPE%/g,B.name??""))}static _AddLogEntry(c){W._LogCache=c+W._LogCache,W.OnNewCacheEntry&&W.OnNewCacheEntry(c)}static _FormatMessage(c){const r=c=>c<10?"0"+c:""+c,D=new Date;return"["+r(D.getHours())+":"+r(D.getMinutes())+":"+r(D.getSeconds())+"]: "+c}static _LogDisabled(c,r){}static _LogEnabled(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1?arguments[1]:void 0,D=arguments.length>2?arguments[2]:void 0;const B=Array.isArray(r)?r[0]:r;if(void 0!==D&&!W._CheckLimit(B,D))return;const t=W._FormatMessage(B),u=this._Levels[c],a=Array.isArray(r)?r.slice(1):[];u.logFunc&&u.logFunc("BJS - "+t,...a);const H=`<div style='color:${u.color}'>${t}</div><br>`;W._AddLogEntry(H),W._GenerateLimitMessage(B,c)}static get LogCache(){return W._LogCache}static ClearLogCache(){W._LogCache="",W._LogLimitOutputs={},W.errorsCount=0}static set LogLevels(c){W.Log=W._LogDisabled,W.Warn=W._LogDisabled,W.Error=W._LogDisabled;const r=[W.MessageLogLevel,W.WarningLogLevel,W.ErrorLogLevel];for(const D of r)if((c&D)===D){const c=this._Levels[D];W[c.name]=W._LogEnabled.bind(W,D)}}}W.NoneLogLevel=0,W.MessageLogLevel=1,W.WarningLogLevel=2,W.ErrorLogLevel=4,W.AllLogLevel=7,W.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",W._LogCache="",W._LogLimitOutputs={},W._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],W.errorsCount=0,W.Log=W._LogEnabled.bind(W,W.MessageLogLevel),W.Warn=W._LogEnabled.bind(W,W.WarningLogLevel),W.Error=W._LogEnabled.bind(W,W.ErrorLogLevel)},11494:(c,r,D)=>{D.d(r,{c:()=>u});const W="undefined"!==typeof WeakRef;class B{constructor(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2?arguments[2]:void 0,W=arguments.length>3?arguments[3]:void 0;this.initialize(c,r,D,W)}initialize(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2?arguments[2]:void 0,W=arguments.length>3?arguments[3]:void 0;return this.mask=c,this.skipNextObservers=r,this.target=D,this.currentTarget=W,this}}class t{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=c,this.mask=r,this.scope=D,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(c)}}class u{static FromPromise(c,r){const D=new u;return c.then((c=>{D.notifyObservers(c)})).catch((c=>{if(!r)throw c;r.notifyObservers(c)})),D}get observers(){return this._observers}constructor(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=r,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new B(0),c&&(this._onObserverAdded=c)}add(c){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],D=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!c)return null;const B=new t(c,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);B.unregisterOnNextCall=D,r?this._observers.unshift(B):this._observers.push(B),this._onObserverAdded&&this._onObserverAdded(B),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(B,this._lastNotifiedValue);const u=W?new WeakRef(this):{deref:()=>this};return B._remove=function(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=u.deref();r&&(c?r.remove(B):r._remove(B))},B}addOnce(c){return this.add(c,void 0,void 0,void 0,!0)}remove(c){if(!c)return!1;c._remove=null;return-1!==this._observers.indexOf(c)&&(this._deferUnregister(c),!0)}removeCallback(c,r){for(let D=0;D<this._observers.length;D++){const W=this._observers[D];if(!W._willBeUnregistered&&(W.callback===c&&(!r||r===W.scope)))return this._deferUnregister(W),!0}return!1}_deferUnregister(c){c._willBeUnregistered||(this._numObserversMarkedAsDeleted++,c.unregisterOnNextCall=!1,c._willBeUnregistered=!0,setTimeout((()=>{this._remove(c)}),0))}_remove(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c)return!1;const D=this._observers.indexOf(c);return-1!==D&&(r&&this._numObserversMarkedAsDeleted--,this._observers.splice(D,1),!0)}makeObserverTopPriority(c){this._remove(c,!1),this._observers.unshift(c)}makeObserverBottomPriority(c){this._remove(c,!1),this._observers.push(c)}notifyObservers(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,D=arguments.length>2?arguments[2]:void 0,W=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),!this._observers.length)return!0;const t=this._eventState;t.mask=r,t.target=D,t.currentTarget=W,t.skipNextObservers=!1,t.lastReturnValue=c,t.userInfo=B;for(const u of this._observers)if(!u._willBeUnregistered&&(u.mask&r&&(u.unregisterOnNextCall&&this._deferUnregister(u),u.scope?t.lastReturnValue=u.callback.apply(u.scope,[c,t]):t.lastReturnValue=u.callback(c,t)),t.skipNextObservers))return!1;return!0}notifyObserver(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=r),c._willBeUnregistered)return;const W=this._eventState;W.mask=D,W.skipNextObservers=!1,c.unregisterOnNextCall&&this._deferUnregister(c),c.callback(r,W)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const c=this._observers.pop();c&&(c._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const c=new u;return c._observers=this._observers.slice(0),c}hasSpecificMask(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const r of this._observers)if(r.mask&c||r.mask===c)return!0;return!1}}},11581:(c,r,D)=>{D.d(r,{d:()=>B,f:()=>u});let W=[];class B{static SetImmediate(c){0===W.length&&setTimeout((()=>{const c=W;W=[];for(const r of c)r()}),1),W.push(c)}}function t(c,r,D){try{if(c())return r(),!0}catch(W){return null===D||void 0===D||D(W),!0}return!1}const u=function(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,u=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&t(c,r,D))return null;const a=setInterval((()=>{t(c,r,D)?clearInterval(a):(B-=W,B<0&&(clearInterval(a),null===D||void 0===D||D(new Error("Operation timed out after maximum retries. "+(u||"")),!0)))}),W);return()=>clearInterval(a)}}}]);