"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10995:(q,S,b)=>{b.d(S,{d:()=>B,e:()=>X,j:()=>T,g:()=>J,l:()=>L});class z{constructor(){this.children=[]}isValid(q){return!0}process(q,S,b){let z="";if(this.line){let b=this.line;const V=S.processor;if(V){var C,v,U,g,r,I;V.lineProcessor&&(b=V.lineProcessor(b,S.isFragment,S.processingContext));const z=(null===(C=S.processor)||void 0===C?void 0:C.attributeKeywordName)??"attribute",l=S.isFragment&&null!==(v=S.processor)&&void 0!==v&&v.varyingFragmentKeywordName?null===(U=S.processor)||void 0===U?void 0:U.varyingFragmentKeywordName:!S.isFragment&&null!==(g=S.processor)&&void 0!==g&&g.varyingVertexKeywordName?null===(r=S.processor)||void 0===r?void 0:r.varyingVertexKeywordName:"varying";if(!S.isFragment&&V.attributeProcessor&&this.line.startsWith(z))b=V.attributeProcessor(this.line,q,S.processingContext);else if(V.varyingProcessor&&(null!==(I=V.varyingCheck)&&void 0!==I&&I.call(V,this.line,S.isFragment)||!V.varyingCheck&&this.line.startsWith(l)))b=V.varyingProcessor(this.line,S.isFragment,q,S.processingContext);else if(V.uniformProcessor&&V.uniformRegexp&&V.uniformRegexp.test(this.line))S.lookForClosingBracketForUniformBuffer||(b=V.uniformProcessor(this.line,S.isFragment,q,S.processingContext));else if(V.uniformBufferProcessor&&V.uniformBufferRegexp&&V.uniformBufferRegexp.test(this.line))S.lookForClosingBracketForUniformBuffer||(b=V.uniformBufferProcessor(this.line,S.isFragment,S.processingContext),S.lookForClosingBracketForUniformBuffer=!0);else if(V.textureProcessor&&V.textureRegexp&&V.textureRegexp.test(this.line))b=V.textureProcessor(this.line,S.isFragment,q,S.processingContext);else if((V.uniformProcessor||V.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!S.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?V.uniformProcessor&&(b=V.uniformProcessor(this.line,S.isFragment,q,S.processingContext)):V.uniformBufferProcessor&&(b=V.uniformBufferProcessor(this.line,S.isFragment,S.processingContext),S.lookForClosingBracketForUniformBuffer=!0)}S.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(S.lookForClosingBracketForUniformBuffer=!1,V.endOfUniformBufferProcessor&&(b=V.endOfUniformBufferProcessor(this.line,S.isFragment,S.processingContext)))}z+=b+"\n"}for(const V of this.children)z+=V.process(q,S,b);return this.additionalDefineKey&&(q[this.additionalDefineKey]=this.additionalDefineValue||"true",b[this.additionalDefineKey]=q[this.additionalDefineKey]),z}}class C{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(q){this._lines.length=0;for(const S of q){if(!S||"\r"===S)continue;if("#"===S[0]){this._lines.push(S);continue}const q=S.trim();if(!q)continue;if(q.startsWith("//")){this._lines.push(S);continue}const b=q.indexOf(";");if(-1===b)this._lines.push(q);else if(b===q.length-1)q.length>1&&this._lines.push(q);else{const q=S.split(";");for(let S=0;S<q.length;S++){let b=q[S];b&&(b=b.trim(),b&&this._lines.push(b+(S!==q.length-1?";":"")))}}}}}class v extends z{process(q,S,b){for(let z=0;z<this.children.length;z++){const C=this.children[z];if(C.isValid(q))return C.process(q,S,b)}return""}}class U extends z{isValid(q){return this.testExpression.isTrue(q)}}class g{isTrue(q){return!0}static postfixToInfix(q){const S=[];for(const b of q)if(void 0===g._OperatorPriority[b])S.push(b);else{const q=S[S.length-1],z=S[S.length-2];S.length-=2,S.push(`(${z}${b}${q})`)}return S[S.length-1]}static infixToPostfix(q){const S=g._InfixToPostfixCache.get(q);if(S)return S.accessTime=Date.now(),S.result;if(!q.includes("&&")&&!q.includes("||")&&!q.includes(")")&&!q.includes("("))return[q];const b=[];let z=-1;const C=()=>{V=V.trim(),""!==V&&(b.push(V),V="")},v=q=>{z<g._Stack.length-1&&(g._Stack[++z]=q)},U=()=>g._Stack[z],r=()=>-1===z?"!!INVALID EXPRESSION!!":g._Stack[z--];let I=0,V="";for(;I<q.length;){const S=q.charAt(I),l=I<q.length-1?q.substring(I,2+I):"";if("("===S)V="",v(S);else if(")"===S){for(C();-1!==z&&"("!==U();)b.push(r());r()}else if(g._OperatorPriority[l]>1){for(C();-1!==z&&g._OperatorPriority[U()]>=g._OperatorPriority[l];)b.push(r());v(l),I++}else V+=S;I++}for(C();-1!==z;)"("===U()?r():b.push(r());return g._InfixToPostfixCache.size>=g.InfixToPostfixCacheLimitSize&&g.ClearCache(),g._InfixToPostfixCache.set(q,{result:b,accessTime:Date.now()}),b}static ClearCache(){const q=Array.from(g._InfixToPostfixCache.entries()).sort(((q,S)=>q[1].accessTime-S[1].accessTime));for(let S=0;S<g.InfixToPostfixCacheCleanupSize;S++)g._InfixToPostfixCache.delete(q[S][0])}}g.InfixToPostfixCacheLimitSize=5e4,g.InfixToPostfixCacheCleanupSize=25e3,g._InfixToPostfixCache=new Map,g._OperatorPriority={")":0,"(":1,"||":2,"&&":3},g._Stack=["","","","","","","","","","","","","","","","","","","",""];class r extends g{constructor(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=q,this.not=S}isTrue(q){let S=void 0!==q[this.define];return this.not&&(S=!S),S}}class I extends g{isTrue(q){return this.leftOperand.isTrue(q)||this.rightOperand.isTrue(q)}}class V extends g{isTrue(q){return this.leftOperand.isTrue(q)&&this.rightOperand.isTrue(q)}}class l extends g{constructor(q,S,b){super(),this.define=q,this.operand=S,this.testValue=b}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(q){let S=!1;const b=parseInt(void 0!=q[this.define]?q[this.define]:this.define),z=parseInt(void 0!=q[this.testValue]?q[this.testValue]:this.testValue);if(isNaN(b)||isNaN(z))return!1;switch(this.operand){case">":S=b>z;break;case"<":S=b<z;break;case"<=":S=b<=z;break;case">=":S=b>=z;break;case"==":S=b===z;break;case"!=":S=b!==z}return S}}var y=b(10964),R=b(10997);const G=/defined\s*?\((.+?)\)/g,Z=/defined\s*?\[(.+?)\]/g,H=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,Q=/__decl__/,k=/light\{X\}.(\w*)/g,W=/\{X\}/g,N=[],u=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function X(q){q.processor&&q.processor.initializeShaders&&q.processor.initializeShaders(q.processingContext)}function T(q,S,b,z){var C;null!==(C=S.processor)&&void 0!==C&&C.preProcessShaderCode&&(q=S.processor.preProcessShaderCode(q,S.isFragment)),J(q,S,(q=>{S.processCodeAfterIncludes&&(q=S.processCodeAfterIncludes(S.isFragment?"fragment":"vertex",q,S.defines));const C=function(q,S,b){let z=function(q,S){var b;if(null!==(b=S.processor)&&void 0!==b&&b.noPrecision)return q;const z=S.shouldUseHighPrecisionShader;-1===q.indexOf("precision highp float")?q=z?"precision highp float;\n"+q:"precision mediump float;\n"+q:z||(q=q.replace("precision highp float","precision mediump float"));return q}(q,S);if(!S.processor)return z;if(0===S.processor.shaderLanguage&&-1!==z.indexOf("#version 3")&&(z=z.replace("#version 300 es",""),!S.processor.parseGLES3))return z;const C=S.defines,v=i(S,b);S.processor.preProcessor&&(z=S.processor.preProcessor(z,C,v,S.isFragment,S.processingContext));const U={};z=e(z,v,S,U),S.processor.postProcessor&&(z=S.processor.postProcessor(z,C,S.isFragment,S.processingContext,b?{drawBuffersExtensionDisabled:!b.getCaps().drawBuffersExtension}:{},v,U));null!==b&&void 0!==b&&b._features.needShaderCodeInlining&&(z=b.inlineShaderCode(z));return z}(q,S,z);b(C,q)}))}function B(q,S,b){return b.processor&&b.processor.finalizeShaders?b.processor.finalizeShaders(q,S,b.processingContext):{vertexCode:q,fragmentCode:S}}function t(q){const S=/defined\((.+)\)/.exec(q);if(S&&S.length)return new r(S[1].trim(),"!"===q[0]);const b=["==","!=",">=","<=","<",">"];let z="",C=0;for(z of b)if(C=q.indexOf(z),C>-1)break;if(-1===C)return new r(q);const v=q.substring(0,C).trim(),U=q.substring(C+z.length).trim();return new l(v,z,U)}function f(q,S){const b=new U,z=q.substring(0,S);let C=q.substring(S);return C=C.substring(0,(C.indexOf("//")+1||C.length+1)-1).trim(),b.testExpression="#ifdef"===z?new r(C):"#ifndef"===z?new r(C,!0):function(q){q=q.replace(G,"defined[$1]");const S=g.infixToPostfix(q),b=[];for(const C of S)if("||"!==C&&"&&"!==C)b.push(C);else if(b.length>=2){let q=b[b.length-1],S=b[b.length-2];b.length-=2;const z="&&"==C?new V:new I;"string"===typeof q&&(q=q.replace(Z,"defined($1)")),"string"===typeof S&&(S=S.replace(Z,"defined($1)")),z.leftOperand="string"===typeof S?t(S):S,z.rightOperand="string"===typeof q?t(q):q,b.push(z)}let z=b[b.length-1];return"string"===typeof z&&(z=z.replace(Z,"defined($1)")),"string"===typeof z?t(z):z}(C),b}function m(q,S,b,C){let v=q.currentLine;for(;E(q,b,C);){v=q.currentLine;const U=v.substring(0,5).toLowerCase();if("#else"===U){const b=new z;return S.children.push(b),void E(q,b,C)}if("#elif"===U){const q=f(v,5);S.children.push(q),b=q}}}function E(q,S,b){for(;q.canRead;){q.lineIndex++;const C=q.currentLine;if(C.indexOf("#")>=0){const z=u.exec(C);if(z&&z.length){switch(z[0]){case"#ifdef":{const z=new v;S.children.push(z);const U=f(C,6);z.children.push(U),m(q,z,U,b);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const z=new v;S.children.push(z);const U=f(C,7);z.children.push(U),m(q,z,U,b);break}case"#if":{const z=new v,U=f(C,3);S.children.push(z),z.children.push(U),m(q,z,U,b);break}}continue}}const U=new z;if(U.line=C,S.children.push(U),"#"===C[0]&&"d"===C[1]){const q=C.replace(";","").split(" ");U.additionalDefineKey=q[1],3===q.length&&(U.additionalDefineValue=q[2])}}return!1}function e(q,S,b,v){const U=new z,g=new C;return g.lineIndex=-1,g.lines=q.split("\n"),E(g,U,v),U.process(S,b,v)}function i(q,S){var b;const z=q.defines,C={};for(const v of z){const q=v.replace("#define","").replace(";","").trim().split(" ");C[q[0]]=q.length>1?q[1]:""}return 0===(null===(b=q.processor)||void 0===b?void 0:b.shaderLanguage)&&(C.GL_ES="true"),C.__VERSION__=q.version,C[q.platformName]="true",(0,R.j)(C,null===S||void 0===S?void 0:S.isNDCHalfZRange,null===S||void 0===S?void 0:S.useReverseDepthBuffer,null===S||void 0===S?void 0:S.useExactSrgbConversions),C}function J(q,S,b){let z;for(N.length=0;null!==(z=H.exec(q));)N.push(z);let C=String(q),v=[q],U=!1;for(const g of N){let q=g[1];if(-1!==q.indexOf("__decl__")&&(q=q.replace(Q,""),S.supportsUniformBuffers&&(q=q.replace("Vertex","Ubo").replace("Fragment","Ubo")),q+="Declaration"),!S.includesShadersStore[q]){const z=S.shadersRepository+"ShadersInclude/"+q+".fx";return void L.loadFile(z,(z=>{S.includesShadersStore[q]=z,J(v.join(""),S,b)}))}{let b=S.includesShadersStore[q];if(g[2]){const q=g[3].split(",");for(let S=0;S<q.length;S+=2){const z=new RegExp(q[S],"g"),C=q[S+1];b=b.replace(z,C)}}if(g[4]){const q=g[5];if(-1!==q.indexOf("..")){const z=q.split(".."),C=parseInt(z[0]);let v=parseInt(z[1]),U=b.slice(0);b="",isNaN(v)&&(v=S.indexParameters[z[1]]);for(let q=C;q<v;q++)S.supportsUniformBuffers||(U=U.replace(k,((q,S)=>S+"{X}"))),b+=U.replace(W,q.toString())+"\n"}else S.supportsUniformBuffers||(b=b.replace(k,((q,S)=>S+"{X}"))),b=b.replace(W,q)}const z=[];for(const q of v){const S=q.split(g[0]);for(let q=0;q<S.length-1;q++)z.push(S[q]),z.push(b);z.push(S[S.length-1])}v=z,U=U||b.indexOf("#include<")>=0||b.indexOf("#include <")>=0}}N.length=0,C=v.join(""),U?J(C.toString(),S,b):b(C)}const L={loadFile:(q,S,b,z,C,v)=>{throw(0,y.c)("FileTools")}}},10997:(q,S,b)=>{b.d(S,{c:()=>C,f:()=>v,j:()=>g,l:()=>U,m:()=>r});var z=b(10964);b(10934);const C={};function v(q,S){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(S?S+"\n":"")+q}function U(q,S,b,v,U,g,r){const I=r||C.loadFile;if(I){return I(q,S,b,v,U,g)}throw(0,z.c)("FileTools")}function g(q,S,b,z){if(q)return S?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,b?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(z?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return S&&(q+="#define IS_NDC_HALF_ZRANGE"),b&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),z&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}function r(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;switch(q){case 3:{const q=(ArrayBuffer,new Int8Array(S));return z&&q.set(new Int8Array(z)),q}case 0:{const q=(ArrayBuffer,new Uint8Array(S));return z&&q.set(new Uint8Array(z)),q}case 4:{const q=S instanceof ArrayBuffer?new Int16Array(S):new Int16Array(b?S/2:S);return z&&q.set(new Int16Array(z)),q}case 5:case 8:case 9:case 10:case 2:{const q=S instanceof ArrayBuffer?new Uint16Array(S):new Uint16Array(b?S/2:S);return z&&q.set(new Uint16Array(z)),q}case 6:{const q=S instanceof ArrayBuffer?new Int32Array(S):new Int32Array(b?S/4:S);return z&&q.set(new Int32Array(z)),q}case 7:case 11:case 12:case 13:case 14:case 15:{const q=S instanceof ArrayBuffer?new Uint32Array(S):new Uint32Array(b?S/4:S);return z&&q.set(new Uint32Array(z)),q}case 1:{const q=S instanceof ArrayBuffer?new Float32Array(S):new Float32Array(b?S/4:S);return z&&q.set(new Float32Array(z)),q}}const C=(ArrayBuffer,new Uint8Array(S));return z&&C.set(new Uint8Array(z)),C}},11017:(q,S,b)=>{b.d(S,{d:()=>z});class z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersRepository:z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersStore:z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.IncludesShadersStore:z.IncludesShadersStoreWGSL}}z.ShadersRepository="src/Shaders/",z.ShadersStore={},z.IncludesShadersStore={},z.ShadersRepositoryWGSL="src/ShadersWGSL/",z.ShadersStoreWGSL={},z.IncludesShadersStoreWGSL={}},11025:(q,S,b)=>{b.d(S,{c:()=>y,d:()=>W,g:()=>G,k:()=>R,o:()=>Z,s:()=>k,v:()=>l,w:()=>I,z:()=>V,A:()=>r,C:()=>g});class z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.lS._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(q){q&&this.program&&q(this.program)}setEngine(q){this.lS=q}_fillEffectInformation(q,S,b,z,C,v,U,g){const r=this.lS;if(r.supportsUniformBuffers)for(const V in S)q.bindUniformBlock(V,S[V]);let I;for(this.lS.getUniforms(this,b).forEach(((q,S)=>{z[b[S]]=q})),this._uniforms=z,I=0;I<C.length;I++){null==q.getUniform(C[I])&&(C.splice(I,1),I--)}C.forEach(((q,S)=>{v[q]=S}));for(const V of r.getAttributes(this,U))g.push(V)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(q,S){const b=this._valueCache[q],z=S.updateFlag;return(void 0===b||b!==z)&&(this._valueCache[q]=z,!0)}_cacheFloat2(q,S,b){let z=this._valueCache[q];if(!z||2!==z.length)return z=[S,b],this._valueCache[q]=z,!0;let C=!1;return z[0]!==S&&(z[0]=S,C=!0),z[1]!==b&&(z[1]=b,C=!0),C}_cacheFloat3(q,S,b,z){let C=this._valueCache[q];if(!C||3!==C.length)return C=[S,b,z],this._valueCache[q]=C,!0;let v=!1;return C[0]!==S&&(C[0]=S,v=!0),C[1]!==b&&(C[1]=b,v=!0),C[2]!==z&&(C[2]=z,v=!0),v}_cacheFloat4(q,S,b,z,C){let v=this._valueCache[q];if(!v||4!==v.length)return v=[S,b,z,C],this._valueCache[q]=v,!0;let U=!1;return v[0]!==S&&(v[0]=S,U=!0),v[1]!==b&&(v[1]=b,U=!0),v[2]!==z&&(v[2]=z,U=!0),v[3]!==C&&(v[3]=C,U=!0),U}setInt(q,S){const b=this._valueCache[q];void 0!==b&&b===S||this.lS.setInt(this._uniforms[q],S)&&(this._valueCache[q]=S)}setInt2(q,S,b){this._cacheFloat2(q,S,b)&&(this.lS.setInt2(this._uniforms[q],S,b)||(this._valueCache[q]=null))}setInt3(q,S,b,z){this._cacheFloat3(q,S,b,z)&&(this.lS.setInt3(this._uniforms[q],S,b,z)||(this._valueCache[q]=null))}setInt4(q,S,b,z,C){this._cacheFloat4(q,S,b,z,C)&&(this.lS.setInt4(this._uniforms[q],S,b,z,C)||(this._valueCache[q]=null))}setIntArray(q,S){this._valueCache[q]=null,this.lS.setIntArray(this._uniforms[q],S)}setIntArray2(q,S){this._valueCache[q]=null,this.lS.setIntArray2(this._uniforms[q],S)}setIntArray3(q,S){this._valueCache[q]=null,this.lS.setIntArray3(this._uniforms[q],S)}setIntArray4(q,S){this._valueCache[q]=null,this.lS.setIntArray4(this._uniforms[q],S)}setUInt(q,S){const b=this._valueCache[q];void 0!==b&&b===S||this.lS.setUInt(this._uniforms[q],S)&&(this._valueCache[q]=S)}setUInt2(q,S,b){this._cacheFloat2(q,S,b)&&(this.lS.setUInt2(this._uniforms[q],S,b)||(this._valueCache[q]=null))}setUInt3(q,S,b,z){this._cacheFloat3(q,S,b,z)&&(this.lS.setUInt3(this._uniforms[q],S,b,z)||(this._valueCache[q]=null))}setUInt4(q,S,b,z,C){this._cacheFloat4(q,S,b,z,C)&&(this.lS.setUInt4(this._uniforms[q],S,b,z,C)||(this._valueCache[q]=null))}setUIntArray(q,S){this._valueCache[q]=null,this.lS.setUIntArray(this._uniforms[q],S)}setUIntArray2(q,S){this._valueCache[q]=null,this.lS.setUIntArray2(this._uniforms[q],S)}setUIntArray3(q,S){this._valueCache[q]=null,this.lS.setUIntArray3(this._uniforms[q],S)}setUIntArray4(q,S){this._valueCache[q]=null,this.lS.setUIntArray4(this._uniforms[q],S)}setArray(q,S){this._valueCache[q]=null,this.lS.setArray(this._uniforms[q],S)}setArray2(q,S){this._valueCache[q]=null,this.lS.setArray2(this._uniforms[q],S)}setArray3(q,S){this._valueCache[q]=null,this.lS.setArray3(this._uniforms[q],S)}setArray4(q,S){this._valueCache[q]=null,this.lS.setArray4(this._uniforms[q],S)}setMatrices(q,S){S&&(this._valueCache[q]=null,this.lS.setMatrices(this._uniforms[q],S))}setMatrix(q,S){this._cacheMatrix(q,S)&&(this.lS.setMatrices(this._uniforms[q],S.Zb())||(this._valueCache[q]=null))}setMatrix3x3(q,S){this._valueCache[q]=null,this.lS.setMatrix3x3(this._uniforms[q],S)}setMatrix2x2(q,S){this._valueCache[q]=null,this.lS.setMatrix2x2(this._uniforms[q],S)}setFloat(q,S){const b=this._valueCache[q];void 0!==b&&b===S||this.lS.setFloat(this._uniforms[q],S)&&(this._valueCache[q]=S)}setVector2(q,S){this._cacheFloat2(q,S.x,S.y)&&(this.lS.setFloat2(this._uniforms[q],S.x,S.y)||(this._valueCache[q]=null))}setFloat2(q,S,b){this._cacheFloat2(q,S,b)&&(this.lS.setFloat2(this._uniforms[q],S,b)||(this._valueCache[q]=null))}setVector3(q,S){this._cacheFloat3(q,S.x,S.y,S.z)&&(this.lS.setFloat3(this._uniforms[q],S.x,S.y,S.z)||(this._valueCache[q]=null))}setFloat3(q,S,b,z){this._cacheFloat3(q,S,b,z)&&(this.lS.setFloat3(this._uniforms[q],S,b,z)||(this._valueCache[q]=null))}setVector4(q,S){this._cacheFloat4(q,S.x,S.y,S.z,S.w)&&(this.lS.setFloat4(this._uniforms[q],S.x,S.y,S.z,S.w)||(this._valueCache[q]=null))}setQuaternion(q,S){this._cacheFloat4(q,S.x,S.y,S.z,S.w)&&(this.lS.setFloat4(this._uniforms[q],S.x,S.y,S.z,S.w)||(this._valueCache[q]=null))}setFloat4(q,S,b,z,C){this._cacheFloat4(q,S,b,z,C)&&(this.lS.setFloat4(this._uniforms[q],S,b,z,C)||(this._valueCache[q]=null))}setColor3(q,S){this._cacheFloat3(q,S.r,S.g,S.b)&&(this.lS.setFloat3(this._uniforms[q],S.r,S.g,S.b)||(this._valueCache[q]=null))}setColor4(q,S,b){this._cacheFloat4(q,S.r,S.g,S.b,b)&&(this.lS.setFloat4(this._uniforms[q],S.r,S.g,S.b,b)||(this._valueCache[q]=null))}setDirectColor4(q,S){this._cacheFloat4(q,S.r,S.g,S.b,S.a)&&(this.lS.setFloat4(this._uniforms[q],S.r,S.g,S.b,S.a)||(this._valueCache[q]=null))}_getVertexShaderCode(){return this.vertexShader?this.lS._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.lS._getShaderSource(this.fragmentShader):null}}var C=b(10997);const v=new WeakMap,U={_webGLVersion:2,cachedPipelines:{}};function g(q){let S=v.get(q);if(!S){if(!q)return U;S={_webGLVersion:q.TEXTURE_BINDING_3D?2:1,_context:q,parallelShaderCompile:q.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},v.set(q,S)}return S}function r(q){v.delete(q)}function I(q,S,b,z,C,v){const U=g(z);v||(v=U._createShaderProgramInjection??y);return v(q,Q(S,"vertex",z,U._contextWasLost),Q(b,"fragment",z,U._contextWasLost),z,C,U.validateShaderPrograms)}function V(q,S,b,z,C){let v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6?arguments[6]:void 0;const r=g(C);U||(U=r._createShaderProgramInjection??y);const I=r._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return U(q,H(S,"vertex",z,I,C,r._contextWasLost),H(b,"fragment",z,I,C,r._contextWasLost),C,v,r.validateShaderPrograms)}function l(q,S){const b=new z,C=g(q);return C.parallelShaderCompile&&!C.disableParallelShaderCompile&&(b.isParallelCompiled=!0),b.context=C._context,b}function y(q,S,b,z){let C=arguments.length>5?arguments[5]:void 0;const v=z.createProgram();if(q.program=v,!v)throw new Error("Unable to create program");return z.attachShader(v,S),z.attachShader(v,b),z.linkProgram(v),q.context=z,q.vertexShader=S,q.fragmentShader=b,q.isParallelCompiled||G(q,z,C),v}function R(q,S,b){const z=q;if(z._isDisposed)return!1;const C=g(S);return!!(C&&C.parallelShaderCompile&&C.parallelShaderCompile.COMPLETION_STATUS_KHR&&z.program&&S.getProgramParameter(z.program,C.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(G(z,S,b),!0)}function G(q,S,b){const z=q.context,C=q.vertexShader,v=q.fragmentShader,U=q.program;if(!z.getProgramParameter(U,z.LINK_STATUS)){if(!S.getShaderParameter(C,S.COMPILE_STATUS)){const b=S.getShaderInfoLog(C);if(b)throw q.vertexCompilationError=b,new Error("VERTEX SHADER "+b)}if(!S.getShaderParameter(v,S.COMPILE_STATUS)){const b=S.getShaderInfoLog(v);if(b)throw q.fragmentCompilationError=b,new Error("FRAGMENT SHADER "+b)}const b=z.getProgramInfoLog(U);if(b)throw q.programLinkError=b,new Error(b)}if(b){z.validateProgram(U);if(!z.getProgramParameter(U,z.VALIDATE_STATUS)){const S=z.getProgramInfoLog(U);if(S)throw q.programValidationError=S,new Error(S)}}z.deleteShader(C),z.deleteShader(v),q.vertexShader=void 0,q.fragmentShader=void 0,q.onCompiled&&(q.onCompiled(),q.onCompiled=void 0)}function Z(q,S,b,z,C,v,U,r,l){let y=arguments.length>10?arguments[10]:void 0,R=arguments.length>11?arguments[11]:void 0,G=arguments.length>12?arguments[12]:void 0;const Z=g(q.context);R||(R=Z.createRawShaderProgramInjection??I),G||(G=Z.createShaderProgramInjection??V);const H=q;H.program=z?R(H,S,b,H.context,l):G(H,S,b,r,H.context,l),H.program.__SPECTOR_rebuildProgram=U,y()}function H(q,S,b,z,v,U){return Q((0,C.f)(q,b,z),S,v,U)}function Q(q,S,b,z){const C=b.createShader("vertex"===S?b.VERTEX_SHADER:b.FRAGMENT_SHADER);if(!C){let q=b.NO_ERROR,C=b.NO_ERROR;for(;(C=b.getError())!==b.NO_ERROR;)q=C;throw new Error(`Something went wrong while creating a gl ${S} shader object. gl error=${q}, gl isContextLost=${b.isContextLost()}, _contextWasLost=${z}`)}return b.shaderSource(C,q),b.compileShader(C),C}function k(q,S){S.useProgram(q)}function W(q,S){const b=q;if(!b.isParallelCompiled)return void S(q);const z=b.onCompiled;b.onCompiled=()=>{null===z||void 0===z||z(),S(q)}}},11020:(q,S,b)=>{b.d(S,{d:()=>l,h:()=>R,j:()=>I,l:()=>V});var z=b(10934),C=b(11025),v=b(11017),U=b(10943),g=b(10995),r=b(10997);function I(q,S){return(0,C.C)(S).cachedPipelines[q]}function V(q){const S=q._name,b=q.context;if(S&&b){const q=(0,C.C)(b),z=q.cachedPipelines[S];null===z||void 0===z||z.dispose(),delete q.cachedPipelines[S]}}function l(q,S,b,C,v,U,r){let I,V;const l=(0,z.k)()?null===U||void 0===U?void 0:U.getHostDocument():null;I="string"===typeof S?S:S.vertexSource?"source:"+S.vertexSource:S.vertexElement?(null===l||void 0===l?void 0:l.getElementById(S.vertexElement))||S.vertexElement:S.vertex||S,V="string"===typeof S?S:S.fragmentSource?"source:"+S.fragmentSource:S.fragmentElement?(null===l||void 0===l?void 0:l.getElementById(S.fragmentElement))||S.fragmentElement:S.fragment||S;const R=[void 0,void 0],G=()=>{if(R[0]&&R[1]){q.isFragment=!0;const[z,I]=R;(0,g.j)(I,q,((U,I)=>{r&&(r._fragmentSourceCodeBeforeMigration=I),b&&(U=b("fragment",U));const V=(0,g.d)(z,U,q);q=null;const l=function(q,S,b,z){if(b){return{vertexSourceCode:(1===z?"//":"")+"#define SHADER_NAME vertex:"+(b.vertexElement||b.vertex||b.spectorName||b)+"\n"+q,fragmentSourceCode:(1===z?"//":"")+"#define SHADER_NAME fragment:"+(b.fragmentElement||b.fragment||b.spectorName||b)+"\n"+S}}return{vertexSourceCode:q,fragmentSourceCode:S}}(V.vertexCode,V.fragmentCode,S,v);null===C||void 0===C||C(l.vertexSourceCode,l.fragmentSourceCode)}),U)}};y(I,"Vertex","",(S=>{(0,g.e)(q),(0,g.j)(S,q,((q,z)=>{r&&(r._rawVertexSourceCode=S,r._vertexSourceCodeBeforeMigration=z),b&&(q=b("vertex",q)),R[0]=q,G()}),U)}),v),y(V,"Fragment","Pixel",(q=>{r&&(r._rawFragmentSourceCode=q),R[1]=q,G()}),v)}function y(q,S,b,C,U,g){if("undefined"!==typeof HTMLElement&&q instanceof HTMLElement){return void C((0,z.b)(q))}if("source:"===q.substring(0,7))return void C(q.substring(7));if("base64:"===q.substring(0,7)){return void C(window.atob(q.substring(7)))}const I=v.d.GetShadersStore(U);if(I[q+S+"Shader"])return void C(I[q+S+"Shader"]);if(b&&I[q+b+"Shader"])return void C(I[q+b+"Shader"]);let V;if(V="."===q[0]||"/"===q[0]||q.indexOf("http")>-1?q:v.d.GetShadersRepository(U)+q,!(g=g||r.l))throw new Error("loadFileInjection is not defined");g(V+"."+S.toLowerCase()+".fx",C)}const R=(q,S,b,z)=>{try{const v=q.context?(0,C.C)(q.context):null;v&&(v.disableParallelShaderCompile=q.disableParallelCompilation);const U=q.existingPipelineContext||S(q.shaderProcessingContext);return U._name=q.name,q.name&&v&&(v.cachedPipelines[q.name]=U),b(U,q.vertex,q.fragment,!!q.createAsRaw,"","",q.rebuildRebind,q.defines,q.transformFeedbackVaryings,"",(()=>{z(U,(()=>{var S;null===(S=q.onRenderingStateCompiled)||void 0===S||S.call(q,U)}))})),U}catch(v){throw U.b.Error("Error compiling effect"),v}}},11009:(q,S,b)=>{b.r(S),b.d(S,{Effect:()=>r});var z=b(10929),C=b(10943),v=b(11017),U=b(11020),g=b(11e3);class r{static get ShadersRepository(){return v.d.ShadersRepository}static set ShadersRepository(q){v.d.ShadersRepository=q}get V(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new z.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9?arguments[9]:void 0,R=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,Z=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new z.d,this.onErrorObservable=new z.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=q,this._key=R;const H=this._key.replace(/\r/g,"").replace(/\n/g,"|");let Q;if(S.attributes){const q=S;if(this._engine=b,this._attributesNames=q.attributes,this._uniformsNames=q.uniformsNames.concat(q.samplers),this._samplerList=q.samplers.slice(),this.defines=q.defines,this.onError=q.onError,this.onCompiled=q.onCompiled,this._fallbacks=q.fallbacks,this._indexParameters=q.indexParameters,this._transformFeedbackVaryings=q.transformFeedbackVaryings||null,this._multiTarget=!!q.multiTarget,this._shaderLanguage=q.shaderLanguage??0,this._disableParallelShaderCompilation=!!q.disableParallelShaderCompilation,q.uniformBuffersNames){this._uniformBuffersNamesList=q.uniformBuffersNames.slice();for(let S=0;S<q.uniformBuffersNames.length;S++)this._uniformBuffersNames[q.uniformBuffersNames[S]]=S}this._processFinalCode=q.processFinalCode??null,this._processCodeAfterIncludes=q.processCodeAfterIncludes??void 0,Z=q.extraInitializationsAsync,Q=q.existingPipelineContext}else this._engine=v,this.defines=null==g?"":g,this._uniformsNames=b.concat(C),this._samplerList=C?C.slice():[],this._attributesNames=S,this._uniformBuffersNamesList=[],this._shaderLanguage=G,this.onError=l,this.onCompiled=V,this._indexParameters=y,this._fallbacks=I;"WEBGL2"===this._engine.shaderPlatformName&&(Q=(0,U.j)(H,this._engine._gl)??Q),this._attributeLocationByName={},this.uniqueId=r._UniqueIdSeed++,Q?(this._pipelineContext=Q,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,Z),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.V||this.dispose(!0)}))}async _processShaderCodeAsync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0;z&&await z(),this._processingContext=b||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const C={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:q??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:v.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:v.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,U.d)(C,this.name,this._processFinalCode,((q,b)=>{this._vertexSourceCode=q,this._fragmentSourceCode=b,this._prepareEffect(S)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.V||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(q){return this._attributes[q]}getAttributeLocationByName(q){return this._attributeLocationByName[q]}getAttributesCount(){return this._attributes.length}getUniformIndex(q){return this._uniformsNames.indexOf(q)}getUniform(q){return this._uniforms[q]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((q=>{this.executeWhenCompiled(q)}))}executeWhenCompiled(q){this.isReady()?q(this):(this.onCompileObservable.add((S=>{q(S)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(q){(0,g.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(S=>{this._processCompilationErrors(S,q)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(q,S,b,z){this._isReady=!1,this._vertexSourceCodeOverride=q,this._fragmentSourceCodeOverride=S,this.onError=(q,S)=>{z&&z(S)},this.onCompiled=()=>{var q,S;const z=this.getEngine().scenes;if(z)for(let b=0;b<z.length;b++)z[b].markAllMaterialsAsDirty(127);null===(q=(S=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===q||q.call(S,b)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(q){if(this._pipelineContext=q,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let S=0;S<this._attributesNames.length;S++){const q=this._attributesNames[S];this._attributeLocationByName[q]=this._attributes[S]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),r.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S=this._pipelineContext;this._isReady=!1;try{const b=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),z=b?null:this.defines,C=b?this._vertexSourceCodeOverride:this._vertexSourceCode,v=b?this._fragmentSourceCodeOverride:this._fragmentSourceCode,g=this._engine;this._pipelineContext=(0,U.h)({existingPipelineContext:q?S:null,vertex:C,fragment:v,context:"WEBGL2"===g.shaderPlatformName||"WEBGL1"===g.shaderPlatformName?g._gl:void 0,rebuildRebind:(q,S,b,z)=>this._rebuildProgram(q,S,b,z),defines:z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:b,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:b=>{S&&!q&&this._engine._deletePipelineContext(S),b&&this._onRenderingStateCompiled(b)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(S)}catch(b){this._processCompilationErrors(b,S)}}_getShaderCodeAndErrorLine(q,S,b){const z=b?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let C=null;if(S&&q){const v=S.match(z);if(v&&2===v.length){const S=parseInt(v[1]),z=q.split("\n",-1);z.length>=S&&(C=`Offending line [${S}] in ${b?"fragment":"vertex"} code: ${z[S-1]}`)}}return[q,C]}_processCompilationErrors(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=q.message;const b=this._attributesNames,z=this._fallbacks;if(C.b.Error("Unable to compile effect:"),C.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),C.b.Error(`Attributes: ${b.join(" ")}`),C.b.Error("Defines:\n"+this.defines),r.LogShaderCodeOnCompilationError){var v,U;let q=null,S=null,b=null;var g;if(null!==(v=this._pipelineContext)&&void 0!==v&&v._getVertexShaderCode()&&([b,q]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),b&&(C.b.Error("Vertex code:"),C.b.Error(b))),null!==(U=this._pipelineContext)&&void 0!==U&&U._getFragmentShaderCode())[b,S]=this._getShaderCodeAndErrorLine(null===(g=this._pipelineContext)||void 0===g?void 0:g._getFragmentShaderCode(),this._compilationError,!0),b&&(C.b.Error("Fragment code:"),C.b.Error(b));q&&C.b.Error(q),S&&C.b.Error(S)}C.b.Error("Error: "+this._compilationError);const I=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};S&&(this._pipelineContext=S,this._isReady=!0,I()),z?(this._pipelineContext=null,z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,C.b.Error("Trying next fallback."),this.defines=z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,I(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,S||I())}get isSupported(){return""===this._compilationError}_bindTexture(q,S){this._engine._bindTexture(this._samplers[q],S,q)}setTexture(q,S){this._engine.setTexture(this._samplers[q],this._uniforms[q],S,q)}setTextureArray(q,S){const b=q+"Ex";if(-1===this._samplerList.indexOf(b+"0")){const z=this._samplerList.indexOf(q);for(let q=1;q<S.length;q++){const S=b+(q-1).toString();this._samplerList.splice(z+q,0,S)}let C=0;for(const q of this._samplerList)this._samplers[q]=C,C+=1}this._engine.setTextureArray(this._samplers[q],this._uniforms[q],S,q)}bindUniformBuffer(q,S){const b=this._uniformBuffersNames[S];void 0===b||r._BaseCache[b]===q&&this._engine._features.useUBOBindingCache||(r._BaseCache[b]=q,this._engine.bindUniformBufferBase(q,b,S))}bindUniformBlock(q,S){this._engine.bindUniformBlock(this._pipelineContext,q,S)}setInt(q,S){return this._pipelineContext.setInt(q,S),this}setInt2(q,S,b){return this._pipelineContext.setInt2(q,S,b),this}setInt3(q,S,b,z){return this._pipelineContext.setInt3(q,S,b,z),this}setInt4(q,S,b,z,C){return this._pipelineContext.setInt4(q,S,b,z,C),this}setIntArray(q,S){return this._pipelineContext.setIntArray(q,S),this}setIntArray2(q,S){return this._pipelineContext.setIntArray2(q,S),this}setIntArray3(q,S){return this._pipelineContext.setIntArray3(q,S),this}setIntArray4(q,S){return this._pipelineContext.setIntArray4(q,S),this}setUInt(q,S){return this._pipelineContext.setUInt(q,S),this}setUInt2(q,S,b){return this._pipelineContext.setUInt2(q,S,b),this}setUInt3(q,S,b,z){return this._pipelineContext.setUInt3(q,S,b,z),this}setUInt4(q,S,b,z,C){return this._pipelineContext.setUInt4(q,S,b,z,C),this}setUIntArray(q,S){return this._pipelineContext.setUIntArray(q,S),this}setUIntArray2(q,S){return this._pipelineContext.setUIntArray2(q,S),this}setUIntArray3(q,S){return this._pipelineContext.setUIntArray3(q,S),this}setUIntArray4(q,S){return this._pipelineContext.setUIntArray4(q,S),this}setFloatArray(q,S){return this._pipelineContext.setArray(q,S),this}setFloatArray2(q,S){return this._pipelineContext.setArray2(q,S),this}setFloatArray3(q,S){return this._pipelineContext.setArray3(q,S),this}setFloatArray4(q,S){return this._pipelineContext.setArray4(q,S),this}setArray(q,S){return this._pipelineContext.setArray(q,S),this}setArray2(q,S){return this._pipelineContext.setArray2(q,S),this}setArray3(q,S){return this._pipelineContext.setArray3(q,S),this}setArray4(q,S){return this._pipelineContext.setArray4(q,S),this}setMatrices(q,S){return this._pipelineContext.setMatrices(q,S),this}setMatrix(q,S){return this._pipelineContext.setMatrix(q,S),this}setMatrix3x3(q,S){return this._pipelineContext.setMatrix3x3(q,S),this}setMatrix2x2(q,S){return this._pipelineContext.setMatrix2x2(q,S),this}setFloat(q,S){return this._pipelineContext.setFloat(q,S),this}setBool(q,S){return this._pipelineContext.setInt(q,S?1:0),this}setVector2(q,S){return this._pipelineContext.setVector2(q,S),this}setFloat2(q,S,b){return this._pipelineContext.setFloat2(q,S,b),this}setVector3(q,S){return this._pipelineContext.setVector3(q,S),this}setFloat3(q,S,b,z){return this._pipelineContext.setFloat3(q,S,b,z),this}setVector4(q,S){return this._pipelineContext.setVector4(q,S),this}setQuaternion(q,S){return this._pipelineContext.setQuaternion(q,S),this}setFloat4(q,S,b,z,C){return this._pipelineContext.setFloat4(q,S,b,z,C),this}setColor3(q,S){return this._pipelineContext.setColor3(q,S),this}setColor4(q,S,b){return this._pipelineContext.setColor4(q,S,b),this}setDirectColor4(q,S){return this._pipelineContext.setDirectColor4(q,S),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(r.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,U.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;S&&(v.d.GetShadersStore(z)[`${q}PixelShader`]=S),b&&(v.d.GetShadersStore(z)[`${q}VertexShader`]=b)}static ResetCache(){r._BaseCache={}}}r.LogShaderCodeOnCompilationError=!0,r.PersistentMode=!1,r.AutomaticallyClearCodeCache=!1,r._UniqueIdSeed=0,r._BaseCache={},r.ShadersStore=v.d.ShadersStore,r.IncludesShadersStore=v.d.IncludesShadersStore},10964:(q,S,b)=>{b.d(S,{c:()=>C});const z={};function C(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!z[q])return z[q]=!0,`${q} needs to be imported before as it contains a side-effect required by your code.`}},10934:(q,S,b)=>{function z(){return"undefined"!==typeof window}function C(){return"undefined"!==typeof navigator}function v(){return"undefined"!==typeof document}function U(q){let S="",b=q.firstChild;for(;b;)3===b.nodeType&&(S+=b.textContent),b=b.nextSibling;return S}b.d(S,{b:()=>U,e:()=>v,h:()=>C,k:()=>z})},10943:(q,S,b)=>{b.d(S,{b:()=>z});class z{static _CheckLimit(q,S){let b=z._LogLimitOutputs[q];return b?b.current++:(b={limit:S,current:1},z._LogLimitOutputs[q]=b),b.current<=b.limit}static _GenerateLimitMessage(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const b=z._LogLimitOutputs[q];if(!b||!z.MessageLimitReached)return;const C=this._Levels[S];b.current===b.limit&&z[C.name](z.MessageLimitReached.replace(/%LIMIT%/g,""+b.limit).replace(/%TYPE%/g,C.name??""))}static _AddLogEntry(q){z._LogCache=q+z._LogCache,z.OnNewCacheEntry&&z.OnNewCacheEntry(q)}static _FormatMessage(q){const S=q=>q<10?"0"+q:""+q,b=new Date;return"["+S(b.getHours())+":"+S(b.getMinutes())+":"+S(b.getSeconds())+"]: "+q}static _LogDisabled(q,S){}static _LogEnabled(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const C=Array.isArray(S)?S[0]:S;if(void 0!==b&&!z._CheckLimit(C,b))return;const v=z._FormatMessage(C),U=this._Levels[q],g=Array.isArray(S)?S.slice(1):[];U.logFunc&&U.logFunc("BJS - "+v,...g);const r=`<div style='color:${U.color}'>${v}</div><br>`;z._AddLogEntry(r),z._GenerateLimitMessage(C,q)}static get LogCache(){return z._LogCache}static ClearLogCache(){z._LogCache="",z._LogLimitOutputs={},z.errorsCount=0}static set LogLevels(q){z.Log=z._LogDisabled,z.Warn=z._LogDisabled,z.Error=z._LogDisabled;const S=[z.MessageLogLevel,z.WarningLogLevel,z.ErrorLogLevel];for(const b of S)if((q&b)===b){const q=this._Levels[b];z[q.name]=z._LogEnabled.bind(z,b)}}}z.NoneLogLevel=0,z.MessageLogLevel=1,z.WarningLogLevel=2,z.ErrorLogLevel=4,z.AllLogLevel=7,z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",z._LogCache="",z._LogLimitOutputs={},z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],z.errorsCount=0,z.Log=z._LogEnabled.bind(z,z.MessageLogLevel),z.Warn=z._LogEnabled.bind(z,z.WarningLogLevel),z.Error=z._LogEnabled.bind(z,z.ErrorLogLevel)},10929:(q,S,b)=>{b.d(S,{d:()=>U});const z="undefined"!==typeof WeakRef;class C{constructor(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this.initialize(q,S,b,z)}initialize(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;return this.mask=q,this.skipNextObservers=S,this.target=b,this.currentTarget=z,this}}class v{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=q,this.mask=S,this.scope=b,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(q)}}class U{static FromPromise(q,S){const b=new U;return q.then((q=>{b.notifyObservers(q)})).catch((q=>{if(!S)throw q;S.notifyObservers(q)})),b}get observers(){return this._observers}constructor(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=S,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new C(0),q&&(this._onObserverAdded=q)}add(q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!q)return null;const C=new v(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);C.unregisterOnNextCall=b,S?this._observers.unshift(C):this._observers.push(C),this._onObserverAdded&&this._onObserverAdded(C),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(C,this._lastNotifiedValue);const U=z?new WeakRef(this):{deref:()=>this};return C._remove=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S=U.deref();S&&(q?S.remove(C):S._remove(C))},C}addOnce(q){return this.add(q,void 0,void 0,void 0,!0)}remove(q){if(!q)return!1;q._remove=null;return-1!==this._observers.indexOf(q)&&(this._deferUnregister(q),!0)}removeCallback(q,S){for(let b=0;b<this._observers.length;b++){const z=this._observers[b];if(!z._willBeUnregistered&&(z.callback===q&&(!S||S===z.scope)))return this._deferUnregister(z),!0}return!1}_deferUnregister(q){q._willBeUnregistered||(this._numObserversMarkedAsDeleted++,q.unregisterOnNextCall=!1,q._willBeUnregistered=!0,setTimeout((()=>{this._remove(q)}),0))}_remove(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q)return!1;const b=this._observers.indexOf(q);return-1!==b&&(S&&this._numObserversMarkedAsDeleted--,this._observers.splice(b,1),!0)}makeObserverTopPriority(q){this._remove(q,!1),this._observers.unshift(q)}makeObserverBottomPriority(q){this._remove(q,!1),this._observers.push(q)}notifyObservers(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,b=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),!this._observers.length)return!0;const v=this._eventState;v.mask=S,v.target=b,v.currentTarget=z,v.skipNextObservers=!1,v.lastReturnValue=q,v.userInfo=C;for(const U of this._observers)if(!U._willBeUnregistered&&(U.mask&S&&(U.unregisterOnNextCall&&this._deferUnregister(U),U.scope?v.lastReturnValue=U.callback.apply(U.scope,[q,v]):v.lastReturnValue=U.callback(q,v)),v.skipNextObservers))return!1;return!0}notifyObserver(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=S),q._willBeUnregistered)return;const z=this._eventState;z.mask=b,z.skipNextObservers=!1,q.unregisterOnNextCall&&this._deferUnregister(q),q.callback(S,z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const q=this._observers.pop();q&&(q._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const q=new U;return q._observers=this._observers.slice(0),q}hasSpecificMask(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const S of this._observers)if(S.mask&q||S.mask===q)return!0;return!1}}},11e3:(q,S,b)=>{b.d(S,{e:()=>C,f:()=>U});let z=[];class C{static SetImmediate(q){0===z.length&&setTimeout((()=>{const q=z;z=[];for(const S of q)S()}),1),z.push(q)}}function v(q,S,b){try{if(q())return S(),!0}catch(z){return null===b||void 0===b||b(z),!0}return!1}const U=function(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,U=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&v(q,S,b))return null;const g=setInterval((()=>{v(q,S,b)?clearInterval(g):(C-=z,C<0&&(clearInterval(g),null===b||void 0===b||b(new Error("Operation timed out after maximum retries. "+(U||"")),!0)))}),z);return()=>clearInterval(g)}}}]);