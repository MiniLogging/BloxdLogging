"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11619:(z,u,Y)=>{Y.d(u,{e:()=>t,i:()=>h,l:()=>o,o:()=>M,q:()=>K,s:()=>C,w:()=>q});var H=Y(10903),E=Y(11188),J=Y(10937),l=Y(10918),T=Y(11626),b=Y(11222),L=Y(11393),D=Y(10972),g=Y(11172);const M=Object.freeze(new H.f(0,0,0,0)),q=Object.freeze(H.p.Zero()),C=Object.freeze(H.m.Zero()),K=Object.freeze(L.b.Zero()),h=Object.freeze(E.c.Black()),o=Object.freeze(new E.e(0,0,0,0)),d={key:0,repeatCount:0,loopMode:2};class t{static _PrepareAnimation(z,u,Y,J,l,T,b,D){let g;if(!isNaN(parseFloat(l))&&isFinite(l)?g=t.ANIMATIONTYPE_FLOAT:l instanceof H.f?g=t.ANIMATIONTYPE_QUATERNION:l instanceof H.p?g=t.ANIMATIONTYPE_VECTOR3:l instanceof H.m?g=t.ANIMATIONTYPE_VECTOR2:l instanceof E.c?g=t.ANIMATIONTYPE_COLOR3:l instanceof E.e?g=t.ANIMATIONTYPE_COLOR4:l instanceof L.b&&(g=t.ANIMATIONTYPE_SIZE),void 0==g)return null;const M=new t(z,u,Y,g,b),q=[{frame:0,value:l},{frame:J,value:T}];return M.setKeys(q),void 0!==D&&M.setEasingFunction(D),M}static CreateAnimation(z,u,Y,H){const E=new t(z+"Animation",z,Y,u,t.ANIMATIONLOOPMODE_CONSTANT);return E.setEasingFunction(H),E}static CreateAndStartAnimation(z,u,Y,H,E,J,l,T,b,L,D){const g=t._PrepareAnimation(z,Y,H,E,J,l,T,b);return g?(u.iz&&(D=u.iz()),D?D.beginDirectAnimation(u,[g],0,E,g.loopMode!==t.ANIMATIONLOOPMODE_CONSTANT,1,L):null):null}static CreateAndStartHierarchyAnimation(z,u,Y,H,E,J,l,T,b,L,D){const g=t._PrepareAnimation(z,H,E,J,l,T,b,L);if(!g)return null;return u.iz().beginDirectHierarchyAnimation(u,Y,[g],0,J,1===g.loopMode,1,D)}static CreateMergeAndStartAnimation(z,u,Y,H,E,J,l,T,b,L){const D=t._PrepareAnimation(z,Y,H,E,J,l,T,b);return D?(u.animations.push(D),u.iz().beginAnimation(u,0,E,1===D.loopMode,1,L)):null}static MakeAnimationAdditive(z,u,Y){let E;E="object"===typeof u?u:{referenceFrame:u??0,range:Y,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let J=z;if(E.cloneOriginalAnimation&&(J=z.clone(),J.name=E.clonedAnimationName||J.name),!J._keys.length)return J;const l=E.referenceFrame&&E.referenceFrame>=0?E.referenceFrame:0;let T=0;const b=J._keys[0];let L=J._keys.length-1;const D=J._keys[L],g={referenceValue:b.value,referencePosition:H.i.Pl[0],referenceQuaternion:H.i.Quaternion[0],referenceScaling:H.i.Pl[1],keyPosition:H.i.Pl[2],keyQuaternion:H.i.Quaternion[1],keyScaling:H.i.Pl[3]};let M=b.frame,q=D.frame;if(E.range){const z=J.getRange(E.range);z&&(M=z.from,q=z.to)}else M=E.fromFrame??M,q=E.toFrame??q;if(M!==b.frame&&(T=J.createKeyForFrame(M)),q!==D.frame&&(L=J.createKeyForFrame(q)),1===J._keys.length){const z=J._getKeyValue(J._keys[0]);g.referenceValue=z.clone?z.clone():z}else if(l<=b.frame){const z=J._getKeyValue(b.value);g.referenceValue=z.clone?z.clone():z}else if(l>=D.frame){const z=J._getKeyValue(D.value);g.referenceValue=z.clone?z.clone():z}else{d.key=0;const z=J._interpolate(l,d);g.referenceValue=z.clone?z.clone():z}J.dataType===t.ANIMATIONTYPE_QUATERNION?g.referenceValue.normalize().conjugateInPlace():J.dataType===t.ANIMATIONTYPE_MATRIX&&(g.referenceValue.decompose(g.referenceScaling,g.referenceQuaternion,g.referencePosition),g.referenceQuaternion.normalize().conjugateInPlace());let C=Number.MAX_VALUE;const K=E.clipKeys?[]:null;for(let h=T;h<=L;h++){let z=J._keys[h];if((K||E.cloneOriginalAnimation)&&(z={frame:z.frame,value:z.value.clone?z.value.clone():z.value,inTangent:z.inTangent,outTangent:z.outTangent,interpolation:z.interpolation,lockedTangent:z.lockedTangent},K&&(C===Number.MAX_VALUE&&(C=z.frame),z.frame-=C,K.push(z))),!h||J.dataType===t.ANIMATIONTYPE_FLOAT||z.value!==b.value)switch(J.dataType){case t.ANIMATIONTYPE_MATRIX:z.value.decompose(g.keyScaling,g.keyQuaternion,g.keyPosition),g.keyPosition.dg(g.referencePosition),g.keyScaling.divideInPlace(g.referenceScaling),g.referenceQuaternion.multiplyToRef(g.keyQuaternion,g.keyQuaternion),H.b.ComposeToRef(g.keyScaling,g.keyQuaternion,g.keyPosition,z.value);break;case t.ANIMATIONTYPE_QUATERNION:g.referenceValue.multiplyToRef(z.value,z.value);break;case t.ANIMATIONTYPE_VECTOR2:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:z.value.subtractToRef(g.referenceValue,z.value);break;case t.ANIMATIONTYPE_SIZE:z.value.width-=g.referenceValue.width,z.value.height-=g.referenceValue.height;break;default:z.value-=g.referenceValue}}return K&&J.setKeys(K,!0),J}static TransitionTo(z,u,Y,H,E,J,l){let T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(l<=0)return Y[z]=u,T&&T(),null;const b=E*(l/1e3);J.setKeys([{frame:0,value:Y[z].clone?Y[z].clone():Y[z]},{frame:b,value:u}]),Y.animations||(Y.animations=[]),Y.animations.push(J);const L=H.beginAnimation(Y,0,b,!1);return L.onAnimationEnd=T,L}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const z of this._runtimeAnimations)if(!z.isStopped())return!0;return!1}constructor(z,u,Y,H,E,J){this.name=z,this.targetProperty=u,this.framePerSecond=Y,this.dataType=H,this.loopMode=E,this.enableBlending=J,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=u.split("."),this.dataType=H,this.loopMode=void 0===E?t.ANIMATIONLOOPMODE_CYCLE:E,this.uniqueId=t._UniqueIdGenerator++}toString(z){let u="Name: "+this.name+", property: "+this.targetProperty;if(u+=", datatype: "+["Float","Pl","Quaternion","Matrix","o","Vector2"][this.dataType],u+=", nKeys: "+(this._keys?this._keys.length:"none"),u+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),z){u+=", Ranges: {";let z=!0;for(const Y in this._ranges)z&&(u+=", ",z=!1),u+=Y;u+="}"}return u}addEvent(z){this._events.push(z),this._events.sort(((z,u)=>z.frame-u.frame))}removeEvents(z){for(let u=0;u<this._events.length;u++)this._events[u].frame===z&&(this._events.splice(u,1),u--)}getEvents(){return this._events}createRange(z,u,Y){this._ranges[z]||(this._ranges[z]=new T.d(z,u,Y))}deleteRange(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this._ranges[z];if(Y){if(u){const z=Y.from,u=Y.to;for(let Y=this._keys.length-1;Y>=0;Y--)this._keys[Y].frame>=z&&this._keys[Y].frame<=u&&this._keys.splice(Y,1)}this._ranges[z]=null}}getRange(z){return this._ranges[z]}getKeys(){return this._keys}getHighestFrame(){let z=0;for(let u=0,Y=this._keys.length;u<Y;u++)z<this._keys[u].frame&&(z=this._keys[u].frame);return z}getEasingFunction(){return this._easingFunction}setEasingFunction(z){this._easingFunction=z}floatInterpolateFunction(z,u,Y){return(0,J.Lerp)(z,u,Y)}floatInterpolateFunctionWithTangents(z,u,Y,H,E){return(0,J.Hermite)(z,u,Y,H,E)}quaternionInterpolateFunction(z,u,Y){return H.f.Slerp(z,u,Y)}quaternionInterpolateFunctionWithTangents(z,u,Y,E,J){return H.f.Hermite(z,u,Y,E,J).normalize()}vector3InterpolateFunction(z,u,Y){return H.p.Lerp(z,u,Y)}vector3InterpolateFunctionWithTangents(z,u,Y,E,J){return H.p.Hermite(z,u,Y,E,J)}vector2InterpolateFunction(z,u,Y){return H.m.Lerp(z,u,Y)}vector2InterpolateFunctionWithTangents(z,u,Y,E,J){return H.m.Hermite(z,u,Y,E,J)}sizeInterpolateFunction(z,u,Y){return L.b.Lerp(z,u,Y)}color3InterpolateFunction(z,u,Y){return E.c.Lerp(z,u,Y)}color3InterpolateFunctionWithTangents(z,u,Y,H,J){return E.c.Hermite(z,u,Y,H,J)}color4InterpolateFunction(z,u,Y){return E.e.Lerp(z,u,Y)}color4InterpolateFunctionWithTangents(z,u,Y,H,J){return E.e.Hermite(z,u,Y,H,J)}_getKeyValue(z){return"function"===typeof z?z():z}evaluate(z){return d.key=0,this._interpolate(z,d)}_interpolate(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(u.loopMode===t.ANIMATIONLOOPMODE_CONSTANT&&u.repeatCount>0)return u.highLimitValue.clone?u.highLimitValue.clone():u.highLimitValue;const H=this._keys;let E;if(this._coreAnimation)E=this._coreAnimation._key;else{const J=H.length;for(E=u.key;E>=0&&z<H[E].frame;)--E;for(;E+1<=J-1&&z>=H[E+1].frame;)++E;if(u.key=E,E<0)return Y?void 0:this._getKeyValue(H[0].value);if(E+1>J-1)return Y?void 0:this._getKeyValue(H[J-1].value);this._key=E}const J=H[E],l=H[E+1];if(Y&&(z===J.frame||z===l.frame))return;const T=this._getKeyValue(J.value),b=this._getKeyValue(l.value);if(1===J.interpolation)return l.frame>z?T:b;const L=void 0!==J.outTangent&&void 0!==l.inTangent,D=l.frame-J.frame;let g=(z-J.frame)/D;const d=J.easingFunction||this.getEasingFunction();switch(d&&(g=d.ease(g)),this.dataType){case t.ANIMATIONTYPE_FLOAT:{const z=L?this.floatInterpolateFunctionWithTangents(T,J.outTangent*D,b,l.inTangent*D,g):this.floatInterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(u.offsetValue??0)*u.repeatCount+z}break}case t.ANIMATIONTYPE_QUATERNION:{const z=L?this.quaternionInterpolateFunctionWithTangents(T,J.outTangent.scale(D),b,l.inTangent.scale(D),g):this.quaternionInterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.addInPlace((u.offsetValue||M).scale(u.repeatCount))}return z}case t.ANIMATIONTYPE_VECTOR3:{const z=L?this.vector3InterpolateFunctionWithTangents(T,J.outTangent.scale(D),b,l.inTangent.scale(D),g):this.vector3InterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((u.offsetValue||q).scale(u.repeatCount))}break}case t.ANIMATIONTYPE_VECTOR2:{const z=L?this.vector2InterpolateFunctionWithTangents(T,J.outTangent.scale(D),b,l.inTangent.scale(D),g):this.vector2InterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((u.offsetValue||C).scale(u.repeatCount))}break}case t.ANIMATIONTYPE_SIZE:switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(T,b,g);case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(T,b,g).add((u.offsetValue||K).scale(u.repeatCount))}break;case t.ANIMATIONTYPE_COLOR3:{const z=L?this.color3InterpolateFunctionWithTangents(T,J.outTangent.scale(D),b,l.inTangent.scale(D),g):this.color3InterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((u.offsetValue||h).scale(u.repeatCount))}break}case t.ANIMATIONTYPE_COLOR4:{const z=L?this.color4InterpolateFunctionWithTangents(T,J.outTangent.scale(D),b,l.inTangent.scale(D),g):this.color4InterpolateFunction(T,b,g);switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return z;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((u.offsetValue||o).scale(u.repeatCount))}break}case t.ANIMATIONTYPE_MATRIX:switch(u.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_YOYO:return t.AllowMatricesInterpolation?this.matrixInterpolateFunction(T,b,g,u.workValue):T;case t.ANIMATIONLOOPMODE_RELATIVE:case t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T}}return 0}matrixInterpolateFunction(z,u,Y,E){return t.AllowMatrixDecomposeForInterpolation?E?(H.b.DecomposeLerpToRef(z,u,Y,E),E):H.b.DecomposeLerp(z,u,Y):E?(H.b.LerpToRef(z,u,Y,E),E):H.b.Lerp(z,u,Y)}clone(){const z=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(z.enableBlending=this.enableBlending,z.blendingSpeed=this.blendingSpeed,this._keys&&z.setKeys(this._keys),this._ranges){z._ranges={};for(const u in this._ranges){const Y=this._ranges[u];Y&&(z._ranges[u]=Y.clone())}}return z}setKeys(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=u?z:z.slice(0)}createKeyForFrame(z){d.key=0;const u=this._interpolate(z,d,!0);if(!u)return this._keys[d.key].frame===z?d.key:d.key+1;const Y={frame:z,value:u.clone?u.clone():u};return this._keys.splice(d.key+1,0,Y),d.key+1}serialize(){const z={};z.name=this.name,z.property=this.targetProperty,z.framePerSecond=this.framePerSecond,z.dataType=this.dataType,z.loopBehavior=this.loopMode,z.enableBlending=this.enableBlending,z.blendingSpeed=this.blendingSpeed;const u=this.dataType;z.keys=[];const Y=this.getKeys();for(let H=0;H<Y.length;H++){const E=Y[H],J={};switch(J.frame=E.frame,u){case t.ANIMATIONTYPE_FLOAT:J.values=[E.value],void 0!==E.inTangent&&J.values.push(E.inTangent),void 0!==E.outTangent&&(void 0===E.inTangent&&J.values.push(void 0),J.values.push(E.outTangent)),void 0!==E.interpolation&&(void 0===E.inTangent&&J.values.push(void 0),void 0===E.outTangent&&J.values.push(void 0),J.values.push(E.interpolation));break;case t.ANIMATIONTYPE_QUATERNION:case t.ANIMATIONTYPE_MATRIX:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:J.values=E.value.al(),void 0!=E.inTangent&&J.values.push(E.inTangent.al()),void 0!=E.outTangent&&(void 0===E.inTangent&&J.values.push(void 0),J.values.push(E.outTangent.al())),void 0!==E.interpolation&&(void 0===E.inTangent&&J.values.push(void 0),void 0===E.outTangent&&J.values.push(void 0),J.values.push(E.interpolation))}z.keys.push(J)}z.ranges=[];for(const H in this._ranges){const u=this._ranges[H];if(!u)continue;const Y={};Y.name=H,Y.from=u.from,Y.to=u.to,z.ranges.push(Y)}return z}static _UniversalLerp(z,u,Y){const H=z.constructor;return H.Lerp?H.Lerp(z,u,Y):H.Slerp?H.Slerp(z,u,Y):z.toFixed?z*(1-Y)+Y*u:u}static Parse(z){const u=new t(z.name,z.property,z.framePerSecond,z.dataType,z.loopBehavior),Y=z.dataType,J=[];let l,T;for(z.enableBlending&&(u.enableBlending=z.enableBlending),z.blendingSpeed&&(u.blendingSpeed=z.blendingSpeed),T=0;T<z.keys.length;T++){const u=z.keys[T];let b,L,D;switch(Y){case t.ANIMATIONTYPE_FLOAT:l=u.values[0],u.values.length>=2&&(b=u.values[1]),u.values.length>=3&&(L=u.values[2]),u.values.length>=4&&(D=u.values[3]);break;case t.ANIMATIONTYPE_QUATERNION:if(l=H.f.Nl(u.values),u.values.length>=8){const z=H.f.Nl(u.values.slice(4,8));z.equals(H.f.Zero())||(b=z)}if(u.values.length>=12){const z=H.f.Nl(u.values.slice(8,12));z.equals(H.f.Zero())||(L=z)}u.values.length>=13&&(D=u.values[12]);break;case t.ANIMATIONTYPE_MATRIX:l=H.b.Nl(u.values),u.values.length>=17&&(D=u.values[16]);break;case t.ANIMATIONTYPE_COLOR3:l=E.c.Nl(u.values),u.values[3]&&(b=E.c.Nl(u.values[3])),u.values[4]&&(L=E.c.Nl(u.values[4])),u.values[5]&&(D=u.values[5]);break;case t.ANIMATIONTYPE_COLOR4:l=E.e.Nl(u.values),u.values[4]&&(b=E.e.Nl(u.values[4])),u.values[5]&&(L=E.e.Nl(u.values[5])),u.values[6]&&(D=E.e.Nl(u.values[6]));break;case t.ANIMATIONTYPE_VECTOR3:default:l=H.p.Nl(u.values),u.values[3]&&(b=H.p.Nl(u.values[3])),u.values[4]&&(L=H.p.Nl(u.values[4])),u.values[5]&&(D=u.values[5])}const g={};g.frame=u.frame,g.value=l,void 0!=b&&(g.inTangent=b),void 0!=L&&(g.outTangent=L),void 0!=D&&(g.interpolation=D),J.push(g)}if(u.setKeys(J),z.ranges)for(T=0;T<z.ranges.length;T++)l=z.ranges[T],u.createRange(l.name,l.from,l.to);return u}static AppendSerializedAnimations(z,u){g.d.AppendSerializedAnimations(z,u)}static async ParseFromFileAsync(z,u){return await new Promise(((Y,H)=>{const E=new D.d;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){let u=JSON.parse(E.responseText);if(u.animations&&(u=u.animations),u.length){const z=[];for(const Y of u)z.push(this.Parse(Y));Y(z)}else{const H=this.Parse(u);z&&(H.name=z),Y(H)}}else H("Unable to load the animation")})),E.open("GET",u),E.send()}))}static async ParseFromSnippetAsync(z){return await new Promise(((u,Y)=>{const H=new D.d;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const Y=JSON.parse(JSON.parse(H.responseText).jsonPayload);if(Y.animations){const H=JSON.parse(Y.animations),E=[];for(const u of H.animations){const Y=this.Parse(u);Y.snippetId=z,E.push(Y)}u(E)}else{const H=JSON.parse(Y.animation),E=this.Parse(H);E.snippetId=z,u(E)}}else Y("Unable to load the snippet "+z)})),H.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),H.send()}))}}t._UniqueIdGenerator=0,t.AllowMatricesInterpolation=!1,t.AllowMatrixDecomposeForInterpolation=!0,t.SnippetUrl="https://snippet.babylonjs.com",t.ANIMATIONTYPE_FLOAT=0,t.ANIMATIONTYPE_VECTOR3=1,t.ANIMATIONTYPE_QUATERNION=2,t.ANIMATIONTYPE_MATRIX=3,t.ANIMATIONTYPE_COLOR3=4,t.ANIMATIONTYPE_COLOR4=7,t.ANIMATIONTYPE_VECTOR2=5,t.ANIMATIONTYPE_SIZE=6,t.ANIMATIONLOOPMODE_RELATIVE=0,t.ANIMATIONLOOPMODE_CYCLE=1,t.ANIMATIONLOOPMODE_CONSTANT=2,t.ANIMATIONLOOPMODE_YOYO=4,t.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,t.CreateFromSnippetAsync=t.ParseFromSnippetAsync,(0,l.d)("BABYLON.Animation",t),b.b._AnimationRangeFactory=(z,u,Y)=>new T.d(z,u,Y)},11626:(z,u,Y)=>{Y.d(u,{d:()=>H});class H{constructor(z,u,Y){this.name=z,this.from=u,this.to=Y}clone(){return new H(this.name,this.from,this.to)}}},11103:(z,u,Y)=>{Y.d(u,{d:()=>l,f:()=>T});var H=Y(11110),E=Y(10953),J=Y(11117);class l{get L(){return this._isDisposed}constructor(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,z&&z.iz?this._engine=z.iz().getEngine():this._engine=z,this._updatable=Y,this._instanced=l,this._divisor=b||1,this._label=L,u instanceof H.e?(this._data=null,this._buffer=u):(this._data=u,this._buffer=null),this.byteStride=T?E:E*Float32Array.BYTES_PER_ELEMENT,J||this.create()}createVertexBuffer(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const b=J?u:u*Float32Array.BYTES_PER_ELEMENT,L=H?J?H:H*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new T(this._engine,this,z,this._updatable,!0,L,void 0===E?this._instanced:E,b,Y,void 0,void 0,!0,this._divisor||l)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!z&&this._buffer||(z=z||this._data,z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z),this._data=z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(z,this._label),this._data=z):this._buffer=this._engine.createVertexBuffer(z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.vY>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.vY,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.vY,void 0,this._label));E.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(z){this.create(z)}updateDirectly(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z,H?u:u*Float32Array.BYTES_PER_ELEMENT,Y?Y*this.byteStride:void 0),this._data=0===u&&void 0===Y?z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class T{get L(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(z){const u=0!=z;this._instanceDivisor=z,u!==this._instanced&&(this._instanced=u,this._computeHashCode())}get _maxVerticesCount(){const z=this.getData();return z?Array.isArray(z)?z.length/(this.byteStride/4)-this.byteOffset/4:(z.byteLength-this.byteOffset)/this.byteStride:0}constructor(z,u,Y,H,E,b,L,D,g,M){let q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],C=arguments.length>11&&void 0!==arguments[11]&&arguments[11],K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,h=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let o=!1;if(this.vl=z,"object"===typeof H&&null!==H?(o=H.updatable??!1,E=H.postponeInternalCreation,b=H.stride,L=H.instanced,D=H.offset,g=H.size,M=H.type,q=H.normalized??!1,C=H.useBytes??!1,K=H.divisor??1,h=H.takeBufferOwnership??!1,this._label=H.label):o=!!H,u instanceof l?(this._buffer=u,this._ownsBuffer=h):(this._buffer=new l(z,u,o,b,E,L,C,K,this._label),this._ownsBuffer=!0),this.uniqueId=T._Counter++,this._kind=Y,void 0===M){const z=this.getData();this.type=z?T.GetDataType(z):T.FLOAT}else this.type=M;const d=(0,J.o)(this.type);C?(this._size=g||(b?b/d:T.DeduceStride(Y)),this.byteStride=b||this._buffer.byteStride||this._size*d,this.byteOffset=D||0):(this._size=g||b||T.DeduceStride(Y),this.byteStride=b?b*d:this._buffer.byteStride||this._size*d,this.byteOffset=(D||0)*d),this.normalized=q,this._instanced=void 0!==L&&L,this._instanceDivisor=L?K:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var z;null===(z=this._buffer)||void 0===z||z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(z,u){const Y=this.getData();return Y?(0,J.n)(Y,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,z,u):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,J.o)(this.type)}getOffset(){return this.byteOffset/(0,J.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,J.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(z){this._buffer.create(z),this._alignBuffer()}update(z){this._buffer.update(z),this._alignBuffer()}updateDirectly(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(z,u,void 0,Y),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(z,u){(0,J.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,z,this.normalized,((z,Y)=>{for(let H=0;H<this._size;H++)u(z[H],Y+H)}))}_alignBuffer(){}static DeduceStride(z){switch(z){case T.UVKind:case T.UV2Kind:case T.UV3Kind:case T.UV4Kind:case T.UV5Kind:case T.UV6Kind:return 2;case T.NormalKind:case T.PositionKind:return 3;case T.ColorKind:case T.ColorInstanceKind:case T.MatricesIndicesKind:case T.MatricesIndicesExtraKind:case T.MatricesWeightsKind:case T.MatricesWeightsExtraKind:case T.TangentKind:return 4;default:throw new Error("Invalid kind '"+z+"'")}}static GetDataType(z){return z instanceof Int8Array?T.BYTE:z instanceof Uint8Array?T.UNSIGNED_BYTE:z instanceof Int16Array?T.SHORT:z instanceof Uint16Array?T.UNSIGNED_SHORT:z instanceof Int32Array?T.INT:z instanceof Uint32Array?T.UNSIGNED_INT:T.FLOAT}static GetTypeByteLength(z){return(0,J.o)(z)}static ForEach(z,u,Y,H,E,l,T,b){(0,J.j)(z,u,Y,H,E,l,T,((z,u)=>{for(let Y=0;Y<H;Y++)b(z[Y],u+Y)}))}static GetFloatData(z,u,Y,H,E,l,T,b){return(0,J.n)(z,u,Y,H,E,l,T,b)}}T._Counter=0,T.BYTE=5120,T.UNSIGNED_BYTE=5121,T.SHORT=5122,T.UNSIGNED_SHORT=5123,T.INT=5124,T.UNSIGNED_INT=5125,T.FLOAT=5126,T.PositionKind="position",T.NormalKind="normal",T.TangentKind="tangent",T.UVKind="uv",T.UV2Kind="uv2",T.UV3Kind="uv3",T.UV4Kind="uv4",T.UV5Kind="uv5",T.UV6Kind="uv6",T.ColorKind="color",T.ColorInstanceKind="instanceColor",T.MatricesIndicesKind="matricesIndices",T.MatricesWeightsKind="matricesWeights",T.MatricesIndicesExtraKind="matricesIndicesExtra",T.MatricesWeightsExtraKind="matricesWeightsExtra"},11117:(z,u,Y)=>{Y.d(u,{e:()=>M,f:()=>g,j:()=>b,n:()=>L,o:()=>l,p:()=>T,t:()=>D});var H=Y(10953);function E(z,u,Y,H){switch(u){case 5120:{let u=z.getInt8(Y);return H&&(u=Math.max(u/127,-1)),u}case 5121:{let u=z.getUint8(Y);return H&&(u/=255),u}case 5122:{let u=z.getInt16(Y,!0);return H&&(u=Math.max(u/32767,-1)),u}case 5123:{let u=z.getUint16(Y,!0);return H&&(u/=65535),u}case 5124:return z.getInt32(Y,!0);case 5125:return z.getUint32(Y,!0);case 5126:return z.getFloat32(Y,!0);default:throw new Error(`Invalid component type ${u}`)}}function J(z,u,Y,H,E){switch(u){case 5120:H&&(E=Math.round(127*E)),z.setInt8(Y,E);break;case 5121:H&&(E=Math.round(255*E)),z.setUint8(Y,E);break;case 5122:H&&(E=Math.round(32767*E)),z.setInt16(Y,E,!0);break;case 5123:H&&(E=Math.round(65535*E)),z.setUint16(Y,E,!0);break;case 5124:z.setInt32(Y,E,!0);break;case 5125:z.setUint32(Y,E,!0);break;case 5126:z.setFloat32(Y,E,!0);break;default:throw new Error(`Invalid component type ${u}`)}}function l(z){switch(z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${z}'`)}}function T(z){switch(z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${z}'`)}}function b(z,u,Y,H,T,b,L,D){const g=new Array(H),M=new Array(H);if(z instanceof Array){let E=u/4;const J=Y/4;for(let u=0;u<b;u+=H){for(let u=0;u<H;u++)g[u]=M[u]=z[E+u];D(M,u);for(let u=0;u<H;u++)g[u]!==M[u]&&(z[E+u]=M[u]);E+=J}}else{const q=ArrayBuffer.isView(z)?new DataView(z.buffer,z.byteOffset,z.byteLength):new DataView(z),C=l(T);for(let z=0;z<b;z+=H){for(let z=0,Y=u;z<H;z++,Y+=C)g[z]=M[z]=E(q,T,Y,L);D(M,z);for(let z=0,Y=u;z<H;z++,Y+=C)g[z]!==M[z]&&J(q,T,Y,L,M[z]);u+=Y}}}function L(z,u,Y,E,J,T,L,D){const g=u*l(Y),M=L*u;if(5126!==Y||J!==g){const H=new Float32Array(M);return b(z,E,J,u,Y,M,T,((z,Y)=>{for(let E=0;E<u;E++)H[Y+E]=z[E]})),H}if(!(z instanceof Array||z instanceof Float32Array)||0!==E||z.length!==M){if(z instanceof Array){const u=E/4;return z.slice(u,u+M)}if(z instanceof ArrayBuffer)return new Float32Array(z,E,M);{const u=z.byteOffset+E;return 0!==(3&u)&&(H.b.Warn("Float array must be aligned to 4-bytes border"),D=!0),D?new Float32Array(z.buffer.slice(u,u+M*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(z.buffer,u,M)}}return D?z.slice():z}function D(z,u,Y,E,J,L,D,g){const M=l(Y),q=T(Y),C=D*u;if(Array.isArray(z)){if(0!==(3&E)||0!==(3&J))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const H=E/4,l=J/4;if(H+(D-1)*l+u>z.length)throw new Error("Last accessed index is out of bounds.");if(l<u)throw new Error("Data stride cannot be smaller than the component size.");if(l!==u){const H=new q(C);return b(z,E,J,u,Y,C,L,((z,Y)=>{for(let E=0;E<u;E++)H[Y+E]=z[E]})),H}return new q(z.slice(H,H+C))}let K,h=E;z instanceof ArrayBuffer?K=z:(K=z.buffer,h+=z.byteOffset);if(h+(D-1)*J+u*M>K.byteLength)throw new Error("Last accessed byte is out of bounds.");const o=u*M;if(J<o)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(J!==o){const z=new q(C);return b(K,h,J,u,Y,C,L,((Y,H)=>{for(let E=0;E<u;E++)z[H+E]=Y[E]})),z}return 1!==M&&0!==(h&M-1)&&(H.b.Warn("Array must be aligned to border of element size. Data will be copied."),g=!0),g?new q(K.slice(h,h+C*M)):new q(K,h,C)}function g(z,u,Y,E,J,T,L,D){const g=u*l(Y),M=L*u;if(D.length!==M)throw new Error("Output length is not valid");if(5126===Y&&J===g)if(z instanceof Array){const u=E/4;D.set(z,u)}else if(z instanceof ArrayBuffer){const u=new Float32Array(z,E,M);D.set(u)}else{const u=z.byteOffset+E;if(0!==(3&u))return H.b.Warn("Float array must be aligned to 4-bytes border"),void D.set(new Float32Array(z.buffer.slice(u,u+M*Float32Array.BYTES_PER_ELEMENT)));const Y=new Float32Array(z.buffer,u,M);D.set(Y)}else b(z,E,J,u,Y,M,T,((z,Y)=>{for(let H=0;H<u;H++)D[Y+H]=z[H]}))}function M(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(z)){for(let E=0;E<u;E++)if(z[Y+E]-H>65535)return!0;return!1}return 4===z.BYTES_PER_ELEMENT}},11110:(z,u,Y)=>{Y.d(u,{e:()=>H});class H{get underlyingResource(){return null}constructor(){this.references=0,this.vY=0,this.is32Bits=!1,this.uniqueId=H._Counter++}}H._Counter=0},11275:(z,u,Y)=>{Y.d(u,{d:()=>h});var H=Y(11079),E=Y(11082),J=Y(11283),l=Y(10945),T=Y(10932),b=Y(10903),L=Y(11222),D=Y(10953),g=Y(10918),M=Y(10970),q=Y(11285),C=Y(11291),K=Y(11172);class h extends L.b{get position(){return this._position}set position(z){this._position=z}set upVector(z){this._upVector=z}get upVector(){return this._upVector}get screenArea(){let z=0,u=0;if(this.mode===h.PERSPECTIVE_CAMERA)this.fovMode===h.FOVMODE_VERTICAL_FIXED?(u=2*this.uT*Math.tan(this.fov/2),z=this.getEngine().getAspectRatio(this)*u):(z=2*this.uT*Math.tan(this.fov/2),u=z/this.getEngine().getAspectRatio(this));else{const Y=this.getEngine().getRenderWidth()/2,H=this.getEngine().getRenderHeight()/2;z=(this.orthoRight??Y)-(this.orthoLeft??-Y),u=(this.orthoTop??H)-(this.orthoBottom??-H)}return z*u}set orthoLeft(z){this._orthoLeft=z;for(const u of this._rigCameras)u.orthoLeft=z}get orthoLeft(){return this._orthoLeft}set orthoRight(z){this._orthoRight=z;for(const u of this._rigCameras)u.orthoRight=z}get orthoRight(){return this._orthoRight}set orthoBottom(z){this._orthoBottom=z;for(const u of this._rigCameras)u.orthoBottom=z}get orthoBottom(){return this._orthoBottom}set orthoTop(z){this._orthoTop=z;for(const u of this._rigCameras)u.orthoTop=z}get orthoTop(){return this._orthoTop}setFocalLength(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(u/(2*z))}set mode(z){this._mode=z;for(const u of this._rigCameras)u.mode=z}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(z,u,Y){let H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(z,Y,!1),this._position=b.p.Zero(),this._upVector=b.p.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.uT=1,this.maxZ=1e4,this.inertia=.9,this._mode=h.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new q.c(0,0,1,1),this.layerMask=268435455,this.fovMode=h.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=h.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new T.e,this.onProjectionMatrixChangedObservable=new T.e,this.onAfterCheckInputsObservable=new T.e,this.onRestoreStateObservable=new T.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new b.b,this._postProcesses=new Array,this._activeMeshes=new J.h(256),this._globalPosition=b.p.Zero(),this._computedViewMatrix=b.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=b.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=b.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.iz().addCamera(this),H&&!this.iz().activeCamera&&(this.iz().activeCamera=this),this.position=u,this.renderPassId=this.iz().getEngine().createRenderPassId(`Camera ${z}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"vD"}toString(z){let u="Name: "+this.name;if(u+=", type: "+this.getClassName(),this.animations)for(let Y=0;Y<this.animations.length;Y++)u+=", animation[0]: "+this.animations[Y].toString(z);return u}applyVerticalCorrection(){const z=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-z.x:z.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(z){return-1!==this._activeMeshes.indexOf(z)}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(z)for(const u of this._postProcesses)if(u&&!u.isReady())return!1;return super.isReady(z)}_initCache(){super._initCache(),this._cache.position=new b.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new b.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.uT=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(z){z||super._updateCache(),this._cache.position.J(this.position),this._cache.upVector.J(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let z=this._cache.mode===this.mode&&this._cache.uT===this.uT&&this._cache.maxZ===this.maxZ;if(!z)return!1;const u=this.getEngine();return this.mode===h.PERSPECTIVE_CAMERA?z=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===u.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(z=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===u.getRenderWidth()&&this._cache.renderHeight===u.getRenderHeight(),this.oblique&&(z=z&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),z}attachControl(z,u){}EM(z){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==h.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let z=0;z<this._postProcesses.length;z++)if(null!==this._postProcesses[z])return this._postProcesses[z];return null}_cascadePostProcessesToRigCams(){const z=this._getFirstPostProcess();z&&z.markTextureDirty();for(let u=0,Y=this._rigCameras.length;u<Y;u++){const z=this._rigCameras[u],Y=z._rigPostProcess;if(Y){"pass"===Y.getEffectName()&&(z.isIntermediate=0===this._postProcesses.length),z._postProcesses=this._postProcesses.slice(0).concat(Y),Y.markTextureDirty()}else z._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!z.isReusable()&&this._postProcesses.indexOf(z)>-1?(D.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==u||u<0?this._postProcesses.push(z):null===this._postProcesses[u]?this._postProcesses[u]=z:this._postProcesses.splice(u,0,z),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.uD(),this._postProcesses.indexOf(z))}detachPostProcess(z){const u=this._postProcesses.indexOf(z);-1!==u&&(this._postProcesses[u]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.uD(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return b.b.Identity()}getViewMatrix(z){return!z&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.iz().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(z){this._doNotComputeProjectionMatrix=!0,void 0!==z&&(this._projectionMatrix=z)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(z){if(this._doNotComputeProjectionMatrix||!z&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.uT=this.uT,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const u=this.getEngine(),Y=this.iz(),H=u.useReverseDepthBuffer;if(this.mode===h.PERSPECTIVE_CAMERA){let z;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=u.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.uT<=0&&(this.uT=.1),z=Y.useRightHandedSystem?b.b.PerspectiveFovRHToRef:b.b.PerspectiveFovLHToRef,z(this.fov,u.getAspectRatio(this),H?this.maxZ:this.uT,H?this.uT:this.maxZ,this._projectionMatrix,this.fovMode===h.FOVMODE_VERTICAL_FIXED,u.isNDCHalfZRange,this.projectionPlaneTilt,H)}else{var E,J,l;const z=u.getRenderWidth()/2,T=u.getRenderHeight()/2;Y.useRightHandedSystem?this.oblique?b.b.ObliqueOffCenterRHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-T,this.orthoTop??T,H?this.maxZ:this.uT,H?this.uT:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,u.isNDCHalfZRange):b.b.OrthoOffCenterRHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-T,this.orthoTop??T,H?this.maxZ:this.uT,H?this.uT:this.maxZ,this._projectionMatrix,u.isNDCHalfZRange):this.oblique?b.b.ObliqueOffCenterLHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-T,this.orthoTop??T,H?this.maxZ:this.uT,H?this.uT:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,u.isNDCHalfZRange):b.b.OrthoOffCenterLHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-T,this.orthoTop??T,H?this.maxZ:this.uT,H?this.uT:this.maxZ,this._projectionMatrix,u.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(E=this.oblique)||void 0===E?void 0:E.angle,this._cache.obliqueLength=null===(J=this.oblique)||void 0===J?void 0:J.length,this._cache.obliqueOffset=null===(l=this.oblique)||void 0===l?void 0:l.offset,this._cache.renderWidth=u.getRenderWidth(),this._cache.renderHeight=u.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(z){return(this.radius||(this.target?b.p.Distance(this.position,this.target):this.position.length()))+z}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?C.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=C.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),u&&this.rigCameras.length>0){let u=!1;for(const Y of this.rigCameras)Y._updateFrustumPlanes(),u=u||z.isInFrustum(Y._frustumPlanes);return u}return z.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(z){return this._updateFrustumPlanes(),z.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,M.e)("Ray")}getForwardRayToRef(z){throw(0,M.e)("Ray")}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.iz().stopAnimation(this),this.iz().removeCamera(this);this._rigCameras.length>0;){const z=this._rigCameras.pop();z&&z.dispose()}if(this._parentContainer){const z=this._parentContainer.cameras.indexOf(this);z>-1&&this._parentContainer.cameras.splice(z,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==h.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let z=this._postProcesses.length;for(;--z>=0;){const u=this._postProcesses[z];u&&u.dispose(this)}}let Y=this.customRenderTargets.length;for(;--Y>=0;)this.customRenderTargets[Y].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.iz().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(z,u)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(z,u){if(this.cameraRigMode!==z){for(;this._rigCameras.length>0;){const z=this._rigCameras.pop();z&&z.dispose()}if(this.cameraRigMode=z,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=u.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=l.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==h.RIG_MODE_NONE){const z=this.createRigCamera(this.name+"_L",0);z&&(z._isLeftCamera=!0);const u=this.createRigCamera(this.name+"_R",1);u&&(u._isRightCamera=!0),z&&u&&(this._rigCameras.push(z),this._rigCameras.push(u))}this._setRigMode(u),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(z){}_getVRProjectionMatrix(){return b.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.uT,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(z,u){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[z]=u,"interaxialDistance"===z&&(this._cameraRigParams.stereoHalfAngle=l.e.ToRadians(u/.0637))}createRigCamera(z,u){return null}_updateRigCameras(){for(let z=0;z<this._rigCameras.length;z++)this._rigCameras[z].uT=this.uT,this._rigCameras[z].maxZ=this.maxZ,this._rigCameras[z].fov=this.fov,this._rigCameras[z].upVector.J(this.upVector);this.cameraRigMode===h.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const z=K.d.Serialize(this);return z.uniqueId=this.uniqueId,z.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(z),this.inputs&&this.inputs.serialize(z),K.d.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.isEnabled=this.isEnabled(),z}clone(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=K.d.Clone(h.GetConstructorFromName(this.getClassName(),z,this.iz(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return Y.name=z,Y.parent=u,this.onClonedObservable.notifyObservers(Y),Y}sb(z){const u=b.p.Zero();return this.getDirectionToRef(z,u),u}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(z,u){b.p.TransformNormalToRef(z,this.getWorldMatrix(),u)}static GetConstructorFromName(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const J=L.b.Construct(z,u,Y,{interaxial_distance:H,isStereoscopicSideBySide:E});return J||(()=>h._CreateDefaultParsedCamera(u,Y))}pl(){return this.getWorldMatrix()}static Parse(z,u){const Y=z.type,H=h.GetConstructorFromName(Y,z.name,u,z.interaxial_distance,z.isStereoscopicSideBySide),E=K.d.Parse(H,z,u);if(void 0!==z.parentId&&(E._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(E._waitingParentInstanceIndex=z.parentInstanceIndex),E.inputs&&(E.inputs.parse(z),E._setupInputs()),z.upVector&&(E.upVector=b.p.Nl(z.upVector)),E.setPosition&&(E.position.kl(0,0,0),E.setPosition(b.p.Nl(z.position))),z.target&&E.setTarget&&E.setTarget(b.p.Nl(z.target)),z.cameraRigMode){const u=z.interaxial_distance?{interaxialDistance:z.interaxial_distance}:{};E.setCameraRigMode(z.cameraRigMode,u)}if(z.animations){for(let u=0;u<z.animations.length;u++){const Y=z.animations[u],H=(0,g.c)("BABYLON.Animation");H&&E.animations.push(H.Parse(Y))}L.b.ParseAnimationRanges(E,z,u)}return z.autoAnimate&&u.beginAnimation(E,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),void 0!==z.isEnabled&&E.oT(z.isEnabled),E}_calculateHandednessMultiplier(){let z=this.iz().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(z*=-1),z}}h._CreateDefaultParsedCamera=(z,u)=>{throw(0,M.e)("UniversalCamera")},h.PERSPECTIVE_CAMERA=0,h.ORTHOGRAPHIC_CAMERA=1,h.FOVMODE_VERTICAL_FIXED=0,h.FOVMODE_HORIZONTAL_FIXED=1,h.RIG_MODE_NONE=0,h.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,h.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,h.RIG_MODE_STEREOSCOPIC_INTERLACED=14,h.RIG_MODE_VR=20,h.RIG_MODE_CUSTOM=22,h.ForceAttachControlToAlwaysPreventDefault=!1,(0,H.e)([(0,E.K)("position")],h.prototype,"_position",void 0),(0,H.e)([(0,E.K)("upVector")],h.prototype,"_upVector",void 0),(0,H.e)([(0,E.L)()],h.prototype,"orthoLeft",null),(0,H.e)([(0,E.L)()],h.prototype,"orthoRight",null),(0,H.e)([(0,E.L)()],h.prototype,"orthoBottom",null),(0,H.e)([(0,E.L)()],h.prototype,"orthoTop",null),(0,H.e)([(0,E.L)()],h.prototype,"fov",void 0),(0,H.e)([(0,E.L)()],h.prototype,"projectionPlaneTilt",void 0),(0,H.e)([(0,E.L)()],h.prototype,"uT",void 0),(0,H.e)([(0,E.L)()],h.prototype,"maxZ",void 0),(0,H.e)([(0,E.L)()],h.prototype,"inertia",void 0),(0,H.e)([(0,E.L)()],h.prototype,"mode",null),(0,H.e)([(0,E.L)()],h.prototype,"layerMask",void 0),(0,H.e)([(0,E.L)()],h.prototype,"fovMode",void 0),(0,H.e)([(0,E.L)()],h.prototype,"cameraRigMode",void 0),(0,H.e)([(0,E.L)()],h.prototype,"interaxialDistance",void 0),(0,H.e)([(0,E.L)()],h.prototype,"isStereoscopicSideBySide",void 0)},11475:(z,u,Y)=>{Y.d(u,{b:()=>g});var H=Y(11079),E=Y(11082),J=Y(11275),l=Y(10903),T=Y(10906),b=Y(11256);Y(11222).b.AddNodeConstructor("TargetCamera",((z,u)=>()=>new g(z,l.p.Zero(),u)));const L=l.b.Zero(),D=l.f.Identity();class g extends J.d{constructor(z,u,Y){super(z,u,Y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new l.p(0,0,0),this.cameraRotation=new l.m(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=l.p.Zero(),this._initialFocalDistance=1,this._viewMatrix=l.b.Zero(),this._cameraTransformMatrix=l.b.Zero(),this._cameraRotationMatrix=l.b.Zero(),this._transformedReferencePoint=l.p.Zero(),this._deferredPositionUpdate=new l.p,this._deferredRotationQuaternionUpdate=new l.f,this._deferredRotationUpdate=new l.p,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=l.p.Forward(this.iz().useRightHandedSystem),this.rotation=new l.p(0,this.iz().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(z){this.getWorldMatrix();const u=l.i.Pl[0],Y=l.i.Pl[1];return Y.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(Y,u),u.scaleInPlace(z),this.globalPosition.add(u)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const z=this.lockedTarget;z.pl().getTranslationToRef(z.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.kl(0,0,0),this.cameraRotation.kl(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new l.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new l.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new l.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(z){z||super._updateCache();const u=this._getLockedTargetPosition();u?this._cache.lockedTarget?this._cache.lockedTarget.J(u):this._cache.lockedTarget=u.clone():this._cache.lockedTarget=null,this._cache.rotation.J(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.J(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const z=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(z):!z)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const z=this.getEngine();return this.speed*Math.sqrt(z.getDeltaTime()/(100*z.getFps()))}setTarget(z){this.upVector.normalize(),this._initialFocalDistance=z.JY(this.position).length(),this.position.z===z.z&&(this.position.z+=T.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.iz().useRightHandedSystem?l.b.LookAtRHToRef(this.position,z,l.p.UpReadOnly,L):l.b.LookAtLHToRef(this.position,z,l.p.UpReadOnly,L),L.invert();const u=this.rotationQuaternion||D;l.f.FromRotationMatrixToRef(L,u),u.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(z){this.setTarget(z)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(l.i.Matrix[0]),l.p.TransformNormalToRef(this.cameraDirection,l.i.Matrix[0],l.i.Pl[0]),this._deferredPositionUpdate.addInPlace(l.i.Pl[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.J(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.J(this._deferredPositionUpdate)}_checkInputs(){const z=this.invertRotation?-this.inverseRotationSpeed:1,u=this._decideIfNeedsToMove(),Y=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.J(this.rotation),this._deferredPositionUpdate.J(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.J(this.rotationQuaternion),u&&this._updatePosition(),Y){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*z,this._deferredRotationUpdate.y+=this.cameraRotation.y*z,!this.noRotationConstraint){const z=1.570796;this._deferredRotationUpdate.x>z&&(this._deferredRotationUpdate.x=z),this._deferredRotationUpdate.x<-z&&(this._deferredRotationUpdate.x=-z)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.J(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(l.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.J(this._deferredRotationQuaternionUpdate))}}u&&(Math.abs(this.cameraDirection.x)<this.speed*T.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*T.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*T.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),Y&&(Math.abs(this.cameraRotation.x)<this.speed*T.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*T.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):l.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return l.p.TransformNormalToRef(l.p.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),l.p.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?b.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(l.f.FromEulerVectorToRef(this.rotation,D),b.c.Y.rotateByQuaternionToRef(D,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(z,u,Y){if(this.iz().useRightHandedSystem?l.b.LookAtRHToRef(z,u,Y,this._viewMatrix):l.b.LookAtLHToRef(z,u,Y,this._viewMatrix),this.parent){const z=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(z,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.J(z)}createRigCamera(z,u){if(this.cameraRigMode!==J.d.RIG_MODE_NONE){const u=new g(z,this.position.clone(),this.iz());return u.isRigCamera=!0,u.rigParent=this,this.cameraRigMode===J.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new l.f),u._cameraRigParams={},u.rotationQuaternion=new l.f),u.mode=this.mode,u.orthoLeft=this.orthoLeft,u.orthoRight=this.orthoRight,u.orthoTop=this.orthoTop,u.orthoBottom=this.orthoBottom,u}return null}_updateRigCameras(){const z=this._rigCameras[0],u=this._rigCameras[1];switch(this.pl(),this.cameraRigMode){case J.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case J.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const Y=this.cameraRigMode===J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,H=this.cameraRigMode===J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Y,z),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*H,u);break}case J.d.RIG_MODE_VR:z.rotationQuaternion?(z.rotationQuaternion.J(this.rotationQuaternion),u.rotationQuaternion.J(this.rotationQuaternion)):(z.rotation.J(this.rotation),u.rotation.J(this.rotation)),z.position.J(this.position),u.position.J(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(z,u){this.getTarget().subtractToRef(this.position,g._TargetFocalPoint),g._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const Y=g._TargetFocalPoint.addInPlace(this.position);l.b.TranslationToRef(-Y.x,-Y.y,-Y.z,g._TargetTransformMatrix),g._TargetTransformMatrix.multiplyToRef(l.b.RotationAxis(u.upVector,z),g._RigCamTransformMatrix),l.b.TranslationToRef(Y.x,Y.y,Y.z,g._TargetTransformMatrix),g._RigCamTransformMatrix.multiplyToRef(g._TargetTransformMatrix,g._RigCamTransformMatrix),l.p.TransformCoordinatesToRef(this.position,g._RigCamTransformMatrix,u.position),u.setTarget(Y)}getClassName(){return"TargetCamera"}}g._RigCamTransformMatrix=new l.b,g._TargetTransformMatrix=new l.b,g._TargetFocalPoint=new l.p,(0,H.e)([(0,E.L)()],g.prototype,"updateUpVectorFromRotation",void 0),(0,H.e)([(0,E.K)()],g.prototype,"rotation",void 0),(0,H.e)([(0,E.L)()],g.prototype,"speed",void 0),(0,H.e)([(0,E.x)("lockedTargetId")],g.prototype,"lockedTarget",void 0)},11124:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{constructor(z,u,Y){this.bu=z,this.bv=u,this.distance=Y,this.faceId=0,this.subMeshId=0}}},11248:(z,u,Y)=>{Y.d(u,{e:()=>J});var H=Y(10903),E=Y(11103);class J{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var z;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||Y&&!this.pickedMesh.isVerticesDataPresent(E.f.NormalKind))return null;let J,l=this.pickedMesh.Il();0===(null===(z=l)||void 0===z?void 0:z.length)&&(l=null);const T=H.i.Pl[0],b=H.i.Pl[1],L=H.i.Pl[2];if(Y){const z=this.pickedMesh.getVerticesData(E.f.NormalKind);let u=l?H.p.FromArrayToRef(z,3*l[3*this.faceId],T):T.kl(z[3*this.faceId*3],z[3*this.faceId*3+1],z[3*this.faceId*3+2]),Y=l?H.p.FromArrayToRef(z,3*l[3*this.faceId+1],b):b.kl(z[3*(3*this.faceId+1)],z[3*(3*this.faceId+1)+1],z[3*(3*this.faceId+1)+2]),D=l?H.p.FromArrayToRef(z,3*l[3*this.faceId+2],L):L.kl(z[3*(3*this.faceId+2)],z[3*(3*this.faceId+2)+1],z[3*(3*this.faceId+2)+2]);u=u.scale(this.bu),Y=Y.scale(this.bv),D=D.scale(1-this.bu-this.bv),J=new H.p(u.x+Y.x+D.x,u.y+Y.y+D.y,u.z+Y.z+D.z)}else{const z=this.pickedMesh.getVerticesData(E.f.PositionKind),u=l?H.p.FromArrayToRef(z,3*l[3*this.faceId],T):T.kl(z[3*this.faceId*3],z[3*this.faceId*3+1],z[3*this.faceId*3+2]),Y=l?H.p.FromArrayToRef(z,3*l[3*this.faceId+1],b):b.kl(z[3*(3*this.faceId+1)],z[3*(3*this.faceId+1)+1],z[3*(3*this.faceId+1)+2]),D=l?H.p.FromArrayToRef(z,3*l[3*this.faceId+2],L):L.kl(z[3*(3*this.faceId+2)],z[3*(3*this.faceId+2)+1],z[3*(3*this.faceId+2)+2]),g=u.JY(Y),M=D.JY(Y);J=H.p.Cross(g,M)}const D=(z,u)=>{if(-1!==this.thinInstanceIndex){const Y=z.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];Y&&H.p.TransformNormalToRef(u,Y,u)}let Y=z.getWorldMatrix();z.nonUniformScaling&&(H.i.Matrix[0].J(Y),Y=H.i.Matrix[0],Y.setTranslationFromFloats(0,0,0),Y.invert(),Y.transposeToRef(H.i.Matrix[1]),Y=H.i.Matrix[1]),H.p.TransformNormalToRef(u,Y,u)};if(u&&D(this.pickedMesh,J),this.ray){const z=H.i.Pl[0].J(J);u||D(this.pickedMesh,z),H.p.Dot(z,this.ray.direction)>0&&J.negateInPlace()}return J.normalize(),J}getTextureCoordinates(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(z))return null;const u=this.pickedMesh.Il();if(!u)return null;const Y=this.pickedMesh.getVerticesData(z);if(!Y)return null;let J=H.m.Nl(Y,2*u[3*this.faceId]),l=H.m.Nl(Y,2*u[3*this.faceId+1]),T=H.m.Nl(Y,2*u[3*this.faceId+2]);return J=J.scale(this.bu),l=l.scale(this.bv),T=T.scale(1-this.bu-this.bv),new H.m(J.x+l.x+T.x,J.y+l.y+T.y)}}},11309:(z,u,Y)=>{Y.d(u,{b:()=>H});let H=!1},11136:(z,u,Y)=>{Y.d(u,{c:()=>l});var H=Y(10910),E=Y(10903),J=Y(10906);class l{constructor(z,u,Y){this.vectors=(0,H.b)(8,E.p.Zero),this.center=E.p.Zero(),this.centerWorld=E.p.Zero(),this.extendSize=E.p.Zero(),this.extendSizeWorld=E.p.Zero(),this.directions=(0,H.b)(3,E.p.Zero),this.vectorsWorld=(0,H.b)(8,E.p.Zero),this.minimumWorld=E.p.Zero(),this.maximumWorld=E.p.Zero(),this.minimum=E.p.Zero(),this.maximum=E.p.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(z,u,Y)}reConstruct(z,u,Y){const H=z.x,J=z.y,l=z.z,T=u.x,b=u.y,L=u.z,D=this.vectors;this.minimum.kl(H,J,l),this.maximum.kl(T,b,L),D[0].kl(H,J,l),D[1].kl(T,b,L),D[2].kl(T,J,l),D[3].kl(H,b,l),D[4].kl(H,J,L),D[5].kl(T,b,l),D[6].kl(H,b,L),D[7].kl(T,J,L),u.addToRef(z,this.center).scaleInPlace(.5),u.subtractToRef(z,this.extendSize).scaleInPlace(.5),this._worldMatrix=Y||E.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(z){const u=l._TmpVector3,Y=this.maximum.subtractToRef(this.minimum,u[0]),H=Y.length();Y.normalizeFromLength(H);const E=H*z,J=Y.scaleInPlace(.5*E),T=this.center.subtractToRef(J,u[1]),b=this.center.addToRef(J,u[2]);return this.reConstruct(T,b,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){const u=this.minimumWorld,Y=this.maximumWorld,H=this.directions,J=this.vectorsWorld,l=this.vectors;if(z.isIdentity()){u.J(this.minimum),Y.J(this.maximum);for(let z=0;z<8;++z)J[z].J(l[z]);this.extendSizeWorld.J(this.extendSize),this.centerWorld.J(this.center)}else{u.Bl(Number.MAX_VALUE),Y.Bl(-Number.MAX_VALUE);for(let H=0;H<8;++H){const T=J[H];E.p.TransformCoordinatesToRef(l[H],z,T),u.minimizeInPlace(T),Y.maximizeInPlace(T)}Y.subtractToRef(u,this.extendSizeWorld).scaleInPlace(.5),Y.addToRef(u,this.centerWorld).scaleInPlace(.5)}E.p.FromArrayToRef(z.m,0,H[0]),E.p.FromArrayToRef(z.m,4,H[1]),E.p.FromArrayToRef(z.m,8,H[2]),this._worldMatrix=z}isInFrustum(z){return l.IsInFrustum(this.vectorsWorld,z)}isCompletelyInFrustum(z){return l.IsCompletelyInFrustum(this.vectorsWorld,z)}intersectsPoint(z){const u=this.minimumWorld,Y=this.maximumWorld,H=u.x,E=u.y,l=u.z,T=Y.x,b=Y.y,L=Y.z,D=z.x,g=z.y,M=z.z,q=-J.e;return!(T-D<q||q>D-H)&&(!(b-g<q||q>g-E)&&!(L-M<q||q>M-l))}intersectsSphere(z){return l.IntersectsSphere(this.minimumWorld,this.maximumWorld,z.centerWorld,z.radiusWorld)}intersectsMinMax(z,u){const Y=this.minimumWorld,H=this.maximumWorld,E=Y.x,J=Y.y,l=Y.z,T=H.x,b=H.y,L=H.z,D=z.x,g=z.y,M=z.z,q=u.x,C=u.y,K=u.z;return!(T<D||E>q)&&(!(b<g||J>C)&&!(L<M||l>K))}dispose(){var z,u;null===(z=this._drawWrapperFront)||void 0===z||z.dispose(),null===(u=this._drawWrapperBack)||void 0===u||u.dispose()}static Intersects(z,u){return z.intersectsMinMax(u.minimumWorld,u.maximumWorld)}static IntersectsSphere(z,u,Y,H){const J=l._TmpVector3[0];E.p.ClampToRef(Y,z,u,J);return E.p.DistanceSquared(Y,J)<=H*H}static IsCompletelyInFrustum(z,u){for(let Y=0;Y<6;++Y){const H=u[Y];for(let u=0;u<8;++u)if(H.dotCoordinate(z[u])<0)return!1}return!0}static IsInFrustum(z,u){for(let Y=0;Y<6;++Y){let H=!0;const E=u[Y];for(let u=0;u<8;++u)if(E.dotCoordinate(z[u])>=0){H=!1;break}if(H)return!1}return!0}}l._TmpVector3=(0,H.b)(3,E.p.Zero)},11131:(z,u,Y)=>{Y.d(u,{e:()=>g});var H=Y(10910),E=Y(10903),J=Y(11136),l=Y(11144);const T={min:0,max:0},b={min:0,max:0},L=(z,u,Y)=>{const H=E.p.Dot(u.centerWorld,z),J=Math.abs(E.p.Dot(u.directions[0],z))*u.extendSize.x+Math.abs(E.p.Dot(u.directions[1],z))*u.extendSize.y+Math.abs(E.p.Dot(u.directions[2],z))*u.extendSize.z;Y.min=H-J,Y.max=H+J},D=(z,u,Y)=>(L(z,u,T),L(z,Y,b),!(T.min>b.max||b.min>T.max));class g{constructor(z,u,Y){this._isLocked=!1,this.boundingBox=new J.c(z,u,Y),this.boundingSphere=new l.c(z,u,Y)}reConstruct(z,u,Y){this.boundingBox.reConstruct(z,u,Y),this.boundingSphere.reConstruct(z,u,Y)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(z){this._isLocked=z}update(z){this._isLocked||(this.boundingBox._update(z),this.boundingSphere._update(z))}centerOn(z,u){const Y=g._TmpVector3[0].J(z).dg(u),H=g._TmpVector3[1].J(z).addInPlace(u);return this.boundingBox.reConstruct(Y,H,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(Y,H,this.boundingBox.getWorldMatrix()),this}encapsulate(z){const u=E.p.Minimize(this.minimum,z),Y=E.p.Maximize(this.maximum,z);return this.reConstruct(u,Y,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(z){const u=E.i.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(u);const Y=E.i.Pl[0];return E.p.TransformCoordinatesToRef(z.boundingBox.minimumWorld,u,Y),this.encapsulate(Y),E.p.TransformCoordinatesToRef(z.boundingBox.maximumWorld,u,Y),this.encapsulate(Y),this}scale(z){return this.boundingBox.scale(z),this.boundingSphere.scale(z),this}isInFrustum(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===u||3===u)&&this.boundingSphere.isCenterInFrustum(z))return!0;if(!this.boundingSphere.isInFrustum(z))return!1;return!(1!==u&&3!==u)||this.boundingBox.isInFrustum(z)}get diagonalLength(){const z=this.boundingBox;return z.maximumWorld.subtractToRef(z.minimumWorld,g._TmpVector3[0]).length()}isCompletelyInFrustum(z){return this.boundingBox.isCompletelyInFrustum(z)}_checkCollision(z){return z._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(z){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(z)&&!!this.boundingBox.intersectsPoint(z))}intersects(z,u){if(!l.c.Intersects(this.boundingSphere,z.boundingSphere))return!1;if(!J.c.Intersects(this.boundingBox,z.boundingBox))return!1;if(!u)return!0;const Y=this.boundingBox,H=z.boundingBox;return!!D(Y.directions[0],Y,H)&&(!!D(Y.directions[1],Y,H)&&(!!D(Y.directions[2],Y,H)&&(!!D(H.directions[0],Y,H)&&(!!D(H.directions[1],Y,H)&&(!!D(H.directions[2],Y,H)&&(!!D(E.p.Cross(Y.directions[0],H.directions[0]),Y,H)&&(!!D(E.p.Cross(Y.directions[0],H.directions[1]),Y,H)&&(!!D(E.p.Cross(Y.directions[0],H.directions[2]),Y,H)&&(!!D(E.p.Cross(Y.directions[1],H.directions[0]),Y,H)&&(!!D(E.p.Cross(Y.directions[1],H.directions[1]),Y,H)&&(!!D(E.p.Cross(Y.directions[1],H.directions[2]),Y,H)&&(!!D(E.p.Cross(Y.directions[2],H.directions[0]),Y,H)&&(!!D(E.p.Cross(Y.directions[2],H.directions[1]),Y,H)&&!!D(E.p.Cross(Y.directions[2],H.directions[2]),Y,H))))))))))))))}}g._TmpVector3=(0,H.b)(2,E.p.Zero)},11144:(z,u,Y)=>{Y.d(u,{c:()=>J});var H=Y(10910),E=Y(10903);class J{constructor(z,u,Y){this.center=E.p.Zero(),this.centerWorld=E.p.Zero(),this.minimum=E.p.Zero(),this.maximum=E.p.Zero(),this.reConstruct(z,u,Y)}reConstruct(z,u,Y){this.minimum.J(z),this.maximum.J(u);const H=E.p.Distance(z,u);u.addToRef(z,this.center).scaleInPlace(.5),this.radius=.5*H,this._update(Y||E.b.IdentityReadOnly)}scale(z){const u=this.radius*z,Y=J._TmpVector3,H=Y[0].Bl(u),E=this.center.subtractToRef(H,Y[1]),l=this.center.addToRef(H,Y[2]);return this.reConstruct(E,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){if(z.isIdentity())this.centerWorld.J(this.center),this.radiusWorld=this.radius;else{E.p.TransformCoordinatesToRef(this.center,z,this.centerWorld);const u=J._TmpVector3[0];E.p.TransformNormalFromFloatsToRef(1,1,1,z,u),this.radiusWorld=Math.max(Math.abs(u.x),Math.abs(u.y),Math.abs(u.z))*this.radius}}isInFrustum(z){const u=this.centerWorld,Y=this.radiusWorld;for(let H=0;H<6;H++)if(z[H].dotCoordinate(u)<=-Y)return!1;return!0}isCenterInFrustum(z){const u=this.centerWorld;for(let Y=0;Y<6;Y++)if(z[Y].dotCoordinate(u)<0)return!1;return!0}intersectsPoint(z){const u=E.p.DistanceSquared(this.centerWorld,z);return!(this.radiusWorld*this.radiusWorld<u)}static Intersects(z,u){const Y=E.p.DistanceSquared(z.centerWorld,u.centerWorld),H=z.radiusWorld+u.radiusWorld;return!(H*H<Y)}static CreateFromCenterAndRadius(z,u,Y){this._TmpVector3[0].J(z),this._TmpVector3[1].kl(0,0,u),this._TmpVector3[2].J(z),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].dg(this._TmpVector3[1]);const H=new J(this._TmpVector3[0],this._TmpVector3[2]);return H._worldMatrix=Y||E.b.Identity(),H}}J._TmpVector3=(0,H.b)(3,E.p.Zero)},11374:(z,u,Y)=>{Y(11018).e.prototype.createDepthStencilTexture=function(z,u,Y){if(u.isCube){const Y=z.width||z;return this._createDepthStencilCubeTexture(Y,u)}return this._createDepthStencilTexture(z,u,Y)}},11355:(z,u,Y)=>{Y(11333).ThinEngine.prototype.setAlphaMode=function(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==z){switch(z){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}u||(this.depthCullingState.depthMask=0===z),this._alphaMode=z}else if(!u){const u=0===z;this.depthCullingState.depthMask!==u&&(this.depthCullingState.depthMask=u)}}},11363:(z,u,Y)=>{var H=Y(11333);H.ThinEngine.prototype.updateDynamicIndexBuffer=function(z,u){let Y;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(z),Y=z.is32Bits?u instanceof Uint32Array?u:new Uint32Array(u):u instanceof Uint16Array?u:new Uint16Array(u),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,Y,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},H.ThinEngine.prototype.updateDynamicVertexBuffer=function(z,u,Y,H){this.bindArrayBuffer(z),void 0===Y&&(Y=0);const E=u.byteLength||u.length;void 0===H||H>=E&&0===Y?u instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Y,new Float32Array(u)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Y,u):u instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Y,new Float32Array(u).subarray(0,H/4)):(u=u instanceof ArrayBuffer?new Uint8Array(u,0,H):new Uint8Array(u.buffer,u.byteOffset,H),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Y,u)),this._resetVertexBufferBinding()}},11368:(z,u,Y)=>{var H=Y(11046),E=Y(10953),J=Y(11333),l=Y(11370),T=Y(11352);class b extends l.b{setDepthStencilTexture(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(z,u),!z)return;const Y=this._engine,H=this._context,E=z._hardwareTexture;if(E&&z._autoMSAAManagement&&this._MSAAFramebuffer){const u=Y._currentFramebuffer;Y._bindUnboundFramebuffer(this._MSAAFramebuffer),H.framebufferRenderbuffer(H.FRAMEBUFFER,(0,T.c)(z.format)?H.DEPTH_STENCIL_ATTACHMENT:H.DEPTH_ATTACHMENT,H.RENDERBUFFER,E.getMSAARenderBuffer()),Y._bindUnboundFramebuffer(u)}}constructor(z,u,Y,H,E){super(z,u,Y,H),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=E}_cloneRenderTargetWrapper(){let z=null;return this._colorTextureArray&&this._depthStencilTextureArray?(z=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),z.texture.isReady=!0):z=super._cloneRenderTargetWrapper(),z}_swapRenderTargetWrapper(z){super._swapRenderTargetWrapper(z),z._framebuffer=this._framebuffer,z._depthStencilBuffer=this._depthStencilBuffer,z._MSAAFramebuffer=this._MSAAFramebuffer,z._colorTextureArray=this._colorTextureArray,z._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,J=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const z=this._engine,u=z._currentFramebuffer,Y=this._context;z._bindUnboundFramebuffer(this._framebuffer),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_STENCIL_ATTACHMENT,Y.RENDERBUFFER,null),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,null),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.STENCIL_ATTACHMENT,Y.RENDERBUFFER,null),z._bindUnboundFramebuffer(u),Y.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(z,u,Y,H,E,J)}shareDepth(z){super.shareDepth(z);const u=this._context,Y=this._depthStencilBuffer,H=z._MSAAFramebuffer||z._framebuffer,E=this._engine;z._depthStencilBuffer&&z._depthStencilBuffer!==Y&&u.deleteRenderbuffer(z._depthStencilBuffer),z._depthStencilBuffer=Y;const J=z._generateStencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT;E._bindUnboundFramebuffer(H),u.framebufferRenderbuffer(u.FRAMEBUFFER,J,u.RENDERBUFFER,Y),E._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=z._hardwareTexture;if(!E)return;const J=this._framebuffer,l=this._engine,T=l._currentFramebuffer;let b;if(l._bindUnboundFramebuffer(J),l.webGLVersion>1){const J=this._context;var L;if(b=J["COLOR_ATTACHMENT"+u],z.is2DArray||z.is3D)Y=Y??(null===(L=this.layerIndices)||void 0===L?void 0:L[u])??0,J.framebufferTextureLayer(J.FRAMEBUFFER,b,E.underlyingResource,H,Y);else if(z.isCube){var D;Y=Y??(null===(D=this.faceIndices)||void 0===D?void 0:D[u])??0,J.framebufferTexture2D(J.FRAMEBUFFER,b,J.TEXTURE_CUBE_MAP_POSITIVE_X+Y,E.underlyingResource,H)}else J.framebufferTexture2D(J.FRAMEBUFFER,b,J.TEXTURE_2D,E.underlyingResource,H)}else{const z=this._context;b=z["COLOR_ATTACHMENT"+u+"_WEBGL"];const J=void 0!==Y?z.TEXTURE_CUBE_MAP_POSITIVE_X+Y:z.TEXTURE_2D;z.framebufferTexture2D(z.FRAMEBUFFER,b,J,E.underlyingResource,H)}if(z._autoMSAAManagement&&this._MSAAFramebuffer){const z=this._context;l._bindUnboundFramebuffer(this._MSAAFramebuffer),z.framebufferRenderbuffer(z.FRAMEBUFFER,b,z.RENDERBUFFER,E.getMSAARenderBuffer())}l._bindUnboundFramebuffer(T)}setTexture(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(z,u,Y),this._bindTextureRenderTarget(z,u)}setLayerAndFaceIndices(z,u){var Y;if(super.setLayerAndFaceIndices(z,u),!this.textures||!this.layerIndices||!this.faceIndices)return;const H=(null===(Y=this._attachments)||void 0===Y?void 0:Y.length)??this.textures.length;for(let E=0;E<H;E++){const z=this.textures[E];z&&(z.is2DArray||z.is3D?this._bindTextureRenderTarget(z,E,this.layerIndices[E]):z.isCube?this._bindTextureRenderTarget(z,E,this.faceIndices[E]):this._bindTextureRenderTarget(z,E))}}setLayerAndFaceIndex(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(z,u,Y),!this.textures||!this.layerIndices||!this.faceIndices)return;const H=this.textures[z];H.is2DArray||H.is3D?this._bindTextureRenderTarget(this.textures[z],z,this.layerIndices[z]):H.isCube&&this._bindTextureRenderTarget(this.textures[z],z,this.faceIndices[z])}resolveMSAATextures(){const z=this._engine,u=z._currentFramebuffer;z._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),z._bindUnboundFramebuffer(u)}dispose(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const u=this._context;z||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(u.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(u.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(u.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(z)}}Y(11374);J.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(z,u,Y){const H=new b(z,u,Y,this,this._gl);return this._renderTargetWrapperCache.push(H),H},J.ThinEngine.prototype.createRenderTargetTexture=function(z,u){const Y=this._createHardwareRenderTargetWrapper(!1,!1,z);let H,E,J=!0,l=!1,T=!1,b=1;void 0!==u&&"object"===typeof u&&(J=u.generateDepthBuffer??!0,l=!!u.generateStencilBuffer,T=!!u.noColorAttachment,H=u.colorAttachment,b=u.samples??1,E=u.label);const L=H||(T?null:this._createInternalTexture(z,u,!0,5)),D=z.width||z,g=z.height||z,M=this._currentFramebuffer,q=this._gl,C=q.createFramebuffer();if(this._bindUnboundFramebuffer(C),Y._depthStencilBuffer=this._setupFramebufferDepthAttachments(l,J,D,g),!L||L.is2DArray||L.is3D||q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,L._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(M),Y.label=E??"RenderTargetWrapper",Y._framebuffer=C,Y._generateDepthBuffer=J,Y._generateStencilBuffer=l,Y.setTextures(L),H){if(Y._samples=H.samples,H.samples>1){const z=H._hardwareTexture.getMSAARenderBuffer(0);Y._MSAAFramebuffer=q.createFramebuffer(),this._bindUnboundFramebuffer(Y._MSAAFramebuffer),q.framebufferRenderbuffer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.RENDERBUFFER,z),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(Y,b);return Y},J.ThinEngine.prototype._createDepthStencilTexture=function(z,u,Y){const J=this._gl,l=z.layers||0,b=z.depth||0;let L=J.TEXTURE_2D;0!==l?L=J.TEXTURE_2D_ARRAY:0!==b&&(L=J.TEXTURE_3D);const D=new H.d(this,12);if(D.label=u.label,!this._caps.depthTextureExtension)return E.b.Error("Depth texture is not supported by your browser or hardware."),D;const g={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...u};if(this._bindTextureDirectly(L,D,!0),this._setupDepthStencilTexture(D,z,0!==g.comparisonFunction&&g.bilinearFiltering,g.comparisonFunction,g.samples),void 0!==g.depthTextureFormat){if(15!==g.depthTextureFormat&&16!==g.depthTextureFormat&&17!==g.depthTextureFormat&&13!==g.depthTextureFormat&&14!==g.depthTextureFormat&&18!==g.depthTextureFormat)return E.b.Error(`Depth texture ${g.depthTextureFormat} format is not supported.`),D;D.format=g.depthTextureFormat}else D.format=g.generateStencil?13:16;const M=(0,T.c)(D.format),q=this._getWebGLTextureTypeFromDepthTextureFormat(D.format),C=M?J.DEPTH_STENCIL:J.DEPTH_COMPONENT,K=this._getInternalFormatFromDepthTextureFormat(D.format,!0,M);return D.is2DArray?J.texImage3D(L,0,K,D.width,D.height,l,0,C,q,null):D.is3D?J.texImage3D(L,0,K,D.width,D.height,b,0,C,q,null):J.texImage2D(L,0,K,D.width,D.height,0,C,q,null),this._bindTextureDirectly(L,null),this._internalTexturesCache.push(D),Y._depthStencilBuffer&&(J.deleteRenderbuffer(Y._depthStencilBuffer),Y._depthStencilBuffer=null),this._bindUnboundFramebuffer(Y._MSAAFramebuffer??Y._framebuffer),Y._generateStencilBuffer=M,Y._depthStencilTextureWithStencil=M,Y._depthStencilBuffer=this._setupFramebufferDepthAttachments(Y._generateStencilBuffer,Y._generateDepthBuffer,Y.width,Y.height,Y.samples,D.format),this._bindUnboundFramebuffer(null),D},J.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(z,u){var Y;if(this.webGLVersion<2||!z)return 1;if(z.samples===u)return u;const H=this._gl;u=Math.min(u,this.getCaps().maxMSAASamples),z._depthStencilBuffer&&(H.deleteRenderbuffer(z._depthStencilBuffer),z._depthStencilBuffer=null),z._MSAAFramebuffer&&(H.deleteFramebuffer(z._MSAAFramebuffer),z._MSAAFramebuffer=null);const E=null===(Y=z.texture)||void 0===Y?void 0:Y._hardwareTexture;if(null===E||void 0===E||E.releaseMSAARenderBuffers(),z.texture&&u>1&&"function"===typeof H.renderbufferStorageMultisample){const Y=H.createFramebuffer();if(!Y)throw new Error("Unable to create multi sampled framebuffer");z._MSAAFramebuffer=Y,this._bindUnboundFramebuffer(z._MSAAFramebuffer);const J=this._createRenderBuffer(z.texture.width,z.texture.height,u,-1,this._getRGBABufferInternalSizedFormat(z.texture.type,z.texture.format,z.texture._useSRGBBuffer),H.COLOR_ATTACHMENT0,!1);if(!J)throw new Error("Unable to create multi sampled framebuffer");null===E||void 0===E||E.addMSAARenderBuffer(J)}this._bindUnboundFramebuffer(z._MSAAFramebuffer??z._framebuffer),z.texture&&(z.texture.samples=u),z._samples=u;const J=z._depthStencilTexture?z._depthStencilTexture.format:void 0;return z._depthStencilBuffer=this._setupFramebufferDepthAttachments(z._generateStencilBuffer,z._generateDepthBuffer,z.width,z.height,u,J),this._bindUnboundFramebuffer(null),u},J.ThinEngine.prototype._setupDepthStencilTexture=function(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const J=u.width??u,l=u.height??u,T=u.layers||0,b=u.depth||0;z.baseWidth=J,z.baseHeight=l,z.width=J,z.height=l,z.is2DArray=T>0,z.depth=T||b,z.isReady=!0,z.samples=E,z.generateMipMaps=!1,z.samplingMode=Y?2:1,z.type=0,z._comparisonFunction=H;const L=this._gl,D=this._getTextureTarget(z),g=this._getSamplingParameters(z.samplingMode,!1);L.texParameteri(D,L.TEXTURE_MAG_FILTER,g.mag),L.texParameteri(D,L.TEXTURE_MIN_FILTER,g.min),L.texParameteri(D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===H?(L.texParameteri(D,L.TEXTURE_COMPARE_FUNC,515),L.texParameteri(D,L.TEXTURE_COMPARE_MODE,L.NONE)):(L.texParameteri(D,L.TEXTURE_COMPARE_FUNC,H),L.texParameteri(D,L.TEXTURE_COMPARE_MODE,L.COMPARE_REF_TO_TEXTURE)))}},10996:(z,u,Y)=>{Y.d(u,{c:()=>i,d:()=>s,f:()=>v,e:()=>F,g:()=>R});class H{constructor(){this.children=[]}isValid(z){return!0}process(z,u,Y){let H="";if(this.line){let Y=this.line;const D=u.processor;if(D){var E,J,l,T,b,L;D.lineProcessor&&(Y=D.lineProcessor(Y,u.isFragment,u.processingContext));const H=(null===(E=u.processor)||void 0===E?void 0:E.attributeKeywordName)??"attribute",g=u.isFragment&&null!==(J=u.processor)&&void 0!==J&&J.varyingFragmentKeywordName?null===(l=u.processor)||void 0===l?void 0:l.varyingFragmentKeywordName:!u.isFragment&&null!==(T=u.processor)&&void 0!==T&&T.varyingVertexKeywordName?null===(b=u.processor)||void 0===b?void 0:b.varyingVertexKeywordName:"varying";if(!u.isFragment&&D.attributeProcessor&&this.line.startsWith(H))Y=D.attributeProcessor(this.line,z,u.processingContext);else if(D.varyingProcessor&&(null!==(L=D.varyingCheck)&&void 0!==L&&L.call(D,this.line,u.isFragment)||!D.varyingCheck&&this.line.startsWith(g)))Y=D.varyingProcessor(this.line,u.isFragment,z,u.processingContext);else if(D.uniformProcessor&&D.uniformRegexp&&D.uniformRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(Y=D.uniformProcessor(this.line,u.isFragment,z,u.processingContext));else if(D.uniformBufferProcessor&&D.uniformBufferRegexp&&D.uniformBufferRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(Y=D.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0);else if(D.textureProcessor&&D.textureRegexp&&D.textureRegexp.test(this.line))Y=D.textureProcessor(this.line,u.isFragment,z,u.processingContext);else if((D.uniformProcessor||D.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!u.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?D.uniformProcessor&&(Y=D.uniformProcessor(this.line,u.isFragment,z,u.processingContext)):D.uniformBufferProcessor&&(Y=D.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0)}u.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(u.lookForClosingBracketForUniformBuffer=!1,D.endOfUniformBufferProcessor&&(Y=D.endOfUniformBufferProcessor(this.line,u.isFragment,u.processingContext)))}H+=Y+"\n"}for(const D of this.children)H+=D.process(z,u,Y);return this.additionalDefineKey&&(z[this.additionalDefineKey]=this.additionalDefineValue||"true",Y[this.additionalDefineKey]=z[this.additionalDefineKey]),H}}class E{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(z){this._lines.length=0;for(const u of z){if(!u||"\r"===u)continue;if("#"===u[0]){this._lines.push(u);continue}const z=u.trim();if(!z)continue;if(z.startsWith("//")){this._lines.push(u);continue}const Y=z.indexOf(";");if(-1===Y)this._lines.push(z);else if(Y===z.length-1)z.length>1&&this._lines.push(z);else{const z=u.split(";");for(let u=0;u<z.length;u++){let Y=z[u];Y&&(Y=Y.trim(),Y&&this._lines.push(Y+(u!==z.length-1?";":"")))}}}}}class J extends H{process(z,u,Y){for(let H=0;H<this.children.length;H++){const E=this.children[H];if(E.isValid(z))return E.process(z,u,Y)}return""}}class l extends H{isValid(z){return this.testExpression.isTrue(z)}}class T{isTrue(z){return!0}static postfixToInfix(z){const u=[];for(const Y of z)if(void 0===T._OperatorPriority[Y])u.push(Y);else{const z=u[u.length-1],H=u[u.length-2];u.length-=2,u.push(`(${H}${Y}${z})`)}return u[u.length-1]}static infixToPostfix(z){const u=T._InfixToPostfixCache.get(z);if(u)return u.accessTime=Date.now(),u.result;if(!z.includes("&&")&&!z.includes("||")&&!z.includes(")")&&!z.includes("("))return[z];const Y=[];let H=-1;const E=()=>{D=D.trim(),""!==D&&(Y.push(D),D="")},J=z=>{H<T._Stack.length-1&&(T._Stack[++H]=z)},l=()=>T._Stack[H],b=()=>-1===H?"!!INVALID EXPRESSION!!":T._Stack[H--];let L=0,D="";for(;L<z.length;){const u=z.charAt(L),g=L<z.length-1?z.substring(L,2+L):"";if("("===u)D="",J(u);else if(")"===u){for(E();-1!==H&&"("!==l();)Y.push(b());b()}else if(T._OperatorPriority[g]>1){for(E();-1!==H&&T._OperatorPriority[l()]>=T._OperatorPriority[g];)Y.push(b());J(g),L++}else D+=u;L++}for(E();-1!==H;)"("===l()?b():Y.push(b());return T._InfixToPostfixCache.size>=T.InfixToPostfixCacheLimitSize&&T.ClearCache(),T._InfixToPostfixCache.set(z,{result:Y,accessTime:Date.now()}),Y}static ClearCache(){const z=Array.from(T._InfixToPostfixCache.entries()).sort(((z,u)=>z[1].accessTime-u[1].accessTime));for(let u=0;u<T.InfixToPostfixCacheCleanupSize;u++)T._InfixToPostfixCache.delete(z[u][0])}}T.InfixToPostfixCacheLimitSize=5e4,T.InfixToPostfixCacheCleanupSize=25e3,T._InfixToPostfixCache=new Map,T._OperatorPriority={")":0,"(":1,"||":2,"&&":3},T._Stack=["","","","","","","","","","","","","","","","","","","",""];class b extends T{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=z,this.not=u}isTrue(z){let u=void 0!==z[this.define];return this.not&&(u=!u),u}}class L extends T{isTrue(z){return this.leftOperand.isTrue(z)||this.rightOperand.isTrue(z)}}class D extends T{isTrue(z){return this.leftOperand.isTrue(z)&&this.rightOperand.isTrue(z)}}class g extends T{constructor(z,u,Y){super(),this.define=z,this.operand=u,this.testValue=Y}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(z){let u=!1;const Y=parseInt(void 0!=z[this.define]?z[this.define]:this.define),H=parseInt(void 0!=z[this.testValue]?z[this.testValue]:this.testValue);if(isNaN(Y)||isNaN(H))return!1;switch(this.operand){case">":u=Y>H;break;case"<":u=Y<H;break;case"<=":u=Y<=H;break;case">=":u=Y>=H;break;case"==":u=Y===H;break;case"!=":u=Y!==H}return u}}var M=Y(10970),q=Y(11002);const C=/defined\s*?\((.+?)\)/g,K=/defined\s*?\[(.+?)\]/g,h=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=/__decl__/,d=/light\{X\}.(\w*)/g,t=/\{X\}/g,W=[],Z=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function s(z){z.processor&&z.processor.initializeShaders&&z.processor.initializeShaders(z.processingContext)}function v(z,u,Y,H){var E;null!==(E=u.processor)&&void 0!==E&&E.preProcessShaderCode&&(z=u.processor.preProcessShaderCode(z,u.isFragment)),F(z,u,(z=>{u.processCodeAfterIncludes&&(z=u.processCodeAfterIncludes(u.isFragment?"fragment":"vertex",z,u.defines));const E=function(z,u,Y){let H=function(z,u){var Y;if(null!==(Y=u.processor)&&void 0!==Y&&Y.noPrecision)return z;const H=u.shouldUseHighPrecisionShader;-1===z.indexOf("precision highp float")?z=H?"precision highp float;\n"+z:"precision mediump float;\n"+z:H||(z=z.replace("precision highp float","precision mediump float"));return z}(z,u);if(!u.processor)return H;if(0===u.processor.shaderLanguage&&-1!==H.indexOf("#version 3")&&(H=H.replace("#version 300 es",""),!u.processor.parseGLES3))return H;const E=u.defines,J=G(u,Y);u.processor.preProcessor&&(H=u.processor.preProcessor(H,E,J,u.isFragment,u.processingContext));const l={};H=x(H,J,u,l),u.processor.postProcessor&&(H=u.processor.postProcessor(H,E,u.isFragment,u.processingContext,Y?{drawBuffersExtensionDisabled:!Y.getCaps().drawBuffersExtension}:{},J,l));null!==Y&&void 0!==Y&&Y._features.needShaderCodeInlining&&(H=Y.inlineShaderCode(H));return H}(z,u,H);Y(E,z)}))}function i(z,u,Y){return Y.processor&&Y.processor.finalizeShaders?Y.processor.finalizeShaders(z,u,Y.processingContext):{vertexCode:z,fragmentCode:u}}function X(z){const u=/defined\((.+)\)/.exec(z);if(u&&u.length)return new b(u[1].trim(),"!"===z[0]);const Y=["==","!=",">=","<=","<",">"];let H="",E=0;for(H of Y)if(E=z.indexOf(H),E>-1)break;if(-1===E)return new b(z);const J=z.substring(0,E).trim(),l=z.substring(E+H.length).trim();return new g(J,H,l)}function Q(z,u){const Y=new l,H=z.substring(0,u);let E=z.substring(u);return E=E.substring(0,(E.indexOf("//")+1||E.length+1)-1).trim(),Y.testExpression="#ifdef"===H?new b(E):"#ifndef"===H?new b(E,!0):function(z){z=z.replace(C,"defined[$1]");const u=T.infixToPostfix(z),Y=[];for(const E of u)if("||"!==E&&"&&"!==E)Y.push(E);else if(Y.length>=2){let z=Y[Y.length-1],u=Y[Y.length-2];Y.length-=2;const H="&&"==E?new D:new L;"string"===typeof z&&(z=z.replace(K,"defined($1)")),"string"===typeof u&&(u=u.replace(K,"defined($1)")),H.leftOperand="string"===typeof u?X(u):u,H.rightOperand="string"===typeof z?X(z):z,Y.push(H)}let H=Y[Y.length-1];return"string"===typeof H&&(H=H.replace(K,"defined($1)")),"string"===typeof H?X(H):H}(E),Y}function V(z,u,Y,E){let J=z.currentLine;for(;A(z,Y,E);){J=z.currentLine;const l=J.substring(0,5).toLowerCase();if("#else"===l){const Y=new H;return u.children.push(Y),void A(z,Y,E)}if("#elif"===l){const z=Q(J,5);u.children.push(z),Y=z}}}function A(z,u,Y){for(;z.canRead;){z.lineIndex++;const E=z.currentLine;if(E.indexOf("#")>=0){const H=Z.exec(E);if(H&&H.length){switch(H[0]){case"#ifdef":{const H=new J;u.children.push(H);const l=Q(E,6);H.children.push(l),V(z,H,l,Y);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const H=new J;u.children.push(H);const l=Q(E,7);H.children.push(l),V(z,H,l,Y);break}case"#if":{const H=new J,l=Q(E,3);u.children.push(H),H.children.push(l),V(z,H,l,Y);break}}continue}}const l=new H;if(l.line=E,u.children.push(l),"#"===E[0]&&"d"===E[1]){const z=E.replace(";","").split(" ");l.additionalDefineKey=z[1],3===z.length&&(l.additionalDefineValue=z[2])}}return!1}function x(z,u,Y,J){const l=new H,T=new E;return T.lineIndex=-1,T.lines=z.split("\n"),A(T,l,J),l.process(u,Y,J)}function G(z,u){var Y;const H=z.defines,E={};for(const J of H){const z=J.replace("#define","").replace(";","").trim().split(" ");E[z[0]]=z.length>1?z[1]:""}return 0===(null===(Y=z.processor)||void 0===Y?void 0:Y.shaderLanguage)&&(E.GL_ES="true"),E.__VERSION__=z.version,E[z.platformName]="true",(0,q.j)(E,null===u||void 0===u?void 0:u.isNDCHalfZRange,null===u||void 0===u?void 0:u.useReverseDepthBuffer,null===u||void 0===u?void 0:u.useExactSrgbConversions),E}function F(z,u,Y){let H;for(W.length=0;null!==(H=h.exec(z));)W.push(H);let E=String(z),J=[z],l=!1;for(const T of W){let z=T[1];if(-1!==z.indexOf("__decl__")&&(z=z.replace(o,""),u.supportsUniformBuffers&&(z=z.replace("Vertex","Ubo").replace("Fragment","Ubo")),z+="Declaration"),!u.includesShadersStore[z]){const H=u.shadersRepository+"ShadersInclude/"+z+".fx";return void R.loadFile(H,(H=>{u.includesShadersStore[z]=H,F(J.join(""),u,Y)}))}{let Y=u.includesShadersStore[z];if(T[2]){const z=T[3].split(",");for(let u=0;u<z.length;u+=2){const H=new RegExp(z[u],"g"),E=z[u+1];Y=Y.replace(H,E)}}if(T[4]){const z=T[5];if(-1!==z.indexOf("..")){const H=z.split(".."),E=parseInt(H[0]);let J=parseInt(H[1]),l=Y.slice(0);Y="",isNaN(J)&&(J=u.indexParameters[H[1]]);for(let z=E;z<J;z++)u.supportsUniformBuffers||(l=l.replace(d,((z,u)=>u+"{X}"))),Y+=l.replace(t,z.toString())+"\n"}else u.supportsUniformBuffers||(Y=Y.replace(d,((z,u)=>u+"{X}"))),Y=Y.replace(t,z)}const H=[];for(const z of J){const u=z.split(T[0]);for(let z=0;z<u.length-1;z++)H.push(u[z]),H.push(Y);H.push(u[u.length-1])}J=H,l=l||Y.indexOf("#include<")>=0||Y.indexOf("#include <")>=0}}W.length=0,E=J.join(""),l?F(E.toString(),u,Y):Y(E)}const R={loadFile:(z,u,Y,H,E,J)=>{throw(0,M.e)("FileTools")}}},11349:(z,u,Y)=>{Y.d(u,{e:()=>H});class H{get underlyingResource(){return this._webGLTexture}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=u,!z&&(z=u.createTexture(),!z))throw new Error("Unable to create webGL texture");this.set(z)}setUsage(){}set(z){this._webGLTexture=z}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(z){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(z)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const z of this._MSAARenderBuffers)this._context.deleteRenderbuffer(z);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._MSAARenderBuffers)||void 0===z?void 0:z[u])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11002:(z,u,Y)=>{Y.d(u,{e:()=>E,g:()=>J,j:()=>T,n:()=>l,p:()=>b});var H=Y(10970);Y(10948);const E={};function J(z,u){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(u?u+"\n":"")+z}function l(z,u,Y,J,l,T,b){const L=b||E.loadFile;if(L){return L(z,u,Y,J,l,T)}throw(0,H.e)("FileTools")}function T(z,u,Y,H){if(z)return u?z.IS_NDC_HALF_ZRANGE="":delete z.IS_NDC_HALF_ZRANGE,Y?z.USE_REVERSE_DEPTHBUFFER="":delete z.USE_REVERSE_DEPTHBUFFER,void(H?z.USE_EXACT_SRGB_CONVERSIONS="":delete z.USE_EXACT_SRGB_CONVERSIONS);{let z="";return u&&(z+="#define IS_NDC_HALF_ZRANGE"),Y&&(z&&(z+="\n"),z+="#define USE_REVERSE_DEPTHBUFFER"),H&&(z&&(z+="\n"),z+="#define USE_EXACT_SRGB_CONVERSIONS"),z}}function b(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;switch(z){case 3:{const z=(ArrayBuffer,new Int8Array(u));return H&&z.set(new Int8Array(H)),z}case 0:{const z=(ArrayBuffer,new Uint8Array(u));return H&&z.set(new Uint8Array(H)),z}case 4:{const z=u instanceof ArrayBuffer?new Int16Array(u):new Int16Array(Y?u/2:u);return H&&z.set(new Int16Array(H)),z}case 5:case 8:case 9:case 10:case 2:{const z=u instanceof ArrayBuffer?new Uint16Array(u):new Uint16Array(Y?u/2:u);return H&&z.set(new Uint16Array(H)),z}case 6:{const z=u instanceof ArrayBuffer?new Int32Array(u):new Int32Array(Y?u/4:u);return H&&z.set(new Int32Array(H)),z}case 7:case 11:case 12:case 13:case 14:case 15:{const z=u instanceof ArrayBuffer?new Uint32Array(u):new Uint32Array(Y?u/4:u);return H&&z.set(new Uint32Array(H)),z}case 1:{const z=u instanceof ArrayBuffer?new Float32Array(u):new Float32Array(Y?u/4:u);return H&&z.set(new Float32Array(H)),z}}const E=(ArrayBuffer,new Uint8Array(u));return H&&E.set(new Uint8Array(H)),E}},11018:(z,u,Y)=>{Y.d(u,{e:()=>t});var H=Y(10928),E=Y(10953),J=Y(11024),l=Y(10920),T=Y(10962);class b{constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,z&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(z){this._zOffset!==z&&(this._zOffset=z,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(z){this._zOffsetUnits!==z&&(this._zOffsetUnits=z,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(z){this._cullFace!==z&&(this._cullFace=z,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(z){this._cull!==z&&(this._cull=z,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(z){this._depthFunc!==z&&(this._depthFunc=z,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(z){this._depthMask!==z&&(this._depthMask=z,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(z){this._depthTest!==z&&(this._depthTest=z,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(z){this._frontFace!==z&&(this._frontFace=z,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(z){this.isDirty&&(this._isCullDirty&&(this.cull?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(z.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(z.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(z.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(z.enable(z.POLYGON_OFFSET_FILL),z.polygonOffset(this.zOffset,this.zOffsetUnits)):z.disable(z.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(z.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class L{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(z){this._func!==z&&(this._func=z,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(z){this._funcRef!==z&&(this._funcRef=z,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(z){this._funcMask!==z&&(this._funcMask=z,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(z){this._opStencilFail!==z&&(this._opStencilFail=z,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(z){this._opDepthFail!==z&&(this._opDepthFail=z,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(z){this._opStencilDepthPass!==z&&(this._opStencilDepthPass=z,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(z){this._mask!==z&&(this._mask=z,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(z){this._enabled!==z&&(this._enabled=z,this._isStencilTestDirty=!0)}constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,z&&this.reset()}reset(){var z;this.stencilMaterial=void 0,null===(z=this.stencilGlobal)||void 0===z||z.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(z){var u;if(!z)return;const Y=!this.useStencilGlobalOnly&&!(null===(u=this.stencilMaterial)||void 0===u||!u.enabled);this.enabled=Y?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=Y?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=Y?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=Y?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=Y?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=Y?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=Y?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=Y?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?z.enable(z.STENCIL_TEST):z.disable(z.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(z.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(z.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(z.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class D{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=D.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=D.KEEP,this.opDepthFail=D.KEEP,this.opStencilDepthPass=D.REPLACE}get stencilFunc(){return this.func}set stencilFunc(z){this.func=z}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(z){this.funcRef=z}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(z){this.funcMask=z}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(z){this.opStencilFail=z}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(z){this.opDepthFail=z}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(z){this.opStencilDepthPass=z}get stencilMask(){return this.mask}set stencilMask(z){this.mask=z}get stencilTest(){return this.enabled}set stencilTest(z){this.enabled=z}}D.ALWAYS=519,D.KEEP=7680,D.REPLACE=7681;class g{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(z){this._alphaBlend!==z&&(this._alphaBlend=z,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(z,u,Y,H){this._blendConstants[0]===z&&this._blendConstants[1]===u&&this._blendConstants[2]===Y&&this._blendConstants[3]===H||(this._blendConstants[0]=z,this._blendConstants[1]=u,this._blendConstants[2]=Y,this._blendConstants[3]=H,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(z,u,Y,H){this._blendFunctionParameters[0]===z&&this._blendFunctionParameters[1]===u&&this._blendFunctionParameters[2]===Y&&this._blendFunctionParameters[3]===H||(this._blendFunctionParameters[0]=z,this._blendFunctionParameters[1]=u,this._blendFunctionParameters[2]=Y,this._blendFunctionParameters[3]=H,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(z,u){this._blendEquationParameters[0]===z&&this._blendEquationParameters[1]===u||(this._blendEquationParameters[0]=z,this._blendEquationParameters[1]=u,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(z){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?z.enable(z.BLEND):z.disable(z.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(z.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(z.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(z.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var M=Y(10970),q=Y(11046),C=Y(10948),K=Y(10932),h=Y(11002),o=Y(11058);function d(z,u){if((0,C.h)()){const{requestAnimationFrame:Y}=u||window;if("function"===typeof Y)return Y(z)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(z);return setTimeout(z,16)}class t{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(z){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(z){z!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=z,this._depthCullingState.depthFunc=z?518:515)}setColorWrite(z){z!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=z)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(z){if(z)return this.isNDCHalfZRange?z.IS_NDC_HALF_ZRANGE="":delete z.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?z.USE_REVERSE_DEPTHBUFFER="":delete z.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?z.USE_EXACT_SRGB_CONVERSIONS="":delete z.USE_EXACT_SRGB_CONVERSIONS);{let z="";return this.isNDCHalfZRange&&(z+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(z&&(z+="\n"),z+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(z&&(z+="\n"),z+="#define USE_EXACT_SRGB_CONVERSIONS"),z}}_rebuildInternalTextures(){const z=this._internalTexturesCache.slice();for(const u of z)u._rebuild()}_rebuildRenderTargetWrappers(){const z=this._renderTargetWrapperCache.slice();for(const u of z)u._rebuild()}_rebuildEffects(){for(const z in this._compiledEffects){const u=this._compiledEffects[z];u._pipelineContext=null,u._prepareEffect()}J.d.ResetCache()}_rebuildGraphicsResources(){var z;this.wipeCaches(!0),this._rebuildEffects(),null===(z=this._rebuildComputeEffects)||void 0===z||z.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){E.b.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(z){setTimeout((()=>{this._clearEmptyResources();const u=this._depthCullingState.depthTest,Y=this._depthCullingState.depthFunc,H=this._depthCullingState.depthMask,E=this._stencilState.stencilTest;z(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=u,this._depthCullingState.depthFunc=Y,this._depthCullingState.depthMask=H,this._stencilState.stencilTest=E,this._flagContextRestored()}),0)}get L(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(z){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(z){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const z=new Uint8Array(4),u=[z,z,z,z,z,z];this._emptyCubeTexture=this.createRawCubeTexture(u,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(z){if(!z)return this._activeRenderLoops.length=0,void this._cancelFrame();const u=this._activeRenderLoops.indexOf(z);u>=0&&(this._activeRenderLoops.splice(u,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const z=this._frameHandler;if(this._frameHandler=0,(0,C.h)()){const{cancelAnimationFrame:u}=this.getHostWindow()||window;if("function"===typeof u)return u(z)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(z);return clearTimeout(z)}}hM(){this.onBeginFrameObservable.notifyObservers(this)}oM(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(z){this._maxFPS=z,void 0!==z&&(this._minFrameTime=z<=0?Number.MAX_VALUE:1e3/z)}_isOverFrameTime(z){if(!z||void 0===this._maxFPS)return!1;const u=z-this._lastFrameTime;return this._lastFrameTime=z,this._renderAccumulator+=u,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(z){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(z)){let z=!0;(this.L||!this.renderEvenInBackground&&this._windowIsBackground)&&(z=!1),z&&(this.hM(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.oM())}}_renderLoop(z){this._processFrame(z),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let z=0;z<this._activeRenderLoops.length;z++){(0,this._activeRenderLoops[z])()}}_renderViews(){return!1}_queueNewFrame(z,u){return d(z,u)}runRenderLoop(z){-1===this._activeRenderLoops.indexOf(z)&&(this._activeRenderLoops.push(z),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(z){this._depthCullingState.depthTest=z}setZOffset(z){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-z:z}getZOffset(){const z=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-z:z}setZOffsetUnits(z){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-z:z}getZOffsetUnits(){const z=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-z:z}getHostWindow(){return(0,C.h)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(z){this._compatibilityMode=!0}_rebuildTextures(){for(const z of this.scenes)z._rebuildTextures();for(const z of this._virtualScenes)z._rebuildTextures()}_releaseRenderTargetWrapper(z){const u=this._renderTargetWrapperCache.indexOf(z);-1!==u&&this._renderTargetWrapperCache.splice(u,1)}get currentViewport(){return this._cachedViewport}setViewport(z,u,Y){const H=u||this.getRenderWidth(),E=Y||this.getRenderHeight(),J=z.x||0,l=z.y||0;this._cachedViewport=z,this._viewport(J*H,l*E,H*z.width,E*z.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(z){return new Path2D(z)}get description(){let z=this.name+this.version;return this._caps.parallelShaderCompile&&(z+=" - Parallel shader compilation"),z}_createTextureBase(z,u,Y,J){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0,W=arguments.length>15?arguments[15]:void 0;const Z="data:"===(z=z||"").substring(0,5),s="blob:"===z.substring(0,5),v=Z&&-1!==z.indexOf(";base64,"),i=M||new q.d(this,1);i!==M&&(i.label=z.substring(0,60));const X=z;!this._transformTextureUrl||v||M||g||(z=this._transformTextureUrl(z)),X!==z&&(i._originalUrl=X);const Q=z.lastIndexOf(".");let V=K||(Q>-1?z.substring(Q).toLowerCase():"");V.indexOf("?")>-1&&(V=V.split("?")[0]);const A=(0,o.d)(V,h);J&&J.addPendingData(i),i.url=z,i.generateMipMaps=!u,i.samplingMode=l,i.invertY=Y,i._useSRGBBuffer=this._getUseSRGBBuffer(!!W,u),this._doNotHandleContextLost||(i._buffer=g);let x=null;T&&!M&&(x=i.onLoadedObservable.add(T)),M||this._internalTexturesCache.push(i);const G=(Y,M)=>{J&&J.removePendingData(i),z===X?(x&&i.onLoadedObservable.remove(x),H.d.UseFallbackTexture&&z!==H.d.FallbackTexture&&this._createTextureBase(H.d.FallbackTexture,u,i.invertY,J,l,null,b,L,D,g,i),Y=(Y||"Unknown error")+(H.d.UseFallbackTexture?" - Fallback texture was used":""),i.onErrorObservable.notifyObservers({message:Y,exception:M}),b&&b(Y,M)):(E.b.Warn(`Failed to load ${z}, falling back to ${X}`),this._createTextureBase(X,u,i.invertY,J,l,T,b,L,D,g,i,C,K,h,d,W))};if(A){const u=async z=>{(await A).loadData(z,i,((z,u,Y,H,E,T)=>{T?G("TextureLoader failed to load data"):L(i,V,J,{width:z,height:u},i.invertY,!Y,H,(()=>(E(),!1)),l)}),d)};g?g instanceof ArrayBuffer?u(new Uint8Array(g)):ArrayBuffer.isView(g)?u(g):b&&b("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(z,(z=>{u(new Uint8Array(z))}),void 0,J?J.offlineProvider:void 0,!0,((z,u)=>{G("Unable to load "+(z&&z.responseURL,u))}))}else{const Y=z=>{s&&!this._doNotHandleContextLost&&(i._buffer=z),L(i,V,J,z,i.invertY,u,!1,D,l)};!Z||v?g&&("string"===typeof g.decoding||g.close)?Y(g):t._FileToolsLoadImage(z||"",Y,G,J?J.offlineProvider:null,h,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof g||g instanceof ArrayBuffer||ArrayBuffer.isView(g)||g instanceof Blob?t._FileToolsLoadImage(g,Y,G,J?J.offlineProvider:null,h,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):g&&Y(g)}return i}_rebuildBuffers(){for(const z of this._uniformBuffers)z._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,C.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const z in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,z)&&(this._boundTexturesCache[z]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(z){this._name=z}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(z){this._hardwareScalingLevel=z,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(z){this._doNotHandleContextLost=z}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(z,u,Y){var E,J;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new b,this._stencilStateComposer=new L,this._stencilState=new D,this._alphaState=new g,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new K.e,this.onCanvasFocusObservable=new K.e,this.onNewSceneAddedObservable=new K.e,this.onResizeObservable=new K.e,this.onCanvasPointerOutObservable=new K.e,this.onEffectErrorObservable=new K.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new K.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=z=>this._renderLoop(z),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new K.e,this.onAfterShaderCompilationObservable=new K.e,this.onBeginFrameObservable=new K.e,this.onEndFrameObservable=new K.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new K.e,this.onContextRestoredObservable=new K.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.fl=new K.e,this.onReleaseEffectsObservable=new K.e,H.d.Instances.push(this),this.startTime=T.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,l.b.SetMatrixPrecision(!!u.useHighPrecisionMatrix),(0,C.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=Y??!1,u.antialias=z??u.antialias,u.deterministicLockstep=u.deterministicLockstep??!1,u.lockstepMaxSteps=u.lockstepMaxSteps??4,u.timeStep=u.timeStep??1/60,u.stencil=u.stencil??!0,this._audioContext=(null===(E=u.audioEngineOptions)||void 0===E?void 0:E.audioContext)??null,this._audioDestination=(null===(J=u.audioEngineOptions)||void 0===J?void 0:J.audioDestination)??null,this.premultipliedAlpha=u.premultipliedAlpha??!0,this._doNotHandleContextLost=!!u.doNotHandleContextLost,this._isStencilEnable=!!u.stencil,this.useExactSrgbConversions=u.useExactSrgbConversions??!1;const M=(0,C.h)()&&window.devicePixelRatio||1,q=u.limitDeviceRatio||M;Y=Y||u.adaptToDeviceRatio||!1,this._hardwareScalingLevel=Y?1/Math.min(q,M):1,this._lastDevicePixelRatio=M,this._creationOptions=u}resize(){let z,u,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const z=(0,C.h)()&&window.devicePixelRatio||1,u=this._lastDevicePixelRatio/z;this._lastDevicePixelRatio=z,this._hardwareScalingLevel*=u}if((0,C.h)()&&(0,C.f)())if(this._renderingCanvas){var H,E;const Y=null===(H=(E=this._renderingCanvas).getBoundingClientRect)||void 0===H?void 0:H.call(E);z=this._renderingCanvas.clientWidth||(null===Y||void 0===Y?void 0:Y.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,u=this._renderingCanvas.clientHeight||(null===Y||void 0===Y?void 0:Y.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else z=window.innerWidth,u=window.innerHeight;else z=this._renderingCanvas?this._renderingCanvas.width:100,u=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(z/this._hardwareScalingLevel,u/this._hardwareScalingLevel,Y)}setSize(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(z|=0,u|=0,!Y&&this._renderingCanvas.width===z&&this._renderingCanvas.height===u)return!1;if(this._renderingCanvas.width=z,this._renderingCanvas.height=u,this.scenes){for(let z=0;z<this.scenes.length;z++){const u=this.scenes[z];for(let z=0;z<u.cameras.length;z++){u.cameras[z]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(z,u,Y,H,E,J,l,T,b,L,D){throw(0,M.e)("engine.rawTexture")}createRawCubeTexture(z,u,Y,H,E,J,l,T){throw(0,M.e)("engine.rawTexture")}createRawTexture3D(z,u,Y,H,E,J,l,T,b,L,D){throw(0,M.e)("engine.rawTexture")}createRawTexture2DArray(z,u,Y,H,E,J,l,T,b,L,D){throw(0,M.e)("engine.rawTexture")}_sharedInit(z){this._renderingCanvas=z}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const z=navigator.userAgent;this.hostInformation.isMobile=-1!==z.indexOf("Mobile")||-1!==z.indexOf("Mac")&&(0,C.f)()&&"ontouchend"in document},this._checkForMobile(),(0,C.h)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(z){return document.createElement("video")}_reportDrawCall(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(z=this._drawCalls)||void 0===z||z.addCount(u,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(z,u){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(z,u){return createImageBitmap(z,u)}resizeImageBitmap(z,u,Y){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(z){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(z,u){if("undefined"===typeof document)return new OffscreenCanvas(z,u);const Y=document.createElement("canvas");return Y.width=z,Y.height=u,Y}createCanvas(z,u){return t._CreateCanvas(z,u)}static _FileToolsLoadImage(z,u,Y,H,E,J,l){throw(0,M.e)("FileTools")}_loadFile(z,u,Y,H,E,J){const l=(0,h.n)(z,u,Y,H,E,J);return this._activeRequests.push(l),l.onCompleteObservable.add((()=>{const z=this._activeRequests.indexOf(l);-1!==z&&this._activeRequests.splice(z,1)})),l}static _FileToolsLoadFile(z,u,Y,H,E,J){if(h.e.loadFile)return h.e.loadFile(z,u,Y,H,E,J);throw(0,M.e)("FileTools")}dispose(){var z;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(z=this.releaseComputeEffects)||void 0===z||z.call(this),J.d.ResetCache();for(const Y of this._activeRequests)Y.abort();this._boundRenderFunction=null,this.fl.notifyObservers(this),this.fl.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,C.h)()&&window.removeEventListener("resize",this._checkForMobile);const u=H.d.Instances.indexOf(this);u>=0&&H.d.Instances.splice(u,1),H.d.Instances.length||(H.d.OnEnginesDisposedObservable.notifyObservers(this),H.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(z){throw(0,M.e)("LoadingScreen")}static MarkAllMaterialsAsDirty(z,u){for(let Y=0;Y<H.d.Instances.length;Y++){const E=H.d.Instances[Y];for(let Y=0;Y<E.scenes.length;Y++)E.scenes[Y].markAllMaterialsAsDirty(z,u)}}}t._RenderPassIdCounter=0,t._RescalePostProcessFactory=null,t.CollisionsEpsilon=.001,t.QueueNewFrame=d},11464:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{}H.AUTOSAMPLERSUFFIX="Sampler",H.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",H.ALPHA_DISABLE=0,H.ALPHA_ADD=1,H.ALPHA_COMBINE=2,H.ALPHA_SUBTRACT=3,H.ALPHA_MULTIPLY=4,H.ALPHA_MAXIMIZED=5,H.ALPHA_ONEONE=6,H.ALPHA_PREMULTIPLIED=7,H.ALPHA_PREMULTIPLIED_PORTERDUFF=8,H.ALPHA_INTERPOLATE=9,H.ALPHA_SCREENMODE=10,H.ALPHA_ONEONE_ONEONE=11,H.ALPHA_ALPHATOCOLOR=12,H.ALPHA_REVERSEONEMINUS=13,H.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,H.ALPHA_ONEONE_ONEZERO=15,H.ALPHA_EXCLUSION=16,H.ALPHA_LAYER_ACCUMULATE=17,H.ALPHA_EQUATION_ADD=0,H.ALPHA_EQUATION_SUBSTRACT=1,H.ALPHA_EQUATION_REVERSE_SUBTRACT=2,H.ALPHA_EQUATION_MAX=3,H.ALPHA_EQUATION_MIN=4,H.ALPHA_EQUATION_DARKEN=5,H.DELAYLOADSTATE_NONE=0,H.DELAYLOADSTATE_LOADED=1,H.DELAYLOADSTATE_LOADING=2,H.DELAYLOADSTATE_NOTLOADED=4,H.NEVER=512,H.ALWAYS=519,H.LESS=513,H.EQUAL=514,H.LEQUAL=515,H.GREATER=516,H.GEQUAL=518,H.NOTEQUAL=517,H.KEEP=7680,H.ZERO=0,H.REPLACE=7681,H.INCR=7682,H.DECR=7683,H.INVERT=5386,H.INCR_WRAP=34055,H.DECR_WRAP=34056,H.TEXTURE_CLAMP_ADDRESSMODE=0,H.TEXTURE_WRAP_ADDRESSMODE=1,H.TEXTURE_MIRROR_ADDRESSMODE=2,H.TEXTURE_CREATIONFLAG_STORAGE=1,H.TEXTUREFORMAT_ALPHA=0,H.TEXTUREFORMAT_LUMINANCE=1,H.TEXTUREFORMAT_LUMINANCE_ALPHA=2,H.TEXTUREFORMAT_RGB=4,H.TEXTUREFORMAT_RGBA=5,H.TEXTUREFORMAT_RED=6,H.TEXTUREFORMAT_R=6,H.TEXTUREFORMAT_R16_UNORM=33322,H.TEXTUREFORMAT_RG16_UNORM=33324,H.TEXTUREFORMAT_RGB16_UNORM=32852,H.TEXTUREFORMAT_RGBA16_UNORM=32859,H.TEXTUREFORMAT_R16_SNORM=36760,H.TEXTUREFORMAT_RG16_SNORM=36761,H.TEXTUREFORMAT_RGB16_SNORM=36762,H.TEXTUREFORMAT_RGBA16_SNORM=36763,H.TEXTUREFORMAT_RG=7,H.TEXTUREFORMAT_RED_INTEGER=8,H.TEXTUREFORMAT_R_INTEGER=8,H.TEXTUREFORMAT_RG_INTEGER=9,H.TEXTUREFORMAT_RGB_INTEGER=10,H.TEXTUREFORMAT_RGBA_INTEGER=11,H.TEXTUREFORMAT_BGRA=12,H.TEXTUREFORMAT_DEPTH24_STENCIL8=13,H.TEXTUREFORMAT_DEPTH32_FLOAT=14,H.TEXTUREFORMAT_DEPTH16=15,H.TEXTUREFORMAT_DEPTH24=16,H.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,H.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,H.TEXTUREFORMAT_STENCIL8=19,H.TEXTUREFORMAT_UNDEFINED=4294967295,H.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,H.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,H.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,H.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,H.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,H.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,H.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,H.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,H.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,H.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,H.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,H.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,H.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,H.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,H.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,H.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,H.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,H.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,H.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,H.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,H.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,H.TEXTURETYPE_UNSIGNED_BYTE=0,H.TEXTURETYPE_UNSIGNED_INT=0,H.TEXTURETYPE_FLOAT=1,H.TEXTURETYPE_HALF_FLOAT=2,H.TEXTURETYPE_BYTE=3,H.TEXTURETYPE_SHORT=4,H.TEXTURETYPE_UNSIGNED_SHORT=5,H.TEXTURETYPE_INT=6,H.TEXTURETYPE_UNSIGNED_INTEGER=7,H.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,H.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,H.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,H.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,H.TEXTURETYPE_UNSIGNED_INT_24_8=12,H.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,H.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,H.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,H.TEXTURETYPE_UNDEFINED=16,H.TEXTURE_2D=3553,H.TEXTURE_2D_ARRAY=35866,H.TEXTURE_CUBE_MAP=34067,H.TEXTURE_CUBE_MAP_ARRAY=3735928559,H.TEXTURE_3D=32879,H.TEXTURE_NEAREST_SAMPLINGMODE=1,H.TEXTURE_NEAREST_NEAREST=1,H.TEXTURE_BILINEAR_SAMPLINGMODE=2,H.TEXTURE_LINEAR_LINEAR=2,H.TEXTURE_TRILINEAR_SAMPLINGMODE=3,H.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,H.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,H.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,H.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,H.TEXTURE_NEAREST_LINEAR=7,H.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,H.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,H.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,H.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,H.TEXTURE_LINEAR_NEAREST=12,H.TEXTURE_EXPLICIT_MODE=0,H.TEXTURE_SPHERICAL_MODE=1,H.TEXTURE_PLANAR_MODE=2,H.TEXTURE_CUBIC_MODE=3,H.TEXTURE_PROJECTION_MODE=4,H.TEXTURE_SKYBOX_MODE=5,H.TEXTURE_INVCUBIC_MODE=6,H.TEXTURE_EQUIRECTANGULAR_MODE=7,H.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,H.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,H.TEXTURE_FILTERING_QUALITY_HIGH=64,H.TEXTURE_FILTERING_QUALITY_MEDIUM=16,H.TEXTURE_FILTERING_QUALITY_LOW=8,H.SCALEMODE_FLOOR=1,H.SCALEMODE_NEAREST=2,H.SCALEMODE_CEILING=3,H.MATERIAL_TextureDirtyFlag=1,H.MATERIAL_LightDirtyFlag=2,H.MATERIAL_FresnelDirtyFlag=4,H.MATERIAL_AttributesDirtyFlag=8,H.MATERIAL_MiscDirtyFlag=16,H.MATERIAL_PrePassDirtyFlag=32,H.MATERIAL_ImageProcessingDirtyFlag=64,H.MATERIAL_AllDirtyFlag=127,H.MATERIAL_TriangleFillMode=0,H.MATERIAL_WireFrameFillMode=1,H.MATERIAL_PointFillMode=2,H.MATERIAL_PointListDrawMode=3,H.MATERIAL_LineListDrawMode=4,H.MATERIAL_LineLoopDrawMode=5,H.MATERIAL_LineStripDrawMode=6,H.MATERIAL_TriangleStripDrawMode=7,H.MATERIAL_TriangleFanDrawMode=8,H.MATERIAL_ClockWiseSideOrientation=0,H.MATERIAL_CounterClockWiseSideOrientation=1,H.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,H.MATERIAL_DIFFUSE_MODEL_BURLEY=1,H.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,H.MATERIAL_DIFFUSE_MODEL_LEGACY=3,H.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,H.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,H.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,H.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,H.ACTION_NothingTrigger=0,H.ACTION_OnPickTrigger=1,H.ACTION_OnLeftPickTrigger=2,H.ACTION_OnRightPickTrigger=3,H.ACTION_OnCenterPickTrigger=4,H.ACTION_OnPickDownTrigger=5,H.ACTION_OnDoublePickTrigger=6,H.ACTION_OnPickUpTrigger=7,H.ACTION_OnPickOutTrigger=16,H.ACTION_OnLongPressTrigger=8,H.ACTION_OnPointerOverTrigger=9,H.ACTION_OnPointerOutTrigger=10,H.ACTION_OnEveryFrameTrigger=11,H.ACTION_OnIntersectionEnterTrigger=12,H.ACTION_OnIntersectionExitTrigger=13,H.ACTION_OnKeyDownTrigger=14,H.ACTION_OnKeyUpTrigger=15,H.PARTICLES_BILLBOARDMODE_Y=2,H.PARTICLES_BILLBOARDMODE_ALL=7,H.PARTICLES_BILLBOARDMODE_STRETCHED=8,H.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,H.MESHES_CULLINGSTRATEGY_STANDARD=0,H.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,H.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,H.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,H.SCENELOADER_NO_LOGGING=0,H.SCENELOADER_MINIMAL_LOGGING=1,H.SCENELOADER_SUMMARY_LOGGING=2,H.SCENELOADER_DETAILED_LOGGING=3,H.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,H.PREPASS_POSITION_TEXTURE_TYPE=1,H.PREPASS_VELOCITY_TEXTURE_TYPE=2,H.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,H.PREPASS_COLOR_TEXTURE_TYPE=4,H.PREPASS_DEPTH_TEXTURE_TYPE=5,H.PREPASS_NORMAL_TEXTURE_TYPE=6,H.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,H.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,H.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,H.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,H.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,H.PREPASS_ALBEDO_TEXTURE_TYPE=12,H.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,H.BUFFER_CREATIONFLAG_READ=1,H.BUFFER_CREATIONFLAG_WRITE=2,H.BUFFER_CREATIONFLAG_READWRITE=3,H.BUFFER_CREATIONFLAG_UNIFORM=4,H.BUFFER_CREATIONFLAG_VERTEX=8,H.BUFFER_CREATIONFLAG_INDEX=16,H.BUFFER_CREATIONFLAG_STORAGE=32,H.BUFFER_CREATIONFLAG_INDIRECT=64,H.RENDERPASS_MAIN=0,H.INPUT_ALT_KEY=18,H.INPUT_CTRL_KEY=17,H.INPUT_META_KEY1=91,H.INPUT_META_KEY2=92,H.INPUT_META_KEY3=93,H.INPUT_SHIFT_KEY=16,H.SNAPSHOTRENDERING_STANDARD=0,H.SNAPSHOTRENDERING_FAST=1,H.PERSPECTIVE_CAMERA=0,H.ORTHOGRAPHIC_CAMERA=1,H.FOVMODE_VERTICAL_FIXED=0,H.FOVMODE_HORIZONTAL_FIXED=1,H.RIG_MODE_NONE=0,H.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,H.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,H.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,H.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,H.RIG_MODE_STEREOSCOPIC_INTERLACED=14,H.RIG_MODE_VR=20,H.RIG_MODE_CUSTOM=22,H.MAX_SUPPORTED_UV_SETS=6,H.GL_ALPHA_EQUATION_ADD=32774,H.GL_ALPHA_EQUATION_MIN=32775,H.GL_ALPHA_EQUATION_MAX=32776,H.GL_ALPHA_EQUATION_SUBTRACT=32778,H.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,H.GL_ALPHA_FUNCTION_SRC=768,H.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,H.GL_ALPHA_FUNCTION_SRC_ALPHA=770,H.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,H.GL_ALPHA_FUNCTION_DST_ALPHA=772,H.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,H.GL_ALPHA_FUNCTION_DST_COLOR=774,H.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,H.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,H.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,H.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,H.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,H.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,H.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,H.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,H.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,H.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,H.SnippetUrl="https://snippet.babylonjs.com",H.FOGMODE_NONE=0,H.FOGMODE_EXP=1,H.FOGMODE_EXP2=2,H.FOGMODE_LINEAR=3,H.BYTE=5120,H.UNSIGNED_BYTE=5121,H.SHORT=5122,H.UNSIGNED_SHORT=5123,H.INT=5124,H.UNSIGNED_INT=5125,H.FLOAT=5126,H.PositionKind="position",H.NormalKind="wl",H.TangentKind="tangent",H.UVKind="uv",H.UV2Kind="uv2",H.UV3Kind="uv3",H.UV4Kind="uv4",H.UV5Kind="uv5",H.UV6Kind="uv6",H.ColorKind="color",H.ColorInstanceKind="instanceColor",H.MatricesIndicesKind="matricesIndices",H.MatricesWeightsKind="matricesWeights",H.MatricesIndicesExtraKind="matricesIndicesExtra",H.MatricesWeightsExtraKind="matricesWeightsExtra",H.ANIMATIONTYPE_FLOAT=0,H.ANIMATIONTYPE_VECTOR3=1,H.ANIMATIONTYPE_QUATERNION=2,H.ANIMATIONTYPE_MATRIX=3,H.ANIMATIONTYPE_COLOR3=4,H.ANIMATIONTYPE_COLOR4=7,H.ANIMATIONTYPE_VECTOR2=5,H.ANIMATIONTYPE_SIZE=6,H.ShadowMinZ=0,H.ShadowMaxZ=1e4},11325:(z,u,Y)=>{Y.d(u,{b:()=>i});var H=Y(11046),E=Y(10928),J=Y(11333),l=Y(10962);class T{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new b(z)}sampleFrame(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const u=z-this._lastFrameTimeMs;this._rollingFrameTime.add(u)}this._lastFrameTimeMs=z}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const z=this._rollingFrameTime.history(0);return 0===z?0:1e3/z}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class b{constructor(z){this._samples=new Array(z),this.reset()}add(z){let u;if(this.isSaturated()){const z=this._samples[this._pos];u=z-this.average,this.average-=u/(this._sampleCount-1),this._m2-=u*(z-this.average)}else this._sampleCount++;u=z-this.average,this.average+=u/this._sampleCount,this._m2+=u*(z-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=z,this._pos++,this._pos%=this._samples.length}history(z){if(z>=this._sampleCount||z>=this._samples.length)return 0;const u=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(u-z)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(z){const u=this._samples.length;return(z%u+u)%u}}var L=Y(11346),D=Y(10953),g=Y(11349),M=(Y(11355),Y(11070));function q(z,u,Y,H){let E,J=1;1===H?E=new Float32Array(u*Y*4):2===H?(E=new Uint16Array(u*Y*4),J=15360):E=7===H?new Uint32Array(u*Y*4):new Uint8Array(u*Y*4);for(let l=0;l<u;l++)for(let H=0;H<Y;H++){const Y=3*(H*u+l),T=4*(H*u+l);E[T+0]=z[Y+0],E[T+1]=z[Y+1],E[T+2]=z[Y+2],E[T+3]=J}return E}function C(z){return function(u,Y,E,J,l,T,b,L){let D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const M=z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,q=z?10:11,C=new H.d(this,q);C.baseWidth=Y,C.baseHeight=E,C.baseDepth=J,C.width=Y,C.height=E,C.depth=J,C.format=l,C.type=g,C.generateMipMaps=T,C.samplingMode=L,z?C.is3D=!0:C.is2DArray=!0,this._doNotHandleContextLost||(C._bufferView=u),z?this.updateRawTexture3D(C,u,l,b,D,g):this.updateRawTexture2DArray(C,u,l,b,D,g),this._bindTextureDirectly(M,C,!0);const K=this._getSamplingParameters(L,T);return this._gl.texParameteri(M,this._gl.TEXTURE_MAG_FILTER,K.mag),this._gl.texParameteri(M,this._gl.TEXTURE_MIN_FILTER,K.min),T&&this._gl.generateMipmap(M),this._bindTextureDirectly(M,null),this._internalTexturesCache.push(C),C}}function K(z){return function(u,Y,H,E){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const T=z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,b=this._getWebGLTextureType(l),L=this._getInternalFormat(H),D=this._getRGBABufferInternalSizedFormat(l,H);this._bindTextureDirectly(T,u,!0),this._unpackFlipY(void 0===E||!!E),this._doNotHandleContextLost||(u._bufferView=Y,u.format=H,u.invertY=E,u._compression=J),u.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),J&&Y?this._gl.compressedTexImage3D(T,0,this.getCaps().s3tc[J],u.width,u.height,u.depth,0,Y):this._gl.texImage3D(T,0,D,u.width,u.height,u.depth,0,L,b,Y),u.generateMipMaps&&this._gl.generateMipmap(T),this._bindTextureDirectly(T,null),u.isReady=!0}}J.ThinEngine.prototype.updateRawTexture=function(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!z)return;const T=this._getRGBABufferInternalSizedFormat(J,Y,l),b=this._getInternalFormat(Y),L=this._getWebGLTextureType(J);this._bindTextureDirectly(this._gl.TEXTURE_2D,z,!0),this._unpackFlipY(void 0===H||!!H),this._doNotHandleContextLost||(z._bufferView=u,z.format=Y,z.type=J,z.invertY=H,z._compression=E),z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),E&&u?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[E],z.width,z.height,0,u):this._gl.texImage2D(this._gl.TEXTURE_2D,0,T,z.width,z.height,0,b,L,u),z.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),z.isReady=!0},J.ThinEngine.prototype.createRawTexture=function(z,u,Y,E,J,l,T){let b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const g=new H.d(this,3);g.baseWidth=u,g.baseHeight=Y,g.width=u,g.height=Y,g.format=E,g.generateMipMaps=J,g.samplingMode=T,g.invertY=l,g._compression=b,g.type=L,g._useSRGBBuffer=this._getUseSRGBBuffer(D,!J),this._doNotHandleContextLost||(g._bufferView=z),this.updateRawTexture(g,z,E,l,b,L,g._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0);const M=this._getSamplingParameters(T,J);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,M.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,M.min),J&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(g),g},J.ThinEngine.prototype.createRawCubeTexture=function(z,u,Y,E,J,l,T){let b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const L=this._gl,g=new H.d(this,8);g.isCube=!0,g.format=Y,g.type=E,this._doNotHandleContextLost||(g._bufferViewArray=z);const q=this._getWebGLTextureType(E);let C=this._getInternalFormat(Y);C===L.RGB&&(C=L.RGBA),q!==L.FLOAT||this._caps.textureFloatLinearFiltering?q!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?q!==L.FLOAT||this._caps.textureFloatRender?q!==L.HALF_FLOAT||this._caps.colorBufferFloat||(J=!1,D.b.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(J=!1,D.b.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(J=!1,T=1,D.b.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(J=!1,T=1,D.b.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const K=u,h=K;g.width=K,g.height=h,g.invertY=l,g._compression=b;if(!this.needPOTTextures||(0,M.f)(g.width)&&(0,M.f)(g.height)||(J=!1),z)this.updateRawCubeTexture(g,z,Y,E,l,b);else{const z=this._getRGBABufferInternalSizedFormat(E),u=0;this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,g,!0);for(let Y=0;Y<6;Y++)b?L.compressedTexImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+Y,u,this.getCaps().s3tc[b],g.width,g.height,0,void 0):L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+Y,u,z,g.width,g.height,0,C,q,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,!0),z&&J&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const o=this._getSamplingParameters(T,J);return L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MAG_FILTER,o.mag),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MIN_FILTER,o.min),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null),g.generateMipMaps=J,g.samplingMode=T,g.isReady=!0,g},J.ThinEngine.prototype.updateRawCubeTexture=function(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;z._bufferViewArray=u,z.format=Y,z.type=H,z.invertY=E,z._compression=J;const T=this._gl,b=this._getWebGLTextureType(H);let L=this._getInternalFormat(Y);const D=this._getRGBABufferInternalSizedFormat(H);let g=!1;L===T.RGB&&(L=T.RGBA,g=!0),this._bindTextureDirectly(T.TEXTURE_CUBE_MAP,z,!0),this._unpackFlipY(void 0===E||!!E),z.width%4!==0&&T.pixelStorei(T.UNPACK_ALIGNMENT,1);for(let M=0;M<6;M++){let Y=u[M];J?T.compressedTexImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+M,l,this.getCaps().s3tc[J],z.width,z.height,0,Y):(g&&(Y=q(Y,z.width,z.height,H)),T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+M,l,D,z.width,z.height,0,L,b,Y))}(!this.needPOTTextures||(0,M.f)(z.width)&&(0,M.f)(z.height))&&z.generateMipMaps&&0===l&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),z.isReady=!0},J.ThinEngine.prototype.createRawCubeTextureFromUrl=function(z,u,Y,H,E,J,l,T){let b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,g=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const M=this._gl,C=this.createRawCubeTexture(null,Y,H,E,!J,g,D,null);null===u||void 0===u||u.addPendingData(C),C.url=z,C.isReady=!1,this._internalTexturesCache.push(C);const K=z=>{if(!C._hardwareTexture)return;const Y=C.width,J=l(z);if(J){if(T){const z=this._getWebGLTextureType(E);let u=this._getInternalFormat(H);const l=this._getRGBABufferInternalSizedFormat(E);let b=!1;u===M.RGB&&(u=M.RGBA,b=!0),this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,C,!0),this._unpackFlipY(!1);const L=T(J);for(let H=0;H<L.length;H++){const J=Y>>H;for(let Y=0;Y<6;Y++){let T=L[H][Y];b&&(T=q(T,J,J,E)),M.texImage2D(Y,H,l,J,J,0,u,z,T)}}this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(C,J,H,E,g);C.isReady=!0,null===u||void 0===u||u.removePendingData(C),C.onLoadedObservable.notifyObservers(C),C.onLoadedObservable.clear(),b&&b()}};return this._loadFile(z,(z=>{K(z)}),void 0,null===u||void 0===u?void 0:u.offlineProvider,!0,((z,Y)=>{null===u||void 0===u||u.removePendingData(C),L&&z&&L(z.status+" "+z.statusText,Y)})),C},J.ThinEngine.prototype.createRawTexture2DArray=C(!1),J.ThinEngine.prototype.createRawTexture3D=C(!0),J.ThinEngine.prototype.updateRawTexture2DArray=K(!1),J.ThinEngine.prototype.updateRawTexture3D=K(!0);var h=Y(11002);J.ThinEngine.prototype._readTexturePixelsSync=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const D=this._gl;if(!D)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const z=D.createFramebuffer();if(!z)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=z}var g,M;(D.bindFramebuffer(D.FRAMEBUFFER,this._dummyFramebuffer),H>-1)?D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+H,null===(g=z._hardwareTexture)||void 0===g?void 0:g.underlyingResource,E):D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,null===(M=z._hardwareTexture)||void 0===M?void 0:M.underlyingResource,E);let q=void 0!==z.type?this._getWebGLTextureType(z.type):D.UNSIGNED_BYTE;if(T)J||(J=(0,h.p)(z.type,4*u*Y));else if(q===D.UNSIGNED_BYTE)J||(J=new Uint8Array(4*u*Y)),q=D.UNSIGNED_BYTE;else J||(J=new Float32Array(4*u*Y)),q=D.FLOAT;return l&&this.flushFramebuffer(),D.readPixels(b,L,u,Y,D.RGBA,q,J),D.bindFramebuffer(D.FRAMEBUFFER,this._currentFramebuffer),J},J.ThinEngine.prototype._readTexturePixels=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(z,u,Y,H,E,J,l,T,b,L))};Y(11363);J.ThinEngine.prototype._createDepthStencilCubeTexture=function(z,u){const Y=new H.d(this,12);if(Y.isCube=!0,1===this.webGLVersion)return D.b.Error("Depth cube texture is not supported by WebGL 1."),Y;const E={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...u},J=this._gl;this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,Y,!0),this._setupDepthStencilTexture(Y,z,E.bilinearFiltering,E.comparisonFunction);for(let H=0;H<6;H++)E.generateStencil?J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+H,0,J.DEPTH24_STENCIL8,z,z,0,J.DEPTH_STENCIL,J.UNSIGNED_INT_24_8,null):J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+H,0,J.DEPTH_COMPONENT24,z,z,0,J.DEPTH_COMPONENT,J.UNSIGNED_INT,null);return this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(Y),Y},J.ThinEngine.prototype._setCubeMapTextureParams=function(z,u,Y){const H=this._gl;H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,u?H.LINEAR_MIPMAP_LINEAR:H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),z.samplingMode=u?3:2,u&&this.getCaps().textureMaxLevel&&void 0!==Y&&Y>0&&(H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAX_LEVEL,Y),z._maxLodLevel=Y),this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,null)},J.ThinEngine.prototype.createCubeTexture=function(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,C=arguments.length>13&&void 0!==arguments[13]&&arguments[13],K=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const h=this._gl;return this.createCubeTextureBase(z,u,Y,!!H,E,J,l,T,b,L,g,q,(z=>this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,z,!0)),((z,u)=>{const Y=this.needPOTTextures?(0,M.e)(u[0].width,this._caps.maxCubemapTextureSize):u[0].width,J=Y,T=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,z,!0),this._unpackFlipY(!1);const b=l?this._getInternalFormat(l,z._useSRGBBuffer):z._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:h.RGBA;let L=l?this._getInternalFormat(l):h.RGBA;z._useSRGBBuffer&&1===this.webGLVersion&&(L=b);for(let H=0;H<T.length;H++)if(u[H].width!==Y||u[H].height!==J){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void D.b.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=Y,this._workingCanvas.height=J,this._workingContext.drawImage(u[H],0,0,u[H].width,u[H].height,0,0,Y,J),h.texImage2D(T[H],0,b,L,h.UNSIGNED_BYTE,this._workingCanvas)}else h.texImage2D(T[H],0,b,L,h.UNSIGNED_BYTE,u[H]);H||h.generateMipmap(h.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(z,!H),z.width=Y,z.height=J,z.isReady=!0,l&&(z.format=l),z.onLoadedObservable.notifyObservers(z),z.onLoadedObservable.clear(),E&&E()}),!!C,K)},J.ThinEngine.prototype.generateMipMapsForCubemap=function(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z.generateMipMaps){const Y=this._gl;this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,z,!0),Y.generateMipmap(Y.TEXTURE_CUBE_MAP),u&&this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,null)}};Y(11368);J.ThinEngine.prototype.setDepthStencilTexture=function(z,u,Y,H){void 0!==z&&(u&&(this._boundUniforms[z]=u),Y&&Y.depthStencilTexture?this._setTexture(z,Y,!1,!0,H):this._setTexture(z,null,void 0,void 0,H))},J.ThinEngine.prototype.createRenderTargetCubeTexture=function(z,u){const Y=this._createHardwareRenderTargetWrapper(!1,!0,z),E={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...u};E.generateStencilBuffer=E.generateDepthBuffer&&E.generateStencilBuffer,(1!==E.type||this._caps.textureFloatLinearFiltering)&&(2!==E.type||this._caps.textureHalfFloatLinearFiltering)||(E.samplingMode=1);const J=this._gl,l=new H.d(this,5);this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,l,!0);const T=this._getSamplingParameters(E.samplingMode,E.generateMipMaps);1!==E.type||this._caps.textureFloat||(E.type=0,D.b.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,T.mag),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,T.min),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE);for(let H=0;H<6;H++)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+H,0,this._getRGBABufferInternalSizedFormat(E.type,E.format),z,z,0,this._getInternalFormat(E.format),this._getWebGLTextureType(E.type),null);const b=J.createFramebuffer();return this._bindUnboundFramebuffer(b),Y._depthStencilBuffer=this._setupFramebufferDepthAttachments(E.generateStencilBuffer,E.generateDepthBuffer,z,z),E.generateMipMaps&&J.generateMipmap(J.TEXTURE_CUBE_MAP),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),Y._framebuffer=b,Y._generateDepthBuffer=E.generateDepthBuffer,Y._generateStencilBuffer=E.generateStencilBuffer,l.width=z,l.height=z,l.isReady=!0,l.isCube=!0,l.samples=1,l.generateMipMaps=E.generateMipMaps,l.samplingMode=E.samplingMode,l.type=E.type,l.format=E.format,this._internalTexturesCache.push(l),Y.setTextures(l),Y};var o=Y(11378),d=Y(11397);J.ThinEngine.prototype.createPrefilteredCubeTexture=function(z,u,E,J){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(z,u,null,!1,(async z=>{if(!z)return void(l&&l(null));const T=z.texture;if(g?z.info.sphericalPolynomial&&(T._sphericalPolynomial=z.info.sphericalPolynomial):T._sphericalPolynomial=new o.h,T._source=9,this.getCaps().textureLOD)return void(l&&l(T));const b=this._gl,L=z.width;if(!L)return;const{DDSTools:M}=await Y.e(26).then(Y.bind(Y,13211)),q=[];for(let Y=0;Y<3;Y++){const l=1-Y/2,g=J,C=Math.log2(L)*E+J,K=g+(C-g)*l,h=Math.round(Math.min(Math.max(K,0),C)),o=new H.d(this,2);if(o.type=T.type,o.format=T.format,o.width=Math.pow(2,Math.max(Math.log2(L)-h,0)),o.height=o.width,o.isCube=!0,o._cachedWrapU=0,o._cachedWrapV=0,this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,o,!0),o.samplingMode=2,b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),z.isDDS){const u=z.info,Y=z.data;this._unpackFlipY(u.isCompressed),M.UploadDDSLevels(this,o,Y,u,!0,6,h)}else D.b.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null);const t=new d.c(u);t._isCube=!0,t._texture=o,o.isReady=!0,q.push(t)}T._lodTextureHigh=q[2],T._lodTextureMid=q[1],T._lodTextureLow=q[0],l&&l(T)}),T,b,L,g,E,J)},J.ThinEngine.prototype.createUniformBuffer=function(z,u){const Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create uniform buffer");const H=new L.e(Y);return this.bindUniformBuffer(H),z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,z,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(z),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),H.references=1,H},J.ThinEngine.prototype.createDynamicUniformBuffer=function(z,u){const Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create dynamic uniform buffer");const H=new L.e(Y);return this.bindUniformBuffer(H),z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,z,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(z),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),H.references=1,H},J.ThinEngine.prototype.updateUniformBuffer=function(z,u,Y,H){this.bindUniformBuffer(z),void 0===Y&&(Y=0),void 0===H?u instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,Y,u):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,Y,new Float32Array(u)):u instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,u.subarray(Y,Y+H)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(u).subarray(Y,Y+H)),this.bindUniformBuffer(null)},J.ThinEngine.prototype.bindUniformBuffer=function(z){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,z?z.underlyingResource:null)},J.ThinEngine.prototype.bindUniformBufferBase=function(z,u,Y){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,u,z?z.underlyingResource:null)},J.ThinEngine.prototype.bindUniformBlock=function(z,u,Y){const H=z.program,E=this._gl.getUniformBlockIndex(H,u);4294967295!==E&&this._gl.uniformBlockBinding(H,E,Y)};var t=Y(10948),W=Y(11018);W.e.prototype.displayLoadingUI=function(){if(!(0,t.h)())return;const z=this.loadingScreen;z&&z.displayLoadingUI()},W.e.prototype.hideLoadingUI=function(){if(!(0,t.h)())return;const z=this._loadingScreen;z&&z.hideLoadingUI()},Object.defineProperty(W.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=W.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(z){this._loadingScreen=z},enumerable:!0,configurable:!0}),Object.defineProperty(W.e.prototype,"loadingUIText",{set:function(z){this.loadingScreen.loadingUIText=z},enumerable:!0,configurable:!0}),Object.defineProperty(W.e.prototype,"loadingUIBackgroundColor",{set:function(z){this.loadingScreen.loadingUIBackgroundColor=z},enumerable:!0,configurable:!0}),W.e.prototype.getInputElement=function(){return this._renderingCanvas},W.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},W.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},W.e.prototype.getAspectRatio=function(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=z.viewport;return this.getRenderWidth(u)*Y.width/(this.getRenderHeight(u)*Y.height)},W.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},W.e.prototype._verifyPointerLock=function(){var z;null===(z=this._onPointerLockChange)||void 0===z||z.call(this)},W.e.prototype.setAlphaEquation=function(z){if(this._alphaEquation!==z){switch(z){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=z}},W.e.prototype.getInputElement=function(){return this._renderingCanvas},W.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},W.e.prototype.setDepthFunction=function(z){this._depthCullingState.depthFunc=z},W.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},W.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},W.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},W.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},W.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},W.e.prototype.setDepthWrite=function(z){this._depthCullingState.depthMask=z},W.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},W.e.prototype.setStencilBuffer=function(z){this._stencilState.stencilTest=z},W.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},W.e.prototype.setStencilMask=function(z){this._stencilState.stencilMask=z},W.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},W.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},W.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},W.e.prototype.setStencilFunction=function(z){this._stencilState.stencilFunc=z},W.e.prototype.setStencilFunctionReference=function(z){this._stencilState.stencilFuncRef=z},W.e.prototype.setStencilFunctionMask=function(z){this._stencilState.stencilFuncMask=z},W.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},W.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},W.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},W.e.prototype.setStencilOperationFail=function(z){this._stencilState.stencilOpStencilFail=z},W.e.prototype.setStencilOperationDepthFail=function(z){this._stencilState.stencilOpDepthFail=z},W.e.prototype.setStencilOperationPass=function(z){this._stencilState.stencilOpStencilDepthPass=z},W.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},W.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},W.e.prototype.setAlphaConstants=function(z,u,Y,H){this._alphaState.setAlphaBlendConstants(z,u,Y,H)},W.e.prototype.getAlphaMode=function(){return this._alphaMode},W.e.prototype.getAlphaEquation=function(){return this._alphaEquation},W.e.prototype.getRenderPassNames=function(){return this._renderPassNames},W.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},W.e.prototype.createRenderPassId=function(z){const u=++W.e._RenderPassIdCounter;return this._renderPassNames[u]=z??"NONAME",u},W.e.prototype.releaseRenderPassId=function(z){this._renderPassNames[z]=void 0;for(let u=0;u<this.scenes.length;++u){const Y=this.scenes[u];for(let u=0;u<Y.meshes.length;++u){const H=Y.meshes[u];if(H.YT)for(let u=0;u<H.YT.length;++u){H.YT[u]._removeDrawWrapper(z)}}}};Y(11374);function Z(z){if(z.requestPointerLock){const u=z.requestPointerLock();u instanceof Promise?u.then((()=>{z.focus()})).catch((()=>{})):z.focus()}}var s=Y(11405),v=Y(11009);class i extends J.ThinEngine{static get NpmPackage(){return W.e.NpmPackage}static get Version(){return W.e.Version}static get Instances(){return E.d.Instances}static get LastCreatedEngine(){return E.d.LastCreatedEngine}static get LastCreatedScene(){return E.d.LastCreatedScene}static DefaultLoadingScreenFactory(z){return W.e.DefaultLoadingScreenFactory(z)}get _supportsHardwareTextureRescaling(){return!!i._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(z,u,Y){super(z,u,Y,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new T,this._drawCalls=new s.d,z&&(this._features.supportRenderPasses=!0,Y=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(z){super._sharedInit(z),function(z,u,Y){z._onCanvasFocus=()=>{z.onCanvasFocusObservable.notifyObservers(z)},z._onCanvasBlur=()=>{z.onCanvasBlurObservable.notifyObservers(z)},z._onCanvasContextMenu=u=>{z.disableContextMenu&&u.preventDefault()},u.addEventListener("focus",z._onCanvasFocus),u.addEventListener("blur",z._onCanvasBlur),u.addEventListener("contextmenu",z._onCanvasContextMenu),z._onBlur=()=>{z.disablePerformanceMonitorInBackground&&z.performanceMonitor.disable(),z._windowIsBackground=!0},z._onFocus=()=>{z.disablePerformanceMonitorInBackground&&z.performanceMonitor.enable(),z._windowIsBackground=!1},z._onCanvasPointerOut=Y=>{document.elementFromPoint(Y.clientX,Y.clientY)!==u&&z.onCanvasPointerOutObservable.notifyObservers(Y)};const H=z.getHostWindow();H&&"function"===typeof H.addEventListener&&(H.addEventListener("blur",z._onBlur),H.addEventListener("focus",z._onFocus)),u.addEventListener("pointerout",z._onCanvasPointerOut),Y.doNotHandleTouchAction||function(z){z&&z.setAttribute&&(z.setAttribute("touch-action","none"),z.style.touchAction="none",z.style.webkitTapHighlightColor="transparent")}(u),!W.e.audioEngine&&Y.audioEngine&&W.e.AudioEngineFactory&&(W.e.audioEngine=W.e.AudioEngineFactory(z.getRenderingCanvas(),z.getAudioContext(),z.getAudioDestination())),(0,t.f)()&&(z._onFullscreenChange=()=>{z.isFullscreen=!!document.fullscreenElement,z.isFullscreen&&z._pointerLockRequested&&u&&Z(u)},document.addEventListener("fullscreenchange",z._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",z._onFullscreenChange,!1),z._onPointerLockChange=()=>{z.isPointerLock=document.pointerLockElement===u},document.addEventListener("pointerlockchange",z._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",z._onPointerLockChange,!1)),z.enableOfflineSupport=void 0!==W.e.OfflineProviderFactory,z._deterministicLockstep=!!Y.deterministicLockstep,z._lockstepMaxSteps=Y.lockstepMaxSteps||0,z._timeStep=Y.timeStep||1/60}(this,z,this._creationOptions)}resizeImageBitmap(z,u,Y){return function(z,u,Y,H){const E=z.createCanvas(Y,H).getContext("2d");if(!E)throw new Error("Unable to get 2d context for resizeImageBitmap");return E.drawImage(u,0,0),E.getImageData(0,0,Y,H).data}(this,z,u,Y)}async _createImageBitmapFromSource(z,u){return await async function(z,u,Y){return await new Promise(((H,E)=>{const J=new Image;J.onload=()=>{J.decode().then((()=>{z.createImageBitmap(J,Y).then((z=>{H(z)}))}))},J.onerror=()=>{E(`Error loading image ${J.src}`)},J.src=u}))}(this,z,u)}switchFullscreen(z){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(z)}enterFullscreen(z){this.isFullscreen||(this._pointerLockRequested=z,this._renderingCanvas&&function(z){const u=z.requestFullscreen||z.webkitRequestFullscreen;u&&u.call(z)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const z=document;document.exitFullscreen?document.exitFullscreen():z.webkitCancelFullScreen&&z.webkitCancelFullScreen()}()}setDitheringState(z){z?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(z){z?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(z,u,Y,H){const E=this._cachedViewport;return this._cachedViewport=null,this._viewport(z,u,Y,H),E}scissorClear(z,u,Y,H,E){this.enableScissor(z,u,Y,H),this.clear(E,!0,!0,!0),this.disableScissor()}enableScissor(z,u,Y,H){const E=this._gl;E.enable(E.SCISSOR_TEST),E.scissor(z,u,Y,H)}disableScissor(){const z=this._gl;z.disable(z.SCISSOR_TEST)}async _loadFileAsync(z,u,Y){return await new Promise(((H,E)=>{this._loadFile(z,(z=>{H(z)}),void 0,u,Y,((z,u)=>{E(u)}))}))}getVertexShaderSource(z){const u=this._gl.getAttachedShaders(z);return u?this._gl.getShaderSource(u[0]):null}getFragmentShaderSource(z){const u=this._gl.getAttachedShaders(z);return u?this._gl.getShaderSource(u[1]):null}set framebufferDimensionsObject(z){this._framebufferDimensionsObject=z,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const z of this.scenes)z.resetCachedMaterial(),z._rebuildGeometries();for(const z of this._virtualScenes)z.resetCachedMaterial(),z._rebuildGeometries();super._rebuildBuffers()}getFontOffset(z){return function(z){const u=document.createElement("span");u.textContent="Hg",u.style.font=z;const Y=document.createElement("div");Y.style.display="inline-block",Y.style.width="1px",Y.style.height="0px",Y.style.verticalAlign="bottom";const H=document.createElement("div");H.style.whiteSpace="nowrap",H.appendChild(u),H.appendChild(Y),document.body.appendChild(H);let E=0,J=0;try{J=Y.getBoundingClientRect().top-u.getBoundingClientRect().top,Y.style.verticalAlign="baseline",E=Y.getBoundingClientRect().top-u.getBoundingClientRect().top}finally{document.body.removeChild(H)}return{ascent:E,height:J,descent:J-E}}(z)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:z}=this.customAnimationFrameRequester;z&&z(this.customAnimationFrameRequester.D)}}else super._cancelFrame()}_renderLoop(z){this._processFrame(z),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.D=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.D):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&Z(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}hM(){this._measureFps(),super.hM()}_deletePipelineContext(z){const u=z;u&&u.program&&u.transformFeedback&&(this.deleteTransformFeedback(u.transformFeedback),u.transformFeedback=null),super._deletePipelineContext(z)}createShaderProgram(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;E=E||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const l=super.createShaderProgram(z,u,Y,H,E,J);return this.onAfterShaderCompilationObservable.notifyObservers(this),l}_createShaderProgram(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const J=H.createProgram();if(z.program=J,!J)throw new Error("Unable to create program");if(H.attachShader(J,u),H.attachShader(J,Y),this.webGLVersion>1&&E){const u=this.createTransformFeedback();this.bindTransformFeedback(u),this.setTranformFeedbackVaryings(J,E),z.transformFeedback=u}return H.linkProgram(J),this.webGLVersion>1&&E&&this.bindTransformFeedback(null),z.context=H,z.vertexShader=u,z.fragmentShader=Y,z.isParallelCompiled||this._finalizePipelineContext(z),J}_releaseTexture(z){super._releaseTexture(z)}_releaseRenderTargetWrapper(z){super._releaseRenderTargetWrapper(z);for(const u of this.scenes){for(const Y of u.postProcesses)Y._outputTexture===z&&(Y._outputTexture=null);for(const Y of u.cameras)for(const u of Y._postProcesses)u&&u._outputTexture===z&&(u._outputTexture=null)}}_rescaleTexture(z,u,Y,H,E){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const J=this.createRenderTargetTexture({width:u.width,height:u.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&i._RescalePostProcessFactory&&(this._rescalePostProcess=i._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const l=()=>{this._rescalePostProcess.onApply=function(u){u._bindTexture("textureSampler",z)};let l=Y;l||(l=this.scenes[this.scenes.length-1]),l.postProcessManager.directRender([this._rescalePostProcess],J,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,H,0,0,u.width,u.height,0),this.unBindFramebuffer(J),J.dispose(),E&&E()},T=this._rescalePostProcess.getEffect();T?T.executeWhenCompiled(l):this._rescalePostProcess.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled(l)}))}}wrapWebGLTexture(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const l=new g.e(z,this._gl),T=new H.d(this,0,!0);return T._hardwareTexture=l,T.baseWidth=E,T.baseHeight=J,T.width=E,T.height=J,T.isReady=!0,T.useMipMaps=u,this.updateTextureSamplingMode(Y,T),T}_uploadImageToTexture(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=this._gl,J=this._getWebGLTextureType(z.type),l=this._getInternalFormat(z.format),T=this._getRGBABufferInternalSizedFormat(z.type,l),b=z.isCube?E.TEXTURE_CUBE_MAP:E.TEXTURE_2D;this._bindTextureDirectly(b,z,!0),this._unpackFlipY(z.invertY);let L=E.TEXTURE_2D;z.isCube&&(L=E.TEXTURE_CUBE_MAP_POSITIVE_X+Y),E.texImage2D(L,H,T,l,J,u),this._bindTextureDirectly(b,null,!0)}updateTextureComparisonFunction(z,u){if(1===this.webGLVersion)return void D.b.Error("WebGL 1 does not support texture comparison.");const Y=this._gl;z.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,z,!0),0===u?(Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_COMPARE_FUNC,515),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_COMPARE_MODE,Y.NONE)):(Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_COMPARE_FUNC,u),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_COMPARE_MODE,Y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,z,!0),0===u?(Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_COMPARE_FUNC,515),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_COMPARE_MODE,Y.NONE)):(Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_COMPARE_FUNC,u),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_COMPARE_MODE,Y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),z._comparisonFunction=u}createInstancesBuffer(z){const u=this._gl.createBuffer();if(!u)throw new Error("Unable to create instance buffer");const Y=new L.e(u);return Y.vY=z,this.bindArrayBuffer(Y),this._gl.bufferData(this._gl.ARRAY_BUFFER,z,this._gl.DYNAMIC_DRAW),Y.references=1,Y}deleteInstancesBuffer(z){this._gl.deleteBuffer(z)}async _clientWaitAsync(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const H=this._gl;return await new Promise(((E,J)=>{(0,v.f)((()=>{const Y=H.clientWaitSync(z,u,0);if(Y==H.WAIT_FAILED)throw new Error("clientWaitSync failed");return Y!=H.TIMEOUT_EXPIRED}),E,J,Y)}))}_readPixelsAsync(z,u,Y,H,E,J,l){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const T=this._gl,b=T.createBuffer();T.bindBuffer(T.PIXEL_PACK_BUFFER,b),T.bufferData(T.PIXEL_PACK_BUFFER,l.byteLength,T.STREAM_READ),T.readPixels(z,u,Y,H,E,J,0),T.bindBuffer(T.PIXEL_PACK_BUFFER,null);const L=T.fenceSync(T.SYNC_GPU_COMMANDS_COMPLETE,0);return L?(T.flush(),this._clientWaitAsync(L,0,10).then((()=>(T.deleteSync(L),T.bindBuffer(T.PIXEL_PACK_BUFFER,b),T.getBufferSubData(T.PIXEL_PACK_BUFFER,0,l),T.bindBuffer(T.PIXEL_PACK_BUFFER,null),T.deleteBuffer(b),l)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(z,u){1===E.d.Instances.length&&W.e.audioEngine&&(W.e.audioEngine.dispose(),W.e.audioEngine=null);const Y=z.getHostWindow();Y&&"function"===typeof Y.removeEventListener&&(Y.removeEventListener("blur",z._onBlur),Y.removeEventListener("focus",z._onFocus)),u&&(u.removeEventListener("focus",z._onCanvasFocus),u.removeEventListener("blur",z._onCanvasBlur),u.removeEventListener("pointerout",z._onCanvasPointerOut),u.removeEventListener("contextmenu",z._onCanvasContextMenu)),(0,t.f)()&&(document.removeEventListener("fullscreenchange",z._onFullscreenChange),document.removeEventListener("mozfullscreenchange",z._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",z._onFullscreenChange),document.removeEventListener("msfullscreenchange",z._onFullscreenChange),document.removeEventListener("pointerlockchange",z._onPointerLockChange),document.removeEventListener("mspointerlockchange",z._onPointerLockChange),document.removeEventListener("mozpointerlockchange",z._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",z._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_R16_UNORM=33322,i.TEXTUREFORMAT_RG16_UNORM=33324,i.TEXTUREFORMAT_RGB16_UNORM=32852,i.TEXTUREFORMAT_RGBA16_UNORM=32859,i.TEXTUREFORMAT_R16_SNORM=36760,i.TEXTUREFORMAT_RG16_SNORM=36761,i.TEXTUREFORMAT_RGB16_SNORM=36762,i.TEXTUREFORMAT_RGBA16_SNORM=36763,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST=1,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR=2,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3},10928:(z,u,Y)=>{Y.d(u,{d:()=>E});var H=Y(10932);class E{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}E.Instances=[],E.OnEnginesDisposedObservable=new H.e,E._LastCreatedScene=null,E.UseFallbackTexture=!0,E.FallbackTexture=""},10920:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{static SetMatrixPrecision(z){if(H.MatrixTrackPrecisionChange=!1,z&&!H.MatrixUse64Bits&&H.MatrixTrackedMatrices)for(let u=0;u<H.MatrixTrackedMatrices.length;++u){const z=H.MatrixTrackedMatrices[u],Y=z.NM;z.NM=new Array(16);for(let u=0;u<16;++u)z.NM[u]=Y[u]}H.MatrixUse64Bits=z,H.MatrixCurrentType=H.MatrixUse64Bits?Array:Float32Array,H.MatrixTrackedMatrices=null}}H.MatrixUse64Bits=!1,H.MatrixTrackPrecisionChange=!0,H.MatrixCurrentType=Float32Array,H.MatrixTrackedMatrices=[]},11370:(z,u,Y)=>{Y.d(u,{b:()=>E});var H=Y(11352);class E{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(z){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=z,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,z&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,H.c)(z.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var z;return(null===(z=this._textures)||void 0===z?void 0:z[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(z){var u,Y;if(!this._textures)return-1;const H=this._textures[z],E=(null===(u=this._layerIndices)||void 0===u?void 0:u[z])??0,J=(null===(Y=this._faceIndices)||void 0===Y?void 0:Y[z])??0;return H.isCube?6*E+J:H.is3D?0:E}get samples(){return this._samples}setSamples(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===z&&!Y)return z;const H=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,z,u):this._engine.updateRenderTargetTextureSampleCount(this,z);return this._samples=z,H}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(z,u,Y,H,E){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=z,this._isCube=u,this._size=Y,this._engine=H,this._depthStencilTexture=null,this.label=E}setTextures(z){Array.isArray(z)?this._textures=z:this._textures=z?[z]:null}setTexture(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[u]!==z&&(this._textures[u]&&Y&&this._textures[u].dispose(),this._textures[u]=z)}setLayerAndFaceIndices(z,u){this._layerIndices=z,this._faceIndices=u}setLayerAndFaceIndex(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==u&&u>=0&&(this._layerIndices[z]=u),void 0!==Y&&Y>=0&&(this._faceIndices[z]=Y)}createDepthStencilTexture(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,l=arguments.length>5?arguments[5]:void 0;return null===(z=this._depthStencilTexture)||void 0===z||z.dispose(),this._depthStencilTextureWithStencil=H,this._depthStencilTextureLabel=l,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:Y,comparisonFunction:u,generateStencil:H,isCube:this._isCube,samples:E,depthTextureFormat:J,label:l},this),this._depthStencilTexture}_shareDepth(z){this.shareDepth(z)}shareDepth(z){this._depthStencilTexture&&(z._depthStencilTexture&&z._depthStencilTexture.dispose(),z._depthStencilTexture=this._depthStencilTexture,z._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(z){this.texture&&this.texture._swapAndDie(z),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let z=null;if(this._isMulti){const u=this.textures;if(u&&u.length>0){let Y=!1,H=u.length,E=-1;const J=u[u.length-1]._source;14!==J&&12!==J||(Y=!0,E=u[u.length-1].format,H--);const l=[],T=[],b=[],L=[],D=[],g=[],M=[],q={};for(let z=0;z<H;++z){const Y=u[z];l.push(Y.samplingMode),T.push(Y.type),b.push(Y.format);void 0!==q[Y.uniqueId]?(L.push(-1),M.push(0)):(q[Y.uniqueId]=z,Y.is2DArray?(L.push(35866),M.push(Y.depth)):Y.isCube?(L.push(34067),M.push(0)):Y.is3D?(L.push(32879),M.push(Y.depth)):(L.push(3553),M.push(0))),this._faceIndices&&D.push(this._faceIndices[z]??0),this._layerIndices&&g.push(this._layerIndices[z]??0)}const C={samplingModes:l,generateMipMaps:u[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:Y,depthTextureFormat:E,types:T,formats:b,textureCount:H,targetTypes:L,faceIndex:D,layerIndex:g,layerCounts:M,label:this.label},K={width:this.width,height:this.height,depth:this.depth};z=this._engine.createMultipleRenderTarget(K,C);for(let h=0;h<H;++h){if(-1!==L[h])continue;const Y=q[u[h].uniqueId];z.setTexture(z.textures[Y],h)}}}else{var u,Y,H,E;const l={};if(l.generateDepthBuffer=this._generateDepthBuffer,l.generateMipMaps=(null===(u=this.texture)||void 0===u?void 0:u.generateMipMaps)??!1,l.generateStencilBuffer=this._generateStencilBuffer,l.samplingMode=null===(Y=this.texture)||void 0===Y?void 0:Y.samplingMode,l.type=null===(H=this.texture)||void 0===H?void 0:H.type,l.format=null===(E=this.texture)||void 0===E?void 0:E.format,l.noColorAttachment=!this._textures,l.label=this.label,this.isCube)z=this._engine.createRenderTargetCubeTexture(this.width,l);else{var J;const u={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(J=this.texture)||void 0===J?void 0:J.depth:void 0};z=this._engine.createRenderTargetTexture(u,l)}z.texture&&(z.texture.isReady=!0)}return z}_swapRenderTargetWrapper(z){if(this._textures&&z._textures)for(let u=0;u<this._textures.length;++u)this._textures[u]._swapAndDie(z._textures[u],!1),z._textures[u].isReady=!0;this._depthStencilTexture&&z._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(z._depthStencilTexture),z._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const z=this._cloneRenderTargetWrapper();if(z){if(this._depthStencilTexture){const u=this._depthStencilTexture.samplingMode,Y=this._depthStencilTexture.format,H=2===u||3===u||11===u;z.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,H,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,Y,this._depthStencilTextureLabel)}this.samples>1&&z.setSamples(this.samples),z._swapRenderTargetWrapper(this),z.dispose()}}releaseTextures(){if(this._textures)for(let z=0;z<this._textures.length;++z)this._textures[z].dispose();this._textures=null}dispose(){var z;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(z=this._depthStencilTexture)||void 0===z||z.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11029:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?H.ShadersRepository:H.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?H.ShadersStore:H.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?H.IncludesShadersStore:H.IncludesShadersStoreWGSL}}H.ShadersRepository="src/Shaders/",H.ShadersStore={},H.IncludesShadersStore={},H.ShadersRepositoryWGSL="src/ShadersWGSL/",H.ShadersStoreWGSL={},H.IncludesShadersStoreWGSL={}},11040:(z,u,Y)=>{Y.d(u,{b:()=>M,e:()=>t,h:()=>C,l:()=>q,n:()=>K,p:()=>d,t:()=>g,v:()=>L,w:()=>D,z:()=>b,B:()=>T});class H{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.vl._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(z){z&&this.program&&z(this.program)}setEngine(z){this.vl=z}_fillEffectInformation(z,u,Y,H,E,J,l,T){const b=this.vl;if(b.supportsUniformBuffers)for(const D in u)z.bindUniformBlock(D,u[D]);let L;for(this.vl.getUniforms(this,Y).forEach(((z,u)=>{H[Y[u]]=z})),this._uniforms=H,L=0;L<E.length;L++){null==z.getUniform(E[L])&&(E.splice(L,1),L--)}E.forEach(((z,u)=>{J[z]=u}));for(const D of b.getAttributes(this,l))T.push(D)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(z,u){const Y=this._valueCache[z],H=u.updateFlag;return(void 0===Y||Y!==H)&&(this._valueCache[z]=H,!0)}_cacheFloat2(z,u,Y){let H=this._valueCache[z];if(!H||2!==H.length)return H=[u,Y],this._valueCache[z]=H,!0;let E=!1;return H[0]!==u&&(H[0]=u,E=!0),H[1]!==Y&&(H[1]=Y,E=!0),E}_cacheFloat3(z,u,Y,H){let E=this._valueCache[z];if(!E||3!==E.length)return E=[u,Y,H],this._valueCache[z]=E,!0;let J=!1;return E[0]!==u&&(E[0]=u,J=!0),E[1]!==Y&&(E[1]=Y,J=!0),E[2]!==H&&(E[2]=H,J=!0),J}_cacheFloat4(z,u,Y,H,E){let J=this._valueCache[z];if(!J||4!==J.length)return J=[u,Y,H,E],this._valueCache[z]=J,!0;let l=!1;return J[0]!==u&&(J[0]=u,l=!0),J[1]!==Y&&(J[1]=Y,l=!0),J[2]!==H&&(J[2]=H,l=!0),J[3]!==E&&(J[3]=E,l=!0),l}setInt(z,u){const Y=this._valueCache[z];void 0!==Y&&Y===u||this.vl.setInt(this._uniforms[z],u)&&(this._valueCache[z]=u)}setInt2(z,u,Y){this._cacheFloat2(z,u,Y)&&(this.vl.setInt2(this._uniforms[z],u,Y)||(this._valueCache[z]=null))}setInt3(z,u,Y,H){this._cacheFloat3(z,u,Y,H)&&(this.vl.setInt3(this._uniforms[z],u,Y,H)||(this._valueCache[z]=null))}setInt4(z,u,Y,H,E){this._cacheFloat4(z,u,Y,H,E)&&(this.vl.setInt4(this._uniforms[z],u,Y,H,E)||(this._valueCache[z]=null))}setIntArray(z,u){this._valueCache[z]=null,this.vl.setIntArray(this._uniforms[z],u)}setIntArray2(z,u){this._valueCache[z]=null,this.vl.setIntArray2(this._uniforms[z],u)}setIntArray3(z,u){this._valueCache[z]=null,this.vl.setIntArray3(this._uniforms[z],u)}setIntArray4(z,u){this._valueCache[z]=null,this.vl.setIntArray4(this._uniforms[z],u)}setUInt(z,u){const Y=this._valueCache[z];void 0!==Y&&Y===u||this.vl.setUInt(this._uniforms[z],u)&&(this._valueCache[z]=u)}setUInt2(z,u,Y){this._cacheFloat2(z,u,Y)&&(this.vl.setUInt2(this._uniforms[z],u,Y)||(this._valueCache[z]=null))}setUInt3(z,u,Y,H){this._cacheFloat3(z,u,Y,H)&&(this.vl.setUInt3(this._uniforms[z],u,Y,H)||(this._valueCache[z]=null))}setUInt4(z,u,Y,H,E){this._cacheFloat4(z,u,Y,H,E)&&(this.vl.setUInt4(this._uniforms[z],u,Y,H,E)||(this._valueCache[z]=null))}setUIntArray(z,u){this._valueCache[z]=null,this.vl.setUIntArray(this._uniforms[z],u)}setUIntArray2(z,u){this._valueCache[z]=null,this.vl.setUIntArray2(this._uniforms[z],u)}setUIntArray3(z,u){this._valueCache[z]=null,this.vl.setUIntArray3(this._uniforms[z],u)}setUIntArray4(z,u){this._valueCache[z]=null,this.vl.setUIntArray4(this._uniforms[z],u)}setArray(z,u){this._valueCache[z]=null,this.vl.setArray(this._uniforms[z],u)}setArray2(z,u){this._valueCache[z]=null,this.vl.setArray2(this._uniforms[z],u)}setArray3(z,u){this._valueCache[z]=null,this.vl.setArray3(this._uniforms[z],u)}setArray4(z,u){this._valueCache[z]=null,this.vl.setArray4(this._uniforms[z],u)}setMatrices(z,u){u&&(this._valueCache[z]=null,this.vl.setMatrices(this._uniforms[z],u))}setMatrix(z,u){this._cacheMatrix(z,u)&&(this.vl.setMatrices(this._uniforms[z],u.al())||(this._valueCache[z]=null))}setMatrix3x3(z,u){this._valueCache[z]=null,this.vl.setMatrix3x3(this._uniforms[z],u)}setMatrix2x2(z,u){this._valueCache[z]=null,this.vl.setMatrix2x2(this._uniforms[z],u)}setFloat(z,u){const Y=this._valueCache[z];void 0!==Y&&Y===u||this.vl.setFloat(this._uniforms[z],u)&&(this._valueCache[z]=u)}setVector2(z,u){this._cacheFloat2(z,u.x,u.y)&&(this.vl.setFloat2(this._uniforms[z],u.x,u.y)||(this._valueCache[z]=null))}setFloat2(z,u,Y){this._cacheFloat2(z,u,Y)&&(this.vl.setFloat2(this._uniforms[z],u,Y)||(this._valueCache[z]=null))}setVector3(z,u){this._cacheFloat3(z,u.x,u.y,u.z)&&(this.vl.setFloat3(this._uniforms[z],u.x,u.y,u.z)||(this._valueCache[z]=null))}setFloat3(z,u,Y,H){this._cacheFloat3(z,u,Y,H)&&(this.vl.setFloat3(this._uniforms[z],u,Y,H)||(this._valueCache[z]=null))}setVector4(z,u){this._cacheFloat4(z,u.x,u.y,u.z,u.w)&&(this.vl.setFloat4(this._uniforms[z],u.x,u.y,u.z,u.w)||(this._valueCache[z]=null))}setQuaternion(z,u){this._cacheFloat4(z,u.x,u.y,u.z,u.w)&&(this.vl.setFloat4(this._uniforms[z],u.x,u.y,u.z,u.w)||(this._valueCache[z]=null))}setFloat4(z,u,Y,H,E){this._cacheFloat4(z,u,Y,H,E)&&(this.vl.setFloat4(this._uniforms[z],u,Y,H,E)||(this._valueCache[z]=null))}setColor3(z,u){this._cacheFloat3(z,u.r,u.g,u.b)&&(this.vl.setFloat3(this._uniforms[z],u.r,u.g,u.b)||(this._valueCache[z]=null))}setColor4(z,u,Y){this._cacheFloat4(z,u.r,u.g,u.b,Y)&&(this.vl.setFloat4(this._uniforms[z],u.r,u.g,u.b,Y)||(this._valueCache[z]=null))}setDirectColor4(z,u){this._cacheFloat4(z,u.r,u.g,u.b,u.a)&&(this.vl.setFloat4(this._uniforms[z],u.r,u.g,u.b,u.a)||(this._valueCache[z]=null))}_getVertexShaderCode(){return this.vertexShader?this.vl._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.vl._getShaderSource(this.fragmentShader):null}}var E=Y(11002);const J=new WeakMap,l={_webGLVersion:2,cachedPipelines:{}};function T(z){let u=J.get(z);if(!u){if(!z)return l;u={_webGLVersion:z.TEXTURE_BINDING_3D?2:1,_context:z,parallelShaderCompile:z.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},J.set(z,u)}return u}function b(z){J.delete(z)}function L(z,u,Y,H,E,J){const l=T(H);J||(J=l._createShaderProgramInjection??M);return J(z,o(u,"vertex",H,l._contextWasLost),o(Y,"fragment",H,l._contextWasLost),H,E,l.validateShaderPrograms)}function D(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0;const b=T(E);l||(l=b._createShaderProgramInjection??M);const L=b._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return l(z,h(u,"vertex",H,L,E,b._contextWasLost),h(Y,"fragment",H,L,E,b._contextWasLost),E,J,b.validateShaderPrograms)}function g(z,u){const Y=new H,E=T(z);return E.parallelShaderCompile&&!E.disableParallelShaderCompile&&(Y.isParallelCompiled=!0),Y.context=E._context,Y}function M(z,u,Y,H){let E=arguments.length>5?arguments[5]:void 0;const J=H.createProgram();if(z.program=J,!J)throw new Error("Unable to create program");return H.attachShader(J,u),H.attachShader(J,Y),H.linkProgram(J),z.context=H,z.vertexShader=u,z.fragmentShader=Y,z.isParallelCompiled||C(z,H,E),J}function q(z,u,Y){const H=z;if(H._isDisposed)return!1;const E=T(u);return!!(E&&E.parallelShaderCompile&&E.parallelShaderCompile.COMPLETION_STATUS_KHR&&H.program&&u.getProgramParameter(H.program,E.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(C(H,u,Y),!0)}function C(z,u,Y){const H=z.context,E=z.vertexShader,J=z.fragmentShader,l=z.program;if(!H.getProgramParameter(l,H.LINK_STATUS)){if(!u.getShaderParameter(E,u.COMPILE_STATUS)){const Y=u.getShaderInfoLog(E);if(Y)throw z.vertexCompilationError=Y,new Error("VERTEX SHADER "+Y)}if(!u.getShaderParameter(J,u.COMPILE_STATUS)){const Y=u.getShaderInfoLog(J);if(Y)throw z.fragmentCompilationError=Y,new Error("FRAGMENT SHADER "+Y)}const Y=H.getProgramInfoLog(l);if(Y)throw z.programLinkError=Y,new Error(Y)}if(Y){H.validateProgram(l);if(!H.getProgramParameter(l,H.VALIDATE_STATUS)){const u=H.getProgramInfoLog(l);if(u)throw z.programValidationError=u,new Error(u)}}H.deleteShader(E),H.deleteShader(J),z.vertexShader=void 0,z.fragmentShader=void 0,z.onCompiled&&(z.onCompiled(),z.onCompiled=void 0)}function K(z,u,Y,H,E,J,l,b,g){let M=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0,C=arguments.length>12?arguments[12]:void 0;const K=T(z.context);q||(q=K.createRawShaderProgramInjection??L),C||(C=K.createShaderProgramInjection??D);const h=z;h.program=H?q(h,u,Y,h.context,g):C(h,u,Y,b,h.context,g),h.program.__SPECTOR_rebuildProgram=l,M()}function h(z,u,Y,H,J,l){return o((0,E.g)(z,Y,H),u,J,l)}function o(z,u,Y,H){const E=Y.createShader("vertex"===u?Y.VERTEX_SHADER:Y.FRAGMENT_SHADER);if(!E){let z=Y.NO_ERROR,E=Y.NO_ERROR;for(;(E=Y.getError())!==Y.NO_ERROR;)z=E;throw new Error(`Something went wrong while creating a gl ${u} shader object. gl error=${z}, gl isContextLost=${Y.isContextLost()}, _contextWasLost=${H}`)}return Y.shaderSource(E,z),Y.compileShader(E),E}function d(z,u){u.useProgram(z)}function t(z,u){const Y=z;if(!Y.isParallelCompiled)return void u(z);const H=Y.onCompiled;Y.onCompiled=()=>{null===H||void 0===H||H(),u(z)}}},11333:(z,u,Y)=>{Y.r(u),Y.d(u,{ThinEngine:()=>W});var H=Y(11040),E=Y(11342),J=Y(10953),l=Y(10948);class T{constructor(){this.shaderLanguage=0}postProcessor(z,u,Y,H,E){if(E.drawBuffersExtensionDisabled){const u=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;z=z.replace(u,"")}return z}}const b=/(flat\s)?\s*varying\s*.*/;class L{constructor(){this.shaderLanguage=0}attributeProcessor(z){return z.replace("attribute","in")}varyingCheck(z,u){return b.test(z)}varyingProcessor(z,u){return z.replace("varying",u?"in":"out")}postProcessor(z,u,Y){const H=-1!==z.search(/#extension.+GL_EXT_draw_buffers.+require/);if(z=(z=z.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),Y){const u=-1!==z.search(/layout *\(location *= *0\) *out/g);z=(z=(z=(z=(z=(z=(z=z.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(H||u?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==u.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+z}return z}}var D=Y(11346),g=Y(11070),M=Y(11018),q=Y(11349),C=Y(11046),K=Y(11024),h=Y(11002),o=Y(11035),d=Y(11352);class t{}class W extends M.e{get name(){return this._name}set name(z){this._name=z}get version(){return this._webGLVersion}static get ShadersRepository(){return K.d.ShadersRepository}static set ShadersRepository(z){K.d.ShadersRepository=z}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(z){this._framebufferDimensionsObject=z}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(z,u,Y,E){if(Y=Y||{},super(u??Y.antialias,Y,E),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!z)return;let l=null;if(z.getContext){if(l=z,void 0===Y.sD&&(Y.sD=!1),void 0===Y.xrCompatible&&(Y.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const z=navigator.userAgent;for(const u of W.ExceptionList){const H=u.key,E=u.targets;if(new RegExp(H).test(z)){if(u.capture&&u.captureConstraint){const Y=u.capture,H=u.captureConstraint,E=new RegExp(Y).exec(z);if(E&&E.length>0){if(parseInt(E[E.length-1])>=H)continue}}for(const z of E)switch(z){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":Y.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,H.z)(this._gl)}:(this._onContextLost=z=>{z.preventDefault(),this._contextWasLost=!0,(0,H.z)(this._gl),J.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},l.addEventListener("webglcontextrestored",this._onContextRestored,!1),Y.powerPreference=Y.powerPreference||"high-performance"),l.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(Y.xrCompatible=!1),!Y.disableWebGL2Support)try{this._gl=l.getContext("webgl2",Y)||l.getContext("experimental-webgl2",Y),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(g){}if(!this._gl){if(!l)throw new Error("The provided canvas is null or undefined.");try{this._gl=l.getContext("webgl",Y)||l.getContext("experimental-webgl",Y)}catch(g){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=z,l=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const u=this._gl.getContextAttributes();u&&(Y.stencil=u.stencil)}this._sharedInit(l),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==Y.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=Y.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let H=0;H<this._caps.maxVertexAttribs;H++)this._currentBufferPointers[H]=new t;this._shaderProcessor=this.webGLVersion>1?new L:new T;const b=`Babylon.js v${W.Version}`;J.b.Log(b+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",b);const D=(0,H.B)(this._gl);D.validateShaderPrograms=this.validateShaderPrograms,D.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(z){return null}areAllEffectsReady(){for(const z in this._compiledEffects){if(!this._compiledEffects[z].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const z=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=z&&(this._glRenderer=this._gl.getParameter(z.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(z.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const z=this._gl.getExtension("WEBGL_draw_buffers");if(null!==z){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=z.drawBuffersWEBGL.bind(z),this._caps.maxDrawBuffers=this._gl.getParameter(z.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let u=0;u<16;u++)this._gl["COLOR_ATTACHMENT"+u+"_WEBGL"]=z["COLOR_ATTACHMENT"+u+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const z=this._gl.getExtension("WEBGL_depth_texture");null!=z&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=z.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const z=this._gl.getExtension("OES_vertex_array_object");null!=z&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=z.createVertexArrayOES.bind(z),this._gl.bindVertexArray=z.bindVertexArrayOES.bind(z),this._gl.deleteVertexArray=z.deleteVertexArrayOES.bind(z))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const z=this._gl.getExtension("ANGLE_instanced_arrays");null!=z?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=z.drawArraysInstancedANGLE.bind(z),this._gl.drawElementsInstanced=z.drawElementsInstancedANGLE.bind(z),this._gl.vertexAttribDivisor=z.vertexAttribDivisorANGLE.bind(z)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const z=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);z&&u&&(this._caps.highPrecisionShaderSupported=0!==z.precision&&0!==u.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const z=this._gl.getExtension("EXT_blend_minmax");null!=z&&(this._caps.blendMinMax=!0,this._gl.MAX=z.MAX_EXT,this._gl.MIN=z.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const z=this._gl.getExtension("EXT_sRGB");null!=z&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:z.SRGB_EXT,SRGB8:z.SRGB_ALPHA_EXT,SRGB8_ALPHA8:z.SRGB_ALPHA_EXT})}if(this._creationOptions){const z=this._creationOptions.forceSRGBBufferSupportState;void 0!==z&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&z)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const z=this._workingCanvas.getContext("2d");z&&(this._workingContext=z)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const z=this.getGlInfo();return z&&z.renderer?z.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=E;let J=0;if(u&&z){let u=!0;if(this._currentRenderTarget){var l;const Y=null===(l=this._currentRenderTarget.texture)||void 0===l?void 0:l.format;if(8===Y||9===Y||10===Y||11===Y){var T;const Y=null===(T=this._currentRenderTarget.texture)||void 0===T?void 0:T.type;7===Y||5===Y?(W._TempClearColorUint32[0]=255*z.r,W._TempClearColorUint32[1]=255*z.g,W._TempClearColorUint32[2]=255*z.b,W._TempClearColorUint32[3]=255*z.a,this._gl.clearBufferuiv(this._gl.COLOR,0,W._TempClearColorUint32),u=!1):(W._TempClearColorInt32[0]=255*z.r,W._TempClearColorInt32[1]=255*z.g,W._TempClearColorInt32[2]=255*z.b,W._TempClearColorInt32[3]=255*z.a,this._gl.clearBufferiv(this._gl.COLOR,0,W._TempClearColorInt32),u=!1)}}u&&(this._gl.clearColor(z.r,z.g,z.b,void 0!==z.a?z.a:1),J|=this._gl.COLOR_BUFFER_BIT)}Y&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),J|=this._gl.DEPTH_BUFFER_BIT),H&&(this._gl.clearStencil(0),J|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(J)}_viewport(z,u,Y,H){z===this._viewportCached.x&&u===this._viewportCached.y&&Y===this._viewportCached.z&&H===this._viewportCached.w||(this._viewportCached.x=z,this._viewportCached.y=u,this._viewportCached.z=Y,this._viewportCached.w=H,this._gl.viewport(z,u,Y,H))}oM(){super.oM(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const b=z;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=z,this._bindUnboundFramebuffer(b._framebuffer);const L=this._gl;var D;if(!z.isMulti)if(z.is2DArray||z.is3D)L.framebufferTextureLayer(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,null===(D=z.texture._hardwareTexture)||void 0===D?void 0:D.underlyingResource,l,T),b._currentLOD=l;else if(z.isCube){var g;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+u,null===(g=z.texture._hardwareTexture)||void 0===g?void 0:g.underlyingResource,l)}else if(b._currentLOD!==l){var M;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,null===(M=z.texture._hardwareTexture)||void 0===M?void 0:M.underlyingResource,l),b._currentLOD=l}const q=z._depthStencilTexture;if(q){z.is3D&&(z.texture.width===q.width&&z.texture.height===q.height&&z.texture.depth===q.depth||J.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const Y=z._depthStencilTextureWithStencil?L.DEPTH_STENCIL_ATTACHMENT:L.DEPTH_ATTACHMENT;var C;if(z.is2DArray||z.is3D)L.framebufferTextureLayer(L.FRAMEBUFFER,Y,null===(C=q._hardwareTexture)||void 0===C?void 0:C.underlyingResource,l,T);else if(z.isCube){var K;L.framebufferTexture2D(L.FRAMEBUFFER,Y,L.TEXTURE_CUBE_MAP_POSITIVE_X+u,null===(K=q._hardwareTexture)||void 0===K?void 0:K.underlyingResource,l)}else{var h;L.framebufferTexture2D(L.FRAMEBUFFER,Y,L.TEXTURE_2D,null===(h=q._hardwareTexture)||void 0===h?void 0:h.underlyingResource,l)}}b._MSAAFramebuffer&&this._bindUnboundFramebuffer(b._MSAAFramebuffer),this._cachedViewport&&!E?this.setViewport(this._cachedViewport,Y,H):(Y||(Y=z.width,l&&(Y/=Math.pow(2,l))),H||(H=z.height,l&&(H/=Math.pow(2,l))),this._viewport(0,0,Y,H)),this.wipeCaches()}setStateCullFaceType(z,u){const Y=this.cullBackFaces??z??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==Y||u)&&(this._depthCullingState.cullFace=Y)}setState(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==z||Y)&&(this._depthCullingState.cull=z),this.setStateCullFaceType(E,Y),this.setZOffset(u),this.setZOffsetUnits(l);const T=H?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==T||Y)&&(this._depthCullingState.frontFace=T),this._stencilStateComposer.stencilMaterial=J}_resolveAndGenerateMipMapsFramebuffer(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z.disableAutomaticMSAAResolve||(z.isMulti?this.resolveMultiFramebuffer(z):this.resolveFramebuffer(z)),u||(z.isMulti?this.generateMipMapsMultiFramebuffer(z):this.generateMipMapsFramebuffer(z))}_bindUnboundFramebuffer(z){this._currentFramebuffer!==z&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,z),this._currentFramebuffer=z)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(z){const u=this._getTextureTarget(z);this._bindTextureDirectly(u,z,!0),this._gl.generateMipmap(u),this._bindTextureDirectly(u,null)}unBindFramebuffer(z,u,Y){const H=z;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(z,u),Y&&(H._MSAAFramebuffer&&this._bindUnboundFramebuffer(H._framebuffer),Y()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(z){var u;z.isMulti||null===(u=z.texture)||void 0===u||!u.generateMipMaps||z.isCube||this.generateMipmaps(z.texture)}resolveFramebuffer(z){const u=z,Y=this._gl;if(!u._MSAAFramebuffer||u.isMulti)return;let H=u.resolveMSAAColors?Y.COLOR_BUFFER_BIT:0;H|=u._generateDepthBuffer&&u.resolveMSAADepth?Y.DEPTH_BUFFER_BIT:0,H|=u._generateStencilBuffer&&u.resolveMSAAStencil?Y.STENCIL_BUFFER_BIT:0,Y.bindFramebuffer(Y.READ_FRAMEBUFFER,u._MSAAFramebuffer),Y.bindFramebuffer(Y.DRAW_FRAMEBUFFER,u._framebuffer),Y.blitFramebuffer(0,0,z.width,z.height,0,0,z.width,z.height,H,Y.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(z,u,Y){return this._createVertexBuffer(z,this._gl.STATIC_DRAW)}_createVertexBuffer(z,u){const Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create vertex buffer");const H=new D.e(Y);return this.bindArrayBuffer(H),"number"!==typeof z?z instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(z),u),H.vY=4*z.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,z,u),H.vY=z.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(z),u),H.vY=z),this._resetVertexBufferBinding(),H.references=1,H}createDynamicVertexBuffer(z,u){return this._createVertexBuffer(z,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(z,u,Y){const H=this._gl.createBuffer(),E=new D.e(H);if(!H)throw new Error("Unable to create index buffer");this.bindIndexBuffer(E);const J=this._normalizeIndexData(z);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,J,u?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),E.references=1,E.is32Bits=4===J.BYTES_PER_ELEMENT,E}_normalizeIndexData(z){if(2===z.BYTES_PER_ELEMENT)return z;if(this._caps.uintIndices){if(z instanceof Uint32Array)return z;for(let u=0;u<z.length;u++)if(z[u]>=65535)return new Uint32Array(z);return new Uint16Array(z)}return new Uint16Array(z)}bindArrayBuffer(z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(z,this._gl.ARRAY_BUFFER)}bindUniformBlock(z,u,Y){const H=z.program,E=this._gl.getUniformBlockIndex(H,u);this._gl.uniformBlockBinding(H,E,Y)}bindIndexBuffer(z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(z,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(z,u){(this._vaoRecordInProgress||this._currentBoundBuffer[u]!==z)&&(this._gl.bindBuffer(u,z?z.underlyingResource:null),this._currentBoundBuffer[u]=z)}updateArrayBuffer(z){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,z)}_vertexAttribPointer(z,u,Y,H,E,J,l){const T=this._currentBufferPointers[u];if(!T)return;let b=!1;T.active?(T.buffer!==z&&(T.buffer=z,b=!0),T.size!==Y&&(T.size=Y,b=!0),T.type!==H&&(T.type=H,b=!0),T.normalized!==E&&(T.normalized=E,b=!0),T.stride!==J&&(T.stride=J,b=!0),T.offset!==l&&(T.offset=l,b=!0)):(b=!0,T.active=!0,T.index=u,T.size=Y,T.type=H,T.normalized=E,T.stride=J,T.offset=l,T.buffer=z),(b||this._vaoRecordInProgress)&&(this.bindArrayBuffer(z),H===this._gl.UNSIGNED_INT||H===this._gl.INT?this._gl.vertexAttribIPointer(u,Y,H,J,l):this._gl.vertexAttribPointer(u,Y,H,E,J,l))}_bindIndexBufferWithCache(z){null!=z&&this._cachedIndexBuffer!==z&&(this._cachedIndexBuffer=z,this.bindIndexBuffer(z),this._uintIndicesCurrentlySet=z.is32Bits)}_bindVertexBuffersAttributes(z,u,Y){const H=u.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let E=0;E<H.length;E++){const J=u.getAttributeLocation(E);if(J>=0){const u=H[E];let l=null;if(Y&&(l=Y[u]),l||(l=z[u]),!l)continue;this._gl.enableVertexAttribArray(J),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[J]=!0);const T=l.getBuffer();T&&(this._vertexAttribPointer(T,J,l.getSize(),l.type,l.normalized,l.byteStride,l.byteOffset),l.getIsInstanced()&&(this._gl.vertexAttribDivisor(J,l.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(J),this._currentInstanceBuffers.push(T))))}}}recordVertexArrayObject(z,u,Y,H){const E=this._gl.createVertexArray();if(!E)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(E),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(z,Y,H),this.bindIndexBuffer(u),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),E}bindVertexArrayObject(z,u){this._cachedVertexArrayObject!==z&&(this._cachedVertexArrayObject=z,this._gl.bindVertexArray(z),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=u&&u.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(z,u,Y,H,E){if(this._cachedVertexBuffers!==z||this._cachedEffectForVertexBuffers!==E){this._cachedVertexBuffers=z,this._cachedEffectForVertexBuffers=E;const u=E.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let J=0;for(let l=0;l<u;l++)if(l<Y.length){const u=E.getAttributeLocation(l);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(z,u,Y[l],this._gl.FLOAT,!1,H,J)),J+=4*Y[l]}}this._bindIndexBufferWithCache(u)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(z,u,Y,H){this._cachedVertexBuffers===z&&this._cachedEffectForVertexBuffers===Y||(this._cachedVertexBuffers=z,this._cachedEffectForVertexBuffers=Y,this._bindVertexBuffersAttributes(z,Y,H)),this._bindIndexBufferWithCache(u)}unbindInstanceAttributes(){let z;for(let u=0,Y=this._currentInstanceLocations.length;u<Y;u++){const Y=this._currentInstanceBuffers[u];z!=Y&&Y.references&&(z=Y,this.bindArrayBuffer(Y));const H=this._currentInstanceLocations[u];this._gl.vertexAttribDivisor(H,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(z){this._gl.deleteVertexArray(z)}_releaseBuffer(z){return z.references--,0===z.references&&(this._deleteBuffer(z),!0)}_deleteBuffer(z){this._gl.deleteBuffer(z.underlyingResource)}updateAndBindInstancesBuffer(z,u,Y){if(this.bindArrayBuffer(z),u&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,u),void 0!==Y[0].index)this.bindInstancesBuffer(z,Y,!0);else for(let H=0;H<4;H++){const u=Y[H];this._vertexAttribArraysEnabled[u]||(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0),this._vertexAttribPointer(z,u,4,this._gl.FLOAT,!1,64,16*H),this._gl.vertexAttribDivisor(u,1),this._currentInstanceLocations.push(u),this._currentInstanceBuffers.push(z)}}bindInstancesBuffer(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(z);let H=0;if(Y)for(let E=0;E<u.length;E++){H+=4*u[E].attributeSize}for(let E=0;E<u.length;E++){const Y=u[E];void 0===Y.index&&(Y.index=this._currentEffect.getAttributeLocationByName(Y.attributeName)),Y.index<0||(this._vertexAttribArraysEnabled[Y.index]||(this._gl.enableVertexAttribArray(Y.index),this._vertexAttribArraysEnabled[Y.index]=!0),this._vertexAttribPointer(z,Y.index,Y.attributeSize,Y.attributeType||this._gl.FLOAT,Y.normalized||!1,H,Y.offset),this._gl.vertexAttribDivisor(Y.index,void 0===Y.divisor?1:Y.divisor),this._currentInstanceLocations.push(Y.index),this._currentInstanceBuffers.push(z))}}disableInstanceAttributeByName(z){if(!this._currentEffect)return;const u=this._currentEffect.getAttributeLocationByName(z);this.disableInstanceAttribute(u)}disableInstanceAttribute(z){let u,Y=!1;for(;-1!==(u=this._currentInstanceLocations.indexOf(z));)this._currentInstanceLocations.splice(u,1),this._currentInstanceBuffers.splice(u,1),Y=!0,u=this._currentInstanceLocations.indexOf(z);Y&&(this._gl.vertexAttribDivisor(z,0),this.disableAttributeByIndex(z))}disableAttributeByIndex(z){this._gl.disableVertexAttribArray(z),this._vertexAttribArraysEnabled[z]=!1,this._currentBufferPointers[z].active=!1}draw(z,u,Y,H){this.drawElementsType(z?0:1,u,Y,H)}drawPointClouds(z,u,Y){this.drawArraysType(2,z,u,Y)}drawUnIndexed(z,u,Y,H){this.drawArraysType(z?0:1,u,Y,H)}drawElementsType(z,u,Y,H){this.applyStates(),this._reportDrawCall();const E=this._drawMode(z),J=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,l=this._uintIndicesCurrentlySet?4:2;H?this._gl.drawElementsInstanced(E,Y,J,u*l,H):this._gl.drawElements(E,Y,J,u*l)}drawArraysType(z,u,Y,H){this.applyStates(),this._reportDrawCall();const E=this._drawMode(z);H?this._gl.drawArraysInstanced(E,u,Y,H):this._gl.drawArrays(E,u,Y)}_drawMode(z){switch(z){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(z){this._compiledEffects[z._key]&&delete this._compiledEffects[z._key];const u=z.getPipelineContext();u&&this._deletePipelineContext(u)}_deletePipelineContext(z){const u=z;u&&u.program&&(u.program.__SPECTOR_rebuildProgram=null,(0,o.m)(u),this._gl&&(this._currentProgram===u.program&&this._setProgram(null),this._gl.deleteProgram(u.program)))}_getGlobalDefines(z){return(0,h.j)(z,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(z,u,Y,E,J,l,T,b,L){let D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10?arguments[10]:void 0;const M="string"===typeof z?z:z.vertexToken||z.vertexSource||z.vertexElement||z.vertex,q="string"===typeof z?z:z.fragmentToken||z.fragmentSource||z.fragmentElement||z.fragment,C=this._getGlobalDefines(),h=void 0!==u.attributes;let o=J??u.defines??"";C&&(o+=C);const d=M+"+"+q+"@"+o;if(this._compiledEffects[d]){const z=this._compiledEffects[d];return T&&z.isReady()&&T(z),z._refCount++,z}this._gl&&(0,H.B)(this._gl);const t=new K.d(z,u,h?this:Y,E,this,J,l,T,b,L,d,u.shaderLanguage??D,u.extraInitializationsAsync??g);return this._compiledEffects[d]=t,t}_getShaderSource(z){return this._gl.getShaderSource(z)}createRawShaderProgram(z,u,Y,E){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=(0,H.B)(this._gl);return l._contextWasLost=this._contextWasLost,l.validateShaderPrograms=this.validateShaderPrograms,(0,H.v)(z,u,Y,E||this._gl,J)}createShaderProgram(z,u,Y,E,J){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const T=(0,H.B)(this._gl);return T._contextWasLost=this._contextWasLost,T.validateShaderPrograms=this.validateShaderPrograms,(0,H.w)(z,u,Y,E,J||this._gl,l)}inlineShaderCode(z){return z}createPipelineContext(z){if(this._gl){(0,H.B)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const u=(0,H.t)(this._gl,z);return u.vl=this,u}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(z){return(0,H.h)(z,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(z,u,Y,E,J,l,T,b,L,D,g){const M=(0,H.B)(this._gl);return M._contextWasLost=this._contextWasLost,M.validateShaderPrograms=this.validateShaderPrograms,M._createShaderProgramInjection=this._createShaderProgram.bind(this),M.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),M.createShaderProgramInjection=this.createShaderProgram.bind(this),M.loadFileInjection=this._loadFile.bind(this),(0,H.n)(z,u,Y,E,J,l,T,b,L,D,g)}_createShaderProgram(z,u,Y,E){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,H.b)(z,u,Y,E,J)}_isRenderingStateCompiled(z){return!this._isDisposed&&(0,H.l)(z,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(z,u){(0,H.e)(z,u)}getUniforms(z,u){const Y=new Array,H=z;for(let E=0;E<u.length;E++)Y.push(this._gl.getUniformLocation(H.program,u[E]));return Y}getAttributes(z,u){const Y=[],H=z;for(let J=0;J<u.length;J++)try{Y.push(this._gl.getAttribLocation(H.program,u[J]))}catch(E){Y.push(-1)}return Y}enableEffect(z){(z=null!==z&&(0,E.c)(z)?z.effect:z)&&z!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(z),this._currentEffect=z,z.onBind&&z.onBind(z),z._onBindObservable&&z._onBindObservable.notifyObservers(z))}setInt(z,u){return!!z&&(this._gl.uniform1i(z,u),!0)}setInt2(z,u,Y){return!!z&&(this._gl.uniform2i(z,u,Y),!0)}setInt3(z,u,Y,H){return!!z&&(this._gl.uniform3i(z,u,Y,H),!0)}setInt4(z,u,Y,H,E){return!!z&&(this._gl.uniform4i(z,u,Y,H,E),!0)}setIntArray(z,u){return!!z&&(this._gl.uniform1iv(z,u),!0)}setIntArray2(z,u){return!(!z||u.length%2!==0)&&(this._gl.uniform2iv(z,u),!0)}setIntArray3(z,u){return!(!z||u.length%3!==0)&&(this._gl.uniform3iv(z,u),!0)}setIntArray4(z,u){return!(!z||u.length%4!==0)&&(this._gl.uniform4iv(z,u),!0)}setUInt(z,u){return!!z&&(this._gl.uniform1ui(z,u),!0)}setUInt2(z,u,Y){return!!z&&(this._gl.uniform2ui(z,u,Y),!0)}setUInt3(z,u,Y,H){return!!z&&(this._gl.uniform3ui(z,u,Y,H),!0)}setUInt4(z,u,Y,H,E){return!!z&&(this._gl.uniform4ui(z,u,Y,H,E),!0)}setUIntArray(z,u){return!!z&&(this._gl.uniform1uiv(z,u),!0)}setUIntArray2(z,u){return!(!z||u.length%2!==0)&&(this._gl.uniform2uiv(z,u),!0)}setUIntArray3(z,u){return!(!z||u.length%3!==0)&&(this._gl.uniform3uiv(z,u),!0)}setUIntArray4(z,u){return!(!z||u.length%4!==0)&&(this._gl.uniform4uiv(z,u),!0)}setArray(z,u){return!!z&&(!(u.length<1)&&(this._gl.uniform1fv(z,u),!0))}setArray2(z,u){return!(!z||u.length%2!==0)&&(this._gl.uniform2fv(z,u),!0)}setArray3(z,u){return!(!z||u.length%3!==0)&&(this._gl.uniform3fv(z,u),!0)}setArray4(z,u){return!(!z||u.length%4!==0)&&(this._gl.uniform4fv(z,u),!0)}setMatrices(z,u){return!!z&&(this._gl.uniformMatrix4fv(z,!1,u),!0)}setMatrix3x3(z,u){return!!z&&(this._gl.uniformMatrix3fv(z,!1,u),!0)}setMatrix2x2(z,u){return!!z&&(this._gl.uniformMatrix2fv(z,!1,u),!0)}setFloat(z,u){return!!z&&(this._gl.uniform1f(z,u),!0)}setFloat2(z,u,Y){return!!z&&(this._gl.uniform2f(z,u,Y),!0)}setFloat3(z,u,Y,H){return!!z&&(this._gl.uniform3f(z,u,Y,H),!0)}setFloat4(z,u,Y,H,E){return!!z&&(this._gl.uniform4f(z,u,Y,H,E),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const z=this._colorWrite;this._gl.colorMask(z,z,z,z)}}wipeCaches(z){this.preventCacheWipeBetweenFrames&&!z||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),z&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(z,u){const Y=this._gl;let H=Y.NEAREST,E=Y.NEAREST,J=!1;switch(z){case 11:H=Y.LINEAR,E=u?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case 3:H=Y.LINEAR,J=!0,E=u?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case 8:J=!0,H=Y.NEAREST,E=u?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case 4:H=Y.NEAREST,E=u?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case 5:H=Y.NEAREST,E=u?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case 6:J=!0,H=Y.NEAREST,E=u?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case 7:H=Y.NEAREST,E=Y.LINEAR;break;case 1:H=Y.NEAREST,E=Y.NEAREST;break;case 9:H=Y.LINEAR,E=u?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case 10:J=!0,H=Y.LINEAR,E=u?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case 2:H=Y.LINEAR,E=Y.LINEAR;break;case 12:H=Y.LINEAR,E=Y.NEAREST}return{min:E,mag:H,hasMipMaps:J}}_createTexture(){const z=this._gl.createTexture();if(!z)throw new Error("Unable to create texture");return z}_createHardwareTexture(){return new q.e(this._createTexture(),this._gl)}_createInternalTexture(z,u){let Y,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=!1,l=!1,T=0,b=3,L=5,D=!1,g=1,M=!1,q=0;void 0!==u&&"object"===typeof u?(E=!!u.generateMipMaps,l=!!u.createMipMaps,T=void 0===u.type?0:u.type,b=void 0===u.samplingMode?3:u.samplingMode,L=void 0===u.format?5:u.format,D=void 0!==u.useSRGBBuffer&&u.useSRGBBuffer,g=u.samples??1,Y=u.label,M=!!u.createMSAATexture,q=u.comparisonFunction||0):E=!!u,D&&(D=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==T||this._caps.textureFloatLinearFiltering)&&(2!==T||this._caps.textureHalfFloatLinearFiltering)||(b=1),1!==T||this._caps.textureFloat||(T=0,J.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const K=(0,d.e)(L),h=(0,d.c)(L),o=this._gl,t=new C.d(this,H),W=z.width||z,Z=z.height||z,s=z.depth||0,v=z.layers||0,i=this._getSamplingParameters(b,(E||l)&&!K),X=0!==v?o.TEXTURE_2D_ARRAY:0!==s?o.TEXTURE_3D:o.TEXTURE_2D,Q=K?this._getInternalFormatFromDepthTextureFormat(L,!0,h):this._getRGBABufferInternalSizedFormat(T,L,D),V=K?h?o.DEPTH_STENCIL:o.DEPTH_COMPONENT:this._getInternalFormat(L),A=K?this._getWebGLTextureTypeFromDepthTextureFormat(L):this._getWebGLTextureType(T);if(this._bindTextureDirectly(X,t),0!==v?(t.is2DArray=!0,o.texImage3D(X,0,Q,W,Z,v,0,V,A,null)):0!==s?(t.is3D=!0,o.texImage3D(X,0,Q,W,Z,s,0,V,A,null)):o.texImage2D(X,0,Q,W,Z,0,V,A,null),o.texParameteri(X,o.TEXTURE_MAG_FILTER,i.mag),o.texParameteri(X,o.TEXTURE_MIN_FILTER,i.min),o.texParameteri(X,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(X,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),K&&this.webGLVersion>1&&(0===q?(o.texParameteri(X,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(X,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(X,o.TEXTURE_COMPARE_FUNC,q),o.texParameteri(X,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE))),(E||l)&&this._gl.generateMipmap(X),this._bindTextureDirectly(X,null),t._useSRGBBuffer=D,t.baseWidth=W,t.baseHeight=Z,t.width=W,t.height=Z,t.depth=v||s,t.isReady=!0,t.samples=g,t.generateMipMaps=E,t.samplingMode=b,t.type=T,t.format=L,t.label=Y,t.comparisonFunction=q,this._internalTexturesCache.push(t),M){let z=null;if(z=(0,d.e)(t.format)?this._setupFramebufferDepthAttachments((0,d.c)(t.format),19!==t.format,t.width,t.height,g,t.format,!0):this._createRenderBuffer(t.width,t.height,g,-1,this._getRGBABufferInternalSizedFormat(t.type,t.format,t._useSRGBBuffer),-1),!z)throw new Error("Unable to create render buffer");t._autoMSAAManagement=!0;let u=t._hardwareTexture;u||(u=t._hardwareTexture=this._createHardwareTexture()),u.addMSAARenderBuffer(z)}return t}_getUseSRGBBuffer(z,u){return z&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||u)}createTexture(z,u,Y,H){var E=this;let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,M=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0,K=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(z,u,Y,H,J,l,T,(function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];return E._prepareWebGLTexture(...u,D)}),((z,u,Y,E,J,l)=>{const T=this._gl,b=Y.width===z&&Y.height===u;J._creationFlags=K??0;const L=this._getTexImageParametersForCreateTexture(J.format,J._useSRGBBuffer);if(b)return T.texImage2D(T.TEXTURE_2D,0,L.internalFormat,L.format,L.type,Y),!1;const D=this._caps.maxTextureSize;if(Y.width>D||Y.height>D||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=z,this._workingCanvas.height=u,this._workingContext.drawImage(Y,0,0,Y.width,Y.height,0,0,z,u),T.texImage2D(T.TEXTURE_2D,0,L.internalFormat,L.format,L.type,this._workingCanvas),J.width=z,J.height=u,!1);{const z=new C.d(this,2);this._bindTextureDirectly(T.TEXTURE_2D,z,!0),T.texImage2D(T.TEXTURE_2D,0,L.internalFormat,L.format,L.type,Y),this._rescaleTexture(z,J,H,L.format,(()=>{this._releaseTexture(z),this._bindTextureDirectly(T.TEXTURE_2D,J,!0),l()}))}return!0}),b,L,D,g,M,q,h)}_getTexImageParametersForCreateTexture(z,u){let Y,H;return 1===this.webGLVersion?(Y=this._getInternalFormat(z,u),H=Y):(Y=this._getInternalFormat(z,!1),H=this._getRGBABufferInternalSizedFormat(0,z,u)),{internalFormat:H,format:Y,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(z,u,Y,H,E){}_unpackFlipY(z){this._unpackFlipYCached!==z&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,z?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=z))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(z){return z.isCube?this._gl.TEXTURE_CUBE_MAP:z.is3D?this._gl.TEXTURE_3D:z.is2DArray||z.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=this._getTextureTarget(u),E=this._getSamplingParameters(z,u.useMipMaps||Y);this._setTextureParameterInteger(H,this._gl.TEXTURE_MAG_FILTER,E.mag,u),this._setTextureParameterInteger(H,this._gl.TEXTURE_MIN_FILTER,E.min),Y&&E.hasMipMaps&&(u.generateMipMaps=!0,this._gl.generateMipmap(H)),this._bindTextureDirectly(H,null),u.samplingMode=z}updateTextureDimensions(z,u,Y){}updateTextureWrappingMode(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=this._getTextureTarget(z);null!==u&&(this._setTextureParameterInteger(E,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(u),z),z._cachedWrapU=u),null!==Y&&(this._setTextureParameterInteger(E,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Y),z),z._cachedWrapV=Y),(z.is2DArray||z.is3D)&&null!==H&&(this._setTextureParameterInteger(E,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(H),z),z._cachedWrapR=H),this._bindTextureDirectly(E,null)}_uploadCompressedDataToTextureDirectly(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const T=this._gl;let b=T.TEXTURE_2D;if(z.isCube&&(b=T.TEXTURE_CUBE_MAP_POSITIVE_X+J),z._useSRGBBuffer)switch(u){case 37492:case 36196:this._caps.etc2?u=T.COMPRESSED_SRGB8_ETC2:z._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?u=T.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:z._useSRGBBuffer=!1;break;case 36492:u=T.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:u=T.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?u=T.COMPRESSED_SRGB_S3TC_DXT1_EXT:z._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?u=T.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:z._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?u=T.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:z._useSRGBBuffer=!1;break;default:z._useSRGBBuffer=!1}this._gl.compressedTexImage2D(b,l,u,Y,H,0,E)}_uploadDataToTextureDirectly(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=this._gl,T=this._getWebGLTextureType(z.type),b=this._getInternalFormat(z.format),L=void 0===E?this._getRGBABufferInternalSizedFormat(z.type,z.format,z._useSRGBBuffer):this._getInternalFormat(E,z._useSRGBBuffer);this._unpackFlipY(z.invertY);let D=l.TEXTURE_2D;z.isCube&&(D=l.TEXTURE_CUBE_MAP_POSITIVE_X+Y);const g=Math.round(Math.log(z.width)*Math.LOG2E),M=Math.round(Math.log(z.height)*Math.LOG2E),q=J?z.width:Math.pow(2,Math.max(g-H,0)),C=J?z.height:Math.pow(2,Math.max(M-H,0));l.texImage2D(D,H,L,q,C,0,b,T,u)}updateTextureData(z,u,Y,H,E,J){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const L=this._gl,D=this._getWebGLTextureType(z.type),g=this._getInternalFormat(z.format);this._unpackFlipY(z.invertY);let M=L.TEXTURE_2D,q=L.TEXTURE_2D;z.isCube&&(q=L.TEXTURE_CUBE_MAP_POSITIVE_X+l,M=L.TEXTURE_CUBE_MAP),this._bindTextureDirectly(M,z,!0),L.texSubImage2D(q,T,Y,H,E,J,g,D,u),b&&this._gl.generateMipmap(q),this._bindTextureDirectly(M,null)}_uploadArrayBufferViewToTexture(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=this._gl,J=z.isCube?E.TEXTURE_CUBE_MAP:E.TEXTURE_2D;this._bindTextureDirectly(J,z,!0),this._uploadDataToTextureDirectly(z,u,Y,H),this._bindTextureDirectly(J,null,!0)}_prepareWebGLTextureContinuation(z,u,Y,H,E){const J=this._gl;if(!J)return;const l=this._getSamplingParameters(E,!Y);J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,l.mag),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,l.min),Y||H||J.generateMipmap(J.TEXTURE_2D),this._bindTextureDirectly(J.TEXTURE_2D,null),u&&u.removePendingData(z),z.onLoadedObservable.notifyObservers(z),z.onLoadedObservable.clear()}_prepareWebGLTexture(z,u,Y,H,E,J,l,T,b,L){const D=this.getCaps().maxTextureSize,M=Math.min(D,this.needPOTTextures?(0,g.e)(H.width,D):H.width),q=Math.min(D,this.needPOTTextures?(0,g.e)(H.height,D):H.height),C=this._gl;C&&(z._hardwareTexture?(this._bindTextureDirectly(C.TEXTURE_2D,z,!0),this._unpackFlipY(void 0===E||!!E),z.baseWidth=H.width,z.baseHeight=H.height,z.width=M,z.height=q,z.isReady=!0,z.type=-1!==z.type?z.type:0,z.format=-1!==z.format?z.format:L??(".jpg"!==u||z._useSRGBBuffer?5:4),T(M,q,H,u,z,(()=>{this._prepareWebGLTextureContinuation(z,Y,J,l,b)}))||this._prepareWebGLTextureContinuation(z,Y,J,l,b)):Y&&Y.removePendingData(z))}_getInternalFormatFromDepthTextureFormat(z,u,Y){const H=this._gl;if(!u)return H.STENCIL_INDEX8;let E=Y?H.DEPTH_STENCIL:H.DEPTH_COMPONENT;return this.webGLVersion>1?15===z?E=H.DEPTH_COMPONENT16:16===z?E=H.DEPTH_COMPONENT24:17===z||13===z?E=Y?H.DEPTH24_STENCIL8:H.DEPTH_COMPONENT24:14===z?E=H.DEPTH_COMPONENT32F:18===z&&(E=Y?H.DEPTH32F_STENCIL8:H.DEPTH_COMPONENT32F):E=H.DEPTH_COMPONENT16,E}_getWebGLTextureTypeFromDepthTextureFormat(z){const u=this._gl;let Y=u.UNSIGNED_INT;return 15===z?Y=u.UNSIGNED_SHORT:17===z||13===z?Y=u.UNSIGNED_INT_24_8:14===z?Y=u.FLOAT:18===z?Y=u.FLOAT_32_UNSIGNED_INT_24_8_REV:19===z&&(Y=u.UNSIGNED_BYTE),Y}_setupFramebufferDepthAttachments(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const T=this._gl;J=J??(z?13:14);const b=this._getInternalFormatFromDepthTextureFormat(J,u,z);return z&&u?this._createRenderBuffer(Y,H,E,T.DEPTH_STENCIL,b,l?-1:T.DEPTH_STENCIL_ATTACHMENT):u?this._createRenderBuffer(Y,H,E,b,b,l?-1:T.DEPTH_ATTACHMENT):z?this._createRenderBuffer(Y,H,E,b,b,l?-1:T.STENCIL_ATTACHMENT):null}_createRenderBuffer(z,u,Y,H,E,J){let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const T=this._gl.createRenderbuffer();return this._updateRenderBuffer(T,z,u,Y,H,E,J,l)}_updateRenderBuffer(z,u,Y,H,E,J,l){let T=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const b=this._gl;return b.bindRenderbuffer(b.RENDERBUFFER,z),H>1&&b.renderbufferStorageMultisample?b.renderbufferStorageMultisample(b.RENDERBUFFER,H,J,u,Y):b.renderbufferStorage(b.RENDERBUFFER,E,u,Y),-1!==l&&b.framebufferRenderbuffer(b.FRAMEBUFFER,l,b.RENDERBUFFER,z),T&&b.bindRenderbuffer(b.RENDERBUFFER,null),z}_releaseTexture(z){this._deleteTexture(z._hardwareTexture),this.unbindAllTextures();const u=this._internalTexturesCache.indexOf(z);-1!==u&&this._internalTexturesCache.splice(u,1),z._lodTextureHigh&&z._lodTextureHigh.dispose(),z._lodTextureMid&&z._lodTextureMid.dispose(),z._lodTextureLow&&z._lodTextureLow.dispose(),z._irradianceTexture&&z._irradianceTexture.dispose()}_deleteTexture(z){null===z||void 0===z||z.release()}_setProgram(z){this._currentProgram!==z&&((0,H.p)(z,this._gl),this._currentProgram=z)}bindSamplers(z){const u=z.getPipelineContext();this._setProgram(u.program);const Y=z.getSamplers();for(let H=0;H<Y.length;H++){const u=z.getUniform(Y[H]);u&&(this._boundUniforms[H]=u)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=!1;const l=u&&u._associatedChannel>-1;Y&&l&&(this._activeChannel=u._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==u||H){if(this._activateCurrentTexture(),u&&u.isMultiview)throw J.b.Error(["_bindTextureDirectly called with a multiview texture!",z,u]),"_bindTextureDirectly called with a multiview texture!";var T;this._gl.bindTexture(z,(null===u||void 0===u||null===(T=u._hardwareTexture)||void 0===T?void 0:T.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=u,u&&(u._associatedChannel=this._activeChannel)}else Y&&(E=!0,this._activateCurrentTexture());return l&&!Y&&this._bindSamplerUniformToChannel(u._associatedChannel,this._activeChannel),E}_bindTexture(z,u,Y){if(void 0===z)return;u&&(u._associatedChannel=z),this._activeChannel=z;const H=u?this._getTextureTarget(u):this._gl.TEXTURE_2D;this._bindTextureDirectly(H,u)}unbindAllTextures(){for(let z=0;z<this._maxSimultaneousTextures;z++)this._activeChannel=z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(z,u,Y,H){void 0!==z&&(u&&(this._boundUniforms[z]=u),this._setTexture(z,Y))}_bindSamplerUniformToChannel(z,u){const Y=this._boundUniforms[z];Y&&Y._currentState!==u&&(this._gl.uniform1i(Y,u),Y._currentState=u)}_getTextureWrapMode(z){switch(z){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(z,u){let Y,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!u)return null!=this._boundTexturesCache[z]&&(this._activeChannel=z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(u.video){this._activeChannel=z;const Y=u.getInternalTexture();Y&&(Y._associatedChannel=z),u.update()}else if(4===u.delayLoadState)return u.delayLoad(),!1;Y=E?u.depthStencilTexture:u.isReady()?u.getInternalTexture():u.isCube?this.emptyCubeTexture:u.is3D?this.emptyTexture3D:u.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!H&&Y&&(Y._associatedChannel=z);let J=!0;this._boundTexturesCache[z]===Y&&(H||this._bindSamplerUniformToChannel(Y._associatedChannel,z),J=!1),this._activeChannel=z;const l=this._getTextureTarget(Y);if(J&&this._bindTextureDirectly(l,Y,H),Y&&!Y.isMultiview){if(Y.isCube&&Y._cachedCoordinatesMode!==u.coordinatesMode){Y._cachedCoordinatesMode=u.coordinatesMode;const z=3!==u.coordinatesMode&&5!==u.coordinatesMode?1:0;u.wrapU=z,u.wrapV=z}Y._cachedWrapU!==u.wrapU&&(Y._cachedWrapU=u.wrapU,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(u.wrapU),Y)),Y._cachedWrapV!==u.wrapV&&(Y._cachedWrapV=u.wrapV,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(u.wrapV),Y)),Y.is3D&&Y._cachedWrapR!==u.wrapR&&(Y._cachedWrapR=u.wrapR,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(u.wrapR),Y)),this._setAnisotropicLevel(l,Y,u.anisotropicFilteringLevel)}return!0}setTextureArray(z,u,Y,H){if(void 0!==z&&u){this._textureUnits&&this._textureUnits.length===Y.length||(this._textureUnits=new Int32Array(Y.length));for(let u=0;u<Y.length;u++){const H=Y[u].getInternalTexture();H?(this._textureUnits[u]=z+u,H._associatedChannel=z+u):this._textureUnits[u]=-1}this._gl.uniform1iv(u,this._textureUnits);for(let z=0;z<Y.length;z++)this._setTexture(this._textureUnits[z],Y[z],!0)}}_setAnisotropicLevel(z,u,Y){const H=this._caps.textureAnisotropicFilterExtension;11!==u.samplingMode&&3!==u.samplingMode&&2!==u.samplingMode&&(Y=1),H&&u._cachedAnisotropicFilteringLevel!==Y&&(this._setTextureParameterFloat(z,H.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y,this._caps.maxAnisotropy),u),u._cachedAnisotropicFilteringLevel=Y)}_setTextureParameterFloat(z,u,Y,H){this._bindTextureDirectly(z,H,!0,!0),this._gl.texParameterf(z,u,Y)}_setTextureParameterInteger(z,u,Y,H){H&&this._bindTextureDirectly(z,H,!0,!0),this._gl.texParameteri(z,u,Y)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let z=0;z<this._caps.maxVertexAttribs;z++)this.disableAttributeByIndex(z)}else for(let z=0,u=this._vertexAttribArraysEnabled.length;z<u;z++)z>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[z]||this.disableAttributeByIndex(z)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var z;((0,l.h)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(z=this._gl.getExtension("WEBGL_lose_context"))||void 0===z||z.loseContext());(0,H.z)(this._gl)}attachContextLostEvent(z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",z,!1)}attachContextRestoredEvent(z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",z,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(z){const u=this._gl;for(;u.getError()!==u.NO_ERROR;);let Y=!0;const H=u.createTexture();u.bindTexture(u.TEXTURE_2D,H),u.texImage2D(u.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(z),1,1,0,u.RGBA,this._getWebGLTextureType(z),null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST);const E=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,E),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,H,0);const J=u.checkFramebufferStatus(u.FRAMEBUFFER);if(Y=Y&&J===u.FRAMEBUFFER_COMPLETE,Y=Y&&u.getError()===u.NO_ERROR,Y&&(u.clear(u.COLOR_BUFFER_BIT),Y=Y&&u.getError()===u.NO_ERROR),Y){u.bindFramebuffer(u.FRAMEBUFFER,null);const z=u.RGBA,H=u.UNSIGNED_BYTE,E=new Uint8Array(4);u.readPixels(0,0,1,1,z,H,E),Y=Y&&u.getError()===u.NO_ERROR}for(u.deleteTexture(H),u.deleteFramebuffer(E),u.bindFramebuffer(u.FRAMEBUFFER,null);!Y&&u.getError()!==u.NO_ERROR;);return Y}_getWebGLTextureType(z){if(1===this._webGLVersion){switch(z){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(z){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=u?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(z){case 0:Y=this._gl.ALPHA;break;case 1:Y=this._gl.LUMINANCE;break;case 2:Y=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:Y=this._gl.RED;break;case 7:case 33324:case 36761:Y=this._gl.RG;break;case 4:case 32852:case 36762:Y=u?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:Y=u?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(z){case 8:Y=this._gl.RED_INTEGER;break;case 9:Y=this._gl.RG_INTEGER;break;case 10:Y=this._gl.RGB_INTEGER;break;case 11:Y=this._gl.RGBA_INTEGER}return Y}_getRGBABufferInternalSizedFormat(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==u)switch(u){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return Y?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(z){case 3:switch(u){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(u){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return Y?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return Y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(u){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(u){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(u){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(u){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(u){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(u){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(u){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return Y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(z,u,Y,H){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const b=E?4:3,L=E?this._gl.RGBA:this._gl.RGB,D=Y*H*b;if(T){if(T.length<D)return J.b.Error(`Data buffer is too small to store the read pixels (${T.length} should be more than ${D})`),Promise.resolve(T)}else T=new Uint8Array(D);return l&&this.flushFramebuffer(),this._gl.readPixels(z,u,Y,H,L,this._gl.UNSIGNED_BYTE,T),Promise.resolve(T)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const z=M.e._CreateCanvas(1,1),u=z.getContext("webgl")||z.getContext("experimental-webgl");this._IsSupported=null!=u&&!!window.WebGLRenderingContext}catch(z){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const z=M.e._CreateCanvas(1,1),u=z.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||z.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!u}catch(z){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}W._TempClearColorUint32=new Uint32Array(4),W._TempClearColorInt32=new Int32Array(4),W.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],W._ConcatenateShader=h.g,W._IsSupported=null,W._HasMajorPerformanceCaveat=null},11545:(z,u,Y)=>{var H;Y.d(u,{b:()=>E}),function(z){z[z.PointerMove=0]="PointerMove",z[z.PointerDown=1]="PointerDown",z[z.PointerUp=2]="PointerUp"}(H||(H={}));class E{}E.DOM_DELTA_PIXEL=0,E.DOM_DELTA_LINE=1,E.DOM_DELTA_PAGE=2},11539:(z,u,Y)=>{Y.d(u,{d:()=>H,h:()=>J,j:()=>E});class H{}H.KEYDOWN=1,H.KEYUP=2;class E{constructor(z,u){this.type=z,this.event=u}}class J extends E{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(z){this.skipOnKeyboardObservable=z}constructor(z,u){super(z,u),this.type=z,this.event=u,this.skipOnKeyboardObservable=!1}}},11530:(z,u,Y)=>{Y.d(u,{d:()=>E,g:()=>l,j:()=>T});var H=Y(10903);class E{}E.POINTERDOWN=1,E.POINTERUP=2,E.POINTERMOVE=4,E.POINTERWHEEL=8,E.POINTERPICK=16,E.POINTERTAP=32,E.POINTERDOUBLETAP=64;class J{constructor(z,u){this.type=z,this.event=u}}class l extends J{constructor(z,u,Y,E){super(z,u),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new H.m(Y,E)}}class T extends J{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(z,u),this._pickInfo=Y,this._inputManager=H}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11637:(z,u,Y)=>{Y.d(u,{e:()=>M});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11188),T=Y(11222),b=Y(11163),L=Y(10918),D=Y(11204),g=Y(11172);class M extends T.b{get range(){return this._range}set range(z){this._range=z,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(z){this._intensityMode=z,this._computePhotometricScale()}get radius(){return this._radius}set radius(z){this._radius=z,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(z){this._shadowEnabled!==z&&(this._shadowEnabled=z,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(z){this._includedOnlyMeshes=z,this._hookArrayForIncludedOnly(z)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(z){this._excludedMeshes=z,this._hookArrayForExcluded(z)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(z){this._excludeWithLayerMask=z,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(z){this._includeOnlyWithLayerMask=z,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(z){this._lightmapMode!==z&&(this._lightmapMode=z,this._markMeshesAsLightDirty())}getViewMatrix(z){return null}getProjectionMatrix(z,u){return null}constructor(z,u){super(z,u,!1),this.lT=new l.c(1,1,1),this.iD=new l.c(1,1,1),this.falloffType=M.FALLOFF_DEFAULT,this.JT=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=M.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.iz().addLight(this),this._uniformBuffer=new b.b(this.iz().getEngine(),void 0,void 0,z),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(z,u){return this}_bindLight(z,u,Y,H){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const J=z.toString();let T=!1;if(this._uniformBuffer.bindToEffect(Y,"Light"+J),this._renderId!==u.getRenderId()||this._lastUseSpecular!==H||!this._uniformBuffer.useUbo){this._renderId=u.getRenderId(),this._lastUseSpecular=H;const z=this.getScaledIntensity();this.transferToEffect(Y,J),this.lT.scaleToRef(z,l.g.o[0]),this._uniformBuffer.updateColor4("vLightDiffuse",l.g.o[0],this.range,J),H&&(this.iD.scaleToRef(z,l.g.o[1]),this._uniformBuffer.updateColor4("vLightSpecular",l.g.o[1],this.radius,J)),T=!0}if(this.transferTexturesToEffect(Y,J),u.shadowsEnabled&&this.shadowEnabled&&E){const z=this.getShadowGenerator(u.activeCamera)??this.getShadowGenerator();z&&(z.bindShadowLight(J,Y),T=!0)}T?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(z){let u="Name: "+this.name;if(u+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let Y=0;Y<this.animations.length;Y++)u+=", animation[0]: "+this.animations[Y].toString(z);return u}_syncParentEnabledState(){super._syncParentEnabledState(),this.L()||this._resyncMeshes()}oT(z){super.oT(z),this._resyncMeshes()}getShadowGenerator(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(z)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return J.p.Zero()}canAffectMesh(z){return!z||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(z))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(z))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&z.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&z.layerMask)))}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const z=this._shadowGenerators.values();for(let u=z.next();!0!==u.done;u=z.next()){u.value.dispose()}this._shadowGenerators=null}if(this.iz().stopAnimation(this),this._parentContainer){const z=this._parentContainer.lights.indexOf(this);z>-1&&this._parentContainer.lights.splice(z,1),this._parentContainer=null}for(const Y of this.iz().meshes)Y._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.iz().removeLight(this),super.dispose(z,u)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.JT}clone(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=M.GetConstructorFromName(this.getTypeID(),z,this.iz());if(!Y)return null;const H=g.d.Clone(Y,this);return z&&(H.name=z),u&&(H.parent=u),H.oT(this.isEnabled()),this.onClonedObservable.notifyObservers(H),H}serialize(){const z=g.d.Serialize(this);if(z.uniqueId=this.uniqueId,z.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(z),this.excludedMeshes.length>0){z.excludedMeshesIds=[];for(const u of this.excludedMeshes)z.excludedMeshesIds.push(u.id)}if(this.includedOnlyMeshes.length>0){z.includedOnlyMeshesIds=[];for(const u of this.includedOnlyMeshes)z.includedOnlyMeshesIds.push(u.id)}return g.d.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.isEnabled=this.isEnabled(),z}static GetConstructorFromName(z,u,Y){const H=T.b.Construct("Light_Type_"+z,u,Y);return H||null}static Parse(z,u){const Y=M.GetConstructorFromName(z.type,z.name,u);if(!Y)return null;const H=g.d.Parse(Y,z,u);if(z.excludedMeshesIds&&(H._excludedMeshesIds=z.excludedMeshesIds),z.includedOnlyMeshesIds&&(H._includedOnlyMeshesIds=z.includedOnlyMeshesIds),void 0!==z.parentId&&(H._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(H._waitingParentInstanceIndex=z.parentInstanceIndex),void 0!==z.falloffType&&(H.falloffType=z.falloffType),void 0!==z.lightmapMode&&(H.lightmapMode=z.lightmapMode),z.animations){for(let u=0;u<z.animations.length;u++){const Y=z.animations[u],E=(0,L.c)("BABYLON.Animation");E&&H.animations.push(E.Parse(Y))}T.b.ParseAnimationRanges(H,z,u)}return z.autoAnimate&&u.beginAnimation(H,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),void 0!==z.isEnabled&&H.oT(z.isEnabled),H}_hookArrayForExcluded(z){var u=this;const Y=z.push;z.push=function(){for(var H=arguments.length,E=new Array(H),J=0;J<H;J++)E[J]=arguments[J];const l=Y.apply(z,E);for(const z of E)z._resyncLightSource(u);return l};const H=z.splice;z.splice=(u,Y)=>{const E=H.apply(z,[u,Y]);for(const z of E)z._resyncLightSource(this);return E};for(const E of z)E._resyncLightSource(this)}_hookArrayForIncludedOnly(z){var u=this;const Y=z.push;z.push=function(){for(var H=arguments.length,E=new Array(H),J=0;J<H;J++)E[J]=arguments[J];const l=Y.apply(z,E);return u._resyncMeshes(),l};const H=z.splice;z.splice=(u,Y)=>{const E=H.apply(z,[u,Y]);return this._resyncMeshes(),E},this._resyncMeshes()}_resyncMeshes(){for(const z of this.iz().meshes)z._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const z of this.iz().meshes)-1!==z.lightSources.indexOf(this)&&z._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.iz().resetCachedMaterial()}_getPhotometricScale(){let z=0;const u=this.getTypeID();let Y=this.intensityMode;switch(Y===M.INTENSITYMODE_AUTOMATIC&&(Y=u===M.LIGHTTYPEID_DIRECTIONALLIGHT?M.INTENSITYMODE_ILLUMINANCE:M.INTENSITYMODE_LUMINOUSINTENSITY),u){case M.LIGHTTYPEID_POINTLIGHT:case M.LIGHTTYPEID_SPOTLIGHT:switch(Y){case M.INTENSITYMODE_LUMINOUSPOWER:z=1/(4*Math.PI);break;case M.INTENSITYMODE_LUMINOUSINTENSITY:z=1;break;case M.INTENSITYMODE_LUMINANCE:z=this.radius*this.radius}break;case M.LIGHTTYPEID_DIRECTIONALLIGHT:switch(Y){case M.INTENSITYMODE_ILLUMINANCE:z=1;break;case M.INTENSITYMODE_LUMINANCE:{let u=this.radius;u=Math.max(u,.001);z=2*Math.PI*(1-Math.cos(u));break}}break;case M.LIGHTTYPEID_HEMISPHERICLIGHT:z=1}return z}_reorderLightsInScene(){const z=this.iz();0!=this._renderPriority&&(z.requireLightSorting=!0),this.iz().sortLightsByPriority()}_isReady(){return!0}}M.FALLOFF_DEFAULT=D.d.FALLOFF_DEFAULT,M.FALLOFF_PHYSICAL=D.d.FALLOFF_PHYSICAL,M.FALLOFF_GLTF=D.d.FALLOFF_GLTF,M.FALLOFF_STANDARD=D.d.FALLOFF_STANDARD,M.LIGHTMAP_DEFAULT=D.d.LIGHTMAP_DEFAULT,M.LIGHTMAP_SPECULAR=D.d.LIGHTMAP_SPECULAR,M.LIGHTMAP_SHADOWSONLY=D.d.LIGHTMAP_SHADOWSONLY,M.INTENSITYMODE_AUTOMATIC=D.d.INTENSITYMODE_AUTOMATIC,M.INTENSITYMODE_LUMINOUSPOWER=D.d.INTENSITYMODE_LUMINOUSPOWER,M.INTENSITYMODE_LUMINOUSINTENSITY=D.d.INTENSITYMODE_LUMINOUSINTENSITY,M.INTENSITYMODE_ILLUMINANCE=D.d.INTENSITYMODE_ILLUMINANCE,M.INTENSITYMODE_LUMINANCE=D.d.INTENSITYMODE_LUMINANCE,M.LIGHTTYPEID_POINTLIGHT=D.d.LIGHTTYPEID_POINTLIGHT,M.LIGHTTYPEID_DIRECTIONALLIGHT=D.d.LIGHTTYPEID_DIRECTIONALLIGHT,M.LIGHTTYPEID_SPOTLIGHT=D.d.LIGHTTYPEID_SPOTLIGHT,M.LIGHTTYPEID_HEMISPHERICLIGHT=D.d.LIGHTTYPEID_HEMISPHERICLIGHT,M.LIGHTTYPEID_RECT_AREALIGHT=D.d.LIGHTTYPEID_RECT_AREALIGHT,(0,H.e)([(0,E.j)()],M.prototype,"diffuse",void 0),(0,H.e)([(0,E.j)()],M.prototype,"specular",void 0),(0,H.e)([(0,E.L)()],M.prototype,"falloffType",void 0),(0,H.e)([(0,E.L)()],M.prototype,"intensity",void 0),(0,H.e)([(0,E.L)()],M.prototype,"range",null),(0,H.e)([(0,E.L)()],M.prototype,"intensityMode",null),(0,H.e)([(0,E.L)()],M.prototype,"radius",null),(0,H.e)([(0,E.L)()],M.prototype,"_renderPriority",void 0),(0,H.e)([(0,E.c)("_reorderLightsInScene")],M.prototype,"renderPriority",void 0),(0,H.e)([(0,E.L)("shadowEnabled")],M.prototype,"_shadowEnabled",void 0),(0,H.e)([(0,E.L)("excludeWithLayerMask")],M.prototype,"_excludeWithLayerMask",void 0),(0,H.e)([(0,E.L)("includeOnlyWithLayerMask")],M.prototype,"_includeOnlyWithLayerMask",void 0),(0,H.e)([(0,E.L)("lightmapMode")],M.prototype,"_lightmapMode",void 0)},11204:(z,u,Y)=>{Y.d(u,{d:()=>H});class H{static CompareLightsPriority(z,u){return z.shadowEnabled!==u.shadowEnabled?(u.shadowEnabled?1:0)-(z.shadowEnabled?1:0):u.renderPriority-z.renderPriority}}H.FALLOFF_DEFAULT=0,H.FALLOFF_PHYSICAL=1,H.FALLOFF_GLTF=2,H.FALLOFF_STANDARD=3,H.LIGHTMAP_DEFAULT=0,H.LIGHTMAP_SPECULAR=1,H.LIGHTMAP_SHADOWSONLY=2,H.INTENSITYMODE_AUTOMATIC=0,H.INTENSITYMODE_LUMINOUSPOWER=1,H.INTENSITYMODE_LUMINOUSINTENSITY=2,H.INTENSITYMODE_ILLUMINANCE=3,H.INTENSITYMODE_LUMINANCE=4,H.LIGHTTYPEID_POINTLIGHT=0,H.LIGHTTYPEID_DIRECTIONALLIGHT=1,H.LIGHTTYPEID_SPOTLIGHT=2,H.LIGHTTYPEID_HEMISPHERICLIGHT=3,H.LIGHTTYPEID_RECT_AREALIGHT=4},11690:(z,u,Y)=>{Y.d(u,{d:()=>b});var H=Y(11079),E=Y(11082),J=Y(10903),l=Y(11637),T=Y(11256);class b extends l.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=J.b.Identity(),this._projectionMatrix=J.b.Identity()}_setPosition(z){this._position=z}get position(){return this._position}set position(z){this._setPosition(z)}_setDirection(z){this._direction=z}get direction(){return this._direction}set direction(z){this._setDirection(z)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(z){this._shadowMinZ=z,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(z){this._shadowMaxZ=z,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=J.p.Zero()),J.p.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=J.p.Zero()),J.p.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(z){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(z){return this.direction=J.p.Normalize(z.JY(this.position)),this.direction}getRotation(){this.direction.normalize();const z=J.p.Cross(this.direction,T.c.Y),u=J.p.Cross(z,this.direction);return J.p.RotationFromAxis(z,u,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=J.p.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}pl(z){return!z&&this.isSynchronized()?(this._currentRenderId=this.iz().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.J(this.position),this._worldMatrix||(this._worldMatrix=J.b.Identity()),J.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(z){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===z||void 0===z?void 0:z.uT)||0}getDepthMaxZ(z){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===z||void 0===z?void 0:z.maxZ)||1e4}setShadowProjectionMatrix(z,u,Y){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(u,Y,z):this._setDefaultShadowProjectionMatrix(z,u,Y),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(z){const u=J.i.Pl[0];let Y=this.position;this.computeTransformedInformation()&&(Y=this.transformedPosition),J.p.NormalizeToRef(this.getShadowDirection(z),u),1===Math.abs(J.p.Dot(u,J.p.Up()))&&(u.z=1e-13);const H=J.i.Pl[1];return Y.addToRef(u,H),J.b.LookAtLHToRef(Y,H,J.p.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(z,u){return this.setShadowProjectionMatrix(this._projectionMatrix,z??this._viewMatrix,u??[]),this._projectionMatrix}}(0,H.e)([(0,E.K)()],b.prototype,"position",null),(0,H.e)([(0,E.K)()],b.prototype,"direction",null),(0,H.e)([(0,E.L)()],b.prototype,"shadowMinZ",null),(0,H.e)([(0,E.L)()],b.prototype,"shadowMaxZ",null)},11306:(z,u,Y)=>{Y.d(u,{e:()=>H});class H{static get ForceFullSceneLoadingForIncremental(){return H._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(z){H._ForceFullSceneLoadingForIncremental=z}static get ShowLoadingScreen(){return H._ShowLoadingScreen}static set ShowLoadingScreen(z){H._ShowLoadingScreen=z}static get loggingLevel(){return H._LoggingLevel}static set loggingLevel(z){H._LoggingLevel=z}static get CleanBoneMatrixWeights(){return H._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(z){H._CleanBoneMatrixWeights=z}}H._ForceFullSceneLoadingForIncremental=!1,H._ShowLoadingScreen=!0,H._CleanBoneMatrixWeights=!1,H._LoggingLevel=0},11497:(z,u,Y)=>{Y.d(u,{e:()=>p});var H=Y(11079),E=Y(11082),J=Y(10953),l=Y(11283),T=Y(11481),b=Y(11504),L=Y(10903),D=Y(11103),g=Y(11559),M=Y(11568);class q extends g.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class C extends M.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRBRDF",90,new q,u),this._useEnergyConservation=C.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=C.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=C.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=C.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=C.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=C.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=C.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=C.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=C.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=C.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=C.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=C.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=C.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=C.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=C.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=C.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=C.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=C.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=z._dirtyCallbacks[16],this._enable(!0)}prepareDefines(z){z.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,z.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,z.SPHERICAL_HARMONICS=this._useSphericalHarmonics,z.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,z.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,z.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,z.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,z.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,z.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}C.DEFAULT_USE_ENERGY_CONSERVATION=!0,C.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,C.DEFAULT_USE_SPHERICAL_HARMONICS=!0,C.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,C.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,C.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,C.DEFAULT_DIFFUSE_MODEL=0,C.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,C.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"useEnergyConservation",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSphericalHarmonics",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"mixIblRadianceWithIrradiance",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"useLegacySpecularEnergyConservation",void 0),(0,H.e)([(0,E.L)("baseDiffuseModel"),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"baseDiffuseModel",void 0),(0,H.e)([(0,E.L)("dielectricSpecularModel"),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"dielectricSpecularModel",void 0),(0,H.e)([(0,E.L)("conductorSpecularModel"),(0,E.c)("_markAllSubMeshesAsMiscDirty")],C.prototype,"conductorSpecularModel",void 0);var K=Y(11572),h=Y(11188),o=Y(11508),d=Y(11077),t=Y(11577),W=Y(11415),Z=Y(11585),s=(Y(11591),Y(11600)),v=Y(11195);class i extends g.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class X extends M.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRClearCoat",100,new i,u),this._isEnabled=!1,this.isEnabled=!1,this.JT=1,this.roughness=0,this._indexOfRefraction=X._DefaultIndexOfRefraction,this.indexOfRefraction=X._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=h.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,u,Y){if(!this._isEnabled)return!0;const H=this._material._disableBumpMap;if(z._areTexturesDirty&&u.texturesEnabled){if(this._texture&&Z.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Z.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(Y.getCaps().standardDerivatives&&this._bumpTexture&&Z.e.ClearCoatBumpTextureEnabled&&!H&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Z.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,u){this._isEnabled?(z.CLEARCOAT=!0,z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,z.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,z._areTexturesDirty&&u.texturesEnabled&&(this._texture&&Z.e.ClearCoatTextureEnabled?(0,v.L)(this._texture,z,"CLEARCOAT_TEXTURE"):z.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&Z.e.ClearCoatTextureEnabled?(0,v.L)(this._textureRoughness,z,"CLEARCOAT_TEXTURE_ROUGHNESS"):z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&Z.e.ClearCoatBumpTextureEnabled?(0,v.L)(this._bumpTexture,z,"CLEARCOAT_BUMP"):z.CLEARCOAT_BUMP=!1,z.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===X._DefaultIndexOfRefraction,this._isTintEnabled?(z.CLEARCOAT_TINT=!0,this._tintTexture&&Z.e.ClearCoatTintTextureEnabled?((0,v.L)(this._tintTexture,z,"CLEARCOAT_TINT_TEXTURE"),z.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):z.CLEARCOAT_TINT_TEXTURE=!1):(z.CLEARCOAT_TINT=!1,z.CLEARCOAT_TINT_TEXTURE=!1))):(z.CLEARCOAT=!1,z.CLEARCOAT_TEXTURE=!1,z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,z.CLEARCOAT_BUMP=!1,z.CLEARCOAT_TINT=!1,z.CLEARCOAT_TINT_TEXTURE=!1,z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,z.CLEARCOAT_DEFAULTIOR=!1,z.CLEARCOAT_TEXTUREDIRECTUV=0,z.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,z.CLEARCOAT_BUMPDIRECTUV=0,z.CLEARCOAT_REMAP_F0=!1,z.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,z.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(z,u,Y,H){if(!this._isEnabled)return;const E=H.materialDefines,J=this._material.isFrozen,l=this._material._disableBumpMap,T=this._material._invertNormalMapX,b=this._material._invertNormalMapY;if(!z.useUbo||!J||!z.isSync){var L,D,g,M;if((this._texture||this._textureRoughness)&&Z.e.ClearCoatTextureEnabled)z.updateFloat4("vClearCoatInfos",(null===(L=this._texture)||void 0===L?void 0:L.coordinatesIndex)??0,(null===(D=this._texture)||void 0===D?void 0:D.level)??0,(null===(g=this._textureRoughness)||void 0===g?void 0:g.coordinatesIndex)??0,(null===(M=this._textureRoughness)||void 0===M?void 0:M.level)??0),this._texture&&(0,v.p)(this._texture,z,"clearCoat"),this._textureRoughness&&!E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.p)(this._textureRoughness,z,"clearCoatRoughness");this._bumpTexture&&Y.getCaps().standardDerivatives&&Z.e.ClearCoatTextureEnabled&&!l&&(z.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,v.p)(this._bumpTexture,z,"clearCoatBump"),u._mirroredCameraPosition?z.updateFloat2("vClearCoatTangentSpaceParams",T?1:-1,b?1:-1):z.updateFloat2("vClearCoatTangentSpaceParams",T?-1:1,b?-1:1)),this._tintTexture&&Z.e.ClearCoatTintTextureEnabled&&(z.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,v.p)(this._tintTexture,z,"clearCoatTint")),z.updateFloat2("vClearCoatParams",this.JT,this.roughness);const H=1-this._indexOfRefraction,J=1+this._indexOfRefraction,q=Math.pow(-H/J,2),C=1/this._indexOfRefraction;z.updateFloat4("vClearCoatRefractionParams",q,C,H,J),this._isTintEnabled&&(z.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),z.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}u.texturesEnabled&&(this._texture&&Z.e.ClearCoatTextureEnabled&&z.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&Z.e.ClearCoatTextureEnabled&&z.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&Y.getCaps().standardDerivatives&&Z.e.ClearCoatBumpTextureEnabled&&!l&&z.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Z.e.ClearCoatTintTextureEnabled&&z.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(z){return this._texture===z||(this._textureRoughness===z||(this._bumpTexture===z||this._tintTexture===z))}getActiveTextures(z){this._texture&&z.push(this._texture),this._textureRoughness&&z.push(this._textureRoughness),this._bumpTexture&&z.push(this._bumpTexture),this._tintTexture&&z.push(this._tintTexture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&z.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&z.push(this._tintTexture)}dispose(z){var u,Y,H,E;z&&(null===(u=this._texture)||void 0===u||u.dispose(),null===(Y=this._textureRoughness)||void 0===Y||Y.dispose(),null===(H=this._bumpTexture)||void 0===H||H.dispose(),null===(E=this._tintTexture)||void 0===E||E.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(z,u,Y){return z.CLEARCOAT_BUMP&&u.addFallback(Y++,"CLEARCOAT_BUMP"),z.CLEARCOAT_TINT&&u.addFallback(Y++,"CLEARCOAT_TINT"),z.CLEARCOAT&&u.addFallback(Y++,"CLEARCOAT"),Y}getSamplers(z){z.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}X._DefaultIndexOfRefraction=1.5,(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isEnabled",void 0),(0,H.e)([(0,E.L)()],X.prototype,"intensity",void 0),(0,H.e)([(0,E.L)()],X.prototype,"roughness",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"indexOfRefraction",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"texture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useRoughnessFromMainTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"textureRoughness",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"remapF0OnInterfaceChange",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"bumpTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isTintEnabled",void 0),(0,H.e)([(0,E.j)()],X.prototype,"tintColor",void 0),(0,H.e)([(0,E.L)()],X.prototype,"tintColorAtDistance",void 0),(0,H.e)([(0,E.L)()],X.prototype,"tintThickness",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"tintTexture",void 0);class Q extends g.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class V extends M.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRIridescence",110,new Q,u),this._isEnabled=!1,this.isEnabled=!1,this.JT=1,this.minimumThickness=V._DefaultMinimumThickness,this.maximumThickness=V._DefaultMaximumThickness,this.indexOfRefraction=V._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,u){if(!this._isEnabled)return!0;if(z._areTexturesDirty&&u.texturesEnabled){if(this._texture&&Z.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&Z.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,u){this._isEnabled?(z.IRIDESCENCE=!0,z._areTexturesDirty&&u.texturesEnabled&&(this._texture&&Z.e.IridescenceTextureEnabled?(0,v.L)(this._texture,z,"IRIDESCENCE_TEXTURE"):z.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&Z.e.IridescenceTextureEnabled?(0,v.L)(this._thicknessTexture,z,"IRIDESCENCE_THICKNESS_TEXTURE"):z.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(z.IRIDESCENCE=!1,z.IRIDESCENCE_TEXTURE=!1,z.IRIDESCENCE_THICKNESS_TEXTURE=!1,z.IRIDESCENCE_TEXTUREDIRECTUV=0,z.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(z,u){if(!this._isEnabled)return;const Y=this._material.isFrozen;if(!z.useUbo||!Y||!z.isSync){var H,E,J,l;if((this._texture||this._thicknessTexture)&&Z.e.IridescenceTextureEnabled)z.updateFloat4("vIridescenceInfos",(null===(H=this._texture)||void 0===H?void 0:H.coordinatesIndex)??0,(null===(E=this._texture)||void 0===E?void 0:E.level)??0,(null===(J=this._thicknessTexture)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(l=this._thicknessTexture)||void 0===l?void 0:l.level)??0),this._texture&&(0,v.p)(this._texture,z,"iridescence"),this._thicknessTexture&&(0,v.p)(this._thicknessTexture,z,"iridescenceThickness");z.updateFloat4("vIridescenceParams",this.JT,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}u.texturesEnabled&&(this._texture&&Z.e.IridescenceTextureEnabled&&z.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&Z.e.IridescenceTextureEnabled&&z.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(z){return this._texture===z||this._thicknessTexture===z}getActiveTextures(z){this._texture&&z.push(this._texture),this._thicknessTexture&&z.push(this._thicknessTexture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&z.push(this._thicknessTexture)}dispose(z){var u,Y;z&&(null===(u=this._texture)||void 0===u||u.dispose(),null===(Y=this._thicknessTexture)||void 0===Y||Y.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(z,u,Y){return z.IRIDESCENCE&&u.addFallback(Y++,"IRIDESCENCE"),Y}getSamplers(z){z.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}V._DefaultMinimumThickness=100,V._DefaultMaximumThickness=400,V._DefaultIndexOfRefraction=1.3,(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,H.e)([(0,E.L)()],V.prototype,"intensity",void 0),(0,H.e)([(0,E.L)()],V.prototype,"minimumThickness",void 0),(0,H.e)([(0,E.L)()],V.prototype,"maximumThickness",void 0),(0,H.e)([(0,E.L)()],V.prototype,"indexOfRefraction",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"thicknessTexture",void 0);class A extends g.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class x extends M.b{set angle(z){this.direction.x=Math.cos(z),this.direction.y=Math.sin(z)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRAnisotropic",110,new A,u),this._isEnabled=!1,this.isEnabled=!1,this.JT=1,this.direction=new L.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=z._dirtyCallbacks[16]}isReadyForSubMesh(z,u){return!this._isEnabled||!(z._areTexturesDirty&&u.texturesEnabled&&this._texture&&Z.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(z,u,Y){this._isEnabled?(z.ANISOTROPIC=this._isEnabled,this._isEnabled&&!Y.isVerticesDataPresent(D.f.TangentKind)&&(z._needUVs=!0,z.MAINUV1=!0),z._areTexturesDirty&&u.texturesEnabled&&(this._texture&&Z.e.AnisotropicTextureEnabled?(0,v.L)(this._texture,z,"ANISOTROPIC_TEXTURE"):z.ANISOTROPIC_TEXTURE=!1),z._areMiscDirty&&(z.ANISOTROPIC_LEGACY=this._legacy)):(z.ANISOTROPIC=!1,z.ANISOTROPIC_TEXTURE=!1,z.ANISOTROPIC_TEXTUREDIRECTUV=0,z.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(z,u){if(!this._isEnabled)return;const Y=this._material.isFrozen;z.useUbo&&Y&&z.isSync||(this._texture&&Z.e.AnisotropicTextureEnabled&&(z.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,v.p)(this._texture,z,"anisotropy")),z.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.JT)),u.texturesEnabled&&this._texture&&Z.e.AnisotropicTextureEnabled&&z.setTexture("anisotropySampler",this._texture)}hasTexture(z){return this._texture===z}getActiveTextures(z){this._texture&&z.push(this._texture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture)}dispose(z){z&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(z,u,Y){return z.ANISOTROPIC&&u.addFallback(Y++,"ANISOTROPIC"),Y}getSamplers(z){z.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(z,u,Y){super.parse(z,u,Y),void 0===z.legacy&&(this.legacy=!0)}}(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0),(0,H.e)([(0,E.L)()],x.prototype,"intensity",void 0),(0,H.e)([(0,E.G)()],x.prototype,"direction",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],x.prototype,"legacy",void 0);class G extends g.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class F extends M.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"Sheen",120,new G,u),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.JT=1,this.color=h.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,u){if(!this._isEnabled)return!0;if(z._areTexturesDirty&&u.texturesEnabled){if(this._texture&&Z.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Z.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,u){this._isEnabled?(z.SHEEN=!0,z.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,z.SHEEN_ROUGHNESS=null!==this._roughness,z.SHEEN_ALBEDOSCALING=this._albedoScaling,z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,z._areTexturesDirty&&u.texturesEnabled&&(this._texture&&Z.e.SheenTextureEnabled?((0,v.L)(this._texture,z,"SHEEN_TEXTURE"),z.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):z.SHEEN_TEXTURE=!1,this._textureRoughness&&Z.e.SheenTextureEnabled?(0,v.L)(this._textureRoughness,z,"SHEEN_TEXTURE_ROUGHNESS"):z.SHEEN_TEXTURE_ROUGHNESS=!1)):(z.SHEEN=!1,z.SHEEN_TEXTURE=!1,z.SHEEN_TEXTURE_ROUGHNESS=!1,z.SHEEN_LINKWITHALBEDO=!1,z.SHEEN_ROUGHNESS=!1,z.SHEEN_ALBEDOSCALING=!1,z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,z.SHEEN_GAMMATEXTURE=!1,z.SHEEN_TEXTUREDIRECTUV=0,z.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(z,u,Y,H){if(!this._isEnabled)return;const E=H.materialDefines,J=this._material.isFrozen;if(!z.useUbo||!J||!z.isSync){var l,T,b,L;if((this._texture||this._textureRoughness)&&Z.e.SheenTextureEnabled)z.updateFloat4("vSheenInfos",(null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(T=this._texture)||void 0===T?void 0:T.level)??0,(null===(b=this._textureRoughness)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(L=this._textureRoughness)||void 0===L?void 0:L.level)??0),this._texture&&(0,v.p)(this._texture,z,"sheen"),this._textureRoughness&&!E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.p)(this._textureRoughness,z,"sheenRoughness");z.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.JT),null!==this._roughness&&z.updateFloat("vSheenRoughness",this._roughness)}u.texturesEnabled&&(this._texture&&Z.e.SheenTextureEnabled&&z.setTexture("sheenSampler",this._texture),this._textureRoughness&&!E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&Z.e.SheenTextureEnabled&&z.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(z){return this._texture===z||this._textureRoughness===z}getActiveTextures(z){this._texture&&z.push(this._texture),this._textureRoughness&&z.push(this._textureRoughness)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&z.push(this._textureRoughness)}dispose(z){var u,Y;z&&(null===(u=this._texture)||void 0===u||u.dispose(),null===(Y=this._textureRoughness)||void 0===Y||Y.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(z,u,Y){return z.SHEEN&&u.addFallback(Y++,"SHEEN"),Y}getSamplers(z){z.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkSheenWithAlbedo",void 0),(0,H.e)([(0,E.L)()],F.prototype,"intensity",void 0),(0,H.e)([(0,E.j)()],F.prototype,"color",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useRoughnessFromMainTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"roughness",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"textureRoughness",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"albedoScaling",void 0);class R extends g.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class w extends M.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(z){this._scene.enableSubSurfaceForPrePass()&&z&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(z))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(z){this._volumeIndexOfRefraction=z>=1?z:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRSubSurface",130,new R,u),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=h.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=h.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=w.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=w.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=z.iz(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=z._dirtyCallbacks[32]}isReadyForSubMesh(z,u){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(z._areTexturesDirty&&u.texturesEnabled){if(this._thicknessTexture&&Z.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&Z.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&Z.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const z=this._getRefractionTexture(u);if(z&&Z.e.RefractionTextureEnabled&&!z.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,u){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return z.SUBSURFACE=!1,z.SS_DISPERSION=!1,z.SS_TRANSLUCENCY=!1,z.SS_SCATTERING=!1,z.SS_REFRACTION=!1,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_THICKNESSANDMASK_TEXTURE=!1,z.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,z.SS_HAS_THICKNESS=!1,z.SS_REFRACTIONINTENSITY_TEXTURE=!1,z.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,z.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,z.SS_REFRACTIONMAP_3D=!1,z.SS_REFRACTIONMAP_OPPOSITEZ=!1,z.SS_LODINREFRACTIONALPHA=!1,z.SS_GAMMAREFRACTION=!1,z.SS_RGBDREFRACTION=!1,z.SS_LINEARSPECULARREFRACTION=!1,z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,z.SS_ALBEDOFORREFRACTIONTINT=!1,z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,z.SS_USE_THICKNESS_AS_DEPTH=!1,z.SS_USE_GLTF_TEXTURES=!1,z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,z.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,z.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(z.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(z._areTexturesDirty){if(z.SUBSURFACE=!0,z.SS_DISPERSION=this._isDispersionEnabled,z.SS_TRANSLUCENCY=this._isTranslucencyEnabled,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,z.SS_SCATTERING=this._isScatteringEnabled,z.SS_THICKNESSANDMASK_TEXTURE=!1,z.SS_REFRACTIONINTENSITY_TEXTURE=!1,z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,z.SS_HAS_THICKNESS=!1,z.SS_USE_GLTF_TEXTURES=!1,z.SS_REFRACTION=!1,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_REFRACTIONMAP_3D=!1,z.SS_GAMMAREFRACTION=!1,z.SS_RGBDREFRACTION=!1,z.SS_LINEARSPECULARREFRACTION=!1,z.SS_REFRACTIONMAP_OPPOSITEZ=!1,z.SS_LODINREFRACTIONALPHA=!1,z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,z.SS_ALBEDOFORREFRACTIONTINT=!1,z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,z.SS_USE_THICKNESS_AS_DEPTH=!1,z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,z.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,z._areTexturesDirty&&u.texturesEnabled&&(this._thicknessTexture&&Z.e.ThicknessTextureEnabled&&(0,v.L)(this._thicknessTexture,z,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&Z.e.RefractionIntensityTextureEnabled&&(0,v.L)(this._refractionIntensityTexture,z,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&Z.e.TranslucencyIntensityTextureEnabled&&(0,v.L)(this._translucencyIntensityTexture,z,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&Z.e.TranslucencyColorTextureEnabled&&((0,v.L)(this._translucencyColorTexture,z,"SS_TRANSLUCENCYCOLOR_TEXTURE"),z.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),z.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,z.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&u.texturesEnabled){const Y=this._getRefractionTexture(u);Y&&Z.e.RefractionTextureEnabled&&(z.SS_REFRACTION=!0,z.SS_REFRACTIONMAP_3D=Y.isCube,z.SS_GAMMAREFRACTION=Y.gammaSpace,z.SS_RGBDREFRACTION=Y.isRGBD,z.SS_LINEARSPECULARREFRACTION=Y.linearSpecularLOD,z.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&Y.isCube?!Y.invertZ:Y.invertZ,z.SS_LODINREFRACTIONALPHA=Y.lodLevelInAlpha,z.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,z.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=Y.isCube&&Y.boundingBoxSize,z.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(z.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(z,u,Y,H){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)z.updateFloat2("vThicknessParam",0,0);else{H.getRenderingMesh().getWorldMatrix().decompose(L.i.Pl[0]);const u=Math.max(Math.abs(L.i.Pl[0].x),Math.abs(L.i.Pl[0].y),Math.abs(L.i.Pl[0].z));z.updateFloat2("vThicknessParam",this.minimumThickness*u,(this.maximumThickness-this.minimumThickness)*u)}}bindForSubMesh(z,u,Y,H){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const E=H.materialDefines,J=this._material.isFrozen,l=this._material.realTimeFiltering,T=E.LODBASEDMICROSFURACE,b=this._getRefractionTexture(u);if(!z.useUbo||!J||!z.isSync){if(this._thicknessTexture&&Z.e.ThicknessTextureEnabled&&(z.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,v.p)(this._thicknessTexture,z,"thickness")),this._refractionIntensityTexture&&Z.e.RefractionIntensityTextureEnabled&&E.SS_REFRACTIONINTENSITY_TEXTURE&&(z.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,v.p)(this._refractionIntensityTexture,z,"refractionIntensity")),this._translucencyColorTexture&&Z.e.TranslucencyColorTextureEnabled&&E.SS_TRANSLUCENCYCOLOR_TEXTURE&&(z.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,v.p)(this._translucencyColorTexture,z,"translucencyColor")),this._translucencyIntensityTexture&&Z.e.TranslucencyIntensityTextureEnabled&&E.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(z.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,v.p)(this._translucencyIntensityTexture,z,"translucencyIntensity")),b&&Z.e.RefractionTextureEnabled){z.rl("refractionMatrix",b.getRefractionTextureMatrix());let u=1;b.isCube||b.depth&&(u=b.depth);const Y=b.getSize().width,H=this.volumeIndexOfRefraction;if(z.updateFloat4("vRefractionInfos",b.level,1/H,u,this._invertRefractionY?-1:1),z.updateFloat4("vRefractionMicrosurfaceInfos",Y,b.lodGenerationScale,b.lodGenerationOffset,1/this.indexOfRefraction),l&&z.updateFloat2("vRefractionFilteringInfo",Y,Math.log2(Y)),b.boundingBoxSize){const u=b;z.updateVector3("vRefractionPosition",u.boundingBoxPosition),z.updateVector3("vRefractionSize",u.boundingBoxSize)}}this._isScatteringEnabled&&z.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),z.updateColor3("vDiffusionDistance",this.diffusionDistance),z.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),z.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),z.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),z.updateFloat("dispersion",this.dispersion)}u.texturesEnabled&&(this._thicknessTexture&&Z.e.ThicknessTextureEnabled&&z.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&Z.e.RefractionIntensityTextureEnabled&&E.SS_REFRACTIONINTENSITY_TEXTURE&&z.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&Z.e.TranslucencyIntensityTextureEnabled&&E.SS_TRANSLUCENCYINTENSITY_TEXTURE&&z.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&Z.e.TranslucencyColorTextureEnabled&&E.SS_TRANSLUCENCYCOLOR_TEXTURE&&z.setTexture("translucencyColorSampler",this._translucencyColorTexture),b&&Z.e.RefractionTextureEnabled&&(T?z.setTexture("refractionSampler",b):(z.setTexture("refractionSampler",b._lodTextureMid||b),z.setTexture("refractionSamplerLow",b._lodTextureLow||b),z.setTexture("refractionSamplerHigh",b._lodTextureHigh||b))))}_getRefractionTexture(z){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?z.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(z){Z.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&z.push(this._refractionTexture)}hasTexture(z){return this._thicknessTexture===z||(this._refractionTexture===z||(this._refractionIntensityTexture===z||(this._translucencyIntensityTexture===z||this._translucencyColorTexture===z)))}hasRenderTargetTextures(){return!!(Z.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(z){this._thicknessTexture&&z.push(this._thicknessTexture),this._refractionTexture&&z.push(this._refractionTexture),this._translucencyColorTexture&&z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&z.push(this._translucencyIntensityTexture)}getAnimatables(z){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&z.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&z.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&z.push(this._translucencyIntensityTexture)}dispose(z){z&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(z,u,Y){return z.SS_SCATTERING&&u.addFallback(Y++,"SS_SCATTERING"),z.SS_TRANSLUCENCY&&u.addFallback(Y++,"SS_TRANSLUCENCY"),Y}getSamplers(z){z.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}w.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,w.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isRefractionEnabled",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isTranslucencyEnabled",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isDispersionEnabled",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markScenePrePassDirty")],w.prototype,"isScatteringEnabled",void 0),(0,H.e)([(0,E.L)()],w.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,H.e)([(0,E.L)()],w.prototype,"refractionIntensity",void 0),(0,H.e)([(0,E.L)()],w.prototype,"translucencyIntensity",void 0),(0,H.e)([(0,E.L)()],w.prototype,"useAlbedoToTintRefraction",void 0),(0,H.e)([(0,E.L)()],w.prototype,"useAlbedoToTintTranslucency",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"thicknessTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"refractionTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"indexOfRefraction",void 0),(0,H.e)([(0,E.L)()],w.prototype,"_volumeIndexOfRefraction",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"volumeIndexOfRefraction",null),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertRefractionY",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"linkRefractionWithTransparency",void 0),(0,H.e)([(0,E.L)()],w.prototype,"minimumThickness",void 0),(0,H.e)([(0,E.L)()],w.prototype,"maximumThickness",void 0),(0,H.e)([(0,E.L)()],w.prototype,"useThicknessAsDepth",void 0),(0,H.e)([(0,E.j)()],w.prototype,"tintColor",void 0),(0,H.e)([(0,E.L)()],w.prototype,"tintColorAtDistance",void 0),(0,H.e)([(0,E.L)()],w.prototype,"dispersion",void 0),(0,H.e)([(0,E.j)()],w.prototype,"diffusionDistance",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useMaskFromThicknessTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"refractionIntensityTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"translucencyIntensityTexture",void 0),(0,H.e)([(0,E.j)()],w.prototype,"translucencyColor",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"translucencyColorTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useGltfStyleTextures",void 0),(0,H.e)([(0,E.L)()],w.prototype,"applyAlbedoAfterSubSurface",void 0),(0,H.e)([(0,E.L)()],w.prototype,"legacyTransluceny",void 0);var c=Y(11603),U=Y(11212),O=Y(11609);const n={effect:null,subMesh:null};class m extends g.d{constructor(z){super(z),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class p extends t.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(z){this._realTimeFiltering=z,this.uD(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(z){this._realTimeFilteringQuality=z,this.uD(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=z||this.iz().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(z,u){super(z,u,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||p.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new L.t(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=h.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new h.c(0,0,0),this._albedoColor=new h.c(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new h.c(1,1,1),this._reflectionColor=new h.c(1,1,1),this._emissiveColor=new h.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=p.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new l.h(16),this._globalAmbientColor=new h.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new C(this),this.clearCoat=new X(this),this.iridescence=new V(this),this.anisotropy=new x(this),this.sheen=new F(this),this.subSurface=new w(this),this.detailMap=new c.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Z.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,T.e)(this.iz()),this.prePassConfiguration=new K.b}get hasRenderTargetTextures(){return!!(Z.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var z;return this._transparencyMode===p.PBRMATERIAL_OPAQUE||this._transparencyMode===p.PBRMATERIAL_ALPHATEST||(null===(z=this.subSurface)||void 0===z?void 0:z.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var z;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(z=this.subSurface)||void 0===z||!z.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===p.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.jl&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==p.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.jl||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(z,u,Y){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const H=u._drawWrapper;if(H.effect&&this.isFrozen&&H._wasPreviouslyReady&&H._wasPreviouslyUsingInstances===Y)return!0;u.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),u.materialDefines=new m(this._eventInfo.defineNames));const E=u.materialDefines;if(this._isReadyForSubMesh(u))return!0;const l=this.iz(),T=l.getEngine();if(E._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,l.texturesEnabled)){if(this._albedoTexture&&Z.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&Z.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&Z.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Z.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Z.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const z=this._getReflectionTexture();if(z&&Z.e.ReflectionTextureEnabled){if(!z.isReadyOrNotBlocking())return!1;var b;if(z.irradianceTexture){if(!z.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!z.sphericalPolynomial&&null!==(b=z.getInternalTexture())&&void 0!==b&&b._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&Z.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Z.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Z.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(T.getCaps().standardDerivatives&&this._bumpTexture&&Z.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Z.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=E,this._eventInfo.subMesh=u,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(E._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(E.AREALIGHTUSED)for(let J=0;J<z.lightSources.length;J++)if(!z.lightSources[J]._isReady())return!1;T.getCaps().standardDerivatives||z.isVerticesDataPresent(D.f.NormalKind)||(z.createNormals(!0),J.b.Warn("PBRMaterial: Normals have been created for the mesh: "+z.name));const L=u.effect,g=E._areLightsDisposed;let M=this._prepareEffect(z,E,this.onCompiled,this.onError,Y,null,u.getRenderingMesh().hasThinInstances),q=!1;if(M)if(this._onEffectCreatedObservable&&(n.effect=M,n.subMesh=u,this._onEffectCreatedObservable.notifyObservers(n)),this.allowShaderHotSwapping&&L&&!M.isReady()){if(M=L,E.markAsUnprocessed(),q=this.isFrozen,g)return E._areLightsDisposed=!0,!1}else l.resetCachedMaterial(),u.setEffect(M,E,this._materialContext);return!(!u.effect||!u.effect.isReady())&&(E._renderId=l.getRenderId(),H._wasPreviouslyReady=!q,H._wasPreviouslyUsingInstances=!!Y,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(z,u){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(z,u,J,l,T),!u.isDirty)return null;u.markAsProcessed();const b=this.iz().getEngine(),L=new s.b;let g=0;u.USESPHERICALINVERTEX&&L.addFallback(g++,"USESPHERICALINVERTEX"),u.FOG&&L.addFallback(g,"FOG"),u.SPECULARAA&&L.addFallback(g,"SPECULARAA"),u.POINTSIZE&&L.addFallback(g,"POINTSIZE"),u.LOGARITHMICDEPTH&&L.addFallback(g,"LOGARITHMICDEPTH"),u.PARALLAX&&L.addFallback(g,"PARALLAX"),u.PARALLAX_RHS&&L.addFallback(g,"PARALLAX_RHS"),u.PARALLAXOCCLUSION&&L.addFallback(g++,"PARALLAXOCCLUSION"),u.ENVIRONMENTBRDF&&L.addFallback(g++,"ENVIRONMENTBRDF"),u.TANGENT&&L.addFallback(g++,"TANGENT"),u.BUMP&&L.addFallback(g++,"BUMP"),g=(0,v.r)(u,L,this._maxSimultaneousLights,g++),u.SPECULARTERM&&L.addFallback(g++,"SPECULARTERM"),u.USESPHERICALFROMREFLECTIONMAP&&L.addFallback(g++,"USESPHERICALFROMREFLECTIONMAP"),u.USEIRRADIANCEMAP&&L.addFallback(g++,"USEIRRADIANCEMAP"),u.LIGHTMAP&&L.addFallback(g++,"LIGHTMAP"),u.NORMAL&&L.addFallback(g++,"NORMAL"),u.AMBIENT&&L.addFallback(g++,"AMBIENT"),u.EMISSIVE&&L.addFallback(g++,"EMISSIVE"),u.VERTEXCOLOR&&L.addFallback(g++,"VERTEXCOLOR"),u.MORPHTARGETS&&L.addFallback(g++,"MORPHTARGETS"),u.MULTIVIEW&&L.addFallback(0,"MULTIVIEW");const M=[D.f.PositionKind];u.NORMAL&&M.push(D.f.NormalKind),u.TANGENT&&M.push(D.f.TangentKind);for(let Y=1;Y<=6;++Y)u["UV"+Y]&&M.push(`uv${1===Y?"":Y}`);u.VERTEXCOLOR&&M.push(D.f.ColorKind),(0,v.t)(M,z,u,L),(0,v.x)(M,u),(0,v.z)(M,z,u),(0,v.s)(M,z,u);let q="pbr";const C=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],h=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=["Material","Scene","Mesh"],t={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:u.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=L,this._eventInfo.fallbackRank=g,this._eventInfo.defines=u,this._eventInfo.uniforms=C,this._eventInfo.attributes=M,this._eventInfo.samplers=h,this._eventInfo.uniformBuffersNames=d,this._eventInfo.customCode=void 0,this._eventInfo.mesh=z,this._eventInfo.indexParameters=t,this._callbackPluginEventGeneric(128,this._eventInfo),O.b.AddUniformsAndSamplers(C,h),K.b.AddUniforms(C),K.b.AddSamplers(h),(0,U.b)(C),o.e&&(o.e.PrepareUniforms(C,u),o.e.PrepareSamplers(h,u)),(0,v.U)({uniformsNames:C,uniformBuffersNames:d,samplers:h,defines:u,maxSimultaneousLights:this._maxSimultaneousLights});const W={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,C,d,h,u,M,W));const Z=u.toString(),i=b.createEffect(q,{attributes:M,uniformsNames:C,uniformBuffersNames:d,samplers:h,defines:Z,fallbacks:L,onCompiled:H,onError:E,indexParameters:t,processFinalCode:W.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:u.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([Y.e(20),Y.e(45)]).then(Y.bind(Y,13319)),Promise.all([Y.e(18),Y.e(46)]).then(Y.bind(Y,13485))]):await Promise.all([Promise.all([Y.e(13),Y.e(48)]).then(Y.bind(Y,13557)),Promise.all([Y.e(12),Y.e(49)]).then(Y.bind(Y,13740))]),this._shadersLoaded=!0}},b);return this._eventInfo.customCode=void 0,i}_prepareDefines(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const J=this.iz(),l=J.getEngine();(0,v.K)(J,z,u,!0,this._maxSimultaneousLights,this._disableLighting),u._needNormals=!0,(0,v.P)(J,u);const T=this.needAlphaBlendingForMesh(z)&&this.iz().useOrderIndependentTransparency;if((0,v.S)(J,u,this.canRenderToMRT&&!T),(0,v.Q)(J,u,T),O.b.PrepareDefines(l.currentRenderPassId,z,u),u.METALLICWORKFLOW=this.isMetallicWorkflow(),u._areTexturesDirty){u._needUVs=!1;for(let z=1;z<=6;++z)u["MAINUV"+z]=!1;if(J.texturesEnabled){u.ALBEDODIRECTUV=0,u.BASE_WEIGHTDIRECTUV=0,u.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,u.AMBIENTDIRECTUV=0,u.OPACITYDIRECTUV=0,u.EMISSIVEDIRECTUV=0,u.REFLECTIVITYDIRECTUV=0,u.MICROSURFACEMAPDIRECTUV=0,u.METALLIC_REFLECTANCEDIRECTUV=0,u.REFLECTANCEDIRECTUV=0,u.BUMPDIRECTUV=0,u.LIGHTMAPDIRECTUV=0,l.getCaps().textureLOD&&(u.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Z.e.DiffuseTextureEnabled?((0,v.L)(this._albedoTexture,u,"ALBEDO"),u.GAMMAALBEDO=this._albedoTexture.gammaSpace):u.ALBEDO=!1,this._baseWeightTexture&&Z.e.BaseWeightTextureEnabled?(0,v.L)(this._baseWeightTexture,u,"BASE_WEIGHT"):u.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&Z.e.BaseDiffuseRoughnessTextureEnabled?(0,v.L)(this._baseDiffuseRoughnessTexture,u,"BASE_DIFFUSE_ROUGHNESS"):u.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&Z.e.AmbientTextureEnabled?((0,v.L)(this._ambientTexture,u,"AMBIENT"),u.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):u.AMBIENT=!1,this._opacityTexture&&Z.e.OpacityTextureEnabled?((0,v.L)(this._opacityTexture,u,"OPACITY"),u.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):u.OPACITY=!1;const z=this._getReflectionTexture();if(z&&Z.e.ReflectionTextureEnabled){switch(u.REFLECTION=!0,u.GAMMAREFLECTION=z.gammaSpace,u.RGBDREFLECTION=z.isRGBD,u.LODINREFLECTIONALPHA=z.lodLevelInAlpha,u.LINEARSPECULARREFLECTION=z.linearSpecularLOD,u.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(u.NUM_SAMPLES=""+this.realTimeFilteringQuality,l._features.needTypeSuffixInShaderConstants&&(u.NUM_SAMPLES=u.NUM_SAMPLES+"u"),u.REALTIME_FILTERING=!0,this.iz().iblCdfGenerator&&(u.IBL_CDF_FILTERING=!0)):u.REALTIME_FILTERING=!1,u.INVERTCUBICMAP=z.coordinatesMode===W.b.INVCUBIC_MODE,u.REFLECTIONMAP_3D=z.isCube,u.REFLECTIONMAP_OPPOSITEZ=u.REFLECTIONMAP_3D&&this.iz().useRightHandedSystem?!z.invertZ:z.invertZ,u.REFLECTIONMAP_CUBIC=!1,u.REFLECTIONMAP_EXPLICIT=!1,u.REFLECTIONMAP_PLANAR=!1,u.REFLECTIONMAP_PROJECTION=!1,u.REFLECTIONMAP_SKYBOX=!1,u.REFLECTIONMAP_SPHERICAL=!1,u.REFLECTIONMAP_EQUIRECTANGULAR=!1,u.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,u.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,z.coordinatesMode){case W.b.EXPLICIT_MODE:u.REFLECTIONMAP_EXPLICIT=!0;break;case W.b.PLANAR_MODE:u.REFLECTIONMAP_PLANAR=!0;break;case W.b.PROJECTION_MODE:u.REFLECTIONMAP_PROJECTION=!0;break;case W.b.SKYBOX_MODE:u.REFLECTIONMAP_SKYBOX=!0;break;case W.b.SPHERICAL_MODE:u.REFLECTIONMAP_SPHERICAL=!0;break;case W.b.EQUIRECTANGULAR_MODE:u.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case W.b.FIXED_EQUIRECTANGULAR_MODE:u.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case W.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:u.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case W.b.CUBIC_MODE:case W.b.INVCUBIC_MODE:default:u.REFLECTIONMAP_CUBIC=!0,u.USE_LOCAL_REFLECTIONMAP_CUBIC=!!z.boundingBoxSize}z.coordinatesMode!==W.b.SKYBOX_MODE&&(z.irradianceTexture?(u.USEIRRADIANCEMAP=!0,u.USESPHERICALFROMREFLECTIONMAP=!1,u.USESPHERICALINVERTEX=!1,z.irradianceTexture._dominantDirection&&(u.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):z.isCube&&(u.USESPHERICALFROMREFLECTIONMAP=!0,u.USEIRRADIANCEMAP=!1,u.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||l.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?u.USESPHERICALINVERTEX=!1:u.USESPHERICALINVERTEX=!0))}else u.REFLECTION=!1,u.REFLECTIONMAP_3D=!1,u.REFLECTIONMAP_SPHERICAL=!1,u.REFLECTIONMAP_PLANAR=!1,u.REFLECTIONMAP_CUBIC=!1,u.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,u.REFLECTIONMAP_PROJECTION=!1,u.REFLECTIONMAP_SKYBOX=!1,u.REFLECTIONMAP_EXPLICIT=!1,u.REFLECTIONMAP_EQUIRECTANGULAR=!1,u.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,u.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,u.INVERTCUBICMAP=!1,u.USESPHERICALFROMREFLECTIONMAP=!1,u.USEIRRADIANCEMAP=!1,u.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,u.USESPHERICALINVERTEX=!1,u.REFLECTIONMAP_OPPOSITEZ=!1,u.LODINREFLECTIONALPHA=!1,u.GAMMAREFLECTION=!1,u.RGBDREFLECTION=!1,u.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&Z.e.LightmapTextureEnabled?((0,v.L)(this._lightmapTexture,u,"LIGHTMAP"),u.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,u.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,u.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):u.LIGHTMAP=!1,this._emissiveTexture&&Z.e.EmissiveTextureEnabled?((0,v.L)(this._emissiveTexture,u,"EMISSIVE"),u.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):u.EMISSIVE=!1,Z.e.SpecularTextureEnabled?(this._metallicTexture?((0,v.L)(this._metallicTexture,u,"REFLECTIVITY"),u.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,u.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,u.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,u.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,u.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,v.L)(this._reflectivityTexture,u,"REFLECTIVITY"),u.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,u.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,u.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):u.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(u.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,v.L)(this._metallicReflectanceTexture,u,"METALLIC_REFLECTANCE"),u.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):u.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,v.L)(this._reflectanceTexture,u,"REFLECTANCE"),u.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):u.REFLECTANCE=!1):(u.METALLIC_REFLECTANCE=!1,u.REFLECTANCE=!1),this._microSurfaceTexture?(0,v.L)(this._microSurfaceTexture,u,"MICROSURFACEMAP"):u.MICROSURFACEMAP=!1):(u.REFLECTIVITY=!1,u.MICROSURFACEMAP=!1),l.getCaps().standardDerivatives&&this._bumpTexture&&Z.e.BumpTextureEnabled&&!this._disableBumpMap?((0,v.L)(this._bumpTexture,u,"BUMP"),this._useParallax&&this._albedoTexture&&Z.e.DiffuseTextureEnabled?(u.PARALLAX=!0,u.PARALLAX_RHS=J.useRightHandedSystem,u.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):u.PARALLAX=!1,u.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(u.BUMP=!1,u.PARALLAX=!1,u.PARALLAX_RHS=!1,u.PARALLAXOCCLUSION=!1,u.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&Z.e.ReflectionTextureEnabled?(u.ENVIRONMENTBRDF=!0,u.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(u.ENVIRONMENTBRDF=!1,u.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?u.ALPHAFROMALBEDO=!0:u.ALPHAFROMALBEDO=!1}u.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===p.LIGHTFALLOFF_STANDARD?(u.USEPHYSICALLIGHTFALLOFF=!1,u.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===p.LIGHTFALLOFF_GLTF?(u.USEPHYSICALLIGHTFALLOFF=!1,u.USEGLTFLIGHTFALLOFF=!0):(u.USEPHYSICALLIGHTFALLOFF=!0,u.USEGLTFLIGHTFALLOFF=!1),u.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.yl&&this._twoSidedLighting?u.TWOSIDEDLIGHTING=!0:u.TWOSIDEDLIGHTING=!1,u.MIRRORED=!!J._mirroredCameraPosition,u.SPECULARAA=l.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(u._areTexturesDirty||u._areMiscDirty)&&(u.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,u.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,u.ALPHABLEND=this.needAlphaBlendingForMesh(z),u.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,u.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),u._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(u),u.FORCENORMALFORWARD=this._forceNormalForward,u.RADIANCEOCCLUSION=this._useRadianceOcclusion,u.HORIZONOCCLUSION=this._useHorizonOcclusion,u._areMiscDirty&&((0,v.O)(z,J,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(z),u,this._applyDecalMapAfterDetailMap),u.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!z.isVerticesDataPresent(D.f.NormalKind),u.DEBUGMODE=this._debugMode),(0,v.G)(J,l,this,u,!!Y,H,E),this._eventInfo.defines=u,this._eventInfo.mesh=z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,v.E)(z,u,!0,!0,!0,this._transparencyMode!==p.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(z,u,Y){const H={clipPlane:!1,useInstances:!1,...Y};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const Y=new m(this._eventInfo.defineNames),E=this._prepareEffect(z,Y,void 0,void 0,H.useInstances,H.clipPlane,z.hasThinInstances);this._onEffectCreatedObservable&&(n.effect=E,n.subMesh=null,this._onEffectCreatedObservable.notifyObservers(n)),E.isReady()?u&&u(this):E.onCompileObservable.add((()=>{u&&u(this)}))})()}buildUniformLayout(){const z=this._uniformBuffer;z.addUniform("vAlbedoInfos",2),z.addUniform("vBaseWeightInfos",2),z.addUniform("vBaseDiffuseRoughnessInfos",2),z.addUniform("vAmbientInfos",4),z.addUniform("vOpacityInfos",2),z.addUniform("vEmissiveInfos",2),z.addUniform("vLightmapInfos",2),z.addUniform("vReflectivityInfos",3),z.addUniform("vMicroSurfaceSamplerInfos",2),z.addUniform("vReflectionInfos",2),z.addUniform("vReflectionFilteringInfo",2),z.addUniform("vReflectionPosition",3),z.addUniform("vReflectionSize",3),z.addUniform("vBumpInfos",3),z.addUniform("albedoMatrix",16),z.addUniform("baseWeightMatrix",16),z.addUniform("baseDiffuseRoughnessMatrix",16),z.addUniform("ambientMatrix",16),z.addUniform("opacityMatrix",16),z.addUniform("emissiveMatrix",16),z.addUniform("lightmapMatrix",16),z.addUniform("reflectivityMatrix",16),z.addUniform("microSurfaceSamplerMatrix",16),z.addUniform("bumpMatrix",16),z.addUniform("vTangentSpaceParams",2),z.addUniform("reflectionMatrix",16),z.addUniform("vReflectionColor",3),z.addUniform("vAlbedoColor",4),z.addUniform("baseWeight",1),z.addUniform("baseDiffuseRoughness",1),z.addUniform("vLightingIntensity",4),z.addUniform("vReflectionMicrosurfaceInfos",3),z.addUniform("vReflectionDominantDirection",3),z.addUniform("pointSize",1),z.addUniform("vReflectivityColor",4),z.addUniform("vEmissiveColor",3),z.addUniform("vAmbientColor",3),z.addUniform("vDebugMode",2),z.addUniform("vMetallicReflectanceFactors",4),z.addUniform("vMetallicReflectanceInfos",2),z.addUniform("metallicReflectanceMatrix",16),z.addUniform("vReflectanceInfos",2),z.addUniform("reflectanceMatrix",16),z.addUniform("vSphericalL00",3),z.addUniform("vSphericalL1_1",3),z.addUniform("vSphericalL10",3),z.addUniform("vSphericalL11",3),z.addUniform("vSphericalL2_2",3),z.addUniform("vSphericalL2_1",3),z.addUniform("vSphericalL20",3),z.addUniform("vSphericalL21",3),z.addUniform("vSphericalL22",3),z.addUniform("vSphericalX",3),z.addUniform("vSphericalY",3),z.addUniform("vSphericalZ",3),z.addUniform("vSphericalXX_ZZ",3),z.addUniform("vSphericalYY_ZZ",3),z.addUniform("vSphericalZZ",3),z.addUniform("vSphericalXY",3),z.addUniform("vSphericalYZ",3),z.addUniform("vSphericalZX",3),z.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(z,u,Y){const H=this.iz(),E=Y.materialDefines;if(!E)return;const J=Y.effect;if(!J)return;this._activeEffect=J,u.getMeshUniformBuffer().bindToEffect(J,"Mesh"),u.transferToEffect(z);const l=H.getEngine();this._uniformBuffer.bindToEffect(J,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,H,u,z,this.isFrozen),O.b.Bind(l.currentRenderPassId,this._activeEffect,u,z,this);const T=H.activeCamera;T?this._uniformBuffer.updateFloat4("cameraInfo",T.uT,T.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=Y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),E.OBJECTSPACE_NORMALMAP&&(z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const L=this._mustRebind(H,J,Y,u.visibility);(0,v.c)(u,this._activeEffect,this.prePassConfiguration);let D=null;const g=this._uniformBuffer;if(L){if(this.bindViewProjection(J),D=this._getReflectionTexture(),!g.useUbo||!this.isFrozen||!g.isSync||Y._drawWrapper._forceRebindOnNextCall){var M;if(H.texturesEnabled){if(this._albedoTexture&&Z.e.DiffuseTextureEnabled&&(g.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,v.p)(this._albedoTexture,g,"albedo")),this._baseWeightTexture&&Z.e.BaseWeightTextureEnabled&&(g.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,v.p)(this._baseWeightTexture,g,"baseWeight")),this._baseDiffuseRoughnessTexture&&Z.e.BaseDiffuseRoughnessTextureEnabled&&(g.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,v.p)(this._baseDiffuseRoughnessTexture,g,"baseDiffuseRoughness")),this._ambientTexture&&Z.e.AmbientTextureEnabled&&(g.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,v.p)(this._ambientTexture,g,"ambient")),this._opacityTexture&&Z.e.OpacityTextureEnabled&&(g.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,v.p)(this._opacityTexture,g,"opacity")),D&&Z.e.ReflectionTextureEnabled){if(g.rl("reflectionMatrix",D.getReflectionTextureMatrix()),g.updateFloat2("vReflectionInfos",D.level*H.iblIntensity,0),D.boundingBoxSize){const z=D;g.updateVector3("vReflectionPosition",z.boundingBoxPosition),g.updateVector3("vReflectionSize",z.boundingBoxSize)}if(this.realTimeFiltering){const z=D.getSize().width;g.updateFloat2("vReflectionFilteringInfo",z,Math.log2(z))}if(E.USEIRRADIANCEMAP)E.USEIRRADIANCEMAP&&E.USE_IRRADIANCE_DOMINANT_DIRECTION&&g.updateVector3("vReflectionDominantDirection",D.irradianceTexture._dominantDirection);else{const z=D.sphericalPolynomial;if(E.USESPHERICALFROMREFLECTIONMAP&&z)if(E.SPHERICAL_HARMONICS){const u=z.preScaledHarmonics;g.updateVector3("vSphericalL00",u.l00),g.updateVector3("vSphericalL1_1",u.l1_1),g.updateVector3("vSphericalL10",u.l10),g.updateVector3("vSphericalL11",u.l11),g.updateVector3("vSphericalL2_2",u.l2_2),g.updateVector3("vSphericalL2_1",u.l2_1),g.updateVector3("vSphericalL20",u.l20),g.updateVector3("vSphericalL21",u.l21),g.updateVector3("vSphericalL22",u.l22)}else g.updateFloat3("vSphericalX",z.x.x,z.x.y,z.x.z),g.updateFloat3("vSphericalY",z.y.x,z.y.y,z.y.z),g.updateFloat3("vSphericalZ",z.z.x,z.z.y,z.z.z),g.updateFloat3("vSphericalXX_ZZ",z.xx.x-z.zz.x,z.xx.y-z.zz.y,z.xx.z-z.zz.z),g.updateFloat3("vSphericalYY_ZZ",z.yy.x-z.zz.x,z.yy.y-z.zz.y,z.yy.z-z.zz.z),g.updateFloat3("vSphericalZZ",z.zz.x,z.zz.y,z.zz.z),g.updateFloat3("vSphericalXY",z.xy.x,z.xy.y,z.xy.z),g.updateFloat3("vSphericalYZ",z.yz.x,z.yz.y,z.yz.z),g.updateFloat3("vSphericalZX",z.zx.x,z.zx.y,z.zx.z)}g.updateFloat3("vReflectionMicrosurfaceInfos",D.getSize().width,D.lodGenerationScale,D.lodGenerationOffset)}this._emissiveTexture&&Z.e.EmissiveTextureEnabled&&(g.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,v.p)(this._emissiveTexture,g,"emissive")),this._lightmapTexture&&Z.e.LightmapTextureEnabled&&(g.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,v.p)(this._lightmapTexture,g,"lightmap")),Z.e.SpecularTextureEnabled&&(this._metallicTexture?(g.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,v.p)(this._metallicTexture,g,"reflectivity")):this._reflectivityTexture&&(g.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,v.p)(this._reflectivityTexture,g,"reflectivity")),this._metallicReflectanceTexture&&(g.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,v.p)(this._metallicReflectanceTexture,g,"metallicReflectance")),this._reflectanceTexture&&E.REFLECTANCE&&(g.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,v.p)(this._reflectanceTexture,g,"reflectance")),this._microSurfaceTexture&&(g.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,v.p)(this._microSurfaceTexture,g,"microSurfaceSampler"))),this._bumpTexture&&l.getCaps().standardDerivatives&&Z.e.BumpTextureEnabled&&!this._disableBumpMap&&(g.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,v.p)(this._bumpTexture,g,"bump"),H._mirroredCameraPosition?g.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):g.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&g.updateFloat("pointSize",this.pointSize),E.METALLICWORKFLOW){var q;h.g.zb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,h.g.zb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const z=(null===(q=this.subSurface)||void 0===q?void 0:q._indexOfRefraction)??1.5,u=1;h.g.zb[0].b=z;const Y=Math.pow((z-u)/(z+u),2);h.g.zb[0].a=Y,g.updateDirectColor4("vReflectivityColor",h.g.zb[0]),g.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else g.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);g.updateColor3("vEmissiveColor",Z.e.EmissiveTextureEnabled?this._emissiveColor:h.c.BlackReadOnly),g.updateColor3("vReflectionColor",this._reflectionColor),!E.SS_REFRACTION&&null!==(M=this.subSurface)&&void 0!==M&&M._linkRefractionWithTransparency?g.updateColor4("vAlbedoColor",this._albedoColor,1):g.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),g.updateFloat("baseWeight",this._baseWeight),g.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*H.environmentIntensity,this._lightingInfos.w=this._specularIntensity,g.updateVector4("vLightingIntensity",this._lightingInfos),H.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),g.updateColor3("vAmbientColor",this._globalAmbientColor),g.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(H.texturesEnabled){if(this._albedoTexture&&Z.e.DiffuseTextureEnabled&&g.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&Z.e.BaseWeightTextureEnabled&&g.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&Z.e.BaseDiffuseRoughnessTextureEnabled&&g.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&Z.e.AmbientTextureEnabled&&g.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Z.e.OpacityTextureEnabled&&g.setTexture("opacitySampler",this._opacityTexture),D&&Z.e.ReflectionTextureEnabled){E.LODBASEDMICROSFURACE?g.setTexture("reflectionSampler",D):(g.setTexture("reflectionSampler",D._lodTextureMid||D),g.setTexture("reflectionSamplerLow",D._lodTextureLow||D),g.setTexture("reflectionSamplerHigh",D._lodTextureHigh||D)),E.USEIRRADIANCEMAP&&g.setTexture("irradianceSampler",D.irradianceTexture);const z=this.iz().iblCdfGenerator;this.realTimeFiltering&&z&&g.setTexture("icdfSampler",z.getIcdfTexture())}E.ENVIRONMENTBRDF&&g.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Z.e.EmissiveTextureEnabled&&g.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Z.e.LightmapTextureEnabled&&g.setTexture("lightmapSampler",this._lightmapTexture),Z.e.SpecularTextureEnabled&&(this._metallicTexture?g.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&g.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&g.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&E.REFLECTANCE&&g.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&g.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&l.getCaps().standardDerivatives&&Z.e.BumpTextureEnabled&&!this._disableBumpMap&&g.setTexture("bumpSampler",this._bumpTexture)}this.iz().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(u)&&this.iz().depthPeelingRenderer.bind(J),this._eventInfo.subMesh=Y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,U.f)(this._activeEffect,this,H),this.bindEyePosition(J)}else H.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(L||!this.isFrozen){var C;if(H.lightsEnabled&&!this._disableLighting&&(0,v.g)(H,u,this._activeEffect,E,this._maxSimultaneousLights),(H.fogEnabled&&u.applyFog&&H.fogMode!==b.d.FOGMODE_NONE||D||this.subSurface.refractionTexture||u.receiveShadows||E.PREPASS)&&this.bindView(J),(0,v.f)(H,u,this._activeEffect,!0),E.NUM_MORPH_INFLUENCERS&&(0,v.i)(u,this._activeEffect),E.BAKED_VERTEX_ANIMATION_TEXTURE)null===(C=u.bakedVertexAnimationManager)||void 0===C||C.bind(J,E.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,v.h)(E,this._activeEffect,H)}this._afterBind(u,this._activeEffect,Y),g.update()}getAnimatables(){const z=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&z.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&z.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&z.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&z.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?z.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&z.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&z.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&z.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&z.push(this._microSurfaceTexture),z}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.iz().environmentTexture}getActiveTextures(){const z=super.getActiveTextures();return this._albedoTexture&&z.push(this._albedoTexture),this._baseWeightTexture&&z.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&z.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&z.push(this._ambientTexture),this._opacityTexture&&z.push(this._opacityTexture),this._reflectionTexture&&z.push(this._reflectionTexture),this._emissiveTexture&&z.push(this._emissiveTexture),this._reflectivityTexture&&z.push(this._reflectivityTexture),this._metallicTexture&&z.push(this._metallicTexture),this._metallicReflectanceTexture&&z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&z.push(this._reflectanceTexture),this._microSurfaceTexture&&z.push(this._microSurfaceTexture),this._bumpTexture&&z.push(this._bumpTexture),this._lightmapTexture&&z.push(this._lightmapTexture),z}hasTexture(z){return!!super.hasTexture(z)||(this._albedoTexture===z||(this._baseWeightTexture===z||(this._baseDiffuseRoughnessTexture===z||(this._ambientTexture===z||(this._opacityTexture===z||(this._reflectionTexture===z||(this._emissiveTexture===z||(this._reflectivityTexture===z||(this._metallicTexture===z||(this._metallicReflectanceTexture===z||(this._reflectanceTexture===z||(this._microSurfaceTexture===z||(this._bumpTexture===z||this._lightmapTexture===z)))))))))))))}setPrePassRenderer(){var z;if(null===(z=this.subSurface)||void 0===z||!z.isScatteringEnabled)return!1;const u=this.iz().enableSubSurfaceForPrePass();return u&&(u.enabled=!0),!0}dispose(z,u){var Y,H,E,J,l,T,b,L,D,g,M,q,C,K;(this._breakShaderLoadedCheck=!0,u)&&(this._environmentBRDFTexture&&this.iz().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(Y=this._albedoTexture)||void 0===Y||Y.dispose(),null===(H=this._baseWeightTexture)||void 0===H||H.dispose(),null===(E=this._baseDiffuseRoughnessTexture)||void 0===E||E.dispose(),null===(J=this._ambientTexture)||void 0===J||J.dispose(),null===(l=this._opacityTexture)||void 0===l||l.dispose(),null===(T=this._reflectionTexture)||void 0===T||T.dispose(),null===(b=this._emissiveTexture)||void 0===b||b.dispose(),null===(L=this._metallicTexture)||void 0===L||L.dispose(),null===(D=this._reflectivityTexture)||void 0===D||D.dispose(),null===(g=this._bumpTexture)||void 0===g||g.dispose(),null===(M=this._lightmapTexture)||void 0===M||M.dispose(),null===(q=this._metallicReflectanceTexture)||void 0===q||q.dispose(),null===(C=this._reflectanceTexture)||void 0===C||C.dispose(),null===(K=this._microSurfaceTexture)||void 0===K||K.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(z,u)}}p.PBRMATERIAL_OPAQUE=d.d.MATERIAL_OPAQUE,p.PBRMATERIAL_ALPHATEST=d.d.MATERIAL_ALPHATEST,p.PBRMATERIAL_ALPHABLEND=d.d.MATERIAL_ALPHABLEND,p.PBRMATERIAL_ALPHATESTANDBLEND=d.d.MATERIAL_ALPHATESTANDBLEND,p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,p.LIGHTFALLOFF_PHYSICAL=0,p.LIGHTFALLOFF_GLTF=1,p.LIGHTFALLOFF_STANDARD=2,p.ForceGLSL=!1,(0,H.e)([(0,E.r)()],p.prototype,"_imageProcessingConfiguration",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsMiscDirty")],p.prototype,"debugMode",void 0)},11479:(z,u,Y)=>{Y.d(u,{c:()=>g});var H=Y(11079),E=Y(11082),J=Y(11481),l=Y(11188),T=Y(11497),b=Y(10918),L=Y(11077),D=Y(11172);class g extends T.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(z){this.subSurface.refractionTexture=z,z?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(z){this.subSurface.indexOfRefraction=z}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(z){this.subSurface.invertRefractionY=z}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(z){this.subSurface.linkRefractionWithTransparency=z,z&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===T.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(z){z!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=z?T.e.LIGHTFALLOFF_PHYSICAL:T.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===T.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(z){z!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=z?T.e.LIGHTFALLOFF_GLTF:T.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(z){this.imageProcessingConfiguration.colorCurvesEnabled=z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(z){this.imageProcessingConfiguration.colorGradingEnabled=z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(z){this._imageProcessingConfiguration.toneMappingEnabled=z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(z){this._imageProcessingConfiguration.exposure=z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(z){this._imageProcessingConfiguration.contrast=z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(z){this._imageProcessingConfiguration.colorGradingTexture=z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(z){this._imageProcessingConfiguration.colorCurves=z}constructor(z,u){super(z,u,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=g.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=l.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new l.c(0,0,0),this.albedoColor=new l.c(1,1,1),this.baseWeight=1,this.reflectivityColor=new l.c(1,1,1),this.reflectionColor=new l.c(1,1,1),this.emissiveColor=new l.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,J.e)(this.iz())}getClassName(){return"PBRMaterial"}clone(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const H=D.d.Clone((()=>new g(z,this.iz())),this,{cloneTexturesOnlyOnce:u});return H.id=z,H.name=z,this.stencil.copyTo(H.stencil),this._clonePlugins(H,Y),H}serialize(){const z=super.serialize();return z.customType="BABYLON.PBRMaterial",z}static Parse(z,u,Y){const H=D.d.Parse((()=>new g(z.name,u)),z,u,Y);return z.stencil&&H.stencil.parse(z.stencil,u,Y),L.d._ParsePlugins(z,H,u,Y),z.clearCoat&&H.clearCoat.parse(z.clearCoat,u,Y),z.anisotropy&&H.anisotropy.parse(z.anisotropy,u,Y),z.brdf&&H.brdf.parse(z.brdf,u,Y),z.sheen&&H.sheen.parse(z.sheen,u,Y),z.subSurface&&H.subSurface.parse(z.subSurface,u,Y),z.iridescence&&H.iridescence.parse(z.iridescence,u,Y),H}}g.PBRMATERIAL_OPAQUE=T.e.PBRMATERIAL_OPAQUE,g.PBRMATERIAL_ALPHATEST=T.e.PBRMATERIAL_ALPHATEST,g.PBRMATERIAL_ALPHABLEND=T.e.PBRMATERIAL_ALPHABLEND,g.PBRMATERIAL_ALPHATESTANDBLEND=T.e.PBRMATERIAL_ALPHATESTANDBLEND,g.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=T.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"directIntensity",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveIntensity",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"environmentIntensity",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"specularIntensity",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"disableBumpMap",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"albedoTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"baseWeightTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"baseDiffuseRoughnessTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTextureStrength",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"opacityTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectionTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectivityTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallic",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"roughness",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicF0Factor",void 0),(0,H.e)([(0,E.j)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicReflectanceColor",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"metallicReflectanceTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectanceTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"microSurfaceTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"bumpTexture",void 0),(0,H.e)([(0,E.C)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty",null)],g.prototype,"lightmapTexture",void 0),(0,H.e)([(0,E.j)("ambient"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientColor",void 0),(0,H.e)([(0,E.j)("albedo"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"albedoColor",void 0),(0,H.e)([(0,E.L)("baseWeight"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"baseWeight",void 0),(0,H.e)([(0,E.L)("baseDiffuseRoughness"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"baseDiffuseRoughness",void 0),(0,H.e)([(0,E.j)("reflectivity"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectivityColor",void 0),(0,H.e)([(0,E.j)("reflection"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectionColor",void 0),(0,H.e)([(0,E.j)("emissive"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveColor",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"microSurface",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useLightmapAsShadowmap",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"useAlphaFromAlbedoTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"forceAlphaTest",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"alphaCutOff",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useSpecularOverAlpha",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAmbientInGrayScale",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,H.e)([(0,E.L)()],g.prototype,"usePhysicalLightFalloff",null),(0,H.e)([(0,E.L)()],g.prototype,"useGLTFLightFalloff",null),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRadianceOverAlpha",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useObjectSpaceNormalMap",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallax",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallaxOcclusion",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"parallaxScaleBias",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsLightsDirty")],g.prototype,"disableLighting",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"forceIrradianceInFragment",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsLightsDirty")],g.prototype,"maxSimultaneousLights",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapX",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapY",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"twoSidedLighting",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useAlphaFresnel",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useLinearAlphaFresnel",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"environmentBRDFTexture",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"forceNormalForward",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"enableSpecularAntiAliasing",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useHorizonOcclusion",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRadianceOcclusion",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],g.prototype,"unlit",void 0),(0,H.e)([(0,E.L)(),(0,E.c)("_markAllSubMeshesAsMiscDirty")],g.prototype,"applyDecalMapAfterDetailMap",void 0),(0,b.d)("BABYLON.PBRMaterial",g)},11058:(z,u,Y)=>{Y.d(u,{d:()=>l});var H=Y(10953);const E=new Map;function J(z,u){(function(z){return E.delete(z)})(z)&&H.b.Warn(`Extension with the name '${z}' already exists`),E.set(z,u)}function l(z,u){"image/ktx"!==u&&"image/ktx2"!==u||(z=".ktx"),E.has(z)||(z.endsWith(".ies")&&J(".ies",(async()=>await Y.e(28).then(Y.bind(Y,13200)).then((z=>new z._IESTextureLoader)))),z.endsWith(".dds")&&J(".dds",(async()=>await Y.e(25).then(Y.bind(Y,13209)).then((z=>new z._DDSTextureLoader)))),z.endsWith(".basis")&&J(".basis",(async()=>await Y.e(29).then(Y.bind(Y,13220)).then((z=>new z._BasisTextureLoader)))),z.endsWith(".env")&&J(".env",(async()=>await Promise.all([Y.e(24),Y.e(30)]).then(Y.bind(Y,13222)).then((z=>new z._ENVTextureLoader)))),z.endsWith(".hdr")&&J(".hdr",(async()=>await Y.e(31).then(Y.bind(Y,13226)).then((z=>new z._HDRTextureLoader)))),(z.endsWith(".ktx")||z.endsWith(".ktx2"))&&(J(".ktx",(async()=>await Y.e(32).then(Y.bind(Y,13232)).then((z=>new z._KTXTextureLoader)))),J(".ktx2",(async()=>await Y.e(32).then(Y.bind(Y,13232)).then((z=>new z._KTXTextureLoader))))),z.endsWith(".tga")&&J(".tga",(async()=>await Y.e(33).then(Y.bind(Y,13238)).then((z=>new z._TGATextureLoader)))),z.endsWith(".exr")&&J(".exr",(async()=>await Y.e(34).then(Y.bind(Y,13244)).then((z=>new z._ExrTextureLoader)))));const H=E.get(z);return H?Promise.resolve(H(u)):null}},11397:(z,u,Y)=>{Y.d(u,{c:()=>M});var H=Y(11079),E=Y(11082),J=Y(10932),l=Y(10903),T=Y(10928),b=Y(11064),L=(Y(10980),Y(11393));class D{get wrapU(){return this._wrapU}set wrapU(z){this._wrapU=z}get wrapV(){return this._wrapV}set wrapV(z){this._wrapV=z}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(z){this._texture&&(this._texture.isCube=z)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(z){this._texture&&(this._texture.is3D=z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(z){this._texture&&(this._texture.is2DArray=z)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(z){return void 0!==(null===z||void 0===z?void 0:z.shareDepth)}constructor(z){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=L.b.Zero(),this._cachedBaseSize=L.b.Zero(),this._initialSamplingMode=2,this._texture=D._IsRenderTargetWrapper(z)?z.texture:z,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(z){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(z,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var g=Y(11172);class M extends D{set jl(z){this._hasAlpha!==z&&(this._hasAlpha=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get jl(){return this._hasAlpha}set getAlphaFromRGB(z){this._getAlphaFromRGB!==z&&(this._getAlphaFromRGB=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(z){this._coordinatesIndex!==z&&(this._coordinatesIndex=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(z){this._coordinatesMode!==z&&(this._coordinatesMode=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(z){this._wrapU=z}get wrapV(){return this._wrapV}set wrapV(z){this._wrapV=z}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(z){this._texture?this._texture.isCube=z:this._isCube=z}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(z){this._texture&&(this._texture.is3D=z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(z){this._texture&&(this._texture.is2DArray=z)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(z){var u;if(this._texture){if(this._texture._gammaSpace===z)return;this._texture._gammaSpace=z}else{if(this._gammaSpace===z)return;this._gammaSpace=z}null===(u=this.iz())||void 0===u||u.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(z){var u;z!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=z),null===(u=this.iz())||void 0===u||u.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(z){this._texture&&(this._texture._lodGenerationOffset=z)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(z){this._texture&&(this._texture._lodGenerationScale=z)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(z){this._texture&&(this._texture._linearSpecularLOD=z)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(z){this._texture&&(this._texture._irradianceTexture=z)}get uid(){return this._uid||(this._uid=(0,b.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=M.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.fl=new J.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,z?M._IsScene(z)?this._scene=z:this._engine=z:this._scene=T.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=u,this._uid=null}iz(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return l.b.IdentityReadOnly}getReflectionTextureMatrix(){return l.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(z){}get canRescale(){return!1}_getFromCache(z,u,Y,H,E,J){const l=this._getEngine();if(!l)return null;const T=l._getUseSRGBBuffer(!!E,u),b=l.getLoadedTexturesCache();for(let L=0;L<b.length;L++){const l=b[L];if((void 0===E||T===l._useSRGBBuffer)&&(void 0===H||H===l.invertY)&&l.url===z&&l.generateMipMaps===!u&&(!Y||Y===l.samplingMode)&&(void 0===J||J===l.isCube))return l.incrementReferences(),l}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const z=this.iz();z&&z.markAllMaterialsAsDirty(1)}readPixels(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const L=this._getEngine();if(!L)return null;const D=this.getSize();let g=D.width,M=D.height;0!==u&&(g/=Math.pow(2,u),M/=Math.pow(2,u),g=Math.round(g),M=Math.round(M)),T=Math.min(g,T),b=Math.min(M,b);try{return this._texture.isCube?L._readTexturePixels(this._texture,T,b,z,u,Y,H,E,J,l):L._readTexturePixels(this._texture,T,b,-1,u,Y,H,E,J,l)}catch(q){return null}}_readPixelsSync(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const J=this.getSize();let l=J.width,T=J.height;const b=this._getEngine();if(!b)return null;0!=u&&(l/=Math.pow(2,u),T/=Math.pow(2,u),l=Math.round(l),T=Math.round(T));try{return this._texture.isCube?b._readTexturePixelsSync(this._texture,l,T,z,u,Y,H,E):b._readTexturePixelsSync(this._texture,l,T,-1,u,Y,H,E)}catch(L){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const z=this._scene.textures.indexOf(this);if(z>=0&&this._scene.textures.splice(z,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const z=this._parentContainer.textures.indexOf(this);z>-1&&this._parentContainer.textures.splice(z,1),this._parentContainer=null}}this.fl.notifyObservers(this),this.fl.clear(),this.metadata=null,super.dispose()}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!z)return null;const u=g.d.Serialize(this);return g.d.AppendSerializedAnimations(this,u),u}static WhenAllReady(z,u){let Y=z.length;if(0!==Y)for(let H=0;H<z.length;H++){const E=z[H];if(E.isReady())0===--Y&&u();else{const z=E.onLoadObservable;z?z.addOnce((()=>{0===--Y&&u()})):0===--Y&&u()}}else u()}static _IsScene(z){return"Scene"===z.getClassName()}}M.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,H.e)([(0,E.L)()],M.prototype,"uniqueId",void 0),(0,H.e)([(0,E.L)()],M.prototype,"name",void 0),(0,H.e)([(0,E.L)()],M.prototype,"displayName",void 0),(0,H.e)([(0,E.L)()],M.prototype,"metadata",void 0),(0,H.e)([(0,E.L)("jl")],M.prototype,"_hasAlpha",void 0),(0,H.e)([(0,E.L)("getAlphaFromRGB")],M.prototype,"_getAlphaFromRGB",void 0),(0,H.e)([(0,E.L)()],M.prototype,"level",void 0),(0,H.e)([(0,E.L)("coordinatesIndex")],M.prototype,"_coordinatesIndex",void 0),(0,H.e)([(0,E.L)()],M.prototype,"optimizeUVAllocation",void 0),(0,H.e)([(0,E.L)("coordinatesMode")],M.prototype,"_coordinatesMode",void 0),(0,H.e)([(0,E.L)()],M.prototype,"wrapU",null),(0,H.e)([(0,E.L)()],M.prototype,"wrapV",null),(0,H.e)([(0,E.L)()],M.prototype,"wrapR",void 0),(0,H.e)([(0,E.L)()],M.prototype,"anisotropicFilteringLevel",void 0),(0,H.e)([(0,E.L)()],M.prototype,"isCube",null),(0,H.e)([(0,E.L)()],M.prototype,"is3D",null),(0,H.e)([(0,E.L)()],M.prototype,"is2DArray",null),(0,H.e)([(0,E.L)()],M.prototype,"gammaSpace",null),(0,H.e)([(0,E.L)()],M.prototype,"invertZ",void 0),(0,H.e)([(0,E.L)()],M.prototype,"lodLevelInAlpha",void 0),(0,H.e)([(0,E.L)()],M.prototype,"lodGenerationOffset",null),(0,H.e)([(0,E.L)()],M.prototype,"lodGenerationScale",null),(0,H.e)([(0,E.L)()],M.prototype,"linearSpecularLOD",null),(0,H.e)([(0,E.C)()],M.prototype,"irradianceTexture",null),(0,H.e)([(0,E.L)()],M.prototype,"isRenderTarget",void 0)},11591:(z,u,Y)=>{var H=Y(11595),E=Y(11397);E.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=H.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((z=>{this._texture._sphericalPolynomial=z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(z){this._texture&&(this._texture._sphericalPolynomial=z)},enumerable:!0,configurable:!0})},11046:(z,u,Y)=>{Y.d(u,{d:()=>l});var H,E=Y(10932),J=Y(11049);!function(z){z[z.Unknown=0]="Unknown",z[z.Url=1]="Url",z[z.Temp=2]="Temp",z[z.Raw=3]="Raw",z[z.Dynamic=4]="Dynamic",z[z.RenderTarget=5]="RenderTarget",z[z.MultiRenderTarget=6]="MultiRenderTarget",z[z.Cube=7]="Cube",z[z.CubeRaw=8]="CubeRaw",z[z.CubePrefiltered=9]="CubePrefiltered",z[z.Raw3D=10]="Raw3D",z[z.Raw2DArray=11]="Raw2DArray",z[z.DepthStencil=12]="DepthStencil",z[z.CubeRawRGBD=13]="CubeRawRGBD",z[z.Depth=14]="Depth"}(H||(H={}));class l extends J.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(z){this.generateMipMaps=z}get uniqueId(){return this._uniqueId}_setUniqueId(z){this._uniqueId=z}getEngine(){return this._engine}get source(){return this._source}constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new E.e,this.onErrorObservable=new E.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=z,this._source=u,this._uniqueId=l._Counter++,Y||(this._hardwareTexture=z._createHardwareTexture())}incrementReferences(){this._references++}updateSize(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,z,u,Y),this.width=z,this.height=u,this.depth=Y,this.baseWidth=z,this.baseHeight=u,this.baseDepth=Y,this._size=z*u*Y}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const z=this.onRebuildCallback(this),u=u=>{u._swapAndDie(this,!1),this.isReady=z.isReady};return void(z.isAsync?z.proxy.then(u):u(z.proxy))}let z;switch(this.source){case 2:case 12:case 14:break;case 1:return void(z=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(z=>{z._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:z=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),z._swapAndDie(this,!1),this.isReady=!0;break;case 10:z=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),z._swapAndDie(this,!1),this.isReady=!0;break;case 11:z=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),z._swapAndDie(this,!1),this.isReady=!0;break;case 4:z=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),z._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(z=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:z=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),z._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return z=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(z=>{z&&z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(z._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(z){var u;let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(u=this._hardwareTexture)||void 0===u||u.setUsage(z._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),z._hardwareTexture=this._hardwareTexture,Y&&(z._isRGBD=this._isRGBD),this._lodTextureHigh&&(z._lodTextureHigh&&z._lodTextureHigh.dispose(),z._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(z._lodTextureMid&&z._lodTextureMid.dispose(),z._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(z._lodTextureLow&&z._lodTextureLow.dispose(),z._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(z._irradianceTexture&&z._irradianceTexture.dispose(),z._irradianceTexture=this._irradianceTexture);const H=this._engine.getLoadedTexturesCache();let E=H.indexOf(this);-1!==E&&H.splice(E,1),E=H.indexOf(z),-1===E&&H.push(z)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}l._Counter=0},11461:(z,u,Y)=>{Y.d(u,{e:()=>E});var H=Y(11415);class E extends H.b{constructor(z,u,Y,E,J){let l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,g=arguments.length>10?arguments[10]:void 0,M=arguments.length>11?arguments[11]:void 0;super(null,J,!l,T,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,D),this.format=E,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==L||(b=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==L||(b=1),this._texture=this._engine.createRawTexture(z,u,Y,E,l,T,b,null,L,D??0,g??!1),this.wrapU=H.b.CLAMP_ADDRESSMODE,this.wrapV=H.b.CLAMP_ADDRESSMODE,this._waitingForData=!!M&&!z)}update(z){this._getEngine().updateRawTexture(this._texture,z,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const z=new E(null,this.getSize().width,this.getSize().height,this.format,this.iz(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return z._texture=this._texture,this._texture.incrementReferences(),z}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(z,u,Y,H){return new E(z,u,Y,1,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(z,u,Y,H){return new E(z,u,Y,2,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(z,u,Y,H){return new E(z,u,Y,0,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(z,u,Y,H){return new E(z,u,Y,4,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(z,u,Y,H){return new E(z,u,Y,5,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(z,u,Y,H){return new E(z,u,Y,5,H,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(z,u,Y,J){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],T=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:H.b.TRILINEAR_SAMPLINGMODE;return new E(z,u,Y,6,J,l,T,b,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(z,u,Y,J){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],T=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:H.b.TRILINEAR_SAMPLINGMODE;return new E(z,u,Y,6,J,l,T,b,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11420:(z,u,Y)=>{Y.d(u,{b:()=>q});var H=Y(10932),E=Y(10903),J=Y(11415),l=Y(11429),T=Y(11070),b=Y(11024),L=Y(10953),D=Y(11434),g=Y(10910);class M{get renderList(){return this._renderList}set renderList(z){this._renderList!==z&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),z&&(this._unObserveRenderList=(0,g.h)(z,this._renderListHasChanged)),this._renderList=z)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(z){z!==this._disableImageProcessing&&(this._disableImageProcessing=z,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(z){if(this._name===z)return;if(this._name=z,!this._scene)return;const u=this._scene.getEngine();for(let Y=0;Y<this._renderPassIds.length;++Y){const z=this._renderPassIds[Y];u._renderPassNames[z]=`${this._name}#${Y}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(z,u){let Y;Y=Array.isArray(z)?z:[z];for(let H=0;H<Y.length;++H)for(let z=0;z<this.options.numPasses;++z){let E=Y[H];Y[H].isAnInstance&&(E=Y[H].sourceMesh),E.setMaterialForRenderPass(this._renderPassIds[z],void 0!==u?Array.isArray(u)?u[z]:u:void 0)}}constructor(z,u,Y){this._unObserveRenderList=null,this._renderListHasChanged=(z,u)=>{const Y=this._renderList?this._renderList.length:0;if(0===u&&Y>0||0===Y)for(const H of this._scene.meshes)H._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new H.e,this.onAfterRenderObservable=new H.e,this.onBeforeRenderingManagerRenderObservable=new H.e,this.onAfterRenderingManagerRenderObservable=new H.e,this.onFastPathRenderObservable=new H.e,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=z,this._scene=u,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...Y},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new D.b(u),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const z=this._scene.getEngine();for(let u=0;u<this.options.numPasses;++u)z.releaseRenderPassId(this._renderPassIds[u]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const z=this._scene.getEngine();for(let u=0;u<this.options.numPasses;++u)this._renderPassIds[u]=z.createRenderPassId(`${this.name}#${u}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(z){this._refreshRate=z,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(z,u){this.prepareRenderList(),this.initRender(z,u);const Y=this._checkReadiness();return this.finishRender(),Y}prepareRenderList(){const z=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let u=0;u<this._waitingRenderList.length;u++){const Y=this._waitingRenderList[u],H=z.getMeshById(Y);H&&this.renderList.push(H)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const z=this._scene.meshes;for(let u=0;u<z.length;u++){const Y=z[u];this.renderListPredicate(Y)&&this.renderList.push(Y)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(z,u){const Y=this._scene.getEngine(),H=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,H&&(H!==this._scene.activeCamera&&(this._scene.setTransformMatrix(H.getViewMatrix(),H.getProjectionMatrix(!0)),this._scene.activeCamera=H),Y.setViewport(H.rigParent?H.rigParent.viewport:H.viewport,z,u)),this._defaultRenderListPrepared=!1}finishRender(){const z=this._scene;this._disableImageProcessing&&(z.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),z.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==z.activeCamera&&z.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),z.getEngine().setViewport(this._currentSceneCamera.viewport)),z.resetCachedMaterial()}render(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=this._scene,H=Y.getEngine(),E=H.currentRenderPassId;H.currentRenderPassId=this._renderPassIds[z],this.onBeforeRenderObservable.notifyObservers(z);if(H.snapshotRendering&&1===H.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(z);else{let u=null;const H=this.renderList?this.renderList:Y.getActiveMeshes().data,E=this.renderList?this.renderList.length:Y.getActiveMeshes().length;this.getCustomRenderList&&(u=this.getCustomRenderList(z,H,E)),u?this._prepareRenderingManager(u,u.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(H,E,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),u=H),this.onBeforeRenderingManagerRenderObservable.notifyObservers(z),this._renderingManager.render(this.customRenderFunction,u,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(z)}u||this.onAfterRenderObservable.notifyObservers(z),H.currentRenderPassId=E}_checkReadiness(){const z=this._scene,u=z.getEngine(),Y=u.currentRenderPassId;let H=!0;z.getViewMatrix()||z.updateTransformMatrix();const E=this.options.numPasses;for(let l=0;l<E&&H;l++){let Y=null;const J=this.renderList?this.renderList:z.getActiveMeshes().data,T=this.renderList?this.renderList.length:z.getActiveMeshes().length;u.currentRenderPassId=this._renderPassIds[l],this.onBeforeRenderObservable.notifyObservers(l),this.getCustomRenderList&&(Y=this.getCustomRenderList(l,J,T)),Y||(Y=J),this.options.doNotChangeAspectRatio||z.updateTransformMatrix(!0);for(let z=0;z<Y.length&&H;++z){const u=Y[z];if(u.isEnabled()&&!u.isBlocked&&u.isVisible&&u.YT)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(u,this.refreshRate,!0)){H=!1;continue}}else if(!u.isReady(!0)){H=!1;continue}}this.onAfterRenderObservable.notifyObservers(l),E>1&&(z.incrementRenderId(),z.resetCachedMaterial())}const J=this.particleSystemList||z.QM;for(const l of J)l.isReady()||(H=!1);return u.currentRenderPassId=Y,H}_prepareRenderingManager(z,u,Y){const H=this._scene,E=H.activeCamera,J=this.cameraForLOD??E;this._renderingManager.reset();const l=H.getRenderId(),T=H.getFrameId();for(let L=0;L<u;L++){const u=z[L];if(u&&!u.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(u,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!u.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let z,b=null;if(J){const z=u._internalAbstractMeshDataInfo._currentLOD.get(J);z&&z[1]===T?b=z[0]:(b=H.customLODSelector?H.customLODSelector(u,J):u.getLOD(J),z?(z[0]=b,z[1]=T):u._internalAbstractMeshDataInfo._currentLOD.set(J,[b,T]))}else b=u;if(!b)continue;if(b!==u&&0!==b.billboardMode&&b.pl(),b._preActivateForIntermediateRendering(l),z=!(!Y||!E)&&0===(u.layerMask&E.layerMask),u.isEnabled()&&u.isVisible&&u.YT&&!z){if(b!==u&&b._activate(l,!0),u._activate(l,!0)&&u.YT.length){u.isAnInstance?u._internalAbstractMeshDataInfo._actAsRegularMesh&&(b=u):b._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,b._internalAbstractMeshDataInfo._isActiveIntermediate=!0,H._prepareSkeleton(b);for(let z=0;z<b.YT.length;z++){const u=b.YT[z];this._renderingManager.dispatch(u,b)}}u._postActivate()}}}const b=this.particleSystemList||H.QM;for(let L=0;L<b.length;L++){const z=b[L],u=z.k;z.isStarted()&&u&&(!u.position||u.isEnabled())&&this._renderingManager.dispatchParticles(z)}}setRenderingOrder(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(z,u,Y,H)}setRenderingAutoClearDepthStencil(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(z,u,Y,H),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const z=new M(this.name,this._scene,this.options);return this.renderList&&(z.renderList=this.renderList.slice(0)),z}dispose(){const z=this.renderList?this.renderList:this._scene.getActiveMeshes().data,u=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let Y=0;Y<u;Y++){const u=z[Y];u&&void 0!==u.getMaterialForRenderPass(this.renderPassId)&&u.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===M.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=M.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}M.REFRESHRATE_RENDER_ONCE=0,M.REFRESHRATE_RENDER_ONEVERYFRAME=1,M.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,b.d.prototype.setDepthStencilTexture=function(z,u){this._engine.setDepthStencilTexture(this._samplers[z],this._uniforms[z],u,z)};class q extends J.b{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(z){this._objectRenderer.renderListPredicate=z}get renderList(){return this._objectRenderer.renderList}set renderList(z){this._objectRenderer.renderList=z}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(z){this._objectRenderer.particleSystemList=z}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(z){this._objectRenderer.getCustomRenderList=z}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(z){this._objectRenderer.renderParticles=z}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(z){this._objectRenderer.renderSprites=z}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(z){this._objectRenderer.forceLayerMaskCheck=z}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(z){this._objectRenderer.activeCamera=z}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(z){this._objectRenderer.cameraForLOD=z}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(z){this._objectRenderer.disableImageProcessing=z}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(z){this._objectRenderer.customIsReadyFunction=z}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(z){this._objectRenderer.customRenderFunction=z}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(z){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(z)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(z)}set onClear(z){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(z)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(z){this._objectRenderer._waitingRenderList=z}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(z,u){this._objectRenderer.setMaterialForRendering(z,u)}get isMulti(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(z))return;this._boundingBoxSize=z;const u=this.iz();u&&u.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z._depthStencilTexture)??null}constructor(z,u,Y){let l,T,b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:J.b.TRILINEAR_SAMPLINGMODE,K=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],o=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,t=arguments.length>12&&void 0!==arguments[12]&&arguments[12],W=arguments.length>13?arguments[13]:void 0,Z=arguments.length>14?arguments[14]:void 0,s=arguments.length>15&&void 0!==arguments[15]&&arguments[15],v=arguments.length>16&&void 0!==arguments[16]&&arguments[16],i=!0;if("object"===typeof b){const z=b;b=!!z.generateMipMaps,D=z.doNotChangeAspectRatio??!0,g=z.type??0,q=!!z.isCube,C=z.samplingMode??J.b.TRILINEAR_SAMPLINGMODE,K=z.generateDepthBuffer??!0,h=!!z.generateStencilBuffer,o=!!z.isMulti,d=z.format??5,t=!!z.delayAllocation,W=z.samples,Z=z.creationFlags,s=!!z.noColorAttachment,v=!!z.useSRGBBuffer,l=z.colorAttachment,i=z.gammaSpace??i,T=z.existingObjectRenderer}if(super(null,Y,!b,void 0,C,void 0,void 0,void 0,void 0,d),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new H.e,this.onAfterUnbindObservable=new H.e,this.onClearObservable=new H.e,this.onResizeObservable=new H.e,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=E.p.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(Y=this.iz()))return;const X=this.iz().getEngine();this._gammaSpace=i,this._coordinatesMode=J.b.PROJECTION_MODE,this.name=z,this.isRenderTarget=!0,this._initialSizeParameter=u,this._dontDisposeObjectRenderer=!!T,this._processSizeParameter(u),this._objectRenderer=T??new M(z,Y,{numPasses:q?6:this.getRenderLayers()||1,doNotChangeAspectRatio:D}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const z of this._scene._beforeRenderTargetClearStage)z.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(X):this.skipInitialClear||X.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const z of this._scene._beforeRenderTargetDrawStage)z.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var z;if(!this._disableEngineStages)for(const Y of this._scene._afterRenderTargetDrawStage)Y.action(this,this._currentFaceIndex,this._currentLayer);const u=(null===(z=this._texture)||void 0===z?void 0:z.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const Y of this._scene._afterRenderTargetPostProcessStage)Y.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=u),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),X):L.b.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(X):this.skipInitialClear||X.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=X.onResizeObservable.add((()=>{})),this._generateMipMaps=!!b,this._doNotChangeAspectRatio=D,o||(this._renderTargetOptions={generateMipMaps:b,type:g,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:K,generateStencilBuffer:h,samples:W,creationFlags:Z,noColorAttachment:s,useSRGBBuffer:v,colorAttachment:l,label:this.name},this.samplingMode===J.b.NEAREST_SAMPLINGMODE&&(this.wrapU=J.b.CLAMP_ADDRESSMODE,this.wrapV=J.b.CLAMP_ADDRESSMODE),t||(q?(this._renderTarget=Y.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=J.b.INVCUBIC_MODE,this._textureMatrix=E.b.Identity()):this._renderTarget=Y.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==W&&(this.samples=W)))}createDepthStencilTexture(){var z;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,l=arguments.length>5?arguments[5]:void 0;null===(z=this._renderTarget)||void 0===z||z.createDepthStencilTexture(u,Y,H,E,J,l)}_processSizeParameter(z){if(z.ratio){this._sizeRatio=z.ratio;const u=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(u.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(u.getRenderHeight(),this._sizeRatio)}}else this._size=z}get samples(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z.samples)??this._samples}set samples(z){this._renderTarget&&(this._samples=this._renderTarget.setSamples(z))}addPostProcess(z){if(!this._postProcessManager){const z=this.iz();if(!z)return;this._postProcessManager=new l.b(z),this._postProcesses=new Array}this._postProcesses.push(z),this._postProcesses[0].JM=!1}clearPostProcesses(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(z)for(const z of this._postProcesses)z.dispose();this._postProcesses=[]}}removePostProcess(z){if(!this._postProcesses)return;const u=this._postProcesses.indexOf(z);-1!==u&&(this._postProcesses.splice(u,1),this._postProcesses.length>0&&(this._postProcesses[0].JM=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(z){this._objectRenderer.refreshRate=z}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const z=this._size.layers;if(z)return z;const u=this._size.depth;return u||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(z){const u=Math.max(1,this.getRenderSize()*z);this.resize(u)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(z){var u;const Y=this.isCube;null===(u=this._renderTarget)||void 0===u||u.dispose(),this._renderTarget=null;const H=this.iz();H&&(this._processSizeParameter(z),this._renderTarget=Y?H.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):H.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(z,u)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(Y.bind(Y,11473)).then((z=>this._dumpTools=z))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const z=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),z}_render(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=this.iz();if(Y){if(void 0!==this.useCameraPostProcesses&&(z=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let H=0;H<6;H++)this._renderToTarget(H,z,u),Y.incrementRenderId(),Y.resetCachedMaterial();else this._renderToTarget(0,z,u);else for(let H=0;H<this.getRenderLayers();H++)this._renderToTarget(0,z,u,H),Y.incrementRenderId(),Y.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(z,u){const Y=z*u,H=(0,T.k)(Y+16384/(128+Y));return Math.min((0,T.c)(z),H)}_bindFrameBuffer(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.iz();if(!Y)return;const H=Y.getEngine();this._renderTarget&&H.bindFramebuffer(this._renderTarget,this.isCube?z:void 0,void 0,void 0,this.ignoreCameraViewport,0,u)}_unbindFrameBuffer(z,u){this._renderTarget&&z.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(u)}))}_prepareFrame(z,u,Y,H){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(u,Y):H&&z.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(u,Y)}_renderToTarget(z,u,Y){var H,E;let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=this.iz();if(!l)return;const T=l.getEngine();this._currentFaceIndex=z,this._currentLayer=J,this._currentUseCameraPostProcess=u,this._currentDumpForDebug=Y,this._prepareFrame(l,z,J,u),null===(H=T._debugPushGroup)||void 0===H||H.call(T,`render to face #${z} layer #${J}`,2),this._objectRenderer.render(z+J,!0),null===(E=T._debugPopGroup)||void 0===E||E.call(T,2),this._unbindFrameBuffer(T,z),this._texture&&this.isCube&&5===z&&T.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(z,u,Y,H)}setRenderingAutoClearDepthStencil(z,u){this._objectRenderer.setRenderingAutoClearDepthStencil(z,u)}clone(){const z=this.getSize(),u=new q(this.name,z,this.iz(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return u.jl=this.jl,u.level=this.level,u.coordinatesMode=this.coordinatesMode,this.renderList&&(u.renderList=this.renderList.slice(0)),u}serialize(){if(!this.name)return null;const z=super.serialize();if(z.renderTargetSize=this.getRenderSize(),z.renderList=[],this.renderList)for(let u=0;u<this.renderList.length;u++)z.renderList.push(this.renderList[u].id);return z}disposeFramebufferObjects(){var z;null===(z=this._renderTarget)||void 0===z||z.dispose(!0)}releaseInternalTexture(){var z;null===(z=this._renderTarget)||void 0===z||z.releaseTextures(),this._texture=null}dispose(){var z;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.iz().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const u=this.iz();if(!u)return;let Y=u.customRenderTargets.indexOf(this);Y>=0&&u.customRenderTargets.splice(Y,1);for(const H of u.cameras)Y=H.customRenderTargets.indexOf(this),Y>=0&&H.customRenderTargets.splice(Y,1);null===(z=this._renderTarget)||void 0===z||z.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}q.REFRESHRATE_RENDER_ONCE=M.REFRESHRATE_RENDER_ONCE,q.REFRESHRATE_RENDER_ONEVERYFRAME=M.REFRESHRATE_RENDER_ONEVERYFRAME,q.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=M.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,J.b._CreateRenderTargetTexture=(z,u,Y,H,E)=>new q(z,u,Y,H)},11415:(z,u,Y)=>{Y.d(u,{b:()=>t});var H=Y(11079),E=Y(11082),J=Y(10932),l=Y(10903),T=Y(11397),b=Y(10918),L=Y(10970),D=Y(11009),g=Y(11061),M=Y(11170),q=Y(10990);function C(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=u.width,E=u.height;if(z instanceof Float32Array){let u=z.byteLength/z.BYTES_PER_ELEMENT;const Y=new Uint8Array(u);for(;--u>=0;){let H=z[u];H<0?H=0:H>1&&(H=1),Y[u]=255*H}z=Y}const J=document.createElement("canvas");J.width=H,J.height=E;const l=J.getContext("2d");if(!l)return null;const T=l.createImageData(H,E);if(T.data.set(z),l.putImageData(T,0,0),Y){const z=document.createElement("canvas");z.width=H,z.height=E;const u=z.getContext("2d");return u?(u.translate(0,E),u.scale(1,-1),u.drawImage(J,0,0),z.toDataURL("image/png")):null}return J.toDataURL("image/png")}function K(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=z.getInternalTexture();if(!H)return null;const E=z._readPixelsSync(u,Y);return E?C(E,z.getSize(),H.invertY):null}async function h(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=z.getInternalTexture();if(!H)return null;const E=await z.readPixels(u,Y);return E?C(E,z.getSize(),H.invertY):null}var o=Y(11309),d=Y(11172);class t extends T.c{static _CreateVideoTexture(z,u,Y){arguments.length>5&&void 0!==arguments[5]||t.TRILINEAR_SAMPLINGMODE;throw(0,L.e)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(z){this._isBlocking=z}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(z,u,Y,H){let E,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.TRILINEAR_SAMPLINGMODE,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9?arguments[9]:void 0,q=arguments.length>10?arguments[10]:void 0,C=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0,h=arguments.length>13?arguments[13]:void 0;super(u),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new J.e,this._isBlocking=!0,this.name=z||"",this.url=z;let d=!1,W=null,Z=!0;"object"===typeof Y&&null!==Y?(E=Y.noMipmap??!1,H=Y.invertY??!o.b,l=Y.samplingMode??t.TRILINEAR_SAMPLINGMODE,T=Y.P??null,b=Y.onError??null,L=Y.buffer??null,g=Y.deleteBuffer??!1,M=Y.format,q=Y.mimeType,C=Y.loaderOptions,K=Y.creationFlags,d=Y.useSRGBBuffer??!1,W=Y.internalTexture??null,Z=Y.gammaSpace??Z,h=Y.forcedExtension??h):E=!!Y,this._gammaSpace=Z,this._noMipmap=E,this._invertY=void 0===H?!o.b:H,this._initialSamplingMode=l,this._buffer=L,this._deleteBuffer=g,this._mimeType=q,this._loaderOptions=C,this._creationFlags=K,this._useSRGBBuffer=d,this._forcedExtension=h,void 0!==M&&(this._format=M);const s=this.iz(),v=this._getEngine();if(!v)return;v.onBeforeTextureInitObservable.notifyObservers(this);const i=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),T&&T(),!this.isBlocking&&s&&s.resetCachedMaterial()},X=(z,u)=>{this._loadingError=!0,this._errorObject={message:z,exception:u},b&&b(z,u),t.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!W)return this._delayedOnLoad=i,void(this._delayedOnError=X);if(this._texture=W??this._getFromCache(this.url,E,l,this._invertY,d,this.isCube),this._texture)if(this._texture.isReady)D.b.SetImmediate((()=>i()));else{const z=this._texture.onLoadedObservable.add(i);this._texture.onErrorObservable.add((u=>{var Y;X(u.message,u.exception),null===(Y=this._texture)||void 0===Y||Y.onLoadedObservable.remove(z)}))}else if(s&&s.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=X;else{try{this._texture=v.createTexture(this.url,E,this._invertY,s,l,i,X,this._buffer,void 0,this._format,this._forcedExtension,q,C,K,d)}catch(Q){throw X("error loading",Q),Q}g&&(this._buffer=null)}}updateURL(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.iz().markAllMaterialsAsDirty(1,(z=>z.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=z),this.url=z,this._buffer=u,this._forcedExtension=H,this.delayLoadState=4,Y&&(this._delayedOnLoad=Y),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const z=this.iz();z&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?D.b.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=z.getEngine().createTexture(this.url,this._noMipmap,this._invertY,z,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(z,u,Y,H){z*=this._cachedUScale,u*=this._cachedVScale,z-=this.uRotationCenter*this._cachedUScale,u-=this.vRotationCenter*this._cachedVScale,Y-=this.wRotationCenter,l.p.TransformCoordinatesFromFloatsToRef(z,u,Y,this._rowGenerationMatrix,H),H.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,H.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,H.z+=this.wRotationCenter}getTextureMatrix(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*z===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*z,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=l.b.Zero(),this._rowGenerationMatrix=new l.b,this._t0=l.p.Zero(),this._t1=l.p.Zero(),this._t2=l.p.Zero()),l.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(l.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,l.i.Matrix[0]),l.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,l.i.Matrix[1]),l.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,l.i.Matrix[2]),l.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,l.i.Matrix[3]),l.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(l.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.dg(this._t0),this._t2.dg(this._t0),l.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const u=this.iz();if(!u)return this._cachedTextureMatrix;const Y=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&Y!==this._cachedIdentity3x2&&u.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const z=this.iz();if(!z)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===z.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=l.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=l.b.Zero());const u=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:l.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:{l.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const u=z.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=u.updateFlag,u.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:l.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return u&&z.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const z={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,P:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return d.d.Clone((()=>new t(this._texture?this._texture.url:null,this.iz(),z)),this)}serialize(){var z;const u=this.name;t.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const Y=super.serialize(t._SerializeInternalTextureUniqueId);if(!Y)return null;if(t.SerializeBuffers||t.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))Y.base64String=this._buffer,Y.name=Y.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const z=this.mimeType||"image/png";Y.base64String=`data:${z};base64,${(0,q.h)(this._buffer)}`}else(t.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(Y.base64String=!this._engine||this._engine._features.supportSyncTextureRead?K(this):h(this));var H;(Y.invertY=this._invertY,Y.samplingMode=this.samplingMode,Y._creationFlags=this._creationFlags,Y._useSRGBBuffer=this._useSRGBBuffer,t._SerializeInternalTextureUniqueId)&&(Y.internalTextureUniqueId=null===(H=this._texture)||void 0===H?void 0:H.uniqueId);return Y.internalTextureLabel=null===(z=this._texture)||void 0===z?void 0:z.label,Y.noMipmap=this._noMipmap,this.name=u,Y}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(z,u,Y){if(z.customType){const H=g.c.Instantiate(z.customType).Parse(z,u,Y);return z.samplingMode&&H.updateSamplingMode&&H._samplingMode&&H._samplingMode!==z.samplingMode&&H.updateSamplingMode(z.samplingMode),H}if(z.isCube&&!z.isRenderTarget)return t._CubeTextureParser(z,u,Y);const H=void 0!==z.internalTextureUniqueId;if(!z.name&&!z.isRenderTarget&&!H)return null;let E;if(H){const Y=u.getEngine().getLoadedTexturesCache();for(const u of Y)if(u.uniqueId===z.internalTextureUniqueId){E=u;break}}const J=u=>{if(u&&u._texture&&(u._texture._cachedWrapU=null,u._texture._cachedWrapV=null,u._texture._cachedWrapR=null),z.samplingMode){const Y=z.samplingMode;u&&u.samplingMode!==Y&&u.updateSamplingMode(Y)}if(u&&z.animations)for(let Y=0;Y<z.animations.length;Y++){const H=z.animations[Y],E=(0,b.c)("BABYLON.Animation");E&&u.animations.push(E.Parse(H))}u&&u._texture&&(H&&!E&&u._texture._setUniqueId(z.internalTextureUniqueId),u._texture.label=z.internalTextureLabel)};return d.d.Parse((()=>{let H=!0;if(z.noMipmap&&(H=!1),z.mirrorPlane){const Y=t._CreateMirror(z.name,z.renderTargetSize,u,H);return Y._waitingRenderList=z.renderList,Y.mirrorPlane=M.b.Nl(z.mirrorPlane),J(Y),Y}if(z.isRenderTarget){let Y=null;if(z.isCube){if(u.reflectionProbes)for(let H=0;H<u.reflectionProbes.length;H++){const Y=u.reflectionProbes[H];if(Y.name===z.name)return Y.cubeTexture}}else Y=t._CreateRenderTargetTexture(z.name,z.renderTargetSize,u,H,z._creationFlags??0),Y._waitingRenderList=z.renderList;return J(Y),Y}if(z.isVideo){const E=t._CreateVideoTexture(Y+(z.url||z.name),Y+(z.src||z.url),u,H,z.invertY,z.samplingMode,z.settings||{});return J(E),E}{let l;if(z.base64String&&!E)l=t.CreateFromBase64String(z.base64String,z.base64String,u,!H,z.invertY,z.samplingMode,(()=>{J(l)}),z._creationFlags??0,z._useSRGBBuffer??!1),l.name=z.name;else{let T;T=z.name&&(z.name.indexOf("://")>0||z.name.startsWith("data:"))?z.name:Y+z.name,z.url&&(z.url.startsWith("data:")||t.UseSerializedUrlIfAny)&&(T=z.url);const b={noMipmap:!H,invertY:z.invertY,samplingMode:z.samplingMode,P:()=>{J(l)},internalTexture:E};l=new t(T,u,b)}return l}}),z,u)}static CreateFromBase64String(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.TRILINEAR_SAMPLINGMODE;return new t("data:"+u,Y,H,E,J,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.TRILINEAR_SAMPLINGMODE,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,D=arguments.length>10?arguments[10]:void 0,g=arguments.length>11?arguments[11]:void 0;return"data:"!==z.substring(0,5)&&(z="data:"+z),new t(z,Y,E,J,l,T,b,u,H,L,void 0,void 0,D,g)}}t.SerializeBuffers=!0,t.ForceSerializeBuffers=!1,t.OnTextureLoadErrorObservable=new J.e,t._SerializeInternalTextureUniqueId=!1,t._CubeTextureParser=(z,u,Y)=>{throw(0,L.e)("CubeTexture")},t._CreateMirror=(z,u,Y,H)=>{throw(0,L.e)("MirrorTexture")},t._CreateRenderTargetTexture=(z,u,Y,H,E)=>{throw(0,L.e)("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=1,t.NEAREST_NEAREST_MIPLINEAR=8,t.BILINEAR_SAMPLINGMODE=2,t.LINEAR_LINEAR_MIPNEAREST=11,t.TRILINEAR_SAMPLINGMODE=3,t.LINEAR_LINEAR_MIPLINEAR=3,t.NEAREST_NEAREST_MIPNEAREST=4,t.NEAREST_LINEAR_MIPNEAREST=5,t.NEAREST_LINEAR_MIPLINEAR=6,t.NEAREST_LINEAR=7,t.NEAREST_NEAREST=1,t.LINEAR_NEAREST_MIPNEAREST=9,t.LINEAR_NEAREST_MIPLINEAR=10,t.LINEAR_LINEAR=2,t.LINEAR_NEAREST=12,t.EXPLICIT_MODE=0,t.SPHERICAL_MODE=1,t.PLANAR_MODE=2,t.CUBIC_MODE=3,t.PROJECTION_MODE=4,t.SKYBOX_MODE=5,t.INVCUBIC_MODE=6,t.EQUIRECTANGULAR_MODE=7,t.FIXED_EQUIRECTANGULAR_MODE=8,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.CLAMP_ADDRESSMODE=0,t.WRAP_ADDRESSMODE=1,t.MIRROR_ADDRESSMODE=2,t.UseSerializedUrlIfAny=!1,(0,H.e)([(0,E.L)()],t.prototype,"url",void 0),(0,H.e)([(0,E.L)()],t.prototype,"uOffset",void 0),(0,H.e)([(0,E.L)()],t.prototype,"vOffset",void 0),(0,H.e)([(0,E.L)()],t.prototype,"uScale",void 0),(0,H.e)([(0,E.L)()],t.prototype,"vScale",void 0),(0,H.e)([(0,E.L)()],t.prototype,"uAng",void 0),(0,H.e)([(0,E.L)()],t.prototype,"vAng",void 0),(0,H.e)([(0,E.L)()],t.prototype,"wAng",void 0),(0,H.e)([(0,E.L)()],t.prototype,"uRotationCenter",void 0),(0,H.e)([(0,E.L)()],t.prototype,"vRotationCenter",void 0),(0,H.e)([(0,E.L)()],t.prototype,"wRotationCenter",void 0),(0,H.e)([(0,E.L)()],t.prototype,"homogeneousRotationInUVTransform",void 0),(0,H.e)([(0,E.L)()],t.prototype,"isBlocking",null),(0,b.d)("BABYLON.Texture",t),d.d._TextureParser=t.Parse},11352:(z,u,Y)=>{function H(z){return 13===z||14===z||15===z||16===z||17===z||18===z||19===z}function E(z){return 13===z||17===z||18===z||19===z}Y.d(u,{c:()=>E,e:()=>H})},11049:(z,u,Y)=>{Y.d(u,{c:()=>H});class H{get wrapU(){return this._cachedWrapU}set wrapU(z){this._cachedWrapU=z}get wrapV(){return this._cachedWrapV}set wrapV(z){this._cachedWrapV=z}get wrapR(){return this._cachedWrapR}set wrapR(z){this._cachedWrapR=z}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(z){this._cachedAnisotropicFilteringLevel=z}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(z){this._comparisonFunction=z}get useMipMaps(){return this._useMipMaps}set useMipMaps(z){this._useMipMaps=z}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=z,this._cachedWrapV=u,this._cachedWrapR=Y,this._cachedAnisotropicFilteringLevel=H,this.samplingMode=E,this._comparisonFunction=J,this}compareSampler(z){return this._cachedWrapU===z._cachedWrapU&&this._cachedWrapV===z._cachedWrapV&&this._cachedWrapR===z._cachedWrapR&&this._cachedAnisotropicFilteringLevel===z._cachedAnisotropicFilteringLevel&&this.samplingMode===z.samplingMode&&this._comparisonFunction===z._comparisonFunction&&this._useMipMaps===z._useMipMaps}}},11212:(z,u,Y)=>{function H(z){-1===z.indexOf("vClipPlane")&&z.push("vClipPlane"),-1===z.indexOf("vClipPlane2")&&z.push("vClipPlane2"),-1===z.indexOf("vClipPlane3")&&z.push("vClipPlane3"),-1===z.indexOf("vClipPlane4")&&z.push("vClipPlane4"),-1===z.indexOf("vClipPlane5")&&z.push("vClipPlane5"),-1===z.indexOf("vClipPlane6")&&z.push("vClipPlane6")}function E(z,u,Y){const H=!!(z.clipPlane??u.clipPlane),E=!!(z.clipPlane2??u.clipPlane2),J=!!(z.clipPlane3??u.clipPlane3),l=!!(z.clipPlane4??u.clipPlane4),T=!!(z.clipPlane5??u.clipPlane5),b=!!(z.clipPlane6??u.clipPlane6);H&&Y.push("#define CLIPPLANE"),E&&Y.push("#define CLIPPLANE2"),J&&Y.push("#define CLIPPLANE3"),l&&Y.push("#define CLIPPLANE4"),T&&Y.push("#define CLIPPLANE5"),b&&Y.push("#define CLIPPLANE6")}function J(z,u,Y){let H=!1;const E=!!(z.clipPlane??u.clipPlane),J=!!(z.clipPlane2??u.clipPlane2),l=!!(z.clipPlane3??u.clipPlane3),T=!!(z.clipPlane4??u.clipPlane4),b=!!(z.clipPlane5??u.clipPlane5),L=!!(z.clipPlane6??u.clipPlane6);return Y.CLIPPLANE!==E&&(Y.CLIPPLANE=E,H=!0),Y.CLIPPLANE2!==J&&(Y.CLIPPLANE2=J,H=!0),Y.CLIPPLANE3!==l&&(Y.CLIPPLANE3=l,H=!0),Y.CLIPPLANE4!==T&&(Y.CLIPPLANE4=T,H=!0),Y.CLIPPLANE5!==b&&(Y.CLIPPLANE5=b,H=!0),Y.CLIPPLANE6!==L&&(Y.CLIPPLANE6=L,H=!0),H}function l(z,u,Y){let H=u.clipPlane??Y.clipPlane;T(z,"vClipPlane",H),H=u.clipPlane2??Y.clipPlane2,T(z,"vClipPlane2",H),H=u.clipPlane3??Y.clipPlane3,T(z,"vClipPlane3",H),H=u.clipPlane4??Y.clipPlane4,T(z,"vClipPlane4",H),H=u.clipPlane5??Y.clipPlane5,T(z,"vClipPlane5",H),H=u.clipPlane6??Y.clipPlane6,T(z,"vClipPlane6",H)}function T(z,u,Y){Y&&z.setFloat4(u,Y.wl.x,Y.wl.y,Y.wl.z,Y.d)}Y.d(u,{b:()=>H,f:()=>l,i:()=>J,l:()=>E})},11513:(z,u,Y)=>{function H(z){z.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}Y.d(u,{c:()=>H})},11342:(z,u,Y)=>{function H(z){return void 0===z.getPipelineContext}Y.d(u,{c:()=>H})},11156:(z,u,Y)=>{Y.d(u,{e:()=>E});var H=Y(11009);class E{static GetEffect(z){return void 0===z.getPipelineContext?z.effect:z}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=z.createDrawContext(),u&&(this.materialContext=z.createMaterialContext())}setEffect(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var H;(this.effect=z,void 0!==u&&(this.defines=u),Y)&&(null===(H=this.drawContext)||void 0===H||H.reset())}dispose(){var z;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const z=this.effect;u?z.dispose():H.b.SetImmediate((()=>{z.getEngine().onEndFrameObservable.addOnce((()=>{z.dispose()}))})),this.effect=null}null===(z=this.drawContext)||void 0===z||z.dispose()}}},11035:(z,u,Y)=>{Y.d(u,{c:()=>g,g:()=>q,i:()=>L,m:()=>D});var H=Y(10948),E=Y(11040),J=Y(11029),l=Y(10953),T=Y(10996),b=Y(11002);function L(z,u){return(0,E.B)(u).cachedPipelines[z]}function D(z){const u=z._name,Y=z.context;if(u&&Y){const z=(0,E.B)(Y),H=z.cachedPipelines[u];null===H||void 0===H||H.dispose(),delete z.cachedPipelines[u]}}function g(z,u,Y,E,J,l,b){let L,D;const g=(0,H.h)()?null===l||void 0===l?void 0:l.getHostDocument():null;L="string"===typeof u?u:u.vertexSource?"source:"+u.vertexSource:u.vertexElement?(null===g||void 0===g?void 0:g.getElementById(u.vertexElement))||u.vertexElement:u.vertex||u,D="string"===typeof u?u:u.fragmentSource?"source:"+u.fragmentSource:u.fragmentElement?(null===g||void 0===g?void 0:g.getElementById(u.fragmentElement))||u.fragmentElement:u.fragment||u;const q=[void 0,void 0],C=()=>{if(q[0]&&q[1]){z.isFragment=!0;const[H,L]=q;(0,T.f)(L,z,((l,L)=>{b&&(b._fragmentSourceCodeBeforeMigration=L),Y&&(l=Y("fragment",l));const D=(0,T.c)(H,l,z);z=null;const g=function(z,u,Y,H){if(Y){return{vertexSourceCode:(1===H?"//":"")+"#define SHADER_NAME vertex:"+(Y.vertexElement||Y.vertex||Y.spectorName||Y)+"\n"+z,fragmentSourceCode:(1===H?"//":"")+"#define SHADER_NAME fragment:"+(Y.fragmentElement||Y.fragment||Y.spectorName||Y)+"\n"+u}}return{vertexSourceCode:z,fragmentSourceCode:u}}(D.vertexCode,D.fragmentCode,u,J);null===E||void 0===E||E(g.vertexSourceCode,g.fragmentSourceCode)}),l)}};M(L,"Vertex","",(u=>{(0,T.d)(z),(0,T.f)(u,z,((z,H)=>{b&&(b._rawVertexSourceCode=u,b._vertexSourceCodeBeforeMigration=H),Y&&(z=Y("vertex",z)),q[0]=z,C()}),l)}),J),M(D,"Fragment","Pixel",(z=>{b&&(b._rawFragmentSourceCode=z),q[1]=z,C()}),J)}function M(z,u,Y,E,l,T){if("undefined"!==typeof HTMLElement&&z instanceof HTMLElement){return void E((0,H.e)(z))}if("source:"===z.substring(0,7))return void E(z.substring(7));if("base64:"===z.substring(0,7)){return void E(window.atob(z.substring(7)))}const L=J.b.GetShadersStore(l);if(L[z+u+"Shader"])return void E(L[z+u+"Shader"]);if(Y&&L[z+Y+"Shader"])return void E(L[z+Y+"Shader"]);let D;if(D="."===z[0]||"/"===z[0]||z.indexOf("http")>-1?z:J.b.GetShadersRepository(l)+z,!(T=T||b.n))throw new Error("loadFileInjection is not defined");T(D+"."+u.toLowerCase()+".fx",E)}const q=(z,u,Y,H)=>{try{const J=z.context?(0,E.B)(z.context):null;J&&(J.disableParallelShaderCompile=z.disableParallelCompilation);const l=z.existingPipelineContext||u(z.shaderProcessingContext);return l._name=z.name,z.name&&J&&(J.cachedPipelines[z.name]=l),Y(l,z.vertex,z.fragment,!!z.createAsRaw,"","",z.rebuildRebind,z.defines,z.transformFeedbackVaryings,"",(()=>{H(l,(()=>{var u;null===(u=z.onRenderingStateCompiled)||void 0===u||u.call(z,l)}))})),l}catch(J){throw l.b.Error("Error compiling effect"),J}}},11024:(z,u,Y)=>{Y.d(u,{d:()=>b});var H=Y(10932),E=Y(10953),J=Y(11029),l=Y(11035),T=Y(11009);class b{static get ShadersRepository(){return J.b.ShadersRepository}static set ShadersRepository(z){J.b.ShadersRepository=z}get L(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new H.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9?arguments[9]:void 0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,K=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new H.e,this.onErrorObservable=new H.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=z,this._key=q;const h=this._key.replace(/\r/g,"").replace(/\n/g,"|");let o;if(u.attributes){const z=u;if(this._engine=Y,this._attributesNames=z.attributes,this._uniformsNames=z.uniformsNames.concat(z.samplers),this._samplerList=z.samplers.slice(),this.defines=z.defines,this.onError=z.onError,this.onCompiled=z.onCompiled,this._fallbacks=z.fallbacks,this._indexParameters=z.indexParameters,this._transformFeedbackVaryings=z.transformFeedbackVaryings||null,this._multiTarget=!!z.multiTarget,this._shaderLanguage=z.shaderLanguage??0,this._disableParallelShaderCompilation=!!z.disableParallelShaderCompilation,z.uniformBuffersNames){this._uniformBuffersNamesList=z.uniformBuffersNames.slice();for(let u=0;u<z.uniformBuffersNames.length;u++)this._uniformBuffersNames[z.uniformBuffersNames[u]]=u}this._processFinalCode=z.processFinalCode??null,this._processCodeAfterIncludes=z.processCodeAfterIncludes??void 0,K=z.extraInitializationsAsync,o=z.existingPipelineContext}else this._engine=J,this.defines=null==T?"":T,this._uniformsNames=Y.concat(E),this._samplerList=E?E.slice():[],this._attributesNames=u,this._uniformBuffersNamesList=[],this._shaderLanguage=C,this.onError=g,this.onCompiled=D,this._indexParameters=M,this._fallbacks=L;"WEBGL2"===this._engine.shaderPlatformName&&(o=(0,l.i)(h,this._engine._gl)??o),this._attributeLocationByName={},this.uniqueId=b._UniqueIdSeed++,o?(this._pipelineContext=o,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,K),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.L||this.dispose(!0)}))}async _processShaderCodeAsync(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3?arguments[3]:void 0;H&&await H(),this._processingContext=Y||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const E={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:z??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:J.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:J.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,l.c)(E,this.name,this._processFinalCode,((z,Y)=>{this._vertexSourceCode=z,this._fragmentSourceCode=Y,this._prepareEffect(u)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.L||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(z){return this._attributes[z]}getAttributeLocationByName(z){return this._attributeLocationByName[z]}getAttributesCount(){return this._attributes.length}getUniformIndex(z){return this._uniformsNames.indexOf(z)}getUniform(z){return this._uniforms[z]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((z=>{this.executeWhenCompiled(z)}))}executeWhenCompiled(z){this.isReady()?z(this):(this.onCompileObservable.add((u=>{z(u)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(z){(0,T.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(u=>{this._processCompilationErrors(u,z)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(z=this._pipelineContext)||void 0===z?void 0:z._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(z=this._pipelineContext)||void 0===z?void 0:z._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(z,u,Y,H){this._isReady=!1,this._vertexSourceCodeOverride=z,this._fragmentSourceCodeOverride=u,this.onError=(z,u)=>{H&&H(u)},this.onCompiled=()=>{var z,u;const H=this.getEngine().scenes;if(H)for(let Y=0;Y<H.length;Y++)H[Y].markAllMaterialsAsDirty(127);null===(z=(u=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===z||z.call(u,Y)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(z){if(this._pipelineContext=z,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let u=0;u<this._attributesNames.length;u++){const z=this._attributesNames[u];this._attributeLocationByName[z]=this._attributes[u]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),b.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this._pipelineContext;this._isReady=!1;try{const Y=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),H=Y?null:this.defines,E=Y?this._vertexSourceCodeOverride:this._vertexSourceCode,J=Y?this._fragmentSourceCodeOverride:this._fragmentSourceCode,T=this._engine;this._pipelineContext=(0,l.g)({existingPipelineContext:z?u:null,vertex:E,fragment:J,context:"WEBGL2"===T.shaderPlatformName||"WEBGL1"===T.shaderPlatformName?T._gl:void 0,rebuildRebind:(z,u,Y,H)=>this._rebuildProgram(z,u,Y,H),defines:H,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Y,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Y=>{u&&!z&&this._engine._deletePipelineContext(u),Y&&this._onRenderingStateCompiled(Y)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(u)}catch(Y){this._processCompilationErrors(Y,u)}}_getShaderCodeAndErrorLine(z,u,Y){const H=Y?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let E=null;if(u&&z){const J=u.match(H);if(J&&2===J.length){const u=parseInt(J[1]),H=z.split("\n",-1);H.length>=u&&(E=`Offending line [${u}] in ${Y?"fragment":"vertex"} code: ${H[u-1]}`)}}return[z,E]}_processCompilationErrors(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=z.message;const Y=this._attributesNames,H=this._fallbacks;if(E.b.Error("Unable to compile effect:"),E.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),E.b.Error(`Attributes: ${Y.join(" ")}`),E.b.Error("Defines:\n"+this.defines),b.LogShaderCodeOnCompilationError){var J,l;let z=null,u=null,Y=null;var T;if(null!==(J=this._pipelineContext)&&void 0!==J&&J._getVertexShaderCode()&&([Y,z]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Y&&(E.b.Error("Vertex code:"),E.b.Error(Y))),null!==(l=this._pipelineContext)&&void 0!==l&&l._getFragmentShaderCode())[Y,u]=this._getShaderCodeAndErrorLine(null===(T=this._pipelineContext)||void 0===T?void 0:T._getFragmentShaderCode(),this._compilationError,!0),Y&&(E.b.Error("Fragment code:"),E.b.Error(Y));z&&E.b.Error(z),u&&E.b.Error(u)}E.b.Error("Error: "+this._compilationError);const L=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};u&&(this._pipelineContext=u,this._isReady=!0,L()),H?(this._pipelineContext=null,H.hasMoreFallbacks?(this._allFallbacksProcessed=!1,E.b.Error("Trying next fallback."),this.defines=H.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,L(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,u||L())}get isSupported(){return""===this._compilationError}_bindTexture(z,u){this._engine._bindTexture(this._samplers[z],u,z)}setTexture(z,u){this._engine.setTexture(this._samplers[z],this._uniforms[z],u,z)}setTextureArray(z,u){const Y=z+"Ex";if(-1===this._samplerList.indexOf(Y+"0")){const H=this._samplerList.indexOf(z);for(let z=1;z<u.length;z++){const u=Y+(z-1).toString();this._samplerList.splice(H+z,0,u)}let E=0;for(const z of this._samplerList)this._samplers[z]=E,E+=1}this._engine.setTextureArray(this._samplers[z],this._uniforms[z],u,z)}bindUniformBuffer(z,u){const Y=this._uniformBuffersNames[u];void 0===Y||b._BaseCache[Y]===z&&this._engine._features.useUBOBindingCache||(b._BaseCache[Y]=z,this._engine.bindUniformBufferBase(z,Y,u))}bindUniformBlock(z,u){this._engine.bindUniformBlock(this._pipelineContext,z,u)}setInt(z,u){return this._pipelineContext.setInt(z,u),this}setInt2(z,u,Y){return this._pipelineContext.setInt2(z,u,Y),this}setInt3(z,u,Y,H){return this._pipelineContext.setInt3(z,u,Y,H),this}setInt4(z,u,Y,H,E){return this._pipelineContext.setInt4(z,u,Y,H,E),this}setIntArray(z,u){return this._pipelineContext.setIntArray(z,u),this}setIntArray2(z,u){return this._pipelineContext.setIntArray2(z,u),this}setIntArray3(z,u){return this._pipelineContext.setIntArray3(z,u),this}setIntArray4(z,u){return this._pipelineContext.setIntArray4(z,u),this}setUInt(z,u){return this._pipelineContext.setUInt(z,u),this}setUInt2(z,u,Y){return this._pipelineContext.setUInt2(z,u,Y),this}setUInt3(z,u,Y,H){return this._pipelineContext.setUInt3(z,u,Y,H),this}setUInt4(z,u,Y,H,E){return this._pipelineContext.setUInt4(z,u,Y,H,E),this}setUIntArray(z,u){return this._pipelineContext.setUIntArray(z,u),this}setUIntArray2(z,u){return this._pipelineContext.setUIntArray2(z,u),this}setUIntArray3(z,u){return this._pipelineContext.setUIntArray3(z,u),this}setUIntArray4(z,u){return this._pipelineContext.setUIntArray4(z,u),this}setFloatArray(z,u){return this._pipelineContext.setArray(z,u),this}setFloatArray2(z,u){return this._pipelineContext.setArray2(z,u),this}setFloatArray3(z,u){return this._pipelineContext.setArray3(z,u),this}setFloatArray4(z,u){return this._pipelineContext.setArray4(z,u),this}setArray(z,u){return this._pipelineContext.setArray(z,u),this}setArray2(z,u){return this._pipelineContext.setArray2(z,u),this}setArray3(z,u){return this._pipelineContext.setArray3(z,u),this}setArray4(z,u){return this._pipelineContext.setArray4(z,u),this}setMatrices(z,u){return this._pipelineContext.setMatrices(z,u),this}setMatrix(z,u){return this._pipelineContext.setMatrix(z,u),this}setMatrix3x3(z,u){return this._pipelineContext.setMatrix3x3(z,u),this}setMatrix2x2(z,u){return this._pipelineContext.setMatrix2x2(z,u),this}setFloat(z,u){return this._pipelineContext.setFloat(z,u),this}setBool(z,u){return this._pipelineContext.setInt(z,u?1:0),this}setVector2(z,u){return this._pipelineContext.setVector2(z,u),this}setFloat2(z,u,Y){return this._pipelineContext.setFloat2(z,u,Y),this}setVector3(z,u){return this._pipelineContext.setVector3(z,u),this}setFloat3(z,u,Y,H){return this._pipelineContext.setFloat3(z,u,Y,H),this}setVector4(z,u){return this._pipelineContext.setVector4(z,u),this}setQuaternion(z,u){return this._pipelineContext.setQuaternion(z,u),this}setFloat4(z,u,Y,H,E){return this._pipelineContext.setFloat4(z,u,Y,H,E),this}setColor3(z,u){return this._pipelineContext.setColor3(z,u),this}setColor4(z,u,Y){return this._pipelineContext.setColor4(z,u,Y),this}setDirectColor4(z,u){return this._pipelineContext.setDirectColor4(z,u),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(b.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,l.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;u&&(J.b.GetShadersStore(H)[`${z}PixelShader`]=u),Y&&(J.b.GetShadersStore(H)[`${z}VertexShader`]=Y)}static ResetCache(){b._BaseCache={}}}b.LogShaderCodeOnCompilationError=!0,b.PersistentMode=!1,b.AutomaticallyClearCodeCache=!1,b._UniqueIdSeed=0,b._BaseCache={},b.ShadersStore=J.b.ShadersStore,b.IncludesShadersStore=J.b.IncludesShadersStore},11600:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(z,u){this._defines[z]||(z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z),this._defines[z]=new Array),this._defines[z].push(u)}addCPUSkinningFallback(z,u){this._mesh=u,z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(z,u){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,z=z.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),u._bonesComputationForcedToCPU=!0;const Y=this._mesh.iz();for(let z=0;z<Y.meshes.length;z++){const H=Y.meshes[z];if(H.material){if(H.computeBonesUsingShaders&&0!==H.numBoneInfluencers)if(H.material.getEffect()===u)H.computeBonesUsingShaders=!1;else if(H.YT)for(const z of H.YT){if(z.effect===u){H.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&H.computeBonesUsingShaders&&H.numBoneInfluencers>0&&(H.computeBonesUsingShaders=!1)}}else{const u=this._defines[this._currentRank];if(u)for(let Y=0;Y<u.length;Y++)z=z.replace("#define "+u[Y],"");this._currentRank++}return z}}},11445:(z,u,Y)=>{Y.d(u,{e:()=>L,g:()=>D});var H=Y(11103),E=Y(11285),J=Y(10932),l=Y(11024),T=Y(11156);Y(11453);const b={Qz:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class L{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;this._fullscreenViewport=new E.c(0,0,1,1);const Y=u.Qz??b.Qz,J=u.indices??b.indices;this.vl=z,this._vertexBuffers={[H.f.PositionKind]:new H.f(z,Y,H.f.PositionKind,!1,!1,2)},this._indexBuffer=z.createIndexBuffer(J),this._indexBufferLength=J.length,this._onContextRestoredObserver=z.onContextRestoredObservable.add((()=>{this._indexBuffer=z.createIndexBuffer(J);for(const z in this._vertexBuffers){this._vertexBuffers[z]._rebuild()}}))}setViewport(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.vl.setViewport(z)}bindBuffers(z){this.vl.bindBuffers(this._vertexBuffers,this._indexBuffer,z)}applyEffectWrapper(z){this.vl.setState(!0),this.vl.depthCullingState.depthTest=!1,this.vl.stencilState.stencilTest=!1,this.vl.enableEffect(z.drawWrapper),this.bindBuffers(z.effect),z.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.vl.depthCullingState.depthTest,this._savedStateStencilTest=this.vl.stencilState.stencilTest}restoreStates(){this.vl.depthCullingState.depthTest=this._savedStateDepthTest,this.vl.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.vl.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(z){return void 0!==z.renderTarget}render(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!z.effect.isReady())return;this.saveStates(),this.setViewport();const Y=null===u?null:this._isRenderTargetTexture(u)?u.renderTarget:u;Y&&this.vl.bindFramebuffer(Y),this.applyEffectWrapper(z),this.draw(),Y&&this.vl.unBindFramebuffer(Y),this.restoreStates()}dispose(){const z=this._vertexBuffers[H.f.PositionKind];z&&(z.dispose(),delete this._vertexBuffers[H.f.PositionKind]),this._indexBuffer&&this.vl._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.vl.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class D{static RegisterShaderCodeProcessing(z,u){u?D._CustomShaderCodeProcessing[z??""]=u:delete D._CustomShaderCodeProcessing[z??""]}static _GetShaderCodeProcessing(z){return D._CustomShaderCodeProcessing[z]??D._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(z){this.options.name=z}isReady(){var z;return(null===(z=this._drawWrapper.effect)||void 0===z?void 0:z.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(z){this._drawWrapper.effect=z}constructor(z){this.alphaMode=0,this.onEffectCreatedObservable=new J.e(void 0,!0),this.onApplyObservable=new J.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...z,name:z.name||"effectWrapper",vl:z.vl,uniforms:z.uniforms||z.uniformNames||[],uniformNames:void 0,samplers:z.samplers||z.samplerNames||[],samplerNames:void 0,attributeNames:z.attributeNames||["position"],uniformBuffers:z.uniformBuffers||[],defines:z.defines||"",useShaderStore:z.useShaderStore||!1,vertexUrl:z.vertexUrl||z.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:z.fragmentShader||"pass",indexParameters:z.indexParameters,blockCompilation:z.blockCompilation||!1,shaderLanguage:z.shaderLanguage||0,onCompiled:z.onCompiled||void 0,extraInitializations:z.extraInitializations||void 0,extraInitializationsAsync:z.extraInitializationsAsync||void 0,useAsPostProcess:z.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),z.vertexUrl||z.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.vl.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new T.e(this.options.vl),this._webGPUReady=1===this.options.shaderLanguage;const u=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,u,this.options.extraInitializations)}_gatherImports(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(z&&this._webGPUReady?u.push(Promise.all([Y.e(42).then(Y.bind(Y,13280))])):u.push(Promise.all([Promise.resolve().then(Y.bind(Y,11453))])))}_postConstructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,H&&this._importPromises.push(...H);const E=this.options.vl.isWebGPU&&!D.ForceGLSL;this._gatherImports(E,this._importPromises),void 0!==Y&&Y(E,this._importPromises),E&&this._webGPUReady&&(this.options.shaderLanguage=1),z||this.updateEffect(u)}updateEffect(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0,b=arguments.length>7?arguments[7]:void 0;const L=D._GetShaderCodeProcessing(this.name);if(null!==L&&void 0!==L&&L.defineCustomBindings){var g,M;const H=(null===(g=u)||void 0===g?void 0:g.slice())??[];H.push(...this.options.uniforms);const E=(null===(M=Y)||void 0===M?void 0:M.slice())??[];E.push(...this.options.samplers),z=L.defineCustomBindings(this.name,z,H,E),u=H,Y=E}this.options.defines=z||"";const q=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let C;C=this.options.extraInitializationsAsync?async()=>{null===q||void 0===q||q(),await this.options.extraInitializationsAsync()}:q,this.options.useShaderStore?this._drawWrapper.effect=this.options.vl.createEffect({vertex:T??this._shaderPath.vertex,fragment:b??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:u||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:Y||this.options.samplers,defines:null!==z?z:"",fallbacks:null,onCompiled:E??this.options.onCompiled,onError:J??null,indexParameters:H||this.options.indexParameters,processCodeAfterIncludes:null!==L&&void 0!==L&&L.processCodeAfterIncludes?(z,u)=>L.processCodeAfterIncludes(this.name,z,u):null,processFinalCode:null!==L&&void 0!==L&&L.processFinalCode?(z,u)=>L.processFinalCode(this.name,z,u):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:C},this.options.vl):this._drawWrapper.effect=new l.d(this._shaderPath,this.options.attributeNames,u||this.options.uniforms,Y||this.options.samplerNames,this.options.vl,z,void 0,E||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,C),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var z,u;let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!Y&&(this.options.vl.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(z=D._GetShaderCodeProcessing(this.name))||void 0===z||null===(u=z.bindCustomBindings)||void 0===u||u.call(z,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}D.ForceGLSL=!1,D._CustomShaderCodeProcessing={}},11522:(z,u,Y)=>{Y.d(u,{b:()=>J,f:()=>E});var H=Y(11513);function E(z,u){u.EXPOSURE&&z.push("exposureLinear"),u.CONTRAST&&z.push("contrast"),u.COLORGRADING&&z.push("colorTransformSettings"),(u.VIGNETTE||u.DITHER)&&z.push("vInverseScreenSize"),u.VIGNETTE&&(z.push("vignetteSettings1"),z.push("vignetteSettings2")),u.COLORCURVES&&(0,H.c)(z),u.DITHER&&z.push("ditherIntensity")}function J(z,u){u.COLORGRADING&&z.push("txColorTransform")}},11508:(z,u,Y)=>{Y.d(u,{e:()=>q});var H=Y(11079),E=Y(11082),J=Y(10932),l=Y(11188),T=Y(11172),b=Y(11513);class L{constructor(){this._dirty=!0,this._tempColor=new l.e(0,0,0,0),this._globalCurve=new l.e(0,0,0,0),this._highlightsCurve=new l.e(0,0,0,0),this._midtonesCurve=new l.e(0,0,0,0),this._shadowsCurve=new l.e(0,0,0,0),this._positiveCurve=new l.e(0,0,0,0),this._negativeCurve=new l.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(z){this._globalHue=z,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(z){this._globalDensity=z,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(z){this._globalSaturation=z,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(z){this._globalExposure=z,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(z){this._highlightsHue=z,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(z){this._highlightsDensity=z,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(z){this._highlightsSaturation=z,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(z){this._highlightsExposure=z,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(z){this._midtonesHue=z,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(z){this._midtonesDensity=z,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(z){this._midtonesSaturation=z,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(z){this._midtonesExposure=z,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(z){this._shadowsHue=z,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(z){this._shadowsDensity=z,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(z){this._shadowsSaturation=z,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(z){this._shadowsExposure=z,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";z._dirty&&(z._dirty=!1,z._getColorGradingDataToRef(z._globalHue,z._globalDensity,z._globalSaturation,z._globalExposure,z._globalCurve),z._getColorGradingDataToRef(z._highlightsHue,z._highlightsDensity,z._highlightsSaturation,z._highlightsExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._highlightsCurve),z._getColorGradingDataToRef(z._midtonesHue,z._midtonesDensity,z._midtonesSaturation,z._midtonesExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._midtonesCurve),z._getColorGradingDataToRef(z._shadowsHue,z._shadowsDensity,z._shadowsSaturation,z._shadowsExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._shadowsCurve),z._highlightsCurve.subtractToRef(z._midtonesCurve,z._positiveCurve),z._midtonesCurve.subtractToRef(z._shadowsCurve,z._negativeCurve)),u&&(u.setFloat4(Y,z._positiveCurve.r,z._positiveCurve.g,z._positiveCurve.b,z._positiveCurve.a),u.setFloat4(H,z._midtonesCurve.r,z._midtonesCurve.g,z._midtonesCurve.b,z._midtonesCurve.a),u.setFloat4(E,z._negativeCurve.r,z._negativeCurve.g,z._negativeCurve.b,z._negativeCurve.a))}_getColorGradingDataToRef(z,u,Y,H,E){null!=z&&(z=L._Clamp(z,0,360),u=L._Clamp(u,-100,100),Y=L._Clamp(Y,-100,100),H=L._Clamp(H,-100,100),u=L._ApplyColorGradingSliderNonlinear(u),u*=.5,H=L._ApplyColorGradingSliderNonlinear(H),u<0&&(u*=-1,z=(z+180)%360),L._FromHSBToRef(z,u,50+.25*H,E),E.scaleToRef(2,E),E.a=1+.01*Y)}static _ApplyColorGradingSliderNonlinear(z){z/=100;let u=Math.abs(z);return u=Math.pow(u,2),z<0&&(u*=-1),u*=100,u}static _FromHSBToRef(z,u,Y,H){let E=L._Clamp(z,0,360);const J=L._Clamp(u/100,0,1),l=L._Clamp(Y/100,0,1);if(0===J)H.r=l,H.g=l,H.b=l;else{E/=60;const z=Math.floor(E),u=E-z,Y=l*(1-J),T=l*(1-J*u),b=l*(1-J*(1-u));switch(z){case 0:H.r=l,H.g=b,H.b=Y;break;case 1:H.r=T,H.g=l,H.b=Y;break;case 2:H.r=Y,H.g=l,H.b=b;break;case 3:H.r=Y,H.g=T,H.b=l;break;case 4:H.r=b,H.g=Y,H.b=l;break;default:H.r=l,H.g=Y,H.b=T}}H.a=1}static _Clamp(z,u,Y){return Math.min(Math.max(z,u),Y)}clone(){return T.d.Clone((()=>new L),this)}serialize(){return T.d.Serialize(this)}static Parse(z){return T.d.Parse((()=>new L),z,null,null)}}L.PrepareUniforms=b.c,(0,H.e)([(0,E.L)()],L.prototype,"_globalHue",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_globalDensity",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_globalSaturation",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_globalExposure",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_highlightsHue",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_highlightsDensity",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_highlightsSaturation",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_highlightsExposure",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_midtonesHue",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_midtonesDensity",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_midtonesSaturation",void 0),(0,H.e)([(0,E.L)()],L.prototype,"_midtonesExposure",void 0),T.d._ColorCurvesParser=L.Parse;var D=Y(11070),g=Y(11522),M=Y(10918);class q{constructor(){this.colorCurves=new L,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=q.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new l.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=q.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new J.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(z){this._colorCurvesEnabled!==z&&(this._colorCurvesEnabled=z,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(z){this._colorGradingTexture!==z&&(this._colorGradingTexture=z,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(z){this._colorGradingEnabled!==z&&(this._colorGradingEnabled=z,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(z){this._colorGradingWithGreenDepth!==z&&(this._colorGradingWithGreenDepth=z,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(z){this._colorGradingBGR!==z&&(this._colorGradingBGR=z,this._updateParameters())}get exposure(){return this._exposure}set exposure(z){this._exposure!==z&&(this._exposure=z,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(z){this._toneMappingEnabled!==z&&(this._toneMappingEnabled=z,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(z){this._toneMappingType!==z&&(this._toneMappingType=z,this._updateParameters())}get contrast(){return this._contrast}set contrast(z){this._contrast!==z&&(this._contrast=z,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(z){this.vignetteCenterY=z}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(z){this.vignetteCenterX=z}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(z){this._vignetteBlendMode!==z&&(this._vignetteBlendMode=z,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(z){this._vignetteEnabled!==z&&(this._vignetteEnabled=z,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(z){this._ditheringEnabled!==z&&(this._ditheringEnabled=z,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(z){this._ditheringIntensity!==z&&(this._ditheringIntensity=z,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(z){this._skipFinalColorClamp!==z&&(this._skipFinalColorClamp=z,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(z){this._applyByPostProcess!==z&&(this._applyByPostProcess=z,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(z){this._isEnabled!==z&&(this._isEnabled=z,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(z){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return z.VIGNETTE=!1,z.TONEMAPPING=0,z.CONTRAST=!1,z.EXPOSURE=!1,z.COLORCURVES=!1,z.COLORGRADING=!1,z.COLORGRADING3D=!1,z.DITHER=!1,z.IMAGEPROCESSING=!1,z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(z.VIGNETTE=this.vignetteEnabled,z.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===q._VIGNETTEMODE_MULTIPLY,z.VIGNETTEBLENDMODEOPAQUE=!z.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case q.TONEMAPPING_KHR_PBR_NEUTRAL:z.TONEMAPPING=3;break;case q.TONEMAPPING_ACES:z.TONEMAPPING=2;break;default:z.TONEMAPPING=1}else z.TONEMAPPING=0;z.CONTRAST=1!==this.contrast,z.EXPOSURE=1!==this.exposure,z.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,z.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,z.COLORGRADING?z.COLORGRADING3D=this.colorGradingTexture.is3D:z.COLORGRADING3D=!1,z.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,z.SAMPLER3DBGRMAP=this.colorGradingBGR,z.DITHER=this._ditheringEnabled,z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,z.IMAGEPROCESSING=z.VIGNETTE||!!z.TONEMAPPING||z.CONTRAST||z.EXPOSURE||z.COLORCURVES||z.COLORGRADING||z.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(z,u){if(this._colorCurvesEnabled&&this.colorCurves&&L.Bind(this.colorCurves,z),this._vignetteEnabled||this._ditheringEnabled){const Y=1/(this.outputTextureWidth||z.getEngine().getRenderWidth()),H=1/(this.outputTextureHeight||z.getEngine().getRenderHeight());if(z.setFloat2("vInverseScreenSize",Y,H),this._ditheringEnabled&&z.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const E=null!=u?u:H/Y;let J=Math.tan(.5*this.vignetteCameraFov),l=J*E;const T=Math.sqrt(l*J);l=(0,D.h)(l,T,this.vignetteStretch),J=(0,D.h)(J,T,this.vignetteStretch),z.setFloat4("vignetteSettings1",l,J,-l*this.vignetteCenterX,-J*this.vignetteCenterY);const b=-2*this.vignetteWeight;z.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,b)}}if(z.setFloat("exposureLinear",this.exposure),z.setFloat("contrast",this.contrast),this.colorGradingTexture){z.setTexture("txColorTransform",this.colorGradingTexture);const u=this.colorGradingTexture.getSize().height;z.setFloat4("colorTransformSettings",(u-1)/u,.5/u,u,this.colorGradingTexture.level)}}clone(){return T.d.Clone((()=>new q),this)}serialize(){return T.d.Serialize(this)}static Parse(z){const u=T.d.Parse((()=>new q),z,null,null);return void 0!==z.vignetteCentreX&&(u.vignetteCenterX=z.vignetteCentreX),void 0!==z.vignetteCentreY&&(u.vignetteCenterY=z.vignetteCentreY),u}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}q.TONEMAPPING_STANDARD=0,q.TONEMAPPING_ACES=1,q.TONEMAPPING_KHR_PBR_NEUTRAL=2,q.PrepareUniforms=g.f,q.PrepareSamplers=g.b,q._VIGNETTEMODE_MULTIPLY=0,q._VIGNETTEMODE_OPAQUE=1,(0,H.e)([(0,E.h)()],q.prototype,"colorCurves",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_colorCurvesEnabled",void 0),(0,H.e)([(0,E.C)("colorGradingTexture")],q.prototype,"_colorGradingTexture",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_colorGradingEnabled",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_colorGradingWithGreenDepth",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_colorGradingBGR",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_exposure",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_toneMappingEnabled",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_toneMappingType",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_contrast",void 0),(0,H.e)([(0,E.L)()],q.prototype,"vignetteStretch",void 0),(0,H.e)([(0,E.L)()],q.prototype,"vignetteCenterX",void 0),(0,H.e)([(0,E.L)()],q.prototype,"vignetteCenterY",void 0),(0,H.e)([(0,E.L)()],q.prototype,"vignetteWeight",void 0),(0,H.e)([(0,E.m)()],q.prototype,"vignetteColor",void 0),(0,H.e)([(0,E.L)()],q.prototype,"vignetteCameraFov",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_vignetteBlendMode",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_vignetteEnabled",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_ditheringEnabled",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_ditheringIntensity",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_skipFinalColorClamp",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_applyByPostProcess",void 0),(0,H.e)([(0,E.L)()],q.prototype,"_isEnabled",void 0),(0,H.e)([(0,E.L)()],q.prototype,"outputTextureWidth",void 0),(0,H.e)([(0,E.L)()],q.prototype,"outputTextureHeight",void 0),T.d._ImageProcessingConfigurationParser=q.Parse,(0,M.d)("BABYLON.ImageProcessingConfiguration",q)},11603:(z,u,Y)=>{Y.d(u,{d:()=>g});var H=Y(11079),E=Y(11077),J=Y(11082),l=Y(11585),T=Y(11559),b=Y(11568),L=Y(11195);class D extends T.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class g extends b.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"DetailMap",140,new D,u),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=E.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,u,Y){return!this._isEnabled||!(z._areTexturesDirty&&u.texturesEnabled&&Y.getCaps().standardDerivatives&&this._texture&&l.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(z,u){if(this._isEnabled){z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const Y=u.getEngine();z._areTexturesDirty&&(Y.getCaps().standardDerivatives&&this._texture&&l.e.DetailTextureEnabled&&this._isEnabled?((0,L.L)(this._texture,z,"DETAIL"),z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):z.DETAIL=!1)}else z.DETAIL=!1}bindForSubMesh(z,u){if(!this._isEnabled)return;const Y=this._material.isFrozen;z.useUbo&&Y&&z.isSync||this._texture&&l.e.DetailTextureEnabled&&(z.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,L.p)(this._texture,z,"detail")),u.texturesEnabled&&this._texture&&l.e.DetailTextureEnabled&&z.setTexture("detailSampler",this._texture)}hasTexture(z){return this._texture===z}getActiveTextures(z){this._texture&&z.push(this._texture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture)}dispose(z){var u;z&&(null===(u=this._texture)||void 0===u||u.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(z){z.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,H.e)([(0,J.C)("detailTexture"),(0,J.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,H.e)([(0,J.L)()],g.prototype,"diffuseBlendLevel",void 0),(0,H.e)([(0,J.L)()],g.prototype,"roughnessBlendLevel",void 0),(0,H.e)([(0,J.L)()],g.prototype,"bumpLevel",void 0),(0,H.e)([(0,J.L)(),(0,J.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"normalBlendMethod",void 0),(0,H.e)([(0,J.L)(),(0,J.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0)},11077:(z,u,Y)=>{Y.d(u,{d:()=>h});var H=Y(11079),E=Y(11082),J=Y(10945),l=Y(10932),T=Y(10928),b=Y(11098),L=Y(11163),D=Y(10953),g=Y(11170),M=Y(11156),q=Y(11172);class C{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(z){this._func=z}get funcRef(){return this._funcRef}set funcRef(z){this._funcRef=z}get funcMask(){return this._funcMask}set funcMask(z){this._funcMask=z}get opStencilFail(){return this._opStencilFail}set opStencilFail(z){this._opStencilFail=z}get opDepthFail(){return this._opDepthFail}set opDepthFail(z){this._opDepthFail=z}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(z){this._opStencilDepthPass=z}get mask(){return this._mask}set mask(z){this._mask=z}get enabled(){return this._enabled}set enabled(z){this._enabled=z}getClassName(){return"MaterialStencilState"}copyTo(z){q.d.Clone((()=>z),this)}serialize(){return q.d.Serialize(this)}parse(z,u,Y){q.d.Parse((()=>this),z,u,Y)}}(0,H.e)([(0,E.L)()],C.prototype,"func",null),(0,H.e)([(0,E.L)()],C.prototype,"funcRef",null),(0,H.e)([(0,E.L)()],C.prototype,"funcMask",null),(0,H.e)([(0,E.L)()],C.prototype,"opStencilFail",null),(0,H.e)([(0,E.L)()],C.prototype,"opDepthFail",null),(0,H.e)([(0,E.L)()],C.prototype,"opStencilDepthPass",null),(0,H.e)([(0,E.L)()],C.prototype,"mask",null),(0,H.e)([(0,E.L)()],C.prototype,"enabled",null);var K=Y(11195);class h{get _supportGlowLayer(){return!1}set _glowModeEnabled(z){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(z){if(this._alpha===z)return;const u=this._alpha;this._alpha=z,1!==u&&1!==z||this.uD(h.MiscDirtyFlag+h.PrePassDirtyFlag)}get alpha(){return this._alpha}set yl(z){this._backFaceCulling!==z&&(this._backFaceCulling=z,this.uD(h.TextureDirtyFlag))}get yl(){return this._backFaceCulling}set cullBackFaces(z){this._cullBackFaces!==z&&(this._cullBackFaces=z,this.uD(h.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(z){this._blockDirtyMechanism!==z&&(this._blockDirtyMechanism=z,z||this.KM())}atomicMaterialsUpdate(z){this.blockDirtyMechanism=!0;try{z(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new l.e),this._onBindObservable}set onBind(z){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(z)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new l.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new l.e),this._onEffectCreatedObservable}set alphaMode(z){this._alphaMode!==z&&(this._alphaMode=z,this.uD(h.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(z){this._needDepthPrePass!==z&&(this._needDepthPrePass=z,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(z){this._fogEnabled!==z&&(this._fogEnabled=z,this.uD(h.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(z){this.fillMode=z?h.WireFrameFillMode:h.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(z){this.fillMode=z?h.PointFillMode:h.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(z){this._fillMode!==z&&(this._fillMode=z,this.uD(h.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){const u=this.iz().getEngine().getCaps().fragmentDepthSupported;z&&!u&&D.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=z&&u,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(z){this._drawWrapper=z}constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.fl=new l.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new C,this._useUBO=!1,this._fillMode=h.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=z;const E=u||T.d.LastCreatedScene;E&&(this._scene=E,this._dirtyCallbacks={},this._forceGLSL=H,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=z||J.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new M.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new L.b(this._scene.getEngine(),void 0,void 0,z),this._useUBO=this.iz().getEngine().supportsUniformBuffers,this._createUniformBuffer(),Y||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),h.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var z;const u=this.iz().getEngine();null===(z=this._uniformBuffer)||void 0===z||z.dispose(),u.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new L.b(u,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new L.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(z){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.KM(),this.checkReadyOnlyOnce=!0}unfreeze(){this.KM(),this.checkReadyOnlyOnce=!1}isReady(z,u){return!0}isReadyForSubMesh(z,u,Y){const H=u.materialDefines;return!!H&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=H,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}iz(){return this._scene}_getEffectiveOrientation(z){return null!==this.sideOrientation?this.sideOrientation:z.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(z){this._transparencyMode!==z&&(this._transparencyMode=z,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===h.MATERIAL_ALPHABLEND||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===h.MATERIAL_ALPHATEST||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===h.MATERIAL_OPAQUE||this._transparencyMode===h.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(z){return this._hasTransparencyMode?this._transparencyModeIsBlend:z.visibility<1||!this._disableAlphaBlending&&(z.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(z){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(z)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}KM(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.iz().meshes;for(const Y of u)if(Y.YT)for(const u of Y.YT)if(u.Oz()===this)for(const Y of u._drawWrappers)Y&&this._materialContext===Y.materialContext&&(Y._wasPreviouslyReady=!1,Y._wasPreviouslyUsingInstances=null,Y._forceRebindOnNextCall=z);z&&this.uD(h.AllDirtyFlag)}_preBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this._scene.getEngine(),H=(null==u?this.sideOrientation:u)===h.ClockWiseSideOrientation;return Y.enableEffect(z||this._getDrawWrapper()),Y.setState(this.yl,this.zOffset,!1,H,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),H}bind(z,u){}buildUniformLayout(){const z=this._uniformBuffer;this._eventInfo.ubo=z,this._callbackPluginEventGeneric(8,this._eventInfo),z.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(z,u,Y){const H=Y._drawWrapper;this._eventInfo.subMesh=Y,this._callbackPluginEventBindForSubMesh(this._eventInfo),H._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(z){}bindView(z){this._useUBO?this._needToBindSceneUbo=!0:z.setMatrix("view",this.iz().getViewMatrix())}bindViewProjection(z){this._useUBO?this._needToBindSceneUbo=!0:(z.setMatrix("viewProjection",this.iz().getTransformMatrix()),z.setMatrix("projection",this.iz().getProjectionMatrix()))}bindEyePosition(z,u){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(z,u)}_afterBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&u&&(this._needToBindSceneUbo=!1,(0,K.m)(u,this.iz().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=z?z.visibility:1,this._onBindObservable&&z&&this._onBindObservable.notifyObservers(z),this.disableDepthWrite){const z=this._scene.getEngine();this._cachedDepthWriteState=z.getDepthWrite(),z.setDepthWrite(!1)}if(this.disableColorWrite){const z=this._scene.getEngine();this._cachedColorWriteState=z.getColorWrite(),z.setColorWrite(!1)}if(0!==this.depthFunction){const z=this._scene.getEngine();this._cachedDepthFunctionState=z.getDepthFunction()||0,z.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(z){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=z,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(z){return null}_clonePlugins(z,u){const Y={};if(this._serializePlugins(Y),h._ParsePlugins(Y,z,this._scene,u),this.pluginManager)for(const H of this.pluginManager._plugins){const u=z.pluginManager.getPlugin(H.name);u&&H.copyTo(u)}}getBindedMeshes(){if(this.meshMap){const z=[];for(const u in this.meshMap){const Y=this.meshMap[u];Y&&z.push(Y)}return z}return this._scene.meshes.filter((z=>z.material===this))}forceCompilation(z,u,Y,H){const E={clipPlane:!1,useInstances:!1,...Y},J=this.iz(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const T=()=>{if(!this._scene||!this._scene.getEngine())return;const Y=J.clipPlane;if(E.clipPlane&&(J.clipPlane=new g.b(0,0,0,1)),this._storeEffectOnSubMeshes){let Y=!0,J=null;if(z.YT){const u=new b.d(0,0,0,0,0,z,void 0,!1,!1);u.materialDefines&&(u.materialDefines._renderId=-1),this.isReadyForSubMesh(z,u,E.useInstances)||(u.effect&&u.effect.getCompilationError()&&u.effect.allFallbacksProcessed()?J=u.effect.getCompilationError():(Y=!1,setTimeout(T,16)))}Y&&(this.allowShaderHotSwapping=l,J&&H&&H(J),u&&u(this))}else this.isReady()?(this.allowShaderHotSwapping=l,u&&u(this)):setTimeout(T,16);E.clipPlane&&(J.clipPlane=Y)};T()}async forceCompilationAsync(z,u){return await new Promise(((Y,H)=>{this.forceCompilation(z,(()=>{Y()}),u,(z=>{H(z)}))}))}uD(z){this.iz().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(h._DirtyCallbackArray.length=0,z&h.ImageProcessingDirtyFlag&&h._DirtyCallbackArray.push(h._ImageProcessingDirtyCallBack),z&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),z&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),z&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),z&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),z&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),z&h.PrePassDirtyFlag&&h._DirtyCallbackArray.push(h._PrePassDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.iz().resetCachedMaterial())}resetDrawCache(){const z=this.iz().meshes;for(const u of z)if(u.YT)for(const z of u.YT)z.Oz()===this&&z.resetDrawCache()}_markAllSubMeshesAsDirty(z){const u=this.iz();if(u.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const Y=u.meshes;for(const H of Y)if(H.YT)for(const Y of H.YT){if((Y.Oz()||(u._hasDefaultMaterial?u.defaultMaterial:null))===this)for(const u of Y._drawWrappers)u&&u.defines&&u.defines.markAllAsDirty&&this._materialContext===u.materialContext&&z(u.defines)}}_markScenePrePassDirty(){if(this.iz().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const z=this.iz().enablePrePassRenderer();z&&z.uD()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(h._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(h._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const z=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.fl.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(z)}))}}setPrePassRenderer(z){return!1}dispose(z,u,Y){const H=this.iz();if(H.stopAnimation(this),H.freeProcessedMaterials(),H.removeMaterial(this),this._eventInfo.forceDisposeTextures=u,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const z=this._parentContainer.materials.indexOf(this);z>-1&&this._parentContainer.materials.splice(z,1),this._parentContainer=null}if(!0!==Y)if(this.meshMap)for(const E in this.meshMap){const z=this.meshMap[E];this._disposeMeshResources(z)}else{const z=H.meshes;for(const u of z)this._disposeMeshResources(u)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.fl.notifyObservers(this),this.fl.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(z){if(!z)return;const u=z.Sl,Y=z._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(z.YT&&Y)for(const E of z.YT){const z=E._drawWrappers;for(let J=0;J<z.length;J++){var H;const l=null===(H=z[J])||void 0===H?void 0:H.effect;if(!l)continue;Y[J]===this&&(null===u||void 0===u||u._releaseVertexArrayObject(l),E._removeDrawWrapper(J,!0,!0))}}}else null===u||void 0===u||u._releaseVertexArrayObject(this._drawWrapper.effect);z.material!==this||z.sourceMesh||(z.material=null)}serialize(){const z=q.d.Serialize(this);return z.stencil=this.stencil.serialize(),z.uniqueId=this.uniqueId,this._serializePlugins(z),z}_serializePlugins(z){if(z.plugins={},this.pluginManager)for(const u of this.pluginManager._plugins)u.doNotSerialize||(z.plugins[u.getClassName()]=u.serialize())}static Parse(z,u,Y){if(z.customType){if("BABYLON.PBRMaterial"===z.customType&&z.overloadedAlbedo&&(z.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return D.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else z.customType="BABYLON.StandardMaterial";const H=J.e.Instantiate(z.customType).Parse(z,u,Y);return H._loadedUniqueId=z.uniqueId,H}static _ParsePlugins(z,u,Y,H){if(z.plugins)for(const T in z.plugins){var E,l;const b=z.plugins[T];let L=null===(E=u.pluginManager)||void 0===E?void 0:E.getPlugin(b.name);if(!L){const z=J.e.Instantiate("BABYLON."+T);z&&(L=new z(u))}null===(l=L)||void 0===l||l.parse(b,Y,H)}}}h.TriangleFillMode=0,h.WireFrameFillMode=1,h.PointFillMode=2,h.PointListDrawMode=3,h.LineListDrawMode=4,h.LineLoopDrawMode=5,h.LineStripDrawMode=6,h.TriangleStripDrawMode=7,h.TriangleFanDrawMode=8,h.ClockWiseSideOrientation=0,h.CounterClockWiseSideOrientation=1,h.ImageProcessingDirtyFlag=64,h.TextureDirtyFlag=1,h.LightDirtyFlag=2,h.FresnelDirtyFlag=4,h.AttributesDirtyFlag=8,h.MiscDirtyFlag=16,h.PrePassDirtyFlag=32,h.AllDirtyFlag=127,h.MATERIAL_OPAQUE=0,h.MATERIAL_ALPHATEST=1,h.MATERIAL_ALPHABLEND=2,h.MATERIAL_ALPHATESTANDBLEND=3,h.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,h.MATERIAL_NORMALBLENDMETHOD_RNM=1,h.OnEventObservable=new l.e,h._AllDirtyCallBack=z=>z.markAllAsDirty(),h._ImageProcessingDirtyCallBack=z=>z.markAsImageProcessingDirty(),h._TextureDirtyCallBack=z=>z.markAsTexturesDirty(),h._FresnelDirtyCallBack=z=>z.markAsFresnelDirty(),h._MiscDirtyCallBack=z=>z.markAsMiscDirty(),h._PrePassDirtyCallBack=z=>z.markAsPrePassDirty(),h._LightsDirtyCallBack=z=>z.markAsLightDirty(),h._AttributeDirtyCallBack=z=>z.markAsAttributesDirty(),h._FresnelAndMiscDirtyCallBack=z=>{h._FresnelDirtyCallBack(z),h._MiscDirtyCallBack(z)},h._TextureAndMiscDirtyCallBack=z=>{h._TextureDirtyCallBack(z),h._MiscDirtyCallBack(z)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=z=>{for(const u of h._DirtyCallbackArray)u(z)},(0,H.e)([(0,E.L)()],h.prototype,"id",void 0),(0,H.e)([(0,E.L)()],h.prototype,"uniqueId",void 0),(0,H.e)([(0,E.L)()],h.prototype,"name",void 0),(0,H.e)([(0,E.L)()],h.prototype,"metadata",void 0),(0,H.e)([(0,E.L)()],h.prototype,"checkReadyOnEveryCall",void 0),(0,H.e)([(0,E.L)()],h.prototype,"checkReadyOnlyOnce",void 0),(0,H.e)([(0,E.L)()],h.prototype,"state",void 0),(0,H.e)([(0,E.L)("alpha")],h.prototype,"_alpha",void 0),(0,H.e)([(0,E.L)("yl")],h.prototype,"_backFaceCulling",void 0),(0,H.e)([(0,E.L)("cullBackFaces")],h.prototype,"_cullBackFaces",void 0),(0,H.e)([(0,E.L)()],h.prototype,"sideOrientation",void 0),(0,H.e)([(0,E.L)("alphaMode")],h.prototype,"_alphaMode",void 0),(0,H.e)([(0,E.L)()],h.prototype,"_needDepthPrePass",void 0),(0,H.e)([(0,E.L)()],h.prototype,"disableDepthWrite",void 0),(0,H.e)([(0,E.L)()],h.prototype,"disableColorWrite",void 0),(0,H.e)([(0,E.L)()],h.prototype,"forceDepthWrite",void 0),(0,H.e)([(0,E.L)()],h.prototype,"depthFunction",void 0),(0,H.e)([(0,E.L)()],h.prototype,"separateCullingPass",void 0),(0,H.e)([(0,E.L)("fogEnabled")],h.prototype,"_fogEnabled",void 0),(0,H.e)([(0,E.L)()],h.prototype,"pointSize",void 0),(0,H.e)([(0,E.L)()],h.prototype,"zOffset",void 0),(0,H.e)([(0,E.L)()],h.prototype,"zOffsetUnits",void 0),(0,H.e)([(0,E.L)()],h.prototype,"pointsCloud",null),(0,H.e)([(0,E.L)()],h.prototype,"fillMode",null),(0,H.e)([(0,E.L)()],h.prototype,"useLogarithmicDepth",null),(0,H.e)([(0,E.L)()],h.prototype,"transparencyMode",null)},11559:(z,u,Y)=>{Y.d(u,{d:()=>H});class H{constructor(z){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=z,z)for(const u in z)Object.prototype.hasOwnProperty.call(z,u)&&this._setDefaultValue(u)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||z,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const z of Object.keys(this))"_"!==z[0]&&this._keys.push(z);if(this._externalProperties)for(const z in this._externalProperties)-1===this._keys.indexOf(z)&&this._keys.push(z)}isEqual(z){if(this._keys.length!==z._keys.length)return!1;for(let u=0;u<this._keys.length;u++){const Y=this._keys[u];if(this[Y]!==z[Y])return!1}return!0}cloneTo(z){this._keys.length!==z._keys.length&&(z._keys=this._keys.slice(0));for(let u=0;u<this._keys.length;u++){const Y=this._keys[u];z[Y]=this[Y]}}reset(){for(const z of this._keys)this._setDefaultValue(z)}_setDefaultValue(z){var u,Y,H,E;const J=(null===(u=this._externalProperties)||void 0===u||null===(Y=u[z])||void 0===Y?void 0:Y.type)??typeof this[z],l=null===(H=this._externalProperties)||void 0===H||null===(E=H[z])||void 0===E?void 0:E.default;switch(J){case"number":this[z]=l??0;break;case"string":this[z]=l??"";break;default:this[z]=l??!1}}toString(){let z="";for(let u=0;u<this._keys.length;u++){const Y=this._keys[u],H=this[Y];switch(typeof H){case"number":case"string":z+="#define "+Y+" "+H+"\n";break;default:H&&(z+="#define "+Y+"\n")}}return z}}},11585:(z,u,Y)=>{Y.d(u,{e:()=>E});var H=Y(11018);class E{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(z){this._DiffuseTextureEnabled!==z&&(this._DiffuseTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(z){this._BaseWeightTextureEnabled!==z&&(this._BaseWeightTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(z){this._BaseDiffuseRoughnessTextureEnabled!==z&&(this._BaseDiffuseRoughnessTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(z){this._DetailTextureEnabled!==z&&(this._DetailTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(z){this._DecalMapEnabled!==z&&(this._DecalMapEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(z){this._AmbientTextureEnabled!==z&&(this._AmbientTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(z){this._OpacityTextureEnabled!==z&&(this._OpacityTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(z){this._ReflectionTextureEnabled!==z&&(this._ReflectionTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(z){this._EmissiveTextureEnabled!==z&&(this._EmissiveTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(z){this._SpecularTextureEnabled!==z&&(this._SpecularTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(z){this._BumpTextureEnabled!==z&&(this._BumpTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(z){this._LightmapTextureEnabled!==z&&(this._LightmapTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(z){this._RefractionTextureEnabled!==z&&(this._RefractionTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(z){this._ColorGradingTextureEnabled!==z&&(this._ColorGradingTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(z){this._FresnelEnabled!==z&&(this._FresnelEnabled=z,H.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(z){this._ClearCoatTextureEnabled!==z&&(this._ClearCoatTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(z){this._ClearCoatBumpTextureEnabled!==z&&(this._ClearCoatBumpTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(z){this._ClearCoatTintTextureEnabled!==z&&(this._ClearCoatTintTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(z){this._SheenTextureEnabled!==z&&(this._SheenTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(z){this._AnisotropicTextureEnabled!==z&&(this._AnisotropicTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(z){this._ThicknessTextureEnabled!==z&&(this._ThicknessTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(z){this._RefractionIntensityTextureEnabled!==z&&(this._RefractionIntensityTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(z){this._TranslucencyIntensityTextureEnabled!==z&&(this._TranslucencyIntensityTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(z){this._TranslucencyColorTextureEnabled!==z&&(this._TranslucencyColorTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(z){this._IridescenceTextureEnabled!==z&&(this._IridescenceTextureEnabled=z,H.e.MarkAllMaterialsAsDirty(1))}}E._DiffuseTextureEnabled=!0,E._BaseWeightTextureEnabled=!0,E._BaseDiffuseRoughnessTextureEnabled=!0,E._DetailTextureEnabled=!0,E._DecalMapEnabled=!0,E._AmbientTextureEnabled=!0,E._OpacityTextureEnabled=!0,E._ReflectionTextureEnabled=!0,E._EmissiveTextureEnabled=!0,E._SpecularTextureEnabled=!0,E._BumpTextureEnabled=!0,E._LightmapTextureEnabled=!0,E._RefractionTextureEnabled=!0,E._ColorGradingTextureEnabled=!0,E._FresnelEnabled=!0,E._ClearCoatTextureEnabled=!0,E._ClearCoatBumpTextureEnabled=!0,E._ClearCoatTintTextureEnabled=!0,E._SheenTextureEnabled=!0,E._AnisotropicTextureEnabled=!0,E._ThicknessTextureEnabled=!0,E._RefractionIntensityTextureEnabled=!0,E._TranslucencyIntensityTextureEnabled=!0,E._TranslucencyColorTextureEnabled=!0,E._IridescenceTextureEnabled=!0},11195:(z,u,Y)=>{Y.d(u,{D:()=>M,E:()=>G,G:()=>x,K:()=>V,L:()=>o,O:()=>Q,P:()=>F,Q:()=>R,S:()=>w,U:()=>U,Y:()=>C,c:()=>W,f:()=>g,g:()=>s,h:()=>D,i:()=>K,m:()=>h,p:()=>d,r:()=>X,s:()=>t,t:()=>v,x:()=>i,z:()=>q});var H=Y(10953),E=Y(11188),J=Y(10928),l=Y(11204),T=Y(11212);const b=E.c.Black(),L={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function D(z,u,Y){if(!z||z.LOGARITHMICDEPTH||z.indexOf&&z.indexOf("LOGARITHMICDEPTH")>=0){const z=Y.activeCamera;1===z.mode&&H.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),u.setFloat("logarithmicDepthConstant",2/(Math.log(z.maxZ+1)/Math.LN2))}}function g(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Y&&z.fogEnabled&&(!u||u.applyFog)&&0!==z.fogMode&&(Y.setFloat4("vFogInfos",z.fogMode,z.fogStart,z.fogEnd,z.fogDensity),H?(z.fogColor.toLinearSpaceToRef(b,z.getEngine().useExactSrgbConversions),Y.setColor3("vFogColor",b)):Y.setColor3("vFogColor",z.fogColor))}function M(z,u,Y,H,E,J,l,T,b,D){const g=z.numMaxInfluencers||z.numInfluencers;return g<=0?0:(u.push("#define MORPHTARGETS"),z.hasPositions&&u.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),z.hasNormals&&u.push("#define MORPHTARGETTEXTURE_HASNORMALS"),z.hasTangents&&u.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),z.hasUVs&&u.push("#define MORPHTARGETTEXTURE_HASUVS"),z.hasUV2s&&u.push("#define MORPHTARGETTEXTURE_HASUV2S"),z.hasColors&&u.push("#define MORPHTARGETTEXTURE_HASCOLORS"),z.supportsPositions&&E&&u.push("#define MORPHTARGETS_POSITION"),z.supportsNormals&&J&&u.push("#define MORPHTARGETS_NORMAL"),z.supportsTangents&&l&&u.push("#define MORPHTARGETS_TANGENT"),z.supportsUVs&&T&&u.push("#define MORPHTARGETS_UV"),z.supportsUV2s&&b&&u.push("#define MORPHTARGETS_UV2"),z.supportsColors&&D&&u.push("#define MORPHTARGETS_COLOR"),u.push("#define NUM_MORPH_INFLUENCERS "+g),z.isUsingTextureForTargets&&u.push("#define MORPHTARGETS_TEXTURE"),L.NUM_MORPH_INFLUENCERS=g,L.NORMAL=J,L.TANGENT=l,L.UV=T,L.UV2=b,L.COLOR=D,q(Y,H,L,E),g)}function q(z,u,Y){let E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=Y.NUM_MORPH_INFLUENCERS;if(l>0&&J.d.LastCreatedEngine){const T=J.d.LastCreatedEngine.getCaps().maxVertexAttribs,b=u.morphTargetManager;if(null!==b&&void 0!==b&&b.isUsingTextureForTargets)return;const L=b&&b.supportsPositions&&E,D=b&&b.supportsNormals&&Y.NORMAL,g=b&&b.supportsTangents&&Y.TANGENT,M=b&&b.supportsUVs&&Y.UV1,q=b&&b.supportsUV2s&&Y.UV2,C=b&&b.supportsColors&&Y.VERTEXCOLOR;for(let Y=0;Y<l;Y++)L&&z.push("position"+Y),D&&z.push("normal"+Y),g&&z.push("tangent"+Y),M&&z.push("uv_"+Y),q&&z.push("uv2_"+Y),C&&z.push("color"+Y),z.length>T&&H.b.Error("Cannot add more vertex attributes for mesh "+u.name)}}function C(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z.push("world0"),z.push("world1"),z.push("world2"),z.push("world3"),u&&(z.push("previousWorld0"),z.push("previousWorld1"),z.push("previousWorld2"),z.push("previousWorld3"))}function K(z,u){const Y=z.morphTargetManager;z&&Y&&u.setFloatArray("morphTargetInfluences",Y.influences)}function h(z,u){u.bindToEffect(z,"Scene")}function o(z,u,Y){u._needUVs=!0,u[Y]=!0,z.optimizeUVAllocation&&z.getTextureMatrix().isIdentityAs3x2()?(u[Y+"DIRECTUV"]=z.coordinatesIndex+1,u["MAINUV"+(z.coordinatesIndex+1)]=!0):u[Y+"DIRECTUV"]=0}function d(z,u,Y){const H=z.getTextureMatrix();u.rl(Y+"Matrix",H)}function t(z,u,Y){Y.BAKED_VERTEX_ANIMATION_TEXTURE&&Y.INSTANCES&&z.push("bakedVertexAnimationSettingsInstanced")}function W(z,u,Y){var H;if(u&&z&&(z.computeBonesUsingShaders&&u._bonesComputationForcedToCPU&&(z.computeBonesUsingShaders=!1),z.useBones&&z.computeBonesUsingShaders&&z.skeleton)){const E=z.skeleton;if(E.isUsingTextureForMatrices&&u.getUniformIndex("boneTextureWidth")>-1){const Y=E.getTransformMatrixTexture(z);u.setTexture("boneSampler",Y),u.setFloat("boneTextureWidth",4*(E.bones.length+1))}else{const J=E.getTransformMatrices(z);J&&(u.setMatrices("mBones",J),Y&&z.iz().prePassRenderer&&z.iz().prePassRenderer.getIndex(2)&&(Y.previousBones[z.uniqueId]||(Y.previousBones[z.uniqueId]=J.slice()),u.setMatrices("mPreviousBones",Y.previousBones[z.uniqueId]),H=J,Y.previousBones[z.uniqueId].set(H)))}}}function Z(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];z._bindLight(u,Y,H,E,J)}function s(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const J=Math.min(u.lightSources.length,E);for(let l=0;l<J;l++){Z(u.lightSources[l],l,z,Y,"boolean"===typeof H?H:H.SPECULARTERM,u.receiveShadows)}}function v(z,u,Y,H){Y.NUM_BONE_INFLUENCERS>0&&(H.addCPUSkinningFallback(0,u),z.push("matricesIndices"),z.push("matricesWeights"),Y.NUM_BONE_INFLUENCERS>4&&(z.push("matricesIndicesExtra"),z.push("matricesWeightsExtra")))}function i(z,u){(u.INSTANCES||u.THIN_INSTANCES)&&C(z,!!u.PREPASS_VELOCITY),u.INSTANCESCOLOR&&z.push("instanceColor")}function X(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=0;for(let J=0;J<Y&&z["LIGHT"+J];J++)J>0&&(E=H+J,u.addFallback(E,"LIGHT"+J)),z.SHADOWS||(z["SHADOW"+J]&&u.addFallback(H,"SHADOW"+J),z["SHADOWPCF"+J]&&u.addFallback(H,"SHADOWPCF"+J),z["SHADOWPCSS"+J]&&u.addFallback(H,"SHADOWPCSS"+J),z["SHADOWPOISSON"+J]&&u.addFallback(H,"SHADOWPOISSON"+J),z["SHADOWESM"+J]&&u.addFallback(H,"SHADOWESM"+J),z["SHADOWCLOSEESM"+J]&&u.addFallback(H,"SHADOWCLOSEESM"+J));return E++}function Q(z,u,Y,H,E,J,l){let T=arguments.length>7&&void 0!==arguments[7]&&arguments[7];l._areMiscDirty&&(l.LOGARITHMICDEPTH=Y,l.POINTSIZE=H,l.FOG=E&&function(z,u){return u.fogEnabled&&z.applyFog&&0!==u.fogMode}(z,u),l.NONUNIFORMSCALING=z.nonUniformScaling,l.ALPHATEST=J,l.DECAL_AFTER_DETAIL=T)}function V(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Y._areLightsDirty)return Y._needNormals;let l=0;const T={needNormals:Y._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(z.lightsEnabled&&!J)for(const L of u.lightSources)if(A(z,u,L,l,Y,H,T),l++,l===E)break;Y.SPECULARTERM=T.specularEnabled,Y.SHADOWS=T.shadowEnabled;for(let L=l;L<E;L++)void 0!==Y["LIGHT"+L]&&(Y["LIGHT"+L]=!1,Y["HEMILIGHT"+L]=!1,Y["POINTLIGHT"+L]=!1,Y["DIRLIGHT"+L]=!1,Y["SPOTLIGHT"+L]=!1,Y["AREALIGHT"+L]=!1,Y["SHADOW"+L]=!1,Y["SHADOWCSM"+L]=!1,Y["SHADOWCSMDEBUG"+L]=!1,Y["SHADOWCSMNUM_CASCADES"+L]=!1,Y["SHADOWCSMUSESHADOWMAXZ"+L]=!1,Y["SHADOWCSMNOBLEND"+L]=!1,Y["SHADOWCSM_RIGHTHANDED"+L]=!1,Y["SHADOWPCF"+L]=!1,Y["SHADOWPCSS"+L]=!1,Y["SHADOWPOISSON"+L]=!1,Y["SHADOWESM"+L]=!1,Y["SHADOWCLOSEESM"+L]=!1,Y["SHADOWCUBE"+L]=!1,Y["SHADOWLOWQUALITY"+L]=!1,Y["SHADOWMEDIUMQUALITY"+L]=!1);const b=z.getEngine().getCaps();return void 0===Y.SHADOWFLOAT&&(T.needRebuild=!0),Y.SHADOWFLOAT=T.shadowEnabled&&(b.textureFloatRender&&b.textureFloatLinearFiltering||b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering),Y.LIGHTMAPEXCLUDED=T.lightmapMode,T.needRebuild&&Y.rebuild(),T.needNormals}function A(z,u,Y,H,E,J,T){switch(T.needNormals=!0,void 0===E["LIGHT"+H]&&(T.needRebuild=!0),E["LIGHT"+H]=!0,E["SPOTLIGHT"+H]=!1,E["HEMILIGHT"+H]=!1,E["POINTLIGHT"+H]=!1,E["DIRLIGHT"+H]=!1,E["AREALIGHT"+H]=!1,Y.prepareLightSpecificDefines(E,H),E["LIGHT_FALLOFF_PHYSICAL"+H]=!1,E["LIGHT_FALLOFF_GLTF"+H]=!1,E["LIGHT_FALLOFF_STANDARD"+H]=!1,Y.falloffType){case l.d.FALLOFF_GLTF:E["LIGHT_FALLOFF_GLTF"+H]=!0;break;case l.d.FALLOFF_PHYSICAL:E["LIGHT_FALLOFF_PHYSICAL"+H]=!0;break;case l.d.FALLOFF_STANDARD:E["LIGHT_FALLOFF_STANDARD"+H]=!0}if(J&&!Y.iD.equalsFloats(0,0,0)&&(T.specularEnabled=!0),E["SHADOW"+H]=!1,E["SHADOWCSM"+H]=!1,E["SHADOWCSMDEBUG"+H]=!1,E["SHADOWCSMNUM_CASCADES"+H]=!1,E["SHADOWCSMUSESHADOWMAXZ"+H]=!1,E["SHADOWCSMNOBLEND"+H]=!1,E["SHADOWCSM_RIGHTHANDED"+H]=!1,E["SHADOWPCF"+H]=!1,E["SHADOWPCSS"+H]=!1,E["SHADOWPOISSON"+H]=!1,E["SHADOWESM"+H]=!1,E["SHADOWCLOSEESM"+H]=!1,E["SHADOWCUBE"+H]=!1,E["SHADOWLOWQUALITY"+H]=!1,E["SHADOWMEDIUMQUALITY"+H]=!1,u&&u.receiveShadows&&z.shadowsEnabled&&Y.shadowEnabled){const u=Y.getShadowGenerator(z.activeCamera)??Y.getShadowGenerator();if(u){const z=u.getShadowMap();z&&z.renderList&&z.renderList.length>0&&(T.shadowEnabled=!0,u.prepareDefines(E,H))}}Y.lightmapMode!=l.d.LIGHTMAP_DEFAULT?(T.lightmapMode=!0,E["LIGHTMAPEXCLUDED"+H]=!0,E["LIGHTMAPNOSPECULAR"+H]=Y.lightmapMode==l.d.LIGHTMAP_SHADOWSONLY):(E["LIGHTMAPEXCLUDED"+H]=!1,E["LIGHTMAPNOSPECULAR"+H]=!1)}function x(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=function(z,u){let Y=!1;if(z.activeCamera){const H=u.CAMERA_ORTHOGRAPHIC?1:0,E=u.CAMERA_PERSPECTIVE?1:0,J=1===z.activeCamera.mode?1:0,l=0===z.activeCamera.mode?1:0;(H^J||E^l)&&(u.CAMERA_ORTHOGRAPHIC=1===J,u.CAMERA_PERSPECTIVE=1===l,Y=!0)}return Y}(z,H);!1!==J&&(b=(0,T.i)(Y,z,H)),H.DEPTHPREPASS!==!u.getColorWrite()&&(H.DEPTHPREPASS=!H.DEPTHPREPASS,b=!0),H.INSTANCES!==E&&(H.INSTANCES=E,b=!0),H.THIN_INSTANCES!==l&&(H.THIN_INSTANCES=l,b=!0),b&&H.markAsUnprocessed()}function G(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!u._areAttributesDirty&&u._needNormals===u._normals&&u._needUVs===u._uvs)return!1;u._normals=u._needNormals,u._uvs=u._needUVs,u.NORMAL=u._needNormals&&z.isVerticesDataPresent("normal"),u._needNormals&&z.isVerticesDataPresent("tangent")&&(u.TANGENT=!0);for(let T=1;T<=6;++T)u["UV"+T]=!!u._needUVs&&z.isVerticesDataPresent(`uv${1===T?"":T}`);if(Y){const Y=z.useVertexColors&&z.isVerticesDataPresent("color");u.VERTEXCOLOR=Y,u.VERTEXALPHA=z.hasVertexAlpha&&Y&&J}return z.isVerticesDataPresent("instanceColor")&&(z.hasInstances||z.hasThinInstances)&&(u.INSTANCESCOLOR=!0),H&&function(z,u){if(z.useBones&&z.computeBonesUsingShaders&&z.skeleton){u.NUM_BONE_INFLUENCERS=z.numBoneInfluencers;const Y=void 0!==u.BONETEXTURE;if(z.skeleton.isUsingTextureForMatrices&&Y)u.BONETEXTURE=!0;else{u.BonesPerMesh=z.skeleton.bones.length+1,u.BONETEXTURE=!Y&&void 0;const H=z.iz().prePassRenderer;if(H&&H.enabled){const Y=-1===H.excludedSkinnedMesh.indexOf(z);u.BONES_VELOCITY_ENABLED=Y}}}else u.NUM_BONE_INFLUENCERS=0,u.BonesPerMesh=0,void 0!==u.BONETEXTURE&&(u.BONETEXTURE=!1)}(z,u),E&&function(z,u){const Y=z.morphTargetManager;Y?(u.MORPHTARGETS_UV=Y.supportsUVs&&u.UV1,u.MORPHTARGETS_UV2=Y.supportsUV2s&&u.UV2,u.MORPHTARGETS_TANGENT=Y.supportsTangents&&u.TANGENT,u.MORPHTARGETS_NORMAL=Y.supportsNormals&&u.NORMAL,u.MORPHTARGETS_POSITION=Y.supportsPositions,u.MORPHTARGETS_COLOR=Y.supportsColors,u.MORPHTARGETTEXTURE_HASUVS=Y.hasUVs,u.MORPHTARGETTEXTURE_HASUV2S=Y.hasUV2s,u.MORPHTARGETTEXTURE_HASTANGENTS=Y.hasTangents,u.MORPHTARGETTEXTURE_HASNORMALS=Y.hasNormals,u.MORPHTARGETTEXTURE_HASPOSITIONS=Y.hasPositions,u.MORPHTARGETTEXTURE_HASCOLORS=Y.hasColors,u.NUM_MORPH_INFLUENCERS=Y.numMaxInfluencers||Y.numInfluencers,u.MORPHTARGETS=u.NUM_MORPH_INFLUENCERS>0,u.MORPHTARGETS_TEXTURE=Y.isUsingTextureForTargets):(u.MORPHTARGETS_UV=!1,u.MORPHTARGETS_UV2=!1,u.MORPHTARGETS_TANGENT=!1,u.MORPHTARGETS_NORMAL=!1,u.MORPHTARGETS_POSITION=!1,u.MORPHTARGETS_COLOR=!1,u.MORPHTARGETTEXTURE_HASUVS=!1,u.MORPHTARGETTEXTURE_HASUV2S=!1,u.MORPHTARGETTEXTURE_HASTANGENTS=!1,u.MORPHTARGETTEXTURE_HASNORMALS=!1,u.MORPHTARGETTEXTURE_HASPOSITIONS=!1,u.MORPHTARGETTEXTURE_HAS_COLORS=!1,u.MORPHTARGETS=!1,u.NUM_MORPH_INFLUENCERS=0)}(z,u),l&&function(z,u){const Y=z.bakedVertexAnimationManager;u.BAKED_VERTEX_ANIMATION_TEXTURE=!(!Y||!Y.isEnabled)}(z,u),!0}function F(z,u){if(z.activeCamera){const Y=u.MULTIVIEW;u.MULTIVIEW=null!==z.activeCamera.outputRenderTarget&&z.activeCamera.outputRenderTarget.getViewCount()>1,u.MULTIVIEW!=Y&&u.markAsUnprocessed()}}function R(z,u,Y){const H=u.ORDER_INDEPENDENT_TRANSPARENCY,E=u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;u.ORDER_INDEPENDENT_TRANSPARENCY=z.useOrderIndependentTransparency&&Y,u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!z.getEngine().getCaps().textureFloatLinearFiltering,H===u.ORDER_INDEPENDENT_TRANSPARENCY&&E===u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||u.markAsUnprocessed()}function w(z,u,Y){const H=u.PREPASS;if(!u._arePrePassDirty)return;const E=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(z.prePassRenderer&&z.prePassRenderer.enabled&&Y){u.PREPASS=!0,u.SCENE_MRT_COUNT=z.prePassRenderer.mrtCount,u.PREPASS_NORMAL_WORLDSPACE=z.prePassRenderer.generateNormalsInWorldSpace,u.PREPASS_COLOR=!0,u.PREPASS_COLOR_INDEX=0;for(let Y=0;Y<E.length;Y++){const H=z.prePassRenderer.getIndex(E[Y].type);-1!==H?(u[E[Y].define]=!0,u[E[Y].index]=H):u[E[Y].define]=!1}}else{u.PREPASS=!1;for(let z=0;z<E.length;z++)u[E[z].define]=!1}u.PREPASS!=H&&(u.markAsUnprocessed(),u.markAsImageProcessingDirty())}function c(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];E&&E.push("Light"+z),J||(u.push("vLightData"+z,"vLightDiffuse"+z,"vLightSpecular"+z,"vLightDirection"+z,"vLightWidth"+z,"vLightHeight"+z,"vLightFalloff"+z,"vLightGround"+z,"lightMatrix"+z,"shadowsInfo"+z,"depthValues"+z),Y.push("shadowTexture"+z),Y.push("depthTexture"+z),u.push("viewFrustumZ"+z,"cascadeBlendFactor"+z,"lightSizeUVCorrection"+z,"depthCorrection"+z,"penumbraDarkness"+z,"frustumLengths"+z),H&&(Y.push("projectionLightTexture"+z),u.push("textureProjectionMatrix"+z)),l&&Y.push("iesLightTexture"+z))}function U(z,u,Y){let H,E,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(z.uniformsNames){const l=z;H=l.uniformsNames,E=l.uniformBuffersNames,u=l.samplers,Y=l.defines,J=l.maxSimultaneousLights||0}else H=z,u||(u=[]);for(let l=0;l<J&&Y["LIGHT"+l];l++)c(l,H,u,Y["PROJECTEDLIGHTTEXTURE"+l],E,!1,Y["IESLIGHTTEXTURE"+l]);Y.NUM_MORPH_INFLUENCERS&&(H.push("morphTargetInfluences"),H.push("morphTargetCount")),Y.BAKED_VERTEX_ANIMATION_TEXTURE&&(H.push("bakedVertexAnimationSettings"),H.push("bakedVertexAnimationTextureSizeInverted"),H.push("bakedVertexAnimationTime"),u.push("bakedVertexAnimationTexture"))}},11609:(z,u,Y)=>{Y.d(u,{b:()=>J});var H,E=Y(10903);!function(z){z[z.Zero=0]="Zero",z[z.One=1]="One",z[z.MaxViewZ=2]="MaxViewZ"}(H||(H={}));class J{static CreateConfiguration(z){return J._Configurations[z]={defines:{},previousWorldMatrices:{},previousViewProjection:E.b.Zero(),currentViewProjection:E.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},J._Configurations[z]}static DeleteConfiguration(z){delete J._Configurations[z]}static GetConfiguration(z){return J._Configurations[z]}static AddUniformsAndSamplers(z,u){z.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(z,u){for(const Y of u)if(Y.YT)for(const u of Y.YT)u._removeDrawWrapper(z)}static PrepareDefines(z,u,Y){if(!Y._arePrePassDirty)return;const H=J._Configurations[z];if(!H)return;Y.PREPASS=!0,Y.PREPASS_COLOR=!1,Y.PREPASS_COLOR_INDEX=-1;let E=0;for(let l=0;l<J.GeometryTextureDescriptions.length;l++){const z=J.GeometryTextureDescriptions[l],u=z.define,T=z.defineIndex,b=H.defines[T];void 0!==b?(Y[u]=!0,Y[T]=b,E++):(Y[u]=!1,delete Y[T])}Y.SCENE_MRT_COUNT=E,Y.BONES_VELOCITY_ENABLED=u.useBones&&u.computeBonesUsingShaders&&u.skeleton&&!u.skeleton.isUsingTextureForMatrices&&-1===H.excludedSkinnedMesh.indexOf(u)}static Bind(z,u,Y,H,E){const l=J._Configurations[z];if(!l)return;const T=Y.iz(),b=T.getEngine();if(l.reverseCulling&&b.setStateCullFaceType(T._mirroredCameraPosition?E.cullBackFaces:!E.cullBackFaces),(void 0!==l.defines.PREPASS_VELOCITY_INDEX||void 0!==l.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(l.previousWorldMatrices[Y.uniqueId]||(l.previousWorldMatrices[Y.uniqueId]=H.clone()),l.previousViewProjection||(l.previousViewProjection=T.getTransformMatrix().clone(),l.currentViewProjection=T.getTransformMatrix().clone()),l.currentViewProjection.updateFlag!==T.getTransformMatrix().updateFlag?(l.lastUpdateFrameId=b.frameId,l.previousViewProjection.J(l.currentViewProjection),l.currentViewProjection.J(T.getTransformMatrix())):l.lastUpdateFrameId!==b.frameId&&(l.lastUpdateFrameId=b.frameId,l.previousViewProjection.J(l.currentViewProjection)),u.setMatrix("previousWorld",l.previousWorldMatrices[Y.uniqueId]),u.setMatrix("previousViewProjection",l.previousViewProjection),l.previousWorldMatrices[Y.uniqueId]=H.clone(),Y.useBones&&Y.computeBonesUsingShaders&&Y.skeleton)){const z=Y.skeleton;if(!z.isUsingTextureForMatrices||-1===u.getUniformIndex("boneTextureWidth")){const H=z.getTransformMatrices(Y);H&&(l.previousBones[Y.uniqueId]||(l.previousBones[Y.uniqueId]=H.slice()),u.setMatrices("mPreviousBones",l.previousBones[Y.uniqueId]),l.previousBones[Y.uniqueId].set(H))}}}}J.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],J._Configurations={}},11568:(z,u,Y)=>{Y.d(u,{b:()=>o});var H=Y(11079),E=Y(11082),J=Y(11077),l=Y(10928),T=Y(10996),b=Y(11029);const L=new RegExp("^([gimus]+)!");class D{constructor(z){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=z,this._scene=z.iz(),this._engine=this._scene.getEngine()}_addPlugin(z){for(let H=0;H<this._plugins.length;++H)if(this._plugins[H].name===z.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!z.isCompatible(this._material.shaderLanguage))throw`The plugin "${z.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const u=z.getClassName();D._MaterialPluginClassToMainDefine[u]||(D._MaterialPluginClassToMainDefine[u]="MATERIALPLUGIN_"+ ++D._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(z,u)=>this._handlePluginEvent(z,u),this._plugins.push(z),this._plugins.sort(((z,u)=>z.priority-u.priority)),this._codeInjectionPoints={};const Y={};Y[D._MaterialPluginClassToMainDefine[u]]={type:"boolean",default:!0};for(const H of this._plugins)H.collectDefines(Y),this._collectPointNames("vertex",H.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",H.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=Y,!0}_activatePlugin(z){-1===this._activePlugins.indexOf(z)&&(this._activePlugins.push(z),this._activePlugins.sort(((z,u)=>z.priority-u.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),z.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(z),this._activePluginsForExtraEvents.sort(((z,u)=>z.priority-u.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(z){for(let u=0;u<this._plugins.length;++u)if(this._plugins[u].name===z)return this._plugins[u];return null}_handlePluginEventIsReadyForSubMesh(z){let u=!0;for(const Y of this._activePlugins)u=u&&Y.isReadyForSubMesh(z.defines,this._scene,this._engine,z.subMesh);z.isReadyForSubMesh=u}_handlePluginEventPrepareDefinesBeforeAttributes(z){for(const u of this._activePlugins)u.prepareDefinesBeforeAttributes(z.defines,this._scene,z.mesh)}_handlePluginEventPrepareDefines(z){for(const u of this._activePlugins)u.prepareDefines(z.defines,this._scene,z.mesh)}_handlePluginEventHardBindForSubMesh(z){for(const u of this._activePluginsForExtraEvents)u.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,z.subMesh)}_handlePluginEventBindForSubMesh(z){for(const u of this._activePlugins)u.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,z.subMesh)}_handlePluginEventHasRenderTargetTextures(z){let u=!1;for(const Y of this._activePluginsForExtraEvents)if(u=Y.hasRenderTargetTextures(),u)break;z.hasRenderTargetTextures=u}_handlePluginEventFillRenderTargetTextures(z){for(const u of this._activePluginsForExtraEvents)u.fillRenderTargetTextures(z.renderTargets)}_handlePluginEvent(z,u){switch(z){case 512:{const z=u;for(const u of this._activePlugins)u.getActiveTextures(z.activeTextures);break}case 256:{const z=u;for(const u of this._activePlugins)u.getAnimatables(z.animatables);break}case 1024:{const z=u;let Y=!1;for(const u of this._activePlugins)if(Y=u.hasTexture(z.texture),Y)break;z.hasTexture=Y;break}case 2:{const z=u;for(const u of this._plugins)u.dispose(z.forceDisposeTextures);break}case 4:u.defineNames=this._defineNamesFromPlugins;break;case 128:{const z=u;for(const u of this._activePlugins)z.fallbackRank=u.addFallbacks(z.defines,z.fallbacks,z.fallbackRank),u.getAttributes(z.attributes,this._scene,z.mesh);this._uniformList.length>0&&z.uniforms.push(...this._uniformList),this._samplerList.length>0&&z.samplers.push(...this._samplerList),this._uboList.length>0&&z.uniformBuffersNames.push(...this._uboList),z.customCode=this._injectCustomCode(z,z.customCode);break}case 8:{const z=u;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const Y=1===this._material.shaderLanguage;for(const u of this._plugins){const H=u.getUniforms(this._material.shaderLanguage);if(H){if(H.ubo)for(const u of H.ubo){if(u.size&&u.type){const H=u.arraySize??0;if(z.ubo.addUniform(u.name,u.size,H),Y){let z;switch(u.type){case"mat4":z="mat4x4f";break;case"float":z="f32";break;default:z=`${u.type}f`}this._uboDeclaration+=H>0?`uniform ${u.name}: array<${z}, ${H}>;\n`:`uniform ${u.name}: ${z};\n`}else this._uboDeclaration+=`${u.type} ${u.name}${H>0?`[${H}]`:""};\n`}this._uniformList.push(u.name)}H.vertex&&(this._vertexDeclaration+=H.vertex+"\n"),H.fragment&&(this._fragmentDeclaration+=H.fragment+"\n")}u.getSamplers(this._samplerList),u.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(z,u){if(u)for(const Y in u)this._codeInjectionPoints[z]||(this._codeInjectionPoints[z]={}),this._codeInjectionPoints[z][Y]=!0}_injectCustomCode(z,u){return(Y,H)=>{var E;u&&(H=u(Y,H)),this._uboDeclaration&&(H=H.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(H=H.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(H=H.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const J=null===(E=this._codeInjectionPoints)||void 0===E?void 0:E[Y];if(!J)return H;let l=null;for(let u in J){let E="";for(const H of this._activePlugins){var D;let J=null===(D=H.getCustomCode(Y,this._material.shaderLanguage))||void 0===D?void 0:D[u];if(J){if(H.resolveIncludes){if(null===l){const u=0;l={defines:[],indexParameters:z.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:b.b.GetShadersRepository(u),includesShadersStore:b.b.GetIncludesShadersStore(u),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}l.isFragment="fragment"===Y,(0,T.e)(J,l,(z=>J=z))}E+=J+"\n"}}if(E.length>0)if("!"===u.charAt(0)){u=u.substring(1);let z="g";if("!"===u.charAt(0))z="",u=u.substring(1);else{const Y=L.exec(u);Y&&Y.length>=2&&(z=Y[1],u=u.substring(z.length+1))}z.indexOf("g")<0&&(z+="g");const Y=H,J=new RegExp(u,z);let l=J.exec(Y);for(;null!==l;){let z=E;for(let u=0;u<l.length;++u)z=z.replace("$"+u,l[u]);H=H.replace(l[0],z),l=J.exec(Y)}}else{const z="#define "+u;H=H.replace(z,"\n"+E+"\n"+z)}}return H}}}D._MaterialPluginClassToMainDefine={},D._MaterialPluginCounter=0,l.d.OnEnginesDisposedObservable.add((()=>{C()}));const g=[];let M=!1,q=null;function C(){g.length=0,M=!1,J.d.OnEventObservable.remove(q),q=null}var K=Y(11172),h=Y(10918);class o{isCompatible(z){return 0===z}_enable(z){z&&this._pluginManager._activatePlugin(this)}constructor(z,u,Y,H){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=z,this.name=u,this.priority=Y,this.resolveIncludes=l,z.pluginManager||(z.pluginManager=new D(z),z.fl.add((()=>{z.pluginManager=void 0}))),this._pluginDefineNames=H,this._pluginManager=z.pluginManager,E&&this._pluginManager._addPlugin(this),J&&this._enable(!0),this.markAllDefinesAsDirty=z._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(z,u,Y,H){return!0}hardBindForSubMesh(z,u,Y,H){}bindForSubMesh(z,u,Y,H){}dispose(z){}getCustomCode(z){return null}collectDefines(z){if(this._pluginDefineNames)for(const u of Object.keys(this._pluginDefineNames)){if("_"===u[0])continue;const Y=typeof this._pluginDefineNames[u];z[u]={type:"number"===Y?"number":"string"===Y?"string":"boolean"===Y?"boolean":"object",default:this._pluginDefineNames[u]}}}prepareDefinesBeforeAttributes(z,u,Y){}prepareDefines(z,u,Y){}hasTexture(z){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(z){}getActiveTextures(z){}getAnimatables(z){}addFallbacks(z,u,Y){return Y}getSamplers(z){}getAttributes(z,u,Y){}getUniformBuffersNames(z){}getUniforms(){return{}}copyTo(z){K.d.Clone((()=>z),this)}serialize(){return K.d.Serialize(this)}parse(z,u,Y){K.d.Parse((()=>this),z,u,Y)}}(0,H.e)([(0,E.L)()],o.prototype,"name",void 0),(0,H.e)([(0,E.L)()],o.prototype,"priority",void 0),(0,H.e)([(0,E.L)()],o.prototype,"resolveIncludes",void 0),(0,H.e)([(0,E.L)()],o.prototype,"registerForExtraEvents",void 0),(0,h.d)("BABYLON.MaterialPluginBase",o)},11316:(z,u,Y)=>{Y.d(u,{d:()=>l});var H=Y(11077),E=Y(11181),J=Y(10918);class l extends H.d{get HT(){return this._subMaterials}set HT(z){this._subMaterials=z,this._hookArray(z)}getChildren(){return this.HT}constructor(z,u){super(z,u,!0),this._waitingSubMaterialsUniqueIds=[],this.iz().addMultiMaterial(this),this.HT=[],this._storeEffectOnSubMeshes=!0}_hookArray(z){var u=this;const Y=z.push;z.push=function(){for(var H=arguments.length,E=new Array(H),J=0;J<H;J++)E[J]=arguments[J];const l=Y.apply(z,E);return u._markAllSubMeshesAsTexturesDirty(),l};const H=z.splice;z.splice=(u,Y)=>{const E=H.apply(z,[u,Y]);return this._markAllSubMeshesAsTexturesDirty(),E}}getSubMaterial(z){return z<0||z>=this.HT.length?this.iz().defaultMaterial:this.HT[z]}getActiveTextures(){return super.getActiveTextures().concat(...this.HT.map((z=>z?z.getActiveTextures():[])))}hasTexture(z){if(super.hasTexture(z))return!0;for(let Y=0;Y<this.HT.length;Y++){var u;if(null!==(u=this.HT[Y])&&void 0!==u&&u.hasTexture(z))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(z,u,Y){for(let H=0;H<this.HT.length;H++){const E=this.HT[H];if(E){if(E._storeEffectOnSubMeshes){if(!E.isReadyForSubMesh(z,u,Y))return!1;continue}if(!E.isReady(z))return!1}}return!0}clone(z,u){const Y=new l(z,this.iz());for(let H=0;H<this.HT.length;H++){let E=null;const J=this.HT[H];E=u&&J?J.clone(z+"-"+J.name):this.HT[H],Y.HT.push(E)}return Y}serialize(){const z={};z.name=this.name,z.id=this.id,z.uniqueId=this.uniqueId,E.e&&(z.tags=E.e.GetTags(this)),z.materialsUniqueIds=[],z.materials=[];for(let u=0;u<this.HT.length;u++){const Y=this.HT[u];Y?(z.materialsUniqueIds.push(Y.uniqueId),z.materials.push(Y.id)):(z.materialsUniqueIds.push(null),z.materials.push(null))}return z}dispose(z,u,Y){const H=this.iz();if(!H)return;if(Y)for(let J=0;J<this.HT.length;J++){const Y=this.HT[J];Y&&Y.dispose(z,u)}const E=H.multiMaterials.indexOf(this);E>=0&&H.multiMaterials.splice(E,1),super.dispose(z,u)}static ParseMultiMaterial(z,u){const Y=new l(z.name,u);if(Y.id=z.id,Y._loadedUniqueId=z.uniqueId,E.e&&E.e.AddTagsTo(Y,z.tags),z.materialsUniqueIds)Y._waitingSubMaterialsUniqueIds=z.materialsUniqueIds;else for(const H of z.materials)Y.HT.push(u.getLastMaterialById(H));return Y}}(0,J.d)("BABYLON.MultiMaterial",l)},11572:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(z){z.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(z){}bindForSubMesh(z,u,Y,H,E){if(u.prePassRenderer&&u.prePassRenderer.enabled&&u.prePassRenderer.currentRTisSceneRT&&(-1!==u.prePassRenderer.getIndex(2)||-1!==u.prePassRenderer.getIndex(11))){this.previousWorldMatrices[Y.uniqueId]||(this.previousWorldMatrices[Y.uniqueId]=H.clone()),this.previousViewProjection||(this.previousViewProjection=u.getTransformMatrix().clone(),this.currentViewProjection=u.getTransformMatrix().clone());const E=u.getEngine();this.currentViewProjection.updateFlag!==u.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=E.frameId,this.previousViewProjection.J(this.currentViewProjection),this.currentViewProjection.J(u.getTransformMatrix())):this._lastUpdateFrameId!==E.frameId&&(this._lastUpdateFrameId=E.frameId,this.previousViewProjection.J(this.currentViewProjection)),z.setMatrix("previousWorld",this.previousWorldMatrices[Y.uniqueId]),z.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[Y.uniqueId]=H.clone()}}}},11577:(z,u,Y)=>{Y.d(u,{d:()=>J});var H=Y(10903),E=Y(11077);class J extends E.d{constructor(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(z,u,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new H.b,this._storeEffectOnSubMeshes=Y}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(z,u){return!!z&&(!this._storeEffectOnSubMeshes||(!z.YT||0===z.YT.length||this.isReadyForSubMesh(z,z.YT[0],u)))}_isReadyForSubMesh(z){const u=z.materialDefines;return!(this.checkReadyOnEveryCall||!z.effect||!u||u._renderId!==this.iz().getRenderId())}bindOnlyWorldMatrix(z){this._activeEffect.setMatrix("world",z)}bindOnlyNormalMatrix(z){this._activeEffect.setMatrix("normalMatrix",z)}bind(z,u){u&&this.bindForSubMesh(z,u,u.YT[0])}_afterBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;super._afterBind(z,u,Y),this.iz()._cachedEffect=u,Y?Y._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Y._drawWrapper._forceRebindOnNextCall||z.isCachedMaterialInvalid(this,u,H)}dispose(z,u,Y){this._activeEffect=void 0,super.dispose(z,u,Y)}}},11643:(z,u,Y)=>{Y.d(u,{b:()=>h});var H=Y(11172),E=Y(11504),J=Y(10903),l=Y(11103),T=Y(11415),b=Y(10918),L=Y(11600),D=Y(10972),g=Y(11577),M=Y(10928),q=Y(11212),C=Y(11195);const K={effect:null,subMesh:null};class h extends g.d{constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(z,u,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new J.b,this._cachedWorldViewProjectionMatrix=new J.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=Y,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","wl","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...H}}get shaderPath(){return this._shaderPath}set shaderPath(z){this._shaderPath=z}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(z){-1===this._options.uniforms.indexOf(z)&&this._options.uniforms.push(z)}setTexture(z,u){return-1===this._options.samplers.indexOf(z)&&this._options.samplers.push(z),this._textures[z]=u,this}removeTexture(z){delete this._textures[z]}setTextureArray(z,u){return-1===this._options.samplers.indexOf(z)&&this._options.samplers.push(z),this._checkUniform(z),this._textureArrays[z]=u,this}setExternalTexture(z,u){return-1===this._options.externalTextures.indexOf(z)&&this._options.externalTextures.push(z),this._externalTextures[z]=u,this}setFloat(z,u){return this._checkUniform(z),this._floats[z]=u,this}setInt(z,u){return this._checkUniform(z),this._ints[z]=u,this}setUInt(z,u){return this._checkUniform(z),this._uints[z]=u,this}setFloats(z,u){return this._checkUniform(z),this._floatsArrays[z]=u,this}setColor3(z,u){return this._checkUniform(z),this._colors3[z]=u,this}setColor3Array(z,u){return this._checkUniform(z),this._colors3Arrays[z]=u.reduce(((z,u)=>(z.push(u.r,u.g,u.b),z)),[]),this}setColor4(z,u){return this._checkUniform(z),this._colors4[z]=u,this}setColor4Array(z,u){return this._checkUniform(z),this._colors4Arrays[z]=u.reduce(((z,u)=>(z.push(u.r,u.g,u.b,u.a),z)),[]),this}setVector2(z,u){return this._checkUniform(z),this._vectors2[z]=u,this}setVector3(z,u){return this._checkUniform(z),this._vectors3[z]=u,this}setVector4(z,u){return this._checkUniform(z),this._vectors4[z]=u,this}setQuaternion(z,u){return this._checkUniform(z),this._quaternions[z]=u,this}setQuaternionArray(z,u){return this._checkUniform(z),this._quaternionsArrays[z]=u.reduce(((z,u)=>(u.toArray(z,z.length),z)),[]),this}setMatrix(z,u){return this._checkUniform(z),this._matrices[z]=u,this}setMatrices(z,u){this._checkUniform(z);const Y=new Float32Array(16*u.length);for(let H=0;H<u.length;H++){u[H].copyToArray(Y,16*H)}return this._matrixArrays[z]=Y,this}setMatrix3x3(z,u){return this._checkUniform(z),this._matrices3x3[z]=u,this}setMatrix2x2(z,u){return this._checkUniform(z),this._matrices2x2[z]=u,this}setArray2(z,u){return this._checkUniform(z),this._vectors2Arrays[z]=u,this}setArray3(z,u){return this._checkUniform(z),this._vectors3Arrays[z]=u,this}setArray4(z,u){return this._checkUniform(z),this._vectors4Arrays[z]=u,this}setUniformBuffer(z,u){return-1===this._options.uniformBuffers.indexOf(z)&&this._options.uniformBuffers.push(z),this._uniformBuffers[z]=u,this}setTextureSampler(z,u){return-1===this._options.samplerObjects.indexOf(z)&&this._options.samplerObjects.push(z),this._textureSamplers[z]=u,this}setStorageBuffer(z,u){return-1===this._options.storageBuffers.indexOf(z)&&this._options.storageBuffers.push(z),this._storageBuffers[z]=u,this}setDefine(z,u){const Y=z.trimEnd()+" ",H=this.options.defines.findIndex((u=>u===z||u.startsWith(Y)));return H>=0&&this.options.defines.splice(H,1),("boolean"!==typeof u||u)&&this.options.defines.push(Y+u),this}isReadyForSubMesh(z,u,Y){return this.isReady(z,Y,u)}isReady(z,u,Y){var H;const J=Y&&this._storeEffectOnSubMeshes;if(this.isFrozen){const z=J?Y._drawWrapper:this._drawWrapper;if(z.effect&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===u)return!0}const T=this.iz(),b=T.getEngine(),D=[],g=[];let M=null,h=this._shaderPath,o=this._options.uniforms,d=this._options.uniformBuffers,t=this._options.samplers;b.getCaps().multiview&&T.activeCamera&&T.activeCamera.outputRenderTarget&&T.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,D.push("#define MULTIVIEW"),-1!==o.indexOf("viewProjection")&&-1===o.indexOf("viewProjectionR")&&o.push("viewProjectionR"));for(let E=0;E<this._options.defines.length;E++){const z=0===this._options.defines[E].indexOf("#define")?this._options.defines[E]:`#define ${this._options.defines[E]}`;D.push(z)}for(let E=0;E<this._options.attributes.length;E++)g.push(this._options.attributes[E]);if(z&&z.isVerticesDataPresent(l.f.ColorKind)&&(-1===g.indexOf(l.f.ColorKind)&&g.push(l.f.ColorKind),D.push("#define VERTEXCOLOR")),u&&(D.push("#define INSTANCES"),(0,C.Y)(g,this._materialHelperNeedsPreviousMatrices),null!==z&&void 0!==z&&z.hasThinInstances&&(D.push("#define THIN_INSTANCES"),z&&z.isVerticesDataPresent(l.f.ColorInstanceKind)&&(g.push(l.f.ColorInstanceKind),D.push("#define INSTANCESCOLOR")))),z&&z.useBones&&z.computeBonesUsingShaders&&z.skeleton){g.push(l.f.MatricesIndicesKind),g.push(l.f.MatricesWeightsKind),z.numBoneInfluencers>4&&(g.push(l.f.MatricesIndicesExtraKind),g.push(l.f.MatricesWeightsExtraKind));const u=z.skeleton;D.push("#define NUM_BONE_INFLUENCERS "+z.numBoneInfluencers),M=new L.b,M.addCPUSkinningFallback(0,z),u.isUsingTextureForMatrices?(D.push("#define BONETEXTURE"),-1===o.indexOf("boneTextureWidth")&&o.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(D.push("#define BonesPerMesh "+(u.bones.length+1)),-1===o.indexOf("mBones")&&o.push("mBones"))}else D.push("#define NUM_BONE_INFLUENCERS 0");let W=0;const Z=z?z.morphTargetManager:null;if(Z){const u=-1!==D.indexOf("#define UV1"),Y=-1!==D.indexOf("#define UV2"),H=-1!==D.indexOf("#define TANGENT"),E=-1!==D.indexOf("#define NORMAL"),J=-1!==D.indexOf("#define VERTEXCOLOR");W=(0,C.D)(Z,D,g,z,!0,E,H,u,Y,J),Z.isUsingTextureForTargets&&(-1===o.indexOf("morphTargetTextureIndices")&&o.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),W>0&&(o=o.slice(),o.push("morphTargetInfluences"),o.push("morphTargetCount"),o.push("morphTargetTextureInfo"),o.push("morphTargetTextureIndices"))}else D.push("#define NUM_MORPH_INFLUENCERS 0");if(z){const u=z.bakedVertexAnimationManager;u&&u.isEnabled&&(D.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===o.indexOf("bakedVertexAnimationSettings")&&o.push("bakedVertexAnimationSettings"),-1===o.indexOf("bakedVertexAnimationTextureSizeInverted")&&o.push("bakedVertexAnimationTextureSizeInverted"),-1===o.indexOf("bakedVertexAnimationTime")&&o.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,C.s)(g,z,D)}for(const E in this._textures)if(!this._textures[E].isReady())return!1;z&&this.needAlphaTestingForMesh(z)&&D.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,q.b)(o),(0,q.l)(this,T,D)),T.fogEnabled&&null!==z&&void 0!==z&&z.applyFog&&T.fogMode!==E.d.FOGMODE_NONE&&(D.push("#define FOG"),-1===o.indexOf("view")&&o.push("view"),-1===o.indexOf("vFogInfos")&&o.push("vFogInfos"),-1===o.indexOf("vFogColor")&&o.push("vFogColor")),this._useLogarithmicDepth&&(D.push("#define LOGARITHMICDEPTH"),-1===o.indexOf("logarithmicDepthConstant")&&o.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(o=o.slice(),d=d.slice(),t=t.slice(),h=this.customShaderNameResolve(this.name,o,d,t,D,g));const s=J?Y._getDrawWrapper(void 0,!0):this._drawWrapper,v=(null===s||void 0===s?void 0:s.effect)??null,i=(null===s||void 0===s?void 0:s.defines)??null,X=D.join("\n");let Q=v;return i!==X&&(Q=b.createEffect(h,{attributes:g,uniformsNames:o,uniformBuffersNames:d,samplers:t,defines:X,fallbacks:M,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:W},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},b),J?Y.setEffect(Q,X,this._materialContext):s&&s.setEffect(Q,X),this._onEffectCreatedObservable&&(K.effect=Q,K.subMesh=Y??(null===z||void 0===z?void 0:z.YT[0])??null,this._onEffectCreatedObservable.notifyObservers(K))),s._wasPreviouslyUsingInstances=!!u,!(null===(H=Q)||void 0===H||!H.isReady())&&(v!==Q&&T.resetCachedMaterial(),s._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(z,u){const Y=u??this.getEffect();if(!Y)return;const H=this._options.uniforms;-1!==H.indexOf("world")&&Y.setMatrix("world",z);const E=this.iz();-1!==H.indexOf("worldView")&&(z.multiplyToRef(E.getViewMatrix(),this._cachedWorldViewMatrix),Y.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==H.indexOf("worldViewProjection")&&(z.multiplyToRef(E.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),Y.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==H.indexOf("view")&&Y.setMatrix("view",E.getViewMatrix())}bindForSubMesh(z,u,Y){var H;this.bind(z,u,null===(H=Y._drawWrapperOverride)||void 0===H?void 0:H.effect,Y)}bind(z,u,Y,H){const E=H&&this._storeEffectOnSubMeshes,J=Y??(E?H.effect:this.getEffect());if(!J)return;const l=this.iz();this._activeEffect=J,this.bindOnlyWorldMatrix(z,Y);const T=this._options.uniformBuffers;let b=!1;if(J&&T&&T.length>0&&l.getEngine().supportsUniformBuffers)for(let g=0;g<T.length;++g){switch(T[g]){case"Mesh":u&&(u.getMeshUniformBuffer().bindToEffect(J,"Mesh"),u.transferToEffect(z));break;case"Scene":(0,C.m)(J,l.getSceneUniformBuffer()),l.finalizeSceneUbo(),b=!0}}const L=u&&E?this._mustRebind(l,J,H,u.visibility):l.getCachedMaterial()!==this;if(J&&L){let z;for(z in b||-1===this._options.uniforms.indexOf("view")||J.setMatrix("view",l.getViewMatrix()),b||-1===this._options.uniforms.indexOf("projection")||J.setMatrix("projection",l.getProjectionMatrix()),b||-1===this._options.uniforms.indexOf("viewProjection")||(J.setMatrix("viewProjection",l.getTransformMatrix()),this._multiview&&J.setMatrix("viewProjectionR",l._transformMatrixR)),l.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&J.setVector3("cameraPosition",l.activeCamera.globalPosition),(0,C.c)(u,J),(0,q.f)(J,this,l),this._useLogarithmicDepth&&(0,C.h)(E?H.materialDefines:J.defines,J,l),u&&(0,C.f)(l,u,J),this._textures)J.setTexture(z,this._textures[z]);for(z in this._textureArrays)J.setTextureArray(z,this._textureArrays[z]);for(z in this._ints)J.setInt(z,this._ints[z]);for(z in this._uints)J.setUInt(z,this._uints[z]);for(z in this._floats)J.setFloat(z,this._floats[z]);for(z in this._floatsArrays)J.setArray(z,this._floatsArrays[z]);for(z in this._colors3)J.setColor3(z,this._colors3[z]);for(z in this._colors3Arrays)J.setArray3(z,this._colors3Arrays[z]);for(z in this._colors4){const u=this._colors4[z];J.setFloat4(z,u.r,u.g,u.b,u.a)}for(z in this._colors4Arrays)J.setArray4(z,this._colors4Arrays[z]);for(z in this._vectors2)J.setVector2(z,this._vectors2[z]);for(z in this._vectors3)J.setVector3(z,this._vectors3[z]);for(z in this._vectors4)J.setVector4(z,this._vectors4[z]);for(z in this._quaternions)J.setQuaternion(z,this._quaternions[z]);for(z in this._matrices)J.setMatrix(z,this._matrices[z]);for(z in this._matrixArrays)J.setMatrices(z,this._matrixArrays[z]);for(z in this._matrices3x3)J.setMatrix3x3(z,this._matrices3x3[z]);for(z in this._matrices2x2)J.setMatrix2x2(z,this._matrices2x2[z]);for(z in this._vectors2Arrays)J.setArray2(z,this._vectors2Arrays[z]);for(z in this._vectors3Arrays)J.setArray3(z,this._vectors3Arrays[z]);for(z in this._vectors4Arrays)J.setArray4(z,this._vectors4Arrays[z]);for(z in this._quaternionsArrays)J.setArray4(z,this._quaternionsArrays[z]);for(z in this._uniformBuffers){const u=this._uniformBuffers[z].getBuffer();u&&J.bindUniformBuffer(u,z)}const Y=l.getEngine(),T=Y.setExternalTexture;if(T)for(z in this._externalTextures)T.call(Y,z,this._externalTextures[z]);const L=Y.setTextureSampler;if(L)for(z in this._textureSamplers)L.call(Y,z,this._textureSamplers[z]);const D=Y.setStorageBuffer;if(D)for(z in this._storageBuffers)D.call(Y,z,this._storageBuffers[z])}if(J&&u&&(L||!this.isFrozen)){(0,C.i)(u,J),u.morphTargetManager&&u.morphTargetManager.isUsingTextureForTargets&&u.morphTargetManager._bind(J);const z=u.bakedVertexAnimationManager;if(z&&z.isEnabled){var D;const z=E?H._drawWrapper:this._drawWrapper;null===(D=u.bakedVertexAnimationManager)||void 0===D||D.bind(J,!!z._wasPreviouslyUsingInstances)}}this._afterBind(u,J,H)}getActiveTextures(){const z=super.getActiveTextures();for(const u in this._textures)z.push(this._textures[u]);for(const u in this._textureArrays){const Y=this._textureArrays[u];for(let u=0;u<Y.length;u++)z.push(Y[u])}return z}hasTexture(z){if(super.hasTexture(z))return!0;for(const u in this._textures)if(this._textures[u]===z)return!0;for(const u in this._textureArrays){const Y=this._textureArrays[u];for(let u=0;u<Y.length;u++)if(Y[u]===z)return!0}return!1}clone(z){const u=H.d.Clone((()=>new h(z,this.iz(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);u.name=z,u.id=z,"object"===typeof u._shaderPath&&(u._shaderPath={...u._shaderPath}),this._options={...this._options};const Y=Object.keys(this._options);for(const H of Y){const z=this._options[H];Array.isArray(z)&&(this._options[H]=z.slice(0))}this.stencil.copyTo(u.stencil);for(const H in this._textures)u.setTexture(H,this._textures[H]);for(const H in this._textureArrays)u.setTextureArray(H,this._textureArrays[H]);for(const H in this._externalTextures)u.setExternalTexture(H,this._externalTextures[H]);for(const H in this._ints)u.setInt(H,this._ints[H]);for(const H in this._uints)u.setUInt(H,this._uints[H]);for(const H in this._floats)u.setFloat(H,this._floats[H]);for(const H in this._floatsArrays)u.setFloats(H,this._floatsArrays[H]);for(const H in this._colors3)u.setColor3(H,this._colors3[H]);for(const H in this._colors3Arrays)u._colors3Arrays[H]=this._colors3Arrays[H];for(const H in this._colors4)u.setColor4(H,this._colors4[H]);for(const H in this._colors4Arrays)u._colors4Arrays[H]=this._colors4Arrays[H];for(const H in this._vectors2)u.setVector2(H,this._vectors2[H]);for(const H in this._vectors3)u.setVector3(H,this._vectors3[H]);for(const H in this._vectors4)u.setVector4(H,this._vectors4[H]);for(const H in this._quaternions)u.setQuaternion(H,this._quaternions[H]);for(const H in this._quaternionsArrays)u._quaternionsArrays[H]=this._quaternionsArrays[H];for(const H in this._matrices)u.setMatrix(H,this._matrices[H]);for(const H in this._matrixArrays)u._matrixArrays[H]=this._matrixArrays[H].slice();for(const H in this._matrices3x3)u.setMatrix3x3(H,this._matrices3x3[H]);for(const H in this._matrices2x2)u.setMatrix2x2(H,this._matrices2x2[H]);for(const H in this._vectors2Arrays)u.setArray2(H,this._vectors2Arrays[H]);for(const H in this._vectors3Arrays)u.setArray3(H,this._vectors3Arrays[H]);for(const H in this._vectors4Arrays)u.setArray4(H,this._vectors4Arrays[H]);for(const H in this._uniformBuffers)u.setUniformBuffer(H,this._uniformBuffers[H]);for(const H in this._textureSamplers)u.setTextureSampler(H,this._textureSamplers[H]);for(const H in this._storageBuffers)u.setStorageBuffer(H,this._storageBuffers[H]);return u}dispose(z,u,Y){if(u){let z;for(z in this._textures)this._textures[z].dispose();for(z in this._textureArrays){const u=this._textureArrays[z];for(let z=0;z<u.length;z++)u[z].dispose()}}this._textures={},super.dispose(z,u,Y)}serialize(){const z=H.d.Serialize(this);let u;for(u in z.customType="BABYLON.ShaderMaterial",z.uniqueId=this.uniqueId,z.options=this._options,z.shaderPath=this._shaderPath,z.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,z.stencil=this.stencil.serialize(),z.textures={},this._textures)z.textures[u]=this._textures[u].serialize();for(u in z.textureArrays={},this._textureArrays){z.textureArrays[u]=[];const Y=this._textureArrays[u];for(let H=0;H<Y.length;H++)z.textureArrays[u].push(Y[H].serialize())}for(u in z.ints={},this._ints)z.ints[u]=this._ints[u];for(u in z.uints={},this._uints)z.uints[u]=this._uints[u];for(u in z.floats={},this._floats)z.floats[u]=this._floats[u];for(u in z.floatsArrays={},this._floatsArrays)z.floatsArrays[u]=this._floatsArrays[u];for(u in z.colors3={},this._colors3){const Y=this._colors3[u];z.colors3[u]=[Y.r,Y.g,Y.b]}for(u in z.colors3Arrays={},this._colors3Arrays)z.colors3Arrays[u]=this._colors3Arrays[u];for(u in z.colors4={},this._colors4){const Y=this._colors4[u];z.colors4[u]=[Y.r,Y.g,Y.b,Y.a]}for(u in z.colors4Arrays={},this._colors4Arrays)z.colors4Arrays[u]=this._colors4Arrays[u];for(u in z.vectors2={},this._vectors2){const Y=this._vectors2[u];z.vectors2[u]=[Y.x,Y.y]}for(u in z.vectors3={},this._vectors3){const Y=this._vectors3[u];z.vectors3[u]=[Y.x,Y.y,Y.z]}for(u in z.vectors4={},this._vectors4){const Y=this._vectors4[u];z.vectors4[u]=[Y.x,Y.y,Y.z,Y.w]}for(u in z.quaternions={},this._quaternions)z.quaternions[u]=this._quaternions[u].al();for(u in z.matrices={},this._matrices)z.matrices[u]=this._matrices[u].al();for(u in z.matrixArray={},this._matrixArrays)z.matrixArray[u]=this._matrixArrays[u];for(u in z.matrices3x3={},this._matrices3x3)z.matrices3x3[u]=this._matrices3x3[u];for(u in z.matrices2x2={},this._matrices2x2)z.matrices2x2[u]=this._matrices2x2[u];for(u in z.vectors2Arrays={},this._vectors2Arrays)z.vectors2Arrays[u]=this._vectors2Arrays[u];for(u in z.vectors3Arrays={},this._vectors3Arrays)z.vectors3Arrays[u]=this._vectors3Arrays[u];for(u in z.vectors4Arrays={},this._vectors4Arrays)z.vectors4Arrays[u]=this._vectors4Arrays[u];for(u in z.quaternionsArrays={},this._quaternionsArrays)z.quaternionsArrays[u]=this._quaternionsArrays[u];return z}static Parse(z,u,Y){const E=H.d.Parse((()=>new h(z.name,u,z.shaderPath,z.options,z.storeEffectOnSubMeshes)),z,u,Y);let l;for(l in z.stencil&&E.stencil.parse(z.stencil,u,Y),z.textures)E.setTexture(l,T.b.Parse(z.textures[l],u,Y));for(l in z.textureArrays){const H=z.textureArrays[l],J=[];for(let z=0;z<H.length;z++)J.push(T.b.Parse(H[z],u,Y));E.setTextureArray(l,J)}for(l in z.ints)E.setInt(l,z.ints[l]);for(l in z.uints)E.setUInt(l,z.uints[l]);for(l in z.floats)E.setFloat(l,z.floats[l]);for(l in z.floatsArrays)E.setFloats(l,z.floatsArrays[l]);for(l in z.colors3){const u=z.colors3[l];E.setColor3(l,{r:u[0],g:u[1],b:u[2]})}for(l in z.colors3Arrays){const u=z.colors3Arrays[l].reduce(((z,u,Y)=>(Y%3===0?z.push([u]):z[z.length-1].push(u),z)),[]).map((z=>({r:z[0],g:z[1],b:z[2]})));E.setColor3Array(l,u)}for(l in z.colors4){const u=z.colors4[l];E.setColor4(l,{r:u[0],g:u[1],b:u[2],a:u[3]})}for(l in z.colors4Arrays){const u=z.colors4Arrays[l].reduce(((z,u,Y)=>(Y%4===0?z.push([u]):z[z.length-1].push(u),z)),[]).map((z=>({r:z[0],g:z[1],b:z[2],a:z[3]})));E.setColor4Array(l,u)}for(l in z.vectors2){const u=z.vectors2[l];E.setVector2(l,{x:u[0],y:u[1]})}for(l in z.vectors3){const u=z.vectors3[l];E.setVector3(l,{x:u[0],y:u[1],z:u[2]})}for(l in z.vectors4){const u=z.vectors4[l];E.setVector4(l,{x:u[0],y:u[1],z:u[2],w:u[3]})}for(l in z.quaternions)E.setQuaternion(l,J.f.Nl(z.quaternions[l]));for(l in z.matrices)E.setMatrix(l,J.b.Nl(z.matrices[l]));for(l in z.matrixArray)E._matrixArrays[l]=new Float32Array(z.matrixArray[l]);for(l in z.matrices3x3)E.setMatrix3x3(l,z.matrices3x3[l]);for(l in z.matrices2x2)E.setMatrix2x2(l,z.matrices2x2[l]);for(l in z.vectors2Arrays)E.setArray2(l,z.vectors2Arrays[l]);for(l in z.vectors3Arrays)E.setArray3(l,z.vectors3Arrays[l]);for(l in z.vectors4Arrays)E.setArray4(l,z.vectors4Arrays[l]);for(l in z.quaternionsArrays)E.setArray4(l,z.quaternionsArrays[l]);return E}static async ParseFromFileAsync(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((E,J)=>{const l=new D.d;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const u=JSON.parse(l.responseText),J=this.Parse(u,Y||M.d.LastCreatedScene,H);z&&(J.name=z),E(J)}else J("Unable to load the ShaderMaterial")})),l.open("GET",u),l.send()}))}static async ParseFromSnippetAsync(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((H,E)=>{const J=new D.d;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const E=JSON.parse(JSON.parse(J.responseText).jsonPayload),l=JSON.parse(E.shaderMaterial),T=this.Parse(l,u||M.d.LastCreatedScene,Y);T.snippetId=z,H(T)}else E("Unable to load the snippet "+z)})),J.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),J.send()}))}}h.SnippetUrl="https://snippet.babylonjs.com",h.CreateFromSnippetAsync=h.ParseFromSnippetAsync,(0,b.d)("BABYLON.ShaderMaterial",h)},11616:(z,u,Y)=>{Y.d(u,{e:()=>X});var H=Y(11079),E=Y(11082),J=Y(11283),l=Y(11504),T=Y(11188),b=Y(11103),L=Y(11572),D=Y(11508),g=Y(11077),M=Y(11559),q=Y(11577),C=Y(11415),K=Y(10918),h=Y(11585),o=Y(11600),d=Y(11603),t=Y(11212),W=Y(11195),Z=Y(11172),s=Y(11609);const v={effect:null,subMesh:null};class i extends M.d{constructor(z){super(z),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(z){const u=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const Y of u)this[Y]=Y===z}}class X extends q.d{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=z||this.iz().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(z){this.imageProcessingConfiguration.colorCurvesEnabled=z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(z){this.imageProcessingConfiguration.colorGradingEnabled=z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(z){this._imageProcessingConfiguration.toneMappingEnabled=z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(z){this._imageProcessingConfiguration.exposure=z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(z){this._imageProcessingConfiguration.contrast=z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(z){this._imageProcessingConfiguration.colorGradingTexture=z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(z){this._imageProcessingConfiguration.colorCurves=z}get canRenderToMRT(){return!0}constructor(z,u){super(z,u,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||X.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new T.c(0,0,0),this.diffuseColor=new T.c(1,1,1),this.specularColor=new T.c(1,1,1),this.emissiveColor=new T.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new J.h(16),this._globalAmbientColor=new T.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new d.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new L.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),X.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),X.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(X.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(X.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"TT"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===g.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.jl&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==g.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.jl||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(z,u){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const E=u._drawWrapper;if(E.effect&&this.isFrozen&&E._wasPreviouslyReady&&E._wasPreviouslyUsingInstances===H)return!0;u.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),u.materialDefines=new i(this._eventInfo.defineNames));const J=this.iz(),l=u.materialDefines;if(this._isReadyForSubMesh(u))return!0;const T=J.getEngine();l._needNormals=(0,W.K)(J,z,l,!0,this._maxSimultaneousLights,this._disableLighting),(0,W.P)(J,l);const g=this.needAlphaBlendingForMesh(z)&&this.iz().useOrderIndependentTransparency;if((0,W.S)(J,l,this.canRenderToMRT&&!g),(0,W.Q)(J,l,g),s.b.PrepareDefines(T.currentRenderPassId,z,l),l._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,l._needUVs=!1;for(let z=1;z<=6;++z)l["MAINUV"+z]=!1;if(J.texturesEnabled){if(l.DIFFUSEDIRECTUV=0,l.BUMPDIRECTUV=0,l.AMBIENTDIRECTUV=0,l.OPACITYDIRECTUV=0,l.EMISSIVEDIRECTUV=0,l.SPECULARDIRECTUV=0,l.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&X.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._diffuseTexture,l,"DIFFUSE")}else l.DIFFUSE=!1;if(this._ambientTexture&&X.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._ambientTexture,l,"AMBIENT")}else l.AMBIENT=!1;if(this._opacityTexture&&X.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._opacityTexture,l,"OPACITY"),l.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else l.OPACITY=!1;if(this._reflectionTexture&&X.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(l._needNormals=!0,l.REFLECTION=!0,l.ROUGHNESS=this._roughness>0,l.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,l.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===C.b.INVCUBIC_MODE,l.REFLECTIONMAP_3D=this._reflectionTexture.isCube,l.REFLECTIONMAP_OPPOSITEZ=l.REFLECTIONMAP_3D&&this.iz().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,l.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case C.b.EXPLICIT_MODE:l.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case C.b.PLANAR_MODE:l.setReflectionMode("REFLECTIONMAP_PLANAR");break;case C.b.PROJECTION_MODE:l.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case C.b.SKYBOX_MODE:l.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case C.b.SPHERICAL_MODE:l.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case C.b.EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case C.b.FIXED_EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case C.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:l.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case C.b.CUBIC_MODE:case C.b.INVCUBIC_MODE:default:l.setReflectionMode("REFLECTIONMAP_CUBIC")}l.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else l.REFLECTION=!1,l.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&X.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._emissiveTexture,l,"EMISSIVE")}else l.EMISSIVE=!1;if(this._lightmapTexture&&X.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._lightmapTexture,l,"LIGHTMAP"),l.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,l.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else l.LIGHTMAP=!1;if(this._specularTexture&&X.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,W.L)(this._specularTexture,l,"SPECULAR"),l.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else l.SPECULAR=!1;if(J.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&X.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,W.L)(this._bumpTexture,l,"BUMP"),l.PARALLAX=this._useParallax,l.PARALLAX_RHS=J.useRightHandedSystem,l.PARALLAXOCCLUSION=this._useParallaxOcclusion,l.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else l.BUMP=!1,l.PARALLAX=!1,l.PARALLAX_RHS=!1,l.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&X.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;l._needUVs=!0,l.REFRACTION=!0,l.REFRACTIONMAP_3D=this._refractionTexture.isCube,l.RGBDREFRACTION=this._refractionTexture.isRGBD,l.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else l.REFRACTION=!1;l.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else l.DIFFUSE=!1,l.AMBIENT=!1,l.OPACITY=!1,l.REFLECTION=!1,l.EMISSIVE=!1,l.LIGHTMAP=!1,l.BUMP=!1,l.REFRACTION=!1;l.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),l.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,l.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,l.SPECULAROVERALPHA=this._useSpecularOverAlpha,l.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,l.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,l.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(z)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=l,this._eventInfo.subMesh=u,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(l._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(l),l.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,l.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(l._areFresnelDirty&&(X.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(l.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,l.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,l.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,l.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,l.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,l.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,l._needNormals=!0,l.FRESNEL=!0):l.FRESNEL=!1),l.AREALIGHTUSED)for(let Y=0;Y<z.lightSources.length;Y++)if(!z.lightSources[Y]._isReady())return!1;(0,W.O)(z,J,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(z),l,this._applyDecalMapAfterDetailMap),(0,W.G)(J,T,this,l,H,null,u.getRenderingMesh().hasThinInstances),this._eventInfo.defines=l,this._eventInfo.mesh=z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,W.E)(z,l,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let M=!1;if(l.isDirty){const H=l._areLightsDisposed;l.markAsProcessed();const E=new o.b;l.REFLECTION&&E.addFallback(0,"REFLECTION"),l.SPECULAR&&E.addFallback(0,"SPECULAR"),l.BUMP&&E.addFallback(0,"BUMP"),l.PARALLAX&&E.addFallback(1,"PARALLAX"),l.PARALLAX_RHS&&E.addFallback(1,"PARALLAX_RHS"),l.PARALLAXOCCLUSION&&E.addFallback(0,"PARALLAXOCCLUSION"),l.SPECULAROVERALPHA&&E.addFallback(0,"SPECULAROVERALPHA"),l.FOG&&E.addFallback(1,"FOG"),l.POINTSIZE&&E.addFallback(0,"POINTSIZE"),l.LOGARITHMICDEPTH&&E.addFallback(0,"LOGARITHMICDEPTH"),(0,W.r)(l,E,this._maxSimultaneousLights),l.SPECULARTERM&&E.addFallback(0,"SPECULARTERM"),l.DIFFUSEFRESNEL&&E.addFallback(1,"DIFFUSEFRESNEL"),l.OPACITYFRESNEL&&E.addFallback(2,"OPACITYFRESNEL"),l.REFLECTIONFRESNEL&&E.addFallback(3,"REFLECTIONFRESNEL"),l.EMISSIVEFRESNEL&&E.addFallback(4,"EMISSIVEFRESNEL"),l.FRESNEL&&E.addFallback(4,"FRESNEL"),l.MULTIVIEW&&E.addFallback(0,"MULTIVIEW");const g=[b.f.PositionKind];l.NORMAL&&g.push(b.f.NormalKind),l.TANGENT&&g.push(b.f.TangentKind);for(let z=1;z<=6;++z)l["UV"+z]&&g.push(`uv${1===z?"":z}`);l.VERTEXCOLOR&&g.push(b.f.ColorKind),(0,W.t)(g,z,l,E),(0,W.x)(g,l),(0,W.z)(g,z,l),(0,W.s)(g,z,l);let q="default";const C=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],K=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],h=["Material","Scene","Mesh"],d={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:l.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=E,this._eventInfo.fallbackRank=0,this._eventInfo.defines=l,this._eventInfo.uniforms=C,this._eventInfo.attributes=g,this._eventInfo.samplers=K,this._eventInfo.uniformBuffersNames=h,this._eventInfo.customCode=void 0,this._eventInfo.mesh=z,this._eventInfo.indexParameters=d,this._callbackPluginEventGeneric(128,this._eventInfo),s.b.AddUniformsAndSamplers(C,K),L.b.AddUniforms(C),L.b.AddSamplers(K),D.e&&(D.e.PrepareUniforms(C,l),D.e.PrepareSamplers(K,l)),(0,W.U)({uniformsNames:C,uniformBuffersNames:h,samplers:K,defines:l,maxSimultaneousLights:this._maxSimultaneousLights}),(0,t.b)(C);const Z={};this.customShaderNameResolve&&(q=this.customShaderNameResolve(q,C,h,K,l,g,Z));const i=l.toString(),X=u.effect;let Q=J.getEngine().createEffect(q,{attributes:g,uniformsNames:C,uniformBuffersNames:h,samplers:K,defines:i,fallbacks:E,onCompiled:this.onCompiled,onError:this.onError,indexParameters:d,processFinalCode:Z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:l.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([Y.e(20),Y.e(51)]).then(Y.bind(Y,13852)),Promise.all([Y.e(18),Y.e(52)]).then(Y.bind(Y,13857))]):await Promise.all([Promise.all([Y.e(13),Y.e(53)]).then(Y.bind(Y,13860)),Promise.all([Y.e(12),Y.e(54)]).then(Y.bind(Y,13868))]),this._shadersLoaded=!0}},T);if(this._eventInfo.customCode=void 0,Q)if(this._onEffectCreatedObservable&&(v.effect=Q,v.subMesh=u,this._onEffectCreatedObservable.notifyObservers(v)),this.allowShaderHotSwapping&&X&&!Q.isReady()){if(Q=X,l.markAsUnprocessed(),M=this.isFrozen,H)return l._areLightsDisposed=!0,!1}else J.resetCachedMaterial(),u.setEffect(Q,l,this._materialContext)}return!(!u.effect||!u.effect.isReady())&&(l._renderId=J.getRenderId(),E._wasPreviouslyReady=!M,E._wasPreviouslyUsingInstances=H,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const z=this._uniformBuffer;z.addUniform("diffuseLeftColor",4),z.addUniform("diffuseRightColor",4),z.addUniform("opacityParts",4),z.addUniform("reflectionLeftColor",4),z.addUniform("reflectionRightColor",4),z.addUniform("refractionLeftColor",4),z.addUniform("refractionRightColor",4),z.addUniform("emissiveLeftColor",4),z.addUniform("emissiveRightColor",4),z.addUniform("vDiffuseInfos",2),z.addUniform("vAmbientInfos",2),z.addUniform("vOpacityInfos",2),z.addUniform("vReflectionInfos",2),z.addUniform("vReflectionPosition",3),z.addUniform("vReflectionSize",3),z.addUniform("vEmissiveInfos",2),z.addUniform("vLightmapInfos",2),z.addUniform("vSpecularInfos",2),z.addUniform("vBumpInfos",3),z.addUniform("diffuseMatrix",16),z.addUniform("ambientMatrix",16),z.addUniform("opacityMatrix",16),z.addUniform("reflectionMatrix",16),z.addUniform("emissiveMatrix",16),z.addUniform("lightmapMatrix",16),z.addUniform("specularMatrix",16),z.addUniform("bumpMatrix",16),z.addUniform("vTangentSpaceParams",2),z.addUniform("pointSize",1),z.addUniform("alphaCutOff",1),z.addUniform("refractionMatrix",16),z.addUniform("vRefractionInfos",4),z.addUniform("vRefractionPosition",3),z.addUniform("vRefractionSize",3),z.addUniform("vSpecularColor",4),z.addUniform("vEmissiveColor",3),z.addUniform("vDiffuseColor",4),z.addUniform("vAmbientColor",3),z.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(z,u,Y){const H=this.iz(),E=Y.materialDefines;if(!E)return;const J=Y.effect;if(!J)return;this._activeEffect=J,u.getMeshUniformBuffer().bindToEffect(J,"Mesh"),u.transferToEffect(z),this._uniformBuffer.bindToEffect(J,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,H,u,z,this.isFrozen),s.b.Bind(H.getEngine().currentRenderPassId,this._activeEffect,u,z,this);const b=H.activeCamera;b?this._uniformBuffer.updateFloat4("cameraInfo",b.uT,b.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=Y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),E.OBJECTSPACE_NORMALMAP&&(z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const L=this._mustRebind(H,J,Y,u.visibility);(0,W.c)(u,J);const D=this._uniformBuffer;if(L){if(this.bindViewProjection(J),!D.useUbo||!this.isFrozen||!D.isSync||Y._drawWrapper._forceRebindOnNextCall){if(X.FresnelEnabled&&E.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(D.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),D.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&D.updateColor4("opacityParts",new T.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(D.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),D.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(D.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),D.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(D.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),D.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),H.texturesEnabled){if(this._diffuseTexture&&X.DiffuseTextureEnabled&&(D.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,W.p)(this._diffuseTexture,D,"diffuse")),this._ambientTexture&&X.AmbientTextureEnabled&&(D.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,W.p)(this._ambientTexture,D,"ambient")),this._opacityTexture&&X.OpacityTextureEnabled&&(D.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,W.p)(this._opacityTexture,D,"opacity")),this._hasAlphaChannel()&&D.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&X.ReflectionTextureEnabled){if(D.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),D.rl("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const z=this._reflectionTexture;D.updateVector3("vReflectionPosition",z.boundingBoxPosition),D.updateVector3("vReflectionSize",z.boundingBoxSize)}}else D.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&X.EmissiveTextureEnabled&&(D.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,W.p)(this._emissiveTexture,D,"emissive")),this._lightmapTexture&&X.LightmapTextureEnabled&&(D.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,W.p)(this._lightmapTexture,D,"lightmap")),this._specularTexture&&X.SpecularTextureEnabled&&(D.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,W.p)(this._specularTexture,D,"specular")),this._bumpTexture&&H.getEngine().getCaps().standardDerivatives&&X.BumpTextureEnabled&&(D.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,W.p)(this._bumpTexture,D,"bump"),H._mirroredCameraPosition?D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&X.RefractionTextureEnabled){let z=1;if(this._refractionTexture.isCube||(D.rl("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(z=this._refractionTexture.depth)),D.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,z,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const z=this._refractionTexture;D.updateVector3("vRefractionPosition",z.boundingBoxPosition),D.updateVector3("vRefractionSize",z.boundingBoxSize)}}}this.pointsCloud&&D.updateFloat("pointSize",this.pointSize),D.updateColor4("vSpecularColor",this.specularColor,this.specularPower),D.updateColor3("vEmissiveColor",X.EmissiveTextureEnabled?this.emissiveColor:T.c.BlackReadOnly),D.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),H.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),D.updateColor3("vAmbientColor",this._globalAmbientColor)}H.texturesEnabled&&(this._diffuseTexture&&X.DiffuseTextureEnabled&&J.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&X.AmbientTextureEnabled&&J.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&X.OpacityTextureEnabled&&J.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&X.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?J.setTexture("reflectionCubeSampler",this._reflectionTexture):J.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&X.EmissiveTextureEnabled&&J.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&X.LightmapTextureEnabled&&J.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&X.SpecularTextureEnabled&&J.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&H.getEngine().getCaps().standardDerivatives&&X.BumpTextureEnabled&&J.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&X.RefractionTextureEnabled&&(this._refractionTexture.isCube?J.setTexture("refractionCubeSampler",this._refractionTexture):J.setTexture("refraction2DSampler",this._refractionTexture))),this.iz().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(u)&&this.iz().depthPeelingRenderer.bind(J),this._eventInfo.subMesh=Y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,t.f)(J,this,H),this.bindEyePosition(J)}else H.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(L||!this.isFrozen){var g;if(H.lightsEnabled&&!this._disableLighting&&(0,W.g)(H,u,J,E,this._maxSimultaneousLights),(H.fogEnabled&&u.applyFog&&H.fogMode!==l.d.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||u.receiveShadows||E.PREPASS)&&this.bindView(J),(0,W.f)(H,u,J),E.NUM_MORPH_INFLUENCERS&&(0,W.i)(u,J),E.BAKED_VERTEX_ANIMATION_TEXTURE)null===(g=u.bakedVertexAnimationManager)||void 0===g||g.bind(J,E.INSTANCES);this.useLogarithmicDepth&&(0,W.h)(E,J,H),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(u,this._activeEffect,Y),D.update()}getAnimatables(){const z=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&z.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&z.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&z.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&z.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&z.push(this._refractionTexture),z}getActiveTextures(){const z=super.getActiveTextures();return this._diffuseTexture&&z.push(this._diffuseTexture),this._ambientTexture&&z.push(this._ambientTexture),this._opacityTexture&&z.push(this._opacityTexture),this._reflectionTexture&&z.push(this._reflectionTexture),this._emissiveTexture&&z.push(this._emissiveTexture),this._specularTexture&&z.push(this._specularTexture),this._bumpTexture&&z.push(this._bumpTexture),this._lightmapTexture&&z.push(this._lightmapTexture),this._refractionTexture&&z.push(this._refractionTexture),z}hasTexture(z){return!!super.hasTexture(z)||(this._diffuseTexture===z||(this._ambientTexture===z||(this._opacityTexture===z||(this._reflectionTexture===z||(this._emissiveTexture===z||(this._specularTexture===z||(this._bumpTexture===z||(this._lightmapTexture===z||this._refractionTexture===z))))))))}dispose(z,u){var Y,H,E,J,l,T,b,L,D;u&&(null===(Y=this._diffuseTexture)||void 0===Y||Y.dispose(),null===(H=this._ambientTexture)||void 0===H||H.dispose(),null===(E=this._opacityTexture)||void 0===E||E.dispose(),null===(J=this._reflectionTexture)||void 0===J||J.dispose(),null===(l=this._emissiveTexture)||void 0===l||l.dispose(),null===(T=this._specularTexture)||void 0===T||T.dispose(),null===(b=this._bumpTexture)||void 0===b||b.dispose(),null===(L=this._lightmapTexture)||void 0===L||L.dispose(),null===(D=this._refractionTexture)||void 0===D||D.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(z,u)}clone(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const H=Z.d.Clone((()=>new X(z,this.iz())),this,{cloneTexturesOnlyOnce:u});return H.name=z,H.id=z,this.stencil.copyTo(H.stencil),this._clonePlugins(H,Y),H}static Parse(z,u,Y){const H=Z.d.Parse((()=>new X(z.name,u)),z,u,Y);return z.stencil&&H.stencil.parse(z.stencil,u,Y),g.d._ParsePlugins(z,H,u,Y),H}static get DiffuseTextureEnabled(){return h.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(z){h.e.DiffuseTextureEnabled=z}static get DetailTextureEnabled(){return h.e.DetailTextureEnabled}static set DetailTextureEnabled(z){h.e.DetailTextureEnabled=z}static get AmbientTextureEnabled(){return h.e.AmbientTextureEnabled}static set AmbientTextureEnabled(z){h.e.AmbientTextureEnabled=z}static get OpacityTextureEnabled(){return h.e.OpacityTextureEnabled}static set OpacityTextureEnabled(z){h.e.OpacityTextureEnabled=z}static get ReflectionTextureEnabled(){return h.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(z){h.e.ReflectionTextureEnabled=z}static get EmissiveTextureEnabled(){return h.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(z){h.e.EmissiveTextureEnabled=z}static get SpecularTextureEnabled(){return h.e.SpecularTextureEnabled}static set SpecularTextureEnabled(z){h.e.SpecularTextureEnabled=z}static get BumpTextureEnabled(){return h.e.BumpTextureEnabled}static set BumpTextureEnabled(z){h.e.BumpTextureEnabled=z}static get LightmapTextureEnabled(){return h.e.LightmapTextureEnabled}static set LightmapTextureEnabled(z){h.e.LightmapTextureEnabled=z}static get RefractionTextureEnabled(){return h.e.RefractionTextureEnabled}static set RefractionTextureEnabled(z){h.e.RefractionTextureEnabled=z}static get ColorGradingTextureEnabled(){return h.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(z){h.e.ColorGradingTextureEnabled=z}static get FresnelEnabled(){return h.e.FresnelEnabled}static set FresnelEnabled(z){h.e.FresnelEnabled=z}}X.ForceGLSL=!1,(0,H.e)([(0,E.C)("diffuseTexture")],X.prototype,"_diffuseTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"diffuseTexture",void 0),(0,H.e)([(0,E.C)("ambientTexture")],X.prototype,"_ambientTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"ambientTexture",void 0),(0,H.e)([(0,E.C)("opacityTexture")],X.prototype,"_opacityTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"opacityTexture",void 0),(0,H.e)([(0,E.C)("reflectionTexture")],X.prototype,"_reflectionTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectionTexture",void 0),(0,H.e)([(0,E.C)("emissiveTexture")],X.prototype,"_emissiveTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"emissiveTexture",void 0),(0,H.e)([(0,E.C)("specularTexture")],X.prototype,"_specularTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"specularTexture",void 0),(0,H.e)([(0,E.C)("bumpTexture")],X.prototype,"_bumpTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"bumpTexture",void 0),(0,H.e)([(0,E.C)("lightmapTexture")],X.prototype,"_lightmapTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"lightmapTexture",void 0),(0,H.e)([(0,E.C)("refractionTexture")],X.prototype,"_refractionTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"refractionTexture",void 0),(0,H.e)([(0,E.j)("ambient")],X.prototype,"ambientColor",void 0),(0,H.e)([(0,E.j)("diffuse")],X.prototype,"diffuseColor",void 0),(0,H.e)([(0,E.j)("specular")],X.prototype,"specularColor",void 0),(0,H.e)([(0,E.j)("emissive")],X.prototype,"emissiveColor",void 0),(0,H.e)([(0,E.L)()],X.prototype,"specularPower",void 0),(0,H.e)([(0,E.L)("useAlphaFromDiffuseTexture")],X.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"useAlphaFromDiffuseTexture",void 0),(0,H.e)([(0,E.L)("useEmissiveAsIllumination")],X.prototype,"_useEmissiveAsIllumination",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useEmissiveAsIllumination",void 0),(0,H.e)([(0,E.L)("linkEmissiveWithDiffuse")],X.prototype,"_linkEmissiveWithDiffuse",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"linkEmissiveWithDiffuse",void 0),(0,H.e)([(0,E.L)("useSpecularOverAlpha")],X.prototype,"_useSpecularOverAlpha",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useSpecularOverAlpha",void 0),(0,H.e)([(0,E.L)("useReflectionOverAlpha")],X.prototype,"_useReflectionOverAlpha",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useReflectionOverAlpha",void 0),(0,H.e)([(0,E.L)("disableLighting")],X.prototype,"_disableLighting",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsLightsDirty")],X.prototype,"disableLighting",void 0),(0,H.e)([(0,E.L)("useObjectSpaceNormalMap")],X.prototype,"_useObjectSpaceNormalMap",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useObjectSpaceNormalMap",void 0),(0,H.e)([(0,E.L)("useParallax")],X.prototype,"_useParallax",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useParallax",void 0),(0,H.e)([(0,E.L)("useParallaxOcclusion")],X.prototype,"_useParallaxOcclusion",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useParallaxOcclusion",void 0),(0,H.e)([(0,E.L)()],X.prototype,"parallaxScaleBias",void 0),(0,H.e)([(0,E.L)("roughness")],X.prototype,"_roughness",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"roughness",void 0),(0,H.e)([(0,E.L)()],X.prototype,"indexOfRefraction",void 0),(0,H.e)([(0,E.L)()],X.prototype,"invertRefractionY",void 0),(0,H.e)([(0,E.L)()],X.prototype,"alphaCutOff",void 0),(0,H.e)([(0,E.L)("useLightmapAsShadowmap")],X.prototype,"_useLightmapAsShadowmap",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useLightmapAsShadowmap",void 0),(0,H.e)([(0,E.q)("diffuseFresnelParameters")],X.prototype,"_diffuseFresnelParameters",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelDirty")],X.prototype,"diffuseFresnelParameters",void 0),(0,H.e)([(0,E.q)("opacityFresnelParameters")],X.prototype,"_opacityFresnelParameters",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],X.prototype,"opacityFresnelParameters",void 0),(0,H.e)([(0,E.q)("reflectionFresnelParameters")],X.prototype,"_reflectionFresnelParameters",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelDirty")],X.prototype,"reflectionFresnelParameters",void 0),(0,H.e)([(0,E.q)("refractionFresnelParameters")],X.prototype,"_refractionFresnelParameters",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelDirty")],X.prototype,"refractionFresnelParameters",void 0),(0,H.e)([(0,E.q)("emissiveFresnelParameters")],X.prototype,"_emissiveFresnelParameters",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelDirty")],X.prototype,"emissiveFresnelParameters",void 0),(0,H.e)([(0,E.L)("useReflectionFresnelFromSpecular")],X.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsFresnelDirty")],X.prototype,"useReflectionFresnelFromSpecular",void 0),(0,H.e)([(0,E.L)("useGlossinessFromSpecularMapAlpha")],X.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,H.e)([(0,E.L)("maxSimultaneousLights")],X.prototype,"_maxSimultaneousLights",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsLightsDirty")],X.prototype,"maxSimultaneousLights",void 0),(0,H.e)([(0,E.L)("invertNormalMapX")],X.prototype,"_invertNormalMapX",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertNormalMapX",void 0),(0,H.e)([(0,E.L)("invertNormalMapY")],X.prototype,"_invertNormalMapY",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertNormalMapY",void 0),(0,H.e)([(0,E.L)("twoSidedLighting")],X.prototype,"_twoSidedLighting",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"twoSidedLighting",void 0),(0,H.e)([(0,E.L)("applyDecalMapAfterDetailMap")],X.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,H.e)([(0,E.c)("_markAllSubMeshesAsMiscDirty")],X.prototype,"applyDecalMapAfterDetailMap",void 0),(0,K.d)("BABYLON.StandardMaterial",X),l.d.DefaultMaterialFactory=z=>new X("default material",z)},11163:(z,u,Y)=>{Y.d(u,{b:()=>J});var H=Y(10953),E=Y(10945);class J{constructor(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=z,this._noUBO=!z.supportsUniformBuffers||E,this._dynamic=Y,this._name=H??"no-name",this._data=u||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.rl=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.rl=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(z){let u;if(u=z<=2?z:4,this._uniformLocationPointer%u!==0){const z=this._uniformLocationPointer;this._uniformLocationPointer+=u-this._uniformLocationPointer%u;const Y=this._uniformLocationPointer-z;for(let u=0;u<Y;u++)this._data.push(0)}}addUniform(z,u){let Y,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[z]){if(H>0){if(u instanceof Array)throw"addUniform should not be use with Array in UBO: "+z;if(this._fillAlignment(4),this._uniformArraySizes[z]={strideSize:u,arraySize:H},16==u)u*=H;else{u=u*H+(4-u)*H}Y=[];for(let z=0;z<u;z++)Y.push(0)}else{if(u instanceof Array)Y=u,u=Y.length;else{Y=[];for(let z=0;z<u;z++)Y.push(0)}this._fillAlignment(u)}this._uniformSizes[z]=u,this._uniformLocations[z]=this._uniformLocationPointer,this._uniformLocationPointer+=u;for(let z=0;z<u;z++)this._data.push(Y[z]);this._needSync=!0}}addMatrix(z,u){this.addUniform(z,Array.prototype.slice.call(u.al()))}addFloat2(z,u,Y){const H=[u,Y];this.addUniform(z,H)}addFloat3(z,u,Y,H){const E=[u,Y,H];this.addUniform(z,E)}addColor3(z,u){const Y=[u.r,u.g,u.b];this.addUniform(z,Y)}addColor4(z,u,Y){const H=[u.r,u.g,u.b,Y];this.addUniform(z,H)}addVector3(z,u){const Y=[u.x,u.y,u.z];this.addUniform(z,Y)}addMatrix3x3(z){this.addUniform(z,12)}addMatrix2x2(z){this.addUniform(z,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const z=[];let u=0;for(const Y in this._uniformLocations)if(z.push(Y),10===++u)break;return z.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(z,u){for(let Y=0;Y<z.length;++Y)if(z[Y]!==u[Y])return!1;return!0}_copyBuffer(z,u){for(let Y=0;Y<z.length;++Y)u[Y]=z[Y]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(J._UpdatedUbosInFrame[this._name]||(J._UpdatedUbosInFrame[this._name]=0),J._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(z,u,Y){this._checkNewFrame();let E=this._uniformLocations[z];if(void 0===E){if(this._buffer)return void H.b.Error("Cannot add an uniform after UBO has been created. uniformName="+z);this.addUniform(z,Y),E=this._uniformLocations[z]}if(this._buffer||this.create(),this._dynamic)for(let H=0;H<Y;H++)this._bufferData[E+H]=u[H];else{let z=!1;for(let H=0;H<Y;H++)(16===Y&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[E+H]!==Math.fround(u[H]))&&(z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[E+H]=u[H]);this._needSync=this._needSync||z}}updateUniformArray(z,u,Y){this._checkNewFrame();const J=this._uniformLocations[z];if(void 0===J)return void H.b.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const l=this._uniformArraySizes[z];if(this._dynamic)for(let H=0;H<Y;H++)this._bufferData[J+H]=u[H];else{let z=!1,H=0,T=0;for(let b=0;b<Y;b++)if(this._bufferData[J+4*T+H]!==E.e.FloatRound(u[b])&&(z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[J+4*T+H]=u[b]),H++,H===l.strideSize){for(;H<4;H++)this._bufferData[J+4*T+H]=0;H=0,T++}this._needSync=this._needSync||z}}_cacheMatrix(z,u){this._checkNewFrame();const Y=this._valueCache[z],H=u.updateFlag;return(void 0===Y||Y!==H)&&(this._valueCache[z]=H,!0)}_updateMatrix3x3ForUniform(z,u){for(let Y=0;Y<3;Y++)J._TempBuffer[4*Y]=u[3*Y],J._TempBuffer[4*Y+1]=u[3*Y+1],J._TempBuffer[4*Y+2]=u[3*Y+2],J._TempBuffer[4*Y+3]=0;this.updateUniform(z,J._TempBuffer,12)}_updateMatrix3x3ForEffect(z,u){this._currentEffect.setMatrix3x3(z,u)}_updateMatrix2x2ForEffect(z,u){this._currentEffect.setMatrix2x2(z,u)}_updateMatrix2x2ForUniform(z,u){for(let Y=0;Y<2;Y++)J._TempBuffer[4*Y]=u[2*Y],J._TempBuffer[4*Y+1]=u[2*Y+1],J._TempBuffer[4*Y+2]=0,J._TempBuffer[4*Y+3]=0;this.updateUniform(z,J._TempBuffer,8)}_updateFloatForEffect(z,u){this._currentEffect.setFloat(z,u)}_updateFloatForUniform(z,u){J._TempBuffer[0]=u,this.updateUniform(z,J._TempBuffer,1)}_updateFloat2ForEffect(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(z+H,u,Y)}_updateFloat2ForUniform(z,u,Y){J._TempBuffer[0]=u,J._TempBuffer[1]=Y,this.updateUniform(z,J._TempBuffer,2)}_updateFloat3ForEffect(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(z+E,u,Y,H)}_updateFloat3ForUniform(z,u,Y,H){J._TempBuffer[0]=u,J._TempBuffer[1]=Y,J._TempBuffer[2]=H,this.updateUniform(z,J._TempBuffer,3)}_updateFloat4ForEffect(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(z+J,u,Y,H,E)}_updateFloat4ForUniform(z,u,Y,H,E){J._TempBuffer[0]=u,J._TempBuffer[1]=Y,J._TempBuffer[2]=H,J._TempBuffer[3]=E,this.updateUniform(z,J._TempBuffer,4)}_updateFloatArrayForEffect(z,u){this._currentEffect.setFloatArray(z,u)}_updateFloatArrayForUniform(z,u){this.updateUniformArray(z,u,u.length)}_updateArrayForEffect(z,u){this._currentEffect.setArray(z,u)}_updateArrayForUniform(z,u){this.updateUniformArray(z,u,u.length)}_updateIntArrayForEffect(z,u){this._currentEffect.setIntArray(z,u)}_updateIntArrayForUniform(z,u){J._TempBufferInt32View.set(u),this.updateUniformArray(z,J._TempBuffer,u.length)}_updateUIntArrayForEffect(z,u){this._currentEffect.setUIntArray(z,u)}_updateUIntArrayForUniform(z,u){J._TempBufferUInt32View.set(u),this.updateUniformArray(z,J._TempBuffer,u.length)}_updateMatrixForEffect(z,u){this._currentEffect.setMatrix(z,u)}_updateMatrixForUniform(z,u){this._cacheMatrix(z,u)&&this.updateUniform(z,u.al(),16)}_updateMatricesForEffect(z,u){this._currentEffect.setMatrices(z,u)}_updateMatricesForUniform(z,u){this.updateUniform(z,u,u.length)}_updateVector3ForEffect(z,u){this._currentEffect.setVector3(z,u)}_updateVector3ForUniform(z,u){J._TempBuffer[0]=u.x,J._TempBuffer[1]=u.y,J._TempBuffer[2]=u.z,this.updateUniform(z,J._TempBuffer,3)}_updateVector4ForEffect(z,u){this._currentEffect.setVector4(z,u)}_updateVector4ForUniform(z,u){J._TempBuffer[0]=u.x,J._TempBuffer[1]=u.y,J._TempBuffer[2]=u.z,J._TempBuffer[3]=u.w,this.updateUniform(z,J._TempBuffer,4)}_updateColor3ForEffect(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(z+Y,u)}_updateColor3ForUniform(z,u){J._TempBuffer[0]=u.r,J._TempBuffer[1]=u.g,J._TempBuffer[2]=u.b,this.updateUniform(z,J._TempBuffer,3)}_updateColor4ForEffect(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(z+H,u,Y)}_updateDirectColor4ForEffect(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(z+Y,u)}_updateColor4ForUniform(z,u,Y){J._TempBuffer[0]=u.r,J._TempBuffer[1]=u.g,J._TempBuffer[2]=u.b,J._TempBuffer[3]=Y,this.updateUniform(z,J._TempBuffer,4)}_updateDirectColor4ForUniform(z,u){J._TempBuffer[0]=u.r,J._TempBuffer[1]=u.g,J._TempBuffer[2]=u.b,J._TempBuffer[3]=u.a,this.updateUniform(z,J._TempBuffer,4)}_updateIntForEffect(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(z+Y,u)}_updateIntForUniform(z,u){J._TempBufferInt32View[0]=u,this.updateUniform(z,J._TempBuffer,1)}_updateInt2ForEffect(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(z+H,u,Y)}_updateInt2ForUniform(z,u,Y){J._TempBufferInt32View[0]=u,J._TempBufferInt32View[1]=Y,this.updateUniform(z,J._TempBuffer,2)}_updateInt3ForEffect(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(z+E,u,Y,H)}_updateInt3ForUniform(z,u,Y,H){J._TempBufferInt32View[0]=u,J._TempBufferInt32View[1]=Y,J._TempBufferInt32View[2]=H,this.updateUniform(z,J._TempBuffer,3)}_updateInt4ForEffect(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(z+J,u,Y,H,E)}_updateInt4ForUniform(z,u,Y,H,E){J._TempBufferInt32View[0]=u,J._TempBufferInt32View[1]=Y,J._TempBufferInt32View[2]=H,J._TempBufferInt32View[3]=E,this.updateUniform(z,J._TempBuffer,4)}_updateUIntForEffect(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(z+Y,u)}_updateUIntForUniform(z,u){J._TempBufferUInt32View[0]=u,this.updateUniform(z,J._TempBuffer,1)}_updateUInt2ForEffect(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(z+H,u,Y)}_updateUInt2ForUniform(z,u,Y){J._TempBufferUInt32View[0]=u,J._TempBufferUInt32View[1]=Y,this.updateUniform(z,J._TempBuffer,2)}_updateUInt3ForEffect(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(z+E,u,Y,H)}_updateUInt3ForUniform(z,u,Y,H){J._TempBufferUInt32View[0]=u,J._TempBufferUInt32View[1]=Y,J._TempBufferUInt32View[2]=H,this.updateUniform(z,J._TempBuffer,3)}_updateUInt4ForEffect(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(z+J,u,Y,H,E)}_updateUInt4ForUniform(z,u,Y,H,E){J._TempBufferUInt32View[0]=u,J._TempBufferUInt32View[1]=Y,J._TempBufferUInt32View[2]=H,J._TempBufferUInt32View[3]=E,this.updateUniform(z,J._TempBuffer,4)}setTexture(z,u){this._currentEffect.setTexture(z,u)}setTextureArray(z,u){this._currentEffect.setTextureArray(z,u)}bindTexture(z,u){this._currentEffect._bindTexture(z,u)}updateUniformDirectly(z,u){this.updateUniform(z,u,u.length),this.update()}bindToEffect(z,u){this._currentEffect=z,this._currentEffectName=u}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(z){if(!this._buffers)return this._buffer===z;for(let u=0;u<this._buffers.length;++u){if(this._buffers[u][0]===z)return this._bufferIndex=u,this._buffer=z,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[u][1]&&this._bufferData.set(this._buffers[u][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const z=this._engine._uniformBuffers,u=z.indexOf(this);if(-1!==u&&(z[u]=z[z.length-1],z.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let Y=0;Y<this._buffers.length;++Y){const z=this._buffers[Y][0];this._engine._releaseBuffer(z)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}J._UpdatedUbosInFrame={},J._MAX_UNIFORM_SIZE=256,J._TempBuffer=new Float32Array(J._MAX_UNIFORM_SIZE),J._TempBufferInt32View=new Int32Array(J._TempBuffer.buffer),J._TempBufferUInt32View=new Uint32Array(J._TempBuffer.buffer)},11256:(z,u,Y)=>{Y.d(u,{c:()=>l,e:()=>H});var H,E,J=Y(10903);!function(z){z[z.LOCAL=0]="LOCAL",z[z.WORLD=1]="WORLD",z[z.BONE=2]="BONE"}(H||(H={}));class l{}l.X=new J.p(1,0,0),l.Y=new J.p(0,1,0),l.Z=new J.p(0,0,1),function(z){z[z.X=0]="X",z[z.Y=1]="Y",z[z.Z=2]="Z"}(E||(E={}))},11188:(z,u,Y)=>{Y.d(u,{c:()=>g,e:()=>M,g:()=>q});var H=Y(10910),E=Y(10918),J=Y(10906),l=Y(10937);function T(z){return Math.pow(z,J.n)}function b(z){return z<=.04045?.0773993808*z:Math.pow(.947867299*(z+.055),2.4)}function L(z){return Math.pow(z,J.j)}function D(z){return z<=.0031308?12.92*z:1.055*Math.pow(z,.41666)-.055}class g{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=z,this.g=u,this.b=Y}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"o"}getHashCode(){let z=255*this.r|0;return z=397*z^255*this.g,z=397*z^255*this.b,z}toArray(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[u]=this.r,z[u+1]=this.g,z[u+2]=this.b,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return g.FromArrayToRef(z,u,this),this}toColor4(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new M(this.r,this.g,this.b,z)}al(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(z){return new g(this.r*z.r,this.g*z.g,this.b*z.b)}multiplyToRef(z,u){return u.r=this.r*z.r,u.g=this.g*z.g,u.b=this.b*z.b,u}multiplyInPlace(z){return this.r*=z.r,this.g*=z.g,this.b*=z.b,this}multiplyByFloats(z,u,Y){return new g(this.r*z,this.g*u,this.b*Y)}divide(z){throw new ReferenceError("Can not divide a color")}divideToRef(z,u){throw new ReferenceError("Can not divide a color")}divideInPlace(z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z.r,z.g,z.b)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z.r,z.g,z.b)}minimizeInPlaceFromFloats(z,u,Y){return this.r=Math.min(z,this.r),this.g=Math.min(u,this.g),this.b=Math.min(Y,this.b),this}maximizeInPlaceFromFloats(z,u,Y){return this.r=Math.max(z,this.r),this.g=Math.max(u,this.g),this.b=Math.max(Y,this.b),this}floorToRef(z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(z){return z&&this.r===z.r&&this.g===z.g&&this.b===z.b}equalsFloats(z,u,Y){return this.equalsToFloats(z,u,Y)}equalsToFloats(z,u,Y){return this.r===z&&this.g===u&&this.b===Y}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.e;return(0,l.WithinEpsilon)(this.r,z.r,u)&&(0,l.WithinEpsilon)(this.g,z.g,u)&&(0,l.WithinEpsilon)(this.b,z.b,u)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(z){throw new ReferenceError("Can not negate a color")}scale(z){return new g(this.r*z,this.g*z,this.b*z)}scaleInPlace(z){return this.r*=z,this.g*=z,this.b*=z,this}scaleToRef(z,u){return u.r=this.r*z,u.g=this.g*z,u.b=this.b*z,u}scaleAndAddToRef(z,u){return u.r+=this.r*z,u.g+=this.g*z,u.b+=this.b*z,u}clampToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;return Y.r=(0,l.Clamp)(this.r,z,u),Y.g=(0,l.Clamp)(this.g,z,u),Y.b=(0,l.Clamp)(this.b,z,u),Y}add(z){return new g(this.r+z.r,this.g+z.g,this.b+z.b)}addInPlace(z){return this.r+=z.r,this.g+=z.g,this.b+=z.b,this}addInPlaceFromFloats(z,u,Y){return this.r+=z,this.g+=u,this.b+=Y,this}addToRef(z,u){return u.r=this.r+z.r,u.g=this.g+z.g,u.b=this.b+z.b,u}JY(z){return new g(this.r-z.r,this.g-z.g,this.b-z.b)}subtractToRef(z,u){return u.r=this.r-z.r,u.g=this.g-z.g,u.b=this.b-z.b,u}dg(z){return this.r-=z.r,this.g-=z.g,this.b-=z.b,this}subtractFromFloats(z,u,Y){return new g(this.r-z,this.g-u,this.b-Y)}subtractFromFloatsToRef(z,u,Y,H){return H.r=this.r-z,H.g=this.g-u,H.b=this.b-Y,H}clone(){return new g(this.r,this.g,this.b)}J(z){return this.r=z.r,this.g=z.g,this.b=z.b,this}kl(z,u,Y){return this.r=z,this.g=u,this.b=Y,this}set(z,u,Y){return this.kl(z,u,Y)}Bl(z){return this.r=this.g=this.b=z,this}toHexString(){const z=Math.round(255*this.r),u=Math.round(255*this.g),Y=Math.round(255*this.b);return"#"+(0,l.ToHex)(z)+(0,l.ToHex)(u)+(0,l.ToHex)(Y)}fromHexString(z){return"#"!==z.substring(0,1)||7!==z.length||(this.r=parseInt(z.substring(1,3),16)/255,this.g=parseInt(z.substring(3,5),16)/255,this.b=parseInt(z.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new g)}toHSVToRef(z){const u=this.r,Y=this.g,H=this.b,E=Math.max(u,Y,H),J=Math.min(u,Y,H);let l=0,T=0;const b=E,L=E-J;return 0!==E&&(T=L/E),E!=J&&(E==u?(l=(Y-H)/L,Y<H&&(l+=6)):E==Y?l=(H-u)/L+2:E==H&&(l=(u-Y)/L+4),l*=60),z.r=l,z.g=T,z.b=b,z}toLinearSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=new g;return this.toLinearSpaceToRef(u,z),u}toLinearSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=b(this.r),z.g=b(this.g),z.b=b(this.b)):(z.r=T(this.r),z.g=T(this.g),z.b=T(this.b)),this}toGammaSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=new g;return this.toGammaSpaceToRef(u,z),u}toGammaSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=D(this.r),z.g=D(this.g),z.b=D(this.b)):(z.r=L(this.r),z.g=L(this.g),z.b=L(this.b)),this}static HSVtoRGBToRef(z,u,Y,H){const E=Y*u,J=z/60,l=E*(1-Math.abs(J%2-1));let T=0,b=0,L=0;J>=0&&J<=1?(T=E,b=l):J>=1&&J<=2?(T=l,b=E):J>=2&&J<=3?(b=E,L=l):J>=3&&J<=4?(b=l,L=E):J>=4&&J<=5?(T=l,L=E):J>=5&&J<=6&&(T=E,L=l);const D=Y-E;return H.r=T+D,H.g=b+D,H.b=L+D,H}static FromHSV(z,u,Y){const H=new g(0,0,0);return g.HSVtoRGBToRef(z,u,Y,H),H}static FromHexString(z){return new g(0,0,0).fromHexString(z)}static Nl(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new g(z[u],z[u+1],z[u+2])}static FromArrayToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;Y.r=z[u],Y.g=z[u+1],Y.b=z[u+2]}static FromInts(z,u,Y){return new g(z/255,u/255,Y/255)}static Lerp(z,u,Y){const H=new g(0,0,0);return g.LerpToRef(z,u,Y,H),H}static LerpToRef(z,u,Y,H){H.r=z.r+(u.r-z.r)*Y,H.g=z.g+(u.g-z.g)*Y,H.b=z.b+(u.b-z.b)*Y}static Hermite(z,u,Y,H,E){const J=E*E,l=E*J,T=2*l-3*J+1,b=-2*l+3*J,L=l-2*J+E,D=l-J,M=z.r*T+Y.r*b+u.r*L+H.r*D,q=z.g*T+Y.g*b+u.g*L+H.g*D,C=z.b*T+Y.b*b+u.b*L+H.b*D;return new g(M,q,C)}static Hermite1stDerivative(z,u,Y,H,E){const J=g.Black();return this.Hermite1stDerivativeToRef(z,u,Y,H,E,J),J}static Hermite1stDerivativeToRef(z,u,Y,H,E,J){const l=E*E;J.r=6*(l-E)*z.r+(3*l-4*E+1)*u.r+6*(-l+E)*Y.r+(3*l-2*E)*H.r,J.g=6*(l-E)*z.g+(3*l-4*E+1)*u.g+6*(-l+E)*Y.g+(3*l-2*E)*H.g,J.b=6*(l-E)*z.b+(3*l-4*E+1)*u.b+6*(-l+E)*Y.b+(3*l-2*E)*H.b}static Red(){return new g(1,0,0)}static Green(){return new g(0,1,0)}static Blue(){return new g(0,0,1)}static Black(){return new g(0,0,0)}static get BlackReadOnly(){return g._BlackReadOnly}static White(){return new g(1,1,1)}static Purple(){return new g(.5,0,.5)}static Magenta(){return new g(1,0,1)}static Yellow(){return new g(1,1,0)}static Gray(){return new g(.5,.5,.5)}static Teal(){return new g(0,1,1)}static Random(){return new g(Math.random(),Math.random(),Math.random())}}g._V8PerformanceHack=new g(.5,.5,.5),g._BlackReadOnly=g.Black(),Object.defineProperties(g.prototype,{dimension:{value:[3]},rank:{value:1}});class M{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=z,this.g=u,this.b=Y,this.a=H}al(){return[this.r,this.g,this.b,this.a]}toArray(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[u]=this.r,z[u+1]=this.g,z[u+2]=this.b,z[u+3]=this.a,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=z[u],this.g=z[u+1],this.b=z[u+2],this.a=z[u+3],this}equals(z){return z&&this.r===z.r&&this.g===z.g&&this.b===z.b&&this.a===z.a}add(z){return new M(this.r+z.r,this.g+z.g,this.b+z.b,this.a+z.a)}addToRef(z,u){return u.r=this.r+z.r,u.g=this.g+z.g,u.b=this.b+z.b,u.a=this.a+z.a,u}addInPlace(z){return this.r+=z.r,this.g+=z.g,this.b+=z.b,this.a+=z.a,this}addInPlaceFromFloats(z,u,Y,H){return this.r+=z,this.g+=u,this.b+=Y,this.a+=H,this}JY(z){return new M(this.r-z.r,this.g-z.g,this.b-z.b,this.a-z.a)}subtractToRef(z,u){return u.r=this.r-z.r,u.g=this.g-z.g,u.b=this.b-z.b,u.a=this.a-z.a,u}dg(z){return this.r-=z.r,this.g-=z.g,this.b-=z.b,this.a-=z.a,this}subtractFromFloats(z,u,Y,H){return new M(this.r-z,this.g-u,this.b-Y,this.a-H)}subtractFromFloatsToRef(z,u,Y,H,E){return E.r=this.r-z,E.g=this.g-u,E.b=this.b-Y,E.a=this.a-H,E}scale(z){return new M(this.r*z,this.g*z,this.b*z,this.a*z)}scaleInPlace(z){return this.r*=z,this.g*=z,this.b*=z,this.a*=z,this}scaleToRef(z,u){return u.r=this.r*z,u.g=this.g*z,u.b=this.b*z,u.a=this.a*z,u}scaleAndAddToRef(z,u){return u.r+=this.r*z,u.g+=this.g*z,u.b+=this.b*z,u.a+=this.a*z,u}clampToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;return Y.r=(0,l.Clamp)(this.r,z,u),Y.g=(0,l.Clamp)(this.g,z,u),Y.b=(0,l.Clamp)(this.b,z,u),Y.a=(0,l.Clamp)(this.a,z,u),Y}multiply(z){return new M(this.r*z.r,this.g*z.g,this.b*z.b,this.a*z.a)}multiplyToRef(z,u){return u.r=this.r*z.r,u.g=this.g*z.g,u.b=this.b*z.b,u.a=this.a*z.a,u}multiplyInPlace(z){return this.r*=z.r,this.g*=z.g,this.b*=z.b,this.a*=z.a,this}multiplyByFloats(z,u,Y,H){return new M(this.r*z,this.g*u,this.b*Y,this.a*H)}divide(z){throw new ReferenceError("Can not divide a color")}divideToRef(z,u){throw new ReferenceError("Can not divide a color")}divideInPlace(z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(z){return this.r=Math.min(this.r,z.r),this.g=Math.min(this.g,z.g),this.b=Math.min(this.b,z.b),this.a=Math.min(this.a,z.a),this}maximizeInPlace(z){return this.r=Math.max(this.r,z.r),this.g=Math.max(this.g,z.g),this.b=Math.max(this.b,z.b),this.a=Math.max(this.a,z.a),this}minimizeInPlaceFromFloats(z,u,Y,H){return this.r=Math.min(z,this.r),this.g=Math.min(u,this.g),this.b=Math.min(Y,this.b),this.a=Math.min(H,this.a),this}maximizeInPlaceFromFloats(z,u,Y,H){return this.r=Math.max(z,this.r),this.g=Math.max(u,this.g),this.b=Math.max(Y,this.b),this.a=Math.max(H,this.a),this}floorToRef(z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(z){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.e;return(0,l.WithinEpsilon)(this.r,z.r,u)&&(0,l.WithinEpsilon)(this.g,z.g,u)&&(0,l.WithinEpsilon)(this.b,z.b,u)&&(0,l.WithinEpsilon)(this.a,z.a,u)}equalsToFloats(z,u,Y,H){return this.r===z&&this.g===u&&this.b===Y&&this.a===H}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"zb"}getHashCode(){let z=255*this.r|0;return z=397*z^255*this.g,z=397*z^255*this.b,z=397*z^255*this.a,z}clone(){return(new M).J(this)}J(z){return this.r=z.r,this.g=z.g,this.b=z.b,this.a=z.a,this}kl(z,u,Y,H){return this.r=z,this.g=u,this.b=Y,this.a=H,this}set(z,u,Y,H){return this.kl(z,u,Y,H)}Bl(z){return this.r=this.g=this.b=this.a=z,this}toHexString(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=Math.round(255*this.r),Y=Math.round(255*this.g),H=Math.round(255*this.b);if(z)return"#"+(0,l.ToHex)(u)+(0,l.ToHex)(Y)+(0,l.ToHex)(H);const E=Math.round(255*this.a);return"#"+(0,l.ToHex)(u)+(0,l.ToHex)(Y)+(0,l.ToHex)(H)+(0,l.ToHex)(E)}fromHexString(z){return"#"!==z.substring(0,1)||9!==z.length&&7!==z.length||(this.r=parseInt(z.substring(1,3),16)/255,this.g=parseInt(z.substring(3,5),16)/255,this.b=parseInt(z.substring(5,7),16)/255,9===z.length&&(this.a=parseInt(z.substring(7,9),16)/255)),this}toLinearSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=new M;return this.toLinearSpaceToRef(u,z),u}toLinearSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=b(this.r),z.g=b(this.g),z.b=b(this.b)):(z.r=T(this.r),z.g=T(this.g),z.b=T(this.b)),z.a=this.a,this}toGammaSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=new M;return this.toGammaSpaceToRef(u,z),u}toGammaSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=D(this.r),z.g=D(this.g),z.b=D(this.b)):(z.r=L(this.r),z.g=L(this.g),z.b=L(this.b)),z.a=this.a,this}static FromHexString(z){return"#"!==z.substring(0,1)||9!==z.length&&7!==z.length?new M(0,0,0,0):new M(0,0,0,1).fromHexString(z)}static Lerp(z,u,Y){return M.LerpToRef(z,u,Y,new M)}static LerpToRef(z,u,Y,H){return H.r=z.r+(u.r-z.r)*Y,H.g=z.g+(u.g-z.g)*Y,H.b=z.b+(u.b-z.b)*Y,H.a=z.a+(u.a-z.a)*Y,H}static Hermite(z,u,Y,H,E){const J=E*E,l=E*J,T=2*l-3*J+1,b=-2*l+3*J,L=l-2*J+E,D=l-J,g=z.r*T+Y.r*b+u.r*L+H.r*D,q=z.g*T+Y.g*b+u.g*L+H.g*D,C=z.b*T+Y.b*b+u.b*L+H.b*D,K=z.a*T+Y.a*b+u.a*L+H.a*D;return new M(g,q,C,K)}static Hermite1stDerivative(z,u,Y,H,E){const J=new M;return this.Hermite1stDerivativeToRef(z,u,Y,H,E,J),J}static Hermite1stDerivativeToRef(z,u,Y,H,E,J){const l=E*E;J.r=6*(l-E)*z.r+(3*l-4*E+1)*u.r+6*(-l+E)*Y.r+(3*l-2*E)*H.r,J.g=6*(l-E)*z.g+(3*l-4*E+1)*u.g+6*(-l+E)*Y.g+(3*l-2*E)*H.g,J.b=6*(l-E)*z.b+(3*l-4*E+1)*u.b+6*(-l+E)*Y.b+(3*l-2*E)*H.b,J.a=6*(l-E)*z.a+(3*l-4*E+1)*u.a+6*(-l+E)*Y.a+(3*l-2*E)*H.a}static FromColor3(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new M(z.r,z.g,z.b,u)}static Nl(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new M(z[u],z[u+1],z[u+2],z[u+3])}static FromArrayToRef(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;Y.r=z[u],Y.g=z[u+1],Y.b=z[u+2],Y.a=z[u+3]}static FromInts(z,u,Y,H){return new M(z/255,u/255,Y/255,H/255)}static CheckColors4(z,u){if(z.length===3*u){const u=[];for(let Y=0;Y<z.length;Y+=3){const H=Y/3*4;u[H]=z[Y],u[H+1]=z[Y+1],u[H+2]=z[Y+2],u[H+3]=1}return u}return z}}M._V8PerformanceHack=new M(.5,.5,.5,.5),Object.defineProperties(M.prototype,{dimension:{value:[4]},rank:{value:1}});class q{}q.o=(0,H.b)(3,g.Black),q.zb=(0,H.b)(3,(()=>new M(0,0,0,0))),(0,E.d)("BABYLON.Color3",g),(0,E.d)("BABYLON.Color4",M)},10906:(z,u,Y)=>{Y.d(u,{e:()=>l,f:()=>J,j:()=>H,n:()=>E});const H=1/2.2,E=2.2,J=(1+Math.sqrt(5))/2,l=.001},11291:(z,u,Y)=>{Y.d(u,{d:()=>E});var H=Y(11170);class E{static GetPlanes(z){const u=[];for(let Y=0;Y<6;Y++)u.push(new H.b(0,0,0,0));return E.GetPlanesToRef(z,u),u}static GetNearPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]+Y[2],u.wl.y=Y[7]+Y[6],u.wl.z=Y[11]+Y[10],u.d=Y[15]+Y[14],u.normalize()}static GetFarPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]-Y[2],u.wl.y=Y[7]-Y[6],u.wl.z=Y[11]-Y[10],u.d=Y[15]-Y[14],u.normalize()}static GetLeftPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]+Y[0],u.wl.y=Y[7]+Y[4],u.wl.z=Y[11]+Y[8],u.d=Y[15]+Y[12],u.normalize()}static GetRightPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]-Y[0],u.wl.y=Y[7]-Y[4],u.wl.z=Y[11]-Y[8],u.d=Y[15]-Y[12],u.normalize()}static GetTopPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]-Y[1],u.wl.y=Y[7]-Y[5],u.wl.z=Y[11]-Y[9],u.d=Y[15]-Y[13],u.normalize()}static GetBottomPlaneToRef(z,u){const Y=z.m;u.wl.x=Y[3]+Y[1],u.wl.y=Y[7]+Y[5],u.wl.z=Y[11]+Y[9],u.d=Y[15]+Y[13],u.normalize()}static GetPlanesToRef(z,u){E.GetNearPlaneToRef(z,u[0]),E.GetFarPlaneToRef(z,u[1]),E.GetLeftPlaneToRef(z,u[2]),E.GetRightPlaneToRef(z,u[3]),E.GetTopPlaneToRef(z,u[4]),E.GetBottomPlaneToRef(z,u[5])}static IsPointInFrustum(z,u){for(let Y=0;Y<6;Y++)if(u[Y].dotCoordinate(z)<0)return!1;return!0}}},11148:(z,u,Y)=>{Y.d(u,{e:()=>T,i:()=>b});var H=Y(11079),E=Y(10903),J=Y(11082);class l{static extractMinAndMaxIndexed(z,u,Y,H,E,J){for(let l=Y;l<Y+H;l++){const Y=3*u[l],H=z[Y],T=z[Y+1],b=z[Y+2];E.minimizeInPlaceFromFloats(H,T,b),J.maximizeInPlaceFromFloats(H,T,b)}}static extractMinAndMax(z,u,Y,H,E,J){for(let l=u,T=u*H;l<u+Y;l++,T+=H){const u=z[T],Y=z[T+1],H=z[T+2];E.minimizeInPlaceFromFloats(u,Y,H),J.maximizeInPlaceFromFloats(u,Y,H)}}}function T(z,u,Y,H){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const T=new E.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new E.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return l.extractMinAndMaxIndexed(z,u,Y,H,T,b),J&&(T.x-=T.x*J.x+J.y,T.y-=T.y*J.x+J.y,T.z-=T.z*J.x+J.y,b.x+=b.x*J.x+J.y,b.y+=b.y*J.x+J.y,b.z+=b.z*J.x+J.y),{minimum:T,maximum:b}}function b(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;const T=new E.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new E.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return J||(J=3),l.extractMinAndMax(z,u,Y,J,T,b),H&&(T.x-=T.x*H.x+H.y,T.y-=T.y*H.x+H.y,T.z-=T.z*H.x+H.y,b.x+=b.x*H.x+H.y,b.y+=b.y*H.x+H.y,b.z+=b.z*H.x+H.y),{minimum:T,maximum:b}}(0,H.e)([J.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H,E]=u;return!Array.isArray(H)&&!Array.isArray(E)}))],l,"extractMinAndMaxIndexed",null),(0,H.e)([J.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H]=u;return!Array.isArray(H)}))],l,"extractMinAndMax",null)},11386:(z,u,Y)=>{Y.d(u,{d:()=>H.b,g:()=>H.f,h:()=>H.i,i:()=>H.p});Y(11256),Y(11188),Y(10906),Y(11291),Y(11389),Y(11170),Y(11393);var H=Y(10903);Y(11285)},11389:(z,u,Y)=>{Y.d(u,{c:()=>T,d:()=>M,e:()=>D,g:()=>g});var H,E=Y(10937),J=Y(10903),l=Y(10906);!function(z){z[z.CW=0]="CW",z[z.CCW=1]="CCW"}(H||(H={}));class T{static Interpolate(z,u,Y,H,E){if(0===z)return 0;const J=1-3*H+3*u,l=3*H-6*u,T=3*u;let b=z;for(let L=0;L<5;L++){const u=b*b;b-=(J*(u*b)+l*u+T*b-z)*(1/(3*J*u+2*l*b+T)),b=Math.min(1,Math.max(0,b))}return 3*Math.pow(1-b,2)*b*Y+3*(1-b)*Math.pow(b,2)*E+Math.pow(b,3)}}class b{constructor(z){this._radians=z,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(z,u){const Y=u.JY(z),H=Math.atan2(Y.y,Y.x);return new b(H)}static BetweenTwoVectors(z,u){let Y=z.lengthSquared()*u.lengthSquared();if(0===Y)return new b(Math.PI/2);Y=Math.sqrt(Y);let H=z.dot(u)/Y;H=(0,E.Clamp)(H,-1,1);const J=Math.acos(H);return new b(J)}static FromRadians(z){return new b(z)}static FromDegrees(z){return new b(z*Math.PI/180)}}class L{constructor(z,u,Y){this.startPoint=z,this.midPoint=u,this.endPoint=Y;const H=Math.pow(u.x,2)+Math.pow(u.y,2),E=(Math.pow(z.x,2)+Math.pow(z.y,2)-H)/2,l=(H-Math.pow(Y.x,2)-Math.pow(Y.y,2))/2,T=(z.x-u.x)*(u.y-Y.y)-(u.x-Y.x)*(z.y-u.y);this.centerPoint=new J.m((E*(u.y-Y.y)-l*(z.y-u.y))/T,((z.x-u.x)*l-(u.x-Y.x)*E)/T),this.radius=this.centerPoint.JY(this.startPoint).length(),this.startAngle=b.BetweenTwoPoints(this.centerPoint,this.startPoint);const L=this.startAngle.degrees();let D=b.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),g=b.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();D-L>180&&(D-=360),D-L<-180&&(D+=360),g-D>180&&(g-=360),g-D<-180&&(g+=360),this.orientation=D-L<0?0:1,this.angle=b.FromDegrees(0===this.orientation?L-g:g-L)}}class D{constructor(z,u){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new J.m(z,u))}addLineTo(z,u){if(this.closed)return this;const Y=new J.m(z,u),H=this._points[this._points.length-1];return this._points.push(Y),this._length+=Y.JY(H).length(),this}addArcTo(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const l=this._points[this._points.length-1],T=new J.m(z,u),b=new J.m(Y,H),D=new L(l,T,b);let g=D.angle.radians()/E;0===D.orientation&&(g*=-1);let M=D.startAngle.radians()+g;for(let J=0;J<E;J++){const z=Math.cos(M)*D.radius+D.centerPoint.x,u=Math.sin(M)*D.radius+D.centerPoint.y;this.addLineTo(z,u),M+=g}return this}addQuadraticCurveTo(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const J=(z,u,Y,H)=>(1-z)*(1-z)*u+2*z*(1-z)*Y+z*z*H,l=this._points[this._points.length-1];for(let T=0;T<=E;T++){const b=T/E,L=J(b,l.x,z,Y),D=J(b,l.y,u,H);this.addLineTo(L,D)}return this}addBezierCurveTo(z,u,Y,H,E,J){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const T=(z,u,Y,H,E)=>(1-z)*(1-z)*(1-z)*u+3*z*(1-z)*(1-z)*Y+3*z*z*(1-z)*H+z*z*z*E,b=this._points[this._points.length-1];for(let L=0;L<=l;L++){const D=L/l,g=T(D,b.x,z,Y,E),M=T(D,b.y,u,H,J);this.addLineTo(g,M)}return this}isPointInside(z){let u=!1;const Y=this._points.length;for(let H=Y-1,E=0;E<Y;H=E++){let Y=this._points[H],J=this._points[E],l=J.x-Y.x,T=J.y-Y.y;if(Math.abs(T)>Number.EPSILON){if(T<0&&(Y=this._points[E],l=-l,J=this._points[H],T=-T),z.y<Y.y||z.y>J.y)continue;if(z.y===Y.y&&z.x===Y.x)return!0;{const H=T*(z.x-Y.x)-l*(z.y-Y.y);if(0===H)return!0;if(H<0)continue;u=!u}}else{if(z.y!==Y.y)continue;if(J.x<=z.x&&z.x<=Y.x||Y.x<=z.x&&z.x<=J.x)return!0}}return u}close(){return this.closed=!0,this}length(){let z=this._length;if(this.closed){const u=this._points[this._points.length-1];z+=this._points[0].JY(u).length()}return z}area(){const z=this._points.length;let u=0;for(let Y=z-1,H=0;H<z;Y=H++)u+=this._points[Y].x*this._points[H].y-this._points[H].x*this._points[Y].y;return.5*u}getPoints(){return this._points}getPointAtLengthPosition(z){if(z<0||z>1)return J.m.Zero();const u=z*this.length();let Y=0;for(let H=0;H<this._points.length;H++){const z=(H+1)%this._points.length,E=this._points[H],l=this._points[z].JY(E),T=l.length()+Y;if(u>=Y&&u<=T){const z=l.normalize(),H=u-Y;return new J.m(E.x+z.x*H,E.y+z.y*H)}Y=T}return J.m.Zero()}static StartingAt(z,u){return new D(z,u)}}class g{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=z,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:J.p.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:J.b.Identity()};for(let E=0;E<z.length;E++)this._curve[E]=z[E].clone();this._raw=Y||!1,this._alignTangentsWithPath=H,this._compute(u,H)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(z){return this._updatePointAtData(z).point}getTangentAt(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,u),u?J.p.TransformCoordinates(J.p.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,u),u?J.p.TransformCoordinates(J.p.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,u),u?J.p.TransformCoordinates(J.p.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(z){return this.length()*z}getPreviousPointIndexAt(z){return this._updatePointAtData(z),this._pointAtData.previousPointArrayIndex}getSubPositionAt(z){return this._updatePointAtData(z),this._pointAtData.subPosition}getClosestPositionTo(z){let u=Number.MAX_VALUE,Y=0;for(let H=0;H<this._curve.length-1;H++){const E=this._curve[H+0],l=this._curve[H+1].JY(E).normalize(),T=this._distances[H+1]-this._distances[H+0],b=Math.min(Math.max(J.p.Dot(l,z.JY(E).normalize()),0)*J.p.Distance(E,z)/T,1),L=J.p.Distance(E.add(l.scale(b*T)),z);L<u&&(u=L,Y=(this._distances[H+0]+T*b)/this.length())}return Y}slice(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(z<0&&(z=1- -1*z%1),u<0&&(u=1- -1*u%1),z>u){const Y=z;z=u,u=Y}const Y=this.getCurve(),H=this.getPointAt(z);let E=this.getPreviousPointIndexAt(z);const J=this.getPointAt(u),l=this.getPreviousPointIndexAt(u)+1,T=[];return 0!==z&&(E++,T.push(H)),T.push(...Y.slice(E,l)),1===u&&1!==z||T.push(J),new g(T,this.getNormalAt(z),this._raw,this._alignTangentsWithPath)}update(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let H=0;H<z.length;H++)this._curve[H].x=z[H].x,this._curve[H].y=z[H].y,this._curve[H].z=z[H].z;return this._compute(u,Y),this}_compute(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=this._curve.length;if(Y<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[Y-1]=this._curve[Y-1].JY(this._curve[Y-2]),this._raw||this._tangents[Y-1].normalize();const H=this._tangents[0],E=this._normalVector(H,z);let l,T,b,L,D;this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=J.p.Cross(H,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let g=1;g<Y;g++)l=this._getLastNonNullVector(g),g<Y-1&&(T=this._getFirstNonNullVector(g),this._tangents[g]=u?T:l.add(T),this._tangents[g].normalize()),this._distances[g]=this._distances[g-1]+this._curve[g].JY(this._curve[g-1]).length(),b=this._tangents[g],D=this._binormals[g-1],this._normals[g]=J.p.Cross(D,b),this._raw||(0===this._normals[g].length()?(L=this._normals[g-1],this._normals[g]=L.clone()):this._normals[g].normalize()),this._binormals[g]=J.p.Cross(b,this._normals[g]),this._raw||this._binormals[g].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(z){let u=1,Y=this._curve[z+u].JY(this._curve[z]);for(;0===Y.length()&&z+u+1<this._curve.length;)u++,Y=this._curve[z+u].JY(this._curve[z]);return Y}_getLastNonNullVector(z){let u=1,Y=this._curve[z].JY(this._curve[z-u]);for(;0===Y.length()&&z>u+1;)u++,Y=this._curve[z].JY(this._curve[z-u]);return Y}_normalVector(z,u){let Y,H=z.length();if(0===H&&(H=1),void 0===u||null===u){let u;u=(0,E.WithinEpsilon)(Math.abs(z.y)/H,1,l.e)?(0,E.WithinEpsilon)(Math.abs(z.x)/H,1,l.e)?(0,E.WithinEpsilon)(Math.abs(z.z)/H,1,l.e)?J.p.Zero():new J.p(0,0,1):new J.p(1,0,0):new J.p(0,-1,0),Y=J.p.Cross(z,u)}else Y=J.p.Cross(z,u),J.p.CrossToRef(Y,z,Y);return Y.normalize(),Y}_updatePointAtData(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===z)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=z;const Y=this.getPoints();if(z<=0)return this._setPointAtData(0,0,Y[0],0,u);if(z>=1)return this._setPointAtData(1,1,Y[Y.length-1],Y.length-1,u);let H,E=Y[0],l=0;const T=z*this.length();for(let b=1;b<Y.length;b++){H=Y[b];const L=J.p.Distance(E,H);if(l+=L,l===T)return this._setPointAtData(z,1,H,b,u);if(l>T){const Y=(l-T)/L,J=E.JY(H),D=H.add(J.scaleInPlace(Y));return this._setPointAtData(z,1-Y,D,b-1,u)}E=H}return this._pointAtData}_setPointAtData(z,u,Y,H,E){return this._pointAtData.point=Y,this._pointAtData.position=z,this._pointAtData.subPosition=u,this._pointAtData.previousPointArrayIndex=H,this._pointAtData.interpolateReady=E,E&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=J.b.Identity();const z=this._pointAtData.previousPointArrayIndex;if(z!==this._tangents.length-1){const u=z+1,Y=this._tangents[z].clone(),H=this._normals[z].clone(),E=this._binormals[z].clone(),l=this._tangents[u].clone(),T=this._normals[u].clone(),b=this._binormals[u].clone(),L=J.f.RotationQuaternionFromAxis(H,E,Y),D=J.f.RotationQuaternionFromAxis(T,b,l);J.f.Slerp(L,D,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class M{static CreateQuadraticBezier(z,u,Y,H){H=H>2?H:3;const E=[],l=(z,u,Y,H)=>(1-z)*(1-z)*u+2*z*(1-z)*Y+z*z*H;for(let T=0;T<=H;T++)E.push(new J.p(l(T/H,z.x,u.x,Y.x),l(T/H,z.y,u.y,Y.y),l(T/H,z.z,u.z,Y.z)));return new M(E)}static CreateCubicBezier(z,u,Y,H,E){E=E>3?E:4;const l=[],T=(z,u,Y,H,E)=>(1-z)*(1-z)*(1-z)*u+3*z*(1-z)*(1-z)*Y+3*z*z*(1-z)*H+z*z*z*E;for(let b=0;b<=E;b++)l.push(new J.p(T(b/E,z.x,u.x,Y.x,H.x),T(b/E,z.y,u.y,Y.y,H.y),T(b/E,z.z,u.z,Y.z,H.z)));return new M(l)}static CreateHermiteSpline(z,u,Y,H,E){const l=[],T=1/E;for(let b=0;b<=E;b++)l.push(J.p.Hermite(z,u,Y,H,b*T));return new M(l)}static CreateCatmullRomSpline(z,u,Y){const H=[],E=1/u;let l=0;if(Y){const Y=z.length;for(let T=0;T<Y;T++){l=0;for(let b=0;b<u;b++)H.push(J.p.CatmullRom(z[T%Y],z[(T+1)%Y],z[(T+2)%Y],z[(T+3)%Y],l)),l+=E}H.push(H[0])}else{const Y=[];Y.push(z[0].clone()),Array.prototype.push.apply(Y,z),Y.push(z[z.length-1].clone());let T=0;for(;T<Y.length-3;T++){l=0;for(let z=0;z<u;z++)H.push(J.p.CatmullRom(Y[T],Y[T+1],Y[T+2],Y[T+3],l)),l+=E}T--,H.push(J.p.CatmullRom(Y[T],Y[T+1],Y[T+2],Y[T+3],l))}return new M(H)}static ArcThru3Points(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=[],b=u.JY(z),L=Y.JY(u),D=z.JY(Y),g=J.p.Cross(b,L),q=g.length();if(q<Math.pow(10,-8))return new M(T);const C=b.lengthSquared(),K=L.lengthSquared(),h=D.lengthSquared(),o=g.lengthSquared(),d=.5*b.length()*L.length()*D.length()/q,t=-.5*K*J.p.Dot(b,D)/o,W=-.5*h*J.p.Dot(b,L)/o,Z=-.5*C*J.p.Dot(L,D)/o,s=z.scale(t).add(u.scale(W)).add(Y.scale(Z)),v=z.JY(s).normalize(),i=J.p.Cross(g,v).normalize();if(l){const u=2*Math.PI/H;for(let z=0;z<=2*Math.PI;z+=u)T.push(s.add(v.scale(d*Math.cos(z)).add(i.scale(d*Math.sin(z)))));T.push(z)}else{const u=1/H;let l=0,b=J.p.Zero();do{b=s.add(v.scale(d*Math.cos(l)).add(i.scale(d*Math.sin(l)))),T.push(b),l+=u}while(!b.equalsWithEpsilon(Y,d*u*1.1));T.push(Y),E&&T.push(z)}return new M(T)}constructor(z){this._length=0,this._points=z,this._length=this._computeLength(z)}getPoints(){return this._points}length(){return this._length}continue(z){const u=this._points[this._points.length-1],Y=this._points.slice(),H=z.getPoints();for(let E=1;E<H.length;E++)Y.push(H[E].JY(H[0]).add(u));return new M(Y)}_computeLength(z){let u=0;for(let Y=1;Y<z.length;Y++)u+=z[Y].JY(z[Y-1]).length();return u}}},11170:(z,u,Y)=>{Y.d(u,{b:()=>E});var H=Y(10903);class E{constructor(z,u,Y,E){this.wl=new H.p(z,u,Y),this.d=E}al(){return[this.wl.x,this.wl.y,this.wl.z,this.d]}clone(){return new E(this.wl.x,this.wl.y,this.wl.z,this.d)}getClassName(){return"Plane"}getHashCode(){let z=this.wl.getHashCode();return z=397*z^this.d,z}normalize(){const z=Math.sqrt(this.wl.x*this.wl.x+this.wl.y*this.wl.y+this.wl.z*this.wl.z);let u=0;return 0!==z&&(u=1/z),this.wl.x*=u,this.wl.y*=u,this.wl.z*=u,this.d*=u,this}transform(z){const u=E._TmpMatrix;z.invertToRef(u);const Y=u.m,H=this.wl.x,J=this.wl.y,l=this.wl.z,T=this.d,b=H*Y[0]+J*Y[1]+l*Y[2]+T*Y[3],L=H*Y[4]+J*Y[5]+l*Y[6]+T*Y[7],D=H*Y[8]+J*Y[9]+l*Y[10]+T*Y[11],g=H*Y[12]+J*Y[13]+l*Y[14]+T*Y[15];return new E(b,L,D,g)}dotCoordinate(z){return this.wl.x*z.x+this.wl.y*z.y+this.wl.z*z.z+this.d}copyFromPoints(z,u,Y){const H=u.x-z.x,E=u.y-z.y,J=u.z-z.z,l=Y.x-z.x,T=Y.y-z.y,b=Y.z-z.z,L=E*b-J*T,D=J*l-H*b,g=H*T-E*l,M=Math.sqrt(L*L+D*D+g*g);let q;return q=0!==M?1/M:0,this.wl.x=L*q,this.wl.y=D*q,this.wl.z=g*q,this.d=-(this.wl.x*z.x+this.wl.y*z.y+this.wl.z*z.z),this}isFrontFacingTo(z,u){return H.p.Dot(this.wl,z)<=u}signedDistanceTo(z){return H.p.Dot(z,this.wl)+this.d}static Nl(z){return new E(z[0],z[1],z[2],z[3])}static FromPoints(z,u,Y){const H=new E(0,0,0,0);return H.copyFromPoints(z,u,Y),H}static FromPositionAndNormal(z,u){const Y=new E(0,0,0,0);return this.FromPositionAndNormalToRef(z,u,Y)}static FromPositionAndNormalToRef(z,u,Y){return Y.wl.J(u),Y.wl.normalize(),Y.d=-z.dot(Y.wl),Y}static SignedDistanceToPlaneFromPositionAndNormal(z,u,Y){const E=-(u.x*z.x+u.y*z.y+u.z*z.z);return H.p.Dot(Y,u)+E}}E._TmpMatrix=H.b.Identity()},10937:(z,u,Y)=>{function H(z){return parseInt(z.toString().replace(/\W/g,""))}function E(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(z-u)<=Y}function J(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return z<u-H||z>Y+H}function l(z,u){return z===u?z:Math.random()*(u-z)+z}function T(z,u,Y){return z+(u-z)*Y}function b(z,u,Y){let H=h(u-z,360);return H>180&&(H-=360),z+H*M(Y)}function L(z,u,Y){let H=0;return H=z!=u?M((Y-z)/(u-z)):0,H}function D(z,u,Y,H,E){const J=E*E,l=E*J;return z*(2*l-3*J+1)+Y*(-2*l+3*J)+u*(l-2*J+E)+H*(l-J)}function g(z,u,Y,H,E){const J=E*E;return 6*(J-E)*z+(3*J-4*E+1)*u+6*(-J+E)*Y+(3*J-2*E)*H}function M(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Y,Math.max(u,z))}function q(z){return z-=2*Math.PI*Math.floor((z+Math.PI)/(2*Math.PI))}function C(z){const u=z.toString(16);return z<=15?("0"+u).toUpperCase():u.toUpperCase()}function K(z){if(Math.log2)return Math.floor(Math.log2(z));if(z<0)return NaN;if(0===z)return-1/0;let u=0;if(z<1){for(;z<1;)u++,z*=2;u=-u}else if(z>1)for(;z>1;)u++,z=Math.floor(z/2);return u}function h(z,u){return z-Math.floor(z/u)*u}function o(z,u,Y){return(z-u)/(Y-u)}function d(z,u,Y){return z*(Y-u)+u}function t(z,u){let Y=h(u-z,360);return Y>180&&(Y-=360),Y}function W(z,u){const Y=h(z,2*u);return u-Math.abs(Y-u)}function Z(z,u,Y){let H=M(Y);return H=-2*H*H*H+3*H*H,u*H+z*(1-H)}function s(z,u,Y){let H=0;return H=Math.abs(u-z)<=Y?u:z+Math.sign(u-z)*Y,H}function v(z,u,Y){const H=t(z,u);let E=0;return E=-Y<H&&H<Y?u:s(z,u=z+H,Y),E}function i(z,u,Y){return(z-u)/(Y-u)}function X(z,u,Y){return(Y-u)*z+u}function Q(z,u){const Y=z%u;return 0===Y?u:Q(u,Y)}Y.r(u),Y.d(u,{Clamp:()=>M,DeltaAngle:()=>t,Denormalize:()=>d,ExtractAsInt:()=>H,Hermite:()=>D,Hermite1stDerivative:()=>g,HighestCommonFactor:()=>Q,ILog2:()=>K,InverseLerp:()=>L,Lerp:()=>T,LerpAngle:()=>b,MoveTowards:()=>s,MoveTowardsAngle:()=>v,Normalize:()=>o,NormalizeRadians:()=>q,OutsideRange:()=>J,PercentToRange:()=>X,PingPong:()=>W,RandomRange:()=>l,RangeToPercent:()=>i,Repeat:()=>h,SmoothStep:()=>Z,ToHex:()=>C,WithinEpsilon:()=>E})},11393:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{constructor(z,u){this.width=z,this.height=u}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let z=0|this.width;return z=397*z^this.height,z}J(z){this.width=z.width,this.height=z.height}kl(z,u){return this.width=z,this.height=u,this}set(z,u){return this.kl(z,u)}multiplyByFloats(z,u){return new H(this.width*z,this.height*u)}clone(){return new H(this.width,this.height)}equals(z){return!!z&&(this.width===z.width&&this.height===z.height)}get surface(){return this.width*this.height}static Zero(){return new H(0,0)}add(z){return new H(this.width+z.width,this.height+z.height)}JY(z){return new H(this.width-z.width,this.height-z.height)}scale(z){return new H(this.width*z,this.height*z)}static Lerp(z,u,Y){const E=z.width+(u.width-z.width)*Y,J=z.height+(u.height-z.height)*Y;return new H(E,J)}}},10903:(z,u,Y)=>{Y.d(u,{b:()=>d,f:()=>o,i:()=>W,m:()=>C,p:()=>K,t:()=>h});var H=Y(10906),E=Y(10910),J=Y(10918),l=Y(10920),T=Y(10928),b=Y(10937);class L{}function D(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=z.al(),J=u.al(),l=E[0],T=E[1],b=E[2],L=E[3],D=E[4],g=E[5],M=E[6],q=E[7],C=E[8],K=E[9],h=E[10],o=E[11],d=E[12],t=E[13],W=E[14],Z=E[15],s=J[0],v=J[1],i=J[2],X=J[3],Q=J[4],V=J[5],A=J[6],x=J[7],G=J[8],F=J[9],R=J[10],w=J[11],c=J[12],U=J[13],O=J[14],n=J[15];Y[H]=l*s+T*Q+b*G+L*c,Y[H+1]=l*v+T*V+b*F+L*U,Y[H+2]=l*i+T*A+b*R+L*O,Y[H+3]=l*X+T*x+b*w+L*n,Y[H+4]=D*s+g*Q+M*G+q*c,Y[H+5]=D*v+g*V+M*F+q*U,Y[H+6]=D*i+g*A+M*R+q*O,Y[H+7]=D*X+g*x+M*w+q*n,Y[H+8]=C*s+K*Q+h*G+o*c,Y[H+9]=C*v+K*V+h*F+o*U,Y[H+10]=C*i+K*A+h*R+o*O,Y[H+11]=C*X+K*x+h*w+o*n,Y[H+12]=d*s+t*Q+W*G+Z*c,Y[H+13]=d*v+t*V+W*F+Z*U,Y[H+14]=d*i+t*A+W*R+Z*O,Y[H+15]=d*X+t*x+W*w+Z*n}function g(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=z.al();u[Y]=H[0],u[Y+1]=H[1],u[Y+2]=H[2],u[Y+3]=H[3],u[Y+4]=H[4],u[Y+5]=H[5],u[Y+6]=H[6],u[Y+7]=H[7],u[Y+8]=H[8],u[Y+9]=H[9],u[Y+10]=H[10],u[Y+11]=H[11],u[Y+12]=H[12],u[Y+13]=H[13],u[Y+14]=H[14],u[Y+15]=H[15]}function M(z,u){const Y=z.al(),H=Y[0],E=Y[1],J=Y[2],l=Y[3],T=Y[4],b=Y[5],L=Y[6],D=Y[7],g=Y[8],M=Y[9],q=Y[10],C=Y[11],K=Y[12],h=Y[13],o=Y[14],d=Y[15],t=q*d-o*C,W=M*d-h*C,Z=M*o-h*q,s=g*d-K*C,v=g*o-q*K,i=g*h-K*M,X=+(b*t-L*W+D*Z),Q=-(T*t-L*s+D*v),V=+(T*W-b*s+D*i),A=-(T*Z-b*v+L*i),x=H*X+E*Q+J*V+l*A;if(0===x)return!1;const G=1/x,F=L*d-o*D,R=b*d-h*D,w=b*o-h*L,c=T*d-K*D,U=T*o-K*L,O=T*h-K*b,n=L*C-q*D,m=b*C-M*D,p=b*q-M*L,S=T*C-g*D,I=T*q-g*L,y=T*M-g*b,a=-(E*t-J*W+l*Z),j=+(H*t-J*s+l*v),k=-(H*W-E*s+l*i),P=+(H*Z-E*v+J*i),e=+(E*F-J*R+l*w),N=-(H*F-J*c+l*U),B=+(H*R-E*c+l*O),f=-(H*w-E*U+J*O),r=-(E*n-J*m+l*p),zz=+(H*n-J*S+l*I),uz=-(H*m-E*S+l*y),Yz=+(H*p-E*I+J*y);return u[0]=X*G,u[1]=a*G,u[2]=e*G,u[3]=r*G,u[4]=Q*G,u[5]=j*G,u[6]=N*G,u[7]=zz*G,u[8]=V*G,u[9]=k*G,u[10]=B*G,u[11]=uz*G,u[12]=A*G,u[13]=P*G,u[14]=f*G,u[15]=Yz*G,!0}L._UpdateFlagSeed=0;const q=z=>parseInt(z.toString().replace(/\W/g,""));class C{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=z,this.y=u}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let z=q(this.x);return z=397*z^q(this.y),z}toArray(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[u]=this.x,z[u+1]=this.y,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.FromArrayToRef(z,u,this),this}al(){return[this.x,this.y]}J(z){return this.x=z.x,this.y=z.y,this}kl(z,u){return this.x=z,this.y=u,this}set(z,u){return this.kl(z,u)}Bl(z){return this.kl(z,z)}add(z){return new C(this.x+z.x,this.y+z.y)}addToRef(z,u){return u.x=this.x+z.x,u.y=this.y+z.y,u}addInPlace(z){return this.x+=z.x,this.y+=z.y,this}addInPlaceFromFloats(z,u){return this.x+=z,this.y+=u,this}addVector3(z){return new C(this.x+z.x,this.y+z.y)}JY(z){return new C(this.x-z.x,this.y-z.y)}subtractToRef(z,u){return u.x=this.x-z.x,u.y=this.y-z.y,u}dg(z){return this.x-=z.x,this.y-=z.y,this}multiplyInPlace(z){return this.x*=z.x,this.y*=z.y,this}multiply(z){return new C(this.x*z.x,this.y*z.y)}multiplyToRef(z,u){return u.x=this.x*z.x,u.y=this.y*z.y,u}multiplyByFloats(z,u){return new C(this.x*z,this.y*u)}divide(z){return new C(this.x/z.x,this.y/z.y)}divideToRef(z,u){return u.x=this.x/z.x,u.y=this.y/z.y,u}divideInPlace(z){return this.x=this.x/z.x,this.y=this.y/z.y,this}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z.x,z.y)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z.x,z.y)}minimizeInPlaceFromFloats(z,u){return this.x=Math.min(z,this.x),this.y=Math.min(u,this.y),this}maximizeInPlaceFromFloats(z,u){return this.x=Math.max(z,this.x),this.y=Math.max(u,this.y),this}subtractFromFloats(z,u){return new C(this.x-z,this.y-u)}subtractFromFloatsToRef(z,u,Y){return Y.x=this.x-z,Y.y=this.y-u,Y}negate(){return new C(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(z){return z.x=-this.x,z.y=-this.y,z}scaleInPlace(z){return this.x*=z,this.y*=z,this}scale(z){return new C(this.x*z,this.y*z)}scaleToRef(z,u){return u.x=this.x*z,u.y=this.y*z,u}scaleAndAddToRef(z,u){return u.x+=this.x*z,u.y+=this.y*z,u}equals(z){return z&&this.x===z.x&&this.y===z.y}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;return z&&(0,b.WithinEpsilon)(this.x,z.x,u)&&(0,b.WithinEpsilon)(this.y,z.y,u)}equalsToFloats(z,u){return this.x===z&&this.y===u}floor(){return new C(Math.floor(this.x),Math.floor(this.y))}floorToRef(z){return z.x=Math.floor(this.x),z.y=Math.floor(this.y),z}fract(){return new C(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(z){return z.x=this.x-Math.floor(this.x),z.y=this.y-Math.floor(this.y),z}rotate(z){return this.rotateToRef(z,new C)}rotateToRef(z,u){const Y=Math.cos(z),H=Math.sin(z);return u.x=Y*this.x-H*this.y,u.y=H*this.x+Y*this.y,u}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){const z=new C;return this.normalizeToRef(z),z}normalizeToRef(z){const u=this.length();return 0===u&&(z.x=this.x,z.y=this.y),this.scaleToRef(1/u,z)}clone(){return new C(this.x,this.y)}dot(z){return this.x*z.x+this.y*z.y}static Zero(){return new C(0,0)}static One(){return new C(1,1)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new C((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).kl((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static get ZeroReadOnly(){return C._ZeroReadOnly}static Nl(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new C(z[u],z[u+1])}static FromArrayToRef(z,u,Y){return Y.x=z[u],Y.y=z[u+1],Y}static FromFloatsToRef(z,u,Y){return Y.kl(z,u),Y}static CatmullRom(z,u,Y,H,E){const J=E*E,l=E*J,T=.5*(2*u.x+(-z.x+Y.x)*E+(2*z.x-5*u.x+4*Y.x-H.x)*J+(-z.x+3*u.x-3*Y.x+H.x)*l),b=.5*(2*u.y+(-z.y+Y.y)*E+(2*z.y-5*u.y+4*Y.y-H.y)*J+(-z.y+3*u.y-3*Y.y+H.y)*l);return new C(T,b)}static ClampToRef(z,u,Y,H){return H.x=(0,b.Clamp)(z.x,u.x,Y.x),H.y=(0,b.Clamp)(z.y,u.y,Y.y),H}static Clamp(z,u,Y){const H=(0,b.Clamp)(z.x,u.x,Y.x),E=(0,b.Clamp)(z.y,u.y,Y.y);return new C(H,E)}static Hermite(z,u,Y,H,E){const J=E*E,l=E*J,T=2*l-3*J+1,b=-2*l+3*J,L=l-2*J+E,D=l-J,g=z.x*T+Y.x*b+u.x*L+H.x*D,M=z.y*T+Y.y*b+u.y*L+H.y*D;return new C(g,M)}static Hermite1stDerivative(z,u,Y,H,E){return this.Hermite1stDerivativeToRef(z,u,Y,H,E,new C)}static Hermite1stDerivativeToRef(z,u,Y,H,E,J){const l=E*E;return J.x=6*(l-E)*z.x+(3*l-4*E+1)*u.x+6*(-l+E)*Y.x+(3*l-2*E)*H.x,J.y=6*(l-E)*z.y+(3*l-4*E+1)*u.y+6*(-l+E)*Y.y+(3*l-2*E)*H.y,J}static Lerp(z,u,Y){return C.LerpToRef(z,u,Y,new C)}static LerpToRef(z,u,Y,H){return H.x=z.x+(u.x-z.x)*Y,H.y=z.y+(u.y-z.y)*Y,H}static Dot(z,u){return z.x*u.x+z.y*u.y}static Normalize(z){return C.NormalizeToRef(z,new C)}static NormalizeToRef(z,u){return z.normalizeToRef(u),u}static Minimize(z,u){const Y=z.x<u.x?z.x:u.x,H=z.y<u.y?z.y:u.y;return new C(Y,H)}static Maximize(z,u){const Y=z.x>u.x?z.x:u.x,H=z.y>u.y?z.y:u.y;return new C(Y,H)}static Transform(z,u){return C.TransformToRef(z,u,new C)}static TransformToRef(z,u,Y){const H=u.m,E=z.x*H[0]+z.y*H[4]+H[12],J=z.x*H[1]+z.y*H[5]+H[13];return Y.x=E,Y.y=J,Y}static PointInTriangle(z,u,Y,H){const E=.5*(-Y.y*H.x+u.y*(-Y.x+H.x)+u.x*(Y.y-H.y)+Y.x*H.y),J=E<0?-1:1,l=(u.y*H.x-u.x*H.y+(H.y-u.y)*z.x+(u.x-H.x)*z.y)*J,T=(u.x*Y.y-u.y*Y.x+(u.y-Y.y)*z.x+(Y.x-u.x)*z.y)*J;return l>0&&T>0&&l+T<2*E*J}static Distance(z,u){return Math.sqrt(C.DistanceSquared(z,u))}static DistanceSquared(z,u){const Y=z.x-u.x,H=z.y-u.y;return Y*Y+H*H}static Center(z,u){return C.CenterToRef(z,u,new C)}static CenterToRef(z,u,Y){return Y.kl((z.x+u.x)/2,(z.y+u.y)/2)}static DistanceOfPointFromSegment(z,u,Y){const H=C.DistanceSquared(u,Y);if(0===H)return C.Distance(z,u);const E=Y.JY(u),J=Math.max(0,Math.min(1,C.Dot(z.JY(u),E)/H)),l=u.add(E.multiplyByFloats(J,J));return C.Distance(z,l)}}C._V8PerformanceHack=new C(.5,.5),C._ZeroReadOnly=C.Zero(),Object.defineProperties(C.prototype,{dimension:{value:[2]},rank:{value:1}});class K{get x(){return this._x}set x(z){this._x=z,this._isDirty=!0}get y(){return this._y}set y(z){this._y=z,this._isDirty=!0}get z(){return this._z}set z(z){this._z=z,this._isDirty=!0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=z,this._y=u,this._z=Y}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Pl"}getHashCode(){let z=q(this._x);return z=397*z^q(this._y),z=397*z^q(this._z),z}al(){return[this._x,this._y,this._z]}toArray(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[u]=this._x,z[u+1]=this._y,z[u+2]=this._z,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K.FromArrayToRef(z,u,this),this}toQuaternion(){return o.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(z){return this._x+=z._x,this._y+=z._y,this._z+=z._z,this._isDirty=!0,this}addInPlaceFromFloats(z,u,Y){return this._x+=z,this._y+=u,this._z+=Y,this._isDirty=!0,this}add(z){return new K(this._x+z._x,this._y+z._y,this._z+z._z)}addToRef(z,u){return u._x=this._x+z._x,u._y=this._y+z._y,u._z=this._z+z._z,u._isDirty=!0,u}dg(z){return this._x-=z._x,this._y-=z._y,this._z-=z._z,this._isDirty=!0,this}JY(z){return new K(this._x-z._x,this._y-z._y,this._z-z._z)}subtractToRef(z,u){return this.subtractFromFloatsToRef(z._x,z._y,z._z,u)}subtractFromFloats(z,u,Y){return new K(this._x-z,this._y-u,this._z-Y)}subtractFromFloatsToRef(z,u,Y,H){return H._x=this._x-z,H._y=this._y-u,H._z=this._z-Y,H._isDirty=!0,H}negate(){return new K(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(z){return z._x=-1*this._x,z._y=-1*this._y,z._z=-1*this._z,z._isDirty=!0,z}scaleInPlace(z){return this._x*=z,this._y*=z,this._z*=z,this._isDirty=!0,this}scale(z){return new K(this._x*z,this._y*z,this._z*z)}scaleToRef(z,u){return u._x=this._x*z,u._y=this._y*z,u._z=this._z*z,u._isDirty=!0,u}getNormalToRef(z){const u=this.length();let Y=Math.acos(this._y/u);const H=Math.atan2(this._z,this._x);Y>Math.PI/2?Y-=Math.PI/2:Y+=Math.PI/2;const E=u*Math.sin(Y)*Math.cos(H),J=u*Math.cos(Y),l=u*Math.sin(Y)*Math.sin(H);return z.set(E,J,l),z}applyRotationQuaternionToRef(z,u){const Y=this._x,H=this._y,E=this._z,J=z._x,l=z._y,T=z._z,b=z._w,L=2*(l*E-T*H),D=2*(T*Y-J*E),g=2*(J*H-l*Y);return u._x=Y+b*L+l*g-T*D,u._y=H+b*D+T*L-J*g,u._z=E+b*g+J*D-l*L,u._isDirty=!0,u}applyRotationQuaternionInPlace(z){return this.applyRotationQuaternionToRef(z,this)}applyRotationQuaternion(z){return this.applyRotationQuaternionToRef(z,new K)}scaleAndAddToRef(z,u){return u._x+=this._x*z,u._y+=this._y*z,u._z+=this._z*z,u._isDirty=!0,u}projectOnPlane(z,u){return this.projectOnPlaneToRef(z,u,new K)}projectOnPlaneToRef(z,u,Y){const H=z.wl,E=z.d,J=t.Pl[0];this.subtractToRef(u,J),J.normalize();const l=K.Dot(J,H);if(Math.abs(l)<1e-10)Y.Bl(1/0);else{const z=-(K.Dot(u,H)+E)/l,T=J.scaleInPlace(z);u.addToRef(T,Y)}return Y}equals(z){return z&&this._x===z._x&&this._y===z._y&&this._z===z._z}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;return z&&(0,b.WithinEpsilon)(this._x,z._x,u)&&(0,b.WithinEpsilon)(this._y,z._y,u)&&(0,b.WithinEpsilon)(this._z,z._z,u)}equalsToFloats(z,u,Y){return this._x===z&&this._y===u&&this._z===Y}multiplyInPlace(z){return this._x*=z._x,this._y*=z._y,this._z*=z._z,this._isDirty=!0,this}multiply(z){return this.multiplyByFloats(z._x,z._y,z._z)}multiplyToRef(z,u){return u._x=this._x*z._x,u._y=this._y*z._y,u._z=this._z*z._z,u._isDirty=!0,u}multiplyByFloats(z,u,Y){return new K(this._x*z,this._y*u,this._z*Y)}divide(z){return new K(this._x/z._x,this._y/z._y,this._z/z._z)}divideToRef(z,u){return u._x=this._x/z._x,u._y=this._y/z._y,u._z=this._z/z._z,u._isDirty=!0,u}divideInPlace(z){return this._x=this._x/z._x,this._y=this._y/z._y,this._z=this._z/z._z,this._isDirty=!0,this}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z._x,z._y,z._z)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z._x,z._y,z._z)}minimizeInPlaceFromFloats(z,u,Y){return z<this._x&&(this.x=z),u<this._y&&(this.y=u),Y<this._z&&(this.z=Y),this}maximizeInPlaceFromFloats(z,u,Y){return z>this._x&&(this.x=z),u>this._y&&(this.y=u),Y>this._z&&(this.z=Y),this}isNonUniformWithinEpsilon(z){const u=Math.abs(this._x),Y=Math.abs(this._y);if(!(0,b.WithinEpsilon)(u,Y,z))return!0;const H=Math.abs(this._z);return!(0,b.WithinEpsilon)(u,H,z)||!(0,b.WithinEpsilon)(Y,H,z)}get isNonUniform(){const z=Math.abs(this._x);if(z!==Math.abs(this._y))return!0;return z!==Math.abs(this._z)}floorToRef(z){return z._x=Math.floor(this._x),z._y=Math.floor(this._y),z._z=Math.floor(this._z),z._isDirty=!0,z}floor(){return new K(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(z){return z._x=this._x-Math.floor(this._x),z._y=this._y-Math.floor(this._y),z._z=this._z-Math.floor(this._z),z._isDirty=!0,z}fract(){return new K(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(z){if("xyz"===(z=z.toLowerCase()))return this;const u=t.Pl[0].J(this);return this.x=u[z[0]],this.y=u[z[1]],this.z=u[z[2]],this}rotateByQuaternionToRef(z,u){return z.toRotationMatrix(t.Matrix[0]),K.TransformCoordinatesToRef(this,t.Matrix[0],u),u}rotateByQuaternionAroundPointToRef(z,u,Y){return this.subtractToRef(u,t.Pl[0]),t.Pl[0].rotateByQuaternionToRef(z,t.Pl[0]),u.addToRef(t.Pl[0],Y),Y}cross(z){return K.CrossToRef(this,z,new K)}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){return this.normalizeToRef(new K)}normalizeToRef(z){const u=this.length();return 0===u||1===u?(z._x=this._x,z._y=this._y,z._z=this._z,z._isDirty=!0,z):this.scaleToRef(1/u,z)}clone(){return new K(this._x,this._y,this._z)}J(z){return this.kl(z._x,z._y,z._z)}kl(z,u,Y){return this._x=z,this._y=u,this._z=Y,this._isDirty=!0,this}set(z,u,Y){return this.kl(z,u,Y)}Bl(z){return this._x=this._y=this._z=z,this._isDirty=!0,this}static GetClipFactor(z,u,Y,H){const E=K.Dot(z,Y);return(E-H)/(E-K.Dot(u,Y))}static GetAngleBetweenVectors(z,u,Y){const H=z.normalizeToRef(t.Pl[1]),E=u.normalizeToRef(t.Pl[2]);let J=K.Dot(H,E);J=(0,b.Clamp)(J,-1,1);const l=Math.acos(J),T=t.Pl[3];return K.CrossToRef(H,E,T),K.Dot(T,Y)>0?isNaN(l)?0:l:isNaN(l)?-Math.PI:-Math.acos(J)}static GetAngleBetweenVectorsOnPlane(z,u,Y){t.Pl[0].J(z);const H=t.Pl[0];t.Pl[1].J(u);const E=t.Pl[1];t.Pl[2].J(Y);const J=t.Pl[2],l=t.Pl[3],T=t.Pl[4];H.normalize(),E.normalize(),J.normalize(),K.CrossToRef(J,H,l),K.CrossToRef(l,J,T);const L=Math.atan2(K.Dot(E,l),K.Dot(E,T));return(0,b.NormalizeRadians)(L)}static PitchYawRollToMoveBetweenPointsToRef(z,u,Y){const H=W.Pl[0];return u.subtractToRef(z,H),Y._y=Math.atan2(H.x,H.z)||0,Y._x=Math.atan2(Math.sqrt(H.x**2+H.z**2),H.y)||0,Y._z=0,Y._isDirty=!0,Y}static PitchYawRollToMoveBetweenPoints(z,u){const Y=K.Zero();return K.PitchYawRollToMoveBetweenPointsToRef(z,u,Y)}static SlerpToRef(z,u,Y,E){Y=(0,b.Clamp)(Y,0,1);const J=t.Pl[0],l=t.Pl[1];J.J(z);const T=J.length();J.normalizeFromLength(T),l.J(u);const L=l.length();l.normalizeFromLength(L);const D=K.Dot(J,l);let g,M;if(D<1-H.e){const z=Math.acos(D),u=1/Math.sin(z);g=Math.sin((1-Y)*z)*u,M=Math.sin(Y*z)*u}else g=1-Y,M=Y;return J.scaleInPlace(g),l.scaleInPlace(M),E.J(J).addInPlace(l),E.scaleInPlace((0,b.Lerp)(T,L,Y)),E}static SmoothToRef(z,u,Y,H,E){return K.SlerpToRef(z,u,0===H?1:Y/H,E),E}static Nl(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new K(z[u],z[u+1],z[u+2])}static FromFloatArray(z,u){return K.Nl(z,u)}static FromArrayToRef(z,u,Y){return Y._x=z[u],Y._y=z[u+1],Y._z=z[u+2],Y._isDirty=!0,Y}static FromFloatArrayToRef(z,u,Y){return K.FromArrayToRef(z,u,Y)}static FromFloatsToRef(z,u,Y,H){return H.kl(z,u,Y),H}static Zero(){return new K(0,0,0)}static One(){return new K(1,1,1)}static Up(){return new K(0,1,0)}static get UpReadOnly(){return K._UpReadOnly}static get DownReadOnly(){return K._DownReadOnly}static get RightReadOnly(){return K._RightReadOnly}static get LeftReadOnly(){return K._LeftReadOnly}static get LeftHandedForwardReadOnly(){return K._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return K._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return K._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return K._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return K._ZeroReadOnly}static get OneReadOnly(){return K._OneReadOnly}static Down(){return new K(0,-1,0)}static Forward(){return new K(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new K(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new K(1,0,0)}static Left(){return new K(-1,0,0)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new K((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).kl((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static TransformCoordinates(z,u){const Y=K.Zero();return K.TransformCoordinatesToRef(z,u,Y),Y}static TransformCoordinatesToRef(z,u,Y){return K.TransformCoordinatesFromFloatsToRef(z._x,z._y,z._z,u,Y),Y}static TransformCoordinatesFromFloatsToRef(z,u,Y,H,E){const J=H.m,l=z*J[0]+u*J[4]+Y*J[8]+J[12],T=z*J[1]+u*J[5]+Y*J[9]+J[13],b=z*J[2]+u*J[6]+Y*J[10]+J[14],L=1/(z*J[3]+u*J[7]+Y*J[11]+J[15]);return E._x=l*L,E._y=T*L,E._z=b*L,E._isDirty=!0,E}static TransformNormal(z,u){const Y=K.Zero();return K.TransformNormalToRef(z,u,Y),Y}static TransformNormalToRef(z,u,Y){return this.TransformNormalFromFloatsToRef(z._x,z._y,z._z,u,Y),Y}static TransformNormalFromFloatsToRef(z,u,Y,H,E){const J=H.m;return E._x=z*J[0]+u*J[4]+Y*J[8],E._y=z*J[1]+u*J[5]+Y*J[9],E._z=z*J[2]+u*J[6]+Y*J[10],E._isDirty=!0,E}static CatmullRom(z,u,Y,H,E){const J=E*E,l=E*J,T=.5*(2*u._x+(-z._x+Y._x)*E+(2*z._x-5*u._x+4*Y._x-H._x)*J+(-z._x+3*u._x-3*Y._x+H._x)*l),b=.5*(2*u._y+(-z._y+Y._y)*E+(2*z._y-5*u._y+4*Y._y-H._y)*J+(-z._y+3*u._y-3*Y._y+H._y)*l),L=.5*(2*u._z+(-z._z+Y._z)*E+(2*z._z-5*u._z+4*Y._z-H._z)*J+(-z._z+3*u._z-3*Y._z+H._z)*l);return new K(T,b,L)}static Clamp(z,u,Y){const H=new K;return K.ClampToRef(z,u,Y,H),H}static ClampToRef(z,u,Y,H){let E=z._x;E=E>Y._x?Y._x:E,E=E<u._x?u._x:E;let J=z._y;J=J>Y._y?Y._y:J,J=J<u._y?u._y:J;let l=z._z;return l=l>Y._z?Y._z:l,l=l<u._z?u._z:l,H.kl(E,J,l),H}static CheckExtends(z,u,Y){u.minimizeInPlace(z),Y.maximizeInPlace(z)}static Hermite(z,u,Y,H,E){const J=E*E,l=E*J,T=2*l-3*J+1,b=-2*l+3*J,L=l-2*J+E,D=l-J,g=z._x*T+Y._x*b+u._x*L+H._x*D,M=z._y*T+Y._y*b+u._y*L+H._y*D,q=z._z*T+Y._z*b+u._z*L+H._z*D;return new K(g,M,q)}static Hermite1stDerivative(z,u,Y,H,E){const J=new K;return this.Hermite1stDerivativeToRef(z,u,Y,H,E,J),J}static Hermite1stDerivativeToRef(z,u,Y,H,E,J){const l=E*E;return J._x=6*(l-E)*z._x+(3*l-4*E+1)*u._x+6*(-l+E)*Y._x+(3*l-2*E)*H._x,J._y=6*(l-E)*z._y+(3*l-4*E+1)*u._y+6*(-l+E)*Y._y+(3*l-2*E)*H._y,J._z=6*(l-E)*z._z+(3*l-4*E+1)*u._z+6*(-l+E)*Y._z+(3*l-2*E)*H._z,J._isDirty=!0,J}static Lerp(z,u,Y){const H=new K(0,0,0);return K.LerpToRef(z,u,Y,H),H}static LerpToRef(z,u,Y,H){return H._x=z._x+(u._x-z._x)*Y,H._y=z._y+(u._y-z._y)*Y,H._z=z._z+(u._z-z._z)*Y,H._isDirty=!0,H}static Dot(z,u){return z._x*u._x+z._y*u._y+z._z*u._z}dot(z){return this._x*z._x+this._y*z._y+this._z*z._z}static Cross(z,u){const Y=new K;return K.CrossToRef(z,u,Y),Y}static CrossToRef(z,u,Y){const H=z._y*u._z-z._z*u._y,E=z._z*u._x-z._x*u._z,J=z._x*u._y-z._y*u._x;return Y.kl(H,E,J),Y}static Normalize(z){const u=K.Zero();return K.NormalizeToRef(z,u),u}static NormalizeToRef(z,u){return z.normalizeToRef(u),u}static Project(z,u,Y,H){const E=new K;return K.ProjectToRef(z,u,Y,H,E),E}static ProjectToRef(z,u,Y,H,E){var J;const l=H.width,b=H.height,L=H.x,D=H.y,g=t.Matrix[1],M=null===(J=T.d.LastCreatedEngine)||void 0===J?void 0:J.isNDCHalfZRange,q=M?1:.5,C=M?0:.5;d.FromValuesToRef(l/2,0,0,0,0,-b/2,0,0,0,0,q,0,L+l/2,b/2+D,C,1,g);const h=t.Matrix[0];return u.multiplyToRef(Y,h),h.multiplyToRef(g,h),K.TransformCoordinatesToRef(z,h,E),E}static Reflect(z,u){return this.ReflectToRef(z,u,new K)}static ReflectToRef(z,u,Y){const H=W.Pl[0];return H.J(u).scaleInPlace(2*K.Dot(z,u)),Y.J(z).dg(H)}static _UnprojectFromInvertedMatrixToRef(z,u,Y){K.TransformCoordinatesToRef(z,u,Y);const H=u.m,E=z._x*H[3]+z._y*H[7]+z._z*H[11]+H[15];return(0,b.WithinEpsilon)(E,1)&&Y.scaleInPlace(1/E),Y}static UnprojectFromTransform(z,u,Y,H,E){return this.Unproject(z,u,Y,H,E,d.IdentityReadOnly)}static Unproject(z,u,Y,H,E,J){const l=new K;return K.UnprojectToRef(z,u,Y,H,E,J,l),l}static UnprojectToRef(z,u,Y,H,E,J,l){return K.UnprojectFloatsToRef(z._x,z._y,z._z,u,Y,H,E,J,l),l}static UnprojectFloatsToRef(z,u,Y,H,E,J,l,b,L){var D;const g=t.Matrix[0];J.multiplyToRef(l,g),g.multiplyToRef(b,g),g.invert();const M=t.Pl[0];return M.x=z/H*2-1,M.y=-(u/E*2-1),null!==(D=T.d.LastCreatedEngine)&&void 0!==D&&D.isNDCHalfZRange?M.z=Y:M.z=2*Y-1,K._UnprojectFromInvertedMatrixToRef(M,g,L),L}static Minimize(z,u){const Y=new K;return Y.J(z),Y.minimizeInPlace(u),Y}static Maximize(z,u){const Y=new K;return Y.J(z),Y.maximizeInPlace(u),Y}static Distance(z,u){return Math.sqrt(K.DistanceSquared(z,u))}static DistanceSquared(z,u){const Y=z._x-u._x,H=z._y-u._y,E=z._z-u._z;return Y*Y+H*H+E*E}static ProjectOnTriangleToRef(z,u,Y,E,J){const l=t.Pl[0],T=t.Pl[1],L=t.Pl[2],D=t.Pl[3],g=t.Pl[4];Y.subtractToRef(u,l),E.subtractToRef(u,T),E.subtractToRef(Y,L);const M=l.length(),q=T.length(),C=L.length();if(M<H.e||q<H.e||C<H.e)return J.J(u),K.Distance(z,u);z.subtractToRef(u,g),K.CrossToRef(l,T,D);const h=D.length();if(h<H.e)return J.J(u),K.Distance(z,u);D.normalizeFromLength(h);let o=g.length();if(o<H.e)return J.J(u),0;g.normalizeFromLength(o);const d=K.Dot(D,g),W=t.Pl[5],Z=t.Pl[6];W.J(D).scaleInPlace(-o*d),Z.J(z).addInPlace(W);const s=t.Pl[4],v=t.Pl[5],i=t.Pl[7],X=t.Pl[8];s.J(l).scaleInPlace(1/M),X.J(T).scaleInPlace(1/q),s.addInPlace(X).scaleInPlace(-1),v.J(l).scaleInPlace(-1/M),X.J(L).scaleInPlace(1/C),v.addInPlace(X).scaleInPlace(-1),i.J(L).scaleInPlace(-1/C),X.J(T).scaleInPlace(-1/q),i.addInPlace(X).scaleInPlace(-1);const Q=t.Pl[9];let V;Q.J(Z).dg(u),K.CrossToRef(s,Q,X),V=K.Dot(X,D);const A=V;Q.J(Z).dg(Y),K.CrossToRef(v,Q,X),V=K.Dot(X,D);const x=V;Q.J(Z).dg(E),K.CrossToRef(i,Q,X),V=K.Dot(X,D);const G=V,F=t.Pl[10];let R,w;A>0&&x<0?(F.J(l),R=u,w=Y):x>0&&G<0?(F.J(L),R=Y,w=E):(F.J(T).scaleInPlace(-1),R=E,w=u);const c=t.Pl[9],U=t.Pl[4];R.subtractToRef(Z,X),w.subtractToRef(Z,c),K.CrossToRef(X,c,U);if(!(K.Dot(U,D)<0))return J.J(Z),Math.abs(o*d);const O=t.Pl[5];K.CrossToRef(F,U,O),O.normalize();const n=t.Pl[9];n.J(R).dg(Z);const m=n.length();if(m<H.e)return J.J(R),K.Distance(z,R);n.normalizeFromLength(m);const p=K.Dot(O,n),S=t.Pl[7];S.J(Z).addInPlace(O.scaleInPlace(m*p)),X.J(S).dg(R),o=F.length(),F.normalizeFromLength(o);let I=K.Dot(X,F)/Math.max(o,H.e);return I=(0,b.Clamp)(I,0,1),S.J(R).addInPlace(F.scaleInPlace(I*o)),J.J(S),K.Distance(z,S)}static Center(z,u){return K.CenterToRef(z,u,K.Zero())}static CenterToRef(z,u,Y){return Y.kl((z._x+u._x)/2,(z._y+u._y)/2,(z._z+u._z)/2)}static RotationFromAxis(z,u,Y){const H=new K;return K.RotationFromAxisToRef(z,u,Y,H),H}static RotationFromAxisToRef(z,u,Y,H){const E=t.Quaternion[0];return o.RotationQuaternionFromAxisToRef(z,u,Y,E),E.toEulerAnglesToRef(H),H}}K._V8PerformanceHack=new K(.5,.5,.5),K._UpReadOnly=K.Up(),K._DownReadOnly=K.Down(),K._LeftHandedForwardReadOnly=K.Forward(!1),K._RightHandedForwardReadOnly=K.Forward(!0),K._LeftHandedBackwardReadOnly=K.Backward(!1),K._RightHandedBackwardReadOnly=K.Backward(!0),K._RightReadOnly=K.Right(),K._LeftReadOnly=K.Left(),K._ZeroReadOnly=K.Zero(),K._OneReadOnly=K.One(),Object.defineProperties(K.prototype,{dimension:{value:[3]},rank:{value:1}});class h{get x(){return this._x}set x(z){this._x=z,this._isDirty=!0}get y(){return this._y}set y(z){this._y=z,this._isDirty=!0}get z(){return this._z}set z(z){this._z=z,this._isDirty=!0}get w(){return this._w}set w(z){this._w=z,this._isDirty=!0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=z,this._y=u,this._z=Y,this._w=H}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let z=q(this._x);return z=397*z^q(this._y),z=397*z^q(this._z),z=397*z^q(this._w),z}al(){return[this._x,this._y,this._z,this._w]}toArray(z,u){return void 0===u&&(u=0),z[u]=this._x,z[u+1]=this._y,z[u+2]=this._z,z[u+3]=this._w,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h.FromArrayToRef(z,u,this),this}addInPlace(z){return this.x+=z._x,this.y+=z._y,this.z+=z._z,this.w+=z._w,this}addInPlaceFromFloats(z,u,Y,H){return this.x+=z,this.y+=u,this.z+=Y,this.w+=H,this}add(z){return new h(this._x+z.x,this._y+z.y,this._z+z.z,this._w+z.w)}addToRef(z,u){return u.x=this._x+z.x,u.y=this._y+z.y,u.z=this._z+z.z,u.w=this._w+z.w,u}dg(z){return this.x-=z.x,this.y-=z.y,this.z-=z.z,this.w-=z.w,this}JY(z){return new h(this._x-z.x,this._y-z.y,this._z-z.z,this._w-z.w)}subtractToRef(z,u){return u.x=this._x-z.x,u.y=this._y-z.y,u.z=this._z-z.z,u.w=this._w-z.w,u}subtractFromFloats(z,u,Y,H){return new h(this._x-z,this._y-u,this._z-Y,this._w-H)}subtractFromFloatsToRef(z,u,Y,H,E){return E.x=this._x-z,E.y=this._y-u,E.z=this._z-Y,E.w=this._w-H,E}negate(){return new h(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(z){return z.x=-this._x,z.y=-this._y,z.z=-this._z,z.w=-this._w,z}scaleInPlace(z){return this.x*=z,this.y*=z,this.z*=z,this.w*=z,this}scale(z){return new h(this._x*z,this._y*z,this._z*z,this._w*z)}scaleToRef(z,u){return u.x=this._x*z,u.y=this._y*z,u.z=this._z*z,u.w=this._w*z,u}scaleAndAddToRef(z,u){return u.x+=this._x*z,u.y+=this._y*z,u.z+=this._z*z,u.w+=this._w*z,u}equals(z){return z&&this._x===z.x&&this._y===z.y&&this._z===z.z&&this._w===z.w}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;return z&&(0,b.WithinEpsilon)(this._x,z.x,u)&&(0,b.WithinEpsilon)(this._y,z.y,u)&&(0,b.WithinEpsilon)(this._z,z.z,u)&&(0,b.WithinEpsilon)(this._w,z.w,u)}equalsToFloats(z,u,Y,H){return this._x===z&&this._y===u&&this._z===Y&&this._w===H}multiplyInPlace(z){return this.x*=z.x,this.y*=z.y,this.z*=z.z,this.w*=z.w,this}multiply(z){return new h(this._x*z.x,this._y*z.y,this._z*z.z,this._w*z.w)}multiplyToRef(z,u){return u.x=this._x*z.x,u.y=this._y*z.y,u.z=this._z*z.z,u.w=this._w*z.w,u}multiplyByFloats(z,u,Y,H){return new h(this._x*z,this._y*u,this._z*Y,this._w*H)}divide(z){return new h(this._x/z.x,this._y/z.y,this._z/z.z,this._w/z.w)}divideToRef(z,u){return u.x=this._x/z.x,u.y=this._y/z.y,u.z=this._z/z.z,u.w=this._w/z.w,u}divideInPlace(z){return this.divideToRef(z,this)}minimizeInPlace(z){return z.x<this._x&&(this.x=z.x),z.y<this._y&&(this.y=z.y),z.z<this._z&&(this.z=z.z),z.w<this._w&&(this.w=z.w),this}maximizeInPlace(z){return z.x>this._x&&(this.x=z.x),z.y>this._y&&(this.y=z.y),z.z>this._z&&(this.z=z.z),z.w>this._w&&(this.w=z.w),this}minimizeInPlaceFromFloats(z,u,Y,H){return this.x=Math.min(z,this._x),this.y=Math.min(u,this._y),this.z=Math.min(Y,this._z),this.w=Math.min(H,this._w),this}maximizeInPlaceFromFloats(z,u,Y,H){return this.x=Math.max(z,this._x),this.y=Math.max(u,this._y),this.z=Math.max(Y,this._z),this.w=Math.max(H,this._w),this}floorToRef(z){return z.x=Math.floor(this._x),z.y=Math.floor(this._y),z.z=Math.floor(this._z),z.w=Math.floor(this._w),z}floor(){return new h(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(z){return z.x=this._x-Math.floor(this._x),z.y=this._y-Math.floor(this._y),z.z=this._z-Math.floor(this._z),z.w=this._w-Math.floor(this._w),z}fract(){return new h(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){return this.normalizeToRef(new h)}normalizeToRef(z){const u=this.length();return 0===u||1===u?(z.x=this._x,z.y=this._y,z.z=this._z,z.w=this._w,z):this.scaleToRef(1/u,z)}toVector3(){return new K(this._x,this._y,this._z)}clone(){return new h(this._x,this._y,this._z,this._w)}J(z){return this.x=z.x,this.y=z.y,this.z=z.z,this.w=z.w,this}kl(z,u,Y,H){return this.x=z,this.y=u,this.z=Y,this.w=H,this}set(z,u,Y,H){return this.kl(z,u,Y,H)}Bl(z){return this.x=this.y=this.z=this.w=z,this}dot(z){return this._x*z.x+this._y*z.y+this._z*z.z+this._w*z.w}static Nl(z,u){return u||(u=0),new h(z[u],z[u+1],z[u+2],z[u+3])}static FromArrayToRef(z,u,Y){return Y.x=z[u],Y.y=z[u+1],Y.z=z[u+2],Y.w=z[u+3],Y}static FromFloatArrayToRef(z,u,Y){return h.FromArrayToRef(z,u,Y),Y}static FromFloatsToRef(z,u,Y,H,E){return E.x=z,E.y=u,E.z=Y,E.w=H,E}static Zero(){return new h(0,0,0,0)}static One(){return new h(1,1,1,1)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new h((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;return Y.x=(0,b.RandomRange)(z,u),Y.y=(0,b.RandomRange)(z,u),Y.z=(0,b.RandomRange)(z,u),Y.w=(0,b.RandomRange)(z,u),Y}static Clamp(z,u,Y){return h.ClampToRef(z,u,Y,new h)}static ClampToRef(z,u,Y,H){return H.x=(0,b.Clamp)(z.x,u.x,Y.x),H.y=(0,b.Clamp)(z.y,u.y,Y.y),H.z=(0,b.Clamp)(z.z,u.z,Y.z),H.w=(0,b.Clamp)(z.w,u.w,Y.w),H}static CheckExtends(z,u,Y){u.minimizeInPlace(z),Y.maximizeInPlace(z)}static get ZeroReadOnly(){return h._ZeroReadOnly}static Normalize(z){return h.NormalizeToRef(z,new h)}static NormalizeToRef(z,u){return z.normalizeToRef(u),u}static Minimize(z,u){const Y=new h;return Y.J(z),Y.minimizeInPlace(u),Y}static Maximize(z,u){const Y=new h;return Y.J(z),Y.maximizeInPlace(u),Y}static Distance(z,u){return Math.sqrt(h.DistanceSquared(z,u))}static DistanceSquared(z,u){const Y=z.x-u.x,H=z.y-u.y,E=z.z-u.z,J=z.w-u.w;return Y*Y+H*H+E*E+J*J}static Center(z,u){return h.CenterToRef(z,u,new h)}static CenterToRef(z,u,Y){return Y.x=(z.x+u.x)/2,Y.y=(z.y+u.y)/2,Y.z=(z.z+u.z)/2,Y.w=(z.w+u.w)/2,Y}static TransformCoordinates(z,u){return h.TransformCoordinatesToRef(z,u,new h)}static TransformCoordinatesToRef(z,u,Y){return h.TransformCoordinatesFromFloatsToRef(z._x,z._y,z._z,u,Y),Y}static TransformCoordinatesFromFloatsToRef(z,u,Y,H,E){const J=H.m,l=z*J[0]+u*J[4]+Y*J[8]+J[12],T=z*J[1]+u*J[5]+Y*J[9]+J[13],b=z*J[2]+u*J[6]+Y*J[10]+J[14],L=z*J[3]+u*J[7]+Y*J[11]+J[15];return E.x=l,E.y=T,E.z=b,E.w=L,E}static TransformNormal(z,u){return h.TransformNormalToRef(z,u,new h)}static TransformNormalToRef(z,u,Y){const H=u.m,E=z.x*H[0]+z.y*H[4]+z.z*H[8],J=z.x*H[1]+z.y*H[5]+z.z*H[9],l=z.x*H[2]+z.y*H[6]+z.z*H[10];return Y.x=E,Y.y=J,Y.z=l,Y.w=z.w,Y}static TransformNormalFromFloatsToRef(z,u,Y,H,E,J){const l=E.m;return J.x=z*l[0]+u*l[4]+Y*l[8],J.y=z*l[1]+u*l[5]+Y*l[9],J.z=z*l[2]+u*l[6]+Y*l[10],J.w=H,J}static FromVector3(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new h(z._x,z._y,z._z,u)}static Dot(z,u){return z.x*u.x+z.y*u.y+z.z*u.z+z.w*u.w}}h._V8PerformanceHack=new h(.5,.5,.5,.5),h._ZeroReadOnly=h.Zero(),Object.defineProperties(h.prototype,{dimension:{value:[4]},rank:{value:1}});class o{get x(){return this._x}set x(z){this._x=z,this._isDirty=!0}get y(){return this._y}set y(z){this._y=z,this._isDirty=!0}get z(){return this._z}set z(z){this._z=z,this._isDirty=!0}get w(){return this._w}set w(z){this._w=z,this._isDirty=!0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=z,this._y=u,this._z=Y,this._w=H}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let z=q(this._x);return z=397*z^q(this._y),z=397*z^q(this._z),z=397*z^q(this._w),z}al(){return[this._x,this._y,this._z,this._w]}toArray(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[u]=this._x,z[u+1]=this._y,z[u+2]=this._z,z[u+3]=this._w,this}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.FromArrayToRef(z,u,this)}equals(z){return z&&this._x===z._x&&this._y===z._y&&this._z===z._z&&this._w===z._w}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;return z&&(0,b.WithinEpsilon)(this._x,z._x,u)&&(0,b.WithinEpsilon)(this._y,z._y,u)&&(0,b.WithinEpsilon)(this._z,z._z,u)&&(0,b.WithinEpsilon)(this._w,z._w,u)}isApprox(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;return z&&((0,b.WithinEpsilon)(this._x,z._x,u)&&(0,b.WithinEpsilon)(this._y,z._y,u)&&(0,b.WithinEpsilon)(this._z,z._z,u)&&(0,b.WithinEpsilon)(this._w,z._w,u)||(0,b.WithinEpsilon)(this._x,-z._x,u)&&(0,b.WithinEpsilon)(this._y,-z._y,u)&&(0,b.WithinEpsilon)(this._z,-z._z,u)&&(0,b.WithinEpsilon)(this._w,-z._w,u))}clone(){return new o(this._x,this._y,this._z,this._w)}J(z){return this._x=z._x,this._y=z._y,this._z=z._z,this._w=z._w,this._isDirty=!0,this}kl(z,u,Y,H){return this._x=z,this._y=u,this._z=Y,this._w=H,this._isDirty=!0,this}set(z,u,Y,H){return this.kl(z,u,Y,H)}Bl(z){return this.kl(z,z,z,z)}add(z){return new o(this._x+z._x,this._y+z._y,this._z+z._z,this._w+z._w)}addInPlace(z){return this._x+=z._x,this._y+=z._y,this._z+=z._z,this._w+=z._w,this._isDirty=!0,this}addToRef(z,u){return u._x=this._x+z._x,u._y=this._y+z._y,u._z=this._z+z._z,u._w=this._w+z._w,u._isDirty=!0,u}addInPlaceFromFloats(z,u,Y,H){return this._x+=z,this._y+=u,this._z+=Y,this._w+=H,this._isDirty=!0,this}subtractToRef(z,u){return u._x=this._x-z._x,u._y=this._y-z._y,u._z=this._z-z._z,u._w=this._w-z._w,u._isDirty=!0,u}subtractFromFloats(z,u,Y,H){return this.subtractFromFloatsToRef(z,u,Y,H,new o)}subtractFromFloatsToRef(z,u,Y,H,E){return E._x=this._x-z,E._y=this._y-u,E._z=this._z-Y,E._w=this._w-H,E._isDirty=!0,E}JY(z){return new o(this._x-z._x,this._y-z._y,this._z-z._z,this._w-z._w)}dg(z){return this._x-=z._x,this._y-=z._y,this._z-=z._z,this._w-=z._w,this._isDirty=!0,this}scale(z){return new o(this._x*z,this._y*z,this._z*z,this._w*z)}scaleToRef(z,u){return u._x=this._x*z,u._y=this._y*z,u._z=this._z*z,u._w=this._w*z,u._isDirty=!0,u}scaleInPlace(z){return this._x*=z,this._y*=z,this._z*=z,this._w*=z,this._isDirty=!0,this}scaleAndAddToRef(z,u){return u._x+=this._x*z,u._y+=this._y*z,u._z+=this._z*z,u._w+=this._w*z,u._isDirty=!0,u}multiply(z){const u=new o(0,0,0,1);return this.multiplyToRef(z,u),u}multiplyToRef(z,u){const Y=this._x*z._w+this._y*z._z-this._z*z._y+this._w*z._x,H=-this._x*z._z+this._y*z._w+this._z*z._x+this._w*z._y,E=this._x*z._y-this._y*z._x+this._z*z._w+this._w*z._z,J=-this._x*z._x-this._y*z._y-this._z*z._z+this._w*z._w;return u.kl(Y,H,E,J),u}multiplyInPlace(z){return this.multiplyToRef(z,this)}multiplyByFloats(z,u,Y,H){return this._x*=z,this._y*=u,this._z*=Y,this._w*=H,this._isDirty=!0,this}divide(z){throw new ReferenceError("Can not divide a quaternion")}divideToRef(z,u){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(z){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new o)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(z){return z._x=-this._x,z._y=-this._y,z._z=-this._z,z._w=-this._w,z._isDirty=!0,z}equalsToFloats(z,u,Y,H){return this._x===z&&this._y===u&&this._z===Y&&this._w===H}floorToRef(z){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(z){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(z){return z.kl(-this._x,-this._y,-this._z,this._w),z}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new o(-this._x,-this._y,-this._z,this._w)}invert(){const z=this.conjugate(),u=this.lengthSquared();return 0==u||1==u||z.scaleInPlace(1/u),z}invertInPlace(){this.conjugateInPlace();const z=this.lengthSquared();return 0==z||1==z||this.scaleInPlace(1/z),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){const z=new o(0,0,0,1);return this.normalizeToRef(z),z}normalizeToRef(z){const u=this.length();return 0===u||1===u?z.kl(this._x,this._y,this._z,this._w):this.scaleToRef(1/u,z)}toEulerAngles(){const z=K.Zero();return this.toEulerAnglesToRef(z),z}toEulerAnglesToRef(z){const u=this._z,Y=this._x,H=this._y,E=this._w,J=H*u-Y*E,l=.4999999;if(J<-l)z._y=2*Math.atan2(H,E),z._x=Math.PI/2,z._z=0,z._isDirty=!0;else if(J>l)z._y=2*Math.atan2(H,E),z._x=-Math.PI/2,z._z=0,z._isDirty=!0;else{const l=E*E,T=u*u,b=Y*Y,L=H*H;z._z=Math.atan2(2*(Y*H+u*E),-T-b+L+l),z._x=Math.asin(-2*J),z._y=Math.atan2(2*(u*Y+H*E),T-b-L+l),z._isDirty=!0}return z}toAlphaBetaGammaToRef(z){const u=this._z,Y=this._x,H=this._y,E=this._w,J=Math.sqrt(Y*Y+H*H),l=Math.sqrt(u*u+E*E),T=2*Math.atan2(J,l),b=2*Math.atan2(u,E),L=2*Math.atan2(H,Y),D=(b+L)/2,g=(b-L)/2;return z.set(g,T,D),z}toRotationMatrix(z){return d.FromQuaternionToRef(this,z),z}fromRotationMatrix(z){return o.FromRotationMatrixToRef(z,this),this}dot(z){return this._x*z._x+this._y*z._y+this._z*z._z+this._w*z._w}toAxisAngle(){const z=K.Zero();return{axis:z,angle:this.toAxisAngleToRef(z)}}toAxisAngleToRef(z){let u=0;const Y=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),H=this._w;return Y>0?(u=2*Math.atan2(Y,H),z.set(this._x/Y,this._y/Y,this._z/Y)):(u=0,z.set(1,0,0)),u}static FromRotationMatrix(z){const u=new o;return o.FromRotationMatrixToRef(z,u),u}static FromRotationMatrixToRef(z,u){const Y=z.m,H=Y[0],E=Y[4],J=Y[8],l=Y[1],T=Y[5],b=Y[9],L=Y[2],D=Y[6],g=Y[10],M=H+T+g;let q;return M>0?(q=.5/Math.sqrt(M+1),u._w=.25/q,u._x=(D-b)*q,u._y=(J-L)*q,u._z=(l-E)*q,u._isDirty=!0):H>T&&H>g?(q=2*Math.sqrt(1+H-T-g),u._w=(D-b)/q,u._x=.25*q,u._y=(E+l)/q,u._z=(J+L)/q,u._isDirty=!0):T>g?(q=2*Math.sqrt(1+T-H-g),u._w=(J-L)/q,u._x=(E+l)/q,u._y=.25*q,u._z=(b+D)/q,u._isDirty=!0):(q=2*Math.sqrt(1+g-H-T),u._w=(l-E)/q,u._x=(J+L)/q,u._y=(b+D)/q,u._z=.25*q,u._isDirty=!0),u}static Dot(z,u){return z._x*u._x+z._y*u._y+z._z*u._z+z._w*u._w}static AreClose(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const H=o.Dot(z,u);return 1-H*H<=Y}static SmoothToRef(z,u,Y,H,E){let J=0===H?1:Y/H;return J=(0,b.Clamp)(J,0,1),o.SlerpToRef(z,u,J,E),E}static Zero(){return new o(0,0,0,0)}static Inverse(z){return new o(-z._x,-z._y,-z._z,z._w)}static InverseToRef(z,u){return u.set(-z._x,-z._y,-z._z,z._w),u}static Identity(){return new o(0,0,0,1)}static IsIdentity(z){return z&&0===z._x&&0===z._y&&0===z._z&&1===z._w}static RotationAxis(z,u){return o.RotationAxisToRef(z,u,new o)}static RotationAxisToRef(z,u,Y){Y._w=Math.cos(u/2);const H=Math.sin(u/2)/z.length();return Y._x=z._x*H,Y._y=z._y*H,Y._z=z._z*H,Y._isDirty=!0,Y}static Nl(z,u){return u||(u=0),new o(z[u],z[u+1],z[u+2],z[u+3])}static FromArrayToRef(z,u,Y){return Y._x=z[u],Y._y=z[u+1],Y._z=z[u+2],Y._w=z[u+3],Y._isDirty=!0,Y}static FromFloatsToRef(z,u,Y,H,E){return E.kl(z,u,Y,H),E}static FromEulerAngles(z,u,Y){const H=new o;return o.RotationYawPitchRollToRef(u,z,Y,H),H}static FromEulerAnglesToRef(z,u,Y,H){return o.RotationYawPitchRollToRef(u,z,Y,H),H}static FromEulerVector(z){const u=new o;return o.RotationYawPitchRollToRef(z._y,z._x,z._z,u),u}static FromEulerVectorToRef(z,u){return o.RotationYawPitchRollToRef(z._y,z._x,z._z,u),u}static FromUnitVectorsToRef(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.e;const J=K.Dot(z,u)+1;return J<E?Math.abs(z.x)>Math.abs(z.z)?Y.set(-z.y,z.x,0,0):Y.set(0,-z.z,z.y,0):(K.CrossToRef(z,u,W.Pl[0]),Y.set(W.Pl[0].x,W.Pl[0].y,W.Pl[0].z,J)),Y.normalize()}static RotationYawPitchRoll(z,u,Y){const H=new o;return o.RotationYawPitchRollToRef(z,u,Y,H),H}static RotationYawPitchRollToRef(z,u,Y,H){const E=.5*Y,J=.5*u,l=.5*z,T=Math.sin(E),b=Math.cos(E),L=Math.sin(J),D=Math.cos(J),g=Math.sin(l),M=Math.cos(l);return H._x=M*L*b+g*D*T,H._y=g*D*b-M*L*T,H._z=M*D*T-g*L*b,H._w=M*D*b+g*L*T,H._isDirty=!0,H}static RotationAlphaBetaGamma(z,u,Y){const H=new o;return o.RotationAlphaBetaGammaToRef(z,u,Y,H),H}static RotationAlphaBetaGammaToRef(z,u,Y,H){const E=.5*(Y+z),J=.5*(Y-z),l=.5*u;return H._x=Math.cos(J)*Math.sin(l),H._y=Math.sin(J)*Math.sin(l),H._z=Math.sin(E)*Math.cos(l),H._w=Math.cos(E)*Math.cos(l),H._isDirty=!0,H}static RotationQuaternionFromAxis(z,u,Y){const H=new o(0,0,0,0);return o.RotationQuaternionFromAxisToRef(z,u,Y,H),H}static RotationQuaternionFromAxisToRef(z,u,Y,H){const E=t.Matrix[0];return z=z.normalizeToRef(t.Pl[0]),u=u.normalizeToRef(t.Pl[1]),Y=Y.normalizeToRef(t.Pl[2]),d.FromXYZAxesToRef(z,u,Y,E),o.FromRotationMatrixToRef(E,H),H}static FromLookDirectionLH(z,u){const Y=new o;return o.FromLookDirectionLHToRef(z,u,Y),Y}static FromLookDirectionLHToRef(z,u,Y){const H=t.Matrix[0];return d.LookDirectionLHToRef(z,u,H),o.FromRotationMatrixToRef(H,Y),Y}static FromLookDirectionRH(z,u){const Y=new o;return o.FromLookDirectionRHToRef(z,u,Y),Y}static FromLookDirectionRHToRef(z,u,Y){const H=t.Matrix[0];return d.LookDirectionRHToRef(z,u,H),o.FromRotationMatrixToRef(H,Y)}static Slerp(z,u,Y){const H=o.Identity();return o.SlerpToRef(z,u,Y,H),H}static SlerpToRef(z,u,Y,H){let E,J,l=z._x*u._x+z._y*u._y+z._z*u._z+z._w*u._w,T=!1;if(l<0&&(T=!0,l=-l),l>.999999)J=1-Y,E=T?-Y:Y;else{const z=Math.acos(l),u=1/Math.sin(z);J=Math.sin((1-Y)*z)*u,E=T?-Math.sin(Y*z)*u:Math.sin(Y*z)*u}return H._x=J*z._x+E*u._x,H._y=J*z._y+E*u._y,H._z=J*z._z+E*u._z,H._w=J*z._w+E*u._w,H._isDirty=!0,H}static Hermite(z,u,Y,H,E){const J=E*E,l=E*J,T=2*l-3*J+1,b=-2*l+3*J,L=l-2*J+E,D=l-J,g=z._x*T+Y._x*b+u._x*L+H._x*D,M=z._y*T+Y._y*b+u._y*L+H._y*D,q=z._z*T+Y._z*b+u._z*L+H._z*D,C=z._w*T+Y._w*b+u._w*L+H._w*D;return new o(g,M,q,C)}static Hermite1stDerivative(z,u,Y,H,E){const J=new o;return this.Hermite1stDerivativeToRef(z,u,Y,H,E,J),J}static Hermite1stDerivativeToRef(z,u,Y,H,E,J){const l=E*E;return J._x=6*(l-E)*z._x+(3*l-4*E+1)*u._x+6*(-l+E)*Y._x+(3*l-2*E)*H._x,J._y=6*(l-E)*z._y+(3*l-4*E+1)*u._y+6*(-l+E)*Y._y+(3*l-2*E)*H._y,J._z=6*(l-E)*z._z+(3*l-4*E+1)*u._z+6*(-l+E)*Y._z+(3*l-2*E)*H._z,J._w=6*(l-E)*z._w+(3*l-4*E+1)*u._w+6*(-l+E)*Y._w+(3*l-2*E)*H._w,J._isDirty=!0,J}static Normalize(z){const u=o.Zero();return o.NormalizeToRef(z,u),u}static NormalizeToRef(z,u){return z.normalizeToRef(u),u}static Clamp(z,u,Y){const H=new o;return o.ClampToRef(z,u,Y,H),H}static ClampToRef(z,u,Y,H){return H.kl((0,b.Clamp)(z.x,u.x,Y.x),(0,b.Clamp)(z.y,u.y,Y.y),(0,b.Clamp)(z.z,u.z,Y.z),(0,b.Clamp)(z.w,u.w,Y.w))}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new o((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).kl((0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u),(0,b.RandomRange)(z,u))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(z,u){return Math.sqrt(o.DistanceSquared(z,u))}static DistanceSquared(z,u){const Y=z.x-u.x,H=z.y-u.y,E=z.z-u.z,J=z.w-u.w;return Y*Y+H*H+E*E+J*J}static Center(z,u){return o.CenterToRef(z,u,o.Zero())}static CenterToRef(z,u,Y){return Y.kl((z.x+u.x)/2,(z.y+u.y)/2,(z.z+u.z)/2,(z.w+u.w)/2)}}o._V8PerformanceHack=new o(.5,.5,.5,.5),Object.defineProperties(o.prototype,{dimension:{value:[4]},rank:{value:1}});class d{static get Use64Bits(){return l.b.MatrixUse64Bits}get m(){return this.NM}markAsUpdated(){this.updateFlag=L._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=z,this._isIdentity3x2=z||Y,this._isIdentityDirty=!this._isIdentity&&u,this._isIdentity3x2Dirty=!this._isIdentity3x2&&H}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,l.b.MatrixTrackPrecisionChange&&l.b.MatrixTrackedMatrices.push(this),this.NM=new l.b.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const z=this.NM;this._isIdentity=1===z[0]&&0===z[1]&&0===z[2]&&0===z[3]&&0===z[4]&&1===z[5]&&0===z[6]&&0===z[7]&&0===z[8]&&0===z[9]&&1===z[10]&&0===z[11]&&0===z[12]&&0===z[13]&&0===z[14]&&1===z[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.NM[0]||1!==this.NM[5]||1!==this.NM[15]||0!==this.NM[1]||0!==this.NM[2]||0!==this.NM[3]||0!==this.NM[4]||0!==this.NM[6]||0!==this.NM[7]||0!==this.NM[8]||0!==this.NM[9]||0!==this.NM[10]||0!==this.NM[11]||0!==this.NM[12]||0!==this.NM[13]||0!==this.NM[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const z=this.NM,u=z[0],Y=z[1],H=z[2],E=z[3],J=z[4],l=z[5],T=z[6],b=z[7],L=z[8],D=z[9],g=z[10],M=z[11],q=z[12],C=z[13],K=z[14],h=z[15],o=g*h-K*M,d=D*h-C*M,t=D*K-C*g,W=L*h-q*M,Z=L*K-g*q,s=L*C-q*D;return u*+(l*o-T*d+b*t)+Y*-(J*o-T*W+b*Z)+H*+(J*d-l*W+b*s)+E*-(J*t-l*Z+T*s)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!z)return this.NM;const Y=this.NM;for(let H=0;H<16;H++)z[u+H]=Y[H];return this}al(){return this.NM}lY(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.FromArrayToRef(z,u,this)}kl(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];return d.FromArrayToRef(u,0,this)}set(){const z=this.NM;for(let u=0;u<16;u++)z[u]=u<0||arguments.length<=u?void 0:arguments[u];return this.markAsUpdated(),this}Bl(z){const u=this.NM;for(let Y=0;Y<16;Y++)u[Y]=z;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return d.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(z){const u=new d;return this.addToRef(z,u),u}addToRef(z,u){const Y=this.NM,H=u.NM,E=z.m;for(let J=0;J<16;J++)H[J]=Y[J]+E[J];return u.markAsUpdated(),u}addToSelf(z){const u=this.NM,Y=z.m;return u[0]+=Y[0],u[1]+=Y[1],u[2]+=Y[2],u[3]+=Y[3],u[4]+=Y[4],u[5]+=Y[5],u[6]+=Y[6],u[7]+=Y[7],u[8]+=Y[8],u[9]+=Y[9],u[10]+=Y[10],u[11]+=Y[11],u[12]+=Y[12],u[13]+=Y[13],u[14]+=Y[14],u[15]+=Y[15],this.markAsUpdated(),this}addInPlace(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]+=Y[H];return this.markAsUpdated(),this}addInPlaceFromFloats(){const z=this.NM;for(let u=0;u<16;u++)z[u]+=u<0||arguments.length<=u?void 0:arguments[u];return this.markAsUpdated(),this}JY(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]-=Y[H];return this.markAsUpdated(),this}subtractToRef(z,u){const Y=this.NM,H=z.m,E=u.NM;for(let J=0;J<16;J++)E[J]=Y[J]-H[J];return u.markAsUpdated(),u}dg(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]-=Y[H];return this.markAsUpdated(),this}subtractFromFloats(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];return this.subtractFromFloatsToRef(...u,new d)}subtractFromFloatsToRef(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];const H=u.pop(),E=this.NM,J=H.NM,l=u;for(let T=0;T<16;T++)J[T]=E[T]-l[T];return H.markAsUpdated(),H}invertToRef(z){return!0===this._isIdentity?(d.IdentityToRef(z),z):(M(this,z.al())?z.markAsUpdated():z.J(this),z)}addAtIndex(z,u){return this.NM[z]+=u,this.markAsUpdated(),this}multiplyAtIndex(z,u){return this.NM[z]*=u,this.markAsUpdated(),this}setTranslationFromFloats(z,u,Y){return this.NM[12]=z,this.NM[13]=u,this.NM[14]=Y,this.markAsUpdated(),this}addTranslationFromFloats(z,u,Y){return this.NM[12]+=z,this.NM[13]+=u,this.NM[14]+=Y,this.markAsUpdated(),this}setTranslation(z){return this.setTranslationFromFloats(z._x,z._y,z._z)}getTranslation(){return new K(this.NM[12],this.NM[13],this.NM[14])}getTranslationToRef(z){return z.x=this.NM[12],z.y=this.NM[13],z.z=this.NM[14],z}removeRotationAndScaling(){const z=this.m;return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,z[12],z[13],z[14],z[15],this),this._updateIdentityStatus(0===z[12]&&0===z[13]&&0===z[14]&&1===z[15]),this}J(z){z.copyToArray(this.NM);const u=z;return this.updateFlag=u.updateFlag,this._updateIdentityStatus(u._isIdentity,u._isIdentityDirty,u._isIdentity3x2,u._isIdentity3x2Dirty),this}copyToArray(z){return g(this,z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(z){const u=new d;return this.multiplyToRef(z,u),u}multiplyInPlace(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]*=Y[H];return this.markAsUpdated(),this}multiplyByFloats(){const z=this.NM;for(let u=0;u<16;u++)z[u]*=u<0||arguments.length<=u?void 0:arguments[u];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];const H=u.pop(),E=this.NM,J=H.NM,l=u;for(let T=0;T<16;T++)J[T]=E[T]*l[T];return H.markAsUpdated(),H}multiplyToRef(z,u){return this._isIdentity?(u.J(z),u):z._isIdentity?(u.J(this),u):(this.multiplyToArray(z,u.NM,0),u.markAsUpdated(),u)}multiplyToArray(z,u,Y){return D(this,z,u,Y),this}divide(z){return this.divideToRef(z,new d)}divideToRef(z,u){const Y=this.NM,H=z.m,E=u.NM;for(let J=0;J<16;J++)E[J]=Y[J]/H[J];return u.markAsUpdated(),u}divideInPlace(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]/=Y[H];return this.markAsUpdated(),this}minimizeInPlace(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]=Math.min(u[H],Y[H]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const z=this.NM;for(let u=0;u<16;u++)z[u]=Math.min(z[u],u<0||arguments.length<=u?void 0:arguments[u]);return this.markAsUpdated(),this}maximizeInPlace(z){const u=this.NM,Y=z.m;for(let H=0;H<16;H++)u[H]=Math.min(u[H],Y[H]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const z=this.NM;for(let u=0;u<16;u++)z[u]=Math.min(z[u],u<0||arguments.length<=u?void 0:arguments[u]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new d)}negateInPlace(){const z=this.NM;for(let u=0;u<16;u++)z[u]=-z[u];return this.markAsUpdated(),this}negateToRef(z){const u=this.NM,Y=z.NM;for(let H=0;H<16;H++)Y[H]=-u[H];return z.markAsUpdated(),z}equals(z){const u=z;if(!u)return!1;if((this._isIdentity||u._isIdentity)&&!this._isIdentityDirty&&!u._isIdentityDirty)return this._isIdentity&&u._isIdentity;const Y=this.m,H=u.m;return Y[0]===H[0]&&Y[1]===H[1]&&Y[2]===H[2]&&Y[3]===H[3]&&Y[4]===H[4]&&Y[5]===H[5]&&Y[6]===H[6]&&Y[7]===H[7]&&Y[8]===H[8]&&Y[9]===H[9]&&Y[10]===H[10]&&Y[11]===H[11]&&Y[12]===H[12]&&Y[13]===H[13]&&Y[14]===H[14]&&Y[15]===H[15]}equalsWithEpsilon(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.NM,H=z.m;for(let E=0;E<16;E++)if(!(0,b.WithinEpsilon)(Y[E],H[E],u))return!1;return!0}equalsToFloats(){const z=this.NM;for(let u=0;u<16;u++)if(z[u]!=(u<0||arguments.length<=u?void 0:arguments[u]))return!1;return!0}floor(){return this.floorToRef(new d)}floorToRef(z){const u=this.NM,Y=z.NM;for(let H=0;H<16;H++)Y[H]=Math.floor(u[H]);return z.markAsUpdated(),z}fract(){return this.fractToRef(new d)}fractToRef(z){const u=this.NM,Y=z.NM;for(let H=0;H<16;H++)Y[H]=u[H]-Math.floor(u[H]);return z.markAsUpdated(),z}clone(){const z=new d;return z.J(this),z}getClassName(){return"Matrix"}getHashCode(){let z=q(this.NM[0]);for(let u=1;u<16;u++)z=397*z^q(this.NM[u]);return z}decomposeToTransformNode(z){return z.rotationQuaternion=z.rotationQuaternion||new o,this.decompose(z.el,z.rotationQuaternion,z.position)}decompose(z,u,Y,H){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return Y&&Y.Bl(0),z&&z.Bl(1),u&&u.kl(0,0,0,1),!0;const J=this.NM;if(Y&&Y.kl(J[12],J[13],J[14]),(z=z||t.Pl[0]).x=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),z.y=Math.sqrt(J[4]*J[4]+J[5]*J[5]+J[6]*J[6]),z.z=Math.sqrt(J[8]*J[8]+J[9]*J[9]+J[10]*J[10]),H){const u=(E?H.absoluteScaling.x:H.el.x)<0?-1:1,Y=(E?H.absoluteScaling.y:H.el.y)<0?-1:1,J=(E?H.absoluteScaling.z:H.el.z)<0?-1:1;z.x*=u,z.y*=Y,z.z*=J}else this.determinant()<=0&&(z.y*=-1);if(0===z._x||0===z._y||0===z._z)return u&&u.kl(0,0,0,1),!1;if(u){const Y=1/z._x,H=1/z._y,E=1/z._z;d.FromValuesToRef(J[0]*Y,J[1]*Y,J[2]*Y,0,J[4]*H,J[5]*H,J[6]*H,0,J[8]*E,J[9]*E,J[10]*E,0,0,0,0,1,t.Matrix[0]),o.FromRotationMatrixToRef(t.Matrix[0],u)}return!0}getRow(z){if(z<0||z>3)return null;const u=4*z;return new h(this.NM[u+0],this.NM[u+1],this.NM[u+2],this.NM[u+3])}getRowToRef(z,u){if(z>=0&&z<=3){const Y=4*z;u.x=this.NM[Y+0],u.y=this.NM[Y+1],u.z=this.NM[Y+2],u.w=this.NM[Y+3]}return u}setRow(z,u){return this.setRowFromFloats(z,u.x,u.y,u.z,u.w)}transpose(){const z=new d;return d.TransposeToRef(this,z),z}transposeToRef(z){return d.TransposeToRef(this,z),z}setRowFromFloats(z,u,Y,H,E){if(z<0||z>3)return this;const J=4*z;return this.NM[J+0]=u,this.NM[J+1]=Y,this.NM[J+2]=H,this.NM[J+3]=E,this.markAsUpdated(),this}scale(z){const u=new d;return this.scaleToRef(z,u),u}scaleToRef(z,u){for(let Y=0;Y<16;Y++)u.NM[Y]=this.NM[Y]*z;return u.markAsUpdated(),u}scaleAndAddToRef(z,u){for(let Y=0;Y<16;Y++)u.NM[Y]+=this.NM[Y]*z;return u.markAsUpdated(),u}scaleInPlace(z){const u=this.NM;for(let Y=0;Y<16;Y++)u[Y]*=z;return this.markAsUpdated(),this}toNormalMatrix(z){const u=t.Matrix[0];this.invertToRef(u),u.transposeToRef(z);const Y=z.NM;return d.FromValuesToRef(Y[0],Y[1],Y[2],0,Y[4],Y[5],Y[6],0,Y[8],Y[9],Y[10],0,0,0,0,1,z),z}getRotationMatrix(){const z=new d;return this.getRotationMatrixToRef(z),z}getRotationMatrixToRef(z){const u=t.Pl[0];if(!this.decompose(u))return d.IdentityToRef(z),z;const Y=this.NM,H=1/u._x,E=1/u._y,J=1/u._z;return d.FromValuesToRef(Y[0]*H,Y[1]*H,Y[2]*H,0,Y[4]*E,Y[5]*E,Y[6]*E,0,Y[8]*J,Y[9]*J,Y[10]*J,0,0,0,0,1,z),z}toggleModelMatrixHandInPlace(){const z=this.NM;return z[2]*=-1,z[6]*=-1,z[8]*=-1,z[9]*=-1,z[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const z=this.NM;return z[8]*=-1,z[9]*=-1,z[10]*=-1,z[11]*=-1,this.markAsUpdated(),this}static Nl(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=new d;return d.FromArrayToRef(z,u,Y),Y}static FromArrayToRef(z,u,Y){for(let H=0;H<16;H++)Y.NM[H]=z[H+u];return Y.markAsUpdated(),Y}static FromFloat32ArrayToRefScaled(z,u,Y,H){return H.NM[0]=z[0+u]*Y,H.NM[1]=z[1+u]*Y,H.NM[2]=z[2+u]*Y,H.NM[3]=z[3+u]*Y,H.NM[4]=z[4+u]*Y,H.NM[5]=z[5+u]*Y,H.NM[6]=z[6+u]*Y,H.NM[7]=z[7+u]*Y,H.NM[8]=z[8+u]*Y,H.NM[9]=z[9+u]*Y,H.NM[10]=z[10+u]*Y,H.NM[11]=z[11+u]*Y,H.NM[12]=z[12+u]*Y,H.NM[13]=z[13+u]*Y,H.NM[14]=z[14+u]*Y,H.NM[15]=z[15+u]*Y,H.markAsUpdated(),H}static get IdentityReadOnly(){return d._IdentityReadOnly}static FromValuesToRef(z,u,Y,H,E,J,l,T,b,L,D,g,M,q,C,K,h){const o=h.NM;o[0]=z,o[1]=u,o[2]=Y,o[3]=H,o[4]=E,o[5]=J,o[6]=l,o[7]=T,o[8]=b,o[9]=L,o[10]=D,o[11]=g,o[12]=M,o[13]=q,o[14]=C,o[15]=K,h.markAsUpdated()}static FromValues(z,u,Y,H,E,J,l,T,b,L,D,g,M,q,C,K){const h=new d,o=h.NM;return o[0]=z,o[1]=u,o[2]=Y,o[3]=H,o[4]=E,o[5]=J,o[6]=l,o[7]=T,o[8]=b,o[9]=L,o[10]=D,o[11]=g,o[12]=M,o[13]=q,o[14]=C,o[15]=K,h.markAsUpdated(),h}static Compose(z,u,Y){const H=new d;return d.ComposeToRef(z,u,Y,H),H}static ComposeToRef(z,u,Y,H){const E=H.NM,J=u._x,l=u._y,T=u._z,b=u._w,L=J+J,D=l+l,g=T+T,M=J*L,q=J*D,C=J*g,K=l*D,h=l*g,o=T*g,d=b*L,t=b*D,W=b*g,Z=z._x,s=z._y,v=z._z;return E[0]=(1-(K+o))*Z,E[1]=(q+W)*Z,E[2]=(C-t)*Z,E[3]=0,E[4]=(q-W)*s,E[5]=(1-(M+o))*s,E[6]=(h+d)*s,E[7]=0,E[8]=(C+t)*v,E[9]=(h-d)*v,E[10]=(1-(M+K))*v,E[11]=0,E[12]=Y._x,E[13]=Y._y,E[14]=Y._z,E[15]=1,H.markAsUpdated(),H}static Identity(){const z=d.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return z._updateIdentityStatus(!0),z}static IdentityToRef(z){return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,z),z._updateIdentityStatus(!0),z}static Zero(){const z=d.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return z._updateIdentityStatus(!1),z}static RotationX(z){const u=new d;return d.RotationXToRef(z,u),u}static Invert(z){const u=new d;return z.invertToRef(u),u}static RotationXToRef(z,u){const Y=Math.sin(z),H=Math.cos(z);return d.FromValuesToRef(1,0,0,0,0,H,Y,0,0,-Y,H,0,0,0,0,1,u),u._updateIdentityStatus(1===H&&0===Y),u}static RotationY(z){const u=new d;return d.RotationYToRef(z,u),u}static RotationYToRef(z,u){const Y=Math.sin(z),H=Math.cos(z);return d.FromValuesToRef(H,0,-Y,0,0,1,0,0,Y,0,H,0,0,0,0,1,u),u._updateIdentityStatus(1===H&&0===Y),u}static RotationZ(z){const u=new d;return d.RotationZToRef(z,u),u}static RotationZToRef(z,u){const Y=Math.sin(z),H=Math.cos(z);return d.FromValuesToRef(H,Y,0,0,-Y,H,0,0,0,0,1,0,0,0,0,1,u),u._updateIdentityStatus(1===H&&0===Y),u}static RotationAxis(z,u){const Y=new d;return d.RotationAxisToRef(z,u,Y),Y}static RotationAxisToRef(z,u,Y){const H=Math.sin(-u),E=Math.cos(-u),J=1-E;z=z.normalizeToRef(t.Pl[0]);const l=Y.NM;return l[0]=z._x*z._x*J+E,l[1]=z._x*z._y*J-z._z*H,l[2]=z._x*z._z*J+z._y*H,l[3]=0,l[4]=z._y*z._x*J+z._z*H,l[5]=z._y*z._y*J+E,l[6]=z._y*z._z*J-z._x*H,l[7]=0,l[8]=z._z*z._x*J-z._y*H,l[9]=z._z*z._y*J+z._x*H,l[10]=z._z*z._z*J+E,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,Y.markAsUpdated(),Y}static RotationAlignToRef(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=K.Dot(u,z),l=Y.NM;if(J<-1+H.e)l[0]=-1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=E?1:-1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=E?-1:1,l[11]=0;else{const Y=K.Cross(u,z),H=1/(1+J);l[0]=Y._x*Y._x*H+J,l[1]=Y._y*Y._x*H-Y._z,l[2]=Y._z*Y._x*H+Y._y,l[3]=0,l[4]=Y._x*Y._y*H+Y._z,l[5]=Y._y*Y._y*H+J,l[6]=Y._z*Y._y*H-Y._x,l[7]=0,l[8]=Y._x*Y._z*H-Y._y,l[9]=Y._y*Y._z*H+Y._x,l[10]=Y._z*Y._z*H+J,l[11]=0}return l[12]=0,l[13]=0,l[14]=0,l[15]=1,Y.markAsUpdated(),Y}static RotationYawPitchRoll(z,u,Y){const H=new d;return d.RotationYawPitchRollToRef(z,u,Y,H),H}static RotationYawPitchRollToRef(z,u,Y,H){return o.RotationYawPitchRollToRef(z,u,Y,t.Quaternion[0]),t.Quaternion[0].toRotationMatrix(H),H}static Scaling(z,u,Y){const H=new d;return d.ScalingToRef(z,u,Y,H),H}static ScalingToRef(z,u,Y,H){return d.FromValuesToRef(z,0,0,0,0,u,0,0,0,0,Y,0,0,0,0,1,H),H._updateIdentityStatus(1===z&&1===u&&1===Y),H}static Translation(z,u,Y){const H=new d;return d.TranslationToRef(z,u,Y,H),H}static TranslationToRef(z,u,Y,H){return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,z,u,Y,1,H),H._updateIdentityStatus(0===z&&0===u&&0===Y),H}static Lerp(z,u,Y){const H=new d;return d.LerpToRef(z,u,Y,H),H}static LerpToRef(z,u,Y,H){const E=H.NM,J=z.m,l=u.m;for(let T=0;T<16;T++)E[T]=J[T]*(1-Y)+l[T]*Y;return H.markAsUpdated(),H}static DecomposeLerp(z,u,Y){const H=new d;return d.DecomposeLerpToRef(z,u,Y,H),H}static DecomposeLerpToRef(z,u,Y,H){const E=t.Pl[0],J=t.Quaternion[0],l=t.Pl[1];z.decompose(E,J,l);const T=t.Pl[2],b=t.Quaternion[1],L=t.Pl[3];u.decompose(T,b,L);const D=t.Pl[4];K.LerpToRef(E,T,Y,D);const g=t.Quaternion[2];o.SlerpToRef(J,b,Y,g);const M=t.Pl[5];return K.LerpToRef(l,L,Y,M),d.ComposeToRef(D,g,M,H),H}static LookAtLH(z,u,Y){const H=new d;return d.LookAtLHToRef(z,u,Y,H),H}static LookAtLHToRef(z,u,Y,H){const E=t.Pl[0],J=t.Pl[1],l=t.Pl[2];u.subtractToRef(z,l),l.normalize(),K.CrossToRef(Y,l,E);const T=E.lengthSquared();0===T?E.x=1:E.normalizeFromLength(Math.sqrt(T)),K.CrossToRef(l,E,J),J.normalize();const b=-K.Dot(E,z),L=-K.Dot(J,z),D=-K.Dot(l,z);return d.FromValuesToRef(E._x,J._x,l._x,0,E._y,J._y,l._y,0,E._z,J._z,l._z,0,b,L,D,1,H),H}static LookAtRH(z,u,Y){const H=new d;return d.LookAtRHToRef(z,u,Y,H),H}static LookAtRHToRef(z,u,Y,H){const E=t.Pl[0],J=t.Pl[1],l=t.Pl[2];z.subtractToRef(u,l),l.normalize(),K.CrossToRef(Y,l,E);const T=E.lengthSquared();0===T?E.x=1:E.normalizeFromLength(Math.sqrt(T)),K.CrossToRef(l,E,J),J.normalize();const b=-K.Dot(E,z),L=-K.Dot(J,z),D=-K.Dot(l,z);return d.FromValuesToRef(E._x,J._x,l._x,0,E._y,J._y,l._y,0,E._z,J._z,l._z,0,b,L,D,1,H),H}static LookDirectionLH(z,u){const Y=new d;return d.LookDirectionLHToRef(z,u,Y),Y}static LookDirectionLHToRef(z,u,Y){const H=t.Pl[0];H.J(z),H.scaleInPlace(-1);const E=t.Pl[1];return K.CrossToRef(u,H,E),d.FromValuesToRef(E._x,E._y,E._z,0,u._x,u._y,u._z,0,H._x,H._y,H._z,0,0,0,0,1,Y),Y}static LookDirectionRH(z,u){const Y=new d;return d.LookDirectionRHToRef(z,u,Y),Y}static LookDirectionRHToRef(z,u,Y){const H=t.Pl[2];return K.CrossToRef(u,z,H),d.FromValuesToRef(H._x,H._y,H._z,0,u._x,u._y,u._z,0,z._x,z._y,z._z,0,0,0,0,1,Y),Y}static OrthoLH(z,u,Y,H,E){const J=new d;return d.OrthoLHToRef(z,u,Y,H,J,E),J}static OrthoLHToRef(z,u,Y,H,E,J){const l=2/z,T=2/u,b=2/(H-Y),L=-(H+Y)/(H-Y);return d.FromValuesToRef(l,0,0,0,0,T,0,0,0,0,b,0,0,0,L,1,E),J&&E.multiplyToRef(Z,E),E._updateIdentityStatus(1===l&&1===T&&1===b&&0===L),E}static OrthoOffCenterLH(z,u,Y,H,E,J,l){const T=new d;return d.OrthoOffCenterLHToRef(z,u,Y,H,E,J,T,l),T}static OrthoOffCenterLHToRef(z,u,Y,H,E,J,l,T){const b=2/(u-z),L=2/(H-Y),D=2/(J-E),g=-(J+E)/(J-E),M=(z+u)/(z-u),q=(H+Y)/(Y-H);return d.FromValuesToRef(b,0,0,0,0,L,0,0,0,0,D,0,M,q,g,1,l),T&&l.multiplyToRef(Z,l),l.markAsUpdated(),l}static ObliqueOffCenterLHToRef(z,u,Y,H,E,J,l,T,b,L,D){const g=-l*Math.cos(T),M=-l*Math.sin(T);return d.TranslationToRef(0,0,-b,t.Matrix[1]),d.FromValuesToRef(1,0,0,0,0,1,0,0,g,M,1,0,0,0,0,1,t.Matrix[0]),t.Matrix[1].multiplyToRef(t.Matrix[0],t.Matrix[0]),d.TranslationToRef(0,0,b,t.Matrix[1]),t.Matrix[0].multiplyToRef(t.Matrix[1],t.Matrix[0]),d.OrthoOffCenterLHToRef(z,u,Y,H,E,J,L,D),t.Matrix[0].multiplyToRef(L,L),L}static OrthoOffCenterRH(z,u,Y,H,E,J,l){const T=new d;return d.OrthoOffCenterRHToRef(z,u,Y,H,E,J,T,l),T}static OrthoOffCenterRHToRef(z,u,Y,H,E,J,l,T){return d.OrthoOffCenterLHToRef(z,u,Y,H,E,J,l,T),l.NM[10]*=-1,l}static ObliqueOffCenterRHToRef(z,u,Y,H,E,J,l,T,b,L,D){const g=l*Math.cos(T),M=l*Math.sin(T);return d.TranslationToRef(0,0,b,t.Matrix[1]),d.FromValuesToRef(1,0,0,0,0,1,0,0,g,M,1,0,0,0,0,1,t.Matrix[0]),t.Matrix[1].multiplyToRef(t.Matrix[0],t.Matrix[0]),d.TranslationToRef(0,0,-b,t.Matrix[1]),t.Matrix[0].multiplyToRef(t.Matrix[1],t.Matrix[0]),d.OrthoOffCenterRHToRef(z,u,Y,H,E,J,L,D),t.Matrix[0].multiplyToRef(L,L),L}static PerspectiveLH(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=new d,T=2*Y/z,b=2*Y/u,L=(H+Y)/(H-Y),D=-2*H*Y/(H-Y),g=Math.tan(J);return d.FromValuesToRef(T,0,0,0,0,b,0,g,0,0,L,1,0,0,D,0,l),E&&l.multiplyToRef(Z,l),l._updateIdentityStatus(!1),l}static PerspectiveFovLH(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const T=new d;return d.PerspectiveFovLHToRef(z,u,Y,H,T,!0,E,J,l),T}static PerspectiveFovLHToRef(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const L=Y,D=H,g=1/Math.tan(.5*z),M=J?g/u:g,q=J?g:g*u,C=b&&0===L?-1:0!==D?(D+L)/(D-L):1,K=b&&0===L?2*D:0!==D?-2*D*L/(D-L):-2*L,h=Math.tan(T);return d.FromValuesToRef(M,0,0,0,0,q,0,h,0,0,C,1,0,0,K,0,E),l&&E.multiplyToRef(Z,E),E._updateIdentityStatus(!1),E}static PerspectiveFovReverseLHToRef(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const b=1/Math.tan(.5*z),L=J?b/u:b,D=J?b:b*u,g=Math.tan(T);return d.FromValuesToRef(L,0,0,0,0,D,0,g,0,0,-Y,1,0,0,1,0,E),l&&E.multiplyToRef(Z,E),E._updateIdentityStatus(!1),E}static PerspectiveFovRH(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const T=new d;return d.PerspectiveFovRHToRef(z,u,Y,H,T,!0,E,J,l),T}static PerspectiveFovRHToRef(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const L=Y,D=H,g=1/Math.tan(.5*z),M=J?g/u:g,q=J?g:g*u,C=b&&0===L?1:0!==D?-(D+L)/(D-L):-1,K=b&&0===L?2*D:0!==D?-2*D*L/(D-L):-2*L,h=Math.tan(T);return d.FromValuesToRef(M,0,0,0,0,q,0,h,0,0,C,-1,0,0,K,0,E),l&&E.multiplyToRef(Z,E),E._updateIdentityStatus(!1),E}static PerspectiveFovReverseRHToRef(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const b=1/Math.tan(.5*z),L=J?b/u:b,D=J?b:b*u,g=Math.tan(T);return d.FromValuesToRef(L,0,0,0,0,D,0,g,0,0,-Y,-1,0,0,-1,0,E),l&&E.multiplyToRef(Z,E),E._updateIdentityStatus(!1),E}static GetFinalMatrix(z,u,Y,H,E,J){const l=z.width,T=z.height,b=z.x,L=z.y,D=d.FromValues(l/2,0,0,0,0,-T/2,0,0,0,0,J-E,0,b+l/2,T/2+L,E,1),g=new d;return u.multiplyToRef(Y,g),g.multiplyToRef(H,g),g.multiplyToRef(D,g)}static GetAsMatrix2x2(z){const u=z.m,Y=[u[0],u[1],u[4],u[5]];return l.b.MatrixUse64Bits?Y:new Float32Array(Y)}static GetAsMatrix3x3(z){const u=z.m,Y=[u[0],u[1],u[2],u[4],u[5],u[6],u[8],u[9],u[10]];return l.b.MatrixUse64Bits?Y:new Float32Array(Y)}static Transpose(z){const u=new d;return d.TransposeToRef(z,u),u}static TransposeToRef(z,u){const Y=z.m,H=Y[0],E=Y[4],J=Y[8],l=Y[12],T=Y[1],b=Y[5],L=Y[9],D=Y[13],g=Y[2],M=Y[6],q=Y[10],C=Y[14],K=Y[3],h=Y[7],o=Y[11],d=Y[15],t=u.NM;return t[0]=H,t[1]=E,t[2]=J,t[3]=l,t[4]=T,t[5]=b,t[6]=L,t[7]=D,t[8]=g,t[9]=M,t[10]=q,t[11]=C,t[12]=K,t[13]=h,t[14]=o,t[15]=d,u.markAsUpdated(),u._updateIdentityStatus(z._isIdentity,z._isIdentityDirty),u}static Reflection(z){const u=new d;return d.ReflectionToRef(z,u),u}static ReflectionToRef(z,u){z.normalize();const Y=z.wl.x,H=z.wl.y,E=z.wl.z,J=-2*Y,l=-2*H,T=-2*E;return d.FromValuesToRef(J*Y+1,l*Y,T*Y,0,J*H,l*H+1,T*H,0,J*E,l*E,T*E+1,0,J*z.d,l*z.d,T*z.d,1,u),u}static FromXYZAxesToRef(z,u,Y,H){return d.FromValuesToRef(z._x,z._y,z._z,0,u._x,u._y,u._z,0,Y._x,Y._y,Y._z,0,0,0,0,1,H),H}static FromQuaternionToRef(z,u){const Y=z._x*z._x,H=z._y*z._y,E=z._z*z._z,J=z._x*z._y,l=z._z*z._w,T=z._z*z._x,b=z._y*z._w,L=z._y*z._z,D=z._x*z._w;return u.NM[0]=1-2*(H+E),u.NM[1]=2*(J+l),u.NM[2]=2*(T-b),u.NM[3]=0,u.NM[4]=2*(J-l),u.NM[5]=1-2*(E+Y),u.NM[6]=2*(L+D),u.NM[7]=0,u.NM[8]=2*(T+b),u.NM[9]=2*(L-D),u.NM[10]=1-2*(H+Y),u.NM[11]=0,u.NM[12]=0,u.NM[13]=0,u.NM[14]=0,u.NM[15]=1,u.markAsUpdated(),u}}d._IdentityReadOnly=d.Identity(),Object.defineProperties(d.prototype,{dimension:{value:[4,4]},rank:{value:2}});class t{}t.Pl=(0,E.f)(11,K.Zero),t.Matrix=(0,E.f)(2,d.Identity),t.Quaternion=(0,E.f)(3,o.Zero);class W{}W.Vector2=(0,E.f)(3,C.Zero),W.Pl=(0,E.f)(13,K.Zero),W.Vector4=(0,E.f)(3,h.Zero),W.Quaternion=(0,E.f)(3,o.Zero),W.Matrix=(0,E.f)(8,d.Identity),(0,J.d)("BABYLON.Vector2",C),(0,J.d)("BABYLON.Vector3",K),(0,J.d)("BABYLON.Vector4",h),(0,J.d)("BABYLON.Matrix",d);const Z=d.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11285:(z,u,Y)=>{Y.d(u,{c:()=>H});class H{constructor(z,u,Y,H){this.x=z,this.y=u,this.width=Y,this.height=H}toGlobal(z,u){return new H(this.x*z,this.y*u,this.width*z,this.height*u)}toGlobalToRef(z,u,Y){return Y.x=this.x*z,Y.y=this.y*u,Y.width=this.width*z,Y.height=this.height*u,this}clone(){return new H(this.x,this.y,this.width,this.height)}}},11378:(z,u,Y)=>{Y.d(u,{d:()=>L,h:()=>D});var H=Y(10903),E=Y(11386);const J=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],l=[()=>1,z=>z.y,z=>z.z,z=>z.x,z=>z.x*z.y,z=>z.y*z.z,z=>3*z.z*z.z-1,z=>z.x*z.z,z=>z.x*z.x-z.y*z.y],T=(z,u)=>J[z]*l[z](u),b=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class L{constructor(){this.preScaled=!1,this.l00=H.p.Zero(),this.l1_1=H.p.Zero(),this.l10=H.p.Zero(),this.l11=H.p.Zero(),this.l2_2=H.p.Zero(),this.l2_1=H.p.Zero(),this.l20=H.p.Zero(),this.l21=H.p.Zero(),this.l22=H.p.Zero()}addLight(z,u,Y){E.h.Pl[0].set(u.r,u.g,u.b);const H=E.h.Pl[0],J=E.h.Pl[1];H.scaleToRef(Y,J),J.scaleToRef(T(0,z),E.h.Pl[2]),this.l00.addInPlace(E.h.Pl[2]),J.scaleToRef(T(1,z),E.h.Pl[2]),this.l1_1.addInPlace(E.h.Pl[2]),J.scaleToRef(T(2,z),E.h.Pl[2]),this.l10.addInPlace(E.h.Pl[2]),J.scaleToRef(T(3,z),E.h.Pl[2]),this.l11.addInPlace(E.h.Pl[2]),J.scaleToRef(T(4,z),E.h.Pl[2]),this.l2_2.addInPlace(E.h.Pl[2]),J.scaleToRef(T(5,z),E.h.Pl[2]),this.l2_1.addInPlace(E.h.Pl[2]),J.scaleToRef(T(6,z),E.h.Pl[2]),this.l20.addInPlace(E.h.Pl[2]),J.scaleToRef(T(7,z),E.h.Pl[2]),this.l21.addInPlace(E.h.Pl[2]),J.scaleToRef(T(8,z),E.h.Pl[2]),this.l22.addInPlace(E.h.Pl[2])}scaleInPlace(z){this.l00.scaleInPlace(z),this.l1_1.scaleInPlace(z),this.l10.scaleInPlace(z),this.l11.scaleInPlace(z),this.l2_2.scaleInPlace(z),this.l2_1.scaleInPlace(z),this.l20.scaleInPlace(z),this.l21.scaleInPlace(z),this.l22.scaleInPlace(z)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(b[0]),this.l1_1.scaleInPlace(b[1]),this.l10.scaleInPlace(b[2]),this.l11.scaleInPlace(b[3]),this.l2_2.scaleInPlace(b[4]),this.l2_1.scaleInPlace(b[5]),this.l20.scaleInPlace(b[6]),this.l21.scaleInPlace(b[7]),this.l22.scaleInPlace(b[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(J[0]),this.l1_1.scaleInPlace(J[1]),this.l10.scaleInPlace(J[2]),this.l11.scaleInPlace(J[3]),this.l2_2.scaleInPlace(J[4]),this.l2_1.scaleInPlace(J[5]),this.l20.scaleInPlace(J[6]),this.l21.scaleInPlace(J[7]),this.l22.scaleInPlace(J[8])}updateFromArray(z){return H.p.FromArrayToRef(z[0],0,this.l00),H.p.FromArrayToRef(z[1],0,this.l1_1),H.p.FromArrayToRef(z[2],0,this.l10),H.p.FromArrayToRef(z[3],0,this.l11),H.p.FromArrayToRef(z[4],0,this.l2_2),H.p.FromArrayToRef(z[5],0,this.l2_1),H.p.FromArrayToRef(z[6],0,this.l20),H.p.FromArrayToRef(z[7],0,this.l21),H.p.FromArrayToRef(z[8],0,this.l22),this}updateFromFloatsArray(z){return H.p.FromFloatsToRef(z[0],z[1],z[2],this.l00),H.p.FromFloatsToRef(z[3],z[4],z[5],this.l1_1),H.p.FromFloatsToRef(z[6],z[7],z[8],this.l10),H.p.FromFloatsToRef(z[9],z[10],z[11],this.l11),H.p.FromFloatsToRef(z[12],z[13],z[14],this.l2_2),H.p.FromFloatsToRef(z[15],z[16],z[17],this.l2_1),H.p.FromFloatsToRef(z[18],z[19],z[20],this.l20),H.p.FromFloatsToRef(z[21],z[22],z[23],this.l21),H.p.FromFloatsToRef(z[24],z[25],z[26],this.l22),this}static Nl(z){return(new L).updateFromArray(z)}static FromPolynomial(z){const u=new L;return u.l00=z.xx.scale(.376127).add(z.yy.scale(.376127)).add(z.zz.scale(.376126)),u.l1_1=z.y.scale(.977204),u.l10=z.z.scale(.977204),u.l11=z.x.scale(.977204),u.l2_2=z.xy.scale(1.16538),u.l2_1=z.yz.scale(1.16538),u.l20=z.zz.scale(1.34567).JY(z.xx.scale(.672834)).JY(z.yy.scale(.672834)),u.l21=z.zx.scale(1.16538),u.l22=z.xx.scale(1.16538).JY(z.yy.scale(1.16538)),u.l1_1.scaleInPlace(-1),u.l11.scaleInPlace(-1),u.l2_1.scaleInPlace(-1),u.l21.scaleInPlace(-1),u.scaleInPlace(Math.PI),u}}class D{constructor(){this.x=H.p.Zero(),this.y=H.p.Zero(),this.z=H.p.Zero(),this.xx=H.p.Zero(),this.yy=H.p.Zero(),this.zz=H.p.Zero(),this.xy=H.p.Zero(),this.yz=H.p.Zero(),this.zx=H.p.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=L.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(z){E.h.Pl[0].kl(z.r,z.g,z.b);const u=E.h.Pl[0];this.xx.addInPlace(u),this.yy.addInPlace(u),this.zz.addInPlace(u)}scaleInPlace(z){this.x.scaleInPlace(z),this.y.scaleInPlace(z),this.z.scaleInPlace(z),this.xx.scaleInPlace(z),this.yy.scaleInPlace(z),this.zz.scaleInPlace(z),this.yz.scaleInPlace(z),this.zx.scaleInPlace(z),this.xy.scaleInPlace(z)}updateFromHarmonics(z){return this._harmonics=z,this.x.J(z.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.J(z.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.J(z.l10),this.z.scaleInPlace(1.02333),this.xx.J(z.l00),E.h.Pl[0].J(z.l20).scaleInPlace(.247708),E.h.Pl[1].J(z.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).dg(E.h.Pl[0]).addInPlace(E.h.Pl[1]),this.yy.J(z.l00),this.yy.scaleInPlace(.886277).dg(E.h.Pl[0]).dg(E.h.Pl[1]),this.zz.J(z.l00),E.h.Pl[0].J(z.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(E.h.Pl[0]),this.yz.J(z.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.J(z.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.J(z.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(z){return(new D).updateFromHarmonics(z)}static Nl(z){const u=new D;return H.p.FromArrayToRef(z[0],0,u.x),H.p.FromArrayToRef(z[1],0,u.y),H.p.FromArrayToRef(z[2],0,u.z),H.p.FromArrayToRef(z[3],0,u.xx),H.p.FromArrayToRef(z[4],0,u.yy),H.p.FromArrayToRef(z[5],0,u.zz),H.p.FromArrayToRef(z[6],0,u.yz),H.p.FromArrayToRef(z[7],0,u.zx),H.p.FromArrayToRef(z[8],0,u.xy),u}}},11655:(z,u,Y)=>{Y.d(u,{d:()=>o,g:()=>d});var H=Y(10903),E=Y(11188),J=Y(11267),l=Y(11231),T=Y(10953),b=Y(11103),L=Y(11389),D=Y(10906),g=Y(10928);class M extends H.m{constructor(z,u){super(z.x,z.y),this.index=u}}class q{constructor(){this.elements=[]}add(z){const u=[];for(const Y of z){const z=new M(Y,this.elements.length);u.push(z),this.elements.push(z)}return u}computeBounds(){const z=new H.m(this.elements[0].x,this.elements[0].y),u=new H.m(this.elements[0].x,this.elements[0].y);for(const Y of this.elements)Y.x<z.x?z.x=Y.x:Y.x>u.x&&(u.x=Y.x),Y.y<z.y?z.y=Y.y:Y.y>u.y&&(u.y=Y.y);return{min:z,max:u,width:u.x-z.x,height:u.y-z.y}}}class C{_addToepoint(z){for(const u of z)this._epoints.push(u.x,u.y)}constructor(z,u,Y){let H,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new q,this._outlinepoints=new q,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=E,this._name=z,this._scene=Y||g.d.LastCreatedScene,H=u instanceof L.e?u.getPoints():u,this._addToepoint(H),this._points.add(H),this._outlinepoints.add(H),"undefined"===typeof this.bjsEarcut&&T.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(z){this._points.add(z);const u=new q;return u.add(z),this._holes.push(u),this._eholes.push(this._epoints.length/2),this._addToepoint(z),this}build(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const H=new J.b(this._name,this._scene),E=this.buildVertexData(u,Y);return H.Uz(b.f.PositionKind,E.Qz,z),H.Uz(b.f.NormalKind,E.Vz,z),H.Uz(b.f.UVKind,E.xz,z),H.setIndices(E.indices),H}buildVertexData(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Y=new l.e,H=[],E=[],J=[],T=this._points.computeBounds();for(const l of this._points.elements)H.push(0,1,0),E.push(l.x,0,l.y),J.push((l.x-T.min.x)/T.width,(l.y-T.min.y)/T.height);const b=[],L=this.bjsEarcut(this._epoints,this._eholes,2);for(let l=0;l<L.length;l++)b.push(L[l]);if(z>0){const Y=E.length/3;for(const u of this._points.elements)H.push(0,-1,0),E.push(u.x,-z,u.y),J.push(1-(u.x-T.min.x)/T.width,1-(u.y-T.min.y)/T.height);const l=b.length;for(let z=0;z<l;z+=3){const u=b[z+0],H=b[z+1],E=b[z+2];b.push(E+Y),b.push(H+Y),b.push(u+Y)}this._addSide(E,H,J,b,T,this._outlinepoints,z,!1,u);for(const L of this._holes)this._addSide(E,H,J,b,T,L,z,!0,u)}return Y.indices=b,Y.Qz=E,Y.Vz=H,Y.xz=J,Y}_addSide(z,u,Y,E,J,l,T,b,L){let g=z.length/3,M=0;for(let q=0;q<l.elements.length;q++){const C=l.elements[q],K=l.elements[(q+1)%l.elements.length];z.push(C.x,0,C.y),z.push(C.x,-T,C.y),z.push(K.x,0,K.y),z.push(K.x,-T,K.y);const h=l.elements[(q+l.elements.length-1)%l.elements.length],o=l.elements[(q+2)%l.elements.length];let d=new H.p(-(K.y-C.y),0,K.x-C.x),t=new H.p(-(C.y-h.y),0,C.x-h.x),W=new H.p(-(o.y-K.y),0,o.x-K.x);b||(d=d.scale(-1),t=t.scale(-1),W=W.scale(-1));const Z=d.normalizeToNew();let s=t.normalizeToNew(),v=W.normalizeToNew();const i=H.p.Dot(s,Z);s=i>L?i<D.e-1?new H.p(C.x,0,C.y).JY(new H.p(K.x,0,K.y)).normalize():t.add(d).normalize():Z;const X=H.p.Dot(W,d);v=X>L?X<D.e-1?new H.p(K.x,0,K.y).JY(new H.p(C.x,0,C.y)).normalize():W.add(d).normalize():Z,Y.push(M/J.width,0),Y.push(M/J.width,1),M+=d.length(),Y.push(M/J.width,0),Y.push(M/J.width,1),u.push(s.x,s.y,s.z),u.push(s.x,s.y,s.z),u.push(v.x,v.y,v.z),u.push(v.x,v.y,v.z),b?(E.push(g),E.push(g+2),E.push(g+1),E.push(g+1),E.push(g+2),E.push(g+3)):(E.push(g),E.push(g+1),E.push(g+2),E.push(g+1),E.push(g+3),E.push(g+2)),g+=4}}}var K=Y(11309);function h(z,u,Y,J,T,L,D){const g=Y||new Array(3),M=J,q=[],C=D||!1;for(let l=0;l<3;l++)void 0===g[l]&&(g[l]=new H.t(0,0,1,1)),M&&void 0===M[l]&&(M[l]=new E.e(1,1,1,1));const h=z.getVerticesData(b.f.PositionKind),o=z.getVerticesData(b.f.NormalKind),d=z.getVerticesData(b.f.UVKind),t=z.Il(),W=h.length/9;let Z=0,s=0,v=0,i=0,X=0;const Q=[0];if(C)for(let H=W;H<h.length/3;H+=4)s=h[3*(H+2)]-h[3*H],v=h[3*(H+2)+2]-h[3*H+2],i=Math.sqrt(s*s+v*v),X+=i,Q.push(X);let V=0,A=0;for(let H=0;H<o.length;H+=3)Math.abs(o[H+1])<.001&&(A=1),Math.abs(o[H+1]-1)<.001&&(A=0),Math.abs(o[H+1]+1)<.001&&(A=2),V=H/3,1===A?(Z=V-W,d[2*V]=Z%4<1.5?C?g[A].x+(g[A].z-g[A].x)*Q[Math.floor(Z/4)]/X:g[A].x:C?g[A].x+(g[A].z-g[A].x)*Q[Math.floor(Z/4)+1]/X:g[A].z,d[2*V+1]=Z%2===0?K.b?1-g[A].w:g[A].w:K.b?1-g[A].y:g[A].y):(d[2*V]=(1-d[2*V])*g[A].x+d[2*V]*g[A].z,d[2*V+1]=(1-d[2*V+1])*g[A].y+d[2*V+1]*g[A].w,K.b&&(d[2*V+1]=1-d[2*V+1])),M&&q.push(M[A].r,M[A].g,M[A].b,M[A].a);l.e._ComputeSides(u,h,t,o,d,T,L);const x=new l.e;if(x.indices=t,x.Qz=h,x.Vz=o,x.xz=d,M){const z=u===l.e.DOUBLESIDE?q.concat(q):q;x.Az=z}return x}function o(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;u.sideOrientation=J.b._GetDefaultSideOrientation(u.sideOrientation);const l=u.shape,T=u.holes||[],b=u.depth||0,L=u.smoothingThreshold||2,D=[];let M=[];for(let J=0;J<l.length;J++)D[J]=new H.m(l[J].x,l[J].z);D[0].equalsWithEpsilon(D[D.length-1],1e-8)&&D.pop();const q=new C(z,D,Y||g.d.LastCreatedScene,E);for(let J=0;J<T.length;J++){M=[];for(let z=0;z<T[J].length;z++)M.push(new H.m(T[J][z].x,T[J][z].z));q.addHole(M)}const K=q.build(!1,b,L);K._originalBuilderSideOrientation=u.sideOrientation;return h(K,u.sideOrientation,u.faceUV,u.faceColors,u.frontUVs,u.backUVs,u.wrap).Fz(K,u.updatable),K}function d(z,u){return o(z,u,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}l.e.CreatePolygon=h,J.b.CreatePolygon=function(z,u,Y,H,E,J){return o(z,{shape:u,holes:H,updatable:E,sideOrientation:J},Y,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},J.b.ExtrudePolygon=function(z,u,Y,H,E,J,l){return d(z,{shape:u,holes:E,depth:Y,updatable:J,sideOrientation:l},H,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11650:(z,u,Y)=>{Y.d(u,{d:()=>D,h:()=>g});var H=Y(11389),E=Y(10903),J=Y(11267),l=Y(11218),T=Y(11655);class b{constructor(z){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=z}moveTo(z,u){this._currentPath=new H.e(z,u),this._tempPaths.push(this._currentPath)}lineTo(z,u){this._currentPath.addLineTo(z,u)}quadraticCurveTo(z,u,Y,H){this._currentPath.addQuadraticCurveTo(z,u,Y,H,this._resolution)}bezierCurveTo(z,u,Y,H,E,J){this._currentPath.addBezierCurveTo(z,u,Y,H,E,J,this._resolution)}extractHoles(){for(const z of this._tempPaths)z.area()>0?this._holes.push(z):this._paths.push(z);if(!this._paths.length&&this._holes.length){const z=this._holes;this._holes=this._paths,this._paths=z}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function L(z,u,Y,H,E,J){const l=J.glyphs[z]||J.glyphs["?"];if(!l)return null;const T=new b(E);if(l.o){const z=l.o.split(" ");for(let E=0,J=z.length;E<J;){switch(z[E++]){case"m":{const J=parseInt(z[E++])*u+Y,l=parseInt(z[E++])*u+H;T.moveTo(J,l);break}case"l":{const J=parseInt(z[E++])*u+Y,l=parseInt(z[E++])*u+H;T.lineTo(J,l);break}case"q":{const J=parseInt(z[E++])*u+Y,l=parseInt(z[E++])*u+H,b=parseInt(z[E++])*u+Y,L=parseInt(z[E++])*u+H;T.quadraticCurveTo(b,L,J,l);break}case"b":{const J=parseInt(z[E++])*u+Y,l=parseInt(z[E++])*u+H,b=parseInt(z[E++])*u+Y,L=parseInt(z[E++])*u+H,D=parseInt(z[E++])*u+Y,g=parseInt(z[E++])*u+H;T.bezierCurveTo(b,L,D,g,J,l);break}}}}return T.extractHoles(),{offsetX:l.ha*u,shapePath:T}}function D(z,u,Y,H){const E=Array.from(z),J=u/H.resolution,l=(H.boundingBox.yMax-H.boundingBox.yMin+H.underlineThickness)*J,T=[];let b=0,D=0;for(let g=0;g<E.length;g++){const z=E[g];if("\n"===z)b=0,D-=l;else{const u=L(z,J,b,D,Y,H);u&&(b+=u.offsetX,T.push(u.shapePath))}}return T}function g(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const g=D(u,H.size||50,H.resolution||8,Y),M=[];let q=0;for(const l of g){if(!l.paths.length)continue;const u=l.holes.slice();for(const Y of l.paths){var C,K;const l=[],D=[],g=Y.getPoints();for(const z of g)D.push(new E.p(z.x,0,z.y));const h=u.slice();for(const z of h){const H=z.getPoints();let J=!1;for(const z of H)if(Y.isPointInside(z)){J=!0;break}if(!J)continue;const T=[];for(const z of H)T.push(new E.p(z.x,0,z.y));l.push(T),u.splice(u.indexOf(z),1)}if(!l.length&&u.length)for(const z of u){const u=z.getPoints(),Y=[];for(const z of u)Y.push(new E.p(z.x,0,z.y));l.push(Y)}const o=(0,T.g)(z,{shape:D,holes:l.length?l:void 0,depth:H.depth||1,faceUV:H.faceUV||(null===(C=H.perLetterFaceUV)||void 0===C?void 0:C.call(H,q)),faceColors:H.faceColors||(null===(K=H.perLetterFaceColors)||void 0===K?void 0:K.call(H,q)),sideOrientation:J.b._GetDefaultSideOrientation(H.sideOrientation||J.b.DOUBLESIDE)},b,L);M.push(o),q++}}const h=J.b.MergeMeshes(M,!0,!0);if(h){const u=h.getBoundingInfo().boundingBox;h.position.x+=-(u.minimumWorld.x+u.maximumWorld.x)/2,h.position.y+=-(u.minimumWorld.y+u.maximumWorld.y)/2,h.position.z+=-(u.minimumWorld.z+u.maximumWorld.z)/2+u.extendSize.z,h.name=z;const Y=new l.d("pivot",b);Y.rotation.x=-Math.PI/2,h.parent=Y,h.bakeCurrentTransformIntoVertices(),h.parent=null,Y.dispose()}return h}},11662:(z,u,Y)=>{Y.d(u,{b:()=>b,e:()=>l,i:()=>T});var H=Y(10945),E=Y(11667),J=Y(11672);function l(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function T(z){return!!(z.wasmUrl&&(z.wasmBinary||z.wasmBinaryUrl)&&"object"===typeof WebAssembly||z.fallbackUrl)}class b{constructor(z){if(z.workerPool)return void(this._workerPoolPromise=Promise.resolve(z.workerPool));const u=z.wasmBinary,Y=z.numWorkers??l(),T=Y&&"function"===typeof Worker&&"function"===typeof URL,b=T||!z.jsModule,L=z.wasmUrl&&z.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:b?H.e.GetBabylonScriptURL(z.wasmUrl,!0):"",wasmBinaryPromise:u?Promise.resolve(u):H.e.LoadFileAsync(H.e.GetBabylonScriptURL(z.wasmBinaryUrl,!0))}:{url:b?H.e.GetBabylonScriptURL(z.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};T?this._workerPoolPromise=L.wasmBinaryPromise.then((z=>{const u=this._getWorkerContent(),H=URL.createObjectURL(new Blob([u],{type:"application/javascript"}));return new E.c(Y,(()=>{const u=new Worker(H);return(0,J.q)(u,z,L.url)}))})):this._modulePromise=L.wasmBinaryPromise.then((async u=>{if(!this._isModuleAvailable()&&!z.jsModule){if(!L.url)throw new Error("Draco codec module is not available");await H.e.LoadBabylonScriptAsync(L.url)}return await this._createModuleAsync(u,z.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((z=>{z.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11672:(z,u,Y)=>{function H(z,u,Y,H){const E=z;let J=null,l=null,T=null,b=null;const L={},D=u.find((z=>"POSITION"===z.dracoName));if(!D)throw new Error("Position attribute is required for Draco encoding");if(!Y){const z=D.data.length/D.size;Y=new(z>65535?Uint32Array:Uint16Array)(z);for(let u=0;u<z;u++)Y[u]=u}try{J=new E.Encoder,l=new E.MeshBuilder,T=new E.Mesh,l.AddFacesToMesh(T,Y.length/3,Y);const z=new Map([[Float32Array,(z,u,Y,H,E,J)=>z.AddFloatAttribute(u,Y,H,E,J)],[Uint32Array,(z,u,Y,H,E,J)=>z.AddUInt32Attribute(u,Y,H,E,J)],[Uint16Array,(z,u,Y,H,E,J)=>z.AddUInt16Attribute(u,Y,H,E,J)],[Uint8Array,(z,u,Y,H,E,J)=>z.AddUInt8Attribute(u,Y,H,E,J)],[Int32Array,(z,u,Y,H,E,J)=>z.AddInt32Attribute(u,Y,H,E,J)],[Int16Array,(z,u,Y,H,E,J)=>z.AddInt16Attribute(u,Y,H,E,J)],[Int8Array,(z,u,Y,H,E,J)=>z.AddInt8Attribute(u,Y,H,E,J)]]);for(const Y of u){Y.data instanceof Uint8ClampedArray&&(Y.data=new Uint8Array(Y.data));const u=z.get(Y.data.constructor),b=Y.data.length/Y.size;L[Y.kind]=u(l,T,E[Y.dracoName],b,Y.size,Y.data),H.quantizationBits&&H.quantizationBits[Y.dracoName]&&J.SetAttributeQuantization(E[Y.dracoName],H.quantizationBits[Y.dracoName])}H.method&&J.SetEncodingMethod(E[H.method]),void 0!==H.encodeSpeed&&void 0!==H.decodeSpeed&&J.SetSpeedOptions(H.encodeSpeed,H.decodeSpeed),b=new E.DracoInt8Array;const D=J.EncodeMeshToDracoBuffer(T,b);if(D<=0)throw new Error("Draco encoding failed.");const g=new Int8Array(D);for(let u=0;u<D;u++)g[u]=b.GetValue(u);return{data:g,attributeIds:L}}finally{T&&E.destroy(T),l&&E.destroy(l),J&&E.destroy(J),b&&E.destroy(b)}}function E(){let z;onmessage=u=>{const Y=u.data;switch(Y.id){case"init":{Y.url&&importScripts(Y.url);const u=Y.wasmBinary?{wasmBinary:Y.wasmBinary}:{};z=DracoEncoderModule(u),postMessage({id:"initDone"});break}case"encodeMesh":if(!z)throw new Error("Draco encoder module is not available");z.then((z=>{const u=H(z,Y.attributes,Y.indices,Y.options);postMessage({id:"encodeMeshDone",encodedMeshData:u},u?[u.data.buffer]:void 0)}))}}}function J(z,u,Y,H,E){const J=z;let l=null,T=null,b=null;try{let z;l=new J.Decoder,T=new J.DecoderBuffer,T.Init(u,u.byteLength);const L=l.GetEncodedGeometryType(T);switch(L){case J.TRIANGULAR_MESH:{const u=new J.Mesh;if(z=l.DecodeBufferToMesh(T,u),!z.ok()||0===u.ptr)throw new Error(z.error_msg());const Y=3*u.num_faces(),E=4*Y,L=J._malloc(E);try{l.GetTrianglesUInt32Array(u,E,L);const z=new Uint32Array(Y);z.set(new Uint32Array(J.HEAPF32.buffer,L,Y)),H(z)}finally{J._free(L)}b=u;break}case J.POINT_CLOUD:{const u=new J.PointCloud;if(z=l.DecodeBufferToPointCloud(T,u),!z.ok()||!u.ptr)throw new Error(z.error_msg());b=u;break}default:throw new Error(`Invalid geometry type ${L}`)}const D=b.num_points(),g=(z,u,Y,H)=>{const l=H.data_type(),T=H.num_components(),b=H.normalized(),L=H.byte_stride(),g=H.byte_offset(),M={[J.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:J.HEAPF32},[J.DT_INT8]:{typedArrayConstructor:Int8Array,heap:J.HEAP8},[J.DT_INT16]:{typedArrayConstructor:Int16Array,heap:J.HEAP16},[J.DT_INT32]:{typedArrayConstructor:Int32Array,heap:J.HEAP32},[J.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:J.HEAPU8},[J.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:J.HEAPU16},[J.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:J.HEAPU32}}[l];if(!M)throw new Error(`Invalid data type ${l}`);const q=D*T,C=q*M.typedArrayConstructor.BYTES_PER_ELEMENT,K=J._malloc(C);try{z.GetAttributeDataArrayForAllPoints(u,H,l,C,K);const J=new M.typedArrayConstructor(M.heap.buffer,K,q);E(Y,J.slice(),T,g,L,b)}finally{J._free(K)}};if(Y)for(const u in Y){const z=Y[u],H=l.GetAttributeByUniqueId(b,z);g(l,b,u,H)}else{const z={position:J.POSITION,wl:J.NORMAL,color:J.COLOR,uv:J.TEX_COORD};for(const u in z){const Y=l.GetAttributeId(b,z[u]);if(-1!==Y){const z=l.GetAttribute(b,Y);g(l,b,u,z)}}}return D}finally{b&&J.destroy(b),T&&J.destroy(T),l&&J.destroy(l)}}function l(){let z;onmessage=u=>{const Y=u.data;switch(Y.id){case"init":{Y.url&&importScripts(Y.url);const u=Y.wasmBinary?{wasmBinary:Y.wasmBinary}:{};z=DracoDecoderModule(u),postMessage({id:"initDone"});break}case"decodeMesh":if(!z)throw new Error("Draco decoder module is not available");z.then((z=>{const u=J(z,Y.dataView,Y.attributes,(z=>{postMessage({id:"indices",data:z},[z.buffer])}),((z,u,Y,H,E,J)=>{postMessage({id:"attribute",kind:z,data:u,size:Y,byteOffset:H,byteStride:E,normalized:J},[u.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:u})}))}}}async function T(z,u,Y){return await new Promise(((H,E)=>{const J=u=>{z.removeEventListener("error",J),z.removeEventListener("message",l),E(u)},l=u=>{"initDone"===u.data.id&&(z.removeEventListener("error",J),z.removeEventListener("message",l),H(z))};if(z.addEventListener("error",J),z.addEventListener("message",l),u){const H=u.slice(0);z.postMessage({id:"init",url:Y,wasmBinary:H},[H])}else z.postMessage({id:"init",url:Y})}))}Y.d(u,{b:()=>J,f:()=>l,j:()=>H,n:()=>E,q:()=>T})},11346:(z,u,Y)=>{Y.d(u,{e:()=>E});var H=Y(11110);class E extends H.e{constructor(z){super(),this._buffer=z}get underlyingResource(){return this._buffer}}},11229:(z,u,Y)=>{Y.d(u,{b:()=>v});var H=Y(11079),E=Y(10932),J=Y(10903),l=Y(11103),T=Y(11231),b=Y(11218),L=Y(11248),D=Y(11131),g=Y(11163);class M{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new J.p(0,0,0),this._diffPositionForCollisions=new J.p(0,0,0),this._collisionResponse=!0}}var q=Y(10970),C=Y(11148),K=Y(11188),h=Y(10906),o=Y(11256),d=Y(10918),t=Y(11082),W=Y(11018);class Z{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=J.p.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class s{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Z,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new M,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class v extends b.d{static get BILLBOARDMODE_NONE(){return b.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return b.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return b.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return b.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return b.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return b.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(z){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=z}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(z){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=z}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(z){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=z}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(z){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=z}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(z){this._internalAbstractMeshDataInfo._collisionRetryCount=z}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(z){this._internalAbstractMeshDataInfo._morphTargetManager!==z&&(this._internalAbstractMeshDataInfo._morphTargetManager=z,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(z){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==z&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=z,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(z){return!!super._updateNonUniformScalingState(z)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(z){this._internalAbstractMeshDataInfo._rawBoundingInfo=z}set yq(z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(z)}set onCollisionPositionChange(z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(z)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(z){if(this._internalAbstractMeshDataInfo._visibility===z)return;const u=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=z,(1===u&&1!==z||1!==u&&1===z)&&this._markSubMeshesAsDirty((z=>{z.markAsMiscDirty(),z.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(z){this._internalAbstractMeshDataInfo._inheritVisibility=z}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let z=this._parentNode;for(;z;){const u=z.isVisible;if("undefined"!==typeof u)return u;z=z.parent}}return this._isVisible}set isVisible(z){this._isVisible=z}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(z){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=z}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(z){this._internalAbstractMeshDataInfo._renderingGroupId=z}get material(){return this._internalAbstractMeshDataInfo._material}set material(z){this._setMaterial(z)}_setMaterial(z){this._internalAbstractMeshDataInfo._material!==z&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=z,z&&z.meshMap&&(z.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.YT&&(this.resetDrawCache(void 0,null==z),this._unBindEffect()))}getMaterialForRenderPass(z){var u;return null===(u=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===u?void 0:u[z]}setMaterialForRenderPass(z,u){var Y;this.resetDrawCache(z),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const H=this._internalAbstractMeshDataInfo._materialForRenderPass[z];null!==H&&void 0!==H&&null!==(Y=H.meshMap)&&void 0!==Y&&Y[this.uniqueId]&&(H.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[z]=u,u&&u.meshMap&&(u.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(z){this._internalAbstractMeshDataInfo._receiveShadows!==z&&(this._internalAbstractMeshDataInfo._receiveShadows=z,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(z){this._internalAbstractMeshDataInfo._hasVertexAlpha!==z&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=z,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(z){this._internalAbstractMeshDataInfo._useVertexColors!==z&&(this._internalAbstractMeshDataInfo._useVertexColors=z,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==z&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=z,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(z){this._internalAbstractMeshDataInfo._numBoneInfluencers!==z&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=z,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(z){this._internalAbstractMeshDataInfo._applyFog!==z&&(this._internalAbstractMeshDataInfo._applyFog=z,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(z){this._internalAbstractMeshDataInfo._enableDistantPicking=z}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(z){z!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=z,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(z)?-1:z}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=z}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(z)?-1:z}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(z){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=z}get lightSources(){return this._lightSources}set skeleton(z){const u=this._internalAbstractMeshDataInfo._skeleton;u&&u.needInitialSkinMatrix&&u._unregisterMeshWithPoseMatrix(this),z&&z.needInitialSkinMatrix&&z._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=z,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(z){var u;let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(z,Y,!1),u=this,this._internalAbstractMeshDataInfo=new s,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Og=v.ng,this.onCollideObservable=new E.e,this.onCollisionPositionChangeObservable=new E.e,this.onMaterialChangedObservable=new E.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.YL=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=K.c.Red(),this.outlineWidth=.02,this.overlayColor=K.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.qT=!1,this.Rz=!1,this.actionManager=null,this.ellipsoid=new J.p(.5,1,.5),this.ellipsoidOffset=new J.p(0,0,0),this.edgesWidth=1,this.edgesColor=new K.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,MT:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new E.e,this._onCollisionPositionChange=function(z,Y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.subtractToRef(u._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,u._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),u._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>W.e.CollisionsEpsilon&&u.position.addInPlace(u._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),H&&u.onCollideObservable.notifyObservers(H),u.onCollisionPositionChangeObservable.notifyObservers(u.position)},Y=this.iz(),Y.CD(this),this._resyncLightSources(),this._uniformBuffer=new g.b(this.iz().getEngine(),void 0,void 0,z,!this.iz().getEngine().isWebGPU),this._buildUniformLayout(),Y.performancePriority){case 2:this.Rz=!0;case 1:this.qT=!0,this.YL=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(z){const u=this._uniformBuffer;u.rl("world",z),u.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),u.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(z){let u="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");u+=", # of submeshes: "+(this.YT?this.YT.length:0);const Y=this._internalAbstractMeshDataInfo._skeleton;return Y&&(u+=", skeleton: "+Y.name),z&&(u+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],u+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.MT?"YES":"NO")),u}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==b.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(u||this.actionManager.isRecursive)){if(!z)return this.actionManager;if(this.actionManager.hasSpecificTrigger(z))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(z,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.YT){for(const z of this.YT)z._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const z of this.iz().lights)z.isEnabled()&&z.canAffectMesh(this)&&this._lightSources.push(z);this._markSubMeshesAsLightDirty()}_resyncLightSource(z){const u=z.isEnabled()&&z.canAffectMesh(this),Y=this._lightSources.indexOf(z);let H=!1;if(-1===Y){if(!u)return;this._lightSources.push(z)}else{if(u)return;H=!0,this._lightSources.splice(Y,1)}this._markSubMeshesAsLightDirty(H)}_unBindEffect(){for(const z of this.YT)z.setEffect(null)}_removeLightSource(z,u){const Y=this._lightSources.indexOf(z);-1!==Y&&(this._lightSources.splice(Y,1),this._markSubMeshesAsLightDirty(u))}_markSubMeshesAsDirty(z){if(this.YT)for(const u of this.YT)for(let Y=0;Y<u._drawWrappers.length;++Y){const H=u._drawWrappers[Y];H&&H.defines&&H.defines.markAllAsDirty&&z(H.defines)}}_markSubMeshesAsLightDirty(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((u=>u.markAsLightDirty(z)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((z=>z.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((z=>z.markAsMiscDirty()))}uD(z){return this._currentRenderId=Number.MAX_VALUE,super.uD(z),this._isDirty=!0,this}resetDrawCache(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.YT)for(const Y of this.YT)Y.resetDrawCache(z,u)}get isBlocked(){return!1}getLOD(z){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Il(){return null}getVerticesData(z){return null}Uz(z,u,Y,H){return this}updateVerticesData(z,u,Y,H){return this}setIndices(z,u){return this}isVerticesDataPresent(z){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.wz()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(z){return this._boundingInfo=z,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(z,u,Y){return this._boundingInfo=new D.e(z,u,Y),this._boundingInfo}normalizeToUnitCube(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(z,u,Y)}get useBones(){return this.skeleton&&this.iz().skeletonsEnabled&&this.isVerticesDataPresent(l.f.MatricesIndicesKind)&&this.isVerticesDataPresent(l.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(z){}_activate(z,u){return this._renderId=z,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===b.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(z,u,Y){return this.position.addInPlace(this.calcMovePOV(z,u,Y)),this}calcMovePOV(z,u,Y){const H=new J.b;(this.rotationQuaternion?this.rotationQuaternion:J.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(H);const E=J.p.Zero(),l=this.definedFacingForward?-1:1;return J.p.TransformCoordinatesFromFloatsToRef(z*l,u,Y*l,H,E),E}rotatePOV(z,u,Y){return this.rotation.addInPlace(this.calcRotatePOV(z,u,Y)),this}calcRotatePOV(z,u,Y){const H=this.definedFacingForward?1:-1;return new J.p(z*H,u,Y*H)}cz(z,u){if(z){const Y=(0,C.i)(z,0,this.getTotalVertices(),u);this._boundingInfo?this._boundingInfo.reConstruct(Y.minimum,Y.maximum):this._boundingInfo=new D.e(Y.minimum,Y.maximum)}if(this.YT)for(let Y=0;Y<this.YT.length;Y++)this.YT[Y].refreshBoundingInfo(z);this.wz()}_refreshBoundingInfoDirect(z){if(this._boundingInfo?this._boundingInfo.reConstruct(z.minimum,z.maximum):this._boundingInfo=new D.e(z.minimum,z.maximum),this.YT)for(let u=0;u<this.YT.length;u++)this.YT[u].refreshBoundingInfo(null);this.wz()}static _ApplySkeleton(z,u,Y,H,E,T,b){!function(z,u,Y,H,E,T,b){const L=J.i.Pl[0],D=J.i.Matrix[0],g=J.i.Matrix[1],M=u===l.f.NormalKind?J.p.TransformNormalFromFloatsToRef:J.p.TransformCoordinatesFromFloatsToRef;for(let l=0,q=0;l<z.length;l+=3,q+=4){let u,C;for(D.reset(),u=0;u<4;u++)C=E[q+u],C>0&&(J.b.FromFloat32ArrayToRefScaled(Y,Math.floor(16*H[q+u]),C,g),D.addToSelf(g));if(T&&b)for(u=0;u<4;u++)C=b[q+u],C>0&&(J.b.FromFloat32ArrayToRefScaled(Y,Math.floor(16*T[q+u]),C,g),D.addToSelf(g));M(z[l],z[l+1],z[l+2],D,L),L.toArray(z,l)}}(z,u,Y,H,E,T,b)}_getData(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.f.PositionKind;const H=z.cache,E=z=>{if(H){const u=H._vertexData||(H._vertexData={});return u[z]||this.copyVerticesData(z,u),u[z]}return this.getVerticesData(z)};if(u||(u=E(Y)),!u)return null;if(H?(H._outputData?H._outputData.set(u):H._outputData=new Float32Array(u),u=H._outputData):(z.applyMorph&&this.morphTargetManager||z.applySkeleton&&this.skeleton)&&(u=u.slice()),z.applyMorph&&this.morphTargetManager&&function(z,u,Y){let H=null;switch(u){case l.f.PositionKind:H=z=>z.getPositions();break;case l.f.NormalKind:H=z=>z.getNormals();break;case l.f.TangentKind:H=z=>z.getTangents();break;case l.f.UVKind:H=z=>z.getUVs();break;case l.f.UV2Kind:H=z=>z.getUV2s();break;case l.f.ColorKind:H=z=>z.getColors();break;default:return}for(let E=0;E<z.length;E++){let u=z[E];for(let J=0;J<Y.numTargets;J++){const l=Y.getTarget(J),T=l.influence;if(0!==T){const Y=H(l);Y&&(u+=(Y[E]-z[E])*T)}}z[E]=u}}(u,Y,this.morphTargetManager),z.applySkeleton&&this.skeleton){const z=E(l.f.MatricesIndicesKind),H=E(l.f.MatricesWeightsKind);if(H&&z){const J=this.numBoneInfluencers>4,T=J?E(l.f.MatricesIndicesExtraKind):null,b=J?E(l.f.MatricesWeightsExtraKind):null,L=this.skeleton.getTransformMatrices(this);v._ApplySkeleton(u,Y,L,z,H,T,b)}}if(!1!==z.updatePositionsArray&&Y===l.f.PositionKind){const z=this._internalAbstractMeshDataInfo._positions||[],Y=z.length;if(z.length=u.length/3,Y<z.length)for(let u=Y;u<z.length;u++)z[u]=new J.p;for(let H=0,E=0;H<z.length;H++,E+=3)z[H].kl(u[E],u[E+1],u[E+2]);this._internalAbstractMeshDataInfo._positions=z}return u}getNormalsData(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:z,applyMorph:u,updatePositionsArray:!1},null,l.f.NormalKind)}tT(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:z,applyMorph:u,updatePositionsArray:!1},Y,l.f.PositionKind)}wz(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new D.e(J.p.Zero(),J.p.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(z){if(!this.YT)return this;const u=this.YT.length;for(let Y=0;Y<u;Y++){const H=this.YT[Y];(u>1||!H.IsGlobal)&&H.updateBoundingInfo(z)}return this}_afterComputeWorldMatrix(){this.Rz||(this._boundingInfoIsDirty=!0)}isInFrustum(z){return this.getBoundingInfo().isInFrustum(z,this.Og)}isCompletelyInFrustum(z){return this.getBoundingInfo().isCompletelyInFrustum(z)}intersectsMesh(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;const H=this.getBoundingInfo(),E=z.getBoundingInfo();if(H.intersects(E,u))return!0;if(Y)for(const J of this.getChildMeshes())if(J.intersectsMesh(z,u,!0))return!0;return!1}intersectsPoint(z){return this.getBoundingInfo().intersectsPoint(z)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(z){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=z}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const Y=this.iz().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=Y.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,Y.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,z,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,u),this}_collideForSubMesh(z,u,Y){var H;if(this._generatePointsArray(),!this._positions)return this;if(!z._lastColliderWorldVertices||!z._lastColliderTransformMatrix.equals(u)){z._lastColliderTransformMatrix=u.clone(),z._lastColliderWorldVertices=[],z._trianglePlanes=[];const Y=z.verticesStart,H=z.verticesStart+z.verticesCount;for(let E=Y;E<H;E++)z._lastColliderWorldVertices.push(J.p.TransformCoordinates(this._positions[E],u))}return Y._collide(z._trianglePlanes,z._lastColliderWorldVertices,this.Il(),z.indexStart,z.indexStart+z.indexCount,z.verticesStart,!!z.Oz(),this,this._shouldConvertRHS(),7===(null===(H=z.Oz())||void 0===H?void 0:H.fillMode)),this}_processCollisionsForSubMeshes(z,u){const Y=this._scene.getCollidingSubMeshCandidates(this,z),H=Y.length;for(let E=0;E<H;E++){const J=Y.data[E];H>1&&!J._checkCollision(z)||this._collideForSubMesh(J,u,z)}return this}_shouldConvertRHS(){return!1}_checkCollision(z){if(!this.getBoundingInfo()._checkCollision(z))return this;const u=J.i.Matrix[0],Y=J.i.Matrix[1];return J.b.ScalingToRef(1/z._radius.x,1/z._radius.y,1/z._radius.z,u),this.worldMatrixFromCache.multiplyToRef(u,Y),this._processCollisionsForSubMeshes(z,Y),this}_generatePointsArray(){return!1}intersects(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=new L.e,b=this.getClassName(),D="InstancedLinesMesh"===b||"LinesMesh"===b||"GreasedLineMesh"===b?this.intersectionThreshold:0,g=this.getBoundingInfo();if(!this.YT)return T;if(!l&&(!z.intersectsSphere(g.boundingSphere,D)||!z.intersectsBox(g.boundingBox,D)))return T;if(H)return T.hit=!l,T.pickedMesh=l?null:this,T.distance=l?0:J.p.Distance(z.origin,g.boundingSphere.center),T.subMeshId=0,T;if(!this._generatePointsArray())return T;let M=null;const q=this._scene.getIntersectingSubMeshCandidates(this,z),C=q.length;let K=!1;for(let J=0;J<C;J++){const z=q.data[J].Oz();if(z&&(7==z.fillMode||0==z.fillMode||1==z.fillMode||2==z.fillMode||4==z.fillMode)){K=!0;break}}if(!K)return T.hit=!0,T.pickedMesh=this,T.distance=J.p.Distance(z.origin,g.boundingSphere.center),T.subMeshId=-1,T;for(let J=0;J<C;J++){const H=q.data[J];if(C>1&&!l&&!H.canIntersects(z))continue;const E=H.intersects(z,this._positions,this.Il(),u,Y);if(E&&(u||!M||E.distance<M.distance)&&(M=E,M.subMeshId=J,u))break}if(M){const u=E??this.getWorldMatrix(),Y=J.i.Pl[0],H=J.i.Pl[1];J.p.TransformCoordinatesToRef(z.origin,u,Y),z.direction.scaleToRef(M.distance,H);const l=J.p.TransformNormal(H,u).addInPlace(Y);return T.hit=!0,T.distance=J.p.Distance(Y,l),T.pickedPoint=l,T.pickedMesh=this,T.bu=M.bu||0,T.bv=M.bv||0,T.subMeshFaceId=M.faceId,T.faceId=M.faceId+q.data[M.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),T.subMeshId=M.subMeshId,T}return T}clone(z,u,Y){return null}releaseSubMeshes(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.YT)for(;this.YT.length;)this.YT[0].dispose(z);else this.YT=[];return this}dispose(z){let u,Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const H=this.iz();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),H.freeActiveMeshes(),H.freeRenderingGroups(),H.renderingManager.maintainStateBetweenFrames&&H.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((z=>z!==this&&z.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),u=0;u<this._intersectionsInProgress.length;u++){const z=this._intersectionsInProgress[u],Y=z._intersectionsInProgress.indexOf(this);z._intersectionsInProgress.splice(Y,1)}this._intersectionsInProgress.length=0;const E=H.lights;for(const l of E){let z=l.includedOnlyMeshes.indexOf(this);-1!==z&&l.includedOnlyMeshes.splice(z,1),z=l.excludedMeshes.indexOf(this),-1!==z&&l.excludedMeshes.splice(z,1);const u=l.getShadowGenerators();if(u){const Y=u.values();for(let u=Y.next();!0!==u.done;u=Y.next()){const Y=u.value.getShadowMap();Y&&Y.renderList&&(z=Y.renderList.indexOf(this),-1!==z&&Y.renderList.splice(z,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const J=H.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,J.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),J.wipeCaches(),H.qD(this),this._parentContainer){const z=this._parentContainer.meshes.indexOf(this);z>-1&&this._parentContainer.meshes.splice(z,1),this._parentContainer=null}if(Y&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!z)for(u=0;u<H.QM.length;u++)H.QM[u].k===this&&(H.QM[u].dispose(),u--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(z,Y)}_initFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;z.facetNormals||(z.facetNormals=[]),z.facetPositions||(z.facetPositions=[]),z.facetPartitioning||(z.facetPartitioning=new Array),z.facetNb=this.Il().length/3|0,z.partitioningSubdivisions=z.partitioningSubdivisions?z.partitioningSubdivisions:10,z.partitioningBBoxRatio=z.partitioningBBoxRatio?z.partitioningBBoxRatio:1.01;for(let u=0;u<z.facetNb;u++)z.facetNormals[u]=J.p.Zero(),z.facetPositions[u]=J.p.Zero();return z.facetDataEnabled=!0,this}updateFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;z.facetDataEnabled||this._initFacetData();const u=this.getVerticesData(l.f.PositionKind),Y=this.Il(),H=this.getVerticesData(l.f.NormalKind),E=this.getBoundingInfo();if(z.facetDepthSort&&!z.facetDepthSortEnabled){if(z.facetDepthSortEnabled=!0,Y instanceof Uint16Array)z.depthSortedIndices=new Uint16Array(Y);else if(Y instanceof Uint32Array)z.depthSortedIndices=new Uint32Array(Y);else{let u=!1;for(let z=0;z<Y.length;z++)if(Y[z]>65535){u=!0;break}z.depthSortedIndices=u?new Uint32Array(Y):new Uint16Array(Y)}if(z.facetDepthSortFunction=function(z,u){return u.sqDistance-z.sqDistance},!z.facetDepthSortFrom){const u=this.iz().activeCamera;z.facetDepthSortFrom=u?u.position:J.p.Zero()}z.depthSortedFacets=[];for(let u=0;u<z.facetNb;u++){const Y={ind:3*u,sqDistance:0};z.depthSortedFacets.push(Y)}z.invertedMatrix=J.b.Identity(),z.facetDepthSortOrigin=J.p.Zero()}z.bbSize.x=E.maximum.x-E.minimum.x>h.e?E.maximum.x-E.minimum.x:h.e,z.bbSize.y=E.maximum.y-E.minimum.y>h.e?E.maximum.y-E.minimum.y:h.e,z.bbSize.z=E.maximum.z-E.minimum.z>h.e?E.maximum.z-E.minimum.z:h.e;let b=z.bbSize.x>z.bbSize.y?z.bbSize.x:z.bbSize.y;if(b=b>z.bbSize.z?b:z.bbSize.z,z.subDiv.max=z.partitioningSubdivisions,z.subDiv.X=Math.floor(z.subDiv.max*z.bbSize.x/b),z.subDiv.Y=Math.floor(z.subDiv.max*z.bbSize.y/b),z.subDiv.Z=Math.floor(z.subDiv.max*z.bbSize.z/b),z.subDiv.X=z.subDiv.X<1?1:z.subDiv.X,z.subDiv.Y=z.subDiv.Y<1?1:z.subDiv.Y,z.subDiv.Z=z.subDiv.Z<1?1:z.subDiv.Z,z.facetParameters.facetNormals=this.getFacetLocalNormals(),z.facetParameters.facetPositions=this.getFacetLocalPositions(),z.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),z.facetParameters.bInfo=E,z.facetParameters.bbSize=z.bbSize,z.facetParameters.subDiv=z.subDiv,z.facetParameters.ratio=this.partitioningBBoxRatio,z.facetParameters.depthSort=z.facetDepthSort,z.facetDepthSort&&z.facetDepthSortEnabled&&(this.pl(!0),this._worldMatrix.invertToRef(z.invertedMatrix),J.p.TransformCoordinatesToRef(z.facetDepthSortFrom,z.invertedMatrix,z.facetDepthSortOrigin),z.facetParameters.distanceTo=z.facetDepthSortOrigin),z.facetParameters.depthSortedFacets=z.depthSortedFacets,H&&T.e.ComputeNormals(u,Y,H,z.facetParameters),z.facetDepthSort&&z.facetDepthSortEnabled){z.depthSortedFacets.sort(z.facetDepthSortFunction);const u=z.depthSortedIndices.length/3|0;for(let H=0;H<u;H++){const u=z.depthSortedFacets[H].ind;z.depthSortedIndices[3*H]=Y[u],z.depthSortedIndices[3*H+1]=Y[u+1],z.depthSortedIndices[3*H+2]=Y[u+2]}this.updateIndices(z.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetNormals||this.updateFacetData(),z.facetNormals}getFacetLocalPositions(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetPositions||this.updateFacetData(),z.facetPositions}getFacetLocalPartitioning(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetPartitioning||this.updateFacetData(),z.facetPartitioning}getFacetPosition(z){const u=J.p.Zero();return this.getFacetPositionToRef(z,u),u}getFacetPositionToRef(z,u){const Y=this.getFacetLocalPositions()[z],H=this.getWorldMatrix();return J.p.TransformCoordinatesToRef(Y,H,u),this}getFacetNormal(z){const u=J.p.Zero();return this.getFacetNormalToRef(z,u),u}getFacetNormalToRef(z,u){const Y=this.getFacetLocalNormals()[z];return J.p.TransformNormalToRef(Y,this.getWorldMatrix(),u),this}getFacetsAtLocalCoordinates(z,u,Y){const H=this.getBoundingInfo(),E=this._internalAbstractMeshDataInfo._facetData,J=Math.floor((z-H.minimum.x*E.partitioningBBoxRatio)*E.subDiv.X*E.partitioningBBoxRatio/E.bbSize.x),l=Math.floor((u-H.minimum.y*E.partitioningBBoxRatio)*E.subDiv.Y*E.partitioningBBoxRatio/E.bbSize.y),T=Math.floor((Y-H.minimum.z*E.partitioningBBoxRatio)*E.subDiv.Z*E.partitioningBBoxRatio/E.bbSize.z);return J<0||J>E.subDiv.max||l<0||l>E.subDiv.max||T<0||T>E.subDiv.max?null:E.facetPartitioning[J+E.subDiv.max*l+E.subDiv.max*E.subDiv.max*T]}getClosestFacetAtCoordinates(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const T=this.getWorldMatrix(),b=J.i.Matrix[5];T.invertToRef(b);const L=J.i.Pl[8];J.p.TransformCoordinatesFromFloatsToRef(z,u,Y,b,L);const D=this.getClosestFacetAtLocalCoordinates(L.x,L.y,L.z,H,E,l);return H&&J.p.TransformCoordinatesFromFloatsToRef(H.x,H.y,H.z,T,H),D}getClosestFacetAtLocalCoordinates(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=null,T=0,b=0,L=0,D=0,g=0,M=0,q=0,C=0;const K=this.getFacetLocalPositions(),h=this.getFacetLocalNormals(),o=this.getFacetsAtLocalCoordinates(z,u,Y);if(!o)return null;let d,t,W,Z=Number.MAX_VALUE,s=Z;for(let v=0;v<o.length;v++)d=o[v],t=h[d],W=K[d],D=(z-W.x)*t.x+(u-W.y)*t.y+(Y-W.z)*t.z,(!E||E&&J&&D>=0||E&&!J&&D<=0)&&(D=t.x*W.x+t.y*W.y+t.z*W.z,g=-(t.x*z+t.y*u+t.z*Y-D)/(t.x*t.x+t.y*t.y+t.z*t.z),M=z+t.x*g,q=u+t.y*g,C=Y+t.z*g,T=M-z,b=q-u,L=C-Y,s=T*T+b*b+L*L,s<Z&&(Z=s,l=d,H&&(H.x=M,H.y=q,H.z=C)));return l}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetDataEnabled&&(z.facetDataEnabled=!1,z.facetPositions=[],z.facetNormals=[],z.facetPartitioning=new Array,z.facetParameters={},z.depthSortedIndices=new Uint32Array(0)),this}updateIndices(z,u){return this}createNormals(z){const u=this.getVerticesData(l.f.PositionKind),Y=this.Il();let H;return H=this.isVerticesDataPresent(l.f.NormalKind)?this.getVerticesData(l.f.NormalKind):[],T.e.ComputeNormals(u,Y,H,{useRightHandedSystem:this.iz().useRightHandedSystem}),this.Uz(l.f.NormalKind,H,z),this}async optimizeIndicesAsync(){const z=this.Il();if(!z)return this;const{OptimizeIndices:u}=await Y.e(35).then(Y.bind(Y,13250));return u(z),this.setIndices(z,this.getTotalVertices()),this}alignWithNormal(z,u){u||(u=o.c.Y);const Y=J.i.Pl[0],H=J.i.Pl[1];return J.p.CrossToRef(u,z,H),J.p.CrossToRef(z,H,Y),this.rotationQuaternion?J.f.RotationQuaternionFromAxisToRef(Y,z,H,this.rotationQuaternion):J.p.RotationFromAxisToRef(Y,z,H,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,q.e)("EdgesRenderer")}enableEdgesRendering(z,u,Y){throw(0,q.e)("EdgesRenderer")}VM(){return this._scene.QM.filter((z=>z.k===this))}}v.OCCLUSION_TYPE_NONE=0,v.OCCLUSION_TYPE_OPTIMISTIC=1,v.OCCLUSION_TYPE_STRICT=2,v.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,v.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,v.CULLINGSTRATEGY_STANDARD=0,v.ng=1,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,H.e)([t.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H,E,J,l,T]=u;return!Array.isArray(H)&&!Array.isArray(E)&&!Array.isArray(J)&&!Array.isArray(l)&&!Array.isArray(T)}))],v,"_ApplySkeleton",null),(0,d.d)("BABYLON.AbstractMesh",v)},11674:(z,u,Y)=>{Y.d(u,{b:()=>H.f});var H=Y(11103)},11298:(z,u,Y)=>{Y.d(u,{b:()=>h});var H=Y(10903),E=Y(11188),J=Y(11231),l=Y(11103),T=Y(11098),b=Y(11306),L=Y(11131),D=Y(10945),g=Y(11181),M=Y(11148),q=Y(10928),C=Y(11309),K=Y(11117);class h{get boundingBias(){return this._boundingBias}set boundingBias(z){this._boundingBias?this._boundingBias.J(z):this._boundingBias=z.clone(),this.wz(!0,null)}static CreateGeometryForMesh(z){const u=new h(h.RandomId(),z.iz());return u.Fz(z),u}get meshes(){return this._meshes}constructor(z,u,Y){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new H.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new H.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=u||q.d.LastCreatedScene,this._scene&&(this.id=z,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=E,Y?this.setAllVerticesData(Y,E):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),J&&(this.Fz(J),J.pl(!0)))}get extend(){return this._extend}iz(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let z=0;z<this._meshes.length;z++)if(!this._meshes[z].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const z=new Set;for(const u in this._vertexBuffers)z.add(this._vertexBuffers[u].getWrapperBuffer());z.forEach((z=>{z._rebuild()}))}setAllVerticesData(z,u){z.applyToGeometry(this,u),this._notifyUpdate()}Uz(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;Y&&Array.isArray(u)&&(u=new Float32Array(u));const E=new l.f(this._engine,u,z,{updatable:Y,postponeInternalCreation:0===this._meshes.length,stride:H,label:"Geometry_"+this.id+"_"+z});this.setVerticesBuffer(E)}removeVerticesData(z){this._vertexBuffers[z]&&(this._vertexBuffers[z].dispose(),delete this._vertexBuffers[z]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const E=z.getKind();this._vertexBuffers[E]&&Y&&this._vertexBuffers[E].dispose(),z._buffer&&z._buffer._increaseReferences(),this._vertexBuffers[E]=z;const J=this._meshes,T=J.length;if(E===l.f.PositionKind){this._totalVertices=u??z._maxVerticesCount,this._updateExtend(z.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const Y=this._extend&&this._extend.minimum||new H.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),E=this._extend&&this._extend.maximum||new H.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let z=0;z<T;z++){const u=J[z];u.buildBoundingInfo(Y,E),u._createGlobalSubMesh(u.isUnIndexed),u.pl(!0),u.synchronizeInstances()}}this._notifyUpdate(E)}updateVerticesDataDirectly(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getVertexBuffer(z);E&&(E.updateDirectly(u,Y,H),this._notifyUpdate(z))}updateVerticesData(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=this.getVertexBuffer(z);H&&(H.update(u),z===l.f.PositionKind&&this.wz(Y,u),this._notifyUpdate(z))}wz(z,u){if(z&&this._updateExtend(u),this._resetPointsArrayCache(),z){const z=this._meshes;for(const u of z){u.hasBoundingInfo?u.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):u.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const z=u.YT;for(const u of z)u.refreshBoundingInfo()}}}_bind(z,u,Y,H){if(!z)return;void 0===u&&(u=this._indexBuffer);const E=this.getVertexBuffers();if(!E)return;if(u!=this._indexBuffer||!this._vertexArrayObjects&&!H)return void this._engine.bindBuffers(E,u,z,Y);const J=H||this._vertexArrayObjects,l=this._engine;J[z.key]||(J[z.key]=l.recordVertexArrayObject(E,u,z,Y)),l.bindVertexArrayObject(J[z.key],u)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(z,u,Y){const H=this.getVertexBuffer(z);return H?H.getFloatData(this._totalVertices,Y||u&&1!==this._meshes.length):null}copyVerticesData(z,u){const Y=this.getVertexBuffer(z);if(!Y)return;u[z]||(u[z]=new Float32Array(this._totalVertices*Y.getSize()));const H=Y.getData();H&&(0,K.f)(H,Y.getSize(),Y.type,Y.byteOffset,Y.byteStride,Y.normalized,this._totalVertices,u[z])}isVertexBufferUpdatable(z){const u=this._vertexBuffers[z];return!!u&&u.isUpdatable()}getVertexBuffer(z){return this.isReady()?this._vertexBuffers[z]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(z){return this._vertexBuffers?void 0!==this._vertexBuffers[z]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(z)}getVerticesDataKinds(){const z=[];let u;if(!this._vertexBuffers&&this._delayInfo)for(u in this._delayInfo)z.push(u);else for(u in this._vertexBuffers)z.push(u);return z}updateIndices(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const H=z.length!==this._indices.length;if(Y||(this._indices=z.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,z,u),H)for(const z of this._meshes)z._createGlobalSubMesh(!0)}else this.setIndices(z,null,!0)}setIndexBuffer(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=z,this._totalVertices=u,this._totalIndices=Y,z.is32Bits=null===H?u>65535:H;for(const E of this._meshes)E._createGlobalSubMesh(!0),E.synchronizeInstances();this._notifyUpdate()}setIndices(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=z,this._indexBufferIsUpdatable=Y,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,Y,"Geometry_"+this.id+"_IndexBuffer")),void 0!=u&&(this._totalVertices=u);for(const E of this._meshes)E._createGlobalSubMesh(!H),E.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Il(z,u){if(!this.isReady())return null;const Y=this._indices;return u||z&&1!==this._meshes.length?Y.slice():Y}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;z&&this._vertexArrayObjects&&this._vertexArrayObjects[z.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[z.key]),delete this._vertexArrayObjects[z.key])}releaseForMesh(z,u){const Y=this._meshes,H=Y.indexOf(z);-1!==H&&(Y.splice(H,1),this._vertexArrayObjects&&z._invalidateInstanceVertexArrayObject(),z._geometry=null,0===Y.length&&u&&this.dispose())}Fz(z){if(z._geometry===this)return;const u=z._geometry;u&&u.releaseForMesh(z),this._vertexArrayObjects&&z._invalidateInstanceVertexArrayObject();const Y=this._meshes;z._geometry=this,z._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),Y.push(z),this.isReady()?this._applyToMesh(z):this._boundingInfo&&z.setBoundingInfo(this._boundingInfo)}_updateExtend(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!z&&(z=this.getVerticesData(l.f.PositionKind),!z))return;this._extend=(0,M.i)(z,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(z){const u=this._meshes.length;for(const Y in this._vertexBuffers)1===u&&this._vertexBuffers[Y].create(),Y===l.f.PositionKind&&(this._extend||this._updateExtend(),z.buildBoundingInfo(this._extend.minimum,this._extend.maximum),z._createGlobalSubMesh(z.isUnIndexed),z.wz());1===u&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),z._syncGeometryWithMorphTargetManager(),z.synchronizeInstances()}_notifyUpdate(z){this.onGeometryUpdated&&this.onGeometryUpdated(this,z),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const u of this._meshes)u._markSubMeshesAsAttributesDirty()}load(z,u){2!==this.delayLoadState&&(this.isReady()?u&&u():(this.delayLoadState=2,this._queueLoad(z,u)))}_queueLoad(z,u){this.delayLoadingFile&&(z.addPendingData(this),z._loadFile(this.delayLoadingFile,(Y=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(Y),this),this.delayLoadState=1,this._delayInfo=[],z.removePendingData(this);const H=this._meshes,E=H.length;for(let z=0;z<E;z++)this._applyToMesh(H[z]);u&&u()}),void 0,!0))}toLeftHanded(){const z=this.Il(!1);if(null!=z&&z.length>0){for(let u=0;u<z.length;u+=3){const Y=z[u+0];z[u+0]=z[u+2],z[u+2]=Y}this.setIndices(z)}const u=this.getVerticesData(l.f.PositionKind,!1);if(null!=u&&u.length>0){for(let z=0;z<u.length;z+=3)u[z+2]=-u[z+2];this.Uz(l.f.PositionKind,u,!1)}const Y=this.getVerticesData(l.f.NormalKind,!1);if(null!=Y&&Y.length>0){for(let z=0;z<Y.length;z+=3)Y[z+2]=-Y[z+2];this.Uz(l.f.NormalKind,Y,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const z=this.getVerticesData(l.f.PositionKind);if(!z||0===z.length)return!1;for(let u=3*this._positionsCache.length,Y=this._positionsCache.length;u<z.length;u+=3,++Y)this._positionsCache[Y]=H.p.Nl(z,u);for(let u=0,Y=0;u<z.length;u+=3,++Y)this._positionsCache[Y].set(z[0+u],z[1+u],z[2+u]);return this._positionsCache.length=z.length/3,this._positions=this._positionsCache,!0}L(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const Y in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Y]);this._vertexArrayObjects={};const z=this._meshes,u=z.length;for(let Y=0;Y<u;Y++)z[Y]._invalidateInstanceVertexArrayObject()}}dispose(){const z=this._meshes,u=z.length;let Y;for(Y=0;Y<u;Y++)this.releaseForMesh(z[Y]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const H in this._vertexBuffers)this._vertexBuffers[H].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const z=this._parentContainer.geometries.indexOf(this);z>-1&&this._parentContainer.geometries.splice(z,1),this._parentContainer=null}this._isDisposed=!0}j(z){const u=new J.e;u.indices=[];const Y=this.Il();if(Y)for(let J=0;J<Y.length;J++)u.indices.push(Y[J]);let H,E=!1,l=!1;for(H in this._vertexBuffers){const z=this.getVerticesData(H);if(z&&(z instanceof Float32Array?u.set(new Float32Array(z),H):u.set(z.slice(0),H),!l)){const z=this.getVertexBuffer(H);z&&(E=z.isUpdatable(),l=!E)}}const T=new h(z,this._scene,u,E);for(H in T.delayLoadState=this.delayLoadState,T.delayLoadingFile=this.delayLoadingFile,T._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)T._delayInfo=T._delayInfo||[],T._delayInfo.push(H);return T._boundingInfo=new L.e(this._extend.minimum,this._extend.maximum),T}serialize(){const z={};return z.id=this.id,z.uniqueId=this.uniqueId,z.updatable=this._updatable,g.e&&g.e.HasTags(this)&&(z.tags=g.e.GetTags(this)),z}_toNumberArray(z){return Array.isArray(z)?z:Array.prototype.slice.call(z)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const z in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,z)&&(this._vertexBuffers[z]._buffer._data=null)}serializeVerticeData(){const z=this.serialize();return this.isVerticesDataPresent(l.f.PositionKind)&&(z.Qz=this._toNumberArray(this.getVerticesData(l.f.PositionKind)),this.isVertexBufferUpdatable(l.f.PositionKind)&&(z.positionsUpdatable=!0)),this.isVerticesDataPresent(l.f.NormalKind)&&(z.Vz=this._toNumberArray(this.getVerticesData(l.f.NormalKind)),this.isVertexBufferUpdatable(l.f.NormalKind)&&(z.normalsUpdatable=!0)),this.isVerticesDataPresent(l.f.TangentKind)&&(z.tangents=this._toNumberArray(this.getVerticesData(l.f.TangentKind)),this.isVertexBufferUpdatable(l.f.TangentKind)&&(z.tangentsUpdatable=!0)),this.isVerticesDataPresent(l.f.UVKind)&&(z.xz=this._toNumberArray(this.getVerticesData(l.f.UVKind)),this.isVertexBufferUpdatable(l.f.UVKind)&&(z.uvsUpdatable=!0)),this.isVerticesDataPresent(l.f.UV2Kind)&&(z.uvs2=this._toNumberArray(this.getVerticesData(l.f.UV2Kind)),this.isVertexBufferUpdatable(l.f.UV2Kind)&&(z.uvs2Updatable=!0)),this.isVerticesDataPresent(l.f.UV3Kind)&&(z.uvs3=this._toNumberArray(this.getVerticesData(l.f.UV3Kind)),this.isVertexBufferUpdatable(l.f.UV3Kind)&&(z.uvs3Updatable=!0)),this.isVerticesDataPresent(l.f.UV4Kind)&&(z.uvs4=this._toNumberArray(this.getVerticesData(l.f.UV4Kind)),this.isVertexBufferUpdatable(l.f.UV4Kind)&&(z.uvs4Updatable=!0)),this.isVerticesDataPresent(l.f.UV5Kind)&&(z.uvs5=this._toNumberArray(this.getVerticesData(l.f.UV5Kind)),this.isVertexBufferUpdatable(l.f.UV5Kind)&&(z.uvs5Updatable=!0)),this.isVerticesDataPresent(l.f.UV6Kind)&&(z.uvs6=this._toNumberArray(this.getVerticesData(l.f.UV6Kind)),this.isVertexBufferUpdatable(l.f.UV6Kind)&&(z.uvs6Updatable=!0)),this.isVerticesDataPresent(l.f.ColorKind)&&(z.Az=this._toNumberArray(this.getVerticesData(l.f.ColorKind)),this.isVertexBufferUpdatable(l.f.ColorKind)&&(z.colorsUpdatable=!0)),this.isVerticesDataPresent(l.f.MatricesIndicesKind)&&(z.matricesIndices=this._toNumberArray(this.getVerticesData(l.f.MatricesIndicesKind)),z.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(l.f.MatricesIndicesKind)&&(z.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(l.f.MatricesWeightsKind)&&(z.matricesWeights=this._toNumberArray(this.getVerticesData(l.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(l.f.MatricesWeightsKind)&&(z.matricesWeightsUpdatable=!0)),z.indices=this._toNumberArray(this.Il()),z}static ExtractFromMesh(z,u){const Y=z._geometry;return Y?Y.j(u):null}static RandomId(){return D.e.RandomId()}static _GetGeometryByLoadedUniqueId(z,u){for(let Y=0;Y<u.geometries.length;Y++)if(u.geometries[Y]._loadedUniqueId===z)return u.geometries[Y];return null}static _ImportGeometry(z,u){const Y=u.iz(),H=z.geometryUniqueId,J=z.geometryId;if(H||J){const z=H?this._GetGeometryByLoadedUniqueId(H,Y):Y.getGeometryById(J);z&&z.Fz(u)}else if(z instanceof ArrayBuffer){const Y=u._binaryInfo;if(Y.positionsAttrDesc&&Y.positionsAttrDesc.count>0){const H=new Float32Array(z,Y.positionsAttrDesc.offset,Y.positionsAttrDesc.count);u.Uz(l.f.PositionKind,H,!1)}if(Y.normalsAttrDesc&&Y.normalsAttrDesc.count>0){const H=new Float32Array(z,Y.normalsAttrDesc.offset,Y.normalsAttrDesc.count);u.Uz(l.f.NormalKind,H,!1)}if(Y.tangetsAttrDesc&&Y.tangetsAttrDesc.count>0){const H=new Float32Array(z,Y.tangetsAttrDesc.offset,Y.tangetsAttrDesc.count);u.Uz(l.f.TangentKind,H,!1)}if(Y.uvsAttrDesc&&Y.uvsAttrDesc.count>0){const H=new Float32Array(z,Y.uvsAttrDesc.offset,Y.uvsAttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UVKind,H,!1)}if(Y.uvs2AttrDesc&&Y.uvs2AttrDesc.count>0){const H=new Float32Array(z,Y.uvs2AttrDesc.offset,Y.uvs2AttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UV2Kind,H,!1)}if(Y.uvs3AttrDesc&&Y.uvs3AttrDesc.count>0){const H=new Float32Array(z,Y.uvs3AttrDesc.offset,Y.uvs3AttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UV3Kind,H,!1)}if(Y.uvs4AttrDesc&&Y.uvs4AttrDesc.count>0){const H=new Float32Array(z,Y.uvs4AttrDesc.offset,Y.uvs4AttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UV4Kind,H,!1)}if(Y.uvs5AttrDesc&&Y.uvs5AttrDesc.count>0){const H=new Float32Array(z,Y.uvs5AttrDesc.offset,Y.uvs5AttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UV5Kind,H,!1)}if(Y.uvs6AttrDesc&&Y.uvs6AttrDesc.count>0){const H=new Float32Array(z,Y.uvs6AttrDesc.offset,Y.uvs6AttrDesc.count);if(C.b)for(let z=1;z<H.length;z+=2)H[z]=1-H[z];u.Uz(l.f.UV6Kind,H,!1)}if(Y.colorsAttrDesc&&Y.colorsAttrDesc.count>0){const H=new Float32Array(z,Y.colorsAttrDesc.offset,Y.colorsAttrDesc.count);u.Uz(l.f.ColorKind,H,!1,Y.colorsAttrDesc.stride)}if(Y.matricesIndicesAttrDesc&&Y.matricesIndicesAttrDesc.count>0){const H=new Int32Array(z,Y.matricesIndicesAttrDesc.offset,Y.matricesIndicesAttrDesc.count),E=[];for(let z=0;z<H.length;z++){const u=H[z];E.push(255&u),E.push((65280&u)>>8),E.push((16711680&u)>>16),E.push(u>>24&255)}u.Uz(l.f.MatricesIndicesKind,E,!1)}if(Y.matricesIndicesExtraAttrDesc&&Y.matricesIndicesExtraAttrDesc.count>0){const H=new Int32Array(z,Y.matricesIndicesExtraAttrDesc.offset,Y.matricesIndicesExtraAttrDesc.count),E=[];for(let z=0;z<H.length;z++){const u=H[z];E.push(255&u),E.push((65280&u)>>8),E.push((16711680&u)>>16),E.push(u>>24&255)}u.Uz(l.f.MatricesIndicesExtraKind,E,!1)}if(Y.matricesWeightsAttrDesc&&Y.matricesWeightsAttrDesc.count>0){const H=new Float32Array(z,Y.matricesWeightsAttrDesc.offset,Y.matricesWeightsAttrDesc.count);u.Uz(l.f.MatricesWeightsKind,H,!1)}if(Y.indicesAttrDesc&&Y.indicesAttrDesc.count>0){const H=new Int32Array(z,Y.indicesAttrDesc.offset,Y.indicesAttrDesc.count);u.setIndices(H,null)}if(Y.subMeshesAttrDesc&&Y.subMeshesAttrDesc.count>0){const H=new Int32Array(z,Y.subMeshesAttrDesc.offset,5*Y.subMeshesAttrDesc.count);u.YT=[];for(let z=0;z<Y.subMeshesAttrDesc.count;z++){const Y=H[5*z+0],E=H[5*z+1],J=H[5*z+2],l=H[5*z+3],b=H[5*z+4];T.d.AddToMesh(Y,E,J,l,b,u)}}}else if(z.Qz&&z.Vz&&z.indices){if(u.Uz(l.f.PositionKind,z.Qz,z.Qz._updatable||z.positionsUpdatable),u.Uz(l.f.NormalKind,z.Vz,z.Vz._updatable||z.normalsUpdatable),z.tangents&&u.Uz(l.f.TangentKind,z.tangents,z.tangents._updatable||z.tangentsUpdatable),z.xz&&u.Uz(l.f.UVKind,z.xz,z.xz._updatable||z.uvsUpdatable),z.uvs2&&u.Uz(l.f.UV2Kind,z.uvs2,z.uvs2._updatable||z.uvs2Updatable),z.uvs3&&u.Uz(l.f.UV3Kind,z.uvs3,z.uvs3._updatable||z.uvs3Updatable),z.uvs4&&u.Uz(l.f.UV4Kind,z.uvs4,z.uvs4._updatable||z.uvs4Updatable),z.uvs5&&u.Uz(l.f.UV5Kind,z.uvs5,z.uvs5._updatable||z.uvs5Updatable),z.uvs6&&u.Uz(l.f.UV6Kind,z.uvs6,z.uvs6._updatable||z.uvs6Updatable),z.Az&&u.Uz(l.f.ColorKind,E.e.CheckColors4(z.Az,z.Qz.length/3),z.Az._updatable),z.matricesIndices)if(z.matricesIndices._isExpanded||z.matricesIndicesExpanded)delete z.matricesIndices._isExpanded,delete z.matricesIndicesExpanded,u.Uz(l.f.MatricesIndicesKind,z.matricesIndices,z.matricesIndices._updatable||z.matricesIndicesUpdatable);else{const Y=[];for(let u=0;u<z.matricesIndices.length;u++){const H=z.matricesIndices[u];Y.push(255&H),Y.push((65280&H)>>8),Y.push((16711680&H)>>16),Y.push(H>>24&255)}u.Uz(l.f.MatricesIndicesKind,Y,z.matricesIndices._updatable||z.matricesIndicesUpdatable)}if(z.matricesIndicesExtra)if(z.matricesIndicesExtraExpanded||z.matricesIndicesExtra._isExpanded)delete z.matricesIndices._isExpanded,delete z.matricesIndicesExtraExpanded,u.Uz(l.f.MatricesIndicesExtraKind,z.matricesIndicesExtra,z.matricesIndicesExtra._updatable||z.matricesIndicesExtraUpdatable);else{const Y=[];for(let u=0;u<z.matricesIndicesExtra.length;u++){const H=z.matricesIndicesExtra[u];Y.push(255&H),Y.push((65280&H)>>8),Y.push((16711680&H)>>16),Y.push(H>>24&255)}u.Uz(l.f.MatricesIndicesExtraKind,Y,z.matricesIndicesExtra._updatable||z.matricesIndicesExtraUpdatable)}z.matricesWeights&&(h._CleanMatricesWeights(z,u),u.Uz(l.f.MatricesWeightsKind,z.matricesWeights,z.matricesWeights._updatable)),z.matricesWeightsExtra&&u.Uz(l.f.MatricesWeightsExtraKind,z.matricesWeightsExtra,z.matricesWeights._updatable),u.setIndices(z.indices,null)}if(z.YT){u.YT=[];for(let Y=0;Y<z.YT.length;Y++){const H=z.YT[Y];T.d.AddToMesh(H.materialIndex,H.verticesStart,H.verticesCount,H.indexStart,H.indexCount,u)}}u._shouldGenerateFlatShading&&(u.convertToFlatShadedMesh(),u._shouldGenerateFlatShading=!1),u.pl(!0),Y.onMeshImportedObservable.notifyObservers(u)}static _CleanMatricesWeights(z,u){const Y=.001;if(!b.e.CleanBoneMatrixWeights)return;let H=0;if(!(z.skeletonId>-1))return;{const Y=u.iz().getLastSkeletonById(z.skeletonId);if(!Y)return;H=Y.bones.length}const E=u.getVerticesData(l.f.MatricesIndicesKind),J=u.getVerticesData(l.f.MatricesIndicesExtraKind),T=z.matricesWeights,L=z.matricesWeightsExtra,D=z.numBoneInfluencer,g=T.length;for(let l=0;l<g;l+=4){let z=0,u=-1;for(let H=0;H<4;H++){const E=T[l+H];z+=E,E<Y&&u<0&&(u=H)}if(L)for(let H=0;H<4;H++){const E=L[l+H];z+=E,E<Y&&u<0&&(u=H+4)}if((u<0||u>D-1)&&(u=D-1),z>Y){const u=1/z;for(let z=0;z<4;z++)T[l+z]*=u;if(L)for(let z=0;z<4;z++)L[l+z]*=u}else u>=4?(L[l+u-4]=1-z,J[l+u-4]=H):(T[l+u]=1-z,E[l+u]=H)}u.Uz(l.f.MatricesIndicesKind,E),z.matricesWeightsExtra&&u.Uz(l.f.MatricesIndicesExtraKind,J)}static Parse(z,u,Y){const E=new h(z.id,u,void 0,z.updatable);return E._loadedUniqueId=z.uniqueId,g.e&&g.e.AddTagsTo(E,z.tags),z.delayLoadingFile?(E.delayLoadState=4,E.delayLoadingFile=Y+z.delayLoadingFile,E._boundingInfo=new L.e(H.p.Nl(z.boundingBoxMinimum),H.p.Nl(z.boundingBoxMaximum)),E._delayInfo=[],z.hasUVs&&E._delayInfo.push(l.f.UVKind),z.hasUVs2&&E._delayInfo.push(l.f.UV2Kind),z.hasUVs3&&E._delayInfo.push(l.f.UV3Kind),z.hasUVs4&&E._delayInfo.push(l.f.UV4Kind),z.hasUVs5&&E._delayInfo.push(l.f.UV5Kind),z.hasUVs6&&E._delayInfo.push(l.f.UV6Kind),z.hasColors&&E._delayInfo.push(l.f.ColorKind),z.hasMatricesIndices&&E._delayInfo.push(l.f.MatricesIndicesKind),z.hasMatricesWeights&&E._delayInfo.push(l.f.MatricesWeightsKind),E._delayLoadingFunction=J.e.ImportVertexData):J.e.ImportVertexData(z,E),u.pushGeometry(E,!0),E}}},11259:(z,u,Y)=>{Y.d(u,{e:()=>M});var H=Y(10903),E=Y(10953),J=Y(11229),l=Y(11267),T=Y(10959),b=Y(11218),L=Y(11103),D=Y(10945),g=Y(10918);l.b._instancedMeshFactory=(z,u)=>{const Y=new M(z,u);if(u.instancedBuffers){Y.instancedBuffers={};for(const z in u.instancedBuffers)Y.instancedBuffers[z]=u.instancedBuffers[z]}return Y};class M extends J.b{constructor(z,u){super(z,u.iz()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,u.IM(this),this._sourceMesh=u,this._unIndexed=u._unIndexed,this.position.J(u.position),this.rotation.J(u.rotation),this.el.J(u.el),u.rotationQuaternion&&(this.rotationQuaternion=u.rotationQuaternion.clone()),this.animations=u.animations.slice();for(const Y of u.getAnimationRanges())null!=Y&&this.createAnimationRange(Y.name,Y.from,Y.to);if(this.infiniteDistance=u.infiniteDistance,this.setPivotMatrix(u.getPivotMatrix()),u.skeleton||u.morphTargetManager||!u.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const z=u.getBoundingInfo();this.buildBoundingInfo(z.minimum,z.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(z){var u;(null===(u=this._sourceMesh)||void 0===u?void 0:u.receiveShadows)!==z&&D.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(z){var u;(null===(u=this._sourceMesh)||void 0===u?void 0:u.material)!==z&&D.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(z){var u;(null===(u=this._sourceMesh)||void 0===u?void 0:u.visibility)!==z&&D.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(z){var u;(null===(u=this._sourceMesh)||void 0===u?void 0:u.skeleton)!==z&&D.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(z){this._sourceMesh&&z!==this._sourceMesh.renderingGroupId&&E.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get Sl(){return this._sourceMesh._geometry}createInstance(z){return this._sourceMesh.createInstance(z)}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(z,!0)}getVerticesData(z,u,Y){return this._sourceMesh.getVerticesData(z,u,Y)}copyVerticesData(z,u){this._sourceMesh.copyVerticesData(z,u)}Uz(z,u,Y,H){return this.sourceMesh&&this.sourceMesh.Uz(z,u,Y,H),this.sourceMesh}updateVerticesData(z,u,Y,H){return this.sourceMesh&&this.sourceMesh.updateVerticesData(z,u,Y,H),this.sourceMesh}setIndices(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(z,u),this.sourceMesh}isVerticesDataPresent(z){return this._sourceMesh.isVerticesDataPresent(z)}Il(){return this._sourceMesh.Il()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let z,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;z="object"===typeof u?u:{applySkeleton:u,applyMorph:Y};const H=this._sourceMesh.Sl?this._sourceMesh.Sl.boundingBias:null;return this.cz(this._sourceMesh._getData(z,null,L.f.PositionKind),H),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(z,u){if(super._activate(z,u),this._sourceMesh.YT||E.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,z),u){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==b.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new H.b);const z=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,H.i.Pl[7].J(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.J(this._currentLOD.pl(!0)),this._currentLOD.position.J(H.i.Pl[7]),this._currentLOD._masterMesh=z,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(z){if(!z)return this;const u=this.sourceMesh.getLODLevels();if(u&&0!==u.length){const u=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(z,u.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(z){return this.sourceMesh._preActivateForIntermediateRendering(z)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.YT)for(let z=0;z<this._sourceMesh.YT.length;z++)this._sourceMesh.YT[z].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}wz(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;const H=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(z);if(T.b.DeepCopy(this,H,["name","YT","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","XM","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","Sl"],[]),this.refreshBoundingInfo(),u&&(H.parent=u),!Y)for(let E=0;E<this.iz().meshes.length;E++){const z=this.iz().meshes[E];z.parent===this&&z.clone(z.name,H)}return H.pl(!0),this.onClonedObservable.notifyObservers(H),H}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.SM(this),super.dispose(z,u)}_serializeAsParent(z){super._serializeAsParent(z),z.parentId=this._sourceMesh.uniqueId,z.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const H=this.clone("Clone of "+(this.name||this.id),z||this.parent,!0,u&&u.newSourcedMesh);H&&Y&&Y(this,H);for(const E of this.getChildTransformNodes(!0))E.instantiateHierarchy(H,u,Y);return H}}l.b.prototype.registerInstancedBuffer=function(z,u){var Y,H;if(null===(Y=this._userInstancedBuffersStorage)||void 0===Y||null===(H=Y.vertexBuffers[z])||void 0===H||H.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const z of this.instances)z.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[z]=null,this._userInstancedBuffersStorage.strides[z]=u,this._userInstancedBuffersStorage.sizes[z]=32*u,this._userInstancedBuffersStorage.data[z]=new Float32Array(this._userInstancedBuffersStorage.sizes[z]),this._userInstancedBuffersStorage.vertexBuffers[z]=new L.f(this.getEngine(),this._userInstancedBuffersStorage.data[z],z,!0,!1,u,!0);for(const E of this.instances)E.instancedBuffers[z]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},l.b.prototype._processInstancedBuffers=function(z,u){const Y=z?z.length:0;for(const H in this.instancedBuffers){let E=this._userInstancedBuffersStorage.sizes[H];const J=this._userInstancedBuffersStorage.strides[H],l=(Y+1)*J;for(;E<l;)E*=2;this._userInstancedBuffersStorage.data[H].length!=E&&(this._userInstancedBuffersStorage.data[H]=new Float32Array(E),this._userInstancedBuffersStorage.sizes[H]=E,this._userInstancedBuffersStorage.vertexBuffers[H]&&(this._userInstancedBuffersStorage.vertexBuffers[H].dispose(),this._userInstancedBuffersStorage.vertexBuffers[H]=null));const T=this._userInstancedBuffersStorage.data[H];let b=0;if(u){const z=this.instancedBuffers[H];z.toArray?z.toArray(T,b):z.copyToArray?z.copyToArray(T,b):T[b]=z,b+=J}for(let u=0;u<Y;u++){const Y=z[u].instancedBuffers[H];Y.toArray?Y.toArray(T,b):Y.copyToArray?Y.copyToArray(T,b):T[b]=Y,b+=J}this._userInstancedBuffersStorage.vertexBuffers[H]?this._userInstancedBuffersStorage.vertexBuffers[H].updateDirectly(T,0):(this._userInstancedBuffersStorage.vertexBuffers[H]=new L.f(this.getEngine(),this._userInstancedBuffersStorage.data[H],H,!0,!1,J,!0),this._invalidateInstanceVertexArrayObject())}},l.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const z in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[z]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},l.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const z in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[z]&&this._userInstancedBuffersStorage.vertexBuffers[z].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,g.d)("BABYLON.InstancedMesh",M)},11639:(z,u,Y)=>{Y.d(u,{e:()=>L});var H=Y(11188),E=Y(11103),J=Y(11267),l=Y(11259),T=Y(11077),b=Y(11643);J.b._LinesMeshParser=(z,u)=>L.Parse(z,u);class L extends J.b{_isShaderMaterial(z){return"ShaderMaterial"===z.getClassName()}constructor(z){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7?arguments[7]:void 0;super(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u,arguments.length>4?arguments[4]:void 0),this.useVertexColor=J,this.useVertexAlpha=l,this.color=new H.c(1,1,1),this.alpha=1,this._shaderLanguage=0,u&&(this.color=u.color.clone(),this.alpha=u.alpha,this.useVertexColor=u.useVertexColor,this.useVertexAlpha=u.useVertexAlpha),this.intersectionThreshold=.1;const D={attributes:[E.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?D.defines.push("#define VERTEXALPHA"):D.needAlphaBlending=!1,this.useVertexColor?(D.defines.push("#define VERTEXCOLOR"),D.attributes.push(E.f.ColorKind)):(D.uniforms.push("color"),this._color4=new H.e),T)this.material=T;else{this.iz().getEngine().isWebGPU&&!L.ForceGLSL&&(this._shaderLanguage=1),D.shaderLanguage=this._shaderLanguage,D.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([Y.e(23).then(Y.bind(Y,13870)),Y.e(19).then(Y.bind(Y,13879))]):await Promise.all([Y.e(17).then(Y.bind(Y,13882)),Y.e(16).then(Y.bind(Y,13886))])},this.material=new b.b("colorShader",this.iz(),"color",D,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(z){this._lineMaterial=z,this._lineMaterial.fillMode=T.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(z){}_bind(z,u){if(!this._geometry)return this;const Y=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(u,Y):this._geometry._bind(u,Y,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:z,g:u,b:Y}=this.color;this._color4.set(z,u,Y,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(z,u,Y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const H=this.iz().getEngine();return this._unIndexed?H.drawArraysType(T.d.LineListDrawMode,z.verticesStart,z.verticesCount,Y):H.drawElementsType(T.d.LineListDrawMode,z.indexStart,z.indexCount,Y),this}dispose(z){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(z)}clone(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;if(u&&void 0===u._addToSceneRootNodes){const Y=u;return Y.source=this,new L(z,this.iz(),Y.parent,Y.source,Y.doNotCloneChildren)}return new L(z,this.iz(),u,this,Y)}createInstance(z){const u=new D(z,this);if(this.instancedBuffers){u.instancedBuffers={};for(const z in this.instancedBuffers)u.instancedBuffers[z]=this.instancedBuffers[z]}return u}serialize(z){super.serialize(z),z.color=this.color.al(),z.alpha=this.alpha}static Parse(z,u){const Y=new L(z.name,u);return Y.color=H.c.Nl(z.color),Y.alpha=z.alpha,Y}}L.ForceGLSL=!1;class D extends l.e{constructor(z,u){super(z,u),this.intersectionThreshold=u.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11267:(z,u,Y)=>{Y.d(u,{b:()=>R,e:()=>Q});var H=Y(10932),E=Y(10945),J=Y(10959),l=Y(11181),T=Y(11239),b=Y(11275),L=Y(10903),D=Y(11188),g=Y(11222),M=Y(11103),q=Y(11231),C=Y(11298),K=Y(11229),h=Y(11098),o=Y(11077),d=Y(11316),t=Y(11306),W=Y(11172),Z=Y(10953),s=Y(10918),v=Y(10970),i=Y(11320);class X{constructor(z,u){this.distanceOrScreenCoverage=z,this.mesh=u}}class Q{}class V{constructor(){this.visibleInstances={},this.batchCache=new A,this.batchCacheReplacementModeInFrozenMode=new A,this.instancesBufferSize=2048}}class A{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class x{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class G{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const F={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class R extends K.b{static _GetDefaultSideOrientation(z){return z||R.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(z){this._internalMeshDataInfo._useLODScreenCoverage=z,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==z&&(z&&this._internalMeshDataInfo._sourcePositions&&(this.Uz(M.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Uz(M.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=z,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new H.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new H.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new H.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new H.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new H.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(z){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(z)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(z){this._internalMeshDataInfo._forcedInstanceCount=z}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(z){this._internalMeshDataInfo._sideOrientation=z,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===z||!this._scene.useRightHandedSystem&&0===z}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(z){this.sideOrientation=z,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(z){this._internalMeshDataInfo._overrideRenderingFillMode=z}get material(){return this._internalAbstractMeshDataInfo._material}set material(z){z&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(z.sideOrientation=null),this._setMaterial(z)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(z){this._unIndexed!==z&&(this._unIndexed=z,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(z){this._instanceDataStorage.manualUpdate=z}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(z){this._instanceDataStorage.previousManualUpdate=z}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(z){this._instanceDataStorage.forceMatrixUpdates=z}_copySource(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.iz();if(z._geometry&&z._geometry.Fz(this),J.b.DeepCopy(z,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Sl","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","XM","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=z,E.useClonedMeshMap&&(z._internalMeshDataInfo.meshMap||(z._internalMeshDataInfo.meshMap={}),z._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=z._originalBuilderSideOrientation,this._creationDataStorage=z._creationDataStorage,z._ranges){const u=z._ranges;for(const z in u)Object.prototype.hasOwnProperty.call(u,z)&&u[z]&&this.createAnimationRange(z,u[z].from,u[z].to)}if(z.metadata&&z.metadata.clone?this.metadata=z.metadata.clone():this.metadata=z.metadata,this._internalMetadata=z._internalMetadata,l.e&&l.e.HasTags(z)&&l.e.AddTagsTo(this,l.e.GetTags(z,!0)),this.oT(z.isEnabled(!1)),this.parent=z.parent,this.setPivotMatrix(z.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+z.id,this.material=z.material,!u){const E=z.getDescendants(!0);for(let z=0;z<E.length;z++){const J=E[z];J._isMesh?(F.parent=this,F.doNotCloneChildren=u,F.clonePhysicsImpostor=Y,F.cloneThinInstances=H,J.clone(this.name+"."+J.name,F)):J.clone&&J.clone(this.name+"."+J.name,this)}}if(z.morphTargetManager&&(this.morphTargetManager=z.morphTargetManager),E.getPhysicsEngine){const u=E.getPhysicsEngine();if(Y&&u)if(1===u.getPluginVersion()){const Y=u.getImpostorForPhysicsObject(z);Y&&(this.physicsImpostor=Y.clone(this))}else 2===u.getPluginVersion()&&z.physicsBody&&z.physicsBody.clone(this)}for(let J=0;J<E.QM.length;J++){const u=E.QM[J];u.k===z&&u.clone(u.name,this)}if(this.skeleton=z.skeleton,H&&(z._thinInstanceDataStorage.matrixData?(this.pg("matrix",new Float32Array(z._thinInstanceDataStorage.matrixData),16,!z._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=z._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=z._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=z._thinInstanceDataStorage.matrixBufferSize,z._userThinInstanceBuffersStorage)){const u=z._userThinInstanceBuffersStorage;for(const z in u.data){var T,b;this.pg(z,new Float32Array(u.data[z]),u.strides[z],!(null!==(T=u.vertexBuffers)&&void 0!==T&&null!==(b=T[z])&&void 0!==b&&b.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[z]=u.sizes[z]}}this.refreshBoundingInfo(!0,!0),this.pl(!0)}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(z,u),this._internalMeshDataInfo=new G,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new V,this._thinInstanceDataStorage=new x,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=R.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,u=this.iz(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(z,u,Y)=>{z&&Y&&(this._uniformBuffer?this.transferToEffect(u):Y.bindOnlyWorldMatrix(u))};let T=null,b=!1;if(Y&&void 0===Y._addToSceneRootNodes){const z=Y;T=z.parent??null,E=z.source??null,J=z.doNotCloneChildren??!1,l=z.clonePhysicsImpostor??!0,b=z.cloneThinInstances??!1}else T=Y;E&&this._copySource(E,J,l,b),null!==T&&(this.parent=T),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=z=>{z.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new H.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),E&&E.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const H=0===this.getTotalVertices()||u&&u.doNotInstantiate&&(!0===u.doNotInstantiate||u.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),z||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));H.parent=z||this.parent,H.position=this.position.clone(),H.el=this.el.clone(),this.rotationQuaternion?H.rotationQuaternion=this.rotationQuaternion.clone():H.rotation=this.rotation.clone(),Y&&Y(this,H);for(const E of this.getChildTransformNodes(!0))"InstancedMesh"===E.getClassName()&&"Mesh"===H.getClassName()&&E.sourceMesh===this?E.instantiateHierarchy(H,{doNotInstantiate:u&&u.doNotInstantiate||!1,newSourcedMesh:H},Y):E.instantiateHierarchy(H,u,Y);return H}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(z){let u=super.toString(z);if(u+=", n vertices: "+this.getTotalVertices(),u+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let Y=0;Y<this.animations.length;Y++)u+=", animation[0]: "+this.animations[Y].toString(z);if(z)if(this._geometry){const z=this.Il(),Y=this.getVerticesData(M.f.PositionKind);Y&&z&&(u+=", flat shading: "+(Y.length/3===z.length?"YES":"NO"))}else u+=", flat shading: UNKNOWN";return u}_unBindEffect(){super._unBindEffect();for(const z of this.instances)z._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const z=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((u,Y)=>u.distanceOrScreenCoverage<Y.distanceOrScreenCoverage?z:u.distanceOrScreenCoverage>Y.distanceOrScreenCoverage?-z:0))}addLODLevel(z,u){if(u&&u._masterMesh)return Z.b.Warn("You cannot use a mesh as LOD level twice"),this;const Y=new X(z,u);return this._internalMeshDataInfo._LODLevels.push(Y),u&&(u._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(z){const u=this._internalMeshDataInfo;for(let Y=0;Y<u._LODLevels.length;Y++){const H=u._LODLevels[Y];if(H.distanceOrScreenCoverage===z)return H.mesh}return null}removeLODLevel(z){const u=this._internalMeshDataInfo;for(let Y=0;Y<u._LODLevels.length;Y++)u._LODLevels[Y].mesh===z&&(u._LODLevels.splice(Y,1),z&&(z._masterMesh=null));return this._sortLODLevels(),this}getLOD(z,u){const Y=this._internalMeshDataInfo;if(!Y._LODLevels||0===Y._LODLevels.length)return this;const H=u||this.getBoundingInfo().boundingSphere,E=z.mode===b.d.ORTHOGRAPHIC_CAMERA?z.uT:H.centerWorld.JY(z.globalPosition).length();let J=E,l=1;if(Y._useLODScreenCoverage){const u=z.screenArea;let Y=H.radiusWorld*z.uT/E;Y=Y*Y*Math.PI,J=Y/u,l=-1}if(l*Y._LODLevels[Y._LODLevels.length-1].distanceOrScreenCoverage>l*J)return this.onLODLevelSelection&&this.onLODLevelSelection(J,this,this),this;for(let T=0;T<Y._LODLevels.length;T++){const z=Y._LODLevels[T];if(l*z.distanceOrScreenCoverage<l*J){if(z.mesh){if(4===z.mesh.delayLoadState)return z.mesh._checkDelayState(),this;if(2===z.mesh.delayLoadState)return this;z.mesh._preActivate(),z.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(J,this,z.mesh),z.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(J,this,this),this}get Sl(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(z,u,Y,H){var E,J;if(!this._geometry)return null;let l=H||null===(E=this._userInstancedBuffersStorage)||void 0===E||null===(J=E.vertexBuffers[z])||void 0===J?void 0:J.getFloatData(this.instances.length+1,Y||u&&1!==this._geometry.meshes.length);return l||(l=this._geometry.getVerticesData(z,u,Y)),l}copyVerticesData(z,u){this._geometry&&this._geometry.copyVerticesData(z,u)}getVertexBuffer(z,u){var Y;return this._geometry?(u||null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[z])??this._geometry.getVertexBuffer(z):null}isVerticesDataPresent(z,u){var Y;return this._geometry?!u&&void 0!==(null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[z])||this._geometry.isVerticesDataPresent(z):!!this._delayInfo&&-1!==this._delayInfo.indexOf(z)}isVertexBufferUpdatable(z,u){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(z);if(!u){var Y;const u=null===(Y=this._userInstancedBuffersStorage)||void 0===Y?void 0:Y.vertexBuffers[z];if(u)return u.isUpdatable()}return this._geometry.isVertexBufferUpdatable(z)}getVerticesDataKinds(z){if(!this._geometry){const z=[];if(this._delayInfo)for(const u of this._delayInfo)z.push(u);return z}const u=this._geometry.getVerticesDataKinds();if(!z&&this._userInstancedBuffersStorage)for(const Y in this._userInstancedBuffersStorage.vertexBuffers)-1===u.indexOf(Y)&&u.push(Y);return u}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Il(z,u){return this._geometry?this._geometry.Il(z,u):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(z))return!1;if(!this.YT||0===this.YT.length)return!0;if(!z)return!0;const Y=this.getEngine(),H=this.iz(),E=u||Y.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.pl();const J=this.material||H.defaultMaterial;if(J)if(J._storeEffectOnSubMeshes)for(const M of this.YT){const z=M.Oz();if(z)if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(this,M,E))return!1}else if(!z.isReady(this,E))return!1}else if(!J.isReady(this,E))return!1;const l=Y.currentRenderPassId;for(const M of this.lightSources){const z=M.getShadowGenerators();if(!z)continue;const u=z.values();for(let H=u.next();!0!==H.done;H=u.next()){var T,b,L,D;const z=H.value;if(z&&(null===(T=z.getShadowMap())||void 0===T||!T.renderList||null!==(b=z.getShadowMap())&&void 0!==b&&b.renderList&&-1!==(null===(L=z.getShadowMap())||void 0===L||null===(D=L.renderList)||void 0===D?void 0:D.indexOf(this)))){const u=z.getShadowMap().renderPassIds??[Y.currentRenderPassId];for(let H=0;H<u.length;++H){Y.currentRenderPassId=u[H];for(const u of this.YT){var g;if(!z.isReady(u,E,(null===(g=u.Oz())||void 0===g?void 0:g.needAlphaBlendingForMesh(this))??!1))return Y.currentRenderPassId=l,!1}}Y.currentRenderPassId=l}}}for(const M of this._internalMeshDataInfo._LODLevels)if(M.mesh&&!M.mesh.isReady(E))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}UD(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(z){this._instanceDataStorage.overridenInstanceCount=z}_preActivate(){const z=this._internalMeshDataInfo,u=this.iz().getRenderId();return z._preActivateId===u||(z._preActivateId=u,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(z){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=z),this}_registerInstanceForRenderId(z,u){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:u,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[u]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=u,this._instanceDataStorage.visibleInstances[u]=new Array),this._instanceDataStorage.visibleInstances[u].push(z),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Rz||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let z,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;z="object"===typeof u?u:{applySkeleton:u,applyMorph:Y};const H=this.Sl?this.Sl.boundingBias:null;return this.cz(this._getData(z,null,M.f.PositionKind),H),this}_createGlobalSubMesh(z){const u=this.getTotalVertices();if(!u||!this.Il())return null;if(this.YT&&this.YT.length>0){const Y=this.Il();if(!Y)return null;const H=Y.length;let E=!1;if(z)E=!0;else for(const z of this.YT){if(z.indexStart+z.indexCount>H){E=!0;break}if(z.verticesStart+z.verticesCount>u){E=!0;break}}if(!E)return this.YT[0]}return this.releaseSubMeshes(),new h.d(0,0,u,0,this.getTotalIndices()||u,this)}subdivide(z){if(z<1)return;const u=this.getTotalIndices();let Y=u/z|0,H=0;for(;Y%3!==0;)Y++;this.releaseSubMeshes();for(let E=0;E<z&&!(H>=u);E++)h.d.CreateFromIndices(0,H,E===z-1?u-H:Y,this,void 0,!1),H+=Y;this.refreshBoundingInfo(),this.synchronizeInstances()}Uz(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Uz(z,u,Y,H);else{const H=new q.e;H.set(u,z);const E=this.iz();new C.b(C.b.RandomId(),E,H,Y,this)}return this}removeVerticesData(z){this._geometry&&this._geometry.removeVerticesData(z)}markVerticesDataAsUpdatable(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this.getVertexBuffer(z);Y&&Y.isUpdatable()!==u&&this.Uz(z,this.getVerticesData(z),u)}setVerticesBuffer(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=C.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(z,null,u),this}updateVerticesData(z,u,Y,H){return this._geometry?(H?(this.makeGeometryUnique(),this.updateVerticesData(z,u,Y,!1)):this._geometry.updateVerticesData(z,u,Y),this):this}updateMeshPositions(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this.getVerticesData(M.f.PositionKind);if(!Y)return this;if(z(Y),this.updateVerticesData(M.f.PositionKind,Y,!1,!1),u){const z=this.Il(),u=this.getVerticesData(M.f.NormalKind);if(!u)return this;q.e.ComputeNormals(Y,z,u),this.updateVerticesData(M.f.NormalKind,u,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const z=this._geometry,u=this._geometry.j(C.b.RandomId());return z.releaseForMesh(this,!0),u.Fz(this),this}setIndexBuffer(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=this._geometry;E||(E=new C.b(C.b.RandomId(),this.iz(),void 0,void 0,this)),E.setIndexBuffer(z,u,Y,H)}setIndices(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(z,u,Y,H);else{const u=new q.e;u.indices=z;const H=this.iz();new C.b(C.b.RandomId(),H,u,Y,this)}return this}updateIndices(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(z,u,Y),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(z,u,Y){let H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const E=this.iz().getEngine();let J;if(this._unIndexed)if(this._getRenderingFillMode(Y)===o.d.WireFrameFillMode)J=z._getLinesIndexBuffer(this.Il(),E);else J=null;else switch(this._getRenderingFillMode(Y)){case o.d.PointFillMode:J=null;break;case o.d.WireFrameFillMode:J=z._getLinesIndexBuffer(this.Il(),E);break;default:case o.d.TriangleFillMode:J=this._geometry.getIndexBuffer()}return this._bindDirect(u,J,H)}_bindDirect(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(z),Y&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(z,u,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(z,u),this):this}_draw(z,u,Y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const H=this.iz().getEngine();return this._unIndexed&&u!==o.d.WireFrameFillMode||u==o.d.PointFillMode?H.drawArraysType(u,z.verticesStart,z.verticesCount,this.forcedInstanceCount||Y):u==o.d.WireFrameFillMode?H.drawElementsType(u,0,z._linesIndexCount,this.forcedInstanceCount||Y):H.drawElementsType(u,z.indexStart,z.indexCount,this.forcedInstanceCount||Y),this}registerBeforeRender(z){return this.onBeforeRenderObservable.add(z),this}unregisterBeforeRender(z){return this.onBeforeRenderObservable.removeCallback(z),this}registerAfterRender(z){return this.onAfterRenderObservable.add(z),this}unregisterAfterRender(z){return this.onAfterRenderObservable.removeCallback(z),this}_getInstancesRenderList(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(u)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[z]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[z]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const Y=this.iz(),H=Y._isInIntermediateRendering(),E=H?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,J=this._instanceDataStorage.batchCache;if(J.mustReturn=!1,J.renderSelf[z]=u||!E&&this.isEnabled()&&this.isVisible,J.visibleInstances[z]=null,this._instanceDataStorage.visibleInstances&&!u){const u=this._instanceDataStorage.visibleInstances,E=Y.getRenderId(),l=H?u.intermediateDefaultRenderId:u.defaultRenderId;J.visibleInstances[z]=u[E],!J.visibleInstances[z]&&l&&(J.visibleInstances[z]=u[l])}return J.hardwareInstancedRendering[z]=!u&&this._instanceDataStorage.hardwareInstancedRendering&&null!==J.visibleInstances[z]&&void 0!==J.visibleInstances[z],this._instanceDataStorage.previousBatch=J,J}_updateInstancedBuffers(z,u,Y,H,E,J){const l=u.visibleInstances[z._id],T=l?l.length:0,b=this._instanceDataStorage;let D=b.instancesBuffer,g=b.instancesPreviousBuffer,q=0,C=0;const K=u.renderSelf[z._id],h=!D||Y!==b.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!b.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||b.isFrozen&&!h)C=(K?1:0)+T;else{const u=this.getWorldMatrix();if(K&&(this._scene.needsPreviousWorldMatrices&&(b.masterMeshPreviousWorldMatrix?(b.masterMeshPreviousWorldMatrix.copyToArray(b.instancesPreviousData,q),b.masterMeshPreviousWorldMatrix.J(u)):(b.masterMeshPreviousWorldMatrix=u.clone(),b.masterMeshPreviousWorldMatrix.copyToArray(b.instancesPreviousData,q))),u.copyToArray(b.instancesData,q),q+=16,C++),l){var o;if(R.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(o=z.Oz())&&void 0!==o&&o.needAlphaBlendingForMesh(z.getRenderingMesh())){const z=this._scene.activeCamera.globalPosition;for(let u=0;u<l.length;u++){const Y=l[u];Y._distanceToCamera=L.p.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,z)}l.sort(((z,u)=>z._distanceToCamera>u._distanceToCamera?-1:z._distanceToCamera<u._distanceToCamera?1:0))}for(let z=0;z<l.length;z++){const u=l[z],Y=u.getWorldMatrix();Y.copyToArray(b.instancesData,q),this._scene.needsPreviousWorldMatrices&&(u._previousWorldMatrix?(u._previousWorldMatrix.copyToArray(b.instancesPreviousData,q),u._previousWorldMatrix.J(Y)):(u._previousWorldMatrix=Y.clone(),u._previousWorldMatrix.copyToArray(b.instancesPreviousData,q))),q+=16,C++}}}h?(D&&D.dispose(),g&&g.dispose(),D=new M.d(H,b.instancesData,!0,16,!1,!0),b.instancesBuffer=D,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=D.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=D.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=D.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=D.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(g=new M.d(H,b.instancesPreviousData,!0,16,!1,!0),b.instancesPreviousBuffer=g,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=g.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=g.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=g.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=g.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(D.updateDirectly(b.instancesData,0,C),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||g.updateDirectly(b.instancesPreviousData,0,C)),this._processInstancedBuffers(l,K),J&&void 0!==E&&(this.iz()._activeIndices.addCount(z.indexCount*C,!1),H._currentDrawContext&&(H._currentDrawContext.useInstancing=!0),this._bind(z,J,E),this._draw(z,E,C)),!this._scene.needsPreviousWorldMatrices||h||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||g.updateDirectly(b.instancesData,0,C)}_renderWithInstances(z,u,Y,H,E){const J=Y.visibleInstances[z._id],l=J?J.length:0,T=this._instanceDataStorage,b=T.instancesBufferSize,L=16*(l+1)*4;for(;T.instancesBufferSize<L;)T.instancesBufferSize*=2;return T.instancesData&&b==T.instancesBufferSize||(T.instancesData=new Float32Array(T.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!T.instancesPreviousData||b!=T.instancesBufferSize)&&(T.instancesPreviousData=new Float32Array(T.instancesBufferSize/4)),this._updateInstancedBuffers(z,Y,b,E,u,H),E.unbindInstanceAttributes(),this}_renderWithThinInstances(z,u,Y,H){var E;const J=(null===(E=this._thinInstanceDataStorage)||void 0===E?void 0:E.instancesCount)??0;this.iz()._activeIndices.addCount(z.indexCount*J,!1),H._currentDrawContext&&(H._currentDrawContext.useInstancing=!0),this._bind(z,Y,u),this._draw(z,u,J),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,J):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),H.unbindInstanceAttributes()}_processInstancedBuffers(z,u){}_processRendering(z,u,Y,H,E,J,l,T){const b=this.iz(),L=b.getEngine();if(H=this._getRenderingFillMode(H),J&&u.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(u,H,Y,L),this;if(J)this._renderWithInstances(u,H,E,Y,L);else{L._currentDrawContext&&(L._currentDrawContext.useInstancing=!1);let Y=0;E.renderSelf[u._id]&&(l&&l(!1,z.getWorldMatrix(),T),Y++,this._draw(u,H,this._instanceDataStorage.overridenInstanceCount));const J=E.visibleInstances[u._id];if(J){const z=J.length;Y+=z;for(let Y=0;Y<z;Y++){const z=J[Y].getWorldMatrix();l&&l(!0,z,T),this._draw(u,H)}}b._activeIndices.addCount(u.indexCount*Y,!1)}return this}_rebuild(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(z&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const u in this._userInstancedBuffersStorage.vertexBuffers){const Y=this._userInstancedBuffersStorage.vertexBuffers[u];Y&&(z&&Y.dispose(),this._userInstancedBuffersStorage.vertexBuffers[u]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(z)}_freeze(){if(this.YT){for(let z=0;z<this.YT.length;z++)this._getInstancesRenderList(z);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(z,u,Y,H){let E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const J=this._scene.getEngine(),l=J.currentRenderPassId;if(void 0!==z&&(J.currentRenderPassId=z),H)(!E||E&&H.isInFrustum(this._scene._frustumPlanes))&&this.render(H,!!u,Y);else for(let T=0;T<this.YT.length;T++){const z=this.YT[T];(!E||E&&z.isInFrustum(this._scene._frustumPlanes))&&this.render(z,!!u,Y)}return void 0!==z&&(J.currentRenderPassId=l),this}directRender(){if(!this.YT)return this;for(const z of this.YT)this.render(z,!1);return this}render(z,u,Y){var H,E,J;const l=this.iz();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const T=(null===(H=l.activeCameras)||void 0===H?void 0:H.length)??0;if((T>1&&l.activeCamera===l.activeCameras[0]||T<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const b=this._getInstancesRenderList(z._id,!!Y);if(b.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const L=l.getEngine();let D=0,g=null;this.ignoreCameraMaxZ&&l.activeCamera&&!l._isInIntermediateRendering()&&(D=l.activeCamera.maxZ,g=l.activeCamera,l.activeCamera.maxZ=0,l.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const M=z.getRenderingMesh(),q=b.hardwareInstancedRendering[z._id]||M.hasThinInstances||!!this._userInstancedBuffersStorage&&!z.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,C=this._instanceDataStorage,K=z.Oz();if(!K)return g&&(g.maxZ=D,l.updateTransformMatrix(!0)),this;if(C.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===K){if(K._storeEffectOnSubMeshes&&(null===(E=z._drawWrapper)||void 0===E||!E._wasPreviouslyReady)||!K._storeEffectOnSubMeshes&&!K._getDrawWrapper()._wasPreviouslyReady)return g&&(g.maxZ=D,l.updateTransformMatrix(!0)),this}else{if(K._storeEffectOnSubMeshes){if(!K.isReadyForSubMesh(this,z,q))return g&&(g.maxZ=D,l.updateTransformMatrix(!0)),this}else if(!K.isReady(this,q))return g&&(g.maxZ=D,l.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=K}let h;u&&L.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),h=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?z._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const d=(null===(J=h)||void 0===J?void 0:J.effect)??null;for(const o of l._beforeRenderingMeshStage)o.action(this,z,b,d);if(!h||!d)return g&&(g.maxZ=D,l.updateTransformMatrix(!0)),this;const t=Y||this;let W;if(C.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.yl&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)W=C.sideOrientation;else{const z=t._getWorldMatrixDeterminant();W=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),z<0&&(W=W===o.d.ClockWiseSideOrientation?o.d.CounterClockWiseSideOrientation:o.d.ClockWiseSideOrientation),C.sideOrientation=W}const Z=this._internalMeshDataInfo._effectiveMaterial._preBind(h,W);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&L.setDepthWrite(!0);const s=this._internalMeshDataInfo._effectiveMaterial,v=s.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),q||this._bind(z,d,v,!1);const i=t.getWorldMatrix();s._storeEffectOnSubMeshes?s.bindForSubMesh(i,this,z):s.bind(i,this),!s.yl&&s.separateCullingPass&&(L.setState(!0,s.zOffset,!1,!Z,s.cullBackFaces,s.stencil,s.zOffsetUnits),this._processRendering(this,z,d,v,b,q,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),L.setState(!0,s.zOffset,!1,Z,s.cullBackFaces,s.stencil,s.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(z)),this._processRendering(this,z,d,v,b,q,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const o of l._afterRenderingMeshStage)o.action(this,z,b,d);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),g&&(g.maxZ=D,l.updateTransformMatrix(!0)),2!==l.performancePriority||C.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(M.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(M.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const z=this.getVerticesData(M.f.MatricesWeightsKind),u=z.length;for(let Y=0;Y<u;Y+=4){const u=z[Y]+z[Y+1]+z[Y+2]+z[Y+3];if(0===u)z[Y]=1;else{const H=1/u;z[Y]*=H,z[Y+1]*=H,z[Y+2]*=H,z[Y+3]*=H}}this.Uz(M.f.MatricesWeightsKind,z)}_normalizeSkinWeightsAndExtra(){const z=this.getVerticesData(M.f.MatricesWeightsExtraKind),u=this.getVerticesData(M.f.MatricesWeightsKind),Y=u.length;for(let H=0;H<Y;H+=4){let Y=u[H]+u[H+1]+u[H+2]+u[H+3];if(Y+=z[H]+z[H+1]+z[H+2]+z[H+3],0===Y)u[H]=1;else{const E=1/Y;u[H]*=E,u[H+1]*=E,u[H+2]*=E,u[H+3]*=E,z[H]*=E,z[H+1]*=E,z[H+2]*=E,z[H+3]*=E}}this.Uz(M.f.MatricesWeightsKind,u),this.Uz(M.f.MatricesWeightsKind,z)}validateSkinning(){const z=this.getVerticesData(M.f.MatricesWeightsExtraKind),u=this.getVerticesData(M.f.MatricesWeightsKind);if(null===u||null==this.skeleton)return{skinned:!1,valid:!0,dK:"not skinned"};const Y=u.length;let H=0,E=0,J=0,l=0;const T=null===z?4:8,b=[];for(let M=0;M<=T;M++)b[M]=0;for(let M=0;M<Y;M+=4){let Y=u[M],L=Y,D=0===L?0:1;for(let E=1;E<T;E++){const J=E<4?u[M+E]:z[M+E-4];J>Y&&H++,0!==J&&D++,L+=J,Y=J}if(b[D]++,D>J&&(J=D),0===L)E++;else{const Y=1/L;let H=0;for(let E=0;E<T;E++)H+=E<4?Math.abs(u[M+E]-u[M+E]*Y):Math.abs(z[M+E-4]-z[M+E-4]*Y);H>.001&&l++}}const L=this.skeleton.bones.length,D=this.getVerticesData(M.f.MatricesIndicesKind),g=this.getVerticesData(M.f.MatricesIndicesExtraKind);let q=0;for(let M=0;M<Y;M+=4)for(let z=0;z<T;z++){const u=z<4?D[M+z]:g[M+z-4];(u>=L||u<0)&&q++}return{skinned:!0,valid:0===E&&0===l&&0===q,dK:"Number of Weights = "+Y/4+"\nMaximum influences = "+J+"\nMissing Weights = "+E+"\nNot Sorted = "+H+"\nNot Normalized = "+l+"\nWeightCounts = ["+b+"]\nNumber of bones = "+L+"\nBad Bone Indices = "+q}}_checkDelayState(){const z=this.iz();return this._geometry?this._geometry.load(z):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(z)),this}_queueLoad(z){z.addPendingData(this);const u=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return E.e.LoadFile(this.delayLoadingFile,(u=>{u instanceof ArrayBuffer?this._delayLoadingFunction(u,this):this._delayLoadingFunction(JSON.parse(u),this);for(const z of this.instances)z.refreshBoundingInfo(),z._syncSubMeshes();this.delayLoadState=1,z.removePendingData(this)}),(()=>{}),z.offlineProvider,u),this}isInFrustum(z){return 2!==this.delayLoadState&&(!!super.isInFrustum(z)&&(this._checkDelayState(),!0))}setMaterialById(z){const u=this.iz().materials;let Y;for(Y=u.length-1;Y>-1;Y--)if(u[Y].id===z)return this.material=u[Y],this;const H=this.iz().multiMaterials;for(Y=H.length-1;Y>-1;Y--)if(H[Y].id===z)return this.material=H[Y],this;return this}getAnimatables(){const z=[];return this.material&&z.push(this.material),this.skeleton&&z.push(this.skeleton),z}bakeTransformIntoVertices(z){if(!this.isVerticesDataPresent(M.f.PositionKind))return this;const u=this.YT.splice(0);this._resetPointsArrayCache();let Y=this.getVerticesData(M.f.PositionKind);const H=L.p.Zero();let E;for(E=0;E<Y.length;E+=3)L.p.TransformCoordinatesFromFloatsToRef(Y[E],Y[E+1],Y[E+2],z,H).toArray(Y,E);if(this.Uz(M.f.PositionKind,Y,this.getVertexBuffer(M.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(M.f.NormalKind)){for(Y=this.getVerticesData(M.f.NormalKind),E=0;E<Y.length;E+=3)L.p.TransformNormalFromFloatsToRef(Y[E],Y[E+1],Y[E+2],z,H).normalize().toArray(Y,E);this.Uz(M.f.NormalKind,Y,this.getVertexBuffer(M.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(M.f.TangentKind)){for(Y=this.getVerticesData(M.f.TangentKind),E=0;E<Y.length;E+=4)L.p.TransformNormalFromFloatsToRef(Y[E],Y[E+1],Y[E+2],z,H).normalize().toArray(Y,E);this.Uz(M.f.TangentKind,Y,this.getVertexBuffer(M.f.TangentKind).isUpdatable())}return z.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.YT=u,this}bakeCurrentTransformIntoVertices(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.pl(!0)),this.resetLocalMatrix(z),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(u&&void 0===u._addToSceneRootNodes){const Y=u;return F.source=this,F.doNotCloneChildren=Y.doNotCloneChildren,F.clonePhysicsImpostor=Y.clonePhysicsImpostor,F.cloneThinInstances=Y.cloneThinInstances,new R(z,this.iz(),F)}return new R(z,this.iz(),u,this,Y,H)}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const Y=this._internalMeshDataInfo;if(Y._onBeforeDrawObservable&&Y._onBeforeDrawObservable.clear(),Y._onBeforeBindObservable&&Y._onBeforeBindObservable.clear(),Y._onBeforeRenderObservable&&Y._onBeforeRenderObservable.clear(),Y._onAfterRenderObservable&&Y._onAfterRenderObservable.clear(),Y._onBetweenPassObservable&&Y._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(Y.meshMap)for(const z in Y.meshMap){const u=Y.meshMap[z];u&&(u._internalMeshDataInfo._source=null,Y.meshMap[z]=void 0)}Y._source&&Y._source._internalMeshDataInfo.meshMap&&(Y._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const z=this.iz().meshes;for(const u of z){const z=u;z._internalMeshDataInfo&&z._internalMeshDataInfo._source&&z._internalMeshDataInfo._source===this&&(z._internalMeshDataInfo._source=null)}}Y._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(z,u)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(z,u,Y,H,J,l){let T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0;const L=this.iz();return E.e.LoadImage(z,(z=>{const E=z.width,b=z.height,L=this.getEngine().createCanvas(E,b).getContext("2d");L.drawImage(z,0,0);const D=L.getImageData(0,0,E,b).data;this.applyDisplacementMapFromBuffer(D,E,b,u,Y,J,l,T),H&&H(this)}),b||(()=>{}),L.offlineProvider),this}applyDisplacementMapFromBuffer(z,u,Y,H,E,J,l){let T=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(M.f.PositionKind)||!this.isVerticesDataPresent(M.f.NormalKind)||!this.isVerticesDataPresent(M.f.UVKind))return Z.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const b=this.getVerticesData(M.f.PositionKind,!0,!0),D=this.getVerticesData(M.f.NormalKind),g=this.getVerticesData(M.f.UVKind);let C=L.p.Zero();const K=L.p.Zero(),h=L.m.Zero();J=J||L.m.Zero(),l=l||new L.m(1,1);for(let M=0;M<b.length;M+=3){L.p.FromArrayToRef(b,M,C),L.p.FromArrayToRef(D,M,K),L.m.FromArrayToRef(g,M/3*2,h);const T=4*((Math.abs(h.x*l.x+J.x%1)*(u-1)%u|0)+(Math.abs(h.y*l.y+J.y%1)*(Y-1)%Y|0)*u),q=.3*(z[T]/255)+.59*(z[T+1]/255)+.11*(z[T+2]/255);K.normalize(),K.scaleInPlace(H+(E-H)*q),C=C.add(K),C.toArray(b,M)}return q.e.ComputeNormals(b,this.Il(),D),T?(this.Uz(M.f.PositionKind,b),this.Uz(M.f.NormalKind,D),this.Uz(M.f.UVKind,g)):(this.updateVerticesData(M.f.PositionKind,b),this.updateVerticesData(M.f.NormalKind,D)),this}_getFlattenedNormals(z,u){const Y=new Float32Array(3*z.length);let H=0;const E=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let J=0;J<z.length;J+=3){const l=L.p.Nl(u,3*z[J]),T=L.p.Nl(u,3*z[J+1]),b=L.p.Nl(u,3*z[J+2]),D=l.JY(T),g=b.JY(T),M=L.p.Normalize(L.p.Cross(D,g));E&&M.scaleInPlace(-1);for(let z=0;z<3;z++)Y[H++]=M.x,Y[H++]=M.y,Y[H++]=M.z}return Y}_convertToUnIndexedMesh(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.getVerticesDataKinds().filter((z=>{var u;return!(null!==(u=this.getVertexBuffer(z))&&void 0!==u&&u.getIsInstanced())})),Y=this.Il(),H={},E=(z,u)=>{const H=new Float32Array(Y.length*u);let E=0;for(let J=0;J<Y.length;J++)for(let l=0;l<u;l++)H[E++]=z[Y[J]*u+l];return H},J=this.getBoundingInfo(),l=this.Sl?this.YT.slice(0):[];for(const T of u)H[T]=this.getVerticesData(T);for(const T of u){const u=this.getVertexBuffer(T),J=u.getSize();if(z&&T===M.f.NormalKind){const z=this._getFlattenedNormals(Y,H[M.f.PositionKind]);this.Uz(M.f.NormalKind,z,u.isUpdatable(),J)}else this.Uz(T,E(H[T],J),u.isUpdatable(),J)}if(this.morphTargetManager){for(let u=0;u<this.morphTargetManager.numTargets;u++){const H=this.morphTargetManager.getTarget(u),J=H.getPositions();H.setPositions(E(J,3));const l=H.getNormals();l&&H.setNormals(z?this._getFlattenedNormals(Y,J):E(l,3));const T=H.getTangents();T&&H.setTangents(E(T,3));const b=H.getUVs();b&&H.setUVs(E(b,2));const L=H.getColors();L&&H.setColors(E(L,4))}this.morphTargetManager.synchronize()}for(let T=0;T<Y.length;T++)Y[T]=T;this.setIndices(Y),this._unIndexed=!0,this.releaseSubMeshes();for(const T of l){const z=T.getBoundingInfo();h.d.AddToMesh(T.materialIndex,T.indexStart,T.indexCount,T.indexStart,T.indexCount,this).setBoundingInfo(z)}return this.setBoundingInfo(J),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=q.e.ExtractFromMesh(this);let Y;if(z&&this.isVerticesDataPresent(M.f.NormalKind)&&u.Vz){for(Y=0;Y<u.Vz.length;Y++)u.Vz[Y]*=-1;this.Uz(M.f.NormalKind,u.Vz,this.isVertexBufferUpdatable(M.f.NormalKind))}if(u.indices){let z;for(Y=0;Y<u.indices.length;Y+=3)z=u.indices[Y+1],u.indices[Y+1]=u.indices[Y+2],u.indices[Y+2]=z;this.setIndices(u.indices,null,this.isVertexBufferUpdatable(M.f.PositionKind),!0)}return this}increaseVertices(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const u=q.e.ExtractFromMesh(this),Y=u.indices&&!Array.isArray(u.indices)&&Array.from?Array.from(u.indices):u.indices,H=u.Qz&&!Array.isArray(u.Qz)&&Array.from?Array.from(u.Qz):u.Qz,E=u.xz&&!Array.isArray(u.xz)&&Array.from?Array.from(u.xz):u.xz,J=u.Vz&&!Array.isArray(u.Vz)&&Array.from?Array.from(u.Vz):u.Vz;if(Y&&H){u.indices=Y,u.Qz=H,E&&(u.xz=E),J&&(u.Vz=J);const l=z+1,T=[];for(let z=0;z<l+1;z++)T[z]=[];let b,D;const g=new L.p(0,0,0),q=new L.p(0,0,0),C=new L.m(0,0),K=[],h=[],o=[];let d,t,W,Z=H.length;E&&(t=E.length),J&&(W=J.length);for(let z=0;z<Y.length;z+=3){h[0]=Y[z],h[1]=Y[z+1],h[2]=Y[z+2];for(let z=0;z<3;z++)if(b=h[z],D=h[(z+1)%3],void 0===o[b]&&void 0===o[D]?(o[b]=[],o[D]=[]):(void 0===o[b]&&(o[b]=[]),void 0===o[D]&&(o[D]=[])),void 0===o[b][D]&&void 0===o[D][b]){o[b][D]=[],g.x=(H[3*D]-H[3*b])/l,g.y=(H[3*D+1]-H[3*b+1])/l,g.z=(H[3*D+2]-H[3*b+2])/l,J&&(q.x=(J[3*D]-J[3*b])/l,q.y=(J[3*D+1]-J[3*b+1])/l,q.z=(J[3*D+2]-J[3*b+2])/l),E&&(C.x=(E[2*D]-E[2*b])/l,C.y=(E[2*D+1]-E[2*b+1])/l),o[b][D].push(b);for(let z=1;z<l;z++)o[b][D].push(H.length/3),H[Z++]=H[3*b]+z*g.x,H[Z++]=H[3*b+1]+z*g.y,H[Z++]=H[3*b+2]+z*g.z,J&&(J[W++]=J[3*b]+z*q.x,J[W++]=J[3*b+1]+z*q.y,J[W++]=J[3*b+2]+z*q.z),E&&(E[t++]=E[2*b]+z*C.x,E[t++]=E[2*b+1]+z*C.y);o[b][D].push(D),o[D][b]=[],d=o[b][D].length;for(let z=0;z<d;z++)o[D][b][z]=o[b][D][d-1-z]}T[0][0]=Y[z],T[1][0]=o[Y[z]][Y[z+1]][1],T[1][1]=o[Y[z]][Y[z+2]][1];for(let u=2;u<l;u++){T[u][0]=o[Y[z]][Y[z+1]][u],T[u][u]=o[Y[z]][Y[z+2]][u],g.x=(H[3*T[u][u]]-H[3*T[u][0]])/u,g.y=(H[3*T[u][u]+1]-H[3*T[u][0]+1])/u,g.z=(H[3*T[u][u]+2]-H[3*T[u][0]+2])/u,J&&(q.x=(J[3*T[u][u]]-J[3*T[u][0]])/u,q.y=(J[3*T[u][u]+1]-J[3*T[u][0]+1])/u,q.z=(J[3*T[u][u]+2]-J[3*T[u][0]+2])/u),E&&(C.x=(E[2*T[u][u]]-E[2*T[u][0]])/u,C.y=(E[2*T[u][u]+1]-E[2*T[u][0]+1])/u);for(let z=1;z<u;z++)T[u][z]=H.length/3,H[Z++]=H[3*T[u][0]]+z*g.x,H[Z++]=H[3*T[u][0]+1]+z*g.y,H[Z++]=H[3*T[u][0]+2]+z*g.z,J&&(J[W++]=J[3*T[u][0]]+z*q.x,J[W++]=J[3*T[u][0]+1]+z*q.y,J[W++]=J[3*T[u][0]+2]+z*q.z),E&&(E[t++]=E[2*T[u][0]]+z*C.x,E[t++]=E[2*T[u][0]+1]+z*C.y)}T[l]=o[Y[z+1]][Y[z+2]],K.push(T[0][0],T[1][0],T[1][1]);for(let z=1;z<l;z++){let u;for(u=0;u<z;u++)K.push(T[z][u],T[z+1][u],T[z+1][u+1]),K.push(T[z][u],T[z+1][u+1],T[z][u+1]);K.push(T[z][u],T[z+1][u],T[z+1][u+1])}}u.indices=K,u.Fz(this,this.isVertexBufferUpdatable(M.f.PositionKind))}else Z.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const z=q.e.ExtractFromMesh(this),u=z.xz,Y=z.indices,H=z.Qz,E=z.Az,J=z.matricesIndices,l=z.matricesWeights,T=z.matricesIndicesExtra,b=z.matricesWeightsExtra;if(void 0===Y||void 0===H||null===Y||null===H)Z.b.Warn("VertexData contains empty entries");else{const L=[],D=[],g=[],C=[],K=[],h=[],o=[],d=[];let t=[],W=0;const Z={};let s,v;for(let z=0;z<Y.length;z+=3){v=[Y[z],Y[z+1],Y[z+2]],t=[];for(let z=0;z<3;z++){t[z]="";for(let u=0;u<3;u++)Math.abs(H[3*v[z]+u])<1e-8&&(H[3*v[z]+u]=0),t[z]+=H[3*v[z]+u]+"|"}if(t[0]!=t[1]&&t[0]!=t[2]&&t[1]!=t[2])for(let z=0;z<3;z++){if(s=Z[t[z]],void 0===s){Z[t[z]]=W,s=W++;for(let u=0;u<3;u++)L.push(H[3*v[z]+u]);if(null!==E&&void 0!==E)for(let u=0;u<4;u++)C.push(E[4*v[z]+u]);if(null!==u&&void 0!==u)for(let Y=0;Y<2;Y++)g.push(u[2*v[z]+Y]);if(null!==J&&void 0!==J)for(let u=0;u<4;u++)K.push(J[4*v[z]+u]);if(null!==l&&void 0!==l)for(let u=0;u<4;u++)h.push(l[4*v[z]+u]);if(null!==T&&void 0!==T)for(let u=0;u<4;u++)o.push(T[4*v[z]+u]);if(null!==b&&void 0!==b)for(let u=0;u<4;u++)d.push(b[4*v[z]+u])}D.push(s)}}const i=[];q.e.ComputeNormals(L,D,i),z.Qz=L,z.indices=D,z.Vz=i,null!==u&&void 0!==u&&(z.xz=g),null!==E&&void 0!==E&&(z.Az=C),null!==J&&void 0!==J&&(z.matricesIndices=K),null!==l&&void 0!==l&&(z.matricesWeights=h),null!==T&&void 0!==T&&(z.matricesIndicesExtra=o),null!==l&&void 0!==l&&(z.matricesWeightsExtra=d),z.Fz(this,this.isVertexBufferUpdatable(M.f.PositionKind))}}static _instancedMeshFactory(z,u){throw(0,v.e)("InstancedMesh")}static _PhysicsImpostorParser(z,u,Y){throw(0,v.e)("PhysicsImpostor")}createInstance(z){const u=R._instancedMeshFactory(z,this);return u.parent=this.parent,u}synchronizeInstances(){for(let z=0;z<this.instances.length;z++){this.instances[z]._syncSubMeshes()}return this}optimizeIndices(z){const u=this.Il(),Y=this.getVerticesData(M.f.PositionKind);if(!Y||!u)return this;const H=[];for(let E=0;E<Y.length;E+=3)H.push(L.p.Nl(Y,E));const J=[];return E.b.SyncAsyncForLoop(H.length,40,(z=>{const u=H.length-1-z,Y=H[u];for(let E=0;E<u;++E){const z=H[E];if(Y.equals(z)){J[u]=E;break}}}),(()=>{for(let z=0;z<u.length;++z)u[z]=J[u[z]]||u[z];const Y=this.YT.slice(0);this.setIndices(u),this.YT=Y,z&&z(this)})),this}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.name=this.name,z.id=this.id,z.uniqueId=this.uniqueId,z.type=this.getClassName(),l.e&&l.e.HasTags(this)&&(z.tags=l.e.GetTags(this)),z.position=this.position.al(),this.rotationQuaternion?z.rotationQuaternion=this.rotationQuaternion.al():this.rotation&&(z.rotation=this.rotation.al()),z.el=this.el.al(),this._postMultiplyPivotMatrix?z.pivotMatrix=this.getPivotMatrix().al():z.localMatrix=this.getPivotMatrix().al(),z.isEnabled=this.isEnabled(!1),z.isVisible=this.isVisible,z.infiniteDistance=this.infiniteDistance,z.pickable=this.YL,z.receiveShadows=this.receiveShadows,z.billboardMode=this.billboardMode,z.visibility=this.visibility,z.qT=this.qT,z.checkCollisions=this.checkCollisions,z.ellipsoid=this.ellipsoid.al(),z.ellipsoidOffset=this.ellipsoidOffset.al(),z.Rz=this.Rz,z.isBlocker=this.isBlocker,z.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(z),z.isUnIndexed=this.isUnIndexed;const u=this._geometry;if(u&&this.YT){z.geometryUniqueId=u.uniqueId,z.geometryId=u.id,z.YT=[];for(let u=0;u<this.YT.length;u++){const Y=this.YT[u];z.YT.push({materialIndex:Y.materialIndex,verticesStart:Y.verticesStart,verticesCount:Y.verticesCount,indexStart:Y.indexStart,indexCount:Y.indexCount})}}if(this.material?this.material.doNotSerialize||(z.materialUniqueId=this.material.uniqueId,z.materialId=this.material.id):(this.material=null,z.materialUniqueId=this._scene.defaultMaterial.uniqueId,z.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(z.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(z.skeletonId=this.skeleton.id,z.numBoneInfluencers=this.numBoneInfluencers),this.iz()._getComponent(i.c.NAME_PHYSICSENGINE)){const u=this.getPhysicsImpostor();u&&(z.physicsMass=u.getParam("zE"),z.physicsFriction=u.getParam("friction"),z.physicsRestitution=u.getParam("zE"),z.physicsImpostor=u.type)}this.metadata&&(z.metadata=this.metadata),z.instances=[];for(let Y=0;Y<this.instances.length;Y++){const u=this.instances[Y];if(u.doNotSerialize)continue;const H={name:u.name,id:u.id,isEnabled:u.isEnabled(!1),isVisible:u.isVisible,YL:u.YL,checkCollisions:u.checkCollisions,position:u.position.al(),el:u.el.al()};if(u.parent&&u.parent._serializeAsParent(H),u.rotationQuaternion?H.rotationQuaternion=u.rotationQuaternion.al():u.rotation&&(H.rotation=u.rotation.al()),this.iz()._getComponent(i.c.NAME_PHYSICSENGINE)){const z=u.getPhysicsImpostor();z&&(H.physicsMass=z.getParam("zE"),H.physicsFriction=z.getParam("friction"),H.physicsRestitution=z.getParam("zE"),H.physicsImpostor=z.type)}u.metadata&&(H.metadata=u.metadata),u.actionManager&&(H.actions=u.actionManager.serialize(u.name)),z.instances.push(H),W.d.AppendSerializedAnimations(u,H),H.ranges=u.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(z.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const u={data:{},sizes:{},strides:{}};for(const z in this._userThinInstanceBuffersStorage.data)u.data[z]=Array.from(this._userThinInstanceBuffersStorage.data[z]),u.sizes[z]=this._userThinInstanceBuffersStorage.sizes[z],u.strides[z]=this._userThinInstanceBuffersStorage.strides[z];z.thinInstances.userThinInstance=u}return W.d.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.layerMask=this.layerMask,z.alphaIndex=this.alphaIndex,z.hasVertexAlpha=this.hasVertexAlpha,z.overlayAlpha=this.overlayAlpha,z.overlayColor=this.overlayColor.al(),z.renderOverlay=this.renderOverlay,z.applyFog=this.applyFog,this.actionManager&&(z.actions=this.actionManager.serialize(this.name)),z}_syncGeometryWithMorphTargetManager(){if(!this.Sl)return;this._markSubMeshesAsAttributesDirty();const z=this._internalAbstractMeshDataInfo._morphTargetManager;if(z&&z.vertexCount){if(z.vertexCount!==this.getTotalVertices())return Z.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(z.isUsingTextureForTargets)return;for(let u=0;u<z.numInfluencers;u++){const Y=z.getActiveTarget(u),H=Y.getPositions();if(!H)return void Z.b.Error("Invalid morph target. Target must have positions.");this.Sl.Uz(M.f.PositionKind+u,H,!1,3);const E=Y.getNormals();E&&this.Sl.Uz(M.f.NormalKind+u,E,!1,3);const J=Y.getTangents();J&&this.Sl.Uz(M.f.TangentKind+u,J,!1,3);const l=Y.getUVs();l&&this.Sl.Uz(M.f.UVKind+"_"+u,l,!1,2);const T=Y.getUV2s();T&&this.Sl.Uz(M.f.UV2Kind+"_"+u,T,!1,2);const b=Y.getColors();b&&this.Sl.Uz(M.f.ColorKind+u,b,!1,4)}}else{let z=0;for(;this.Sl.isVerticesDataPresent(M.f.PositionKind+z);)this.Sl.removeVerticesData(M.f.PositionKind+z),this.Sl.isVerticesDataPresent(M.f.NormalKind+z)&&this.Sl.removeVerticesData(M.f.NormalKind+z),this.Sl.isVerticesDataPresent(M.f.TangentKind+z)&&this.Sl.removeVerticesData(M.f.TangentKind+z),this.Sl.isVerticesDataPresent(M.f.UVKind+z)&&this.Sl.removeVerticesData(M.f.UVKind+"_"+z),this.Sl.isVerticesDataPresent(M.f.UV2Kind+z)&&this.Sl.removeVerticesData(M.f.UV2Kind+"_"+z),this.Sl.isVerticesDataPresent(M.f.ColorKind+z)&&this.Sl.removeVerticesData(M.f.ColorKind+z),z++}}static Parse(z,u,Y){let H;if(H=z.type&&"LinesMesh"===z.type?R._LinesMeshParser(z,u):z.type&&"GroundMesh"===z.type?R._GroundMeshParser(z,u):z.type&&"GoldbergMesh"===z.type?R._GoldbergMeshParser(z,u):z.type&&"GreasedLineMesh"===z.type?R._GreasedLineMeshParser(z,u):z.type&&"TrailMesh"===z.type?R._TrailMeshParser(z,u):new R(z.name,u),H.id=z.id,H._waitingParsedUniqueId=z.uniqueId,l.e&&l.e.AddTagsTo(H,z.tags),H.position=L.p.Nl(z.position),void 0!==z.metadata&&(H.metadata=z.metadata),z.rotationQuaternion?H.rotationQuaternion=L.f.Nl(z.rotationQuaternion):z.rotation&&(H.rotation=L.p.Nl(z.rotation)),H.el=L.p.Nl(z.el),z.localMatrix?H.setPreTransformMatrix(L.b.Nl(z.localMatrix)):z.pivotMatrix&&H.setPivotMatrix(L.b.Nl(z.pivotMatrix)),H.oT(z.isEnabled),H.isVisible=z.isVisible,H.infiniteDistance=z.infiniteDistance,H.qT=!!z.qT,H.showBoundingBox=z.showBoundingBox,H.showSubMeshesBoundingBox=z.showSubMeshesBoundingBox,void 0!==z.applyFog&&(H.applyFog=z.applyFog),void 0!==z.pickable&&(H.YL=z.pickable),void 0!==z.alphaIndex&&(H.alphaIndex=z.alphaIndex),H.receiveShadows=z.receiveShadows,void 0!==z.billboardMode&&(H.billboardMode=z.billboardMode),void 0!==z.visibility&&(H.visibility=z.visibility),H.checkCollisions=z.checkCollisions,H.Rz=!!z.Rz,z.ellipsoid&&(H.ellipsoid=L.p.Nl(z.ellipsoid)),z.ellipsoidOffset&&(H.ellipsoidOffset=L.p.Nl(z.ellipsoidOffset)),null!=z.overrideMaterialSideOrientation&&(H.sideOrientation=z.overrideMaterialSideOrientation),void 0!==z.sideOrientation&&(H.sideOrientation=z.sideOrientation),void 0!==z.isBlocker&&(H.isBlocker=z.isBlocker),H._shouldGenerateFlatShading=z.useFlatShading,z.MT&&(H._waitingData.MT=z.MT),void 0!==z.parentId&&(H._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(H._waitingParentInstanceIndex=z.parentInstanceIndex),void 0!==z.actions&&(H._waitingData.actions=z.actions),void 0!==z.overlayAlpha&&(H.overlayAlpha=z.overlayAlpha),void 0!==z.overlayColor&&(H.overlayColor=D.c.Nl(z.overlayColor)),void 0!==z.renderOverlay&&(H.renderOverlay=z.renderOverlay),H.isUnIndexed=!!z.isUnIndexed,H.hasVertexAlpha=z.hasVertexAlpha,z.delayLoadingFile?(H.delayLoadState=4,H.delayLoadingFile=Y+z.delayLoadingFile,H.buildBoundingInfo(L.p.Nl(z.boundingBoxMinimum),L.p.Nl(z.boundingBoxMaximum)),z._binaryInfo&&(H._binaryInfo=z._binaryInfo),H._delayInfo=[],z.hasUVs&&H._delayInfo.push(M.f.UVKind),z.hasUVs2&&H._delayInfo.push(M.f.UV2Kind),z.hasUVs3&&H._delayInfo.push(M.f.UV3Kind),z.hasUVs4&&H._delayInfo.push(M.f.UV4Kind),z.hasUVs5&&H._delayInfo.push(M.f.UV5Kind),z.hasUVs6&&H._delayInfo.push(M.f.UV6Kind),z.hasColors&&H._delayInfo.push(M.f.ColorKind),z.hasMatricesIndices&&H._delayInfo.push(M.f.MatricesIndicesKind),z.hasMatricesWeights&&H._delayInfo.push(M.f.MatricesWeightsKind),H._delayLoadingFunction=C.b._ImportGeometry,t.e.ForceFullSceneLoadingForIncremental&&H._checkDelayState()):C.b._ImportGeometry(z,H),z.materialUniqueId?H._waitingMaterialId=z.materialUniqueId:z.materialId&&(H._waitingMaterialId=z.materialId),z.morphTargetManagerId>-1&&(H._waitingMorphTargetManagerId=z.morphTargetManagerId),void 0!==z.skeletonId&&null!==z.skeletonId&&(H.skeleton=u.getLastSkeletonById(z.skeletonId),z.numBoneInfluencers&&(H.numBoneInfluencers=z.numBoneInfluencers)),z.animations){for(let u=0;u<z.animations.length;u++){const Y=z.animations[u],E=(0,s.c)("BABYLON.Animation");E&&H.animations.push(E.Parse(Y))}g.b.ParseAnimationRanges(H,z,u)}if(z.autoAnimate&&u.beginAnimation(H,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),z.layerMask&&!isNaN(z.layerMask)?H.layerMask=Math.abs(parseInt(z.layerMask)):H.layerMask=268435455,z.physicsImpostor&&(H.physicsImpostor=R._PhysicsImpostorParser(u,H,z)),z.lodMeshIds&&(H._waitingData.lods={ids:z.lodMeshIds,distances:z.lodDistances?z.lodDistances:null,coverages:z.lodCoverages?z.lodCoverages:null}),z.instances)for(let E=0;E<z.instances.length;E++){const Y=z.instances[E],J=H.createInstance(Y.name);if(Y.id&&(J.id=Y.id),l.e&&(Y.tags?l.e.AddTagsTo(J,Y.tags):l.e.AddTagsTo(J,z.tags)),J.position=L.p.Nl(Y.position),void 0!==Y.metadata&&(J.metadata=Y.metadata),void 0!==Y.parentId&&(J._waitingParentId=Y.parentId),void 0!==Y.parentInstanceIndex&&(J._waitingParentInstanceIndex=Y.parentInstanceIndex),void 0!==Y.isEnabled&&null!==Y.isEnabled&&J.oT(Y.isEnabled),void 0!==Y.isVisible&&null!==Y.isVisible&&(J.isVisible=Y.isVisible),void 0!==Y.YL&&null!==Y.YL&&(J.YL=Y.YL),Y.rotationQuaternion?J.rotationQuaternion=L.f.Nl(Y.rotationQuaternion):Y.rotation&&(J.rotation=L.p.Nl(Y.rotation)),J.el=L.p.Nl(Y.el),void 0!=Y.checkCollisions&&null!=Y.checkCollisions&&(J.checkCollisions=Y.checkCollisions),void 0!=Y.pickable&&null!=Y.pickable&&(J.YL=Y.pickable),void 0!=Y.showBoundingBox&&null!=Y.showBoundingBox&&(J.showBoundingBox=Y.showBoundingBox),void 0!=Y.showSubMeshesBoundingBox&&null!=Y.showSubMeshesBoundingBox&&(J.showSubMeshesBoundingBox=Y.showSubMeshesBoundingBox),void 0!=Y.alphaIndex&&null!=Y.showSubMeshesBoundingBox&&(J.alphaIndex=Y.alphaIndex),Y.physicsImpostor&&(J.physicsImpostor=R._PhysicsImpostorParser(u,J,Y)),void 0!==Y.actions&&(J._waitingData.actions=Y.actions),Y.animations){for(let z=0;z<Y.animations.length;z++){const u=Y.animations[z],H=(0,s.c)("BABYLON.Animation");H&&J.animations.push(H.Parse(u))}g.b.ParseAnimationRanges(J,Y,u),Y.autoAnimate&&u.beginAnimation(J,Y.autoAnimateFrom,Y.autoAnimateTo,Y.autoAnimateLoop,Y.autoAnimateSpeed||1)}}if(z.thinInstances){const u=z.thinInstances;if(H.thinInstanceEnablePicking=!!u.enablePicking,u.matrixData?(H.pg("matrix",new Float32Array(u.matrixData),16,!1),H._thinInstanceDataStorage.matrixBufferSize=u.matrixBufferSize,H._thinInstanceDataStorage.instancesCount=u.instancesCount):H._thinInstanceDataStorage.matrixBufferSize=u.matrixBufferSize,z.thinInstances.userThinInstance){const u=z.thinInstances.userThinInstance;for(const z in u.data)H.pg(z,new Float32Array(u.data[z]),u.strides[z],!1),H._userThinInstanceBuffersStorage.sizes[z]=u.sizes[z]}}return H}setPositionsForCPUSkinning(){const z=this._internalMeshDataInfo;if(!z._sourcePositions){const u=this.getVerticesData(M.f.PositionKind);if(!u)return z._sourcePositions;z._sourcePositions=new Float32Array(u),this.isVertexBufferUpdatable(M.f.PositionKind)||this.Uz(M.f.PositionKind,u,!0)}return z._sourcePositions}setNormalsForCPUSkinning(){const z=this._internalMeshDataInfo;if(!z._sourceNormals){const u=this.getVerticesData(M.f.NormalKind);if(!u)return z._sourceNormals;z._sourceNormals=new Float32Array(u),this.isVertexBufferUpdatable(M.f.NormalKind)||this.Uz(M.f.NormalKind,u,!0)}return z._sourceNormals}applySkeleton(z){if(!this.Sl)return this;if(this.Sl._softwareSkinningFrameId==this.iz().getFrameId())return this;if(this.Sl._softwareSkinningFrameId=this.iz().getFrameId(),!this.isVerticesDataPresent(M.f.PositionKind))return this;if(!this.isVerticesDataPresent(M.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(M.f.MatricesWeightsKind))return this;const u=this.isVerticesDataPresent(M.f.NormalKind),Y=this._internalMeshDataInfo;if(!Y._sourcePositions){const z=this.YT.slice();this.setPositionsForCPUSkinning(),this.YT=z}u&&!Y._sourceNormals&&this.setNormalsForCPUSkinning();let H=this.getVerticesData(M.f.PositionKind);if(!H)return this;H instanceof Float32Array||(H=new Float32Array(H));let E=this.getVerticesData(M.f.NormalKind);if(u){if(!E)return this;E instanceof Float32Array||(E=new Float32Array(E))}const J=this.getVerticesData(M.f.MatricesIndicesKind),l=this.getVerticesData(M.f.MatricesWeightsKind);if(!l||!J)return this;const T=this.numBoneInfluencers>4,b=T?this.getVerticesData(M.f.MatricesIndicesExtraKind):null,D=T?this.getVerticesData(M.f.MatricesWeightsExtraKind):null,g=z.getTransformMatrices(this),q=L.p.Zero(),C=new L.b,K=new L.b;let h,o=0;for(let M=0;M<H.length;M+=3,o+=4){let z;for(h=0;h<4;h++)z=l[o+h],z>0&&(L.b.FromFloat32ArrayToRefScaled(g,Math.floor(16*J[o+h]),z,K),C.addToSelf(K));if(T)for(h=0;h<4;h++)z=D[o+h],z>0&&(L.b.FromFloat32ArrayToRefScaled(g,Math.floor(16*b[o+h]),z,K),C.addToSelf(K));L.p.TransformCoordinatesFromFloatsToRef(Y._sourcePositions[M],Y._sourcePositions[M+1],Y._sourcePositions[M+2],C,q),q.toArray(H,M),u&&(L.p.TransformNormalFromFloatsToRef(Y._sourceNormals[M],Y._sourceNormals[M+1],Y._sourceNormals[M+2],C,q),q.toArray(E,M)),C.reset()}return this.updateVerticesData(M.f.PositionKind,H),u&&this.updateVerticesData(M.f.NormalKind,E),this}static MinMax(z){let u=null,Y=null;for(const H of z){const z=H.getBoundingInfo().boundingBox;u&&Y?(u.minimizeInPlace(z.minimumWorld),Y.maximizeInPlace(z.maximumWorld)):(u=z.minimumWorld,Y=z.maximumWorld)}return u&&Y?{min:u,max:Y}:{min:L.p.Zero(),max:L.p.Zero()}}static Center(z){const u=z instanceof Array?R.MinMax(z):z;return L.p.Center(u.min,u.max)}static MergeMeshes(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0;return(0,T.h)(R._MergeMeshesCoroutine(z,u,Y,H,E,J,!1))}static async MergeMeshesAsync(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0;return await(0,T.f)(R._MergeMeshesCoroutine(z,u,Y,H,E,J,!0),(0,T.b)())}static*_MergeMeshesCoroutine(z){let u,Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2?arguments[2]:void 0,E=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0;if(0===(z=z.filter(Boolean)).length)return null;if(!H){let Y=0;for(u=0;u<z.length;u++)if(Y+=z[u].getTotalVertices(),Y>=65536)return Z.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}l&&(J=!1);const b=new Array,L=new Array,D=new Array,g=z[0].sideOrientation;for(u=0;u<z.length;u++){const Y=z[u];if(Y.isAnInstance)return Z.b.Warn("Cannot merge instance meshes."),null;if(g!==Y.sideOrientation)return Z.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(J&&D.push(Y.getTotalIndices()),l)if(Y.material){const z=Y.material;if(z instanceof d.d){for(let u=0;u<z.HT.length;u++)b.indexOf(z.HT[u])<0&&b.push(z.HT[u]);for(let u=0;u<Y.YT.length;u++)L.push(b.indexOf(z.HT[Y.YT[u].materialIndex])),D.push(Y.YT[u].indexCount)}else{b.indexOf(z)<0&&b.push(z);for(let u=0;u<Y.YT.length;u++)L.push(b.indexOf(z)),D.push(Y.YT[u].indexCount)}}else for(let z=0;z<Y.YT.length;z++)L.push(0),D.push(Y.YT[z].indexCount)}const M=z[0],C=z=>{const u=z.pl(!0);return{vertexData:q.e.ExtractFromMesh(z,!1,!1),transform:u}},{vertexData:K,transform:o}=C(M);T&&(yield);const t=new Array(z.length-1);for(let q=1;q<z.length;q++)t[q-1]=C(z[q]),T&&(yield);const W=K._mergeCoroutine(o,t,H,T,!Y);let s=W.next();for(;!s.done;)T&&(yield),s=W.next();const v=s.value;E||(E=new R(M.name+"_merged",M.iz()));const i=v._applyToCoroutine(E,void 0,T);let X=i.next();for(;!X.done;)T&&(yield),X=i.next();if(E.checkCollisions=M.checkCollisions,E.sideOrientation=M.sideOrientation,Y)for(u=0;u<z.length;u++)z[u].dispose();if(J||l){E.releaseSubMeshes(),u=0;let z=0;for(;u<D.length;)h.d.CreateFromIndices(0,z,D[u],E,void 0,!1),z+=D[u],u++;for(const u of E.YT)u.refreshBoundingInfo();E.pl(!0)}if(l){const z=new d.d(M.name+"_merged",M.iz());z.HT=b;for(let u=0;u<E.YT.length;u++)E.YT[u].materialIndex=L[u];E.material=z}else E.material=M.material;return E}IM(z){z._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(z)}SM(z){const u=z._indexInSourceMeshInstanceArray;if(-1!=u){if(u!==this.instances.length-1){const z=this.instances[this.instances.length-1];this.instances[u]=z,z._indexInSourceMeshInstanceArray=u}z._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===o.d.CounterClockWiseSideOrientation}_getRenderingFillMode(z){const u=this.iz();return u.forcePointsCloud?o.d.PointFillMode:u.forceWireframe?o.d.WireFrameFillMode:this.overrideRenderingFillMode??z}setMaterialByID(z){return this.setMaterialById(z)}static CreateRibbon(z,u,Y,H,E,J,l,T,b){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(z,u,Y,H,E,J){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(z,u,Y,H,E){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(z,u,Y,H,E,J){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(z,u,Y,H){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(z,u,Y,H,E,J,l,T,b){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(z,u,Y,H,E,J,l){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(z,u,Y,H,E,J,l,T,b,L){throw new Error("Import MeshBuilder to populate this function")}static RL(z,u,Y,H,E){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(z,u,Y,H,E,J,l,T){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(z,u,Y,H,E,J,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(z,u,Y,H,E,J,l,T){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(z,u,Y,H,E,J,l,T,b,L){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(z,u,Y,H,E,J,l,T,b,L,D,g){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(z,u,Y,H,E,J,l){throw new Error("Import MeshBuilder to populate this function")}static cL(z,u,Y,H,E){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(z,u,Y,H,E,J){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(z,u,Y,H,E,J,l,T,b){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(z,u,Y,H,E,J,l,T,b,L,D){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(z,u,Y,H,E,J,l,T,b,L){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(z,u,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(z,u,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(z,u,Y,H,E,J){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(z,u,Y){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(z){throw new Error("Import MeshBuilder to populate this function")}}R.FRONTSIDE=q.e.FRONTSIDE,R.BACKSIDE=q.e.BACKSIDE,R.DOUBLESIDE=q.e.DOUBLESIDE,R.DEFAULTSIDE=q.e.DEFAULTSIDE,R.NO_CAP=0,R.CAP_START=1,R.CAP_END=2,R.CAP_ALL=3,R.NO_FLIP=0,R.FLIP_TILE=1,R.ROTATE_TILE=2,R.FLIP_ROW=3,R.ROTATE_ROW=4,R.FLIP_N_ROTATE_TILE=5,R.FLIP_N_ROTATE_ROW=6,R.CENTER=0,R.LEFT=1,R.RIGHT=2,R.TOP=3,R.BOTTOM=4,R.INSTANCEDMESH_SORT_TRANSPARENT=!1,R._GroundMeshParser=(z,u)=>{throw(0,v.e)("GroundMesh")},R._GoldbergMeshParser=(z,u)=>{throw(0,v.e)("GoldbergMesh")},R._LinesMeshParser=(z,u)=>{throw(0,v.e)("LinesMesh")},R._GreasedLineMeshParser=(z,u)=>{throw(0,v.e)("GreasedLineMesh")},R._GreasedLineRibbonMeshParser=(z,u)=>{throw(0,v.e)("GreasedLineRibbonMesh")},R._TrailMeshParser=(z,u)=>{throw(0,v.e)("TrailMesh")},(0,s.d)("BABYLON.Mesh",R)},11231:(z,u,Y)=>{Y.d(u,{e:()=>C});var H=Y(11079),E=Y(10903),J=Y(11103),l=Y(10970),T=Y(11188),b=Y(10953),L=Y(11082),D=Y(11239),g=Y(10982),M=Y(11098);class q{}class C{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,D.e)(this._applyToCoroutine.bind(this)),this.uniqueId=C._UniqueIdGenerator,C._UniqueIdGenerator++}set(z,u){switch(z.length||b.b.Warn(`Setting vertex data kind '${u}' with an empty array`),u){case J.f.PositionKind:this.Qz=z;break;case J.f.NormalKind:this.Vz=z;break;case J.f.TangentKind:this.tangents=z;break;case J.f.UVKind:this.xz=z;break;case J.f.UV2Kind:this.uvs2=z;break;case J.f.UV3Kind:this.uvs3=z;break;case J.f.UV4Kind:this.uvs4=z;break;case J.f.UV5Kind:this.uvs5=z;break;case J.f.UV6Kind:this.uvs6=z;break;case J.f.ColorKind:this.Az=z;break;case J.f.MatricesIndicesKind:this.matricesIndices=z;break;case J.f.MatricesWeightsKind:this.matricesWeights=z;break;case J.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=z;break;case J.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=z}}Fz(z,u){return this._applyTo(z,u,!1),this}applyToGeometry(z,u){return this._applyTo(z,u,!1),this}updateMesh(z){return this._update(z),this}updateGeometry(z){return this._update(z),this}*_applyToCoroutine(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;if(this.Qz&&(z.Uz(J.f.PositionKind,this.Qz,u),Y&&(yield)),this.Vz&&(z.Uz(J.f.NormalKind,this.Vz,u),Y&&(yield)),this.tangents&&(z.Uz(J.f.TangentKind,this.tangents,u),Y&&(yield)),this.xz&&(z.Uz(J.f.UVKind,this.xz,u),Y&&(yield)),this.uvs2&&(z.Uz(J.f.UV2Kind,this.uvs2,u),Y&&(yield)),this.uvs3&&(z.Uz(J.f.UV3Kind,this.uvs3,u),Y&&(yield)),this.uvs4&&(z.Uz(J.f.UV4Kind,this.uvs4,u),Y&&(yield)),this.uvs5&&(z.Uz(J.f.UV5Kind,this.uvs5,u),Y&&(yield)),this.uvs6&&(z.Uz(J.f.UV6Kind,this.uvs6,u),Y&&(yield)),this.Az){const H=this.Qz&&this.Az.length===this.Qz.length?3:4;z.Uz(J.f.ColorKind,this.Az,u,H),this.hasVertexAlpha&&void 0!==z.hasVertexAlpha&&(z.hasVertexAlpha=!0),Y&&(yield)}if(this.matricesIndices&&(z.Uz(J.f.MatricesIndicesKind,this.matricesIndices,u),Y&&(yield)),this.matricesWeights&&(z.Uz(J.f.MatricesWeightsKind,this.matricesWeights,u),Y&&(yield)),this.matricesIndicesExtra&&(z.Uz(J.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,u),Y&&(yield)),this.matricesWeightsExtra&&(z.Uz(J.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,u),Y&&(yield)),this.indices?(z.setIndices(this.indices,null,u),Y&&(yield)):z.setIndices([],null),z.YT&&this.materialInfos&&this.materialInfos.length>1){const u=z;u.YT=[];for(const z of this.materialInfos)new M.d(z.materialIndex,z.verticesStart,z.verticesCount,z.indexStart,z.indexCount,u)}return this}_update(z,u,Y){return this.Qz&&z.updateVerticesData(J.f.PositionKind,this.Qz,u,Y),this.Vz&&z.updateVerticesData(J.f.NormalKind,this.Vz,u,Y),this.tangents&&z.updateVerticesData(J.f.TangentKind,this.tangents,u,Y),this.xz&&z.updateVerticesData(J.f.UVKind,this.xz,u,Y),this.uvs2&&z.updateVerticesData(J.f.UV2Kind,this.uvs2,u,Y),this.uvs3&&z.updateVerticesData(J.f.UV3Kind,this.uvs3,u,Y),this.uvs4&&z.updateVerticesData(J.f.UV4Kind,this.uvs4,u,Y),this.uvs5&&z.updateVerticesData(J.f.UV5Kind,this.uvs5,u,Y),this.uvs6&&z.updateVerticesData(J.f.UV6Kind,this.uvs6,u,Y),this.Az&&z.updateVerticesData(J.f.ColorKind,this.Az,u,Y),this.matricesIndices&&z.updateVerticesData(J.f.MatricesIndicesKind,this.matricesIndices,u,Y),this.matricesWeights&&z.updateVerticesData(J.f.MatricesWeightsKind,this.matricesWeights,u,Y),this.matricesIndicesExtra&&z.updateVerticesData(J.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,u,Y),this.matricesWeightsExtra&&z.updateVerticesData(J.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,u,Y),this.indices&&z.setIndices(this.indices,null),this}static _TransformVector3Coordinates(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const J=E.i.Pl[0],l=E.i.Pl[1];for(let T=Y;T<Y+H;T+=3)E.p.FromArrayToRef(z,T,J),E.p.TransformCoordinatesToRef(J,u,l),z[T]=l.x,z[T+1]=l.y,z[T+2]=l.z}static _TransformVector3Normals(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const J=E.i.Pl[0],l=E.i.Pl[1];for(let T=Y;T<Y+H;T+=3)E.p.FromArrayToRef(z,T,J),E.p.TransformNormalToRef(J,u,l),z[T]=l.x,z[T+1]=l.y,z[T+2]=l.z}static _TransformVector4Normals(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const J=E.i.Vector4[0],l=E.i.Vector4[1];for(let T=Y;T<Y+H;T+=4)E.t.FromArrayToRef(z,T,J),E.t.TransformNormalToRef(J,u,l),z[T]=l.x,z[T+1]=l.y,z[T+2]=l.z,z[T+3]=l.w}static _FlipFaces(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.length;for(let H=u;H<u+Y;H+=3){const u=z[H+1];z[H+1]=z[H+2],z[H+2]=u}}transform(z){const u=z.determinant()<0;return this.Qz&&C._TransformVector3Coordinates(this.Qz,z),this.Vz&&C._TransformVector3Normals(this.Vz,z),this.tangents&&C._TransformVector4Normals(this.tangents,z),u&&this.indices&&C._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const z=[];for(const u of this.materialInfos){const Y=new C;if(this.Qz&&(Y.Qz=this.Qz.slice(3*u.verticesStart,3*(u.verticesCount+u.verticesStart))),this.Vz&&(Y.Vz=this.Vz.slice(3*u.verticesStart,3*(u.verticesCount+u.verticesStart))),this.tangents&&(Y.tangents=this.tangents.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.Az&&(Y.Az=this.Az.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.xz&&(Y.xz=this.xz.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.uvs2&&(Y.uvs2=this.uvs2.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.uvs3&&(Y.uvs3=this.uvs3.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.uvs4&&(Y.uvs4=this.uvs4.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.uvs5&&(Y.uvs5=this.uvs5.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.uvs6&&(Y.uvs6=this.uvs6.slice(2*u.verticesStart,2*(u.verticesCount+u.verticesStart))),this.matricesIndices&&(Y.matricesIndices=this.matricesIndices.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.matricesIndicesExtra&&(Y.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.matricesWeights&&(Y.matricesWeights=this.matricesWeights.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.matricesWeightsExtra&&(Y.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*u.verticesStart,4*(u.verticesCount+u.verticesStart))),this.indices){Y.indices=[];for(let z=u.indexStart;z<u.indexStart+u.indexCount;z++)Y.indices.push(this.indices[z]-u.verticesStart)}const H=new q;H.indexStart=0,H.indexCount=Y.indices?Y.indices.length:0,H.materialIndex=u.materialIndex,H.verticesStart=0,H.verticesCount=(Y.Qz?Y.Qz.length:0)/3,Y.materialInfos=[H],z.push(Y)}return z}merge(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const J=Array.isArray(z)?z.map((z=>({vertexData:z}))):[{vertexData:z}];return(0,D.h)(this._mergeCoroutine(void 0,J,u,!1,Y,H,E))}*_mergeCoroutine(z,u){var Y,H;let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let D=u.map((z=>z.vertexData)),g=this;if(L)for(const J of D)J&&(J._validate(),!this.Vz&&J.Vz&&(this.Vz=new Float32Array(this.Qz.length)),!this.tangents&&J.tangents&&(this.tangents=new Float32Array(this.Qz.length/3*4)),!this.xz&&J.xz&&(this.xz=new Float32Array(this.Qz.length/3*2)),!this.uvs2&&J.uvs2&&(this.uvs2=new Float32Array(this.Qz.length/3*2)),!this.uvs3&&J.uvs3&&(this.uvs3=new Float32Array(this.Qz.length/3*2)),!this.uvs4&&J.uvs4&&(this.uvs4=new Float32Array(this.Qz.length/3*2)),!this.uvs5&&J.uvs5&&(this.uvs5=new Float32Array(this.Qz.length/3*2)),!this.uvs6&&J.uvs6&&(this.uvs6=new Float32Array(this.Qz.length/3*2)),!this.Az&&J.Az&&(this.Az=new Float32Array(this.Qz.length/3*4),this.Az.fill(1)),!this.matricesIndices&&J.matricesIndices&&(this.matricesIndices=new Float32Array(this.Qz.length/3*4)),!this.matricesWeights&&J.matricesWeights&&(this.matricesWeights=new Float32Array(this.Qz.length/3*4)),!this.matricesIndicesExtra&&J.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Qz.length/3*4)),!this.matricesWeightsExtra&&J.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Qz.length/3*4)));for(const J of D)if(J)if(L)this.Vz&&!J.Vz&&(J.Vz=new Float32Array(J.Qz.length)),this.tangents&&!J.tangents&&(J.tangents=new Float32Array(J.Qz.length/3*4)),this.xz&&!J.xz&&(J.xz=new Float32Array(J.Qz.length/3*2)),this.uvs2&&!J.uvs2&&(J.uvs2=new Float32Array(J.Qz.length/3*2)),this.uvs3&&!J.uvs3&&(J.uvs3=new Float32Array(J.Qz.length/3*2)),this.uvs4&&!J.uvs4&&(J.uvs4=new Float32Array(J.Qz.length/3*2)),this.uvs5&&!J.uvs5&&(J.uvs5=new Float32Array(J.Qz.length/3*2)),this.uvs6&&!J.uvs6&&(J.uvs6=new Float32Array(J.Qz.length/3*2)),this.Az&&!J.Az&&(J.Az=new Float32Array(J.Qz.length/3*4),J.Az.fill(1)),this.matricesIndices&&!J.matricesIndices&&(J.matricesIndices=new Float32Array(J.Qz.length/3*4)),this.matricesWeights&&!J.matricesWeights&&(J.matricesWeights=new Float32Array(J.Qz.length/3*4)),this.matricesIndicesExtra&&!J.matricesIndicesExtra&&(J.matricesIndicesExtra=new Float32Array(J.Qz.length/3*4)),this.matricesWeightsExtra&&!J.matricesWeightsExtra&&(J.matricesWeightsExtra=new Float32Array(J.Qz.length/3*4));else if(J._validate(),!this.Vz!==!J.Vz||!this.tangents!==!J.tangents||!this.xz!==!J.xz||!this.uvs2!==!J.uvs2||!this.uvs3!==!J.uvs3||!this.uvs4!==!J.uvs4||!this.uvs5!==!J.uvs5||!this.uvs6!==!J.uvs6||!this.Az!==!J.Az||!this.matricesIndices!==!J.matricesIndices||!this.matricesWeights!==!J.matricesWeights||!this.matricesIndicesExtra!==!J.matricesIndicesExtra||!this.matricesWeightsExtra!==!J.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(b){let Y=0,H=0,E=0;const J=[];let l=null;const T=[];for(const u of this.splitBasedOnMaterialID())T.push({vertexData:u,transform:z});for(const z of u)if(z.vertexData)for(const u of z.vertexData.splitBasedOnMaterialID())T.push({vertexData:u,transform:z.transform});T.sort(((z,u)=>{const Y=z.vertexData.materialInfos?z.vertexData.materialInfos[0].materialIndex:0,H=u.vertexData.materialInfos?u.vertexData.materialInfos[0].materialIndex:0;return Y>H?1:Y===H?0:-1}));for(const z of T){const u=z.vertexData;if(Y=u.materialInfos?u.materialInfos[0].materialIndex:0,l&&l.materialIndex===Y)l.indexCount+=u.indices.length,l.verticesCount+=u.Qz.length/3;else{const z=new q;z.materialIndex=Y,z.indexStart=H,z.indexCount=u.indices.length,z.verticesStart=E,z.verticesCount=u.Qz.length/3,J.push(z),l=z}H+=u.indices.length,E+=u.Qz.length/3}const b=T.splice(0,1)[0];g=b.vertexData,z=b.transform,D=T.map((z=>z.vertexData)),u=T,this.materialInfos=J}const M=D.reduce(((z,u)=>{var Y;return z+((null===(Y=u.indices)||void 0===Y?void 0:Y.length)??0)}),(null===(Y=g.indices)||void 0===Y?void 0:Y.length)??0);let K=T||D.some((z=>z.indices===g.indices))?null===(H=g.indices)||void 0===H?void 0:H.slice():g.indices;if(M>0){var h;let Y=(null===(h=K)||void 0===h?void 0:h.length)??0;if(K||(K=new Array(M)),K.length!==M){if(Array.isArray(K))K.length=M;else{const z=E||K instanceof Uint32Array?new Uint32Array(M):new Uint16Array(M);z.set(K),K=z}z&&z.determinant()<0&&C._FlipFaces(K,0,Y)}let H=g.Qz?g.Qz.length/3:0;for(const{vertexData:z,transform:E}of u)if(z.indices){for(let u=0;u<z.indices.length;u++)K[Y+u]=z.indices[u]+H;E&&E.determinant()<0&&C._FlipFaces(K,Y,z.indices.length),H+=z.Qz.length/3,Y+=z.indices.length,l&&(yield)}}return this.indices=K,this.Qz=C._MergeElement(J.f.PositionKind,g.Qz,z,u.map((z=>[z.vertexData.Qz,z.transform]))),l&&(yield),g.Vz&&(this.Vz=C._MergeElement(J.f.NormalKind,g.Vz,z,u.map((z=>[z.vertexData.Vz,z.transform]))),l&&(yield)),g.tangents&&(this.tangents=C._MergeElement(J.f.TangentKind,g.tangents,z,u.map((z=>[z.vertexData.tangents,z.transform]))),l&&(yield)),g.xz&&(this.xz=C._MergeElement(J.f.UVKind,g.xz,z,u.map((z=>[z.vertexData.xz,z.transform]))),l&&(yield)),g.uvs2&&(this.uvs2=C._MergeElement(J.f.UV2Kind,g.uvs2,z,u.map((z=>[z.vertexData.uvs2,z.transform]))),l&&(yield)),g.uvs3&&(this.uvs3=C._MergeElement(J.f.UV3Kind,g.uvs3,z,u.map((z=>[z.vertexData.uvs3,z.transform]))),l&&(yield)),g.uvs4&&(this.uvs4=C._MergeElement(J.f.UV4Kind,g.uvs4,z,u.map((z=>[z.vertexData.uvs4,z.transform]))),l&&(yield)),g.uvs5&&(this.uvs5=C._MergeElement(J.f.UV5Kind,g.uvs5,z,u.map((z=>[z.vertexData.uvs5,z.transform]))),l&&(yield)),g.uvs6&&(this.uvs6=C._MergeElement(J.f.UV6Kind,g.uvs6,z,u.map((z=>[z.vertexData.uvs6,z.transform]))),l&&(yield)),g.Az&&(this.Az=C._MergeElement(J.f.ColorKind,g.Az,z,u.map((z=>[z.vertexData.Az,z.transform]))),(void 0!==g.hasVertexAlpha||u.some((z=>void 0!==z.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=g.hasVertexAlpha||u.some((z=>z.vertexData.hasVertexAlpha))),l&&(yield)),g.matricesIndices&&(this.matricesIndices=C._MergeElement(J.f.MatricesIndicesKind,g.matricesIndices,z,u.map((z=>[z.vertexData.matricesIndices,z.transform]))),l&&(yield)),g.matricesWeights&&(this.matricesWeights=C._MergeElement(J.f.MatricesWeightsKind,g.matricesWeights,z,u.map((z=>[z.vertexData.matricesWeights,z.transform]))),l&&(yield)),g.matricesIndicesExtra&&(this.matricesIndicesExtra=C._MergeElement(J.f.MatricesIndicesExtraKind,g.matricesIndicesExtra,z,u.map((z=>[z.vertexData.matricesIndicesExtra,z.transform]))),l&&(yield)),g.matricesWeightsExtra&&(this.matricesWeightsExtra=C._MergeElement(J.f.MatricesWeightsExtraKind,g.matricesWeightsExtra,z,u.map((z=>[z.vertexData.matricesWeightsExtra,z.transform])))),this}static _MergeElement(z,u,Y,H){const E=H.filter((z=>null!==z[0]&&void 0!==z[0]));if(!u&&0==E.length)return u;if(!u)return this._MergeElement(z,E[0][0],E[0][1],E.slice(1));const l=E.reduce(((z,u)=>z+u[0].length),u.length),T=z===J.f.PositionKind?C._TransformVector3Coordinates:z===J.f.NormalKind?C._TransformVector3Normals:z===J.f.TangentKind?C._TransformVector4Normals:()=>{};if(u instanceof Float32Array){const z=new Float32Array(l);z.set(u),Y&&T(z,Y,0,u.length);let H=u.length;for(const[u,Y]of E)z.set(u,H),Y&&T(z,Y,H,u.length),H+=u.length;return z}{const z=new Array(l);for(let Y=0;Y<u.length;Y++)z[Y]=u[Y];Y&&T(z,Y,0,u.length);let H=u.length;for(const[u,Y]of E){for(let Y=0;Y<u.length;Y++)z[H+Y]=u[Y];Y&&T(z,Y,H,u.length),H+=u.length}return z}}_validate(){if(!this.Qz)throw new g.i("Positions are required",g.f.MeshInvalidPositionsError);const z=(z,u)=>{const Y=J.f.DeduceStride(z);if(u.length%Y!==0)throw new Error("The "+z+"s array count must be a multiple of "+Y);return u.length/Y},u=z(J.f.PositionKind,this.Qz),Y=(Y,H)=>{const E=z(Y,H);if(E!==u)throw new Error("The "+Y+"s element count ("+E+") does not match the positions count ("+u+")")};this.Vz&&Y(J.f.NormalKind,this.Vz),this.tangents&&Y(J.f.TangentKind,this.tangents),this.xz&&Y(J.f.UVKind,this.xz),this.uvs2&&Y(J.f.UV2Kind,this.uvs2),this.uvs3&&Y(J.f.UV3Kind,this.uvs3),this.uvs4&&Y(J.f.UV4Kind,this.uvs4),this.uvs5&&Y(J.f.UV5Kind,this.uvs5),this.uvs6&&Y(J.f.UV6Kind,this.uvs6),this.Az&&Y(J.f.ColorKind,this.Az),this.matricesIndices&&Y(J.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&Y(J.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&Y(J.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&Y(J.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const z=this.serialize();return C.Parse(z)}serialize(){const z={};if(this.Qz&&(z.Qz=Array.from(this.Qz)),this.Vz&&(z.Vz=Array.from(this.Vz)),this.tangents&&(z.tangents=Array.from(this.tangents)),this.xz&&(z.xz=Array.from(this.xz)),this.uvs2&&(z.uvs2=Array.from(this.uvs2)),this.uvs3&&(z.uvs3=Array.from(this.uvs3)),this.uvs4&&(z.uvs4=Array.from(this.uvs4)),this.uvs5&&(z.uvs5=Array.from(this.uvs5)),this.uvs6&&(z.uvs6=Array.from(this.uvs6)),this.Az&&(z.Az=Array.from(this.Az),z.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(z.matricesIndices=Array.from(this.matricesIndices),z.matricesIndicesExpanded=!0),this.matricesWeights&&(z.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(z.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),z.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(z.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),z.indices=this.indices?Array.from(this.indices):[],this.materialInfos){z.materialInfos=[];for(const u of this.materialInfos){const Y={indexStart:u.indexStart,indexCount:u.indexCount,materialIndex:u.materialIndex,verticesStart:u.verticesStart,verticesCount:u.verticesCount};z.materialInfos.push(Y)}}return z}static ExtractFromMesh(z,u,Y){return C._ExtractFrom(z,u,Y)}static ExtractFromGeometry(z,u,Y){return C._ExtractFrom(z,u,Y)}static _ExtractFrom(z,u,Y){const H=new C;if(z.isVerticesDataPresent(J.f.PositionKind)&&(H.Qz=z.getVerticesData(J.f.PositionKind,u,Y)),z.isVerticesDataPresent(J.f.NormalKind)&&(H.Vz=z.getVerticesData(J.f.NormalKind,u,Y)),z.isVerticesDataPresent(J.f.TangentKind)&&(H.tangents=z.getVerticesData(J.f.TangentKind,u,Y)),z.isVerticesDataPresent(J.f.UVKind)&&(H.xz=z.getVerticesData(J.f.UVKind,u,Y)),z.isVerticesDataPresent(J.f.UV2Kind)&&(H.uvs2=z.getVerticesData(J.f.UV2Kind,u,Y)),z.isVerticesDataPresent(J.f.UV3Kind)&&(H.uvs3=z.getVerticesData(J.f.UV3Kind,u,Y)),z.isVerticesDataPresent(J.f.UV4Kind)&&(H.uvs4=z.getVerticesData(J.f.UV4Kind,u,Y)),z.isVerticesDataPresent(J.f.UV5Kind)&&(H.uvs5=z.getVerticesData(J.f.UV5Kind,u,Y)),z.isVerticesDataPresent(J.f.UV6Kind)&&(H.uvs6=z.getVerticesData(J.f.UV6Kind,u,Y)),z.isVerticesDataPresent(J.f.ColorKind)){const E=z.Sl||z,l=E.getVertexBuffer(J.f.ColorKind),T=E.getVerticesData(J.f.ColorKind,u,Y);if(3===l.getSize()){const z=new Float32Array(4*T.length/3);for(let u=0,Y=0;u<T.length;u+=3,Y+=4)z[Y]=T[u],z[Y+1]=T[u+1],z[Y+2]=T[u+2],z[Y+3]=1;H.Az=z}else{if(4!==l.getSize())throw new Error(`Unexpected number of color components: ${l.getSize()}`);H.Az=T}}return z.isVerticesDataPresent(J.f.MatricesIndicesKind)&&(H.matricesIndices=z.getVerticesData(J.f.MatricesIndicesKind,u,Y)),z.isVerticesDataPresent(J.f.MatricesWeightsKind)&&(H.matricesWeights=z.getVerticesData(J.f.MatricesWeightsKind,u,Y)),z.isVerticesDataPresent(J.f.MatricesIndicesExtraKind)&&(H.matricesIndicesExtra=z.getVerticesData(J.f.MatricesIndicesExtraKind,u,Y)),z.isVerticesDataPresent(J.f.MatricesWeightsExtraKind)&&(H.matricesWeightsExtra=z.getVerticesData(J.f.MatricesWeightsExtraKind,u,Y)),H.indices=z.Il(u,Y),H}static CreateRibbon(z){throw(0,l.e)("ribbonBuilder")}static CreateBox(z){throw(0,l.e)("boxBuilder")}static CreateTiledBox(z){throw(0,l.e)("tiledBoxBuilder")}static CreateTiledPlane(z){throw(0,l.e)("tiledPlaneBuilder")}static CreateSphere(z){throw(0,l.e)("sphereBuilder")}static CreateCylinder(z){throw(0,l.e)("cylinderBuilder")}static CreateTorus(z){throw(0,l.e)("torusBuilder")}static CreateLineSystem(z){throw(0,l.e)("linesBuilder")}static CreateDashedLines(z){throw(0,l.e)("linesBuilder")}static CreateGround(z){throw(0,l.e)("groundBuilder")}static CreateTiledGround(z){throw(0,l.e)("groundBuilder")}static CreateGroundFromHeightMap(z){throw(0,l.e)("groundBuilder")}static cL(z){throw(0,l.e)("planeBuilder")}static CreateDisc(z){throw(0,l.e)("discBuilder")}static CreatePolygon(z,u,Y,H,E,J,T){throw(0,l.e)("polygonBuilder")}static CreateIcoSphere(z){throw(0,l.e)("icoSphereBuilder")}static CreatePolyhedron(z){throw(0,l.e)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||E.p.Up();throw(0,l.e)("capsuleBuilder")}static CreateTorusKnot(z){throw(0,l.e)("torusKnotBuilder")}static ComputeNormals(z,u,Y,H){let J=0,l=0,T=0,b=0,L=0,D=0,g=0,M=0,q=0,C=0,K=0,h=0,o=0,d=0,t=0,W=0,Z=0,s=0,v=0,i=0,X=!1,Q=!1,V=!1,A=!1,x=1,G=0,F=null;H&&(X=!!H.facetNormals,Q=!!H.facetPositions,V=!!H.facetPartitioning,x=!0===H.useRightHandedSystem?-1:1,G=H.ratio||0,A=!!H.depthSort,F=H.distanceTo,A&&void 0===F&&(F=E.p.Zero()));let R=0,w=0,c=0,U=0;for(V&&H&&H.bbSize&&(R=H.subDiv.X*G/H.bbSize.x,w=H.subDiv.Y*G/H.bbSize.y,c=H.subDiv.Z*G/H.bbSize.z,U=H.subDiv.max*H.subDiv.max,H.facetPartitioning.length=0),J=0;J<z.length;J++)Y[J]=0;const O=u.length/3|0;for(J=0;J<O;J++){if(h=3*u[3*J],o=h+1,d=h+2,t=3*u[3*J+1],W=t+1,Z=t+2,s=3*u[3*J+2],v=s+1,i=s+2,l=z[h]-z[t],T=z[o]-z[W],b=z[d]-z[Z],L=z[s]-z[t],D=z[v]-z[W],g=z[i]-z[Z],M=x*(T*g-b*D),q=x*(b*L-l*g),C=x*(l*D-T*L),K=Math.sqrt(M*M+q*q+C*C),K=0===K?1:K,M/=K,q/=K,C/=K,X&&H&&(H.facetNormals[J].x=M,H.facetNormals[J].y=q,H.facetNormals[J].z=C),Q&&H&&(H.facetPositions[J].x=(z[h]+z[t]+z[s])/3,H.facetPositions[J].y=(z[o]+z[W]+z[v])/3,H.facetPositions[J].z=(z[d]+z[Z]+z[i])/3),V&&H){const u=Math.floor((H.facetPositions[J].x-H.bInfo.minimum.x*G)*R),Y=Math.floor((H.facetPositions[J].y-H.bInfo.minimum.y*G)*w),E=Math.floor((H.facetPositions[J].z-H.bInfo.minimum.z*G)*c),l=Math.floor((z[h]-H.bInfo.minimum.x*G)*R),T=Math.floor((z[o]-H.bInfo.minimum.y*G)*w),b=Math.floor((z[d]-H.bInfo.minimum.z*G)*c),L=Math.floor((z[t]-H.bInfo.minimum.x*G)*R),D=Math.floor((z[W]-H.bInfo.minimum.y*G)*w),g=Math.floor((z[Z]-H.bInfo.minimum.z*G)*c),M=Math.floor((z[s]-H.bInfo.minimum.x*G)*R),q=Math.floor((z[v]-H.bInfo.minimum.y*G)*w),C=Math.floor((z[i]-H.bInfo.minimum.z*G)*c),K=l+H.subDiv.max*T+U*b,X=L+H.subDiv.max*D+U*g,Q=M+H.subDiv.max*q+U*C,V=u+H.subDiv.max*Y+U*E;H.facetPartitioning[V]=H.facetPartitioning[V]?H.facetPartitioning[V]:[],H.facetPartitioning[K]=H.facetPartitioning[K]?H.facetPartitioning[K]:[],H.facetPartitioning[X]=H.facetPartitioning[X]?H.facetPartitioning[X]:[],H.facetPartitioning[Q]=H.facetPartitioning[Q]?H.facetPartitioning[Q]:[],H.facetPartitioning[K].push(J),X!=K&&H.facetPartitioning[X].push(J),Q!=X&&Q!=K&&H.facetPartitioning[Q].push(J),V!=K&&V!=X&&V!=Q&&H.facetPartitioning[V].push(J)}if(A&&H&&H.facetPositions){const z=H.depthSortedFacets[J];z.ind=3*J,z.sqDistance=E.p.DistanceSquared(H.facetPositions[J],F)}Y[h]+=M,Y[o]+=q,Y[d]+=C,Y[t]+=M,Y[W]+=q,Y[Z]+=C,Y[s]+=M,Y[v]+=q,Y[i]+=C}for(J=0;J<Y.length/3;J++)M=Y[3*J],q=Y[3*J+1],C=Y[3*J+2],K=Math.sqrt(M*M+q*q+C*C),K=0===K?1:K,M/=K,q/=K,C/=K,Y[3*J]=M,Y[3*J+1]=q,Y[3*J+2]=C}static _ComputeSides(z,u,Y,H,J,l,T){const b=Y.length,L=H.length;let D,g;switch(z=z||C.DEFAULTSIDE){case C.FRONTSIDE:break;case C.BACKSIDE:for(D=0;D<b;D+=3){const z=Y[D];Y[D]=Y[D+2],Y[D+2]=z}for(g=0;g<L;g++)H[g]=-H[g];break;case C.DOUBLESIDE:{const z=u.length,M=z/3;for(let Y=0;Y<z;Y++)u[z+Y]=u[Y];for(D=0;D<b;D+=3)Y[D+b]=Y[D+2]+M,Y[D+1+b]=Y[D+1]+M,Y[D+2+b]=Y[D]+M;for(g=0;g<L;g++)H[L+g]=-H[g];const q=J.length;let C=0;for(C=0;C<q;C++)J[C+q]=J[C];for(l=l||new E.t(0,0,1,1),T=T||new E.t(0,0,1,1),C=0,D=0;D<q/2;D++)J[C]=l.x+(l.z-l.x)*J[C],J[C+1]=l.y+(l.w-l.y)*J[C+1],J[C+q]=T.x+(T.z-T.x)*J[C+q],J[C+q+1]=T.y+(T.w-T.y)*J[C+q+1],C+=2;break}}}static Parse(z){const u=new C,Y=z.Qz;Y&&u.set(Y,J.f.PositionKind);const H=z.Vz;H&&u.set(H,J.f.NormalKind);const E=z.tangents;E&&u.set(E,J.f.TangentKind);const l=z.xz;l&&u.set(l,J.f.UVKind);const b=z.uvs2;b&&u.set(b,J.f.UV2Kind);const L=z.uvs3;L&&u.set(L,J.f.UV3Kind);const D=z.uvs4;D&&u.set(D,J.f.UV4Kind);const g=z.uvs5;g&&u.set(g,J.f.UV5Kind);const M=z.uvs6;M&&u.set(M,J.f.UV6Kind);const K=z.Az;K&&(u.set(T.e.CheckColors4(K,Y.length/3),J.f.ColorKind),void 0!==z.hasVertexAlpha&&(u.hasVertexAlpha=z.hasVertexAlpha));const h=z.matricesIndices;h&&u.set(h,J.f.MatricesIndicesKind);const o=z.matricesWeights;o&&u.set(o,J.f.MatricesWeightsKind);const d=z.indices;d&&(u.indices=d);const t=z.materialInfos;if(t){u.materialInfos=[];for(const z of t){const Y=new q;Y.indexCount=z.indexCount,Y.indexStart=z.indexStart,Y.verticesCount=z.verticesCount,Y.verticesStart=z.verticesStart,Y.materialIndex=z.materialIndex,u.materialInfos.push(Y)}}return u}static ImportVertexData(z,u){const Y=C.Parse(z);u.setAllVerticesData(Y,z.updatable)}}C.FRONTSIDE=0,C.BACKSIDE=1,C.DOUBLESIDE=2,C.DEFAULTSIDE=0,C._UniqueIdGenerator=0,(0,H.e)([L.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H]=u;return!Array.isArray(H)}))],C,"_TransformVector3Coordinates",null),(0,H.e)([L.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H]=u;return!Array.isArray(H)}))],C,"_TransformVector3Normals",null),(0,H.e)([L.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H]=u;return!Array.isArray(H)}))],C,"_TransformVector4Normals",null),(0,H.e)([L.g.filter((function(){for(var z=arguments.length,u=new Array(z),Y=0;Y<z;Y++)u[Y]=arguments[Y];let[H]=u;return!Array.isArray(H)}))],C,"_FlipFaces",null)},11098:(z,u,Y)=>{Y.d(u,{d:()=>b});var H=Y(11103),E=Y(11124),J=Y(11131),l=Y(11148),T=Y(11156);class b{get materialDefines(){var z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(z=this._getDrawWrapper())||void 0===z?void 0:z.defines}set materialDefines(z){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=z}_getDrawWrapper(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=z??this._engine.currentRenderPassId;let Y=this._drawWrappers[z];return!Y&&u&&(this._drawWrappers[z]=Y=new T.e(this._mesh.iz().getEngine())),Y}_removeDrawWrapper(z){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var Y;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(Y=this._drawWrappers[z])||void 0===Y||Y.dispose(u));this._drawWrappers[z]=void 0}get effect(){var z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(z=this._getDrawWrapper())||void 0===z?void 0:z.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(z){this._mainDrawWrapperOverride=z}setEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this._drawWrapper;E.setEffect(z,u,H),void 0!==Y&&(E.materialContext=Y),z||(E.defines=null,E.materialContext=void 0)}resetDrawCache(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==z)return void this._removeDrawWrapper(z,!0,u);for(const z of this._drawWrappers)null===z||void 0===z||z.dispose(u)}this._drawWrappers=[]}static AddToMesh(z,u,Y,H,E,J,l){return new b(z,u,Y,H,E,J,l,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(z,u,Y,H,E,J,l){let T=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],b=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=z,this.verticesStart=u,this.verticesCount=Y,this.indexStart=H,this.indexCount=E,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=J,this._renderingMesh=l||J,b&&J.YT.push(this),this._engine=this._mesh.iz().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=J.YT.length-1,T&&(this.refreshBoundingInfo(),J.pl(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(z){return this._boundingInfo=z,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const z=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return z||this._renderingMesh}Oz(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!u)return z&&this._mesh.iz()._hasDefaultMaterial?this._mesh.iz().defaultMaterial:null;if(this._isMultiMaterial(u)){const z=u.getSubMaterial(this.materialIndex);return this._currentMaterial!==z&&(this._currentMaterial=z,this.resetDrawCache()),z}return u}_isMultiMaterial(z){return void 0!==z.getSubMaterial}refreshBoundingInfo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Sl)return this;if(z||(z=this._renderingMesh.getVerticesData(H.f.PositionKind)),!z)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const u=this._renderingMesh.Il();let Y;if(0===this.indexStart&&this.indexCount===u.length){const z=this._renderingMesh.getBoundingInfo();Y={minimum:z.minimum.clone(),maximum:z.maximum.clone()}}else Y=(0,l.e)(z,u,this.indexStart,this.indexCount,this._renderingMesh.Sl.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(Y.minimum,Y.maximum):this._boundingInfo=new J.e(Y.minimum,Y.maximum),this}_checkCollision(z){return this.getBoundingInfo()._checkCollision(z)}updateBoundingInfo(z){let u=this.getBoundingInfo();return u||(this.refreshBoundingInfo(),u=this.getBoundingInfo()),u&&u.update(z),this}isInFrustum(z){const u=this.getBoundingInfo();return!!u&&u.isInFrustum(z,this._mesh.Og)}isCompletelyInFrustum(z){const u=this.getBoundingInfo();return!!u&&u.isCompletelyInFrustum(z)}render(z){return this._renderingMesh.render(this,z,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(z,u){if(!this._linesIndexBuffer){const Y=6*Math.floor(this.indexCount/3),H=this.verticesStart+this.verticesCount>65535?new Uint32Array(Y):new Uint16Array(Y);let E=0;if(0===z.length)for(let z=this.indexStart;z<this.indexStart+this.indexCount;z+=3)H[E++]=z,H[E++]=z+1,H[E++]=z+1,H[E++]=z+2,H[E++]=z+2,H[E++]=z;else for(let u=this.indexStart;u<this.indexStart+this.indexCount;u+=3)H[E++]=z[u],H[E++]=z[u+1],H[E++]=z[u+1],H[E++]=z[u+2],H[E++]=z[u+2],H[E++]=z[u];this._linesIndexBuffer=u.createIndexBuffer(H),this._linesIndexCount=H.length}return this._linesIndexBuffer}canIntersects(z){const u=this.getBoundingInfo();return!!u&&z.intersectsBox(u.boundingBox)}intersects(z,u,Y,H,E){const J=this.Oz();if(!J)return null;let l=3,T=!1;switch(J.fillMode){case 3:case 5:case 6:case 8:return null;case 7:l=1,T=!0}return 4===J.fillMode?Y.length?this._intersectLines(z,u,Y,this._mesh.intersectionThreshold,H):this._intersectUnIndexedLines(z,u,Y,this._mesh.intersectionThreshold,H):!Y.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(z,u,Y,H,E):this._intersectTriangles(z,u,Y,l,T,H,E)}_intersectLines(z,u,Y,H,J){let l=null;for(let T=this.indexStart;T<this.indexStart+this.indexCount;T+=2){const b=u[Y[T]],L=u[Y[T+1]],D=z.intersectionSegment(b,L,H);if(!(D<0)&&((J||!l||D<l.distance)&&(l=new E.b(null,null,D),l.faceId=T/2,J)))break}return l}_intersectUnIndexedLines(z,u,Y,H,J){let l=null;for(let T=this.verticesStart;T<this.verticesStart+this.verticesCount;T+=2){const Y=u[T],b=u[T+1],L=z.intersectionSegment(Y,b,H);if(!(L<0)&&((J||!l||L<l.distance)&&(l=new E.b(null,null,L),l.faceId=T/2,J)))break}return l}_intersectTriangles(z,u,Y,H,E,J,l){let T=null,b=-1;for(let L=this.indexStart;L<this.indexStart+this.indexCount-(3-H);L+=H){b++;const H=Y[L],D=Y[L+1],g=Y[L+2];if(E&&4294967295===g){L+=2;continue}const M=u[H],q=u[D],C=u[g];if(!M||!q||!C)continue;if(l&&!l(M,q,C,z,H,D,g))continue;const K=z.intersectsTriangle(M,q,C);if(K){if(K.distance<0)continue;if((J||!T||K.distance<T.distance)&&(T=K,T.faceId=b,J))break}}return T}_intersectUnIndexedTriangles(z,u,Y,H,E){let J=null;for(let l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=3){const Y=u[l],T=u[l+1],b=u[l+2];if(E&&!E(Y,T,b,z,-1,-1,-1))continue;const L=z.intersectsTriangle(Y,T,b);if(L){if(L.distance<0)continue;if((H||!J||L.distance<J.distance)&&(J=L,J.faceId=l/3,H))break}}return J}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(z,u){const Y=new b(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,z,u,!1);if(!this.IsGlobal){const z=this.getBoundingInfo();if(!z)return Y;Y._boundingInfo=new J.e(z.minimum,z.maximum)}return Y}dispose(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.iz().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this._mesh.YT.indexOf(this);this._mesh.YT.splice(u,1),this.resetDrawCache(void 0,z)}getClassName(){return"SubMesh"}static CreateFromIndices(z,u,Y,H,E){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=Number.MAX_VALUE,T=-Number.MAX_VALUE;const L=(E||H).Il();for(let b=u;b<u+Y;b++){const z=L[b];z<l&&(l=z),z>T&&(T=z)}return new b(z,l,T-l+1,u,Y,H,E,J)}}},11657:(z,u,Y)=>{var H=Y(11267),E=Y(11103),J=Y(10903),l=Y(10953),T=Y(11131);H.b.prototype.thinInstanceAdd=function(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.iz().getEngine().getCaps().instancedArrays)return l.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(z)?z.length:1);const Y=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(z))for(let H=0;H<z.length;++H)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,z[H],H===z.length-1&&u);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,z,u);return Y},H.b.prototype.thinInstanceAddSelf=function(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(J.b.IdentityReadOnly,z)},H.b.prototype.thinInstanceRegisterAttribute=function(z,u){z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),this.removeVerticesData(z),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[z]=u,this._userThinInstanceBuffersStorage.sizes[z]=u*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[z]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[z]),this._userThinInstanceBuffersStorage.vertexBuffers[z]=new E.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[z],z,!0,!1,u,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])},H.b.prototype.thinInstanceSetMatrixAt=function(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||z>=this._thinInstanceDataStorage.instancesCount)return!1;const H=this._thinInstanceDataStorage.matrixData;return u.copyToArray(H,16*z),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[z]=u),Y&&(this.Sg("matrix"),this.Rz||this.thinInstanceRefreshBoundingInfo(!1)),!0},H.b.prototype.thinInstanceSetAttributeAt=function(z,u,Y){let H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[z]||u>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(z,0),this._userThinInstanceBuffersStorage.data[z].set(Y,u*this._userThinInstanceBuffersStorage.strides[z]),H&&this.Sg(z),!0)},Object.defineProperty(H.b.prototype,"ET",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(z){var u;const Y=this._thinInstanceDataStorage.matrixData??(null===(u=this.source)||void 0===u?void 0:u._thinInstanceDataStorage.matrixData);z<=(Y?Y.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=z)},enumerable:!0,configurable:!0}),H.b.prototype._thinInstanceCreateMatrixBuffer=function(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const H=new E.d(this.getEngine(),u,!Y,16,!1,!0);for(let E=0;E<4;E++)this.setVerticesBuffer(H.createVertexBuffer(z+E,4*E,4));return H},H.b.prototype.pg=function(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var J;if(Y=Y||16,"matrix"===z)null===(J=this._thinInstanceDataStorage.matrixBuffer)||void 0===J||J.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=u?u.length:32*Y,this._thinInstanceDataStorage.matrixData=u,this._thinInstanceDataStorage.worldMatrices=null,null!==u?(this._thinInstanceDataStorage.instancesCount=u.length/Y,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",u,H),this.Rz||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Rz||this.refreshBoundingInfo());else if("previousMatrix"===z){var l;null===(l=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===l||l.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=u,null!==u&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",u,H))}else{var T;if(z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),null===u)null!==(T=this._userThinInstanceBuffersStorage)&&void 0!==T&&T.data[z]&&(this.removeVerticesData(z),delete this._userThinInstanceBuffersStorage.data[z],delete this._userThinInstanceBuffersStorage.strides[z],delete this._userThinInstanceBuffersStorage.sizes[z],delete this._userThinInstanceBuffersStorage.vertexBuffers[z]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[z]=u,this._userThinInstanceBuffersStorage.strides[z]=Y,this._userThinInstanceBuffersStorage.sizes[z]=u.length,this._userThinInstanceBuffersStorage.vertexBuffers[z]=new E.f(this.getEngine(),u,z,!H,!1,Y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},H.b.prototype.Sg=function(z){var u;if("matrix"===z)this.PM&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(z),null===(u=this._thinInstanceDataStorage.matrixBuffer)||void 0===u||u.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===z){var Y;this.PM&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(z),null===(Y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Y||Y.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var H;z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),null!==(H=this._userThinInstanceBuffersStorage)&&void 0!==H&&H.vertexBuffers[z]&&(this.PM&&!this._userThinInstanceBuffersStorage.vertexBuffers[z].isUpdatable()&&this._thinInstanceRecreateBuffer(z),this._userThinInstanceBuffersStorage.vertexBuffers[z].updateDirectly(this._userThinInstanceBuffersStorage.data[z],0))}},H.b.prototype.thinInstancePartialBufferUpdate=function(z,u,Y){var H;"matrix"===z?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(u,Y):(z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),null!==(H=this._userThinInstanceBuffersStorage)&&void 0!==H&&H.vertexBuffers[z]&&this._userThinInstanceBuffersStorage.vertexBuffers[z].updateDirectly(u,Y))},H.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const z=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let u=0;u<this._thinInstanceDataStorage.instancesCount;++u)this._thinInstanceDataStorage.worldMatrices[u]=J.b.Nl(z,16*u)}return this._thinInstanceDataStorage.worldMatrices},H.b.prototype.thinInstanceRefreshBoundingInfo=function(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const H=this._thinInstanceDataStorage.boundingVectors;if(z||!this.rawBoundingInfo){H.length=0,this.refreshBoundingInfo(u,Y);const z=this.getBoundingInfo();this.rawBoundingInfo=new T.e(z.minimum,z.maximum)}const E=this.getBoundingInfo(),l=this._thinInstanceDataStorage.matrixData;if(0===H.length)for(let J=0;J<E.boundingBox.vectors.length;++J)H.push(E.boundingBox.vectors[J].clone());J.i.Pl[0].Bl(Number.POSITIVE_INFINITY),J.i.Pl[1].Bl(Number.NEGATIVE_INFINITY);for(let T=0;T<this._thinInstanceDataStorage.instancesCount;++T){J.b.FromArrayToRef(l,16*T,J.i.Matrix[0]);for(let z=0;z<H.length;++z)J.p.TransformCoordinatesToRef(H[z],J.i.Matrix[0],J.i.Pl[2]),J.i.Pl[0].minimizeInPlace(J.i.Pl[2]),J.i.Pl[1].maximizeInPlace(J.i.Pl[2])}E.reConstruct(J.i.Pl[0],J.i.Pl[1]),this.wz()},H.b.prototype._thinInstanceRecreateBuffer=function(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var Y;if("matrix"===z)null===(Y=this._thinInstanceDataStorage.matrixBuffer)||void 0===Y||Y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,u);else if("previousMatrix"===z){var H;if(this._scene.needsPreviousWorldMatrices)null===(H=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===H||H.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,u)}else{var J;z===E.f.ColorKind&&(z=E.f.ColorInstanceKind),null===(J=this._userThinInstanceBuffersStorage.vertexBuffers[z])||void 0===J||J.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[z]=new E.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[z],z,!u,!1,this._userThinInstanceBuffersStorage.strides[z],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},H.b.prototype._thinInstanceUpdateBufferSize=function(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;z===E.f.ColorKind&&(z=E.f.ColorInstanceKind);const Y="matrix"===z;if(!Y&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[z]))return;const H=Y?16:this._userThinInstanceBuffersStorage.strides[z],J=Y?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[z];let l=Y?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[z];const T=(this._thinInstanceDataStorage.instancesCount+u)*H;let b=J;for(;b<T;)b*=2;if(!l||J!=b){if(l){const z=new Float32Array(b);z.set(l,0),l=z}else l=new Float32Array(b);var L,D,g;if(Y){if(null===(L=this._thinInstanceDataStorage.matrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",l,!1),this._thinInstanceDataStorage.matrixData=l,this._thinInstanceDataStorage.matrixBufferSize=b,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(D=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===D||D.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",l,!1)}else null===(g=this._userThinInstanceBuffersStorage.vertexBuffers[z])||void 0===g||g.dispose(),this._userThinInstanceBuffersStorage.data[z]=l,this._userThinInstanceBuffersStorage.sizes[z]=b,this._userThinInstanceBuffersStorage.vertexBuffers[z]=new E.f(this.getEngine(),l,z,!0,!1,H,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},H.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},H.b.prototype._disposeThinInstanceSpecificData=function(){var z;null!==(z=this._thinInstanceDataStorage)&&void 0!==z&&z.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11218:(z,u,Y)=>{Y.d(u,{d:()=>D});var H=Y(11079),E=Y(11082),J=Y(11172),l=Y(10932),T=Y(10903),b=Y(11222),L=Y(10918);class D extends b.b{get billboardMode(){return this._billboardMode}set billboardMode(z){this._billboardMode!==z&&(this._billboardMode=z,this._cache.useBillboardPosition=0!==(this._billboardMode&D.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(z){this._infiniteDistance!==z&&(this._infiniteDistance=z)}constructor(z){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new T.p(0,0,1),this._up=new T.p(0,1,0),this._right=new T.p(1,0,0),this._position=T.p.Zero(),this._rotation=T.p.Zero(),this._rotationQuaternion=null,this._scaling=T.p.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=D.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.BM=T.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=T.p.Zero(),this._absoluteScaling=T.p.Zero(),this._absoluteRotationQuaternion=T.f.Identity(),this._pivotMatrix=T.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new l.e,this._nonUniformScaling=!1,u&&this.iz().addTransformNode(this)}getClassName(){return"ub"}get position(){return this._position}set position(z){this._position=z,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(z){this._rotation=z,this._rotationQuaternion=null,this._markAsDirtyInternal()}get el(){return this._scaling}set el(z){this._scaling=z,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(z){this._rotationQuaternion=z,z&&this._rotation.Bl(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return T.p.TransformNormalFromFloatsToRef(0,0,this.iz().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return T.p.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return T.p.TransformNormalFromFloatsToRef(this.iz().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(z){return this._poseMatrix?(this._poseMatrix.J(z),this):(this._poseMatrix=z.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=T.b.Identity()),this._poseMatrix}_isSynchronized(){const z=this._cache;return this._billboardMode===z.billboardMode&&this._billboardMode===D.BILLBOARDMODE_NONE&&(!z.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const z=this._cache;z.localMatrixUpdated=!1,z.billboardMode=-1,z.infiniteDistance=!1,z.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(z){return this.setPivotMatrix(z,!1)}setPivotMatrix(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.J(z),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=u,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=T.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const H=this.clone("Clone of "+(this.name||this.id),z||this.parent,!0);H&&Y&&Y(this,H);for(const E of this.getChildTransformNodes(!0))E.instantiateHierarchy(H,u,Y);return H}MT(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Bl(0),this._rotationQuaternion=this._rotationQuaternion||T.f.Identity(),z.decompose(this._scaling,this._rotationQuaternion,this._position),this.pl(!0)):(this._worldMatrix=z,this._absolutePosition.kl(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.pl(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.pl(!0),this}get XM(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.pl(),this._absolutePosition}setAbsolutePosition(z){if(!z)return this;let u,Y,H;if(void 0===z.x){if(arguments.length<3)return this;u=arguments[0],Y=arguments[1],H=arguments[2]}else u=z.x,Y=z.y,H=z.z;if(this.parent){const z=T.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(z),T.p.TransformCoordinatesFromFloatsToRef(u,Y,H,z,this.position)}else this.position.x=u,this.position.y=Y,this.position.z=H;return this._absolutePosition.J(z),this}setPositionWithLocalVector(z){return this.pl(),this.position=T.p.TransformNormal(z,this.BM),this}getPositionExpressedInLocalSpace(){this.pl();const z=T.i.Matrix[0];return this.BM.invertToRef(z),T.p.TransformNormal(this.position,z)}locallyTranslate(z){return this.pl(!0),this.position=T.p.TransformCoordinates(z,this.BM),this}lookAt(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const J=D._LookAtVectorCache,l=0===E?this.position:this.getAbsolutePosition();if(z.subtractToRef(l,J),this.setDirection(J,u,Y,H),1===E&&this.parent)if(this.rotationQuaternion){const z=T.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(z);const u=T.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),z.multiplyToRef(u,z),this.rotationQuaternion.fromRotationMatrix(z)}else{const z=T.i.Quaternion[0];T.f.FromEulerVectorToRef(this.rotation,z);const u=T.i.Matrix[0];z.toRotationMatrix(u);const Y=T.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.invert(),u.multiplyToRef(Y,u),z.fromRotationMatrix(u),z.toEulerAnglesToRef(this.rotation)}return this}sb(z){const u=T.p.Zero();return this.getDirectionToRef(z,u),u}getDirectionToRef(z,u){return T.p.TransformNormalToRef(z,this.getWorldMatrix(),u),this}setDirection(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const E=-Math.atan2(z.z,z.x)+Math.PI/2,J=Math.sqrt(z.x*z.x+z.z*z.z),l=-Math.atan2(z.y,J);return this.rotationQuaternion?T.f.RotationYawPitchRollToRef(E+u,l+Y,H,this.rotationQuaternion):(this.rotation.x=l+Y,this.rotation.y=E+u,this.rotation.z=H),this}setPivotPoint(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.iz().getRenderId()&&this.pl(!0);const Y=this.getWorldMatrix();if(1==u){const u=T.i.Matrix[0];Y.invertToRef(u),z=T.p.TransformCoordinates(z,u)}return this.setPivotMatrix(T.b.Translation(-z.x,-z.y,-z.z),!0)}getPivotPoint(){const z=T.p.Zero();return this.getPivotPointToRef(z),z}getPivotPointToRef(z){return z.x=-this._pivotMatrix.m[12],z.y=-this._pivotMatrix.m[13],z.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const z=T.p.Zero();return this.getAbsolutePivotPointToRef(z),z}getAbsolutePivotPointToRef(z){return this.getPivotPointToRef(z),T.p.TransformCoordinatesToRef(z,this.getWorldMatrix(),z),this}uD(z){if(this._isDirty)return this;if(this._children)for(const u of this._children)u.uD(z);return super.uD(z)}setParent(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!z&&!this.parent)return this;const H=T.i.Quaternion[0],E=T.i.Pl[0],J=T.i.Pl[1],l=T.i.Matrix[1];T.b.IdentityToRef(l);const b=T.i.Matrix[0];this.pl(!0);let L=this.rotationQuaternion;return L||(L=D._TmpRotation,T.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,L)),T.b.ComposeToRef(this.el,L,this.position,b),this.parent&&b.multiplyToRef(this.parent.pl(!0),b),z&&(z.pl(!0).invertToRef(l),b.multiplyToRef(l,b)),b.decompose(J,H,E,u?this:void 0),this.rotationQuaternion?this.rotationQuaternion.J(H):H.toEulerAnglesToRef(this.rotation),this.el.J(J),this.position.J(E),this.parent=z,Y&&this.setPivotMatrix(T.b.Identity()),this}addChild(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return z.setParent(this,u),this}removeChild(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return z.parent!==this||z.setParent(null,u),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(z){return this._nonUniformScaling!==z&&(this._nonUniformScaling=z,!0)}attachToBone(z,u){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=u,this.parent=z,z.getSkeleton().prepare(!0),z.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=z?this._currentParentWhenAttachingToBone:null,this):(z&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(z,u,Y){let H;if(z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Bl(0)),Y&&0!==Y){if(this.parent){const Y=this.parent.getWorldMatrix(),H=T.i.Matrix[0];Y.invertToRef(H),z=T.p.TransformNormal(z,H),Y.determinant()<0&&(u*=-1)}H=T.f.RotationAxisToRef(z,u,D._RotationAxisCache),H.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else H=T.f.RotationAxisToRef(z,u,D._RotationAxisCache),this.rotationQuaternion.multiplyToRef(H,this.rotationQuaternion);return this}rotateAround(z,u,Y){u.normalize(),this.rotationQuaternion||(this.rotationQuaternion=T.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Bl(0));const H=T.i.Pl[0],E=T.i.Pl[1],J=T.i.Pl[2],l=T.i.Quaternion[0],b=T.i.Matrix[0],L=T.i.Matrix[1],D=T.i.Matrix[2],g=T.i.Matrix[3];return z.subtractToRef(this.position,H),T.b.TranslationToRef(H.x,H.y,H.z,b),T.b.TranslationToRef(-H.x,-H.y,-H.z,L),T.b.RotationAxisToRef(u,Y,D),L.multiplyToRef(D,g),g.multiplyToRef(b,g),g.decompose(E,l,J),this.position.addInPlace(J),l.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(z,u,Y){const H=z.scale(u);if(Y&&0!==Y)this.setAbsolutePosition(this.getAbsolutePosition().add(H));else{const z=this.getPositionExpressedInLocalSpace().add(H);this.setPositionWithLocalVector(z)}return this}addRotation(z,u,Y){let H;this.rotationQuaternion?H=this.rotationQuaternion:(H=T.i.Quaternion[1],T.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,H));const E=T.i.Quaternion[0];return T.f.RotationYawPitchRollToRef(u,z,Y,E),H.multiplyInPlace(E),this.rotationQuaternion||H.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==D.BILLBOARDMODE_NONE}pl(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const Y=this.iz().getRenderId();if(!this._isDirty&&!z&&(this._currentRenderId===Y||this.isSynchronized()))return this._currentRenderId=Y,this._worldMatrix;u=u||this.iz().activeCamera,this._updateCache();const H=this._cache;H.pivotMatrixUpdated=!1,H.billboardMode=this.billboardMode,H.infiniteDistance=this.infiniteDistance,H.parent=this._parentNode,this._currentRenderId=Y,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const E=this._getEffectiveParent(),J=D._TmpScaling;let l,b=this._position;if(this._infiniteDistance&&!this.parent&&u){const z=u.getWorldMatrix(),Y=new T.p(z.m[12],z.m[13],z.m[14]);b=D._TmpTranslation,b.kl(this._position.x+Y.x,this._position.y+Y.y,this._position.z+Y.z)}if(J.kl(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,l=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(T.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.kl(0,0,0))}}else l=D._TmpRotation,T.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l);if(this._usePivotMatrix){const z=T.i.Matrix[1];T.b.ScalingToRef(J.x,J.y,J.z,z);const u=T.i.Matrix[0];l.toRotationMatrix(u),this._pivotMatrix.multiplyToRef(z,T.i.Matrix[4]),T.i.Matrix[4].multiplyToRef(u,this.BM),this._postMultiplyPivotMatrix&&this.BM.multiplyToRef(this._pivotMatrixInverse,this.BM),this.BM.addTranslationFromFloats(b.x,b.y,b.z)}else T.b.ComposeToRef(J,l,b,this.BM);if(E&&E.getWorldMatrix){if(z&&E.pl(z),this.billboardMode){if(this._transformToBoneReferal){const z=this.parent;z.getSkeleton().prepare(),z.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),T.i.Matrix[7])}else T.i.Matrix[7].J(E.getWorldMatrix());const z=T.i.Pl[5],u=T.i.Pl[6],Y=T.i.Quaternion[0];T.i.Matrix[7].decompose(u,Y,z),T.b.ScalingToRef(u.x,u.y,u.z,T.i.Matrix[7]),T.i.Matrix[7].setTranslation(z),D.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(Y,z),this.BM.setTranslation(z)),this.BM.multiplyToRef(T.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const z=this.parent;z.getSkeleton().prepare(),this.BM.multiplyToRef(z.getFinalMatrix(),T.i.Matrix[6]),T.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.BM.multiplyToRef(E.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.J(this.BM);if(u&&this.billboardMode)if(H.useBillboardPosition){if(H.useBillboardPosition){const z=T.i.Pl[0];this._worldMatrix.getTranslationToRef(z);const Y=u.globalPosition;this._worldMatrix.invertToRef(T.i.Matrix[1]);const H=T.i.Pl[1];T.p.TransformCoordinatesToRef(Y,T.i.Matrix[1],H),H.normalize();const E=-Math.atan2(H.z,H.x)+Math.PI/2,J=Math.sqrt(H.x*H.x+H.z*H.z),l=-Math.atan2(H.y,J);if(T.f.RotationYawPitchRollToRef(E,l,0,T.i.Quaternion[0]),(this.billboardMode&D.BILLBOARDMODE_ALL)!==D.BILLBOARDMODE_ALL){const z=T.i.Pl[1];T.i.Quaternion[0].toEulerAnglesToRef(z),(this.billboardMode&D.BILLBOARDMODE_X)!==D.BILLBOARDMODE_X&&(z.x=0),(this.billboardMode&D.BILLBOARDMODE_Y)!==D.BILLBOARDMODE_Y&&(z.y=0),(this.billboardMode&D.BILLBOARDMODE_Z)!==D.BILLBOARDMODE_Z&&(z.z=0),T.b.RotationYawPitchRollToRef(z.y,z.x,z.z,T.i.Matrix[0])}else T.b.FromQuaternionToRef(T.i.Quaternion[0],T.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(T.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(T.i.Pl[0])}}else{const z=T.i.Pl[0];if(this._worldMatrix.getTranslationToRef(z),T.i.Matrix[1].J(u.getViewMatrix()),T.i.Matrix[1].setTranslationFromFloats(0,0,0),T.i.Matrix[1].invertToRef(T.i.Matrix[0]),(this.billboardMode&D.BILLBOARDMODE_ALL)!==D.BILLBOARDMODE_ALL){T.i.Matrix[0].decompose(void 0,T.i.Quaternion[0],void 0);const z=T.i.Pl[1];T.i.Quaternion[0].toEulerAnglesToRef(z),(this.billboardMode&D.BILLBOARDMODE_X)!==D.BILLBOARDMODE_X&&(z.x=0),(this.billboardMode&D.BILLBOARDMODE_Y)!==D.BILLBOARDMODE_Y&&(z.y=0),(this.billboardMode&D.BILLBOARDMODE_Z)!==D.BILLBOARDMODE_Z&&(z.z=0),T.b.RotationYawPitchRollToRef(z.y,z.x,z.z,T.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(T.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(T.i.Pl[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):E&&E._nonUniformScaling?this._updateNonUniformScalingState(E._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.kl(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=T.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.pl(),z){const z=this.getChildren();for(let u=0;u<z.length;++u){const Y=z[u];if(Y){Y.pl();const z=T.i.Matrix[0];Y.BM.multiplyToRef(this.BM,z);const u=T.i.Quaternion[0];z.decompose(Y.el,u,Y.position),Y.rotationQuaternion?Y.rotationQuaternion.J(u):u.toEulerAnglesToRef(Y.rotation)}}}this.el.kl(1,1,1),this.position.kl(0,0,0),this.rotation.kl(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=T.f.Identity()),this._worldMatrix=T.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(z){return this.onAfterWorldMatrixUpdateObservable.add(z),this}unregisterAfterWorldMatrixUpdate(z){return this.onAfterWorldMatrixUpdateObservable.removeCallback(z),this}getPositionInCameraSpace(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z||(z=this.iz().activeCamera),T.p.TransformCoordinates(this.getAbsolutePosition(),z.getViewMatrix())}getDistanceToCamera(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z||(z=this.iz().activeCamera),this.getAbsolutePosition().JY(z.globalPosition).length()}clone(z,u,Y){const H=J.d.Clone((()=>new D(z,this.iz())),this);if(H.name=z,H.id=z,u&&(H.parent=u),!Y){const u=this.getDescendants(!0);for(let Y=0;Y<u.length;Y++){const E=u[Y];E.clone&&E.clone(z+"."+E.name,H)}}return H}serialize(z){const u=J.d.Serialize(this,z);return u.type=this.getClassName(),u.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(u),u.localMatrix=this.getPivotMatrix().al(),u.isEnabled=this.isEnabled(),J.d.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u}static Parse(z,u,Y){const H=J.d.Parse((()=>new D(z.name,u)),z,u,Y);if(z.localMatrix?H.setPreTransformMatrix(T.b.Nl(z.localMatrix)):z.pivotMatrix&&H.setPivotMatrix(T.b.Nl(z.pivotMatrix)),H.oT(z.isEnabled),H._waitingParsedUniqueId=z.uniqueId,void 0!==z.parentId&&(H._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(H._waitingParentInstanceIndex=z.parentInstanceIndex),z.animations){for(let u=0;u<z.animations.length;u++){const Y=z.animations[u],E=(0,L.c)("BABYLON.Animation");E&&H.animations.push(E.Parse(Y))}b.b.ParseAnimationRanges(H,z,u)}return z.autoAnimate&&u.beginAnimation(H,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),H}getChildTransformNodes(z,u){const Y=[];return this._getDescendants(Y,z,(z=>(!u||u(z))&&z instanceof D)),Y}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.iz().stopAnimation(this),this.iz().removeTransformNode(this),this._parentContainer){const z=this._parentContainer.transformNodes.indexOf(this);z>-1&&this._parentContainer.transformNodes.splice(z,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),z){const z=this.getChildTransformNodes(!0);for(const u of z)u.parent=null,u.pl(!0)}super.dispose(z,u)}normalizeToUnitCube(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,H=null,E=null;u&&(this.rotationQuaternion?(E=this.rotationQuaternion.clone(),this.rotationQuaternion.kl(0,0,0,1)):this.rotation&&(H=this.rotation.clone(),this.rotation.kl(0,0,0)));const J=this.getHierarchyBoundingVectors(z,Y),l=J.max.JY(J.min),T=Math.max(l.x,l.y,l.z);if(0===T)return this;const b=1/T;return this.el.scaleInPlace(b),u&&(this.rotationQuaternion&&E?this.rotationQuaternion.J(E):this.rotation&&H&&this.rotation.J(H)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}D.BILLBOARDMODE_NONE=0,D.BILLBOARDMODE_X=1,D.BILLBOARDMODE_Y=2,D.BILLBOARDMODE_Z=4,D.BILLBOARDMODE_ALL=7,D.BILLBOARDMODE_USE_POSITION=128,D.BillboardUseParentOrientation=!1,D._TmpRotation=T.f.Zero(),D._TmpScaling=T.p.Zero(),D._TmpTranslation=T.p.Zero(),D._LookAtVectorCache=new T.p(0,0,0),D._RotationAxisCache=new T.f,(0,H.e)([(0,E.K)("position")],D.prototype,"_position",void 0),(0,H.e)([(0,E.K)("rotation")],D.prototype,"_rotation",void 0),(0,H.e)([(0,E.z)("rotationQuaternion")],D.prototype,"_rotationQuaternion",void 0),(0,H.e)([(0,E.K)("el")],D.prototype,"_scaling",void 0),(0,H.e)([(0,E.L)("billboardMode")],D.prototype,"_billboardMode",void 0),(0,H.e)([(0,E.L)()],D.prototype,"scalingDeterminant",void 0),(0,H.e)([(0,E.L)("infiniteDistance")],D.prototype,"_infiniteDistance",void 0),(0,H.e)([(0,E.L)()],D.prototype,"ignoreNonUniformScaling",void 0),(0,H.e)([(0,E.L)()],D.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11595:(z,u,Y)=>{Y.d(u,{c:()=>L});var H=Y(10903),E=Y(10937),J=Y(11378),l=Y(10906),T=Y(11188);class b{constructor(z,u,Y,H){this.name=z,this.worldAxisForNormal=u,this.worldAxisForFileX=Y,this.worldAxisForFileY=H}}class L{static ConvertCubeMapTextureToSphericalPolynomial(z){var u;if(!z.isCube)return null;null===(u=z.iz())||void 0===u||u.getEngine().flushFramebuffer();const Y=z.getSize().width,H=z.readPixels(0,void 0,void 0,!1),E=z.readPixels(1,void 0,void 0,!1);let J,l;z.isRenderTarget?(J=z.readPixels(3,void 0,void 0,!1),l=z.readPixels(2,void 0,void 0,!1)):(J=z.readPixels(2,void 0,void 0,!1),l=z.readPixels(3,void 0,void 0,!1));const T=z.readPixels(4,void 0,void 0,!1),b=z.readPixels(5,void 0,void 0,!1),L=z.gammaSpace;let D=0;return 1!=z.textureType&&2!=z.textureType||(D=1),new Promise((z=>{Promise.all([E,H,J,l,T,b]).then((u=>{let[H,E,J,l,T,b]=u;const g={size:Y,right:E,left:H,up:J,down:l,front:T,back:b,format:5,type:D,gammaSpace:L};z(this.ConvertCubeMapToSphericalPolynomial(g))}))}))}static _AreaElement(z,u){return Math.atan2(z*u,Math.sqrt(z*z+u*u+1))}static ConvertCubeMapToSphericalPolynomial(z){const u=new J.d;let Y=0;const H=2/z.size,b=H,L=.5*H,D=L-1;for(let J=0;J<6;J++){const g=this._FileFaces[J],M=z[g.name];let q=D;const C=5===z.format?4:3;for(let J=0;J<z.size;J++){let K=D;for(let b=0;b<z.size;b++){const D=g.worldAxisForFileX.scale(K).add(g.worldAxisForFileY.scale(q)).add(g.worldAxisForNormal);D.normalize();const h=this._AreaElement(K-L,q-L)-this._AreaElement(K-L,q+L)-this._AreaElement(K+L,q-L)+this._AreaElement(K+L,q+L);let o=M[J*z.size*C+b*C+0],d=M[J*z.size*C+b*C+1],t=M[J*z.size*C+b*C+2];isNaN(o)&&(o=0),isNaN(d)&&(d=0),isNaN(t)&&(t=0),0===z.type&&(o/=255,d/=255,t/=255),z.gammaSpace&&(o=Math.pow((0,E.Clamp)(o),l.n),d=Math.pow((0,E.Clamp)(d),l.n),t=Math.pow((0,E.Clamp)(t),l.n));const W=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const z=Math.max(o,d,t);if(z>W){const u=W/z;o*=u,d*=u,t*=u}}else o=(0,E.Clamp)(o,0,W),d=(0,E.Clamp)(d,0,W),t=(0,E.Clamp)(t,0,W);const Z=new T.c(o,d,t);u.addLight(D,Z,h),Y+=h,K+=H}q+=b}}const g=6*(4*Math.PI)/6/Y;return u.scaleInPlace(g),u.convertIncidentRadianceToIrradiance(),u.convertIrradianceToLambertianRadiance(),J.h.FromHarmonics(u)}}L._FileFaces=[new b("right",new H.p(1,0,0),new H.p(0,0,-1),new H.p(0,-1,0)),new b("left",new H.p(-1,0,0),new H.p(0,0,1),new H.p(0,-1,0)),new b("up",new H.p(0,1,0),new H.p(1,0,0),new H.p(0,0,1)),new b("down",new H.p(0,-1,0),new H.p(1,0,0),new H.p(0,0,-1)),new b("front",new H.p(0,0,1),new H.p(1,0,0),new H.p(0,-1,0)),new b("back",new H.p(0,0,-1),new H.p(-1,0,0),new H.p(0,-1,0))],L.MAX_HDRI_VALUE=4096,L.PRESERVE_CLAMPED_COLORS=!1},10910:(z,u,Y)=>{function H(z,u){const Y=[];for(let H=0;H<z;++H)Y.push(u());return Y}function E(z,u){return H(z,u)}Y.d(u,{b:()=>H,f:()=>E,h:()=>l});const J=["push","splice","pop","shift","unshift"];function l(z,u){const Y=J.map((Y=>function(z,u,Y){const H=z[u];if("function"!==typeof H)return null;const E=function(){const H=z.length,J=E.previous.apply(z,arguments);return Y(u,H),J};return H.next=E,E.previous=H,z[u]=E,()=>{const Y=E.previous;if(!Y)return;const H=E.next;H?(Y.next=H,H.previous=Y):(Y.next=void 0,z[u]=Y),E.next=void 0,E.previous=void 0}}(z,Y,u)));return()=>{for(const z of Y)null===z||void 0===z||z()}}},11481:(z,u,Y)=>{Y.d(u,{e:()=>l});var H=Y(11415),E=Y(11488);let J=0;const l=z=>{if(!z.environmentBRDFTexture){const u=z.useDelayedTextureLoading;z.useDelayedTextureLoading=!1;const Y=z._blockEntityCollection;z._blockEntityCollection=!1;const l=H.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+J++,z,!0,!1,H.b.BILINEAR_SAMPLINGMODE);z._blockEntityCollection=Y;const T=z.getEngine().getLoadedTexturesCache(),b=T.indexOf(l.getInternalTexture());-1!==b&&T.splice(b,1),l.isRGBD=!0,l.wrapU=H.b.CLAMP_ADDRESSMODE,l.wrapV=H.b.CLAMP_ADDRESSMODE,z.environmentBRDFTexture=l,z.useDelayedTextureLoading=u,E.b.ExpandRGBDTexture(l);const L=z.getEngine().onContextRestoredObservable.add((()=>{l.isRGBD=!0;const u=z.onBeforeRenderObservable.add((()=>{l.isReady()&&(z.onBeforeRenderObservable.remove(u),E.b.ExpandRGBDTexture(l))}))}));z.fl.add((()=>{z.getEngine().onContextRestoredObservable.remove(L)}))}return z.environmentBRDFTexture}},11239:(z,u,Y)=>{function H(z,u,Y){try{const H=z.next();H.done?u(H):H.value?H.value.then((()=>{H.value=void 0,u(H)}),Y):u(H)}catch(H){Y(H)}}function E(){let z,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(Y,E,J)=>{const l=performance.now();void 0===z||l-z>u?(z=l,setTimeout((()=>{H(Y,E,J)}),0)):H(Y,E,J)}}function J(z,u,Y,H,E){const J=()=>{let l;const T=z=>{z.done?Y(z.value):void 0===l?l=!0:J()};do{l=void 0,E&&E.aborted?H(new Error("Aborted")):u(z,T,H),void 0===l&&(l=!1)}while(l)};J()}function l(z,u){let Y;return J(z,H,(z=>Y=z),(z=>{throw z}),u),Y}async function T(z,u,Y){return await new Promise(((H,E)=>{J(z,u,H,E,Y)}))}function b(z,u){return function(){return l(z(...arguments),u)}}Y.d(u,{b:()=>E,e:()=>b,f:()=>T,h:()=>l})},11089:(z,u,Y)=>{Y.d(u,{e:()=>J,i:()=>l});const H={},E={};function J(z){const u=z.getClassName();return E[u]||(E[u]={}),E[u]}function l(z){const u=z.getClassName();if(H[u])return H[u];H[u]={};const Y=H[u];let J=z,l=u;for(;l;){const z=E[l];for(const E in z)Y[E]=z[E];let u,H=!1;do{if(u=Object.getPrototypeOf(J),!u.getClassName){H=!0;break}if(u.getClassName()!==l)break;J=u}while(u);if(H)break;l=u.getClassName(),J=u}return Y}},11082:(z,u,Y)=>{Y.d(u,{C:()=>T,G:()=>D,K:()=>g,L:()=>l,c:()=>J,g:()=>d,h:()=>q,j:()=>b,m:()=>C,q:()=>L,r:()=>K,u:()=>o,x:()=>M,z:()=>h});var H=Y(11089);function E(z,u){return(Y,E)=>{const J=(0,H.e)(Y);J[E]||(J[E]={type:z,sourceName:u})}}function J(z){return function(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(Y,H)=>{const E=u||"_"+H;Object.defineProperty(Y,H,{get:function(){return this[E]},set:function(u){var H;"function"===typeof(null===(H=this[E])||void 0===H?void 0:H.equals)&&this[E].equals(u)||this[E]!==u&&(this[E]=u,Y[z].apply(this))},enumerable:!0,configurable:!0})}}(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function l(z){return E(0,z)}function T(z){return E(1,z)}function b(z){return E(2,z)}function L(z){return E(3,z)}function D(z){return E(4,z)}function g(z){return E(5,z)}function M(z){return E(6,z)}function q(z){return E(7,z)}function C(z){return E(8,z)}function K(z){return E(9,z)}function h(z){return E(10,z)}function o(z){return E(12,z)}function d(z,u,Y,H){const E=Y.value;Y.value=function(){let Y=E;if("undefined"!==typeof _native&&_native[u]){const z=_native[u];Y=H?function(){return H(...arguments)?z(...arguments):E(...arguments)}:z}return z[u]=Y,Y(...arguments)}}d.filter=function(z){return(u,Y,H)=>d(u,Y,H,z)}},11172:(z,u,Y)=>{Y.d(u,{d:()=>L});var H=Y(10970),E=Y(11181),J=Y(11188),l=Y(10903),T=Y(11089);const b=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const J=z();E.e&&E.e.HasTags(u)&&E.e.AddTagsTo(J,E.e.GetTags(u,!0));const l=(0,T.i)(J),b={};for(const E in l){const z=l[E],T=u[E],D=z.type;if(void 0!==T&&null!==T&&("uniqueId"!==E||L.AllowLoadingUniqueId))switch(D){case 0:case 6:case 9:case 11:J[E]=T;break;case 1:H.cloneTexturesOnlyOnce&&b[T.uniqueId]?J[E]=b[T.uniqueId]:(J[E]=Y||T.isRenderTarget?T:T.clone(),b[T.uniqueId]=J[E]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:J[E]=Y?T:T.clone()}}return J};class L{static AppendSerializedAnimations(z,u){if(z.animations){u.animations=[];for(let Y=0;Y<z.animations.length;Y++){const H=z.animations[Y];u.animations.push(H.serialize())}}}static Serialize(z,u){u||(u={}),E.e&&(u.tags=E.e.GetTags(z));const Y=(0,T.i)(z);for(const H in Y){const E=Y[H],J=E.sourceName||H,l=E.type,T=z[H];if(void 0!==T&&null!==T&&("uniqueId"!==H||L.AllowLoadingUniqueId))switch(l){case 0:u[J]=T;break;case 1:case 3:case 7:case 9:u[J]=T.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:u[J]=T.al();break;case 6:case 11:u[J]=T.id}}return u}static ParseProperties(z,u,Y,H){H||(H="");const E=(0,T.i)(u);for(const T in E){const b=E[T],D=z[b.sourceName||T],g=b.type;if(void 0!==D&&null!==D&&("uniqueId"!==T||L.AllowLoadingUniqueId)){const z=u;switch(g){case 0:z[T]=D;break;case 1:Y&&(z[T]=L._TextureParser(D,Y,H));break;case 2:z[T]=J.c.Nl(D);break;case 3:z[T]=L._FresnelParametersParser(D);break;case 4:z[T]=l.m.Nl(D);break;case 5:z[T]=l.p.Nl(D);break;case 6:Y&&(z[T]=Y.getLastMeshById(D));break;case 7:z[T]=L._ColorCurvesParser(D);break;case 8:z[T]=J.e.Nl(D);break;case 9:z[T]=L._ImageProcessingConfigurationParser(D);break;case 10:z[T]=l.f.Nl(D);break;case 11:Y&&(z[T]=Y.getCameraById(D));break;case 12:z[T]=l.b.Nl(D)}}}}static Parse(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=z();return E.e&&E.e.AddTagsTo(J,u.tags),L.ParseProperties(u,J,Y,H),J}static Clone(z,u){return b(z,u,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(z,u){return b(z,u,!0)}}L.AllowLoadingUniqueId=!1,L._ImageProcessingConfigurationParser=z=>{throw(0,H.e)("ImageProcessingConfiguration")},L._FresnelParametersParser=z=>{throw(0,H.e)("FresnelParameters")},L._ColorCurvesParser=z=>{throw(0,H.e)("ColorCurves")},L._TextureParser=(z,u,Y)=>{throw(0,H.e)("Texture")}},10959:(z,u,Y)=>{Y.d(u,{b:()=>J});var H=Y(10953);const E=(z,u,Y)=>z?z.getClassName&&"Mesh"===z.getClassName()?null:!z.getClassName||"SubMesh"!==z.getClassName()&&"PhysicsBody"!==z.getClassName()?z.clone?z.clone():Array.isArray(z)?z.slice():Y&&"object"===typeof z?{...z}:null:z.clone(u):null;class J{static DeepCopy(z,u,Y,J){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const T=function(z){const u=[];do{const Y=Object.getOwnPropertyNames(z);for(const z of Y)-1===u.indexOf(z)&&u.push(z)}while(z=Object.getPrototypeOf(z));return u}(z);for(const L of T){if("_"===L[0]&&(!J||-1===J.indexOf(L)))continue;if(L.endsWith("Observable"))continue;if(Y&&-1!==Y.indexOf(L))continue;const T=z[L],D=typeof T;if("function"!==D)try{if("object"===D)if(T instanceof Uint8Array)u[L]=Uint8Array.from(T);else if(T instanceof Array){if(u[L]=[],T.length>0)if("object"==typeof T[0])for(let z=0;z<T.length;z++){const Y=E(T[z],u,l);-1===u[L].indexOf(Y)&&u[L].push(Y)}else u[L]=T.slice(0)}else u[L]=E(T,u,l);else u[L]=T}catch(b){H.b.Warn(b.message)}}}}},11682:(z,u,Y)=>{function H(){const z=z=>!!z&&"object"===typeof z;for(var u=arguments.length,Y=new Array(u),E=0;E<u;E++)Y[E]=arguments[E];return Y.reduce(((u,Y)=>{const E=Object.keys(Y);for(const J of E){const E=u[J],l=Y[J];Array.isArray(E)&&Array.isArray(l)?u[J]=E.concat(...l):z(E)&&z(l)?u[J]=H(E,l):u[J]=l}return u}),{})}Y.d(u,{e:()=>H})},10970:(z,u,Y)=>{Y.d(u,{e:()=>E});const H={};function E(z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!H[z])return H[z]=!0,`${z} needs to be imported before as it contains a side-effect required by your code.`}},10948:(z,u,Y)=>{function H(){return"undefined"!==typeof window}function E(){return"undefined"!==typeof navigator}function J(){return"undefined"!==typeof document}function l(z){let u="",Y=z.firstChild;for(;Y;)3===Y.nodeType&&(u+=Y.textContent),Y=Y.nextSibling;return u}Y.d(u,{e:()=>l,f:()=>J,g:()=>E,h:()=>H})},11473:(z,u,Y)=>{Y.r(u),Y.d(u,{Dispose:()=>M,DumpData:()=>g,DumpDataAsync:()=>D,DumpFramebuffer:()=>L,DumpTools:()=>q});var H=Y(11445),E=Y(10945),J=Y(10937),l=Y(10928);let T,b=null;async function L(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0;const T=await Y.readPixels(0,0,z,u);g(z,u,new Uint8Array(T.buffer),H,E,J,!0,void 0,l)}async function D(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7?arguments[7]:void 0;return await new Promise((b=>{g(z,u,Y,(z=>b(z)),H,E,J,l,T)}))}function g(z,u,L,D){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return b||(b=new Promise(((z,u)=>{let E,J=null;const b={sD:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Y.bind(Y,11333)).then((L=>{let{ThinEngine:D}=L;const g=l.d.Instances.length;try{E=new OffscreenCanvas(100,100),J=new D(E,!1,b)}catch(K){var q;g<l.d.Instances.length&&(null===(q=l.d.Instances.pop())||void 0===q||q.dispose()),E=document.createElement("canvas"),J=new D(E,!1,b)}l.d.Instances.pop(),l.d.OnEnginesDisposedObservable.add((z=>{J&&z!==J&&!J.L&&0===l.d.Instances.length&&M()})),J.getCaps().parallelShaderCompile=void 0;const C=new H.e(J);Y.e(37).then(Y.bind(Y,13257)).then((Y=>{let{passPixelShader:l}=Y;if(!J)return void u("Engine is not defined");const b=new H.g({vl:J,name:l.name,fragmentShader:l.shader,samplerNames:["textureSampler"]});T={canvas:E,vl:J,renderer:C,wrapper:b},z(T)}))})).catch(u)}))),await b})().then((Y=>{if(Y.vl.setSize(z,u,!0),L instanceof Float32Array){const z=new Uint8Array(L.length);let u=L.length;for(;u--;){const Y=L[u];z[u]=Math.round(255*(0,J.Clamp)(Y))}L=z}const H=Y.vl.createRawTexture(L,z,u,5,!1,!C,1);Y.renderer.setViewport(),Y.renderer.applyEffectWrapper(Y.wrapper),Y.wrapper.effect._bindTexture("textureSampler",H),Y.renderer.draw(),K?E.e.ToBlob(Y.canvas,(z=>{const u=new FileReader;u.onload=z=>{const u=z.target.result;D&&D(u)},u.readAsArrayBuffer(z)}),g,h):E.e.EncodeScreenshotCanvasData(Y.canvas,D,g,q,h),H.dispose()}))}function M(){var z;T?(T.wrapper.dispose(),T.renderer.dispose(),T.vl.dispose()):null===(z=b)||void 0===z||z.then((z=>{z.wrapper.dispose(),z.renderer.dispose(),z.vl.dispose()}));b=null,T=null}const q={DumpData:g,DumpDataAsync:D,DumpFramebuffer:L,Dispose:M};E.e.DumpData=g,E.e.DumpDataAsync=D,E.e.DumpFramebuffer=L},10982:(z,u,Y)=>{Y.d(u,{e:()=>H,f:()=>E,i:()=>J});class H extends Error{}H._setPrototypeOf=Object.setPrototypeOf||((z,u)=>(z.__proto__=u,z));const E={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class J extends H{constructor(z,u,Y){super(z),this.errorCode=u,this.innerError=Y,this.name="RuntimeError",H._setPrototypeOf(this,J.prototype)}}},10980:(z,u,Y)=>{Y.d(u,{e:()=>G,h:()=>t,i:()=>Q,m:()=>A,p:()=>i,n:()=>h,s:()=>s,t:()=>v,v:()=>X,x:()=>W});var H=Y(10972),E=Y(10948),J=Y(10932);class l{}l.FilesToLoad={};var T=Y(10982),b=Y(10990),L=Y(10996),D=Y(10928),g=Y(10953),M=Y(11009),q=Y(11002),C=Y(11018);const K=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class h extends T.i{constructor(z,u){super(z,T.f.LoadFileError),this.name="LoadFileError",T.e._setPrototypeOf(this,h.prototype),u instanceof H.d?this.request=u:this.file=u}}class o extends T.i{constructor(z,u){super(z,T.f.RequestFileError),this.request=u,this.name="RequestFileError",T.e._setPrototypeOf(this,o.prototype)}}class d extends T.i{constructor(z,u){super(z,T.f.ReadFileError),this.file=u,this.name="ReadFileError",T.e._setPrototypeOf(this,d.prototype)}}const t={DefaultRetryStrategy:class{static ExponentialBackoff(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(Y,H,E)=>0!==H.status||E>=z||-1!==Y.indexOf("file:")?-1:Math.pow(2,E)*u}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:z=>z,ScriptBaseUrl:"",ScriptPreprocessUrl:z=>z,CleanUrl:z=>z=z.replace(/#/gm,"%23")},W=(z,u)=>{if((!z||0!==z.indexOf("data:"))&&t.CorsBehavior)if("string"===typeof t.CorsBehavior||t.CorsBehavior instanceof String)u.crossOrigin=t.CorsBehavior;else{const Y=t.CorsBehavior(z);Y&&(u.crossOrigin=Y)}},Z={getRequiredSize:null},s=function(z,u,Y,E){let J,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:D.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===g||void 0===g||!g._features.forceBitmapOverHTMLImageElement))return Y("LoadImage is only supported in web or BabylonNative environments."),null;let M=!1;z instanceof ArrayBuffer||ArrayBuffer.isView(z)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(J=URL.createObjectURL(new Blob([z],{type:T})),M=!0):J=`data:${T};base64,`+(0,b.h)(z):z instanceof Blob?(J=URL.createObjectURL(z),M=!0):(J=t.CleanUrl(z),J=t.PreprocessUrl(J));const q=u=>{if(Y){const H=J||z.toString();Y(`Error while trying to load image: ${0===H.indexOf("http")||H.length<=128?H:H.slice(0,128)+"..."}`,u)}};if(null!==g&&void 0!==g&&g._features.forceBitmapOverHTMLImageElement)return i(J,(H=>{g.createImageBitmap(new Blob([H],{type:T}),{premultiplyAlpha:"none",...L}).then((z=>{u(z),M&&URL.revokeObjectURL(J)})).catch((u=>{Y&&Y("Error while trying to load image: "+z,u)}))}),void 0,E||void 0,!0,((z,u)=>{q(u)})),null;const C=new Image;if(Z.getRequiredSize){const u=Z.getRequiredSize(z);u.width&&(C.width=u.width),u.height&&(C.height=u.height)}W(J,C);const K=[],h=()=>{for(const z of K)z.target.removeEventListener(z.name,z.handler);K.length=0};K.push({target:C,name:"load",handler:()=>{h(),u(C),M&&C.src&&URL.revokeObjectURL(C.src)}}),K.push({target:C,name:"error",handler:z=>{h(),q(z),M&&C.src&&URL.revokeObjectURL(C.src)}}),K.push({target:document,name:"securitypolicyviolation",handler:z=>{if(z.blockedURI!==C.src||"dK"===z.disposition)return;h();const u=new Error(`CSP violation of policy ${z.effectiveDirective} ${z.blockedURI}. Current policy is ${z.originalPolicy}`);D.d.UseFallbackTexture=!1,q(u),M&&C.src&&URL.revokeObjectURL(C.src),C.src=""}}),(()=>{for(const z of K)z.target.addEventListener(z.name,z.handler)})();const o="blob:"===J.substring(0,5),d="data:"===J.substring(0,5),s=()=>{o||d||!H.d.IsCustomRequestAvailable?C.src=J:i(J,((z,u,Y)=>{const H=new Blob([z],{type:!T&&Y?Y:T}),E=URL.createObjectURL(H);M=!0,C.src=E}),void 0,E||void 0,!0,((z,u)=>{q(u)}))},v=()=>{E&&E.loadImage(J,C)};if(!o&&!d&&E&&E.enableTexturesOffline)E.open(v,s);else{if(-1!==J.indexOf("file:")){const z=decodeURIComponent(J.substring(5).toLowerCase());if(l.FilesToLoad[z]&&"undefined"!==typeof URL){try{let u;try{u=URL.createObjectURL(l.FilesToLoad[z])}catch(X){u=URL.createObjectURL(l.FilesToLoad[z])}C.src=u,M=!0}catch(Q){C.src=""}return C}}s()}return C},v=(z,u,Y,H,E)=>{const l=new FileReader,T={onCompleteObservable:new J.e,abort:()=>l.abort()};return l.onloadend=()=>T.onCompleteObservable.notifyObservers(T),E&&(l.onerror=()=>{E(new d(`Unable to read ${z.name}`,z))}),l.onload=z=>{u(z.target.result)},Y&&(l.onprogress=Y),H?l.readAsArrayBuffer(z):l.readAsText(z),T},i=(z,u,Y,H,E,b,L)=>{if(z.name)return v(z,u,Y,E,b?z=>{b(void 0,z)}:void 0);const D=z;if(-1!==D.indexOf("file:")){let z=decodeURIComponent(D.substring(5).toLowerCase());0===z.indexOf("./")&&(z=z.substring(2));const H=l.FilesToLoad[z];if(H)return v(H,u,Y,E,b?z=>b(void 0,new h(z.message,z.file)):void 0)}const{match:q,type:C}=x(D);if(q){const z={onCompleteObservable:new J.e,abort:()=>()=>{}};try{const z=E?G(D):F(D);u(z,void 0,C)}catch(T){b?b(void 0,T):g.b.Error(T.message||"Failed to parse the Data URL")}return M.b.SetImmediate((()=>{z.onCompleteObservable.notifyObservers(z)})),z}return X(D,((z,Y)=>{u(z,null===Y||void 0===Y?void 0:Y.responseURL,null===Y||void 0===Y?void 0:Y.getResponseHeader("content-type"))}),Y,H,E,b?z=>{b(z.request,new h(z.message,z.request))}:void 0,L)},X=(z,u,Y,l,T,b,L)=>{z=t.CleanUrl(z),z=t.PreprocessUrl(z);const D=t.BaseUrl+z;let M=!1;const q={onCompleteObservable:new J.e,abort:()=>M=!0},C=()=>{let z,J=new H.d,l=null;const C=()=>{J&&(Y&&J.removeEventListener("progress",Y),z&&J.removeEventListener("readystatechange",z),J.removeEventListener("loadend",K))};let K=()=>{C(),q.onCompleteObservable.notifyObservers(q),q.onCompleteObservable.clear(),Y=void 0,z=null,K=null,b=void 0,L=void 0,u=void 0};q.abort=()=>{M=!0,K&&K(),J&&J.readyState!==(XMLHttpRequest.DONE||4)&&J.abort(),null!==l&&(clearTimeout(l),l=null),J=null};const h=z=>{const u=z.message||"Unknown error";b&&J?b(new o(u,J)):g.b.Error(u)},d=g=>{if(J){if(J.open("GET",D),L)try{L(J)}catch(q){return void h(q)}T&&(J.responseType="arraybuffer"),Y&&J.addEventListener("progress",Y),K&&J.addEventListener("loadend",K),z=()=>{if(!M&&J&&J.readyState===(XMLHttpRequest.DONE||4)){if(z&&J.removeEventListener("readystatechange",z),J.status>=200&&J.status<300||0===J.status&&(!(0,E.h)()||V())){const z=T?J.response:J.responseText;if(null!==z){try{u&&u(z,J)}catch(q){h(q)}return}}const Y=t.DefaultRetryStrategy;if(Y){const z=Y(D,J,g);if(-1!==z)return C(),J=new H.d,void(l=setTimeout((()=>d(g+1)),z))}const L=new o("Error status: "+J.status+" "+J.statusText+" - Unable to load "+D,J);b&&b(L)}},J.addEventListener("readystatechange",z),J.send()}};d(0)};if(l&&l.enableSceneOffline){const H=z=>{z&&z.status>400?b&&b(z):C()},E=()=>{l&&l.loadFile(t.BaseUrl+z,(z=>{!M&&u&&u(z),q.onCompleteObservable.notifyObservers(q)}),Y?z=>{!M&&Y&&Y(z)}:void 0,H,T)};l.open(E,H)}else C();return q},Q=z=>{const{match:u,type:Y}=x(z);if(u)return Y||void 0;const H=z.lastIndexOf(".");switch(z.substring(H+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"zT":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},V=()=>"undefined"!==typeof location&&"file:"===location.protocol,A=z=>K.test(z),x=z=>{const u=K.exec(z);if(null===u||0===u.length)return{match:!1,type:""};return{match:!0,type:u[0].replace("data:","").replace("base64,","")}};function G(z){return(0,b.c)(z.split(",")[1])}const F=z=>(0,b.d)(z.split(",")[1]);let R;C.e._FileToolsLoadImage=s,q.e.loadFile=i,L.g.loadFile=i;((z,u,Y,H,E,J,l,T,b,L)=>{R={DecodeBase64UrlToBinary:z,DecodeBase64UrlToString:u,DefaultRetryStrategy:Y.DefaultRetryStrategy,BaseUrl:Y.BaseUrl,CorsBehavior:Y.CorsBehavior,PreprocessUrl:Y.PreprocessUrl,IsBase64DataUrl:H,IsFileURL:E,LoadFile:J,LoadImage:l,ReadFile:T,RequestFile:b,SetCorsBehavior:L},Object.defineProperty(R,"DefaultRetryStrategy",{get:function(){return Y.DefaultRetryStrategy},set:function(z){Y.DefaultRetryStrategy=z}}),Object.defineProperty(R,"BaseUrl",{get:function(){return Y.BaseUrl},set:function(z){Y.BaseUrl=z}}),Object.defineProperty(R,"PreprocessUrl",{get:function(){return Y.PreprocessUrl},set:function(z){Y.PreprocessUrl=z}}),Object.defineProperty(R,"CorsBehavior",{get:function(){return Y.CorsBehavior},set:function(z){Y.CorsBehavior=z}})})(G,F,t,A,V,i,s,v,X,W)},11064:(z,u,Y)=>{function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(z=>{const u=16*Math.random()|0;return("x"===z?u:3&u|8).toString(16)}))}Y.d(u,{b:()=>H})},11061:(z,u,Y)=>{Y.d(u,{c:()=>J});var H=Y(10953),E=Y(10918);class J{static Instantiate(z){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[z])return this.RegisteredExternalClasses[z];const u=(0,E.c)(z);if(u)return u;H.b.Warn(z+" not found, you may have missed an import.");const Y=z.split(".");let J=window||this;for(let H=0,E=Y.length;H<E;H++)J=J[Y[H]];return"function"!==typeof J?null:J}}J.RegisteredExternalClasses={}},10953:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{static _CheckLimit(z,u){let Y=H._LogLimitOutputs[z];return Y?Y.current++:(Y={limit:u,current:1},H._LogLimitOutputs[z]=Y),Y.current<=Y.limit}static _GenerateLimitMessage(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Y=H._LogLimitOutputs[z];if(!Y||!H.MessageLimitReached)return;const E=this._Levels[u];Y.current===Y.limit&&H[E.name](H.MessageLimitReached.replace(/%LIMIT%/g,""+Y.limit).replace(/%TYPE%/g,E.name??""))}static _AddLogEntry(z){H._LogCache=z+H._LogCache,H.OnNewCacheEntry&&H.OnNewCacheEntry(z)}static _FormatMessage(z){const u=z=>z<10?"0"+z:""+z,Y=new Date;return"["+u(Y.getHours())+":"+u(Y.getMinutes())+":"+u(Y.getSeconds())+"]: "+z}static _LogDisabled(z,u){}static _LogEnabled(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const E=Array.isArray(u)?u[0]:u;if(void 0!==Y&&!H._CheckLimit(E,Y))return;const J=H._FormatMessage(E),l=this._Levels[z],T=Array.isArray(u)?u.slice(1):[];l.logFunc&&l.logFunc("BJS - "+J,...T);const b=`<div style='color:${l.color}'>${J}</div><br>`;H._AddLogEntry(b),H._GenerateLimitMessage(E,z)}static get LogCache(){return H._LogCache}static ClearLogCache(){H._LogCache="",H._LogLimitOutputs={},H.errorsCount=0}static set LogLevels(z){H.Log=H._LogDisabled,H.Warn=H._LogDisabled,H.Error=H._LogDisabled;const u=[H.MessageLogLevel,H.WarningLogLevel,H.ErrorLogLevel];for(const Y of u)if((z&Y)===Y){const z=this._Levels[Y];H[z.name]=H._LogEnabled.bind(H,Y)}}}H.NoneLogLevel=0,H.MessageLogLevel=1,H.WarningLogLevel=2,H.ErrorLogLevel=4,H.AllLogLevel=7,H.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",H._LogCache="",H._LogLimitOutputs={},H._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],H.errorsCount=0,H.Log=H._LogEnabled.bind(H,H.MessageLogLevel),H.Warn=H._LogEnabled.bind(H,H.WarningLogLevel),H.Error=H._LogEnabled.bind(H,H.ErrorLogLevel)},10932:(z,u,Y)=>{Y.d(u,{e:()=>l});const H="undefined"!==typeof WeakRef;class E{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0;this.initialize(z,u,Y,H)}initialize(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0;return this.mask=z,this.skipNextObservers=u,this.target=Y,this.currentTarget=H,this}}class J{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=z,this.mask=u,this.scope=Y,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(z)}}class l{static FromPromise(z,u){const Y=new l;return z.then((z=>{Y.notifyObservers(z)})).catch((z=>{if(!u)throw z;u.notifyObservers(z)})),Y}get observers(){return this._observers}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=u,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new E(0),z&&(this._onObserverAdded=z)}add(z){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!z)return null;const E=new J(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);E.unregisterOnNextCall=Y,u?this._observers.unshift(E):this._observers.push(E),this._onObserverAdded&&this._onObserverAdded(E),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(E,this._lastNotifiedValue);const l=H?new WeakRef(this):{deref:()=>this};return E._remove=function(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=l.deref();u&&(z?u.remove(E):u._remove(E))},E}addOnce(z){return this.add(z,void 0,void 0,void 0,!0)}remove(z){if(!z)return!1;z._remove=null;return-1!==this._observers.indexOf(z)&&(this._deferUnregister(z),!0)}removeCallback(z,u){for(let Y=0;Y<this._observers.length;Y++){const H=this._observers[Y];if(!H._willBeUnregistered&&(H.callback===z&&(!u||u===H.scope)))return this._deferUnregister(H),!0}return!1}_deferUnregister(z){z._willBeUnregistered||(this._numObserversMarkedAsDeleted++,z.unregisterOnNextCall=!1,z._willBeUnregistered=!0,setTimeout((()=>{this._remove(z)}),0))}_remove(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!z)return!1;const Y=this._observers.indexOf(z);return-1!==Y&&(u&&this._numObserversMarkedAsDeleted--,this._observers.splice(Y,1),!0)}makeObserverTopPriority(z){this._remove(z,!1),this._observers.unshift(z)}makeObserverBottomPriority(z){this._remove(z,!1),this._observers.push(z)}notifyObservers(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=z),!this._observers.length)return!0;const J=this._eventState;J.mask=u,J.target=Y,J.currentTarget=H,J.skipNextObservers=!1,J.lastReturnValue=z,J.userInfo=E;for(const l of this._observers)if(!l._willBeUnregistered&&(l.mask&u&&(l.unregisterOnNextCall&&this._deferUnregister(l),l.scope?J.lastReturnValue=l.callback.apply(l.scope,[z,J]):J.lastReturnValue=l.callback(z,J)),J.skipNextObservers))return!1;return!0}notifyObserver(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),z._willBeUnregistered)return;const H=this._eventState;H.mask=Y,H.skipNextObservers=!1,z.unregisterOnNextCall&&this._deferUnregister(z),z.callback(u,H)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const z=this._observers.pop();z&&(z._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const z=new l;return z._observers=this._observers.slice(0),z}hasSpecificMask(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const u of this._observers)if(u.mask&z||u.mask===z)return!0;return!1}}},11405:(z,u,Y)=>{Y.d(u,{d:()=>E});var H=Y(10962);class E{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(z,u){E.Enabled&&(this._current+=z,u&&this._fetchResult())}beginMonitoring(){E.Enabled&&(this._startMonitoringTime=H.d.Now)}endMonitoring(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!E.Enabled)return;z&&this.fetchNewFrame();const u=H.d.Now;this._current=u-this._startMonitoringTime,z&&this._fetchResult()}oM(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const z=H.d.Now;z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}E.Enabled=!0},10962:(z,u,Y)=>{Y.d(u,{d:()=>E});var H=Y(10948);class E{static get Now(){return(0,H.h)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11488:(z,u,Y)=>{Y.d(u,{b:()=>J});var H=Y(11442),E=Y(11408);class J{static ExpandRGBDTexture(z){const u=z._texture;if(!u||!z.isRGBD)return;const E=u.getEngine(),J=E.getCaps(),l=u.isReady;let T=!1;J.textureHalfFloatRender&&J.textureHalfFloatLinearFiltering?(T=!0,u.type=2):J.textureFloatRender&&J.textureFloatLinearFiltering&&(T=!0,u.type=1),T&&(u.isReady=!1,u._isRGBD=!1,u.invertY=!1);const b=async()=>{const J=E.isWebGPU,l=J?1:0;u.isReady=!1,J?await Y.e(21).then(Y.bind(Y,13297)):await Y.e(14).then(Y.bind(Y,13305));const T=new H.e("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,u.type,void 0,null,!1,void 0,l);T.externalTextureSamplerBinding=!0;const b=E.createRenderTargetTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:u.samplingMode,type:u.type,format:5});T.onEffectCreatedObservable.addOnce((Y=>{Y.executeWhenCompiled((()=>{T.onApply=z=>{z._bindTexture("textureSampler",u),z.setFloat2("scale",1,1)},z.iz().postProcessManager.directRender([T],b,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(u),T&&T.dispose(),b._swapAndDie(u),u.isReady=!0}))}))};T&&(l?b():z.onLoadObservable.addOnce(b))}static async EncodeTextureToRGBD(z,u){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u.getEngine().isWebGPU?await Y.e(22).then(Y.bind(Y,13312)):await Y.e(15).then(Y.bind(Y,13307)),await(0,E.e)("rgbdEncode",z,u,H,1,5)}}},11283:(z,u,Y)=>{Y.d(u,{d:()=>E,h:()=>H});class H{constructor(z){this.length=0,this.data=new Array(z),this._id=H._GlobalId++}push(z){this.data[this.length++]=z,this.length>this.data.length&&(this.data.length*=2)}forEach(z){for(let u=0;u<this.length;u++)z(this.data[u])}sort(z){this.data.sort(z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let u=0;u<z.length;u++)this.data[this.length++]=(z.data||z)[u]}}indexOf(z){const u=this.data.indexOf(z);return u>=this.length?-1:u}contains(z){return-1!==this.indexOf(z)}}H._GlobalId=0;class E extends H{constructor(){super(...arguments),this._duplicateId=0}push(z){super.push(z),z.__smartArrayFlags||(z.__smartArrayFlags={}),z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(z){return(!z.__smartArrayFlags||z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let u=0;u<z.length;u++){const Y=(z.data||z)[u];this.pushNoDuplicate(Y)}}}}},10990:(z,u,Y)=>{Y.d(u,{c:()=>l,d:()=>J,e:()=>H,h:()=>E});const H=z=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(z);let u="";for(let Y=0;Y<z.byteLength;Y++)u+=String.fromCharCode(z[Y]);return u},E=z=>{const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Y,H,E,J,l,T,b,L="",D=0;const g=ArrayBuffer.isView(z)?new Uint8Array(z.buffer,z.byteOffset,z.byteLength):new Uint8Array(z);for(;D<g.length;)Y=g[D++],H=D<g.length?g[D++]:Number.NaN,E=D<g.length?g[D++]:Number.NaN,J=Y>>2,l=(3&Y)<<4|H>>4,T=(15&H)<<2|E>>6,b=63&E,isNaN(H)?T=b=64:isNaN(E)&&(b=64),L+=u.charAt(J)+u.charAt(l)+u.charAt(T)+u.charAt(b);return L},J=z=>atob(z),l=z=>{const u=J(z),Y=u.length,H=new Uint8Array(new ArrayBuffer(Y));for(let E=0;E<Y;E++)H[E]=u.charCodeAt(E);return H.buffer}},11181:(z,u,Y)=>{Y.d(u,{e:()=>E});class H{static Eval(z,u){return"true"===(z=z.match(/\([^()]*\)/g)?z.replace(/\([^()]*\)/g,(z=>(z=z.slice(1,z.length-1),H._HandleParenthesisContent(z,u)))):H._HandleParenthesisContent(z,u))||"false"!==z&&H.Eval(z,u)}static _HandleParenthesisContent(z,u){let Y;u=u||(z=>"true"===z);const E=z.split("||");for(const J in E)if(Object.prototype.hasOwnProperty.call(E,J)){let z=H._SimplifyNegation(E[J].trim());const l=z.split("&&");if(l.length>1)for(let E=0;E<l.length;++E){const J=H._SimplifyNegation(l[E].trim());if(Y="true"!==J&&"false"!==J?"!"===J[0]?!u(J.substring(1)):u(J):"true"===J,!Y){z="false";break}}if(Y||"true"===z){Y=!0;break}Y="true"!==z&&"false"!==z?"!"===z[0]?!u(z.substring(1)):u(z):"true"===z}return Y?"true":"false"}static _SimplifyNegation(z){return"!true"===(z=(z=z.replace(/^[\s!]+/,(z=>(z=z.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?z="false":"!false"===z&&(z="true"),z}}class E{static EnableFor(z){z._tags=z._tags||{},z.hasTags=()=>E.HasTags(z),z.addTags=u=>E.AddTagsTo(z,u),z.removeTags=u=>E.RemoveTagsFrom(z,u),z.matchesTagsQuery=u=>E.MatchesQuery(z,u)}static DisableFor(z){delete z._tags,delete z.hasTags,delete z.addTags,delete z.removeTags,delete z.matchesTagsQuery}static HasTags(z){if(!z._tags)return!1;const u=z._tags;for(const Y in u)if(Object.prototype.hasOwnProperty.call(u,Y))return!0;return!1}static GetTags(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!z._tags)return null;if(u){const u=[];for(const Y in z._tags)Object.prototype.hasOwnProperty.call(z._tags,Y)&&!0===z._tags[Y]&&u.push(Y);return u.join(" ")}return z._tags}static AddTagsTo(z,u){if(!u)return;if("string"!==typeof u)return;const Y=u.split(" ");for(const H of Y)E._AddTagTo(z,H)}static _AddTagTo(z,u){""!==(u=u.trim())&&"true"!==u&&"false"!==u&&(u.match(/[\s]/)||u.match(/^([!]|([|]|[&]){2})/)||(E.EnableFor(z),z._tags[u]=!0))}static RemoveTagsFrom(z,u){if(!E.HasTags(z))return;const Y=u.split(" ");for(const H in Y)E._RemoveTagFrom(z,Y[H])}static _RemoveTagFrom(z,u){delete z._tags[u]}static MatchesQuery(z,u){return void 0===u||(""===u?E.HasTags(z):H.Eval(u,(u=>E.HasTags(z)&&z._tags[u])))}}},11408:(z,u,Y)=>{Y.d(u,{e:()=>o,f:()=>Z,i:()=>v,j:()=>i,n:()=>W});var H=Y(11415),E=Y(11420),J=Y(11079),l=Y(11442),T=Y(11018),b=Y(10918),L=Y(11172),D=Y(11445),g=Y(11325);class M extends D.g{_gatherImports(z,u){z?(this._webGPUReady=!0,u.push(Promise.all([Y.e(36).then(Y.bind(Y,13253))]))):u.push(Promise.all([Y.e(37).then(Y.bind(Y,13257))])),super._gatherImports(z,u)}constructor(z){super({...arguments.length>2?arguments[2]:void 0,name:z,vl:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||g.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:M.FragmentUrl})}}M.FragmentUrl="pass";class q extends D.g{_gatherImports(z,u){z?(this._webGPUReady=!0,u.push(Promise.all([Y.e(43).then(Y.bind(Y,13287))]))):u.push(Promise.all([Y.e(44).then(Y.bind(Y,13295))])),super._gatherImports(z,u)}constructor(z){super({...arguments.length>2?arguments[2]:void 0,name:z,vl:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||g.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:q.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(z){if(!(z<0||z>5))switch(this._face=z,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}q.FragmentUrl="passCube";var C=Y(11082);class K extends l.e{getClassName(){return"PassPostProcess"}constructor(z,u){let Y=arguments.length>4?arguments[4]:void 0;const H={size:"number"===typeof u?u:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,vl:Y,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...u};super(z,M.FragmentUrl,{effectWrapper:"number"!==typeof u&&u.effectWrapper?void 0:new M(z,Y,H),...H})}static _Parse(z,u,Y,H){return L.d.Parse((()=>new K(z.name,z.options,u,z.renderTargetSamplingMode,z._engine,z.reusable)),z,Y,H)}}(0,b.d)("BABYLON.PassPostProcess",K);class h extends l.e{get face(){return this._effectWrapper.face}set face(z){this._effectWrapper.face=z}getClassName(){return"PassCubePostProcess"}constructor(z,u){let Y=arguments.length>4?arguments[4]:void 0;const H={size:"number"===typeof u?u:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,vl:Y,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...u};super(z,M.FragmentUrl,{effectWrapper:"number"!==typeof u&&u.effectWrapper?void 0:new q(z,Y,H),...H})}static _Parse(z,u,Y,H){return L.d.Parse((()=>new h(z.name,z.options,u,z.renderTargetSamplingMode,z._engine,z.reusable)),z,Y,H)}}function o(z,u,Y,H,E,J,T,b){const L=u.getEngine();return u.isReady=!1,E=E??u.samplingMode,H=H??u.type,J=J??u.format,T=T??u.width,b=b??u.height,-1===H&&(H=0),new Promise((D=>{const g=new l.e("postprocess",z,null,null,1,null,E,L,!1,void 0,H,void 0,null,!1,J);g.externalTextureSamplerBinding=!0;const M=L.createRenderTargetTexture({width:T,height:b},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E,type:H,format:J});g.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{g.onApply=z=>{z._bindTexture("textureSampler",u),z.setFloat2("scale",1,1)},Y.postProcessManager.directRender([g],M,!0),L.restoreDefaultFramebuffer(),L._releaseTexture(u),g&&g.dispose(),M._swapAndDie(u),u.type=H,u.format=5,u.isReady=!0,D(u)}))}))}))}let d,t;function W(z){d||(d=new Float32Array(1),t=new Int32Array(d.buffer)),d[0]=z;const u=t[0];let Y=u>>16&32768,H=u>>12&2047;const E=u>>23&255;return E<103?Y:E>142?(Y|=31744,Y|=(255==E?0:1)&&8388607&u,Y):E<113?(H|=2048,Y|=(H>>114-E)+(H>>113-E&1),Y):(Y|=E-112<<10|H>>1,Y+=1&H,Y)}function Z(z){const u=(32768&z)>>15,Y=(31744&z)>>10,H=1023&z;return 0===Y?(u?-1:1)*Math.pow(2,-14)*(H/Math.pow(2,10)):31==Y?H?NaN:1/0*(u?-1:1):(u?-1:1)*Math.pow(2,Y-15)*(1+H/Math.pow(2,10))}(0,J.e)([(0,C.L)()],h.prototype,"face",null),T.e._RescalePostProcessFactory=z=>new K("rescale",1,null,2,z,!1,0);const s=async(z,u,J,T,b)=>{const L=z.iz(),D=L.getEngine();let g;if(D.isWebGPU?z.isCube?await Y.e(40).then(Y.bind(Y,13271)):await Y.e(41).then(Y.bind(Y,13274)):z.isCube?await Y.e(38).then(Y.bind(Y,13259)):await Y.e(39).then(Y.bind(Y,13265)),z.isCube){const z=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];g=new l.e("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:H.b.NEAREST_NEAREST_MIPNEAREST,vl:D,defines:z[T],shaderLanguage:D.isWebGPU?1:0})}else g=new l.e("lod","lod",{uniforms:["lod","gamma"],samplingMode:H.b.NEAREST_NEAREST_MIPNEAREST,vl:D,shaderLanguage:D.isWebGPU?1:0});await new Promise((z=>{g.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled((()=>{z(0)}))}))}));const M=new E.b("temp",{width:u,height:J},L,!1);g.onApply=function(u){u.setTexture("textureSampler",z),u.setFloat("lod",b),u.setInt("gamma",z.gammaSpace?1:0)};const q=z.getInternalTexture();try{if(M.renderTarget&&q){const Y=q.samplingMode;0!==b?z.updateSamplingMode(H.b.NEAREST_NEAREST_MIPNEAREST):z.updateSamplingMode(H.b.NEAREST_NEAREST),L.postProcessManager.directRender([g],M.renderTarget,!0),z.updateSamplingMode(Y);const E=await D.readPixels(0,0,u,J),l=new Uint8Array(E.buffer,0,E.byteLength);return D.unBindFramebuffer(M.renderTarget),l}throw Error("Render to texture failed.")}finally{M.dispose(),g.dispose()}};async function v(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!z.isReady()&&z._texture&&await new Promise(((u,Y)=>{null!==z._texture?z._texture.onLoadedObservable.addOnce((()=>{u(0)})):Y(0)})),await s(z,u,Y,H,E)}const i={CreateResizedCopy:function(z,u,Y){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=z.iz(),T=l.getEngine(),b=new E.b("resized"+z.name,{width:u,height:Y},l,!z.noMipmap,!0,z._texture.type,!1,z.samplingMode,!1);b.wrapU=z.wrapU,b.wrapV=z.wrapV,b.uOffset=z.uOffset,b.vOffset=z.vOffset,b.uScale=z.uScale,b.vScale=z.vScale,b.uAng=z.uAng,b.vAng=z.vAng,b.wAng=z.wAng,b.coordinatesIndex=z.coordinatesIndex,b.level=z.level,b.anisotropicFilteringLevel=z.anisotropicFilteringLevel,b._texture.isReady=!1,z.wrapU=H.b.CLAMP_ADDRESSMODE,z.wrapV=H.b.CLAMP_ADDRESSMODE;const L=new K("pass",1,null,J?H.b.BILINEAR_SAMPLINGMODE:H.b.NEAREST_SAMPLINGMODE,T,!1,0);return L.externalTextureSamplerBinding=!0,L.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled((()=>{L.onApply=function(u){u.setTexture("textureSampler",z)};const u=b.renderTarget;u&&(l.postProcessManager.directRender([L],u),T.unBindFramebuffer(u),b.disposeFramebufferObjects(),L.dispose(),b.getInternalTexture().isReady=!0)}))})),b},ApplyPostProcess:o,ToHalfFloat:W,FromHalfFloat:Z,GetTextureDataAsync:v}},11009:(z,u,Y)=>{Y.d(u,{b:()=>E,f:()=>l});let H=[];class E{static SetImmediate(z){0===H.length&&setTimeout((()=>{const z=H;H=[];for(const u of z)u()}),1),H.push(z)}}function J(z,u,Y){try{if(z())return u(),!0}catch(H){return null===Y||void 0===Y||Y(H),!0}return!1}const l=function(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,l=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&J(z,u,Y))return null;const T=setInterval((()=>{J(z,u,Y)?clearInterval(T):(E-=H,E<0&&(clearInterval(T),null===Y||void 0===Y||Y(new Error("Operation timed out after maximum retries. "+(l||"")),!0)))}),H);return()=>clearInterval(T)}},11070:(z,u,Y)=>{function H(z){let u=1;do{u*=2}while(u<z);return u===z}function E(z,u,Y){return z*(1-Y)+u*Y}function J(z){const u=l(z),Y=T(z);return u-z>z-Y?Y:u}function l(z){return z--,z|=z>>1,z|=z>>2,z|=z>>4,z|=z>>8,z|=z>>16,++z}function T(z){return z|=z>>1,z|=z>>2,z|=z>>4,z|=z>>8,(z|=z>>16)-(z>>1)}function b(z,u){let Y;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:Y=T(z);break;case 2:Y=J(z);break;default:Y=l(z)}return Math.min(Y,u)}Y.d(u,{c:()=>T,e:()=>b,f:()=>H,h:()=>E,k:()=>J})},10945:(z,u,Y)=>{Y.d(u,{b:()=>o,e:()=>h});var H=Y(10932),E=Y(10948),J=Y(10953),l=Y(10959),T=Y(10962),b=Y(10970),L=Y(10972),D=Y(10928),g=Y(10980),M=Y(11009),q=Y(11061),C=Y(11064),K=Y(11070);class h{static get BaseUrl(){return g.h.BaseUrl}static set BaseUrl(z){g.h.BaseUrl=z}static get CleanUrl(){return g.h.CleanUrl}static set CleanUrl(z){g.h.CleanUrl=z}static IsAbsoluteUrl(z){return 0===z.indexOf("//")||-1!==z.indexOf("://")&&(-1!==z.indexOf(".")&&(-1!==z.indexOf("/")&&(!(z.indexOf(":")>z.indexOf("/"))&&(z.indexOf("://")<z.indexOf(".")||(0===z.indexOf("data:")||0===z.indexOf("blob:"))))))}static set ScriptBaseUrl(z){g.h.ScriptBaseUrl=z}static get ScriptBaseUrl(){return g.h.ScriptBaseUrl}static set CDNBaseUrl(z){h.ScriptBaseUrl=z,h.AssetBaseUrl=z}static set ScriptPreprocessUrl(z){g.h.ScriptPreprocessUrl=z}static get ScriptPreprocessUrl(){return g.h.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return g.h.DefaultRetryStrategy}static set DefaultRetryStrategy(z){g.h.DefaultRetryStrategy=z}static get CorsBehavior(){return g.h.CorsBehavior}static set CorsBehavior(z){g.h.CorsBehavior=z}static get UseFallbackTexture(){return D.d.UseFallbackTexture}static set UseFallbackTexture(z){D.d.UseFallbackTexture=z}static get RegisteredExternalClasses(){return q.c.RegisteredExternalClasses}static set RegisteredExternalClasses(z){q.c.RegisteredExternalClasses=z}static get fallbackTexture(){return D.d.FallbackTexture}static set fallbackTexture(z){D.d.FallbackTexture=z}static FetchToRef(z,u,Y,H,E,J){const l=4*((Math.abs(z)*Y%Y|0)+(Math.abs(u)*H%H|0)*Y);J.r=E[l]/255,J.g=E[l+1]/255,J.b=E[l+2]/255,J.a=E[l+3]/255}static Mix(z,u,Y){return 0}static Instantiate(z){return q.c.Instantiate(z)}static SetImmediate(z){M.b.SetImmediate(z)}static IsExponentOfTwo(z){return!0}static FloatRound(z){return Math.fround(z)}static GetFilename(z){const u=z.lastIndexOf("/");return u<0?z:z.substring(u+1)}static GetFolderPath(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=z.lastIndexOf("/");return Y<0?u?z:"":z.substring(0,Y+1)}static ToDegrees(z){return 180*z/Math.PI}static ToRadians(z){return z*Math.PI/180}static SmoothAngleChange(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const H=this.ToRadians(z),E=this.ToRadians(u);return this.ToDegrees(Math.atan2((1-Y)*Math.sin(E)+Y*Math.sin(H),(1-Y)*Math.cos(E)+Y*Math.cos(H)))}static MakeArray(z,u){return!0===u||void 0!==z&&null!=z?Array.isArray(z)?z:[z]:null}static GetPointerPrefix(z){return(0,E.h)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(z,u){(0,g.x)(z,u)}static SetReferrerPolicyBehavior(z,u){u.referrerPolicy=z}static get PreprocessUrl(){return g.h.PreprocessUrl}static set PreprocessUrl(z){g.h.PreprocessUrl=z}static LoadImage(z,u,Y,H,E,J){return(0,g.s)(z,u,Y,H,E,J)}static LoadFile(z,u,Y,H,E,J){return(0,g.p)(z,u,Y,H,E,J)}static async LoadFileAsync(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((Y,H)=>{(0,g.p)(z,(z=>{Y(z)}),void 0,void 0,u,((z,u)=>{H(u)}))}))}static GetAssetUrl(z){if(!z)return"";if(h.AssetBaseUrl&&z.startsWith(h._DefaultAssetsUrl)){const u="/"===h.AssetBaseUrl[h.AssetBaseUrl.length-1]?h.AssetBaseUrl.substring(0,h.AssetBaseUrl.length-1):h.AssetBaseUrl;return z.replace(h._DefaultAssetsUrl,u)}return z}static GetBabylonScriptURL(z,u){if(!z)return"";if(h.ScriptBaseUrl&&z.startsWith(h._DefaultCdnUrl)){const u="/"===h.ScriptBaseUrl[h.ScriptBaseUrl.length-1]?h.ScriptBaseUrl.substring(0,h.ScriptBaseUrl.length-1):h.ScriptBaseUrl;z=z.replace(h._DefaultCdnUrl,u)}return z=h.ScriptPreprocessUrl(z),u&&(z=h.GetAbsoluteUrl(z)),z}static LoadBabylonScript(z,u,Y,H){z=h.GetBabylonScriptURL(z),h.LoadScript(z,u,Y)}static async LoadBabylonScriptAsync(z){return z=h.GetBabylonScriptURL(z),await h.LoadScriptAsync(z)}static LoadScript(z,u,Y,H){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(z),u&&u()}catch(b){null===Y||void 0===Y||Y(`Unable to load script '${z}' in worker`,b)}return}if(!(0,E.h)())return void(null===Y||void 0===Y||Y(`Cannot load script '${z}' outside of a window or a worker`));const l=document.getElementsByTagName("head")[0],T=document.createElement("script");J?(T.setAttribute("type","module"),T.innerText=z):(T.setAttribute("type","text/javascript"),T.setAttribute("src",z)),H&&(T.id=H),T.onload=()=>{u&&u()},T.onerror=u=>{Y&&Y(`Unable to load script '${z}'`,u)},l.appendChild(T)}static async LoadScriptAsync(z,u){return await new Promise(((Y,H)=>{this.LoadScript(z,(()=>{Y()}),((z,u)=>{H(u||new Error(z))}),u)}))}static ReadFileAsDataURL(z,u,Y){const E=new FileReader,J={onCompleteObservable:new H.e,abort:()=>E.abort()};return E.onloadend=()=>{J.onCompleteObservable.notifyObservers(J)},E.onload=z=>{u(z.target.result)},E.onprogress=Y,E.readAsDataURL(z),J}static ReadFile(z,u,Y,H,E){return(0,g.t)(z,u,Y,H,E)}static FileAsURL(z){const u=new Blob([z]);return window.URL.createObjectURL(u)}static Format(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return z.toFixed(u)}static DeepCopy(z,u,Y,H){l.b.DeepCopy(z,u,Y,H)}static IsEmpty(z){for(const u in z)if(Object.prototype.hasOwnProperty.call(z,u))return!1;return!0}static RegisterTopRootEvents(z,u){for(let H=0;H<u.length;H++){const E=u[H];z.addEventListener(E.name,E.handler,!1);try{window.parent&&window.parent.addEventListener(E.name,E.handler,!1)}catch(Y){}}}static UnregisterTopRootEvents(z,u){for(let H=0;H<u.length;H++){const E=u[H];z.removeEventListener(E.name,E.handler);try{z.parent&&z.parent.removeEventListener(E.name,E.handler)}catch(Y){}}}static async DumpFramebuffer(z,u,Y,H){throw(0,b.e)("DumpTools")}static DumpData(z,u,Y,H){throw(0,b.e)("DumpTools")}static async DumpDataAsync(z,u,Y){throw(0,b.e)("DumpTools")}static _IsOffScreenCanvas(z){return void 0!==z.convertToBlob}static ToBlob(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",H=arguments.length>3?arguments[3]:void 0;h._IsOffScreenCanvas(z)||z.toBlob||(z.toBlob=function(z,u,Y){setTimeout((()=>{const H=atob(this.toDataURL(u,Y).split(",")[1]),E=H.length,J=new Uint8Array(E);for(let z=0;z<E;z++)J[z]=H.charCodeAt(z);z(new Blob([J]))}))}),h._IsOffScreenCanvas(z)?z.convertToBlob({type:Y,quality:H}).then((z=>u(z))):z.toBlob((function(z){u(z)}),Y,H)}static DownloadBlob(z,u){if("download"in document.createElement("a")){if(!u){const z=new Date;u="screenshot_"+((z.getFullYear()+"-"+(z.getMonth()+1)).slice(2)+"-"+z.getDate()+"_"+z.getHours()+"-"+("0"+z.getMinutes()).slice(-2))+".png"}h.Download(z,u)}else if(z&&"undefined"!==typeof URL){const u=URL.createObjectURL(z),Y=window.open("");if(!Y)return;const H=Y.document.createElement("img");H.onload=function(){URL.revokeObjectURL(u)},H.src=u,Y.document.body.appendChild(H)}}static EncodeScreenshotCanvasData(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;if("string"!==typeof H&&u){if(u){if(h._IsOffScreenCanvas(z))return void z.convertToBlob({type:Y,quality:E}).then((z=>{const Y=new FileReader;Y.readAsDataURL(z),Y.onloadend=()=>{const z=Y.result;u(z)}}));const H=z.toDataURL(Y,E);u(H)}}else this.ToBlob(z,(function(z){z&&h.DownloadBlob(z,H),u&&u("")}),Y,E)}static Download(z,u){if("undefined"===typeof URL)return;const Y=window.URL.createObjectURL(z),H=document.createElement("a");document.body.appendChild(H),H.style.display="none",H.href=Y,H.download=u,H.addEventListener("click",(()=>{H.parentElement&&H.parentElement.removeChild(H)})),H.click(),window.URL.revokeObjectURL(Y)}static BackCompatCameraNoPreventDefault(z){return"boolean"===typeof z[0]?z[0]:"boolean"===typeof z[1]&&z[1]}static CreateScreenshot(z,u,Y,H){throw(0,b.e)("ScreenshotTools")}static async CreateScreenshotAsync(z,u,Y){throw(0,b.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(z,u,Y,H){throw(0,b.e)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(z,u,Y){throw(0,b.e)("ScreenshotTools")}static RandomId(){return(0,C.b)()}static IsBase64(z){return(0,g.m)(z)}static DecodeBase64(z){return(0,g.e)(z)}static get errorsCount(){return J.b.errorsCount}static Log(z){J.b.Log(z)}static Warn(z){J.b.Warn(z)}static Error(z){J.b.Error(z)}static get LogCache(){return J.b.LogCache}static ClearLogCache(){J.b.ClearLogCache()}static set LogLevels(z){J.b.LogLevels=z}static set PerformanceLogLevel(z){return(z&h.PerformanceUserMarkLogLevel)===h.PerformanceUserMarkLogLevel?(h.StartPerformanceCounter=h._StartUserMark,void(h.EndPerformanceCounter=h._EndUserMark)):(z&h.PerformanceConsoleLogLevel)===h.PerformanceConsoleLogLevel?(h.StartPerformanceCounter=h._StartPerformanceConsole,void(h.EndPerformanceCounter=h._EndPerformanceConsole)):(h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,void(h.EndPerformanceCounter=h._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(z,u){}static _EndPerformanceCounterDisabled(z,u){}static _StartUserMark(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h._Performance){if(!(0,E.h)())return;h._Performance=window.performance}u&&h._Performance.mark&&h._Performance.mark(z+"-Begin")}static _EndUserMark(z){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&h._Performance.mark&&(h._Performance.mark(z+"-End"),h._Performance.measure(z,z+"-Begin",z+"-End"))}static _StartPerformanceConsole(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];u&&(h._StartUserMark(z,u),console.time&&console.time(z))}static _EndPerformanceConsole(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];u&&(h._EndUserMark(z,u),console.timeEnd(z))}static get Now(){return T.d.Now}static GetClassName(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=null;if(!u&&z.getClassName)Y=z.getClassName();else{if(z instanceof Object){Y=(u?z:Object.getPrototypeOf(z)).constructor.__bjsclassName__}Y||(Y=typeof z)}return Y}static First(z,u){for(const Y of z)if(u(Y))return Y;return null}static getFullClassName(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=null,H=null;if(!u&&z.getClassName)Y=z.getClassName();else{if(z instanceof Object){const E=u?z:Object.getPrototypeOf(z);Y=E.constructor.__bjsclassName__,H=E.constructor.__bjsmoduleName__}Y||(Y=typeof z)}return Y?(null!=H?H+".":"")+Y:null}static async DelayAsync(z){await new Promise((u=>{setTimeout((()=>{u()}),z)}))}static IsSafari(){return!!(0,E.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}h.AssetBaseUrl="",h.UseCustomRequestHeaders=!1,h.CustomRequestHeaders=L.d.CustomRequestHeaders,h.GetDOMTextContent=E.e,h._DefaultCdnUrl="https://cdn.babylonjs.com",h._DefaultAssetsUrl="https://assets.babylonjs.com/core",h.GetAbsoluteUrl="object"===typeof document?z=>{const u=document.createElement("a");return u.href=z,u.href}:"function"===typeof URL&&"object"===typeof location?z=>new URL(z,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},h.NoneLogLevel=J.b.NoneLogLevel,h.MessageLogLevel=J.b.MessageLogLevel,h.WarningLogLevel=J.b.WarningLogLevel,h.ErrorLogLevel=J.b.ErrorLogLevel,h.AllLogLevel=J.b.AllLogLevel,h.IsWindowObjectExist=E.h,h.PerformanceNoneLogLevel=0,h.PerformanceUserMarkLogLevel=1,h.PerformanceConsoleLogLevel=2,h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,h.EndPerformanceCounter=h._EndPerformanceCounterDisabled;class o{constructor(z,u,Y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=z,this.index=H-1,this._done=!1,this._fn=u,this._successCallback=Y}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(z,u,Y){const H=new o(z,u,Y,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return H.executeNext(),H}static SyncAsyncForLoop(z,u,Y,H,E){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return o.Run(Math.ceil(z/u),(H=>{E&&E()?H.breakLoop():setTimeout((()=>{for(let J=0;J<u;++J){const l=H.index*u+J;if(l>=z)break;if(Y(l),E&&E()){H.breakLoop();break}}H.executeNext()}),J)}),H)}}h.Mix=K.h,h.IsExponentOfTwo=K.f,D.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10918:(z,u,Y)=>{Y.d(u,{c:()=>J,d:()=>E});const H={};function E(z,u){H[z]=u}function J(z){return H[z]}},11552:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{static get UniqueId(){const z=this._UniqueIdCounter;return this._UniqueIdCounter++,z}}H._UniqueIdCounter=1},10972:(z,u,Y)=>{Y.d(u,{d:()=>H});class H{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(H.CustomRequestHeaders).length>0||H.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const z in H.CustomRequestHeaders){const u=H.CustomRequestHeaders[z];u&&this._xhr.setRequestHeader(z,u)}}_shouldSkipRequestModifications(z){return H.SkipRequestModificationForBabylonCDN&&(z.includes("preview.babylonjs.com")||z.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(z){this._xhr.onprogress=z}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(z){this._xhr.responseType=z}get timeout(){return this._xhr.timeout}set timeout(z){this._xhr.timeout=z}addEventListener(z,u,Y){this._xhr.addEventListener(z,u,Y)}removeEventListener(z,u,Y){this._xhr.removeEventListener(z,u,Y)}abort(){this._xhr.abort()}send(z){H.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(z)}open(z,u){for(const Y of H.CustomRequestModifiers){if(this._shouldSkipRequestModifications(u))return;u=Y(this._xhr,u)||u}u=(u=u.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=u,this._xhr.open(z,u,!0)}setRequestHeader(z,u){this._xhr.setRequestHeader(z,u)}getResponseHeader(z){return this._xhr.getResponseHeader(z)}}H.CustomRequestHeaders={},H.CustomRequestModifiers=new Array,H.SkipRequestModificationForBabylonCDN=!0},11667:(z,u,Y)=>{Y.d(u,{c:()=>E});class H{constructor(z){this._pendingActions=new Array,this._workerInfos=z.map((z=>({workerPromise:Promise.resolve(z),idle:!0})))}dispose(){for(const z of this._workerInfos)z.workerPromise.then((z=>{z.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(z){this._executeOnIdleWorker(z)||this._pendingActions.push(z)}_executeOnIdleWorker(z){for(const u of this._workerInfos)if(u.idle)return this._execute(u,z),!0;return!1}_execute(z,u){z.idle=!1,z.workerPromise.then((Y=>{u(Y,(()=>{const u=this._pendingActions.shift();u?this._execute(z,u):z.idle=!0}))}))}}class E extends H{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.DefaultOptions;super([]),this._maxWorkers=z,this._createWorkerAsync=u,this._options=Y}push(z){if(!this._executeOnIdleWorker(z))if(this._workerInfos.length<this._maxWorkers){const u={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(u),this._execute(u,z)}else this._pendingActions.push(z)}_execute(z,u){z.timeoutId&&(clearTimeout(z.timeoutId),delete z.timeoutId),super._execute(z,((Y,H)=>{u(Y,(()=>{H(),z.idle&&(z.timeoutId=setTimeout((()=>{z.workerPromise.then((z=>{z.terminate()}));const u=this._workerInfos.indexOf(z);-1!==u&&this._workerInfos.splice(u,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}E.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11633:(z,u,Y)=>{Y.d(u,{d:()=>D});var H=Y(11079),E=Y(10932),J=Y(10928),l=Y(11103),T=Y(11082),b=Y(11172),L=Y(10918);class D{get influence(){return this._influence}set influence(z){if(this._influence===z)return;const u=this._influence;this._influence=z,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===u||0===z)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=z,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new E.e,this._onDataLayoutChanged=new E.e,this._animationPropertiesOverride=null,this.id=z,this._scene=Y||J.d.LastCreatedScene,this.influence=u,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(z){const u=this.hasPositions;this._positions=z,u!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(z){const u=this.hasNormals;this._normals=z,u!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(z){const u=this.hasTangents;this._tangents=z,u!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(z){const u=this.hasUVs;this._uvs=z,u!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(z){const u=this.hasUV2s;this._uv2s=z,u!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(z){const u=this.hasColors;this._colors=z,u!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const z=b.d.Clone((()=>new D(this.name,this.influence,this._scene)),this);return z._positions=this._positions,z._normals=this._normals,z._tangents=this._tangents,z._uvs=this._uvs,z._uv2s=this._uv2s,z._colors=this._colors,z}serialize(){const z={};return z.name=this.name,z.influence=this.influence,z.Qz=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(z.id=this.id),this.hasNormals&&(z.Vz=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(z.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(z.xz=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(z.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(z.Az=Array.prototype.slice.call(this.getColors())),b.d.AppendSerializedAnimations(this,z),z}getClassName(){return"MorphTarget"}static Parse(z,u){const Y=new D(z.name,z.influence);if(Y.setPositions(z.Qz),null!=z.id&&(Y.id=z.id),z.Vz&&Y.setNormals(z.Vz),z.tangents&&Y.setTangents(z.tangents),z.xz&&Y.setUVs(z.xz),z.uv2s&&Y.setUV2s(z.uv2s),z.Az&&Y.setColors(z.Az),z.animations){for(let u=0;u<z.animations.length;u++){const H=z.animations[u],E=(0,L.c)("BABYLON.Animation");E&&Y.animations.push(E.Parse(H))}z.autoAnimate&&u&&u.beginAnimation(Y,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1)}return Y}static FromMesh(z,u,Y){u||(u=z.name);const H=new D(u,Y,z.iz());return H.setPositions(z.getVerticesData(l.f.PositionKind)),z.isVerticesDataPresent(l.f.NormalKind)&&H.setNormals(z.getVerticesData(l.f.NormalKind)),z.isVerticesDataPresent(l.f.TangentKind)&&H.setTangents(z.getVerticesData(l.f.TangentKind)),z.isVerticesDataPresent(l.f.UVKind)&&H.setUVs(z.getVerticesData(l.f.UVKind)),z.isVerticesDataPresent(l.f.UV2Kind)&&H.setUV2s(z.getVerticesData(l.f.UV2Kind)),z.isVerticesDataPresent(l.f.ColorKind)&&H.setColors(z.getVerticesData(l.f.ColorKind)),H}}(0,H.e)([(0,T.L)()],D.prototype,"id",void 0)},11442:(z,u,Y)=>{Y.d(u,{e:()=>C});var H=Y(11079),E=Y(11283),J=Y(10932),l=Y(10903),T=Y(11024),b=Y(11082),L=Y(11172),D=Y(10918),g=Y(11018),M=Y(11070),q=Y(11445);g.e.prototype.setTextureFromPostProcess=function(z,u,Y){var H;let E=null;u&&(u._forcedOutputTexture?E=u._forcedOutputTexture:u._textures.data[u._currentRenderTextureInd]&&(E=u._textures.data[u._currentRenderTextureInd])),this._bindTexture(z,(null===(H=E)||void 0===H?void 0:H.texture)??null,Y)},g.e.prototype.setTextureFromPostProcessOutput=function(z,u,Y){var H;this._bindTexture(z,(null===u||void 0===u||null===(H=u._outputTexture)||void 0===H?void 0:H.texture)??null,Y)},T.d.prototype.setTextureFromPostProcess=function(z,u){this._engine.setTextureFromPostProcess(this._samplers[z],u,z)},T.d.prototype.setTextureFromPostProcessOutput=function(z,u){this._engine.setTextureFromPostProcessOutput(this._samplers[z],u,z)};class C{static get ForceGLSL(){return q.g.ForceGLSL}static set ForceGLSL(z){q.g.ForceGLSL=z}static RegisterShaderCodeProcessing(z,u){q.g.RegisterShaderCodeProcessing(z,u)}get name(){return this._effectWrapper.name}set name(z){this._effectWrapper.name=z}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(z){this._effectWrapper.alphaMode=z}get samples(){return this._samples}set samples(z){this._samples=Math.min(z,this._engine.getCaps().maxMSAASamples),this._textures.forEach((z=>{z.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(z){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),z&&(this._onActivateObserver=this.onActivateObservable.add(z))}set onSizeChanged(z){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(z)}set onApply(z){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(z)}set onBeforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z)}set onAfterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(z)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(z){this._forcedOutputTexture=z}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.kl(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(z,u,Y,H,T,b){var L;let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,g=arguments.length>7?arguments[7]:void 0,M=arguments.length>8?arguments[8]:void 0,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",d=arguments.length>12?arguments[12]:void 0,t=arguments.length>13&&void 0!==arguments[13]&&arguments[13],W=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,Z=arguments.length>15?arguments[15]:void 0,s=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.JM=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new E.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new l.m(1,1),this._texelSize=l.m.Zero(),this.onActivateObservable=new J.e,this.onSizeChangedObservable=new J.e,this.onApplyObservable=new J.e,this.onBeforeRenderObservable=new J.e,this.onAfterRenderObservable=new J.e,this.fl=new J.e;let v,i=1,X=null;if(Y&&!Array.isArray(Y)){const z=Y;Y=z.uniforms??null,H=z.samplers??null,i=z.size??1,b=z.camera??null,D=z.samplingMode??1,g=z.vl,M=z.reusable,K=Array.isArray(z.defines)?z.defines.join("\n"):z.defines??null,h=z.textureType??0,o=z.vertexUrl??"postprocess",d=z.indexParameters,t=z.blockCompilation??!1,W=z.textureFormat??5,Z=z.shaderLanguage??0,X=z.uniformBuffers??null,s=z.extraInitializations,v=z.effectWrapper}else T&&(i="number"===typeof T?T:{width:T.width,height:T.height});if(this._useExistingThinPostProcess=!!v,this._effectWrapper=v??new q.g({name:z,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:u,vl:g||(null===(L=b)||void 0===L?void 0:L.iz().getEngine()),uniforms:Y,samplers:H,uniformBuffers:X,defines:K,vertexUrl:o,indexParameters:d,blockCompilation:!0,shaderLanguage:Z,extraInitializations:void 0}),this.name=z,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=b?(this._camera=b,this._scene=b.iz(),b.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):g&&(this._engine=g,this._engine.postProcesses.push(this)),this._options=i,this.renderTargetSamplingMode=D||1,this._reusable=M||!1,this._textureType=h,this._textureFormat=W,this._shaderLanguage=Z||0,this._samplers=H||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=u,this._vertexUrl=o,this._parameters=Y||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=X||[],this._indexParameters=d,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const z=[];this._gatherImports(this._engine.isWebGPU&&!C.ForceGLSL,z),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(t,K,s,z)}}_gatherImports(){let z=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?z.push(Promise.all([Y.e(42).then(Y.bind(Y,13280))])):z.push(Promise.all([Promise.resolve().then(Y.bind(Y,11453))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(z){return this._disposeTextures(),this._shareOutputWithPostProcess=z,this}useOwnOutput(){0==this._textures.length&&(this._textures=new E.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,T=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(z,u,Y,H,E,J,l,T),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let E=0;E<this._textureCache.length;E++)if(this._textureCache[E].texture.width===z.width&&this._textureCache[E].texture.height===z.height&&this._textureCache[E].postProcessChannel===Y&&this._textureCache[E].texture._generateDepthBuffer===u.generateDepthBuffer&&this._textureCache[E].texture.samples===u.samples)return this._textureCache[E].texture;const H=this._engine.createRenderTargetTexture(z,u);return this._textureCache.push({texture:H,postProcessChannel:Y,lastUsedRenderId:-1}),H}_flushTextureCache(){const z=this._renderId;for(let u=this._textureCache.length-1;u>=0;u--)if(z-this._textureCache[u].lastUsedRenderId>100){let z=!1;for(let Y=0;Y<this._textures.length;Y++)if(this._textures.data[Y]===this._textureCache[u].texture){z=!0;break}z||(this._textureCache[u].texture.dispose(),this._textureCache.splice(u,1))}}resize(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=z,this.height=u;let J=null;if(Y)for(let b=0;b<Y._postProcesses.length;b++)if(null!==Y._postProcesses[b]){J=Y._postProcesses[b];break}const l={width:this.width,height:this.height},T={generateMipMaps:H,generateDepthBuffer:E||J===this,generateStencilBuffer:(E||J===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(l,T,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(l,T,1)),this._texelSize.kl(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let z;if(this._shareOutputWithPostProcess)z=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)z=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let u;z=this.inputTexture;for(let Y=0;Y<this._textureCache.length;Y++)if(this._textureCache[Y].texture===z){u=this._textureCache[Y];break}u&&(u.lastUsedRenderId=this._renderId)}return z}activate(z){var u,Y;let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;const J=null===z||void 0!==z.cameraRigMode?z||this._camera:null,l=(null===J||void 0===J?void 0:J.iz())??z,T=l.getEngine(),b=T.getCaps().maxTextureSize,L=(H?H.width:this._engine.getRenderWidth(!0))*this._options|0,D=(H?H.height:this._engine.getRenderHeight(!0))*this._options|0;let g=this._options.width||L,q=this._options.height||D;const C=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let K=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const z=T.currentViewport;z&&(g*=z.width,q*=z.height)}(C||this.alwaysForcePOT)&&(this._options.width||(g=T.needPOTTextures?(0,M.e)(g,b,this.scaleMode):g),this._options.height||(q=T.needPOTTextures?(0,M.e)(q,b,this.scaleMode):q)),this.width===g&&this.height===q&&(K=this._getTarget())||this.resize(g,q,J,C,E),this._textures.forEach((z=>{z.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(z,this.samples)})),this._flushTextureCache(),this._renderId++}return K||(K=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.kl(L/g,D/q),this._engine.bindFramebuffer(K,0,L,D,this.forceFullscreenViewport)):(this._scaleRatio.kl(1,1),this._engine.bindFramebuffer(K,0,void 0,void 0,this.forceFullscreenViewport)),null===(u=(Y=this._engine)._debugInsertMarker)||void 0===u||u.call(Y,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(J),this.JM&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:l.clearColor,l._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),K}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let z;var u;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),z=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(u=z)||void 0===u?void 0:u.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let z=this._textureCache.length-1;z>=0;z--)this._textureCache[z].texture.dispose();this._textureCache.length=0}setPrePassRenderer(z){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=z.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(z){let u;if(z=z||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(u=this._scene.postProcesses.indexOf(this),-1!==u&&this._scene.postProcesses.splice(u,1)),this._parentContainer){const z=this._parentContainer.postProcesses.indexOf(this);z>-1&&this._parentContainer.postProcesses.splice(z,1),this._parentContainer=null}if(u=this._engine.postProcesses.indexOf(this),-1!==u&&this._engine.postProcesses.splice(u,1),this.fl.notifyObservers(),z){if(z.detachPostProcess(this),u=z._postProcesses.indexOf(this),0===u&&z._postProcesses.length>0){const z=this._camera._getFirstPostProcess();z&&z.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const z=L.d.Serialize(this),u=this.getCamera()||this._scene&&this._scene.activeCamera;return z.customType="BABYLON."+this.getClassName(),z.cameraId=u?u.id:null,z.reusable=this._reusable,z.textureType=this._textureType,z.fragmentUrl=this._fragmentUrl,z.parameters=this._parameters,z.samplers=this._samplers,z.uniformBuffers=this._uniformBuffers,z.options=this._options,z.defines=this._postProcessDefines,z.textureFormat=this._textureFormat,z.vertexUrl=this._vertexUrl,z.indexParameters=this._indexParameters,z}clone(){const z=this.serialize();z._engine=this._engine,z.cameraId=null;const u=C.Parse(z,this._scene,"");return u?(u.onActivateObservable=this.onActivateObservable.clone(),u.onSizeChangedObservable=this.onSizeChangedObservable.clone(),u.onApplyObservable=this.onApplyObservable.clone(),u.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),u.onAfterRenderObservable=this.onAfterRenderObservable.clone(),u._prePassEffectConfiguration=this._prePassEffectConfiguration,u):null}static Parse(z,u,Y){const H=(0,D.c)(z.customType);if(!H||!H._Parse)return null;const E=u?u.getCameraById(z.cameraId):null;return H._Parse(z,E,u,Y)}static _Parse(z,u,Y,H){return L.d.Parse((()=>new C(z.name,z.fragmentUrl,z.parameters,z.samplers,z.options,u,z.renderTargetSamplingMode,z._engine,z.reusable,z.defines,z.textureType,z.vertexUrl,z.indexParameters,!1,z.textureFormat)),z,Y,H)}}(0,H.e)([(0,b.L)()],C.prototype,"uniqueId",void 0),(0,H.e)([(0,b.L)()],C.prototype,"name",null),(0,H.e)([(0,b.L)()],C.prototype,"width",void 0),(0,H.e)([(0,b.L)()],C.prototype,"height",void 0),(0,H.e)([(0,b.L)()],C.prototype,"renderTargetSamplingMode",void 0),(0,H.e)([(0,b.m)()],C.prototype,"clearColor",void 0),(0,H.e)([(0,b.L)()],C.prototype,"JM",void 0),(0,H.e)([(0,b.L)()],C.prototype,"forceAutoClearInAlphaMode",void 0),(0,H.e)([(0,b.L)()],C.prototype,"alphaMode",null),(0,H.e)([(0,b.L)()],C.prototype,"alphaConstants",void 0),(0,H.e)([(0,b.L)()],C.prototype,"enablePixelPerfectMode",void 0),(0,H.e)([(0,b.L)()],C.prototype,"forceFullscreenViewport",void 0),(0,H.e)([(0,b.L)()],C.prototype,"scaleMode",void 0),(0,H.e)([(0,b.L)()],C.prototype,"alwaysForcePOT",void 0),(0,H.e)([(0,b.L)("samples")],C.prototype,"_samples",void 0),(0,H.e)([(0,b.L)()],C.prototype,"adaptScaleToCurrentViewport",void 0),(0,D.d)("BABYLON.PostProcess",C)},11429:(z,u,Y)=>{Y.d(u,{b:()=>J});var H=Y(11103),E=Y(10932);class J{constructor(z){this._vertexBuffers={},this.onBeforeRenderObservable=new E.e,this._scene=z}_prepareBuffers(){if(this._vertexBuffers[H.f.PositionKind])return;const z=[];z.push(1,1),z.push(-1,1),z.push(-1,-1),z.push(1,-1),this._vertexBuffers[H.f.PositionKind]=new H.f(this._scene.getEngine(),z,H.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const z=[];z.push(0),z.push(1),z.push(2),z.push(0),z.push(2),z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(z)}_rebuild(){const z=this._vertexBuffers[H.f.PositionKind];z&&(z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this._scene.activeCamera;return!!Y&&(u=u||Y._postProcesses.filter((z=>null!=z)),!(!u||0===u.length||!this._scene.postProcessesEnabled)&&(u[0].activate(Y,z,null!==u&&void 0!==u),!0))}directRender(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.length;const T=this._scene.getEngine();for(let L=0;L<l;L++){var b;if(L<z.length-1)z[L+1].activate(this._scene.activeCamera||this._scene,null===u||void 0===u?void 0:u.texture);else u?T.bindFramebuffer(u,H,void 0,void 0,Y,E):J||T.restoreDefaultFramebuffer(),null===(b=T._debugInsertMarker)||void 0===b||b.call(T,`post process ${z[L].name} output`);const l=z[L],D=l.apply();D&&(l.onBeforeRenderObservable.notifyObservers(D),this._prepareBuffers(),T.bindBuffers(this._vertexBuffers,this._indexBuffer,D),T.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(D))}T.setDepthBuffer(!0),T.setDepthWrite(!0)}_finalizeFrame(z,u,Y,H){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const J=this._scene.activeCamera;if(!J)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(H=H||J._postProcesses.filter((z=>null!=z))).length||!this._scene.postProcessesEnabled)return;const l=this._scene.getEngine();for(let b=0,L=H.length;b<L;b++){const D=H[b];var T;if(b<L-1)D._outputTexture=H[b+1].activate(J,null===u||void 0===u?void 0:u.texture);else u?(l.bindFramebuffer(u,Y,void 0,void 0,E),D._outputTexture=u):(l.restoreDefaultFramebuffer(),D._outputTexture=null),null===(T=l._debugInsertMarker)||void 0===T||T.call(l,`post process ${H[b].name} output`);if(z)break;const g=D.apply();g&&(D.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,g),l.drawElementsType(0,0,6),D.onAfterRenderObservable.notifyObservers(g))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(0)}dispose(){const z=this._vertexBuffers[H.f.PositionKind];z&&(z.dispose(),this._vertexBuffers[H.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11434:(z,u,Y)=>{Y.d(u,{b:()=>T});var H=Y(11283),E=Y(10903);class J{set opaqueSortCompareFn(z){this._opaqueSortCompareFn=z||J.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(z){this._alphaTestSortCompareFn=z||J.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(z){this._transparentSortCompareFn=z||J.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=z,this._opaqueSubMeshes=new H.h(256),this._transparentSubMeshes=new H.h(256),this._alphaTestSubMeshes=new H.h(256),this._depthOnlySubMeshes=new H.h(256),this._particleSystems=new H.h(256),this._spriteManagers=new H.h(256),this._empty=!0,this._edgesRenderers=new H.d(16),this._scene=u,this.opaqueSortCompareFn=Y,this.alphaTestSortCompareFn=E,this.transparentSortCompareFn=J}render(z,u,Y,H){if(z)return void z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const E=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(E.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),E.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const J=E.getStencilBuffer();if(E.setStencilBuffer(!1),u&&this._renderSprites(),Y&&this._renderParticles(H),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(E.setStencilBuffer(J),this._scene.useOrderIndependentTransparency){const z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);z.length&&this._renderTransparent(z)}else this._renderTransparent(this._transparentSubMeshes);E.setAlphaMode(0)}if(E.setStencilBuffer(!1),this._edgesRenderers.length){for(let z=0;z<this._edgesRenderers.length;z++)this._edgesRenderers.data[z].render();E.setAlphaMode(0)}E.setStencilBuffer(J)}_renderOpaqueSorted(z){J._RenderSorted(z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(z){J._RenderSorted(z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(z){J._RenderSorted(z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(z,u,Y,H){let l,T=0;const b=Y?Y.globalPosition:J._ZeroVector;if(H)for(;T<z.length;T++)l=z.data[T],l._alphaIndex=l.getMesh().alphaIndex,l._distanceToCamera=E.p.Distance(l.getBoundingInfo().boundingSphere.centerWorld,b);const L=z.length===z.data.length?z.data:z.data.slice(0,z.length);u&&L.sort(u);const D=L[0].getMesh().iz();for(T=0;T<L.length;T++)if(l=L[T],!D._activeMeshesFrozenButKeepClipping||l.isInFrustum(D._frustumPlanes)){if(H){const z=l.Oz();if(z&&z.needDepthPrePass){const u=z.iz().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),l.render(!1),u.setColorWrite(!0)}}l.render(H)}}static defaultTransparentSortCompare(z,u){return z._alphaIndex>u._alphaIndex?1:z._alphaIndex<u._alphaIndex?-1:J.backToFrontSortCompare(z,u)}static backToFrontSortCompare(z,u){return z._distanceToCamera<u._distanceToCamera?1:z._distanceToCamera>u._distanceToCamera?-1:0}static frontToBackSortCompare(z,u){return z._distanceToCamera<u._distanceToCamera?-1:z._distanceToCamera>u._distanceToCamera?1:0}static PainterSortCompare(z,u){const Y=z.getMesh(),H=u.getMesh();return Y.material&&H.material?Y.material.uniqueId-H.material.uniqueId:Y.uniqueId-H.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(z,u,Y){void 0===u&&(u=z.getMesh()),void 0===Y&&(Y=z.Oz()),null!==Y&&void 0!==Y&&(Y.needAlphaBlendingForMesh(u)?this._transparentSubMeshes.push(z):Y.needAlphaTestingForMesh(u)?(Y.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._alphaTestSubMeshes.push(z)):(Y.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._opaqueSubMeshes.push(z)),u._renderingGroup=this,u._edgesRenderer&&u.isEnabled()&&u.isVisible&&u._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(u._edgesRenderer),this._empty=!1)}dispatchSprites(z){this._spriteManagers.push(z),this._empty=!1}dispatchParticles(z){this._particleSystems.push(z),this._empty=!1}_renderParticles(z){if(0===this._particleSystems.length)return;const u=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let Y=0;Y<this._particleSystems.length;Y++){const H=this._particleSystems.data[Y];if(0===(u&&u.layerMask&H.layerMask))continue;const E=H.k;E.position&&z&&-1===z.indexOf(E)||this._scene._activeParticles.addCount(H.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let u=0;u<this._spriteManagers.length;u++){const Y=this._spriteManagers.data[u];0!==(z&&z.layerMask&Y.layerMask)&&Y.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}J._ZeroVector=E.p.Zero();class l{}class T{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(z){z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const z of this._scene.meshes)if(z.YT)for(const u of z.YT)u._wasDispatched=!1;if(this._scene.spriteManagers)for(const z of this._scene.spriteManagers)z._wasDispatched=!1;for(const z of this._scene.QM)z._wasDispatched=!1}constructor(z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new l,this._maintainStateBetweenFrames=!1,this._scene=z;for(let u=T.MIN_RENDERINGGROUPS;u<T.MAX_RENDERINGGROUPS;u++)this._autoClearDepthStencil[u]={JM:!0,depth:!0,stencil:!0}}getRenderingGroup(z){const u=z||0;return this._prepareRenderingGroup(u),this._renderingGroups[u]}_clearDepthStencilBuffer(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,z,u),this._depthStencilBufferAlreadyCleaned=!0)}render(z,u,Y,H){const E=this._renderingGroupInfo;if(E.Cu=this._scene,E.camera=this._scene.activeCamera,E.renderingManager=this,this._scene.spriteManagers&&H)for(let J=0;J<this._scene.spriteManagers.length;J++){const z=this._scene.spriteManagers[J];this.dispatchSprites(z)}for(let J=T.MIN_RENDERINGGROUPS;J<T.MAX_RENDERINGGROUPS;J++){this._depthStencilBufferAlreadyCleaned=J===T.MIN_RENDERINGGROUPS;const l=this._renderingGroups[J];if(!l||l._empty)continue;const b=1<<J;if(E.renderingGroupId=J,this._scene.onBeforeRenderingGroupObservable.notifyObservers(E,b),T.AUTOCLEAR){const z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(J):this._autoClearDepthStencil[J];z&&z.JM&&this._clearDepthStencilBuffer(z.depth,z.stencil)}for(const z of this._scene._beforeRenderingGroupDrawStage)z.action(J);l.render(z,H,Y,u);for(const z of this._scene._afterRenderingGroupDrawStage)z.action(J);this._scene.onAfterRenderingGroupObservable.notifyObservers(E,b)}}reset(){if(!this.maintainStateBetweenFrames)for(let z=T.MIN_RENDERINGGROUPS;z<T.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let z=T.MIN_RENDERINGGROUPS;z<T.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let z=T.MIN_RENDERINGGROUPS;z<T.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.dispose()}}_prepareRenderingGroup(z){void 0===this._renderingGroups[z]&&(this._renderingGroups[z]=new J(z,this._scene,this._customOpaqueSortCompareFn[z],this._customAlphaTestSortCompareFn[z],this._customTransparentSortCompareFn[z]))}dispatchSprites(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchSprites(z))}dispatchParticles(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchParticles(z))}dispatch(z,u,Y){void 0===u&&(u=z.getMesh()),this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatch(z,u,Y))}setRenderingOrder(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[z]=u,this._customAlphaTestSortCompareFn[z]=Y,this._customTransparentSortCompareFn[z]=H,this._renderingGroups[z]){const u=this._renderingGroups[z];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[z],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[z],u.transparentSortCompareFn=this._customTransparentSortCompareFn[z]}}setRenderingAutoClearDepthStencil(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[z]={JM:u,depth:Y,stencil:H}}getAutoClearDepthStencilSetup(z){return this._autoClearDepthStencil[z]}}T.MAX_RENDERINGGROUPS=4,T.MIN_RENDERINGGROUPS=0,T.AUTOCLEAR=!0},11453:(z,u,Y)=>{Y.r(u),Y.d(u,{postprocessVertexShader:()=>l});var H=Y(11029);const E="postprocessVertexShader",J="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";H.b.ShadersStore[E]||(H.b.ShadersStore[E]=J);const l={name:E,shader:J}},11547:(z,u,Y)=>{Y.d(u,{b:()=>H});class H{}H._IsPickingAvailable=!1},11222:(z,u,Y)=>{Y.d(u,{b:()=>g});var H=Y(11079),E=Y(10903),J=Y(11082),l=Y(10932),T=Y(10928),b=Y(10970),L=Y(11172);class D{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new l.e,this._onClonedObservable=new l.e}}class g{static AddNodeConstructor(z,u){this._NodeConstructors[z]=u}static Construct(z,u,Y,H){const E=this._NodeConstructors[z];return E?E(u,Y,H):null}set accessibilityTag(z){this._accessibilityTag=z,this.onAccessibilityTagChangedObservable.notifyObservers(z)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(z){this._nodeDataStorage._doNotSerialize=z}L(){return this._nodeDataStorage._isDisposed}set parent(z){if(this._parentNode===z)return;const u=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const u=this._parentNode._children.indexOf(this);-1!==u&&this._parentNode._children.splice(u,1),z||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=z,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),u||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(z){z.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const z=this._scene.rootNodes,u=z.length-1;z[this._nodeDataStorage._sceneRootNodesIndex]=z[u],z[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}getClassName(){return"Node"}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new D,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new l.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=E.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.fl=new l.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=z,this.id=z,this._scene=u||T.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),Y&&this._addToSceneRootNodes()}iz(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(z)||(z.init(),this._scene.isLoading&&!u?this._scene.onDataLoadedObservable.addOnce((()=>{z.attach(this)})):z.attach(this),this._behaviors.push(z)),this}removeBehavior(z){const u=this._behaviors.indexOf(z);return-1===u||(this._behaviors[u].detach(),this._behaviors.splice(u,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(z){for(const u of this._behaviors)if(u.name===z)return u;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.pl(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(z){!z&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(z){return this.parent?this.parent._getActionManagerForTrigger(z,!1):null}_updateCache(z){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}uD(z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const z of this._children)z._syncParentEnabledState()}oT(z){this._nodeDataStorage._isEnabled!==z&&(this._nodeDataStorage._isEnabled=z,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(z))}isDescendantOf(z){return!!this.parent&&(this.parent===z||this.parent.isDescendantOf(z))}_getDescendants(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;if(this._children)for(let H=0;H<this._children.length;H++){const E=this._children[H];Y&&!Y(E)||z.push(E),u||E._getDescendants(z,!1,Y)}}getDescendants(z,u){const Y=[];return this._getDescendants(Y,z,u),Y}getChildMeshes(z,u){const Y=[];return this._getDescendants(Y,z,(z=>(!u||u(z))&&void 0!==z.Og)),Y}getChildren(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(u,z)}_setReady(z){z!==this._nodeDataStorage._isReady&&(z?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(z){for(let u=0;u<this.animations.length;u++){const Y=this.animations[u];if(Y.name===z)return Y}return null}createAnimationRange(z,u,Y){if(!this._ranges[z]){this._ranges[z]=g._AnimationRangeFactory(z,u,Y);for(let H=0,E=this.animations.length;H<E;H++)this.animations[H]&&this.animations[H].createRange(z,u,Y)}}deleteAnimationRange(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Y=0,H=this.animations.length;Y<H;Y++)this.animations[Y]&&this.animations[Y].deleteRange(z,u);this._ranges[z]=null}getAnimationRange(z){return this._ranges[z]||null}clone(z,u,Y){const H=L.d.Clone((()=>new g(z,this.iz())),this);if(u&&(H.parent=u),!Y){const u=this.getDescendants(!0);for(let Y=0;Y<u.length;Y++){const E=u[Y];E.clone(z+"."+E.name,H)}}return H}getAnimationRanges(){const z=[];let u;for(u in this._ranges)z.push(this._ranges[u]);return z}beginAnimation(z,u,Y,H){const E=this.getAnimationRange(z);return E?this._scene.beginAnimation(this,E.from,E.to,u,Y,H):null}serializeAnimationRanges(){const z=[];for(const u in this._ranges){const Y=this._ranges[u];if(!Y)continue;const H={};H.name=u,H.from=Y.from,H.to=Y.to,z.push(H)}return z}pl(z){return this._worldMatrix||(this._worldMatrix=E.b.Identity()),this._worldMatrix}dispose(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!z){const Y=this.getDescendants(!0);for(const H of Y)H.dispose(z,u)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.fl.notifyObservers(this),this.fl.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const Y of this._behaviors)Y.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(z,u,Y){if(u.ranges)for(let H=0;H<u.ranges.length;H++){const Y=u.ranges[H];z.createAnimationRange(Y.name,Y.from,Y.to)}}getHierarchyBoundingVectors(){let z,u,Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.iz().incrementRenderId(),this.pl(!0);const J=this;if(J.getBoundingInfo&&J.YT){const Y=J.getBoundingInfo();z=Y.boundingBox.minimumWorld.clone(),u=Y.boundingBox.maximumWorld.clone()}else z=new E.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new E.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(Y){const Y=this.getDescendants(!1);for(const J of Y){const Y=J;if(Y.pl(!0),H&&!H(Y))continue;if(!Y.getBoundingInfo||0===Y.getTotalVertices())continue;const l=Y.getBoundingInfo().boundingBox,T=l.minimumWorld,b=l.maximumWorld;E.p.CheckExtends(T,z,u),E.p.CheckExtends(b,z,u)}}return{min:z,max:u}}}g._AnimationRangeFactory=(z,u,Y)=>{throw(0,b.e)("AnimationRange")},g._NodeConstructors={},(0,H.e)([(0,J.L)()],g.prototype,"name",void 0),(0,H.e)([(0,J.L)()],g.prototype,"id",void 0),(0,H.e)([(0,J.L)()],g.prototype,"uniqueId",void 0),(0,H.e)([(0,J.L)()],g.prototype,"state",void 0),(0,H.e)([(0,J.L)()],g.prototype,"metadata",void 0)},11504:(z,u,Y)=>{Y.d(u,{d:()=>zz});var H=Y(10945),E=Y(10962),J=Y(10932),l=Y(11283);class T{constructor(){this._count=0,this._data={}}J(z){this.clear(),z.forEach(((z,u)=>this.add(z,u)))}get(z){const u=this._data[z];if(void 0!==u)return u}getOrAddWithFactory(z,u){let Y=this.get(z);return void 0!==Y||(Y=u(z),Y&&this.add(z,Y)),Y}getOrAdd(z,u){const Y=this.get(z);return void 0!==Y?Y:(this.add(z,u),u)}contains(z){return void 0!==this._data[z]}add(z,u){return void 0===this._data[z]&&(this._data[z]=u,++this._count,!0)}set(z,u){return void 0!==this._data[z]&&(this._data[z]=u,!0)}getAndRemove(z){const u=this.get(z);return void 0!==u?(delete this._data[z],--this._count,u):null}remove(z){return!!this.contains(z)&&(delete this._data[z],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(z){for(const u in this._data){z(u,this._data[u])}}first(z){for(const u in this._data){const Y=z(u,this._data[u]);if(Y)return Y}return null}}var b=Y(11181),L=Y(10903),D=Y(11508),g=Y(11163),M=Y(11248);class q{constructor(z,u,Y,H,E,J){this.source=z,this.pointerX=u,this.pointerY=Y,this.meshUnderPointer=H,this.sourceEvent=E,this.additionalData=J}static CreateNew(z,u,Y){const H=z.iz();return new q(z,H.pointerX,H.pointerY,H.meshUnderPointer||z,u,Y)}static CreateNewFromSprite(z,u,Y,H){return new q(z,u.pointerX,u.pointerY,u.meshUnderPointer,Y,H)}static CreateNewFromScene(z,u){return new q(null,z.pointerX,z.pointerY,z.meshUnderPointer,u)}static CreateNewFromPrimitive(z,u,Y,H){return new q(z,u.x,u.y,null,Y,H)}}var C=Y(11429),K=Y(11434),h=Y(11320),o=Y(10948),d=Y(10928),t=Y(10970),W=Y(11530);class Z{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const z in Z.Triggers)if(Object.prototype.hasOwnProperty.call(Z.Triggers,z))return!0;return!1}static get HasPickTriggers(){for(const z in Z.Triggers)if(Object.prototype.hasOwnProperty.call(Z.Triggers,z)){const u=parseInt(z);if(u>=1&&u<=7)return!0}return!1}static HasSpecificTrigger(z){for(const u in Z.Triggers)if(Object.prototype.hasOwnProperty.call(Z.Triggers,u)){if(parseInt(u)===z)return!0}return!1}}Z.Triggers={};var s,v,i,X,Q,V,A,x=Y(11539);!function(z){z[z.Generic=0]="Generic",z[z.Keyboard=1]="Keyboard",z[z.Mouse=2]="Mouse",z[z.Touch=3]="Touch",z[z.DualShock=4]="DualShock",z[z.Xbox=5]="Xbox",z[z.Switch=6]="Switch",z[z.DualSense=7]="DualSense"}(s||(s={})),function(z){z[z.Horizontal=0]="Horizontal",z[z.Vertical=1]="Vertical",z[z.LeftClick=2]="LeftClick",z[z.MiddleClick=3]="MiddleClick",z[z.RightClick=4]="RightClick",z[z.BrowserBack=5]="BrowserBack",z[z.BrowserForward=6]="BrowserForward",z[z.MouseWheelX=7]="MouseWheelX",z[z.MouseWheelY=8]="MouseWheelY",z[z.MouseWheelZ=9]="MouseWheelZ",z[z.Move=12]="Move"}(v||(v={})),function(z){z[z.Horizontal=0]="Horizontal",z[z.Vertical=1]="Vertical",z[z.LeftClick=2]="LeftClick",z[z.MiddleClick=3]="MiddleClick",z[z.RightClick=4]="RightClick",z[z.BrowserBack=5]="BrowserBack",z[z.BrowserForward=6]="BrowserForward",z[z.MouseWheelX=7]="MouseWheelX",z[z.MouseWheelY=8]="MouseWheelY",z[z.MouseWheelZ=9]="MouseWheelZ",z[z.DeltaHorizontal=10]="DeltaHorizontal",z[z.DeltaVertical=11]="DeltaVertical"}(i||(i={})),function(z){z[z.Cross=0]="Cross",z[z.Circle=1]="Circle",z[z.Square=2]="Square",z[z.Triangle=3]="Triangle",z[z.L1=4]="L1",z[z.R1=5]="R1",z[z.L2=6]="L2",z[z.R2=7]="R2",z[z.Share=8]="Share",z[z.Options=9]="Options",z[z.L3=10]="L3",z[z.R3=11]="R3",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.TouchPad=17]="TouchPad",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(X||(X={})),function(z){z[z.Cross=0]="Cross",z[z.Circle=1]="Circle",z[z.Square=2]="Square",z[z.Triangle=3]="Triangle",z[z.L1=4]="L1",z[z.R1=5]="R1",z[z.L2=6]="L2",z[z.R2=7]="R2",z[z.Create=8]="Create",z[z.Options=9]="Options",z[z.L3=10]="L3",z[z.R3=11]="R3",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.TouchPad=17]="TouchPad",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(Q||(Q={})),function(z){z[z.A=0]="A",z[z.B=1]="B",z[z.X=2]="X",z[z.Y=3]="Y",z[z.LB=4]="LB",z[z.RB=5]="RB",z[z.LT=6]="LT",z[z.RT=7]="RT",z[z.Back=8]="Back",z[z.Start=9]="Start",z[z.LS=10]="LS",z[z.RS=11]="RS",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.LStickXAxis=17]="LStickXAxis",z[z.LStickYAxis=18]="LStickYAxis",z[z.RStickXAxis=19]="RStickXAxis",z[z.RStickYAxis=20]="RStickYAxis"}(V||(V={})),function(z){z[z.B=0]="B",z[z.A=1]="A",z[z.Y=2]="Y",z[z.X=3]="X",z[z.L=4]="L",z[z.R=5]="R",z[z.ZL=6]="ZL",z[z.ZR=7]="ZR",z[z.Minus=8]="Minus",z[z.Plus=9]="Plus",z[z.LS=10]="LS",z[z.RS=11]="RS",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.Capture=17]="Capture",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(A||(A={}));var G=Y(11545);class F{static CreateDeviceEvent(z,u,Y,H,E,J,l){switch(z){case s.Keyboard:return this._CreateKeyboardEvent(Y,H,E,J);case s.Mouse:if(Y===v.MouseWheelX||Y===v.MouseWheelY||Y===v.MouseWheelZ)return this._CreateWheelEvent(z,u,Y,H,E,J);case s.Touch:return this._CreatePointerEvent(z,u,Y,H,E,J,l);default:throw`Unable to generate event for device ${s[z]}`}}static _CreatePointerEvent(z,u,Y,H,E,J,l){const T=this._CreateMouseEvent(z,u,Y,H,E,J);z===s.Mouse?(T.deviceType=s.Mouse,T.pointerId=1,T.pointerType="mouse"):(T.deviceType=s.Touch,T.pointerId=l??u,T.pointerType="touch");let b=0;return b+=E.pollInput(z,u,v.LeftClick),b+=2*E.pollInput(z,u,v.RightClick),b+=4*E.pollInput(z,u,v.MiddleClick),T.buttons=b,Y===v.Move?T.type="pointermove":Y>=v.LeftClick&&Y<=v.RightClick&&(T.type=1===H?"pointerdown":"pointerup",T.button=Y-2),T}static _CreateWheelEvent(z,u,Y,H,E,J){const l=this._CreateMouseEvent(z,u,Y,H,E,J);switch(l.pointerId=1,l.type="wheel",l.deltaMode=G.b.DOM_DELTA_PIXEL,l.deltaX=0,l.deltaY=0,l.deltaZ=0,Y){case v.MouseWheelX:l.deltaX=H;break;case v.MouseWheelY:l.deltaY=H;break;case v.MouseWheelZ:l.deltaZ=H}return l}static _CreateMouseEvent(z,u,Y,H,E,J){const l=this._CreateEvent(J),T=E.pollInput(z,u,v.Horizontal),b=E.pollInput(z,u,v.Vertical);return J?(l.movementX=0,l.movementY=0,l.offsetX=l.movementX-J.getBoundingClientRect().x,l.offsetY=l.movementY-J.getBoundingClientRect().y):(l.movementX=E.pollInput(z,u,10),l.movementY=E.pollInput(z,u,11),l.offsetX=0,l.offsetY=0),this._CheckNonCharacterKeys(l,E),l.clientX=T,l.clientY=b,l.x=T,l.y=b,l.deviceType=z,l.deviceSlot=u,l.inputIndex=Y,l}static _CreateKeyboardEvent(z,u,Y,H){const E=this._CreateEvent(H);return this._CheckNonCharacterKeys(E,Y),E.deviceType=s.Keyboard,E.deviceSlot=0,E.inputIndex=z,E.type=1===u?"keydown":"keyup",E.key=String.fromCharCode(z),E.keyCode=z,E}static _CheckNonCharacterKeys(z,u){const Y=u.isDeviceAvailable(s.Keyboard),H=Y&&1===u.pollInput(s.Keyboard,0,18),E=Y&&1===u.pollInput(s.Keyboard,0,17),J=Y&&(1===u.pollInput(s.Keyboard,0,91)||1===u.pollInput(s.Keyboard,0,92)||1===u.pollInput(s.Keyboard,0,93)),l=Y&&1===u.pollInput(s.Keyboard,0,16);z.altKey=H,z.ctrlKey=E,z.metaKey=J,z.shiftKey=l}static _CreateEvent(z){const u={preventDefault:()=>{}};return u.target=z,u}}class R{constructor(z,u,Y){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(z,u,((z,u,H,E)=>{const J=F.CreateDeviceEvent(z,u,H,E,this);Y(z,u,J)})):this._createDummyNativeInput()}pollInput(z,u,Y){return this._nativeInput.pollInput(z,u,Y)}isDeviceAvailable(z){return z===s.Mouse||z===s.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const w=Object.keys(v).length/2;class c{constructor(z,u,Y,E){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=H.e.IsSafari(),this._usingMacOs=(0,o.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=z=>{},this._keyboardUpEvent=z=>{},this._keyboardBlurEvent=z=>{},this._pointerMoveEvent=z=>{},this._pointerDownEvent=z=>{},this._pointerUpEvent=z=>{},this._pointerCancelEvent=z=>{},this._pointerCancelTouch=z=>{},this._pointerLeaveEvent=z=>{},this._pointerWheelEvent=z=>{},this._pointerBlurEvent=z=>{},this._pointerMacOsChromeOutEvent=z=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,o.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,o.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=z=>{},this._gamepadDisconnectedEvent=z=>{},this._eventPrefix=H.e.GetPointerPrefix(z),this._engine=z,this._onDeviceConnected=u,this._onDeviceDisconnected=Y,this._onInputChanged=E,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(z,u,Y){const E=this._inputs[z][u];if(!E)throw`Unable to find device ${s[z]}`;z>=s.DualShock&&z<=s.DualSense&&this._updateDevice(z,u,Y);const J=E[Y];if(void 0===J)throw`Unable to find input ${Y} for device ${s[z]} in slot ${u}`;return Y===v.Move&&H.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),J}isDeviceAvailable(z){return void 0!==this._inputs[z]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const z=null===this||void 0===this?void 0:this._engine.getInputElement();if(z&&(!this._eventsAttached||this._elementToAttachTo!==z)){if(this._disableEvents(),this._inputs)for(const z of this._inputs)if(z)for(const u in z){const Y=z[+u];if(Y)for(let z=0;z<Y.length;z++)Y[z]=0}this._elementToAttachTo=z,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const z=navigator.getGamepads();for(const u of z)u&&this._addGamePad(u)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(s.Mouse,0,0,0)}_addGamePad(z){const u=this._getGamepadDeviceType(z.id),Y=z.index;this._gamepads=this._gamepads||new Array(z.index+1),this._registerDevice(u,Y,z.buttons.length+z.axes.length),this._gamepads[Y]=u}_addPointerDevice(z,u,Y,H){this._pointerActive||(this._pointerActive=!0),this._registerDevice(z,u,w);const E=this._inputs[z][u];E[0]=Y,E[1]=H}_registerDevice(z,u,Y){if(void 0===u)throw`Unable to register device ${s[z]} to undefined slot.`;if(this._inputs[z]||(this._inputs[z]={}),!this._inputs[z][u]){const H=new Array(Y);H.fill(0),this._inputs[z][u]=H,this._onDeviceConnected(z,u)}}_unregisterDevice(z,u){this._inputs[z][u]&&(delete this._inputs[z][u],this._onDeviceDisconnected(z,u))}_handleKeyActions(){this._keyboardDownEvent=z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(s.Keyboard,0,255));const u=this._inputs[s.Keyboard][0];if(u){u[z.keyCode]=1;const Y=z;Y.inputIndex=z.keyCode,this._usingMacOs&&z.metaKey&&"Meta"!==z.key&&(this._metaKeys.includes(z.keyCode)||this._metaKeys.push(z.keyCode)),this._onInputChanged(s.Keyboard,0,Y)}},this._keyboardUpEvent=z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(s.Keyboard,0,255));const u=this._inputs[s.Keyboard][0];if(u){u[z.keyCode]=0;const Y=z;if(Y.inputIndex=z.keyCode,this._usingMacOs&&"Meta"===z.key&&this._metaKeys.length>0){for(const z of this._metaKeys){const Y=F.CreateDeviceEvent(s.Keyboard,0,z,0,this,this._elementToAttachTo);u[z]=0,this._onInputChanged(s.Keyboard,0,Y)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(s.Keyboard,0,Y)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const z=this._inputs[s.Keyboard][0];for(let u=0;u<z.length;u++)if(0!==z[u]){z[u]=0;const Y=F.CreateDeviceEvent(s.Keyboard,0,u,0,this,this._elementToAttachTo);this._onInputChanged(s.Keyboard,0,Y)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,o.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let H=0;H<this._maxTouchPoints;H++)this._activeTouchIds[H]=-1;this._pointerMoveEvent=z=>{const u=this._getPointerType(z);let Y=u===s.Mouse?0:this._activeTouchIds.indexOf(z.pointerId);if(u===s.Touch&&-1===Y){const E=this._activeTouchIds.indexOf(-1);if(!(E>=0))return void H.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);Y=E,this._activeTouchIds[E]=z.pointerId,this._onDeviceConnected(u,Y)}this._inputs[u]||(this._inputs[u]={}),this._inputs[u][Y]||this._addPointerDevice(u,Y,z.clientX,z.clientY);const E=this._inputs[u][Y];if(E){const H=z;H.inputIndex=v.Move,E[v.Horizontal]=z.clientX,E[v.Vertical]=z.clientY,u===s.Touch&&0===E[v.LeftClick]&&(E[v.LeftClick]=1),void 0===z.pointerId&&(z.pointerId=this._mouseId),this._onInputChanged(u,Y,H),this._usingSafari||-1===z.button||(H.inputIndex=z.button+2,E[z.button+2]=E[z.button+2]?0:1,this._onInputChanged(u,Y,H))}},this._pointerDownEvent=z=>{const u=this._getPointerType(z);let Y=u===s.Mouse?0:z.pointerId;if(u===s.Touch){let u=this._activeTouchIds.indexOf(z.pointerId);if(-1===u&&(u=this._activeTouchIds.indexOf(-1)),!(u>=0))return void H.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);Y=u,this._activeTouchIds[u]=z.pointerId}this._inputs[u]||(this._inputs[u]={}),this._inputs[u][Y]?u===s.Touch&&this._onDeviceConnected(u,Y):this._addPointerDevice(u,Y,z.clientX,z.clientY);const E=this._inputs[u][Y];if(E){const H=E[v.Horizontal],l=E[v.Vertical];if(u===s.Mouse){if(void 0===z.pointerId&&(z.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(J){}}else if(z.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(z.pointerId)}catch(J){}E[v.Horizontal]=z.clientX,E[v.Vertical]=z.clientY,E[z.button+2]=1;const T=z;T.inputIndex=z.button+2,this._onInputChanged(u,Y,T),H===z.clientX&&l===z.clientY||(T.inputIndex=v.Move,this._onInputChanged(u,Y,T))}},this._pointerUpEvent=z=>{var u;const Y=this._getPointerType(z),H=Y===s.Mouse?0:this._activeTouchIds.indexOf(z.pointerId);if(Y===s.Touch){if(-1===H)return;this._activeTouchIds[H]=-1}const E=null===(u=this._inputs[Y])||void 0===u?void 0:u[H];let J=z.button,l=E&&0!==E[J+2];if(!l&&this._isUsingFirefox&&this._usingMacOs&&E&&(J=2===J?0:2,l=0!==E[J+2]),l){var T,b,L,D;const u=E[v.Horizontal],l=E[v.Vertical];E[v.Horizontal]=z.clientX,E[v.Vertical]=z.clientY,E[J+2]=0;const g=z;void 0===z.pointerId&&(z.pointerId=this._mouseId),u===z.clientX&&l===z.clientY||(g.inputIndex=v.Move,this._onInputChanged(Y,H,g)),g.inputIndex=J+2,Y===s.Mouse&&this._mouseId>=0&&null!==(T=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==T&&T.call(b,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):z.pointerId&&null!==(L=(D=this._elementToAttachTo).hasPointerCapture)&&void 0!==L&&L.call(D,z.pointerId)&&this._elementToAttachTo.releasePointerCapture(z.pointerId),this._onInputChanged(Y,H,g),Y===s.Touch&&this._onDeviceDisconnected(Y,H)}},this._pointerCancelTouch=z=>{var u,Y;const H=this._activeTouchIds.indexOf(z);if(-1===H)return;null!==(u=(Y=this._elementToAttachTo).hasPointerCapture)&&void 0!==u&&u.call(Y,z)&&this._elementToAttachTo.releasePointerCapture(z),this._inputs[s.Touch][H][v.LeftClick]=0;const E=F.CreateDeviceEvent(s.Touch,H,v.LeftClick,0,this,this._elementToAttachTo,z);this._onInputChanged(s.Touch,H,E),this._activeTouchIds[H]=-1,this._onDeviceDisconnected(s.Touch,H)},this._pointerCancelEvent=z=>{if("mouse"===z.pointerType){var u,Y;const z=this._inputs[s.Mouse][0];this._mouseId>=0&&null!==(u=(Y=this._elementToAttachTo).hasPointerCapture)&&void 0!==u&&u.call(Y,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let u=v.LeftClick;u<=v.BrowserForward;u++)if(1===z[u]){z[u]=0;const Y=F.CreateDeviceEvent(s.Mouse,0,u,0,this,this._elementToAttachTo);this._onInputChanged(s.Mouse,0,Y)}}else this._pointerCancelTouch(z.pointerId)},this._pointerLeaveEvent=z=>{"pen"===z.pointerType&&this._pointerCancelTouch(z.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let z=!1;const u=function(){};try{const Y=Object.defineProperty({},"passive",{get:function(){z=!0}});this._elementToAttachTo.addEventListener("test",u,Y),this._elementToAttachTo.removeEventListener("test",u,Y)}catch(Y){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(s.Mouse)){var z,u;const Y=this._inputs[s.Mouse][0];this._mouseId>=0&&null!==(z=(u=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(u,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let z=v.LeftClick;z<=v.BrowserForward;z++)if(1===Y[z]){Y[z]=0;const u=F.CreateDeviceEvent(s.Mouse,0,z,0,this,this._elementToAttachTo);this._onInputChanged(s.Mouse,0,u)}}if(this.isDeviceAvailable(s.Touch)){const z=this._inputs[s.Touch];for(let u=0;u<this._activeTouchIds.length;u++){var Y,H,E;const J=this._activeTouchIds[u];if(null!==(Y=(H=this._elementToAttachTo).hasPointerCapture)&&void 0!==Y&&Y.call(H,J)&&this._elementToAttachTo.releasePointerCapture(J),-1!==J&&1===(null===(E=z[u])||void 0===E?void 0:E[v.LeftClick])){z[u][v.LeftClick]=0;const Y=F.CreateDeviceEvent(s.Touch,u,v.LeftClick,0,this,this._elementToAttachTo,J);this._onInputChanged(s.Touch,u,Y),this._activeTouchIds[u]=-1,this._onDeviceDisconnected(s.Touch,u)}}}},this._pointerWheelEvent=z=>{const u=s.Mouse;this._inputs[u]||(this._inputs[u]=[]),this._inputs[u][0]||(this._pointerActive=!0,this._registerDevice(u,0,w));const Y=this._inputs[u][0];if(Y){Y[v.MouseWheelX]=z.deltaX||0,Y[v.MouseWheelY]=z.deltaY||z.wheelDelta||0,Y[v.MouseWheelZ]=z.deltaZ||0;const H=z;void 0===z.pointerId&&(z.pointerId=this._mouseId),0!==Y[v.MouseWheelX]&&(H.inputIndex=v.MouseWheelX,this._onInputChanged(u,0,H)),0!==Y[v.MouseWheelY]&&(H.inputIndex=v.MouseWheelY,this._onInputChanged(u,0,H)),0!==Y[v.MouseWheelZ]&&(H.inputIndex=v.MouseWheelZ,this._onInputChanged(u,0,H))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=z=>{z.buttons>1&&this._pointerCancelEvent(z)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!z&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(s.Mouse)){const z=this._inputs[s.Mouse][0];z[v.MouseWheelX]=0,z[v.MouseWheelY]=0,z[v.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=z=>{this._addGamePad(z.gamepad)},this._gamepadDisconnectedEvent=z=>{if(this._gamepads){const u=this._getGamepadDeviceType(z.gamepad.id),Y=z.gamepad.index;this._unregisterDevice(u,Y),delete this._gamepads[Y]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(z,u,Y){const H=navigator.getGamepads()[u];if(H&&z===this._gamepads[u]){const E=this._inputs[z][u];Y>=H.buttons.length?E[Y]=H.axes[Y-H.buttons.length].valueOf():E[Y]=H.buttons[Y].value}}_getGamepadDeviceType(z){return-1!==z.indexOf("054c")?-1!==z.indexOf("0ce6")?s.DualSense:s.DualShock:-1!==z.indexOf("Xbox One")||-1!==z.search("Xbox 360")||-1!==z.search("xinput")?s.Xbox:-1!==z.indexOf("057e")?s.Switch:s.Generic}_getPointerType(z){let u=s.Mouse;return("touch"===z.pointerType||"pen"===z.pointerType||z.touches)&&(u=s.Touch),u}}class U{constructor(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=u,this.deviceSlot=Y,this.onInputChangedObservable=new J.e,this._deviceInputSystem=z}getInput(z){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,z)}}class O{constructor(z){this._registeredManagers=new Array,this._refCount=0,this.registerManager=z=>{for(let u=0;u<this._devices.length;u++){const Y=this._devices[u];for(const H in Y){const Y=+H;z._addDevice(new U(this._deviceInputSystem,u,Y))}}this._registeredManagers.push(z)},this.unregisterManager=z=>{const u=this._registeredManagers.indexOf(z);u>-1&&this._registeredManagers.splice(u,1)};const u=Object.keys(s).length/2;this._devices=new Array(u);const Y=(z,u)=>{this._devices[z]||(this._devices[z]=new Array),this._devices[z][u]||(this._devices[z][u]=u);for(const Y of this._registeredManagers){const H=new U(this._deviceInputSystem,z,u);Y._addDevice(H)}},H=(z,u)=>{var Y;null!==(Y=this._devices[z])&&void 0!==Y&&Y[u]&&delete this._devices[z][u];for(const H of this._registeredManagers)H._removeDevice(z,u)},E=(z,u,Y)=>{if(Y)for(const H of this._registeredManagers)H._onInputChanged(z,u,Y)};"undefined"!==typeof _native?this._deviceInputSystem=new R(Y,H,E):this._deviceInputSystem=new c(z,Y,H,E)}dispose(){this._deviceInputSystem.dispose()}}class n{getDeviceSource(z,u){if(void 0===u){if(void 0===this._firstDevice[z])return null;u=this._firstDevice[z]}return this._devices[z]&&void 0!==this._devices[z][u]?this._devices[z][u]:null}getDeviceSources(z){return this._devices[z]?this._devices[z].filter((z=>!!z)):[]}constructor(z){const u=Object.keys(s).length/2;this._devices=new Array(u),this._firstDevice=new Array(u),this._engine=z,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new O(z)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new J.e((z=>{for(const u of this._devices)if(u)for(const Y of u)Y&&this.onDeviceConnectedObservable.notifyObserver(z,Y)})),this.onDeviceDisconnectedObservable=new J.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=z.fl.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.fl.remove(this._onDisposeObserver)}_addDevice(z){this._devices[z.deviceType]||(this._devices[z.deviceType]=[]),this._devices[z.deviceType][z.deviceSlot]||(this._devices[z.deviceType][z.deviceSlot]=z,this._updateFirstDevices(z.deviceType)),this.onDeviceConnectedObservable.notifyObservers(z)}_removeDevice(z,u){var Y,H;const E=null===(Y=this._devices[z])||void 0===Y?void 0:Y[u];this.onDeviceDisconnectedObservable.notifyObservers(E),null!==(H=this._devices[z])&&void 0!==H&&H[u]&&delete this._devices[z][u],this._updateFirstDevices(z)}_onInputChanged(z,u,Y){var H,E;null===(H=this._devices[z])||void 0===H||null===(E=H[u])||void 0===E||E.onInputChangedObservable.notifyObservers(Y)}_updateFirstDevices(z){switch(z){case s.Keyboard:case s.Mouse:this._firstDevice[z]=0;break;case s.Touch:case s.DualSense:case s.DualShock:case s.Xbox:case s.Switch:case s.Generic:{delete this._firstDevice[z];const u=this._devices[z];if(u)for(let Y=0;Y<u.length;Y++)if(u[Y]){this._firstDevice[z]=Y;break}break}}}}var m=Y(11547);class p{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get GY(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(z){this._singleClick=z}set GY(z){this._doubleClick=z}set hasSwiped(z){this._hasSwiped=z}set ignore(z){this._ignore=z}}class S{constructor(z){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new L.m(0,0),this._previousStartingPointerPosition=new L.m(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=z||d.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(z){return this._meshUnderPointerId[z]||null}get unTranslatedPointer(){return new L.m(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(z){this._pointerX=z}get pointerY(){return this._pointerY}set pointerY(z){this._pointerY=z}_updatePointerPosition(z){const u=this._scene.getEngine().getInputElementClientRect();u&&(this._pointerX=z.clientX-u.left,this._pointerY=z.clientY-u.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(z,u){const Y=this._scene,H=Y.getEngine(),E=H.getInputElement();E&&(E.tabIndex=H.canvasTabIndex,Y.doNotHandleCursors||(E.style.cursor=Y.defaultCursor)),this._setCursorAndPointerOverMesh(z,u,Y);for(const b of Y._pointerMoveStage){var J;const Y=!(null===(J=z=z||this._pickMove(u))||void 0===J||!J.pickedMesh);z=b.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,Y,E)}const l=u.inputIndex>=v.MouseWheelX&&u.inputIndex<=v.MouseWheelZ?W.d.POINTERWHEEL:W.d.POINTERMOVE;let T;Y.onPointerMove&&(z=z||this._pickMove(u),Y.onPointerMove(u,z,l)),z?(T=new W.j(l,u,z),this._setRayOnPointerInfo(z,u)):(T=new W.j(l,u,null,this),this._movePointerInfo=T),Y.onPointerObservable.hasObservers()&&Y.onPointerObservable.notifyObservers(T,l)}_setRayOnPointerInfo(z,u){const Y=this._scene;z&&m.b._IsPickingAvailable&&(z.ray||(z.ray=Y.createPickingRay(u.offsetX,u.offsetY,L.b.Identity(),Y.activeCamera)))}_addCameraPointerObserver(z,u){return this._cameraObserverCount++,this._scene.onPointerObservable.add(z,u)}_removeCameraPointerObserver(z){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(z)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(z,u,Y){const H=this._scene,E=new W.g(Y,u,this._unTranslatedPointerX,this._unTranslatedPointerY);return z&&(E.originalPickingInfo=z,E.ray=z.ray,"xr-near"===u.pointerType&&z.originMesh&&(E.nearInteractionPickingInfo=z)),H.onPrePointerObservable.notifyObservers(E,Y),!!E.skipOnPointerObservable}_pickMove(z){const u=this._scene,Y=u.EY(this._unTranslatedPointerX,this._unTranslatedPointerY,u.pointerMovePredicate,u.pointerMoveFastCheck,u.cameraToUseForPointers,u.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(Y,z,u),Y}_setCursorAndPointerOverMesh(z,u,Y){const H=Y.getEngine().getInputElement();if(null!==z&&void 0!==z&&z.pickedMesh){if(this.setPointerOverMesh(z.pickedMesh,u.pointerId,z,u),!Y.doNotHandleCursors&&H&&this._pointerOverMesh){const z=this._pointerOverMesh._getActionManagerForTrigger();z&&z.hasPointerTriggers&&(H.style.cursor=z.hoverCursor||Y.hoverCursor)}}else this.setPointerOverMesh(null,u.pointerId,z,u)}simulatePointerMove(z,u){const Y=new PointerEvent("pointermove",u);Y.inputIndex=v.Move,this._checkPrePointerObservable(z,Y,W.d.POINTERMOVE)||this._processPointerMove(z,Y)}simulatePointerDown(z,u){const Y=new PointerEvent("pointerdown",u);Y.inputIndex=Y.button+2,this._checkPrePointerObservable(z,Y,W.d.POINTERDOWN)||this._processPointerDown(z,Y)}_processPointerDown(z,u){var Y;const H=this._scene;if(null!==(Y=z)&&void 0!==Y&&Y.pickedMesh){this._pickedDownMesh=z.pickedMesh;const Y=z.pickedMesh._getActionManagerForTrigger();if(Y){if(Y.hasPickTriggers)switch(Y.processTrigger(5,new q(z.pickedMesh,H.pointerX,H.pointerY,z.pickedMesh,u,z)),u.button){case 0:Y.processTrigger(2,new q(z.pickedMesh,H.pointerX,H.pointerY,z.pickedMesh,u,z));break;case 1:Y.processTrigger(4,new q(z.pickedMesh,H.pointerX,H.pointerY,z.pickedMesh,u,z));break;case 2:Y.processTrigger(3,new q(z.pickedMesh,H.pointerX,H.pointerY,z.pickedMesh,u,z))}Y.hasSpecificTrigger(8)&&window.setTimeout((()=>{const z=H.EY(this._unTranslatedPointerX,this._unTranslatedPointerY,(z=>z.YL&&z.isVisible&&z.isReady()&&z.actionManager&&z.actionManager.hasSpecificTrigger(8)&&z===this._pickedDownMesh),!1,H.cameraToUseForPointers);null!==z&&void 0!==z&&z.pickedMesh&&Y&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>S.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,Y.processTrigger(8,q.CreateNew(z.pickedMesh,u)))}),S.LongPressDelay)}}else for(const l of H._pointerDownStage)z=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,u,!1);let E;const J=W.d.POINTERDOWN;z?(H.onPointerDown&&H.onPointerDown(u,z,J),E=new W.j(J,u,z),this._setRayOnPointerInfo(z,u)):E=new W.j(J,u,null,this),H.onPointerObservable.hasObservers()&&H.onPointerObservable.notifyObservers(E,J)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(z,u,Y){const H=new PointerEvent("pointerup",u);H.inputIndex=v.Move;const E=new p;Y?E.GY=!0:E.singleClick=!0,this._checkPrePointerObservable(z,H,W.d.POINTERUP)||this._processPointerUp(z,H,E)}_processPointerUp(z,u,Y){var H;const E=this._scene;if(null!==(H=z)&&void 0!==H&&H.pickedMesh){if(this._pickedUpMesh=z.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(E.onPointerPick&&E.onPointerPick(u,z),Y.singleClick&&!Y.ignore&&E.onPointerObservable.observers.length>this._cameraObserverCount)){const Y=W.d.POINTERPICK,H=new W.j(Y,u,z);this._setRayOnPointerInfo(z,u),E.onPointerObservable.notifyObservers(H,Y)}const H=z.pickedMesh._getActionManagerForTrigger();if(H&&!Y.ignore){H.processTrigger(7,q.CreateNew(z.pickedMesh,u,z)),!Y.hasSwiped&&Y.singleClick&&H.processTrigger(1,q.CreateNew(z.pickedMesh,u,z));const E=z.pickedMesh._getActionManagerForTrigger(6);Y.GY&&E&&E.processTrigger(6,q.CreateNew(z.pickedMesh,u,z))}}else if(!Y.ignore)for(const J of E._pointerUpStage)z=J.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,u,Y.GY);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const z=this._pickedDownMesh._getActionManagerForTrigger(16);z&&z.processTrigger(16,q.CreateNew(this._pickedDownMesh,u))}if(!Y.ignore){const H=new W.j(W.d.POINTERUP,u,z);if(this._setRayOnPointerInfo(z,u),E.onPointerObservable.notifyObservers(H,W.d.POINTERUP),E.onPointerUp&&E.onPointerUp(u,z,W.d.POINTERUP),!Y.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let H=0;if(Y.singleClick?H=W.d.POINTERTAP:Y.GY&&(H=W.d.POINTERDOUBLETAP),H){const Y=new W.j(H,u,z);E.onPointerObservable.hasObservers()&&E.onPointerObservable.hasSpecificMask(H)&&E.onPointerObservable.notifyObservers(Y,H)}}}}isPointerCaptured(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[z]}attachControl(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=this._scene,J=E.getEngine();H||(H=J.getInputElement()),this._alreadyAttached&&this.EM(),H&&(this._alreadyAttachedTo=H),this._deviceSourceManager=new n(J),this._initActionManager=z=>{if(!this._meshPickProceed){const u=E.skipPointerUpPicking||0===E._registeredActions&&!this._checkForPicking()&&!E.onPointerUp?null:E.EY(this._unTranslatedPointerX,this._unTranslatedPointerY,E.pointerUpPredicate,E.pointerUpFastCheck,E.cameraToUseForPointers,E.pointerUpTrianglePredicate);this._currentPickResult=u,u&&(z=u.hit&&u.pickedMesh?u.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return z},this._delayedSimpleClick=(z,u,Y)=>{if((Date.now()-this._previousStartingPointerTime>S.DoubleClickDelay&&!this._doubleClickOccured||z!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,u.singleClick=!0,u.ignore=!1,this._delayedClicks[z])){const u=this._delayedClicks[z].evt,Y=W.d.POINTERTAP,H=new W.j(Y,u,this._currentPickResult);E.onPointerObservable.hasObservers()&&E.onPointerObservable.hasSpecificMask(Y)&&E.onPointerObservable.notifyObservers(H,Y),this._delayedClicks[z]=null}},this._initClickEvent=(z,u,Y,H)=>{const E=new p;this._currentPickResult=null;let J=null,l=z.hasSpecificMask(W.d.POINTERPICK)||u.hasSpecificMask(W.d.POINTERPICK)||z.hasSpecificMask(W.d.POINTERTAP)||u.hasSpecificMask(W.d.POINTERTAP)||z.hasSpecificMask(W.d.POINTERDOUBLETAP)||u.hasSpecificMask(W.d.POINTERDOUBLETAP);!l&&Z&&(J=this._initActionManager(J,E),J&&(l=J.hasPickTriggers));let T=!1;if(l=l&&!this._isMultiTouchGesture,l){const l=Y.button;if(E.hasSwiped=this._isPointerSwiping(),!E.hasSwiped){let D=!S.ExclusiveDoubleClickMode;if(D||(D=!z.hasSpecificMask(W.d.POINTERDOUBLETAP)&&!u.hasSpecificMask(W.d.POINTERDOUBLETAP),D&&!Z.HasSpecificTrigger(6)&&(J=this._initActionManager(J,E),J&&(D=!J.hasSpecificTrigger(6)))),D)(Date.now()-this._previousStartingPointerTime>S.DoubleClickDelay||l!==this._previousButtonPressed)&&(E.singleClick=!0,H(E,this._currentPickResult),T=!0);else{const z={evt:Y,clickInfo:E,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,l,E,H),S.DoubleClickDelay)};this._delayedClicks[l]=z}let g=z.hasSpecificMask(W.d.POINTERDOUBLETAP)||u.hasSpecificMask(W.d.POINTERDOUBLETAP);if(!g&&Z.HasSpecificTrigger(6)&&(J=this._initActionManager(J,E),J&&(g=J.hasSpecificTrigger(6))),g)if(l===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<S.DoubleClickDelay&&!this._doubleClickOccured){if(E.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l,S.ExclusiveDoubleClickMode){var b;if(this._delayedClicks[l])clearTimeout(null===(b=this._delayedClicks[l])||void 0===b?void 0:b.timeoutId),this._delayedClicks[l]=null;H(E,this._previousPickResult)}else H(E,this._currentPickResult);else{var L;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,E.GY=!0,E.ignore=!1,S.ExclusiveDoubleClickMode&&this._delayedClicks[l])clearTimeout(null===(L=this._delayedClicks[l])||void 0===L?void 0:L.timeoutId),this._delayedClicks[l]=null;H(E,this._currentPickResult)}T=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l}}T||H(E,this._currentPickResult)},this._onPointerMove=z=>{if(this._updatePointerPosition(z),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>S.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>S.DragMovementThreshold),J.isPointerLock&&J._verifyPointerLock(),this._checkPrePointerObservable(null,z,z.inputIndex>=v.MouseWheelX&&z.inputIndex<=v.MouseWheelZ?W.d.POINTERWHEEL:W.d.POINTERMOVE))return;if(!E.cameraToUseForPointers&&!E.activeCamera)return;if(E.gM)return void this._processPointerMove(new M.e,z);E.pointerMovePredicate||(E.pointerMovePredicate=z=>z.YL&&z.isVisible&&z.isReady()&&z.isEnabled()&&(z.enablePointerMoveEvents||E.constantlyUpdateMeshUnderPointer||null!==z._getActionManagerForTrigger())&&(!E.cameraToUseForPointers||0!==(E.cameraToUseForPointers.layerMask&z.layerMask)));const u=E._registeredActions>0||E.constantlyUpdateMeshUnderPointer?this._pickMove(z):null;this._processPointerMove(u,z)},this._onPointerDown=z=>{const u=this._activePointerIds.indexOf(-1);if(-1===u?this._activePointerIds.push(z.pointerId):this._activePointerIds[u]=z.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,S.ExclusiveDoubleClickMode)for(let H=0;H<this._delayedClicks.length;H++)if(this._delayedClicks[H])if(z.button===H){var Y;clearTimeout(null===(Y=this._delayedClicks[H])||void 0===Y?void 0:Y.timeoutId)}else{const z=this._delayedClicks[H].clickInfo;this._doubleClickOccured=!1,z.singleClick=!0,z.ignore=!1;const u=this._delayedClicks[H].evt,Y=W.d.POINTERTAP,J=new W.j(Y,u,this._currentPickResult);E.onPointerObservable.hasObservers()&&E.onPointerObservable.hasSpecificMask(Y)&&E.onPointerObservable.notifyObservers(J,Y),this._delayedClicks[H]=null}if(this._updatePointerPosition(z),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=z.button),E.preventDefaultOnPointerDown&&H&&(z.preventDefault(),H.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,z,W.d.POINTERDOWN))return;if(!E.cameraToUseForPointers&&!E.activeCamera)return;let J;this._pointerCaptures[z.pointerId]=!0,E.pointerDownPredicate||(E.pointerDownPredicate=z=>z.YL&&z.isVisible&&z.isReady()&&z.isEnabled()&&(!E.cameraToUseForPointers||0!==(E.cameraToUseForPointers.layerMask&z.layerMask))),this._pickedDownMesh=null,J=E.skipPointerDownPicking||0===E._registeredActions&&!this._checkForPicking()&&!E.onPointerDown?new M.e:E.EY(this._unTranslatedPointerX,this._unTranslatedPointerY,E.pointerDownPredicate,E.pointerDownFastCheck,E.cameraToUseForPointers,E.pointerDownTrianglePredicate),this._processPointerDown(J,z)},this._onPointerUp=z=>{const u=this._activePointerIds.indexOf(z.pointerId);-1!==u&&(this._activePointerIds[u]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(z),E.preventDefaultOnPointerUp&&H&&(z.preventDefault(),H.focus()),this._initClickEvent(E.onPrePointerObservable,E.onPointerObservable,z,((u,Y)=>{if(E.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!u.ignore)){if(this._checkPrePointerObservable(null,z,W.d.POINTERUP))return this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===z.buttons&&(this._pointerCaptures[z.pointerId]=!1));u.hasSwiped||(u.singleClick&&E.onPrePointerObservable.hasSpecificMask(W.d.POINTERTAP)&&this._checkPrePointerObservable(null,z,W.d.POINTERTAP)&&(this._skipPointerTap=!0),u.GY&&E.onPrePointerObservable.hasSpecificMask(W.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,z,W.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[z.pointerId]?(0===z.buttons&&(this._pointerCaptures[z.pointerId]=!1),(E.cameraToUseForPointers||E.activeCamera)&&(E.pointerUpPredicate||(E.pointerUpPredicate=z=>z.YL&&z.isVisible&&z.isReady()&&z.isEnabled()&&(!E.cameraToUseForPointers||0!==(E.cameraToUseForPointers.layerMask&z.layerMask))),!this._meshPickProceed&&(Z&&Z.HasTriggers||this._checkForPicking()||E.onPointerUp)&&this._initActionManager(null,u),Y||(Y=this._currentPickResult),this._processPointerUp(Y,z,u),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=z=>{const u=x.d.KEYDOWN;if(E.onPreKeyboardObservable.hasObservers()){const Y=new x.h(u,z);if(E.onPreKeyboardObservable.notifyObservers(Y,u),Y.skipOnKeyboardObservable)return}if(E.onKeyboardObservable.hasObservers()){const Y=new x.j(u,z);E.onKeyboardObservable.notifyObservers(Y,u)}E.actionManager&&E.actionManager.processTrigger(14,q.CreateNewFromScene(E,z))},this._onKeyUp=z=>{const u=x.d.KEYUP;if(E.onPreKeyboardObservable.hasObservers()){const Y=new x.h(u,z);if(E.onPreKeyboardObservable.notifyObservers(Y,u),Y.skipOnKeyboardObservable)return}if(E.onKeyboardObservable.hasObservers()){const Y=new x.j(u,z);E.onKeyboardObservable.notifyObservers(Y,u)}E.actionManager&&E.actionManager.processTrigger(15,q.CreateNewFromScene(E,z))},this._deviceSourceManager.onDeviceConnectedObservable.add((H=>{H.deviceType===s.Mouse?H.onInputChangedObservable.add((E=>{this._originMouseEvent=E,E.inputIndex===v.LeftClick||E.inputIndex===v.MiddleClick||E.inputIndex===v.RightClick||E.inputIndex===v.BrowserBack||E.inputIndex===v.BrowserForward?u&&1===H.getInput(E.inputIndex)?this._onPointerDown(E):z&&0===H.getInput(E.inputIndex)&&this._onPointerUp(E):Y&&(E.inputIndex===v.Move?this._onPointerMove(E):E.inputIndex!==v.MouseWheelX&&E.inputIndex!==v.MouseWheelY&&E.inputIndex!==v.MouseWheelZ||this._onPointerMove(E))})):H.deviceType===s.Touch?H.onInputChangedObservable.add((E=>{E.inputIndex===v.LeftClick&&(u&&1===H.getInput(E.inputIndex)?(this._onPointerDown(E),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):z&&0===H.getInput(E.inputIndex)&&(this._onPointerUp(E),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),Y&&E.inputIndex===v.Move&&this._onPointerMove(E)})):H.deviceType===s.Keyboard&&H.onInputChangedObservable.add((z=>{"keydown"===z.type?this._onKeyDown(z):"keyup"===z.type&&this._onKeyUp(z)}))})),this._alreadyAttached=!0}EM(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[u]===z&&(!z||!z._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const E=this._meshUnderPointerId[u];let J;E&&(J=E._getActionManagerForTrigger(10),J&&J.processTrigger(10,new q(E,this._pointerX,this._pointerY,z,H,{pointerId:u}))),z?(this._meshUnderPointerId[u]=z,this._pointerOverMesh=z,J=z._getActionManagerForTrigger(9),J&&J.processTrigger(9,new q(z,this._pointerX,this._pointerY,z,H,{pointerId:u,pickResult:Y}))):(delete this._meshUnderPointerId[u],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:z,pointerId:u})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(z){this._pointerOverMesh===z&&(this._pointerOverMesh=null),this._pickedDownMesh===z&&(this._pickedDownMesh=null),this._pickedUpMesh===z&&(this._pickedUpMesh=null);for(const u in this._meshUnderPointerId)this._meshUnderPointerId[u]===z&&delete this._meshUnderPointerId[u]}}S.DragMovementThreshold=10,S.LongPressDelay=500,S.DoubleClickDelay=300,S.ExclusiveDoubleClickMode=!1;var I=Y(11405),y=Y(11188),a=Y(11291),j=Y(11552),k=Y(10980),P=Y(11204),e=Y(10910);class N{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.gM=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var B,f=Y(10953),r=Y(10918);!function(z){z[z.BackwardCompatible=0]="BackwardCompatible",z[z.Intermediate=1]="Intermediate",z[z.Aggressive=2]="Aggressive"}(B||(B={}));class zz{static DefaultMaterialFactory(z){throw(0,t.e)("TT")}static CollisionCoordinatorFactory(){throw(0,t.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(z){z!==this._clearColor&&(this._clearColor=z,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(z){if(z!==this._performancePriority){switch(this._performancePriority=z,z){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.gM=!1,this.JM=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.gM=!0,this.JM=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.gM=!0,this.JM=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(z)}}set forceWireframe(z){this._forceWireframe!==z&&(this._forceWireframe=z,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(z){this._skipFrustumClipping!==z&&(this._skipFrustumClipping=z)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(z){this._forcePointsCloud!==z&&(this._forcePointsCloud=z,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(z){this._environmentTexture!==z&&(this._environmentTexture=z,this.onEnvironmentTextureChangedObservable.notifyObservers(z),this.markAllMaterialsAsDirty(1))}getNodes(){let z=[];z=z.concat(this.meshes),z=z.concat(this.lights),z=z.concat(this.cameras),z=z.concat(this.transformNodes);for(const u of this.skeletons)z=z.concat(u.bones);return z}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}set onDispose(z){this._onDisposeObserver&&this.fl.remove(this._onDisposeObserver),this._onDisposeObserver=this.fl.add(z)}set beforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),z&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z))}set afterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),z&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(z))}set beforeCameraRender(z){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(z)}set afterCameraRender(z){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(z)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(z){this._pointerPickingConfiguration.pointerDownPredicate=z}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(z){this._pointerPickingConfiguration.pointerUpPredicate=z}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(z){this._pointerPickingConfiguration.pointerMovePredicate=z}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(z){this._pointerPickingConfiguration.pointerDownFastCheck=z}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(z){this._pointerPickingConfiguration.pointerUpFastCheck=z}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(z){this._pointerPickingConfiguration.pointerMoveFastCheck=z}get gM(){return this._pointerPickingConfiguration.gM}set gM(z){this._pointerPickingConfiguration.gM=z}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(z){this._pointerPickingConfiguration.skipPointerDownPicking=z}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(z){this._pointerPickingConfiguration.skipPointerUpPicking=z}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return S.DragMovementThreshold}static set DragMovementThreshold(z){S.DragMovementThreshold=z}static get LongPressDelay(){return S.LongPressDelay}static set LongPressDelay(z){S.LongPressDelay=z}static get DoubleClickDelay(){return S.DoubleClickDelay}static set DoubleClickDelay(z){S.DoubleClickDelay=z}static get ExclusiveDoubleClickMode(){return S.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(z){S.ExclusiveDoubleClickMode=z}bindEyePosition(z){var u;let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(u=this.activeCamera)||void 0===u?void 0:u.globalPosition)??L.p.ZeroReadOnly,J=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return L.i.Vector4[0].set(E.x,E.y,E.z,J?-1:1),z&&(H?z.setFloat3(Y,L.i.Vector4[0].x,L.i.Vector4[0].y,L.i.Vector4[0].z):z.setVector4(Y,L.i.Vector4[0])),L.i.Vector4[0]}finalizeSceneUbo(){const z=this.getSceneUniformBuffer(),u=this.bindEyePosition(null);return z.updateFloat4("vEyePosition",u.x,u.y,u.z,u.w),z.update(),z}set useRightHandedSystem(z){this._useRightHandedSystem!==z&&(this._useRightHandedSystem=z,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(z){this._currentStepId=z}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(z){this._fogEnabled!==z&&(this._fogEnabled=z,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(z){this._fogMode!==z&&(this._fogMode=z,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(z){this._shadowsEnabled!==z&&(this._shadowsEnabled=z,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(z){this._lightsEnabled!==z&&(this._lightsEnabled=z,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(z){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),z&&(this._unObserveActiveCameras=(0,e.h)(z,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=z}get activeCamera(){return this._activeCamera}set activeCamera(z){z!==this._activeCamera&&(this._activeCamera=z,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return zz.DefaultMaterialFactory!==zz._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.Qg||(this.Qg=zz.DefaultMaterialFactory(this)),this.Qg}set defaultMaterial(z){this.Qg=z}set texturesEnabled(z){this._texturesEnabled!==z&&(this._texturesEnabled=z,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(z){if(this._frameGraph)return this._frameGraph=z,void(z||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=z,z&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(z){this._skeletonsEnabled!==z&&(this._skeletonsEnabled=z,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=zz.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const z of this._transientComponents)z.register();this._transientComponents.length=0}}ml(z){this._components.push(z),this._transientComponents.push(z);const u=z;u.addFromContainer&&u.serialize&&this._serializableComponents.push(u)}_getComponent(z){for(const u of this._components)if(u.name===z)return u;return null}get uniqueId(){return this._uniqueId}constructor(z,u){this._inputManager=new S(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.JM=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new y.e(.2,.2,.3,1),this.onClearColorChangedObservable=new J.e,this.ambientColor=new y.c(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new J.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.QM=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.bq=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.fl=new J.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new J.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new J.e,this.onAfterRenderCameraObservable=new J.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new J.e,this.onAfterAnimationsObservable=new J.e,this.onBeforeDrawPhaseObservable=new J.e,this.onAfterDrawPhaseObservable=new J.e,this.onReadyObservable=new J.e,this.onBeforeCameraRenderObservable=new J.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new J.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new J.e,this.onAfterActiveMeshesEvaluationObservable=new J.e,this.onBeforeParticlesRenderingObservable=new J.e,this.onAfterParticlesRenderingObservable=new J.e,this.onDataLoadedObservable=new J.e,this.onNewCameraAddedObservable=new J.e,this.onCameraRemovedObservable=new J.e,this.onNewLightAddedObservable=new J.e,this.onLightRemovedObservable=new J.e,this.onNewGeometryAddedObservable=new J.e,this.onGeometryRemovedObservable=new J.e,this.onNewTransformNodeAddedObservable=new J.e,this.onTransformNodeRemovedObservable=new J.e,this.onNewMeshAddedObservable=new J.e,this.onMeshRemovedObservable=new J.e,this.onNewSkeletonAddedObservable=new J.e,this.onSkeletonRemovedObservable=new J.e,this.onNewMaterialAddedObservable=new J.e,this.onNewMultiMaterialAddedObservable=new J.e,this.onMaterialRemovedObservable=new J.e,this.onMultiMaterialRemovedObservable=new J.e,this.onNewTextureAddedObservable=new J.e,this.onTextureRemovedObservable=new J.e,this.onBeforeRenderTargetsRenderObservable=new J.e,this.onAfterRenderTargetsRenderObservable=new J.e,this.onBeforeStepObservable=new J.e,this.onAfterStepObservable=new J.e,this.onActiveCameraChanged=new J.e,this.onActiveCamerasChanged=new J.e,this.onBeforeRenderingGroupObservable=new J.e,this.onAfterRenderingGroupObservable=new J.e,this.onMeshImportedObservable=new J.e,this.onAnimationFileImportedObservable=new J.e,this.onEnvironmentTextureChangedObservable=new J.e,this.onMeshUnderPointerUpdatedObservable=new J.e,this._registeredForLateAnimationBindings=new l.d(256),this._pointerPickingConfiguration=new N,this.onPrePointerObservable=new J.e,this.onPointerObservable=new J.e,this.onPreKeyboardObservable=new J.e,this.onKeyboardObservable=new J.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=zz.FOGMODE_NONE,this.fogColor=new y.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new L.p(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new l.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new I.d,this._activeIndices=new I.d,this._activeParticles=new I.d,this._activeBones=new I.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new l.h(256),this._processedMaterials=new l.h(256),this._renderTargets=new l.d(256),this._materialsRenderTargets=new l.d(256),this._activeParticleSystems=new l.h(256),this._activeSkeletons=new l.d(32),this._softwareSkinnedMeshes=new l.d(32),this._activeAnimatables=new Array,this._transformMatrix=L.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=h.d.Create(),this._beforeClearStage=h.d.Create(),this._beforeRenderTargetClearStage=h.d.Create(),this._gatherRenderTargetsStage=h.d.Create(),this._gatherActiveCameraRenderTargetsStage=h.d.Create(),this._isReadyForMeshStage=h.d.Create(),this._beforeEvaluateActiveMeshStage=h.d.Create(),this._evaluateSubMeshStage=h.d.Create(),this._preActiveMeshStage=h.d.Create(),this._cameraDrawRenderTargetStage=h.d.Create(),this._beforeCameraDrawStage=h.d.Create(),this._beforeRenderTargetDrawStage=h.d.Create(),this._beforeRenderingGroupDrawStage=h.d.Create(),this._beforeRenderingMeshStage=h.d.Create(),this._afterRenderingMeshStage=h.d.Create(),this._afterRenderingGroupDrawStage=h.d.Create(),this._afterCameraDrawStage=h.d.Create(),this._afterCameraPostProcessStage=h.d.Create(),this._afterRenderTargetDrawStage=h.d.Create(),this._afterRenderTargetPostProcessStage=h.d.Create(),this._afterRenderStage=h.d.Create(),this._pointerMoveStage=h.d.Create(),this._pointerDownStage=h.d.Create(),this._pointerUpStage=h.d.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const Y={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...u};z=this._engine=z||d.d.LastCreatedEngine,Y.virtual?z._virtualScenes.push(this):(d.d._LastCreatedScene=this,z.scenes.push(this)),this._uid=null,this._renderingManager=new K.b(this),C.b&&(this.postProcessManager=new C.b(this)),(0,o.h)()&&this.attachControl(),this._createUbo(),D.e&&(this._imageProcessingConfiguration=new D.e),this.setDefaultCandidateProviders(),Y.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=Y.useMaterialMeshMap,this.useClonedMeshMap=Y.useClonedMeshMap,u&&u.virtual||z.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(z){return this._defaultSubMeshCandidates.data=z.YT,this._defaultSubMeshCandidates.length=z.YT.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=z=>this._getDefaultSubMeshCandidates(z),this.getIntersectingSubMeshCandidates=(z,u)=>this._getDefaultSubMeshCandidates(z),this.getCollidingSubMeshCandidates=(z,u)=>this._getDefaultSubMeshCandidates(z)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(z){this._inputManager.pointerX=z}get pointerY(){return this._inputManager.pointerY}set pointerY(z){this._inputManager.pointerY=z}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(z,u){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==u||this._cachedMaterial!==z||this._cachedVisibility!==Y}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(z,u){return this._inputManager.simulatePointerMove(z,u),this}simulatePointerDown(z,u){return this._inputManager.simulatePointerDown(z,u),this}simulatePointerUp(z,u,Y){return this._inputManager.simulatePointerUp(z,u,Y),this}isPointerCaptured(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(z)}attachControl(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(z,u,Y)}EM(){this._inputManager.EM()}isReady(){var z,u;let Y,H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const E=this.getEngine(),J=E.currentRenderPassId;E.currentRenderPassId=(null===(z=this.activeCamera)||void 0===z?void 0:z.renderPassId)??J;let l=!0;for(this._pendingData.length>0&&(l=!1),null===(u=this.prePassRenderer)||void 0===u||u.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&l&&(l=this.depthPeelingRenderer.isReady()),H&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),Y=0;Y<this.meshes.length;Y++){const z=this.meshes[Y];if(!z.YT||0===z.YT.length)continue;if(!z.isReady(!0)){l=!1;continue}const u=z.hasThinInstances||"InstancedMesh"===z.getClassName()||"InstancedLinesMesh"===z.getClassName()||E.getCaps().instancedArrays&&z.instances.length>0;for(const Y of this._isReadyForMeshStage)Y.action(z,u)||(l=!1);if(!H)continue;const J=z.material||this.defaultMaterial;if(J)if(J._storeEffectOnSubMeshes)for(const Y of z.YT){const z=Y.Oz();z&&z.hasRenderTargetTextures&&null!=z.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(z)&&(this._processedMaterials.push(z),this._materialsRenderTargets.concatWithNoDuplicate(z.getRenderTargetTextures()))}else J.hasRenderTargetTextures&&null!=J.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(J)&&(this._processedMaterials.push(J),this._materialsRenderTargets.concatWithNoDuplicate(J.getRenderTargetTextures()))}if(H)for(Y=0;Y<this._materialsRenderTargets.length;++Y){this._materialsRenderTargets.data[Y].isReadyForRendering()||(l=!1)}for(Y=0;Y<this.geometries.length;Y++){2===this.geometries[Y].delayLoadState&&(l=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const T of this.activeCameras)T.isReady(!0)||(l=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(l=!1));for(const T of this.QM)T.isReady()||(l=!1);if(this.layers)for(const T of this.layers)T.isReady()||(l=!1);if(this.effectLayers)for(const T of this.effectLayers)T.isLayerReady()||(l=!1);return E.areAllEffectsReady()||(l=!1),E.currentRenderPassId=J,l}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(z){this.onBeforeRenderObservable.add(z)}unregisterBeforeRender(z){this.onBeforeRenderObservable.removeCallback(z)}registerAfterRender(z){this.onAfterRenderObservable.add(z)}unregisterAfterRender(z){this.onAfterRenderObservable.removeCallback(z)}_executeOnceBeforeRender(z){const u=()=>{z(),setTimeout((()=>{this.unregisterBeforeRender(u)}))};this.registerBeforeRender(u)}executeOnceBeforeRender(z,u){void 0!==u?setTimeout((()=>{this._executeOnceBeforeRender(z)}),u):this._executeOnceBeforeRender(z)}addPendingData(z){this._pendingData.push(z)}removePendingData(z){const u=this.isLoading,Y=this._pendingData.indexOf(z);-1!==Y&&this._pendingData.splice(Y,1),u&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(z),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(u)}async whenReadyAsync(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((u=>{this.executeWhenReady((()=>{u()}),z)}))}_checkIsReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(z)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(z)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=E.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(z,u,Y,H){Y||H||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===z.updateFlag&&this._projectionUpdateFlag===u.updateFlag||(this._viewUpdateFlag=z.updateFlag,this._projectionUpdateFlag=u.updateFlag,this._viewMatrix=z,this._projectionMatrix=u,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?a.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=a.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(Y,H):this._sceneUbo.useUbo&&(this._sceneUbo.rl("viewProjection",this._transformMatrix),this._sceneUbo.rl("view",this._viewMatrix),this._sceneUbo.rl("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(z){const u=new g.b(this._engine,void 0,!1,z??"Cu");return u.addUniform("viewProjection",16),u.addUniform("view",16),u.addUniform("projection",16),u.addUniform("vEyePosition",4),u}setSceneUniformBuffer(z){this._sceneUbo=z,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return j.b.UniqueId}CD(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(z),z._resyncLightSources(),z.parent||z._addToSceneRootNodes(),H.e.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(z)})),u)){const u=z.getChildMeshes();for(const z of u)this.CD(z)}}qD(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Y=this.meshes.indexOf(z);if(-1!==Y&&(this.meshes.splice(Y,1),z.parent||z._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(z),this.onMeshRemovedObservable.notifyObservers(z),u){const u=z.getChildMeshes();for(const z of u)this.qD(z)}return Y}addTransformNode(z){this._blockEntityCollection||z.iz()===this&&-1!==z._indexInSceneTransformNodesArray||(z._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(z),z.parent||z._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(z))}removeTransformNode(z){const u=z._indexInSceneTransformNodesArray;if(-1!==u){if(u!==this.transformNodes.length-1){const z=this.transformNodes[this.transformNodes.length-1];this.transformNodes[u]=z,z._indexInSceneTransformNodesArray=u}z._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),z.parent||z._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(z),u}removeSkeleton(z){const u=this.skeletons.indexOf(z);return-1!==u&&(this.skeletons.splice(u,1),this.onSkeletonRemovedObservable.notifyObservers(z),this._executeActiveContainerCleanup(this._activeSkeletons)),u}removeMorphTargetManager(z){const u=this.morphTargetManagers.indexOf(z);return-1!==u&&this.morphTargetManagers.splice(u,1),u}removeLight(z){const u=this.lights.indexOf(z);if(-1!==u){for(const u of this.meshes)u._removeLightSource(z,!1);this.lights.splice(u,1),this.sortLightsByPriority(),z.parent||z._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(z),u}removeCamera(z){const u=this.cameras.indexOf(z);if(-1!==u&&(this.cameras.splice(u,1),z.parent||z._removeFromSceneRootNodes()),this.activeCameras){const u=this.activeCameras.indexOf(z);-1!==u&&this.activeCameras.splice(u,1)}return this.activeCamera===z&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(z),u}removeParticleSystem(z){const u=this.QM.indexOf(z);return-1!==u&&(this.QM.splice(u,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),u}removeAnimation(z){const u=this.animations.indexOf(z);return-1!==u&&this.animations.splice(u,1),u}stopAnimation(z,u,Y){}removeAnimationGroup(z){const u=this.animationGroups.indexOf(z);return-1!==u&&this.animationGroups.splice(u,1),u}removeMultiMaterial(z){const u=this.multiMaterials.indexOf(z);return-1!==u&&this.multiMaterials.splice(u,1),this.onMultiMaterialRemovedObservable.notifyObservers(z),u}removeMaterial(z){const u=z._indexInSceneMaterialArray;if(-1!==u&&u<this.materials.length){if(u!==this.materials.length-1){const z=this.materials[this.materials.length-1];this.materials[u]=z,z._indexInSceneMaterialArray=u}z._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(z),u}removeActionManager(z){const u=this.actionManagers.indexOf(z);return-1!==u&&this.actionManagers.splice(u,1),u}removeTexture(z){const u=this.textures.indexOf(z);return-1!==u&&this.textures.splice(u,1),this.onTextureRemovedObservable.notifyObservers(z),u}addLight(z){if(!this._blockEntityCollection){this.lights.push(z),this.sortLightsByPriority(),z.parent||z._addToSceneRootNodes();for(const u of this.meshes)-1===u.lightSources.indexOf(z)&&(u.lightSources.push(z),u._resyncLightSources());H.e.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(z)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(P.d.CompareLightsPriority)}addCamera(z){this._blockEntityCollection||(this.cameras.push(z),H.e.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(z)})),z.parent||z._addToSceneRootNodes())}addSkeleton(z){this._blockEntityCollection||(this.skeletons.push(z),H.e.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(z)})))}addParticleSystem(z){this._blockEntityCollection||this.QM.push(z)}addAnimation(z){this._blockEntityCollection||this.animations.push(z)}addAnimationGroup(z){this._blockEntityCollection||this.animationGroups.push(z)}addMultiMaterial(z){this._blockEntityCollection||(this.multiMaterials.push(z),H.e.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(z)})))}addMaterial(z){this._blockEntityCollection||z.iz()===this&&-1!==z._indexInSceneMaterialArray||(z._indexInSceneMaterialArray=this.materials.length,this.materials.push(z),H.e.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(z)})))}addMorphTargetManager(z){this._blockEntityCollection||this.morphTargetManagers.push(z)}addGeometry(z){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=this.geometries.length),this.geometries.push(z))}addActionManager(z){this.actionManagers.push(z)}addTexture(z){this._blockEntityCollection||(this.textures.push(z),this.onNewTextureAddedObservable.notifyObservers(z))}switchActiveCamera(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.EM(),this.activeCamera=z,u&&z.attachControl())}setActiveCameraById(z){const u=this.getCameraById(z);return u?(this.activeCamera=u,u):null}setActiveCameraByName(z){const u=this.getCameraByName(z);return u?(this.activeCamera=u,u):null}getAnimationGroupByName(z){for(let u=0;u<this.animationGroups.length;u++)if(this.animationGroups[u].name===z)return this.animationGroups[u];return null}_getMaterial(z,u){for(let Y=0;Y<this.materials.length;Y++){const z=this.materials[Y];if(u(z))return z}if(z)for(let Y=0;Y<this.multiMaterials.length;Y++){const z=this.multiMaterials[Y];if(u(z))return z}return null}getMaterialByUniqueID(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(z,u)}getMaterialByUniqueId(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(u,(u=>u.uniqueId===z))}getMaterialById(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(u,(u=>u.id===z))}getMaterialByName(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(u,(u=>u.name===z))}getLastMaterialById(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let Y=this.materials.length-1;Y>=0;Y--)if(this.materials[Y].id===z)return this.materials[Y];if(u)for(let Y=this.multiMaterials.length-1;Y>=0;Y--)if(this.multiMaterials[Y].id===z)return this.multiMaterials[Y];return null}getTextureByUniqueId(z){for(let u=0;u<this.textures.length;u++)if(this.textures[u].uniqueId===z)return this.textures[u];return null}getTextureByName(z){for(let u=0;u<this.textures.length;u++)if(this.textures[u].name===z)return this.textures[u];return null}getCameraById(z){for(let u=0;u<this.cameras.length;u++)if(this.cameras[u].id===z)return this.cameras[u];return null}getCameraByUniqueId(z){for(let u=0;u<this.cameras.length;u++)if(this.cameras[u].uniqueId===z)return this.cameras[u];return null}getCameraByName(z){for(let u=0;u<this.cameras.length;u++)if(this.cameras[u].name===z)return this.cameras[u];return null}getBoneById(z){for(let u=0;u<this.skeletons.length;u++){const Y=this.skeletons[u];for(let u=0;u<Y.bones.length;u++)if(Y.bones[u].id===z)return Y.bones[u]}return null}getBoneByName(z){for(let u=0;u<this.skeletons.length;u++){const Y=this.skeletons[u];for(let u=0;u<Y.bones.length;u++)if(Y.bones[u].name===z)return Y.bones[u]}return null}getLightByName(z){for(let u=0;u<this.lights.length;u++)if(this.lights[u].name===z)return this.lights[u];return null}getLightById(z){for(let u=0;u<this.lights.length;u++)if(this.lights[u].id===z)return this.lights[u];return null}getLightByUniqueId(z){for(let u=0;u<this.lights.length;u++)if(this.lights[u].uniqueId===z)return this.lights[u];return null}getParticleSystemById(z){for(let u=0;u<this.QM.length;u++)if(this.QM[u].id===z)return this.QM[u];return null}getGeometryById(z){for(let u=0;u<this.geometries.length;u++)if(this.geometries[u].id===z)return this.geometries[u];return null}_getGeometryByUniqueId(z){if(this._geometriesByUniqueId){const u=this._geometriesByUniqueId[z];if(void 0!==u)return this.geometries[u]}else for(let u=0;u<this.geometries.length;u++)if(this.geometries[u].uniqueId===z)return this.geometries[u];return null}getFrameGraphByName(z){for(let u=0;u<this.frameGraphs.length;u++)if(this.frameGraphs[u].name===z)return this.frameGraphs[u];return null}pushGeometry(z,u){return!(!u&&this._getGeometryByUniqueId(z.uniqueId))&&(this.addGeometry(z),H.e.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(z)})),!0)}removeGeometry(z){let u;if(this._geometriesByUniqueId){if(u=this._geometriesByUniqueId[z.uniqueId],void 0===u)return!1}else if(u=this.geometries.indexOf(z),u<0)return!1;if(u!==this.geometries.length-1){const z=this.geometries[this.geometries.length-1];z&&(this.geometries[u]=z,this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=u))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(z),!0}getGeometries(){return this.geometries}getMeshById(z){for(let u=0;u<this.meshes.length;u++)if(this.meshes[u].id===z)return this.meshes[u];return null}getMeshesById(z){return this.meshes.filter((function(u){return u.id===z}))}getTransformNodeById(z){for(let u=0;u<this.transformNodes.length;u++)if(this.transformNodes[u].id===z)return this.transformNodes[u];return null}getTransformNodeByUniqueId(z){for(let u=0;u<this.transformNodes.length;u++)if(this.transformNodes[u].uniqueId===z)return this.transformNodes[u];return null}getTransformNodesById(z){return this.transformNodes.filter((function(u){return u.id===z}))}getMeshByUniqueId(z){for(let u=0;u<this.meshes.length;u++)if(this.meshes[u].uniqueId===z)return this.meshes[u];return null}getLastMeshById(z){for(let u=this.meshes.length-1;u>=0;u--)if(this.meshes[u].id===z)return this.meshes[u];return null}getLastTransformNodeById(z){for(let u=this.transformNodes.length-1;u>=0;u--)if(this.transformNodes[u].id===z)return this.transformNodes[u];return null}getLastEntryById(z){let u;for(u=this.meshes.length-1;u>=0;u--)if(this.meshes[u].id===z)return this.meshes[u];for(u=this.transformNodes.length-1;u>=0;u--)if(this.transformNodes[u].id===z)return this.transformNodes[u];for(u=this.cameras.length-1;u>=0;u--)if(this.cameras[u].id===z)return this.cameras[u];for(u=this.lights.length-1;u>=0;u--)if(this.lights[u].id===z)return this.lights[u];return null}getNodeById(z){const u=this.getMeshById(z);if(u)return u;const Y=this.getTransformNodeById(z);if(Y)return Y;const H=this.getLightById(z);if(H)return H;const E=this.getCameraById(z);if(E)return E;const J=this.getBoneById(z);return J||null}getNodeByName(z){const u=this.getMeshByName(z);if(u)return u;const Y=this.getTransformNodeByName(z);if(Y)return Y;const H=this.getLightByName(z);if(H)return H;const E=this.getCameraByName(z);if(E)return E;const J=this.getBoneByName(z);return J||null}getMeshByName(z){for(let u=0;u<this.meshes.length;u++)if(this.meshes[u].name===z)return this.meshes[u];return null}getTransformNodeByName(z){for(let u=0;u<this.transformNodes.length;u++)if(this.transformNodes[u].name===z)return this.transformNodes[u];return null}getLastSkeletonById(z){for(let u=this.skeletons.length-1;u>=0;u--)if(this.skeletons[u].id===z)return this.skeletons[u];return null}getSkeletonByUniqueId(z){for(let u=0;u<this.skeletons.length;u++)if(this.skeletons[u].uniqueId===z)return this.skeletons[u];return null}getSkeletonById(z){for(let u=0;u<this.skeletons.length;u++)if(this.skeletons[u].id===z)return this.skeletons[u];return null}getSkeletonByName(z){for(let u=0;u<this.skeletons.length;u++)if(this.skeletons[u].name===z)return this.skeletons[u];return null}getMorphTargetManagerById(z){for(let u=0;u<this.morphTargetManagers.length;u++)if(this.morphTargetManagers[u].uniqueId===z)return this.morphTargetManagers[u];return null}getMorphTargetById(z){for(let u=0;u<this.morphTargetManagers.length;++u){const Y=this.morphTargetManagers[u];for(let u=0;u<Y.numTargets;++u){const H=Y.getTarget(u);if(H.id===z)return H}}return null}getMorphTargetByName(z){for(let u=0;u<this.morphTargetManagers.length;++u){const Y=this.morphTargetManagers[u];for(let u=0;u<Y.numTargets;++u){const H=Y.getTarget(u);if(H.name===z)return H}}return null}getPostProcessByName(z){for(let u=0;u<this.postProcesses.length;++u){const Y=this.postProcesses[u];if(Y.name===z)return Y}return null}isActiveMesh(z){return-1!==this._activeMeshes.indexOf(z)}get uid(){return this._uid||(this._uid=H.e.RandomId()),this._uid}addExternalData(z,u){return this._externalData||(this._externalData=new T),this._externalData.add(z,u)}getExternalData(z){return this._externalData?this._externalData.get(z):null}getOrAddExternalDataWithFactory(z,u){return this._externalData||(this._externalData=new T),this._externalData.getOrAddWithFactory(z,u)}removeExternalData(z){return this._externalData.remove(z)}_evaluateSubMesh(z,u,Y,H){if(H||z.isInFrustum(this._frustumPlanes)){for(const H of this._evaluateSubMeshStage)H.action(u,z);const Y=z.Oz();null!==Y&&void 0!==Y&&(Y.hasRenderTargetTextures&&null!=Y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Y)&&(this._processedMaterials.push(Y),this._materialsRenderTargets.concatWithNoDuplicate(Y.getRenderTargetTextures())),this._renderingManager.dispatch(z,u,Y))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(z){this._preventFreeActiveMeshesAndRenderingGroups!==z&&(z&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=z)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let z=0;z<this.activeCameras.length;z++){const u=this.activeCameras[z];u&&u._activeMeshes&&u._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let z=0;z<this.textures.length;z++){const u=this.textures[z];u&&u.renderList&&u.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=E,this._skipEvaluateActiveMeshesCompletely=z,H)for(let z=0;z<this._activeMeshes.length;z++)this._activeMeshes.data[z]._freeze();u&&u()}else Y&&Y("No active camera found")})),this}unfreezeActiveMeshes(){for(let z=0;z<this.meshes.length;z++){const u=this.meshes[z];u._internalAbstractMeshDataInfo&&(u._internalAbstractMeshDataInfo._isActive=!1)}for(let z=0;z<this._activeMeshes.length;z++)this._activeMeshes.data[z]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(z){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>z.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var z;if(this._activeMeshes.length>0)null===(z=this.activeCamera)||void 0===z||z._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const z=this._activeMeshes.length;for(let u=0;u<z;u++){this._activeMeshes.data[u].pl()}}if(this._activeParticleSystems){const z=this._activeParticleSystems.length;for(let u=0;u<z;u++)this._activeParticleSystems.data[u].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const H of this._beforeEvaluateActiveMeshStage)H.action();const u=this.getActiveMeshCandidates(),Y=u.length;for(let H=0;H<Y;H++){const z=u.data[H];let Y=z._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(Y?Y[1]=-1:(Y=[z,-1],z._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,Y)),z.isBlocked)continue;if(this._totalVertices.addCount(z.getTotalVertices(),!1),!z.isReady()||!z.isEnabled()||z.el.hasAZeroComponent)continue;z.pl(),z.actionManager&&z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(z);let E=this.customLODSelector?this.customLODSelector(z,this.activeCamera):z.getLOD(this.activeCamera);if(Y[0]=E,Y[1]=this._frameId,void 0!==E&&null!==E&&(E!==z&&0!==E.billboardMode&&E.pl(),z._preActivate(),z.isVisible&&z.visibility>0&&0!==(z.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||z.qT||z.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(z),this.activeCamera._activeMeshes.push(z),E!==z&&E._activate(this._renderId,!1);for(const u of this._preActiveMeshStage)u.action(z);z._activate(this._renderId,!1)&&(z.isAnInstance?z._internalAbstractMeshDataInfo._actAsRegularMesh&&(E=z):E._internalAbstractMeshDataInfo._onlyForInstances=!1,E._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(z,E)),z._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let z=0;z<this.QM.length;z++){const u=this.QM[z];if(!u.isStarted()||!u.k)continue;const Y=u.k;Y.position&&!Y.isEnabled()||(this._activeParticleSystems.push(u),u.animate(),this._renderingManager.dispatchParticles(u))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(z){this._skeletonsEnabled&&z.skeleton&&(this._activeSkeletons.pushNoDuplicate(z.skeleton)&&(z.skeleton.prepare(),this._activeBones.addCount(z.skeleton.bones.length,!1)),z.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(z)&&this.frameGraph&&z.applySkeleton(z.skeleton))}_activeMesh(z,u){this._prepareSkeleton(u);let Y=z.hasInstances||z.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||u.qT;if(u&&u.YT&&u.YT.length>0){const H=this.getActiveSubMeshCandidates(u),E=H.length;Y=Y||1===E;for(let J=0;J<E;J++){const E=H.data[J];this._evaluateSubMesh(E,u,z,Y)}}}updateTransformMatrix(z){const u=this.activeCamera;if(u)if(u._renderingMultiview){const Y=u._rigCameras[0],H=u._rigCameras[1];this.setTransformMatrix(Y.getViewMatrix(),Y.getProjectionMatrix(z),H.getViewMatrix(),H.getProjectionMatrix(z))}else this.setTransformMatrix(u.getViewMatrix(),u.getProjectionMatrix(z))}_bindFrameBuffer(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(z&&z._multiviewTexture?z._multiviewTexture._bindFrameBuffer():z&&z.outputRenderTarget?z.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),u&&this._clearFrameBuffer(z)}_clearFrameBuffer(z){if(z&&z._multiviewTexture);else if(z&&z.outputRenderTarget&&!z._renderingMultiview){const u=z.outputRenderTarget;u.onClearObservable.hasObservers()?u.onClearObservable.notifyObservers(this._engine):u.skipInitialClear||z.isRightCamera||(this.JM&&this._engine.clear(u.clearColor||this._clearColor,!u._cleared,!0,!0),u._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(z,u){var Y;let E=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(z&&z._skipRendering)return;const J=this._engine;if(this._activeCamera=z,!this.activeCamera)throw new Error("Active camera not set");if(J.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&E){let u=!0;z._renderingMultiview&&z.outputRenderTarget&&(u=z.outputRenderTarget.skipInitialClear,this.JM&&(this._defaultFrameBufferCleared=!1,z.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),z._renderingMultiview&&z.outputRenderTarget&&(z.outputRenderTarget.skipInitialClear=u)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let H=0;H<this._softwareSkinnedMeshes.length;H++){const z=this._softwareSkinnedMeshes.data[H];z.applySkeleton(z.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),z.customRenderTargets&&z.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(z.customRenderTargets),u&&u.customRenderTargets&&u.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(u.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const H of this._gatherActiveCameraRenderTargetsStage)H.action(this._renderTargets);let l=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){H.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let z=0;z<this._renderTargets.length;z++){const u=this._renderTargets.data[z];if(u._shouldRender()){this._renderId++;const z=u.activeCamera&&u.activeCamera!==this.activeCamera;u.render(z,this.dumpNextRenderTargets),l=!0}}H.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const z of this._cameraDrawRenderTargetStage)l=z.action(this.activeCamera)||l;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(Y=z.outputRenderTarget)||void 0===Y?void 0:Y.renderPassId)??z.renderPassId??0,l&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||z._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const H of this._beforeCameraDrawStage)H.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),J.snapshotRendering&&1===J.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const H of this._afterCameraDrawStage)H.action(this.activeCamera);if(this.postProcessManager&&!z._multiviewTexture){const u=z.outputRenderTarget?z.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(z.isIntermediate,u)}for(const H of this._afterCameraPostProcessStage)H.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===z.cameraRigMode||z._renderingMultiview)return z._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(z,void 0,u),void this.onAfterRenderCameraObservable.notifyObservers(z);if(z._useMultiviewToSingleView)this._renderMultiviewToSingleView(z);else{this.onBeforeCameraRenderObservable.notifyObservers(z);for(let u=0;u<z._rigCameras.length;u++)this._renderForCamera(z._rigCameras[u],z)}this._activeCamera=z,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(z)}_checkIntersections(){for(let z=0;z<this._meshesForIntersections.length;z++){const u=this._meshesForIntersections.data[z];if(u.actionManager)for(let z=0;u.actionManager&&z<u.actionManager.actions.length;z++){const Y=u.actionManager.actions[z];if(12===Y.trigger||13===Y.trigger){const z=Y.getTriggerParameter(),H=z.mesh?z.mesh:z,E=H.intersectsMesh(u,z.usePreciseIntersection),J=u._intersectionsInProgress.indexOf(H);E&&-1===J?12===Y.trigger?(Y._executeCurrent(q.CreateNew(u,void 0,H)),u._intersectionsInProgress.push(H)):13===Y.trigger&&u._intersectionsInProgress.push(H):!E&&J>-1&&(13===Y.trigger&&Y._executeCurrent(q.CreateNew(u,void 0,H)),u.actionManager.hasSpecificTrigger(13,(z=>{const u=z.mesh?z.mesh:z;return H===u}))&&13!==Y.trigger||u._intersectionsInProgress.splice(J,1))}}}}_advancePhysicsEngineStep(z){}_animate(z){}animate(){if(this._engine.isDeterministicLockStep()){let z=Math.max(zz.MinDeltaTime,Math.min(this._engine.getDeltaTime(),zz.MaxDeltaTime))+this._timeAccumulator;const u=this._engine.getTimeStep(),Y=1e3/u/1e3;let H=0;const E=this._engine.getLockstepMaxSteps();let J=Math.floor(z/u);for(J=Math.min(J,E);z>0&&H<J;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=u*Y,this._animate(u),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(u),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,H++,z-=u;this._timeAccumulator=z<0?0:z}else{const z=this.useConstantAnimationDeltaTime?16:Math.max(zz.MinDeltaTime,Math.min(this._engine.getDeltaTime(),zz.MaxDeltaTime));this._animationRatio=.06*z,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(z)}}_clear(){(this.autoClearDepthAndStencil||this.JM)&&this._engine.clear(this._clearColor,this.JM||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(z){var u;if(null===z||void 0===z||!z.outputRenderTarget||null!==z&&void 0!==z&&z.isRigCamera||(z.outputRenderTarget._cleared=!1),null!==z&&void 0!==z&&null!==(u=z.rigCameras)&&void 0!==u&&u.length)for(let Y=0;Y<z.rigCameras.length;++Y){const u=z.rigCameras[Y].outputRenderTarget;u&&(u._cleared=!1)}}resetDrawCache(z){if(this.meshes)for(const u of this.meshes)u.resetDrawCache(z)}_renderWithFrameGraph(){var z;let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),u)for(const E of this.cameras)if(E.update(),0!==E.cameraRigMode)for(let z=0;z<E._rigCameras.length;z++)E._rigCameras[z].update();this.onBeforeRenderObservable.notifyObservers(this);for(const E of this._beforeClearStage)E.action();const Y=this.getActiveMeshCandidates(),H=Y.length;for(let E=0;E<H;E++){const z=Y.data[E];z.isBlocked||(this._totalVertices.addCount(z.getTotalVertices(),!1),z.isReady()&&z.isEnabled()&&!z.el.hasAZeroComponent&&(z.pl(),z.actionManager&&z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(z)))}if(this.particlesEnabled)for(let E=0;E<this.QM.length;E++){const z=this.QM[E];if(!z.isStarted()||!z.k)continue;const u=z.k;u.position&&!u.isEnabled()||(this._activeParticleSystems.push(z),z.animate())}null===(z=this.frameGraph)||void 0===z||z.execute()}_renderRenderTarget(z,u){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,z._shouldRender()){if(this._renderId++,this.activeCamera=u,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),z.render(Y,H)}this._intermediateRendering=!1}render(){var z;let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.L){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(z=this.activeCameras)&&void 0!==z&&z.length)for(const z of this.activeCameras)this._checkCameraRenderTarget(z);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),Y||this.animate();for(const z of this._beforeCameraUpdateStage)z.action();if(u)if(this.activeCameras&&this.activeCameras.length>0)for(let z=0;z<this.activeCameras.length;z++){const u=this.activeCameras[z];if(u.update(),0!==u.cameraRigMode)for(let z=0;z<u._rigCameras.length;z++)u._rigCameras[z].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let z=0;z<this.activeCamera._rigCameras.length;z++)this.activeCamera._rigCameras[z].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(u,Y);else{var E;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const z=null!==(E=this.activeCameras)&&void 0!==E&&E.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){H.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let u=0;u<this.customRenderTargets.length;u++){const Y=this.customRenderTargets[u],H=Y.activeCamera||this.activeCamera;this._renderRenderTarget(Y,H,z!==H,this.dumpNextRenderTargets)}H.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===z||void 0===z?void 0:z.renderPassId)??0,this.activeCamera=z,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const u of this._beforeClearStage)u.action();this._clearFrameBuffer(this.activeCamera);for(const u of this._gatherRenderTargetsStage)u.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let u=0;u<this.activeCameras.length;u++)this._processSubCameras(this.activeCameras[u],u>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const z of this._afterRenderStage)z.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let z=0;z<this._toBeDisposed.length;z++){const u=this._toBeDisposed[z];u&&u.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let z=0;z<this.materials.length;z++)this.materials[z].freeze()}unfreezeMaterials(){for(let z=0;z<this.materials.length;z++)this.materials[z].unfreeze()}dispose(){if(this.L)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const z of this._activeAnimatables)z.onAnimationEndObservable.clear(),z.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const z=this._activeRequests.slice();for(const E of z)E.abort();this._activeRequests.length=0;try{this.fl.notifyObservers(this)}catch(H){f.b.Error("An error occurred while calling onDisposeObservable!",H)}this.EM();if(this._engine.getInputElement())for(let E=0;E<this.cameras.length;E++)this.cameras[E].EM();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.Qg&&this.Qg.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(z=>z.dispose(!0))),this._disposeList(this.transformNodes,(z=>z.dispose(!0)));const u=this.cameras;this._disposeList(u),this._disposeList(this.QM),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let Y=this._engine.scenes.indexOf(this);if(Y>-1&&this._engine.scenes.splice(Y,1),d.d._LastCreatedScene===this){d.d._LastCreatedScene=null;let z=d.d.Instances.length-1;for(;z>=0;){const u=d.d.Instances[z];if(u.scenes.length>0){d.d._LastCreatedScene=u.scenes[this._engine.scenes.length-1];break}z--}}Y=this._engine._virtualScenes.indexOf(this),Y>-1&&this._engine._virtualScenes.splice(Y,1),this._engine.wipeCaches(!0),this.fl.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(z,u){const Y=z.slice(0);u=u??(z=>z.dispose());for(const H of Y)u(H);z.length=0}get L(){return this._isDisposed}clearCachedVertexData(){for(let z=0;z<this.meshes.length;z++){const u=this.meshes[z].Sl;u&&u.clearCachedData()}}cleanCachedTextureBuffer(){for(const z of this.textures){z._buffer&&(z._buffer=null)}}getWorldExtends(z){const u=new L.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Y=new L.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);z=z||(()=>!0);const H=this.meshes.filter(z);for(const E of H){if(E.pl(!0),!E.YT||0===E.YT.length||E.infiniteDistance)continue;const z=E.getBoundingInfo(),H=z.boundingBox.minimumWorld,J=z.boundingBox.maximumWorld;L.p.CheckExtends(H,u,Y),L.p.CheckExtends(J,u,Y)}return{min:u,max:Y}}createPickingRay(z,u,Y,H){throw(0,t.e)("Ray")}createPickingRayToRef(z,u,Y,H,E){throw(0,t.e)("Ray")}createPickingRayInCameraSpace(z,u,Y){throw(0,t.e)("Ray")}createPickingRayInCameraSpaceToRef(z,u,Y,H){throw(0,t.e)("Ray")}EY(z,u,Y,H,E,J){const l=(0,t.e)("Ray",!0);return l&&f.b.Warn(l),new M.e}pickWithBoundingInfo(z,u,Y,H,E){const J=(0,t.e)("Ray",!0);return J&&f.b.Warn(J),new M.e}pickWithRay(z,u,Y,H){throw(0,t.e)("Ray")}multiPick(z,u,Y,H,E){throw(0,t.e)("Ray")}multiPickWithRay(z,u,Y){throw(0,t.e)("Ray")}setPointerOverMesh(z,u,Y){this._inputManager.setPointerOverMesh(z,u,Y)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const z of this.geometries)z._rebuild();for(const z of this.meshes)z._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const z of this._components)z.rebuild();for(const z of this.QM)z.rebuild();if(this.spriteManagers)for(const z of this.spriteManagers)z.rebuild()}_rebuildTextures(){for(const z of this.textures)z._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(z,u,Y){if(void 0===u)return z;const H=[];for(const E in z){const J=z[E];b.e&&b.e.MatchesQuery(J,u)&&(!Y||Y(J))&&H.push(J)}return H}getMeshesByTags(z,u){return this._getByTags(this.meshes,z,u)}getCamerasByTags(z,u){return this._getByTags(this.cameras,z,u)}getLightsByTags(z,u){return this._getByTags(this.lights,z,u)}getMaterialByTags(z,u){return this._getByTags(this.materials,z,u).concat(this._getByTags(this.multiMaterials,z,u))}getTransformNodesByTags(z,u){return this._getByTags(this.transformNodes,z,u)}setRenderingOrder(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(z,u,Y,H)}setRenderingAutoClearDepthStencil(z,u){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(z,u,Y,H)}getAutoClearDepthStencilSetup(z){return this._renderingManager.getAutoClearDepthStencilSetup(z)}_forceBlockMaterialDirtyMechanism(z){this._blockMaterialDirtyMechanism=z}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(z){this._blockMaterialDirtyMechanism!==z&&(this._blockMaterialDirtyMechanism=z,z||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(z,u){if(!this._blockMaterialDirtyMechanism)for(const Y of this.materials)u&&!u(Y)||Y.uD(z)}_loadFile(z,u,Y,H,E,J,l){const T=(0,k.p)(z,u,Y,H?this.offlineProvider:void 0,E,J,l);return this._activeRequests.push(T),T.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),T}async _loadFileAsync(z,u,Y,H,E){return await new Promise(((J,l)=>{this._loadFile(z,(z=>{J(z)}),u,Y,H,((z,u)=>{l(u)}),E)}))}_requestFile(z,u,Y,H,E,J,l){const T=(0,k.v)(z,u,Y,H?this.offlineProvider:void 0,E,J,l);return this._activeRequests.push(T),T.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),T}async _requestFileAsync(z,u,Y,H,E){return await new Promise(((J,l)=>{this._requestFile(z,(z=>{J(z)}),u,Y,H,(z=>{l(z)}),E)}))}_readFile(z,u,Y,H,E){const J=(0,k.t)(z,u,Y,H,E);return this._activeRequests.push(J),J.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),J}async _readFileAsync(z,u,Y){return await new Promise(((H,E)=>{this._readFile(z,(z=>{H(z)}),u,Y,(z=>{E(z)}))}))}getPerfCollector(){throw(0,t.e)("performanceViewerSceneExtension")}setActiveCameraByID(z){return this.setActiveCameraById(z)}getMaterialByID(z){return this.getMaterialById(z)}getLastMaterialByID(z){return this.getLastMaterialById(z)}getTextureByUniqueID(z){return this.getTextureByUniqueId(z)}getCameraByID(z){return this.getCameraById(z)}getCameraByUniqueID(z){return this.getCameraByUniqueId(z)}getBoneByID(z){return this.getBoneById(z)}getLightByID(z){return this.getLightById(z)}getLightByUniqueID(z){return this.getLightByUniqueId(z)}getParticleSystemByID(z){return this.getParticleSystemById(z)}getGeometryByID(z){return this.getGeometryById(z)}getMeshByID(z){return this.getMeshById(z)}getMeshByUniqueID(z){return this.getMeshByUniqueId(z)}getLastMeshByID(z){return this.getLastMeshById(z)}getMeshesByID(z){return this.getMeshesById(z)}getTransformNodeByID(z){return this.getTransformNodeById(z)}getTransformNodeByUniqueID(z){return this.getTransformNodeByUniqueId(z)}getTransformNodesByID(z){return this.getTransformNodesById(z)}getNodeByID(z){return this.getNodeById(z)}getLastEntryByID(z){return this.getLastEntryById(z)}getLastSkeletonByID(z){return this.getLastSkeletonById(z)}}zz.FOGMODE_NONE=0,zz.FOGMODE_EXP=1,zz.FOGMODE_EXP2=2,zz.FOGMODE_LINEAR=3,zz.MinDeltaTime=1,zz.MaxDeltaTime=1e3,zz._OriginalDefaultMaterialFactory=zz.DefaultMaterialFactory,(0,r.d)("BABYLON.Scene",zz)},11320:(z,u,Y)=>{Y.d(u,{c:()=>H,d:()=>E});class H{}H.NAME_EFFECTLAYER="EffectLayer",H.NAME_LAYER="Layer",H.NAME_LENSFLARESYSTEM="LensFlareSystem",H.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",H.NAME_PARTICLESYSTEM="Yb",H.NAME_GAMEPAD="Gamepad",H.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",H.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",H.NAME_PREPASSRENDERER="PrePassRenderer",H.NAME_DEPTHRENDERER="DepthRenderer",H.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",H.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",H.NAME_SPRITE="Sprite",H.NAME_SUBSURFACE="SubSurface",H.NAME_OUTLINERENDERER="Outline",H.NAME_PROCEDURALTEXTURE="ProceduralTexture",H.NAME_SHADOWGENERATOR="ShadowGenerator",H.NAME_OCTREE="Hb",H.NAME_PHYSICSENGINE="PhysicsEngine",H.NAME_AUDIO="Audio",H.NAME_FLUIDRENDERER="FluidRenderer",H.NAME_IBLCDFGENERATOR="iblCDFGenerator",H.STEP_ISREADYFORMESH_EFFECTLAYER=0,H.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,H.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,H.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,H.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,H.STEP_BEFORECAMERADRAW_PREPASS=0,H.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,H.STEP_BEFORECAMERADRAW_LAYER=2,H.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,H.STEP_BEFORERENDERTARGETDRAW_LAYER=1,H.STEP_BEFORERENDERINGMESH_PREPASS=0,H.STEP_BEFORERENDERINGMESH_OUTLINE=1,H.STEP_AFTERRENDERINGMESH_PREPASS=0,H.STEP_AFTERRENDERINGMESH_OUTLINE=1,H.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,H.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,H.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,H.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,H.STEP_BEFORECLEAR_PREPASS=1,H.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,H.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,H.STEP_AFTERRENDERTARGETDRAW_LAYER=1,H.STEP_AFTERCAMERADRAW_PREPASS=0,H.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,H.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,H.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,H.STEP_AFTERCAMERADRAW_LAYER=4,H.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,H.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,H.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,H.STEP_AFTERRENDER_AUDIO=0,H.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,H.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,H.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,H.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,H.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,H.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,H.STEP_POINTERMOVE_SPRITE=0,H.STEP_POINTERDOWN_SPRITE=0,H.STEP_POINTERUP_SPRITE=0;class E extends Array{constructor(z){super(...z)}static Create(){return Object.create(E.prototype)}registerStep(z,u,Y){let H=0,E=Number.MAX_VALUE;for(;H<this.length;H++){if(E=this[H].index,z<E)break}this.splice(H,0,{index:z,component:u,action:Y.bind(u)})}clear(){this.length=0}}},11079:(z,u,Y)=>{Y.d(u,{e:()=>H});function H(z,u,Y,H){var E,J=arguments.length,l=J<3?u:null===H?H=Object.getOwnPropertyDescriptor(u,Y):H;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)l=Reflect.decorate(z,u,Y,H);else for(var T=z.length-1;T>=0;T--)(E=z[T])&&(l=(J<3?E(l):J>3?E(u,Y,l):E(u,Y))||l);return J>3&&l&&Object.defineProperty(u,Y,l),l}Object.create;Object.create}}]);