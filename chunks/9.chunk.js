"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[9],{11724:(C,U,K)=>{K.d(U,{b:()=>T,f:()=>H,j:()=>d,i:()=>G,n:()=>J});class m{constructor(){this.children=[]}isValid(C){return!0}process(C,U,K){let m="";if(this.line){let K=this.line;const j=U.processor;if(j){var O,X,A,e,t,z;j.lineProcessor&&(K=j.lineProcessor(K,U.isFragment,U.processingContext));const m=(null===(O=U.processor)||void 0===O?void 0:O.attributeKeywordName)??"attribute",p=U.isFragment&&null!==(X=U.processor)&&void 0!==X&&X.varyingFragmentKeywordName?null===(A=U.processor)||void 0===A?void 0:A.varyingFragmentKeywordName:!U.isFragment&&null!==(e=U.processor)&&void 0!==e&&e.varyingVertexKeywordName?null===(t=U.processor)||void 0===t?void 0:t.varyingVertexKeywordName:"varying";if(!U.isFragment&&j.attributeProcessor&&this.line.startsWith(m))K=j.attributeProcessor(this.line,C,U.processingContext);else if(j.varyingProcessor&&(null!==(z=j.varyingCheck)&&void 0!==z&&z.call(j,this.line,U.isFragment)||!j.varyingCheck&&this.line.startsWith(p)))K=j.varyingProcessor(this.line,U.isFragment,C,U.processingContext);else if(j.uniformProcessor&&j.uniformRegexp&&j.uniformRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(K=j.uniformProcessor(this.line,U.isFragment,C,U.processingContext));else if(j.uniformBufferProcessor&&j.uniformBufferRegexp&&j.uniformBufferRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(K=j.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0);else if(j.textureProcessor&&j.textureRegexp&&j.textureRegexp.test(this.line))K=j.textureProcessor(this.line,U.isFragment,C,U.processingContext);else if((j.uniformProcessor||j.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!U.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?j.uniformProcessor&&(K=j.uniformProcessor(this.line,U.isFragment,C,U.processingContext)):j.uniformBufferProcessor&&(K=j.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0)}U.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(U.lookForClosingBracketForUniformBuffer=!1,j.endOfUniformBufferProcessor&&(K=j.endOfUniformBufferProcessor(this.line,U.isFragment,U.processingContext)))}m+=K+"\n"}for(const j of this.children)m+=j.process(C,U,K);return this.additionalDefineKey&&(C[this.additionalDefineKey]=this.additionalDefineValue||"true",K[this.additionalDefineKey]=C[this.additionalDefineKey]),m}}class O{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(C){this._lines.length=0;for(const U of C){if(!U||"\r"===U)continue;if("#"===U[0]){this._lines.push(U);continue}const C=U.trim();if(!C)continue;if(C.startsWith("//")){this._lines.push(U);continue}const K=C.indexOf(";");if(-1===K)this._lines.push(C);else if(K===C.length-1)C.length>1&&this._lines.push(C);else{const C=U.split(";");for(let U=0;U<C.length;U++){let K=C[U];K&&(K=K.trim(),K&&this._lines.push(K+(U!==C.length-1?";":"")))}}}}}class X extends m{process(C,U,K){for(let m=0;m<this.children.length;m++){const O=this.children[m];if(O.isValid(C))return O.process(C,U,K)}return""}}class A extends m{isValid(C){return this.testExpression.isTrue(C)}}class e{isTrue(C){return!0}static postfixToInfix(C){const U=[];for(const K of C)if(void 0===e._OperatorPriority[K])U.push(K);else{const C=U[U.length-1],m=U[U.length-2];U.length-=2,U.push(`(${m}${K}${C})`)}return U[U.length-1]}static infixToPostfix(C){const U=e._InfixToPostfixCache.get(C);if(U)return U.accessTime=Date.now(),U.result;if(!C.includes("&&")&&!C.includes("||")&&!C.includes(")")&&!C.includes("("))return[C];const K=[];let m=-1;const O=()=>{j=j.trim(),""!==j&&(K.push(j),j="")},X=C=>{m<e._Stack.length-1&&(e._Stack[++m]=C)},A=()=>e._Stack[m],t=()=>-1===m?"!!INVALID EXPRESSION!!":e._Stack[m--];let z=0,j="";for(;z<C.length;){const U=C.charAt(z),p=z<C.length-1?C.substring(z,2+z):"";if("("===U)j="",X(U);else if(")"===U){for(O();-1!==m&&"("!==A();)K.push(t());t()}else if(e._OperatorPriority[p]>1){for(O();-1!==m&&e._OperatorPriority[A()]>=e._OperatorPriority[p];)K.push(t());X(p),z++}else j+=U;z++}for(O();-1!==m;)"("===A()?t():K.push(t());return e._InfixToPostfixCache.size>=e.InfixToPostfixCacheLimitSize&&e.ClearCache(),e._InfixToPostfixCache.set(C,{result:K,accessTime:Date.now()}),K}static ClearCache(){const C=Array.from(e._InfixToPostfixCache.entries()).sort(((C,U)=>C[1].accessTime-U[1].accessTime));for(let U=0;U<e.InfixToPostfixCacheCleanupSize;U++)e._InfixToPostfixCache.delete(C[U][0])}}e.InfixToPostfixCacheLimitSize=5e4,e.InfixToPostfixCacheCleanupSize=25e3,e._InfixToPostfixCache=new Map,e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""];class t extends e{constructor(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=C,this.not=U}isTrue(C){let U=void 0!==C[this.define];return this.not&&(U=!U),U}}class z extends e{isTrue(C){return this.leftOperand.isTrue(C)||this.rightOperand.isTrue(C)}}class j extends e{isTrue(C){return this.leftOperand.isTrue(C)&&this.rightOperand.isTrue(C)}}class p extends e{constructor(C,U,K){super(),this.define=C,this.operand=U,this.testValue=K}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(C){let U=!1;const K=parseInt(void 0!=C[this.define]?C[this.define]:this.define),m=parseInt(void 0!=C[this.testValue]?C[this.testValue]:this.testValue);if(isNaN(K)||isNaN(m))return!1;switch(this.operand){case">":U=K>m;break;case"<":U=K<m;break;case"<=":U=K<=m;break;case">=":U=K>=m;break;case"==":U=K===m;break;case"!=":U=K!==m}return U}}var E=K(11696),u=K(11726);const b=/defined\s*?\((.+?)\)/g,v=/defined\s*?\[(.+?)\]/g,Q=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,V=/__decl__/,f=/light\{X\}.(\w*)/g,F=/\{X\}/g,Z=[],P=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function H(C){C.processor&&C.processor.initializeShaders&&C.processor.initializeShaders(C.processingContext)}function d(C,U,K,m){var O;null!==(O=U.processor)&&void 0!==O&&O.preProcessShaderCode&&(C=U.processor.preProcessShaderCode(C,U.isFragment)),G(C,U,(C=>{U.processCodeAfterIncludes&&(C=U.processCodeAfterIncludes(U.isFragment?"fragment":"vertex",C,U.defines));const O=function(C,U,K){let m=function(C,U){var K;if(null!==(K=U.processor)&&void 0!==K&&K.noPrecision)return C;const m=U.shouldUseHighPrecisionShader;-1===C.indexOf("precision highp float")?C=m?"precision highp float;\n"+C:"precision mediump float;\n"+C:m||(C=C.replace("precision highp float","precision mediump float"));return C}(C,U);if(!U.processor)return m;if(0===U.processor.shaderLanguage&&-1!==m.indexOf("#version 3")&&(m=m.replace("#version 300 es",""),!U.processor.parseGLES3))return m;const O=U.defines,X=l(U,K);U.processor.preProcessor&&(m=U.processor.preProcessor(m,O,X,U.isFragment,U.processingContext));const A={};m=D(m,X,U,A),U.processor.postProcessor&&(m=U.processor.postProcessor(m,O,U.isFragment,U.processingContext,K?{drawBuffersExtensionDisabled:!K.getCaps().drawBuffersExtension}:{},X,A));null!==K&&void 0!==K&&K._features.needShaderCodeInlining&&(m=K.inlineShaderCode(m));return m}(C,U,m);K(O,C)}))}function T(C,U,K){return K.processor&&K.processor.finalizeShaders?K.processor.finalizeShaders(C,U,K.processingContext):{vertexCode:C,fragmentCode:U}}function y(C){const U=/defined\((.+)\)/.exec(C);if(U&&U.length)return new t(U[1].trim(),"!"===C[0]);const K=["==","!=",">=","<=","<",">"];let m="",O=0;for(m of K)if(O=C.indexOf(m),O>-1)break;if(-1===O)return new t(C);const X=C.substring(0,O).trim(),A=C.substring(O+m.length).trim();return new p(X,m,A)}function a(C,U){const K=new A,m=C.substring(0,U);let O=C.substring(U);return O=O.substring(0,(O.indexOf("//")+1||O.length+1)-1).trim(),K.testExpression="#ifdef"===m?new t(O):"#ifndef"===m?new t(O,!0):function(C){C=C.replace(b,"defined[$1]");const U=e.infixToPostfix(C),K=[];for(const O of U)if("||"!==O&&"&&"!==O)K.push(O);else if(K.length>=2){let C=K[K.length-1],U=K[K.length-2];K.length-=2;const m="&&"==O?new j:new z;"string"===typeof C&&(C=C.replace(v,"defined($1)")),"string"===typeof U&&(U=U.replace(v,"defined($1)")),m.leftOperand="string"===typeof U?y(U):U,m.rightOperand="string"===typeof C?y(C):C,K.push(m)}let m=K[K.length-1];return"string"===typeof m&&(m=m.replace(v,"defined($1)")),"string"===typeof m?y(m):m}(O),K}function r(C,U,K,O){let X=C.currentLine;for(;i(C,K,O);){X=C.currentLine;const A=X.substring(0,5).toLowerCase();if("#else"===A){const K=new m;return U.children.push(K),void i(C,K,O)}if("#elif"===A){const C=a(X,5);U.children.push(C),K=C}}}function i(C,U,K){for(;C.canRead;){C.lineIndex++;const O=C.currentLine;if(O.indexOf("#")>=0){const m=P.exec(O);if(m&&m.length){switch(m[0]){case"#ifdef":{const m=new X;U.children.push(m);const A=a(O,6);m.children.push(A),r(C,m,A,K);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const m=new X;U.children.push(m);const A=a(O,7);m.children.push(A),r(C,m,A,K);break}case"#if":{const m=new X,A=a(O,3);U.children.push(m),m.children.push(A),r(C,m,A,K);break}}continue}}const A=new m;if(A.line=O,U.children.push(A),"#"===O[0]&&"d"===O[1]){const C=O.replace(";","").split(" ");A.additionalDefineKey=C[1],3===C.length&&(A.additionalDefineValue=C[2])}}return!1}function D(C,U,K,X){const A=new m,e=new O;return e.lineIndex=-1,e.lines=C.split("\n"),i(e,A,X),A.process(U,K,X)}function l(C,U){var K;const m=C.defines,O={};for(const X of m){const C=X.replace("#define","").replace(";","").trim().split(" ");O[C[0]]=C.length>1?C[1]:""}return 0===(null===(K=C.processor)||void 0===K?void 0:K.shaderLanguage)&&(O.GL_ES="true"),O.__VERSION__=C.version,O[C.platformName]="true",(0,u.l)(O,null===U||void 0===U?void 0:U.isNDCHalfZRange,null===U||void 0===U?void 0:U.useReverseDepthBuffer,null===U||void 0===U?void 0:U.useExactSrgbConversions),O}function G(C,U,K){let m;for(Z.length=0;null!==(m=Q.exec(C));)Z.push(m);let O=String(C),X=[C],A=!1;for(const e of Z){let C=e[1];if(-1!==C.indexOf("__decl__")&&(C=C.replace(V,""),U.supportsUniformBuffers&&(C=C.replace("Vertex","Ubo").replace("Fragment","Ubo")),C+="Declaration"),!U.includesShadersStore[C]){const m=U.shadersRepository+"ShadersInclude/"+C+".fx";return void J.loadFile(m,(m=>{U.includesShadersStore[C]=m,G(X.join(""),U,K)}))}{let K=U.includesShadersStore[C];if(e[2]){const C=e[3].split(",");for(let U=0;U<C.length;U+=2){const m=new RegExp(C[U],"g"),O=C[U+1];K=K.replace(m,O)}}if(e[4]){const C=e[5];if(-1!==C.indexOf("..")){const m=C.split(".."),O=parseInt(m[0]);let X=parseInt(m[1]),A=K.slice(0);K="",isNaN(X)&&(X=U.indexParameters[m[1]]);for(let C=O;C<X;C++)U.supportsUniformBuffers||(A=A.replace(f,((C,U)=>U+"{X}"))),K+=A.replace(F,C.toString())+"\n"}else U.supportsUniformBuffers||(K=K.replace(f,((C,U)=>U+"{X}"))),K=K.replace(F,C)}const m=[];for(const C of X){const U=C.split(e[0]);for(let C=0;C<U.length-1;C++)m.push(U[C]),m.push(K);m.push(U[U.length-1])}X=m,A=A||K.indexOf("#include<")>=0||K.indexOf("#include <")>=0}}Z.length=0,O=X.join(""),A?G(O.toString(),U,K):K(O)}const J={loadFile:(C,U,K,m,O,X)=>{throw(0,E.b)("FileTools")}}},11726:(C,U,K)=>{K.d(U,{e:()=>O,i:()=>X,l:()=>e,m:()=>A,q:()=>t});var m=K(11696);K(11670);const O={};function X(C,U){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(U?U+"\n":"")+C}function A(C,U,K,X,A,e,t){const z=t||O.loadFile;if(z){return z(C,U,K,X,A,e)}throw(0,m.b)("FileTools")}function e(C,U,K,m){if(C)return U?C.IS_NDC_HALF_ZRANGE="":delete C.IS_NDC_HALF_ZRANGE,K?C.USE_REVERSE_DEPTHBUFFER="":delete C.USE_REVERSE_DEPTHBUFFER,void(m?C.USE_EXACT_SRGB_CONVERSIONS="":delete C.USE_EXACT_SRGB_CONVERSIONS);{let C="";return U&&(C+="#define IS_NDC_HALF_ZRANGE"),K&&(C&&(C+="\n"),C+="#define USE_REVERSE_DEPTHBUFFER"),m&&(C&&(C+="\n"),C+="#define USE_EXACT_SRGB_CONVERSIONS"),C}}function t(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0;switch(C){case 3:{const C=(ArrayBuffer,new Int8Array(U));return m&&C.set(new Int8Array(m)),C}case 0:{const C=(ArrayBuffer,new Uint8Array(U));return m&&C.set(new Uint8Array(m)),C}case 4:{const C=U instanceof ArrayBuffer?new Int16Array(U):new Int16Array(K?U/2:U);return m&&C.set(new Int16Array(m)),C}case 5:case 8:case 9:case 10:case 2:{const C=U instanceof ArrayBuffer?new Uint16Array(U):new Uint16Array(K?U/2:U);return m&&C.set(new Uint16Array(m)),C}case 6:{const C=U instanceof ArrayBuffer?new Int32Array(U):new Int32Array(K?U/4:U);return m&&C.set(new Int32Array(m)),C}case 7:case 11:case 12:case 13:case 14:case 15:{const C=U instanceof ArrayBuffer?new Uint32Array(U):new Uint32Array(K?U/4:U);return m&&C.set(new Uint32Array(m)),C}case 1:{const C=U instanceof ArrayBuffer?new Float32Array(U):new Float32Array(K?U/4:U);return m&&C.set(new Float32Array(m)),C}}const O=(ArrayBuffer,new Uint8Array(U));return m&&O.set(new Uint8Array(m)),O}},11747:(C,U,K)=>{K.d(U,{d:()=>m});class m{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?m.ShadersRepository:m.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?m.ShadersStore:m.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?m.IncludesShadersStore:m.IncludesShadersStoreWGSL}}m.ShadersRepository="src/Shaders/",m.ShadersStore={},m.IncludesShadersStore={},m.ShadersRepositoryWGSL="src/ShadersWGSL/",m.ShadersStoreWGSL={},m.IncludesShadersStoreWGSL={}},11758:(C,U,K)=>{K.d(U,{d:()=>E,h:()=>F,i:()=>b,k:()=>u,o:()=>v,s:()=>f,t:()=>p,v:()=>z,x:()=>j,A:()=>t,E:()=>e});class m{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.uU._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(C){C&&this.program&&C(this.program)}setEngine(C){this.uU=C}_fillEffectInformation(C,U,K,m,O,X,A,e){const t=this.uU;if(t.supportsUniformBuffers)for(const j in U)C.bindUniformBlock(j,U[j]);let z;for(this.uU.getUniforms(this,K).forEach(((C,U)=>{m[K[U]]=C})),this._uniforms=m,z=0;z<O.length;z++){null==C.getUniform(O[z])&&(O.splice(z,1),z--)}O.forEach(((C,U)=>{X[C]=U}));for(const j of t.getAttributes(this,A))e.push(j)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(C,U){const K=this._valueCache[C],m=U.updateFlag;return(void 0===K||K!==m)&&(this._valueCache[C]=m,!0)}_cacheFloat2(C,U,K){let m=this._valueCache[C];if(!m||2!==m.length)return m=[U,K],this._valueCache[C]=m,!0;let O=!1;return m[0]!==U&&(m[0]=U,O=!0),m[1]!==K&&(m[1]=K,O=!0),O}_cacheFloat3(C,U,K,m){let O=this._valueCache[C];if(!O||3!==O.length)return O=[U,K,m],this._valueCache[C]=O,!0;let X=!1;return O[0]!==U&&(O[0]=U,X=!0),O[1]!==K&&(O[1]=K,X=!0),O[2]!==m&&(O[2]=m,X=!0),X}_cacheFloat4(C,U,K,m,O){let X=this._valueCache[C];if(!X||4!==X.length)return X=[U,K,m,O],this._valueCache[C]=X,!0;let A=!1;return X[0]!==U&&(X[0]=U,A=!0),X[1]!==K&&(X[1]=K,A=!0),X[2]!==m&&(X[2]=m,A=!0),X[3]!==O&&(X[3]=O,A=!0),A}setInt(C,U){const K=this._valueCache[C];void 0!==K&&K===U||this.uU.setInt(this._uniforms[C],U)&&(this._valueCache[C]=U)}setInt2(C,U,K){this._cacheFloat2(C,U,K)&&(this.uU.setInt2(this._uniforms[C],U,K)||(this._valueCache[C]=null))}setInt3(C,U,K,m){this._cacheFloat3(C,U,K,m)&&(this.uU.setInt3(this._uniforms[C],U,K,m)||(this._valueCache[C]=null))}setInt4(C,U,K,m,O){this._cacheFloat4(C,U,K,m,O)&&(this.uU.setInt4(this._uniforms[C],U,K,m,O)||(this._valueCache[C]=null))}setIntArray(C,U){this._valueCache[C]=null,this.uU.setIntArray(this._uniforms[C],U)}setIntArray2(C,U){this._valueCache[C]=null,this.uU.setIntArray2(this._uniforms[C],U)}setIntArray3(C,U){this._valueCache[C]=null,this.uU.setIntArray3(this._uniforms[C],U)}setIntArray4(C,U){this._valueCache[C]=null,this.uU.setIntArray4(this._uniforms[C],U)}setUInt(C,U){const K=this._valueCache[C];void 0!==K&&K===U||this.uU.setUInt(this._uniforms[C],U)&&(this._valueCache[C]=U)}setUInt2(C,U,K){this._cacheFloat2(C,U,K)&&(this.uU.setUInt2(this._uniforms[C],U,K)||(this._valueCache[C]=null))}setUInt3(C,U,K,m){this._cacheFloat3(C,U,K,m)&&(this.uU.setUInt3(this._uniforms[C],U,K,m)||(this._valueCache[C]=null))}setUInt4(C,U,K,m,O){this._cacheFloat4(C,U,K,m,O)&&(this.uU.setUInt4(this._uniforms[C],U,K,m,O)||(this._valueCache[C]=null))}setUIntArray(C,U){this._valueCache[C]=null,this.uU.setUIntArray(this._uniforms[C],U)}setUIntArray2(C,U){this._valueCache[C]=null,this.uU.setUIntArray2(this._uniforms[C],U)}setUIntArray3(C,U){this._valueCache[C]=null,this.uU.setUIntArray3(this._uniforms[C],U)}setUIntArray4(C,U){this._valueCache[C]=null,this.uU.setUIntArray4(this._uniforms[C],U)}setArray(C,U){this._valueCache[C]=null,this.uU.setArray(this._uniforms[C],U)}setArray2(C,U){this._valueCache[C]=null,this.uU.setArray2(this._uniforms[C],U)}setArray3(C,U){this._valueCache[C]=null,this.uU.setArray3(this._uniforms[C],U)}setArray4(C,U){this._valueCache[C]=null,this.uU.setArray4(this._uniforms[C],U)}setMatrices(C,U){U&&(this._valueCache[C]=null,this.uU.setMatrices(this._uniforms[C],U))}setMatrix(C,U){this._cacheMatrix(C,U)&&(this.uU.setMatrices(this._uniforms[C],U.Oe())||(this._valueCache[C]=null))}setMatrix3x3(C,U){this._valueCache[C]=null,this.uU.setMatrix3x3(this._uniforms[C],U)}setMatrix2x2(C,U){this._valueCache[C]=null,this.uU.setMatrix2x2(this._uniforms[C],U)}setFloat(C,U){const K=this._valueCache[C];void 0!==K&&K===U||this.uU.setFloat(this._uniforms[C],U)&&(this._valueCache[C]=U)}setVector2(C,U){this._cacheFloat2(C,U.x,U.y)&&(this.uU.setFloat2(this._uniforms[C],U.x,U.y)||(this._valueCache[C]=null))}setFloat2(C,U,K){this._cacheFloat2(C,U,K)&&(this.uU.setFloat2(this._uniforms[C],U,K)||(this._valueCache[C]=null))}setVector3(C,U){this._cacheFloat3(C,U.x,U.y,U.z)&&(this.uU.setFloat3(this._uniforms[C],U.x,U.y,U.z)||(this._valueCache[C]=null))}setFloat3(C,U,K,m){this._cacheFloat3(C,U,K,m)&&(this.uU.setFloat3(this._uniforms[C],U,K,m)||(this._valueCache[C]=null))}setVector4(C,U){this._cacheFloat4(C,U.x,U.y,U.z,U.w)&&(this.uU.setFloat4(this._uniforms[C],U.x,U.y,U.z,U.w)||(this._valueCache[C]=null))}setQuaternion(C,U){this._cacheFloat4(C,U.x,U.y,U.z,U.w)&&(this.uU.setFloat4(this._uniforms[C],U.x,U.y,U.z,U.w)||(this._valueCache[C]=null))}setFloat4(C,U,K,m,O){this._cacheFloat4(C,U,K,m,O)&&(this.uU.setFloat4(this._uniforms[C],U,K,m,O)||(this._valueCache[C]=null))}setColor3(C,U){this._cacheFloat3(C,U.r,U.g,U.b)&&(this.uU.setFloat3(this._uniforms[C],U.r,U.g,U.b)||(this._valueCache[C]=null))}setColor4(C,U,K){this._cacheFloat4(C,U.r,U.g,U.b,K)&&(this.uU.setFloat4(this._uniforms[C],U.r,U.g,U.b,K)||(this._valueCache[C]=null))}setDirectColor4(C,U){this._cacheFloat4(C,U.r,U.g,U.b,U.a)&&(this.uU.setFloat4(this._uniforms[C],U.r,U.g,U.b,U.a)||(this._valueCache[C]=null))}_getVertexShaderCode(){return this.vertexShader?this.uU._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.uU._getShaderSource(this.fragmentShader):null}}var O=K(11726);const X=new WeakMap,A={_webGLVersion:2,cachedPipelines:{}};function e(C){let U=X.get(C);if(!U){if(!C)return A;U={_webGLVersion:C.TEXTURE_BINDING_3D?2:1,_context:C,parallelShaderCompile:C.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},X.set(C,U)}return U}function t(C){X.delete(C)}function z(C,U,K,m,O,X){const A=e(m);X||(X=A._createShaderProgramInjection??E);return X(C,V(U,"vertex",m,A._contextWasLost),V(K,"fragment",m,A._contextWasLost),m,O,A.validateShaderPrograms)}function j(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0;const t=e(O);A||(A=t._createShaderProgramInjection??E);const z=t._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return A(C,Q(U,"vertex",m,z,O,t._contextWasLost),Q(K,"fragment",m,z,O,t._contextWasLost),O,X,t.validateShaderPrograms)}function p(C,U){const K=new m,O=e(C);return O.parallelShaderCompile&&!O.disableParallelShaderCompile&&(K.isParallelCompiled=!0),K.context=O._context,K}function E(C,U,K,m){let O=arguments.length>5?arguments[5]:void 0;const X=m.createProgram();if(C.program=X,!X)throw new Error("Unable to create program");return m.attachShader(X,U),m.attachShader(X,K),m.linkProgram(X),C.context=m,C.vertexShader=U,C.fragmentShader=K,C.isParallelCompiled||b(C,m,O),X}function u(C,U,K){const m=C;if(m._isDisposed)return!1;const O=e(U);return!!(O&&O.parallelShaderCompile&&O.parallelShaderCompile.COMPLETION_STATUS_KHR&&m.program&&U.getProgramParameter(m.program,O.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(b(m,U,K),!0)}function b(C,U,K){const m=C.context,O=C.vertexShader,X=C.fragmentShader,A=C.program;if(!m.getProgramParameter(A,m.LINK_STATUS)){if(!U.getShaderParameter(O,U.COMPILE_STATUS)){const K=U.getShaderInfoLog(O);if(K)throw C.vertexCompilationError=K,new Error("VERTEX SHADER "+K)}if(!U.getShaderParameter(X,U.COMPILE_STATUS)){const K=U.getShaderInfoLog(X);if(K)throw C.fragmentCompilationError=K,new Error("FRAGMENT SHADER "+K)}const K=m.getProgramInfoLog(A);if(K)throw C.programLinkError=K,new Error(K)}if(K){m.validateProgram(A);if(!m.getProgramParameter(A,m.VALIDATE_STATUS)){const U=m.getProgramInfoLog(A);if(U)throw C.programValidationError=U,new Error(U)}}m.deleteShader(O),m.deleteShader(X),C.vertexShader=void 0,C.fragmentShader=void 0,C.onCompiled&&(C.onCompiled(),C.onCompiled=void 0)}function v(C,U,K,m,O,X,A,t,p){let E=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0;const v=e(C.context);u||(u=v.createRawShaderProgramInjection??z),b||(b=v.createShaderProgramInjection??j);const Q=C;Q.program=m?u(Q,U,K,Q.context,p):b(Q,U,K,t,Q.context,p),Q.program.__SPECTOR_rebuildProgram=A,E()}function Q(C,U,K,m,X,A){return V((0,O.i)(C,K,m),U,X,A)}function V(C,U,K,m){const O=K.createShader("vertex"===U?K.VERTEX_SHADER:K.FRAGMENT_SHADER);if(!O){let C=K.NO_ERROR,O=K.NO_ERROR;for(;(O=K.getError())!==K.NO_ERROR;)C=O;throw new Error(`Something went wrong while creating a gl ${U} shader object. gl error=${C}, gl isContextLost=${K.isContextLost()}, _contextWasLost=${m}`)}return K.shaderSource(O,C),K.compileShader(O),O}function f(C,U){U.useProgram(C)}function F(C,U){const K=C;if(!K.isParallelCompiled)return void U(C);const m=K.onCompiled;K.onCompiled=()=>{null===m||void 0===m||m(),U(C)}}},11753:(C,U,K)=>{K.d(U,{c:()=>p,g:()=>u,h:()=>z,l:()=>j});var m=K(11670),O=K(11758),X=K(11747),A=K(11679),e=K(11724),t=K(11726);function z(C,U){return(0,O.E)(U).cachedPipelines[C]}function j(C){const U=C._name,K=C.context;if(U&&K){const C=(0,O.E)(K),m=C.cachedPipelines[U];null===m||void 0===m||m.dispose(),delete C.cachedPipelines[U]}}function p(C,U,K,O,X,A,t){let z,j;const p=(0,m.g)()?null===A||void 0===A?void 0:A.getHostDocument():null;z="string"===typeof U?U:U.vertexSource?"source:"+U.vertexSource:U.vertexElement?(null===p||void 0===p?void 0:p.getElementById(U.vertexElement))||U.vertexElement:U.vertex||U,j="string"===typeof U?U:U.fragmentSource?"source:"+U.fragmentSource:U.fragmentElement?(null===p||void 0===p?void 0:p.getElementById(U.fragmentElement))||U.fragmentElement:U.fragment||U;const u=[void 0,void 0],b=()=>{if(u[0]&&u[1]){C.isFragment=!0;const[m,z]=u;(0,e.j)(z,C,((A,z)=>{t&&(t._fragmentSourceCodeBeforeMigration=z),K&&(A=K("fragment",A));const j=(0,e.b)(m,A,C);C=null;const p=function(C,U,K,m){if(K){return{vertexSourceCode:(1===m?"//":"")+"#define SHADER_NAME vertex:"+(K.vertexElement||K.vertex||K.spectorName||K)+"\n"+C,fragmentSourceCode:(1===m?"//":"")+"#define SHADER_NAME fragment:"+(K.fragmentElement||K.fragment||K.spectorName||K)+"\n"+U}}return{vertexSourceCode:C,fragmentSourceCode:U}}(j.vertexCode,j.fragmentCode,U,X);null===O||void 0===O||O(p.vertexSourceCode,p.fragmentSourceCode)}),A)}};E(z,"Vertex","",(U=>{(0,e.f)(C),(0,e.j)(U,C,((C,m)=>{t&&(t._rawVertexSourceCode=U,t._vertexSourceCodeBeforeMigration=m),K&&(C=K("vertex",C)),u[0]=C,b()}),A)}),X),E(j,"Fragment","Pixel",(C=>{t&&(t._rawFragmentSourceCode=C),u[1]=C,b()}),X)}function E(C,U,K,O,A,e){if("undefined"!==typeof HTMLElement&&C instanceof HTMLElement){return void O((0,m.c)(C))}if("source:"===C.substring(0,7))return void O(C.substring(7));if("base64:"===C.substring(0,7)){return void O(window.atob(C.substring(7)))}const z=X.d.GetShadersStore(A);if(z[C+U+"Shader"])return void O(z[C+U+"Shader"]);if(K&&z[C+K+"Shader"])return void O(z[C+K+"Shader"]);let j;if(j="."===C[0]||"/"===C[0]||C.indexOf("http")>-1?C:X.d.GetShadersRepository(A)+C,!(e=e||t.m))throw new Error("loadFileInjection is not defined");e(j+"."+U.toLowerCase()+".fx",O)}const u=(C,U,K,m)=>{try{const X=C.context?(0,O.E)(C.context):null;X&&(X.disableParallelShaderCompile=C.disableParallelCompilation);const A=C.existingPipelineContext||U(C.shaderProcessingContext);return A._name=C.name,C.name&&X&&(X.cachedPipelines[C.name]=A),K(A,C.vertex,C.fragment,!!C.createAsRaw,"","",C.rebuildRebind,C.defines,C.transformFeedbackVaryings,"",(()=>{m(A,(()=>{var U;null===(U=C.onRenderingStateCompiled)||void 0===U||U.call(C,A)}))})),A}catch(X){throw A.d.Error("Error compiling effect"),X}}},11741:(C,U,K)=>{K.r(U),K.d(U,{Effect:()=>t});var m=K(11663),O=K(11679),X=K(11747),A=K(11753),e=K(11733);class t{static get ShadersRepository(){return X.d.ShadersRepository}static set ShadersRepository(C){X.d.ShadersRepository=C}get A(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new m.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9?arguments[9]:void 0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,v=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new m.b,this.onErrorObservable=new m.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=C,this._key=u;const Q=this._key.replace(/\r/g,"").replace(/\n/g,"|");let V;if(U.attributes){const C=U;if(this._engine=K,this._attributesNames=C.attributes,this._uniformsNames=C.uniformsNames.concat(C.samplers),this._samplerList=C.samplers.slice(),this.defines=C.defines,this.onError=C.onError,this.onCompiled=C.onCompiled,this._fallbacks=C.fallbacks,this._indexParameters=C.indexParameters,this._transformFeedbackVaryings=C.transformFeedbackVaryings||null,this._multiTarget=!!C.multiTarget,this._shaderLanguage=C.shaderLanguage??0,this._disableParallelShaderCompilation=!!C.disableParallelShaderCompilation,C.uniformBuffersNames){this._uniformBuffersNamesList=C.uniformBuffersNames.slice();for(let U=0;U<C.uniformBuffersNames.length;U++)this._uniformBuffersNames[C.uniformBuffersNames[U]]=U}this._processFinalCode=C.processFinalCode??null,this._processCodeAfterIncludes=C.processCodeAfterIncludes??void 0,v=C.extraInitializationsAsync,V=C.existingPipelineContext}else this._engine=X,this.defines=null==e?"":e,this._uniformsNames=K.concat(O),this._samplerList=O?O.slice():[],this._attributesNames=U,this._uniformBuffersNamesList=[],this._shaderLanguage=b,this.onError=p,this.onCompiled=j,this._indexParameters=E,this._fallbacks=z;"WEBGL2"===this._engine.shaderPlatformName&&(V=(0,A.h)(Q,this._engine._gl)??V),this._attributeLocationByName={},this.uniqueId=t._UniqueIdSeed++,V?(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,v),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.A||this.dispose(!0)}))}async _processShaderCodeAsync(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3?arguments[3]:void 0;m&&await m(),this._processingContext=K||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const O={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:C??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:X.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:X.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,A.c)(O,this.name,this._processFinalCode,((C,K)=>{this._vertexSourceCode=C,this._fragmentSourceCode=K,this._prepareEffect(U)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.A||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(C){return this._attributes[C]}getAttributeLocationByName(C){return this._attributeLocationByName[C]}getAttributesCount(){return this._attributes.length}getUniformIndex(C){return this._uniformsNames.indexOf(C)}getUniform(C){return this._uniforms[C]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((C=>{this.executeWhenCompiled(C)}))}executeWhenCompiled(C){this.isReady()?C(this):(this.onCompileObservable.add((U=>{C(U)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(C){(0,e.c)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(U=>{this._processCompilationErrors(U,C)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var C;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(C=this._pipelineContext)||void 0===C?void 0:C._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var C;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(C=this._pipelineContext)||void 0===C?void 0:C._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(C,U,K,m){this._isReady=!1,this._vertexSourceCodeOverride=C,this._fragmentSourceCodeOverride=U,this.onError=(C,U)=>{m&&m(U)},this.onCompiled=()=>{var C,U;const m=this.getEngine().scenes;if(m)for(let K=0;K<m.length;K++)m[K].markAllMaterialsAsDirty(127);null===(C=(U=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===C||C.call(U,K)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(C){if(this._pipelineContext=C,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let U=0;U<this._attributesNames.length;U++){const C=this._attributesNames[U];this._attributeLocationByName[C]=this._attributes[U]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),t.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this._pipelineContext;this._isReady=!1;try{const K=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),m=K?null:this.defines,O=K?this._vertexSourceCodeOverride:this._vertexSourceCode,X=K?this._fragmentSourceCodeOverride:this._fragmentSourceCode,e=this._engine;this._pipelineContext=(0,A.g)({existingPipelineContext:C?U:null,vertex:O,fragment:X,context:"WEBGL2"===e.shaderPlatformName||"WEBGL1"===e.shaderPlatformName?e._gl:void 0,rebuildRebind:(C,U,K,m)=>this._rebuildProgram(C,U,K,m),defines:m,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:K,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:K=>{U&&!C&&this._engine._deletePipelineContext(U),K&&this._onRenderingStateCompiled(K)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(U)}catch(K){this._processCompilationErrors(K,U)}}_getShaderCodeAndErrorLine(C,U,K){const m=K?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let O=null;if(U&&C){const X=U.match(m);if(X&&2===X.length){const U=parseInt(X[1]),m=C.split("\n",-1);m.length>=U&&(O=`Offending line [${U}] in ${K?"fragment":"vertex"} code: ${m[U-1]}`)}}return[C,O]}_processCompilationErrors(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=C.message;const K=this._attributesNames,m=this._fallbacks;if(O.d.Error("Unable to compile effect:"),O.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),O.d.Error(`Attributes: ${K.join(" ")}`),O.d.Error("Defines:\n"+this.defines),t.LogShaderCodeOnCompilationError){var X,A;let C=null,U=null,K=null;var e;if(null!==(X=this._pipelineContext)&&void 0!==X&&X._getVertexShaderCode()&&([K,C]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),K&&(O.d.Error("Vertex code:"),O.d.Error(K))),null!==(A=this._pipelineContext)&&void 0!==A&&A._getFragmentShaderCode())[K,U]=this._getShaderCodeAndErrorLine(null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode(),this._compilationError,!0),K&&(O.d.Error("Fragment code:"),O.d.Error(K));C&&O.d.Error(C),U&&O.d.Error(U)}O.d.Error("Error: "+this._compilationError);const z=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};U&&(this._pipelineContext=U,this._isReady=!0,z()),m?(this._pipelineContext=null,m.hasMoreFallbacks?(this._allFallbacksProcessed=!1,O.d.Error("Trying next fallback."),this.defines=m.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,z(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,U||z())}get isSupported(){return""===this._compilationError}_bindTexture(C,U){this._engine._bindTexture(this._samplers[C],U,C)}setTexture(C,U){this._engine.setTexture(this._samplers[C],this._uniforms[C],U,C)}setTextureArray(C,U){const K=C+"Ex";if(-1===this._samplerList.indexOf(K+"0")){const m=this._samplerList.indexOf(C);for(let C=1;C<U.length;C++){const U=K+(C-1).toString();this._samplerList.splice(m+C,0,U)}let O=0;for(const C of this._samplerList)this._samplers[C]=O,O+=1}this._engine.setTextureArray(this._samplers[C],this._uniforms[C],U,C)}bindUniformBuffer(C,U){const K=this._uniformBuffersNames[U];void 0===K||t._BaseCache[K]===C&&this._engine._features.useUBOBindingCache||(t._BaseCache[K]=C,this._engine.bindUniformBufferBase(C,K,U))}bindUniformBlock(C,U){this._engine.bindUniformBlock(this._pipelineContext,C,U)}setInt(C,U){return this._pipelineContext.setInt(C,U),this}setInt2(C,U,K){return this._pipelineContext.setInt2(C,U,K),this}setInt3(C,U,K,m){return this._pipelineContext.setInt3(C,U,K,m),this}setInt4(C,U,K,m,O){return this._pipelineContext.setInt4(C,U,K,m,O),this}setIntArray(C,U){return this._pipelineContext.setIntArray(C,U),this}setIntArray2(C,U){return this._pipelineContext.setIntArray2(C,U),this}setIntArray3(C,U){return this._pipelineContext.setIntArray3(C,U),this}setIntArray4(C,U){return this._pipelineContext.setIntArray4(C,U),this}setUInt(C,U){return this._pipelineContext.setUInt(C,U),this}setUInt2(C,U,K){return this._pipelineContext.setUInt2(C,U,K),this}setUInt3(C,U,K,m){return this._pipelineContext.setUInt3(C,U,K,m),this}setUInt4(C,U,K,m,O){return this._pipelineContext.setUInt4(C,U,K,m,O),this}setUIntArray(C,U){return this._pipelineContext.setUIntArray(C,U),this}setUIntArray2(C,U){return this._pipelineContext.setUIntArray2(C,U),this}setUIntArray3(C,U){return this._pipelineContext.setUIntArray3(C,U),this}setUIntArray4(C,U){return this._pipelineContext.setUIntArray4(C,U),this}setFloatArray(C,U){return this._pipelineContext.setArray(C,U),this}setFloatArray2(C,U){return this._pipelineContext.setArray2(C,U),this}setFloatArray3(C,U){return this._pipelineContext.setArray3(C,U),this}setFloatArray4(C,U){return this._pipelineContext.setArray4(C,U),this}setArray(C,U){return this._pipelineContext.setArray(C,U),this}setArray2(C,U){return this._pipelineContext.setArray2(C,U),this}setArray3(C,U){return this._pipelineContext.setArray3(C,U),this}setArray4(C,U){return this._pipelineContext.setArray4(C,U),this}setMatrices(C,U){return this._pipelineContext.setMatrices(C,U),this}setMatrix(C,U){return this._pipelineContext.setMatrix(C,U),this}setMatrix3x3(C,U){return this._pipelineContext.setMatrix3x3(C,U),this}setMatrix2x2(C,U){return this._pipelineContext.setMatrix2x2(C,U),this}setFloat(C,U){return this._pipelineContext.setFloat(C,U),this}setBool(C,U){return this._pipelineContext.setInt(C,U?1:0),this}setVector2(C,U){return this._pipelineContext.setVector2(C,U),this}setFloat2(C,U,K){return this._pipelineContext.setFloat2(C,U,K),this}setVector3(C,U){return this._pipelineContext.setVector3(C,U),this}setFloat3(C,U,K,m){return this._pipelineContext.setFloat3(C,U,K,m),this}setVector4(C,U){return this._pipelineContext.setVector4(C,U),this}setQuaternion(C,U){return this._pipelineContext.setQuaternion(C,U),this}setFloat4(C,U,K,m,O){return this._pipelineContext.setFloat4(C,U,K,m,O),this}setColor3(C,U){return this._pipelineContext.setColor3(C,U),this}setColor4(C,U,K){return this._pipelineContext.setColor4(C,U,K),this}setDirectColor4(C,U){return this._pipelineContext.setDirectColor4(C,U),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(t.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,A.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;U&&(X.d.GetShadersStore(m)[`${C}PixelShader`]=U),K&&(X.d.GetShadersStore(m)[`${C}VertexShader`]=K)}static ResetCache(){t._BaseCache={}}}t.LogShaderCodeOnCompilationError=!0,t.PersistentMode=!1,t.AutomaticallyClearCodeCache=!1,t._UniqueIdSeed=0,t._BaseCache={},t.ShadersStore=X.d.ShadersStore,t.IncludesShadersStore=X.d.IncludesShadersStore},11696:(C,U,K)=>{K.d(U,{b:()=>O});const m={};function O(C){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!m[C])return m[C]=!0,`${C} needs to be imported before as it contains a side-effect required by your code.`}},11670:(C,U,K)=>{function m(){return"undefined"!==typeof window}function O(){return"undefined"!==typeof navigator}function X(){return"undefined"!==typeof document}function A(C){let U="",K=C.firstChild;for(;K;)3===K.nodeType&&(U+=K.textContent),K=K.nextSibling;return U}K.d(U,{c:()=>A,d:()=>X,f:()=>O,g:()=>m})},11679:(C,U,K)=>{K.d(U,{d:()=>m});class m{static _CheckLimit(C,U){let K=m._LogLimitOutputs[C];return K?K.current++:(K={limit:U,current:1},m._LogLimitOutputs[C]=K),K.current<=K.limit}static _GenerateLimitMessage(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const K=m._LogLimitOutputs[C];if(!K||!m.MessageLimitReached)return;const O=this._Levels[U];K.current===K.limit&&m[O.name](m.MessageLimitReached.replace(/%LIMIT%/g,""+K.limit).replace(/%TYPE%/g,O.name??""))}static _AddLogEntry(C){m._LogCache=C+m._LogCache,m.OnNewCacheEntry&&m.OnNewCacheEntry(C)}static _FormatMessage(C){const U=C=>C<10?"0"+C:""+C,K=new Date;return"["+U(K.getHours())+":"+U(K.getMinutes())+":"+U(K.getSeconds())+"]: "+C}static _LogDisabled(C,U){}static _LogEnabled(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;const O=Array.isArray(U)?U[0]:U;if(void 0!==K&&!m._CheckLimit(O,K))return;const X=m._FormatMessage(O),A=this._Levels[C],e=Array.isArray(U)?U.slice(1):[];A.logFunc&&A.logFunc("BJS - "+X,...e);const t=`<div style='color:${A.color}'>${X}</div><br>`;m._AddLogEntry(t),m._GenerateLimitMessage(O,C)}static get LogCache(){return m._LogCache}static ClearLogCache(){m._LogCache="",m._LogLimitOutputs={},m.errorsCount=0}static set LogLevels(C){m.Log=m._LogDisabled,m.Warn=m._LogDisabled,m.Error=m._LogDisabled;const U=[m.MessageLogLevel,m.WarningLogLevel,m.ErrorLogLevel];for(const K of U)if((C&K)===K){const C=this._Levels[K];m[C.name]=m._LogEnabled.bind(m,K)}}}m.NoneLogLevel=0,m.MessageLogLevel=1,m.WarningLogLevel=2,m.ErrorLogLevel=4,m.AllLogLevel=7,m.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",m._LogCache="",m._LogLimitOutputs={},m._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],m.errorsCount=0,m.Log=m._LogEnabled.bind(m,m.MessageLogLevel),m.Warn=m._LogEnabled.bind(m,m.WarningLogLevel),m.Error=m._LogEnabled.bind(m,m.ErrorLogLevel)},11663:(C,U,K)=>{K.d(U,{b:()=>A});const m="undefined"!==typeof WeakRef;class O{constructor(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0,m=arguments.length>3?arguments[3]:void 0;this.initialize(C,U,K,m)}initialize(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0,m=arguments.length>3?arguments[3]:void 0;return this.mask=C,this.skipNextObservers=U,this.target=K,this.currentTarget=m,this}}class X{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=C,this.mask=U,this.scope=K,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(C)}}class A{static FromPromise(C,U){const K=new A;return C.then((C=>{K.notifyObservers(C)})).catch((C=>{if(!U)throw C;U.notifyObservers(C)})),K}get observers(){return this._observers}constructor(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=U,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new O(0),C&&(this._onObserverAdded=C)}add(C){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!C)return null;const O=new X(C,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);O.unregisterOnNextCall=K,U?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(O,this._lastNotifiedValue);const A=m?new WeakRef(this):{deref:()=>this};return O._remove=function(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=A.deref();U&&(C?U.remove(O):U._remove(O))},O}addOnce(C){return this.add(C,void 0,void 0,void 0,!0)}remove(C){if(!C)return!1;C._remove=null;return-1!==this._observers.indexOf(C)&&(this._deferUnregister(C),!0)}removeCallback(C,U){for(let K=0;K<this._observers.length;K++){const m=this._observers[K];if(!m._willBeUnregistered&&(m.callback===C&&(!U||U===m.scope)))return this._deferUnregister(m),!0}return!1}_deferUnregister(C){C._willBeUnregistered||(this._numObserversMarkedAsDeleted++,C.unregisterOnNextCall=!1,C._willBeUnregistered=!0,setTimeout((()=>{this._remove(C)}),0))}_remove(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!C)return!1;const K=this._observers.indexOf(C);return-1!==K&&(U&&this._numObserversMarkedAsDeleted--,this._observers.splice(K,1),!0)}makeObserverTopPriority(C){this._remove(C,!1),this._observers.unshift(C)}makeObserverBottomPriority(C){this._remove(C,!1),this._observers.push(C)}notifyObservers(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,K=arguments.length>2?arguments[2]:void 0,m=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=C),!this._observers.length)return!0;const X=this._eventState;X.mask=U,X.target=K,X.currentTarget=m,X.skipNextObservers=!1,X.lastReturnValue=C,X.userInfo=O;for(const A of this._observers)if(!A._willBeUnregistered&&(A.mask&U&&(A.unregisterOnNextCall&&this._deferUnregister(A),A.scope?X.lastReturnValue=A.callback.apply(A.scope,[C,X]):X.lastReturnValue=A.callback(C,X)),X.skipNextObservers))return!1;return!0}notifyObserver(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=U),C._willBeUnregistered)return;const m=this._eventState;m.mask=K,m.skipNextObservers=!1,C.unregisterOnNextCall&&this._deferUnregister(C),C.callback(U,m)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const C=this._observers.pop();C&&(C._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const C=new A;return C._observers=this._observers.slice(0),C}hasSpecificMask(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const U of this._observers)if(U.mask&C||U.mask===C)return!0;return!1}}},11733:(C,U,K)=>{K.d(U,{b:()=>O,c:()=>A});let m=[];class O{static SetImmediate(C){0===m.length&&setTimeout((()=>{const C=m;m=[];for(const U of C)U()}),1),m.push(C)}}function X(C,U,K){try{if(C())return U(),!0}catch(m){return null===K||void 0===K||K(m),!0}return!1}const A=function(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,A=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&X(C,U,K))return null;const e=setInterval((()=>{X(C,U,K)?clearInterval(e):(O-=m,O<0&&(clearInterval(e),null===K||void 0===K||K(new Error("Operation timed out after maximum retries. "+(A||"")),!0)))}),m);return()=>clearInterval(e)}}}]);