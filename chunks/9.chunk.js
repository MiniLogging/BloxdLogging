"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[9],{12132:(i,x,e)=>{e.d(x,{b:()=>O,c:()=>f,h:()=>w,e:()=>X,i:()=>C});class j{constructor(){this.children=[]}isValid(i){return!0}process(i,x,e){let j="";if(this.line){let e=this.line;const g=x.processor;if(g){var E,a,Y,J,u,b;g.lineProcessor&&(e=g.lineProcessor(e,x.isFragment,x.processingContext));const j=(null===(E=x.processor)||void 0===E?void 0:E.attributeKeywordName)??"attribute",A=x.isFragment&&null!==(a=x.processor)&&void 0!==a&&a.varyingFragmentKeywordName?null===(Y=x.processor)||void 0===Y?void 0:Y.varyingFragmentKeywordName:!x.isFragment&&null!==(J=x.processor)&&void 0!==J&&J.varyingVertexKeywordName?null===(u=x.processor)||void 0===u?void 0:u.varyingVertexKeywordName:"varying";if(!x.isFragment&&g.attributeProcessor&&this.line.startsWith(j))e=g.attributeProcessor(this.line,i,x.processingContext);else if(g.varyingProcessor&&(null!==(b=g.varyingCheck)&&void 0!==b&&b.call(g,this.line,x.isFragment)||!g.varyingCheck&&this.line.startsWith(A)))e=g.varyingProcessor(this.line,x.isFragment,i,x.processingContext);else if(g.uniformProcessor&&g.uniformRegexp&&g.uniformRegexp.test(this.line))x.lookForClosingBracketForUniformBuffer||(e=g.uniformProcessor(this.line,x.isFragment,i,x.processingContext));else if(g.uniformBufferProcessor&&g.uniformBufferRegexp&&g.uniformBufferRegexp.test(this.line))x.lookForClosingBracketForUniformBuffer||(e=g.uniformBufferProcessor(this.line,x.isFragment,x.processingContext),x.lookForClosingBracketForUniformBuffer=!0);else if(g.textureProcessor&&g.textureRegexp&&g.textureRegexp.test(this.line))e=g.textureProcessor(this.line,x.isFragment,i,x.processingContext);else if((g.uniformProcessor||g.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!x.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?g.uniformProcessor&&(e=g.uniformProcessor(this.line,x.isFragment,i,x.processingContext)):g.uniformBufferProcessor&&(e=g.uniformBufferProcessor(this.line,x.isFragment,x.processingContext),x.lookForClosingBracketForUniformBuffer=!0)}x.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(x.lookForClosingBracketForUniformBuffer=!1,g.endOfUniformBufferProcessor&&(e=g.endOfUniformBufferProcessor(this.line,x.isFragment,x.processingContext)))}j+=e+"\n"}for(const g of this.children)j+=g.process(i,x,e);return this.additionalDefineKey&&(i[this.additionalDefineKey]=this.additionalDefineValue||"true",e[this.additionalDefineKey]=i[this.additionalDefineKey]),j}}class E{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(i){this._lines.length=0;for(const x of i){if(!x||"\r"===x)continue;if("#"===x[0]){this._lines.push(x);continue}const i=x.trim();if(!i)continue;if(i.startsWith("//")){this._lines.push(x);continue}const e=i.indexOf(";");if(-1===e)this._lines.push(i);else if(e===i.length-1)i.length>1&&this._lines.push(i);else{const i=x.split(";");for(let x=0;x<i.length;x++){let e=i[x];e&&(e=e.trim(),e&&this._lines.push(e+(x!==i.length-1?";":"")))}}}}}class a extends j{process(i,x,e){for(let j=0;j<this.children.length;j++){const E=this.children[j];if(E.isValid(i))return E.process(i,x,e)}return""}}class Y extends j{isValid(i){return this.testExpression.isTrue(i)}}class J{isTrue(i){return!0}static postfixToInfix(i){const x=[];for(const e of i)if(void 0===J._OperatorPriority[e])x.push(e);else{const i=x[x.length-1],j=x[x.length-2];x.length-=2,x.push(`(${j}${e}${i})`)}return x[x.length-1]}static infixToPostfix(i){const x=J._InfixToPostfixCache.get(i);if(x)return x.accessTime=Date.now(),x.result;if(!i.includes("&&")&&!i.includes("||")&&!i.includes(")")&&!i.includes("("))return[i];const e=[];let j=-1;const E=()=>{g=g.trim(),""!==g&&(e.push(g),g="")},a=i=>{j<J._Stack.length-1&&(J._Stack[++j]=i)},Y=()=>J._Stack[j],u=()=>-1===j?"!!INVALID EXPRESSION!!":J._Stack[j--];let b=0,g="";for(;b<i.length;){const x=i.charAt(b),A=b<i.length-1?i.substring(b,2+b):"";if("("===x)g="",a(x);else if(")"===x){for(E();-1!==j&&"("!==Y();)e.push(u());u()}else if(J._OperatorPriority[A]>1){for(E();-1!==j&&J._OperatorPriority[Y()]>=J._OperatorPriority[A];)e.push(u());a(A),b++}else g+=x;b++}for(E();-1!==j;)"("===Y()?u():e.push(u());return J._InfixToPostfixCache.size>=J.InfixToPostfixCacheLimitSize&&J.ClearCache(),J._InfixToPostfixCache.set(i,{result:e,accessTime:Date.now()}),e}static ClearCache(){const i=Array.from(J._InfixToPostfixCache.entries()).sort(((i,x)=>i[1].accessTime-x[1].accessTime));for(let x=0;x<J.InfixToPostfixCacheCleanupSize;x++)J._InfixToPostfixCache.delete(i[x][0])}}J.InfixToPostfixCacheLimitSize=5e4,J.InfixToPostfixCacheCleanupSize=25e3,J._InfixToPostfixCache=new Map,J._OperatorPriority={")":0,"(":1,"||":2,"&&":3},J._Stack=["","","","","","","","","","","","","","","","","","","",""];class u extends J{constructor(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=i,this.not=x}isTrue(i){let x=void 0!==i[this.define];return this.not&&(x=!x),x}}class b extends J{isTrue(i){return this.leftOperand.isTrue(i)||this.rightOperand.isTrue(i)}}class g extends J{isTrue(i){return this.leftOperand.isTrue(i)&&this.rightOperand.isTrue(i)}}class A extends J{constructor(i,x,e){super(),this.define=i,this.operand=x,this.testValue=e}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(i){let x=!1;const e=parseInt(void 0!=i[this.define]?i[this.define]:this.define),j=parseInt(void 0!=i[this.testValue]?i[this.testValue]:this.testValue);if(isNaN(e)||isNaN(j))return!1;switch(this.operand){case">":x=e>j;break;case"<":x=e<j;break;case"<=":x=e<=j;break;case">=":x=e>=j;break;case"==":x=e===j;break;case"!=":x=e!==j}return x}}var K=e(12092),L=e(12135);const o=/defined\s*?\((.+?)\)/g,M=/defined\s*?\[(.+?)\]/g,z=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,T=/__decl__/,Q=/light\{X\}.(\w*)/g,t=/\{X\}/g,V=[],S=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function f(i){i.processor&&i.processor.initializeShaders&&i.processor.initializeShaders(i.processingContext)}function w(i,x,e,j){var E;null!==(E=x.processor)&&void 0!==E&&E.preProcessShaderCode&&(i=x.processor.preProcessShaderCode(i,x.isFragment)),X(i,x,(i=>{x.processCodeAfterIncludes&&(i=x.processCodeAfterIncludes(x.isFragment?"fragment":"vertex",i,x.defines));const E=function(i,x,e){let j=function(i,x){var e;if(null!==(e=x.processor)&&void 0!==e&&e.noPrecision)return i;const j=x.shouldUseHighPrecisionShader;-1===i.indexOf("precision highp float")?i=j?"precision highp float;\n"+i:"precision mediump float;\n"+i:j||(i=i.replace("precision highp float","precision mediump float"));return i}(i,x);if(!x.processor)return j;if(0===x.processor.shaderLanguage&&-1!==j.indexOf("#version 3")&&(j=j.replace("#version 300 es",""),!x.processor.parseGLES3))return j;const E=x.defines,a=mi(x,e);x.processor.preProcessor&&(j=x.processor.preProcessor(j,E,a,x.isFragment,x.processingContext));const Y={};j=N(j,a,x,Y),x.processor.postProcessor&&(j=x.processor.postProcessor(j,E,x.isFragment,x.processingContext,e?{drawBuffersExtensionDisabled:!e.getCaps().drawBuffersExtension}:{},a,Y));null!==e&&void 0!==e&&e._features.needShaderCodeInlining&&(j=e.inlineShaderCode(j));return j}(i,x,j);e(E,i)}))}function O(i,x,e){return e.processor&&e.processor.finalizeShaders?e.processor.finalizeShaders(i,x,e.processingContext):{vertexCode:i,fragmentCode:x}}function l(i){const x=/defined\((.+)\)/.exec(i);if(x&&x.length)return new u(x[1].trim(),"!"===i[0]);const e=["==","!=",">=","<=","<",">"];let j="",E=0;for(j of e)if(E=i.indexOf(j),E>-1)break;if(-1===E)return new u(i);const a=i.substring(0,E).trim(),Y=i.substring(E+j.length).trim();return new A(a,j,Y)}function Z(i,x){const e=new Y,j=i.substring(0,x);let E=i.substring(x);return E=E.substring(0,(E.indexOf("//")+1||E.length+1)-1).trim(),e.testExpression="#ifdef"===j?new u(E):"#ifndef"===j?new u(E,!0):function(i){i=i.replace(o,"defined[$1]");const x=J.infixToPostfix(i),e=[];for(const E of x)if("||"!==E&&"&&"!==E)e.push(E);else if(e.length>=2){let i=e[e.length-1],x=e[e.length-2];e.length-=2;const j="&&"==E?new g:new b;"string"===typeof i&&(i=i.replace(M,"defined($1)")),"string"===typeof x&&(x=x.replace(M,"defined($1)")),j.leftOperand="string"===typeof x?l(x):x,j.rightOperand="string"===typeof i?l(i):i,e.push(j)}let j=e[e.length-1];return"string"===typeof j&&(j=j.replace(M,"defined($1)")),"string"===typeof j?l(j):j}(E),e}function B(i,x,e,E){let a=i.currentLine;for(;k(i,e,E);){a=i.currentLine;const Y=a.substring(0,5).toLowerCase();if("#else"===Y){const e=new j;return x.children.push(e),void k(i,e,E)}if("#elif"===Y){const i=Z(a,5);x.children.push(i),e=i}}}function k(i,x,e){for(;i.canRead;){i.lineIndex++;const E=i.currentLine;if(E.indexOf("#")>=0){const j=S.exec(E);if(j&&j.length){switch(j[0]){case"#ifdef":{const j=new a;x.children.push(j);const Y=Z(E,6);j.children.push(Y),B(i,j,Y,e);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const j=new a;x.children.push(j);const Y=Z(E,7);j.children.push(Y),B(i,j,Y,e);break}case"#if":{const j=new a,Y=Z(E,3);x.children.push(j),j.children.push(Y),B(i,j,Y,e);break}}continue}}const Y=new j;if(Y.line=E,x.children.push(Y),"#"===E[0]&&"d"===E[1]){const i=E.replace(";","").split(" ");Y.additionalDefineKey=i[1],3===i.length&&(Y.additionalDefineValue=i[2])}}return!1}function N(i,x,e,a){const Y=new j,J=new E;return J.lineIndex=-1,J.lines=i.split("\n"),k(J,Y,a),Y.process(x,e,a)}function mi(i,x){var e;const j=i.defines,E={};for(const a of j){const i=a.replace("#define","").replace(";","").trim().split(" ");E[i[0]]=i.length>1?i[1]:""}return 0===(null===(e=i.processor)||void 0===e?void 0:e.shaderLanguage)&&(E.GL_ES="true"),E.__VERSION__=i.version,E[i.platformName]="true",(0,L.h)(E,null===x||void 0===x?void 0:x.isNDCHalfZRange,null===x||void 0===x?void 0:x.ue,null===x||void 0===x?void 0:x.useExactSrgbConversions),E}function X(i,x,e){let j;for(V.length=0;null!==(j=z.exec(i));)V.push(j);let E=String(i),a=[i],Y=!1;for(const J of V){let i=J[1];if(-1!==i.indexOf("__decl__")&&(i=i.replace(T,""),x.supportsUniformBuffers&&(i=i.replace("Vertex","Ubo").replace("Fragment","Ubo")),i+="Declaration"),!x.includesShadersStore[i]){const j=x.shadersRepository+"ShadersInclude/"+i+".fx";return void C.loadFile(j,(j=>{x.includesShadersStore[i]=j,X(a.join(""),x,e)}))}{let e=x.includesShadersStore[i];if(J[2]){const i=J[3].split(",");for(let x=0;x<i.length;x+=2){const j=new RegExp(i[x],"g"),E=i[x+1];e=e.replace(j,E)}}if(J[4]){const i=J[5];if(-1!==i.indexOf("..")){const j=i.split(".."),E=parseInt(j[0]);let a=parseInt(j[1]),Y=e.slice(0);e="",isNaN(a)&&(a=x.indexParameters[j[1]]);for(let i=E;i<a;i++)x.supportsUniformBuffers||(Y=Y.replace(Q,((i,x)=>x+"{X}"))),e+=Y.replace(t,i.toString())+"\n"}else x.supportsUniformBuffers||(e=e.replace(Q,((i,x)=>x+"{X}"))),e=e.replace(t,i)}const j=[];for(const i of a){const x=i.split(J[0]);for(let i=0;i<x.length-1;i++)j.push(x[i]),j.push(e);j.push(x[x.length-1])}a=j,Y=Y||e.indexOf("#include<")>=0||e.indexOf("#include <")>=0}}V.length=0,E=a.join(""),Y?X(E.toString(),x,e):e(E)}const C={loadFile:(i,x,e,j,E,a)=>{throw(0,K.e)("FileTools")}}},12135:(i,x,e)=>{e.d(x,{e:()=>E,f:()=>a,h:()=>J,i:()=>Y,l:()=>u});var j=e(12092);e(12069);const E={};function a(i,x){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(x?x+"\n":"")+i}function Y(i,x,e,a,Y,J,u){const b=u||E.loadFile;if(b){return b(i,x,e,a,Y,J)}throw(0,j.e)("FileTools")}function J(i,x,e,j){if(i)return x?i.IS_NDC_HALF_ZRANGE="":delete i.IS_NDC_HALF_ZRANGE,e?i.USE_REVERSE_DEPTHBUFFER="":delete i.USE_REVERSE_DEPTHBUFFER,void(j?i.USE_EXACT_SRGB_CONVERSIONS="":delete i.USE_EXACT_SRGB_CONVERSIONS);{let i="";return x&&(i+="#define IS_NDC_HALF_ZRANGE"),e&&(i&&(i+="\n"),i+="#define USE_REVERSE_DEPTHBUFFER"),j&&(i&&(i+="\n"),i+="#define USE_EXACT_SRGB_CONVERSIONS"),i}}function u(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;switch(i){case 3:{const i=(ArrayBuffer,new Int8Array(x));return j&&i.set(new Int8Array(j)),i}case 0:{const i=(ArrayBuffer,new Uint8Array(x));return j&&i.set(new Uint8Array(j)),i}case 4:{const i=x instanceof ArrayBuffer?new Int16Array(x):new Int16Array(e?x/2:x);return j&&i.set(new Int16Array(j)),i}case 5:case 8:case 9:case 10:case 2:{const i=x instanceof ArrayBuffer?new Uint16Array(x):new Uint16Array(e?x/2:x);return j&&i.set(new Uint16Array(j)),i}case 6:{const i=x instanceof ArrayBuffer?new Int32Array(x):new Int32Array(e?x/4:x);return j&&i.set(new Int32Array(j)),i}case 7:case 11:case 12:case 13:case 14:case 15:{const i=x instanceof ArrayBuffer?new Uint32Array(x):new Uint32Array(e?x/4:x);return j&&i.set(new Uint32Array(j)),i}case 1:{const i=x instanceof ArrayBuffer?new Float32Array(x):new Float32Array(e?x/4:x);return j&&i.set(new Float32Array(j)),i}}const E=(ArrayBuffer,new Uint8Array(x));return j&&E.set(new Uint8Array(j)),E}},12162:(i,x,e)=>{e.d(x,{c:()=>j});class j{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.ShadersRepository:j.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.ShadersStore:j.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.IncludesShadersStore:j.IncludesShadersStoreWGSL}}j.ShadersRepository="src/Shaders/",j.ShadersStore={},j.IncludesShadersStore={},j.ShadersRepositoryWGSL="src/ShadersWGSL/",j.ShadersStoreWGSL={},j.IncludesShadersStoreWGSL={}},12169:(i,x,e)=>{e.d(x,{b:()=>K,f:()=>t,i:()=>o,j:()=>L,n:()=>M,q:()=>Q,u:()=>A,v:()=>b,y:()=>g,A:()=>u,D:()=>J});class j{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.tx._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(i){i&&this.program&&i(this.program)}setEngine(i){this.tx=i}_fillEffectInformation(i,x,e,j,E,a,Y,J){const u=this.tx;if(u.supportsUniformBuffers)for(const g in x)i.bindUniformBlock(g,x[g]);let b;for(this.tx.getUniforms(this,e).forEach(((i,x)=>{j[e[x]]=i})),this._uniforms=j,b=0;b<E.length;b++){null==i.getUniform(E[b])&&(E.splice(b,1),b--)}E.forEach(((i,x)=>{a[i]=x}));for(const g of u.getAttributes(this,Y))J.push(g)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(i,x){const e=this._valueCache[i],j=x.updateFlag;return(void 0===e||e!==j)&&(this._valueCache[i]=j,!0)}_cacheFloat2(i,x,e){let j=this._valueCache[i];if(!j||2!==j.length)return j=[x,e],this._valueCache[i]=j,!0;let E=!1;return j[0]!==x&&(j[0]=x,E=!0),j[1]!==e&&(j[1]=e,E=!0),E}_cacheFloat3(i,x,e,j){let E=this._valueCache[i];if(!E||3!==E.length)return E=[x,e,j],this._valueCache[i]=E,!0;let a=!1;return E[0]!==x&&(E[0]=x,a=!0),E[1]!==e&&(E[1]=e,a=!0),E[2]!==j&&(E[2]=j,a=!0),a}_cacheFloat4(i,x,e,j,E){let a=this._valueCache[i];if(!a||4!==a.length)return a=[x,e,j,E],this._valueCache[i]=a,!0;let Y=!1;return a[0]!==x&&(a[0]=x,Y=!0),a[1]!==e&&(a[1]=e,Y=!0),a[2]!==j&&(a[2]=j,Y=!0),a[3]!==E&&(a[3]=E,Y=!0),Y}setInt(i,x){const e=this._valueCache[i];void 0!==e&&e===x||this.tx.setInt(this._uniforms[i],x)&&(this._valueCache[i]=x)}setInt2(i,x,e){this._cacheFloat2(i,x,e)&&(this.tx.setInt2(this._uniforms[i],x,e)||(this._valueCache[i]=null))}setInt3(i,x,e,j){this._cacheFloat3(i,x,e,j)&&(this.tx.setInt3(this._uniforms[i],x,e,j)||(this._valueCache[i]=null))}setInt4(i,x,e,j,E){this._cacheFloat4(i,x,e,j,E)&&(this.tx.setInt4(this._uniforms[i],x,e,j,E)||(this._valueCache[i]=null))}setIntArray(i,x){this._valueCache[i]=null,this.tx.setIntArray(this._uniforms[i],x)}setIntArray2(i,x){this._valueCache[i]=null,this.tx.setIntArray2(this._uniforms[i],x)}setIntArray3(i,x){this._valueCache[i]=null,this.tx.setIntArray3(this._uniforms[i],x)}setIntArray4(i,x){this._valueCache[i]=null,this.tx.setIntArray4(this._uniforms[i],x)}setUInt(i,x){const e=this._valueCache[i];void 0!==e&&e===x||this.tx.setUInt(this._uniforms[i],x)&&(this._valueCache[i]=x)}setUInt2(i,x,e){this._cacheFloat2(i,x,e)&&(this.tx.setUInt2(this._uniforms[i],x,e)||(this._valueCache[i]=null))}setUInt3(i,x,e,j){this._cacheFloat3(i,x,e,j)&&(this.tx.setUInt3(this._uniforms[i],x,e,j)||(this._valueCache[i]=null))}setUInt4(i,x,e,j,E){this._cacheFloat4(i,x,e,j,E)&&(this.tx.setUInt4(this._uniforms[i],x,e,j,E)||(this._valueCache[i]=null))}setUIntArray(i,x){this._valueCache[i]=null,this.tx.setUIntArray(this._uniforms[i],x)}setUIntArray2(i,x){this._valueCache[i]=null,this.tx.setUIntArray2(this._uniforms[i],x)}setUIntArray3(i,x){this._valueCache[i]=null,this.tx.setUIntArray3(this._uniforms[i],x)}setUIntArray4(i,x){this._valueCache[i]=null,this.tx.setUIntArray4(this._uniforms[i],x)}setArray(i,x){this._valueCache[i]=null,this.tx.setArray(this._uniforms[i],x)}setArray2(i,x){this._valueCache[i]=null,this.tx.setArray2(this._uniforms[i],x)}setArray3(i,x){this._valueCache[i]=null,this.tx.setArray3(this._uniforms[i],x)}setArray4(i,x){this._valueCache[i]=null,this.tx.setArray4(this._uniforms[i],x)}setMatrices(i,x){x&&(this._valueCache[i]=null,this.tx.setMatrices(this._uniforms[i],x))}setMatrix(i,x){this._cacheMatrix(i,x)&&(this.tx.setMatrices(this._uniforms[i],x.de())||(this._valueCache[i]=null))}setMatrix3x3(i,x){this._valueCache[i]=null,this.tx.setMatrix3x3(this._uniforms[i],x)}setMatrix2x2(i,x){this._valueCache[i]=null,this.tx.setMatrix2x2(this._uniforms[i],x)}setFloat(i,x){const e=this._valueCache[i];void 0!==e&&e===x||this.tx.setFloat(this._uniforms[i],x)&&(this._valueCache[i]=x)}setVector2(i,x){this._cacheFloat2(i,x.x,x.y)&&(this.tx.setFloat2(this._uniforms[i],x.x,x.y)||(this._valueCache[i]=null))}setFloat2(i,x,e){this._cacheFloat2(i,x,e)&&(this.tx.setFloat2(this._uniforms[i],x,e)||(this._valueCache[i]=null))}setVector3(i,x){this._cacheFloat3(i,x.x,x.y,x.z)&&(this.tx.setFloat3(this._uniforms[i],x.x,x.y,x.z)||(this._valueCache[i]=null))}setFloat3(i,x,e,j){this._cacheFloat3(i,x,e,j)&&(this.tx.setFloat3(this._uniforms[i],x,e,j)||(this._valueCache[i]=null))}setVector4(i,x){this._cacheFloat4(i,x.x,x.y,x.z,x.w)&&(this.tx.setFloat4(this._uniforms[i],x.x,x.y,x.z,x.w)||(this._valueCache[i]=null))}setQuaternion(i,x){this._cacheFloat4(i,x.x,x.y,x.z,x.w)&&(this.tx.setFloat4(this._uniforms[i],x.x,x.y,x.z,x.w)||(this._valueCache[i]=null))}setFloat4(i,x,e,j,E){this._cacheFloat4(i,x,e,j,E)&&(this.tx.setFloat4(this._uniforms[i],x,e,j,E)||(this._valueCache[i]=null))}setColor3(i,x){this._cacheFloat3(i,x.r,x.g,x.b)&&(this.tx.setFloat3(this._uniforms[i],x.r,x.g,x.b)||(this._valueCache[i]=null))}setColor4(i,x,e){this._cacheFloat4(i,x.r,x.g,x.b,e)&&(this.tx.setFloat4(this._uniforms[i],x.r,x.g,x.b,e)||(this._valueCache[i]=null))}setDirectColor4(i,x){this._cacheFloat4(i,x.r,x.g,x.b,x.a)&&(this.tx.setFloat4(this._uniforms[i],x.r,x.g,x.b,x.a)||(this._valueCache[i]=null))}_getVertexShaderCode(){return this.vertexShader?this.tx._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.tx._getShaderSource(this.fragmentShader):null}}var E=e(12135);const a=new WeakMap,Y={_webGLVersion:2,cachedPipelines:{}};function J(i){let x=a.get(i);if(!x){if(!i)return Y;x={_webGLVersion:i.TEXTURE_BINDING_3D?2:1,_context:i,parallelShaderCompile:i.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},a.set(i,x)}return x}function u(i){a.delete(i)}function b(i,x,e,j,E,a){const Y=J(j);a||(a=Y._createShaderProgramInjection??K);return a(i,T(x,"vertex",j,Y._contextWasLost),T(e,"fragment",j,Y._contextWasLost),j,E,Y.validateShaderPrograms)}function g(i,x,e,j,E){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;const u=J(E);Y||(Y=u._createShaderProgramInjection??K);const b=u._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Y(i,z(x,"vertex",j,b,E,u._contextWasLost),z(e,"fragment",j,b,E,u._contextWasLost),E,a,u.validateShaderPrograms)}function A(i,x){const e=new j,E=J(i);return E.parallelShaderCompile&&!E.disableParallelShaderCompile&&(e.isParallelCompiled=!0),e.context=E._context,e}function K(i,x,e,j){let E=arguments.length>5?arguments[5]:void 0;const a=j.createProgram();if(i.program=a,!a)throw new Error("Unable to create program");return j.attachShader(a,x),j.attachShader(a,e),j.linkProgram(a),i.context=j,i.vertexShader=x,i.fragmentShader=e,i.isParallelCompiled||o(i,j,E),a}function L(i,x,e){const j=i;if(j._isDisposed)return!1;const E=J(x);return!!(E&&E.parallelShaderCompile&&E.parallelShaderCompile.COMPLETION_STATUS_KHR&&j.program&&x.getProgramParameter(j.program,E.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(o(j,x,e),!0)}function o(i,x,e){const j=i.context,E=i.vertexShader,a=i.fragmentShader,Y=i.program;if(!j.getProgramParameter(Y,j.LINK_STATUS)){if(!x.getShaderParameter(E,x.COMPILE_STATUS)){const e=x.getShaderInfoLog(E);if(e)throw i.vertexCompilationError=e,new Error("VERTEX SHADER "+e)}if(!x.getShaderParameter(a,x.COMPILE_STATUS)){const e=x.getShaderInfoLog(a);if(e)throw i.fragmentCompilationError=e,new Error("FRAGMENT SHADER "+e)}const e=j.getProgramInfoLog(Y);if(e)throw i.programLinkError=e,new Error(e)}if(e){j.validateProgram(Y);if(!j.getProgramParameter(Y,j.VALIDATE_STATUS)){const x=j.getProgramInfoLog(Y);if(x)throw i.programValidationError=x,new Error(x)}}j.deleteShader(E),j.deleteShader(a),i.vertexShader=void 0,i.fragmentShader=void 0,i.onCompiled&&(i.onCompiled(),i.onCompiled=void 0)}function M(i,x,e,j,E,a,Y,u,A){let K=arguments.length>10?arguments[10]:void 0,L=arguments.length>11?arguments[11]:void 0,o=arguments.length>12?arguments[12]:void 0;const M=J(i.context);L||(L=M.createRawShaderProgramInjection??b),o||(o=M.createShaderProgramInjection??g);const z=i;z.program=j?L(z,x,e,z.context,A):o(z,x,e,u,z.context,A),z.program.__SPECTOR_rebuildProgram=Y,K()}function z(i,x,e,j,a,Y){return T((0,E.f)(i,e,j),x,a,Y)}function T(i,x,e,j){const E=e.createShader("vertex"===x?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(!E){let i=e.NO_ERROR,E=e.NO_ERROR;for(;(E=e.getError())!==e.NO_ERROR;)i=E;throw new Error(`Something went wrong while creating a gl ${x} shader object. gl error=${i}, gl isContextLost=${e.isContextLost()}, _contextWasLost=${j}`)}return e.shaderSource(E,i),e.compileShader(E),E}function Q(i,x){x.useProgram(i)}function t(i,x){const e=i;if(!e.isParallelCompiled)return void x(i);const j=e.onCompiled;e.onCompiled=()=>{null===j||void 0===j||j(),x(i)}}},12165:(i,x,e)=>{e.d(x,{d:()=>A,f:()=>L,j:()=>b,k:()=>g});var j=e(12069),E=e(12169),a=e(12162),Y=e(12072),J=e(12132),u=e(12135);function b(i,x){return(0,E.D)(x).cachedPipelines[i]}function g(i){const x=i._name,e=i.context;if(x&&e){const i=(0,E.D)(e),j=i.cachedPipelines[x];null===j||void 0===j||j.dispose(),delete i.cachedPipelines[x]}}function A(i,x,e,E,a,Y,u){let b,g;const A=(0,j.i)()?null===Y||void 0===Y?void 0:Y.getHostDocument():null;b="string"===typeof x?x:x.vertexSource?"source:"+x.vertexSource:x.vertexElement?(null===A||void 0===A?void 0:A.getElementById(x.vertexElement))||x.vertexElement:x.vertex||x,g="string"===typeof x?x:x.fragmentSource?"source:"+x.fragmentSource:x.fragmentElement?(null===A||void 0===A?void 0:A.getElementById(x.fragmentElement))||x.fragmentElement:x.fragment||x;const L=[void 0,void 0],o=()=>{if(L[0]&&L[1]){i.isFragment=!0;const[j,b]=L;(0,J.h)(b,i,((Y,b)=>{u&&(u._fragmentSourceCodeBeforeMigration=b),e&&(Y=e("fragment",Y));const g=(0,J.b)(j,Y,i);i=null;const A=function(i,x,e,j){if(e){return{vertexSourceCode:(1===j?"//":"")+"#define SHADER_NAME vertex:"+(e.vertexElement||e.vertex||e.spectorName||e)+"\n"+i,fragmentSourceCode:(1===j?"//":"")+"#define SHADER_NAME fragment:"+(e.fragmentElement||e.fragment||e.spectorName||e)+"\n"+x}}return{vertexSourceCode:i,fragmentSourceCode:x}}(g.vertexCode,g.fragmentCode,x,a);null===E||void 0===E||E(A.vertexSourceCode,A.fragmentSourceCode)}),Y)}};K(b,"Vertex","",(x=>{(0,J.c)(i),(0,J.h)(x,i,((i,j)=>{u&&(u._rawVertexSourceCode=x,u._vertexSourceCodeBeforeMigration=j),e&&(i=e("vertex",i)),L[0]=i,o()}),Y)}),a),K(g,"Fragment","Pixel",(i=>{u&&(u._rawFragmentSourceCode=i),L[1]=i,o()}),a)}function K(i,x,e,E,Y,J){if("undefined"!==typeof HTMLElement&&i instanceof HTMLElement){return void E((0,j.b)(i))}if("source:"===i.substring(0,7))return void E(i.substring(7));if("base64:"===i.substring(0,7)){return void E(window.atob(i.substring(7)))}const b=a.c.GetShadersStore(Y);if(b[i+x+"Shader"])return void E(b[i+x+"Shader"]);if(e&&b[i+e+"Shader"])return void E(b[i+e+"Shader"]);let g;if(g="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:a.c.GetShadersRepository(Y)+i,!(J=J||u.i))throw new Error("loadFileInjection is not defined");J(g+"."+x.toLowerCase()+".fx",E)}const L=(i,x,e,j)=>{try{const a=i.context?(0,E.D)(i.context):null;a&&(a.disableParallelShaderCompile=i.disableParallelCompilation);const Y=i.existingPipelineContext||x(i.shaderProcessingContext);return Y._name=i.name,i.name&&a&&(a.cachedPipelines[i.name]=Y),e(Y,i.vertex,i.fragment,!!i.createAsRaw,"","",i.rebuildRebind,i.defines,i.transformFeedbackVaryings,"",(()=>{j(Y,(()=>{var x;null===(x=i.onRenderingStateCompiled)||void 0===x||x.call(i,Y)}))})),Y}catch(a){throw Y.c.Error("Error compiling effect"),a}}},12158:(i,x,e)=>{e.r(x),e.d(x,{Effect:()=>u});var j=e(12065),E=e(12072),a=e(12162),Y=e(12165),J=e(12142);class u{static get ShadersRepository(){return a.c.ShadersRepository}static set ShadersRepository(i){a.c.ShadersRepository=i}get M(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new j.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9?arguments[9]:void 0,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,M=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new j.b,this.onErrorObservable=new j.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=i,this._key=L;const z=this._key.replace(/\r/g,"").replace(/\n/g,"|");let T;if(x.attributes){const i=x;if(this._engine=e,this._attributesNames=i.attributes,this._uniformsNames=i.uniformsNames.concat(i.samplers),this._samplerList=i.samplers.slice(),this.defines=i.defines,this.onError=i.onError,this.onCompiled=i.onCompiled,this._fallbacks=i.fallbacks,this._indexParameters=i.indexParameters,this._transformFeedbackVaryings=i.transformFeedbackVaryings||null,this._multiTarget=!!i.multiTarget,this._shaderLanguage=i.shaderLanguage??0,this._disableParallelShaderCompilation=!!i.disableParallelShaderCompilation,i.uniformBuffersNames){this._uniformBuffersNamesList=i.uniformBuffersNames.slice();for(let x=0;x<i.uniformBuffersNames.length;x++)this._uniformBuffersNames[i.uniformBuffersNames[x]]=x}this._processFinalCode=i.processFinalCode??null,this._processCodeAfterIncludes=i.processCodeAfterIncludes??void 0,M=i.extraInitializationsAsync,T=i.existingPipelineContext}else this._engine=a,this.defines=null==J?"":J,this._uniformsNames=e.concat(E),this._samplerList=E?E.slice():[],this._attributesNames=x,this._uniformBuffersNamesList=[],this._shaderLanguage=o,this.onError=A,this.onCompiled=g,this._indexParameters=K,this._fallbacks=b;"WEBGL2"===this._engine.shaderPlatformName&&(T=(0,Y.j)(z,this._engine._gl)??T),this._attributeLocationByName={},this.uniqueId=u._UniqueIdSeed++,T?(this._pipelineContext=T,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,M),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.M||this.dispose(!0)}))}async _processShaderCodeAsync(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3?arguments[3]:void 0;j&&await j(),this._processingContext=e||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const E={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:i??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:a.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,ue:this._engine.ue,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Y.d)(E,this.name,this._processFinalCode,((i,e)=>{this._vertexSourceCode=i,this._fragmentSourceCode=e,this._prepareEffect(x)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.M||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(i){return this._attributes[i]}getAttributeLocationByName(i){return this._attributeLocationByName[i]}getAttributesCount(){return this._attributes.length}getUniformIndex(i){return this._uniformsNames.indexOf(i)}getUniform(i){return this._uniforms[i]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((i=>{this.executeWhenCompiled(i)}))}executeWhenCompiled(i){this.isReady()?i(this):(this.onCompileObservable.add((x=>{i(x)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(i){(0,J.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(x=>{this._processCompilationErrors(x,i)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var i;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(i=this._pipelineContext)||void 0===i?void 0:i._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var i;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(i=this._pipelineContext)||void 0===i?void 0:i._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,ue:this._engine.ue,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(i,x,e,j){this._isReady=!1,this._vertexSourceCodeOverride=i,this._fragmentSourceCodeOverride=x,this.onError=(i,x)=>{j&&j(x)},this.onCompiled=()=>{var i,x;const j=this.getEngine().scenes;if(j)for(let e=0;e<j.length;e++)j[e].markAllMaterialsAsDirty(127);null===(i=(x=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===i||i.call(x,e)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(i){if(this._pipelineContext=i,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let x=0;x<this._attributesNames.length;x++){const i=this._attributesNames[x];this._attributeLocationByName[i]=this._attributes[x]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),u.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x=this._pipelineContext;this._isReady=!1;try{const e=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),j=e?null:this.defines,E=e?this._vertexSourceCodeOverride:this._vertexSourceCode,a=e?this._fragmentSourceCodeOverride:this._fragmentSourceCode,J=this._engine;this._pipelineContext=(0,Y.f)({existingPipelineContext:i?x:null,vertex:E,fragment:a,context:"WEBGL2"===J.shaderPlatformName||"WEBGL1"===J.shaderPlatformName?J._gl:void 0,rebuildRebind:(i,x,e,j)=>this._rebuildProgram(i,x,e,j),defines:j,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:e,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:e=>{x&&!i&&this._engine._deletePipelineContext(x),e&&this._onRenderingStateCompiled(e)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(x)}catch(e){this._processCompilationErrors(e,x)}}_getShaderCodeAndErrorLine(i,x,e){const j=e?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let E=null;if(x&&i){const a=x.match(j);if(a&&2===a.length){const x=parseInt(a[1]),j=i.split("\n",-1);j.length>=x&&(E=`Offending line [${x}] in ${e?"fragment":"vertex"} code: ${j[x-1]}`)}}return[i,E]}_processCompilationErrors(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=i.message;const e=this._attributesNames,j=this._fallbacks;if(E.c.Error("Unable to compile effect:"),E.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),E.c.Error(`Attributes: ${e.join(" ")}`),E.c.Error("Defines:\n"+this.defines),u.LogShaderCodeOnCompilationError){var a,Y;let i=null,x=null,e=null;var J;if(null!==(a=this._pipelineContext)&&void 0!==a&&a._getVertexShaderCode()&&([e,i]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),e&&(E.c.Error("Vertex code:"),E.c.Error(e))),null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getFragmentShaderCode())[e,x]=this._getShaderCodeAndErrorLine(null===(J=this._pipelineContext)||void 0===J?void 0:J._getFragmentShaderCode(),this._compilationError,!0),e&&(E.c.Error("Fragment code:"),E.c.Error(e));i&&E.c.Error(i),x&&E.c.Error(x)}E.c.Error("Error: "+this._compilationError);const b=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};x&&(this._pipelineContext=x,this._isReady=!0,b()),j?(this._pipelineContext=null,j.hasMoreFallbacks?(this._allFallbacksProcessed=!1,E.c.Error("Trying next fallback."),this.defines=j.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,b(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,x||b())}get isSupported(){return""===this._compilationError}_bindTexture(i,x){this._engine._bindTexture(this._samplers[i],x,i)}setTexture(i,x){this._engine.setTexture(this._samplers[i],this._uniforms[i],x,i)}setTextureArray(i,x){const e=i+"Ex";if(-1===this._samplerList.indexOf(e+"0")){const j=this._samplerList.indexOf(i);for(let i=1;i<x.length;i++){const x=e+(i-1).toString();this._samplerList.splice(j+i,0,x)}let E=0;for(const i of this._samplerList)this._samplers[i]=E,E+=1}this._engine.setTextureArray(this._samplers[i],this._uniforms[i],x,i)}bindUniformBuffer(i,x){const e=this._uniformBuffersNames[x];void 0===e||u._BaseCache[e]===i&&this._engine._features.useUBOBindingCache||(u._BaseCache[e]=i,this._engine.bindUniformBufferBase(i,e,x))}bindUniformBlock(i,x){this._engine.bindUniformBlock(this._pipelineContext,i,x)}setInt(i,x){return this._pipelineContext.setInt(i,x),this}setInt2(i,x,e){return this._pipelineContext.setInt2(i,x,e),this}setInt3(i,x,e,j){return this._pipelineContext.setInt3(i,x,e,j),this}setInt4(i,x,e,j,E){return this._pipelineContext.setInt4(i,x,e,j,E),this}setIntArray(i,x){return this._pipelineContext.setIntArray(i,x),this}setIntArray2(i,x){return this._pipelineContext.setIntArray2(i,x),this}setIntArray3(i,x){return this._pipelineContext.setIntArray3(i,x),this}setIntArray4(i,x){return this._pipelineContext.setIntArray4(i,x),this}setUInt(i,x){return this._pipelineContext.setUInt(i,x),this}setUInt2(i,x,e){return this._pipelineContext.setUInt2(i,x,e),this}setUInt3(i,x,e,j){return this._pipelineContext.setUInt3(i,x,e,j),this}setUInt4(i,x,e,j,E){return this._pipelineContext.setUInt4(i,x,e,j,E),this}setUIntArray(i,x){return this._pipelineContext.setUIntArray(i,x),this}setUIntArray2(i,x){return this._pipelineContext.setUIntArray2(i,x),this}setUIntArray3(i,x){return this._pipelineContext.setUIntArray3(i,x),this}setUIntArray4(i,x){return this._pipelineContext.setUIntArray4(i,x),this}setFloatArray(i,x){return this._pipelineContext.setArray(i,x),this}setFloatArray2(i,x){return this._pipelineContext.setArray2(i,x),this}setFloatArray3(i,x){return this._pipelineContext.setArray3(i,x),this}setFloatArray4(i,x){return this._pipelineContext.setArray4(i,x),this}setArray(i,x){return this._pipelineContext.setArray(i,x),this}setArray2(i,x){return this._pipelineContext.setArray2(i,x),this}setArray3(i,x){return this._pipelineContext.setArray3(i,x),this}setArray4(i,x){return this._pipelineContext.setArray4(i,x),this}setMatrices(i,x){return this._pipelineContext.setMatrices(i,x),this}setMatrix(i,x){return this._pipelineContext.setMatrix(i,x),this}setMatrix3x3(i,x){return this._pipelineContext.setMatrix3x3(i,x),this}setMatrix2x2(i,x){return this._pipelineContext.setMatrix2x2(i,x),this}setFloat(i,x){return this._pipelineContext.setFloat(i,x),this}setBool(i,x){return this._pipelineContext.setInt(i,x?1:0),this}setVector2(i,x){return this._pipelineContext.setVector2(i,x),this}setFloat2(i,x,e){return this._pipelineContext.setFloat2(i,x,e),this}setVector3(i,x){return this._pipelineContext.setVector3(i,x),this}setFloat3(i,x,e,j){return this._pipelineContext.setFloat3(i,x,e,j),this}setVector4(i,x){return this._pipelineContext.setVector4(i,x),this}setQuaternion(i,x){return this._pipelineContext.setQuaternion(i,x),this}setFloat4(i,x,e,j,E){return this._pipelineContext.setFloat4(i,x,e,j,E),this}setColor3(i,x){return this._pipelineContext.setColor3(i,x),this}setColor4(i,x,e){return this._pipelineContext.setColor4(i,x,e),this}setDirectColor4(i,x){return this._pipelineContext.setDirectColor4(i,x),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(u.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Y.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;x&&(a.c.GetShadersStore(j)[`${i}PixelShader`]=x),e&&(a.c.GetShadersStore(j)[`${i}VertexShader`]=e)}static ResetCache(){u._BaseCache={}}}u.LogShaderCodeOnCompilationError=!0,u.PersistentMode=!1,u.AutomaticallyClearCodeCache=!1,u._UniqueIdSeed=0,u._BaseCache={},u.ShadersStore=a.c.ShadersStore,u.IncludesShadersStore=a.c.IncludesShadersStore},12092:(i,x,e)=>{e.d(x,{e:()=>E});const j={};function E(i){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!j[i])return j[i]=!0,`${i} needs to be imported before as it contains a side-effect required by your code.`}},12069:(i,x,e)=>{function j(){return"undefined"!==typeof window}function E(){return"undefined"!==typeof navigator}function a(){return"undefined"!==typeof document}function Y(i){let x="",e=i.firstChild;for(;e;)3===e.nodeType&&(x+=e.textContent),e=e.nextSibling;return x}e.d(x,{b:()=>Y,c:()=>a,f:()=>E,i:()=>j})},12072:(i,x,e)=>{e.d(x,{c:()=>j});class j{static _CheckLimit(i,x){let e=j._LogLimitOutputs[i];return e?e.current++:(e={limit:x,current:1},j._LogLimitOutputs[i]=e),e.current<=e.limit}static _GenerateLimitMessage(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const e=j._LogLimitOutputs[i];if(!e||!j.MessageLimitReached)return;const E=this._Levels[x];e.current===e.limit&&j[E.name](j.MessageLimitReached.replace(/%LIMIT%/g,""+e.limit).replace(/%TYPE%/g,E.name??""))}static _AddLogEntry(i){j._LogCache=i+j._LogCache,j.OnNewCacheEntry&&j.OnNewCacheEntry(i)}static _FormatMessage(i){const x=i=>i<10?"0"+i:""+i,e=new Date;return"["+x(e.getHours())+":"+x(e.getMinutes())+":"+x(e.getSeconds())+"]: "+i}static _LogDisabled(i,x){}static _LogEnabled(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const E=Array.isArray(x)?x[0]:x;if(void 0!==e&&!j._CheckLimit(E,e))return;const a=j._FormatMessage(E),Y=this._Levels[i],J=Array.isArray(x)?x.slice(1):[];Y.logFunc&&Y.logFunc("BJS - "+a,...J);const u=`<div style='color:${Y.color}'>${a}</div><br>`;j._AddLogEntry(u),j._GenerateLimitMessage(E,i)}static get LogCache(){return j._LogCache}static ClearLogCache(){j._LogCache="",j._LogLimitOutputs={},j.errorsCount=0}static set LogLevels(i){j.Log=j._LogDisabled,j.Warn=j._LogDisabled,j.Error=j._LogDisabled;const x=[j.MessageLogLevel,j.WarningLogLevel,j.ErrorLogLevel];for(const e of x)if((i&e)===e){const i=this._Levels[e];j[i.name]=j._LogEnabled.bind(j,e)}}}j.NoneLogLevel=0,j.MessageLogLevel=1,j.WarningLogLevel=2,j.ErrorLogLevel=4,j.AllLogLevel=7,j.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",j._LogCache="",j._LogLimitOutputs={},j._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],j.errorsCount=0,j.Log=j._LogEnabled.bind(j,j.MessageLogLevel),j.Warn=j._LogEnabled.bind(j,j.WarningLogLevel),j.Error=j._LogEnabled.bind(j,j.ErrorLogLevel)},12065:(i,x,e)=>{e.d(x,{b:()=>Y});const j="undefined"!==typeof WeakRef;class E{constructor(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;this.initialize(i,x,e,j)}initialize(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;return this.mask=i,this.skipNextObservers=x,this.target=e,this.currentTarget=j,this}}class a{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=i,this.mask=x,this.scope=e,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(i)}}class Y{static FromPromise(i,x){const e=new Y;return i.then((i=>{e.notifyObservers(i)})).catch((i=>{if(!x)throw i;x.notifyObservers(i)})),e}get observers(){return this._observers}constructor(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=x,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new E(0),i&&(this._onObserverAdded=i)}add(i){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!i)return null;const E=new a(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);E.unregisterOnNextCall=e,x?this._observers.unshift(E):this._observers.push(E),this._onObserverAdded&&this._onObserverAdded(E),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(E,this._lastNotifiedValue);const Y=j?new WeakRef(this):{deref:()=>this};return E._remove=function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x=Y.deref();x&&(i?x.remove(E):x._remove(E))},E}addOnce(i){return this.add(i,void 0,void 0,void 0,!0)}remove(i){if(!i)return!1;i._remove=null;return-1!==this._observers.indexOf(i)&&(this._deferUnregister(i),!0)}removeCallback(i,x){for(let e=0;e<this._observers.length;e++){const j=this._observers[e];if(!j._willBeUnregistered&&(j.callback===i&&(!x||x===j.scope)))return this._deferUnregister(j),!0}return!1}_deferUnregister(i){i._willBeUnregistered||(this._numObserversMarkedAsDeleted++,i.unregisterOnNextCall=!1,i._willBeUnregistered=!0,setTimeout((()=>{this._remove(i)}),0))}_remove(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!i)return!1;const e=this._observers.indexOf(i);return-1!==e&&(x&&this._numObserversMarkedAsDeleted--,this._observers.splice(e,1),!0)}makeObserverTopPriority(i){this._remove(i,!1),this._observers.unshift(i)}makeObserverBottomPriority(i){this._remove(i,!1),this._observers.push(i)}notifyObservers(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,e=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=i),!this._observers.length)return!0;const a=this._eventState;a.mask=x,a.target=e,a.currentTarget=j,a.skipNextObservers=!1,a.lastReturnValue=i,a.userInfo=E;for(const Y of this._observers)if(!Y._willBeUnregistered&&(Y.mask&x&&(Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.scope?a.lastReturnValue=Y.callback.apply(Y.scope,[i,a]):a.lastReturnValue=Y.callback(i,a)),a.skipNextObservers))return!1;return!0}notifyObserver(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=x),i._willBeUnregistered)return;const j=this._eventState;j.mask=e,j.skipNextObservers=!1,i.unregisterOnNextCall&&this._deferUnregister(i),i.callback(x,j)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const i=this._observers.pop();i&&(i._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const i=new Y;return i._observers=this._observers.slice(0),i}hasSpecificMask(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const x of this._observers)if(x.mask&i||x.mask===i)return!0;return!1}}},12142:(i,x,e)=>{e.d(x,{b:()=>E,d:()=>Y});let j=[];class E{static SetImmediate(i){0===j.length&&setTimeout((()=>{const i=j;j=[];for(const x of i)x()}),1),j.push(i)}}function a(i,x,e){try{if(i())return x(),!0}catch(j){return null===e||void 0===e||e(j),!0}return!1}const Y=function(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Y=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&a(i,x,e))return null;const J=setInterval((()=>{a(i,x,e)?clearInterval(J):(E-=j,E<0&&(clearInterval(J),null===e||void 0===e||e(new Error("Operation timed out after maximum retries. "+(Y||"")),!0)))}),j);return()=>clearInterval(J)}}}]);