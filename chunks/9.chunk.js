"use strict";(self.fyqbdzs5tyo=self.fyqbdzs5tyo||[]).push([[9],{11122:(V,I,A)=>{A.d(I,{e:()=>e,g:()=>m,o:()=>s,k:()=>f,p:()=>R});class B{constructor(){this.children=[]}isValid(V){return!0}process(V,I,A){let B="";if(this.line){let A=this.line;const X=I.processor;if(X){var F,E,Y,H,c,b;X.lineProcessor&&(A=X.lineProcessor(A,I.isFragment,I.processingContext));const B=(null===(F=I.processor)||void 0===F?void 0:F.attributeKeywordName)??"attribute",P=I.isFragment&&null!==(E=I.processor)&&void 0!==E&&E.varyingFragmentKeywordName?null===(Y=I.processor)||void 0===Y?void 0:Y.varyingFragmentKeywordName:!I.isFragment&&null!==(H=I.processor)&&void 0!==H&&H.varyingVertexKeywordName?null===(c=I.processor)||void 0===c?void 0:c.varyingVertexKeywordName:"varying";if(!I.isFragment&&X.attributeProcessor&&this.line.startsWith(B))A=X.attributeProcessor(this.line,V,I.processingContext);else if(X.varyingProcessor&&(null!==(b=X.varyingCheck)&&void 0!==b&&b.call(X,this.line,I.isFragment)||!X.varyingCheck&&this.line.startsWith(P)))A=X.varyingProcessor(this.line,I.isFragment,V,I.processingContext);else if(X.uniformProcessor&&X.uniformRegexp&&X.uniformRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(A=X.uniformProcessor(this.line,I.isFragment,V,I.processingContext));else if(X.uniformBufferProcessor&&X.uniformBufferRegexp&&X.uniformBufferRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(A=X.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0);else if(X.textureProcessor&&X.textureRegexp&&X.textureRegexp.test(this.line))A=X.textureProcessor(this.line,I.isFragment,V,I.processingContext);else if((X.uniformProcessor||X.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!I.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?X.uniformProcessor&&(A=X.uniformProcessor(this.line,I.isFragment,V,I.processingContext)):X.uniformBufferProcessor&&(A=X.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0)}I.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(I.lookForClosingBracketForUniformBuffer=!1,X.endOfUniformBufferProcessor&&(A=X.endOfUniformBufferProcessor(this.line,I.isFragment,I.processingContext)))}B+=A+"\n"}for(const X of this.children)B+=X.process(V,I,A);return this.additionalDefineKey&&(V[this.additionalDefineKey]=this.additionalDefineValue||"true",A[this.additionalDefineKey]=V[this.additionalDefineKey]),B}}class F{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(V){this._lines.length=0;for(const I of V){if(!I||"\r"===I)continue;if("#"===I[0]){this._lines.push(I);continue}const V=I.trim();if(!V)continue;if(V.startsWith("//")){this._lines.push(I);continue}const A=V.indexOf(";");if(-1===A)this._lines.push(V);else if(A===V.length-1)V.length>1&&this._lines.push(V);else{const V=I.split(";");for(let I=0;I<V.length;I++){let A=V[I];A&&(A=A.trim(),A&&this._lines.push(A+(I!==V.length-1?";":"")))}}}}}class E extends B{process(V,I,A){for(let B=0;B<this.children.length;B++){const F=this.children[B];if(F.isValid(V))return F.process(V,I,A)}return""}}class Y extends B{isValid(V){return this.testExpression.isTrue(V)}}class H{isTrue(V){return!0}static postfixToInfix(V){const I=[];for(const A of V)if(void 0===H._OperatorPriority[A])I.push(A);else{const V=I[I.length-1],B=I[I.length-2];I.length-=2,I.push(`(${B}${A}${V})`)}return I[I.length-1]}static infixToPostfix(V){const I=H._InfixToPostfixCache.get(V);if(I)return I.accessTime=Date.now(),I.result;if(!V.includes("&&")&&!V.includes("||")&&!V.includes(")")&&!V.includes("("))return[V];const A=[];let B=-1;const F=()=>{X=X.trim(),""!==X&&(A.push(X),X="")},E=V=>{B<H._Stack.length-1&&(H._Stack[++B]=V)},Y=()=>H._Stack[B],c=()=>-1===B?"!!INVALID EXPRESSION!!":H._Stack[B--];let b=0,X="";for(;b<V.length;){const I=V.charAt(b),P=b<V.length-1?V.substring(b,2+b):"";if("("===I)X="",E(I);else if(")"===I){for(F();-1!==B&&"("!==Y();)A.push(c());c()}else if(H._OperatorPriority[P]>1){for(F();-1!==B&&H._OperatorPriority[Y()]>=H._OperatorPriority[P];)A.push(c());E(P),b++}else X+=I;b++}for(F();-1!==B;)"("===Y()?c():A.push(c());return H._InfixToPostfixCache.size>=H.InfixToPostfixCacheLimitSize&&H.ClearCache(),H._InfixToPostfixCache.set(V,{result:A,accessTime:Date.now()}),A}static ClearCache(){const V=Array.from(H._InfixToPostfixCache.entries()).sort(((V,I)=>V[1].accessTime-I[1].accessTime));for(let I=0;I<H.InfixToPostfixCacheCleanupSize;I++)H._InfixToPostfixCache.delete(V[I][0])}}H.InfixToPostfixCacheLimitSize=5e4,H.InfixToPostfixCacheCleanupSize=25e3,H._InfixToPostfixCache=new Map,H._OperatorPriority={")":0,"(":1,"||":2,"&&":3},H._Stack=["","","","","","","","","","","","","","","","","","","",""];class c extends H{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=V,this.not=I}isTrue(V){let I=void 0!==V[this.define];return this.not&&(I=!I),I}}class b extends H{isTrue(V){return this.leftOperand.isTrue(V)||this.rightOperand.isTrue(V)}}class X extends H{isTrue(V){return this.leftOperand.isTrue(V)&&this.rightOperand.isTrue(V)}}class P extends H{constructor(V,I,A){super(),this.define=V,this.operand=I,this.testValue=A}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(V){let I=!1;const A=parseInt(void 0!=V[this.define]?V[this.define]:this.define),B=parseInt(void 0!=V[this.testValue]?V[this.testValue]:this.testValue);if(isNaN(A)||isNaN(B))return!1;switch(this.operand){case">":I=A>B;break;case"<":I=A<B;break;case"<=":I=A<=B;break;case">=":I=A>=B;break;case"==":I=A===B;break;case"!=":I=A!==B}return I}}var J=A(11084),G=A(11127);const w=/defined\s*?\((.+?)\)/g,t=/defined\s*?\[(.+?)\]/g,u=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,W=/__decl__/,g=/light\{X\}.(\w*)/g,o=/\{X\}/g,L=[],z=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function m(V){V.processor&&V.processor.initializeShaders&&V.processor.initializeShaders(V.processingContext)}function s(V,I,A,B){var F;null!==(F=I.processor)&&void 0!==F&&F.preProcessShaderCode&&(V=I.processor.preProcessShaderCode(V,I.isFragment)),f(V,I,(V=>{I.processCodeAfterIncludes&&(V=I.processCodeAfterIncludes(I.isFragment?"fragment":"vertex",V,I.defines));const F=function(V,I,A){let B=function(V,I){var A;if(null!==(A=I.processor)&&void 0!==A&&A.noPrecision)return V;const B=I.shouldUseHighPrecisionShader;-1===V.indexOf("precision highp float")?V=B?"precision highp float;\n"+V:"precision mediump float;\n"+V:B||(V=V.replace("precision highp float","precision mediump float"));return V}(V,I);if(!I.processor)return B;if(0===I.processor.shaderLanguage&&-1!==B.indexOf("#version 3")&&(B=B.replace("#version 300 es",""),!I.processor.parseGLES3))return B;const F=I.defines,E=x(I,A);I.processor.preProcessor&&(B=I.processor.preProcessor(B,F,E,I.isFragment,I.processingContext));const Y={};B=M(B,E,I,Y),I.processor.postProcessor&&(B=I.processor.postProcessor(B,F,I.isFragment,I.processingContext,A?{drawBuffersExtensionDisabled:!A.getCaps().drawBuffersExtension}:{},E,Y));null!==A&&void 0!==A&&A._features.needShaderCodeInlining&&(B=A.inlineShaderCode(B));return B}(V,I,B);A(F,V)}))}function e(V,I,A){return A.processor&&A.processor.finalizeShaders?A.processor.finalizeShaders(V,I,A.processingContext):{vertexCode:V,fragmentCode:I}}function S(V){const I=/defined\((.+)\)/.exec(V);if(I&&I.length)return new c(I[1].trim(),"!"===V[0]);const A=["==","!=",">=","<=","<",">"];let B="",F=0;for(B of A)if(F=V.indexOf(B),F>-1)break;if(-1===F)return new c(V);const E=V.substring(0,F).trim(),Y=V.substring(F+B.length).trim();return new P(E,B,Y)}function Q(V,I){const A=new Y,B=V.substring(0,I);let F=V.substring(I);return F=F.substring(0,(F.indexOf("//")+1||F.length+1)-1).trim(),A.testExpression="#ifdef"===B?new c(F):"#ifndef"===B?new c(F,!0):function(V){V=V.replace(w,"defined[$1]");const I=H.infixToPostfix(V),A=[];for(const F of I)if("||"!==F&&"&&"!==F)A.push(F);else if(A.length>=2){let V=A[A.length-1],I=A[A.length-2];A.length-=2;const B="&&"==F?new X:new b;"string"===typeof V&&(V=V.replace(t,"defined($1)")),"string"===typeof I&&(I=I.replace(t,"defined($1)")),B.leftOperand="string"===typeof I?S(I):I,B.rightOperand="string"===typeof V?S(V):V,A.push(B)}let B=A[A.length-1];return"string"===typeof B&&(B=B.replace(t,"defined($1)")),"string"===typeof B?S(B):B}(F),A}function h(V,I,A,F){let E=V.currentLine;for(;r(V,A,F);){E=V.currentLine;const Y=E.substring(0,5).toLowerCase();if("#else"===Y){const A=new B;return I.children.push(A),void r(V,A,F)}if("#elif"===Y){const V=Q(E,5);I.children.push(V),A=V}}}function r(V,I,A){for(;V.canRead;){V.lineIndex++;const F=V.currentLine;if(F.indexOf("#")>=0){const B=z.exec(F);if(B&&B.length){switch(B[0]){case"#ifdef":{const B=new E;I.children.push(B);const Y=Q(F,6);B.children.push(Y),h(V,B,Y,A);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const B=new E;I.children.push(B);const Y=Q(F,7);B.children.push(Y),h(V,B,Y,A);break}case"#if":{const B=new E,Y=Q(F,3);I.children.push(B),B.children.push(Y),h(V,B,Y,A);break}}continue}}const Y=new B;if(Y.line=F,I.children.push(Y),"#"===F[0]&&"d"===F[1]){const V=F.replace(";","").split(" ");Y.additionalDefineKey=V[1],3===V.length&&(Y.additionalDefineValue=V[2])}}return!1}function M(V,I,A,E){const Y=new B,H=new F;return H.lineIndex=-1,H.lines=V.split("\n"),r(H,Y,E),Y.process(I,A,E)}function x(V,I){var A;const B=V.defines,F={};for(const E of B){const V=E.replace("#define","").replace(";","").trim().split(" ");F[V[0]]=V.length>1?V[1]:""}return 0===(null===(A=V.processor)||void 0===A?void 0:A.shaderLanguage)&&(F.GL_ES="true"),F.__VERSION__=V.version,F[V.platformName]="true",(0,G.g)(F,null===I||void 0===I?void 0:I.isNDCHalfZRange,null===I||void 0===I?void 0:I.useReverseDepthBuffer,null===I||void 0===I?void 0:I.useExactSrgbConversions),F}function f(V,I,A){let B;for(L.length=0;null!==(B=u.exec(V));)L.push(B);let F=String(V),E=[V],Y=!1;for(const H of L){let V=H[1];if(-1!==V.indexOf("__decl__")&&(V=V.replace(W,""),I.supportsUniformBuffers&&(V=V.replace("Vertex","Ubo").replace("Fragment","Ubo")),V+="Declaration"),!I.includesShadersStore[V]){const B=I.shadersRepository+"ShadersInclude/"+V+".fx";return void R.loadFile(B,(B=>{I.includesShadersStore[V]=B,f(E.join(""),I,A)}))}{let A=I.includesShadersStore[V];if(H[2]){const V=H[3].split(",");for(let I=0;I<V.length;I+=2){const B=new RegExp(V[I],"g"),F=V[I+1];A=A.replace(B,F)}}if(H[4]){const V=H[5];if(-1!==V.indexOf("..")){const B=V.split(".."),F=parseInt(B[0]);let E=parseInt(B[1]),Y=A.slice(0);A="",isNaN(E)&&(E=I.indexParameters[B[1]]);for(let V=F;V<E;V++)I.supportsUniformBuffers||(Y=Y.replace(g,((V,I)=>I+"{X}"))),A+=Y.replace(o,V.toString())+"\n"}else I.supportsUniformBuffers||(A=A.replace(g,((V,I)=>I+"{X}"))),A=A.replace(o,V)}const B=[];for(const V of E){const I=V.split(H[0]);for(let V=0;V<I.length-1;V++)B.push(I[V]),B.push(A);B.push(I[I.length-1])}E=B,Y=Y||A.indexOf("#include<")>=0||A.indexOf("#include <")>=0}}L.length=0,F=E.join(""),Y?f(F.toString(),I,A):A(F)}const R={loadFile:(V,I,A,B,F,E)=>{throw(0,J.e)("FileTools")}}},11127:(V,I,A)=>{A.d(I,{c:()=>F,e:()=>E,g:()=>H,i:()=>Y,l:()=>c});var B=A(11084);A(11062);const F={};function E(V,I){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(I?I+"\n":"")+V}function Y(V,I,A,E,Y,H,c){const b=c||F.loadFile;if(b){return b(V,I,A,E,Y,H)}throw(0,B.e)("FileTools")}function H(V,I,A,B){if(V)return I?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,A?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(B?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return I&&(V+="#define IS_NDC_HALF_ZRANGE"),A&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),B&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}function c(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;switch(V){case 3:{const V=(ArrayBuffer,new Int8Array(I));return B&&V.set(new Int8Array(B)),V}case 0:{const V=(ArrayBuffer,new Uint8Array(I));return B&&V.set(new Uint8Array(B)),V}case 4:{const V=I instanceof ArrayBuffer?new Int16Array(I):new Int16Array(A?I/2:I);return B&&V.set(new Int16Array(B)),V}case 5:case 8:case 9:case 10:case 2:{const V=I instanceof ArrayBuffer?new Uint16Array(I):new Uint16Array(A?I/2:I);return B&&V.set(new Uint16Array(B)),V}case 6:{const V=I instanceof ArrayBuffer?new Int32Array(I):new Int32Array(A?I/4:I);return B&&V.set(new Int32Array(B)),V}case 7:case 11:case 12:case 13:case 14:case 15:{const V=I instanceof ArrayBuffer?new Uint32Array(I):new Uint32Array(A?I/4:I);return B&&V.set(new Uint32Array(B)),V}case 1:{const V=I instanceof ArrayBuffer?new Float32Array(I):new Float32Array(A?I/4:I);return B&&V.set(new Float32Array(B)),V}}const F=(ArrayBuffer,new Uint8Array(I));return B&&F.set(new Uint8Array(B)),F}},11152:(V,I,A)=>{A.d(I,{e:()=>B});class B{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersRepository:B.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersStore:B.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.IncludesShadersStore:B.IncludesShadersStoreWGSL}}B.ShadersRepository="src/Shaders/",B.ShadersStore={},B.IncludesShadersStore={},B.ShadersRepositoryWGSL="src/ShadersWGSL/",B.ShadersStoreWGSL={},B.IncludesShadersStoreWGSL={}},11162:(V,I,A)=>{A.d(I,{b:()=>J,e:()=>o,f:()=>w,g:()=>G,i:()=>t,l:()=>g,p:()=>P,r:()=>b,u:()=>X,x:()=>c,y:()=>H});class B{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.wI._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(V){V&&this.program&&V(this.program)}setEngine(V){this.wI=V}_fillEffectInformation(V,I,A,B,F,E,Y,H){const c=this.wI;if(c.supportsUniformBuffers)for(const X in I)V.bindUniformBlock(X,I[X]);let b;for(this.wI.getUniforms(this,A).forEach(((V,I)=>{B[A[I]]=V})),this._uniforms=B,b=0;b<F.length;b++){null==V.getUniform(F[b])&&(F.splice(b,1),b--)}F.forEach(((V,I)=>{E[V]=I}));for(const X of c.getAttributes(this,Y))H.push(X)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(V,I){const A=this._valueCache[V],B=I.updateFlag;return(void 0===A||A!==B)&&(this._valueCache[V]=B,!0)}_cacheFloat2(V,I,A){let B=this._valueCache[V];if(!B||2!==B.length)return B=[I,A],this._valueCache[V]=B,!0;let F=!1;return B[0]!==I&&(B[0]=I,F=!0),B[1]!==A&&(B[1]=A,F=!0),F}_cacheFloat3(V,I,A,B){let F=this._valueCache[V];if(!F||3!==F.length)return F=[I,A,B],this._valueCache[V]=F,!0;let E=!1;return F[0]!==I&&(F[0]=I,E=!0),F[1]!==A&&(F[1]=A,E=!0),F[2]!==B&&(F[2]=B,E=!0),E}_cacheFloat4(V,I,A,B,F){let E=this._valueCache[V];if(!E||4!==E.length)return E=[I,A,B,F],this._valueCache[V]=E,!0;let Y=!1;return E[0]!==I&&(E[0]=I,Y=!0),E[1]!==A&&(E[1]=A,Y=!0),E[2]!==B&&(E[2]=B,Y=!0),E[3]!==F&&(E[3]=F,Y=!0),Y}setInt(V,I){const A=this._valueCache[V];void 0!==A&&A===I||this.wI.setInt(this._uniforms[V],I)&&(this._valueCache[V]=I)}setInt2(V,I,A){this._cacheFloat2(V,I,A)&&(this.wI.setInt2(this._uniforms[V],I,A)||(this._valueCache[V]=null))}setInt3(V,I,A,B){this._cacheFloat3(V,I,A,B)&&(this.wI.setInt3(this._uniforms[V],I,A,B)||(this._valueCache[V]=null))}setInt4(V,I,A,B,F){this._cacheFloat4(V,I,A,B,F)&&(this.wI.setInt4(this._uniforms[V],I,A,B,F)||(this._valueCache[V]=null))}setIntArray(V,I){this._valueCache[V]=null,this.wI.setIntArray(this._uniforms[V],I)}setIntArray2(V,I){this._valueCache[V]=null,this.wI.setIntArray2(this._uniforms[V],I)}setIntArray3(V,I){this._valueCache[V]=null,this.wI.setIntArray3(this._uniforms[V],I)}setIntArray4(V,I){this._valueCache[V]=null,this.wI.setIntArray4(this._uniforms[V],I)}setUInt(V,I){const A=this._valueCache[V];void 0!==A&&A===I||this.wI.setUInt(this._uniforms[V],I)&&(this._valueCache[V]=I)}setUInt2(V,I,A){this._cacheFloat2(V,I,A)&&(this.wI.setUInt2(this._uniforms[V],I,A)||(this._valueCache[V]=null))}setUInt3(V,I,A,B){this._cacheFloat3(V,I,A,B)&&(this.wI.setUInt3(this._uniforms[V],I,A,B)||(this._valueCache[V]=null))}setUInt4(V,I,A,B,F){this._cacheFloat4(V,I,A,B,F)&&(this.wI.setUInt4(this._uniforms[V],I,A,B,F)||(this._valueCache[V]=null))}setUIntArray(V,I){this._valueCache[V]=null,this.wI.setUIntArray(this._uniforms[V],I)}setUIntArray2(V,I){this._valueCache[V]=null,this.wI.setUIntArray2(this._uniforms[V],I)}setUIntArray3(V,I){this._valueCache[V]=null,this.wI.setUIntArray3(this._uniforms[V],I)}setUIntArray4(V,I){this._valueCache[V]=null,this.wI.setUIntArray4(this._uniforms[V],I)}setArray(V,I){this._valueCache[V]=null,this.wI.setArray(this._uniforms[V],I)}setArray2(V,I){this._valueCache[V]=null,this.wI.setArray2(this._uniforms[V],I)}setArray3(V,I){this._valueCache[V]=null,this.wI.setArray3(this._uniforms[V],I)}setArray4(V,I){this._valueCache[V]=null,this.wI.setArray4(this._uniforms[V],I)}setMatrices(V,I){I&&(this._valueCache[V]=null,this.wI.setMatrices(this._uniforms[V],I))}setMatrix(V,I){this._cacheMatrix(V,I)&&(this.wI.setMatrices(this._uniforms[V],I.AH())||(this._valueCache[V]=null))}setMatrix3x3(V,I){this._valueCache[V]=null,this.wI.setMatrix3x3(this._uniforms[V],I)}setMatrix2x2(V,I){this._valueCache[V]=null,this.wI.setMatrix2x2(this._uniforms[V],I)}setFloat(V,I){const A=this._valueCache[V];void 0!==A&&A===I||this.wI.setFloat(this._uniforms[V],I)&&(this._valueCache[V]=I)}setVector2(V,I){this._cacheFloat2(V,I.x,I.y)&&(this.wI.setFloat2(this._uniforms[V],I.x,I.y)||(this._valueCache[V]=null))}setFloat2(V,I,A){this._cacheFloat2(V,I,A)&&(this.wI.setFloat2(this._uniforms[V],I,A)||(this._valueCache[V]=null))}setVector3(V,I){this._cacheFloat3(V,I.x,I.y,I.z)&&(this.wI.setFloat3(this._uniforms[V],I.x,I.y,I.z)||(this._valueCache[V]=null))}setFloat3(V,I,A,B){this._cacheFloat3(V,I,A,B)&&(this.wI.setFloat3(this._uniforms[V],I,A,B)||(this._valueCache[V]=null))}setVector4(V,I){this._cacheFloat4(V,I.x,I.y,I.z,I.w)&&(this.wI.setFloat4(this._uniforms[V],I.x,I.y,I.z,I.w)||(this._valueCache[V]=null))}setQuaternion(V,I){this._cacheFloat4(V,I.x,I.y,I.z,I.w)&&(this.wI.setFloat4(this._uniforms[V],I.x,I.y,I.z,I.w)||(this._valueCache[V]=null))}setFloat4(V,I,A,B,F){this._cacheFloat4(V,I,A,B,F)&&(this.wI.setFloat4(this._uniforms[V],I,A,B,F)||(this._valueCache[V]=null))}setColor3(V,I){this._cacheFloat3(V,I.r,I.g,I.b)&&(this.wI.setFloat3(this._uniforms[V],I.r,I.g,I.b)||(this._valueCache[V]=null))}setColor4(V,I,A){this._cacheFloat4(V,I.r,I.g,I.b,A)&&(this.wI.setFloat4(this._uniforms[V],I.r,I.g,I.b,A)||(this._valueCache[V]=null))}setDirectColor4(V,I){this._cacheFloat4(V,I.r,I.g,I.b,I.a)&&(this.wI.setFloat4(this._uniforms[V],I.r,I.g,I.b,I.a)||(this._valueCache[V]=null))}_getVertexShaderCode(){return this.vertexShader?this.wI._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.wI._getShaderSource(this.fragmentShader):null}}var F=A(11127);const E=new WeakMap,Y={_webGLVersion:2,cachedPipelines:{}};function H(V){let I=E.get(V);if(!I){if(!V)return Y;I={_webGLVersion:V.TEXTURE_BINDING_3D?2:1,_context:V,parallelShaderCompile:V.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},E.set(V,I)}return I}function c(V){E.delete(V)}function b(V,I,A,B,F,E){const Y=H(B);E||(E=Y._createShaderProgramInjection??J);return E(V,W(I,"vertex",B,Y._contextWasLost),W(A,"fragment",B,Y._contextWasLost),B,F,Y.validateShaderPrograms)}function X(V,I,A,B,F){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;const c=H(F);Y||(Y=c._createShaderProgramInjection??J);const b=c._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Y(V,u(I,"vertex",B,b,F,c._contextWasLost),u(A,"fragment",B,b,F,c._contextWasLost),F,E,c.validateShaderPrograms)}function P(V,I){const A=new B,F=H(V);return F.parallelShaderCompile&&!F.disableParallelShaderCompile&&(A.isParallelCompiled=!0),A.context=F._context,A}function J(V,I,A,B){let F=arguments.length>5?arguments[5]:void 0;const E=B.createProgram();if(V.program=E,!E)throw new Error("Unable to create program");return B.attachShader(E,I),B.attachShader(E,A),B.linkProgram(E),V.context=B,V.vertexShader=I,V.fragmentShader=A,V.isParallelCompiled||w(V,B,F),E}function G(V,I,A){const B=V;if(B._isDisposed)return!1;const F=H(I);return!!(F&&F.parallelShaderCompile&&F.parallelShaderCompile.COMPLETION_STATUS_KHR&&B.program&&I.getProgramParameter(B.program,F.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(w(B,I,A),!0)}function w(V,I,A){const B=V.context,F=V.vertexShader,E=V.fragmentShader,Y=V.program;if(!B.getProgramParameter(Y,B.LINK_STATUS)){if(!I.getShaderParameter(F,I.COMPILE_STATUS)){const A=I.getShaderInfoLog(F);if(A)throw V.vertexCompilationError=A,new Error("VERTEX SHADER "+A)}if(!I.getShaderParameter(E,I.COMPILE_STATUS)){const A=I.getShaderInfoLog(E);if(A)throw V.fragmentCompilationError=A,new Error("FRAGMENT SHADER "+A)}const A=B.getProgramInfoLog(Y);if(A)throw V.programLinkError=A,new Error(A)}if(A){B.validateProgram(Y);if(!B.getProgramParameter(Y,B.VALIDATE_STATUS)){const I=B.getProgramInfoLog(Y);if(I)throw V.programValidationError=I,new Error(I)}}B.deleteShader(F),B.deleteShader(E),V.vertexShader=void 0,V.fragmentShader=void 0,V.onCompiled&&(V.onCompiled(),V.onCompiled=void 0)}function t(V,I,A,B,F,E,Y,c,P){let J=arguments.length>10?arguments[10]:void 0,G=arguments.length>11?arguments[11]:void 0,w=arguments.length>12?arguments[12]:void 0;const t=H(V.context);G||(G=t.createRawShaderProgramInjection??b),w||(w=t.createShaderProgramInjection??X);const u=V;u.program=B?G(u,I,A,u.context,P):w(u,I,A,c,u.context,P),u.program.__SPECTOR_rebuildProgram=Y,J()}function u(V,I,A,B,E,Y){return W((0,F.e)(V,A,B),I,E,Y)}function W(V,I,A,B){const F=A.createShader("vertex"===I?A.VERTEX_SHADER:A.FRAGMENT_SHADER);if(!F){let V=A.NO_ERROR,F=A.NO_ERROR;for(;(F=A.getError())!==A.NO_ERROR;)V=F;throw new Error(`Something went wrong while creating a gl ${I} shader object. gl error=${V}, gl isContextLost=${A.isContextLost()}, _contextWasLost=${B}`)}return A.shaderSource(F,V),A.compileShader(F),F}function g(V,I){I.useProgram(V)}function o(V,I){const A=V;if(!A.isParallelCompiled)return void I(V);const B=A.onCompiled;A.onCompiled=()=>{null===B||void 0===B||B(),I(V)}}},11155:(V,I,A)=>{A.d(I,{c:()=>P,g:()=>G,k:()=>b,o:()=>X});var B=A(11062),F=A(11162),E=A(11152),Y=A(11064),H=A(11122),c=A(11127);function b(V,I){return(0,F.y)(I).cachedPipelines[V]}function X(V){const I=V._name,A=V.context;if(I&&A){const V=(0,F.y)(A),B=V.cachedPipelines[I];null===B||void 0===B||B.dispose(),delete V.cachedPipelines[I]}}function P(V,I,A,F,E,Y,c){let b,X;const P=(0,B.k)()?null===Y||void 0===Y?void 0:Y.getHostDocument():null;b="string"===typeof I?I:I.vertexSource?"source:"+I.vertexSource:I.vertexElement?(null===P||void 0===P?void 0:P.getElementById(I.vertexElement))||I.vertexElement:I.vertex||I,X="string"===typeof I?I:I.fragmentSource?"source:"+I.fragmentSource:I.fragmentElement?(null===P||void 0===P?void 0:P.getElementById(I.fragmentElement))||I.fragmentElement:I.fragment||I;const G=[void 0,void 0],w=()=>{if(G[0]&&G[1]){V.isFragment=!0;const[B,b]=G;(0,H.o)(b,V,((Y,b)=>{c&&(c._fragmentSourceCodeBeforeMigration=b),A&&(Y=A("fragment",Y));const X=(0,H.e)(B,Y,V);V=null;const P=function(V,I,A,B){if(A){return{vertexSourceCode:(1===B?"//":"")+"#define SHADER_NAME vertex:"+(A.vertexElement||A.vertex||A.spectorName||A)+"\n"+V,fragmentSourceCode:(1===B?"//":"")+"#define SHADER_NAME fragment:"+(A.fragmentElement||A.fragment||A.spectorName||A)+"\n"+I}}return{vertexSourceCode:V,fragmentSourceCode:I}}(X.vertexCode,X.fragmentCode,I,E);null===F||void 0===F||F(P.vertexSourceCode,P.fragmentSourceCode)}),Y)}};J(b,"Vertex","",(I=>{(0,H.g)(V),(0,H.o)(I,V,((V,B)=>{c&&(c._rawVertexSourceCode=I,c._vertexSourceCodeBeforeMigration=B),A&&(V=A("vertex",V)),G[0]=V,w()}),Y)}),E),J(X,"Fragment","Pixel",(V=>{c&&(c._rawFragmentSourceCode=V),G[1]=V,w()}),E)}function J(V,I,A,F,Y,H){if("undefined"!==typeof HTMLElement&&V instanceof HTMLElement){return void F((0,B.e)(V))}if("source:"===V.substring(0,7))return void F(V.substring(7));if("base64:"===V.substring(0,7)){return void F(window.atob(V.substring(7)))}const b=E.e.GetShadersStore(Y);if(b[V+I+"Shader"])return void F(b[V+I+"Shader"]);if(A&&b[V+A+"Shader"])return void F(b[V+A+"Shader"]);let X;if(X="."===V[0]||"/"===V[0]||V.indexOf("http")>-1?V:E.e.GetShadersRepository(Y)+V,!(H=H||c.i))throw new Error("loadFileInjection is not defined");H(X+"."+I.toLowerCase()+".fx",F)}const G=(V,I,A,B)=>{try{const E=V.context?(0,F.y)(V.context):null;E&&(E.disableParallelShaderCompile=V.disableParallelCompilation);const Y=V.existingPipelineContext||I(V.shaderProcessingContext);return Y._name=V.name,V.name&&E&&(E.cachedPipelines[V.name]=Y),A(Y,V.vertex,V.fragment,!!V.createAsRaw,"","",V.rebuildRebind,V.defines,V.transformFeedbackVaryings,"",(()=>{B(Y,(()=>{var I;null===(I=V.onRenderingStateCompiled)||void 0===I||I.call(V,Y)}))})),Y}catch(E){throw Y.b.Error("Error compiling effect"),E}}},11143:(V,I,A)=>{A.r(I),A.d(I,{Effect:()=>c});var B=A(11057),F=A(11064),E=A(11152),Y=A(11155),H=A(11135);class c{static get ShadersRepository(){return E.e.ShadersRepository}static set ShadersRepository(V){E.e.ShadersRepository=V}get H(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9?arguments[9]:void 0,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,t=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new B.c,this.onErrorObservable=new B.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=V,this._key=G;const u=this._key.replace(/\r/g,"").replace(/\n/g,"|");let W;if(I.attributes){const V=I;if(this._engine=A,this._attributesNames=V.attributes,this._uniformsNames=V.uniformsNames.concat(V.samplers),this._samplerList=V.samplers.slice(),this.defines=V.defines,this.onError=V.onError,this.onCompiled=V.onCompiled,this._fallbacks=V.fallbacks,this._indexParameters=V.indexParameters,this._transformFeedbackVaryings=V.transformFeedbackVaryings||null,this._multiTarget=!!V.multiTarget,this._shaderLanguage=V.shaderLanguage??0,this._disableParallelShaderCompilation=!!V.disableParallelShaderCompilation,V.uniformBuffersNames){this._uniformBuffersNamesList=V.uniformBuffersNames.slice();for(let I=0;I<V.uniformBuffersNames.length;I++)this._uniformBuffersNames[V.uniformBuffersNames[I]]=I}this._processFinalCode=V.processFinalCode??null,this._processCodeAfterIncludes=V.processCodeAfterIncludes??void 0,t=V.extraInitializationsAsync,W=V.existingPipelineContext}else this._engine=E,this.defines=null==H?"":H,this._uniformsNames=A.concat(F),this._samplerList=F?F.slice():[],this._attributesNames=I,this._uniformBuffersNamesList=[],this._shaderLanguage=w,this.onError=P,this.onCompiled=X,this._indexParameters=J,this._fallbacks=b;"WEBGL2"===this._engine.shaderPlatformName&&(W=(0,Y.k)(u,this._engine._gl)??W),this._attributeLocationByName={},this.uniqueId=c._UniqueIdSeed++,W?(this._pipelineContext=W,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,t),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.H||this.dispose(!0)}))}async _processShaderCodeAsync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0;B&&await B(),this._processingContext=A||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const F={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:V??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:E.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:E.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Y.c)(F,this.name,this._processFinalCode,((V,A)=>{this._vertexSourceCode=V,this._fragmentSourceCode=A,this._prepareEffect(I)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.H||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(V){return this._attributes[V]}getAttributeLocationByName(V){return this._attributeLocationByName[V]}getAttributesCount(){return this._attributes.length}getUniformIndex(V){return this._uniformsNames.indexOf(V)}getUniform(V){return this._uniforms[V]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((V=>{this.executeWhenCompiled(V)}))}executeWhenCompiled(V){this.isReady()?V(this):(this.onCompileObservable.add((I=>{V(I)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(V){(0,H.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(I=>{this._processCompilationErrors(I,V)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(V,I,A,B){this._isReady=!1,this._vertexSourceCodeOverride=V,this._fragmentSourceCodeOverride=I,this.onError=(V,I)=>{B&&B(I)},this.onCompiled=()=>{var V,I;const B=this.getEngine().scenes;if(B)for(let A=0;A<B.length;A++)B[A].markAllMaterialsAsDirty(127);null===(V=(I=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===V||V.call(I,A)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(V){if(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let I=0;I<this._attributesNames.length;I++){const V=this._attributesNames[I];this._attributeLocationByName[V]=this._attributes[I]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),c.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this._pipelineContext;this._isReady=!1;try{const A=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),B=A?null:this.defines,F=A?this._vertexSourceCodeOverride:this._vertexSourceCode,E=A?this._fragmentSourceCodeOverride:this._fragmentSourceCode,H=this._engine;this._pipelineContext=(0,Y.g)({existingPipelineContext:V?I:null,vertex:F,fragment:E,context:"WEBGL2"===H.shaderPlatformName||"WEBGL1"===H.shaderPlatformName?H._gl:void 0,rebuildRebind:(V,I,A,B)=>this._rebuildProgram(V,I,A,B),defines:B,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:A,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:A=>{I&&!V&&this._engine._deletePipelineContext(I),A&&this._onRenderingStateCompiled(A)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(I)}catch(A){this._processCompilationErrors(A,I)}}_getShaderCodeAndErrorLine(V,I,A){const B=A?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let F=null;if(I&&V){const E=I.match(B);if(E&&2===E.length){const I=parseInt(E[1]),B=V.split("\n",-1);B.length>=I&&(F=`Offending line [${I}] in ${A?"fragment":"vertex"} code: ${B[I-1]}`)}}return[V,F]}_processCompilationErrors(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=V.message;const A=this._attributesNames,B=this._fallbacks;if(F.b.Error("Unable to compile effect:"),F.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),F.b.Error(`Attributes: ${A.join(" ")}`),F.b.Error("Defines:\n"+this.defines),c.LogShaderCodeOnCompilationError){var E,Y;let V=null,I=null,A=null;var H;if(null!==(E=this._pipelineContext)&&void 0!==E&&E._getVertexShaderCode()&&([A,V]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),A&&(F.b.Error("Vertex code:"),F.b.Error(A))),null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getFragmentShaderCode())[A,I]=this._getShaderCodeAndErrorLine(null===(H=this._pipelineContext)||void 0===H?void 0:H._getFragmentShaderCode(),this._compilationError,!0),A&&(F.b.Error("Fragment code:"),F.b.Error(A));V&&F.b.Error(V),I&&F.b.Error(I)}F.b.Error("Error: "+this._compilationError);const b=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};I&&(this._pipelineContext=I,this._isReady=!0,b()),B?(this._pipelineContext=null,B.hasMoreFallbacks?(this._allFallbacksProcessed=!1,F.b.Error("Trying next fallback."),this.defines=B.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,b(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,I||b())}get isSupported(){return""===this._compilationError}_bindTexture(V,I){this._engine._bindTexture(this._samplers[V],I,V)}setTexture(V,I){this._engine.setTexture(this._samplers[V],this._uniforms[V],I,V)}setTextureArray(V,I){const A=V+"Ex";if(-1===this._samplerList.indexOf(A+"0")){const B=this._samplerList.indexOf(V);for(let V=1;V<I.length;V++){const I=A+(V-1).toString();this._samplerList.splice(B+V,0,I)}let F=0;for(const V of this._samplerList)this._samplers[V]=F,F+=1}this._engine.setTextureArray(this._samplers[V],this._uniforms[V],I,V)}bindUniformBuffer(V,I){const A=this._uniformBuffersNames[I];void 0===A||c._BaseCache[A]===V&&this._engine._features.useUBOBindingCache||(c._BaseCache[A]=V,this._engine.bindUniformBufferBase(V,A,I))}bindUniformBlock(V,I){this._engine.bindUniformBlock(this._pipelineContext,V,I)}setInt(V,I){return this._pipelineContext.setInt(V,I),this}setInt2(V,I,A){return this._pipelineContext.setInt2(V,I,A),this}setInt3(V,I,A,B){return this._pipelineContext.setInt3(V,I,A,B),this}setInt4(V,I,A,B,F){return this._pipelineContext.setInt4(V,I,A,B,F),this}setIntArray(V,I){return this._pipelineContext.setIntArray(V,I),this}setIntArray2(V,I){return this._pipelineContext.setIntArray2(V,I),this}setIntArray3(V,I){return this._pipelineContext.setIntArray3(V,I),this}setIntArray4(V,I){return this._pipelineContext.setIntArray4(V,I),this}setUInt(V,I){return this._pipelineContext.setUInt(V,I),this}setUInt2(V,I,A){return this._pipelineContext.setUInt2(V,I,A),this}setUInt3(V,I,A,B){return this._pipelineContext.setUInt3(V,I,A,B),this}setUInt4(V,I,A,B,F){return this._pipelineContext.setUInt4(V,I,A,B,F),this}setUIntArray(V,I){return this._pipelineContext.setUIntArray(V,I),this}setUIntArray2(V,I){return this._pipelineContext.setUIntArray2(V,I),this}setUIntArray3(V,I){return this._pipelineContext.setUIntArray3(V,I),this}setUIntArray4(V,I){return this._pipelineContext.setUIntArray4(V,I),this}setFloatArray(V,I){return this._pipelineContext.setArray(V,I),this}setFloatArray2(V,I){return this._pipelineContext.setArray2(V,I),this}setFloatArray3(V,I){return this._pipelineContext.setArray3(V,I),this}setFloatArray4(V,I){return this._pipelineContext.setArray4(V,I),this}setArray(V,I){return this._pipelineContext.setArray(V,I),this}setArray2(V,I){return this._pipelineContext.setArray2(V,I),this}setArray3(V,I){return this._pipelineContext.setArray3(V,I),this}setArray4(V,I){return this._pipelineContext.setArray4(V,I),this}setMatrices(V,I){return this._pipelineContext.setMatrices(V,I),this}setMatrix(V,I){return this._pipelineContext.setMatrix(V,I),this}setMatrix3x3(V,I){return this._pipelineContext.setMatrix3x3(V,I),this}setMatrix2x2(V,I){return this._pipelineContext.setMatrix2x2(V,I),this}setFloat(V,I){return this._pipelineContext.setFloat(V,I),this}setBool(V,I){return this._pipelineContext.setInt(V,I?1:0),this}setVector2(V,I){return this._pipelineContext.setVector2(V,I),this}setFloat2(V,I,A){return this._pipelineContext.setFloat2(V,I,A),this}setVector3(V,I){return this._pipelineContext.setVector3(V,I),this}setFloat3(V,I,A,B){return this._pipelineContext.setFloat3(V,I,A,B),this}setVector4(V,I){return this._pipelineContext.setVector4(V,I),this}setQuaternion(V,I){return this._pipelineContext.setQuaternion(V,I),this}setFloat4(V,I,A,B,F){return this._pipelineContext.setFloat4(V,I,A,B,F),this}setColor3(V,I){return this._pipelineContext.setColor3(V,I),this}setColor4(V,I,A){return this._pipelineContext.setColor4(V,I,A),this}setDirectColor4(V,I){return this._pipelineContext.setDirectColor4(V,I),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(c.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Y.o)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;I&&(E.e.GetShadersStore(B)[`${V}PixelShader`]=I),A&&(E.e.GetShadersStore(B)[`${V}VertexShader`]=A)}static ResetCache(){c._BaseCache={}}}c.LogShaderCodeOnCompilationError=!0,c.PersistentMode=!1,c.AutomaticallyClearCodeCache=!1,c._UniqueIdSeed=0,c._BaseCache={},c.ShadersStore=E.e.ShadersStore,c.IncludesShadersStore=E.e.IncludesShadersStore},11084:(V,I,A)=>{A.d(I,{e:()=>F});const B={};function F(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!B[V])return B[V]=!0,`${V} needs to be imported before as it contains a side-effect required by your code.`}},11062:(V,I,A)=>{function B(){return"undefined"!==typeof window}function F(){return"undefined"!==typeof navigator}function E(){return"undefined"!==typeof document}function Y(V){let I="",A=V.firstChild;for(;A;)3===A.nodeType&&(I+=A.textContent),A=A.nextSibling;return I}A.d(I,{e:()=>Y,f:()=>E,j:()=>F,k:()=>B})},11064:(V,I,A)=>{A.d(I,{b:()=>B});class B{static _CheckLimit(V,I){let A=B._LogLimitOutputs[V];return A?A.current++:(A={limit:I,current:1},B._LogLimitOutputs[V]=A),A.current<=A.limit}static _GenerateLimitMessage(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const A=B._LogLimitOutputs[V];if(!A||!B.MessageLimitReached)return;const F=this._Levels[I];A.current===A.limit&&B[F.name](B.MessageLimitReached.replace(/%LIMIT%/g,""+A.limit).replace(/%TYPE%/g,F.name??""))}static _AddLogEntry(V){B._LogCache=V+B._LogCache,B.OnNewCacheEntry&&B.OnNewCacheEntry(V)}static _FormatMessage(V){const I=V=>V<10?"0"+V:""+V,A=new Date;return"["+I(A.getHours())+":"+I(A.getMinutes())+":"+I(A.getSeconds())+"]: "+V}static _LogDisabled(V,I){}static _LogEnabled(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const F=Array.isArray(I)?I[0]:I;if(void 0!==A&&!B._CheckLimit(F,A))return;const E=B._FormatMessage(F),Y=this._Levels[V],H=Array.isArray(I)?I.slice(1):[];Y.logFunc&&Y.logFunc("BJS - "+E,...H);const c=`<div style='color:${Y.color}'>${E}</div><br>`;B._AddLogEntry(c),B._GenerateLimitMessage(F,V)}static get LogCache(){return B._LogCache}static ClearLogCache(){B._LogCache="",B._LogLimitOutputs={},B.errorsCount=0}static set LogLevels(V){B.Log=B._LogDisabled,B.Warn=B._LogDisabled,B.Error=B._LogDisabled;const I=[B.MessageLogLevel,B.WarningLogLevel,B.ErrorLogLevel];for(const A of I)if((V&A)===A){const V=this._Levels[A];B[V.name]=B._LogEnabled.bind(B,A)}}}B.NoneLogLevel=0,B.MessageLogLevel=1,B.WarningLogLevel=2,B.ErrorLogLevel=4,B.AllLogLevel=7,B.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",B._LogCache="",B._LogLimitOutputs={},B._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],B.errorsCount=0,B.Log=B._LogEnabled.bind(B,B.MessageLogLevel),B.Warn=B._LogEnabled.bind(B,B.WarningLogLevel),B.Error=B._LogEnabled.bind(B,B.ErrorLogLevel)},11057:(V,I,A)=>{A.d(I,{c:()=>Y});const B="undefined"!==typeof WeakRef;class F{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.initialize(V,I,A,B)}initialize(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;return this.mask=V,this.skipNextObservers=I,this.target=A,this.currentTarget=B,this}}class E{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=V,this.mask=I,this.scope=A,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(V)}}class Y{static FromPromise(V,I){const A=new Y;return V.then((V=>{A.notifyObservers(V)})).catch((V=>{if(!I)throw V;I.notifyObservers(V)})),A}get observers(){return this._observers}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=I,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new F(0),V&&(this._onObserverAdded=V)}add(V){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)return null;const F=new E(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);F.unregisterOnNextCall=A,I?this._observers.unshift(F):this._observers.push(F),this._onObserverAdded&&this._onObserverAdded(F),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(F,this._lastNotifiedValue);const Y=B?new WeakRef(this):{deref:()=>this};return F._remove=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=Y.deref();I&&(V?I.remove(F):I._remove(F))},F}addOnce(V){return this.add(V,void 0,void 0,void 0,!0)}remove(V){if(!V)return!1;V._remove=null;return-1!==this._observers.indexOf(V)&&(this._deferUnregister(V),!0)}removeCallback(V,I){for(let A=0;A<this._observers.length;A++){const B=this._observers[A];if(!B._willBeUnregistered&&(B.callback===V&&(!I||I===B.scope)))return this._deferUnregister(B),!0}return!1}_deferUnregister(V){V._willBeUnregistered||(this._numObserversMarkedAsDeleted++,V.unregisterOnNextCall=!1,V._willBeUnregistered=!0,setTimeout((()=>{this._remove(V)}),0))}_remove(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V)return!1;const A=this._observers.indexOf(V);return-1!==A&&(I&&this._numObserversMarkedAsDeleted--,this._observers.splice(A,1),!0)}makeObserverTopPriority(V){this._remove(V,!1),this._observers.unshift(V)}makeObserverBottomPriority(V){this._remove(V,!1),this._observers.push(V)}notifyObservers(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,A=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),!this._observers.length)return!0;const E=this._eventState;E.mask=I,E.target=A,E.currentTarget=B,E.skipNextObservers=!1,E.lastReturnValue=V,E.userInfo=F;for(const Y of this._observers)if(!Y._willBeUnregistered&&(Y.mask&I&&(Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.scope?E.lastReturnValue=Y.callback.apply(Y.scope,[V,E]):E.lastReturnValue=Y.callback(V,E)),E.skipNextObservers))return!1;return!0}notifyObserver(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=I),V._willBeUnregistered)return;const B=this._eventState;B.mask=A,B.skipNextObservers=!1,V.unregisterOnNextCall&&this._deferUnregister(V),V.callback(I,B)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const V=this._observers.pop();V&&(V._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const V=new Y;return V._observers=this._observers.slice(0),V}hasSpecificMask(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const I of this._observers)if(I.mask&V||I.mask===V)return!0;return!1}}},11135:(V,I,A)=>{A.d(I,{c:()=>F,e:()=>Y});let B=[];class F{static SetImmediate(V){0===B.length&&setTimeout((()=>{const V=B;B=[];for(const I of V)I()}),1),B.push(V)}}function E(V,I,A){try{if(V())return I(),!0}catch(B){return null===A||void 0===A||A(B),!0}return!1}const Y=function(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Y=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&E(V,I,A))return null;const H=setInterval((()=>{E(V,I,A)?clearInterval(H):(F-=B,F<0&&(clearInterval(H),null===A||void 0===A||A(new Error("Operation timed out after maximum retries. "+(Y||"")),!0)))}),B);return()=>clearInterval(H)}}}]);