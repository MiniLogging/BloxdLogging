"use strict";(self.h66iwo8dvgq=self.h66iwo8dvgq||[]).push([[9],{11749:(b,X,P)=>{P.d(X,{b:()=>v,d:()=>L,j:()=>Z,h:()=>i,m:()=>x});class Q{constructor(){this.children=[]}isValid(b){return!0}process(b,X,P){let Q="";if(this.line){let P=this.line;const f=X.processor;if(f){var S,d,N,a,u,w;f.lineProcessor&&(P=f.lineProcessor(P,X.isFragment,X.processingContext));const Q=(null===(S=X.processor)||void 0===S?void 0:S.attributeKeywordName)??"attribute",O=X.isFragment&&null!==(d=X.processor)&&void 0!==d&&d.varyingFragmentKeywordName?null===(N=X.processor)||void 0===N?void 0:N.varyingFragmentKeywordName:!X.isFragment&&null!==(a=X.processor)&&void 0!==a&&a.varyingVertexKeywordName?null===(u=X.processor)||void 0===u?void 0:u.varyingVertexKeywordName:"varying";if(!X.isFragment&&f.attributeProcessor&&this.line.startsWith(Q))P=f.attributeProcessor(this.line,b,X.processingContext);else if(f.varyingProcessor&&(null!==(w=f.varyingCheck)&&void 0!==w&&w.call(f,this.line,X.isFragment)||!f.varyingCheck&&this.line.startsWith(O)))P=f.varyingProcessor(this.line,X.isFragment,b,X.processingContext);else if(f.uniformProcessor&&f.uniformRegexp&&f.uniformRegexp.test(this.line))X.lookForClosingBracketForUniformBuffer||(P=f.uniformProcessor(this.line,X.isFragment,b,X.processingContext));else if(f.uniformBufferProcessor&&f.uniformBufferRegexp&&f.uniformBufferRegexp.test(this.line))X.lookForClosingBracketForUniformBuffer||(P=f.uniformBufferProcessor(this.line,X.isFragment,X.processingContext),X.lookForClosingBracketForUniformBuffer=!0);else if(f.textureProcessor&&f.textureRegexp&&f.textureRegexp.test(this.line))P=f.textureProcessor(this.line,X.isFragment,b,X.processingContext);else if((f.uniformProcessor||f.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!X.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?f.uniformProcessor&&(P=f.uniformProcessor(this.line,X.isFragment,b,X.processingContext)):f.uniformBufferProcessor&&(P=f.uniformBufferProcessor(this.line,X.isFragment,X.processingContext),X.lookForClosingBracketForUniformBuffer=!0)}X.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(X.lookForClosingBracketForUniformBuffer=!1,f.endOfUniformBufferProcessor&&(P=f.endOfUniformBufferProcessor(this.line,X.isFragment,X.processingContext)))}Q+=P+"\n"}for(const f of this.children)Q+=f.process(b,X,P);return this.additionalDefineKey&&(b[this.additionalDefineKey]=this.additionalDefineValue||"true",P[this.additionalDefineKey]=b[this.additionalDefineKey]),Q}}class S{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(b){this._lines.length=0;for(const X of b){if(!X||"\r"===X)continue;if("#"===X[0]){this._lines.push(X);continue}const b=X.trim();if(!b)continue;if(b.startsWith("//")){this._lines.push(X);continue}const P=b.indexOf(";");if(-1===P)this._lines.push(b);else if(P===b.length-1)b.length>1&&this._lines.push(b);else{const b=X.split(";");for(let X=0;X<b.length;X++){let P=b[X];P&&(P=P.trim(),P&&this._lines.push(P+(X!==b.length-1?";":"")))}}}}}class d extends Q{process(b,X,P){for(let Q=0;Q<this.children.length;Q++){const S=this.children[Q];if(S.isValid(b))return S.process(b,X,P)}return""}}class N extends Q{isValid(b){return this.testExpression.isTrue(b)}}class a{isTrue(b){return!0}static postfixToInfix(b){const X=[];for(const P of b)if(void 0===a._OperatorPriority[P])X.push(P);else{const b=X[X.length-1],Q=X[X.length-2];X.length-=2,X.push(`(${Q}${P}${b})`)}return X[X.length-1]}static infixToPostfix(b){const X=a._InfixToPostfixCache.get(b);if(X)return X.accessTime=Date.now(),X.result;if(!b.includes("&&")&&!b.includes("||")&&!b.includes(")")&&!b.includes("("))return[b];const P=[];let Q=-1;const S=()=>{f=f.trim(),""!==f&&(P.push(f),f="")},d=b=>{Q<a._Stack.length-1&&(a._Stack[++Q]=b)},N=()=>a._Stack[Q],u=()=>-1===Q?"!!INVALID EXPRESSION!!":a._Stack[Q--];let w=0,f="";for(;w<b.length;){const X=b.charAt(w),O=w<b.length-1?b.substring(w,2+w):"";if("("===X)f="",d(X);else if(")"===X){for(S();-1!==Q&&"("!==N();)P.push(u());u()}else if(a._OperatorPriority[O]>1){for(S();-1!==Q&&a._OperatorPriority[N()]>=a._OperatorPriority[O];)P.push(u());d(O),w++}else f+=X;w++}for(S();-1!==Q;)"("===N()?u():P.push(u());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(b,{result:P,accessTime:Date.now()}),P}static ClearCache(){const b=Array.from(a._InfixToPostfixCache.entries()).sort(((b,X)=>b[1].accessTime-X[1].accessTime));for(let X=0;X<a.InfixToPostfixCacheCleanupSize;X++)a._InfixToPostfixCache.delete(b[X][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class u extends a{constructor(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=b,this.not=X}isTrue(b){let X=void 0!==b[this.define];return this.not&&(X=!X),X}}class w extends a{isTrue(b){return this.leftOperand.isTrue(b)||this.rightOperand.isTrue(b)}}class f extends a{isTrue(b){return this.leftOperand.isTrue(b)&&this.rightOperand.isTrue(b)}}class O extends a{constructor(b,X,P){super(),this.define=b,this.operand=X,this.testValue=P}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(b){let X=!1;const P=parseInt(void 0!=b[this.define]?b[this.define]:this.define),Q=parseInt(void 0!=b[this.testValue]?b[this.testValue]:this.testValue);if(isNaN(P)||isNaN(Q))return!1;switch(this.operand){case">":X=P>Q;break;case"<":X=P<Q;break;case"<=":X=P<=Q;break;case">=":X=P>=Q;break;case"==":X=P===Q;break;case"!=":X=P!==Q}return X}}var e=P(11719),Y=P(11752);const D=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,t=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,B=/__decl__/,W=/light\{X\}.(\w*)/g,n=/\{X\}/g,y=[],h=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function L(b){b.processor&&b.processor.initializeShaders&&b.processor.initializeShaders(b.processingContext)}function Z(b,X,P,Q){var S;null!==(S=X.processor)&&void 0!==S&&S.preProcessShaderCode&&(b=X.processor.preProcessShaderCode(b,X.isFragment)),i(b,X,(b=>{X.processCodeAfterIncludes&&(b=X.processCodeAfterIncludes(X.isFragment?"fragment":"vertex",b,X.defines));const S=function(b,X,P){let Q=function(b,X){var P;if(null!==(P=X.processor)&&void 0!==P&&P.noPrecision)return b;const Q=X.shouldUseHighPrecisionShader;-1===b.indexOf("precision highp float")?b=Q?"precision highp float;\n"+b:"precision mediump float;\n"+b:Q||(b=b.replace("precision highp float","precision mediump float"));return b}(b,X);if(!X.processor)return Q;if(0===X.processor.shaderLanguage&&-1!==Q.indexOf("#version 3")&&(Q=Q.replace("#version 300 es",""),!X.processor.parseGLES3))return Q;const S=X.defines,d=V(X,P);X.processor.preProcessor&&(Q=X.processor.preProcessor(Q,S,d,X.isFragment,X.processingContext));const N={};Q=q(Q,d,X,N),X.processor.postProcessor&&(Q=X.processor.postProcessor(Q,S,X.isFragment,X.processingContext,P?{drawBuffersExtensionDisabled:!P.getCaps().drawBuffersExtension}:{},d,N));null!==P&&void 0!==P&&P._features.needShaderCodeInlining&&(Q=P.inlineShaderCode(Q));return Q}(b,X,Q);P(S,b)}))}function v(b,X,P){return P.processor&&P.processor.finalizeShaders?P.processor.finalizeShaders(b,X,P.processingContext):{vertexCode:b,fragmentCode:X}}function A(b){const X=/defined\((.+)\)/.exec(b);if(X&&X.length)return new u(X[1].trim(),"!"===b[0]);const P=["==","!=",">=","<=","<",">"];let Q="",S=0;for(Q of P)if(S=b.indexOf(Q),S>-1)break;if(-1===S)return new u(b);const d=b.substring(0,S).trim(),N=b.substring(S+Q.length).trim();return new O(d,Q,N)}function o(b,X){const P=new N,Q=b.substring(0,X);let S=b.substring(X);return S=S.substring(0,(S.indexOf("//")+1||S.length+1)-1).trim(),P.testExpression="#ifdef"===Q?new u(S):"#ifndef"===Q?new u(S,!0):function(b){b=b.replace(D,"defined[$1]");const X=a.infixToPostfix(b),P=[];for(const S of X)if("||"!==S&&"&&"!==S)P.push(S);else if(P.length>=2){let b=P[P.length-1],X=P[P.length-2];P.length-=2;const Q="&&"==S?new f:new w;"string"===typeof b&&(b=b.replace(E,"defined($1)")),"string"===typeof X&&(X=X.replace(E,"defined($1)")),Q.leftOperand="string"===typeof X?A(X):X,Q.rightOperand="string"===typeof b?A(b):b,P.push(Q)}let Q=P[P.length-1];return"string"===typeof Q&&(Q=Q.replace(E,"defined($1)")),"string"===typeof Q?A(Q):Q}(S),P}function K(b,X,P,S){let d=b.currentLine;for(;T(b,P,S);){d=b.currentLine;const N=d.substring(0,5).toLowerCase();if("#else"===N){const P=new Q;return X.children.push(P),void T(b,P,S)}if("#elif"===N){const b=o(d,5);X.children.push(b),P=b}}}function T(b,X,P){for(;b.canRead;){b.lineIndex++;const S=b.currentLine;if(S.indexOf("#")>=0){const Q=h.exec(S);if(Q&&Q.length){switch(Q[0]){case"#ifdef":{const Q=new d;X.children.push(Q);const N=o(S,6);Q.children.push(N),K(b,Q,N,P);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Q=new d;X.children.push(Q);const N=o(S,7);Q.children.push(N),K(b,Q,N,P);break}case"#if":{const Q=new d,N=o(S,3);X.children.push(Q),Q.children.push(N),K(b,Q,N,P);break}}continue}}const N=new Q;if(N.line=S,X.children.push(N),"#"===S[0]&&"d"===S[1]){const b=S.replace(";","").split(" ");N.additionalDefineKey=b[1],3===b.length&&(N.additionalDefineValue=b[2])}}return!1}function q(b,X,P,d){const N=new Q,a=new S;return a.lineIndex=-1,a.lines=b.split("\n"),T(a,N,d),N.process(X,P,d)}function V(b,X){var P;const Q=b.defines,S={};for(const d of Q){const b=d.replace("#define","").replace(";","").trim().split(" ");S[b[0]]=b.length>1?b[1]:""}return 0===(null===(P=b.processor)||void 0===P?void 0:P.shaderLanguage)&&(S.GL_ES="true"),S.__VERSION__=b.version,S[b.platformName]="true",(0,Y.h)(S,null===X||void 0===X?void 0:X.isNDCHalfZRange,null===X||void 0===X?void 0:X.useReverseDepthBuffer,null===X||void 0===X?void 0:X.useExactSrgbConversions),S}function i(b,X,P){let Q;for(y.length=0;null!==(Q=t.exec(b));)y.push(Q);let S=String(b),d=[b],N=!1;for(const a of y){let b=a[1];if(-1!==b.indexOf("__decl__")&&(b=b.replace(B,""),X.supportsUniformBuffers&&(b=b.replace("Vertex","Ubo").replace("Fragment","Ubo")),b+="Declaration"),!X.includesShadersStore[b]){const Q=X.shadersRepository+"ShadersInclude/"+b+".fx";return void x.loadFile(Q,(Q=>{X.includesShadersStore[b]=Q,i(d.join(""),X,P)}))}{let P=X.includesShadersStore[b];if(a[2]){const b=a[3].split(",");for(let X=0;X<b.length;X+=2){const Q=new RegExp(b[X],"g"),S=b[X+1];P=P.replace(Q,S)}}if(a[4]){const b=a[5];if(-1!==b.indexOf("..")){const Q=b.split(".."),S=parseInt(Q[0]);let d=parseInt(Q[1]),N=P.slice(0);P="",isNaN(d)&&(d=X.indexParameters[Q[1]]);for(let b=S;b<d;b++)X.supportsUniformBuffers||(N=N.replace(W,((b,X)=>X+"{X}"))),P+=N.replace(n,b.toString())+"\n"}else X.supportsUniformBuffers||(P=P.replace(W,((b,X)=>X+"{X}"))),P=P.replace(n,b)}const Q=[];for(const b of d){const X=b.split(a[0]);for(let b=0;b<X.length-1;b++)Q.push(X[b]),Q.push(P);Q.push(X[X.length-1])}d=Q,N=N||P.indexOf("#include<")>=0||P.indexOf("#include <")>=0}}y.length=0,S=d.join(""),N?i(S.toString(),X,P):P(S)}const x={loadFile:(b,X,P,Q,S,d)=>{throw(0,e.b)("FileTools")}}},11752:(b,X,P)=>{P.d(X,{e:()=>S,g:()=>d,h:()=>a,i:()=>N,k:()=>u});var Q=P(11719);P(11696);const S={};function d(b,X){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(X?X+"\n":"")+b}function N(b,X,P,d,N,a,u){const w=u||S.loadFile;if(w){return w(b,X,P,d,N,a)}throw(0,Q.b)("FileTools")}function a(b,X,P,Q){if(b)return X?b.IS_NDC_HALF_ZRANGE="":delete b.IS_NDC_HALF_ZRANGE,P?b.USE_REVERSE_DEPTHBUFFER="":delete b.USE_REVERSE_DEPTHBUFFER,void(Q?b.USE_EXACT_SRGB_CONVERSIONS="":delete b.USE_EXACT_SRGB_CONVERSIONS);{let b="";return X&&(b+="#define IS_NDC_HALF_ZRANGE"),P&&(b&&(b+="\n"),b+="#define USE_REVERSE_DEPTHBUFFER"),Q&&(b&&(b+="\n"),b+="#define USE_EXACT_SRGB_CONVERSIONS"),b}}function u(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;switch(b){case 3:{const b=(ArrayBuffer,new Int8Array(X));return Q&&b.set(new Int8Array(Q)),b}case 0:{const b=(ArrayBuffer,new Uint8Array(X));return Q&&b.set(new Uint8Array(Q)),b}case 4:{const b=X instanceof ArrayBuffer?new Int16Array(X):new Int16Array(P?X/2:X);return Q&&b.set(new Int16Array(Q)),b}case 5:case 8:case 9:case 10:case 2:{const b=X instanceof ArrayBuffer?new Uint16Array(X):new Uint16Array(P?X/2:X);return Q&&b.set(new Uint16Array(Q)),b}case 6:{const b=X instanceof ArrayBuffer?new Int32Array(X):new Int32Array(P?X/4:X);return Q&&b.set(new Int32Array(Q)),b}case 7:case 11:case 12:case 13:case 14:case 15:{const b=X instanceof ArrayBuffer?new Uint32Array(X):new Uint32Array(P?X/4:X);return Q&&b.set(new Uint32Array(Q)),b}case 1:{const b=X instanceof ArrayBuffer?new Float32Array(X):new Float32Array(P?X/4:X);return Q&&b.set(new Float32Array(Q)),b}}const S=(ArrayBuffer,new Uint8Array(X));return Q&&S.set(new Uint8Array(Q)),S}},11765:(b,X,P)=>{P.d(X,{c:()=>Q});class Q{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersRepository:Q.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersStore:Q.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.IncludesShadersStore:Q.IncludesShadersStoreWGSL}}Q.ShadersRepository="src/Shaders/",Q.ShadersStore={},Q.IncludesShadersStore={},Q.ShadersRepositoryWGSL="src/ShadersWGSL/",Q.ShadersStoreWGSL={},Q.IncludesShadersStoreWGSL={}},11776:(b,X,P)=>{P.d(X,{b:()=>e,d:()=>n,g:()=>D,j:()=>Y,l:()=>E,o:()=>W,r:()=>O,t:()=>w,w:()=>f,z:()=>u,B:()=>a});class Q{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.EX._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(b){b&&this.program&&b(this.program)}setEngine(b){this.EX=b}_fillEffectInformation(b,X,P,Q,S,d,N,a){const u=this.EX;if(u.supportsUniformBuffers)for(const f in X)b.bindUniformBlock(f,X[f]);let w;for(this.EX.getUniforms(this,P).forEach(((b,X)=>{Q[P[X]]=b})),this._uniforms=Q,w=0;w<S.length;w++){null==b.getUniform(S[w])&&(S.splice(w,1),w--)}S.forEach(((b,X)=>{d[b]=X}));for(const f of u.getAttributes(this,N))a.push(f)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(b,X){const P=this._valueCache[b],Q=X.updateFlag;return(void 0===P||P!==Q)&&(this._valueCache[b]=Q,!0)}_cacheFloat2(b,X,P){let Q=this._valueCache[b];if(!Q||2!==Q.length)return Q=[X,P],this._valueCache[b]=Q,!0;let S=!1;return Q[0]!==X&&(Q[0]=X,S=!0),Q[1]!==P&&(Q[1]=P,S=!0),S}_cacheFloat3(b,X,P,Q){let S=this._valueCache[b];if(!S||3!==S.length)return S=[X,P,Q],this._valueCache[b]=S,!0;let d=!1;return S[0]!==X&&(S[0]=X,d=!0),S[1]!==P&&(S[1]=P,d=!0),S[2]!==Q&&(S[2]=Q,d=!0),d}_cacheFloat4(b,X,P,Q,S){let d=this._valueCache[b];if(!d||4!==d.length)return d=[X,P,Q,S],this._valueCache[b]=d,!0;let N=!1;return d[0]!==X&&(d[0]=X,N=!0),d[1]!==P&&(d[1]=P,N=!0),d[2]!==Q&&(d[2]=Q,N=!0),d[3]!==S&&(d[3]=S,N=!0),N}setInt(b,X){const P=this._valueCache[b];void 0!==P&&P===X||this.EX.setInt(this._uniforms[b],X)&&(this._valueCache[b]=X)}setInt2(b,X,P){this._cacheFloat2(b,X,P)&&(this.EX.setInt2(this._uniforms[b],X,P)||(this._valueCache[b]=null))}setInt3(b,X,P,Q){this._cacheFloat3(b,X,P,Q)&&(this.EX.setInt3(this._uniforms[b],X,P,Q)||(this._valueCache[b]=null))}setInt4(b,X,P,Q,S){this._cacheFloat4(b,X,P,Q,S)&&(this.EX.setInt4(this._uniforms[b],X,P,Q,S)||(this._valueCache[b]=null))}setIntArray(b,X){this._valueCache[b]=null,this.EX.setIntArray(this._uniforms[b],X)}setIntArray2(b,X){this._valueCache[b]=null,this.EX.setIntArray2(this._uniforms[b],X)}setIntArray3(b,X){this._valueCache[b]=null,this.EX.setIntArray3(this._uniforms[b],X)}setIntArray4(b,X){this._valueCache[b]=null,this.EX.setIntArray4(this._uniforms[b],X)}setUInt(b,X){const P=this._valueCache[b];void 0!==P&&P===X||this.EX.setUInt(this._uniforms[b],X)&&(this._valueCache[b]=X)}setUInt2(b,X,P){this._cacheFloat2(b,X,P)&&(this.EX.setUInt2(this._uniforms[b],X,P)||(this._valueCache[b]=null))}setUInt3(b,X,P,Q){this._cacheFloat3(b,X,P,Q)&&(this.EX.setUInt3(this._uniforms[b],X,P,Q)||(this._valueCache[b]=null))}setUInt4(b,X,P,Q,S){this._cacheFloat4(b,X,P,Q,S)&&(this.EX.setUInt4(this._uniforms[b],X,P,Q,S)||(this._valueCache[b]=null))}setUIntArray(b,X){this._valueCache[b]=null,this.EX.setUIntArray(this._uniforms[b],X)}setUIntArray2(b,X){this._valueCache[b]=null,this.EX.setUIntArray2(this._uniforms[b],X)}setUIntArray3(b,X){this._valueCache[b]=null,this.EX.setUIntArray3(this._uniforms[b],X)}setUIntArray4(b,X){this._valueCache[b]=null,this.EX.setUIntArray4(this._uniforms[b],X)}setArray(b,X){this._valueCache[b]=null,this.EX.setArray(this._uniforms[b],X)}setArray2(b,X){this._valueCache[b]=null,this.EX.setArray2(this._uniforms[b],X)}setArray3(b,X){this._valueCache[b]=null,this.EX.setArray3(this._uniforms[b],X)}setArray4(b,X){this._valueCache[b]=null,this.EX.setArray4(this._uniforms[b],X)}setMatrices(b,X){X&&(this._valueCache[b]=null,this.EX.setMatrices(this._uniforms[b],X))}setMatrix(b,X){this._cacheMatrix(b,X)&&(this.EX.setMatrices(this._uniforms[b],X.Zd())||(this._valueCache[b]=null))}setMatrix3x3(b,X){this._valueCache[b]=null,this.EX.setMatrix3x3(this._uniforms[b],X)}setMatrix2x2(b,X){this._valueCache[b]=null,this.EX.setMatrix2x2(this._uniforms[b],X)}setFloat(b,X){const P=this._valueCache[b];void 0!==P&&P===X||this.EX.setFloat(this._uniforms[b],X)&&(this._valueCache[b]=X)}setVector2(b,X){this._cacheFloat2(b,X.x,X.y)&&(this.EX.setFloat2(this._uniforms[b],X.x,X.y)||(this._valueCache[b]=null))}setFloat2(b,X,P){this._cacheFloat2(b,X,P)&&(this.EX.setFloat2(this._uniforms[b],X,P)||(this._valueCache[b]=null))}setVector3(b,X){this._cacheFloat3(b,X.x,X.y,X.z)&&(this.EX.setFloat3(this._uniforms[b],X.x,X.y,X.z)||(this._valueCache[b]=null))}setFloat3(b,X,P,Q){this._cacheFloat3(b,X,P,Q)&&(this.EX.setFloat3(this._uniforms[b],X,P,Q)||(this._valueCache[b]=null))}setVector4(b,X){this._cacheFloat4(b,X.x,X.y,X.z,X.w)&&(this.EX.setFloat4(this._uniforms[b],X.x,X.y,X.z,X.w)||(this._valueCache[b]=null))}setQuaternion(b,X){this._cacheFloat4(b,X.x,X.y,X.z,X.w)&&(this.EX.setFloat4(this._uniforms[b],X.x,X.y,X.z,X.w)||(this._valueCache[b]=null))}setFloat4(b,X,P,Q,S){this._cacheFloat4(b,X,P,Q,S)&&(this.EX.setFloat4(this._uniforms[b],X,P,Q,S)||(this._valueCache[b]=null))}setColor3(b,X){this._cacheFloat3(b,X.r,X.g,X.b)&&(this.EX.setFloat3(this._uniforms[b],X.r,X.g,X.b)||(this._valueCache[b]=null))}setColor4(b,X,P){this._cacheFloat4(b,X.r,X.g,X.b,P)&&(this.EX.setFloat4(this._uniforms[b],X.r,X.g,X.b,P)||(this._valueCache[b]=null))}setDirectColor4(b,X){this._cacheFloat4(b,X.r,X.g,X.b,X.a)&&(this.EX.setFloat4(this._uniforms[b],X.r,X.g,X.b,X.a)||(this._valueCache[b]=null))}_getVertexShaderCode(){return this.vertexShader?this.EX._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.EX._getShaderSource(this.fragmentShader):null}}var S=P(11752);const d=new WeakMap,N={_webGLVersion:2,cachedPipelines:{}};function a(b){let X=d.get(b);if(!X){if(!b)return N;X={_webGLVersion:b.TEXTURE_BINDING_3D?2:1,_context:b,parallelShaderCompile:b.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},d.set(b,X)}return X}function u(b){d.delete(b)}function w(b,X,P,Q,S,d){const N=a(Q);d||(d=N._createShaderProgramInjection??e);return d(b,B(X,"vertex",Q,N._contextWasLost),B(P,"fragment",Q,N._contextWasLost),Q,S,N.validateShaderPrograms)}function f(b,X,P,Q,S){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6?arguments[6]:void 0;const u=a(S);N||(N=u._createShaderProgramInjection??e);const w=u._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return N(b,t(X,"vertex",Q,w,S,u._contextWasLost),t(P,"fragment",Q,w,S,u._contextWasLost),S,d,u.validateShaderPrograms)}function O(b,X){const P=new Q,S=a(b);return S.parallelShaderCompile&&!S.disableParallelShaderCompile&&(P.isParallelCompiled=!0),P.context=S._context,P}function e(b,X,P,Q){let S=arguments.length>5?arguments[5]:void 0;const d=Q.createProgram();if(b.program=d,!d)throw new Error("Unable to create program");return Q.attachShader(d,X),Q.attachShader(d,P),Q.linkProgram(d),b.context=Q,b.vertexShader=X,b.fragmentShader=P,b.isParallelCompiled||D(b,Q,S),d}function Y(b,X,P){const Q=b;if(Q._isDisposed)return!1;const S=a(X);return!!(S&&S.parallelShaderCompile&&S.parallelShaderCompile.COMPLETION_STATUS_KHR&&Q.program&&X.getProgramParameter(Q.program,S.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(D(Q,X,P),!0)}function D(b,X,P){const Q=b.context,S=b.vertexShader,d=b.fragmentShader,N=b.program;if(!Q.getProgramParameter(N,Q.LINK_STATUS)){if(!X.getShaderParameter(S,X.COMPILE_STATUS)){const P=X.getShaderInfoLog(S);if(P)throw b.vertexCompilationError=P,new Error("VERTEX SHADER "+P)}if(!X.getShaderParameter(d,X.COMPILE_STATUS)){const P=X.getShaderInfoLog(d);if(P)throw b.fragmentCompilationError=P,new Error("FRAGMENT SHADER "+P)}const P=Q.getProgramInfoLog(N);if(P)throw b.programLinkError=P,new Error(P)}if(P){Q.validateProgram(N);if(!Q.getProgramParameter(N,Q.VALIDATE_STATUS)){const X=Q.getProgramInfoLog(N);if(X)throw b.programValidationError=X,new Error(X)}}Q.deleteShader(S),Q.deleteShader(d),b.vertexShader=void 0,b.fragmentShader=void 0,b.onCompiled&&(b.onCompiled(),b.onCompiled=void 0)}function E(b,X,P,Q,S,d,N,u,O){let e=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0;const E=a(b.context);Y||(Y=E.createRawShaderProgramInjection??w),D||(D=E.createShaderProgramInjection??f);const t=b;t.program=Q?Y(t,X,P,t.context,O):D(t,X,P,u,t.context,O),t.program.__SPECTOR_rebuildProgram=N,e()}function t(b,X,P,Q,d,N){return B((0,S.g)(b,P,Q),X,d,N)}function B(b,X,P,Q){const S=P.createShader("vertex"===X?P.VERTEX_SHADER:P.FRAGMENT_SHADER);if(!S){let b=P.NO_ERROR,S=P.NO_ERROR;for(;(S=P.getError())!==P.NO_ERROR;)b=S;throw new Error(`Something went wrong while creating a gl ${X} shader object. gl error=${b}, gl isContextLost=${P.isContextLost()}, _contextWasLost=${Q}`)}return P.shaderSource(S,b),P.compileShader(S),S}function W(b,X){X.useProgram(b)}function n(b,X){const P=b;if(!P.isParallelCompiled)return void X(b);const Q=P.onCompiled;P.onCompiled=()=>{null===Q||void 0===Q||Q(),X(b)}}},11767:(b,X,P)=>{P.d(X,{c:()=>O,f:()=>Y,g:()=>w,k:()=>f});var Q=P(11696),S=P(11776),d=P(11765),N=P(11700),a=P(11749),u=P(11752);function w(b,X){return(0,S.B)(X).cachedPipelines[b]}function f(b){const X=b._name,P=b.context;if(X&&P){const b=(0,S.B)(P),Q=b.cachedPipelines[X];null===Q||void 0===Q||Q.dispose(),delete b.cachedPipelines[X]}}function O(b,X,P,S,d,N,u){let w,f;const O=(0,Q.o)()?null===N||void 0===N?void 0:N.getHostDocument():null;w="string"===typeof X?X:X.vertexSource?"source:"+X.vertexSource:X.vertexElement?(null===O||void 0===O?void 0:O.getElementById(X.vertexElement))||X.vertexElement:X.vertex||X,f="string"===typeof X?X:X.fragmentSource?"source:"+X.fragmentSource:X.fragmentElement?(null===O||void 0===O?void 0:O.getElementById(X.fragmentElement))||X.fragmentElement:X.fragment||X;const Y=[void 0,void 0],D=()=>{if(Y[0]&&Y[1]){b.isFragment=!0;const[Q,w]=Y;(0,a.j)(w,b,((N,w)=>{u&&(u._fragmentSourceCodeBeforeMigration=w),P&&(N=P("fragment",N));const f=(0,a.b)(Q,N,b);b=null;const O=function(b,X,P,Q){if(P){return{vertexSourceCode:(1===Q?"//":"")+"#define SHADER_NAME vertex:"+(P.vertexElement||P.vertex||P.spectorName||P)+"\n"+b,fragmentSourceCode:(1===Q?"//":"")+"#define SHADER_NAME fragment:"+(P.fragmentElement||P.fragment||P.spectorName||P)+"\n"+X}}return{vertexSourceCode:b,fragmentSourceCode:X}}(f.vertexCode,f.fragmentCode,X,d);null===S||void 0===S||S(O.vertexSourceCode,O.fragmentSourceCode)}),N)}};e(w,"Vertex","",(X=>{(0,a.d)(b),(0,a.j)(X,b,((b,Q)=>{u&&(u._rawVertexSourceCode=X,u._vertexSourceCodeBeforeMigration=Q),P&&(b=P("vertex",b)),Y[0]=b,D()}),N)}),d),e(f,"Fragment","Pixel",(b=>{u&&(u._rawFragmentSourceCode=b),Y[1]=b,D()}),d)}function e(b,X,P,S,N,a){if("undefined"!==typeof HTMLElement&&b instanceof HTMLElement){return void S((0,Q.d)(b))}if("source:"===b.substring(0,7))return void S(b.substring(7));if("base64:"===b.substring(0,7)){return void S(window.atob(b.substring(7)))}const w=d.c.GetShadersStore(N);if(w[b+X+"Shader"])return void S(w[b+X+"Shader"]);if(P&&w[b+P+"Shader"])return void S(w[b+P+"Shader"]);let f;if(f="."===b[0]||"/"===b[0]||b.indexOf("http")>-1?b:d.c.GetShadersRepository(N)+b,!(a=a||u.i))throw new Error("loadFileInjection is not defined");a(f+"."+X.toLowerCase()+".fx",S)}const Y=(b,X,P,Q)=>{try{const d=b.context?(0,S.B)(b.context):null;d&&(d.disableParallelShaderCompile=b.disableParallelCompilation);const N=b.existingPipelineContext||X(b.shaderProcessingContext);return N._name=b.name,b.name&&d&&(d.cachedPipelines[b.name]=N),P(N,b.vertex,b.fragment,!!b.createAsRaw,"","",b.rebuildRebind,b.defines,b.transformFeedbackVaryings,"",(()=>{Q(N,(()=>{var X;null===(X=b.onRenderingStateCompiled)||void 0===X||X.call(b,N)}))})),N}catch(d){throw N.b.Error("Error compiling effect"),d}}},11762:(b,X,P)=>{P.r(X),P.d(X,{Effect:()=>u});var Q=P(11694),S=P(11700),d=P(11765),N=P(11767),a=P(11755);class u{static get ShadersRepository(){return d.c.ShadersRepository}static set ShadersRepository(b){d.c.ShadersRepository=b}get Y(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Q.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9?arguments[9]:void 0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Q.d,this.onErrorObservable=new Q.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=b,this._key=Y;const t=this._key.replace(/\r/g,"").replace(/\n/g,"|");let B;if(X.attributes){const b=X;if(this._engine=P,this._attributesNames=b.attributes,this._uniformsNames=b.uniformsNames.concat(b.samplers),this._samplerList=b.samplers.slice(),this.defines=b.defines,this.onError=b.onError,this.onCompiled=b.onCompiled,this._fallbacks=b.fallbacks,this._indexParameters=b.indexParameters,this._transformFeedbackVaryings=b.transformFeedbackVaryings||null,this._multiTarget=!!b.multiTarget,this._shaderLanguage=b.shaderLanguage??0,this._disableParallelShaderCompilation=!!b.disableParallelShaderCompilation,b.uniformBuffersNames){this._uniformBuffersNamesList=b.uniformBuffersNames.slice();for(let X=0;X<b.uniformBuffersNames.length;X++)this._uniformBuffersNames[b.uniformBuffersNames[X]]=X}this._processFinalCode=b.processFinalCode??null,this._processCodeAfterIncludes=b.processCodeAfterIncludes??void 0,E=b.extraInitializationsAsync,B=b.existingPipelineContext}else this._engine=d,this.defines=null==a?"":a,this._uniformsNames=P.concat(S),this._samplerList=S?S.slice():[],this._attributesNames=X,this._uniformBuffersNamesList=[],this._shaderLanguage=D,this.onError=O,this.onCompiled=f,this._indexParameters=e,this._fallbacks=w;"WEBGL2"===this._engine.shaderPlatformName&&(B=(0,N.g)(t,this._engine._gl)??B),this._attributeLocationByName={},this.uniqueId=u._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.Y||this.dispose(!0)}))}async _processShaderCodeAsync(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3?arguments[3]:void 0;Q&&await Q(),this._processingContext=P||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const S={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:b??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:d.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:d.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,N.c)(S,this.name,this._processFinalCode,((b,P)=>{this._vertexSourceCode=b,this._fragmentSourceCode=P,this._prepareEffect(X)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.Y||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(b){return this._attributes[b]}getAttributeLocationByName(b){return this._attributeLocationByName[b]}getAttributesCount(){return this._attributes.length}getUniformIndex(b){return this._uniformsNames.indexOf(b)}getUniform(b){return this._uniforms[b]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((b=>{this.executeWhenCompiled(b)}))}executeWhenCompiled(b){this.isReady()?b(this):(this.onCompileObservable.add((X=>{b(X)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(b){(0,a.c)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(X=>{this._processCompilationErrors(X,b)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(b=this._pipelineContext)||void 0===b?void 0:b._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(b=this._pipelineContext)||void 0===b?void 0:b._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(b,X,P,Q){this._isReady=!1,this._vertexSourceCodeOverride=b,this._fragmentSourceCodeOverride=X,this.onError=(b,X)=>{Q&&Q(X)},this.onCompiled=()=>{var b,X;const Q=this.getEngine().scenes;if(Q)for(let P=0;P<Q.length;P++)Q[P].markAllMaterialsAsDirty(127);null===(b=(X=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===b||b.call(X,P)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(b){if(this._pipelineContext=b,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let X=0;X<this._attributesNames.length;X++){const b=this._attributesNames[X];this._attributeLocationByName[b]=this._attributes[X]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),u.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X=this._pipelineContext;this._isReady=!1;try{const P=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Q=P?null:this.defines,S=P?this._vertexSourceCodeOverride:this._vertexSourceCode,d=P?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,N.f)({existingPipelineContext:b?X:null,vertex:S,fragment:d,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(b,X,P,Q)=>this._rebuildProgram(b,X,P,Q),defines:Q,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:P,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:P=>{X&&!b&&this._engine._deletePipelineContext(X),P&&this._onRenderingStateCompiled(P)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(X)}catch(P){this._processCompilationErrors(P,X)}}_getShaderCodeAndErrorLine(b,X,P){const Q=P?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let S=null;if(X&&b){const d=X.match(Q);if(d&&2===d.length){const X=parseInt(d[1]),Q=b.split("\n",-1);Q.length>=X&&(S=`Offending line [${X}] in ${P?"fragment":"vertex"} code: ${Q[X-1]}`)}}return[b,S]}_processCompilationErrors(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=b.message;const P=this._attributesNames,Q=this._fallbacks;if(S.b.Error("Unable to compile effect:"),S.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),S.b.Error(`Attributes: ${P.join(" ")}`),S.b.Error("Defines:\n"+this.defines),u.LogShaderCodeOnCompilationError){var d,N;let b=null,X=null,P=null;var a;if(null!==(d=this._pipelineContext)&&void 0!==d&&d._getVertexShaderCode()&&([P,b]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),P&&(S.b.Error("Vertex code:"),S.b.Error(P))),null!==(N=this._pipelineContext)&&void 0!==N&&N._getFragmentShaderCode())[P,X]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),P&&(S.b.Error("Fragment code:"),S.b.Error(P));b&&S.b.Error(b),X&&S.b.Error(X)}S.b.Error("Error: "+this._compilationError);const w=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};X&&(this._pipelineContext=X,this._isReady=!0,w()),Q?(this._pipelineContext=null,Q.hasMoreFallbacks?(this._allFallbacksProcessed=!1,S.b.Error("Trying next fallback."),this.defines=Q.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,w(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,X||w())}get isSupported(){return""===this._compilationError}_bindTexture(b,X){this._engine._bindTexture(this._samplers[b],X,b)}setTexture(b,X){this._engine.setTexture(this._samplers[b],this._uniforms[b],X,b)}setTextureArray(b,X){const P=b+"Ex";if(-1===this._samplerList.indexOf(P+"0")){const Q=this._samplerList.indexOf(b);for(let b=1;b<X.length;b++){const X=P+(b-1).toString();this._samplerList.splice(Q+b,0,X)}let S=0;for(const b of this._samplerList)this._samplers[b]=S,S+=1}this._engine.setTextureArray(this._samplers[b],this._uniforms[b],X,b)}bindUniformBuffer(b,X){const P=this._uniformBuffersNames[X];void 0===P||u._BaseCache[P]===b&&this._engine._features.useUBOBindingCache||(u._BaseCache[P]=b,this._engine.bindUniformBufferBase(b,P,X))}bindUniformBlock(b,X){this._engine.bindUniformBlock(this._pipelineContext,b,X)}setInt(b,X){return this._pipelineContext.setInt(b,X),this}setInt2(b,X,P){return this._pipelineContext.setInt2(b,X,P),this}setInt3(b,X,P,Q){return this._pipelineContext.setInt3(b,X,P,Q),this}setInt4(b,X,P,Q,S){return this._pipelineContext.setInt4(b,X,P,Q,S),this}setIntArray(b,X){return this._pipelineContext.setIntArray(b,X),this}setIntArray2(b,X){return this._pipelineContext.setIntArray2(b,X),this}setIntArray3(b,X){return this._pipelineContext.setIntArray3(b,X),this}setIntArray4(b,X){return this._pipelineContext.setIntArray4(b,X),this}setUInt(b,X){return this._pipelineContext.setUInt(b,X),this}setUInt2(b,X,P){return this._pipelineContext.setUInt2(b,X,P),this}setUInt3(b,X,P,Q){return this._pipelineContext.setUInt3(b,X,P,Q),this}setUInt4(b,X,P,Q,S){return this._pipelineContext.setUInt4(b,X,P,Q,S),this}setUIntArray(b,X){return this._pipelineContext.setUIntArray(b,X),this}setUIntArray2(b,X){return this._pipelineContext.setUIntArray2(b,X),this}setUIntArray3(b,X){return this._pipelineContext.setUIntArray3(b,X),this}setUIntArray4(b,X){return this._pipelineContext.setUIntArray4(b,X),this}setFloatArray(b,X){return this._pipelineContext.setArray(b,X),this}setFloatArray2(b,X){return this._pipelineContext.setArray2(b,X),this}setFloatArray3(b,X){return this._pipelineContext.setArray3(b,X),this}setFloatArray4(b,X){return this._pipelineContext.setArray4(b,X),this}setArray(b,X){return this._pipelineContext.setArray(b,X),this}setArray2(b,X){return this._pipelineContext.setArray2(b,X),this}setArray3(b,X){return this._pipelineContext.setArray3(b,X),this}setArray4(b,X){return this._pipelineContext.setArray4(b,X),this}setMatrices(b,X){return this._pipelineContext.setMatrices(b,X),this}setMatrix(b,X){return this._pipelineContext.setMatrix(b,X),this}setMatrix3x3(b,X){return this._pipelineContext.setMatrix3x3(b,X),this}setMatrix2x2(b,X){return this._pipelineContext.setMatrix2x2(b,X),this}setFloat(b,X){return this._pipelineContext.setFloat(b,X),this}setBool(b,X){return this._pipelineContext.setInt(b,X?1:0),this}setVector2(b,X){return this._pipelineContext.setVector2(b,X),this}setFloat2(b,X,P){return this._pipelineContext.setFloat2(b,X,P),this}setVector3(b,X){return this._pipelineContext.setVector3(b,X),this}setFloat3(b,X,P,Q){return this._pipelineContext.setFloat3(b,X,P,Q),this}setVector4(b,X){return this._pipelineContext.setVector4(b,X),this}setQuaternion(b,X){return this._pipelineContext.setQuaternion(b,X),this}setFloat4(b,X,P,Q,S){return this._pipelineContext.setFloat4(b,X,P,Q,S),this}setColor3(b,X){return this._pipelineContext.setColor3(b,X),this}setColor4(b,X,P){return this._pipelineContext.setColor4(b,X,P),this}setDirectColor4(b,X){return this._pipelineContext.setDirectColor4(b,X),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(u.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,N.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;X&&(d.c.GetShadersStore(Q)[`${b}PixelShader`]=X),P&&(d.c.GetShadersStore(Q)[`${b}VertexShader`]=P)}static ResetCache(){u._BaseCache={}}}u.LogShaderCodeOnCompilationError=!0,u.PersistentMode=!1,u.AutomaticallyClearCodeCache=!1,u._UniqueIdSeed=0,u._BaseCache={},u.ShadersStore=d.c.ShadersStore,u.IncludesShadersStore=d.c.IncludesShadersStore},11719:(b,X,P)=>{P.d(X,{b:()=>S});const Q={};function S(b){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Q[b])return Q[b]=!0,`${b} needs to be imported before as it contains a side-effect required by your code.`}},11696:(b,X,P)=>{function Q(){return"undefined"!==typeof window}function S(){return"undefined"!==typeof navigator}function d(){return"undefined"!==typeof document}function N(b){let X="",P=b.firstChild;for(;P;)3===P.nodeType&&(X+=P.textContent),P=P.nextSibling;return X}P.d(X,{d:()=>N,g:()=>d,k:()=>S,o:()=>Q})},11700:(b,X,P)=>{P.d(X,{b:()=>Q});class Q{static _CheckLimit(b,X){let P=Q._LogLimitOutputs[b];return P?P.current++:(P={limit:X,current:1},Q._LogLimitOutputs[b]=P),P.current<=P.limit}static _GenerateLimitMessage(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const P=Q._LogLimitOutputs[b];if(!P||!Q.MessageLimitReached)return;const S=this._Levels[X];P.current===P.limit&&Q[S.name](Q.MessageLimitReached.replace(/%LIMIT%/g,""+P.limit).replace(/%TYPE%/g,S.name??""))}static _AddLogEntry(b){Q._LogCache=b+Q._LogCache,Q.OnNewCacheEntry&&Q.OnNewCacheEntry(b)}static _FormatMessage(b){const X=b=>b<10?"0"+b:""+b,P=new Date;return"["+X(P.getHours())+":"+X(P.getMinutes())+":"+X(P.getSeconds())+"]: "+b}static _LogDisabled(b,X){}static _LogEnabled(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;const S=Array.isArray(X)?X[0]:X;if(void 0!==P&&!Q._CheckLimit(S,P))return;const d=Q._FormatMessage(S),N=this._Levels[b],a=Array.isArray(X)?X.slice(1):[];N.logFunc&&N.logFunc("BJS - "+d,...a);const u=`<div style='color:${N.color}'>${d}</div><br>`;Q._AddLogEntry(u),Q._GenerateLimitMessage(S,b)}static get LogCache(){return Q._LogCache}static ClearLogCache(){Q._LogCache="",Q._LogLimitOutputs={},Q.errorsCount=0}static set LogLevels(b){Q.Log=Q._LogDisabled,Q.Warn=Q._LogDisabled,Q.Error=Q._LogDisabled;const X=[Q.MessageLogLevel,Q.WarningLogLevel,Q.ErrorLogLevel];for(const P of X)if((b&P)===P){const b=this._Levels[P];Q[b.name]=Q._LogEnabled.bind(Q,P)}}}Q.NoneLogLevel=0,Q.MessageLogLevel=1,Q.WarningLogLevel=2,Q.ErrorLogLevel=4,Q.AllLogLevel=7,Q.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Q._LogCache="",Q._LogLimitOutputs={},Q._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Q.errorsCount=0,Q.Log=Q._LogEnabled.bind(Q,Q.MessageLogLevel),Q.Warn=Q._LogEnabled.bind(Q,Q.WarningLogLevel),Q.Error=Q._LogEnabled.bind(Q,Q.ErrorLogLevel)},11694:(b,X,P)=>{P.d(X,{d:()=>N});const Q="undefined"!==typeof WeakRef;class S{constructor(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;this.initialize(b,X,P,Q)}initialize(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;return this.mask=b,this.skipNextObservers=X,this.target=P,this.currentTarget=Q,this}}class d{constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=b,this.mask=X,this.scope=P,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(b)}}class N{static FromPromise(b,X){const P=new N;return b.then((b=>{P.notifyObservers(b)})).catch((b=>{if(!X)throw b;X.notifyObservers(b)})),P}get observers(){return this._observers}constructor(b){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=X,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new S(0),b&&(this._onObserverAdded=b)}add(b){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!b)return null;const S=new d(b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);S.unregisterOnNextCall=P,X?this._observers.unshift(S):this._observers.push(S),this._onObserverAdded&&this._onObserverAdded(S),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(S,this._lastNotifiedValue);const N=Q?new WeakRef(this):{deref:()=>this};return S._remove=function(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X=N.deref();X&&(b?X.remove(S):X._remove(S))},S}addOnce(b){return this.add(b,void 0,void 0,void 0,!0)}remove(b){if(!b)return!1;b._remove=null;return-1!==this._observers.indexOf(b)&&(this._deferUnregister(b),!0)}removeCallback(b,X){for(let P=0;P<this._observers.length;P++){const Q=this._observers[P];if(!Q._willBeUnregistered&&(Q.callback===b&&(!X||X===Q.scope)))return this._deferUnregister(Q),!0}return!1}_deferUnregister(b){b._willBeUnregistered||(this._numObserversMarkedAsDeleted++,b.unregisterOnNextCall=!1,b._willBeUnregistered=!0,setTimeout((()=>{this._remove(b)}),0))}_remove(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!b)return!1;const P=this._observers.indexOf(b);return-1!==P&&(X&&this._numObserversMarkedAsDeleted--,this._observers.splice(P,1),!0)}makeObserverTopPriority(b){this._remove(b,!1),this._observers.unshift(b)}makeObserverBottomPriority(b){this._remove(b,!1),this._observers.push(b)}notifyObservers(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,P=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),!this._observers.length)return!0;const d=this._eventState;d.mask=X,d.target=P,d.currentTarget=Q,d.skipNextObservers=!1,d.lastReturnValue=b,d.userInfo=S;for(const N of this._observers)if(!N._willBeUnregistered&&(N.mask&X&&(N.unregisterOnNextCall&&this._deferUnregister(N),N.scope?d.lastReturnValue=N.callback.apply(N.scope,[b,d]):d.lastReturnValue=N.callback(b,d)),d.skipNextObservers))return!1;return!0}notifyObserver(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=X),b._willBeUnregistered)return;const Q=this._eventState;Q.mask=P,Q.skipNextObservers=!1,b.unregisterOnNextCall&&this._deferUnregister(b),b.callback(X,Q)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const b=this._observers.pop();b&&(b._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const b=new N;return b._observers=this._observers.slice(0),b}hasSpecificMask(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const X of this._observers)if(X.mask&b||X.mask===b)return!0;return!1}}},11755:(b,X,P)=>{P.d(X,{b:()=>S,c:()=>N});let Q=[];class S{static SetImmediate(b){0===Q.length&&setTimeout((()=>{const b=Q;Q=[];for(const X of b)X()}),1),Q.push(b)}}function d(b,X,P){try{if(b())return X(),!0}catch(Q){return null===P||void 0===P||P(Q),!0}return!1}const N=function(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,N=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&d(b,X,P))return null;const a=setInterval((()=>{d(b,X,P)?clearInterval(a):(S-=Q,S<0&&(clearInterval(a),null===P||void 0===P||P(new Error("Operation timed out after maximum retries. "+(N||"")),!0)))}),Q);return()=>clearInterval(a)}}}]);