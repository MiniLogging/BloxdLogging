/*! For license information please see bf8vo.9.17d042e4.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10478:function(u,G){!function(u){"use strict";var G=function(u,s){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,G){u.__proto__=G}||function(u,G){for(var s in G)Object.prototype.hasOwnProperty.call(G,s)&&(u[s]=G[s])},G(u,s)};function s(u,s){if("function"!==typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function T(){this.constructor=u}G(u,s),u.prototype=null===s?Object.create(s):(T.prototype=s.prototype,new T)}function T(u,G,s,T){var z,O=arguments.length,m=O<3?G:null===T?T=Object.getOwnPropertyDescriptor(G,s):T;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)m=Reflect.decorate(u,G,s,T);else for(var f=u.length-1;f>=0;f--)(z=u[f])&&(m=(O<3?z(m):O>3?z(G,s,m):z(G,s))||m);return O>3&&m&&Object.defineProperty(G,s,m),m}function z(u,G,s){if(s||2===arguments.length)for(var T,z=0,O=G.length;z<O;z++)!T&&z in G||(T||(T=Array.prototype.slice.call(G,0,z)),T[z]=G[z]);return u.concat(T||Array.prototype.slice.call(G))}var O,m=255,f=213;u.OPERATION=void 0,(O=u.OPERATION||(u.OPERATION={}))[O.ADD=128]="ADD",O[O.REPLACE=0]="REPLACE",O[O.DELETE=64]="DELETE",O[O.DELETE_AND_ADD=192]="DELETE_AND_ADD",O[O.TOUCH=1]="TOUCH",O[O.CLEAR=10]="CLEAR";var C=function(){function G(u,G,s){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=u,this.setParent(G,s)}return G.prototype.setParent=function(u,G,s){var T=this;if(this.indexes||(this.indexes=this.ref instanceof Ru?this.ref._definition.indexes:{}),this.parent=u,this.parentIndex=s,G)if(this.root=G,this.ref instanceof Ru){var z=this.ref._definition;for(var O in z.schema){var m=this.ref[O];if(m&&m.$changes){var f=z.indexes[O];m.$changes.setParent(this.ref,G,f)}}}else"object"===typeof this.ref&&this.ref.forEach((function(u,G){if(u instanceof Ru){var s=u.$changes,z=T.ref.$changes.indexes[G];s.setParent(T.ref,T.root,z)}}))},G.prototype.operation=function(u){this.changes.set(--this.currentCustomOperation,u)},G.prototype.change=function(G,s){void 0===s&&(s=u.OPERATION.ADD);var T="number"===typeof G?G:this.indexes[G];this.assertValidIndex(T,G);var z=this.changes.get(T);z&&z.op!==u.OPERATION.DELETE&&z.op!==u.OPERATION.TOUCH||this.changes.set(T,{op:z&&z.op===u.OPERATION.DELETE?u.OPERATION.DELETE_AND_ADD:s,index:T}),this.allChanges.add(T),this.changed=!0,this.touchParents()},G.prototype.touch=function(G){var s="number"===typeof G?G:this.indexes[G];this.assertValidIndex(s,G),this.changes.has(s)||this.changes.set(s,{op:u.OPERATION.TOUCH,index:s}),this.allChanges.add(s),this.touchParents()},G.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},G.prototype.getType=function(u){if(this.ref._definition)return(G=this.ref._definition).schema[G.fieldsByIndex[u]];var G,s=(G=this.parent._definition).schema[G.fieldsByIndex[this.parentIndex]];return Object.values(s)[0]},G.prototype.getChildrenFilter=function(){var u=this.parent._definition.childFilters;return u&&u[this.parentIndex]},G.prototype.getValue=function(u){return this.ref.getByIndex(u)},G.prototype.delete=function(G){var s="number"===typeof G?G:this.indexes[G];if(void 0!==s){var T=this.getValue(s);this.changes.set(s,{op:u.OPERATION.DELETE,index:s}),this.allChanges.delete(s),delete this.caches[s],T&&T.$changes&&(T.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(G," (").concat(s,")"))},G.prototype.discard=function(G,s){var T=this;void 0===G&&(G=!1),void 0===s&&(s=!1),this.ref instanceof Ru||this.changes.forEach((function(G){if(G.op===u.OPERATION.DELETE){var s=T.ref.getIndex(G.index);delete T.indexes[s]}})),this.changes.clear(),this.changed=G,s&&this.allChanges.clear(),this.currentCustomOperation=0},G.prototype.discardAll=function(){var u=this;this.changes.forEach((function(G){var s=u.getValue(G.index);s&&s.$changes&&s.$changes.discardAll()})),this.discard()},G.prototype.cache=function(u,G){this.caches[u]=G},G.prototype.clone=function(){return new G(this.ref,this.parent,this.root)},G.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},G.prototype.assertValidIndex=function(u,G){if(void 0===u)throw new Error('ChangeTree: missing index for field "'.concat(G,'"'))},G}();function x(u,G,s,T){return u[G]||(u[G]=[]),u[G].push(s),null===T||void 0===T||T.forEach((function(u,G){return s(u,G)})),function(){return b(u[G],u[G].indexOf(s))}}function g(G){var s=this,T="string"!==typeof this.$changes.getType();this.$items.forEach((function(z,O){G.push({refId:s.$changes.refId,op:u.OPERATION.DELETE,field:O,value:void 0,previousValue:z}),T&&s.$changes.root.removeRef(z.$changes.refId)}))}function b(u,G){if(-1===G||G>=u.length)return!1;for(var s=u.length-1,T=G;T<s;T++)u[T]=u[T+1];return u.length=s,!0}var Q=function(u,G){var s=u.toString(),T=G.toString();return s<T?-1:s>T?1:0};function Y(u){return u.$proxy=!0,u=new Proxy(u,{get:function(u,G){return"symbol"===typeof G||isNaN(G)?u[G]:u.at(G)},set:function(u,G,s){if("symbol"===typeof G||isNaN(G))u[G]=s;else{var T=Array.from(u.$items.keys()),z=parseInt(T[G]||G);void 0===s||null===s?u.deleteAt(z):u.setAt(z,s)}return!0},deleteProperty:function(u,G){return"number"===typeof G?u.deleteAt(G):delete u[G],!0}})}var n=function(){function G(){for(var u=[],G=0;G<arguments.length;G++)u[G]=arguments[G];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,u)}return G.prototype.te=function(G,s){return void 0===s&&(s=!0),x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,G,s?this.$items:void 0)},G.prototype.bb=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,G)},G.is=function(u){return Array.isArray(u)||void 0!==u.array},Object.defineProperty(G.prototype,"length",{get:function(){return this.$items.size},set:function(u){0===u?this.clear():this.splice(u,this.length-u)},enumerable:!1,configurable:!0}),G.prototype.push=function(){for(var u,G=this,s=[],T=0;T<arguments.length;T++)s[T]=arguments[T];return s.forEach((function(s){u=G.$refId++,G.setAt(u,s)})),u},G.prototype.pop=function(){var u=Array.from(this.$indexes.values()).pop();if(void 0!==u){this.$changes.delete(u),this.$indexes.delete(u);var G=this.$items.get(u);return this.$items.delete(u),G}},G.prototype.at=function(u){var G=Array.from(this.$items.keys())[u];return this.$items.get(G)},G.prototype.setAt=function(G,s){var T,z;if(void 0!==s&&null!==s){if(this.$items.get(G)!==s){void 0!==s.$changes&&s.$changes.setParent(this,this.$changes.root,G);var O=null!==(z=null===(T=this.$changes.indexes[G])||void 0===T?void 0:T.op)&&void 0!==z?z:u.OPERATION.ADD;this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,s),this.$changes.change(G,O)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},G.prototype.deleteAt=function(u){var G=Array.from(this.$items.keys())[u];return void 0!==G&&this.$deleteAt(G)},G.prototype.$deleteAt=function(u){return this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u)},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&g.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.concat=function(){for(var u,s=[],T=0;T<arguments.length;T++)s[T]=arguments[T];return new(G.bind.apply(G,z([void 0],(u=Array.from(this.$items.values())).concat.apply(u,s),!1)))},G.prototype.join=function(u){return Array.from(this.$items.values()).join(u)},G.prototype.reverse=function(){var u=this,G=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(s,T){u.setAt(G[T],s)})),this},G.prototype.shift=function(){var u=Array.from(this.$items.keys()).shift();if(void 0!==u){var G=this.$items.get(u);return this.$deleteAt(u),G}},G.prototype.slice=function(u,s){var T=new G;return T.push.apply(T,Array.from(this.$items.values()).slice(u,s)),T},G.prototype.sort=function(u){var G=this;void 0===u&&(u=Q);var s=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(u).forEach((function(u,T){G.setAt(s[T],u)})),this},G.prototype.splice=function(u,G){void 0===G&&(G=this.length-u);for(var s=Array.from(this.$items.keys()),T=[],z=u;z<u+G;z++)T.push(this.$items.get(s[z])),this.$deleteAt(s[z]);return T},G.prototype.unshift=function(){for(var u=this,G=[],s=0;s<arguments.length;s++)G[s]=arguments[s];var T=this.length,z=G.length,O=Array.from(this.$items.values());return G.forEach((function(G,s){u.setAt(s,G)})),O.forEach((function(G,s){u.setAt(z+s,G)})),T+z},G.prototype.indexOf=function(u,G){return Array.from(this.$items.values()).indexOf(u,G)},G.prototype.lastIndexOf=function(u,G){return void 0===G&&(G=this.length-1),Array.from(this.$items.values()).lastIndexOf(u,G)},G.prototype.every=function(u,G){return Array.from(this.$items.values()).every(u,G)},G.prototype.some=function(u,G){return Array.from(this.$items.values()).some(u,G)},G.prototype.forEach=function(u,G){Array.from(this.$items.values()).forEach(u,G)},G.prototype.map=function(u,G){return Array.from(this.$items.values()).map(u,G)},G.prototype.filter=function(u,G){return Array.from(this.$items.values()).filter(u,G)},G.prototype.reduce=function(u,G){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},G.prototype.reduceRight=function(u,G){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},G.prototype.find=function(u,G){return Array.from(this.$items.values()).find(u,G)},G.prototype.findIndex=function(u,G){return Array.from(this.$items.values()).findIndex(u,G)},G.prototype.fill=function(u,G,s){throw new Error("ArraySchema#fill() not implemented")},G.prototype.copyWithin=function(u,G,s){throw new Error("ArraySchema#copyWithin() not implemented")},G.prototype.toString=function(){return this.$items.toString()},G.prototype.toLocaleString=function(){return this.$items.toLocaleString()},G.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(G,Symbol.species,{get:function(){return G},enumerable:!1,configurable:!0}),G.prototype.entries=function(){return this.$items.entries()},G.prototype.keys=function(){return this.$items.keys()},G.prototype.values=function(){return this.$items.values()},G.prototype.includes=function(u,G){return Array.from(this.$items.values()).includes(u,G)},G.prototype.flatMap=function(u,G){throw new Error("ArraySchema#flatMap() is not supported.")},G.prototype.flat=function(u){throw new Error("ArraySchema#flat() is not supported.")},G.prototype.findLast=function(){var u=Array.from(this.$items.values());return u.findLast.apply(u,arguments)},G.prototype.findLastIndex=function(){var u=Array.from(this.$items.values());return u.findLastIndex.apply(u,arguments)},G.prototype.setIndex=function(u,G){this.$indexes.set(u,G)},G.prototype.getIndex=function(u){return this.$indexes.get(u)},G.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},G.prototype.deleteByIndex=function(u){var G=this.$indexes.get(u);this.$items.delete(G),this.$indexes.delete(u)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){return this.toArray().map((function(u){return"function"===typeof u.toJSON?u.toJSON():u}))},G.prototype.clone=function(u){return u?new(G.bind.apply(G,z([void 0],Array.from(this.$items.values()),!1))):new(G.bind.apply(G,z([void 0],this.map((function(u){return u.$changes?u.clone():u})),!1)))},G}();function V(u){return u.$proxy=!0,u=new Proxy(u,{get:function(u,G){return"symbol"!==typeof G&&"undefined"===typeof u[G]?u.get(G):u[G]},set:function(u,G,s){return"symbol"!==typeof G&&-1===G.indexOf("$")&&"te"!==G&&"bb"!==G&&"onChange"!==G?u.set(G,s):u[G]=s,!0},deleteProperty:function(u,G){return u.delete(G),!0}})}var F=function(){function G(u){var s=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u)if(u instanceof Map||u instanceof G)u.forEach((function(u,G){return s.set(G,u)}));else for(var T in u)this.set(T,u[T])}return G.prototype.te=function(G,s){return void 0===s&&(s=!0),x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,G,s?this.$items:void 0)},G.prototype.bb=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,G)},G.is=function(u){return void 0!==u.map},G.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(G.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(G,Symbol.species,{get:function(){return G},enumerable:!1,configurable:!0}),G.prototype.set=function(G,s){if(void 0===s||null===s)throw new Error("MapSchema#set('".concat(G,"', ").concat(s,"): trying to set ").concat(s," value on '").concat(G,"'."));G=G.toString();var T="undefined"!==typeof this.$changes.indexes[G],z=T?this.$changes.indexes[G]:this.$refId++,O=T?u.OPERATION.REPLACE:u.OPERATION.ADD,m=void 0!==s.$changes;if(m&&s.$changes.setParent(this,this.$changes.root,z),T){if(!m&&this.$items.get(G)===s)return;m&&this.$items.get(G)!==s&&(O=u.OPERATION.ADD)}else this.$changes.indexes[G]=z,this.$indexes.set(z,G);return this.$items.set(G,s),this.$changes.change(G,O),this},G.prototype.get=function(u){return this.$items.get(u)},G.prototype.delete=function(u){return this.$changes.delete(u),this.$items.delete(u)},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&g.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(u){return this.$items.has(u)},G.prototype.forEach=function(u){this.$items.forEach(u)},G.prototype.entries=function(){return this.$items.entries()},G.prototype.keys=function(){return this.$items.keys()},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(u,G){this.$indexes.set(u,G)},G.prototype.getIndex=function(u){return this.$indexes.get(u)},G.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},G.prototype.deleteByIndex=function(u){var G=this.$indexes.get(u);this.$items.delete(G),this.$indexes.delete(u)},G.prototype.toJSON=function(){var u={};return this.forEach((function(G,s){u[s]="function"===typeof G.toJSON?G.toJSON():G})),u},G.prototype.clone=function(u){var s;return u?s=Object.assign(new G,this):(s=new G,this.forEach((function(u,G){u.$changes?s.set(G,u.clone()):s.set(G,u)}))),s},G}(),r={};function c(u,G){r[u]=G}function j(u){return r[u]}var l=function(){function u(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return u.create=function(G){var s=new u;return s.schema=Object.assign({},G&&G.schema||{}),s.indexes=Object.assign({},G&&G.indexes||{}),s.fieldsByIndex=Object.assign({},G&&G.fieldsByIndex||{}),s.descriptors=Object.assign({},G&&G.descriptors||{}),s.deprecated=Object.assign({},G&&G.deprecated||{}),s},u.prototype.addField=function(u,G){var s=this.getNextFieldIndex();this.fieldsByIndex[s]=u,this.indexes[u]=s,this.schema[u]=Array.isArray(G)?{array:G[0]}:G},u.prototype.hasField=function(u){return void 0!==this.indexes[u]},u.prototype.addFilter=function(u,G){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[u]]=G,this.indexesWithFilters.push(this.indexes[u]),!0},u.prototype.addChildrenFilter=function(u,G){var s=this.indexes[u],T=this.schema[u];if(j(Object.keys(T)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[s]=G,!0;console.warn("@filterChildren: field '".concat(u,"' can't have children. Ignoring filter."))},u.prototype.getChildrenFilter=function(u){return this.childFilters&&this.childFilters[this.indexes[u]]},u.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},u}();function P(u){return u._context&&u._context.useFilters}var H=function(){function u(){this.types={},this.schemas=new Map,this.useFilters=!1}return u.prototype.has=function(u){return this.schemas.has(u)},u.prototype.get=function(u){return this.types[u]},u.prototype.add=function(u,G){void 0===G&&(G=this.schemas.size),u._definition=l.create(u._definition),u._typeid=G,this.types[G]=u,this.schemas.set(u,G)},u.create=function(G){return void 0===G&&(G={}),function(s){return G.context||(G.context=new u),p(s,G)}},u}(),X=new H;function p(u,G){return void 0===G&&(G={}),function(s,T){var O=G.context||X,m=s.constructor;if(m._context=O,!u)throw new Error("".concat(m.name,': @type() reference provided for "').concat(T,"\" is undefined. Make sure you don't have any circular dependencies."));O.has(m)||O.add(m);var f=m._definition;if(f.addField(T,u),f.descriptors[T]){if(f.deprecated[T])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(T,"' definition on '").concat(m.name,"'.\nCheck @type() annotation"))}catch(r){var C=r.stack.split("\n")[4].trim();throw new Error("".concat(r.message," ").concat(C))}}var x=n.is(u),g=!x&&F.is(u);if("string"!==typeof u&&!Ru.is(u)){var b=Object.values(u)[0];"string"===typeof b||O.has(b)||O.add(b)}if(G.manual)f.descriptors[T]={enumerable:!0,configurable:!0,writable:!0};else{var Q="_".concat(T);f.descriptors[Q]={enumerable:!1,configurable:!1,writable:!0},f.descriptors[T]={get:function(){return this[Q]},set:function(u){u!==this[Q]&&(void 0!==u&&null!==u?(!x||u instanceof n||(u=new(n.bind.apply(n,z([void 0],u,!1)))),!g||u instanceof F||(u=new F(u)),void 0===u.$proxy&&(g?u=V(u):x&&(u=Y(u))),this.$changes.change(T),u.$changes&&u.$changes.setParent(this,this.$changes.root,this._definition.indexes[T])):this[Q]&&this.$changes.delete(T),this[Q]=u)},enumerable:!0,configurable:!0}}}}function q(u){return function(G,s){var T=G.constructor;T._definition.addFilter(s,u)&&(T._context.useFilters=!0)}}function d(u){return function(G,s){var T=G.constructor;T._definition.addChildrenFilter(s,u)&&(T._context.useFilters=!0)}}function v(u){return void 0===u&&(u=!0),function(G,s){var T=G.constructor._definition;T.deprecated[s]=!0,u&&(T.descriptors[s]={get:function(){throw new Error("".concat(s," is deprecated."))},set:function(u){},enumerable:!1,configurable:!0})}}function W(u,G,s){for(var T in void 0===s&&(s={}),s.context||(s.context=u._context||s.context||X),G)p(G[T],s)(u.prototype,T);return u}function M(u){for(var G=0,s=0,T=0,z=u.length;T<z;T++)(G=u.charCodeAt(T))<128?s+=1:G<2048?s+=2:G<55296||G>=57344?s+=3:(T++,s+=4);return s}function o(u,G,s){for(var T=0,z=0,O=s.length;z<O;z++)(T=s.charCodeAt(z))<128?u[G++]=T:T<2048?(u[G++]=192|T>>6,u[G++]=128|63&T):T<55296||T>=57344?(u[G++]=224|T>>12,u[G++]=128|T>>6&63,u[G++]=128|63&T):(z++,T=65536+((1023&T)<<10|1023&s.charCodeAt(z)),u[G++]=240|T>>18,u[G++]=128|T>>12&63,u[G++]=128|T>>6&63,u[G++]=128|63&T)}function R(u,G){u.push(255&G)}function B(u,G){u.push(255&G)}function D(u,G){u.push(255&G),u.push(G>>8&255)}function k(u,G){u.push(255&G),u.push(G>>8&255)}function w(u,G){u.push(255&G),u.push(G>>8&255),u.push(G>>16&255),u.push(G>>24&255)}function L(u,G){var s=G>>24,T=G>>16,z=G>>8,O=G;u.push(255&O),u.push(255&z),u.push(255&T),u.push(255&s)}function S(u,G){var s=Math.floor(G/Math.pow(2,32));L(u,G>>>0),L(u,s)}function e(u,G){var s=G/Math.pow(2,32)|0;L(u,G>>>0),L(u,s)}function h(u,G){N(u,G)}function I(u,G){y(u,G)}var i=new Int32Array(2),J=new Float32Array(i.buffer),A=new Float64Array(i.buffer);function N(u,G){J[0]=G,w(u,i[0])}function y(u,G){A[0]=G,w(u,i[0]),w(u,i[1])}function a(u,G){return B(u,G?1:0)}function K(u,G){G||(G="");var s=M(G),T=0;if(s<32)u.push(160|s),T=1;else if(s<256)u.push(217),B(u,s),T=2;else if(s<65536)u.push(218),k(u,s),T=3;else{if(!(s<4294967296))throw new Error("String too long");u.push(219),L(u,s),T=5}return o(u,u.length,G),T+s}function Z(u,G){return isNaN(G)?Z(u,0):isFinite(G)?G!==(0|G)?(u.push(203),y(u,G),9):G>=0?G<128?(B(u,G),1):G<256?(u.push(204),B(u,G),2):G<65536?(u.push(205),k(u,G),3):G<4294967296?(u.push(206),L(u,G),5):(u.push(207),e(u,G),9):G>=-32?(u.push(224|G+32),1):G>=-128?(u.push(208),R(u,G),2):G>=-32768?(u.push(209),D(u,G),3):G>=-2147483648?(u.push(210),w(u,G),5):(u.push(211),S(u,G),9):Z(u,G>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var t=Object.freeze({__proto__:null,utf8Write:o,int8:R,uint8:B,int16:D,uint16:k,int32:w,uint32:L,int64:S,uint64:e,float32:h,float64:I,writeFloat32:N,writeFloat64:y,boolean:a,string:K,number:Z});function E(u,G,s){for(var T="",z=0,O=G,m=G+s;O<m;O++){var f=u[O];0!==(128&f)?192!==(224&f)?224!==(240&f)?240!==(248&f)?console.error("Invalid byte "+f.toString(16)):(z=(7&f)<<18|(63&u[++O])<<12|(63&u[++O])<<6|63&u[++O])>=65536?(z-=65536,T+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):T+=String.fromCharCode(z):T+=String.fromCharCode((15&f)<<12|(63&u[++O])<<6|63&u[++O]):T+=String.fromCharCode((31&f)<<6|63&u[++O]):T+=String.fromCharCode(f)}return T}function U(u,G){return uu(u,G)<<24>>24}function uu(u,G){return u[G.offset++]}function Gu(u,G){return su(u,G)<<16>>16}function su(u,G){return u[G.offset++]|u[G.offset++]<<8}function Tu(u,G){return u[G.offset++]|u[G.offset++]<<8|u[G.offset++]<<16|u[G.offset++]<<24}function zu(u,G){return Tu(u,G)>>>0}function Ou(u,G){return Qu(u,G)}function mu(u,G){return Yu(u,G)}function fu(u,G){var s=zu(u,G);return Tu(u,G)*Math.pow(2,32)+s}function Cu(u,G){var s=zu(u,G);return zu(u,G)*Math.pow(2,32)+s}var xu=new Int32Array(2),gu=new Float32Array(xu.buffer),bu=new Float64Array(xu.buffer);function Qu(u,G){return xu[0]=Tu(u,G),gu[0]}function Yu(u,G){return xu[0]=Tu(u,G),xu[1]=Tu(u,G),bu[0]}function nu(u,G){return uu(u,G)>0}function Vu(u,G){var s,T=u[G.offset++];T<192?s=31&T:217===T?s=uu(u,G):218===T?s=su(u,G):219===T&&(s=zu(u,G));var z=E(u,G.offset,s);return G.offset+=s,z}function Fu(u,G){var s=u[G.offset];return s<192&&s>160||217===s||218===s||219===s}function ru(u,G){var s=u[G.offset++];return s<128?s:202===s?Qu(u,G):203===s?Yu(u,G):204===s?uu(u,G):205===s?su(u,G):206===s?zu(u,G):207===s?Cu(u,G):208===s?U(u,G):209===s?Gu(u,G):210===s?Tu(u,G):211===s?fu(u,G):s>223?-1*(255-s+1):void 0}function cu(u,G){var s=u[G.offset];return s<128||s>=202&&s<=211}function ju(u,G){return u[G.offset]<160}function lu(u,G){return u[G.offset-1]===m&&(u[G.offset]<128||u[G.offset]>=202&&u[G.offset]<=211)}var Pu=Object.freeze({__proto__:null,int8:U,uint8:uu,int16:Gu,uint16:su,int32:Tu,uint32:zu,float32:Ou,float64:mu,int64:fu,uint64:Cu,readFloat32:Qu,readFloat64:Yu,boolean:nu,string:Vu,stringCheck:Fu,number:ru,numberCheck:cu,arrayCheck:ju,switchStructureCheck:lu}),Hu=function(){function G(u){var G=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u&&u.forEach((function(u){return G.add(u)}))}return G.prototype.te=function(G,s){return void 0===s&&(s=!0),x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,G,s?this.$items:void 0)},G.prototype.bb=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,G)},G.is=function(u){return void 0!==u.collection},G.prototype.add=function(u){var G=this.$refId++;return void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,G),this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,u),this.$changes.change(G),G},G.prototype.at=function(u){var G=Array.from(this.$items.keys())[u];return this.$items.get(G)},G.prototype.entries=function(){return this.$items.entries()},G.prototype.delete=function(u){for(var G,s,T=this.$items.entries();(s=T.next())&&!s.done;)if(u===s.value[1]){G=s.value[0];break}return void 0!==G&&(this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G))},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&g.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(u){return Array.from(this.$items.values()).some((function(G){return G===u}))},G.prototype.forEach=function(u){var G=this;this.$items.forEach((function(s,T,z){return u(s,T,G)}))},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(u,G){this.$indexes.set(u,G)},G.prototype.getIndex=function(u){return this.$indexes.get(u)},G.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},G.prototype.deleteByIndex=function(u){var G=this.$indexes.get(u);this.$items.delete(G),this.$indexes.delete(u)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){var u=[];return this.forEach((function(G,s){u.push("function"===typeof G.toJSON?G.toJSON():G)})),u},G.prototype.clone=function(u){var s;return u?s=Object.assign(new G,this):(s=new G,this.forEach((function(u){u.$changes?s.add(u.clone()):s.add(u)}))),s},G}(),Xu=function(){function G(u){var G=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,u&&u.forEach((function(u){return G.add(u)}))}return G.prototype.te=function(G,s){return void 0===s&&(s=!0),x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.ADD,G,s?this.$items:void 0)},G.prototype.bb=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,G)},G.prototype.onChange=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,G)},G.is=function(u){return void 0!==u.set},G.prototype.add=function(G){var s,T;if(this.has(G))return!1;var z=this.$refId++;void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,z);var O=null!==(T=null===(s=this.$changes.indexes[z])||void 0===s?void 0:s.op)&&void 0!==T?T:u.OPERATION.ADD;return this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,G),this.$changes.change(z,O),z},G.prototype.entries=function(){return this.$items.entries()},G.prototype.delete=function(u){for(var G,s,T=this.$items.entries();(s=T.next())&&!s.done;)if(u===s.value[1]){G=s.value[0];break}return void 0!==G&&(this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G))},G.prototype.clear=function(G){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),G&&g.call(this,G),this.$items.clear(),this.$changes.operation({index:0,op:u.OPERATION.CLEAR}),this.$changes.touchParents()},G.prototype.has=function(u){for(var G,s=this.$items.values(),T=!1;(G=s.next())&&!G.done;)if(u===G.value){T=!0;break}return T},G.prototype.forEach=function(u){var G=this;this.$items.forEach((function(s,T,z){return u(s,T,G)}))},G.prototype.values=function(){return this.$items.values()},Object.defineProperty(G.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),G.prototype.setIndex=function(u,G){this.$indexes.set(u,G)},G.prototype.getIndex=function(u){return this.$indexes.get(u)},G.prototype.getByIndex=function(u){return this.$items.get(this.$indexes.get(u))},G.prototype.deleteByIndex=function(u){var G=this.$indexes.get(u);this.$items.delete(G),this.$indexes.delete(u)},G.prototype.toArray=function(){return Array.from(this.$items.values())},G.prototype.toJSON=function(){var u=[];return this.forEach((function(G,s){u.push("function"===typeof G.toJSON?G.toJSON():G)})),u},G.prototype.clone=function(u){var s;return u?s=Object.assign(new G,this):(s=new G,this.forEach((function(u){u.$changes?s.add(u.clone()):s.add(u)}))),s},G}(),pu=function(){function u(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return u.prototype.addRefId=function(u){this.refIds.has(u)||(this.refIds.add(u),this.containerIndexes.set(u,new Set))},u.get=function(G){return void 0===G.$filterState&&(G.$filterState=new u),G.$filterState},u}(),qu=function(){function u(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return u.prototype.getNextUniqueId=function(){return this.nextUniqueId++},u.prototype.addRef=function(u,G,s){void 0===s&&(s=!0),this.refs.set(u,G),s&&(this.refCounts[u]=(this.refCounts[u]||0)+1)},u.prototype.removeRef=function(u){this.refCounts[u]=this.refCounts[u]-1,this.deletedRefs.add(u)},u.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},u.prototype.garbageCollectDeletedRefs=function(){var u=this;this.deletedRefs.forEach((function(G){if(!(u.refCounts[G]>0)){var s=u.refs.get(G);if(s instanceof Ru)for(var T in s._definition.schema)"string"!==typeof s._definition.schema[T]&&s[T]&&s[T].$changes&&u.removeRef(s[T].$changes.refId);else{var z=s.$changes.parent._definition,O=z.schema[z.fieldsByIndex[s.$changes.parentIndex]];"function"===typeof Object.values(O)[0]&&Array.from(s.values()).forEach((function(G){return u.removeRef(G.$changes.refId)}))}u.refs.delete(G),delete u.refCounts[G]}})),this.deletedRefs.clear()},u}(),du=function(u){function G(){return null!==u&&u.apply(this,arguments)||this}return s(G,u),G}(Error);function vu(u,G,s,T){var z,O=!1;switch(G){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":z="number",isNaN(u)&&console.log('trying to encode "NaN" in '.concat(s.constructor.name,"#").concat(T));break;case"string":z="string",O=!0;break;case"boolean":return}if(typeof u!==z&&(!O||O&&null!==u)){var m="'".concat(JSON.stringify(u),"'").concat(u&&u.constructor&&" (".concat(u.constructor.name,")")||"");throw new du("a '".concat(z,"' was expected, but ").concat(m," was provided in ").concat(s.constructor.name,"#").concat(T))}}function Wu(u,G,s,T){if(!(u instanceof G))throw new du("a '".concat(G.name,"' was expected, but '").concat(u.constructor.name,"' was provided in ").concat(s.constructor.name,"#").concat(T))}function Mu(u,G,s,T,z){vu(s,u,T,z);var O=t[u];if(!O)throw new du("a '".concat(u,"' was expected, but ").concat(s," was provided in ").concat(T.constructor.name,"#").concat(z));O(G,s)}function ou(u,G,s){return Pu[u](G,s)}var Ru=function(){function G(){for(var u=[],G=0;G<arguments.length;G++)u[G]=arguments[G];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new qu),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var s=this._definition.descriptors;s&&Object.defineProperties(this,s),u[0]&&this.assign(u[0])}return G.onError=function(u){console.error(u)},G.is=function(u){return u._definition&&void 0!==u._definition.schema},G.prototype.onChange=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.REPLACE,G)},G.prototype.bb=function(G){return x(this.$callbacks||(this.$callbacks=[]),u.OPERATION.DELETE,G)},G.prototype.assign=function(u){return Object.assign(this,u),this},Object.defineProperty(G.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),G.prototype.setDirty=function(u,G){this.$changes.change(u,G)},G.prototype.listen=function(u,G,s){var T=this;return void 0===s&&(s=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[u]||(this.$callbacks[u]=[]),this.$callbacks[u].push(G),s&&void 0!==this[u]&&G(this[u],void 0),function(){return b(T.$callbacks[u],T.$callbacks[u].indexOf(G))}},G.prototype.decode=function(s,T,z){var O;void 0===T&&(T={offset:0}),void 0===z&&(z=this);var f=[],C=this.$changes.root,x=s.length,g=0;for(C.refs.set(g,this);T.offset<x;){var b=s[T.offset++];if(b!=m){var Q=z.$changes,Y=void 0!==z._definition,V=Y?b>>6<<6:b;if(V!==u.OPERATION.CLEAR){var r=Y?b%(V||255):ru(s,T),c=Y?z._definition.fieldsByIndex[r]:"",l=Q.getType(r),P=void 0,H=void 0,X=void 0;if(Y?H=z["_".concat(c)]:(H=z.getByIndex(r),(V&u.OPERATION.ADD)===u.OPERATION.ADD?(X=z instanceof F?Vu(s,T):r,z.setIndex(r,X)):X=z.getIndex(r)),(V&u.OPERATION.DELETE)===u.OPERATION.DELETE&&(V!==u.OPERATION.DELETE_AND_ADD&&z.deleteByIndex(r),H&&H.$changes&&C.removeRef(H.$changes.refId),P=null),void 0!==c){if(V===u.OPERATION.DELETE);else if(G.is(l)){var p=ru(s,T);if(P=C.refs.get(p),V!==u.OPERATION.REPLACE){var q=this.getSchemaType(s,T,l);P||((P=this.createTypeInstance(q)).$changes.refId=p,H&&(P.$callbacks=H.$callbacks,H.$changes.refId&&p!==H.$changes.refId&&C.removeRef(H.$changes.refId))),C.addRef(p,P,P!==H)}}else if("string"===typeof l)P=ou(l,s,T);else{var d=j(Object.keys(l)[0]),v=ru(s,T),W=C.refs.has(v)?H||C.refs.get(v):new d.constructor;if((P=W.clone(!0)).$changes.refId=v,H&&(P.$callbacks=H.$callbacks,H.$changes.refId&&v!==H.$changes.refId)){C.removeRef(H.$changes.refId);for(var M=H.entries(),o=void 0;(o=M.next())&&!o.done;){var R=(O=o.value)[0],B=O[1];f.push({refId:v,op:u.OPERATION.DELETE,field:R,value:void 0,previousValue:B})}}C.addRef(v,P,W!==H)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(Q.ref,Q.root,r),z instanceof G)z[c]=P;else if(z instanceof F)R=X,z.$items.set(R,P),z.$changes.allChanges.add(r);else if(z instanceof n)z.setAt(r,P);else if(z instanceof Hu){var D=z.add(P);z.setIndex(r,D)}else z instanceof Xu&&!1!==(D=z.add(P))&&z.setIndex(r,D);H!==P&&f.push({refId:g,op:V,field:c,dynamicIndex:X,value:P,previousValue:H})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:T.offset};T.offset<x&&(!lu(s,T)||(k.offset=T.offset+1,!C.refs.has(ru(s,k))));)T.offset++}}else z.clear(f)}else{g=ru(s,T);var w=C.refs.get(g);if(!w)throw new Error('"refId" not found: '.concat(g));z=w}}return this._triggerChanges(f),C.garbageCollectDeletedRefs(),f},G.prototype.encode=function(s,T,z){void 0===s&&(s=!1),void 0===T&&(T=[]),void 0===z&&(z=!1);for(var O=this.$changes,f=new WeakSet,C=[O],x=1,g=0;g<x;g++){var b=C[g],Q=b.ref,Y=Q instanceof G;b.ensureRefId(),f.add(b),b!==O&&(b.changed||s)&&(B(T,m),Z(T,b.refId));for(var n=s?Array.from(b.allChanges):Array.from(b.changes.values()),V=0,r=n.length;V<r;V++){var c=s?{op:u.OPERATION.ADD,index:n[V]}:n[V],l=c.index,P=Y?Q._definition.fieldsByIndex&&Q._definition.fieldsByIndex[l]:l,H=T.length;if(c.op!==u.OPERATION.TOUCH)if(Y)B(T,l|c.op);else{if(B(T,c.op),c.op===u.OPERATION.CLEAR)continue;Z(T,l)}if(Y||(c.op&u.OPERATION.ADD)!=u.OPERATION.ADD||Q instanceof F&&K(T,b.ref.$indexes.get(l)),c.op!==u.OPERATION.DELETE){var X=b.getType(l),p=b.getValue(l);if(p&&p.$changes&&!f.has(p.$changes)&&(C.push(p.$changes),p.$changes.ensureRefId(),x++),c.op!==u.OPERATION.TOUCH){if(G.is(X))Wu(p,X,Q,P),Z(T,p.$changes.refId),(c.op&u.OPERATION.ADD)===u.OPERATION.ADD&&this.tryEncodeTypeId(T,X,p.constructor);else if("string"===typeof X)Mu(X,T,p,Q,P);else{var q=j(Object.keys(X)[0]);Wu(Q["_".concat(P)],q.constructor,Q,P),Z(T,p.$changes.refId)}z&&b.cache(l,T.slice(H))}}}s||z||b.discard()}return T},G.prototype.encodeAll=function(u){return this.encode(!0,[],u)},G.prototype.applyFilters=function(s,T){var z,O;void 0===T&&(T=!1);for(var f=this,C=new Set,x=pu.get(s),g=[this.$changes],b=1,Q=[],Y=function(Y){var n=g[Y];if(C.has(n.refId))return"continue";var V=n.ref,r=V instanceof G;B(Q,m),Z(Q,n.refId);var c=x.refIds.has(n),j=T||!c;x.addRefId(n);var l=x.containerIndexes.get(n),P=j?Array.from(n.allChanges):Array.from(n.changes.values());!T&&r&&V._definition.indexesWithFilters&&V._definition.indexesWithFilters.forEach((function(G){!l.has(G)&&n.allChanges.has(G)&&(j?P.push(G):P.push({op:u.OPERATION.ADD,index:G}))}));for(var H=0,X=P.length;H<X;H++){var p=j?{op:u.OPERATION.ADD,index:P[H]}:P[H];if(p.op!==u.OPERATION.CLEAR){var q=p.index;if(p.op!==u.OPERATION.DELETE){var d=n.getValue(q),v=n.getType(q);if(r){if((W=V._definition.filters&&V._definition.filters[q])&&!W.call(V,s,d,f)){d&&d.$changes&&C.add(d.$changes.refId);continue}}else{var W,M=n.parent;if((W=n.getChildrenFilter())&&!W.call(M,s,V.$indexes.get(q),d,f)){d&&d.$changes&&C.add(d.$changes.refId);continue}}if(d.$changes&&(g.push(d.$changes),b++),p.op!==u.OPERATION.TOUCH)if(p.op===u.OPERATION.ADD||r)Q.push.apply(Q,null!==(z=n.caches[q])&&void 0!==z?z:[]),l.add(q);else if(l.has(q))Q.push.apply(Q,null!==(O=n.caches[q])&&void 0!==O?O:[]);else{if(l.add(q),B(Q,u.OPERATION.ADD),Z(Q,q),V instanceof F){var o=n.ref.$indexes.get(q);K(Q,o)}d.$changes?Z(Q,d.$changes.refId):t[v](Q,d)}else d.$changes&&!r&&(B(Q,u.OPERATION.ADD),Z(Q,q),V instanceof F&&(o=n.ref.$indexes.get(q),K(Q,o)),Z(Q,d.$changes.refId))}else r?B(Q,p.op|q):(B(Q,p.op),Z(Q,q))}else B(Q,p.op)}},n=0;n<b;n++)Y(n);return Q},G.prototype.clone=function(){var u,G=new this.constructor,s=this._definition.schema;for(var T in s)"object"===typeof this[T]&&"function"===typeof(null===(u=this[T])||void 0===u?void 0:u.clone)?G[T]=this[T].clone():G[T]=this[T];return G},G.prototype.toJSON=function(){var u=this._definition.schema,G=this._definition.deprecated,s={};for(var T in u)G[T]||null===this[T]||"undefined"===typeof this[T]||(s[T]="function"===typeof this[T].toJSON?this[T].toJSON():this["_".concat(T)]);return s},G.prototype.discardAllChanges=function(){this.$changes.discardAll()},G.prototype.getByIndex=function(u){return this[this._definition.fieldsByIndex[u]]},G.prototype.deleteByIndex=function(u){this[this._definition.fieldsByIndex[u]]=void 0},G.prototype.tryEncodeTypeId=function(u,G,s){G._typeid!==s._typeid&&(B(u,f),Z(u,s._typeid))},G.prototype.getSchemaType=function(u,G,s){var T;return u[G.offset]===f&&(G.offset++,T=this.constructor._context.get(ru(u,G))),T||s},G.prototype.createTypeInstance=function(u){var G=new u;return G.$changes.root=this.$changes.root,G},G.prototype._triggerChanges=function(s){for(var T,z,O,m,f,C,x,g,b,Q=new Set,Y=this.$changes.root.refs,n=function(n){var V=s[n],F=V.refId,r=Y.get(F),c=r.$callbacks;if((V.op&u.OPERATION.DELETE)===u.OPERATION.DELETE&&V.previousValue instanceof G&&(null===(z=null===(T=V.previousValue.$callbacks)||void 0===T?void 0:T[u.OPERATION.DELETE])||void 0===z||z.forEach((function(u){return u()}))),!c)return"continue";if(r instanceof G){if(!Q.has(F))try{null===(O=null===c||void 0===c?void 0:c[u.OPERATION.REPLACE])||void 0===O||O.forEach((function(u){return u()}))}catch(j){G.onError(j)}try{c.hasOwnProperty(V.field)&&(null===(m=c[V.field])||void 0===m||m.forEach((function(u){return u(V.value,V.previousValue)})))}catch(j){G.onError(j)}}else V.op===u.OPERATION.ADD&&void 0===V.previousValue?null===(f=c[u.OPERATION.ADD])||void 0===f||f.forEach((function(u){var G;return u(V.value,null!==(G=V.dynamicIndex)&&void 0!==G?G:V.field)})):V.op===u.OPERATION.DELETE?void 0!==V.previousValue&&(null===(C=c[u.OPERATION.DELETE])||void 0===C||C.forEach((function(u){var G;return u(V.previousValue,null!==(G=V.dynamicIndex)&&void 0!==G?G:V.field)}))):V.op===u.OPERATION.DELETE_AND_ADD&&(void 0!==V.previousValue&&(null===(x=c[u.OPERATION.DELETE])||void 0===x||x.forEach((function(u){var G;return u(V.previousValue,null!==(G=V.dynamicIndex)&&void 0!==G?G:V.field)}))),null===(g=c[u.OPERATION.ADD])||void 0===g||g.forEach((function(u){var G;return u(V.value,null!==(G=V.dynamicIndex)&&void 0!==G?G:V.field)}))),V.value!==V.previousValue&&(null===(b=c[u.OPERATION.REPLACE])||void 0===b||b.forEach((function(u){var G;return u(V.value,null!==(G=V.dynamicIndex)&&void 0!==G?G:V.field)})));Q.add(F)},V=0;V<s.length;V++)n(V)},G._definition=l.create(),G}();function Bu(u){for(var G=[u.$changes],s=1,T={},z=T,O=function(u){var s=G[u];s.changes.forEach((function(u){var G=s.ref,T=u.index,O=G._definition?G._definition.fieldsByIndex[T]:G.$indexes.get(T);z[O]=s.getValue(T)}))},m=0;m<s;m++)O(m);return T}var Du={context:new H},ku=function(u){function G(){return null!==u&&u.apply(this,arguments)||this}return s(G,u),T([p("string",Du)],G.prototype,"name",void 0),T([p("string",Du)],G.prototype,"type",void 0),T([p("number",Du)],G.prototype,"referencedType",void 0),G}(Ru),wu=function(u){function G(){var G=null!==u&&u.apply(this,arguments)||this;return G.fields=new n,G}return s(G,u),T([p("number",Du)],G.prototype,"id",void 0),T([p([ku],Du)],G.prototype,"fields",void 0),G}(Ru),Lu=function(u){function G(){var G=null!==u&&u.apply(this,arguments)||this;return G.types=new n,G}return s(G,u),G.encode=function(u){var s=u.constructor,T=new G;T.rootType=s._typeid;var z=function(u,G){for(var s in G){var z=new ku;z.name=s;var O=void 0;if("string"===typeof G[s])O=G[s];else{var m=G[s],f=void 0;Ru.is(m)?(O="ref",f=G[s]):"string"===typeof m[O=Object.keys(m)[0]]?O+=":"+m[O]:f=m[O],z.referencedType=f?f._typeid:-1}z.type=O,u.fields.push(z)}T.types.push(u)},O=s._context.types;for(var m in O){var f=new wu;f.id=Number(m),z(f,O[m]._definition.schema)}return T.encodeAll()},G.decode=function(u,T){var z=new H,O=new G;O.decode(u,T);var m=O.types.reduce((function(u,G){var T=function(u){function G(){return null!==u&&u.apply(this,arguments)||this}return s(G,u),G}(Ru),O=G.id;return u[O]=T,z.add(T,O),u}),{});O.types.forEach((function(u){var G=m[u.id];u.fields.forEach((function(u){var s;if(void 0!==u.referencedType){var T=u.type,O=m[u.referencedType];if(!O){var f=u.type.split(":");T=f[0],O=f[1]}"ref"===T?p(O,{context:z})(G.prototype,u.name):p(((s={})[T]=O,s),{context:z})(G.prototype,u.name)}else p(u.type,{context:z})(G.prototype,u.name)}))}));var f=m[O.rootType],C=new f;for(var x in f._definition.schema){var g=f._definition.schema[x];"string"!==typeof g&&(C[x]="function"===typeof g?new g:new(j(Object.keys(g)[0]).constructor))}return C},T([p([wu],Du)],G.prototype,"types",void 0),T([p("number",Du)],G.prototype,"rootType",void 0),G}(Ru);c("map",{constructor:F}),c("array",{constructor:n}),c("set",{constructor:Xu}),c("collection",{constructor:Hu}),u.ArraySchema=n,u.CollectionSchema=Hu,u.Context=H,u.MapSchema=F,u.Reflection=Lu,u.ReflectionField=ku,u.ReflectionType=wu,u.Schema=Ru,u.SchemaDefinition=l,u.SetSchema=Xu,u.decode=Pu,u.defineTypes=W,u.deprecated=v,u.dumpChanges=Bu,u.encode=t,u.filter=q,u.filterChildren=d,u.hasFilter=P,u.registerType=c,u.type=p,Object.defineProperty(u,"__esModule",{value:!0})}(G)},12105:u=>{u.exports=function(u){return null!=u&&null!=u.constructor&&"function"===typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}},12083:(u,G,s)=>{"use strict";var T=s(12089),z=s(12096),O=s(12105);s.g.__TYPEDARRAY_POOL||(s.g.__TYPEDARRAY_POOL={UINT8:z([32,0]),UINT16:z([32,0]),UINT32:z([32,0]),INT8:z([32,0]),INT16:z([32,0]),INT32:z([32,0]),FLOAT:z([32,0]),DOUBLE:z([32,0]),DATA:z([32,0]),UINT8C:z([32,0]),BUFFER:z([32,0])});var m="undefined"!==typeof Uint8ClampedArray,f=s.g.__TYPEDARRAY_POOL;f.UINT8C||(f.UINT8C=z([32,0])),f.BUFFER||(f.BUFFER=z([32,0]));var C=f.DATA,x=f.BUFFER;function g(u){if(u){var G=u.length||u.byteLength,s=T.log2(G);C[s].push(u)}}function b(u){u=T.nextPow2(u);var G=T.log2(u),s=C[G];return s.length>0?s.pop():new ArrayBuffer(u)}function Q(u){return new Uint8Array(b(u),0,u)}function Y(u){return new Uint16Array(b(2*u),0,u)}function n(u){return new Uint32Array(b(4*u),0,u)}function V(u){return new Int8Array(b(u),0,u)}function F(u){return new Int16Array(b(2*u),0,u)}function r(u){return new Int32Array(b(4*u),0,u)}function c(u){return new Float32Array(b(4*u),0,u)}function j(u){return new Float64Array(b(8*u),0,u)}function l(u){return m?new Uint8ClampedArray(b(u),0,u):Q(u)}function P(u){return new DataView(b(u),0,u)}G.free=function(u){if(O(u))x[T.log2(u.length)].push(u);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(u)&&(u=u.buffer),!u)return;var G=u.length||u.byteLength,s=0|T.log2(G);C[s].push(u)}},G.freeUint8=G.freeUint16=G.freeUint32=G.freeInt8=G.freeInt16=G.freeInt32=G.freeFloat32=G.freeFloat=G.freeFloat64=G.freeDouble=G.freeUint8Clamped=G.freeDataView=function(u){g(u.buffer)},G.freeArrayBuffer=g,G.freeBuffer=function(u){x[T.log2(u.length)].push(u)},G.malloc=function(u,G){if(void 0===G||"arraybuffer"===G)return b(u);switch(G){case"uint8":return Q(u);case"uint16":return Y(u);case"uint32":return n(u);case"int8":return V(u);case"int16":return F(u);case"int32":return r(u);case"float":case"float32":return c(u);case"double":case"float64":return j(u);case"uint8_clamped":return l(u);case"buffer":throw"Buffer not supported";case"data":case"dataview":return P(u);default:return null}return null},G.mallocArrayBuffer=b,G.mallocUint8=Q,G.mallocUint16=Y,G.mallocUint32=n,G.mallocInt8=V,G.mallocInt16=F,G.mallocInt32=r,G.mallocFloat32=G.mallocFloat=c,G.mallocFloat64=G.mallocDouble=j,G.mallocUint8Clamped=l,G.mallocDataView=P,G.clearCache=function(){for(var u=0;u<32;++u)f.UINT8[u].length=0,f.UINT16[u].length=0,f.UINT32[u].length=0,f.INT8[u].length=0,f.INT16[u].length=0,f.INT32[u].length=0,f.FLOAT[u].length=0,f.DOUBLE[u].length=0,f.UINT8C[u].length=0,C[u].length=0,x[u].length=0}},12186:(u,G,s)=>{u.exports=z;var T=s(147);function z(u,G){if(!(this instanceof z))return new z(u,G);var s=T.create();T.add(s,u,G),this.base=T.min(T.create(),u,s),this.Dg=T.clone(G),this.max=T.max(T.create(),u,s),this.mag=T.length(this.Dg)}var O=z.prototype;O.width=function(){return this.Dg[0]},O.height=function(){return this.Dg[1]},O.depth=function(){return this.Dg[2]},O.x0=function(){return this.base[0]},O.y0=function(){return this.base[1]},O.z0=function(){return this.base[2]},O.x1=function(){return this.max[0]},O.y1=function(){return this.max[1]},O.z1=function(){return this.max[2]},O.translate=function(u){return T.add(this.max,this.max,u),T.add(this.base,this.base,u),this},O.setPosition=function(u){return T.add(this.max,u,this.Dg),T.j(this.base,u),this},O.expand=function(u){var G=T.create(),s=T.create();return T.max(G,u.max,this.max),T.min(s,u.base,this.base),T.Nc(G,G,s),new z(s,G)},O.intersects=function(u){return!(u.base[0]>this.max[0])&&(!(u.base[1]>this.max[1])&&(!(u.base[2]>this.max[2])&&(!(u.max[0]<this.base[0])&&(!(u.max[1]<this.base[1])&&!(u.max[2]<this.base[2])))))},O.touches=function(u){var G=this.union(u);return null!==G&&(0==G.width()||0==G.height()||0==G.depth())},O.union=function(u){if(!this.intersects(u))return null;var G=Math.max(u.base[0],this.base[0]),s=Math.max(u.base[1],this.base[1]),T=Math.max(u.base[2],this.base[2]);return new z([G,s,T],[Math.min(u.max[0],this.max[0])-G,Math.min(u.max[1],this.max[1])-s,Math.min(u.max[2],this.max[2])-T])}},12089:(u,G)=>{"use strict";function s(u){var G=32;return(u&=-u)&&G--,65535&u&&(G-=16),16711935&u&&(G-=8),252645135&u&&(G-=4),858993459&u&&(G-=2),1431655765&u&&(G-=1),G}G.INT_BITS=32,G.INT_MAX=2147483647,G.INT_MIN=-1<<31,G.sign=function(u){return(u>0)-(u<0)},G.abs=function(u){var G=u>>31;return(u^G)-G},G.min=function(u,G){return G^(u^G)&-(u<G)},G.max=function(u,G){return u^(u^G)&-(u<G)},G.isPow2=function(u){return!(u&u-1)&&!!u},G.log2=function(u){var G,s;return G=(u>65535)<<4,G|=s=((u>>>=G)>255)<<3,G|=s=((u>>>=s)>15)<<2,(G|=s=((u>>>=s)>3)<<1)|(u>>>=s)>>1},G.log10=function(u){return u>=1e9?9:u>=1e8?8:u>=1e7?7:u>=1e6?6:u>=1e5?5:u>=1e4?4:u>=1e3?3:u>=100?2:u>=10?1:0},G.popCount=function(u){return 16843009*((u=(858993459&(u-=u>>>1&1431655765))+(u>>>2&858993459))+(u>>>4)&252645135)>>>24},G.countTrailingZeros=s,G.nextPow2=function(u){return u+=0===u,--u,u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)+1},G.prevPow2=function(u){return u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)-(u>>>1)},G.parity=function(u){return u^=u>>>16,u^=u>>>8,u^=u>>>4,27030>>>(u&=15)&1};var T=new Array(256);!function(u){for(var G=0;G<256;++G){var s=G,T=G,z=7;for(s>>>=1;s;s>>>=1)T<<=1,T|=1&s,--z;u[G]=T<<z&255}}(T),G.reverse=function(u){return T[255&u]<<24|T[u>>>8&255]<<16|T[u>>>16&255]<<8|T[u>>>24&255]},G.interleave2=function(u,G){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))<<1},G.deinterleave2=function(u,G){return(u=65535&((u=16711935&((u=252645135&((u=858993459&((u=u>>>G&1431655765)|u>>>1))|u>>>2))|u>>>4))|u>>>16))<<16>>16},G.interleave3=function(u,G,s){return u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2),(u|=(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<1)|(s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2))<<2},G.deinterleave3=function(u,G){return(u=1023&((u=4278190335&((u=251719695&((u=3272356035&((u=u>>>G&1227133513)|u>>>2))|u>>>4))|u>>>8))|u>>>16))<<22>>22},G.nextCombination=function(u){var G=u|u-1;return G+1|(~G&-~G)-1>>>s(u)+1}},12077:(u,G,s)=>{"use strict";u.exports=function(u,G,s){switch(arguments.length){case 1:return T=[],x(z=u,z,g,!0),T;case 2:return"function"===typeof G?x(u,u,G,!0):function(u,G){return T=[],x(u,G,g,!1),T}(u,G);case 3:return x(u,G,s,!1);default:throw new Error("box-intersect: Invalid arguments")}var z};var T,z=s(12083),O=s(12110),m=s(12119);function f(u,G){for(var s=0;s<u;++s)if(!(G[s]<=G[s+u]))return!0;return!1}function C(u,G,s,T){for(var z=0,O=0,m=0,C=u.length;m<C;++m){var x=u[m];if(!f(G,x)){for(var g=0;g<2*G;++g)s[z++]=x[g];T[O++]=m}}return O}function x(u,G,s,T){var f=u.length,x=G.length;if(!(f<=0||x<=0)){var g=u[0].length>>>1;if(!(g<=0)){var b,Q=z.mallocDouble(2*g*f),Y=z.mallocInt32(f);if((f=C(u,g,Q,Y))>0){if(1===g&&T)O.init(f),b=O.sweepComplete(g,s,0,f,Q,Y,0,f,Q,Y);else{var n=z.mallocDouble(2*g*x),V=z.mallocInt32(x);(x=C(G,g,n,V))>0&&(O.init(f+x),b=1===g?O.sweepBipartite(g,s,0,f,Q,Y,0,x,n,V):m(g,s,T,f,Q,Y,x,n,V),z.free(n),z.free(V))}z.free(Q),z.free(Y)}return b}}}function g(u,G){T.push([u,G])}},12125:(u,G)=>{"use strict";var s="d",T="ax",z="fp",O="es",m="rs",f="re",C="rb",x="bs",g="be",b="bb",Q=[s,T,"vv",m,f,C,"ri",x,g,b,"bi"];function Y(u){var G="bruteForce"+(u?"Full":"Partial"),T=[],m=Q.slice();u||m.splice(3,0,z);var f=["function "+G+"("+m.join()+"){"];function C(G,z){var m=function(u,G,T){var z="bruteForce"+(u?"Red":"Blue")+(G?"Flip":"")+(T?"Full":""),m=["function ",z,"(",Q.join(),"){","var ",O,"=2*",s,";"],f="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(T?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return u?m.push(f,"Q",":",C):m.push(C,"Q",":",f),T?m.push("if(y1<x0||x1<y0)continue;"):G?m.push("if(y0<=x0||x1<y0)continue;"):m.push("if(y0<x0||x1<y0)continue;"),m.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),G?m.push("yi,xi"):m.push("xi,yi"),m.push(");if(rv!==void 0)return rv;}}}"),{name:z,code:m.join("")}}(G,z,u);T.push(m.code),f.push("return "+m.name+"("+Q.join()+");")}f.push("if(re-rs>be-bs){"),u?(C(!0,!1),f.push("}else{"),C(!1,!1)):(f.push("if(fp){"),C(!0,!0),f.push("}else{"),C(!0,!1),f.push("}}else{if(fp){"),C(!1,!0),f.push("}else{"),C(!1,!1),f.push("}")),f.push("}}return "+G);var x=T.join("")+f.join("");return new Function(x)()}G.partial=Y(!1),G.full=Y(!0)},12119:(u,G,s)=>{"use strict";u.exports=function(u,G,s,O,g,v,W,M,o){!function(u,G){var s=8*z.log2(G+1)*(u+1)|0,O=z.nextPow2(l*s);H.length<O&&(T.free(H),H=T.mallocInt32(O));var m=z.nextPow2(P*s);X.length<m&&(T.free(X),X=T.mallocDouble(m))}(u,O+W);var R,B=0,D=2*u;p(B++,0,0,O,0,W,s?16:0,-1/0,1/0),s||p(B++,0,0,W,0,O,1,-1/0,1/0);for(;B>0;){var k=(B-=1)*l,w=H[k],L=H[k+1],S=H[k+2],e=H[k+3],h=H[k+4],I=H[k+5],i=B*P,J=X[i],A=X[i+1],N=1&I,y=!!(16&I),a=g,K=v,Z=M,t=o;if(N&&(a=M,K=o,Z=g,t=v),!(2&I&&L>=(S=F(u,w,L,S,a,K,A)))&&!(4&I&&(L=r(u,w,L,S,a,K,J))>=S)){var E=S-L,U=h-e;if(y){if(u*E*(E+U)<Y){if(void 0!==(R=C.scanComplete(u,w,G,L,S,a,K,e,h,Z,t)))return R;continue}}else{if(u*Math.min(E,U)<b){if(void 0!==(R=m(u,w,G,N,L,S,a,K,e,h,Z,t)))return R;continue}if(u*E*U<Q){if(void 0!==(R=C.scanBipartite(u,w,G,N,L,S,a,K,e,h,Z,t)))return R;continue}}var uu=n(u,w,L,S,a,K,J,A);if(L<uu)if(u*(uu-L)<b){if(void 0!==(R=f(u,w+1,G,L,uu,a,K,e,h,Z,t)))return R}else if(w===u-2){if(void 0!==(R=N?C.sweepBipartite(u,G,e,h,Z,t,L,uu,a,K):C.sweepBipartite(u,G,L,uu,a,K,e,h,Z,t)))return R}else p(B++,w+1,L,uu,e,h,N,-1/0,1/0),p(B++,w+1,e,h,L,uu,1^N,-1/0,1/0);if(uu<S){var Gu=x(u,w,e,h,Z,t),su=Z[D*Gu+w],Tu=V(u,w,Gu,h,Z,t,su);if(Tu<h&&p(B++,w,uu,S,Tu,h,(4|N)+(y?16:0),su,A),e<Gu&&p(B++,w,uu,S,e,Gu,(2|N)+(y?16:0),J,su),Gu+1===Tu){if(void 0!==(R=y?d(u,w,G,uu,S,a,K,Gu,Z,t[Gu]):q(u,w,G,N,uu,S,a,K,Gu,Z,t[Gu])))return R}else if(Gu<Tu){var zu;if(y){if(uu<(zu=c(u,w,uu,S,a,K,su))){var Ou=V(u,w,uu,zu,a,K,su);if(w===u-2){if(uu<Ou&&void 0!==(R=C.sweepComplete(u,G,uu,Ou,a,K,Gu,Tu,Z,t)))return R;if(Ou<zu&&void 0!==(R=C.sweepBipartite(u,G,Ou,zu,a,K,Gu,Tu,Z,t)))return R}else uu<Ou&&p(B++,w+1,uu,Ou,Gu,Tu,16,-1/0,1/0),Ou<zu&&(p(B++,w+1,Ou,zu,Gu,Tu,0,-1/0,1/0),p(B++,w+1,Gu,Tu,Ou,zu,1,-1/0,1/0))}}else uu<(zu=N?j(u,w,uu,S,a,K,su):c(u,w,uu,S,a,K,su))&&(w===u-2?R=N?C.sweepBipartite(u,G,Gu,Tu,Z,t,uu,zu,a,K):C.sweepBipartite(u,G,uu,zu,a,K,Gu,Tu,Z,t):(p(B++,w+1,uu,zu,Gu,Tu,N,-1/0,1/0),p(B++,w+1,Gu,Tu,uu,zu,1^N,-1/0,1/0)))}}}}};var T=s(12083),z=s(12089),O=s(12125),m=O.partial,f=O.full,C=s(12110),x=s(12134),g=s(12137),b=128,Q=1<<22,Y=1<<22,n=g("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),V=g("lo===p0",["p0"]),F=g("lo<p0",["p0"]),r=g("hi<=p0",["p0"]),c=g("lo<=p0&&p0<=hi",["p0"]),j=g("lo<p0&&p0<=hi",["p0"]),l=6,P=2,H=T.mallocInt32(1024),X=T.mallocDouble(1024);function p(u,G,s,T,z,O,m,f,C){var x=l*u;H[x]=G,H[x+1]=s,H[x+2]=T,H[x+3]=z,H[x+4]=O,H[x+5]=m;var g=P*u;X[g]=f,X[g+1]=C}function q(u,G,s,T,z,O,m,f,C,x,g){var b=2*u,Q=C*b,Y=x[Q+G];u:for(var n=z,V=z*b;n<O;++n,V+=b){var F=m[V+G],r=m[V+G+u];if(!(Y<F||r<Y)&&(!T||Y!==F)){for(var c,j=f[n],l=G+1;l<u;++l){F=m[V+l],r=m[V+l+u];var P=x[Q+l],H=x[Q+l+u];if(r<P||H<F)continue u}if(void 0!==(c=T?s(g,j):s(j,g)))return c}}}function d(u,G,s,T,z,O,m,f,C,x){var g=2*u,b=f*g,Q=C[b+G];u:for(var Y=T,n=T*g;Y<z;++Y,n+=g){var V=m[Y];if(V!==x){var F=O[n+G],r=O[n+G+u];if(!(Q<F||r<Q)){for(var c=G+1;c<u;++c){F=O[n+c],r=O[n+c+u];var j=C[b+c],l=C[b+c+u];if(r<j||l<F)continue u}var P=s(V,x);if(void 0!==P)return P}}}}},12134:(u,G,s)=>{"use strict";u.exports=function(u,G,s,m,f,C){if(m<=s+1)return s;var x=s,g=m,b=m+s>>>1,Q=2*u,Y=b,n=f[Q*b+G];for(;x<g;){if(g-x<z){O(u,G,x,g,f,C),n=f[Q*b+G];break}var V=g-x,F=Math.random()*V+x|0,r=f[Q*F+G],c=Math.random()*V+x|0,j=f[Q*c+G],l=Math.random()*V+x|0,P=f[Q*l+G];r<=j?P>=j?(Y=c,n=j):r>=P?(Y=F,n=r):(Y=l,n=P):j>=P?(Y=c,n=j):P>=r?(Y=F,n=r):(Y=l,n=P);for(var H=Q*(g-1),X=Q*Y,p=0;p<Q;++p,++H,++X){var q=f[H];f[H]=f[X],f[X]=q}var d=C[g-1];C[g-1]=C[Y],C[Y]=d;for(H=Q*(g-1),X=Q*(Y=T(u,G,x,g-1,f,C,n)),p=0;p<Q;++p,++H,++X){q=f[H];f[H]=f[X],f[X]=q}d=C[g-1];if(C[g-1]=C[Y],C[Y]=d,b<Y){for(g=Y-1;x<g&&f[Q*(g-1)+G]===n;)g-=1;g+=1}else{if(!(Y<b))break;for(x=Y+1;x<g&&f[Q*x+G]===n;)x+=1}}return T(u,G,s,b,f,C,f[Q*b+G])};var T=s(12137)("lo<p0",["p0"]),z=8;function O(u,G,s,T,z,O){for(var m=2*u,f=m*(s+1)+G,C=s+1;C<T;++C,f+=m)for(var x=z[f],g=C,b=m*(C-1);g>s&&z[b+G]>x;--g,b-=m){for(var Q=b,Y=b+m,n=0;n<m;++n,++Q,++Y){var V=z[Q];z[Q]=z[Y],z[Y]=V}var F=O[g];O[g]=O[g-1],O[g-1]=F}}},12137:u=>{"use strict";u.exports=function(u,s){var T="abcdef".split("").concat(s),z=[];u.indexOf("lo")>=0&&z.push("lo=e[k+n]");u.indexOf("hi")>=0&&z.push("hi=e[k+o]");return T.push(G.replace("_",z.join()).replace("$",u)),Function.apply(void 0,T)};var G="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12112:u=>{"use strict";u.exports=function(u,T){T<=4*G?s(0,T-1,u):x(0,T-1,u)};var G=32;function s(u,G,s){for(var T=2*(u+1),z=u+1;z<=G;++z){for(var O=s[T++],m=s[T++],f=z,C=T-2;f-- >u;){var x=s[C-2],g=s[C-1];if(x<O)break;if(x===O&&g<m)break;s[C]=x,s[C+1]=g,C-=2}s[C]=O,s[C+1]=m}}function T(u,G,s){G*=2;var T=s[u*=2],z=s[u+1];s[u]=s[G],s[u+1]=s[G+1],s[G]=T,s[G+1]=z}function z(u,G,s){G*=2,s[u*=2]=s[G],s[u+1]=s[G+1]}function O(u,G,s,T){G*=2,s*=2;var z=T[u*=2],O=T[u+1];T[u]=T[G],T[u+1]=T[G+1],T[G]=T[s],T[G+1]=T[s+1],T[s]=z,T[s+1]=O}function m(u,G,s,T,z){G*=2,z[u*=2]=z[G],z[G]=s,z[u+1]=z[G+1],z[G+1]=T}function f(u,G,s){G*=2;var T=s[u*=2],z=s[G];return!(T<z)&&(T!==z||s[u+1]>s[G+1])}function C(u,G,s,T){var z=T[u*=2];return z<G||z===G&&T[u+1]<s}function x(u,g,b){var Q=(g-u+1)/6|0,Y=u+Q,n=g-Q,V=u+g>>1,F=V-Q,r=V+Q,c=Y,j=F,l=V,P=r,H=n,X=u+1,p=g-1,q=0;f(c,j,b)&&(q=c,c=j,j=q),f(P,H,b)&&(q=P,P=H,H=q),f(c,l,b)&&(q=c,c=l,l=q),f(j,l,b)&&(q=j,j=l,l=q),f(c,P,b)&&(q=c,c=P,P=q),f(l,P,b)&&(q=l,l=P,P=q),f(j,H,b)&&(q=j,j=H,H=q),f(j,l,b)&&(q=j,j=l,l=q),f(P,H,b)&&(q=P,P=H,H=q);for(var d=b[2*j],v=b[2*j+1],W=b[2*P],M=b[2*P+1],o=2*c,R=2*l,B=2*H,D=2*Y,k=2*V,w=2*n,L=0;L<2;++L){var S=b[o+L],e=b[R+L],h=b[B+L];b[D+L]=S,b[k+L]=e,b[w+L]=h}z(F,u,b),z(r,g,b);for(var I=X;I<=p;++I)if(C(I,d,v,b))I!==X&&T(I,X,b),++X;else if(!C(I,W,M,b))for(;;){if(C(p,W,M,b)){C(p,d,v,b)?(O(I,X,p,b),++X,--p):(T(I,p,b),--p);break}if(--p<I)break}m(u,X-1,d,v,b),m(g,p+1,W,M,b),X-2-u<=G?s(u,X-2,b):x(u,X-2,b),g-(p+2)<=G?s(p+2,g,b):x(p+2,g,b),p-X<=G?s(X,p,b):x(X,p,b)}},12110:(u,G,s)=>{"use strict";u.exports={init:function(u){var G=z.nextPow2(u);C.length<G&&(T.free(C),C=T.mallocInt32(G));x.length<G&&(T.free(x),x=T.mallocInt32(G));g.length<G&&(T.free(g),g=T.mallocInt32(G));b.length<G&&(T.free(b),b=T.mallocInt32(G));Q.length<G&&(T.free(Q),Q=T.mallocInt32(G));Y.length<G&&(T.free(Y),Y=T.mallocInt32(G));var s=8*G;n.length<s&&(T.free(n),n=T.mallocDouble(s))},sweepBipartite:function(u,G,s,T,z,f,Q,Y,r,c){for(var j=0,l=2*u,P=u-1,H=l-1,X=s;X<T;++X){var p=f[X],q=l*X;n[j++]=z[q+P],n[j++]=-(p+1),n[j++]=z[q+H],n[j++]=p}for(X=Q;X<Y;++X){p=c[X]+m;var d=l*X;n[j++]=r[d+P],n[j++]=-p,n[j++]=r[d+H],n[j++]=p}var v=j>>>1;O(n,v);var W=0,M=0;for(X=0;X<v;++X){var o=0|n[2*X+1];if(o>=m)V(g,b,M--,o=o-m|0);else if(o>=0)V(C,x,W--,o);else if(o<=-m){o=-o-m|0;for(var R=0;R<W;++R){if(void 0!==(B=G(C[R],o)))return B}F(g,b,M++,o)}else{o=-o-1|0;for(R=0;R<M;++R){var B;if(void 0!==(B=G(o,g[R])))return B}F(C,x,W++,o)}}},sweepComplete:function(u,G,s,T,z,m,f,r,c,j){for(var l=0,P=2*u,H=u-1,X=P-1,p=s;p<T;++p){var q=m[p]+1<<1,d=P*p;n[l++]=z[d+H],n[l++]=-q,n[l++]=z[d+X],n[l++]=q}for(p=f;p<r;++p){q=j[p]+1<<1;var v=P*p;n[l++]=c[v+H],n[l++]=1|-q,n[l++]=c[v+X],n[l++]=1|q}var W=l>>>1;O(n,W);var M=0,o=0,R=0;for(p=0;p<W;++p){var B=0|n[2*p+1],D=1&B;if(p<W-1&&B>>1===n[2*p+3]>>1&&(D=2,p+=1),B<0){for(var k=-(B>>1)-1,w=0;w<R;++w){if(void 0!==(L=G(Q[w],k)))return L}if(0!==D)for(w=0;w<M;++w){if(void 0!==(L=G(C[w],k)))return L}if(1!==D)for(w=0;w<o;++w){var L;if(void 0!==(L=G(g[w],k)))return L}0===D?F(C,x,M++,k):1===D?F(g,b,o++,k):2===D&&F(Q,Y,R++,k)}else{k=(B>>1)-1;0===D?V(C,x,M--,k):1===D?V(g,b,o--,k):2===D&&V(Q,Y,R--,k)}}},scanBipartite:function(u,G,s,T,z,f,g,b,Q,Y,r,c){var j=0,l=2*u,P=G,H=G+u,X=1,p=1;T?p=m:X=m;for(var q=z;q<f;++q){var d=q+X,v=l*q;n[j++]=g[v+P],n[j++]=-d,n[j++]=g[v+H],n[j++]=d}for(q=Q;q<Y;++q){d=q+p;var W=l*q;n[j++]=r[W+P],n[j++]=-d}var M=j>>>1;O(n,M);var o=0;for(q=0;q<M;++q){var R=0|n[2*q+1];if(R<0){var B=!1;if((d=-R)>=m?(B=!T,d-=m):(B=!!T,d-=1),B)F(C,x,o++,d);else{var D=c[d],k=l*d,w=r[k+G+1],L=r[k+G+1+u];u:for(var S=0;S<o;++S){var e=C[S],h=l*e;if(!(L<g[h+G+1]||g[h+G+1+u]<w)){for(var I=G+2;I<u;++I)if(r[k+I+u]<g[h+I]||g[h+I+u]<r[k+I])continue u;var i,J=b[e];if(void 0!==(i=T?s(D,J):s(J,D)))return i}}}}else V(C,x,o--,R-X)}},scanComplete:function(u,G,s,T,z,f,x,g,b,Q,Y){for(var V=0,F=2*u,r=G,c=G+u,j=T;j<z;++j){var l=j+m,P=F*j;n[V++]=f[P+r],n[V++]=-l,n[V++]=f[P+c],n[V++]=l}for(j=g;j<b;++j){l=j+1;var H=F*j;n[V++]=Q[H+r],n[V++]=-l}var X=V>>>1;O(n,X);var p=0;for(j=0;j<X;++j){var q=0|n[2*j+1];if(q<0){if((l=-q)>=m)C[p++]=l-m;else{var d=Y[l-=1],v=F*l,W=Q[v+G+1],M=Q[v+G+1+u];u:for(var o=0;o<p;++o){var R=C[o],B=x[R];if(B===d)break;var D=F*R;if(!(M<f[D+G+1]||f[D+G+1+u]<W)){for(var k=G+2;k<u;++k)if(Q[v+k+u]<f[D+k]||f[D+k+u]<Q[v+k])continue u;var w=s(B,d);if(void 0!==w)return w}}}}else{for(l=q-m,o=p-1;o>=0;--o)if(C[o]===l){for(k=o+1;k<p;++k)C[k-1]=C[k];break}--p}}}};var T=s(12083),z=s(12089),O=s(12112),m=1<<28,f=1024,C=T.mallocInt32(f),x=T.mallocInt32(f),g=T.mallocInt32(f),b=T.mallocInt32(f),Q=T.mallocInt32(f),Y=T.mallocInt32(f),n=T.mallocDouble(8192);function V(u,G,s,T){var z=G[T],O=u[s-1];u[z]=O,G[O]=z}function F(u,G,s,T){u[s]=T,G[T]=s}},12244:u=>{"use strict";u.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12235:(u,G,s)=>{var T=s(12244),z=s(12251),O=Object.hasOwnProperty,m=Object.create(null);for(var f in T)O.call(T,f)&&(m[T[f]]=f);var C=u.exports={to:{},get:{}};function x(u,G,s){return Math.min(Math.max(G,u),s)}function g(u){var G=Math.round(u).toString(16).toUpperCase();return G.length<2?"0"+G:G}C.get=function(u){var G,s;switch(u.substring(0,3).toLowerCase()){case"hsl":G=C.get.hsl(u),s="hsl";break;case"hwb":G=C.get.hwb(u),s="hwb";break;default:G=C.get.rgb(u),s="rgb"}return G?{model:s,value:G}:null},C.get.rgb=function(u){if(!u)return null;var G,s,z,m=[0,0,0,1];if(G=u.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(z=G[2],G=G[1],s=0;s<3;s++){var f=2*s;m[s]=parseInt(G.slice(f,f+2),16)}z&&(m[3]=parseInt(z,16)/255)}else if(G=u.match(/^#([a-f0-9]{3,4})$/i)){for(z=(G=G[1])[3],s=0;s<3;s++)m[s]=parseInt(G[s]+G[s],16);z&&(m[3]=parseInt(z+z,16)/255)}else if(G=u.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(s=0;s<3;s++)m[s]=parseInt(G[s+1],0);G[4]&&(G[5]?m[3]=.01*parseFloat(G[4]):m[3]=parseFloat(G[4]))}else{if(!(G=u.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(G=u.match(/^(\w+)$/))?"transparent"===G[1]?[0,0,0,0]:O.call(T,G[1])?((m=T[G[1]])[3]=1,m):null:null;for(s=0;s<3;s++)m[s]=Math.round(2.55*parseFloat(G[s+1]));G[4]&&(G[5]?m[3]=.01*parseFloat(G[4]):m[3]=parseFloat(G[4]))}for(s=0;s<3;s++)m[s]=x(m[s],0,255);return m[3]=x(m[3],0,1),m},C.get.hsl=function(u){if(!u)return null;var G=u.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(G){var s=parseFloat(G[4]);return[(parseFloat(G[1])%360+360)%360,x(parseFloat(G[2]),0,100),x(parseFloat(G[3]),0,100),x(isNaN(s)?1:s,0,1)]}return null},C.get.hwb=function(u){if(!u)return null;var G=u.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(G){var s=parseFloat(G[4]);return[(parseFloat(G[1])%360+360)%360,x(parseFloat(G[2]),0,100),x(parseFloat(G[3]),0,100),x(isNaN(s)?1:s,0,1)]}return null},C.to.hex=function(){var u=z(arguments);return"#"+g(u[0])+g(u[1])+g(u[2])+(u[3]<1?g(Math.round(255*u[3])):"")},C.to.rgb=function(){var u=z(arguments);return u.length<4||1===u[3]?"rgb("+Math.round(u[0])+", "+Math.round(u[1])+", "+Math.round(u[2])+")":"rgba("+Math.round(u[0])+", "+Math.round(u[1])+", "+Math.round(u[2])+", "+u[3]+")"},C.to.rgb.percent=function(){var u=z(arguments),G=Math.round(u[0]/255*100),s=Math.round(u[1]/255*100),T=Math.round(u[2]/255*100);return u.length<4||1===u[3]?"rgb("+G+"%, "+s+"%, "+T+"%)":"rgba("+G+"%, "+s+"%, "+T+"%, "+u[3]+")"},C.to.hsl=function(){var u=z(arguments);return u.length<4||1===u[3]?"hsl("+u[0]+", "+u[1]+"%, "+u[2]+"%)":"hsla("+u[0]+", "+u[1]+"%, "+u[2]+"%, "+u[3]+")"},C.to.hwb=function(){var u=z(arguments),G="";return u.length>=4&&1!==u[3]&&(G=", "+u[3]),"hwb("+u[0]+", "+u[1]+"%, "+u[2]+"%"+G+")"},C.to.keyword=function(u){return m[u.slice(0,3)]}},12227:(u,G,s)=>{const T=s(12235),z=s(12260),O=["keyword","gray","hex"],m={};for(const Y of Object.keys(z))m[[...z[Y].labels].sort().join("")]=Y;const f={};function C(u,G){if(!(this instanceof C))return new C(u,G);if(G&&G in O&&(G=null),G&&!(G in z))throw new Error("Unknown model: "+G);let s,x;if(null==u)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(u instanceof C)this.model=u.model,this.color=[...u.color],this.valpha=u.valpha;else if("string"===typeof u){const G=T.get(u);if(null===G)throw new Error("Unable to parse color from string: "+u);this.model=G.model,x=z[this.model].channels,this.color=G.value.slice(0,x),this.valpha="number"===typeof G.value[x]?G.value[x]:1}else if(u.length>0){this.model=G||"rgb",x=z[this.model].channels;const s=Array.prototype.slice.call(u,0,x);this.color=Q(s,x),this.valpha="number"===typeof u[x]?u[x]:1}else if("number"===typeof u)this.model="rgb",this.color=[u>>16&255,u>>8&255,255&u],this.valpha=1;else{this.valpha=1;const G=Object.keys(u);"alpha"in u&&(G.splice(G.indexOf("alpha"),1),this.valpha="number"===typeof u.alpha?u.alpha:0);const T=G.sort().join("");if(!(T in m))throw new Error("Unable to parse color from object: "+JSON.stringify(u));this.model=m[T];const{labels:O}=z[this.model],f=[];for(s=0;s<O.length;s++)f.push(u[O[s]]);this.color=Q(f)}if(f[this.model])for(x=z[this.model].channels,s=0;s<x;s++){const u=f[this.model][s];u&&(this.color[s]=u(this.color[s]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(u){let G=this.model in T.to?this:this.rgb();G=G.round("number"===typeof u?u:1);const s=1===G.valpha?G.color:[...G.color,this.valpha];return T.to[G.model](s)},percentString(u){const G=this.rgb().round("number"===typeof u?u:1),s=1===G.valpha?G.color:[...G.color,this.valpha];return T.to.rgb.percent(s)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const u={},{channels:G}=z[this.model],{labels:s}=z[this.model];for(let T=0;T<G;T++)u[s[T]]=this.color[T];return 1!==this.valpha&&(u.alpha=this.valpha),u},unitArray(){const u=this.rgb().color;return u[0]/=255,u[1]/=255,u[2]/=255,1!==this.valpha&&u.push(this.valpha),u},unitObject(){const u=this.rgb().object();return u.r/=255,u.g/=255,u.b/=255,1!==this.valpha&&(u.alpha=this.valpha),u},round(u){return u=Math.max(u||0,0),new C([...this.color.map(x(u)),this.valpha],this.model)},alpha(u){return void 0!==u?new C([...this.color,Math.max(0,Math.min(1,u))],this.model):this.valpha},red:g("rgb",0,b(255)),green:g("rgb",1,b(255)),blue:g("rgb",2,b(255)),hue:g(["hsl","hsv","hsl","hwb","hcg"],0,(u=>(u%360+360)%360)),saturationl:g("hsl",1,b(100)),lightness:g("hsl",2,b(100)),saturationv:g("hsv",1,b(100)),value:g("hsv",2,b(100)),chroma:g("hcg",1,b(100)),gray:g("hcg",2,b(100)),white:g("hwb",1,b(100)),wblack:g("hwb",2,b(100)),cyan:g("cmyk",0,b(100)),magenta:g("cmyk",1,b(100)),yellow:g("cmyk",2,b(100)),black:g("cmyk",3,b(100)),x:g("xyz",0,b(95.047)),y:g("xyz",1,b(100)),z:g("xyz",2,b(108.833)),l:g("lab",0,b(100)),a:g("lab",1),b:g("lab",2),keyword(u){return void 0!==u?new C(u):z[this.model].keyword(this.color)},hex(u){return void 0!==u?new C(u):T.to.hex(this.rgb().round().color)},hexa(u){if(void 0!==u)return new C(u);const G=this.rgb().round().color;let s=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===s.length&&(s="0"+s),T.to.hex(G)+s},rgbNumber(){const u=this.rgb().color;return(255&u[0])<<16|(255&u[1])<<8|255&u[2]},luminosity(){const u=this.rgb().color,G=[];for(const[s,T]of u.entries()){const u=T/255;G[s]=u<=.04045?u/12.92:((u+.055)/1.055)**2.4}return.2126*G[0]+.7152*G[1]+.0722*G[2]},contrast(u){const G=this.luminosity(),s=u.luminosity();return G>s?(G+.05)/(s+.05):(s+.05)/(G+.05)},level(u){const G=this.contrast(u);return G>=7?"AAA":G>=4.5?"AA":""},isDark(){const u=this.rgb().color;return(2126*u[0]+7152*u[1]+722*u[2])/1e4<128},isLight(){return!this.isDark()},negate(){const u=this.rgb();for(let G=0;G<3;G++)u.color[G]=255-u.color[G];return u},lighten(u){const G=this.hsl();return G.color[2]+=G.color[2]*u,G},darken(u){const G=this.hsl();return G.color[2]-=G.color[2]*u,G},saturate(u){const G=this.hsl();return G.color[1]+=G.color[1]*u,G},desaturate(u){const G=this.hsl();return G.color[1]-=G.color[1]*u,G},whiten(u){const G=this.hwb();return G.color[1]+=G.color[1]*u,G},blacken(u){const G=this.hwb();return G.color[2]+=G.color[2]*u,G},grayscale(){const u=this.rgb().color,G=.3*u[0]+.59*u[1]+.11*u[2];return C.rgb(G,G,G)},fade(u){return this.alpha(this.valpha-this.valpha*u)},opaquer(u){return this.alpha(this.valpha+this.valpha*u)},rotate(u){const G=this.hsl();let s=G.color[0];return s=(s+u)%360,s=s<0?360+s:s,G.color[0]=s,G},mix(u,G){if(!u||!u.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof u);const s=u.rgb(),T=this.rgb(),z=void 0===G?.5:G,O=2*z-1,m=s.alpha()-T.alpha(),f=((O*m===-1?O:(O+m)/(1+O*m))+1)/2,x=1-f;return C.rgb(f*s.red()+x*T.red(),f*s.green()+x*T.green(),f*s.blue()+x*T.blue(),s.alpha()*z+T.alpha()*(1-z))}};for(const Y of Object.keys(z)){if(O.includes(Y))continue;const{channels:u}=z[Y];C.prototype[Y]=function(){if(this.model===Y)return new C(this);for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];return G.length>0?new C(G,Y):new C([...(T=z[this.model][Y].raw(this.color),Array.isArray(T)?T:[T]),this.valpha],Y);var T},C[Y]=function(){for(var G=arguments.length,s=new Array(G),T=0;T<G;T++)s[T]=arguments[T];let z=s[0];return"number"===typeof z&&(z=Q(s,u)),new C(z,Y)}}function x(u){return function(G){return function(u,G){return Number(u.toFixed(G))}(G,u)}}function g(u,G,s){u=Array.isArray(u)?u:[u];for(const T of u)(f[T]||(f[T]=[]))[G]=s;return u=u[0],function(T){let z;return void 0!==T?(s&&(T=s(T)),z=this[u](),z.color[G]=T,z):(z=this[u]().color[G],s&&(z=s(z)),z)}}function b(u){return function(G){return Math.max(0,Math.min(u,G))}}function Q(u,G){for(let s=0;s<G;s++)"number"!==typeof u[s]&&(u[s]=0);return u}u.exports=C},12263:(u,G,s)=>{const T=s(12267),z={};for(const m of Object.keys(T))z[T[m]]=m;const O={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};u.exports=O;for(const m of Object.keys(O)){if(!("channels"in O[m]))throw new Error("missing channels property: "+m);if(!("labels"in O[m]))throw new Error("missing channel labels property: "+m);if(O[m].labels.length!==O[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:u,labels:G}=O[m];delete O[m].channels,delete O[m].labels,Object.defineProperty(O[m],"channels",{value:u}),Object.defineProperty(O[m],"labels",{value:G})}O.rgb.hsl=function(u){const G=u[0]/255,s=u[1]/255,T=u[2]/255,z=Math.min(G,s,T),O=Math.max(G,s,T),m=O-z;let f,C;O===z?f=0:G===O?f=(s-T)/m:s===O?f=2+(T-G)/m:T===O&&(f=4+(G-s)/m),f=Math.min(60*f,360),f<0&&(f+=360);const x=(z+O)/2;return C=O===z?0:x<=.5?m/(O+z):m/(2-O-z),[f,100*C,100*x]},O.rgb.hsv=function(u){let G,s,T,z,O;const m=u[0]/255,f=u[1]/255,C=u[2]/255,x=Math.max(m,f,C),g=x-Math.min(m,f,C),b=function(u){return(x-u)/6/g+.5};return 0===g?(z=0,O=0):(O=g/x,G=b(m),s=b(f),T=b(C),m===x?z=T-s:f===x?z=1/3+G-T:C===x&&(z=2/3+s-G),z<0?z+=1:z>1&&(z-=1)),[360*z,100*O,100*x]},O.rgb.hwb=function(u){const G=u[0],s=u[1];let T=u[2];const z=O.rgb.hsl(u)[0],m=1/255*Math.min(G,Math.min(s,T));return T=1-1/255*Math.max(G,Math.max(s,T)),[z,100*m,100*T]},O.rgb.cmyk=function(u){const G=u[0]/255,s=u[1]/255,T=u[2]/255,z=Math.min(1-G,1-s,1-T);return[100*((1-G-z)/(1-z)||0),100*((1-s-z)/(1-z)||0),100*((1-T-z)/(1-z)||0),100*z]},O.rgb.keyword=function(u){const G=z[u];if(G)return G;let s,O=1/0;for(const z of Object.keys(T)){const G=T[z],C=(f=G,((m=u)[0]-f[0])**2+(m[1]-f[1])**2+(m[2]-f[2])**2);C<O&&(O=C,s=z)}var m,f;return s},O.keyword.rgb=function(u){return T[u]},O.rgb.xyz=function(u){let G=u[0]/255,s=u[1]/255,T=u[2]/255;G=G>.04045?((G+.055)/1.055)**2.4:G/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92;return[100*(.4124*G+.3576*s+.1805*T),100*(.2126*G+.7152*s+.0722*T),100*(.0193*G+.1192*s+.9505*T)]},O.rgb.lab=function(u){const G=O.rgb.xyz(u);let s=G[0],T=G[1],z=G[2];s/=95.047,T/=100,z/=108.883,s=s>.008856?s**(1/3):7.787*s+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*T-16,500*(s-T),200*(T-z)]},O.hsl.rgb=function(u){const G=u[0]/360,s=u[1]/100,T=u[2]/100;let z,O,m;if(0===s)return m=255*T,[m,m,m];z=T<.5?T*(1+s):T+s-T*s;const f=2*T-z,C=[0,0,0];for(let x=0;x<3;x++)O=G+1/3*-(x-1),O<0&&O++,O>1&&O--,m=6*O<1?f+6*(z-f)*O:2*O<1?z:3*O<2?f+(z-f)*(2/3-O)*6:f,C[x]=255*m;return C},O.hsl.hsv=function(u){const G=u[0];let s=u[1]/100,T=u[2]/100,z=s;const O=Math.max(T,.01);T*=2,s*=T<=1?T:2-T,z*=O<=1?O:2-O;return[G,100*(0===T?2*z/(O+z):2*s/(T+s)),100*((T+s)/2)]},O.hsv.rgb=function(u){const G=u[0]/60,s=u[1]/100;let T=u[2]/100;const z=Math.floor(G)%6,O=G-Math.floor(G),m=255*T*(1-s),f=255*T*(1-s*O),C=255*T*(1-s*(1-O));switch(T*=255,z){case 0:return[T,C,m];case 1:return[f,T,m];case 2:return[m,T,C];case 3:return[m,f,T];case 4:return[C,m,T];case 5:return[T,m,f]}},O.hsv.hsl=function(u){const G=u[0],s=u[1]/100,T=u[2]/100,z=Math.max(T,.01);let O,m;m=(2-s)*T;const f=(2-s)*z;return O=s*z,O/=f<=1?f:2-f,O=O||0,m/=2,[G,100*O,100*m]},O.hwb.rgb=function(u){const G=u[0]/360;let s=u[1]/100,T=u[2]/100;const z=s+T;let O;z>1&&(s/=z,T/=z);const m=Math.floor(6*G),f=1-T;O=6*G-m,0!==(1&m)&&(O=1-O);const C=s+O*(f-s);let x,g,b;switch(m){default:case 6:case 0:x=f,g=C,b=s;break;case 1:x=C,g=f,b=s;break;case 2:x=s,g=f,b=C;break;case 3:x=s,g=C,b=f;break;case 4:x=C,g=s,b=f;break;case 5:x=f,g=s,b=C}return[255*x,255*g,255*b]},O.cmyk.rgb=function(u){const G=u[0]/100,s=u[1]/100,T=u[2]/100,z=u[3]/100;return[255*(1-Math.min(1,G*(1-z)+z)),255*(1-Math.min(1,s*(1-z)+z)),255*(1-Math.min(1,T*(1-z)+z))]},O.xyz.rgb=function(u){const G=u[0]/100,s=u[1]/100,T=u[2]/100;let z,O,m;return z=3.2406*G+-1.5372*s+-.4986*T,O=-.9689*G+1.8758*s+.0415*T,m=.0557*G+-.204*s+1.057*T,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,z=Math.min(Math.max(0,z),1),O=Math.min(Math.max(0,O),1),m=Math.min(Math.max(0,m),1),[255*z,255*O,255*m]},O.xyz.lab=function(u){let G=u[0],s=u[1],T=u[2];G/=95.047,s/=100,T/=108.883,G=G>.008856?G**(1/3):7.787*G+16/116,s=s>.008856?s**(1/3):7.787*s+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*s-16,500*(G-s),200*(s-T)]},O.lab.xyz=function(u){let G,s,T;s=(u[0]+16)/116,G=u[1]/500+s,T=s-u[2]/200;const z=s**3,O=G**3,m=T**3;return s=z>.008856?z:(s-16/116)/7.787,G=O>.008856?O:(G-16/116)/7.787,T=m>.008856?m:(T-16/116)/7.787,G*=95.047,s*=100,T*=108.883,[G,s,T]},O.lab.lch=function(u){const G=u[0],s=u[1],T=u[2];let z;z=360*Math.atan2(T,s)/2/Math.PI,z<0&&(z+=360);return[G,Math.sqrt(s*s+T*T),z]},O.lch.lab=function(u){const G=u[0],s=u[1],T=u[2]/360*2*Math.PI;return[G,s*Math.cos(T),s*Math.sin(T)]},O.rgb.ansi16=function(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[s,T,z]=u;let m=null===G?O.rgb.hsv(u)[2]:G;if(m=Math.round(m/50),0===m)return 30;let f=30+(Math.round(z/255)<<2|Math.round(T/255)<<1|Math.round(s/255));return 2===m&&(f+=60),f},O.hsv.ansi16=function(u){return O.rgb.ansi16(O.hsv.rgb(u),u[2])},O.rgb.ansi256=function(u){const G=u[0],s=u[1],T=u[2];if(G===s&&s===T)return G<8?16:G>248?231:Math.round((G-8)/247*24)+232;return 16+36*Math.round(G/255*5)+6*Math.round(s/255*5)+Math.round(T/255*5)},O.ansi16.rgb=function(u){let G=u%10;if(0===G||7===G)return u>50&&(G+=3.5),G=G/10.5*255,[G,G,G];const s=.5*(1+~~(u>50));return[(1&G)*s*255,(G>>1&1)*s*255,(G>>2&1)*s*255]},O.ansi256.rgb=function(u){if(u>=232){const G=10*(u-232)+8;return[G,G,G]}let G;u-=16;return[Math.floor(u/36)/5*255,Math.floor((G=u%36)/6)/5*255,G%6/5*255]},O.rgb.hex=function(u){const G=(((255&Math.round(u[0]))<<16)+((255&Math.round(u[1]))<<8)+(255&Math.round(u[2]))).toString(16).toUpperCase();return"000000".substring(G.length)+G},O.hex.rgb=function(u){const G=u.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!G)return[0,0,0];let s=G[0];3===G[0].length&&(s=s.split("").map((u=>u+u)).join(""));const T=parseInt(s,16);return[T>>16&255,T>>8&255,255&T]},O.rgb.hcg=function(u){const G=u[0]/255,s=u[1]/255,T=u[2]/255,z=Math.max(Math.max(G,s),T),O=Math.min(Math.min(G,s),T),m=z-O;let f,C;return f=m<1?O/(1-m):0,C=m<=0?0:z===G?(s-T)/m%6:z===s?2+(T-G)/m:4+(G-s)/m,C/=6,C%=1,[360*C,100*m,100*f]},O.hsl.hcg=function(u){const G=u[1]/100,s=u[2]/100,T=s<.5?2*G*s:2*G*(1-s);let z=0;return T<1&&(z=(s-.5*T)/(1-T)),[u[0],100*T,100*z]},O.hsv.hcg=function(u){const G=u[1]/100,s=u[2]/100,T=G*s;let z=0;return T<1&&(z=(s-T)/(1-T)),[u[0],100*T,100*z]},O.hcg.rgb=function(u){const G=u[0]/360,s=u[1]/100,T=u[2]/100;if(0===s)return[255*T,255*T,255*T];const z=[0,0,0],O=G%1*6,m=O%1,f=1-m;let C=0;switch(Math.floor(O)){case 0:z[0]=1,z[1]=m,z[2]=0;break;case 1:z[0]=f,z[1]=1,z[2]=0;break;case 2:z[0]=0,z[1]=1,z[2]=m;break;case 3:z[0]=0,z[1]=f,z[2]=1;break;case 4:z[0]=m,z[1]=0,z[2]=1;break;default:z[0]=1,z[1]=0,z[2]=f}return C=(1-s)*T,[255*(s*z[0]+C),255*(s*z[1]+C),255*(s*z[2]+C)]},O.hcg.hsv=function(u){const G=u[1]/100,s=G+u[2]/100*(1-G);let T=0;return s>0&&(T=G/s),[u[0],100*T,100*s]},O.hcg.hsl=function(u){const G=u[1]/100,s=u[2]/100*(1-G)+.5*G;let T=0;return s>0&&s<.5?T=G/(2*s):s>=.5&&s<1&&(T=G/(2*(1-s))),[u[0],100*T,100*s]},O.hcg.hwb=function(u){const G=u[1]/100,s=G+u[2]/100*(1-G);return[u[0],100*(s-G),100*(1-s)]},O.hwb.hcg=function(u){const G=u[1]/100,s=1-u[2]/100,T=s-G;let z=0;return T<1&&(z=(s-T)/(1-T)),[u[0],100*T,100*z]},O.apple.rgb=function(u){return[u[0]/65535*255,u[1]/65535*255,u[2]/65535*255]},O.rgb.apple=function(u){return[u[0]/255*65535,u[1]/255*65535,u[2]/255*65535]},O.gray.rgb=function(u){return[u[0]/100*255,u[0]/100*255,u[0]/100*255]},O.gray.hsl=function(u){return[0,0,u[0]]},O.gray.hsv=O.gray.hsl,O.gray.hwb=function(u){return[0,100,u[0]]},O.gray.cmyk=function(u){return[0,0,0,u[0]]},O.gray.lab=function(u){return[u[0],0,0]},O.gray.hex=function(u){const G=255&Math.round(u[0]/100*255),s=((G<<16)+(G<<8)+G).toString(16).toUpperCase();return"000000".substring(s.length)+s},O.rgb.gray=function(u){return[(u[0]+u[1]+u[2])/3/255*100]}},12260:(u,G,s)=>{const T=s(12263),z=s(12274),O={};Object.keys(T).forEach((u=>{O[u]={},Object.defineProperty(O[u],"channels",{value:T[u].channels}),Object.defineProperty(O[u],"labels",{value:T[u].labels});const G=z(u);Object.keys(G).forEach((s=>{const T=G[s];O[u][s]=function(u){const G=function(){for(var G=arguments.length,s=new Array(G),T=0;T<G;T++)s[T]=arguments[T];const z=s[0];if(void 0===z||null===z)return z;z.length>1&&(s=z);const O=u(s);if("object"===typeof O)for(let u=O.length,m=0;m<u;m++)O[m]=Math.round(O[m]);return O};return"conversion"in u&&(G.conversion=u.conversion),G}(T),O[u][s].raw=function(u){const G=function(){for(var G=arguments.length,s=new Array(G),T=0;T<G;T++)s[T]=arguments[T];const z=s[0];return void 0===z||null===z?z:(z.length>1&&(s=z),u(s))};return"conversion"in u&&(G.conversion=u.conversion),G}(T)}))})),u.exports=O},12274:(u,G,s)=>{const T=s(12263);function z(u){const G=function(){const u={},G=Object.keys(T);for(let s=G.length,T=0;T<s;T++)u[G[T]]={distance:-1,parent:null};return u}(),s=[u];for(G[u].distance=0;s.length;){const u=s.pop(),z=Object.keys(T[u]);for(let T=z.length,O=0;O<T;O++){const T=z[O],m=G[T];-1===m.distance&&(m.distance=G[u].distance+1,m.parent=u,s.unshift(T))}}return G}function O(u,G){return function(s){return G(u(s))}}function m(u,G){const s=[G[u].parent,u];let z=T[G[u].parent][u],m=G[u].parent;for(;G[m].parent;)s.unshift(G[m].parent),z=O(T[G[m].parent][m],z),m=G[m].parent;return z.conversion=s,z}u.exports=function(u){const G=z(u),s={},T=Object.keys(G);for(let z=T.length,O=0;O<z;O++){const u=T[O];null!==G[u].parent&&(s[u]=m(u,G))}return s}},12267:u=>{"use strict";u.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10486:function(u,G,s){"use strict";var T=this&&this.__createBinding||(Object.create?function(u,G,s,T){void 0===T&&(T=s);var z=Object.getOwnPropertyDescriptor(G,s);z&&!("get"in z?!G.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return G[s]}}),Object.defineProperty(u,T,z)}:function(u,G,s,T){void 0===T&&(T=s),u[T]=G[s]}),z=this&&this.__setModuleDefault||(Object.create?function(u,G){Object.defineProperty(u,"default",{enumerable:!0,value:G})}:function(u,G){u.default=G}),O=this&&this.__importStar||function(u){if(u&&u.__esModule)return u;var G={};if(null!=u)for(var s in u)"default"!==s&&Object.prototype.hasOwnProperty.call(u,s)&&T(G,u,s);return z(G,u),G},m=this&&this.__awaiter||function(u,G,s,T){return new(s||(s=Promise))((function(z,O){function m(u){try{C(T.next(u))}catch(G){O(G)}}function f(u){try{C(T.throw(u))}catch(G){O(G)}}function C(u){var G;u.done?z(u.value):(G=u.value,G instanceof s?G:new s((function(u){u(G)}))).then(m,f)}C((T=T.apply(u,G||[])).next())}))};Object.defineProperty(G,"__esModule",{value:!0}),G.Auth=G.Platform=void 0;const f=O(s(10419)),C=s(10489),x="colyseus-auth-token";!function(u){u.ios="ios",u.android="android"}(G.Platform||(G.Platform={}));G.Auth=class{constructor(u){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=u.replace("ws","http"),(0,C.getItem)(x,(u=>this.token=u))}get hasToken(){return!!this.token}login(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(this,void 0,void 0,(function*(){const G=Object.assign({},u);this.hasToken&&(G.token=this.token);const s=yield this.request("post","/auth",G);this.token=s.token,(0,C.setItem)(x,this.token);for(let u in s)this.hasOwnProperty(u)&&(this[u]=s[u]);return this.registerPingService(),this}))}save(){return m(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return m(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(u){return m(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:u})}))}acceptFriendRequest(u){return m(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:u})}))}declineFriendRequest(u){return m(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:u})}))}blockUser(u){return m(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:u})}))}unblockUser(u){return m(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:u})}))}request(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return m(this,void 0,void 0,(function*(){z.Accept="application/json",this.hasToken&&(z.Authorization="Bearer "+this.token);const O=[];for(const u in s)O.push(`${u}=${s[u]}`);const m=O.length>0?`?${O.join("&")}`:"",C={headers:z};return T&&(C.body=T),(yield f[u](`${this.endpoint}${G}${m}`,C)).data}))}logout(){this.token=void 0,(0,C.removeItem)(x),this.unregisterPingService()}registerPingService(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),u)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10415:function(u,G,s){"use strict";var T,z=this&&this.__awaiter||function(u,G,s,T){return new(s||(s=Promise))((function(z,O){function m(u){try{C(T.next(u))}catch(G){O(G)}}function f(u){try{C(T.throw(u))}catch(G){O(G)}}function C(u){var G;u.done?z(u.value):(G=u.value,G instanceof s?G:new s((function(u){u(G)}))).then(m,f)}C((T=T.apply(u,G||[])).next())}))};Object.defineProperty(G,"__esModule",{value:!0}),G.Client=G.MatchMakeError=void 0;const O=s(10419),m=s(10422),f=s(10426);class C extends Error{constructor(u,G){super(u),this.code=G,Object.setPrototypeOf(this,C.prototype)}}G.MatchMakeError=C;const x="undefined"!==typeof window&&"undefined"!==typeof(null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";G.Client=class{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;if("string"===typeof u){const G=new URL(u),s="https:"===G.protocol||"wss:"===G.protocol,T=Number(G.port||(s?443:80));this.settings={hostname:G.hostname,pathname:"/"!==G.pathname?G.pathname:"",port:T,secure:s}}else void 0===u.port&&(u.port=u.secure?443:80),void 0===u.pathname&&(u.pathname=""),this.settings=u}joinOrCreate(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",u,G,s)}))}create(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",u,G,s)}))}join(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",u,G,s)}))}joinById(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",u,G,s)}))}reconnect(u,G){return z(this,void 0,void 0,(function*(){if("string"===typeof u&&"string"===typeof G)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[s,T]=u.split(":");return yield this.createMatchMakeRequest("reconnect",s,{reconnectionToken:T},G)}))}getAvailableRooms(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return z(this,void 0,void 0,(function*(){return(yield(0,O.get)(this.getHttpEndpoint(`${u}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(u,G,s){return z(this,void 0,void 0,(function*(){const T=this.createRoom(u.room.name,G);T.roomId=u.room.roomId,T.sessionId=u.sessionId;const O={sessionId:T.sessionId};u.reconnectionToken&&(O.reconnectionToken=u.reconnectionToken);const f=s||T;return T.connect(this.buildEndpoint(u.room,O),u.devMode&&(()=>z(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${T.roomId}'...`);let s=0;const O=()=>z(this,void 0,void 0,(function*(){s++;try{yield this.consumeSeatReservation(u,G,f),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${T.roomId}'`)}catch(z){s<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${s} out of 8)`),setTimeout(O,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(O,2e3)}))),f),new Promise(((u,G)=>{const s=(u,s)=>G(new m.ServerError(u,s));f.onError.once(s),f.onJoin.once((()=>{f.onError.remove(s),u(f)}))}))}))}createMatchMakeRequest(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0;return z(this,void 0,void 0,(function*(){const z=(yield(0,O.post)(this.getHttpEndpoint(`${u}/${G}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).data;if(z.error)throw new C(z.error,z.code);return"reconnect"===u&&(z.reconnectionToken=s.reconnectionToken),yield this.consumeSeatReservation(z,T,m)}))}createRoom(u,G){return new f.Room(u,G)}buildEndpoint(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[];for(const z in G)G.hasOwnProperty(z)&&s.push(`${z}=${G[z]}`);let T=this.settings.secure?"wss://":"ws://";return u.publicAddress?T+=`${u.publicAddress}`:T+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${T}/${u.processId}/${u.roomId}?${s.join("&")}`}getHttpEndpoint(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${u}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10436:(u,G,s)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.Connection=void 0;const T=s(10441);G.Connection=class{constructor(){this.events={},this.transport=new T.WebSocketTransport(this.events)}send(u){this.transport.send(u)}connect(u){this.transport.connect(u)}close(u,G){this.transport.close(u,G)}get isOpen(){return this.transport.isOpen}}},10458:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.utf8Length=G.utf8Read=G.ErrorCode=G.Protocol=void 0,function(u){u[u.HANDSHAKE=9]="HANDSHAKE",u[u.JOIN_ROOM=10]="JOIN_ROOM",u[u.ERROR=11]="ERROR",u[u.LEAVE_ROOM=12]="LEAVE_ROOM",u[u.ROOM_DATA=13]="ROOM_DATA",u[u.ROOM_STATE=14]="ROOM_STATE",u[u.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",u[u.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",u[u.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(G.Protocol||(G.Protocol={})),function(u){u[u.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",u[u.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",u[u.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",u[u.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",u[u.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",u[u.AUTH_FAILED=4215]="AUTH_FAILED",u[u.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(G.ErrorCode||(G.ErrorCode={})),G.utf8Read=function(u,G){const s=u[G++];for(var T="",z=0,O=G,m=G+s;O<m;O++){var f=u[O];if(0!==(128&f))if(192!==(224&f))if(224!==(240&f)){if(240!==(248&f))throw new Error("Invalid byte "+f.toString(16));(z=(7&f)<<18|(63&u[++O])<<12|(63&u[++O])<<6|63&u[++O])>=65536?(z-=65536,T+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):T+=String.fromCharCode(z)}else T+=String.fromCharCode((15&f)<<12|(63&u[++O])<<6|63&u[++O]);else T+=String.fromCharCode((31&f)<<6|63&u[++O]);else T+=String.fromCharCode(f)}return T},G.utf8Length=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",G=0,s=0;for(let T=0,z=u.length;T<z;T++)G=u.charCodeAt(T),G<128?s+=1:G<2048?s+=2:G<55296||G>=57344?s+=3:(T++,s+=4);return s+1}},10426:function(u,G,s){"use strict";var T=this&&this.__createBinding||(Object.create?function(u,G,s,T){void 0===T&&(T=s);var z=Object.getOwnPropertyDescriptor(G,s);z&&!("get"in z?!G.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return G[s]}}),Object.defineProperty(u,T,z)}:function(u,G,s,T){void 0===T&&(T=s),u[T]=G[s]}),z=this&&this.__setModuleDefault||(Object.create?function(u,G){Object.defineProperty(u,"default",{enumerable:!0,value:G})}:function(u,G){u.default=G}),O=this&&this.__importStar||function(u){if(u&&u.__esModule)return u;var G={};if(null!=u)for(var s in u)"default"!==s&&Object.prototype.hasOwnProperty.call(u,s)&&T(G,u,s);return z(G,u),G};Object.defineProperty(G,"__esModule",{value:!0}),G.Room=void 0;const m=O(s(10430)),f=s(10436),C=s(10458),x=s(10460),g=s(10468),b=s(10474),Q=s(10478),Y=s(10422);class n{constructor(u,G){this.onStateChange=(0,b.createSignal)(),this.onError=(0,b.createSignal)(),this.onLeave=(0,b.createSignal)(),this.onJoin=(0,b.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=u,G&&(this.serializer=new((0,x.getSerializer)("schema")),this.rootSchema=G,this.serializer.state=new G),this.onError(((u,G)=>{var s;return null===(s=console.warn)||void 0===s?void 0:s.call(console,`colyseus.js - onError => (${u}) ${G}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const T=new f.Connection;s.connection=T,T.events.onmessage=n.prototype.onMessageCallback.bind(s),T.events.onclose=function(u){var T;if(!s.hasJoined)return null===(T=console.warn)||void 0===T||T.call(console,`Room connection was closed unexpectedly (${u.code}): ${u.reason}`),void s.onError.invoke(u.code,u.reason);u.code===Y.CloseCode.DEVMODE_RESTART&&G?G():(s.onLeave.invoke(u.code),s.destroy())},T.events.onerror=function(u){var G;null===(G=console.warn)||void 0===G||G.call(console,`Room, onError (${u.code}): ${u.reason}`),s.onError.invoke(u.code,u.reason)},T.connect(u)}leave(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((G=>{this.onLeave((u=>G(u))),this.connection?u?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Y.CloseCode.CONSENTED)}))}onMessage(u,G){return this.onMessageHandlers.on(this.getMessageHandlerKey(u),G)}send(u,G){const s=[C.Protocol.ROOM_DATA];let T;if("string"===typeof u?Q.encode.string(s,u):Q.encode.number(s,u),void 0!==G){const u=m.encode(G);T=new Uint8Array(s.length+u.byteLength),T.set(new Uint8Array(s),0),T.set(new Uint8Array(u),s.length)}else T=new Uint8Array(s);this.connection.send(T.buffer)}sendBytes(u,G){const s=[C.Protocol.ROOM_DATA_BYTES];let T;"string"===typeof u?Q.encode.string(s,u):Q.encode.number(s,u),T=new Uint8Array(s.length+(G.byteLength||G.length)),T.set(new Uint8Array(s),0),T.set(new Uint8Array(G),s.length),this.connection.send(T.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(u){const G=Array.from(new Uint8Array(u.data)),s=G[0];if(s===C.Protocol.JOIN_ROOM){let u=1;const s=(0,C.utf8Read)(G,u);if(u+=(0,C.utf8Length)(s),this.serializerId=(0,C.utf8Read)(G,u),u+=(0,C.utf8Length)(this.serializerId),!this.serializer){const u=(0,x.getSerializer)(this.serializerId);this.serializer=new u}G.length>u&&this.serializer.handshake&&this.serializer.handshake(G,{offset:u}),this.reconnectionToken=`${this.roomId}:${s}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(s===C.Protocol.ERROR){const u={offset:1},s=Q.decode.number(G,u),T=Q.decode.string(G,u);this.onError.invoke(s,T)}else if(s===C.Protocol.LEAVE_ROOM)this.leave();else if(s===C.Protocol.ROOM_DATA_SCHEMA){const u={offset:1},s=this.serializer.getState().constructor._context.get(Q.decode.number(G,u)),T=new s;T.decode(G,u),this.dispatchMessage(s,T)}else if(s===C.Protocol.ROOM_STATE)G.shift(),this.setState(G);else if(s===C.Protocol.ROOM_STATE_PATCH)G.shift(),this.patch(G);else if(s===C.Protocol.ROOM_DATA){const s={offset:1},T=Q.decode.stringCheck(G,s)?Q.decode.string(G,s):Q.decode.number(G,s),z=G.length>s.offset?m.decode(u.data,s.offset):void 0;this.dispatchMessage(T,z)}else if(s===C.Protocol.ROOM_DATA_BYTES){const u={offset:1},s=Q.decode.stringCheck(G,u)?Q.decode.string(G,u):Q.decode.number(G,u);this.dispatchMessage(s,new Uint8Array(G.slice(u.offset)))}}setState(u){this.serializer.setState(u),this.onStateChange.invoke(this.serializer.getState())}patch(u){this.serializer.patch(u),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(u,G){var s;const T=this.getMessageHandlerKey(u);this.onMessageHandlers.events[T]?this.onMessageHandlers.emit(T,G):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",u,G):null===(s=console.warn)||void 0===s||s.call(console,`colyseus.js: onMessage() not registered for type '${u}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(u){switch(typeof u){case"function":return`$${u._typeid}`;case"string":return u;case"number":return`i${u}`;default:throw new Error("invalid message type.")}}}G.Room=n},10489:(u,G)=>{"use strict";let s;function T(){return s||(s="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(u,G){this.cache[u]=G},getItem:function(u){this.cache[u]},removeItem:function(u){delete this.cache[u]}}),s}Object.defineProperty(G,"__esModule",{value:!0}),G.getItem=G.removeItem=G.setItem=void 0,G.setItem=function(u,G){T().setItem(u,G)},G.removeItem=function(u){T().removeItem(u)},G.getItem=function(u,G){const s=T().getItem(u);"undefined"!==typeof Promise&&s instanceof Promise?s.then((u=>G(u))):G(s)}},10468:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.createNanoEvents=void 0;G.createNanoEvents=()=>({emit(u){let G=this.events[u]||[];for(var s=arguments.length,T=new Array(s>1?s-1:0),z=1;z<s;z++)T[z-1]=arguments[z];for(let O=0,m=G.length;O<m;O++)G[O](...T)},events:{},on(u,G){var s;return(null===(s=this.events[u])||void 0===s?void 0:s.push(G))||(this.events[u]=[G]),()=>{var s;this.events[u]=null===(s=this.events[u])||void 0===s?void 0:s.filter((u=>G!==u))}}})},10474:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.createSignal=G.EventEmitter=void 0;class s{constructor(){this.handlers=[]}register(u){return this.handlers.push(u),this}invoke(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];this.handlers.forEach((u=>u.apply(this,G)))}invokeAsync(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];return Promise.all(this.handlers.map((u=>u.apply(this,G))))}remove(u){const G=this.handlers.indexOf(u);this.handlers[G]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}G.EventEmitter=s,G.createSignal=function(){const u=new s;function G(G){return u.register(G,null===this)}return G.once=G=>{const s=function(){for(var T=arguments.length,z=new Array(T),O=0;O<T;O++)z[O]=arguments[O];G.apply(this,z),u.remove(s)};u.register(s)},G.remove=G=>u.remove(G),G.invoke=function(){return u.invoke(...arguments)},G.invokeAsync=function(){return u.invokeAsync(...arguments)},G.clear=()=>u.clear(),G}},10422:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.ServerError=G.CloseCode=void 0,function(u){u[u.CONSENTED=4e3]="CONSENTED",u[u.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(G.CloseCode||(G.CloseCode={}));class s extends Error{constructor(u,G){super(G),this.name="ServerError",this.code=u}}G.ServerError=s},10402:(u,G,s)=>{"use strict";G.c=void 0,s(10407);var T=s(10415);Object.defineProperty(G,"c",{enumerable:!0,get:function(){return T.Client}});var z=s(10458);var O=s(10426);var m=s(10486);const f=s(10497);const C=s(10501),x=s(10460);(0,x.registerSerializer)("schema",f.SchemaSerializer),(0,x.registerSerializer)("none",C.NoneSerializer)},10407:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=u=>null!==u&&"object"===typeof u&&u.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10430:(u,G)=>{"use strict";function s(u,G){if(this._offset=G,u instanceof ArrayBuffer)this._buffer=u,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(u))throw new Error("Invalid argument");this._buffer=u.buffer,this._view=new DataView(this._buffer,u.byteOffset,u.byteLength)}}Object.defineProperty(G,"__esModule",{value:!0}),G.decode=G.encode=void 0,s.prototype._array=function(u){for(var G=new Array(u),s=0;s<u;s++)G[s]=this._parse();return G},s.prototype._map=function(u){for(var G={},s=0;s<u;s++)G[this._parse()]=this._parse();return G},s.prototype._str=function(u){var G=function(u,G,s){for(var T="",z=0,O=G,m=G+s;O<m;O++){var f=u.getUint8(O);if(0!==(128&f))if(192!==(224&f))if(224!==(240&f)){if(240!==(248&f))throw new Error("Invalid byte "+f.toString(16));(z=(7&f)<<18|(63&u.getUint8(++O))<<12|(63&u.getUint8(++O))<<6|63&u.getUint8(++O))>=65536?(z-=65536,T+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):T+=String.fromCharCode(z)}else T+=String.fromCharCode((15&f)<<12|(63&u.getUint8(++O))<<6|63&u.getUint8(++O));else T+=String.fromCharCode((31&f)<<6|63&u.getUint8(++O));else T+=String.fromCharCode(f)}return T}(this._view,this._offset,u);return this._offset+=u,G},s.prototype._bin=function(u){var G=this._buffer.slice(this._offset,this._offset+u);return this._offset+=u,G},s.prototype._parse=function(){var u,G=this._view.getUint8(this._offset++),s=0,T=0,z=0,O=0;if(G<192)return G<128?G:G<144?this._map(15&G):G<160?this._array(15&G):this._str(31&G);if(G>223)return-1*(255-G+1);switch(G){case 192:return null;case 194:return!1;case 195:return!0;case 196:return s=this._view.getUint8(this._offset),this._offset+=1,this._bin(s);case 197:return s=this._view.getUint16(this._offset),this._offset+=2,this._bin(s);case 198:return s=this._view.getUint32(this._offset),this._offset+=4,this._bin(s);case 199:if(s=this._view.getUint8(this._offset),T=this._view.getInt8(this._offset+1),this._offset+=2,-1===T){var m=this._view.getUint32(this._offset);return z=this._view.getInt32(this._offset+4),O=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*z+O)+m/1e6)}return[T,this._bin(s)];case 200:return s=this._view.getUint16(this._offset),T=this._view.getInt8(this._offset+2),this._offset+=3,[T,this._bin(s)];case 201:return s=this._view.getUint32(this._offset),T=this._view.getInt8(this._offset+4),this._offset+=5,[T,this._bin(s)];case 202:return u=this._view.getFloat32(this._offset),this._offset+=4,u;case 203:return u=this._view.getFloat64(this._offset),this._offset+=8,u;case 204:return u=this._view.getUint8(this._offset),this._offset+=1,u;case 205:return u=this._view.getUint16(this._offset),this._offset+=2,u;case 206:return u=this._view.getUint32(this._offset),this._offset+=4,u;case 207:return z=this._view.getUint32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,z+O;case 208:return u=this._view.getInt8(this._offset),this._offset+=1,u;case 209:return u=this._view.getInt16(this._offset),this._offset+=2,u;case 210:return u=this._view.getInt32(this._offset),this._offset+=4,u;case 211:return z=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,z+O;case 212:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?void(this._offset+=1):[T,this._bin(1)];case 213:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(2)];case 214:return T=this._view.getInt8(this._offset),this._offset+=1,-1===T?(u=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*u)):[T,this._bin(4)];case 215:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?(z=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(z+O)):-1===T?(z=this._view.getUint32(this._offset),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&z)+O)+(z>>>2)/1e6)):[T,this._bin(8)];case 216:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(16)];case 217:return s=this._view.getUint8(this._offset),this._offset+=1,this._str(s);case 218:return s=this._view.getUint16(this._offset),this._offset+=2,this._str(s);case 219:return s=this._view.getUint32(this._offset),this._offset+=4,this._str(s);case 220:return s=this._view.getUint16(this._offset),this._offset+=2,this._array(s);case 221:return s=this._view.getUint32(this._offset),this._offset+=4,this._array(s);case 222:return s=this._view.getUint16(this._offset),this._offset+=2,this._map(s);case 223:return s=this._view.getUint32(this._offset),this._offset+=4,this._map(s)}throw new Error("Could not parse")},G.decode=function(u){var G=new s(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),T=G._parse();if(G._offset!==u.byteLength)throw new Error(u.byteLength-G._offset+" trailing bytes");return T};function T(u,G,s){for(var T=0,z=0,O=s.length;z<O;z++)(T=s.charCodeAt(z))<128?u.setUint8(G++,T):T<2048?(u.setUint8(G++,192|T>>6),u.setUint8(G++,128|63&T)):T<55296||T>=57344?(u.setUint8(G++,224|T>>12),u.setUint8(G++,128|T>>6&63),u.setUint8(G++,128|63&T)):(z++,T=65536+((1023&T)<<10|1023&s.charCodeAt(z)),u.setUint8(G++,240|T>>18),u.setUint8(G++,128|T>>12&63),u.setUint8(G++,128|T>>6&63),u.setUint8(G++,128|63&T))}function z(u,G,s){var T=typeof s,O=0,m=0,f=0,C=0,x=0,g=0;if("string"===T){if(x=function(u){for(var G=0,s=0,T=0,z=u.length;T<z;T++)(G=u.charCodeAt(T))<128?s+=1:G<2048?s+=2:G<55296||G>=57344?s+=3:(T++,s+=4);return s}(s),x<32)u.push(160|x),g=1;else if(x<256)u.push(217,x),g=2;else if(x<65536)u.push(218,x>>8,x),g=3;else{if(!(x<4294967296))throw new Error("String too long");u.push(219,x>>24,x>>16,x>>8,x),g=5}return G.push({_str:s,_length:x,_offset:u.length}),g+x}if("number"===T)return Math.floor(s)===s&&isFinite(s)?s>=0?s<128?(u.push(s),1):s<256?(u.push(204,s),2):s<65536?(u.push(205,s>>8,s),3):s<4294967296?(u.push(206,s>>24,s>>16,s>>8,s),5):(f=s/Math.pow(2,32)|0,C=s>>>0,u.push(207,f>>24,f>>16,f>>8,f,C>>24,C>>16,C>>8,C),9):s>=-32?(u.push(s),1):s>=-128?(u.push(208,s),2):s>=-32768?(u.push(209,s>>8,s),3):s>=-2147483648?(u.push(210,s>>24,s>>16,s>>8,s),5):(f=Math.floor(s/Math.pow(2,32)),C=s>>>0,u.push(211,f>>24,f>>16,f>>8,f,C>>24,C>>16,C>>8,C),9):(u.push(203),G.push({_float:s,_length:8,_offset:u.length}),9);if("object"===T){if(null===s)return u.push(192),1;if(Array.isArray(s)){if((x=s.length)<16)u.push(144|x),g=1;else if(x<65536)u.push(220,x>>8,x),g=3;else{if(!(x<4294967296))throw new Error("Array too large");u.push(221,x>>24,x>>16,x>>8,x),g=5}for(O=0;O<x;O++)g+=z(u,G,s[O]);return g}if(s instanceof Date){var b=s.getTime(),Q=Math.floor(b/1e3),Y=1e6*(b-1e3*Q);return Q>=0&&Y>=0&&Q<=17179869183?0===Y&&Q<=4294967295?(u.push(214,255,Q>>24,Q>>16,Q>>8,Q),6):(f=Q/4294967296,C=4294967295&Q,u.push(215,255,Y>>22,Y>>14,Y>>6,f,C>>24,C>>16,C>>8,C),10):(f=Math.floor(Q/4294967296),C=Q>>>0,u.push(199,12,255,Y>>24,Y>>16,Y>>8,Y,f>>24,f>>16,f>>8,f,C>>24,C>>16,C>>8,C),15)}if(s instanceof ArrayBuffer){if((x=s.byteLength)<256)u.push(196,x),g=2;else if(x<65536)u.push(197,x>>8,x),g=3;else{if(!(x<4294967296))throw new Error("Buffer too large");u.push(198,x>>24,x>>16,x>>8,x),g=5}return G.push({_bin:s,_length:x,_offset:u.length}),g+x}if("function"===typeof s.toJSON)return z(u,G,s.toJSON());var n=[],V="",F=Object.keys(s);for(O=0,m=F.length;O<m;O++)void 0!==s[V=F[O]]&&"function"!==typeof s[V]&&n.push(V);if((x=n.length)<16)u.push(128|x),g=1;else if(x<65536)u.push(222,x>>8,x),g=3;else{if(!(x<4294967296))throw new Error("Object too large");u.push(223,x>>24,x>>16,x>>8,x),g=5}for(O=0;O<x;O++)g+=z(u,G,V=n[O]),g+=z(u,G,s[V]);return g}if("boolean"===T)return u.push(s?195:194),1;if("undefined"===T)return u.push(192),1;if("function"===typeof s.toJSON)return z(u,G,s.toJSON());throw new Error("Could not encode")}G.encode=function(u){var G=[],s=[],O=z(G,s,u),m=new ArrayBuffer(O),f=new DataView(m),C=0,x=0,g=-1;s.length>0&&(g=s[0]._offset);for(var b,Q=0,Y=0,n=0,V=G.length;n<V;n++)if(f.setUint8(x+n,G[n]),n+1===g){if(Q=(b=s[C])._length,Y=x+g,b._bin)for(var F=new Uint8Array(b._bin),r=0;r<Q;r++)f.setUint8(Y+r,F[r]);else b._str?T(f,Y,b._str):void 0!==b._float&&f.setFloat64(Y,b._float);x+=Q,s[++C]&&(g=s[C]._offset)}return m}},10501:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.NoneSerializer=void 0;G.NoneSerializer=class{setState(u){}getState(){return null}patch(u){}teardown(){}handshake(u){}}},10497:(u,G,s)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.SchemaSerializer=void 0;const T=s(10478);G.SchemaSerializer=class{setState(u){return this.state.decode(u)}getState(){return this.state}patch(u){return this.state.decode(u)}teardown(){var u,G;null===(G=null===(u=this.state)||void 0===u?void 0:u.$changes)||void 0===G||G.root.clearRefs()}handshake(u,G){if(this.state){(new T.Reflection).decode(u,G)}else this.state=T.Reflection.decode(u,G)}}},10460:(u,G)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0}),G.getSerializer=G.registerSerializer=void 0;const s={};G.registerSerializer=function(u,G){s[u]=G},G.getSerializer=function(u){const G=s[u];if(!G)throw new Error("missing serializer: "+u);return G}},10441:function(u,G,s){"use strict";var T=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(G,"__esModule",{value:!0}),G.WebSocketTransport=void 0;const z=T(s(10450)),O=globalThis.WebSocket||z.default;G.WebSocketTransport=class{constructor(u){this.events=u}send(u){u instanceof ArrayBuffer?this.ws.send(u):Array.isArray(u)&&this.ws.send(new Uint8Array(u).buffer)}connect(u){this.ws=new O(u,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(u,G){this.ws.close(u,G)}get isOpen(){return this.ws.readyState===O.OPEN}}},10450:u=>{"use strict";u.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12096:u=>{"use strict";function G(u,s,T){var z=0|u[T];if(z<=0)return[];var O,m=new Array(z);if(T===u.length-1)for(O=0;O<z;++O)m[O]=s;else for(O=0;O<z;++O)m[O]=G(u,s,T+1);return m}u.exports=function(u,s){switch("undefined"===typeof s&&(s=0),typeof u){case"number":if(u>0)return function(u,G){var s,T;for(s=new Array(u),T=0;T<u;++T)s[T]=G;return s}(0|u,s);break;case"object":if("number"===typeof u.length)return G(u,s,0)}return[]}},12053:(u,G,s)=>{u.exports=function(){var u=this;this.components={},this.comps=this.components;var G=this.components,s=1,z={},O=[],m=[],f={timeout:!1,removals:[],multiComps:[]};function C(u,s){var T=G[s],O=z[s],m=O.hash[u];m&&(O.remove(u),T.bb&&(T.multi?(m.forEach((G=>{G&&T.bb(u,G)})),m.length=0):T.bb(u,m)),f.removals.push(O),x())}function x(){f.timeout||(f.timeout=!0,setTimeout(g,1))}function g(){f.timeout=!1,b()}function b(){f.multiComps.length&&function(u){for(var G=0;G<u.length;G++){var{entID:s,data:T}=u[G],z=T.hash[s];if(z){for(var O=0;O<z.length;O++)z[O]||(z.splice(O,1),O--);0===z.length&&(T.remove(s),f.removals.push(T))}}u.length=0}(f.multiComps),f.removals.length&&function(u){for(var G=0;G<u.length;G++){u[G].flush()}u.length=0}(f.removals)}this.ri=z,this._systems=O,this._renderSystems=m,this.Hg=function(G){var T=s++;return Array.isArray(G)&&G.forEach((G=>u.je(T,G))),T},this.deleteEntity=function(G){return Object.keys(z).forEach((u=>{z[u].hash[G]&&C(G,u)})),u},this.gh=function(u){if(!u)throw new Error("Missing component definition");var s=u.name;if(!s)throw new Error("Component definition must have a name property.");if("string"!==typeof s)throw new Error("Component name must be a string.");if(""===s)throw new Error("Component name must be a non-empty string.");if(z[s])throw new Error(`Component ${s} already exists.`);var f={};return f.name=s,f.multi=!!u.multi,f.order=isNaN(u.order)?99:u.order,f.stateConstructor=u.stateConstructor||null,f.state=u.state||{},f.te=u.te||null,f.bb=u.bb||null,f.system=u.system||null,f.$f=u.$f||null,G[s]=f,z[s]=new T,z[s]._pendingMultiCleanup=!1,z[s]._multiCleanupIDs=f.multi?[]:null,f.system&&(O.push(s),O.sort(((u,s)=>G[u].order-G[s].order))),f.$f&&(m.push(s),m.sort(((u,s)=>G[u].order-G[s].order))),s},this.overwriteComponent=function(u,s){var T=G[u];if(!T)throw new Error(`Unknown component: ${u}`);if(!s)throw new Error("Missing component definition");if(T.name!==s.name)throw new Error("Overwriting component must use the same name property.");var f={};f.name=u,f.multi=!!s.multi,f.order=isNaN(s.order)?99:s.order,f.state=s.state||{},f.te=s.te||null,f.bb=s.bb||null,f.system=s.system||null,f.$f=s.$f||null,G[u]=f,z[u]._pendingMultiCleanup=!1,z[u]._multiCleanupIDs=f.multi?[]:null;var C=O.indexOf(u);f.system&&C<0&&O.push(u),!f.system&&C>=0&&O.splice(C,1),O.sort(((u,s)=>G[u].order-G[s].order));var x=m.indexOf(u);f.$f&&x<0&&m.push(u),!f.$f&&x>=0&&m.splice(x,1),m.sort(((u,s)=>G[u].order-G[s].order));var g=f.state;return this.cg(u).forEach((u=>{for(var G in g)G in u||(u[G]=g[G]);f.te&&f.te(u.Yf,u)})),u},this.deleteComponent=function(s){var T=z[s];if(!T)throw new Error(`Unknown component: ${s}`);T.flush(),T.list.forEach((u=>{u&&C(u.Yf||u[0].Yf,s)}));var f=O.indexOf(s),x=m.indexOf(s);return f>-1&&O.splice(f,1),x>-1&&m.splice(x,1),z[s].dispose(),delete z[s],delete G[s],u},this.je=function(u,s,T){var O,m=G[s],f=z[s];if(!f)throw new Error(`Unknown component: ${s}.`);if(f.hash[u]&&!m.multi)throw new Error(`Entity ${u} already has component: ${s}.`);if(m.stateConstructor){if(!(O=new m.stateConstructor).hasOwnProperty("Yf"))throw new Error(`Component ${m.name} stateConstructor type does not have property __id`)}else O=Object.assign({},{Yf:u},m.state,T);if(O.Yf=u,m.multi){var C=f.hash[u];C||(C=[],f.add(u,C)),C.push(O)}else f.add(u,O);return m.te&&m.te(u,O),this},this.ye=function(u,G){var s=z[G];if(!s)throw new Error(`Unknown component: ${G}.`);return!!s.hash[u]},this.oe=function(G,s){if(!z[s])throw new Error(`Unknown component: ${s}.`);return C(G,s),u},this.getState=function(u,G){var s=z[G];if(!s)throw new Error(`Unknown component: ${G}.`);return s.hash[u]},this.cg=function(u){var G=z[u];if(!G)throw new Error(`Unknown component: ${u}.`);return b(),G.list},this.rk=function(u){if(!z[u])throw new Error(`Unknown component: ${u}.`);var G=z[u].hash;return u=>G[u]},this.uk=function(u){if(!z[u])throw new Error(`Unknown component: ${u}.`);var G=z[u].hash;return u=>!!G[u]},this.yd=function(s){b();for(var T=0;T<O.length;T++){var m=O[T],f=G[m],C=z[m];f.system(s,C.list),b()}return u},this.render=function(s){b();for(var T=0;T<m.length;T++){var O=m[T],f=G[O],C=z[O];f.$f(s,C.list),b()}return u},this.removeMultiComponent=function(s,T,O){var m=G[T],C=z[T];if(!C)throw new Error(`Unknown component: ${T}.`);if(!m.multi)throw new Error("removeMultiComponent called on non-multi component");return function(u,G,s,T){var z=s.hash[u];if(z){var O=z[T];O&&(z[T]=null,G.bb&&G.bb(u,O),f.multiComps.push({entID:u,data:s}),x())}}(s,m,C,O),u}};var T=s(12055)},12055:u=>{function G(u,G){var s=u._map[G];if(delete u.hash[G],delete u._map[G],s===u.list.length-1)u.list.pop();else{var T=u.list.pop();if(u.list[s]=T,null===T||null===T[0]){var z=u.list.length;for(var O in u._map)if(u._map[O]===z)return void(u._map[O]=s)}else{var m=T.Yf||T[0].Yf;u._map[m]=s}}}u.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(u,G){if("number"===typeof this._map[u]){var s=this._map[u];this.hash[u]=G,this.list[s]=G}else this._map[u]=this.list.length,this.hash[u]=G,this.list.push(G)}remove(u){var G=this._map[u];this.hash[u]=null,this.list[G]=null,this._pendingRemovals.push(u)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var u=0;u<this._pendingRemovals.length;u++){var s=this._pendingRemovals[u];null===this.hash[s]&&G(this,s)}this._pendingRemovals.length=0}}},12330:u=>{"use strict";u.exports=function(u,G,s,T,z,O){var m=+G[0],f=+G[1],C=+G[2],x=+s[0],g=+s[1],b=+s[2],Q=Math.sqrt(x*x+g*g+b*b);if(0===Q)throw new Error("Can't raycast along a zero vector");return function(u,G,s,T,z,O,m,f,C,x){for(var g=0,b=Math.floor,Q=0|b(G),Y=0|b(s),n=0|b(T),V=z>0?1:-1,F=O>0?1:-1,r=m>0?1:-1,c=Math.abs(1/z),j=Math.abs(1/O),l=Math.abs(1/m),P=c<1/0?c*(V>0?Q+1-G:G-Q):1/0,H=j<1/0?j*(F>0?Y+1-s:s-Y):1/0,X=l<1/0?l*(r>0?n+1-T:T-n):1/0,p=-1;g<=f;){var q=u(Q,Y,n);if(q)return C&&(C[0]=G+g*z,C[1]=s+g*O,C[2]=T+g*m),x&&(x[0]=x[1]=x[2]=0,0===p&&(x[0]=-V),1===p&&(x[1]=-F),2===p&&(x[2]=-r)),q;P<H?P<X?(Q+=V,g=P,P+=c,p=0):(n+=r,g=X,X+=l,p=2):H<X?(Y+=F,g=H,H+=j,p=1):(n+=r,g=X,X+=l,p=2)}return C&&(C[0]=G+g*z,C[1]=s+g*O,C[2]=T+g*m),x&&(x[0]=x[1]=x[2]=0),0}(u,m,f,C,x/=Q,g/=Q,b/=Q,T="undefined"===typeof T?64:+T,z,O)}},12365:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(682);function z(){this.kj=!1,this.stopPropagation=!1,this.lj=!1,this.disabled=!1}class O{constructor(u,G){this.version="0.7.0";var s=Object.assign({},new z,G||{});this.element=u||document,this.kj=!!s.kj,this.stopPropagation=!!s.stopPropagation,this.lj=!!s.lj,this.disabled=!!s.disabled,this.filterEvents=(u,G)=>!0,this.down=new T.EventEmitter,this.up=new T.EventEmitter,this.state={},this.Nf={dx:0,dy:0,hk:0,Mf:0,ik:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?f(this):document.addEventListener("DOMContentLoaded",(u=>{f(this)}),{once:!0})}bind(u){for(var G=arguments.length,s=new Array(G>1?G-1:0),T=1;T<G;T++)s[T-1]=arguments[T];s.forEach((G=>{var s=this._keyBindmap[G]||[];s.includes(u)||(s.push(u),this._keyBindmap[G]=s)})),this.state[u]=!!this.state[u],this.pressCount[u]=this.pressCount[u]||0,this.releaseCount[u]=this.releaseCount[u]||0}unbind(u){for(var G in this._keyBindmap){var s=this._keyBindmap[G],T=s.indexOf(u);T>-1&&s.splice(T,1)}}getBindings(){var u={};for(var G in this._keyBindmap){this._keyBindmap[G].forEach((s=>{u[s]=u[s]||[],u[s].push(G)}))}return u}yd(){m(this.Nf),m(this.pressCount),m(this.releaseCount)}}function m(u){for(var G in u)u[G]=0}function f(u){window.addEventListener("keydown",n.bind(null,u,!0),!1),window.addEventListener("keyup",n.bind(null,u,!1),!1);var G={passive:!0};u.element.addEventListener("touchstart",b.bind(void 0,u),{passive:!1}),u.element.addEventListener("touchend",Y.bind(void 0,u),G),u.element.addEventListener("mousedown",V.bind(null,u,!0),G),window.document.addEventListener("mouseup",V.bind(null,u,!1),G),u.element.addEventListener("touchmove",F.bind(null,u),G),u.element.addEventListener("mousemove",F.bind(null,u),G),window.PointerEvent,u.element.addEventListener("wheel",r.bind(null,u),G),u.element.addEventListener("contextmenu",c.bind(null,u),!1),window.addEventListener("blur",j.bind(null,u),!1)}var C=0,x=0,g=null;function b(u,G){G.preventDefault(),Q(G)}function Q(u){let G=!1;for(let s=0;s<u.touches.length;++s)if(u.touches[s].identifier===g){G=!0;break}if(!G){const G=u.changedTouches[0];C=G.clientX,x=G.clientY,g=G.identifier}}function Y(u,G){for(var s=G.changedTouches,T=0;T<s.length;++T)s[T].identifier===g&&(g=null)}function n(u,G,s){l(s.code,G,u,s)}function V(u,G,s){if("pointerId"in s)if(G){if(null!==u._touches.currID)return;u._touches.currID=s.pointerId}else{if(u._touches.currID!==s.pointerId)return;u._touches.currID=null}return l("Mouse"+("button"in s?s.button+1:1),G,u,s),!1}function F(u,G){var s=G.movementX||G.mozMovementX||0,T=G.movementY||G.mozMovementY||0;if(G.touches&&0===(s|T)){var z=function(u){Q(u);for(let G=0;G<u.changedTouches.length;++G)if(u.changedTouches[G].identifier==g){const s=u.changedTouches[G],T=[s.clientX-C,s.clientY-x];return C=s.clientX,x=s.clientY,T}return console.error(`Did not find touch id ${g}`),[0,0]}(G);s=z[0],T=z[1]}u.Nf.dx+=s,u.Nf.dy+=T}function r(u,G){var s=1;switch(G.deltaMode){case 0:s=1;break;case 1:s=12;break;case 2:s=u.element.clientHeight||window.innerHeight}u.Nf.hk+=(G.deltaX||0)*s,u.Nf.Mf+=(G.deltaY||0)*s,u.Nf.ik+=(G.deltaZ||0)*s}function c(u,G){if(!u.lj)return G.preventDefault(),!1}function j(u){for(var G in u._keyStates)u._keyStates[G]&&(/^Mouse\d/.test(G)||l(G,!1,u,{code:G,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function l(u,G,s,T){var z=s._keyBindmap[u];z&&(P(s._keyStates[u],G)&&(s._keyStates[u]=G,z.forEach((u=>{(!s.filterEvents||s.filterEvents(T,u))&&function(u,G,s,T){var z=G?s.pressCount:s.releaseCount;z[u]=(z[u]||0)+1;var O=s._bindPressCount[u]||0;(O+=G?1:-1)<0&&(O=0);s._bindPressCount[u]=O;var m=s.state[u];if(P(m,O)){s.state[u]=O>0;var f=G?s.down:s.up;s.disabled||f.emit(u,T)}}(u,G,s,T)}))),"button"in T||(s.kj&&!T.defaultPrevented&&T.preventDefault(),s.stopPropagation&&T.stopPropagation()))}function P(u,G){return u?!G:G}},10549:u=>{"use strict";u.exports=function(u){for(var G=new Array(u),s=0;s<u;++s)G[s]=s;return G}},10556:u=>{function G(u){return!!u.constructor&&"function"===typeof u.constructor.isBuffer&&u.constructor.isBuffer(u)}u.exports=function(u){return null!=u&&(G(u)||function(u){return"function"===typeof u.readFloatLE&&"function"===typeof u.slice&&G(u.slice(0,0))}(u)||!!u._isBuffer)}},12334:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Qh=!1,this.Rh=!1,this.Nh=30,this.Ph=0,this.Zh=!1,this.fullscreen=!1,this.Th=function(u){},this.Uh=function(){},this.Xh=function(){},this.cb=function(){},this.Vh=function(u){},this.onFullscreenChanged=function(u){},x((()=>{!function(u,G){u._nowObject=performance||Date,u._lastTick=0,u._renderAccum=0,u._rt=0,u._frameCB=f.bind(null,u),requestAnimationFrame(u._frameCB),G>0&&(u._intervalCB=m.bind(null,u),u._interval=setInterval(u._intervalCB,Math.max(G,1e3/u.Nh/2)))}(this,G),function(u,G){if(!G)return;var s=!1,T=!1;document.addEventListener("pointerlockchange",(T=>{s=document.pointerLockElement===G,u.Vh(s)})),document.addEventListener("fullscreenchange",(s=>{T=document.fullscreenElement===G,u.onFullscreenChanged(T)})),Object.defineProperty(u,"Zh",{get:()=>s,set:u=>{u&&!s?C(G):s&&!u&&function(u){u.exitPointerLock&&u.exitPointerLock()}(document)}}),Object.defineProperty(u,"fullscreen",{get:()=>T,set:u=>{u&&!T?G.requestFullscreen():T&&!u&&document.exitFullscreen()}}),G.addEventListener("click",(z=>{u.Qh&&!s&&C(G),u.Rh&&!T&&G.requestFullscreen()}));var z=()=>u.cb();if(window.ResizeObserver){new ResizeObserver(z).observe(G)}else window.addEventListener("resize",z)}(this,u),this.Xh()}))}}var z=3,O=20;function m(u){for(var G=1e3/u.Nh,s=u._nowObject.now()+O,T=0;u._nowObject.now()>=u._lastTick+G&&u._nowObject.now()<s&&++T<=z;)u.Th(G),u._lastTick+=G;var m=5*(G+5),f=u._nowObject.now();if(f-u._lastTick>m)for(;f>=u._lastTick+G;)u._lastTick+=G}function f(u){requestAnimationFrame(u._frameCB),m(u);var G=u._nowObject.now(),s=G-u._rt;if(u._rt=G,u.Ph>0){u._renderAccum+=s;var T=1e3/u.Ph;if(u._renderAccum<T)return;u._renderAccum=Math.min(u._renderAccum-T,T)}var z=1e3/u.Nh,O=(G-u._lastTick)/z;u.Uh(s,O,z)}function C(u){u.requestPointerLock&&u.requestPointerLock()}var x=u=>{if("loading"===document.readyState){var G=()=>{document.removeEventListener("readystatechange",G),u()};document.addEventListener("readystatechange",G)}else setTimeout(u,1)}},10546:(u,G,s)=>{var T=s(10549),z=s(10556),O="undefined"!==typeof Float64Array;function m(u,G){return u[0]-G[0]}function f(){var u,G=this.stride,s=new Array(G.length);for(u=0;u<s.length;++u)s[u]=[Math.abs(G[u]),u];s.sort(m);var T=new Array(s.length);for(u=0;u<T.length;++u)T[u]=s[u][1];return T}function C(u,G){var s=["View",G,"d",u].join("");G<0&&(s="View_Nil"+u);var z="generic"===u;if(-1===G){var O="function "+s+"(a){this.data=a;};var proto="+s+".prototype;proto.dtype='"+u+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+s+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+s+"(a){return new "+s+"(a);}";return new Function(O)()}if(0===G){O="function "+s+"(a,d) {this.data = a;this.offset = d};var proto="+s+".prototype;proto.dtype='"+u+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+s+"_copy() {return new "+s+"(this.data,this.offset)};proto.pick=function "+s+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+s+"_get(){return "+(z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+s+"_set(v){return "+(z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+s+"(a,b,c,d){return new "+s+"(a,d)}";return new Function("TrivialArray",O)(x[u][0])}O=["'use strict'"];var m=T(G),C=m.map((function(u){return"i"+u})),g="this.offset+"+m.map((function(u){return"this.stride["+u+"]*i"+u})).join("+"),b=m.map((function(u){return"b"+u})).join(","),Q=m.map((function(u){return"c"+u})).join(",");O.push("function "+s+"(a,"+b+","+Q+",d){this.data=a","this.shape=["+b+"]","this.stride=["+Q+"]","this.offset=d|0}","var proto="+s+".prototype","proto.dtype='"+u+"'","proto.dimension="+G),O.push("Object.defineProperty(proto,'size',{get:function "+s+"_size(){return "+m.map((function(u){return"this.shape["+u+"]"})).join("*"),"}})"),1===G?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),G<4?(O.push("function "+s+"_order(){"),2===G?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===G&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+s+"_set("+C.join(",")+",v){"),z?O.push("return this.data.set("+g+",v)}"):O.push("return this.data["+g+"]=v}"),O.push("proto.get=function "+s+"_get("+C.join(",")+"){"),z?O.push("return this.data.get("+g+")}"):O.push("return this.data["+g+"]}"),O.push("proto.index=function "+s+"_index(",C.join(),"){return "+g+"}"),O.push("proto.hi=function "+s+"_hi("+C.join(",")+"){return new "+s+"(this.data,"+m.map((function(u){return["(typeof i",u,"!=='number'||i",u,"<0)?this.shape[",u,"]:i",u,"|0"].join("")})).join(",")+","+m.map((function(u){return"this.stride["+u+"]"})).join(",")+",this.offset)}");var Y=m.map((function(u){return"a"+u+"=this.shape["+u+"]"})),n=m.map((function(u){return"c"+u+"=this.stride["+u+"]"}));O.push("proto.lo=function "+s+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+n.join(","));for(var V=0;V<G;++V)O.push("if(typeof i"+V+"==='number'&&i"+V+">=0){d=i"+V+"|0;b+=c"+V+"*d;a"+V+"-=d}");O.push("return new "+s+"(this.data,"+m.map((function(u){return"a"+u})).join(",")+","+m.map((function(u){return"c"+u})).join(",")+",b)}"),O.push("proto.step=function "+s+"_step("+C.join(",")+"){var "+m.map((function(u){return"a"+u+"=this.shape["+u+"]"})).join(",")+","+m.map((function(u){return"b"+u+"=this.stride["+u+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(V=0;V<G;++V)O.push("if(typeof i"+V+"==='number'){d=i"+V+"|0;if(d<0){c+=b"+V+"*(a"+V+"-1);a"+V+"=ceil(-a"+V+"/d)}else{a"+V+"=ceil(a"+V+"/d)}b"+V+"*=d}");O.push("return new "+s+"(this.data,"+m.map((function(u){return"a"+u})).join(",")+","+m.map((function(u){return"b"+u})).join(",")+",c)}");var F=new Array(G),r=new Array(G);for(V=0;V<G;++V)F[V]="a[i"+V+"]",r[V]="b[i"+V+"]";O.push("proto.transpose=function "+s+"_transpose("+C+"){"+C.map((function(u,G){return u+"=("+u+"===undefined?"+G+":"+u+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+s+"(this.data,"+F.join(",")+","+r.join(",")+",this.offset)}"),O.push("proto.pick=function "+s+"_pick("+C+"){var a=[],b=[],c=this.offset");for(V=0;V<G;++V)O.push("if(typeof i"+V+"==='number'&&i"+V+">=0){c=(c+this.stride["+V+"]*i"+V+")|0}else{a.push(this.shape["+V+"]);b.push(this.stride["+V+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+s+"(data,shape,stride,offset){return new "+s+"(data,"+m.map((function(u){return"shape["+u+"]"})).join(",")+","+m.map((function(u){return"stride["+u+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(x[u],f)}var x={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};u.exports=function(u,G,s,T){if(void 0===u)return(0,x.array[0])([]);"number"===typeof u&&(u=[u]),void 0===G&&(G=[u.length]);var m=G.length;if(void 0===s){s=new Array(m);for(var f=m-1,g=1;f>=0;--f)s[f]=g,g*=G[f]}if(void 0===T){T=0;for(f=0;f<m;++f)s[f]<0&&(T-=(G[f]-1)*s[f])}for(var b=function(u){if(z(u))return"buffer";if(O)switch(Object.prototype.toString.call(u)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(u)?"array":"generic"}(u),Q=x[b];Q.length<=m+1;)Q.push(C(b,Q.length-1));return(0,Q[m+1])(u,G,s,T)}},10520:u=>{var G;self,G=()=>(()=>{"use strict";var u={d:(G,s)=>{for(var T in s)u.o(s,T)&&!u.o(G,T)&&Object.defineProperty(G,T,{enumerable:!0,get:s[T]})},o:(u,G)=>Object.prototype.hasOwnProperty.call(u,G)},G={};u.d(G,{default:()=>B});var s,T=function(u,G){var s=G.x-u.x,T=G.y-u.y;return Math.sqrt(s*s+T*T)},z=function(u){return u*(Math.PI/180)},O=new Map,m=function(u){O.has(u)&&clearTimeout(O.get(u)),O.set(u,setTimeout(u,100))},f=function(u,G,s){for(var T,z=G.split(/[ ,]+/g),O=0;O<z.length;O+=1)T=z[O],u.addEventListener?u.addEventListener(T,s,!1):u.attachEvent&&u.attachEvent(T,s)},C=function(u,G,s){for(var T,z=G.split(/[ ,]+/g),O=0;O<z.length;O+=1)T=z[O],u.removeEventListener?u.removeEventListener(T,s):u.detachEvent&&u.detachEvent(T,s)},x=function(u){return u.preventDefault(),u.type.match(/^touch/)?u.changedTouches:u},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},b=function(u,G){G.top||G.right||G.bottom||G.left?(u.style.top=G.top,u.style.right=G.right,u.style.bottom=G.bottom,u.style.left=G.left):(u.style.left=G.x+"px",u.style.top=G.y+"px")},Q=function(u,G,s){var T=Y(u);for(var z in T)if(T.hasOwnProperty(z))if("string"==typeof G)T[z]=G+" "+s;else{for(var O="",m=0,f=G.length;m<f;m+=1)O+=G[m]+" "+s+", ";T[z]=O.slice(0,-2)}return T},Y=function(u){var G={};return G[u]="",["webkit","Moz","o"].forEach((function(s){G[s+u.charAt(0).toUpperCase()+u.slice(1)]=""})),G},n=function(u,G){for(var s in G)G.hasOwnProperty(s)&&(u[s]=G[s]);return u},V=function(u,G){if(u.length)for(var s=0,T=u.length;s<T;s+=1)G(u[s]);else G(u)},F="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r=window.matchMedia("(any-hover: none)").matches,c=!!("ontouchstart"in window),j=!!window.PointerEvent,l=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},H={start:"mousedown",move:"mousemove",end:"mouseup"},X={};function p(){}F&&!r?s=P:j?s={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:l?s={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:c?(s=P,X=H):s=H,p.prototype.on=function(u,G){var s,T=this,z=u.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var O=0;O<z.length;O+=1)s=z[O],T._handlers_[s]=T._handlers_[s]||[],T._handlers_[s].push(G);return T},p.prototype.off=function(u,G){var s=this;return s._handlers_=s._handlers_||{},void 0===u?s._handlers_={}:void 0===G?s._handlers_[u]=null:s._handlers_[u]&&s._handlers_[u].indexOf(G)>=0&&s._handlers_[u].splice(s._handlers_[u].indexOf(G),1),s},p.prototype.trigger=function(u,G){var s,T=this,z=u.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var O=0;O<z.length;O+=1)s=z[O],T._handlers_[s]&&T._handlers_[s].length&&T._handlers_[s].forEach((function(u){u.call(T,{type:s,target:T},G)}))},p.prototype.config=function(u){var G=this;G.options=G.defaults||{},u&&(G.options=function(u,G){var s={};for(var T in u)u.hasOwnProperty(T)&&G.hasOwnProperty(T)?s[T]=G[T]:u.hasOwnProperty(T)&&(s[T]=u[T]);return s}(G.options,u))},p.prototype.bindEvt=function(u,G){var T=this;return T._domHandlers_=T._domHandlers_||{},T._domHandlers_[G]=function(){"function"==typeof T["on"+G]?T["on"+G].apply(T,arguments):console.warn('[WARNING] : Missing "on'+G+'" handler.')},f(u,s[G],T._domHandlers_[G]),X[G]&&f(u,X[G],T._domHandlers_[G]),T},p.prototype.unbindEvt=function(u,G){var T=this;return T._domHandlers_=T._domHandlers_||{},C(u,s[G],T._domHandlers_[G]),X[G]&&C(u,X[G],T._domHandlers_[G]),delete T._domHandlers_[G],this};const q=p;function d(u,G){return this.identifier=G.identifier,this.position=G.position,this.frontPosition=G.frontPosition,this.collection=u,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(G),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=d.id,d.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}d.prototype=new q,d.constructor=d,d.id=0,d.prototype.buildEl=function(u){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},d.prototype.stylize=function(){if(this.options.dataOnly)return this;var u=this.options.fadeTime+"ms",G=function(){var u=Y("borderRadius");for(var G in u)u.hasOwnProperty(G)&&(u[G]="50%");return u}(),s=Q("transition","opacity",u),T={};return T.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},T.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},T.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},n(T.el,s),"circle"===this.options.shape&&n(T.back,G),n(T.front,G),this.applyStyles(T),this},d.prototype.applyStyles=function(u){for(var G in this.ui)if(this.ui.hasOwnProperty(G))for(var s in u[G])this.ui[G].style[s]=u[G][s];return this},d.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},d.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},d.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},d.prototype.show=function(u){var G=this;return G.options.dataOnly||(clearTimeout(G.removeTimeout),clearTimeout(G.showTimeout),clearTimeout(G.restTimeout),G.addToDom(),G.restCallback(),setTimeout((function(){G.ui.el.style.opacity=1}),0),G.showTimeout=setTimeout((function(){G.trigger("shown",G.instance),"function"==typeof u&&u.call(this)}),G.options.fadeTime)),G},d.prototype.hide=function(u){var G=this;if(G.options.dataOnly)return G;if(G.ui.el.style.opacity=G.options.restOpacity,clearTimeout(G.removeTimeout),clearTimeout(G.showTimeout),clearTimeout(G.restTimeout),G.removeTimeout=setTimeout((function(){var s="dynamic"===G.options.mode?"none":"block";G.ui.el.style.display=s,"function"==typeof u&&u.call(G),G.trigger("hidden",G.instance)}),G.options.fadeTime),G.options.restJoystick){var s=G.options.restJoystick,T={};T.x=!0===s||!1!==s.x?0:G.instance.frontPosition.x,T.y=!0===s||!1!==s.y?0:G.instance.frontPosition.y,G.setPosition(u,T)}return G},d.prototype.setPosition=function(u,G){var s=this;s.frontPosition={x:G.x,y:G.y};var T=s.options.fadeTime+"ms",z={};z.front=Q("transition",["transform"],T);var O={front:{}};O.front={transform:"translate("+s.frontPosition.x+"px,"+s.frontPosition.y+"px)"},s.applyStyles(z),s.applyStyles(O),s.restTimeout=setTimeout((function(){"function"==typeof u&&u.call(s),s.restCallback()}),s.options.fadeTime)},d.prototype.restCallback=function(){var u=this,G={};G.front=Q("transition","none",""),u.applyStyles(G),u.trigger("rested",u.instance)},d.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},d.prototype.computeDirection=function(u){var G,s,T,z=u.angle.radian,O=Math.PI/4,m=Math.PI/2;if(z>O&&z<3*O&&!u.lockX?G="up":z>-O&&z<=O&&!u.lockY?G="left":z>3*-O&&z<=-O&&!u.lockX?G="down":u.lockY||(G="right"),u.lockY||(s=z>-m&&z<m?"left":"right"),u.lockX||(T=z>0?"up":"down"),u.force>this.options.threshold){var f,C={};for(f in this.direction)this.direction.hasOwnProperty(f)&&(C[f]=this.direction[f]);var x={};for(f in this.direction={x:s,y:T,angle:G},u.direction=this.direction,C)C[f]===this.direction[f]&&(x[f]=!0);if(x.x&&x.y&&x.angle)return u;x.x&&x.y||this.trigger("plain",u),x.x||this.trigger("plain:"+s,u),x.y||this.trigger("plain:"+T,u),x.angle||this.trigger("dir dir:"+G,u)}else this.resetDirection();return u};const v=d;function W(u,G){var s=this;s.nipples=[],s.idles=[],s.actives=[],s.ids=[],s.pressureIntervals={},s.manager=u,s.id=W.id,W.id+=1,s.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},s.config(G),"static"!==s.options.mode&&"semi"!==s.options.mode||(s.options.multitouch=!1),s.options.multitouch||(s.options.maxNumberOfNipples=1);var T=getComputedStyle(s.options.zone.parentElement);return T&&"flex"===T.display&&(s.parentIsFlex=!0),s.updateBox(),s.prepareNipples(),s.mj(),s.begin(),s.nipples}W.prototype=new q,W.constructor=W,W.id=0,W.prototype.prepareNipples=function(){var u=this,G=u.nipples;G.on=u.on.bind(u),G.off=u.off.bind(u),G.options=u.options,G.destroy=u.destroy.bind(u),G.ids=u.ids,G.id=u.id,G.processOnMove=u.processOnMove.bind(u),G.processOnEnd=u.processOnEnd.bind(u),G.get=function(u){if(void 0===u)return G[0];for(var s=0,T=G.length;s<T;s+=1)if(G[s].identifier===u)return G[s];return!1}},W.prototype.mj=function(){var u=this;u.bindEvt(u.options.zone,"start"),u.options.zone.style.touchAction="none",u.options.zone.style.msTouchAction="none"},W.prototype.begin=function(){var u=this,G=u.options;if("static"===G.mode){var s=u.createNipple(G.position,u.manager.getIdentifier());s.add(),u.idles.push(s)}},W.prototype.createNipple=function(u,G){var s=this,T=s.manager.scroll,z={},O=s.options,m=s.parentIsFlex?T.x:T.x+s.box.left,f=s.parentIsFlex?T.y:T.y+s.box.top;if(u.x&&u.y)z={x:u.x-m,y:u.y-f};else if(u.top||u.right||u.bottom||u.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=u.top,C.style.right=u.right,C.style.bottom=u.bottom,C.style.left=u.left,C.style.position="absolute",O.zone.appendChild(C);var x=C.getBoundingClientRect();O.zone.removeChild(C),z=u,u={x:x.left+T.x,y:x.top+T.y}}var g=new v(s,{color:O.color,size:O.size,threshold:O.threshold,fadeTime:O.fadeTime,dataOnly:O.dataOnly,restJoystick:O.restJoystick,restOpacity:O.restOpacity,mode:O.mode,identifier:G,position:u,zone:O.zone,frontPosition:{x:0,y:0},shape:O.shape});return O.dataOnly||(b(g.ui.el,z),b(g.ui.front,g.frontPosition)),s.nipples.push(g),s.trigger("added "+g.identifier+":added",g),s.manager.trigger("added "+g.identifier+":added",g),s.bindNipple(g),g},W.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},W.prototype.bindNipple=function(u){var G,s=this,T=function(u,T){G=u.type+" "+T.id+":"+u.type,s.trigger(G,T)};u.on("destroyed",s.onDestroyed.bind(s)),u.on("shown hidden rested dir plain",T),u.on("dir:up dir:right dir:down dir:left",T),u.on("plain:up plain:right plain:down plain:left",T)},W.prototype.pressureFn=function(u,G,s){var T=this,z=0;clearInterval(T.pressureIntervals[s]),T.pressureIntervals[s]=setInterval(function(){var s=u.force||u.pressure||u.webkitForce||0;s!==z&&(G.trigger("pressure",s),T.trigger("pressure "+G.identifier+":pressure",s),z=s)}.bind(T),100)},W.prototype.onstart=function(u){var G=this,s=G.options,T=u;return u=x(u),G.updateBox(),V(u,(function(z){G.actives.length<s.maxNumberOfNipples?G.processOnStart(z):T.type.match(/^touch/)&&(Object.keys(G.manager.ids).forEach((function(s){if(Object.values(T.touches).findIndex((function(u){return u.identifier===s}))<0){var z=[u[0]];z.identifier=s,G.processOnEnd(z)}})),G.actives.length<s.maxNumberOfNipples&&G.processOnStart(z))})),G.manager.bindDocument(),!1},W.prototype.processOnStart=function(u){var G,s=this,z=s.options,O=s.manager.getIdentifier(u),m=u.force||u.pressure||u.webkitForce||0,f={x:u.pageX,y:u.pageY},C=s.getOrCreate(O,f);C.identifier!==O&&s.manager.removeIdentifier(C.identifier),C.identifier=O;var x=function(G){G.trigger("start",G),s.trigger("start "+G.id+":start",G),G.show(),m>0&&s.pressureFn(u,G,G.identifier),s.processOnMove(u)};if((G=s.idles.indexOf(C))>=0&&s.idles.splice(G,1),s.actives.push(C),s.ids.push(C.identifier),"semi"!==z.mode)x(C);else{if(!(T(f,C.position)<=z.catchDistance))return C.destroy(),void s.processOnStart(u);x(C)}return C},W.prototype.getOrCreate=function(u,G){var s,T=this,z=T.options;return/(semi|static)/.test(z.mode)?(s=T.idles[0])?(T.idles.splice(0,1),s):"semi"===z.mode?T.createNipple(G,u):(console.warn("Coudln't find the needed nipple."),!1):s=T.createNipple(G,u)},W.prototype.processOnMove=function(u){var G=this,s=G.options,O=G.manager.getIdentifier(u),m=G.nipples.get(O),f=G.manager.scroll;if(function(u){return isNaN(u.buttons)?0!==u.pressure:0!==u.buttons}(u)){if(!m)return console.error("Found zombie joystick with ID "+O),void G.manager.removeIdentifier(O);if(s.dynamicPage){var C=m.el.getBoundingClientRect();m.position={x:f.x+C.left,y:f.y+C.top}}m.identifier=O;var x=m.options.size/2,g={x:u.pageX,y:u.pageY};s.lockX&&(g.y=m.position.y),s.lockY&&(g.x=m.position.x);var b,Q,Y,n,V,F,r,c,j,l,P=T(g,m.position),H=(b=g,Y=(Q=m.position).x-b.x,n=Q.y-b.y,function(u){return u*(180/Math.PI)}(Math.atan2(n,Y))),X=z(H),p=P/x,q={distance:P,position:g};if("circle"===m.options.shape?(V=Math.min(P,x),r=m.position,c=V,l={x:0,y:0},j=z(j=H),l.x=r.x-c*Math.cos(j),l.y=r.y-c*Math.sin(j),F=l):(F=function(u,G,s){return{x:Math.min(Math.max(u.x,G.x-s),G.x+s),y:Math.min(Math.max(u.y,G.y-s),G.y+s)}}(g,m.position,x),V=T(F,m.position)),s.follow){if(P>x){var d=g.x-F.x,v=g.y-F.y;m.position.x+=d,m.position.y+=v,m.el.style.top=m.position.y-(G.box.top+f.y)+"px",m.el.style.left=m.position.x-(G.box.left+f.x)+"px",P=T(g,m.position)}}else g=F,P=V;var W=g.x-m.position.x,M=g.y-m.position.y;m.frontPosition={x:W,y:M},s.dataOnly||(m.ui.front.style.transform="translate("+W+"px,"+M+"px)");var o={identifier:m.identifier,position:g,force:p,pressure:u.force||u.pressure||u.webkitForce||0,distance:P,angle:{radian:X,degree:H},vector:{x:W/x,y:-M/x},raw:q,instance:m,lockX:s.lockX,lockY:s.lockY};(o=m.computeDirection(o)).angle={radian:z(180-H),degree:180-H},m.trigger("move",o),G.trigger("move "+m.id+":move",o)}else this.processOnEnd(u)},W.prototype.processOnEnd=function(u){var G=this,s=G.options,T=G.manager.getIdentifier(u),z=G.nipples.get(T),O=G.manager.removeIdentifier(z.identifier);z&&(s.dataOnly||z.hide((function(){"dynamic"===s.mode&&(z.trigger("removed",z),G.trigger("removed "+z.id+":removed",z),G.manager.trigger("removed "+z.id+":removed",z),z.destroy())})),clearInterval(G.pressureIntervals[z.identifier]),z.resetDirection(),z.trigger("end",z),G.trigger("end "+z.id+":end",z),G.ids.indexOf(z.identifier)>=0&&G.ids.splice(G.ids.indexOf(z.identifier),1),G.actives.indexOf(z)>=0&&G.actives.splice(G.actives.indexOf(z),1),/(semi|static)/.test(s.mode)?G.idles.push(z):G.nipples.indexOf(z)>=0&&G.nipples.splice(G.nipples.indexOf(z),1),G.manager.unbindDocument(),/(semi|static)/.test(s.mode)&&(G.manager.ids[O.id]=O.identifier))},W.prototype.onDestroyed=function(u,G){var s=this;s.nipples.indexOf(G)>=0&&s.nipples.splice(s.nipples.indexOf(G),1),s.actives.indexOf(G)>=0&&s.actives.splice(s.actives.indexOf(G),1),s.idles.indexOf(G)>=0&&s.idles.splice(s.idles.indexOf(G),1),s.ids.indexOf(G.identifier)>=0&&s.ids.splice(s.ids.indexOf(G.identifier),1),s.manager.removeIdentifier(G.identifier),s.manager.unbindDocument()},W.prototype.destroy=function(){var u=this;for(var G in u.unbindEvt(u.options.zone,"start"),u.nipples.forEach((function(u){u.destroy()})),u.pressureIntervals)u.pressureIntervals.hasOwnProperty(G)&&clearInterval(u.pressureIntervals[G]);u.trigger("destroyed",u.nipples),u.manager.unbindDocument(),u.off()};const M=W;function o(u){var G=this;G.ids={},G.index=0,G.collections=[],G.scroll=g(),G.config(u),G.prepareCollections();var s=function(){var u;G.collections.forEach((function(s){s.forEach((function(s){u=s.el.getBoundingClientRect(),s.position={x:G.scroll.x+u.left,y:G.scroll.y+u.top}}))}))};f(window,"resize",(function(){m(s)}));var T=function(){G.scroll=g()};return f(window,"scroll",(function(){m(T)})),G.collections}o.prototype=new q,o.constructor=o,o.prototype.prepareCollections=function(){var u=this;u.collections.create=u.create.bind(u),u.collections.on=u.on.bind(u),u.collections.off=u.off.bind(u),u.collections.destroy=u.destroy.bind(u),u.collections.get=function(G){var s;return u.collections.every((function(u){return!(s=u.get(G))})),s}},o.prototype.create=function(u){return this.createCollection(u)},o.prototype.createCollection=function(u){var G=this,s=new M(G,u);return G.bindCollection(s),G.collections.push(s),s},o.prototype.bindCollection=function(u){var G,s=this,T=function(u,T){G=u.type+" "+T.id+":"+u.type,s.trigger(G,T)};u.on("destroyed",s.onDestroyed.bind(s)),u.on("shown hidden rested dir plain",T),u.on("dir:up dir:right dir:down dir:left",T),u.on("plain:up plain:right plain:down plain:left",T)},o.prototype.bindDocument=function(){var u=this;u.binded||(u.bindEvt(document,"move").bindEvt(document,"end"),u.binded=!0)},o.prototype.unbindDocument=function(u){var G=this;Object.keys(G.ids).length&&!0!==u||(G.unbindEvt(document,"move").unbindEvt(document,"end"),G.binded=!1)},o.prototype.getIdentifier=function(u){var G;return u?void 0===(G=void 0===u.identifier?u.pointerId:u.identifier)&&(G=this.latest||0):G=this.index,void 0===this.ids[G]&&(this.ids[G]=this.index,this.index+=1),this.latest=G,this.ids[G]},o.prototype.removeIdentifier=function(u){var G={};for(var s in this.ids)if(this.ids[s]===u){G.id=s,G.identifier=this.ids[s],delete this.ids[s];break}return G},o.prototype.onmove=function(u){return this.onAny("move",u),!1},o.prototype.onend=function(u){return this.onAny("end",u),!1},o.prototype.oncancel=function(u){return this.onAny("end",u),!1},o.prototype.onAny=function(u,G){var s,T=this,z="processOn"+u.charAt(0).toUpperCase()+u.slice(1);G=x(G);var O=function(u,G,s){s.ids.indexOf(G)>=0&&(s[z](u),u._found_=!0)};return V(G,(function(u){s=T.getIdentifier(u),V(T.collections,O.bind(null,u,s)),u._found_||T.removeIdentifier(s)})),!1},o.prototype.destroy=function(){var u=this;u.unbindDocument(!0),u.ids={},u.index=0,u.collections.forEach((function(u){u.destroy()})),u.off()},o.prototype.onDestroyed=function(u,G){var s=this;if(s.collections.indexOf(G)<0)return!1;s.collections.splice(s.collections.indexOf(G),1)};var R=new o;const B={create:function(u){return R.create(u)},factory:R};return G.default})(),u.exports=G()},10746:(u,G,s)=>{"use strict";const{Deflate:T,deflate:z,deflateRaw:O,gzip:m}=s(10752),{Inflate:f,inflate:C,inflateRaw:x,ungzip:g}=s(10815),b=s(10795);u.exports.Deflate=T,u.exports.deflate=z,u.exports.deflateRaw=O,u.exports.gzip=m,u.exports.Inflate=f,u.exports.inflate=C,u.exports.inflateRaw=x,u.exports.ungzip=g,u.exports.constants=b},10752:(u,G,s)=>{"use strict";const T=s(10761),z=s(10798),O=s(10801),m=s(10788),f=s(10806),C=Object.prototype.toString,{Z_NO_FLUSH:x,Z_SYNC_FLUSH:g,Z_FULL_FLUSH:b,Z_FINISH:Q,Z_OK:Y,Z_STREAM_END:n,Z_DEFAULT_COMPRESSION:V,Z_DEFAULT_STRATEGY:F,Z_DEFLATED:r}=s(10795);function c(u){this.options=z.assign({level:V,method:r,Ja:16384,windowBits:15,memLevel:8,strategy:F},u||{});let G=this.options;G.raw&&G.windowBits>0?G.windowBits=-G.windowBits:G.gzip&&G.windowBits>0&&G.windowBits<16&&(G.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;let s=T.deflateInit2(this.strm,G.level,G.method,G.windowBits,G.memLevel,G.strategy);if(s!==Y)throw new Error(m[s]);if(G.header&&T.deflateSetHeader(this.strm,G.header),G.dictionary){let u;if(u="string"===typeof G.dictionary?O.string2buf(G.dictionary):"[object ArrayBuffer]"===C.call(G.dictionary)?new Uint8Array(G.dictionary):G.dictionary,s=T.deflateSetDictionary(this.strm,u),s!==Y)throw new Error(m[s]);this._dict_set=!0}}function j(u,G){const s=new c(G);if(s.push(u,!0),s.err)throw s.msg||m[s.err];return s.result}c.prototype.push=function(u,G){const s=this.strm,z=this.options.Ja;let m,f;if(this.ended)return!1;for(f=G===~~G?G:!0===G?Q:x,"string"===typeof u?s.input=O.string2buf(u):"[object ArrayBuffer]"===C.call(u)?s.input=new Uint8Array(u):s.input=u,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(z),s.next_out=0,s.avail_out=z),(f===g||f===b)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(m=T.deflate(s,f),m===n)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),m=T.deflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===Y;if(0!==s.avail_out){if(f>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},c.prototype.onData=function(u){this.chunks.push(u)},c.prototype.onEnd=function(u){u===Y&&(this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},u.exports.Deflate=c,u.exports.deflate=j,u.exports.deflateRaw=function(u,G){return(G=G||{}).raw=!0,j(u,G)},u.exports.gzip=function(u,G){return(G=G||{}).gzip=!0,j(u,G)},u.exports.constants=s(10795)},10815:(u,G,s)=>{"use strict";const T=s(10823),z=s(10798),O=s(10801),m=s(10788),f=s(10806),C=s(10838),x=Object.prototype.toString,{Z_NO_FLUSH:g,Z_FINISH:b,Z_OK:Q,Z_STREAM_END:Y,Z_NEED_DICT:n,Z_STREAM_ERROR:V,Z_DATA_ERROR:F,Z_MEM_ERROR:r}=s(10795);function c(u){this.options=z.assign({Ja:65536,windowBits:15,to:""},u||{});const G=this.options;G.raw&&G.windowBits>=0&&G.windowBits<16&&(G.windowBits=-G.windowBits,0===G.windowBits&&(G.windowBits=-15)),!(G.windowBits>=0&&G.windowBits<16)||u&&u.windowBits||(G.windowBits+=32),G.windowBits>15&&G.windowBits<48&&0===(15&G.windowBits)&&(G.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;let s=T.inflateInit2(this.strm,G.windowBits);if(s!==Q)throw new Error(m[s]);if(this.header=new C,T.inflateGetHeader(this.strm,this.header),G.dictionary&&("string"===typeof G.dictionary?G.dictionary=O.string2buf(G.dictionary):"[object ArrayBuffer]"===x.call(G.dictionary)&&(G.dictionary=new Uint8Array(G.dictionary)),G.raw&&(s=T.inflateSetDictionary(this.strm,G.dictionary),s!==Q)))throw new Error(m[s])}function j(u,G){const s=new c(G);if(s.push(u),s.err)throw s.msg||m[s.err];return s.result}c.prototype.push=function(u,G){const s=this.strm,z=this.options.Ja,m=this.options.dictionary;let f,C,c;if(this.ended)return!1;for(C=G===~~G?G:!0===G?b:g,"[object ArrayBuffer]"===x.call(u)?s.input=new Uint8Array(u):s.input=u,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(z),s.next_out=0,s.avail_out=z),f=T.inflate(s,C),f===n&&m&&(f=T.inflateSetDictionary(s,m),f===Q?f=T.inflate(s,C):f===F&&(f=n));s.avail_in>0&&f===Y&&s.state.wrap>0&&0!==u[s.next_in];)T.inflateReset(s),f=T.inflate(s,C);switch(f){case V:case F:case n:case r:return this.onEnd(f),this.ended=!0,!1}if(c=s.avail_out,s.next_out&&(0===s.avail_out||f===Y))if("string"===this.options.to){let u=O.utf8border(s.output,s.next_out),G=s.next_out-u,T=O.buf2string(s.output,u);s.next_out=G,s.avail_out=z-G,G&&s.output.set(s.output.subarray(u,u+G),0),this.onData(T)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(f!==Q||0!==c){if(f===Y)return f=T.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},c.prototype.onData=function(u){this.chunks.push(u)},c.prototype.onEnd=function(u){u===Q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},u.exports.Inflate=c,u.exports.inflate=j,u.exports.inflateRaw=function(u,G){return(G=G||{}).raw=!0,j(u,G)},u.exports.ungzip=j,u.exports.constants=s(10795)},10798:u=>{"use strict";const G=(u,G)=>Object.prototype.hasOwnProperty.call(u,G);u.exports.assign=function(u){const s=Array.prototype.slice.call(arguments,1);for(;s.length;){const T=s.shift();if(T){if("object"!==typeof T)throw new TypeError(T+"must be non-object");for(const s in T)G(T,s)&&(u[s]=T[s])}}return u},u.exports.flattenChunks=u=>{let G=0;for(let T=0,z=u.length;T<z;T++)G+=u[T].length;const s=new Uint8Array(G);for(let T=0,z=0,O=u.length;T<O;T++){let G=u[T];s.set(G,z),z+=G.length}return s}},10801:u=>{"use strict";let G=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(T){G=!1}const s=new Uint8Array(256);for(let z=0;z<256;z++)s[z]=z>=252?6:z>=248?5:z>=240?4:z>=224?3:z>=192?2:1;s[254]=s[254]=1,u.exports.string2buf=u=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(u);let G,s,T,z,O,m=u.length,f=0;for(z=0;z<m;z++)s=u.charCodeAt(z),55296===(64512&s)&&z+1<m&&(T=u.charCodeAt(z+1),56320===(64512&T)&&(s=65536+(s-55296<<10)+(T-56320),z++)),f+=s<128?1:s<2048?2:s<65536?3:4;for(G=new Uint8Array(f),O=0,z=0;O<f;z++)s=u.charCodeAt(z),55296===(64512&s)&&z+1<m&&(T=u.charCodeAt(z+1),56320===(64512&T)&&(s=65536+(s-55296<<10)+(T-56320),z++)),s<128?G[O++]=s:s<2048?(G[O++]=192|s>>>6,G[O++]=128|63&s):s<65536?(G[O++]=224|s>>>12,G[O++]=128|s>>>6&63,G[O++]=128|63&s):(G[O++]=240|s>>>18,G[O++]=128|s>>>12&63,G[O++]=128|s>>>6&63,G[O++]=128|63&s);return G};u.exports.buf2string=(u,T)=>{const z=T||u.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(u.subarray(0,T));let O,m;const f=new Array(2*z);for(m=0,O=0;O<z;){let G=u[O++];if(G<128){f[m++]=G;continue}let T=s[G];if(T>4)f[m++]=65533,O+=T-1;else{for(G&=2===T?31:3===T?15:7;T>1&&O<z;)G=G<<6|63&u[O++],T--;T>1?f[m++]=65533:G<65536?f[m++]=G:(G-=65536,f[m++]=55296|G>>10&1023,f[m++]=56320|1023&G)}}return((u,s)=>{if(s<65534&&u.subarray&&G)return String.fromCharCode.apply(null,u.length===s?u:u.subarray(0,s));let T="";for(let G=0;G<s;G++)T+=String.fromCharCode(u[G]);return T})(f,m)},u.exports.utf8border=(u,G)=>{(G=G||u.length)>u.length&&(G=u.length);let T=G-1;for(;T>=0&&128===(192&u[T]);)T--;return T<0||0===T?G:T+s[u[T]]>G?T:G}},10772:u=>{"use strict";u.exports=(u,G,s,T)=>{let z=65535&u,O=u>>>16&65535,m=0;for(;0!==s;){m=s>2e3?2e3:s,s-=m;do{z=z+G[T++]|0,O=O+z|0}while(--m);z%=65521,O%=65521}return z|O<<16}},10795:u=>{"use strict";u.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10780:u=>{"use strict";const G=new Uint32Array((()=>{let u,G=[];for(var s=0;s<256;s++){u=s;for(var T=0;T<8;T++)u=1&u?3988292384^u>>>1:u>>>1;G[s]=u}return G})());u.exports=(u,s,T,z)=>{const O=G,m=z+T;u^=-1;for(let G=z;G<m;G++)u=u>>>8^O[255&(u^s[G])];return~u}},10761:(u,G,s)=>{"use strict";const{_tr_init:T,_tr_stored_block:z,_tr_flush_block:O,_tr_tally:m,_tr_align:f}=s(10770),C=s(10772),x=s(10780),g=s(10788),{Z_NO_FLUSH:b,Z_PARTIAL_FLUSH:Q,Z_FULL_FLUSH:Y,Z_FINISH:n,Z_BLOCK:V,Z_OK:F,Z_STREAM_END:r,Z_STREAM_ERROR:c,Z_DATA_ERROR:j,Z_BUF_ERROR:l,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:H,Z_HUFFMAN_ONLY:X,Z_RLE:p,Z_FIXED:q,Z_DEFAULT_STRATEGY:d,Z_UNKNOWN:v,Z_DEFLATED:W}=s(10795),M=258,o=262,R=103,B=113,D=666,k=(u,G)=>(u.msg=g[G],G),w=u=>(u<<1)-(u>4?9:0),L=u=>{let G=u.length;for(;--G>=0;)u[G]=0};let S=(u,G,s)=>(G<<u.hash_shift^s)&u.hash_mask;const e=u=>{const G=u.state;let s=G.pending;s>u.avail_out&&(s=u.avail_out),0!==s&&(u.output.set(G.pending_buf.subarray(G.pending_out,G.pending_out+s),u.next_out),u.next_out+=s,G.pending_out+=s,u.total_out+=s,u.avail_out-=s,G.pending-=s,0===G.pending&&(G.pending_out=0))},h=(u,G)=>{O(u,u.block_start>=0?u.block_start:-1,u.strstart-u.block_start,G),u.block_start=u.strstart,e(u.strm)},I=(u,G)=>{u.pending_buf[u.pending++]=G},i=(u,G)=>{u.pending_buf[u.pending++]=G>>>8&255,u.pending_buf[u.pending++]=255&G},J=(u,G,s,T)=>{let z=u.avail_in;return z>T&&(z=T),0===z?0:(u.avail_in-=z,G.set(u.input.subarray(u.next_in,u.next_in+z),s),1===u.state.wrap?u.adler=C(u.adler,G,z,s):2===u.state.wrap&&(u.adler=x(u.adler,G,z,s)),u.next_in+=z,u.total_in+=z,z)},A=(u,G)=>{let s,T,z=u.max_chain_length,O=u.strstart,m=u.prev_length,f=u.nice_match;const C=u.strstart>u.w_size-o?u.strstart-(u.w_size-o):0,x=u.window,g=u.w_mask,b=u.prev,Q=u.strstart+M;let Y=x[O+m-1],n=x[O+m];u.prev_length>=u.good_match&&(z>>=2),f>u.lookahead&&(f=u.lookahead);do{if(s=G,x[s+m]===n&&x[s+m-1]===Y&&x[s]===x[O]&&x[++s]===x[O+1]){O+=2,s++;do{}while(x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&x[++O]===x[++s]&&O<Q);if(T=M-(Q-O),O=Q-M,T>m){if(u.match_start=G,m=T,T>=f)break;Y=x[O+m-1],n=x[O+m]}}}while((G=b[G&g])>C&&0!==--z);return m<=u.lookahead?m:u.lookahead},N=u=>{const G=u.w_size;let s,T,z,O,m;do{if(O=u.window_size-u.lookahead-u.strstart,u.strstart>=G+(G-o)){u.window.set(u.window.subarray(G,G+G),0),u.match_start-=G,u.strstart-=G,u.block_start-=G,T=u.hash_size,s=T;do{z=u.head[--s],u.head[s]=z>=G?z-G:0}while(--T);T=G,s=T;do{z=u.prev[--s],u.prev[s]=z>=G?z-G:0}while(--T);O+=G}if(0===u.strm.avail_in)break;if(T=J(u.strm,u.window,u.strstart+u.lookahead,O),u.lookahead+=T,u.lookahead+u.insert>=3)for(m=u.strstart-u.insert,u.ins_h=u.window[m],u.ins_h=S(u,u.ins_h,u.window[m+1]);u.insert&&(u.ins_h=S(u,u.ins_h,u.window[m+3-1]),u.prev[m&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=m,m++,u.insert--,!(u.lookahead+u.insert<3)););}while(u.lookahead<o&&0!==u.strm.avail_in)},y=(u,G)=>{let s,T;for(;;){if(u.lookahead<o){if(N(u),u.lookahead<o&&G===b)return 1;if(0===u.lookahead)break}if(s=0,u.lookahead>=3&&(u.ins_h=S(u,u.ins_h,u.window[u.strstart+3-1]),s=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),0!==s&&u.strstart-s<=u.w_size-o&&(u.match_length=A(u,s)),u.match_length>=3)if(T=m(u,u.strstart-u.match_start,u.match_length-3),u.lookahead-=u.match_length,u.match_length<=u.max_lazy_match&&u.lookahead>=3){u.match_length--;do{u.strstart++,u.ins_h=S(u,u.ins_h,u.window[u.strstart+3-1]),s=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart}while(0!==--u.match_length);u.strstart++}else u.strstart+=u.match_length,u.match_length=0,u.ins_h=u.window[u.strstart],u.ins_h=S(u,u.ins_h,u.window[u.strstart+1]);else T=m(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++;if(T&&(h(u,!1),0===u.strm.avail_out))return 1}return u.insert=u.strstart<2?u.strstart:2,G===n?(h(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(h(u,!1),0===u.strm.avail_out)?1:2},a=(u,G)=>{let s,T,z;for(;;){if(u.lookahead<o){if(N(u),u.lookahead<o&&G===b)return 1;if(0===u.lookahead)break}if(s=0,u.lookahead>=3&&(u.ins_h=S(u,u.ins_h,u.window[u.strstart+3-1]),s=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart),u.prev_length=u.match_length,u.prev_match=u.match_start,u.match_length=2,0!==s&&u.prev_length<u.max_lazy_match&&u.strstart-s<=u.w_size-o&&(u.match_length=A(u,s),u.match_length<=5&&(u.strategy===H||3===u.match_length&&u.strstart-u.match_start>4096)&&(u.match_length=2)),u.prev_length>=3&&u.match_length<=u.prev_length){z=u.strstart+u.lookahead-3,T=m(u,u.strstart-1-u.prev_match,u.prev_length-3),u.lookahead-=u.prev_length-1,u.prev_length-=2;do{++u.strstart<=z&&(u.ins_h=S(u,u.ins_h,u.window[u.strstart+3-1]),s=u.prev[u.strstart&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=u.strstart)}while(0!==--u.prev_length);if(u.match_available=0,u.match_length=2,u.strstart++,T&&(h(u,!1),0===u.strm.avail_out))return 1}else if(u.match_available){if(T=m(u,0,u.window[u.strstart-1]),T&&h(u,!1),u.strstart++,u.lookahead--,0===u.strm.avail_out)return 1}else u.match_available=1,u.strstart++,u.lookahead--}return u.match_available&&(T=m(u,0,u.window[u.strstart-1]),u.match_available=0),u.insert=u.strstart<2?u.strstart:2,G===n?(h(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(h(u,!1),0===u.strm.avail_out)?1:2};function K(u,G,s,T,z){this.good_length=u,this.max_lazy=G,this.nice_length=s,this.max_chain=T,this.func=z}const Z=[new K(0,0,0,0,((u,G)=>{let s=65535;for(s>u.pending_buf_size-5&&(s=u.pending_buf_size-5);;){if(u.lookahead<=1){if(N(u),0===u.lookahead&&G===b)return 1;if(0===u.lookahead)break}u.strstart+=u.lookahead,u.lookahead=0;const T=u.block_start+s;if((0===u.strstart||u.strstart>=T)&&(u.lookahead=u.strstart-T,u.strstart=T,h(u,!1),0===u.strm.avail_out))return 1;if(u.strstart-u.block_start>=u.w_size-o&&(h(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,G===n?(h(u,!0),0===u.strm.avail_out?3:4):(u.strstart>u.block_start&&(h(u,!1),u.strm.avail_out),1)})),new K(4,4,8,4,y),new K(4,5,16,8,y),new K(4,6,32,32,y),new K(4,4,16,16,a),new K(8,16,32,32,a),new K(8,16,128,128,a),new K(8,32,128,256,a),new K(32,128,258,1024,a),new K(32,258,258,4096,a)];function t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=W,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),L(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const E=u=>{if(!u||!u.state)return k(u,c);u.total_in=u.total_out=0,u.data_type=v;const G=u.state;return G.pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap?42:B,u.adler=2===G.wrap?0:1,G.last_flush=b,T(G),F},U=u=>{const G=E(u);var s;return G===F&&((s=u.state).window_size=2*s.w_size,L(s.head),s.max_lazy_match=Z[s.level].max_lazy,s.good_match=Z[s.level].good_length,s.nice_match=Z[s.level].nice_length,s.max_chain_length=Z[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),G},uu=(u,G,s,T,z,O)=>{if(!u)return c;let m=1;if(G===P&&(G=6),T<0?(m=0,T=-T):T>15&&(m=2,T-=16),z<1||z>9||s!==W||T<8||T>15||G<0||G>9||O<0||O>q)return k(u,c);8===T&&(T=9);const f=new t;return u.state=f,f.strm=u,f.wrap=m,f.gzhead=null,f.w_bits=T,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=z+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<z+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.d_buf=1*f.lit_bufsize,f.l_buf=3*f.lit_bufsize,f.level=G,f.strategy=O,f.method=s,U(u)};u.exports.deflateInit=(u,G)=>uu(u,G,W,15,8,d),u.exports.deflateInit2=uu,u.exports.deflateReset=U,u.exports.deflateResetKeep=E,u.exports.deflateSetHeader=(u,G)=>u&&u.state?2!==u.state.wrap?c:(u.state.gzhead=G,F):c,u.exports.deflate=(u,G)=>{let s,T;if(!u||!u.state||G>V||G<0)return u?k(u,c):c;const O=u.state;if(!u.output||!u.input&&0!==u.avail_in||O.status===D&&G!==n)return k(u,0===u.avail_out?l:c);O.strm=u;const C=O.last_flush;if(O.last_flush=G,42===O.status)if(2===O.wrap)u.adler=0,I(O,31),I(O,139),I(O,8),O.gzhead?(I(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),I(O,255&O.gzhead.time),I(O,O.gzhead.time>>8&255),I(O,O.gzhead.time>>16&255),I(O,O.gzhead.time>>24&255),I(O,9===O.level?2:O.strategy>=X||O.level<2?4:0),I(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(I(O,255&O.gzhead.extra.length),I(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(u.adler=x(u.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(I(O,0),I(O,0),I(O,0),I(O,0),I(O,0),I(O,9===O.level?2:O.strategy>=X||O.level<2?4:0),I(O,3),O.status=B);else{let G=W+(O.w_bits-8<<4)<<8,s=-1;s=O.strategy>=X||O.level<2?0:O.level<6?1:6===O.level?2:3,G|=s<<6,0!==O.strstart&&(G|=32),G+=31-G%31,O.status=B,i(O,G),0!==O.strstart&&(i(O,u.adler>>>16),i(O,65535&u.adler)),u.adler=1}if(69===O.status)if(O.gzhead.extra){for(s=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),e(u),s=O.pending,O.pending!==O.pending_buf_size));)I(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(73===O.status)if(O.gzhead.name){s=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),e(u),s=O.pending,O.pending===O.pending_buf_size)){T=1;break}T=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,I(O,T)}while(0!==T);O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),0===T&&(O.gzindex=0,O.status=91)}else O.status=91;if(91===O.status)if(O.gzhead.comment){s=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),e(u),s=O.pending,O.pending===O.pending_buf_size)){T=1;break}T=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,I(O,T)}while(0!==T);O.gzhead.hcrc&&O.pending>s&&(u.adler=x(u.adler,O.pending_buf,O.pending-s,s)),0===T&&(O.status=R)}else O.status=R;if(O.status===R&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&e(u),O.pending+2<=O.pending_buf_size&&(I(O,255&u.adler),I(O,u.adler>>8&255),u.adler=0,O.status=B)):O.status=B),0!==O.pending){if(e(u),0===u.avail_out)return O.last_flush=-1,F}else if(0===u.avail_in&&w(G)<=w(C)&&G!==n)return k(u,l);if(O.status===D&&0!==u.avail_in)return k(u,l);if(0!==u.avail_in||0!==O.lookahead||G!==b&&O.status!==D){let s=O.strategy===X?((u,G)=>{let s;for(;;){if(0===u.lookahead&&(N(u),0===u.lookahead)){if(G===b)return 1;break}if(u.match_length=0,s=m(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,s&&(h(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,G===n?(h(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(h(u,!1),0===u.strm.avail_out)?1:2})(O,G):O.strategy===p?((u,G)=>{let s,T,z,O;const f=u.window;for(;;){if(u.lookahead<=M){if(N(u),u.lookahead<=M&&G===b)return 1;if(0===u.lookahead)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(z=u.strstart-1,T=f[z],T===f[++z]&&T===f[++z]&&T===f[++z])){O=u.strstart+M;do{}while(T===f[++z]&&T===f[++z]&&T===f[++z]&&T===f[++z]&&T===f[++z]&&T===f[++z]&&T===f[++z]&&T===f[++z]&&z<O);u.match_length=M-(O-z),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(s=m(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(s=m(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),s&&(h(u,!1),0===u.strm.avail_out))return 1}return u.insert=0,G===n?(h(u,!0),0===u.strm.avail_out?3:4):u.last_lit&&(h(u,!1),0===u.strm.avail_out)?1:2})(O,G):Z[O.level].func(O,G);if(3!==s&&4!==s||(O.status=D),1===s||3===s)return 0===u.avail_out&&(O.last_flush=-1),F;if(2===s&&(G===Q?f(O):G!==V&&(z(O,0,0,!1),G===Y&&(L(O.head),0===O.lookahead&&(O.strstart=0,O.block_start=0,O.insert=0))),e(u),0===u.avail_out))return O.last_flush=-1,F}return G!==n?F:O.wrap<=0?r:(2===O.wrap?(I(O,255&u.adler),I(O,u.adler>>8&255),I(O,u.adler>>16&255),I(O,u.adler>>24&255),I(O,255&u.total_in),I(O,u.total_in>>8&255),I(O,u.total_in>>16&255),I(O,u.total_in>>24&255)):(i(O,u.adler>>>16),i(O,65535&u.adler)),e(u),O.wrap>0&&(O.wrap=-O.wrap),0!==O.pending?F:r)},u.exports.deflateEnd=u=>{if(!u||!u.state)return c;const G=u.state.status;return 42!==G&&69!==G&&73!==G&&91!==G&&G!==R&&G!==B&&G!==D?k(u,c):(u.state=null,G===B?k(u,j):F)},u.exports.deflateSetDictionary=(u,G)=>{let s=G.length;if(!u||!u.state)return c;const T=u.state,z=T.wrap;if(2===z||1===z&&42!==T.status||T.lookahead)return c;if(1===z&&(u.adler=C(u.adler,G,s,0)),T.wrap=0,s>=T.w_size){0===z&&(L(T.head),T.strstart=0,T.block_start=0,T.insert=0);let u=new Uint8Array(T.w_size);u.set(G.subarray(s-T.w_size,s),0),G=u,s=T.w_size}const O=u.avail_in,m=u.next_in,f=u.input;for(u.avail_in=s,u.next_in=0,u.input=G,N(T);T.lookahead>=3;){let u=T.strstart,G=T.lookahead-2;do{T.ins_h=S(T,T.ins_h,T.window[u+3-1]),T.prev[u&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=u,u++}while(--G);T.strstart=u,T.lookahead=2,N(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=2,T.match_available=0,u.next_in=m,u.input=f,u.avail_in=O,T.wrap=z,F},u.exports.deflateInfo="pako deflate (from Nodeca project)"},10838:u=>{"use strict";u.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10827:u=>{"use strict";u.exports=function(u,G){let s,T,z,O,m,f,C,x,g,b,Q,Y,n,V,F,r,c,j,l,P,H,X,p,q;const d=u.state;s=u.next_in,p=u.input,T=s+(u.avail_in-5),z=u.next_out,q=u.output,O=z-(G-u.avail_out),m=z+(u.avail_out-257),f=d.dmax,C=d.wsize,x=d.whave,g=d.wnext,b=d.window,Q=d.hold,Y=d.bits,n=d.lencode,V=d.distcode,F=(1<<d.lenbits)-1,r=(1<<d.distbits)-1;u:do{Y<15&&(Q+=p[s++]<<Y,Y+=8,Q+=p[s++]<<Y,Y+=8),c=n[Q&F];G:for(;;){if(j=c>>>24,Q>>>=j,Y-=j,j=c>>>16&255,0===j)q[z++]=65535&c;else{if(!(16&j)){if(0===(64&j)){c=n[(65535&c)+(Q&(1<<j)-1)];continue G}if(32&j){d.mode=12;break u}u.msg="invalid literal/length code",d.mode=30;break u}l=65535&c,j&=15,j&&(Y<j&&(Q+=p[s++]<<Y,Y+=8),l+=Q&(1<<j)-1,Q>>>=j,Y-=j),Y<15&&(Q+=p[s++]<<Y,Y+=8,Q+=p[s++]<<Y,Y+=8),c=V[Q&r];s:for(;;){if(j=c>>>24,Q>>>=j,Y-=j,j=c>>>16&255,!(16&j)){if(0===(64&j)){c=V[(65535&c)+(Q&(1<<j)-1)];continue s}u.msg="invalid distance code",d.mode=30;break u}if(P=65535&c,j&=15,Y<j&&(Q+=p[s++]<<Y,Y+=8,Y<j&&(Q+=p[s++]<<Y,Y+=8)),P+=Q&(1<<j)-1,P>f){u.msg="invalid distance too far back",d.mode=30;break u}if(Q>>>=j,Y-=j,j=z-O,P>j){if(j=P-j,j>x&&d.sane){u.msg="invalid distance too far back",d.mode=30;break u}if(H=0,X=b,0===g){if(H+=C-j,j<l){l-=j;do{q[z++]=b[H++]}while(--j);H=z-P,X=q}}else if(g<j){if(H+=C+g-j,j-=g,j<l){l-=j;do{q[z++]=b[H++]}while(--j);if(H=0,g<l){j=g,l-=j;do{q[z++]=b[H++]}while(--j);H=z-P,X=q}}}else if(H+=g-j,j<l){l-=j;do{q[z++]=b[H++]}while(--j);H=z-P,X=q}for(;l>2;)q[z++]=X[H++],q[z++]=X[H++],q[z++]=X[H++],l-=3;l&&(q[z++]=X[H++],l>1&&(q[z++]=X[H++]))}else{H=z-P;do{q[z++]=q[H++],q[z++]=q[H++],q[z++]=q[H++],l-=3}while(l>2);l&&(q[z++]=q[H++],l>1&&(q[z++]=q[H++]))}break}}break}}while(s<T&&z<m);l=Y>>3,s-=l,Y-=l<<3,Q&=(1<<Y)-1,u.next_in=s,u.next_out=z,u.avail_in=s<T?T-s+5:5-(s-T),u.avail_out=z<m?m-z+257:257-(z-m),d.hold=Q,d.bits=Y}},10823:(u,G,s)=>{"use strict";const T=s(10772),z=s(10780),O=s(10827),m=s(10836),{Z_FINISH:f,Z_BLOCK:C,Z_TREES:x,Z_OK:g,Z_STREAM_END:b,Z_NEED_DICT:Q,Z_STREAM_ERROR:Y,Z_DATA_ERROR:n,Z_MEM_ERROR:V,Z_BUF_ERROR:F,Z_DEFLATED:r}=s(10795),c=12,j=30,l=u=>(u>>>24&255)+(u>>>8&65280)+((65280&u)<<8)+((255&u)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const H=u=>{if(!u||!u.state)return Y;const G=u.state;return u.total_in=u.total_out=G.total=0,u.msg="",G.wrap&&(u.adler=1&G.wrap),G.mode=1,G.last=0,G.havedict=0,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new Int32Array(852),G.distcode=G.distdyn=new Int32Array(592),G.sane=1,G.back=-1,g},X=u=>{if(!u||!u.state)return Y;const G=u.state;return G.wsize=0,G.whave=0,G.wnext=0,H(u)},p=(u,G)=>{let s;if(!u||!u.state)return Y;const T=u.state;return G<0?(s=0,G=-G):(s=1+(G>>4),G<48&&(G&=15)),G&&(G<8||G>15)?Y:(null!==T.window&&T.wbits!==G&&(T.window=null),T.wrap=s,T.wbits=G,X(u))},q=(u,G)=>{if(!u)return Y;const s=new P;u.state=s,s.window=null;const T=p(u,G);return T!==g&&(u.state=null),T};let d,v,W=!0;const M=u=>{if(W){d=new Int32Array(512),v=new Int32Array(32);let G=0;for(;G<144;)u.lens[G++]=8;for(;G<256;)u.lens[G++]=9;for(;G<280;)u.lens[G++]=7;for(;G<288;)u.lens[G++]=8;for(m(1,u.lens,0,288,d,0,u.work,{bits:9}),G=0;G<32;)u.lens[G++]=5;m(2,u.lens,0,32,v,0,u.work,{bits:5}),W=!1}u.lencode=d,u.lenbits=9,u.distcode=v,u.distbits=5},o=(u,G,s,T)=>{let z;const O=u.state;return null===O.window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new Uint8Array(O.wsize)),T>=O.wsize?(O.window.set(G.subarray(s-O.wsize,s),0),O.wnext=0,O.whave=O.wsize):(z=O.wsize-O.wnext,z>T&&(z=T),O.window.set(G.subarray(s-T,s-T+z),O.wnext),(T-=z)?(O.window.set(G.subarray(s-T,s),0),O.wnext=T,O.whave=O.wsize):(O.wnext+=z,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=z))),0};u.exports.inflateReset=X,u.exports.inflateReset2=p,u.exports.inflateResetKeep=H,u.exports.inflateInit=u=>q(u,15),u.exports.inflateInit2=q,u.exports.inflate=(u,G)=>{let s,P,H,X,p,q,d,v,W,R,B,D,k,w,L,S,e,h,I,i,J,A,N=0;const y=new Uint8Array(4);let a,K;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!u||!u.state||!u.output||!u.input&&0!==u.avail_in)return Y;s=u.state,s.mode===c&&(s.mode=13),p=u.next_out,H=u.output,d=u.avail_out,X=u.next_in,P=u.input,q=u.avail_in,v=s.hold,W=s.bits,R=q,B=d,A=g;u:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;W<16;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(2&s.wrap&&35615===v){s.check=0,y[0]=255&v,y[1]=v>>>8&255,s.check=z(s.check,y,2,0),v=0,W=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){u.msg="incorrect header check",s.mode=j;break}if((15&v)!==r){u.msg="unknown compression method",s.mode=j;break}if(v>>>=4,W-=4,J=8+(15&v),0===s.wbits)s.wbits=J;else if(J>s.wbits){u.msg="invalid window size",s.mode=j;break}s.dmax=1<<s.wbits,u.adler=s.check=1,s.mode=512&v?10:c,v=0,W=0;break;case 2:for(;W<16;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(s.flags=v,(255&s.flags)!==r){u.msg="unknown compression method",s.mode=j;break}if(57344&s.flags){u.msg="unknown header flags set",s.mode=j;break}s.head&&(s.head.text=v>>8&1),512&s.flags&&(y[0]=255&v,y[1]=v>>>8&255,s.check=z(s.check,y,2,0)),v=0,W=0,s.mode=3;case 3:for(;W<32;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.head&&(s.head.time=v),512&s.flags&&(y[0]=255&v,y[1]=v>>>8&255,y[2]=v>>>16&255,y[3]=v>>>24&255,s.check=z(s.check,y,4,0)),v=0,W=0,s.mode=4;case 4:for(;W<16;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&s.flags&&(y[0]=255&v,y[1]=v>>>8&255,s.check=z(s.check,y,2,0)),v=0,W=0,s.mode=5;case 5:if(1024&s.flags){for(;W<16;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.length=v,s.head&&(s.head.extra_len=v),512&s.flags&&(y[0]=255&v,y[1]=v>>>8&255,s.check=z(s.check,y,2,0)),v=0,W=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&(D=s.length,D>q&&(D=q),D&&(s.head&&(J=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(P.subarray(X,X+D),J)),512&s.flags&&(s.check=z(s.check,P,D,X)),q-=D,X+=D,s.length-=D),s.length))break u;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===q)break u;D=0;do{J=P[X+D++],s.head&&J&&s.length<65536&&(s.head.name+=String.fromCharCode(J))}while(J&&D<q);if(512&s.flags&&(s.check=z(s.check,P,D,X)),q-=D,X+=D,J)break u}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===q)break u;D=0;do{J=P[X+D++],s.head&&J&&s.length<65536&&(s.head.comment+=String.fromCharCode(J))}while(J&&D<q);if(512&s.flags&&(s.check=z(s.check,P,D,X)),q-=D,X+=D,J)break u}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;W<16;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(v!==(65535&s.check)){u.msg="header crc mismatch",s.mode=j;break}v=0,W=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),u.adler=s.check=0,s.mode=c;break;case 10:for(;W<32;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}u.adler=s.check=l(v),v=0,W=0,s.mode=11;case 11:if(0===s.havedict)return u.next_out=p,u.avail_out=d,u.next_in=X,u.avail_in=q,s.hold=v,s.bits=W,Q;u.adler=s.check=1,s.mode=c;case c:if(G===C||G===x)break u;case 13:if(s.last){v>>>=7&W,W-=7&W,s.mode=27;break}for(;W<3;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}switch(s.last=1&v,v>>>=1,W-=1,3&v){case 0:s.mode=14;break;case 1:if(M(s),s.mode=20,G===x){v>>>=2,W-=2;break u}break;case 2:s.mode=17;break;case 3:u.msg="invalid block type",s.mode=j}v>>>=2,W-=2;break;case 14:for(v>>>=7&W,W-=7&W;W<32;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if((65535&v)!==(v>>>16^65535)){u.msg="invalid stored block lengths",s.mode=j;break}if(s.length=65535&v,v=0,W=0,s.mode=15,G===x)break u;case 15:s.mode=16;case 16:if(D=s.length,D){if(D>q&&(D=q),D>d&&(D=d),0===D)break u;H.set(P.subarray(X,X+D),p),q-=D,X+=D,d-=D,p+=D,s.length-=D;break}s.mode=c;break;case 17:for(;W<14;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(s.nlen=257+(31&v),v>>>=5,W-=5,s.ndist=1+(31&v),v>>>=5,W-=5,s.ncode=4+(15&v),v>>>=4,W-=4,s.nlen>286||s.ndist>30){u.msg="too many length or distance symbols",s.mode=j;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;W<3;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.lens[Z[s.have++]]=7&v,v>>>=3,W-=3}for(;s.have<19;)s.lens[Z[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,a={bits:s.lenbits},A=m(0,s.lens,0,19,s.lencode,0,s.work,a),s.lenbits=a.bits,A){u.msg="invalid code lengths set",s.mode=j;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;N=s.lencode[v&(1<<s.lenbits)-1],L=N>>>24,S=N>>>16&255,e=65535&N,!(L<=W);){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(e<16)v>>>=L,W-=L,s.lens[s.have++]=e;else{if(16===e){for(K=L+2;W<K;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(v>>>=L,W-=L,0===s.have){u.msg="invalid bit length repeat",s.mode=j;break}J=s.lens[s.have-1],D=3+(3&v),v>>>=2,W-=2}else if(17===e){for(K=L+3;W<K;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}v>>>=L,W-=L,J=0,D=3+(7&v),v>>>=3,W-=3}else{for(K=L+7;W<K;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}v>>>=L,W-=L,J=0,D=11+(127&v),v>>>=7,W-=7}if(s.have+D>s.nlen+s.ndist){u.msg="invalid bit length repeat",s.mode=j;break}for(;D--;)s.lens[s.have++]=J}}if(s.mode===j)break;if(0===s.lens[256]){u.msg="invalid code -- missing end-of-block",s.mode=j;break}if(s.lenbits=9,a={bits:s.lenbits},A=m(1,s.lens,0,s.nlen,s.lencode,0,s.work,a),s.lenbits=a.bits,A){u.msg="invalid literal/lengths set",s.mode=j;break}if(s.distbits=6,s.distcode=s.distdyn,a={bits:s.distbits},A=m(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,a),s.distbits=a.bits,A){u.msg="invalid distances set",s.mode=j;break}if(s.mode=20,G===x)break u;case 20:s.mode=21;case 21:if(q>=6&&d>=258){u.next_out=p,u.avail_out=d,u.next_in=X,u.avail_in=q,s.hold=v,s.bits=W,O(u,B),p=u.next_out,H=u.output,d=u.avail_out,X=u.next_in,P=u.input,q=u.avail_in,v=s.hold,W=s.bits,s.mode===c&&(s.back=-1);break}for(s.back=0;N=s.lencode[v&(1<<s.lenbits)-1],L=N>>>24,S=N>>>16&255,e=65535&N,!(L<=W);){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(S&&0===(240&S)){for(h=L,I=S,i=e;N=s.lencode[i+((v&(1<<h+I)-1)>>h)],L=N>>>24,S=N>>>16&255,e=65535&N,!(h+L<=W);){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}v>>>=h,W-=h,s.back+=h}if(v>>>=L,W-=L,s.back+=L,s.length=e,0===S){s.mode=26;break}if(32&S){s.back=-1,s.mode=c;break}if(64&S){u.msg="invalid literal/length code",s.mode=j;break}s.extra=15&S,s.mode=22;case 22:if(s.extra){for(K=s.extra;W<K;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,W-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;N=s.distcode[v&(1<<s.distbits)-1],L=N>>>24,S=N>>>16&255,e=65535&N,!(L<=W);){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(0===(240&S)){for(h=L,I=S,i=e;N=s.distcode[i+((v&(1<<h+I)-1)>>h)],L=N>>>24,S=N>>>16&255,e=65535&N,!(h+L<=W);){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}v>>>=h,W-=h,s.back+=h}if(v>>>=L,W-=L,s.back+=L,64&S){u.msg="invalid distance code",s.mode=j;break}s.offset=e,s.extra=15&S,s.mode=24;case 24:if(s.extra){for(K=s.extra;W<K;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,W-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){u.msg="invalid distance too far back",s.mode=j;break}s.mode=25;case 25:if(0===d)break u;if(D=B-d,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){u.msg="invalid distance too far back",s.mode=j;break}D>s.wnext?(D-=s.wnext,k=s.wsize-D):k=s.wnext-D,D>s.length&&(D=s.length),w=s.window}else w=H,k=p-s.offset,D=s.length;D>d&&(D=d),d-=D,s.length-=D;do{H[p++]=w[k++]}while(--D);0===s.length&&(s.mode=21);break;case 26:if(0===d)break u;H[p++]=s.length,d--,s.mode=21;break;case 27:if(s.wrap){for(;W<32;){if(0===q)break u;q--,v|=P[X++]<<W,W+=8}if(B-=d,u.total_out+=B,s.total+=B,B&&(u.adler=s.check=s.flags?z(s.check,H,B,p-B):T(s.check,H,B,p-B)),B=d,(s.flags?v:l(v))!==s.check){u.msg="incorrect data check",s.mode=j;break}v=0,W=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;W<32;){if(0===q)break u;q--,v+=P[X++]<<W,W+=8}if(v!==(4294967295&s.total)){u.msg="incorrect length check",s.mode=j;break}v=0,W=0}s.mode=29;case 29:A=b;break u;case j:A=n;break u;case 31:return V;default:return Y}return u.next_out=p,u.avail_out=d,u.next_in=X,u.avail_in=q,s.hold=v,s.bits=W,(s.wsize||B!==u.avail_out&&s.mode<j&&(s.mode<27||G!==f))&&o(u,u.output,u.next_out,B-u.avail_out)?(s.mode=31,V):(R-=u.avail_in,B-=u.avail_out,u.total_in+=R,u.total_out+=B,s.total+=B,s.wrap&&B&&(u.adler=s.check=s.flags?z(s.check,H,B,u.next_out-B):T(s.check,H,B,u.next_out-B)),u.data_type=s.bits+(s.last?64:0)+(s.mode===c?128:0)+(20===s.mode||15===s.mode?256:0),(0===R&&0===B||G===f)&&A===g&&(A=F),A)},u.exports.inflateEnd=u=>{if(!u||!u.state)return Y;let G=u.state;return G.window&&(G.window=null),u.state=null,g},u.exports.inflateGetHeader=(u,G)=>{if(!u||!u.state)return Y;const s=u.state;return 0===(2&s.wrap)?Y:(s.head=G,G.done=!1,g)},u.exports.inflateSetDictionary=(u,G)=>{const s=G.length;let z,O,m;return u&&u.state?(z=u.state,0!==z.wrap&&11!==z.mode?Y:11===z.mode&&(O=1,O=T(O,G,s,0),O!==z.check)?n:(m=o(u,G,s,s),m?(z.mode=31,V):(z.havedict=1,g))):Y},u.exports.inflateInfo="pako inflate (from Nodeca project)"},10836:u=>{"use strict";const G=15,s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),T=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),z=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),O=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);u.exports=(u,m,f,C,x,g,b,Q)=>{const Y=Q.bits;let n,V,F,r,c,j,l=0,P=0,H=0,X=0,p=0,q=0,d=0,v=0,W=0,M=0,o=null,R=0;const B=new Uint16Array(16),D=new Uint16Array(16);let k,w,L,S=null,e=0;for(l=0;l<=G;l++)B[l]=0;for(P=0;P<C;P++)B[m[f+P]]++;for(p=Y,X=G;X>=1&&0===B[X];X--);if(p>X&&(p=X),0===X)return x[g++]=20971520,x[g++]=20971520,Q.bits=1,0;for(H=1;H<X&&0===B[H];H++);for(p<H&&(p=H),v=1,l=1;l<=G;l++)if(v<<=1,v-=B[l],v<0)return-1;if(v>0&&(0===u||1!==X))return-1;for(D[1]=0,l=1;l<G;l++)D[l+1]=D[l]+B[l];for(P=0;P<C;P++)0!==m[f+P]&&(b[D[m[f+P]]++]=P);if(0===u?(o=S=b,j=19):1===u?(o=s,R-=257,S=T,e-=257,j=256):(o=z,S=O,j=-1),M=0,P=0,l=H,c=g,q=p,d=0,F=-1,W=1<<p,r=W-1,1===u&&W>852||2===u&&W>592)return 1;for(;;){k=l-d,b[P]<j?(w=0,L=b[P]):b[P]>j?(w=S[e+b[P]],L=o[R+b[P]]):(w=96,L=0),n=1<<l-d,V=1<<q,H=V;do{V-=n,x[c+(M>>d)+V]=k<<24|w<<16|L}while(0!==V);for(n=1<<l-1;M&n;)n>>=1;if(0!==n?(M&=n-1,M+=n):M=0,P++,0===--B[l]){if(l===X)break;l=m[f+b[P]]}if(l>p&&(M&r)!==F){for(0===d&&(d=p),c+=H,q=l-d,v=1<<q;q+d<X&&(v-=B[q+d],!(v<=0));)q++,v<<=1;if(W+=1<<q,1===u&&W>852||2===u&&W>592)return 1;F=M&r,x[F]=p<<24|q<<16|c-g}}return 0!==M&&(x[c+M]=l-d<<24|64<<16),Q.bits=p,0}},10788:u=>{"use strict";u.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10770:u=>{"use strict";function G(u){let G=u.length;for(;--G>=0;)u[G]=0}const s=256,T=286,z=30,O=15,m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),f=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Array(576);G(g);const b=new Array(60);G(b);const Q=new Array(512);G(Q);const Y=new Array(256);G(Y);const n=new Array(29);G(n);const V=new Array(z);function F(u,G,s,T,z){this.static_tree=u,this.extra_bits=G,this.extra_base=s,this.elems=T,this.max_length=z,this.has_stree=u&&u.length}let r,c,j;function l(u,G){this.dyn_tree=u,this.max_code=0,this.stat_desc=G}G(V);const P=u=>u<256?Q[u]:Q[256+(u>>>7)],H=(u,G)=>{u.pending_buf[u.pending++]=255&G,u.pending_buf[u.pending++]=G>>>8&255},X=(u,G,s)=>{u.bi_valid>16-s?(u.bi_buf|=G<<u.bi_valid&65535,H(u,u.bi_buf),u.bi_buf=G>>16-u.bi_valid,u.bi_valid+=s-16):(u.bi_buf|=G<<u.bi_valid&65535,u.bi_valid+=s)},p=(u,G,s)=>{X(u,s[2*G],s[2*G+1])},q=(u,G)=>{let s=0;do{s|=1&u,u>>>=1,s<<=1}while(--G>0);return s>>>1},d=(u,G,s)=>{const T=new Array(16);let z,m,f=0;for(z=1;z<=O;z++)T[z]=f=f+s[z-1]<<1;for(m=0;m<=G;m++){let G=u[2*m+1];0!==G&&(u[2*m]=q(T[G]++,G))}},v=u=>{let G;for(G=0;G<T;G++)u.dyn_ltree[2*G]=0;for(G=0;G<z;G++)u.dyn_dtree[2*G]=0;for(G=0;G<19;G++)u.bl_tree[2*G]=0;u.dyn_ltree[512]=1,u.opt_len=u.static_len=0,u.last_lit=u.matches=0},W=u=>{u.bi_valid>8?H(u,u.bi_buf):u.bi_valid>0&&(u.pending_buf[u.pending++]=u.bi_buf),u.bi_buf=0,u.bi_valid=0},M=(u,G,s,T)=>{const z=2*G,O=2*s;return u[z]<u[O]||u[z]===u[O]&&T[G]<=T[s]},o=(u,G,s)=>{const T=u.heap[s];let z=s<<1;for(;z<=u.heap_len&&(z<u.heap_len&&M(G,u.heap[z+1],u.heap[z],u.depth)&&z++,!M(G,T,u.heap[z],u.depth));)u.heap[s]=u.heap[z],s=z,z<<=1;u.heap[s]=T},R=(u,G,T)=>{let z,O,C,x,g=0;if(0!==u.last_lit)do{z=u.pending_buf[u.d_buf+2*g]<<8|u.pending_buf[u.d_buf+2*g+1],O=u.pending_buf[u.l_buf+g],g++,0===z?p(u,O,G):(C=Y[O],p(u,C+s+1,G),x=m[C],0!==x&&(O-=n[C],X(u,O,x)),z--,C=P(z),p(u,C,T),x=f[C],0!==x&&(z-=V[C],X(u,z,x)))}while(g<u.last_lit);p(u,256,G)},B=(u,G)=>{const s=G.dyn_tree,T=G.stat_desc.static_tree,z=G.stat_desc.has_stree,m=G.stat_desc.elems;let f,C,x,g=-1;for(u.heap_len=0,u.heap_max=573,f=0;f<m;f++)0!==s[2*f]?(u.heap[++u.heap_len]=g=f,u.depth[f]=0):s[2*f+1]=0;for(;u.heap_len<2;)x=u.heap[++u.heap_len]=g<2?++g:0,s[2*x]=1,u.depth[x]=0,u.opt_len--,z&&(u.static_len-=T[2*x+1]);for(G.max_code=g,f=u.heap_len>>1;f>=1;f--)o(u,s,f);x=m;do{f=u.heap[1],u.heap[1]=u.heap[u.heap_len--],o(u,s,1),C=u.heap[1],u.heap[--u.heap_max]=f,u.heap[--u.heap_max]=C,s[2*x]=s[2*f]+s[2*C],u.depth[x]=(u.depth[f]>=u.depth[C]?u.depth[f]:u.depth[C])+1,s[2*f+1]=s[2*C+1]=x,u.heap[1]=x++,o(u,s,1)}while(u.heap_len>=2);u.heap[--u.heap_max]=u.heap[1],((u,G)=>{const s=G.dyn_tree,T=G.max_code,z=G.stat_desc.static_tree,m=G.stat_desc.has_stree,f=G.stat_desc.extra_bits,C=G.stat_desc.extra_base,x=G.stat_desc.max_length;let g,b,Q,Y,n,V,F=0;for(Y=0;Y<=O;Y++)u.bl_count[Y]=0;for(s[2*u.heap[u.heap_max]+1]=0,g=u.heap_max+1;g<573;g++)b=u.heap[g],Y=s[2*s[2*b+1]+1]+1,Y>x&&(Y=x,F++),s[2*b+1]=Y,b>T||(u.bl_count[Y]++,n=0,b>=C&&(n=f[b-C]),V=s[2*b],u.opt_len+=V*(Y+n),m&&(u.static_len+=V*(z[2*b+1]+n)));if(0!==F){do{for(Y=x-1;0===u.bl_count[Y];)Y--;u.bl_count[Y]--,u.bl_count[Y+1]+=2,u.bl_count[x]--,F-=2}while(F>0);for(Y=x;0!==Y;Y--)for(b=u.bl_count[Y];0!==b;)Q=u.heap[--g],Q>T||(s[2*Q+1]!==Y&&(u.opt_len+=(Y-s[2*Q+1])*s[2*Q],s[2*Q+1]=Y),b--)}})(u,G),d(s,g,u.bl_count)},D=(u,G,s)=>{let T,z,O=-1,m=G[1],f=0,C=7,x=4;for(0===m&&(C=138,x=3),G[2*(s+1)+1]=65535,T=0;T<=s;T++)z=m,m=G[2*(T+1)+1],++f<C&&z===m||(f<x?u.bl_tree[2*z]+=f:0!==z?(z!==O&&u.bl_tree[2*z]++,u.bl_tree[32]++):f<=10?u.bl_tree[34]++:u.bl_tree[36]++,f=0,O=z,0===m?(C=138,x=3):z===m?(C=6,x=3):(C=7,x=4))},k=(u,G,s)=>{let T,z,O=-1,m=G[1],f=0,C=7,x=4;for(0===m&&(C=138,x=3),T=0;T<=s;T++)if(z=m,m=G[2*(T+1)+1],!(++f<C&&z===m)){if(f<x)do{p(u,z,u.bl_tree)}while(0!==--f);else 0!==z?(z!==O&&(p(u,z,u.bl_tree),f--),p(u,16,u.bl_tree),X(u,f-3,2)):f<=10?(p(u,17,u.bl_tree),X(u,f-3,3)):(p(u,18,u.bl_tree),X(u,f-11,7));f=0,O=z,0===m?(C=138,x=3):z===m?(C=6,x=3):(C=7,x=4)}};let w=!1;const L=(u,G,s,T)=>{X(u,0+(T?1:0),3),((u,G,s,T)=>{W(u),T&&(H(u,s),H(u,~s)),u.pending_buf.set(u.window.subarray(G,G+s),u.pending),u.pending+=s})(u,G,s,!0)};u.exports._tr_init=u=>{w||((()=>{let u,G,s,x,l;const P=new Array(16);for(s=0,x=0;x<28;x++)for(n[x]=s,u=0;u<1<<m[x];u++)Y[s++]=x;for(Y[s-1]=x,l=0,x=0;x<16;x++)for(V[x]=l,u=0;u<1<<f[x];u++)Q[l++]=x;for(l>>=7;x<z;x++)for(V[x]=l<<7,u=0;u<1<<f[x]-7;u++)Q[256+l++]=x;for(G=0;G<=O;G++)P[G]=0;for(u=0;u<=143;)g[2*u+1]=8,u++,P[8]++;for(;u<=255;)g[2*u+1]=9,u++,P[9]++;for(;u<=279;)g[2*u+1]=7,u++,P[7]++;for(;u<=287;)g[2*u+1]=8,u++,P[8]++;for(d(g,287,P),u=0;u<z;u++)b[2*u+1]=5,b[2*u]=q(u,5);r=new F(g,m,257,T,O),c=new F(b,f,0,z,O),j=new F(new Array(0),C,0,19,7)})(),w=!0),u.l_desc=new l(u.dyn_ltree,r),u.d_desc=new l(u.dyn_dtree,c),u.bl_desc=new l(u.bl_tree,j),u.bi_buf=0,u.bi_valid=0,v(u)},u.exports._tr_stored_block=L,u.exports._tr_flush_block=(u,G,T,z)=>{let O,m,f=0;u.level>0?(2===u.strm.data_type&&(u.strm.data_type=(u=>{let G,T=4093624447;for(G=0;G<=31;G++,T>>>=1)if(1&T&&0!==u.dyn_ltree[2*G])return 0;if(0!==u.dyn_ltree[18]||0!==u.dyn_ltree[20]||0!==u.dyn_ltree[26])return 1;for(G=32;G<s;G++)if(0!==u.dyn_ltree[2*G])return 1;return 0})(u)),B(u,u.l_desc),B(u,u.d_desc),f=(u=>{let G;for(D(u,u.dyn_ltree,u.l_desc.max_code),D(u,u.dyn_dtree,u.d_desc.max_code),B(u,u.bl_desc),G=18;G>=3&&0===u.bl_tree[2*x[G]+1];G--);return u.opt_len+=3*(G+1)+5+5+4,G})(u),O=u.opt_len+3+7>>>3,m=u.static_len+3+7>>>3,m<=O&&(O=m)):O=m=T+5,T+4<=O&&-1!==G?L(u,G,T,z):4===u.strategy||m===O?(X(u,2+(z?1:0),3),R(u,g,b)):(X(u,4+(z?1:0),3),((u,G,s,T)=>{let z;for(X(u,G-257,5),X(u,s-1,5),X(u,T-4,4),z=0;z<T;z++)X(u,u.bl_tree[2*x[z]+1],3);k(u,u.dyn_ltree,G-1),k(u,u.dyn_dtree,s-1)})(u,u.l_desc.max_code+1,u.d_desc.max_code+1,f+1),R(u,u.dyn_ltree,u.dyn_dtree)),v(u),z&&W(u)},u.exports._tr_tally=(u,G,T)=>(u.pending_buf[u.d_buf+2*u.last_lit]=G>>>8&255,u.pending_buf[u.d_buf+2*u.last_lit+1]=255&G,u.pending_buf[u.l_buf+u.last_lit]=255&T,u.last_lit++,0===G?u.dyn_ltree[2*T]++:(u.matches++,G--,u.dyn_ltree[2*(Y[T]+s+1)]++,u.dyn_dtree[2*P(G)]++),u.last_lit===u.lit_bufsize-1),u.exports._tr_align=u=>{X(u,2,3),p(u,256,g),(u=>{16===u.bi_valid?(H(u,u.bi_buf),u.bi_buf=0,u.bi_valid=0):u.bi_valid>=8&&(u.pending_buf[u.pending++]=255&u.bi_buf,u.bi_buf>>=8,u.bi_valid-=8)})(u)}},10806:u=>{"use strict";u.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11801:u=>{function G(u,G,s){for(var T=u.length,z=-1/0,O=1/0,m=0;m<T;m++){var f=(s[0][m]-u[m])/G[m],C=(s[1][m]-u[m])/G[m];if(f>C){var x=f;f=C,C=x}if(C<z||f>O)return 1/0;f>z&&(z=f),C<O&&(O=C)}return z>O?1/0:z}u.exports=function(u,s,T,z){var O=G(s,T,z);if(O===1/0)u=null;else{u=u||[];for(var m=0;m<s.length;m++)u[m]=s[m]+T[m]*O}return u},u.exports.distance=G},12289:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(41);const z=T.useLayoutEffect;const O=function(u){var G=(0,T.useRef)(u);return z((function(){G.current=u})),G};var m=function(u){var G=O(u);(0,T.useEffect)((function(){var u=function(u){var s;if(null!=G.current&&(s=G.current(u)),u.defaultPrevented&&(u.returnValue=""),"string"===typeof s)return u.returnValue=s,s};return window.addEventListener("beforeunload",u),function(){window.removeEventListener("beforeunload",u)}}),[])}},12251:(u,G,s)=>{"use strict";var T=s(12255),z=Array.prototype.concat,O=Array.prototype.slice,m=u.exports=function(u){for(var G=[],s=0,m=u.length;s<m;s++){var f=u[s];T(f)?G=z.call(G,O.call(f)):G.push(f)}return G};m.wrap=function(u){return function(){return u(m(arguments))}}},12255:u=>{u.exports=function(u){return!(!u||"string"===typeof u)&&(u instanceof Array||Array.isArray(u)||u.length>=0&&(u.splice instanceof Function||Object.getOwnPropertyDescriptor(u,u.length-1)&&"String"!==u.constructor.name))}},12193:u=>{"use strict";var G=[],s=[],T=[],z=[],O=[],m=[],f=[],C=[],x=[],g=[],b=[],Q=[];u.exports=function(u,Y,n,V,F,r){for(var c=f,j=x,l=g,P=Q,H=0;H<3;H++)c[H]=+n[H],l[H]=+Y.max[H],j[H]=+Y.base[H];r||(r=1e-10);var X=function(u,f,x,g,Q,Y){var n=G,V=s,F=T,r=z,c=O,j=m,l=C,P=Math.floor,H=0,X=0,p=0,q=0,d=0;if(v(),0===p)return 0;for(q=o();X<=p;){if(W(q)&&M())return H;q=o()}for(H+=p,d=0;d<3;d++)g[d]+=x[d],Q[d]+=x[d];return H;function v(){if(X=0,0!==(p=Math.sqrt(x[0]*x[0]+x[1]*x[1]+x[2]*x[2])))for(var u=0;u<3;u++){var G=x[u]>=0;r[u]=G?1:-1;var s=G?Q[u]:g[u];n[u]=G?g[u]:Q[u],V[u]=R(s,r[u]),F[u]=B(n[u],r[u]),l[u]=x[u]/p,c[u]=Math.abs(1/l[u]);var T=G?V[u]+1-s:s-V[u];j[u]=c[u]<1/0?c[u]*T:1/0}}function W(G){for(var s=r[0],T=0===G?V[0]:F[0],z=V[0]+s,O=r[1],m=1===G?V[1]:F[1],f=V[1]+O,C=r[2],x=2===G?V[2]:F[2],g=V[2]+C,b=T;b!=z;b+=s)for(var Q=m;Q!=f;Q+=O)for(var Y=x;Y!=g;Y+=C)if(u(b,Q,Y))return!0;return!1}function M(){H+=X;var u=r[q],G=X/p,s=b;for(d=0;d<3;d++){var T=x[d]*G;g[d]+=T,Q[d]+=T,s[d]=x[d]-T}if(u>0?Q[q]=Math.round(Q[q]):g[q]=Math.round(g[q]),f(H,q,u,s))return!0;for(d=0;d<3;d++)x[d]=s[d];return v(),0===p}function o(){var u=j[0]<j[1]?j[0]<j[2]?0:2:j[1]<j[2]?1:2,G=j[u]-X;for(X=j[u],V[u]+=r[u],j[u]+=c[u],d=0;d<3;d++)n[d]+=G*l[d],F[d]=B(n[d],r[d]);return u}function R(u,G){return P(u-G*Y)}function B(u,G){return P(u+G*Y)}}(u,V,c,j,l,r);if(!F){for(H=0;H<3;H++)P[H]=n[H]>0?l[H]-Y.max[H]:j[H]-Y.base[H];Y.translate(P)}return X}},10538:(u,G,s)=>{var T=s(10541);function z(u){for(var G,s,z=0,O=u.length,m=0;m<u.length;){for(G=u[m],s=0;m<O&&u[m]===G;)++m,++s;z+=T.log2(s)/7|0,z+=T.log2(G>>>0)/7|0,z+=2}return z}G.size=z,G.encode=function(u,G){G||(G=new Uint8Array(z(u)));for(var s,T,O=0,m=G.length,f=0;f<u.length;){for(s=u[f],T=0;f<u.length&&u[f]===s;)++f,++T;for(;O<m&&T>=128;)G[O++]=128+(127&T),T>>>=7;if(O>=m)throw new Error("RLE buffer overflow");for(G[O++]=T,s>>>=0;O<m&&s>=128;)G[O++]=128+(127&s),s>>>=7;if(O>=m)throw new Error("RLE buffer overflow");G[O++]=s}return G},G.decode=function(u,G){for(var s,T,z,O,m=G.length,f=u.length,C=0,x=0;x<f;){for(s=0,T=0;x<f&&u[x]>=128;)s+=(127&u[x++])<<T,T+=7;if(s+=u[x++]<<T,x>=f)throw new Error("RLE buffer underrun");if(C+s>m)throw new Error("Chunk buffer overflow");for(z=0,T=0;x<f&&u[x]>=128;)z+=(127&u[x++])<<T,T+=7;if(x>=f)throw new Error("RLE buffer underrun");for(z+=u[x++]<<T,O=0;O<s;++O)G[C++]=z}return G}},10541:(u,G)=>{"use strict";function s(u){var G=32;return(u&=-u)&&G--,65535&u&&(G-=16),16711935&u&&(G-=8),252645135&u&&(G-=4),858993459&u&&(G-=2),1431655765&u&&(G-=1),G}G.INT_BITS=32,G.INT_MAX=2147483647,G.INT_MIN=-1<<31,G.sign=function(u){return(u>0)-(u<0)},G.abs=function(u){var G=u>>31;return(u^G)-G},G.min=function(u,G){return G^(u^G)&-(u<G)},G.max=function(u,G){return u^(u^G)&-(u<G)},G.isPow2=function(u){return!(u&u-1)&&!!u},G.log2=function(u){var G,s;return G=(u>65535)<<4,G|=s=((u>>>=G)>255)<<3,G|=s=((u>>>=s)>15)<<2,(G|=s=((u>>>=s)>3)<<1)|(u>>>=s)>>1},G.log10=function(u){return u>=1e9?9:u>=1e8?8:u>=1e7?7:u>=1e6?6:u>=1e5?5:u>=1e4?4:u>=1e3?3:u>=100?2:u>=10?1:0},G.popCount=function(u){return 16843009*((u=(858993459&(u-=u>>>1&1431655765))+(u>>>2&858993459))+(u>>>4)&252645135)>>>24},G.countTrailingZeros=s,G.nextPow2=function(u){return u+=0===u,--u,u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)+1},G.prevPow2=function(u){return u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,(u|=u>>>16)-(u>>>1)},G.parity=function(u){return u^=u>>>16,u^=u>>>8,u^=u>>>4,27030>>>(u&=15)&1};var T=new Array(256);!function(u){for(var G=0;G<256;++G){var s=G,T=G,z=7;for(s>>>=1;s;s>>>=1)T<<=1,T|=1&s,--z;u[G]=T<<z&255}}(T),G.reverse=function(u){return T[255&u]<<24|T[u>>>8&255]<<16|T[u>>>16&255]<<8|T[u>>>24&255]},G.interleave2=function(u,G){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))<<1},G.deinterleave2=function(u,G){return(u=65535&((u=16711935&((u=252645135&((u=858993459&((u=u>>>G&1431655765)|u>>>1))|u>>>2))|u>>>4))|u>>>16))<<16>>16},G.interleave3=function(u,G,s){return u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2),(u|=(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<1)|(s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2))<<2},G.deinterleave3=function(u,G){return(u=1023&((u=4278190335&((u=251719695&((u=3272356035&((u=u>>>G&1227133513)|u>>>2))|u>>>4))|u>>>8))|u>>>16))<<22>>22},G.nextCombination=function(u){var G=u|u-1;return G+1|(~G&-~G)-1>>>s(u)+1}},12368:(u,G,s)=>{"use strict";s.d(G,{e:()=>b});var T=s(12186),z=s(147);class O{constructor(u,G,s,O,m,f,C){this.bg=new T(u.base,u.Dg),this.mass=G,this.friction=s,this.restitution=O,this.Qc=m,this.Ck=f,this.Rc=!!C,this.Bg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.pl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ze=z.create(),this.Xf=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=z.create(),this._impulses=z.create(),this._sleepFrameCount=10}loadFromCopy(u){z.j(this.bg.base,u.bg.base),z.j(this.bg.Dg,u.bg.Dg),z.j(this.bg.max,u.bg.max),this.bg.mag=u.bg.mag,this.mass=u.mass,this.friction=u.friction,this.restitution=u.restitution,this.Qc=u.Qc,this.Ck=u.Ck,this.Rc=u.Rc,this.Bg=u.Bg,this.fluidDrag=u.fluidDrag,this.pl=u.pl,this.preventFallOffEdge=u.preventFallOffEdge,this.rolledBackLastTick=u.rolledBackLastTick,z.j(this.Ze,u.Ze),z.j(this.Xf,u.Xf),this.inFluid=u.inFluid,this._ratioInFluid=u._ratioInFluid,z.j(this._forces,u._forces),z.j(this._impulses,u._impulses),this._sleepFrameCount=u._sleepFrameCount}setPosition(u){m(u),z.Nc(u,u,this.bg.base),this.bg.translate(u),this.df()}eb(){return z.clone(this.bg.base)}applyForce(u){m(u),z.add(this._forces,this._forces,u),this.df()}applyImpulse(u){m(u),z.add(this._impulses,this._impulses,u),this.df()}df(){this._sleepFrameCount=10}atRestX(){return this.Xf[0]}atRestY(){return this.Xf[1]}atRestZ(){return this.Xf[2]}}var m=u=>{};var f=s(12186),C=s(147),x=s(12193);function g(){this.Bg=.1,this.fluidDrag=.4,this.$c=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function b(u,G,s){u=Object.assign(new g,u),this.gravity=u.gravity||[0,-10,0],this.Bg=u.Bg||.1,this.$c=u.$c||2,this.fluidDrag=u.fluidDrag||.4,this.minBounceImpulse=u.minBounceImpulse,this.bodies=[],this.Zj=u.Zj,this.testSolid=G,this.testFluid=s}b.prototype.Jk=function(u,G,s,T,z,m){u=u||new f([0,0,0],[1,1,1]),"undefined"==typeof G&&(G=1),"undefined"==typeof s&&(s=1),"undefined"==typeof T&&(T=0),"undefined"==typeof z&&(z=1);var C=new O(u,G,s,T,z,m);return this.bodies.push(C),C},b.prototype.Kk=function(u){var G=this.bodies.indexOf(u);G<0||(this.bodies.splice(G,1),u.bg=u.Ck=null)};var Q=C.create(),Y=C.create(),n=C.create(),V=C.create(),F=C.create(),r=C.create(),c=C.create(),j=new f([0,0,0],[1,1,1]),l=new O(j,1,1,0,1,(()=>{}),!1);function P(u,G,s){return G=s,G*=1-(1-u.ratioInFluid)**2}b.prototype.yd=function(u){u/=1e3;var G=S(0,C.squaredLength(this.gravity));this.bodies.forEach((s=>function(u,G,s,T){C.j(F,G.Xf),u.Zj&&l.loadFromCopy(G);if(G.mass<=0)return C.set(G.Ze,0,0,0),C.set(G._forces,0,0,0),void C.set(G._impulses,0,0,0);var z=T||0===G.Qc;if(function(u,G,s,T){if(G._sleepFrameCount>0)return!1;if(T)return!0;var z=!1,O=.5*s*s*G.Qc;return C.scale(L,u.gravity,O),x(u.testSolid,G.bg,L,(function(){return z=!0,!0}),!0),z}(u,G,s,z))return;G._sleepFrameCount--,function(u,G){var s=G.bg,T=Math.floor(s.base[0]),z=Math.floor(s.base[2]),O=Math.floor(s.base[1]),m=Math.floor(s.max[1]);if(!u.testFluid(T,O,z))return G.inFluid=!1,void(G.ratioInFluid=0);var f=1,x=O+1;for(;x<=m&&u.testFluid(T,x,z);)f++,x++;var g=(O+f-s.base[1])/s.Dg[1];g>1&&(g=1);var b=s.Dg[0]*s.Dg[1]*s.Dg[2]*g,Q=X;C.scale(Q,u.gravity,-u.$c*b*G.Qc),G.applyForce(Q),G.inFluid=!0,G.ratioInFluid=g}(u,G),h(G._forces),h(G._impulses),h(G.Ze),h(G.Xf),C.scale(Q,G._forces,1/G.mass),C.md(Q,Q,u.gravity,G.Qc),C.scale(Y,G._impulses,1/G.mass),C.md(Y,Y,Q,s),C.add(G.Ze,G.Ze,Y),G.friction&&(p(u,0,G,Y,s),p(u,1,G,Y,s),p(u,2,G,Y,s));var O=G.fluidDrag>=0?G.fluidDrag:u.fluidDrag,m=G.Bg>=0?G.Bg:u.Bg,f=m,g=m;G.inFluid&&(f=P(G,f,G.fluidDragHoriz>=0?G.fluidDragHoriz:O),g=P(G,g,G.fluidDragVert>=0?G.fluidDragVert:O));f=Math.max(1-f*s/G.mass,0),g=Math.max(1-g*s/G.mass,0),C.set(H,f,g,f),C.multiply(G.Ze,G.Ze,H),C.scale(n,G.Ze,s),C.set(G._forces,0,0,0),C.set(G._impulses,0,0,0),G.Rc&&e(v,G.bg);C.j(r,n),C.set(c,0,0,0),G.preventFallOffEdge&&function(u,G,s,T){if(!G.Xf[1]||s[1]>0)return;var z=D;e(z,G.bg);for(var O=0;O<3;O+=2){C.set(B,0,0,0),B[O]=s[O];var m=!0;(m=(m=(m=(m=m&&!w(u,z.base[0]+B[0]+1e-5,z.base[1],z.base[2]+B[2]+1e-5))&&!w(u,z.max[0]+B[0]-1e-5,z.base[1],z.base[2]+B[2]+1e-5))&&!w(u,z.base[0]+B[0]+1e-5,z.base[1],z.max[2]+B[2]-1e-5))&&!w(u,z.max[0]+B[0]-1e-5,z.base[1],z.max[2]+B[2]-1e-5))?(T[O]=s[O]>0?1:-1,s[O]=0):0===O&&(C.set(k,s[0],0,0),d(u,z,k,T,G.slideOnCollision))}}(u,G,n,c);d(u,G.bg,n,G.Xf,G.slideOnCollision),G.Rc&&function(u,G,s,T){if(G.Xf[1]>=0&&!G.inFluid)return;var z=0!==G.Xf[0],O=0!==G.Xf[2];if(!z&&!O)return;var m=Math.abs(T[0]/T[2]),f=4;if(!z&&m>f)return;if(!O&&m<1/f)return;C.add(M,s.base,T);var g=u.testSolid;x(g,s,T,(function(u,G,s,T){if(1!==G)return!0;T[G]=0}));var b=s.base[1],Q=G.inFluid?1.951:1.001,Y=Math.floor(b+Q)-b;C.set(o,0,Y,0);var n=!1;if(x(g,s,o,(function(u,G,s,T){return n=!0,!0})),n)return;C.Nc(R,M,s.base),R[1]=0,d(u,s,R,W,!0);var V=S(s.base[0],M[0]),F=S(s.base[2],M[2]);if(z&&!V&&(!F||!O))return;if(O&&(!V||!z)&&!F)return;var r=!0;if(r=r&&!w(u,s.base[0]+1e-5,s.base[1],s.base[2]+1e-5),r=r&&!w(u,s.max[0]-1e-5,s.base[1],s.base[2]+1e-5),r=r&&!w(u,s.base[0]+1e-5,s.base[1],s.max[2]-1e-5),r=r&&!w(u,s.max[0]-1e-5,s.base[1],s.max[2]-1e-5),r)return;e(G.bg,s),G.Xf[0]=W[0],G.Xf[2]=W[2],G.pl&&G.pl()}(u,G,v,r);for(var b=0;b<3;++b)G.Xf[b]=G.Xf[b]||c[b],V[b]=0,G.Xf[b]&&(F[b]||(V[b]=-G.Ze[b]),G.Ze[b]=0);var j=C.length(V);j>.001&&(C.scale(V,V,G.mass),G.Ck&&G.Ck(V),G.restitution>0&&j>u.minBounceImpulse&&(C.scale(V,V,G.restitution),G.applyImpulse(V)));var q=C.squaredLength(G.Ze);q>1e-5&&G.df();u.Zj&&u.Zj(G)?(G.loadFromCopy(l),G.rolledBackLastTick=!0):G.rolledBackLastTick=!1}(this,s,u,G)))};var H=C.create([0,0,0]);var X=C.create();function p(u,G,s,T,z){var O=s.Xf[G],m=T[G];if(!s.alwaysApplyHorizFriction||1!==G){if(0===O)return;if(O*m<=0)return}C.j(q,s.Ze),q[G]=0;var f=C.length(q);if(!S(f,0)){var x=Math.abs(s.friction*u.gravity[G]*z),g=f>x?(f-x)/f:0;s.Ze[(G+1)%3]*=g,s.Ze[(G+2)%3]*=g}}var q=C.create();function d(u,G,s,T,z){return C.set(T,0,0,0),x(u.testSolid,G,s,(function(u,G,s,O){T[G]=s,O[G]=0,z||(O[0]=0,O[1]=0,O[2]=0)}))}var v=new f([],[]),W=C.create(),M=C.create(),o=C.create(),R=C.create();var B=C.create(),D=new f([],[]),k=C.create();function w(u,G,s,T){return u.testSolid(Math.floor(G),Math.floor(s-1),Math.floor(T))}var L=C.create();function S(u,G){return Math.abs(u-G)<1e-5}function e(u,G){for(var s=0;s<3;s++)u.base[s]=G.base[s],u.max[s]=G.max[s],u.Dg[s]=G.Dg[s]}var h=function(u){}},10739:u=>{"use strict";u.exports=function(u,G,s,T){var z=self||window;try{try{var O;try{O=new z.Blob([u])}catch(x){(O=new(z.BlobBuilder||z.WebKitBlobBuilder||z.MozBlobBuilder||z.MSBlobBuilder)).append(u),O=O.getBlob()}var m=z.URL||z.webkitURL,f=m.createObjectURL(O),C=new z[G](f,s);return m.revokeObjectURL(f),C}catch(x){return new z[G]("data:application/javascript,".concat(encodeURIComponent(u)),s)}}catch(x){if(!T)throw Error("Inline worker is not supported");return new z[G](T,s)}}},11781:(u,G,s)=>{"use strict";function T(u,G,s,T,z){var O={};return Object.keys(T).forEach((function(u){O[u]=T[u]})),O.enumerable=!!O.enumerable,O.configurable=!!O.configurable,("value"in O||O.initializer)&&(O.writable=!0),O=s.slice().reverse().reduce((function(s,T){return T(u,G,s)||s}),O),z&&void 0!==O.initializer&&(O.value=O.initializer?O.initializer.call(z):void 0,O.initializer=void 0),void 0===O.initializer&&(Object.defineProperty(u,G,O),O=null),O}s.d(G,{d:()=>T})},11774:(u,G,s)=>{"use strict";function T(u,G,s,T){s&&Object.defineProperty(u,G,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(T):void 0})}s.d(G,{e:()=>T})},11838:(u,G,s)=>{"use strict";s.d(G,{b:()=>j,f:()=>F,h:()=>r,i:()=>Q,l:()=>V,n:()=>n,o:()=>Y});var T=s(10904),z=s(10930),O=s(10924),m=s(10715),f=s(11844),C=s(11161),x=s(11112),g=s(10615),b=s(10935);const Q=Object.freeze(new T.h(0,0,0,0)),Y=Object.freeze(T.q.Zero()),n=Object.freeze(T.m.Zero()),V=Object.freeze(x.e.Zero()),F=Object.freeze(z.b.Black()),r=Object.freeze(new z.e(0,0,0,0)),c={key:0,repeatCount:0,loopMode:2};class j{static _PrepareAnimation(u,G,s,O,m,f,C,g){let b;if(!isNaN(parseFloat(m))&&isFinite(m)?b=j.ANIMATIONTYPE_FLOAT:m instanceof T.h?b=j.ANIMATIONTYPE_QUATERNION:m instanceof T.q?b=j.ANIMATIONTYPE_VECTOR3:m instanceof T.m?b=j.ANIMATIONTYPE_VECTOR2:m instanceof z.b?b=j.ANIMATIONTYPE_COLOR3:m instanceof z.e?b=j.ANIMATIONTYPE_COLOR4:m instanceof x.e&&(b=j.ANIMATIONTYPE_SIZE),void 0==b)return null;const Q=new j(u,G,s,b,C),Y=[{frame:0,value:m},{frame:O,value:f}];return Q.setKeys(Y),void 0!==g&&Q.setEasingFunction(g),Q}static CreateAnimation(u,G,s,T){const z=new j(u+"Animation",u,s,G,j.ANIMATIONLOOPMODE_CONSTANT);return z.setEasingFunction(T),z}static CreateAndStartAnimation(u,G,s,T,z,O,m,f,C,x,g){const b=j._PrepareAnimation(u,s,T,z,O,m,f,C);return b?(G.va&&(g=G.va()),g?g.beginDirectAnimation(G,[b],0,z,1===b.loopMode,1,x):null):null}static CreateAndStartHierarchyAnimation(u,G,s,T,z,O,m,f,C,x,g){const b=j._PrepareAnimation(u,T,z,O,m,f,C,x);if(!b)return null;return G.va().beginDirectHierarchyAnimation(G,s,[b],0,O,1===b.loopMode,1,g)}static CreateMergeAndStartAnimation(u,G,s,T,z,O,m,f,C,x){const g=j._PrepareAnimation(u,s,T,z,O,m,f,C);return g?(G.animations.push(g),G.va().beginAnimation(G,0,z,1===g.loopMode,1,x)):null}static MakeAnimationAdditive(u,G,s){let z;z="object"===typeof G?G:{referenceFrame:G??0,range:s,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let O=u;if(z.cloneOriginalAnimation&&(O=u.clone(),O.name=z.clonedAnimationName||O.name),!O._keys.length)return O;const m=z.referenceFrame&&z.referenceFrame>=0?z.referenceFrame:0;let f=0;const C=O._keys[0];let x=O._keys.length-1;const g=O._keys[x],b={referenceValue:C.value,referencePosition:T.l.gb[0],referenceQuaternion:T.l.Quaternion[0],referenceScaling:T.l.gb[1],keyPosition:T.l.gb[2],keyQuaternion:T.l.Quaternion[1],keyScaling:T.l.gb[3]};let Q=C.frame,Y=g.frame;if(z.range){const u=O.getRange(z.range);u&&(Q=u.from,Y=u.to)}else Q=z.fromFrame??Q,Y=z.toFrame??Y;if(Q!==C.frame&&(f=O.createKeyForFrame(Q)),Y!==g.frame&&(x=O.createKeyForFrame(Y)),1===O._keys.length){const u=O._getKeyValue(O._keys[0]);b.referenceValue=u.clone?u.clone():u}else if(m<=C.frame){const u=O._getKeyValue(C.value);b.referenceValue=u.clone?u.clone():u}else if(m>=g.frame){const u=O._getKeyValue(g.value);b.referenceValue=u.clone?u.clone():u}else{c.key=0;const u=O._interpolate(m,c);b.referenceValue=u.clone?u.clone():u}O.dataType===j.ANIMATIONTYPE_QUATERNION?b.referenceValue.normalize().conjugateInPlace():O.dataType===j.ANIMATIONTYPE_MATRIX&&(b.referenceValue.decompose(b.referenceScaling,b.referenceQuaternion,b.referencePosition),b.referenceQuaternion.normalize().conjugateInPlace());let n=Number.MAX_VALUE;const V=z.clipKeys?[]:null;for(let F=f;F<=x;F++){let u=O._keys[F];if((V||z.cloneOriginalAnimation)&&(u={frame:u.frame,value:u.value.clone?u.value.clone():u.value,inTangent:u.inTangent,outTangent:u.outTangent,interpolation:u.interpolation,lockedTangent:u.lockedTangent},V&&(n===Number.MAX_VALUE&&(n=u.frame),u.frame-=n,V.push(u))),!F||O.dataType===j.ANIMATIONTYPE_FLOAT||u.value!==C.value)switch(O.dataType){case j.ANIMATIONTYPE_MATRIX:u.value.decompose(b.keyScaling,b.keyQuaternion,b.keyPosition),b.keyPosition.fi(b.referencePosition),b.keyScaling.divideInPlace(b.referenceScaling),b.referenceQuaternion.multiplyToRef(b.keyQuaternion,b.keyQuaternion),T.d.ComposeToRef(b.keyScaling,b.keyQuaternion,b.keyPosition,u.value);break;case j.ANIMATIONTYPE_QUATERNION:b.referenceValue.multiplyToRef(u.value,u.value);break;case j.ANIMATIONTYPE_VECTOR2:case j.ANIMATIONTYPE_VECTOR3:case j.ANIMATIONTYPE_COLOR3:case j.ANIMATIONTYPE_COLOR4:u.value.subtractToRef(b.referenceValue,u.value);break;case j.ANIMATIONTYPE_SIZE:u.value.width-=b.referenceValue.width,u.value.height-=b.referenceValue.height;break;default:u.value-=b.referenceValue}}return V&&O.setKeys(V,!0),O}static TransitionTo(u,G,s,T,z,O,m){let f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(m<=0)return s[u]=G,f&&f(),null;const C=z*(m/1e3);O.setKeys([{frame:0,value:s[u].clone?s[u].clone():s[u]},{frame:C,value:G}]),s.animations||(s.animations=[]),s.animations.push(O);const x=T.beginAnimation(s,0,C,!1);return x.onAnimationEnd=f,x}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const u of this._runtimeAnimations)if(!u.isStopped())return!0;return!1}constructor(u,G,s,T,z,O){this.name=u,this.targetProperty=G,this.framePerSecond=s,this.dataType=T,this.loopMode=z,this.enableBlending=O,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=G.split("."),this.dataType=T,this.loopMode=void 0===z?j.ANIMATIONLOOPMODE_CYCLE:z,this.uniqueId=j._UniqueIdGenerator++}toString(u){let G="Name: "+this.name+", property: "+this.targetProperty;if(G+=", datatype: "+["Float","gb","Quaternion","Matrix","hb","Vector2"][this.dataType],G+=", nKeys: "+(this._keys?this._keys.length:"none"),G+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),u){G+=", Ranges: {";let u=!0;for(const s in this._ranges)u&&(G+=", ",u=!1),G+=s;G+="}"}return G}addEvent(u){this._events.push(u),this._events.sort(((u,G)=>u.frame-G.frame))}removeEvents(u){for(let G=0;G<this._events.length;G++)this._events[G].frame===u&&(this._events.splice(G,1),G--)}getEvents(){return this._events}createRange(u,G,s){this._ranges[u]||(this._ranges[u]=new f.c(u,G,s))}deleteRange(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this._ranges[u];if(s){if(G){const u=s.from,G=s.to;for(let s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=u&&this._keys[s].frame<=G&&this._keys.splice(s,1)}this._ranges[u]=null}}getRange(u){return this._ranges[u]}getKeys(){return this._keys}getHighestFrame(){let u=0;for(let G=0,s=this._keys.length;G<s;G++)u<this._keys[G].frame&&(u=this._keys[G].frame);return u}getEasingFunction(){return this._easingFunction}setEasingFunction(u){this._easingFunction=u}floatInterpolateFunction(u,G,s){return(0,O.m)(u,G,s)}floatInterpolateFunctionWithTangents(u,G,s,T,z){return(0,O.f)(u,G,s,T,z)}quaternionInterpolateFunction(u,G,s){return T.h.Slerp(u,G,s)}quaternionInterpolateFunctionWithTangents(u,G,s,z,O){return T.h.Hermite(u,G,s,z,O).normalize()}vector3InterpolateFunction(u,G,s){return T.q.Lerp(u,G,s)}vector3InterpolateFunctionWithTangents(u,G,s,z,O){return T.q.Hermite(u,G,s,z,O)}vector2InterpolateFunction(u,G,s){return T.m.Lerp(u,G,s)}vector2InterpolateFunctionWithTangents(u,G,s,z,O){return T.m.Hermite(u,G,s,z,O)}sizeInterpolateFunction(u,G,s){return x.e.Lerp(u,G,s)}color3InterpolateFunction(u,G,s){return z.b.Lerp(u,G,s)}color3InterpolateFunctionWithTangents(u,G,s,T,O){return z.b.Hermite(u,G,s,T,O)}color4InterpolateFunction(u,G,s){return z.e.Lerp(u,G,s)}color4InterpolateFunctionWithTangents(u,G,s,T,O){return z.e.Hermite(u,G,s,T,O)}_getKeyValue(u){return"function"===typeof u?u():u}evaluate(u){return c.key=0,this._interpolate(u,c)}_interpolate(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(G.loopMode===j.ANIMATIONLOOPMODE_CONSTANT&&G.repeatCount>0)return G.highLimitValue.clone?G.highLimitValue.clone():G.highLimitValue;const T=this._keys,z=T.length;let O=G.key;for(;O>=0&&u<T[O].frame;)--O;for(;O+1<=z-1&&u>=T[O+1].frame;)++O;if(G.key=O,O<0)return s?void 0:this._getKeyValue(T[0].value);if(O+1>z-1)return s?void 0:this._getKeyValue(T[z-1].value);const m=T[O],f=T[O+1];if(s&&(u===m.frame||u===f.frame))return;const C=this._getKeyValue(m.value),x=this._getKeyValue(f.value);if(1===m.interpolation)return f.frame>u?C:x;const g=void 0!==m.outTangent&&void 0!==f.inTangent,b=f.frame-m.frame;let c=(u-m.frame)/b;const l=m.easingFunction||this.getEasingFunction();switch(null!==l&&(c=l.ease(c)),this.dataType){case j.ANIMATIONTYPE_FLOAT:{const u=g?this.floatInterpolateFunctionWithTangents(C,m.outTangent*b,x,f.inTangent*b,c):this.floatInterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(G.offsetValue??0)*G.repeatCount+u}break}case j.ANIMATIONTYPE_QUATERNION:{const u=g?this.quaternionInterpolateFunctionWithTangents(C,m.outTangent.scale(b),x,f.inTangent.scale(b),c):this.quaternionInterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.addInPlace((G.offsetValue||Q).scale(G.repeatCount))}return u}case j.ANIMATIONTYPE_VECTOR3:{const u=g?this.vector3InterpolateFunctionWithTangents(C,m.outTangent.scale(b),x,f.inTangent.scale(b),c):this.vector3InterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((G.offsetValue||Y).scale(G.repeatCount))}break}case j.ANIMATIONTYPE_VECTOR2:{const u=g?this.vector2InterpolateFunctionWithTangents(C,m.outTangent.scale(b),x,f.inTangent.scale(b),c):this.vector2InterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((G.offsetValue||n).scale(G.repeatCount))}break}case j.ANIMATIONTYPE_SIZE:switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(C,x,c);case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(C,x,c).add((G.offsetValue||V).scale(G.repeatCount))}break;case j.ANIMATIONTYPE_COLOR3:{const u=g?this.color3InterpolateFunctionWithTangents(C,m.outTangent.scale(b),x,f.inTangent.scale(b),c):this.color3InterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((G.offsetValue||F).scale(G.repeatCount))}break}case j.ANIMATIONTYPE_COLOR4:{const u=g?this.color4InterpolateFunctionWithTangents(C,m.outTangent.scale(b),x,f.inTangent.scale(b),c):this.color4InterpolateFunction(C,x,c);switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return u;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((G.offsetValue||r).scale(G.repeatCount))}break}case j.ANIMATIONTYPE_MATRIX:switch(G.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return j.AllowMatricesInterpolation?this.matrixInterpolateFunction(C,x,c,G.workValue):C;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return C}}return 0}matrixInterpolateFunction(u,G,s,z){return j.AllowMatrixDecomposeForInterpolation?z?(T.d.DecomposeLerpToRef(u,G,s,z),z):T.d.DecomposeLerp(u,G,s):z?(T.d.LerpToRef(u,G,s,z),z):T.d.Lerp(u,G,s)}clone(){const u=new j(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed,this._keys&&u.setKeys(this._keys),this._ranges){u._ranges={};for(const G in this._ranges){const s=this._ranges[G];s&&(u._ranges[G]=s.clone())}}return u}setKeys(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=G?u:u.slice(0)}createKeyForFrame(u){c.key=0;const G=this._interpolate(u,c,!0);if(!G)return this._keys[c.key].frame===u?c.key:c.key+1;const s={frame:u,value:G.clone?G.clone():G};return this._keys.splice(c.key+1,0,s),c.key+1}serialize(){const u={};u.name=this.name,u.property=this.targetProperty,u.framePerSecond=this.framePerSecond,u.dataType=this.dataType,u.loopBehavior=this.loopMode,u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed;const G=this.dataType;u.keys=[];const s=this.getKeys();for(let T=0;T<s.length;T++){const z=s[T],O={};switch(O.frame=z.frame,G){case j.ANIMATIONTYPE_FLOAT:O.values=[z.value],void 0!==z.inTangent&&O.values.push(z.inTangent),void 0!==z.outTangent&&(void 0===z.inTangent&&O.values.push(void 0),O.values.push(z.outTangent)),void 0!==z.interpolation&&(void 0===z.inTangent&&O.values.push(void 0),void 0===z.outTangent&&O.values.push(void 0),O.values.push(z.interpolation));break;case j.ANIMATIONTYPE_QUATERNION:case j.ANIMATIONTYPE_MATRIX:case j.ANIMATIONTYPE_VECTOR3:case j.ANIMATIONTYPE_COLOR3:case j.ANIMATIONTYPE_COLOR4:O.values=z.value.$i(),void 0!=z.inTangent&&O.values.push(z.inTangent.$i()),void 0!=z.outTangent&&(void 0===z.inTangent&&O.values.push(void 0),O.values.push(z.outTangent.$i())),void 0!==z.interpolation&&(void 0===z.inTangent&&O.values.push(void 0),void 0===z.outTangent&&O.values.push(void 0),O.values.push(z.interpolation))}u.keys.push(O)}u.ranges=[];for(const T in this._ranges){const G=this._ranges[T];if(!G)continue;const s={};s.name=T,s.from=G.from,s.to=G.to,u.ranges.push(s)}return u}static _UniversalLerp(u,G,s){const T=u.constructor;return T.Lerp?T.Lerp(u,G,s):T.Slerp?T.Slerp(u,G,s):u.toFixed?u*(1-s)+s*G:G}static Parse(u){const G=new j(u.name,u.property,u.framePerSecond,u.dataType,u.loopBehavior),s=u.dataType,O=[];let m,f;for(u.enableBlending&&(G.enableBlending=u.enableBlending),u.blendingSpeed&&(G.blendingSpeed=u.blendingSpeed),f=0;f<u.keys.length;f++){const G=u.keys[f];let C,x,g;switch(s){case j.ANIMATIONTYPE_FLOAT:m=G.values[0],G.values.length>=2&&(C=G.values[1]),G.values.length>=3&&(x=G.values[2]),G.values.length>=4&&(g=G.values[3]);break;case j.ANIMATIONTYPE_QUATERNION:if(m=T.h.Ag(G.values),G.values.length>=8){const u=T.h.Ag(G.values.slice(4,8));u.equals(T.h.Zero())||(C=u)}if(G.values.length>=12){const u=T.h.Ag(G.values.slice(8,12));u.equals(T.h.Zero())||(x=u)}G.values.length>=13&&(g=G.values[12]);break;case j.ANIMATIONTYPE_MATRIX:m=T.d.Ag(G.values),G.values.length>=17&&(g=G.values[16]);break;case j.ANIMATIONTYPE_COLOR3:m=z.b.Ag(G.values),G.values[3]&&(C=z.b.Ag(G.values[3])),G.values[4]&&(x=z.b.Ag(G.values[4])),G.values[5]&&(g=G.values[5]);break;case j.ANIMATIONTYPE_COLOR4:m=z.e.Ag(G.values),G.values[4]&&(C=z.e.Ag(G.values[4])),G.values[5]&&(x=z.e.Ag(G.values[5])),G.values[6]&&(g=z.e.Ag(G.values[6]));break;case j.ANIMATIONTYPE_VECTOR3:default:m=T.q.Ag(G.values),G.values[3]&&(C=T.q.Ag(G.values[3])),G.values[4]&&(x=T.q.Ag(G.values[4])),G.values[5]&&(g=G.values[5])}const b={};b.frame=G.frame,b.value=m,void 0!=C&&(b.inTangent=C),void 0!=x&&(b.outTangent=x),void 0!=g&&(b.interpolation=g),O.push(b)}if(G.setKeys(O),u.ranges)for(f=0;f<u.ranges.length;f++)m=u.ranges[f],G.createRange(m.name,m.from,m.to);return G}static AppendSerializedAnimations(u,G){b.e.AppendSerializedAnimations(u,G)}static ParseFromFileAsync(u,G){return new Promise(((s,T)=>{const z=new g.e;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){let G=JSON.parse(z.responseText);if(G.animations&&(G=G.animations),G.length){const u=[];for(const s of G)u.push(this.Parse(s));s(u)}else{const T=this.Parse(G);u&&(T.name=u),s(T)}}else T("Unable to load the animation")})),z.open("GET",G),z.send()}))}static ParseFromSnippetAsync(u){return new Promise(((G,s)=>{const T=new g.e;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const s=JSON.parse(JSON.parse(T.responseText).jsonPayload);if(s.animations){const T=JSON.parse(s.animations),z=[];for(const G of T.animations){const s=this.Parse(G);s.snippetId=u,z.push(s)}G(z)}else{const T=JSON.parse(s.animation),z=this.Parse(T);z.snippetId=u,G(z)}}else s("Unable to load the snippet "+u)})),T.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),T.send()}))}}j._UniqueIdGenerator=0,j.AllowMatricesInterpolation=!1,j.AllowMatrixDecomposeForInterpolation=!0,j.SnippetUrl="https://snippet.babylonjs.com",j.ANIMATIONTYPE_FLOAT=0,j.ANIMATIONTYPE_VECTOR3=1,j.ANIMATIONTYPE_QUATERNION=2,j.ANIMATIONTYPE_MATRIX=3,j.ANIMATIONTYPE_COLOR3=4,j.ANIMATIONTYPE_COLOR4=7,j.ANIMATIONTYPE_VECTOR2=5,j.ANIMATIONTYPE_SIZE=6,j.ANIMATIONLOOPMODE_RELATIVE=0,j.ANIMATIONLOOPMODE_CYCLE=1,j.ANIMATIONLOOPMODE_CONSTANT=2,j.ANIMATIONLOOPMODE_YOYO=4,j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,j.CreateFromSnippetAsync=j.ParseFromSnippetAsync,(0,m.g)("BABYLON.Animation",j),C.b._AnimationRangeFactory=(u,G,s)=>new f.c(u,G,s)},11844:(u,G,s)=>{"use strict";s.d(G,{c:()=>T});class T{constructor(u,G,s){this.name=u,this.from=G,this.to=s}clone(){return new T(this.name,this.from,this.to)}}},11436:(u,G,s)=>{"use strict";var T=s(10568),z=s(10584),O=s(10645),m=s(10577);O.b.AudioEngineFactory=(u,G,s)=>new f(u,G,s);class f{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new T.e,this.onAudioLockedObservable=new T.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,m.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const z=document.createElement("audio");this._hostElement=u,this._audioContext=G,this._audioDestination=s;try{z&&z.canPlayType&&(z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(O){}try{z&&z.canPlayType&&z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(O){}}lock(){this._triggerSuspendedState()}unlock(){var u,G;if("running"===(null===(u=this._audioContext)||void 0===u?void 0:u.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(G=this._audioContext)||void 0===G||G.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var u;null===(u=this._audioContext)||void 0===u||u.addEventListener("statechange",(()=>{var u;this.unlocked&&"running"!==(null===(u=this._audioContext)||void 0===u?void 0:u.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var u;return null!==(u=this._audioContext)&&void 0!==u&&u.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(u){this.canUseWebAudio=!1,z.d.Error("Web Audio: "+u.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const u=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",G=document.createElement("style");G.appendChild(document.createTextNode(u)),document.getElementsByTagName("head")[0].appendChild(G),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(u){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=u)}connectToAnalyser(u){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=u,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},11831:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(10904),z=s(10918),O=s(11161);class m extends O.b{get _matrix(){return this._compose(),this.Ij}set _matrix(u){(u.updateFlag!==this.Ij.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ij.p(u),this._markAsDirtyAndDecompose())}constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(u,G.va(),!1),this.name=u,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=G,this.Ij=(null===z||void 0===z?void 0:z.clone())??T.d.Identity(),this._restMatrix=O??this.Ij.clone(),this._bindMatrix=m??this.Ij.clone(),this._index=f,this._absoluteMatrix=new T.d,this._absoluteBindMatrix=new T.d,this._absoluteInverseBindMatrix=new T.d,this._finalMatrix=new T.d,G.bones.push(this),this.setParent(s,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(u){this.setParent(u)}setParent(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==u){if(this.parent){const u=this.parent.children.indexOf(this);-1!==u&&this.parent.children.splice(u,1)}this._parentNode=u,this.parent&&this.parent.children.push(this),G&&this._updateAbsoluteBindMatrices(),this.pg()}}getLocalMatrix(){return this._compose(),this.Ij}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(u){this._restMatrix.p(u)}setRestPose(u){this.setRestMatrix(u)}getBindPose(){return this.getBindMatrix()}setBindMatrix(u){this.xj(u)}setBindPose(u){this.setBindMatrix(u)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const u=T.l.gb[0],G=T.l.Quaternion[0],s=T.l.gb[1];this.getRestMatrix().decompose(u,G,s),this._linkedTransformNode.position.p(s),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??T.h.Identity(),this._linkedTransformNode.rotationQuaternion.p(G),this._linkedTransformNode.vf.p(u)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(u){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=u,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.pf}set position(u){this._decompose(),this.pf.p(u),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(u){this.setRotation(u)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(u){this.setRotationQuaternion(u)}get vf(){return this.getScale()}set vf(u){this.setScale(u)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=T.q.Zero(),this._localRotation=T.h.Zero(),this.pf=T.q.Zero()),this.Ij.decompose(this._localScaling,this._localRotation,this.pf))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,T.d.ComposeToRef(this._localScaling,this._localRotation,this.pf,this.Ij)):this._needToCompose=!1)}xj(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(u),G&&this._updateAbsoluteBindMatrices(),s?this._matrix=u:this.pg()}_updateAbsoluteBindMatrices(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(u||(u=this._bindMatrix),this.parent?u.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(u),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),G)for(let s=0;s<this.children.length;s++)this.children[s]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}pg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.pg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.pg(),this._needToDecompose=!0}_updatePosition(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=this.getLocalMatrix();if(0==G)z?(O.addAtIndex(12,u.x),O.addAtIndex(13,u.y),O.addAtIndex(14,u.z)):O.setTranslationFromFloats(u.x,u.y,u.z);else{let G=null;s&&(G=s.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=m._TmpMats[0],C=m._TmpVecs[0];this.parent?s&&G?(f.p(this.parent.getAbsoluteMatrix()),f.multiplyToRef(G,f)):f.p(this.parent.getAbsoluteMatrix()):T.d.IdentityToRef(f),z&&f.setTranslationFromFloats(0,0,0),f.invert(),T.q.TransformCoordinatesToRef(u,f,C),z?(O.addAtIndex(12,C.x),O.addAtIndex(13,C.y),O.addAtIndex(14,C.z)):O.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this._updatePosition(u,G,s,!0)}setPosition(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this._updatePosition(u,G,s,!1)}setAbsolutePosition(u,G){this.setPosition(u,1,G)}scale(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=this.getLocalMatrix(),f=m._TmpMats[0];T.d.ScalingToRef(u,G,s,f),f.multiplyToRef(O,O),f.invert();for(const T of this.children){const z=T.getLocalMatrix();z.multiplyToRef(f,z),z.multiplyAtIndex(12,u),z.multiplyAtIndex(13,G),z.multiplyAtIndex(14,s),T._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),z)for(const T of this.children)T.scale(u,G,s,z)}setScale(u){this._decompose(),this._localScaling.p(u),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(u){this._decompose(),u.p(this._localScaling)}setYawPitchRoll(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4?arguments[4]:void 0;if(0===z){const f=m._TmpQuat;return T.h.RotationYawPitchRollToRef(u,G,s,f),void this.setRotationQuaternion(f,z,O)}const f=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,O))return;const C=m._TmpMats[1];T.d.RotationYawPitchRollToRef(u,G,s,C),f.multiplyToRef(C,C),this._rotateWithMatrix(C,z,O)}rotate(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;const O=m._TmpMats[0];O.setTranslationFromFloats(0,0,0),T.d.RotationAxisToRef(u,G,O),this._rotateWithMatrix(O,s,z)}setAxisAngle(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;if(0===s){const O=m._TmpQuat;return T.h.RotationAxisToRef(u,G,O),void this.setRotationQuaternion(O,s,z)}const O=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,z))return;const f=m._TmpMats[1];T.d.RotationAxisToRef(u,G,f),O.multiplyToRef(f,f),this._rotateWithMatrix(f,s,z)}setRotation(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(u.y,u.x,u.z,G,s)}setRotationQuaternion(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(0===G)return this._decompose(),this._localRotation.p(u),void this._markAsDirtyAndCompose();const z=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,s))return;const O=m._TmpMats[1];T.d.FromQuaternionToRef(u,O),z.multiplyToRef(O,O),this._rotateWithMatrix(O,G,s)}setRotationMatrix(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(0===G){const z=m._TmpQuat;return T.h.FromRotationMatrixToRef(u,z),void this.setRotationQuaternion(z,G,s)}const z=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,s))return;const O=m._TmpMats[1];O.p(u),z.multiplyToRef(u,O),this._rotateWithMatrix(O,G,s)}_rotateWithMatrix(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const T=this.getLocalMatrix(),z=T.m[12],O=T.m[13],f=T.m[14],C=this.getParent(),x=m._TmpMats[3],g=m._TmpMats[4];C&&1==G?(s?(x.p(s.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(x,x)):x.p(C.getAbsoluteMatrix()),g.p(x),g.invert(),T.multiplyToRef(x,T),T.multiplyToRef(u,T),T.multiplyToRef(g,T)):1==G&&s?(x.p(s.getWorldMatrix()),g.p(x),g.invert(),T.multiplyToRef(x,T),T.multiplyToRef(u,T),T.multiplyToRef(g,T)):T.multiplyToRef(u,T),T.setTranslationFromFloats(z,O,f),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(u,G){const s=m._TmpMats[2];return u.p(this.getAbsoluteMatrix()),G?(u.multiplyToRef(G.getWorldMatrix(),u),T.d.ScalingToRef(G.vf.x,G.vf.y,G.vf.z,s)):T.d.IdentityToRef(s),u.invert(),!isNaN(u.m[0])&&(s.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyToRef(s,u),!0)}eb(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.q.Zero();return this.getPositionToRef(u,G,s),s}getPositionToRef(){let u=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const u=this.getLocalMatrix();G.x=u.m[12],G.y=u.m[13],G.z=u.m[14]}else{let s=null;u&&(s=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let T=m._TmpMats[0];u&&s?(T.p(this.getAbsoluteMatrix()),T.multiplyToRef(s,T)):T=this.getAbsoluteMatrix(),G.x=T.m[12],G.y=T.m[13],G.z=T.m[14]}}getAbsolutePosition(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const G=T.q.Zero();return this.getPositionToRef(1,u,G),G}getAbsolutePositionToRef(u,G){this.getPositionToRef(1,u,G)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ij.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Ij);const u=this._skeleton.getPoseMatrix();u&&this._absoluteMatrix.multiplyToRef(u,this._absoluteMatrix)}const u=this.children,G=u.length;for(let s=0;s<G;s++)u[s].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}$d(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.q.Zero();return this.getDirectionToRef(u,G,s),s}getDirectionToRef(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,z=null;G&&(z=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=m._TmpMats[0];O.p(this.getAbsoluteMatrix()),G&&z&&O.multiplyToRef(z,O),T.q.TransformNormalToRef(u,O,s),s.normalize()}getRotation(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.q.Zero();return this.getRotationToRef(u,G,s),s}getRotationToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const T=m._TmpQuat;this.getRotationQuaternionToRef(u,G,T),T.toEulerAnglesToRef(s)}getRotationQuaternion(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.h.Identity();return this.getRotationQuaternionToRef(u,G,s),s}getRotationQuaternionToRef(){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),G.p(this._localRotation);else{const s=m._TmpMats[0],T=this.getAbsoluteMatrix();u?T.multiplyToRef(u.getWorldMatrix(),s):s.p(T),s.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyAtIndex(1,this._scalingDeterminant),s.multiplyAtIndex(2,this._scalingDeterminant),s.decompose(void 0,G,void 0)}}getRotationMatrix(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1?arguments[1]:void 0;const s=T.d.Identity();return this.getRotationMatrixToRef(u,G,s),s}getRotationMatrixToRef(){let u=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(G);else{const s=m._TmpMats[0],T=this.getAbsoluteMatrix();u?T.multiplyToRef(u.getWorldMatrix(),s):s.p(T),s.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyAtIndex(1,this._scalingDeterminant),s.multiplyAtIndex(2,this._scalingDeterminant),s.getRotationMatrixToRef(G)}}getAbsolutePositionFromLocal(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.q.Zero();return this.getAbsolutePositionFromLocalToRef(u,G,s),s}getAbsolutePositionFromLocalToRef(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,z=null;G&&(z=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=m._TmpMats[0];O.p(this.getAbsoluteMatrix()),G&&z&&O.multiplyToRef(z,O),T.q.TransformCoordinatesToRef(u,O,s)}getLocalPositionFromAbsolute(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=T.q.Zero();return this.getLocalPositionFromAbsoluteToRef(u,G,s),s}getLocalPositionFromAbsoluteToRef(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,z=null;G&&(z=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=m._TmpMats[0];O.p(this.getAbsoluteMatrix()),G&&z&&O.multiplyToRef(z,O),O.invert(),T.q.TransformCoordinatesToRef(u,O,s)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}m._TmpVecs=(0,z.c)(2,T.q.Zero),m._TmpQuat=T.h.Identity(),m._TmpMats=(0,z.c)(5,T.d.Identity)},10961:(u,G,s)=>{"use strict";s.d(G,{b:()=>O,f:()=>m});var T=s(10969),z=s(10584);class O{get u(){return this._isDisposed}constructor(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,u&&u.va?this._engine=u.va().getEngine():this._engine=u,this._updatable=s,this._instanced=m,this._divisor=C||1,this._label=x,G instanceof T.e?(this._data=null,this._buffer=G):(this._data=G,this._buffer=null),this.byteStride=f?z:z*Float32Array.BYTES_PER_ELEMENT,O||this.create()}createVertexBuffer(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const C=O?G:G*Float32Array.BYTES_PER_ELEMENT,x=T?O?T:T*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,u,this._updatable,!0,x,void 0===z?this._instanced:z,C,s,void 0,void 0,!0,this._divisor||f)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!u&&this._buffer||(u=u||this._data,u&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,u),this._data=u):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(u,this._label),this._data=u):this._buffer=this._engine.createVertexBuffer(u,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Aj>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Aj,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Aj,void 0,this._label));z.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(u){this.create(u)}updateDirectly(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,u,T?G:G*Float32Array.BYTES_PER_ELEMENT,s?s*this.byteStride:void 0),this._data=0===G&&void 0===s?u:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class m{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(u){const G=0!=u;this._instanceDivisor=u,G!==this._instanced&&(this._instanced=G,this._computeHashCode())}get _maxVerticesCount(){const u=this.getData();return u?Array.isArray(u)?u.length/(this.byteStride/4)-this.byteOffset/4:(u.byteLength-this.byteOffset)/this.byteStride:0}constructor(u,G,s,T,z,f,C,x,g,b){let Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]&&arguments[11],n=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let F=!1;if(this.jd=u,"object"===typeof T&&null!==T?(F=T.updatable??!1,z=T.postponeInternalCreation,f=T.stride,C=T.instanced,x=T.offset,g=T.size,b=T.type,Q=T.normalized??!1,Y=T.useBytes??!1,n=T.divisor??1,V=T.takeBufferOwnership??!1,this._label=T.label):F=!!T,G instanceof O?(this._buffer=G,this._ownsBuffer=V):(this._buffer=new O(u,G,F,f,z,C,Y,n,this._label),this._ownsBuffer=!0),this.uniqueId=m._Counter++,this._kind=s,void 0===b){const u=this.getData();this.type=u?m.GetDataType(u):m.FLOAT}else this.type=b;const r=m.GetTypeByteLength(this.type);Y?(this._size=g||(f?f/r:m.DeduceStride(s)),this.byteStride=f||this._buffer.byteStride||this._size*r,this.byteOffset=x||0):(this._size=g||f||m.DeduceStride(s),this.byteStride=f?f*r:this._buffer.byteStride||this._size*r,this.byteOffset=(x||0)*r),this.normalized=Q,this._instanced=void 0!==C&&C,this._instanceDivisor=C?n:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var u;null===(u=this._buffer)||void 0===u||u._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(u,G){const s=this.getData();return s?m.GetFloatData(s,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,u,G):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/m.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/m.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*m.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(u){this._buffer.create(u),this._alignBuffer()}update(u){this._buffer.update(u),this._alignBuffer()}updateDirectly(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(u,G,void 0,s),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(u,G){m.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,u,this.normalized,G)}_alignBuffer(){}static DeduceStride(u){switch(u){case m.UVKind:case m.UV2Kind:case m.UV3Kind:case m.UV4Kind:case m.UV5Kind:case m.UV6Kind:return 2;case m.NormalKind:case m.PositionKind:return 3;case m.ColorKind:case m.ColorInstanceKind:case m.MatricesIndicesKind:case m.MatricesIndicesExtraKind:case m.MatricesWeightsKind:case m.MatricesWeightsExtraKind:case m.TangentKind:return 4;default:throw new Error("Invalid kind '"+u+"'")}}static GetDataType(u){return u instanceof Int8Array?m.BYTE:u instanceof Uint8Array?m.UNSIGNED_BYTE:u instanceof Int16Array?m.SHORT:u instanceof Uint16Array?m.UNSIGNED_SHORT:u instanceof Int32Array?m.INT:u instanceof Uint32Array?m.UNSIGNED_INT:m.FLOAT}static GetTypeByteLength(u){switch(u){case m.BYTE:case m.UNSIGNED_BYTE:return 1;case m.SHORT:case m.UNSIGNED_SHORT:return 2;case m.INT:case m.UNSIGNED_INT:case m.FLOAT:return 4;default:throw new Error(`Invalid type '${u}'`)}}static ForEach(u,G,s,T,z,O,f,C){if(u instanceof Array){let z=G/4;const m=s/4;for(let G=0;G<O;G+=T){for(let s=0;s<T;s++)C(u[z+s],G+s);z+=m}}else{const x=u instanceof ArrayBuffer?new DataView(u):new DataView(u.buffer,u.byteOffset,u.byteLength),g=m.GetTypeByteLength(z);for(let u=0;u<O;u+=T){let O=G;for(let G=0;G<T;G++){C(m._GetFloatValue(x,z,O,f),u+G),O+=g}G+=s}}}static _GetFloatValue(u,G,s,T){switch(G){case m.BYTE:{let G=u.getInt8(s);return T&&(G=Math.max(G/127,-1)),G}case m.UNSIGNED_BYTE:{let G=u.getUint8(s);return T&&(G/=255),G}case m.SHORT:{let G=u.getInt16(s,!0);return T&&(G=Math.max(G/32767,-1)),G}case m.UNSIGNED_SHORT:{let G=u.getUint16(s,!0);return T&&(G/=65535),G}case m.INT:return u.getInt32(s,!0);case m.UNSIGNED_INT:return u.getUint32(s,!0);case m.FLOAT:return u.getFloat32(s,!0);default:throw new Error(`Invalid component type ${G}`)}}static GetFloatData(u,G,s,T,O,f,C,x){const g=G*m.GetTypeByteLength(s),b=C*G;if(s!==m.FLOAT||O!==g){const z=new Float32Array(b);return m.ForEach(u,T,O,G,s,b,f,((u,G)=>z[G]=u)),z}if(!(u instanceof Array||u instanceof Float32Array)||0!==T||u.length!==b){if(u instanceof Array){const G=T/4;return u.slice(G,G+b)}if(u instanceof ArrayBuffer)return new Float32Array(u,T,b);{const G=u.byteOffset+T;if(0!==(3&G)&&(z.d.Warn("Float array must be aligned to 4-bytes border"),x=!0),x){const s=new Uint8Array(b*Float32Array.BYTES_PER_ELEMENT),T=new Uint8Array(u.buffer,G,s.length);return s.set(T),new Float32Array(s.buffer)}return new Float32Array(u.buffer,G,b)}}return x?u.slice():u}}m._Counter=0,m.BYTE=5120,m.UNSIGNED_BYTE=5121,m.SHORT=5122,m.UNSIGNED_SHORT=5123,m.INT=5124,m.UNSIGNED_INT=5125,m.FLOAT=5126,m.PositionKind="position",m.NormalKind="normal",m.TangentKind="tangent",m.UVKind="uv",m.UV2Kind="uv2",m.UV3Kind="uv3",m.UV4Kind="uv4",m.UV5Kind="uv5",m.UV6Kind="uv6",m.ColorKind="color",m.ColorInstanceKind="instanceColor",m.MatricesIndicesKind="matricesIndices",m.MatricesWeightsKind="matricesWeights",m.MatricesIndicesExtraKind="matricesIndicesExtra",m.MatricesWeightsExtraKind="matricesWeightsExtra"},10969:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{get underlyingResource(){return null}constructor(){this.references=0,this.Aj=0,this.is32Bits=!1,this.uniqueId=T._Counter++}}T._Counter=0},12277:(u,G,s)=>{"use strict";s.d(G,{d:()=>R});var T=s(10863),z=s(10866),O=s(10568),m=s(10904),f=s(11161),C=s(11148),x=s(10991),g=s(10601),b=s(10913);class Q{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(u){this._idleRotationSpeed=u}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(u){this._idleRotationWaitTime=u}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(u){this._idleRotationSpinupTime=u}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(u){this._attachedCamera=u;const G=this._attachedCamera.va();this._onPrePointerObservableObserver=G.onPrePointerObservable.add((u=>{u.type!==x.d.POINTERDOWN?u.type===x.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const u=g.e.Now;let G=0;null!=this._lastFrameTime&&(G=u-this._lastFrameTime),this._lastFrameTime=u,this._applyUserInteraction();const s=u-this._lastInteractionTime-this._idleRotationWaitTime,T=Math.max(Math.min(s/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*T,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(G/1e3))}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.va();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(u){this._lastInteractionTime=u??g.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<b.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let u=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(u=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?u:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=g.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}s(11382);class Y{constructor(){this._easingMode=Y.EASINGMODE_EASEIN}setEasingMode(u){const G=Math.min(Math.max(u,0),2);this._easingMode=G}getEasingMode(){return this._easingMode}easeInCore(u){throw new Error("You must implement this method")}ease(u){switch(this._easingMode){case Y.EASINGMODE_EASEIN:return this.easeInCore(u);case Y.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-u)}return u>=.5?.5*(1-this.easeInCore(2*(1-u)))+.5:.5*this.easeInCore(2*u)}}Y.EASINGMODE_EASEIN=0,Y.EASINGMODE_EASEOUT=1,Y.EASINGMODE_EASEINOUT=2;var n=s(11838);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(u){if(this._autoTransitionRange===u)return;this._autoTransitionRange=u;const G=this._attachedCamera;G&&(u?this._onMeshTargetChangedObserver=G.onMeshTargetChangedObservable.add((u=>{if(u&&(u.Gj(!0),u.getBoundingInfo)){const G=u.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*G,this.upperRadiusTransitionRange=.05*G}})):this._onMeshTargetChangedObserver&&G.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(u){this._attachedCamera=u,this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(u){return!!this._attachedCamera&&(this._attachedCamera.i===u&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(u){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=n.b.CreateAnimation("i",n.b.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const G=n.b.TransitionTo("i",this._attachedCamera.i+u,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));G&&this._animatables.push(G)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new class extends Y{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=u}easeInCore(u){const G=Math.max(0,this.amplitude);return Math.pow(u,3)-u*G*Math.sin(3.141592653589793*u)}}(.3),V.EasingMode=Y.EASINGMODE_EASEOUT;class F{constructor(){this.onTargetFramingAnimationEndObservable=new O.e,this._mode=F.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(u){this._mode=u}get mode(){return this._mode}set radiusScale(u){this._radiusScale=u}get radiusScale(){return this._radiusScale}set positionScale(u){this._positionScale=u}get positionScale(){return this._positionScale}set defaultElevation(u){this._defaultElevation=u}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(u){this._elevationReturnTime=u}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(u){this._elevationReturnWaitTime=u}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(u){this._framingTime=u}get framingTime(){return this._framingTime}init(){}attach(u){this._attachedCamera=u;const G=this._attachedCamera.va();F.EasingFunction.setEasingMode(F.EasingMode),this._onPrePointerObservableObserver=G.onPrePointerObservable.add((u=>{u.type!==x.d.POINTERDOWN?u.type===x.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((u=>{u&&u.getBoundingInfo&&this.zoomOnMesh(u,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.va();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u.Gj(!0);const T=u.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(T.minimumWorld,T.maximumWorld,G,s)}zoomOnMeshHierarchy(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u.Gj(!0);const T=u.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(T.min,T.max,G,s)}zoomOnMeshesHierarchy(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new m.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new m.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let O=0;O<u.length;O++){const G=u[O].getHierarchyBoundingVectors(!0);m.q.CheckExtends(G.min,T,z),m.q.CheckExtends(G.max,T,z)}this.zoomOnBoundingInfo(T,z,G,s)}zoomOnBoundingInfo(u,G){let s,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const O=u.y,f=O+(G.y-O)*this._positionScale,C=G.Nc(u).scale(.5);if(T)s=new m.q(0,f,0);else{const G=u.add(C);s=new m.q(G.x,f,G.z)}this._vectorTransition||(this._vectorTransition=n.b.CreateAnimation("target",n.b.ANIMATIONTYPE_VECTOR3,60,F.EasingFunction)),this._betaIsAnimating=!0;let x=n.b.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);x&&this._animatables.push(x);let g=0;if(this._mode===F.FitFrustumSidesMode){const s=this._calculateLowerRadiusFromModelBoundingSphere(u,G);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.Mi),g=s}else this._mode===F.IgnoreBoundsSizeMode&&(g=this._calculateLowerRadiusFromModelBoundingSphere(u,G),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Mi));if(this.autoCorrectCameraLimitsAndSensibility){const s=G.Nc(u).length();this._attachedCamera.panningSensibility=5e3/s,this._attachedCamera.wheelPrecision=100/g}return this._radiusTransition||(this._radiusTransition=n.b.CreateAnimation("i",n.b.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),x=n.b.TransitionTo("i",g,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),z&&z(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),x&&this._animatables.push(x),!0}_calculateLowerRadiusFromModelBoundingSphere(u,G){const s=this._attachedCamera;if(!s)return 0;let T=s._calculateLowerRadiusFromModelBoundingSphere(u,G,this._radiusScale);return s.lowerRadiusLimit&&this._mode===F.IgnoreBoundsSizeMode&&(T=T<s.lowerRadiusLimit?s.lowerRadiusLimit:T),s.upperRadiusLimit&&(T=T>s.upperRadiusLimit?s.upperRadiusLimit:T),T}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const u=g.e.Now-this._lastInteractionTime,G=.5*Math.PI-this._defaultElevation,s=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>s&&u>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=n.b.CreateAnimation("beta",n.b.ANIMATIONTYPE_FLOAT,60,F.EasingFunction));const u=n.b.TransitionTo("beta",G,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));u&&this._animatables.push(u)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=g.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}F.EasingFunction=new class extends Y{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=u}easeInCore(u){return this.exponent<=0?u:(Math.exp(this.exponent*u)-1)/(Math.exp(this.exponent)-1)}},F.EasingMode=Y.EASINGMODE_EASEINOUT,F.IgnoreBoundsSizeMode=0,F.FitFrustumSidesMode=1;var r=s(11154),c=s(11822),j=s(11828),l=s(10564);class P{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(u){u=l.e.BackCompatCameraNoPreventDefault(arguments);const G=this.camera.getEngine(),s=G.getInputElement();let T=0,z=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=O=>{var m,f;const C=O.event,g="touch"===C.pointerType;if(O.type!==x.d.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const b=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,G.isPointerLock){const u=C.movementX,G=C.movementY;this.onTouch(null,u,G),this._pointA=null,this._pointB=null}else{if(O.type!==x.d.POINTERDOWN&&O.type!==x.d.POINTERDOUBLETAP&&g&&(null===(m=this._pointA)||void 0===m?void 0:m.pointerId)!==C.pointerId&&(null===(f=this._pointB)||void 0===f?void 0:f.pointerId)!==C.pointerId)return;if(O.type!==x.d.POINTERDOWN||-1!==this._currentActiveButton&&!g)if(O.type===x.d.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(O.type!==x.d.POINTERUP||this._currentActiveButton!==C.button&&!g){if(O.type===x.d.POINTERMOVE)if(u||C.preventDefault(),this._pointA&&null===this._pointB){const u=C.clientX-this._pointA.x,G=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,u,G)}else if(this._pointA&&this._pointB){const u=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;u.x=C.clientX,u.y=C.clientY;const G=this._pointA.x-this._pointB.x,s=this._pointA.y-this._pointB.y,m=G*G+s*s,f={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:O.type};this.onMultiTouch(this._pointA,this._pointB,T,m,z,f),z=f,T=m}}else{try{null===b||void 0===b||b.releasePointerCapture(C.pointerId)}catch(Q){}g||(this._pointB=null),G._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==T||z)&&(this.onMultiTouch(this._pointA,this._pointB,T,0,z,null),T=0,z=null),this._currentActiveButton=-1,this.onButtonUp(C),u||C.preventDefault()}else{try{null===b||void 0===b||b.setPointerCapture(C.pointerId)}catch(Q){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentActiveButton||g||(this._currentActiveButton=C.button),this.onButtonDown(C),u||(C.preventDefault(),s&&s.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,x.d.POINTERDOWN|x.d.POINTERUP|x.d.POINTERMOVE|x.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,T=0,z=null,this.onLostFocus()},this._contextMenuBind=u=>this.onContextMenu(u),s&&s.addEventListener("contextmenu",this._contextMenuBind,!1);const O=this.camera.va().getEngine().getHostWindow();O&&l.e.RegisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])}Ii(){if(this._onLostFocus){const u=this.camera.va().getEngine().getHostWindow();u&&l.e.UnregisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const u=this.camera.va().getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(u){}onTouch(u,G,s){}onMultiTouch(u,G,s,T,z,O){}onContextMenu(u){u.preventDefault()}onButtonDown(u){}onButtonUp(u){}onLostFocus(){}}(0,T.b)([(0,z.M)()],P.prototype,"buttons",void 0);class H extends P{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(u,G){if(0!==this.panningSensibility&&u&&G){const s=G.x-u.x,T=G.y-u.y;this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility}}_computePinchZoom(u,G){const s=this.camera.i||H.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=s*Math.sqrt(u)/Math.sqrt(G):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(G-u)*s*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(G-u)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(u,G,s){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility):(this.camera.inertialAlphaOffset-=G/this.angularSensibilityX,this.camera.inertialBetaOffset-=s/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(u,G,s,T,z,O){0===s&&null===z||0===T&&null===O||(this.multiTouchPanAndZoom?(this._computePinchZoom(s,T),this._computeMultiTouchPanning(z,O)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(T)-Math.sqrt(s))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(s,T),this._isPinching=!0):this._computeMultiTouchPanning(z,O)):this.multiTouchPanning?this._computeMultiTouchPanning(z,O):this.pinchZoom&&this._computePinchZoom(s,T))}onButtonDown(u){this._isPanClick=u.button===this.camera._panningMouseButton}onButtonUp(u){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}H.MinimumRadiusForPinch=.001,(0,T.b)([(0,z.M)()],H.prototype,"buttons",void 0),(0,T.b)([(0,z.M)()],H.prototype,"angularSensibilityX",void 0),(0,T.b)([(0,z.M)()],H.prototype,"angularSensibilityY",void 0),(0,T.b)([(0,z.M)()],H.prototype,"pinchPrecision",void 0),(0,T.b)([(0,z.M)()],H.prototype,"pinchDeltaPercentage",void 0),(0,T.b)([(0,z.M)()],H.prototype,"useNaturalPinchZoom",void 0),(0,T.b)([(0,z.M)()],H.prototype,"pinchZoom",void 0),(0,T.b)([(0,z.M)()],H.prototype,"panningSensibility",void 0),(0,T.b)([(0,z.M)()],H.prototype,"multiTouchPanning",void 0),(0,T.b)([(0,z.M)()],H.prototype,"multiTouchPanAndZoom",void 0),j.c.ArcRotateCameraPointersInput=H;var X=s(11e3);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(u){u=l.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((G=>{const s=G.event;if(!s.metaKey)if(G.type===X.d.KEYDOWN){if(this._ctrlPressed=s.ctrlKey,this._altPressed=s.altKey,-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode)){-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),s.preventDefault&&(u||s.preventDefault())}}else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode)){const G=this._keys.indexOf(s.keyCode);G>=0&&this._keys.splice(G,1),s.preventDefault&&(u||s.preventDefault())}})))}Ii(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const u=this.camera;for(let G=0;G<this._keys.length;G++){const s=this._keys[G];-1!==this.keysLeft.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX-=1/this.panningSensibility:u.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset+=1/this.zoomingSensibility:u.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX+=1/this.panningSensibility:u.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset-=1/this.zoomingSensibility:u.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(s)&&u.useInputToRestoreState&&u.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,T.b)([(0,z.M)()],p.prototype,"keysUp",void 0),(0,T.b)([(0,z.M)()],p.prototype,"keysDown",void 0),(0,T.b)([(0,z.M)()],p.prototype,"keysLeft",void 0),(0,T.b)([(0,z.M)()],p.prototype,"keysRight",void 0),(0,T.b)([(0,z.M)()],p.prototype,"keysReset",void 0),(0,T.b)([(0,z.M)()],p.prototype,"panningSensibility",void 0),(0,T.b)([(0,z.M)()],p.prototype,"zoomingSensibility",void 0),(0,T.b)([(0,z.M)()],p.prototype,"useAltToZoom",void 0),(0,T.b)([(0,z.M)()],p.prototype,"angularSpeed",void 0),j.c.ArcRotateCameraKeyboardMoveInput=p;var q=s(11018),d=s(11002),v=s(10924);class W{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new m.q(0,0,0),this._globalOffset=new m.q(0,0,0),this._inertialPanning=m.q.Zero()}_computeDeltaFromMouseWheelLegacyEvent(u,G){let s=0;const T=.01*u*this.wheelDeltaPercentage*G;return s=u>0?T/(1+this.wheelDeltaPercentage):T*(1+this.wheelDeltaPercentage),s}attachControl(u){u=l.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=G=>{if(G.type!==x.d.POINTERWHEEL)return;const s=G.event;let T=0;const z=s.deltaMode===d.e.DOM_DELTA_LINE?40:1,O=-s.deltaY*z;if(this.customComputeDeltaFromMouseWheel)T=this.customComputeDeltaFromMouseWheel(O,this,s);else if(this.wheelDeltaPercentage){if(T=this._computeDeltaFromMouseWheelLegacyEvent(O,this.camera.i),T>0){let u=this.camera.i,G=this.camera.inertialRadiusOffset+T;for(let s=0;s<20&&Math.abs(G)>.001;s++)u-=G,G*=this.camera.inertia;u=(0,v.b)(u,0,Number.MAX_VALUE),T=this._computeDeltaFromMouseWheelLegacyEvent(O,u)}}else T=O/(40*this.wheelPrecision);T&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(T)):this.camera.inertialRadiusOffset+=T),s.preventDefault&&(u||s.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,x.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.vj(0)}Ii(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const u=this.camera;0+u.inertialAlphaOffset+u.inertialBetaOffset+u.inertialRadiusOffset&&(this._updateHitPlane(),u.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(u.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const u=this.camera,G=u.target.Nc(u.position);this._hitPlane=q.d.FromPositionAndNormal(u.target,G)}_getPosition(){const u=this.camera,G=u.va(),s=G.createPickingRay(G.pointerX,G.pointerY,m.d.Identity(),u,!1);0===u.targetScreenOffset.x&&0===u.targetScreenOffset.y||(this._viewOffset.set(u.targetScreenOffset.x,u.targetScreenOffset.y,0),u.getViewMatrix().invertToRef(u._cameraTransformMatrix),this._globalOffset=m.q.TransformNormal(this._viewOffset,u._cameraTransformMatrix),s.origin.addInPlace(this._globalOffset));let T=0;return this._hitPlane&&(T=s.intersectsPlane(this._hitPlane)??0),s.origin.addInPlace(s.direction.scaleInPlace(T))}_zoomToMouse(u){const G=this.camera,s=1-G.inertia;if(G.lowerRadiusLimit){const T=G.lowerRadiusLimit??0;G.i-(G.inertialRadiusOffset+u)/s<T&&(u=(G.i-T)*s-G.inertialRadiusOffset)}if(G.upperRadiusLimit){const T=G.upperRadiusLimit??0;G.i-(G.inertialRadiusOffset+u)/s>T&&(u=(G.i-T)*s-G.inertialRadiusOffset)}const T=u/s/G.i,z=this._getPosition(),O=m.l.gb[6];z.subtractToRef(G.target,O),O.scaleInPlace(T),O.scaleInPlace(s),this._inertialPanning.addInPlace(O),G.inertialRadiusOffset+=u}_zeroIfClose(u){Math.abs(u.x)<b.e&&(u.x=0),Math.abs(u.y)<b.e&&(u.y=0),Math.abs(u.z)<b.e&&(u.z=0)}}(0,T.b)([(0,z.M)()],W.prototype,"wheelPrecision",void 0),(0,T.b)([(0,z.M)()],W.prototype,"zoomToMouseLocation",void 0),(0,T.b)([(0,z.M)()],W.prototype,"wheelDeltaPercentage",void 0),j.c.ArcRotateCameraMouseWheelInput=W;class M extends j.e{constructor(u){super(u)}addMouseWheel(){return this.add(new W),this}addPointers(){return this.add(new H),this}addKeyboard(){return this.add(new p),this}}var o=s(10715);f.b.AddNodeConstructor("ArcRotateCamera",((u,G)=>()=>new R(u,0,0,1,m.q.Zero(),G)));class R extends c.b{get target(){return this._target}set target(u){this.setTarget(u)}get targetHost(){return this._targetHost}set targetHost(u){u&&this.setTarget(u)}getTarget(){return this.target}get position(){return this._position}set position(u){this.setPosition(u)}set upVector(u){this._upToYMatrix||(this._yToUpMatrix=new m.d,this._upToYMatrix=new m.d,this._upVector=m.q.Zero()),u.normalize(),this._upVector.p(u),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){m.d.RotationAlignToRef(m.q.UpReadOnly,this._upVector,this._yToUpMatrix),m.d.RotationAlignToRef(this._upVector,m.q.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const u=this.inputs.attached.pointers;return u?u.angularSensibilityX:0}set angularSensibilityX(u){const G=this.inputs.attached.pointers;G&&(G.angularSensibilityX=u)}get angularSensibilityY(){const u=this.inputs.attached.pointers;return u?u.angularSensibilityY:0}set angularSensibilityY(u){const G=this.inputs.attached.pointers;G&&(G.angularSensibilityY=u)}get pinchPrecision(){const u=this.inputs.attached.pointers;return u?u.pinchPrecision:0}set pinchPrecision(u){const G=this.inputs.attached.pointers;G&&(G.pinchPrecision=u)}get pinchDeltaPercentage(){const u=this.inputs.attached.pointers;return u?u.pinchDeltaPercentage:0}set pinchDeltaPercentage(u){const G=this.inputs.attached.pointers;G&&(G.pinchDeltaPercentage=u)}get useNaturalPinchZoom(){const u=this.inputs.attached.pointers;return!!u&&u.useNaturalPinchZoom}set useNaturalPinchZoom(u){const G=this.inputs.attached.pointers;G&&(G.useNaturalPinchZoom=u)}get panningSensibility(){const u=this.inputs.attached.pointers;return u?u.panningSensibility:0}set panningSensibility(u){const G=this.inputs.attached.pointers;G&&(G.panningSensibility=u)}get keysUp(){const u=this.inputs.attached.keyboard;return u?u.keysUp:[]}set keysUp(u){const G=this.inputs.attached.keyboard;G&&(G.keysUp=u)}get keysDown(){const u=this.inputs.attached.keyboard;return u?u.keysDown:[]}set keysDown(u){const G=this.inputs.attached.keyboard;G&&(G.keysDown=u)}get keysLeft(){const u=this.inputs.attached.keyboard;return u?u.keysLeft:[]}set keysLeft(u){const G=this.inputs.attached.keyboard;G&&(G.keysLeft=u)}get keysRight(){const u=this.inputs.attached.keyboard;return u?u.keysRight:[]}set keysRight(u){const G=this.inputs.attached.keyboard;G&&(G.keysRight=u)}get wheelPrecision(){const u=this.inputs.attached.mousewheel;return u?u.wheelPrecision:0}set wheelPrecision(u){const G=this.inputs.attached.mousewheel;G&&(G.wheelPrecision=u)}get zoomToMouseLocation(){const u=this.inputs.attached.mousewheel;return!!u&&u.zoomToMouseLocation}set zoomToMouseLocation(u){const G=this.inputs.attached.mousewheel;G&&(G.zoomToMouseLocation=u)}get wheelDeltaPercentage(){const u=this.inputs.attached.mousewheel;return u?u.wheelDeltaPercentage:0}set wheelDeltaPercentage(u){const G=this.inputs.attached.mousewheel;G&&(G.wheelDeltaPercentage=u)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(u){u!==this.useBouncingBehavior&&(u?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(u){u!==this.useFramingBehavior&&(u?(this._framingBehavior=new F,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(u){u!==this.useAutoRotationBehavior&&(u?(this._autoRotationBehavior=new Q,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(u,G,s,T,z,f){var C;let x=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(u,m.q.Zero(),f,x),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=m.q.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=m.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new m.d,this.panningAxis=new m.q(1,1,0),this._transformedDirection=new m.q,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new O.e,this.checkCollisions=!1,this.collisionRadius=new m.q(.5,.5,.5),this._previousPosition=m.q.Zero(),this._collisionVelocity=m.q.Zero(),this._newPosition=m.q.Zero(),this._computationVector=m.q.Zero(),this._onCollisionPositionChange=function(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s?(C.setPosition(G),C.Ck&&C.Ck(s)):C._previousPosition.p(C._position);const T=Math.cos(C.alpha),z=Math.sin(C.alpha),O=Math.cos(C.beta);let m=Math.sin(C.beta);0===m&&(m=1e-4);const f=C._getTargetPosition();C._computationVector.hf(C.i*T*m,C.i*O,C.i*z*m),f.addToRef(C._computationVector,C._newPosition),C._position.p(C._newPosition);let x=C.upVector;C.allowUpsideDown&&C.beta<0&&(x=x.clone(),x=x.negate()),C._computeViewMatrix(C._position,f,x),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=m.q.Zero(),z&&this.setTarget(z),this.alpha=G,this.beta=s,this.i=T,this.getViewMatrix(),this.inputs=new M(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new m.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=m.m.Zero()}_updateCache(u){u||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const u=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?u.addToRef(this._targetBoundingCenter,this._target):this._target.p(u)}const u=this._getLockedTargetPosition();return u||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>b.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const z=arguments;G=l.e.BackCompatCameraNoPreventDefault(z),this._useCtrlForPanning=s,this._panningMouseButton=T,"boolean"===typeof z[0]&&(z.length>1&&(this._useCtrlForPanning=z[1]),z.length>2&&(this._panningMouseButton=z[2])),this.inputs.attachElement(G),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ii(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const u=this._scene.getEngine().getDeltaTime()/1e3,G=1-Math.pow(2,-u/this.restoreStateInterpolationFactor);this.setTarget(m.q.Lerp(this.getTarget(),this._storedTarget,G)),m.h.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,m.l.Quaternion[0]),m.h.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,m.l.Quaternion[1]),m.h.SlerpToRef(m.l.Quaternion[1],m.l.Quaternion[0],G,m.l.Quaternion[2]),m.l.Quaternion[2].normalize(),m.l.Quaternion[2].toAlphaBetaGammaToRef(m.l.gb[0]),this.alpha=m.l.gb[0].x,this.beta=m.l.gb[0].y,this.i+=(this._storedRadius-this.i)*G,m.m.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,G,this.targetScreenOffset),(m.q.DistanceSquared(this.getTarget(),this._storedTarget)<b.e&&m.l.Quaternion[2].equalsWithEpsilon(m.l.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<b.e&&m.m.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<b.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const u=this.invertRotation?-1:1,G=this._calculateHandednessMultiplier();let s=this.inertialAlphaOffset*G;this.beta<0&&(s*=-1),this.alpha+=s*u,this.beta+=this.inertialBetaOffset*u,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*b.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const u=new m.q(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),m.q.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const u=this.upVector,G=m.q.CrossToRef(this._transformedDirection,u,this._transformedDirection);m.q.CrossToRef(u,G,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);m.q.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const u=m.l.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.transposeToRef(u),m.q.TransformCoordinatesToRef(this._transformedDirection,u,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*b.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*b.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.q.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const u=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const G=Math.round((u-this.alpha)/(2*Math.PI));this.alpha+=2*G*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(u){this._position.equals(u)||(this._position.p(u),this.rebuildAnglesAndRadius())}setTarget(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(T=this.overrideCloneAlphaBetaRadius??T,u.Gj)G&&u.getBoundingInfo?this._targetBoundingCenter=u.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,u.Gj(),this._targetHost=u,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const G=u,T=this._getTargetPosition();if(T&&!s&&T.equals(G))return;this._targetHost=null,this._target=G,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}T||this.rebuildAnglesAndRadius()}_getViewMatrix(){const u=Math.cos(this.alpha),G=Math.sin(this.alpha),s=Math.cos(this.beta);let T=Math.sin(this.beta);0===T&&(T=1e-4),0===this.i&&(this.i=1e-4);const z=this._getTargetPosition();if(this._computationVector.hf(this.i*u*T,this.i*s,this.i*G*T),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.q.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),z.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const u=this.va().collisionCoordinator;this._collider||(this._collider=u.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,u.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let u=this.upVector;this.allowUpsideDown&&T<0&&(u=u.negate()),this._computeViewMatrix(this._position,z,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=z,this._viewMatrix}zoomOn(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u=u||this.va().meshes;const s=C.c.MinMax(u);let T=this._calculateLowerRadiusFromModelBoundingSphere(s.min,s.max);T=Math.max(Math.min(T,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=T*this.zoomOnFactor,this.focusOn({min:s.min,max:s.max,distance:T},G)}focusOn(u){let G,s,T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===u.min){const T=u||this.va().meshes;G=C.c.MinMax(T),s=m.q.Distance(G.min,G.max)}else{G=u,s=u.distance}this._target=C.c.Center(G),T||(this.maxZ=2*s)}createRigCamera(u,G){let s=0;switch(this.cameraRigMode){case r.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.e.RIG_MODE_VR:s=this._cameraRigParams.stereoHalfAngle*(0===G?1:-1);break;case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:s=this._cameraRigParams.stereoHalfAngle*(0===G?-1:1)}const T=new R(u,this.alpha+s,this.beta,this.i,this._target,this.va());return T._cameraRigParams={},T.isRigCamera=!0,T.rigParent=this,T.upVector=this.upVector,T.mode=this.mode,T.orthoLeft=this.orthoLeft,T.orthoRight=this.orthoRight,T.orthoBottom=this.orthoBottom,T.orthoTop=this.orthoTop,T}_updateRigCameras(){const u=this._rigCameras[0],G=this._rigCameras[1];switch(u.beta=G.beta=this.beta,this.cameraRigMode){case r.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case r.e.RIG_MODE_VR:u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,G.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case r.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,G.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const T=m.q.Distance(u,G),z=this.va().getEngine().getAspectRatio(this),O=Math.tan(this.fov/2),f=O*z,C=.5*T*s,x=C*Math.sqrt(1+1/(f*f)),g=C*Math.sqrt(1+1/(O*O));return Math.max(x,g)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,T.b)([(0,z.M)()],R.prototype,"alpha",void 0),(0,T.b)([(0,z.M)()],R.prototype,"beta",void 0),(0,T.b)([(0,z.M)()],R.prototype,"i",void 0),(0,T.b)([(0,z.M)()],R.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,T.b)([(0,z.J)("target")],R.prototype,"_target",void 0),(0,T.b)([(0,z.v)("targetHost")],R.prototype,"_targetHost",void 0),(0,T.b)([(0,z.M)()],R.prototype,"inertialAlphaOffset",void 0),(0,T.b)([(0,z.M)()],R.prototype,"inertialBetaOffset",void 0),(0,T.b)([(0,z.M)()],R.prototype,"inertialRadiusOffset",void 0),(0,T.b)([(0,z.M)()],R.prototype,"lowerAlphaLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"upperAlphaLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"lowerBetaLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"upperBetaLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"lowerRadiusLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"upperRadiusLimit",void 0),(0,T.b)([(0,z.M)()],R.prototype,"inertialPanningX",void 0),(0,T.b)([(0,z.M)()],R.prototype,"inertialPanningY",void 0),(0,T.b)([(0,z.M)()],R.prototype,"pinchToPanMaxDistance",void 0),(0,T.b)([(0,z.M)()],R.prototype,"panningDistanceLimit",void 0),(0,T.b)([(0,z.J)()],R.prototype,"panningOriginTarget",void 0),(0,T.b)([(0,z.M)()],R.prototype,"panningInertia",void 0),(0,T.b)([(0,z.M)()],R.prototype,"zoomToMouseLocation",null),(0,T.b)([(0,z.M)()],R.prototype,"zoomOnFactor",void 0),(0,T.b)([(0,z.F)()],R.prototype,"targetScreenOffset",void 0),(0,T.b)([(0,z.M)()],R.prototype,"allowUpsideDown",void 0),(0,T.b)([(0,z.M)()],R.prototype,"useInputToRestoreState",void 0),(0,T.b)([(0,z.M)()],R.prototype,"restoreStateInterpolationFactor",void 0),(0,o.g)("BABYLON.ArcRotateCamera",R)},11154:(u,G,s)=>{"use strict";s.d(G,{e:()=>F});var T=s(10863),z=s(10866),O=s(10881),m=s(10564),f=s(10568),C=s(10904),x=s(11161),g=s(10584),b=s(10715),Q=s(10609),Y=s(11170),n=s(11013),V=s(10935);class F extends x.b{get position(){return this._position}set position(u){this._position=u}set upVector(u){this._upVector=u}get upVector(){return this._upVector}get screenArea(){let u=0,G=0;if(this.mode===F.PERSPECTIVE_CAMERA)this.fovMode===F.FOVMODE_VERTICAL_FIXED?(G=2*this.Mi*Math.tan(this.fov/2),u=this.getEngine().getAspectRatio(this)*G):(u=2*this.Mi*Math.tan(this.fov/2),G=u/this.getEngine().getAspectRatio(this));else{const s=this.getEngine().getRenderWidth()/2,T=this.getEngine().getRenderHeight()/2;u=(this.orthoRight??s)-(this.orthoLeft??-s),G=(this.orthoTop??T)-(this.orthoBottom??-T)}return u*G}set orthoLeft(u){this._orthoLeft=u;for(const G of this._rigCameras)G.orthoLeft=u}get orthoLeft(){return this._orthoLeft}set orthoRight(u){this._orthoRight=u;for(const G of this._rigCameras)G.orthoRight=u}get orthoRight(){return this._orthoRight}set orthoBottom(u){this._orthoBottom=u;for(const G of this._rigCameras)G.orthoBottom=u}get orthoBottom(){return this._orthoBottom}set orthoTop(u){this._orthoTop=u;for(const G of this._rigCameras)G.orthoTop=u}get orthoTop(){return this._orthoTop}set mode(u){this._mode=u;for(const G of this._rigCameras)G.mode=u}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(u,G,s){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(u,s,!1),this._position=C.q.Zero(),this._upVector=C.q.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Mi=1,this.maxZ=1e4,this.inertia=.9,this._mode=F.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new Y.b(0,0,1,1),this.layerMask=268435455,this.fovMode=F.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=F.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new f.e,this.onProjectionMatrixChangedObservable=new f.e,this.onAfterCheckInputsObservable=new f.e,this.onRestoreStateObservable=new f.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new C.d,this._postProcesses=new Array,this._activeMeshes=new O.e(256),this._globalPosition=C.q.Zero(),this._computedViewMatrix=C.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=C.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=C.h.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),T&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=G,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${u}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Zg"}toString(u){let G="Name: "+this.name;if(G+=", type: "+this.getClassName(),this.animations)for(let s=0;s<this.animations.length;s++)G+=", animation[0]: "+this.animations[s].toString(u);return G}applyVerticalCorrection(){const u=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-u.x:u.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(u){return-1!==this._activeMeshes.indexOf(u)}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(u)for(const G of this._postProcesses)if(G&&!G.isReady())return!1;return super.isReady(u)}_initCache(){super._initCache(),this._cache.position=new C.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new C.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Mi=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(u){u||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let u=this._cache.mode===this.mode&&this._cache.Mi===this.Mi&&this._cache.maxZ===this.maxZ;if(!u)return!1;const G=this.getEngine();return this.mode===F.PERSPECTIVE_CAMERA?u=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===G.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(u=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===G.getRenderWidth()&&this._cache.renderHeight===G.getRenderHeight(),this.oblique&&(u=u&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),u}attachControl(u,G){}Ii(u){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==F.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let u=0;u<this._postProcesses.length;u++)if(null!==this._postProcesses[u])return this._postProcesses[u];return null}_cascadePostProcessesToRigCams(){const u=this._getFirstPostProcess();u&&u.markTextureDirty();for(let G=0,s=this._rigCameras.length;G<s;G++){const u=this._rigCameras[G],s=u._rigPostProcess;if(s){"pass"===s.getEffectName()&&(u.isIntermediate=0===this._postProcesses.length),u._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()}else u._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!u.isReusable()&&this._postProcesses.indexOf(u)>-1?(g.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==G||G<0?this._postProcesses.push(u):null===this._postProcesses[G]?this._postProcesses[G]=u:this._postProcesses.splice(G,0,u),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.pg(),this._postProcesses.indexOf(u))}detachPostProcess(u){const G=this._postProcesses.indexOf(u);-1!==G&&(this._postProcesses[G]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.pg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return C.d.Identity()}getViewMatrix(u){return!u&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(u){this._doNotComputeProjectionMatrix=!0,void 0!==u&&(this._projectionMatrix=u)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(u){if(this._doNotComputeProjectionMatrix||!u&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Mi=this.Mi,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const G=this.getEngine(),s=this.va(),T=G.useReverseDepthBuffer;if(this.mode===F.PERSPECTIVE_CAMERA){let u;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=G.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Mi<=0&&(this.Mi=.1),u=s.useRightHandedSystem?C.d.PerspectiveFovRHToRef:C.d.PerspectiveFovLHToRef,u(this.fov,G.getAspectRatio(this),T?this.maxZ:this.Mi,T?this.Mi:this.maxZ,this._projectionMatrix,this.fovMode===F.FOVMODE_VERTICAL_FIXED,G.isNDCHalfZRange,this.projectionPlaneTilt,T)}else{var z,O,m;const u=G.getRenderWidth()/2,f=G.getRenderHeight()/2;s.useRightHandedSystem?this.oblique?C.d.ObliqueOffCenterRHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-f,this.orthoTop??f,T?this.maxZ:this.Mi,T?this.Mi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,G.isNDCHalfZRange):C.d.OrthoOffCenterRHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-f,this.orthoTop??f,T?this.maxZ:this.Mi,T?this.Mi:this.maxZ,this._projectionMatrix,G.isNDCHalfZRange):this.oblique?C.d.ObliqueOffCenterLHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-f,this.orthoTop??f,T?this.maxZ:this.Mi,T?this.Mi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,G.isNDCHalfZRange):C.d.OrthoOffCenterLHToRef(this.orthoLeft??-u,this.orthoRight??u,this.orthoBottom??-f,this.orthoTop??f,T?this.maxZ:this.Mi,T?this.Mi:this.maxZ,this._projectionMatrix,G.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(z=this.oblique)||void 0===z?void 0:z.angle,this._cache.obliqueLength=null===(O=this.oblique)||void 0===O?void 0:O.length,this._cache.obliqueOffset=null===(m=this.oblique)||void 0===m?void 0:m.offset,this._cache.renderWidth=G.getRenderWidth(),this._cache.renderHeight=G.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(u){return(this.i||(this.target?C.q.Distance(this.position,this.target):this.position.length()))+u}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?n.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=n.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),G&&this.rigCameras.length>0){let G=!1;return this.rigCameras.forEach((s=>{s._updateFrustumPlanes(),G=G||u.isInFrustum(s._frustumPlanes)})),G}return u.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(u){return this._updateFrustumPlanes(),u.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,Q.c)("Ray")}getForwardRayToRef(u){throw(0,Q.c)("Ray")}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this._parentContainer){const u=this._parentContainer.cameras.indexOf(this);u>-1&&this._parentContainer.cameras.splice(u,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==F.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let u=this._postProcesses.length;for(;--u>=0;){const G=this._postProcesses[u];G&&G.dispose(this)}}let s=this.customRenderTargets.length;for(;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(u,G)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(u,G){if(this.cameraRigMode!==u){for(;this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this.cameraRigMode=u,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=G.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=m.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==F.RIG_MODE_NONE){const u=this.createRigCamera(this.name+"_L",0);u&&(u._isLeftCamera=!0);const G=this.createRigCamera(this.name+"_R",1);G&&(G._isRightCamera=!0),u&&G&&(this._rigCameras.push(u),this._rigCameras.push(G))}this._setRigMode(G),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(u){}_getVRProjectionMatrix(){return C.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Mi,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(u,G){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[u]=G,"interaxialDistance"===u&&(this._cameraRigParams.stereoHalfAngle=m.e.ToRadians(G/.0637))}createRigCamera(u,G){return null}_updateRigCameras(){for(let u=0;u<this._rigCameras.length;u++)this._rigCameras[u].Mi=this.Mi,this._rigCameras[u].maxZ=this.maxZ,this._rigCameras[u].fov=this.fov,this._rigCameras[u].upVector.p(this.upVector);this.cameraRigMode===F.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const u=V.e.Serialize(this);return u.uniqueId=this.uniqueId,u.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(u),this.inputs&&this.inputs.serialize(u),V.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}clone(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=V.e.Clone(F.GetConstructorFromName(this.getClassName(),u,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return s.name=u,s.parent=G,this.onClonedObservable.notifyObservers(s),s}$d(u){const G=C.q.Zero();return this.getDirectionToRef(u,G),G}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(u,G){C.q.TransformNormalToRef(u,this.getWorldMatrix(),G)}static GetConstructorFromName(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const O=x.b.Construct(u,G,s,{interaxial_distance:T,isStereoscopicSideBySide:z});return O||(()=>F._CreateDefaultParsedCamera(G,s))}Gj(){return this.getWorldMatrix()}static Parse(u,G){const s=u.type,T=F.GetConstructorFromName(s,u.name,G,u.interaxial_distance,u.isStereoscopicSideBySide),z=V.e.Parse(T,u,G);if(void 0!==u.parentId&&(z._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(z._waitingParentInstanceIndex=u.parentInstanceIndex),z.inputs&&(z.inputs.parse(u),z._setupInputs()),u.upVector&&(z.upVector=C.q.Ag(u.upVector)),z.setPosition&&(z.position.hf(0,0,0),z.setPosition(C.q.Ag(u.position))),u.target&&z.setTarget&&z.setTarget(C.q.Ag(u.target)),u.cameraRigMode){const G=u.interaxial_distance?{interaxialDistance:u.interaxial_distance}:{};z.setCameraRigMode(u.cameraRigMode,G)}if(u.animations){for(let G=0;G<u.animations.length;G++){const s=u.animations[G],T=(0,b.e)("BABYLON.Animation");T&&z.animations.push(T.Parse(s))}x.b.ParseAnimationRanges(z,u,G)}return u.autoAnimate&&G.beginAnimation(z,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&z.Af(u.isEnabled),z}_calculateHandednessMultiplier(){let u=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(u*=-1),u}}F._CreateDefaultParsedCamera=(u,G)=>{throw(0,Q.c)("UniversalCamera")},F.PERSPECTIVE_CAMERA=0,F.ORTHOGRAPHIC_CAMERA=1,F.FOVMODE_VERTICAL_FIXED=0,F.FOVMODE_HORIZONTAL_FIXED=1,F.RIG_MODE_NONE=0,F.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,F.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,F.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,F.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,F.RIG_MODE_STEREOSCOPIC_INTERLACED=14,F.RIG_MODE_VR=20,F.RIG_MODE_CUSTOM=22,F.ForceAttachControlToAlwaysPreventDefault=!1,(0,T.b)([(0,z.J)("position")],F.prototype,"_position",void 0),(0,T.b)([(0,z.J)("upVector")],F.prototype,"_upVector",void 0),(0,T.b)([(0,z.M)()],F.prototype,"orthoLeft",null),(0,T.b)([(0,z.M)()],F.prototype,"orthoRight",null),(0,T.b)([(0,z.M)()],F.prototype,"orthoBottom",null),(0,T.b)([(0,z.M)()],F.prototype,"orthoTop",null),(0,T.b)([(0,z.M)()],F.prototype,"fov",void 0),(0,T.b)([(0,z.M)()],F.prototype,"projectionPlaneTilt",void 0),(0,T.b)([(0,z.M)()],F.prototype,"Mi",void 0),(0,T.b)([(0,z.M)()],F.prototype,"maxZ",void 0),(0,T.b)([(0,z.M)()],F.prototype,"inertia",void 0),(0,T.b)([(0,z.M)()],F.prototype,"mode",null),(0,T.b)([(0,z.M)()],F.prototype,"layerMask",void 0),(0,T.b)([(0,z.M)()],F.prototype,"fovMode",void 0),(0,T.b)([(0,z.M)()],F.prototype,"cameraRigMode",void 0),(0,T.b)([(0,z.M)()],F.prototype,"interaxialDistance",void 0),(0,T.b)([(0,z.M)()],F.prototype,"isStereoscopicSideBySide",void 0)},11828:(u,G,s)=>{"use strict";s.d(G,{c:()=>m,e:()=>f});var T=s(10584),z=s(10935),O=s(11154),m={};class f{constructor(u){this.attachedToElement=!1,this.attached={},this.camera=u,this.checkInputs=()=>{}}add(u){const G=u.getSimpleName();this.attached[G]?T.d.Warn("camera input of type "+G+" already exists on camera"):(this.attached[G]=u,u.camera=this.camera,u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u))),this.attachedToElement&&u.attachControl(this.noPreventDefault))}remove(u){for(const G in this.attached){const s=this.attached[G];if(s===u)return s.Ii(),s.camera=null,delete this.attached[G],void this.rebuildInputCheck()}}removeByType(u){for(const G in this.attached){const s=this.attached[G];s.getClassName()===u&&(s.Ii(),s.camera=null,delete this.attached[G],this.rebuildInputCheck())}}_addCheckInputs(u){const G=this.checkInputs;return()=>{G(),u()}}attachInput(u){this.attachedToElement&&u.attachControl(this.noPreventDefault)}attachElement(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){u=!O.e.ForceAttachControlToAlwaysPreventDefault&&u,this.attachedToElement=!0,this.noPreventDefault=u;for(const G in this.attached)this.attached[G].attachControl(u)}}detachElement(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const G in this.attached)this.attached[G].Ii(),u&&(this.attached[G].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const u in this.attached){const G=this.attached[u];G.checkInputs&&(this.checkInputs=this._addCheckInputs(G.checkInputs.bind(G)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(u){const G={};for(const s in this.attached){const u=this.attached[s],T=z.e.Serialize(u);G[u.getClassName()]=T}u.inputsmgr=G}parse(u){const G=u.inputsmgr;if(G){this.clear();for(const u in G){const s=m[u];if(s){const T=G[u],O=z.e.Parse((()=>new s),T,null);this.add(O)}}}else for(const s in this.attached){const G=m[this.attached[s].getClassName()];if(G){const T=z.e.Parse((()=>new G),u,null);this.remove(this.attached[s]),this.add(T)}}}}},11819:(u,G,s)=>{"use strict";s.d(G,{d:()=>H});var T=s(10863),z=s(10866),O=s(10904),m=s(11822),f=s(11828),C=s(11e3),x=s(10564);class g{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(u){u=x.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((G=>{const s=G.event;if(!s.metaKey)if(G.type===C.d.KEYDOWN){if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),u||s.preventDefault()}}else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){const G=this._keys.indexOf(s.keyCode);G>=0&&this._keys.splice(G,1),u||s.preventDefault()}})))}Ii(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const u=this.camera;for(let G=0;G<this._keys.length;G++){const s=this._keys[G],T=u._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(s)?u._localDirection.hf(-T,0,0):-1!==this.keysUp.indexOf(s)?u._localDirection.hf(0,0,T):-1!==this.keysRight.indexOf(s)?u._localDirection.hf(T,0,0):-1!==this.keysDown.indexOf(s)?u._localDirection.hf(0,0,-T):-1!==this.keysUpward.indexOf(s)?u._localDirection.hf(0,T,0):-1!==this.keysDownward.indexOf(s)?u._localDirection.hf(0,-T,0):-1!==this.keysRotateLeft.indexOf(s)?(u._localDirection.hf(0,0,0),u.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(s)?(u._localDirection.hf(0,0,0),u.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(s)?(u._localDirection.hf(0,0,0),u.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(s)&&(u._localDirection.hf(0,0,0),u.cameraRotation.x+=this._getLocalRotation()),u.va().useRightHandedSystem&&(u._localDirection.z*=-1),u.getViewMatrix().invertToRef(u._cameraTransformMatrix),O.q.TransformNormalToRef(u._localDirection,u._cameraTransformMatrix,u._transformedDirection),u.cameraDirection.addInPlace(u._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const u=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*u}}(0,T.b)([(0,z.M)()],g.prototype,"keysUp",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysUpward",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysDown",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysDownward",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysLeft",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysRight",void 0),(0,T.b)([(0,z.M)()],g.prototype,"rotationSpeed",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysRotateLeft",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysRotateRight",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysRotateUp",void 0),(0,T.b)([(0,z.M)()],g.prototype,"keysRotateDown",void 0),f.c.FreeCameraKeyboardMoveInput=g;var b=s(10568),Q=s(10991);class Y{constructor(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=u,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new b.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(u){u=x.e.BackCompatCameraNoPreventDefault(arguments);const G=this.camera.getEngine(),s=G.getInputElement();this._pointerInput||(this._pointerInput=T=>{const z=T.event,O="touch"===z.pointerType;if(!this.touchEnabled&&O)return;if(T.type!==Q.d.POINTERMOVE&&-1===this.buttons.indexOf(z.button))return;const m=z.target;if(T.type===Q.d.POINTERDOWN){if(O&&-1!==this._activePointerId||!O&&-1!==this._currentActiveButton)return;this._activePointerId=z.pointerId;try{null===m||void 0===m||m.setPointerCapture(z.pointerId)}catch(f){}-1===this._currentActiveButton&&(this._currentActiveButton=z.button),this._previousPosition={x:z.clientX,y:z.clientY},u||(z.preventDefault(),s&&s.focus()),G.isPointerLock&&this._onMouseMove&&this._onMouseMove(T.event)}else if(T.type===Q.d.POINTERUP){if(O&&this._activePointerId!==z.pointerId||!O&&this._currentActiveButton!==z.button)return;try{null===m||void 0===m||m.releasePointerCapture(z.pointerId)}catch(f){}this._currentActiveButton=-1,this._previousPosition=null,u||z.preventDefault(),this._activePointerId=-1}else if(T.type===Q.d.POINTERMOVE&&(this._activePointerId===z.pointerId||!O))if(G.isPointerLock&&this._onMouseMove)this._onMouseMove(T.event);else if(this._previousPosition){const G=this.camera._calculateHandednessMultiplier(),s=(z.clientX-this._previousPosition.x)*G,T=z.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=s/this.angularSensibility,this.camera.cameraRotation.x+=T/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:T}),this._previousPosition={x:z.clientX,y:z.clientY},u||z.preventDefault()}}),this._onMouseMove=s=>{if(!G.isPointerLock)return;const T=this.camera._calculateHandednessMultiplier(),z=s.movementX*T;this.camera.cameraRotation.y+=z/this.angularSensibility;const O=s.movementY;this.camera.cameraRotation.x+=O/this.angularSensibility,this._previousPosition=null,u||s.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Q.d.POINTERDOWN|Q.d.POINTERUP|Q.d.POINTERMOVE),s&&(this._contextMenuBind=u=>this.onContextMenu(u),s.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(u){u.preventDefault()}Ii(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const u=this.camera.getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,T.b)([(0,z.M)()],Y.prototype,"buttons",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"angularSensibility",void 0),f.c.FreeCameraMouseInput=Y;var n,V=s(11002);class F{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new b.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(u){u=x.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=G=>{if(G.type!==Q.d.POINTERWHEEL)return;const s=G.event,T=s.deltaMode===V.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*T*s.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*T*s.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*T*s.deltaZ/this._normalize,s.preventDefault&&(u||s.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Q.d.POINTERWHEEL)}Ii(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,T.b)([(0,z.M)()],F.prototype,"wheelPrecisionX",void 0),(0,T.b)([(0,z.M)()],F.prototype,"wheelPrecisionY",void 0),(0,T.b)([(0,z.M)()],F.prototype,"wheelPrecisionZ",void 0),function(u){u[u.MoveRelative=0]="MoveRelative",u[u.RotateRelative=1]="RotateRelative",u[u.MoveScene=2]="MoveScene"}(n||(n={}));class r extends F{constructor(){super(...arguments),this._moveRelative=O.q.Zero(),this._rotateRelative=O.q.Zero(),this._moveScene=O.q.Zero(),this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(u){null===u&&this._wheelXAction!==n.MoveRelative||(this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=u)}get wheelXMoveRelative(){return this._wheelXAction!==n.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(u){null===u&&this._wheelYAction!==n.MoveRelative||(this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=u)}get wheelYMoveRelative(){return this._wheelYAction!==n.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(u){null===u&&this._wheelZAction!==n.MoveRelative||(this._wheelZAction=n.MoveRelative,this._wheelZActionCoordinate=u)}get wheelZMoveRelative(){return this._wheelZAction!==n.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(u){null===u&&this._wheelXAction!==n.RotateRelative||(this._wheelXAction=n.RotateRelative,this._wheelXActionCoordinate=u)}get wheelXRotateRelative(){return this._wheelXAction!==n.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(u){null===u&&this._wheelYAction!==n.RotateRelative||(this._wheelYAction=n.RotateRelative,this._wheelYActionCoordinate=u)}get wheelYRotateRelative(){return this._wheelYAction!==n.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(u){null===u&&this._wheelZAction!==n.RotateRelative||(this._wheelZAction=n.RotateRelative,this._wheelZActionCoordinate=u)}get wheelZRotateRelative(){return this._wheelZAction!==n.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(u){null===u&&this._wheelXAction!==n.MoveScene||(this._wheelXAction=n.MoveScene,this._wheelXActionCoordinate=u)}get wheelXMoveScene(){return this._wheelXAction!==n.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(u){null===u&&this._wheelYAction!==n.MoveScene||(this._wheelYAction=n.MoveScene,this._wheelYActionCoordinate=u)}get wheelYMoveScene(){return this._wheelYAction!==n.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(u){null===u&&this._wheelZAction!==n.MoveScene||(this._wheelZAction=n.MoveScene,this._wheelZActionCoordinate=u)}get wheelZMoveScene(){return this._wheelZAction!==n.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.vj(0),this._rotateRelative.vj(0),this._moveScene.vj(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const u=O.d.Zero();this.camera.getViewMatrix().invertToRef(u);const G=O.q.Zero();O.q.TransformNormalToRef(this._moveRelative,u,G),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(G),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(u,G,s){if(0===u)return;if(null===G||null===s)return;let T=null;switch(G){case n.MoveRelative:T=this._moveRelative;break;case n.RotateRelative:T=this._rotateRelative;break;case n.MoveScene:T=this._moveScene}switch(s){case 0:T.set(u,0,0);break;case 1:T.set(0,u,0);break;case 2:T.set(0,0,u)}}}(0,T.b)([(0,z.M)()],r.prototype,"wheelXMoveRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelYMoveRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelZMoveRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelXRotateRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelYRotateRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelZRotateRelative",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelXMoveScene",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelYMoveScene",null),(0,T.b)([(0,z.M)()],r.prototype,"wheelZMoveScene",null),f.c.FreeCameraMouseWheelInput=r;class c{constructor(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=u,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=x.e.IsSafari()}attachControl(u){u=x.e.BackCompatCameraNoPreventDefault(arguments);let G=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=s=>{const T=s.event,z="mouse"===T.pointerType||this._isSafari&&"undefined"===typeof T.pointerType;if(this.allowMouse||!z)if(s.type===Q.d.POINTERDOWN){if(u||T.preventDefault(),this._pointerPressed.push(T.pointerId),1!==this._pointerPressed.length)return;G={x:T.clientX,y:T.clientY}}else if(s.type===Q.d.POINTERUP){u||T.preventDefault();const s=this._pointerPressed.indexOf(T.pointerId);if(-1===s)return;if(this._pointerPressed.splice(s,1),0!=s)return;G=null,this._offsetX=null,this._offsetY=null}else if(s.type===Q.d.POINTERMOVE){if(u||T.preventDefault(),!G)return;if(0!=this._pointerPressed.indexOf(T.pointerId))return;this._offsetX=T.clientX-G.x,this._offsetY=-(T.clientY-G.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Q.d.POINTERDOWN|Q.d.POINTERUP|Q.d.POINTERMOVE),this._onLostFocus){const u=this.camera.getEngine().getInputElement();u&&u.addEventListener("blur",this._onLostFocus)}}Ii(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const u=this.camera.getEngine().getInputElement();u&&u.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const u=this.camera,G=u._calculateHandednessMultiplier();u.cameraRotation.y=G*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)u.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const G=u._computeLocalCameraSpeed(),s=new O.q(0,0,0!==this.touchMoveSensibility?G*this._offsetY/this.touchMoveSensibility:0);O.d.RotationYawPitchRollToRef(u.rotation.y,u.rotation.x,0,u._cameraRotationMatrix),u.cameraDirection.addInPlace(O.q.TransformCoordinates(s,u._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,T.b)([(0,z.M)()],c.prototype,"touchAngularSensibility",void 0),(0,T.b)([(0,z.M)()],c.prototype,"touchMoveSensibility",void 0),f.c.FreeCameraTouchInput=c;class j extends f.e{constructor(u){super(u),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new g),this}addMouse(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Y(u),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new r,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new c),this}clear(){super.clear(),this._mouseInput=null}}var l=s(10715),P=s(10645);class H extends m.b{get angularSensibility(){const u=this.inputs.attached.mouse;return u?u.angularSensibility:0}set angularSensibility(u){const G=this.inputs.attached.mouse;G&&(G.angularSensibility=u)}get keysUp(){const u=this.inputs.attached.keyboard;return u?u.keysUp:[]}set keysUp(u){const G=this.inputs.attached.keyboard;G&&(G.keysUp=u)}get keysUpward(){const u=this.inputs.attached.keyboard;return u?u.keysUpward:[]}set keysUpward(u){const G=this.inputs.attached.keyboard;G&&(G.keysUpward=u)}get keysDown(){const u=this.inputs.attached.keyboard;return u?u.keysDown:[]}set keysDown(u){const G=this.inputs.attached.keyboard;G&&(G.keysDown=u)}get keysDownward(){const u=this.inputs.attached.keyboard;return u?u.keysDownward:[]}set keysDownward(u){const G=this.inputs.attached.keyboard;G&&(G.keysDownward=u)}get keysLeft(){const u=this.inputs.attached.keyboard;return u?u.keysLeft:[]}set keysLeft(u){const G=this.inputs.attached.keyboard;G&&(G.keysLeft=u)}get keysRight(){const u=this.inputs.attached.keyboard;return u?u.keysRight:[]}set keysRight(u){const G=this.inputs.attached.keyboard;G&&(G.keysRight=u)}get keysRotateLeft(){const u=this.inputs.attached.keyboard;return u?u.keysRotateLeft:[]}set keysRotateLeft(u){const G=this.inputs.attached.keyboard;G&&(G.keysRotateLeft=u)}get keysRotateRight(){const u=this.inputs.attached.keyboard;return u?u.keysRotateRight:[]}set keysRotateRight(u){const G=this.inputs.attached.keyboard;G&&(G.keysRotateRight=u)}get keysRotateUp(){const u=this.inputs.attached.keyboard;return u?u.keysRotateUp:[]}set keysRotateUp(u){const G=this.inputs.attached.keyboard;G&&(G.keysRotateUp=u)}get keysRotateDown(){const u=this.inputs.attached.keyboard;return u?u.keysRotateDown:[]}set keysRotateDown(u){const G=this.inputs.attached.keyboard;G&&(G.keysRotateDown=u)}constructor(u,G,s){var T;super(u,G,s,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),T=this,this.ellipsoid=new O.q(.5,1,.5),this.ellipsoidOffset=new O.q(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=O.q.Zero(),this._diffPosition=O.q.Zero(),this._newPosition=O.q.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T._newPosition.p(G),T._newPosition.subtractToRef(T._oldPosition,T._diffPosition),T._diffPosition.length()>P.b.CollisionsEpsilon&&(T.position.addToRef(T._diffPosition,T._deferredPositionUpdate),T._deferOnly?T._deferredUpdated=!0:T.position.p(T._deferredPositionUpdate),T.Ck&&s&&T.Ck(s))},this.inputs=new j(this),this.inputs.addKeyboard().addMouse()}attachControl(u,G){G=x.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(G)}Ii(){this.inputs.detachElement(),this.cameraDirection=new O.q(0,0,0),this.cameraRotation=new O.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(u){this._collisionMask=isNaN(u)?-1:u}_collideWithWorld(u){let G;G=this.parent?O.q.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,G.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const s=this.va().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let T=u;this.applyGravity&&(T=u.add(this.va().gravity)),s.getNewPosition(this._oldPosition,T,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=O.q.Zero(),this._transformedDirection=O.q.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(u){this._needMoveForGravity=u}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,T.b)([(0,z.J)()],H.prototype,"ellipsoid",void 0),(0,T.b)([(0,z.J)()],H.prototype,"ellipsoidOffset",void 0),(0,T.b)([(0,z.M)()],H.prototype,"checkCollisions",void 0),(0,T.b)([(0,z.M)()],H.prototype,"applyGravity",void 0),(0,l.g)("BABYLON.FreeCamera",H)},11822:(u,G,s)=>{"use strict";s.d(G,{b:()=>x});var T=s(10863),z=s(10866),O=s(11154),m=s(10904),f=s(10913),C=s(11201);s(11161).b.AddNodeConstructor("TargetCamera",((u,G)=>()=>new x(u,m.q.Zero(),G)));class x extends O.e{constructor(u,G,s){super(u,G,s,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=m.q.Zero(),this._tmpTargetVector=m.q.Zero(),this.cameraDirection=new m.q(0,0,0),this.cameraRotation=new m.m(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new m.h,this.rotation=new m.q(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=m.q.Zero(),this._initialFocalDistance=1,this._viewMatrix=m.d.Zero(),this._camMatrix=m.d.Zero(),this._cameraTransformMatrix=m.d.Zero(),this._cameraRotationMatrix=m.d.Zero(),this._referencePoint=new m.q(0,0,1),this._transformedReferencePoint=m.q.Zero(),this._deferredPositionUpdate=new m.q,this._deferredRotationQuaternionUpdate=new m.h,this._deferredRotationUpdate=new m.q,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=m.q.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(u){this.getWorldMatrix();const G=this.getTarget().Nc(this.position);return G.normalize(),G.scaleInPlace(u),this.globalPosition.add(G)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const u=this.lockedTarget;u.Gj().getTranslationToRef(u.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.hf(0,0,0),this.cameraRotation.hf(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new m.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new m.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new m.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(u){u||super._updateCache();const G=this._getLockedTargetPosition();G?this._cache.lockedTarget?this._cache.lockedTarget.p(G):this._cache.lockedTarget=G.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const u=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(u):!u)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const u=this.getEngine();return this.speed*Math.sqrt(u.getDeltaTime()/(100*u.getFps()))}setTarget(u){this.upVector.normalize(),this._initialFocalDistance=u.Nc(this.position).length(),this.position.z===u.z&&(this.position.z+=f.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),m.d.LookAtLHToRef(this.position,u,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const G=u.Nc(this.position);G.x>=0?this.rotation.y=-Math.atan(G.z/G.x)+Math.PI/2:this.rotation.y=-Math.atan(G.z/G.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&m.h.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(u){this.setTarget(u)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(m.l.Matrix[0]),m.q.TransformNormalToRef(this.cameraDirection,m.l.Matrix[0],m.l.gb[0]),this._deferredPositionUpdate.addInPlace(m.l.gb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const u=this.invertRotation?-this.inverseRotationSpeed:1,G=this._decideIfNeedsToMove(),s=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),G&&this._updatePosition(),s){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*u,this._deferredRotationUpdate.y+=this.cameraRotation.y*u,!this.noRotationConstraint){const u=1.570796;this._deferredRotationUpdate.x>u&&(this._deferredRotationUpdate.x=u),this._deferredRotationUpdate.x<-u&&(this._deferredRotationUpdate.x=-u)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(m.h.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}G&&(Math.abs(this.cameraDirection.x)<this.speed*f.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*f.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*f.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),s&&(Math.abs(this.cameraRotation.x)<this.speed*f.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*f.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):m.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return m.q.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),m.q.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?C.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(m.h.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),C.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(u,G,s){if(this.ignoreParentScaling){if(this.parent){const T=this.parent.getWorldMatrix();m.q.TransformCoordinatesToRef(u,T,this._globalPosition),m.q.TransformCoordinatesToRef(G,T,this._tmpTargetVector),m.q.TransformNormalToRef(s,T,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(u),this._tmpTargetVector.p(G),this._tmpUpVector.p(s);this.va().useRightHandedSystem?m.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):m.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?m.d.LookAtRHToRef(u,G,s,this._viewMatrix):m.d.LookAtLHToRef(u,G,s,this._viewMatrix),this.parent){const u=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(u,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(u)}createRigCamera(u,G){if(this.cameraRigMode!==O.e.RIG_MODE_NONE){const G=new x(u,this.position.clone(),this.va());return G.isRigCamera=!0,G.rigParent=this,this.cameraRigMode===O.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new m.h),G._cameraRigParams={},G.rotationQuaternion=new m.h),G.mode=this.mode,G.orthoLeft=this.orthoLeft,G.orthoRight=this.orthoRight,G.orthoTop=this.orthoTop,G.orthoBottom=this.orthoBottom,G}return null}_updateRigCameras(){const u=this._rigCameras[0],G=this._rigCameras[1];switch(this.Gj(),this.cameraRigMode){case O.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case O.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const s=this.cameraRigMode===O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,T=this.cameraRigMode===O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,u),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*T,G);break}case O.e.RIG_MODE_VR:u.rotationQuaternion?(u.rotationQuaternion.p(this.rotationQuaternion),G.rotationQuaternion.p(this.rotationQuaternion)):(u.rotation.p(this.rotation),G.rotation.p(this.rotation)),u.position.p(this.position),G.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(u,G){this.getTarget().subtractToRef(this.position,x._TargetFocalPoint),x._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const s=x._TargetFocalPoint.addInPlace(this.position);m.d.TranslationToRef(-s.x,-s.y,-s.z,x._TargetTransformMatrix),x._TargetTransformMatrix.multiplyToRef(m.d.RotationAxis(G.upVector,u),x._RigCamTransformMatrix),m.d.TranslationToRef(s.x,s.y,s.z,x._TargetTransformMatrix),x._RigCamTransformMatrix.multiplyToRef(x._TargetTransformMatrix,x._RigCamTransformMatrix),m.q.TransformCoordinatesToRef(this.position,x._RigCamTransformMatrix,G.position),G.setTarget(s)}getClassName(){return"TargetCamera"}}x._RigCamTransformMatrix=new m.d,x._TargetTransformMatrix=new m.d,x._TargetFocalPoint=new m.q,(0,T.b)([(0,z.J)()],x.prototype,"rotation",void 0),(0,T.b)([(0,z.M)()],x.prototype,"speed",void 0),(0,T.b)([(0,z.v)("lockedTargetId")],x.prototype,"lockedTarget",void 0)},11055:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{constructor(u,G,s){this.bu=u,this.bv=G,this.distance=s,this.faceId=0,this.subMeshId=0}}},10959:(u,G,s)=>{"use strict";s.d(G,{c:()=>O});var T=s(10904),z=s(10961);class O{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var u;let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||s&&!this.pickedMesh.isVerticesDataPresent(z.f.NormalKind))return null;let O,m=this.pickedMesh.kf();0===(null===(u=m)||void 0===u?void 0:u.length)&&(m=null);const f=T.l.gb[0],C=T.l.gb[1],x=T.l.gb[2];if(s){const u=this.pickedMesh.getVerticesData(z.f.NormalKind);let G=m?T.q.FromArrayToRef(u,3*m[3*this.faceId],f):f.hf(u[3*this.faceId*3],u[3*this.faceId*3+1],u[3*this.faceId*3+2]),s=m?T.q.FromArrayToRef(u,3*m[3*this.faceId+1],C):C.hf(u[3*(3*this.faceId+1)],u[3*(3*this.faceId+1)+1],u[3*(3*this.faceId+1)+2]),g=m?T.q.FromArrayToRef(u,3*m[3*this.faceId+2],x):x.hf(u[3*(3*this.faceId+2)],u[3*(3*this.faceId+2)+1],u[3*(3*this.faceId+2)+2]);G=G.scale(this.bu),s=s.scale(this.bv),g=g.scale(1-this.bu-this.bv),O=new T.q(G.x+s.x+g.x,G.y+s.y+g.y,G.z+s.z+g.z)}else{const u=this.pickedMesh.getVerticesData(z.f.PositionKind),G=m?T.q.FromArrayToRef(u,3*m[3*this.faceId],f):f.hf(u[3*this.faceId*3],u[3*this.faceId*3+1],u[3*this.faceId*3+2]),s=m?T.q.FromArrayToRef(u,3*m[3*this.faceId+1],C):C.hf(u[3*(3*this.faceId+1)],u[3*(3*this.faceId+1)+1],u[3*(3*this.faceId+1)+2]),g=m?T.q.FromArrayToRef(u,3*m[3*this.faceId+2],x):x.hf(u[3*(3*this.faceId+2)],u[3*(3*this.faceId+2)+1],u[3*(3*this.faceId+2)+2]),b=G.Nc(s),Q=g.Nc(s);O=T.q.Cross(b,Q)}const g=(u,G)=>{let s=u.getWorldMatrix();u.nonUniformScaling&&(T.l.Matrix[0].p(s),s=T.l.Matrix[0],s.setTranslationFromFloats(0,0,0),s.invert(),s.transposeToRef(T.l.Matrix[1]),s=T.l.Matrix[1]),T.q.TransformNormalToRef(G,s,G)};if(G&&g(this.pickedMesh,O),this.ray){const u=T.l.gb[0].p(O);G||g(this.pickedMesh,u),T.q.Dot(u,this.ray.direction)>0&&O.negateInPlace()}return O.normalize(),O}getTextureCoordinates(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(u))return null;const G=this.pickedMesh.kf();if(!G)return null;const s=this.pickedMesh.getVerticesData(u);if(!s)return null;let O=T.m.Ag(s,2*G[3*this.faceId]),m=T.m.Ag(s,2*G[3*this.faceId+1]),f=T.m.Ag(s,2*G[3*this.faceId+2]);return O=O.scale(this.bu),m=m.scale(this.bv),f=f.scale(1-this.bu-this.bv),new T.m(O.x+m.x+f.x,O.y+m.y+f.y)}}},11121:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});let T=!1},12341:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(10881),z=s(12350);class O{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=s,this.bi=[],this._maxBlockCapacity=G||64,this._selectionContent=new T.b(1024),this._creationFunc=u}update(u,G,s){z.c._CreateBlocks(u,G,s,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ai(u){for(let G=0;G<this.eh.length;G++){this.eh[G].addEntry(u)}}Kg(u){for(let G=0;G<this.eh.length;G++){this.eh[G].removeEntry(u)}}select(u,G){this._selectionContent.reset();for(let s=0;s<this.eh.length;s++){this.eh[s].select(u,this._selectionContent,G)}return G?this._selectionContent.concat(this.bi):this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}intersects(u,G,s){this._selectionContent.reset();for(let T=0;T<this.eh.length;T++){this.eh[T].intersects(u,G,this._selectionContent,s)}return s?this._selectionContent.concat(this.bi):this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}intersectsRay(u){this._selectionContent.reset();for(let G=0;G<this.eh.length;G++){this.eh[G].intersectsRay(u,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}}O.CreationFuncForMeshes=(u,G)=>{const s=u.getBoundingInfo();!u.isBlocked&&s.boundingBox.intersectsMinMax(G.gi,G.hi)&&G.entries.push(u)},O.CreationFuncForSubMeshes=(u,G)=>{u.getBoundingInfo().boundingBox.intersectsMinMax(G.gi,G.hi)&&G.entries.push(u)}},12350:(u,G,s)=>{"use strict";s.d(G,{c:()=>O});var T=s(10904),z=s(11065);class O{constructor(u,G,s,T,z,O){this.entries=[],this.ii=new Array,this._capacity=s,this._depth=T,this._maxDepth=z,this._creationFunc=O,this._minPoint=u,this._maxPoint=G,this.ii.push(u.clone()),this.ii.push(G.clone()),this.ii.push(u.clone()),this.ii[2].x=G.x,this.ii.push(u.clone()),this.ii[3].y=G.y,this.ii.push(u.clone()),this.ii[4].z=G.z,this.ii.push(G.clone()),this.ii[5].z=u.z,this.ii.push(G.clone()),this.ii[6].x=u.x,this.ii.push(G.clone()),this.ii[7].y=u.y}get Aj(){return this._capacity}get gi(){return this._minPoint}get hi(){return this._maxPoint}addEntry(u){if(this.eh)for(let G=0;G<this.eh.length;G++){this.eh[G].addEntry(u)}else this._creationFunc(u,this),this.entries.length>this.Aj&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(u){if(this.eh){for(let G=0;G<this.eh.length;G++){this.eh[G].removeEntry(u)}return}const G=this.entries.indexOf(u);G>-1&&this.entries.splice(G,1)}addEntries(u){for(let G=0;G<u.length;G++){const s=u[G];this.addEntry(s)}}select(u,G,s){if(z.b.IsInFrustum(this.ii,u)){if(this.eh){for(let T=0;T<this.eh.length;T++){this.eh[T].select(u,G,s)}return}s?G.concat(this.entries):G.concatWithNoDuplicate(this.entries)}}intersects(u,G,s,T){if(z.b.IntersectsSphere(this._minPoint,this._maxPoint,u,G)){if(this.eh){for(let z=0;z<this.eh.length;z++){this.eh[z].intersects(u,G,s,T)}return}T?s.concat(this.entries):s.concatWithNoDuplicate(this.entries)}}intersectsRay(u,G){if(u.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.eh){for(let s=0;s<this.eh.length;s++){this.eh[s].intersectsRay(u,G)}return}G.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){O._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(u,G,s,z,m,f,C,x){C.eh=new Array;const g=new T.q((G.x-u.x)/2,(G.y-u.y)/2,(G.z-u.z)/2);for(let T=0;T<2;T++)for(let G=0;G<2;G++)for(let b=0;b<2;b++){const Q=u.add(g.multiplyByFloats(T,G,b)),Y=u.add(g.multiplyByFloats(T+1,G+1,b+1)),n=new O(Q,Y,z,m+1,f,x);n.addEntries(s),C.eh.push(n)}}}},12355:(u,G,s)=>{"use strict";s.d(G,{c:()=>g});var T=s(10889),z=s(10904),O=s(11191),m=s(11543),f=s(10986),C=s(12341),x=s(10619);T.e.prototype.createOrUpdateSelectionOctree=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=this._getComponent(f.d.NAME_OCTREE);s||(s=new g(this),this.o(s)),this.$h||(this.$h=new C.e(C.e.CreationFuncForMeshes,u,G));const T=this.getWorldExtends();return this.$h.update(T.min,T.max,this.meshes),this.$h},Object.defineProperty(T.e.prototype,"selectionOctree",{get:function(){return this.$h},enumerable:!0,configurable:!0}),O.d.prototype.createOrUpdateSubmeshesOctree=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const s=this.va();let T=s._getComponent(f.d.NAME_OCTREE);T||(T=new g(s),s.o(T)),this._submeshesOctree||(this._submeshesOctree=new C.e(C.e.CreationFuncForSubMeshes,u,G)),this.Gj(!0);const z=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(z.minimumWorld,z.maximumWorld,this.xf),this._submeshesOctree};class g{constructor(u){this.name=f.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new m.b(z.q.Zero(),new z.q(1,1,1)),(u=u||x.d.LastCreatedScene)&&(this.wf=u,this.wf.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.wf.getActiveSubMeshCandidates=u=>this.getActiveSubMeshCandidates(u),this.wf.getCollidingSubMeshCandidates=(u,G)=>this.getCollidingSubMeshCandidates(u,G),this.wf.getIntersectingSubMeshCandidates=(u,G)=>this.getIntersectingSubMeshCandidates(u,G))}register(){this.wf.onMeshRemovedObservable.add((u=>{const G=this.wf.selectionOctree;if(void 0!==G&&null!==G){const s=G.bi.indexOf(u);-1!==s&&G.bi.splice(s,1)}})),this.wf.onMeshImportedObservable.add((u=>{const G=this.wf.selectionOctree;void 0!==G&&null!==G&&G.ai(u)}))}getActiveMeshCandidates(){var u;return(null===(u=this.wf.$h)||void 0===u?void 0:u.select(this.wf.frustumPlanes))||this.wf._getDefaultMeshCandidates()}getActiveSubMeshCandidates(u){if(u._submeshesOctree&&u.useOctreeForRenderingSelection){return u._submeshesOctree.select(this.wf.frustumPlanes)}return this.wf._getDefaultSubMeshCandidates(u)}getIntersectingSubMeshCandidates(u,G){if(u._submeshesOctree&&u.useOctreeForPicking){m.b.TransformToRef(G,u.getWorldMatrix(),this._tempRay);return u._submeshesOctree.intersectsRay(this._tempRay)}return this.wf._getDefaultSubMeshCandidates(u)}getCollidingSubMeshCandidates(u,G){if(u._submeshesOctree&&u.useOctreeForCollisions){const s=G._velocityWorldLength+Math.max(G._radius.x,G._radius.y,G._radius.z);return u._submeshesOctree.intersects(G._basePointWorld,s)}return this.wf._getDefaultSubMeshCandidates(u)}rebuild(){}dispose(){}}},11065:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(10918),z=s(10904),O=s(10913);class m{constructor(u,G,s){this.vectors=(0,T.c)(8,z.q.Zero),this.center=z.q.Zero(),this.centerWorld=z.q.Zero(),this.extendSize=z.q.Zero(),this.extendSizeWorld=z.q.Zero(),this.directions=(0,T.c)(3,z.q.Zero),this.vectorsWorld=(0,T.c)(8,z.q.Zero),this.minimumWorld=z.q.Zero(),this.maximumWorld=z.q.Zero(),this.minimum=z.q.Zero(),this.maximum=z.q.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(u,G,s)}reConstruct(u,G,s){const T=u.x,O=u.y,m=u.z,f=G.x,C=G.y,x=G.z,g=this.vectors;this.minimum.hf(T,O,m),this.maximum.hf(f,C,x),g[0].hf(T,O,m),g[1].hf(f,C,x),g[2].hf(f,O,m),g[3].hf(T,C,m),g[4].hf(T,O,x),g[5].hf(f,C,m),g[6].hf(T,C,x),g[7].hf(f,O,x),G.addToRef(u,this.center).scaleInPlace(.5),G.subtractToRef(u,this.extendSize).scaleInPlace(.5),this._worldMatrix=s||z.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(u){const G=m._TmpVector3,s=this.maximum.subtractToRef(this.minimum,G[0]),T=s.length();s.normalizeFromLength(T);const z=T*u,O=s.scaleInPlace(.5*z),f=this.center.subtractToRef(O,G[1]),C=this.center.addToRef(O,G[2]);return this.reConstruct(f,C,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(u){const G=this.minimumWorld,s=this.maximumWorld,T=this.directions,O=this.vectorsWorld,m=this.vectors;if(u.isIdentity()){G.p(this.minimum),s.p(this.maximum);for(let u=0;u<8;++u)O[u].p(m[u]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{G.vj(Number.MAX_VALUE),s.vj(-Number.MAX_VALUE);for(let T=0;T<8;++T){const f=O[T];z.q.TransformCoordinatesToRef(m[T],u,f),G.minimizeInPlace(f),s.maximizeInPlace(f)}s.subtractToRef(G,this.extendSizeWorld).scaleInPlace(.5),s.addToRef(G,this.centerWorld).scaleInPlace(.5)}z.q.FromArrayToRef(u.m,0,T[0]),z.q.FromArrayToRef(u.m,4,T[1]),z.q.FromArrayToRef(u.m,8,T[2]),this._worldMatrix=u}isInFrustum(u){return m.IsInFrustum(this.vectorsWorld,u)}isCompletelyInFrustum(u){return m.IsCompletelyInFrustum(this.vectorsWorld,u)}intersectsPoint(u){const G=this.minimumWorld,s=this.maximumWorld,T=G.x,z=G.y,m=G.z,f=s.x,C=s.y,x=s.z,g=u.x,b=u.y,Q=u.z,Y=-O.e;return!(f-g<Y||Y>g-T)&&(!(C-b<Y||Y>b-z)&&!(x-Q<Y||Y>Q-m))}intersectsSphere(u){return m.IntersectsSphere(this.minimumWorld,this.maximumWorld,u.centerWorld,u.radiusWorld)}intersectsMinMax(u,G){const s=this.minimumWorld,T=this.maximumWorld,z=s.x,O=s.y,m=s.z,f=T.x,C=T.y,x=T.z,g=u.x,b=u.y,Q=u.z,Y=G.x,n=G.y,V=G.z;return!(f<g||z>Y)&&(!(C<b||O>n)&&!(x<Q||m>V))}dispose(){var u,G;null===(u=this._drawWrapperFront)||void 0===u||u.dispose(),null===(G=this._drawWrapperBack)||void 0===G||G.dispose()}static Intersects(u,G){return u.intersectsMinMax(G.minimumWorld,G.maximumWorld)}static IntersectsSphere(u,G,s,T){const O=m._TmpVector3[0];z.q.ClampToRef(s,u,G,O);return z.q.DistanceSquared(s,O)<=T*T}static IsCompletelyInFrustum(u,G){for(let s=0;s<6;++s){const T=G[s];for(let G=0;G<8;++G)if(T.dotCoordinate(u[G])<0)return!1}return!0}static IsInFrustum(u,G){for(let s=0;s<6;++s){let T=!0;const z=G[s];for(let G=0;G<8;++G)if(z.dotCoordinate(u[G])>=0){T=!1;break}if(T)return!1}return!0}}m._TmpVector3=(0,T.c)(3,z.q.Zero)},11059:(u,G,s)=>{"use strict";s.d(G,{c:()=>b});var T=s(10918),z=s(10904),O=s(11065),m=s(11073);const f={min:0,max:0},C={min:0,max:0},x=(u,G,s)=>{const T=z.q.Dot(G.centerWorld,u),O=Math.abs(z.q.Dot(G.directions[0],u))*G.extendSize.x+Math.abs(z.q.Dot(G.directions[1],u))*G.extendSize.y+Math.abs(z.q.Dot(G.directions[2],u))*G.extendSize.z;s.min=T-O,s.max=T+O},g=(u,G,s)=>(x(u,G,f),x(u,s,C),!(f.min>C.max||C.min>f.max));class b{constructor(u,G,s){this._isLocked=!1,this.boundingBox=new O.b(u,G,s),this.boundingSphere=new m.c(u,G,s)}reConstruct(u,G,s){this.boundingBox.reConstruct(u,G,s),this.boundingSphere.reConstruct(u,G,s)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(u){this._isLocked=u}update(u){this._isLocked||(this.boundingBox._update(u),this.boundingSphere._update(u))}centerOn(u,G){const s=b._TmpVector3[0].p(u).fi(G),T=b._TmpVector3[1].p(u).addInPlace(G);return this.boundingBox.reConstruct(s,T,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(s,T,this.boundingBox.getWorldMatrix()),this}encapsulate(u){const G=z.q.Minimize(this.minimum,u),s=z.q.Maximize(this.maximum,u);return this.reConstruct(G,s,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(u){const G=z.l.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(G);const s=z.l.gb[0];return z.q.TransformCoordinatesToRef(u.boundingBox.minimumWorld,G,s),this.encapsulate(s),z.q.TransformCoordinatesToRef(u.boundingBox.maximumWorld,G,s),this.encapsulate(s),this}scale(u){return this.boundingBox.scale(u),this.boundingSphere.scale(u),this}isInFrustum(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===G||3===G)&&this.boundingSphere.isCenterInFrustum(u))return!0;if(!this.boundingSphere.isInFrustum(u))return!1;return!(1!==G&&3!==G)||this.boundingBox.isInFrustum(u)}get diagonalLength(){const u=this.boundingBox;return u.maximumWorld.subtractToRef(u.minimumWorld,b._TmpVector3[0]).length()}isCompletelyInFrustum(u){return this.boundingBox.isCompletelyInFrustum(u)}_checkCollision(u){return u._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(u){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(u)&&!!this.boundingBox.intersectsPoint(u))}intersects(u,G){if(!m.c.Intersects(this.boundingSphere,u.boundingSphere))return!1;if(!O.b.Intersects(this.boundingBox,u.boundingBox))return!1;if(!G)return!0;const s=this.boundingBox,T=u.boundingBox;return!!g(s.directions[0],s,T)&&(!!g(s.directions[1],s,T)&&(!!g(s.directions[2],s,T)&&(!!g(T.directions[0],s,T)&&(!!g(T.directions[1],s,T)&&(!!g(T.directions[2],s,T)&&(!!g(z.q.Cross(s.directions[0],T.directions[0]),s,T)&&(!!g(z.q.Cross(s.directions[0],T.directions[1]),s,T)&&(!!g(z.q.Cross(s.directions[0],T.directions[2]),s,T)&&(!!g(z.q.Cross(s.directions[1],T.directions[0]),s,T)&&(!!g(z.q.Cross(s.directions[1],T.directions[1]),s,T)&&(!!g(z.q.Cross(s.directions[1],T.directions[2]),s,T)&&(!!g(z.q.Cross(s.directions[2],T.directions[0]),s,T)&&(!!g(z.q.Cross(s.directions[2],T.directions[1]),s,T)&&!!g(z.q.Cross(s.directions[2],T.directions[2]),s,T))))))))))))))}}b._TmpVector3=(0,T.c)(2,z.q.Zero)},11073:(u,G,s)=>{"use strict";s.d(G,{c:()=>O});var T=s(10918),z=s(10904);class O{constructor(u,G,s){this.center=z.q.Zero(),this.centerWorld=z.q.Zero(),this.minimum=z.q.Zero(),this.maximum=z.q.Zero(),this.reConstruct(u,G,s)}reConstruct(u,G,s){this.minimum.p(u),this.maximum.p(G);const T=z.q.Distance(u,G);G.addToRef(u,this.center).scaleInPlace(.5),this.i=.5*T,this._update(s||z.d.IdentityReadOnly)}scale(u){const G=this.i*u,s=O._TmpVector3,T=s[0].vj(G),z=this.center.subtractToRef(T,s[1]),m=this.center.addToRef(T,s[2]);return this.reConstruct(z,m,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(u){if(u.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.i;else{z.q.TransformCoordinatesToRef(this.center,u,this.centerWorld);const G=O._TmpVector3[0];z.q.TransformNormalFromFloatsToRef(1,1,1,u,G),this.radiusWorld=Math.max(Math.abs(G.x),Math.abs(G.y),Math.abs(G.z))*this.i}}isInFrustum(u){const G=this.centerWorld,s=this.radiusWorld;for(let T=0;T<6;T++)if(u[T].dotCoordinate(G)<=-s)return!1;return!0}isCenterInFrustum(u){const G=this.centerWorld;for(let s=0;s<6;s++)if(u[s].dotCoordinate(G)<0)return!1;return!0}intersectsPoint(u){const G=z.q.DistanceSquared(this.centerWorld,u);return!(this.radiusWorld*this.radiusWorld<G)}static Intersects(u,G){const s=z.q.DistanceSquared(u.centerWorld,G.centerWorld),T=u.radiusWorld+G.radiusWorld;return!(T*T<s)}static CreateFromCenterAndRadius(u,G,s){this._TmpVector3[0].p(u),this._TmpVector3[1].hf(0,0,G),this._TmpVector3[2].p(u),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].fi(this._TmpVector3[1]);const T=new O(this._TmpVector3[0],this._TmpVector3[2]);return T._worldMatrix=s||z.d.Identity(),T}}O._TmpVector3=(0,T.c)(3,z.q.Zero)},11543:(u,G,s)=>{"use strict";s.d(G,{b:()=>Y});var T=s(10889),z=s(11154),O=s(10913),m=s(10904),f=s(10918),C=s(11055),x=s(10959),g=s(10619),b=s(11010);const Q={internalPickerForMesh:void 0};class Y{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.e;this.origin=u,this.direction=G,this.length=s,this.epsilon=T}clone(){return new Y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const T=Y._TmpVector3[0].hf(u.x-s,u.y-s,u.z-s),z=Y._TmpVector3[1].hf(G.x+s,G.y+s,G.z+s);let O,m,f,C,x=0,g=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<T.x||this.origin.x>z.x)return!1}else if(O=1/this.direction.x,m=(T.x-this.origin.x)*O,f=(z.x-this.origin.x)*O,f===-1/0&&(f=1/0),m>f&&(C=m,m=f,f=C),x=Math.max(m,x),g=Math.min(f,g),x>g)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<T.y||this.origin.y>z.y)return!1}else if(O=1/this.direction.y,m=(T.y-this.origin.y)*O,f=(z.y-this.origin.y)*O,f===-1/0&&(f=1/0),m>f&&(C=m,m=f,f=C),x=Math.max(m,x),g=Math.min(f,g),x>g)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<T.z||this.origin.z>z.z)return!1}else if(O=1/this.direction.z,m=(T.z-this.origin.z)*O,f=(z.z-this.origin.z)*O,f===-1/0&&(f=1/0),m>f&&(C=m,m=f,f=C),x=Math.max(m,x),g=Math.min(f,g),x>g)return!1;return!0}intersectsBox(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(u.minimum,u.maximum,G)}intersectsSphere(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=u.center.x-this.origin.x,T=u.center.y-this.origin.y,z=u.center.z-this.origin.z,O=s*s+T*T+z*z,m=u.i+G,f=m*m;if(O<=f)return!0;const C=s*this.direction.x+T*this.direction.y+z*this.direction.z;if(C<0)return!1;return O-C*C<=f}intersectsTriangle(u,G,s){const T=Y._TmpVector3[0],z=Y._TmpVector3[1],O=Y._TmpVector3[2],f=Y._TmpVector3[3],x=Y._TmpVector3[4];G.subtractToRef(u,T),s.subtractToRef(u,z),m.q.CrossToRef(this.direction,z,O);const g=m.q.Dot(T,O);if(0===g)return null;const b=1/g;this.origin.subtractToRef(u,f);const Q=m.q.Dot(f,O)*b;if(Q<-this.epsilon||Q>1+this.epsilon)return null;m.q.CrossToRef(f,T,x);const n=m.q.Dot(this.direction,x)*b;if(n<-this.epsilon||Q+n>1+this.epsilon)return null;const V=m.q.Dot(z,x)*b;return V>this.length?null:new C.b(1-Q-n,Q,V)}intersectsPlane(u){let G;const s=m.q.Dot(u.ab,this.direction);if(Math.abs(s)<9.99999997475243e-7)return null;{const T=m.q.Dot(u.ab,this.origin);return G=(-u.d-T)/s,G<0?G<-9.99999997475243e-7?null:0:G}}intersectsAxis(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(u){case"y":{const u=(this.origin.y-G)/this.direction.y;return u>0?null:new m.q(this.origin.x+this.direction.x*-u,G,this.origin.z+this.direction.z*-u)}case"x":{const u=(this.origin.x-G)/this.direction.x;return u>0?null:new m.q(G,this.origin.y+this.direction.y*-u,this.origin.z+this.direction.z*-u)}case"z":{const u=(this.origin.z-G)/this.direction.z;return u>0?null:new m.q(this.origin.x+this.direction.x*-u,this.origin.y+this.direction.y*-u,G)}default:return null}}intersectsMesh(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=m.l.Matrix[0];return u.getWorldMatrix().invertToRef(f),this._tmpRay?Y.TransformToRef(this,f,this._tmpRay):this._tmpRay=Y.Transform(this,f),u.intersects(this._tmpRay,G,s,T,z,O)}intersectsMeshes(u,G,s){s?s.length=0:s=[];for(let T=0;T<u.length;T++){const z=this.intersectsMesh(u[T],G);z.hit&&s.push(z)}return s.sort(this._comparePickingInfo),s}_comparePickingInfo(u,G){return u.distance<G.distance?-1:u.distance>G.distance?1:0}intersectionSegment(u,G,s){const T=this.origin,z=m.l.gb[0],O=m.l.gb[1],f=m.l.gb[2],C=m.l.gb[3];G.subtractToRef(u,z),this.direction.scaleToRef(Y._Rayl,f),T.addToRef(f,O),u.subtractToRef(T,C);const x=m.q.Dot(z,z),g=m.q.Dot(z,f),b=m.q.Dot(f,f),Q=m.q.Dot(z,C),n=m.q.Dot(f,C),V=x*b-g*g;let F,r,c=V,j=V;V<Y._Smallnum?(F=0,c=1,r=n,j=b):(F=g*n-b*Q,r=x*n-g*Q,F<0?(F=0,r=n,j=b):F>c&&(F=c,r=n+g,j=b)),r<0?(r=0,-Q<0?F=0:-Q>x?F=c:(F=-Q,c=x)):r>j&&(r=j,-Q+g<0?F=0:-Q+g>x?F=c:(F=-Q+g,c=x));const l=Math.abs(F)<Y._Smallnum?0:F/c,P=Math.abs(r)<Y._Smallnum?0:r/j,H=m.l.gb[4];f.scaleToRef(P,H);const X=m.l.gb[5];z.scaleToRef(l,X),X.addInPlace(C);const p=m.l.gb[6];X.subtractToRef(H,p);return P>0&&P<=this.length&&p.lengthSquared()<s*s?X.length():-1}update(u,G,s,T,z,O,f){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Y._RayDistant||(Y._RayDistant=Y.Zero()),Y._RayDistant.unprojectRayToRef(u,G,s,T,m.d.IdentityReadOnly,O,f);const C=m.l.Matrix[0];z.invertToRef(C),Y.TransformToRef(Y._RayDistant,C,this)}else this.unprojectRayToRef(u,G,s,T,z,O,f);return this}static Zero(){return new Y(m.q.Zero(),m.q.Zero())}static CreateNew(u,G,s,T,z,O,m){return Y.Zero().update(u,G,s,T,z,O,m)}static CreateNewFromTo(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.d.IdentityReadOnly;const T=new Y(new m.q(0,0,0),new m.q(0,0,0));return Y.CreateFromToToRef(u,G,T,s)}static CreateFromToToRef(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.d.IdentityReadOnly;s.origin.p(u);const z=G.subtractToRef(u,s.direction),O=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);return s.length=O,s.direction.normalize(),Y.TransformToRef(s,T,s)}static Transform(u,G){const s=new Y(new m.q(0,0,0),new m.q(0,0,0));return Y.TransformToRef(u,G,s),s}static TransformToRef(u,G,s){m.q.TransformCoordinatesToRef(u.origin,G,s.origin),m.q.TransformNormalToRef(u.direction,G,s.direction),s.length=u.length,s.epsilon=u.epsilon;const T=s.direction,z=T.length();if(0!==z&&1!==z){const u=1/z;T.x*=u,T.y*=u,T.z*=u,s.length*=z}return s}unprojectRayToRef(u,G,s,T,z,O,f){const C=m.l.Matrix[0];z.multiplyToRef(O,C),C.multiplyToRef(f,C),C.invert();const x=g.d.LastCreatedEngine,b=m.l.gb[0];b.x=u/s*2-1,b.y=-(G/T*2-1),b.z=null!==x&&void 0!==x&&x.useReverseDepthBuffer?1:null!==x&&void 0!==x&&x.isNDCHalfZRange?0:-1;const Q=m.l.gb[1].hf(b.x,b.y,1-1e-8),Y=m.l.gb[2],n=m.l.gb[3];m.q._UnprojectFromInvertedMatrixToRef(b,C,Y),m.q._UnprojectFromInvertedMatrixToRef(Q,C,n),this.origin.p(Y),n.subtractToRef(Y,this.direction),this.direction.normalize()}}function n(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=Y.Zero();return V(u,G,s,T,m,z,O),m}function V(u,G,s,T,z,O){let f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const x=u.getEngine();if(!O&&!(O=u.activeCamera))return u;const g=O.viewport,b=x.getRenderHeight(),{x:Q,y:Y,width:n,height:V}=g.toGlobal(x.getRenderWidth(),b),F=1/x.getHardwareScalingLevel();return G=G*F-Q,s=s*F-(b-Y-V),z.update(G,s,n,V,T||m.d.IdentityReadOnly,f?m.d.IdentityReadOnly:O.getViewMatrix(),O.getProjectionMatrix(),C),u}function F(u,G,s,T,z){if(!x.c)return u;const O=u.getEngine();if(!z&&!(z=u.activeCamera))throw new Error("Active camera not set");const f=z.viewport,C=O.getRenderHeight(),{x:g,y:b,width:Q,height:Y}=f.toGlobal(O.getRenderWidth(),C),n=m.d.Identity(),V=1/O.getHardwareScalingLevel();return G=G*V-g,s=s*V-(C-b-Y),T.update(G,s,Q,Y,n,n,z.getProjectionMatrix()),u}function r(u,G,s,T,z,O,m,f){const C=G(T,s.enableDistantPicking),x=s.intersects(C,z,m,O,T,f);return x&&x.hit?!z&&null!=u&&x.distance>=u.distance?null:x:null}function c(u,G,s,T,z,O){let f=null;const C=!!(u.activeCameras&&u.activeCameras.length>1&&u.cameraToUseForPointers!==u.activeCamera),g=u.cameraToUseForPointers||u.activeCamera,b=Q.internalPickerForMesh||r;for(let x=0;x<u.meshes.length;x++){const Q=u.meshes[x];if(s){if(!s(Q,-1))continue}else if(!Q.isEnabled()||!Q.isVisible||!Q.me)continue;const Y=C&&Q.isWorldMatrixCameraDependent(),n=Q.Gj(Y,g);if(Q.hasThinInstances&&Q.thinInstanceEnablePicking){const u=b(f,G,Q,n,!0,!0,O);if(u){if(z)return u;const C=m.l.Matrix[1],x=Q.thinInstanceGetWorldMatrices();for(let u=0;u<x.length;u++){if(s&&!s(Q,u))continue;x[u].multiplyToRef(n,C);const m=b(f,G,Q,C,T,z,O,!0);if(m&&(f=m,f.thinInstanceIndex=u,T))return f}}}else{const u=b(f,G,Q,n,T,z,O);if(u&&(f=u,T))return f}}return f||new x.c}function j(u,G,s,T){if(!x.c)return null;const z=[],O=!!(u.activeCameras&&u.activeCameras.length>1&&u.cameraToUseForPointers!==u.activeCamera),f=u.cameraToUseForPointers||u.activeCamera,C=Q.internalPickerForMesh||r;for(let x=0;x<u.meshes.length;x++){const g=u.meshes[x];if(s){if(!s(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.me)continue;const b=O&&g.isWorldMatrixCameraDependent(),Q=g.Gj(b,f);if(g.hasThinInstances&&g.thinInstanceEnablePicking){if(C(null,G,g,Q,!0,!0,T)){const u=m.l.Matrix[1],O=g.thinInstanceGetWorldMatrices();for(let m=0;m<O.length;m++){if(s&&!s(g,m))continue;O[m].multiplyToRef(Q,u);const f=C(null,G,g,u,!1,!1,T,!0);f&&(f.thinInstanceIndex=m,z.push(f))}}}else{const u=C(null,G,g,Q,!1,!1,T);u&&z.push(u)}}return z}function l(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;T||(T=u.getWorldMatrix()),G.length=s,z?G.origin.p(z):G.origin.p(u.position);const O=m.l.gb[2];O.set(0,0,u._scene.useRightHandedSystem?-1:1);const f=m.l.gb[3];return m.q.TransformNormalToRef(O,T,f),m.q.NormalizeToRef(f,G.direction),G}var P,H;Y._TmpVector3=(0,f.c)(6,m.q.Zero),Y._RayDistant=Y.Zero(),Y._Smallnum=1e-8,Y._Rayl=1e9,P=T.e,(H=z.e)&&(H.prototype.getForwardRay=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;return l(this,new Y(m.q.Zero(),m.q.Zero(),u),u,G,s)},H.prototype.getForwardRayToRef=function(u){return l(this,u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(b.e._IsPickingAvailable=!0,P.prototype.createPickingRay=function(u,G,s,T){return n(this,u,G,s,T,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),T.e.prototype.createPickingRayToRef=function(u,G,s,T,z){return V(this,u,G,s,T,z,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},T.e.prototype.createPickingRayInCameraSpace=function(u,G,s){return function(u,G,s,T){const z=Y.Zero();return F(u,G,s,z,T),z}(this,u,G,s)},T.e.prototype.createPickingRayInCameraSpaceToRef=function(u,G,s,T){return F(this,u,G,s,T)},T.e.prototype.pickWithBoundingInfo=function(u,G,s,T,z){return function(u,G,s,T,z,O){if(!x.c)return null;const f=c(u,(T=>(u._tempPickingRay||(u._tempPickingRay=Y.Zero()),V(u,G,s,T,u._tempPickingRay,O||null),u._tempPickingRay)),T,z,!0);return f&&(f.ray=n(u,G,s,m.d.Identity(),O||null)),f}(this,u,G,s,T,z)},T.e.prototype.Mc=function(u,G,s,T,z,O){return function(u,G,s,T,z,O,f){const C=c(u,((T,z)=>(u._tempPickingRay||(u._tempPickingRay=Y.Zero()),V(u,G,s,T,u._tempPickingRay,O||null,!1,z),u._tempPickingRay)),T,z,!1,f);return C&&(C.ray=n(u,G,s,m.d.Identity(),O||null)),C}(this,u,G,s,T,z,O)},T.e.prototype.pickWithRay=function(u,G,s,T){return function(u,G,s,T,z){const O=c(u,(s=>(u._pickWithRayInverseMatrix||(u._pickWithRayInverseMatrix=m.d.Identity()),s.invertToRef(u._pickWithRayInverseMatrix),u._cachedRayForTransform||(u._cachedRayForTransform=Y.Zero()),Y.TransformToRef(G,u._pickWithRayInverseMatrix,u._cachedRayForTransform),u._cachedRayForTransform)),s,T,!1,z);return O&&(O.ray=G),O}(this,u,G,s,T)},T.e.prototype.multiPick=function(u,G,s,T,z){return function(u,G,s,T,z,O){return j(u,(T=>n(u,G,s,T,z||null)),T,O)}(this,u,G,s,T,z)},T.e.prototype.multiPickWithRay=function(u,G,s){return function(u,G,s,T){return j(u,(s=>(u._pickWithRayInverseMatrix||(u._pickWithRayInverseMatrix=m.d.Identity()),s.invertToRef(u._pickWithRayInverseMatrix),u._cachedRayForTransform||(u._cachedRayForTransform=Y.Zero()),Y.TransformToRef(G,u._pickWithRayInverseMatrix,u._cachedRayForTransform),u._cachedRayForTransform)),s,T)}(this,u,G,s)}},11432:(u,G,s)=>{"use strict";var T=s(10683),z=s(10584),O=s(10622),m=s(10720),f=s(10645),C=s(10698);f.b.prototype._partialLoadFile=function(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(u,(u=>{s[G]=u,s._internalCount++,6===s._internalCount&&T(s)}),void 0,void 0,!0,((u,G)=>{z&&u&&z(u.status+" "+u.statusText,G)}))},f.b.prototype._cascadeLoadFiles=function(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=[];z._internalCount=0;for(let O=0;O<6;O++)this._partialLoadFile(s[O],O,z,G,T)},f.b.prototype._cascadeLoadImgs=function(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5?arguments[5]:void 0;const m=[];m._internalCount=0;for(let f=0;f<6;f++)this._partialLoadImg(T[f],f,m,u,G,s,z,O)},f.b.prototype._partialLoadImg=function(u,G,s,T,z,f){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0;const g=(0,m.c)();(0,O.l)(u,(u=>{s[G]=u,s._internalCount++,T&&T.removePendingData(g),6===s._internalCount&&f&&f(z,s)}),((u,G)=>{T&&T.removePendingData(g),C&&C(u,G)}),T?T.offlineProvider:null,x),T&&T.addPendingData(g)},f.b.prototype.createCubeTextureBase=function(u,G,s,O){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,F=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,r=arguments.length>14&&void 0!==arguments[14]&&arguments[14],c=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const j=n||new T.d(this,7);j.isCube=!0,j.url=u,j.generateMipMaps=!O,j._lodGenerationScale=Q,j._lodGenerationOffset=Y,j._useSRGBBuffer=!!r&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!O),j!==n&&(j.label=u.substring(0,60)),this._doNotHandleContextLost||(j._extension=g,j._files=s,j._buffer=c);const l=u;this._transformTextureUrl&&!n&&(u=this._transformTextureUrl(u));const P=u.split("?")[0],H=P.lastIndexOf("."),X=g||(H>-1?P.substring(H).toLowerCase():""),p=(0,C.c)(X),q=(T,C)=>{u===l?f&&T&&f(T.status+" "+T.statusText,C):(z.d.Warn(`Failed to load ${u}, falling back to the ${l}`),this.createCubeTextureBase(l,G,s,!!O,m,f,x,g,b,Q,Y,j,V,F,r,c))};if(p)p.then((T=>{const O=u=>{V&&V(j,u),T.loadCubeData(u,j,b,m,f)};c?O(c):s&&6===s.length?T.supportCascades?this._cascadeLoadFiles(G,(u=>O(u.map((u=>new Uint8Array(u))))),s,f):f?f("Textures type does not support cascades."):z.d.Warn("Texture loader does not support cascades."):this._loadFile(u,(u=>O(new Uint8Array(u))),void 0,void 0,!0,q)}));else{if(!s||0===s.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(G,j,((u,G)=>{F&&F(u,G)}),s,f)}return this._internalTexturesCache.push(j),j}},11369:(u,G,s)=>{"use strict";s(10645).b.prototype.createDepthStencilTexture=function(u,G,s){if(G.isCube){const s=u.width||u;return this._createDepthStencilCubeTexture(s,G)}return this._createDepthStencilTexture(u,G,s)}},11341:(u,G,s)=>{"use strict";s(11312).ThinEngine.prototype.setAlphaMode=function(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==u){switch(u){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}G||(this.depthCullingState.depthMask=0===u),this._alphaMode=u}else if(!G){const G=0===u;this.depthCullingState.depthMask!==G&&(this.depthCullingState.depthMask=G)}}},11308:(u,G,s)=>{"use strict";var T=s(11312);T.ThinEngine.prototype.updateDynamicIndexBuffer=function(u,G){let s;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(u),s=u.is32Bits?G instanceof Uint32Array?G:new Uint32Array(G):G instanceof Uint16Array?G:new Uint16Array(G),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},T.ThinEngine.prototype.updateDynamicVertexBuffer=function(u,G,s,T){this.bindArrayBuffer(u),void 0===s&&(s=0);const z=G.byteLength||G.length;void 0===T||T>=z&&0===s?G instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,new Float32Array(G)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,G):G instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(G).subarray(s,s+T)):(G=G instanceof ArrayBuffer?new Uint8Array(G,s,T):new Uint8Array(G.buffer,G.byteOffset+s,T),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,G)),this._resetVertexBufferBinding()}},11358:(u,G,s)=>{"use strict";var T=s(10683),z=s(10584),O=s(11312),m=s(11360);class f extends m.b{constructor(u,G,s,T,z){super(u,G,s,T),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=z}_cloneRenderTargetWrapper(){let u=null;return this._colorTextureArray&&this._depthStencilTextureArray?(u=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),u.texture.isReady=!0):u=super._cloneRenderTargetWrapper(),u}_swapRenderTargetWrapper(u){super._swapRenderTargetWrapper(u),u._framebuffer=this._framebuffer,u._depthStencilBuffer=this._depthStencilBuffer,u._MSAAFramebuffer=this._MSAAFramebuffer,u._colorTextureArray=this._colorTextureArray,u._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,O=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const u=this._engine,G=u._currentFramebuffer,s=this._context;u._bindUnboundFramebuffer(this._framebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,null),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,null),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.RENDERBUFFER,null),u._bindUnboundFramebuffer(G),s.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(u,G,s,T,z,O)}shareDepth(u){super.shareDepth(u);const G=this._context,s=this._depthStencilBuffer,T=u._MSAAFramebuffer||u._framebuffer,z=this._engine;u._depthStencilBuffer&&u._depthStencilBuffer!==s&&G.deleteRenderbuffer(u._depthStencilBuffer),u._depthStencilBuffer=s;const O=u._generateStencilBuffer?G.DEPTH_STENCIL_ATTACHMENT:G.DEPTH_ATTACHMENT;z._bindUnboundFramebuffer(T),G.framebufferRenderbuffer(G.FRAMEBUFFER,O,G.RENDERBUFFER,s),z._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!u._hardwareTexture)return;const z=this._framebuffer,O=this._engine,m=O._currentFramebuffer;if(O._bindUnboundFramebuffer(z),O.webGLVersion>1){const z=this._context,O=z["COLOR_ATTACHMENT"+G];var f;if(u.is2DArray||u.is3D)s=s??(null===(f=this.layerIndices)||void 0===f?void 0:f[G])??0,z.framebufferTextureLayer(z.FRAMEBUFFER,O,u._hardwareTexture.underlyingResource,T,s);else if(u.isCube){var C;s=s??(null===(C=this.faceIndices)||void 0===C?void 0:C[G])??0,z.framebufferTexture2D(z.FRAMEBUFFER,O,z.TEXTURE_CUBE_MAP_POSITIVE_X+s,u._hardwareTexture.underlyingResource,T)}else z.framebufferTexture2D(z.FRAMEBUFFER,O,z.TEXTURE_2D,u._hardwareTexture.underlyingResource,T)}else{const z=this._context,O=z["COLOR_ATTACHMENT"+G+"_WEBGL"],m=void 0!==s?z.TEXTURE_CUBE_MAP_POSITIVE_X+s:z.TEXTURE_2D;z.framebufferTexture2D(z.FRAMEBUFFER,O,m,u._hardwareTexture.underlyingResource,T)}O._bindUnboundFramebuffer(m)}setTexture(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(u,G,s),this._bindTextureRenderTarget(u,G)}setLayerAndFaceIndices(u,G){var s;if(super.setLayerAndFaceIndices(u,G),!this.textures||!this.layerIndices||!this.faceIndices)return;const T=(null===(s=this._attachments)||void 0===s?void 0:s.length)??this.textures.length;for(let z=0;z<T;z++){const u=this.textures[z];u&&(u.is2DArray||u.is3D?this._bindTextureRenderTarget(u,z,this.layerIndices[z]):u.isCube?this._bindTextureRenderTarget(u,z,this.faceIndices[z]):this._bindTextureRenderTarget(u,z))}}setLayerAndFaceIndex(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(u,G,s),!this.textures||!this.layerIndices||!this.faceIndices)return;const T=this.textures[u];T.is2DArray||T.is3D?this._bindTextureRenderTarget(this.textures[u],u,this.layerIndices[u]):T.isCube&&this._bindTextureRenderTarget(this.textures[u],u,this.faceIndices[u])}dispose(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const G=this._context;u||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(G.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(G.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(G.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(u)}}s(11369);O.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(u,G,s){const T=new f(u,G,s,this,this._gl);return this._renderTargetWrapperCache.push(T),T},O.ThinEngine.prototype.createRenderTargetTexture=function(u,G){const s=this._createHardwareRenderTargetWrapper(!1,!1,u);let T,z,O=!0,m=!1,f=!1,C=1;void 0!==G&&"object"===typeof G&&(O=G.generateDepthBuffer??!0,m=!!G.generateStencilBuffer,f=!!G.noColorAttachment,T=G.colorAttachment,C=G.samples??1,z=G.label);const x=T||(f?null:this._createInternalTexture(u,G,!0,5)),g=u.width||u,b=u.height||u,Q=this._currentFramebuffer,Y=this._gl,n=Y.createFramebuffer();if(this._bindUnboundFramebuffer(n),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(m,O,g,b),!x||x.is2DArray||x.is3D||Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,x._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(Q),s.label=z??"RenderTargetWrapper",s._framebuffer=n,s._generateDepthBuffer=O,s._generateStencilBuffer=m,s.setTextures(x),T){if(s._samples=T.samples,T.samples>1){const u=T._hardwareTexture.getMSAARenderBuffer(0);s._MSAAFramebuffer=Y.createFramebuffer(),this._bindUnboundFramebuffer(s._MSAAFramebuffer),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.RENDERBUFFER,u),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(s,C);return s},O.ThinEngine.prototype._createDepthStencilTexture=function(u,G,s){const O=this._gl,m=u.layers||0,f=u.depth||0;let C=O.TEXTURE_2D;0!==m?C=O.TEXTURE_2D_ARRAY:0!==f&&(C=O.TEXTURE_3D);const x=new T.d(this,12);if(x.label=G.label,!this._caps.depthTextureExtension)return z.d.Error("Depth texture is not supported by your browser or hardware."),x;const g={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...G};if(this._bindTextureDirectly(C,x,!0),this._setupDepthStencilTexture(x,u,0!==g.comparisonFunction&&g.bilinearFiltering,g.comparisonFunction,g.samples),void 0!==g.depthTextureFormat){if(15!==g.depthTextureFormat&&16!==g.depthTextureFormat&&17!==g.depthTextureFormat&&13!==g.depthTextureFormat&&14!==g.depthTextureFormat&&18!==g.depthTextureFormat)return z.d.Error(`Depth texture ${g.depthTextureFormat} format is not supported.`),x;x.format=g.depthTextureFormat}else x.format=g.generateStencil?13:16;const b=17===x.format||13===x.format||18===x.format;let Q=O.UNSIGNED_INT;15===x.format?Q=O.UNSIGNED_SHORT:17===x.format||13===x.format?Q=O.UNSIGNED_INT_24_8:14===x.format?Q=O.FLOAT:18===x.format&&(Q=O.FLOAT_32_UNSIGNED_INT_24_8_REV);const Y=b?O.DEPTH_STENCIL:O.DEPTH_COMPONENT,n=this._getInternalFormatFromDepthTextureFormat(x.format,!0,b);return x.is2DArray?O.texImage3D(C,0,n,x.width,x.height,m,0,Y,Q,null):x.is3D?O.texImage3D(C,0,n,x.width,x.height,f,0,Y,Q,null):O.texImage2D(C,0,n,x.width,x.height,0,Y,Q,null),this._bindTextureDirectly(C,null),this._internalTexturesCache.push(x),s._depthStencilBuffer&&(O.deleteRenderbuffer(s._depthStencilBuffer),s._depthStencilBuffer=null),this._bindUnboundFramebuffer(s._MSAAFramebuffer??s._framebuffer),s._generateStencilBuffer=b,s._depthStencilTextureWithStencil=b,s._depthStencilBuffer=this._setupFramebufferDepthAttachments(s._generateStencilBuffer,s._generateDepthBuffer,s.width,s.height,s.samples,x.format),this._bindUnboundFramebuffer(null),x},O.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(u,G){var s;if(this.webGLVersion<2||!u)return 1;if(u.samples===G)return G;const T=this._gl;G=Math.min(G,this.getCaps().maxMSAASamples),u._depthStencilBuffer&&(T.deleteRenderbuffer(u._depthStencilBuffer),u._depthStencilBuffer=null),u._MSAAFramebuffer&&(T.deleteFramebuffer(u._MSAAFramebuffer),u._MSAAFramebuffer=null);const z=null===(s=u.texture)||void 0===s?void 0:s._hardwareTexture;if(null===z||void 0===z||z.releaseMSAARenderBuffers(),u.texture&&G>1&&"function"===typeof T.renderbufferStorageMultisample){const s=T.createFramebuffer();if(!s)throw new Error("Unable to create multi sampled framebuffer");u._MSAAFramebuffer=s,this._bindUnboundFramebuffer(u._MSAAFramebuffer);const O=this._createRenderBuffer(u.texture.width,u.texture.height,G,-1,this._getRGBABufferInternalSizedFormat(u.texture.type,u.texture.format,u.texture._useSRGBBuffer),T.COLOR_ATTACHMENT0,!1);if(!O)throw new Error("Unable to create multi sampled framebuffer");null===z||void 0===z||z.addMSAARenderBuffer(O)}this._bindUnboundFramebuffer(u._MSAAFramebuffer??u._framebuffer),u.texture&&(u.texture.samples=G),u._samples=G;const O=u._depthStencilTexture?u._depthStencilTexture.format:void 0;return u._depthStencilBuffer=this._setupFramebufferDepthAttachments(u._generateStencilBuffer,u._generateDepthBuffer,u.width,u.height,G,O),this._bindUnboundFramebuffer(null),G},O.ThinEngine.prototype._setupDepthStencilTexture=function(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const O=G.width??G,m=G.height??G,f=G.layers||0,C=G.depth||0;u.baseWidth=O,u.baseHeight=m,u.width=O,u.height=m,u.is2DArray=f>0,u.depth=f||C,u.isReady=!0,u.samples=z,u.generateMipMaps=!1,u.samplingMode=s?2:1,u.type=0,u._comparisonFunction=T;const x=this._gl,g=this._getTextureTarget(u),b=this._getSamplingParameters(u.samplingMode,!1);x.texParameteri(g,x.TEXTURE_MAG_FILTER,b.mag),x.texParameteri(g,x.TEXTURE_MIN_FILTER,b.min),x.texParameteri(g,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(g,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===T?(x.texParameteri(g,x.TEXTURE_COMPARE_FUNC,515),x.texParameteri(g,x.TEXTURE_COMPARE_MODE,x.NONE)):(x.texParameteri(g,x.TEXTURE_COMPARE_FUNC,T),x.texParameteri(g,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE)))}},10630:(u,G,s)=>{"use strict";s.d(G,{e:()=>p,h:()=>H,i:()=>X,j:()=>R,n:()=>B});class T{constructor(){this.children=[]}isValid(u){return!0}process(u,G){let s="";if(this.line){let x=this.line;const g=G.processor;if(g){var T,z,O,m,f,C;g.lineProcessor&&(x=g.lineProcessor(x,G.isFragment,G.processingContext));const s=(null===(T=G.processor)||void 0===T?void 0:T.attributeKeywordName)??"attribute",b=G.isFragment&&null!==(z=G.processor)&&void 0!==z&&z.varyingFragmentKeywordName?null===(O=G.processor)||void 0===O?void 0:O.varyingFragmentKeywordName:!G.isFragment&&null!==(m=G.processor)&&void 0!==m&&m.varyingVertexKeywordName?null===(f=G.processor)||void 0===f?void 0:f.varyingVertexKeywordName:"varying";if(!G.isFragment&&g.attributeProcessor&&this.line.startsWith(s))x=g.attributeProcessor(this.line,u,G.processingContext);else if(g.varyingProcessor&&(null!==(C=g.varyingCheck)&&void 0!==C&&C.call(g,this.line,G.isFragment)||!g.varyingCheck&&this.line.startsWith(b)))x=g.varyingProcessor(this.line,G.isFragment,u,G.processingContext);else if(g.uniformProcessor&&g.uniformRegexp&&g.uniformRegexp.test(this.line))G.lookForClosingBracketForUniformBuffer||(x=g.uniformProcessor(this.line,G.isFragment,u,G.processingContext));else if(g.uniformBufferProcessor&&g.uniformBufferRegexp&&g.uniformBufferRegexp.test(this.line))G.lookForClosingBracketForUniformBuffer||(x=g.uniformBufferProcessor(this.line,G.isFragment,G.processingContext),G.lookForClosingBracketForUniformBuffer=!0);else if(g.textureProcessor&&g.textureRegexp&&g.textureRegexp.test(this.line))x=g.textureProcessor(this.line,G.isFragment,u,G.processingContext);else if((g.uniformProcessor||g.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!G.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?g.uniformProcessor&&(x=g.uniformProcessor(this.line,G.isFragment,u,G.processingContext)):g.uniformBufferProcessor&&(x=g.uniformBufferProcessor(this.line,G.isFragment,G.processingContext),G.lookForClosingBracketForUniformBuffer=!0)}G.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(G.lookForClosingBracketForUniformBuffer=!1,g.endOfUniformBufferProcessor&&(x=g.endOfUniformBufferProcessor(this.line,G.isFragment,G.processingContext)))}s+=x+"\n"}return this.children.forEach((T=>{s+=T.process(u,G)})),this.additionalDefineKey&&(u[this.additionalDefineKey]=this.additionalDefineValue||"true"),s}}class z{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(u){this._lines.length=0;for(const G of u){if(!G||"\r"===G)continue;if("#"===G[0]){this._lines.push(G);continue}const u=G.trim();if(!u)continue;if(u.startsWith("//")){this._lines.push(G);continue}const s=u.indexOf(";");if(-1===s)this._lines.push(u);else if(s===u.length-1)u.length>1&&this._lines.push(u);else{const u=G.split(";");for(let G=0;G<u.length;G++){let s=u[G];s&&(s=s.trim(),s&&this._lines.push(s+(G!==u.length-1?";":"")))}}}}}class O extends T{process(u,G){for(let s=0;s<this.children.length;s++){const T=this.children[s];if(T.isValid(u))return T.process(u,G)}return""}}class m extends T{isValid(u){return this.testExpression.isTrue(u)}}class f{isTrue(u){return!0}static postfixToInfix(u){const G=[];for(const s of u)if(void 0===f._OperatorPriority[s])G.push(s);else{const u=G[G.length-1],T=G[G.length-2];G.length-=2,G.push(`(${T}${s}${u})`)}return G[G.length-1]}static infixToPostfix(u){const G=f._InfixToPostfixCache.get(u);if(G)return G.accessTime=Date.now(),G.result;if(!u.includes("&&")&&!u.includes("||")&&!u.includes(")")&&!u.includes("("))return[u];const s=[];let T=-1;const z=()=>{g=g.trim(),""!==g&&(s.push(g),g="")},O=u=>{T<f._Stack.length-1&&(f._Stack[++T]=u)},m=()=>f._Stack[T],C=()=>-1===T?"!!INVALID EXPRESSION!!":f._Stack[T--];let x=0,g="";for(;x<u.length;){const G=u.charAt(x),b=x<u.length-1?u.substring(x,2+x):"";if("("===G)g="",O(G);else if(")"===G){for(z();-1!==T&&"("!==m();)s.push(C());C()}else if(f._OperatorPriority[b]>1){for(z();-1!==T&&f._OperatorPriority[m()]>=f._OperatorPriority[b];)s.push(C());O(b),x++}else g+=G;x++}for(z();-1!==T;)"("===m()?C():s.push(C());return f._InfixToPostfixCache.size>=f.InfixToPostfixCacheLimitSize&&f.ClearCache(),f._InfixToPostfixCache.set(u,{result:s,accessTime:Date.now()}),s}static ClearCache(){const u=Array.from(f._InfixToPostfixCache.entries()).sort(((u,G)=>u[1].accessTime-G[1].accessTime));for(let G=0;G<f.InfixToPostfixCacheCleanupSize;G++)f._InfixToPostfixCache.delete(u[G][0])}}f.InfixToPostfixCacheLimitSize=5e4,f.InfixToPostfixCacheCleanupSize=25e3,f._InfixToPostfixCache=new Map,f._OperatorPriority={")":0,"(":1,"||":2,"&&":3},f._Stack=["","","","","","","","","","","","","","","","","","","",""];class C extends f{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=u,this.not=G}isTrue(u){let G=void 0!==u[this.define];return this.not&&(G=!G),G}}class x extends f{isTrue(u){return this.leftOperand.isTrue(u)||this.rightOperand.isTrue(u)}}class g extends f{isTrue(u){return this.leftOperand.isTrue(u)&&this.rightOperand.isTrue(u)}}class b extends f{constructor(u,G,s){super(),this.define=u,this.operand=G,this.testValue=s}isTrue(u){let G=u[this.define];void 0===G&&(G=this.define);let s=!1;const T=parseInt(G),z=parseInt(this.testValue);switch(this.operand){case">":s=T>z;break;case"<":s=T<z;break;case"<=":s=T<=z;break;case">=":s=T>=z;break;case"==":s=T===z;break;case"!=":s=T!==z}return s}}var Q=s(10609),Y=s(10634);const n=/defined\s*?\((.+?)\)/g,V=/defined\s*?\[(.+?)\]/g,F=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,r=/__decl__/,c=/light\{X\}.(\w*)/g,j=/\{X\}/g,l=[],P=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function H(u){u.processor&&u.processor.initializeShaders&&u.processor.initializeShaders(u.processingContext)}function X(u,G,s,T){var z;null!==(z=G.processor)&&void 0!==z&&z.preProcessShaderCode&&(u=G.processor.preProcessShaderCode(u,G.isFragment)),R(u,G,(u=>{G.processCodeAfterIncludes&&(u=G.processCodeAfterIncludes(G.isFragment?"fragment":"vertex",u,G.defines));const z=function(u,G,s){let T=function(u,G){var s;if(null!==(s=G.processor)&&void 0!==s&&s.noPrecision)return u;const T=G.shouldUseHighPrecisionShader;-1===u.indexOf("precision highp float")?u=T?"precision highp float;\n"+u:"precision mediump float;\n"+u:T||(u=u.replace("precision highp float","precision mediump float"));return u}(u,G);if(!G.processor)return T;if(0===G.processor.shaderLanguage&&-1!==T.indexOf("#version 3")&&(T=T.replace("#version 300 es",""),!G.processor.parseGLES3))return T;const z=G.defines,O=o(G,s);G.processor.preProcessor&&(T=G.processor.preProcessor(T,z,O,G.isFragment,G.processingContext));T=M(T,O,G),G.processor.postProcessor&&(T=G.processor.postProcessor(T,z,G.isFragment,G.processingContext,s?{drawBuffersExtensionDisabled:!s.getCaps().drawBuffersExtension}:{}));null!==s&&void 0!==s&&s._features.needShaderCodeInlining&&(T=s.inlineShaderCode(T));return T}(u,G,T);s(z,u)}))}function p(u,G,s){return s.processor&&s.processor.finalizeShaders?s.processor.finalizeShaders(u,G,s.processingContext):{vertexCode:u,fragmentCode:G}}function q(u){const G=/defined\((.+)\)/.exec(u);if(G&&G.length)return new C(G[1].trim(),"!"===u[0]);const s=["==","!=",">=","<=","<",">"];let T="",z=0;for(T of s)if(z=u.indexOf(T),z>-1)break;if(-1===z)return new C(u);const O=u.substring(0,z).trim(),m=u.substring(z+T.length).trim();return new b(O,T,m)}function d(u,G){const s=new m,T=u.substring(0,G);let z=u.substring(G);return z=z.substring(0,(z.indexOf("//")+1||z.length+1)-1).trim(),s.testExpression="#ifdef"===T?new C(z):"#ifndef"===T?new C(z,!0):function(u){u=u.replace(n,"defined[$1]");const G=f.infixToPostfix(u),s=[];for(const z of G)if("||"!==z&&"&&"!==z)s.push(z);else if(s.length>=2){let u=s[s.length-1],G=s[s.length-2];s.length-=2;const T="&&"==z?new g:new x;"string"===typeof u&&(u=u.replace(V,"defined($1)")),"string"===typeof G&&(G=G.replace(V,"defined($1)")),T.leftOperand="string"===typeof G?q(G):G,T.rightOperand="string"===typeof u?q(u):u,s.push(T)}let T=s[s.length-1];return"string"===typeof T&&(T=T.replace(V,"defined($1)")),"string"===typeof T?q(T):T}(z),s}function v(u,G,s){let z=u.currentLine;for(;W(u,s);){z=u.currentLine;const O=z.substring(0,5).toLowerCase();if("#else"===O){const s=new T;return G.children.push(s),void W(u,s)}if("#elif"===O){const u=d(z,5);G.children.push(u),s=u}}}function W(u,G){for(;u.canRead;){u.lineIndex++;const s=u.currentLine;if(s.indexOf("#")>=0){const T=P.exec(s);if(T&&T.length){switch(T[0]){case"#ifdef":{const T=new O;G.children.push(T);const z=d(s,6);T.children.push(z),v(u,T,z);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const T=new O;G.children.push(T);const z=d(s,7);T.children.push(z),v(u,T,z);break}case"#if":{const T=new O,z=d(s,3);G.children.push(T),T.children.push(z),v(u,T,z);break}}continue}}const z=new T;if(z.line=s,G.children.push(z),"#"===s[0]&&"d"===s[1]){const u=s.replace(";","").split(" ");z.additionalDefineKey=u[1],3===u.length&&(z.additionalDefineValue=u[2])}}return!1}function M(u,G,s){const O=new T,m=new z;return m.lineIndex=-1,m.lines=u.split("\n"),W(m,O),O.process(G,s)}function o(u,G){var s;const T=u.defines,z={};for(const O of T){const u=O.replace("#define","").replace(";","").trim().split(" ");z[u[0]]=u.length>1?u[1]:""}return 0===(null===(s=u.processor)||void 0===s?void 0:s.shaderLanguage)&&(z.GL_ES="true"),z.__VERSION__=u.version,z[u.platformName]="true",(0,Y.i)(z,null===G||void 0===G?void 0:G.isNDCHalfZRange,null===G||void 0===G?void 0:G.useReverseDepthBuffer,null===G||void 0===G?void 0:G.useExactSrgbConversions),z}function R(u,G,s){let T;for(l.length=0;null!==(T=F.exec(u));)l.push(T);let z=String(u),O=[u],m=!1;for(const f of l){let u=f[1];if(-1!==u.indexOf("__decl__")&&(u=u.replace(r,""),G.supportsUniformBuffers&&(u=u.replace("Vertex","Ubo").replace("Fragment","Ubo")),u+="Declaration"),!G.includesShadersStore[u]){const T=G.shadersRepository+"ShadersInclude/"+u+".fx";return void B.loadFile(T,(T=>{G.includesShadersStore[u]=T,R(O.join(""),G,s)}))}{let s=G.includesShadersStore[u];if(f[2]){const u=f[3].split(",");for(let G=0;G<u.length;G+=2){const T=new RegExp(u[G],"g"),z=u[G+1];s=s.replace(T,z)}}if(f[4]){const u=f[5];if(-1!==u.indexOf("..")){const T=u.split(".."),z=parseInt(T[0]);let O=parseInt(T[1]),m=s.slice(0);s="",isNaN(O)&&(O=G.indexParameters[T[1]]);for(let u=z;u<O;u++)G.supportsUniformBuffers||(m=m.replace(c,((u,G)=>G+"{X}"))),s+=m.replace(j,u.toString())+"\n"}else G.supportsUniformBuffers||(s=s.replace(c,((u,G)=>G+"{X}"))),s=s.replace(j,u)}const T=[];for(const u of O){const G=u.split(f[0]);for(let u=0;u<G.length-1;u++)T.push(G[u]),T.push(s);T.push(G[G.length-1])}O=T,m=m||s.indexOf("#include<")>=0||s.indexOf("#include <")>=0}}l.length=0,z=O.join(""),m?R(z.toString(),G,s):s(z)}const B={loadFile:(u,G,s,T,z,O)=>{throw(0,Q.c)("FileTools")}}},11327:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{get underlyingResource(){return this._webGLTexture}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=G,!u&&(u=G.createTexture(),!u))throw new Error("Unable to create webGL texture");this.set(u)}setUsage(){}set(u){this._webGLTexture=u}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(u){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(u)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const u of this._MSAARenderBuffers)this._context.deleteRenderbuffer(u);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(u=this._MSAARenderBuffers)||void 0===u?void 0:u[G])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10634:(u,G,s)=>{"use strict";s.d(G,{d:()=>z,f:()=>O,i:()=>f,l:()=>m,m:()=>C});var T=s(10609);s(10577);const z={};function O(u,G){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(G?G+"\n":"")+u}function m(u,G,s,O,m,f,C){const x=C||z.loadFile;if(x){return x(u,G,s,O,m,f)}throw(0,T.c)("FileTools")}function f(u,G,s,T){if(u)return G?u.IS_NDC_HALF_ZRANGE="":delete u.IS_NDC_HALF_ZRANGE,s?u.USE_REVERSE_DEPTHBUFFER="":delete u.USE_REVERSE_DEPTHBUFFER,void(T?u.USE_EXACT_SRGB_CONVERSIONS="":delete u.USE_EXACT_SRGB_CONVERSIONS);{let u="";return G&&(u+="#define IS_NDC_HALF_ZRANGE"),s&&(u&&(u+="\n"),u+="#define USE_REVERSE_DEPTHBUFFER"),T&&(u&&(u+="\n"),u+="#define USE_EXACT_SRGB_CONVERSIONS"),u}}function C(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;switch(u){case 3:{const u=(ArrayBuffer,new Int8Array(G));return T&&u.set(new Int8Array(T)),u}case 0:{const u=(ArrayBuffer,new Uint8Array(G));return T&&u.set(new Uint8Array(T)),u}case 4:{const u=G instanceof ArrayBuffer?new Int16Array(G):new Int16Array(s?G/2:G);return T&&u.set(new Int16Array(T)),u}case 5:case 8:case 9:case 10:case 2:{const u=G instanceof ArrayBuffer?new Uint16Array(G):new Uint16Array(s?G/2:G);return T&&u.set(new Uint16Array(T)),u}case 6:{const u=G instanceof ArrayBuffer?new Int32Array(G):new Int32Array(s?G/4:G);return T&&u.set(new Int32Array(T)),u}case 7:case 11:case 12:case 13:case 14:case 15:{const u=G instanceof ArrayBuffer?new Uint32Array(G):new Uint32Array(s?G/4:G);return T&&u.set(new Uint32Array(T)),u}case 1:{const u=G instanceof ArrayBuffer?new Float32Array(G):new Float32Array(s?G/4:G);return T&&u.set(new Float32Array(T)),u}}const z=(ArrayBuffer,new Uint8Array(G));return T&&z.set(new Uint8Array(T)),z}},10645:(u,G,s)=>{"use strict";s.d(G,{b:()=>j});var T=s(10619),z=s(10584),O=s(10650),m=s(10676),f=s(10601);class C{constructor(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,u&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(u){this._zOffset!==u&&(this._zOffset=u,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(u){this._zOffsetUnits!==u&&(this._zOffsetUnits=u,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(u){this._cullFace!==u&&(this._cullFace=u,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(u){this._cull!==u&&(this._cull=u,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(u){this._depthFunc!==u&&(this._depthFunc=u,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(u){this._depthMask!==u&&(this._depthMask=u,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(u){this._depthTest!==u&&(this._depthTest=u,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(u){this._frontFace!==u&&(this._frontFace=u,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(u){this.isDirty&&(this._isCullDirty&&(this.cull?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(u.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(u.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(u.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(this.zOffset,this.zOffsetUnits)):u.disable(u.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(u.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class x{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(u){this._func!==u&&(this._func=u,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(u){this._funcRef!==u&&(this._funcRef=u,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(u){this._funcMask!==u&&(this._funcMask=u,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(u){this._opStencilFail!==u&&(this._opStencilFail=u,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(u){this._opDepthFail!==u&&(this._opDepthFail=u,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(u){this._opStencilDepthPass!==u&&(this._opStencilDepthPass=u,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(u){this._mask!==u&&(this._mask=u,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(u){this._enabled!==u&&(this._enabled=u,this._isStencilTestDirty=!0)}constructor(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,u&&this.reset()}reset(){var u;this.stencilMaterial=void 0,null===(u=this.stencilGlobal)||void 0===u||u.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(u){var G;if(!u)return;const s=!this.useStencilGlobalOnly&&!(null===(G=this.stencilMaterial)||void 0===G||!G.enabled);this.enabled=s?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=s?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=s?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=s?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=s?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=s?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=s?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=s?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(u.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(u.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(u.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class g{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=g.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=g.KEEP,this.opDepthFail=g.KEEP,this.opStencilDepthPass=g.REPLACE}get stencilFunc(){return this.func}set stencilFunc(u){this.func=u}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(u){this.funcRef=u}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(u){this.funcMask=u}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(u){this.opStencilFail=u}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(u){this.opDepthFail=u}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(u){this.opStencilDepthPass=u}get stencilMask(){return this.mask}set stencilMask(u){this.mask=u}get stencilTest(){return this.enabled}set stencilTest(u){this.enabled=u}}g.ALWAYS=519,g.KEEP=7680,g.REPLACE=7681;class b{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(u){this._alphaBlend!==u&&(this._alphaBlend=u,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(u,G,s,T){this._blendConstants[0]===u&&this._blendConstants[1]===G&&this._blendConstants[2]===s&&this._blendConstants[3]===T||(this._blendConstants[0]=u,this._blendConstants[1]=G,this._blendConstants[2]=s,this._blendConstants[3]=T,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(u,G,s,T){this._blendFunctionParameters[0]===u&&this._blendFunctionParameters[1]===G&&this._blendFunctionParameters[2]===s&&this._blendFunctionParameters[3]===T||(this._blendFunctionParameters[0]=u,this._blendFunctionParameters[1]=G,this._blendFunctionParameters[2]=s,this._blendFunctionParameters[3]=T,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(u,G){this._blendEquationParameters[0]===u&&this._blendEquationParameters[1]===G||(this._blendEquationParameters[0]=u,this._blendEquationParameters[1]=G,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(u){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?u.enable(u.BLEND):u.disable(u.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(u.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(u.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(u.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var Q=s(10609),Y=s(10683),n=s(10577),V=s(10568),F=s(10634),r=s(10698);function c(u,G){if((0,n.k)()){const{requestAnimationFrame:s}=G||window;if("function"===typeof s)return s(u)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(u);return setTimeout(u,16)}class j{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(u){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(u){u!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=u,this._depthCullingState.depthFunc=u?518:515)}setColorWrite(u){u!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=u)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(u){if(u)return this.isNDCHalfZRange?u.IS_NDC_HALF_ZRANGE="":delete u.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?u.USE_REVERSE_DEPTHBUFFER="":delete u.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?u.USE_EXACT_SRGB_CONVERSIONS="":delete u.USE_EXACT_SRGB_CONVERSIONS);{let u="";return this.isNDCHalfZRange&&(u+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(u&&(u+="\n"),u+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(u&&(u+="\n"),u+="#define USE_EXACT_SRGB_CONVERSIONS"),u}}_rebuildInternalTextures(){const u=this._internalTexturesCache.slice();for(const G of u)G._rebuild()}_rebuildRenderTargetWrappers(){const u=this._renderTargetWrapperCache.slice();for(const G of u)G._rebuild()}_rebuildEffects(){for(const u in this._compiledEffects){const G=this._compiledEffects[u];G._pipelineContext=null,G._prepareEffect()}O.e.ResetCache()}_rebuildGraphicsResources(){var u;this.wipeCaches(!0),this._rebuildEffects(),null===(u=this._rebuildComputeEffects)||void 0===u||u.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){z.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(u){setTimeout((async()=>{this._clearEmptyResources();const G=this._depthCullingState.depthTest,s=this._depthCullingState.depthFunc,T=this._depthCullingState.depthMask,z=this._stencilState.stencilTest;await u(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=G,this._depthCullingState.depthFunc=s,this._depthCullingState.depthMask=T,this._stencilState.stencilTest=z,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(u){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(u){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const u=new Uint8Array(4),G=[u,u,u,u,u,u];this._emptyCubeTexture=this.createRawCubeTexture(G,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(u){if(!u)return this._activeRenderLoops.length=0,void this._cancelFrame();const G=this._activeRenderLoops.indexOf(u);G>=0&&(this._activeRenderLoops.splice(G,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const u=this._frameHandler;if(this._frameHandler=0,(0,n.k)()){const{cancelAnimationFrame:G}=this.getHostWindow()||window;if("function"===typeof G)return G(u)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(u);return clearTimeout(u)}}Wi(){this.onBeginFrameObservable.notifyObservers(this)}Xi(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let u=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(u=!1),u&&(this.Wi(),this._renderViews()||this._renderFrame(),this.Xi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let u=0;u<this._activeRenderLoops.length;u++){(0,this._activeRenderLoops[u])()}}_renderViews(){return!1}_queueNewFrame(u,G){return c(u,G)}runRenderLoop(u){-1===this._activeRenderLoops.indexOf(u)&&(this._activeRenderLoops.push(u),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(u){this._depthCullingState.depthTest=u}setZOffset(u){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-u:u}getZOffset(){const u=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-u:u}setZOffsetUnits(u){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-u:u}getZOffsetUnits(){const u=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-u:u}getHostWindow(){return(0,n.k)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(u){this._compatibilityMode=!0}_rebuildTextures(){for(const u of this.scenes)u._rebuildTextures();for(const u of this._virtualScenes)u._rebuildTextures()}_releaseRenderTargetWrapper(u){const G=this._renderTargetWrapperCache.indexOf(u);-1!==G&&this._renderTargetWrapperCache.splice(G,1)}get currentViewport(){return this._cachedViewport}setViewport(u,G,s){const T=G||this.getRenderWidth(),z=s||this.getRenderHeight(),O=u.x||0,m=u.y||0;this._cachedViewport=u,this._viewport(O*T,m*z,T*u.width,z*u.height)}createCanvasImage(){return document.createElement("img")}get description(){let u=this.name+this.version;return this._caps.parallelShaderCompile&&(u+=" - Parallel shader compilation"),u}_createTextureBase(u,G,s,O){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,F=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0,l=arguments.length>15?arguments[15]:void 0;const P="data:"===(u=u||"").substr(0,5),H="blob:"===u.substr(0,5),X=P&&-1!==u.indexOf(";base64,"),p=Q||new Y.d(this,1);p!==Q&&(p.label=u.substring(0,60));const q=u;!this._transformTextureUrl||X||Q||b||(u=this._transformTextureUrl(u)),q!==u&&(p._originalUrl=q);const d=u.lastIndexOf(".");let v=V||(d>-1?u.substring(d).toLowerCase():"");v.indexOf("?")>-1&&(v=v.split("?")[0]);const W=(0,r.c)(v,F);O&&O.addPendingData(p),p.url=u,p.generateMipMaps=!G,p.samplingMode=m,p.invertY=s,p._useSRGBBuffer=this._getUseSRGBBuffer(!!l,G),this._doNotHandleContextLost||(p._buffer=b);let M=null;f&&!Q&&(M=p.onLoadedObservable.add(f)),Q||this._internalTexturesCache.push(p);const o=(s,Q)=>{O&&O.removePendingData(p),u===q?(M&&p.onLoadedObservable.remove(M),T.d.UseFallbackTexture&&u!==T.d.FallbackTexture&&this._createTextureBase(T.d.FallbackTexture,G,p.invertY,O,m,null,C,x,g,b,p),s=(s||"Unknown error")+(T.d.UseFallbackTexture?" - Fallback texture was used":""),p.onErrorObservable.notifyObservers({message:s,exception:Q}),C&&C(s,Q)):(z.d.Warn(`Failed to load ${u}, falling back to ${q}`),this._createTextureBase(q,G,p.invertY,O,m,f,C,x,g,b,p,n,V,F,c,l))};if(W){const G=async u=>{(await W).loadData(u,p,((u,G,s,T,z,f)=>{f?o("TextureLoader failed to load data"):x(p,v,O,{width:u,height:G},p.invertY,!s,T,(()=>(z(),!1)),m)}),c)};b?b instanceof ArrayBuffer?G(new Uint8Array(b)):ArrayBuffer.isView(b)?G(b):C&&C("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(u,(u=>G(new Uint8Array(u))),void 0,O?O.offlineProvider:void 0,!0,((u,G)=>{o("Unable to load "+(u&&u.responseURL,G))}))}else{const s=u=>{H&&!this._doNotHandleContextLost&&(p._buffer=u),x(p,v,O,u,p.invertY,G,!1,g,m)};!P||X?b&&("string"===typeof b.decoding||b.close)?s(b):j._FileToolsLoadImage(u||"",s,o,O?O.offlineProvider:null,F,p.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof b||b instanceof ArrayBuffer||ArrayBuffer.isView(b)||b instanceof Blob?j._FileToolsLoadImage(b,s,o,O?O.offlineProvider:null,F,p.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):b&&s(b)}return p}_rebuildBuffers(){for(const u of this._uniformBuffers)u._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,n.d)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const u in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,u)&&(this._boundTexturesCache[u]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(u){this._name=u}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(u){this._hardwareScalingLevel=u,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(u){this._doNotHandleContextLost=u}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(u,G,s){var z,O;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new C,this._stencilStateComposer=new x,this._stencilState=new g,this._alphaState=new b,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new V.e,this.onCanvasFocusObservable=new V.e,this.onNewSceneAddedObservable=new V.e,this.onResizeObservable=new V.e,this.onCanvasPointerOutObservable=new V.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new V.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new V.e,this.onAfterShaderCompilationObservable=new V.e,this.onBeginFrameObservable=new V.e,this.onEndFrameObservable=new V.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new V.e,this.onContextRestoredObservable=new V.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this._i=new V.e,T.d.Instances.push(this),this.startTime=f.e.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,m.e.SetMatrixPrecision(!!G.useHighPrecisionMatrix),(0,n.h)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=s??!1,G.antialias=u??G.antialias,G.deterministicLockstep=G.deterministicLockstep??!1,G.lockstepMaxSteps=G.lockstepMaxSteps??4,G.timeStep=G.timeStep??1/60,G.audioEngine=G.audioEngine??!0,G.stencil=G.stencil??!0,this._audioContext=(null===(z=G.audioEngineOptions)||void 0===z?void 0:z.audioContext)??null,this._audioDestination=(null===(O=G.audioEngineOptions)||void 0===O?void 0:O.audioDestination)??null,this.premultipliedAlpha=G.premultipliedAlpha??!0,this._doNotHandleContextLost=!!G.doNotHandleContextLost,this._isStencilEnable=!!G.stencil,this.useExactSrgbConversions=G.useExactSrgbConversions??!1;const Q=(0,n.k)()&&window.devicePixelRatio||1,Y=G.limitDeviceRatio||Q;s=s||G.adaptToDeviceRatio||!1,this._hardwareScalingLevel=s?1/Math.min(Y,Q):1,this._lastDevicePixelRatio=Q,this._creationOptions=G}resize(){let u,G,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const u=(0,n.k)()&&window.devicePixelRatio||1,G=this._lastDevicePixelRatio/u;this._lastDevicePixelRatio=u,this._hardwareScalingLevel*=G}if((0,n.k)()&&(0,n.d)())if(this._renderingCanvas){const s=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};u=this._renderingCanvas.clientWidth||s.width||this._renderingCanvas.width||100,G=this._renderingCanvas.clientHeight||s.height||this._renderingCanvas.height||100}else u=window.innerWidth,G=window.innerHeight;else u=this._renderingCanvas?this._renderingCanvas.width:100,G=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(u/this._hardwareScalingLevel,G/this._hardwareScalingLevel,s)}setSize(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(u|=0,G|=0,!s&&this._renderingCanvas.width===u&&this._renderingCanvas.height===G)return!1;if(this._renderingCanvas.width=u,this._renderingCanvas.height=G,this.scenes){for(let u=0;u<this.scenes.length;u++){const G=this.scenes[u];for(let u=0;u<G.cameras.length;u++){G.cameras[u]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(u,G,s,T,z,O,m,f,C,x,g){throw(0,Q.c)("engine.rawTexture")}createRawCubeTexture(u,G,s,T,z,O,m,f){throw(0,Q.c)("engine.rawTexture")}createRawTexture3D(u,G,s,T,z,O,m,f,C,x,g){throw(0,Q.c)("engine.rawTexture")}createRawTexture2DArray(u,G,s,T,z,O,m,f,C,x,g){throw(0,Q.c)("engine.rawTexture")}_sharedInit(u){this._renderingCanvas=u}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const u=navigator.userAgent;this.hostInformation.isMobile=-1!==u.indexOf("Mobile")||-1!==u.indexOf("Mac")&&(0,n.d)()&&"ontouchend"in document},this._checkForMobile(),(0,n.k)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(u){return document.createElement("video")}_reportDrawCall(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(u=this._drawCalls)||void 0===u||u.addCount(G,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(u,G){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(u,G){return createImageBitmap(u,G)}resizeImageBitmap(u,G,s){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(u){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(u,G){if("undefined"===typeof document)return new OffscreenCanvas(u,G);const s=document.createElement("canvas");return s.width=u,s.height=G,s}createCanvas(u,G){return j._CreateCanvas(u,G)}static _FileToolsLoadImage(u,G,s,T,z,O){throw(0,Q.c)("FileTools")}_loadFile(u,G,s,T,z,O){const m=(0,F.l)(u,G,s,T,z,O);return this._activeRequests.push(m),m.onCompleteObservable.add((()=>{const u=this._activeRequests.indexOf(m);-1!==u&&this._activeRequests.splice(u,1)})),m}static _FileToolsLoadFile(u,G,s,T,z,O){if(F.d.loadFile)return F.d.loadFile(u,G,s,T,z,O);throw(0,Q.c)("FileTools")}dispose(){var u;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(u=this.releaseComputeEffects)||void 0===u||u.call(this),O.e.ResetCache();for(const s of this._activeRequests)s.abort();this._boundRenderFunction=null,this._i.notifyObservers(this),this._i.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,n.k)()&&window.removeEventListener("resize",this._checkForMobile);const G=T.d.Instances.indexOf(this);G>=0&&T.d.Instances.splice(G,1),T.d.Instances.length||(T.d.OnEnginesDisposedObservable.notifyObservers(this),T.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(u){throw(0,Q.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(u,G){for(let s=0;s<T.d.Instances.length;s++){const z=T.d.Instances[s];for(let s=0;s<z.scenes.length;s++)z.scenes[s].markAllMaterialsAsDirty(u,G)}}}j._RenderPassIdCounter=0,j._RescalePostProcessFactory=null,j.CollisionsEpsilon=.001,j.QueueNewFrame=c},11350:(u,G,s)=>{"use strict";s.d(G,{d:()=>p});var T=s(10683),z=s(10619),O=s(11312),m=s(10601);class f{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new C(u)}sampleFrame(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.e.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const G=u-this._lastFrameTimeMs;this._rollingFrameTime.add(G)}this._lastFrameTimeMs=u}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const u=this._rollingFrameTime.history(0);return 0===u?0:1e3/u}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class C{constructor(u){this._samples=new Array(u),this.reset()}add(u){let G;if(this.isSaturated()){const u=this._samples[this._pos];G=u-this.average,this.average-=G/(this._sampleCount-1),this._m2-=G*(u-this.average)}else this._sampleCount++;G=u-this.average,this.average+=G/this._sampleCount,this._m2+=G*(u-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=u,this._pos++,this._pos%=this._samples.length}history(u){if(u>=this._sampleCount||u>=this._samples.length)return 0;const G=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(G-u)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(u){const G=this._samples.length;return(u%G+G)%G}}var x=s(11319),g=s(10584),b=s(11327),Q=(s(11341),s(10725));function Y(u,G,s,T){let z,O=1;1===T?z=new Float32Array(G*s*4):2===T?(z=new Uint16Array(G*s*4),O=15360):z=7===T?new Uint32Array(G*s*4):new Uint8Array(G*s*4);for(let m=0;m<G;m++)for(let T=0;T<s;T++){const s=3*(T*G+m),f=4*(T*G+m);z[f+0]=u[s+0],z[f+1]=u[s+1],z[f+2]=u[s+2],z[f+3]=O}return z}function n(u){return function(G,s,z,O,m,f,C,x){let g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const Q=u?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,Y=u?10:11,n=new T.d(this,Y);n.baseWidth=s,n.baseHeight=z,n.baseDepth=O,n.width=s,n.height=z,n.depth=O,n.format=m,n.type=b,n.generateMipMaps=f,n.samplingMode=x,u?n.is3D=!0:n.is2DArray=!0,this._doNotHandleContextLost||(n._bufferView=G),u?this.updateRawTexture3D(n,G,m,C,g,b):this.updateRawTexture2DArray(n,G,m,C,g,b),this._bindTextureDirectly(Q,n,!0);const V=this._getSamplingParameters(x,f);return this._gl.texParameteri(Q,this._gl.TEXTURE_MAG_FILTER,V.mag),this._gl.texParameteri(Q,this._gl.TEXTURE_MIN_FILTER,V.min),f&&this._gl.generateMipmap(Q),this._bindTextureDirectly(Q,null),this._internalTexturesCache.push(n),n}}function V(u){return function(G,s,T,z){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const f=u?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,C=this._getWebGLTextureType(m),x=this._getInternalFormat(T),g=this._getRGBABufferInternalSizedFormat(m,T);this._bindTextureDirectly(f,G,!0),this._unpackFlipY(void 0===z||!!z),this._doNotHandleContextLost||(G._bufferView=s,G.format=T,G.invertY=z,G._compression=O),G.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),O&&s?this._gl.compressedTexImage3D(f,0,this.getCaps().s3tc[O],G.width,G.height,G.depth,0,s):this._gl.texImage3D(f,0,g,G.width,G.height,G.depth,0,x,C,s),G.generateMipMaps&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),G.isReady=!0}}O.ThinEngine.prototype.updateRawTexture=function(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!u)return;const f=this._getRGBABufferInternalSizedFormat(O,s,m),C=this._getInternalFormat(s),x=this._getWebGLTextureType(O);this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0),this._unpackFlipY(void 0===T||!!T),this._doNotHandleContextLost||(u._bufferView=G,u.format=s,u.type=O,u.invertY=T,u._compression=z),u.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),z&&G?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[z],u.width,u.height,0,G):this._gl.texImage2D(this._gl.TEXTURE_2D,0,f,u.width,u.height,0,C,x,G),u.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),u.isReady=!0},O.ThinEngine.prototype.createRawTexture=function(u,G,s,z,O,m,f){let C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const b=new T.d(this,3);b.baseWidth=G,b.baseHeight=s,b.width=G,b.height=s,b.format=z,b.generateMipMaps=O,b.samplingMode=f,b.invertY=m,b._compression=C,b.type=x,b._useSRGBBuffer=this._getUseSRGBBuffer(g,!O),this._doNotHandleContextLost||(b._bufferView=u),this.updateRawTexture(b,u,z,m,C,x,b._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,b,!0);const Q=this._getSamplingParameters(f,O);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,Q.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,Q.min),O&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(b),b},O.ThinEngine.prototype.createRawCubeTexture=function(u,G,s,z,O,m,f){let C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const x=this._gl,b=new T.d(this,8);b.isCube=!0,b.format=s,b.type=z,this._doNotHandleContextLost||(b._bufferViewArray=u);const Y=this._getWebGLTextureType(z);let n=this._getInternalFormat(s);n===x.RGB&&(n=x.RGBA),Y!==x.FLOAT||this._caps.textureFloatLinearFiltering?Y!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?Y!==x.FLOAT||this._caps.textureFloatRender?Y!==x.HALF_FLOAT||this._caps.colorBufferFloat||(O=!1,g.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(O=!1,g.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(O=!1,f=1,g.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(O=!1,f=1,g.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const V=G,F=V;b.width=V,b.height=F,b.invertY=m,b._compression=C;if(!this.needPOTTextures||(0,Q.k)(b.width)&&(0,Q.k)(b.height)||(O=!1),u)this.updateRawCubeTexture(b,u,s,z,m,C);else{const u=this._getRGBABufferInternalSizedFormat(z),G=0;this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,b,!0);for(let s=0;s<6;s++)C?x.compressedTexImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+s,G,this.getCaps().s3tc[C],b.width,b.height,0,void 0):x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+s,G,u,b.width,b.height,0,n,Y,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,b,!0),u&&O&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const r=this._getSamplingParameters(f,O);return x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MAG_FILTER,r.mag),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MIN_FILTER,r.min),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,null),b.generateMipMaps=O,b.samplingMode=f,b.isReady=!0,b},O.ThinEngine.prototype.updateRawCubeTexture=function(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;u._bufferViewArray=G,u.format=s,u.type=T,u.invertY=z,u._compression=O;const f=this._gl,C=this._getWebGLTextureType(T);let x=this._getInternalFormat(s);const g=this._getRGBABufferInternalSizedFormat(T);let b=!1;x===f.RGB&&(x=f.RGBA,b=!0),this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(void 0===z||!!z),u.width%4!==0&&f.pixelStorei(f.UNPACK_ALIGNMENT,1);for(let Q=0;Q<6;Q++){let s=G[Q];O?f.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+Q,m,this.getCaps().s3tc[O],u.width,u.height,0,s):(b&&(s=Y(s,u.width,u.height,T)),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+Q,m,g,u.width,u.height,0,x,C,s))}(!this.needPOTTextures||(0,Q.k)(u.width)&&(0,Q.k)(u.height))&&u.generateMipMaps&&0===m&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),u.isReady=!0},O.ThinEngine.prototype.createRawCubeTextureFromUrl=function(u,G,s,T,z,O,m,f){let C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,b=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const Q=this._gl,n=this.createRawCubeTexture(null,s,T,z,!O,b,g,null);null===G||void 0===G||G.addPendingData(n),n.url=u,n.isReady=!1,this._internalTexturesCache.push(n);const V=u=>{const s=n.width,O=m(u);if(O){if(f){const u=this._getWebGLTextureType(z);let G=this._getInternalFormat(T);const m=this._getRGBABufferInternalSizedFormat(z);let C=!1;G===Q.RGB&&(G=Q.RGBA,C=!0),this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,n,!0),this._unpackFlipY(!1);const x=f(O);for(let T=0;T<x.length;T++){const O=s>>T;for(let s=0;s<6;s++){let f=x[T][s];C&&(f=Y(f,O,O,z)),Q.texImage2D(s,T,m,O,O,0,G,u,f)}}this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(n,O,T,z,b);n.isReady=!0,null===G||void 0===G||G.removePendingData(n),n.onLoadedObservable.notifyObservers(n),n.onLoadedObservable.clear(),C&&C()}};return this._loadFile(u,(u=>{V(u)}),void 0,null===G||void 0===G?void 0:G.offlineProvider,!0,((u,s)=>{null===G||void 0===G||G.removePendingData(n),x&&u&&x(u.status+" "+u.statusText,s)})),n},O.ThinEngine.prototype.createRawTexture2DArray=n(!1),O.ThinEngine.prototype.createRawTexture3D=n(!0),O.ThinEngine.prototype.updateRawTexture2DArray=V(!1),O.ThinEngine.prototype.updateRawTexture3D=V(!0);var F=s(10634);O.ThinEngine.prototype._readTexturePixelsSync=function(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const g=this._gl;if(!g)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const u=g.createFramebuffer();if(!u)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=u}var b,Q;(g.bindFramebuffer(g.FRAMEBUFFER,this._dummyFramebuffer),T>-1)?g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+T,null===(b=u._hardwareTexture)||void 0===b?void 0:b.underlyingResource,z):g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,null===(Q=u._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,z);let Y=void 0!==u.type?this._getWebGLTextureType(u.type):g.UNSIGNED_BYTE;if(f)O||(O=(0,F.m)(u.type,4*G*s));else if(Y===g.UNSIGNED_BYTE)O||(O=new Uint8Array(4*G*s)),Y=g.UNSIGNED_BYTE;else O||(O=new Float32Array(4*G*s)),Y=g.FLOAT;return m&&this.flushFramebuffer(),g.readPixels(C,x,G,s,g.RGBA,Y,O),g.bindFramebuffer(g.FRAMEBUFFER,this._currentFramebuffer),O},O.ThinEngine.prototype._readTexturePixels=function(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(u,G,s,T,z,O,m,f,C,x))};s(11308);O.ThinEngine.prototype._createDepthStencilCubeTexture=function(u,G){const s=new T.d(this,12);if(s.isCube=!0,1===this.webGLVersion)return g.d.Error("Depth cube texture is not supported by WebGL 1."),s;const z={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...G},O=this._gl;this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,s,!0),this._setupDepthStencilTexture(s,u,z.bilinearFiltering,z.comparisonFunction);for(let T=0;T<6;T++)z.generateStencil?O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,O.DEPTH24_STENCIL8,u,u,0,O.DEPTH_STENCIL,O.UNSIGNED_INT_24_8,null):O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,O.DEPTH_COMPONENT24,u,u,0,O.DEPTH_COMPONENT,O.UNSIGNED_INT,null);return this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(s),s},O.ThinEngine.prototype._setCubeMapTextureParams=function(u,G,s){const T=this._gl;T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MAG_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MIN_FILTER,G?T.LINEAR_MIPMAP_LINEAR:T.LINEAR),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),u.samplingMode=G?3:2,G&&this.getCaps().textureMaxLevel&&void 0!==s&&s>0&&(T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MAX_LEVEL,s),u._maxLodLevel=s),this._bindTextureDirectly(T.TEXTURE_CUBE_MAP,null)},O.ThinEngine.prototype.createCubeTexture=function(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,n=arguments.length>13&&void 0!==arguments[13]&&arguments[13],V=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const F=this._gl;return this.createCubeTextureBase(u,G,s,!!T,z,O,m,f,C,x,b,Y,(u=>this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,u,!0)),((u,G)=>{const s=this.needPOTTextures?(0,Q.h)(G[0].width,this._caps.maxCubemapTextureSize):G[0].width,O=s,f=[F.TEXTURE_CUBE_MAP_POSITIVE_X,F.TEXTURE_CUBE_MAP_POSITIVE_Y,F.TEXTURE_CUBE_MAP_POSITIVE_Z,F.TEXTURE_CUBE_MAP_NEGATIVE_X,F.TEXTURE_CUBE_MAP_NEGATIVE_Y,F.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(!1);const C=m?this._getInternalFormat(m,u._useSRGBBuffer):u._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:F.RGBA;let x=m?this._getInternalFormat(m):F.RGBA;u._useSRGBBuffer&&1===this.webGLVersion&&(x=C);for(let T=0;T<f.length;T++)if(G[T].width!==s||G[T].height!==O){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void g.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=s,this._workingCanvas.height=O,this._workingContext.drawImage(G[T],0,0,G[T].width,G[T].height,0,0,s,O),F.texImage2D(f[T],0,C,x,F.UNSIGNED_BYTE,this._workingCanvas)}else F.texImage2D(f[T],0,C,x,F.UNSIGNED_BYTE,G[T]);T||F.generateMipmap(F.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(u,!T),u.width=s,u.height=O,u.isReady=!0,m&&(u.format=m),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear(),z&&z()}),!!n,V)},O.ThinEngine.prototype.generateMipMapsForCubemap=function(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(u.generateMipMaps){const s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,u,!0),s.generateMipmap(s.TEXTURE_CUBE_MAP),G&&this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null)}};s(11358);O.ThinEngine.prototype.setDepthStencilTexture=function(u,G,s,T){void 0!==u&&(G&&(this._boundUniforms[u]=G),s&&s.depthStencilTexture?this._setTexture(u,s,!1,!0,T):this._setTexture(u,null,void 0,void 0,T))},O.ThinEngine.prototype.createRenderTargetCubeTexture=function(u,G){const s=this._createHardwareRenderTargetWrapper(!1,!0,u),z={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...G};z.generateStencilBuffer=z.generateDepthBuffer&&z.generateStencilBuffer,(1!==z.type||this._caps.textureFloatLinearFiltering)&&(2!==z.type||this._caps.textureHalfFloatLinearFiltering)||(z.samplingMode=1);const O=this._gl,m=new T.d(this,5);this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,m,!0);const f=this._getSamplingParameters(z.samplingMode,z.generateMipMaps);1!==z.type||this._caps.textureFloat||(z.type=0,g.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,f.mag),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,f.min),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE);for(let T=0;T<6;T++)O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+T,0,this._getRGBABufferInternalSizedFormat(z.type,z.format),u,u,0,this._getInternalFormat(z.format),this._getWebGLTextureType(z.type),null);const C=O.createFramebuffer();return this._bindUnboundFramebuffer(C),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(z.generateStencilBuffer,z.generateDepthBuffer,u,u),z.generateMipMaps&&O.generateMipmap(O.TEXTURE_CUBE_MAP),this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),s._framebuffer=C,s._generateDepthBuffer=z.generateDepthBuffer,s._generateStencilBuffer=z.generateStencilBuffer,m.width=u,m.height=u,m.isReady=!0,m.isCube=!0,m.samples=1,m.generateMipMaps=z.generateMipMaps,m.samplingMode=z.samplingMode,m.type=z.type,m.format=z.format,this._internalTexturesCache.push(m),s.setTextures(m),s};var r=s(11378),c=s(11107),j=s(11388);O.ThinEngine.prototype.createPrefilteredCubeTexture=function(u,G,s,z){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6?arguments[6]:void 0,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(u,G,null,!1,(u=>{if(!u)return void(O&&O(null));const m=u.texture;if(x?u.info.sphericalPolynomial&&(m._sphericalPolynomial=u.info.sphericalPolynomial):m._sphericalPolynomial=new r.h,m._source=9,this.getCaps().textureLOD)return void(O&&O(m));const f=this._gl,C=u.width;if(!C)return;const b=[];for(let O=0;O<3;O++){const x=1-O/2,Q=z,Y=Math.log2(C)*s+z,n=Q+(Y-Q)*x,V=Math.round(Math.min(Math.max(n,0),Y)),F=new T.d(this,2);if(F.type=m.type,F.format=m.format,F.width=Math.pow(2,Math.max(Math.log2(C)-V,0)),F.height=F.width,F.isCube=!0,F._cachedWrapU=0,F._cachedWrapV=0,this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,F,!0),F.samplingMode=2,f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),u.isDDS){const G=u.info,s=u.data;this._unpackFlipY(G.isCompressed),j.e.UploadDDSLevels(this,F,s,G,!0,6,V)}else g.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null);const r=new c.c(G);r._isCube=!0,r._texture=F,F.isReady=!0,b.push(r)}m._lodTextureHigh=b[2],m._lodTextureMid=b[1],m._lodTextureLow=b[0],O&&O(m)}),m,f,C,x,s,z)},O.ThinEngine.prototype.createUniformBuffer=function(u,G){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create uniform buffer");const T=new x.e(s);return this.bindUniformBuffer(T),u instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,u,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(u),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),T.references=1,T},O.ThinEngine.prototype.createDynamicUniformBuffer=function(u,G){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create dynamic uniform buffer");const T=new x.e(s);return this.bindUniformBuffer(T),u instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,u,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(u),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),T.references=1,T},O.ThinEngine.prototype.updateUniformBuffer=function(u,G,s,T){this.bindUniformBuffer(u),void 0===s&&(s=0),void 0===T?G instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,G):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,new Float32Array(G)):G instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,G.subarray(s,s+T)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(G).subarray(s,s+T)),this.bindUniformBuffer(null)},O.ThinEngine.prototype.bindUniformBuffer=function(u){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,u?u.underlyingResource:null)},O.ThinEngine.prototype.bindUniformBufferBase=function(u,G,s){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,G,u?u.underlyingResource:null)},O.ThinEngine.prototype.bindUniformBlock=function(u,G,s){const T=u.program,z=this._gl.getUniformBlockIndex(T,G);4294967295!==z&&this._gl.uniformBlockBinding(T,z,s)};var l=s(10577),P=s(10645);P.b.prototype.displayLoadingUI=function(){if(!(0,l.k)())return;const u=this.loadingScreen;u&&u.displayLoadingUI()},P.b.prototype.hideLoadingUI=function(){if(!(0,l.k)())return;const u=this._loadingScreen;u&&u.hideLoadingUI()},Object.defineProperty(P.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=P.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(u){this._loadingScreen=u},enumerable:!0,configurable:!0}),Object.defineProperty(P.b.prototype,"loadingUIText",{set:function(u){this.loadingScreen.loadingUIText=u},enumerable:!0,configurable:!0}),Object.defineProperty(P.b.prototype,"loadingUIBackgroundColor",{set:function(u){this.loadingScreen.loadingUIBackgroundColor=u},enumerable:!0,configurable:!0}),P.b.prototype.getInputElement=function(){return this._renderingCanvas},P.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},P.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},P.b.prototype.getAspectRatio=function(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=u.viewport;return this.getRenderWidth(G)*s.width/(this.getRenderHeight(G)*s.height)},P.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},P.b.prototype._verifyPointerLock=function(){var u;null===(u=this._onPointerLockChange)||void 0===u||u.call(this)},P.b.prototype.setAlphaEquation=function(u){if(this._alphaEquation!==u){switch(u){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=u}},P.b.prototype.getInputElement=function(){return this._renderingCanvas},P.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},P.b.prototype.setDepthFunction=function(u){this._depthCullingState.depthFunc=u},P.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},P.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},P.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},P.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},P.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},P.b.prototype.setDepthWrite=function(u){this._depthCullingState.depthMask=u},P.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},P.b.prototype.setStencilBuffer=function(u){this._stencilState.stencilTest=u},P.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},P.b.prototype.setStencilMask=function(u){this._stencilState.stencilMask=u},P.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},P.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},P.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},P.b.prototype.setStencilFunction=function(u){this._stencilState.stencilFunc=u},P.b.prototype.setStencilFunctionReference=function(u){this._stencilState.stencilFuncRef=u},P.b.prototype.setStencilFunctionMask=function(u){this._stencilState.stencilFuncMask=u},P.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},P.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},P.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},P.b.prototype.setStencilOperationFail=function(u){this._stencilState.stencilOpStencilFail=u},P.b.prototype.setStencilOperationDepthFail=function(u){this._stencilState.stencilOpDepthFail=u},P.b.prototype.setStencilOperationPass=function(u){this._stencilState.stencilOpStencilDepthPass=u},P.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},P.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},P.b.prototype.setAlphaConstants=function(u,G,s,T){this._alphaState.setAlphaBlendConstants(u,G,s,T)},P.b.prototype.getAlphaMode=function(){return this._alphaMode},P.b.prototype.getAlphaEquation=function(){return this._alphaEquation},P.b.prototype.getRenderPassNames=function(){return this._renderPassNames},P.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},P.b.prototype.createRenderPassId=function(u){const G=++P.b._RenderPassIdCounter;return this._renderPassNames[G]=u??"NONAME",G},P.b.prototype.releaseRenderPassId=function(u){this._renderPassNames[u]=void 0;for(let G=0;G<this.scenes.length;++G){const s=this.scenes[G];for(let G=0;G<s.meshes.length;++G){const T=s.meshes[G];if(T.xf)for(let G=0;G<T.xf.length;++G){T.xf[G]._removeDrawWrapper(u)}}}};s(11369);function H(u){if(u.requestPointerLock){const G=u.requestPointerLock();G instanceof Promise?G.then((()=>{u.focus()})).catch((()=>{})):u.focus()}}var X=s(10734);s(11436);class p extends O.ThinEngine{static get NpmPackage(){return P.b.NpmPackage}static get Version(){return P.b.Version}static get Instances(){return z.d.Instances}static get LastCreatedEngine(){return z.d.LastCreatedEngine}static get LastCreatedScene(){return z.d.LastCreatedScene}static DefaultLoadingScreenFactory(u){return P.b.DefaultLoadingScreenFactory(u)}get _supportsHardwareTextureRescaling(){return!!p._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(u,G,s){if(super(u,G,s,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new f,this._drawCalls=new X.e,u&&(this._features.supportRenderPasses=!0,s=this._creationOptions,u.getContext)){const G=u;this._sharedInit(G)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(u){super._sharedInit(u),function(u,G,s){u._onCanvasFocus=()=>{u.onCanvasFocusObservable.notifyObservers(u)},u._onCanvasBlur=()=>{u.onCanvasBlurObservable.notifyObservers(u)},u._onCanvasContextMenu=G=>{u.disableContextMenu&&G.preventDefault()},G.addEventListener("focus",u._onCanvasFocus),G.addEventListener("blur",u._onCanvasBlur),G.addEventListener("contextmenu",u._onCanvasContextMenu),u._onBlur=()=>{u.disablePerformanceMonitorInBackground&&u.performanceMonitor.disable(),u._windowIsBackground=!0},u._onFocus=()=>{u.disablePerformanceMonitorInBackground&&u.performanceMonitor.enable(),u._windowIsBackground=!1},u._onCanvasPointerOut=s=>{document.elementFromPoint(s.clientX,s.clientY)!==G&&u.onCanvasPointerOutObservable.notifyObservers(s)};const T=u.getHostWindow();T&&"function"===typeof T.addEventListener&&(T.addEventListener("blur",u._onBlur),T.addEventListener("focus",u._onFocus)),G.addEventListener("pointerout",u._onCanvasPointerOut),s.doNotHandleTouchAction||function(u){u&&u.setAttribute&&(u.setAttribute("touch-action","none"),u.style.touchAction="none",u.style.webkitTapHighlightColor="transparent")}(G),!P.b.audioEngine&&s.audioEngine&&P.b.AudioEngineFactory&&(P.b.audioEngine=P.b.AudioEngineFactory(u.getRenderingCanvas(),u.getAudioContext(),u.getAudioDestination())),(0,l.d)()&&(u._onFullscreenChange=()=>{u.isFullscreen=!!document.fullscreenElement,u.isFullscreen&&u._pointerLockRequested&&G&&H(G)},document.addEventListener("fullscreenchange",u._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",u._onFullscreenChange,!1),u._onPointerLockChange=()=>{u.isPointerLock=document.pointerLockElement===G},document.addEventListener("pointerlockchange",u._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",u._onPointerLockChange,!1)),u.enableOfflineSupport=void 0!==P.b.OfflineProviderFactory,u._deterministicLockstep=!!s.deterministicLockstep,u._lockstepMaxSteps=s.lockstepMaxSteps||0,u._timeStep=s.timeStep||1/60}(this,u,this._creationOptions)}resizeImageBitmap(u,G,s){return function(u,G,s,T){const z=u.createCanvas(s,T).getContext("2d");if(!z)throw new Error("Unable to get 2d context for resizeImageBitmap");return z.drawImage(G,0,0),z.getImageData(0,0,s,T).data}(this,u,G,s)}_createImageBitmapFromSource(u,G){return function(u,G,s){return new Promise(((T,z)=>{const O=new Image;O.onload=()=>{O.decode().then((()=>{u.createImageBitmap(O,s).then((u=>{T(u)}))}))},O.onerror=()=>{z(`Error loading image ${O.src}`)},O.src=G}))}(this,u,G)}switchFullscreen(u){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(u)}enterFullscreen(u){this.isFullscreen||(this._pointerLockRequested=u,this._renderingCanvas&&function(u){const G=u.requestFullscreen||u.webkitRequestFullscreen;G&&G.call(u)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const u=document;document.exitFullscreen?document.exitFullscreen():u.webkitCancelFullScreen&&u.webkitCancelFullScreen()}()}setDitheringState(u){u?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(u){u?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(u,G,s,T){const z=this._cachedViewport;return this._cachedViewport=null,this._viewport(u,G,s,T),z}scissorClear(u,G,s,T,z){this.enableScissor(u,G,s,T),this.clear(z,!0,!0,!0),this.disableScissor()}enableScissor(u,G,s,T){const z=this._gl;z.enable(z.SCISSOR_TEST),z.scissor(u,G,s,T)}disableScissor(){const u=this._gl;u.disable(u.SCISSOR_TEST)}_loadFileAsync(u,G,s){return new Promise(((T,z)=>{this._loadFile(u,(u=>{T(u)}),void 0,G,s,((u,G)=>{z(G)}))}))}getVertexShaderSource(u){const G=this._gl.getAttachedShaders(u);return G?this._gl.getShaderSource(G[0]):null}getFragmentShaderSource(u){const G=this._gl.getAttachedShaders(u);return G?this._gl.getShaderSource(G[1]):null}set framebufferDimensionsObject(u){this._framebufferDimensionsObject=u,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const u of this.scenes)u.resetCachedMaterial(),u._rebuildGeometries();for(const u of this._virtualScenes)u.resetCachedMaterial(),u._rebuildGeometries();super._rebuildBuffers()}getFontOffset(u){return function(u){const G=document.createElement("span");G.textContent="Hg",G.style.font=u;const s=document.createElement("div");s.style.display="inline-block",s.style.width="1px",s.style.height="0px",s.style.verticalAlign="bottom";const T=document.createElement("div");T.style.whiteSpace="nowrap",T.appendChild(G),T.appendChild(s),document.body.appendChild(T);let z=0,O=0;try{O=s.getBoundingClientRect().top-G.getBoundingClientRect().top,s.style.verticalAlign="baseline",z=s.getBoundingClientRect().top-G.getBoundingClientRect().top}finally{document.body.removeChild(T)}return{ascent:z,height:O,descent:O-z}}(u)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:u}=this.customAnimationFrameRequester;u&&u(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let u=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(u=!1),u&&(this.Wi(),this._renderViews()||this._renderFrame(),this.Xi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&H(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Wi(){this._measureFps(),super.Wi()}_deletePipelineContext(u){const G=u;G&&G.program&&G.transformFeedback&&(this.deleteTransformFeedback(G.transformFeedback),G.transformFeedback=null),super._deletePipelineContext(u)}createShaderProgram(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;z=z||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const m=super.createShaderProgram(u,G,s,T,z,O);return this.onAfterShaderCompilationObservable.notifyObservers(this),m}_createShaderProgram(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const O=T.createProgram();if(u.program=O,!O)throw new Error("Unable to create program");if(T.attachShader(O,G),T.attachShader(O,s),this.webGLVersion>1&&z){const G=this.createTransformFeedback();this.bindTransformFeedback(G),this.setTranformFeedbackVaryings(O,z),u.transformFeedback=G}return T.linkProgram(O),this.webGLVersion>1&&z&&this.bindTransformFeedback(null),u.context=T,u.vertexShader=G,u.fragmentShader=s,u.isParallelCompiled||this._finalizePipelineContext(u),O}_releaseTexture(u){super._releaseTexture(u)}_releaseRenderTargetWrapper(u){super._releaseRenderTargetWrapper(u),this.scenes.forEach((G=>{G.postProcesses.forEach((G=>{G._outputTexture===u&&(G._outputTexture=null)})),G.cameras.forEach((G=>{G._postProcesses.forEach((G=>{G&&G._outputTexture===u&&(G._outputTexture=null)}))}))}))}_rescaleTexture(u,G,s,T,z){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const O=this.createRenderTargetTexture({width:G.width,height:G.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&p._RescalePostProcessFactory&&(this._rescalePostProcess=p._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const m=()=>{this._rescalePostProcess.onApply=function(G){G._bindTexture("textureSampler",u)};let m=s;m||(m=this.scenes[this.scenes.length-1]),m.postProcessManager.directRender([this._rescalePostProcess],O,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,G,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,T,0,0,G.width,G.height,0),this.unBindFramebuffer(O),O.dispose(),z&&z()},f=this._rescalePostProcess.getEffect();f?f.executeWhenCompiled(m):this._rescalePostProcess.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled(m)}))}}wrapWebGLTexture(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const m=new b.e(u,this._gl),f=new T.d(this,0,!0);return f._hardwareTexture=m,f.baseWidth=z,f.baseHeight=O,f.width=z,f.height=O,f.isReady=!0,f.useMipMaps=G,this.updateTextureSamplingMode(s,f),f}_uploadImageToTexture(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const z=this._gl,O=this._getWebGLTextureType(u.type),m=this._getInternalFormat(u.format),f=this._getRGBABufferInternalSizedFormat(u.type,m),C=u.isCube?z.TEXTURE_CUBE_MAP:z.TEXTURE_2D;this._bindTextureDirectly(C,u,!0),this._unpackFlipY(u.invertY);let x=z.TEXTURE_2D;u.isCube&&(x=z.TEXTURE_CUBE_MAP_POSITIVE_X+s),z.texImage2D(x,T,f,m,O,G),this._bindTextureDirectly(C,null,!0)}updateTextureComparisonFunction(u,G){if(1===this.webGLVersion)return void g.d.Error("WebGL 1 does not support texture comparison.");const s=this._gl;u.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),0===G?(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,G),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0),0===G?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,G),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),u._comparisonFunction=G}createInstancesBuffer(u){const G=this._gl.createBuffer();if(!G)throw new Error("Unable to create instance buffer");const s=new x.e(G);return s.Aj=u,this.bindArrayBuffer(s),this._gl.bufferData(this._gl.ARRAY_BUFFER,u,this._gl.DYNAMIC_DRAW),s.references=1,s}deleteInstancesBuffer(u){this._gl.deleteBuffer(u)}_clientWaitAsync(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const T=this._gl;return new Promise(((z,O)=>{const m=()=>{const f=T.clientWaitSync(u,G,0);f!=T.WAIT_FAILED?f!=T.TIMEOUT_EXPIRED?z():setTimeout(m,s):O()};m()}))}_readPixelsAsync(u,G,s,T,z,O,m){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const f=this._gl,C=f.createBuffer();f.bindBuffer(f.PIXEL_PACK_BUFFER,C),f.bufferData(f.PIXEL_PACK_BUFFER,m.byteLength,f.STREAM_READ),f.readPixels(u,G,s,T,z,O,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const x=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);return x?(f.flush(),this._clientWaitAsync(x,0,10).then((()=>(f.deleteSync(x),f.bindBuffer(f.PIXEL_PACK_BUFFER,C),f.getBufferSubData(f.PIXEL_PACK_BUFFER,0,m),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),f.deleteBuffer(C),m)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(u,G){1===z.d.Instances.length&&P.b.audioEngine&&(P.b.audioEngine.dispose(),P.b.audioEngine=null);const s=u.getHostWindow();s&&"function"===typeof s.removeEventListener&&(s.removeEventListener("blur",u._onBlur),s.removeEventListener("focus",u._onFocus)),G&&(G.removeEventListener("focus",u._onCanvasFocus),G.removeEventListener("blur",u._onCanvasBlur),G.removeEventListener("pointerout",u._onCanvasPointerOut),G.removeEventListener("contextmenu",u._onCanvasContextMenu)),(0,l.d)()&&(document.removeEventListener("fullscreenchange",u._onFullscreenChange),document.removeEventListener("mozfullscreenchange",u._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",u._onFullscreenChange),document.removeEventListener("msfullscreenchange",u._onFullscreenChange),document.removeEventListener("pointerlockchange",u._onPointerLockChange),document.removeEventListener("mspointerlockchange",u._onPointerLockChange),document.removeEventListener("mozpointerlockchange",u._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",u._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}p.ALPHA_DISABLE=0,p.ALPHA_ADD=1,p.ALPHA_COMBINE=2,p.ALPHA_SUBTRACT=3,p.ALPHA_MULTIPLY=4,p.ALPHA_MAXIMIZED=5,p.ALPHA_ONEONE=6,p.ALPHA_PREMULTIPLIED=7,p.ALPHA_PREMULTIPLIED_PORTERDUFF=8,p.ALPHA_INTERPOLATE=9,p.ALPHA_SCREENMODE=10,p.DELAYLOADSTATE_NONE=0,p.DELAYLOADSTATE_LOADED=1,p.DELAYLOADSTATE_LOADING=2,p.DELAYLOADSTATE_NOTLOADED=4,p.NEVER=512,p.ALWAYS=519,p.LESS=513,p.EQUAL=514,p.LEQUAL=515,p.GREATER=516,p.GEQUAL=518,p.NOTEQUAL=517,p.KEEP=7680,p.REPLACE=7681,p.INCR=7682,p.DECR=7683,p.INVERT=5386,p.INCR_WRAP=34055,p.DECR_WRAP=34056,p.TEXTURE_CLAMP_ADDRESSMODE=0,p.TEXTURE_WRAP_ADDRESSMODE=1,p.TEXTURE_MIRROR_ADDRESSMODE=2,p.TEXTUREFORMAT_ALPHA=0,p.TEXTUREFORMAT_LUMINANCE=1,p.TEXTUREFORMAT_LUMINANCE_ALPHA=2,p.TEXTUREFORMAT_RGB=4,p.TEXTUREFORMAT_RGBA=5,p.TEXTUREFORMAT_RED=6,p.TEXTUREFORMAT_R=6,p.TEXTUREFORMAT_RG=7,p.TEXTUREFORMAT_RED_INTEGER=8,p.TEXTUREFORMAT_R_INTEGER=8,p.TEXTUREFORMAT_RG_INTEGER=9,p.TEXTUREFORMAT_RGB_INTEGER=10,p.TEXTUREFORMAT_RGBA_INTEGER=11,p.TEXTURETYPE_UNSIGNED_BYTE=0,p.TEXTURETYPE_UNSIGNED_INT=0,p.TEXTURETYPE_FLOAT=1,p.TEXTURETYPE_HALF_FLOAT=2,p.TEXTURETYPE_BYTE=3,p.TEXTURETYPE_SHORT=4,p.TEXTURETYPE_UNSIGNED_SHORT=5,p.TEXTURETYPE_INT=6,p.TEXTURETYPE_UNSIGNED_INTEGER=7,p.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,p.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,p.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,p.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,p.TEXTURETYPE_UNSIGNED_INT_24_8=12,p.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,p.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,p.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,p.TEXTURE_NEAREST_SAMPLINGMODE=1,p.TEXTURE_BILINEAR_SAMPLINGMODE=2,p.TEXTURE_TRILINEAR_SAMPLINGMODE=3,p.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,p.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,p.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,p.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,p.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,p.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,p.TEXTURE_NEAREST_LINEAR=7,p.TEXTURE_NEAREST_NEAREST=1,p.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,p.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,p.TEXTURE_LINEAR_LINEAR=2,p.TEXTURE_LINEAR_NEAREST=12,p.TEXTURE_EXPLICIT_MODE=0,p.TEXTURE_SPHERICAL_MODE=1,p.TEXTURE_PLANAR_MODE=2,p.TEXTURE_CUBIC_MODE=3,p.TEXTURE_PROJECTION_MODE=4,p.TEXTURE_SKYBOX_MODE=5,p.TEXTURE_INVCUBIC_MODE=6,p.TEXTURE_EQUIRECTANGULAR_MODE=7,p.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,p.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,p.SCALEMODE_FLOOR=1,p.SCALEMODE_NEAREST=2,p.SCALEMODE_CEILING=3},10619:(u,G,s)=>{"use strict";s.d(G,{d:()=>z});var T=s(10568);class z{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}z.Instances=[],z.OnEnginesDisposedObservable=new T.e,z._LastCreatedScene=null,z.UseFallbackTexture=!0,z.FallbackTexture=""},12357:(u,G,s)=>{"use strict";s(10584);var T=s(11350);s(10683),s(10969),s(10676),s(11360),s(11317);T.d},10676:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{static SetMatrixPrecision(u){if(T.MatrixTrackPrecisionChange=!1,u&&!T.MatrixUse64Bits&&T.MatrixTrackedMatrices)for(let G=0;G<T.MatrixTrackedMatrices.length;++G){const u=T.MatrixTrackedMatrices[G],s=u.Hj;u.Hj=new Array(16);for(let G=0;G<16;++G)u.Hj[G]=s[G]}T.MatrixUse64Bits=u,T.MatrixCurrentType=T.MatrixUse64Bits?Array:Float32Array,T.MatrixTrackedMatrices=null}}T.MatrixUse64Bits=!1,T.MatrixTrackPrecisionChange=!0,T.MatrixCurrentType=Float32Array,T.MatrixTrackedMatrices=[]},11360:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var u;return(null===(u=this._textures)||void 0===u?void 0:u[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(u){var G,s;if(!this._textures)return-1;const T=this._textures[u],z=(null===(G=this._layerIndices)||void 0===G?void 0:G[u])??0,O=(null===(s=this._faceIndices)||void 0===s?void 0:s[u])??0;return T.isCube?6*z+O:T.is3D?0:z}get samples(){return this._samples}setSamples(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===u&&!s)return u;const T=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,u,G):this._engine.updateRenderTargetTextureSampleCount(this,u);return this._samples=u,T}constructor(u,G,s,T,z){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=u,this._isCube=G,this._size=s,this._engine=T,this._depthStencilTexture=null,this.label=z}setTextures(u){Array.isArray(u)?this._textures=u:this._textures=u?[u]:null}setTexture(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[G]!==u&&(this._textures[G]&&s&&this._textures[G].dispose(),this._textures[G]=u)}setLayerAndFaceIndices(u,G){this._layerIndices=u,this._faceIndices=G}setLayerAndFaceIndex(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==G&&G>=0&&(this._layerIndices[u]=G),void 0!==s&&s>=0&&(this._faceIndices[u]=s)}createDepthStencilTexture(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,m=arguments.length>5?arguments[5]:void 0;return null===(u=this._depthStencilTexture)||void 0===u||u.dispose(),this._depthStencilTextureWithStencil=T,this._depthStencilTextureLabel=m,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:s,comparisonFunction:G,generateStencil:T,isCube:this._isCube,samples:z,depthTextureFormat:O,label:m},this),this._depthStencilTexture}_shareDepth(u){this.shareDepth(u)}shareDepth(u){this._depthStencilTexture&&(u._depthStencilTexture&&u._depthStencilTexture.dispose(),u._depthStencilTexture=this._depthStencilTexture,u._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(u){this.texture&&this.texture._swapAndDie(u),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let u=null;if(this._isMulti){const G=this.textures;if(G&&G.length>0){let s=!1,T=G.length,z=-1;const O=G[G.length-1]._source;14!==O&&12!==O||(s=!0,z=G[G.length-1].format,T--);const m=[],f=[],C=[],x=[],g=[],b=[],Q=[],Y={};for(let u=0;u<T;++u){const s=G[u];m.push(s.samplingMode),f.push(s.type),C.push(s.format);void 0!==Y[s.uniqueId]?(x.push(-1),Q.push(0)):(Y[s.uniqueId]=u,s.is2DArray?(x.push(35866),Q.push(s.depth)):s.isCube?(x.push(34067),Q.push(0)):s.is3D?(x.push(32879),Q.push(s.depth)):(x.push(3553),Q.push(0))),this._faceIndices&&g.push(this._faceIndices[u]??0),this._layerIndices&&b.push(this._layerIndices[u]??0)}const n={samplingModes:m,generateMipMaps:G[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:s,depthTextureFormat:z,types:f,formats:C,textureCount:T,targetTypes:x,faceIndex:g,layerIndex:b,layerCounts:Q,label:this.label},V={width:this.width,height:this.height,depth:this.depth};u=this._engine.createMultipleRenderTarget(V,n);for(let F=0;F<T;++F){if(-1!==x[F])continue;const s=Y[G[F].uniqueId];u.setTexture(u.textures[s],F)}}}else{var G,s,T,z;const m={};if(m.generateDepthBuffer=this._generateDepthBuffer,m.generateMipMaps=(null===(G=this.texture)||void 0===G?void 0:G.generateMipMaps)??!1,m.generateStencilBuffer=this._generateStencilBuffer,m.samplingMode=null===(s=this.texture)||void 0===s?void 0:s.samplingMode,m.type=null===(T=this.texture)||void 0===T?void 0:T.type,m.format=null===(z=this.texture)||void 0===z?void 0:z.format,m.noColorAttachment=!this._textures,m.label=this.label,this.isCube)u=this._engine.createRenderTargetCubeTexture(this.width,m);else{var O;const G={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(O=this.texture)||void 0===O?void 0:O.depth:void 0};u=this._engine.createRenderTargetTexture(G,m)}u.texture&&(u.texture.isReady=!0)}return u}_swapRenderTargetWrapper(u){if(this._textures&&u._textures)for(let G=0;G<this._textures.length;++G)this._textures[G]._swapAndDie(u._textures[G],!1),u._textures[G].isReady=!0;this._depthStencilTexture&&u._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(u._depthStencilTexture),u._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const u=this._cloneRenderTargetWrapper();if(u){if(this._depthStencilTexture){const G=this._depthStencilTexture.samplingMode,s=this._depthStencilTexture.format,T=2===G||3===G||11===G;u.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,T,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,s,this._depthStencilTextureLabel)}this.samples>1&&u.setSamples(this.samples),u._swapRenderTargetWrapper(this),u.dispose()}}releaseTextures(){if(this._textures)for(let G=0;G<(null===(u=this._textures)||void 0===u?void 0:u.length);++G){var u;this._textures[G].dispose()}this._textures=null}dispose(){var u;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(u=this._depthStencilTexture)||void 0===u||u.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10655:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?T.ShadersRepository:T.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?T.ShadersStore:T.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?T.IncludesShadersStore:T.IncludesShadersStoreWGSL}}T.ShadersRepository="src/Shaders/",T.ShadersStore={},T.IncludesShadersStore={},T.ShadersRepositoryWGSL="src/ShadersWGSL/",T.ShadersStoreWGSL={},T.IncludesShadersStoreWGSL={}},10668:(u,G,s)=>{"use strict";s.d(G,{b:()=>Q,f:()=>c,g:()=>Y,k:()=>n,n:()=>r,r:()=>b,v:()=>x,w:()=>g,y:()=>C,B:()=>f});class T{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.jd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(u){u&&this.program&&u(this.program)}setEngine(u){this.jd=u}_fillEffectInformation(u,G,s,T,z,O,m,f){const C=this.jd;if(C.supportsUniformBuffers)for(const g in G)u.bindUniformBlock(g,G[g]);let x;for(this.jd.getUniforms(this,s).forEach(((u,G)=>{T[s[G]]=u})),this._uniforms=T,x=0;x<z.length;x++){null==u.getUniform(z[x])&&(z.splice(x,1),x--)}z.forEach(((u,G)=>{O[u]=G}));for(const g of C.getAttributes(this,m))f.push(g)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(u,G){const s=this._valueCache[u],T=G.updateFlag;return(void 0===s||s!==T)&&(this._valueCache[u]=T,!0)}_cacheFloat2(u,G,s){let T=this._valueCache[u];if(!T||2!==T.length)return T=[G,s],this._valueCache[u]=T,!0;let z=!1;return T[0]!==G&&(T[0]=G,z=!0),T[1]!==s&&(T[1]=s,z=!0),z}_cacheFloat3(u,G,s,T){let z=this._valueCache[u];if(!z||3!==z.length)return z=[G,s,T],this._valueCache[u]=z,!0;let O=!1;return z[0]!==G&&(z[0]=G,O=!0),z[1]!==s&&(z[1]=s,O=!0),z[2]!==T&&(z[2]=T,O=!0),O}_cacheFloat4(u,G,s,T,z){let O=this._valueCache[u];if(!O||4!==O.length)return O=[G,s,T,z],this._valueCache[u]=O,!0;let m=!1;return O[0]!==G&&(O[0]=G,m=!0),O[1]!==s&&(O[1]=s,m=!0),O[2]!==T&&(O[2]=T,m=!0),O[3]!==z&&(O[3]=z,m=!0),m}setInt(u,G){const s=this._valueCache[u];void 0!==s&&s===G||this.jd.setInt(this._uniforms[u],G)&&(this._valueCache[u]=G)}setInt2(u,G,s){this._cacheFloat2(u,G,s)&&(this.jd.setInt2(this._uniforms[u],G,s)||(this._valueCache[u]=null))}setInt3(u,G,s,T){this._cacheFloat3(u,G,s,T)&&(this.jd.setInt3(this._uniforms[u],G,s,T)||(this._valueCache[u]=null))}setInt4(u,G,s,T,z){this._cacheFloat4(u,G,s,T,z)&&(this.jd.setInt4(this._uniforms[u],G,s,T,z)||(this._valueCache[u]=null))}setIntArray(u,G){this._valueCache[u]=null,this.jd.setIntArray(this._uniforms[u],G)}setIntArray2(u,G){this._valueCache[u]=null,this.jd.setIntArray2(this._uniforms[u],G)}setIntArray3(u,G){this._valueCache[u]=null,this.jd.setIntArray3(this._uniforms[u],G)}setIntArray4(u,G){this._valueCache[u]=null,this.jd.setIntArray4(this._uniforms[u],G)}setUInt(u,G){const s=this._valueCache[u];void 0!==s&&s===G||this.jd.setUInt(this._uniforms[u],G)&&(this._valueCache[u]=G)}setUInt2(u,G,s){this._cacheFloat2(u,G,s)&&(this.jd.setUInt2(this._uniforms[u],G,s)||(this._valueCache[u]=null))}setUInt3(u,G,s,T){this._cacheFloat3(u,G,s,T)&&(this.jd.setUInt3(this._uniforms[u],G,s,T)||(this._valueCache[u]=null))}setUInt4(u,G,s,T,z){this._cacheFloat4(u,G,s,T,z)&&(this.jd.setUInt4(this._uniforms[u],G,s,T,z)||(this._valueCache[u]=null))}setUIntArray(u,G){this._valueCache[u]=null,this.jd.setUIntArray(this._uniforms[u],G)}setUIntArray2(u,G){this._valueCache[u]=null,this.jd.setUIntArray2(this._uniforms[u],G)}setUIntArray3(u,G){this._valueCache[u]=null,this.jd.setUIntArray3(this._uniforms[u],G)}setUIntArray4(u,G){this._valueCache[u]=null,this.jd.setUIntArray4(this._uniforms[u],G)}setArray(u,G){this._valueCache[u]=null,this.jd.setArray(this._uniforms[u],G)}setArray2(u,G){this._valueCache[u]=null,this.jd.setArray2(this._uniforms[u],G)}setArray3(u,G){this._valueCache[u]=null,this.jd.setArray3(this._uniforms[u],G)}setArray4(u,G){this._valueCache[u]=null,this.jd.setArray4(this._uniforms[u],G)}setMatrices(u,G){G&&(this._valueCache[u]=null,this.jd.setMatrices(this._uniforms[u],G))}setMatrix(u,G){this._cacheMatrix(u,G)&&(this.jd.setMatrices(this._uniforms[u],G.$i())||(this._valueCache[u]=null))}setMatrix3x3(u,G){this._valueCache[u]=null,this.jd.setMatrix3x3(this._uniforms[u],G)}setMatrix2x2(u,G){this._valueCache[u]=null,this.jd.setMatrix2x2(this._uniforms[u],G)}setFloat(u,G){const s=this._valueCache[u];void 0!==s&&s===G||this.jd.setFloat(this._uniforms[u],G)&&(this._valueCache[u]=G)}setVector2(u,G){this._cacheFloat2(u,G.x,G.y)&&(this.jd.setFloat2(this._uniforms[u],G.x,G.y)||(this._valueCache[u]=null))}setFloat2(u,G,s){this._cacheFloat2(u,G,s)&&(this.jd.setFloat2(this._uniforms[u],G,s)||(this._valueCache[u]=null))}setVector3(u,G){this._cacheFloat3(u,G.x,G.y,G.z)&&(this.jd.setFloat3(this._uniforms[u],G.x,G.y,G.z)||(this._valueCache[u]=null))}setFloat3(u,G,s,T){this._cacheFloat3(u,G,s,T)&&(this.jd.setFloat3(this._uniforms[u],G,s,T)||(this._valueCache[u]=null))}setVector4(u,G){this._cacheFloat4(u,G.x,G.y,G.z,G.w)&&(this.jd.setFloat4(this._uniforms[u],G.x,G.y,G.z,G.w)||(this._valueCache[u]=null))}setQuaternion(u,G){this._cacheFloat4(u,G.x,G.y,G.z,G.w)&&(this.jd.setFloat4(this._uniforms[u],G.x,G.y,G.z,G.w)||(this._valueCache[u]=null))}setFloat4(u,G,s,T,z){this._cacheFloat4(u,G,s,T,z)&&(this.jd.setFloat4(this._uniforms[u],G,s,T,z)||(this._valueCache[u]=null))}setColor3(u,G){this._cacheFloat3(u,G.r,G.g,G.b)&&(this.jd.setFloat3(this._uniforms[u],G.r,G.g,G.b)||(this._valueCache[u]=null))}setColor4(u,G,s){this._cacheFloat4(u,G.r,G.g,G.b,s)&&(this.jd.setFloat4(this._uniforms[u],G.r,G.g,G.b,s)||(this._valueCache[u]=null))}setDirectColor4(u,G){this._cacheFloat4(u,G.r,G.g,G.b,G.a)&&(this.jd.setFloat4(this._uniforms[u],G.r,G.g,G.b,G.a)||(this._valueCache[u]=null))}_getVertexShaderCode(){return this.vertexShader?this.jd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.jd._getShaderSource(this.fragmentShader):null}}var z=s(10634);const O=new WeakMap,m={_webGLVersion:2,cachedPipelines:{}};function f(u){let G=O.get(u);if(!G){if(!u)return m;G={_webGLVersion:u.TEXTURE_BINDING_3D?2:1,_context:u,cachedPipelines:{}},O.set(u,G)}return G}function C(u){O.delete(u)}function x(u,G,s,T,z,O){const m=f(T);O||(O=m._createShaderProgramInjection??Q);return O(u,F(G,"vertex",T,m._contextWasLost),F(s,"fragment",T,m._contextWasLost),T,z,m.validateShaderPrograms)}function g(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6?arguments[6]:void 0;const C=f(z);m||(m=C._createShaderProgramInjection??Q);const x=C._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return m(u,V(G,"vertex",T,x,z,C._contextWasLost),V(s,"fragment",T,x,z,C._contextWasLost),z,O,C.validateShaderPrograms)}function b(u,G){const s=new T,z=f(u);return z.parallelShaderCompile&&(s.isParallelCompiled=!0),s.context=z._context,s}function Q(u,G,s,T){let z=arguments.length>5?arguments[5]:void 0;const O=T.createProgram();if(u.program=O,!O)throw new Error("Unable to create program");return T.attachShader(O,G),T.attachShader(O,s),T.linkProgram(O),u.context=T,u.vertexShader=G,u.fragmentShader=s,u.isParallelCompiled||Y(u,T,z),O}function Y(u,G,s){const T=u.context,z=u.vertexShader,O=u.fragmentShader,m=u.program;if(!T.getProgramParameter(m,T.LINK_STATUS)){if(!G.getShaderParameter(z,G.COMPILE_STATUS)){const s=G.getShaderInfoLog(z);if(s)throw u.vertexCompilationError=s,new Error("VERTEX SHADER "+s)}if(!G.getShaderParameter(O,G.COMPILE_STATUS)){const s=G.getShaderInfoLog(O);if(s)throw u.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s)}const s=T.getProgramInfoLog(m);if(s)throw u.programLinkError=s,new Error(s)}if(s){T.validateProgram(m);if(!T.getProgramParameter(m,T.VALIDATE_STATUS)){const G=T.getProgramInfoLog(m);if(G)throw u.programValidationError=G,new Error(G)}}T.deleteShader(z),T.deleteShader(O),u.vertexShader=void 0,u.fragmentShader=void 0,u.onCompiled&&(u.onCompiled(),u.onCompiled=void 0)}function n(u,G,s,T,z,O,m,C,b){let Q=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0,n=arguments.length>12?arguments[12]:void 0;const V=f(u.context);Y||(Y=V.createRawShaderProgramInjection??x),n||(n=V.createShaderProgramInjection??g);const F=u;F.program=T?Y(F,G,s,F.context,b):n(F,G,s,C,F.context,b),F.program.__SPECTOR_rebuildProgram=m,Q()}function V(u,G,s,T,O,m){return F((0,z.f)(u,s,T),G,O,m)}function F(u,G,s,T){const z=s.createShader("vertex"===G?s.VERTEX_SHADER:s.FRAGMENT_SHADER);if(!z){let u=s.NO_ERROR,z=s.NO_ERROR;for(;(z=s.getError())!==s.NO_ERROR;)u=z;throw new Error(`Something went wrong while creating a gl ${G} shader object. gl error=${u}, gl isContextLost=${s.isContextLost()}, _contextWasLost=${T}`)}return s.shaderSource(z,u),s.compileShader(z),z}function r(u,G){G.useProgram(u)}function c(u,G){const s=u;if(!s.isParallelCompiled)return void G(u);const T=s.onCompiled;s.onCompiled=()=>{null===T||void 0===T||T(),G(u)}}},11312:(u,G,s)=>{"use strict";s.r(G),s.d(G,{ThinEngine:()=>j});var T=s(10668),z=s(11317),O=s(10584),m=s(10577);class f{constructor(){this.shaderLanguage=0}postProcessor(u,G,s,T,z){if(z.drawBuffersExtensionDisabled){const G=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;u=u.replace(G,"")}return u}}const C=/(flat\s)?\s*varying\s*.*/;class x{constructor(){this.shaderLanguage=0}attributeProcessor(u){return u.replace("attribute","in")}varyingCheck(u,G){return C.test(u)}varyingProcessor(u,G){return u.replace("varying",G?"in":"out")}postProcessor(u,G,s){const T=-1!==u.search(/#extension.+GL_EXT_draw_buffers.+require/);if(u=(u=u.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),s){const G=-1!==u.search(/layout *\(location *= *0\) *out/g);u=(u=(u=(u=(u=(u=(u=u.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(T||G?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==G.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+u}return u}}var g=s(11319),b=s(10725),Q=s(10645),Y=s(11327),n=s(10683),V=s(10650),F=s(10634),r=s(10661);class c{}class j extends Q.b{get name(){return this._name}set name(u){this._name=u}get version(){return this._webGLVersion}static get ShadersRepository(){return V.e.ShadersRepository}static set ShadersRepository(u){V.e.ShadersRepository=u}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(u){this._framebufferDimensionsObject=u}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(u,G,s,z){if(s=s||{},super(G??s.antialias,s,z),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!u)return;let m=null;if(u.getContext){if(m=u,this._renderingCanvas=m,void 0===s.Xg&&(s.Xg=!1),void 0===s.xrCompatible&&(s.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const u=navigator.userAgent;for(const G of j.ExceptionList){const T=G.key,z=G.targets;if(new RegExp(T).test(u)){if(G.capture&&G.captureConstraint){const s=G.capture,T=G.captureConstraint,z=new RegExp(s).exec(u);if(z&&z.length>0){if(parseInt(z[z.length-1])>=T)continue}}for(const u of z)switch(u){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":s.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=u=>{u.preventDefault(),this._contextWasLost=!0,O.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},m.addEventListener("webglcontextlost",this._onContextLost,!1),m.addEventListener("webglcontextrestored",this._onContextRestored,!1),s.powerPreference=s.powerPreference||"high-performance"),this._badDesktopOS&&(s.xrCompatible=!1),!s.disableWebGL2Support)try{this._gl=m.getContext("webgl2",s)||m.getContext("experimental-webgl2",s),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(b){}if(!this._gl){if(!m)throw new Error("The provided canvas is null or undefined.");try{this._gl=m.getContext("webgl",s)||m.getContext("experimental-webgl",s)}catch(b){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=u,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const G=this._gl.getContextAttributes();G&&(s.stencil=G.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==s.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=s.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let T=0;T<this._caps.maxVertexAttribs;T++)this._currentBufferPointers[T]=new c;this._shaderProcessor=this.webGLVersion>1?new x:new f;const C=`Babylon.js v${j.Version}`;O.d.Log(C+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",C);const g=(0,T.B)(this._gl);g.validateShaderPrograms=this.validateShaderPrograms,g.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(u){return null}areAllEffectsReady(){for(const u in this._compiledEffects){if(!this._compiledEffects[u].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const u=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=u&&(this._glRenderer=this._gl.getParameter(u.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(u.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const u=this._gl.getExtension("WEBGL_draw_buffers");if(null!==u){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=u.drawBuffersWEBGL.bind(u),this._caps.maxDrawBuffers=this._gl.getParameter(u.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let G=0;G<16;G++)this._gl["COLOR_ATTACHMENT"+G+"_WEBGL"]=u["COLOR_ATTACHMENT"+G+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const u=this._gl.getExtension("WEBGL_depth_texture");null!=u&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=u.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const u=this._gl.getExtension("OES_vertex_array_object");null!=u&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=u.createVertexArrayOES.bind(u),this._gl.bindVertexArray=u.bindVertexArrayOES.bind(u),this._gl.deleteVertexArray=u.deleteVertexArrayOES.bind(u))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const u=this._gl.getExtension("ANGLE_instanced_arrays");null!=u?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=u.drawArraysInstancedANGLE.bind(u),this._gl.drawElementsInstanced=u.drawElementsInstancedANGLE.bind(u),this._gl.vertexAttribDivisor=u.vertexAttribDivisorANGLE.bind(u)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const u=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),G=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);u&&G&&(this._caps.highPrecisionShaderSupported=0!==u.precision&&0!==G.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const u=this._gl.getExtension("EXT_sRGB");null!=u&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:u.SRGB_EXT,SRGB8:u.SRGB_ALPHA_EXT,SRGB8_ALPHA8:u.SRGB_ALPHA_EXT})}if(this._creationOptions){const u=this._creationOptions.forceSRGBBufferSupportState;void 0!==u&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&u)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let G=0;G<this._maxSimultaneousTextures;G++)this._nextFreeTextureSlots.push(G);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const u=this._workingCanvas.getContext("2d");u&&(this._workingContext=u)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const u=this.getGlInfo();return u&&u.renderer?u.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=z;let O=0;if(G&&u){let G=!0;if(this._currentRenderTarget){var m;const s=null===(m=this._currentRenderTarget.texture)||void 0===m?void 0:m.format;if(8===s||9===s||10===s||11===s){var f;const s=null===(f=this._currentRenderTarget.texture)||void 0===f?void 0:f.type;7===s||5===s?(j._TempClearColorUint32[0]=255*u.r,j._TempClearColorUint32[1]=255*u.g,j._TempClearColorUint32[2]=255*u.b,j._TempClearColorUint32[3]=255*u.a,this._gl.clearBufferuiv(this._gl.COLOR,0,j._TempClearColorUint32),G=!1):(j._TempClearColorInt32[0]=255*u.r,j._TempClearColorInt32[1]=255*u.g,j._TempClearColorInt32[2]=255*u.b,j._TempClearColorInt32[3]=255*u.a,this._gl.clearBufferiv(this._gl.COLOR,0,j._TempClearColorInt32),G=!1)}}G&&(this._gl.clearColor(u.r,u.g,u.b,void 0!==u.a?u.a:1),O|=this._gl.COLOR_BUFFER_BIT)}s&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),O|=this._gl.DEPTH_BUFFER_BIT),T&&(this._gl.clearStencil(0),O|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(O)}_viewport(u,G,s,T){u===this._viewportCached.x&&G===this._viewportCached.y&&s===this._viewportCached.z&&T===this._viewportCached.w||(this._viewportCached.x=u,this._viewportCached.y=G,this._viewportCached.z=s,this._viewportCached.w=T,this._gl.viewport(u,G,s,T))}Xi(){super.Xi(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const C=u;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=u,this._bindUnboundFramebuffer(C._framebuffer);const x=this._gl;var g;if(!u.isMulti)if(u.is2DArray||u.is3D)x.framebufferTextureLayer(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,null===(g=u.texture._hardwareTexture)||void 0===g?void 0:g.underlyingResource,m,f),C._currentLOD=m;else if(u.isCube){var b;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+G,null===(b=u.texture._hardwareTexture)||void 0===b?void 0:b.underlyingResource,m)}else if(C._currentLOD!==m){var Q;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,null===(Q=u.texture._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,m),C._currentLOD=m}const Y=u._depthStencilTexture;if(Y){u.is3D&&(u.texture.width===Y.width&&u.texture.height===Y.height&&u.texture.depth===Y.depth||O.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const s=u._depthStencilTextureWithStencil?x.DEPTH_STENCIL_ATTACHMENT:x.DEPTH_ATTACHMENT;var n;if(u.is2DArray||u.is3D)x.framebufferTextureLayer(x.FRAMEBUFFER,s,null===(n=Y._hardwareTexture)||void 0===n?void 0:n.underlyingResource,m,f);else if(u.isCube){var V;x.framebufferTexture2D(x.FRAMEBUFFER,s,x.TEXTURE_CUBE_MAP_POSITIVE_X+G,null===(V=Y._hardwareTexture)||void 0===V?void 0:V.underlyingResource,m)}else{var F;x.framebufferTexture2D(x.FRAMEBUFFER,s,x.TEXTURE_2D,null===(F=Y._hardwareTexture)||void 0===F?void 0:F.underlyingResource,m)}}C._MSAAFramebuffer&&this._bindUnboundFramebuffer(C._MSAAFramebuffer),this._cachedViewport&&!z?this.setViewport(this._cachedViewport,s,T):(s||(s=u.width,m&&(s/=Math.pow(2,m))),T||(T=u.height,m&&(T/=Math.pow(2,m))),this._viewport(0,0,s,T)),this.wipeCaches()}setState(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==u||s)&&(this._depthCullingState.cull=u);const f=this.cullBackFaces??z??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==f||s)&&(this._depthCullingState.cullFace=f),this.setZOffset(G),this.setZOffsetUnits(m);const C=T?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==C||s)&&(this._depthCullingState.frontFace=C),this._stencilStateComposer.stencilMaterial=O}_bindUnboundFramebuffer(u){this._currentFramebuffer!==u&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,u),this._currentFramebuffer=u)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(u){const G=this._getTextureTarget(u);this._bindTextureDirectly(G,u,!0),this._gl.generateMipmap(G),this._bindTextureDirectly(G,null)}unBindFramebuffer(u){var G;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0;const z=u;this._currentRenderTarget=null;const O=this._gl;if(z._MSAAFramebuffer){if(u.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(u,s,T);O.bindFramebuffer(O.READ_FRAMEBUFFER,z._MSAAFramebuffer),O.bindFramebuffer(O.DRAW_FRAMEBUFFER,z._framebuffer),O.blitFramebuffer(0,0,u.width,u.height,0,0,u.width,u.height,O.COLOR_BUFFER_BIT,O.NEAREST)}null===(G=u.texture)||void 0===G||!G.generateMipMaps||s||u.isCube||this.generateMipmaps(u.texture),T&&(z._MSAAFramebuffer&&this._bindUnboundFramebuffer(z._framebuffer),T()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(u,G,s){return this._createVertexBuffer(u,this._gl.STATIC_DRAW)}_createVertexBuffer(u,G){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create vertex buffer");const T=new g.e(s);return this.bindArrayBuffer(T),"number"!==typeof u?u instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(u),G),T.Aj=4*u.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,u,G),T.Aj=u.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(u),G),T.Aj=u),this._resetVertexBufferBinding(),T.references=1,T}createDynamicVertexBuffer(u,G){return this._createVertexBuffer(u,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(u,G,s){const T=this._gl.createBuffer(),z=new g.e(T);if(!T)throw new Error("Unable to create index buffer");this.bindIndexBuffer(z);const O=this._normalizeIndexData(u);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,O,G?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),z.references=1,z.is32Bits=4===O.BYTES_PER_ELEMENT,z}_normalizeIndexData(u){if(2===u.BYTES_PER_ELEMENT)return u;if(this._caps.uintIndices){if(u instanceof Uint32Array)return u;for(let G=0;G<u.length;G++)if(u[G]>=65535)return new Uint32Array(u);return new Uint16Array(u)}return new Uint16Array(u)}bindArrayBuffer(u){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(u,this._gl.ARRAY_BUFFER)}bindUniformBlock(u,G,s){const T=u.program,z=this._gl.getUniformBlockIndex(T,G);this._gl.uniformBlockBinding(T,z,s)}bindIndexBuffer(u){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(u,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(u,G){(this._vaoRecordInProgress||this._currentBoundBuffer[G]!==u)&&(this._gl.bindBuffer(G,u?u.underlyingResource:null),this._currentBoundBuffer[G]=u)}updateArrayBuffer(u){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,u)}_vertexAttribPointer(u,G,s,T,z,O,m){const f=this._currentBufferPointers[G];if(!f)return;let C=!1;f.active?(f.buffer!==u&&(f.buffer=u,C=!0),f.size!==s&&(f.size=s,C=!0),f.type!==T&&(f.type=T,C=!0),f.normalized!==z&&(f.normalized=z,C=!0),f.stride!==O&&(f.stride=O,C=!0),f.offset!==m&&(f.offset=m,C=!0)):(C=!0,f.active=!0,f.index=G,f.size=s,f.type=T,f.normalized=z,f.stride=O,f.offset=m,f.buffer=u),(C||this._vaoRecordInProgress)&&(this.bindArrayBuffer(u),T===this._gl.UNSIGNED_INT||T===this._gl.INT?this._gl.vertexAttribIPointer(G,s,T,O,m):this._gl.vertexAttribPointer(G,s,T,z,O,m))}_bindIndexBufferWithCache(u){null!=u&&this._cachedIndexBuffer!==u&&(this._cachedIndexBuffer=u,this.bindIndexBuffer(u),this._uintIndicesCurrentlySet=u.is32Bits)}_bindVertexBuffersAttributes(u,G,s){const T=G.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let z=0;z<T.length;z++){const O=G.getAttributeLocation(z);if(O>=0){const G=T[z];let m=null;if(s&&(m=s[G]),m||(m=u[G]),!m)continue;this._gl.enableVertexAttribArray(O),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[O]=!0);const f=m.getBuffer();f&&(this._vertexAttribPointer(f,O,m.getSize(),m.type,m.normalized,m.byteStride,m.byteOffset),m.getIsInstanced()&&(this._gl.vertexAttribDivisor(O,m.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(O),this._currentInstanceBuffers.push(f))))}}}recordVertexArrayObject(u,G,s,T){const z=this._gl.createVertexArray();if(!z)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(z),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(u,s,T),this.bindIndexBuffer(G),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),z}bindVertexArrayObject(u,G){this._cachedVertexArrayObject!==u&&(this._cachedVertexArrayObject=u,this._gl.bindVertexArray(u),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=G&&G.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(u,G,s,T,z){if(this._cachedVertexBuffers!==u||this._cachedEffectForVertexBuffers!==z){this._cachedVertexBuffers=u,this._cachedEffectForVertexBuffers=z;const G=z.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let O=0;for(let m=0;m<G;m++)if(m<s.length){const G=z.getAttributeLocation(m);G>=0&&(this._gl.enableVertexAttribArray(G),this._vertexAttribArraysEnabled[G]=!0,this._vertexAttribPointer(u,G,s[m],this._gl.FLOAT,!1,T,O)),O+=4*s[m]}}this._bindIndexBufferWithCache(G)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(u,G,s,T){this._cachedVertexBuffers===u&&this._cachedEffectForVertexBuffers===s||(this._cachedVertexBuffers=u,this._cachedEffectForVertexBuffers=s,this._bindVertexBuffersAttributes(u,s,T)),this._bindIndexBufferWithCache(G)}unbindInstanceAttributes(){let u;for(let G=0,s=this._currentInstanceLocations.length;G<s;G++){const s=this._currentInstanceBuffers[G];u!=s&&s.references&&(u=s,this.bindArrayBuffer(s));const T=this._currentInstanceLocations[G];this._gl.vertexAttribDivisor(T,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(u){this._gl.deleteVertexArray(u)}_releaseBuffer(u){return u.references--,0===u.references&&(this._deleteBuffer(u),!0)}_deleteBuffer(u){this._gl.deleteBuffer(u.underlyingResource)}updateAndBindInstancesBuffer(u,G,s){if(this.bindArrayBuffer(u),G&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,G),void 0!==s[0].index)this.bindInstancesBuffer(u,s,!0);else for(let T=0;T<4;T++){const G=s[T];this._vertexAttribArraysEnabled[G]||(this._gl.enableVertexAttribArray(G),this._vertexAttribArraysEnabled[G]=!0),this._vertexAttribPointer(u,G,4,this._gl.FLOAT,!1,64,16*T),this._gl.vertexAttribDivisor(G,1),this._currentInstanceLocations.push(G),this._currentInstanceBuffers.push(u)}}bindInstancesBuffer(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(u);let T=0;if(s)for(let z=0;z<G.length;z++){T+=4*G[z].attributeSize}for(let z=0;z<G.length;z++){const s=G[z];void 0===s.index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(u,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,T,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(u))}}disableInstanceAttributeByName(u){if(!this._currentEffect)return;const G=this._currentEffect.getAttributeLocationByName(u);this.disableInstanceAttribute(G)}disableInstanceAttribute(u){let G,s=!1;for(;-1!==(G=this._currentInstanceLocations.indexOf(u));)this._currentInstanceLocations.splice(G,1),this._currentInstanceBuffers.splice(G,1),s=!0,G=this._currentInstanceLocations.indexOf(u);s&&(this._gl.vertexAttribDivisor(u,0),this.disableAttributeByIndex(u))}disableAttributeByIndex(u){this._gl.disableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!1,this._currentBufferPointers[u].active=!1}draw(u,G,s,T){this.drawElementsType(u?0:1,G,s,T)}drawPointClouds(u,G,s){this.drawArraysType(2,u,G,s)}drawUnIndexed(u,G,s,T){this.drawArraysType(u?0:1,G,s,T)}drawElementsType(u,G,s,T){this.applyStates(),this._reportDrawCall();const z=this._drawMode(u),O=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,m=this._uintIndicesCurrentlySet?4:2;T?this._gl.drawElementsInstanced(z,s,O,G*m,T):this._gl.drawElements(z,s,O,G*m)}drawArraysType(u,G,s,T){this.applyStates(),this._reportDrawCall();const z=this._drawMode(u);T?this._gl.drawArraysInstanced(z,G,s,T):this._gl.drawArrays(z,G,s)}_drawMode(u){switch(u){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(u){this._compiledEffects[u._key]&&delete this._compiledEffects[u._key];const G=u.getPipelineContext();G&&this._deletePipelineContext(G)}_deletePipelineContext(u){const G=u;G&&G.program&&(G.program.__SPECTOR_rebuildProgram=null,(0,r.l)(G),this._gl.deleteProgram(G.program))}_getGlobalDefines(u){return(0,F.i)(u,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(u,G,s,z,O,m,f,C,x){let g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10?arguments[10]:void 0;const Q="string"===typeof u?u:u.vertexToken||u.vertexSource||u.vertexElement||u.vertex,Y="string"===typeof u?u:u.fragmentToken||u.fragmentSource||u.fragmentElement||u.fragment,n=this._getGlobalDefines();let F=O??G.defines??"";n&&(F+=n);const r=Q+"+"+Y+"@"+F;if(this._compiledEffects[r]){const u=this._compiledEffects[r];return f&&u.isReady()&&f(u),u._refCount++,u}this._gl&&(0,T.B)(this._gl);const c=new V.e(u,G,s,z,this,O,m,f,C,x,r,G.shaderLanguage??g,G.extraInitializationsAsync??b);return this._compiledEffects[r]=c,c}_getShaderSource(u){return this._gl.getShaderSource(u)}createRawShaderProgram(u,G,s,z){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const m=(0,T.B)(this._gl);return m._contextWasLost=this._contextWasLost,m.validateShaderPrograms=this.validateShaderPrograms,(0,T.v)(u,G,s,z||this._gl,O)}createShaderProgram(u,G,s,z,O){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const f=(0,T.B)(this._gl);return f._contextWasLost=this._contextWasLost,f.validateShaderPrograms=this.validateShaderPrograms,(0,T.w)(u,G,s,z,O||this._gl,m)}inlineShaderCode(u){return u}createPipelineContext(u){if(this._gl){(0,T.B)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const G=(0,T.r)(this._gl,u);return G.jd=this,G}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(u){return(0,T.g)(u,this._gl,this.validateShaderPrograms)}_preparePipelineContext(u,G,s,z,O,m,f,C,x,g,b){const Q=(0,T.B)(this._gl);return Q._contextWasLost=this._contextWasLost,Q.validateShaderPrograms=this.validateShaderPrograms,Q._createShaderProgramInjection=this._createShaderProgram.bind(this),Q.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),Q.createShaderProgramInjection=this.createShaderProgram.bind(this),Q.loadFileInjection=this._loadFile.bind(this),(0,T.k)(u,G,s,z,O,m,f,C,x,g,b)}_createShaderProgram(u,G,s,z){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,T.b)(u,G,s,z,O)}_isRenderingStateCompiled(u){const G=u;return!this._isDisposed&&!G._isDisposed&&(!!this._gl.getProgramParameter(G.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(G),!0))}_executeWhenRenderingStateIsCompiled(u,G){(0,T.f)(u,G)}getUniforms(u,G){const s=new Array,T=u;for(let z=0;z<G.length;z++)s.push(this._gl.getUniformLocation(T.program,G[z]));return s}getAttributes(u,G){const s=[],T=u;for(let O=0;O<G.length;O++)try{s.push(this._gl.getAttribLocation(T.program,G[O]))}catch(z){s.push(-1)}return s}enableEffect(u){(u=null!==u&&(0,z.d)(u)?u.effect:u)&&u!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(u),this._currentEffect=u,u.onBind&&u.onBind(u),u._onBindObservable&&u._onBindObservable.notifyObservers(u))}setInt(u,G){return!!u&&(this._gl.uniform1i(u,G),!0)}setInt2(u,G,s){return!!u&&(this._gl.uniform2i(u,G,s),!0)}setInt3(u,G,s,T){return!!u&&(this._gl.uniform3i(u,G,s,T),!0)}setInt4(u,G,s,T,z){return!!u&&(this._gl.uniform4i(u,G,s,T,z),!0)}setIntArray(u,G){return!!u&&(this._gl.uniform1iv(u,G),!0)}setIntArray2(u,G){return!(!u||G.length%2!==0)&&(this._gl.uniform2iv(u,G),!0)}setIntArray3(u,G){return!(!u||G.length%3!==0)&&(this._gl.uniform3iv(u,G),!0)}setIntArray4(u,G){return!(!u||G.length%4!==0)&&(this._gl.uniform4iv(u,G),!0)}setUInt(u,G){return!!u&&(this._gl.uniform1ui(u,G),!0)}setUInt2(u,G,s){return!!u&&(this._gl.uniform2ui(u,G,s),!0)}setUInt3(u,G,s,T){return!!u&&(this._gl.uniform3ui(u,G,s,T),!0)}setUInt4(u,G,s,T,z){return!!u&&(this._gl.uniform4ui(u,G,s,T,z),!0)}setUIntArray(u,G){return!!u&&(this._gl.uniform1uiv(u,G),!0)}setUIntArray2(u,G){return!(!u||G.length%2!==0)&&(this._gl.uniform2uiv(u,G),!0)}setUIntArray3(u,G){return!(!u||G.length%3!==0)&&(this._gl.uniform3uiv(u,G),!0)}setUIntArray4(u,G){return!(!u||G.length%4!==0)&&(this._gl.uniform4uiv(u,G),!0)}setArray(u,G){return!!u&&(!(G.length<1)&&(this._gl.uniform1fv(u,G),!0))}setArray2(u,G){return!(!u||G.length%2!==0)&&(this._gl.uniform2fv(u,G),!0)}setArray3(u,G){return!(!u||G.length%3!==0)&&(this._gl.uniform3fv(u,G),!0)}setArray4(u,G){return!(!u||G.length%4!==0)&&(this._gl.uniform4fv(u,G),!0)}setMatrices(u,G){return!!u&&(this._gl.uniformMatrix4fv(u,!1,G),!0)}setMatrix3x3(u,G){return!!u&&(this._gl.uniformMatrix3fv(u,!1,G),!0)}setMatrix2x2(u,G){return!!u&&(this._gl.uniformMatrix2fv(u,!1,G),!0)}setFloat(u,G){return!!u&&(this._gl.uniform1f(u,G),!0)}setFloat2(u,G,s){return!!u&&(this._gl.uniform2f(u,G,s),!0)}setFloat3(u,G,s,T){return!!u&&(this._gl.uniform3f(u,G,s,T),!0)}setFloat4(u,G,s,T,z){return!!u&&(this._gl.uniform4f(u,G,s,T,z),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const u=this._colorWrite;this._gl.colorMask(u,u,u,u)}}wipeCaches(u){this.preventCacheWipeBetweenFrames&&!u||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),u&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(u,G){const s=this._gl;let T=s.NEAREST,z=s.NEAREST;switch(u){case 11:T=s.LINEAR,z=G?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 3:T=s.LINEAR,z=G?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 8:T=s.NEAREST,z=G?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 4:T=s.NEAREST,z=G?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 5:T=s.NEAREST,z=G?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 6:T=s.NEAREST,z=G?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 7:T=s.NEAREST,z=s.LINEAR;break;case 1:T=s.NEAREST,z=s.NEAREST;break;case 9:T=s.LINEAR,z=G?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 10:T=s.LINEAR,z=G?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 2:T=s.LINEAR,z=s.LINEAR;break;case 12:T=s.LINEAR,z=s.NEAREST}return{min:z,mag:T}}_createTexture(){const u=this._gl.createTexture();if(!u)throw new Error("Unable to create texture");return u}_createHardwareTexture(){return new Y.e(this._createTexture(),this._gl)}_createInternalTexture(u,G){let s,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=!1,m=0,f=3,C=5,x=!1,g=1;void 0!==G&&"object"===typeof G?(z=!!G.generateMipMaps,m=void 0===G.type?0:G.type,f=void 0===G.samplingMode?3:G.samplingMode,C=void 0===G.format?5:G.format,x=void 0!==G.useSRGBBuffer&&G.useSRGBBuffer,g=G.samples??1,s=G.label):z=!!G,x&&(x=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==m||this._caps.textureFloatLinearFiltering)&&(2!==m||this._caps.textureHalfFloatLinearFiltering)||(f=1),1!==m||this._caps.textureFloat||(m=0,O.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const b=this._gl,Q=new n.d(this,T),Y=u.width||u,V=u.height||u,F=u.depth||0,r=u.layers||0,c=this._getSamplingParameters(f,z),j=0!==r?b.TEXTURE_2D_ARRAY:0!==F?b.TEXTURE_3D:b.TEXTURE_2D,l=this._getRGBABufferInternalSizedFormat(m,C,x),P=this._getInternalFormat(C),H=this._getWebGLTextureType(m);return this._bindTextureDirectly(j,Q),0!==r?(Q.is2DArray=!0,b.texImage3D(j,0,l,Y,V,r,0,P,H,null)):0!==F?(Q.is3D=!0,b.texImage3D(j,0,l,Y,V,F,0,P,H,null)):b.texImage2D(j,0,l,Y,V,0,P,H,null),b.texParameteri(j,b.TEXTURE_MAG_FILTER,c.mag),b.texParameteri(j,b.TEXTURE_MIN_FILTER,c.min),b.texParameteri(j,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(j,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),z&&this._gl.generateMipmap(j),this._bindTextureDirectly(j,null),Q._useSRGBBuffer=x,Q.baseWidth=Y,Q.baseHeight=V,Q.width=Y,Q.height=V,Q.depth=r,Q.isReady=!0,Q.samples=g,Q.generateMipMaps=z,Q.samplingMode=f,Q.type=m,Q.format=C,Q.label=s,this._internalTexturesCache.push(Q),Q}_getUseSRGBBuffer(u,G){return u&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||G)}createTexture(u,G,s,T){var z=this;let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,Q=arguments.length>11?arguments[11]:void 0,Y=arguments.length>12?arguments[12]:void 0,V=arguments.length>13?arguments[13]:void 0,F=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(u,G,s,T,O,m,f,(function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];return z._prepareWebGLTexture(...G,g)}),((u,G,s,z,O,m)=>{const f=this._gl,C=s.width===u&&s.height===G;O._creationFlags=V??0;const x=this._getTexImageParametersForCreateTexture(O.format,O._useSRGBBuffer);if(C)return f.texImage2D(f.TEXTURE_2D,0,x.internalFormat,x.format,x.type,s),!1;const g=this._caps.maxTextureSize;if(s.width>g||s.height>g||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=u,this._workingCanvas.height=G,this._workingContext.drawImage(s,0,0,s.width,s.height,0,0,u,G),f.texImage2D(f.TEXTURE_2D,0,x.internalFormat,x.format,x.type,this._workingCanvas),O.width=u,O.height=G,!1);{const u=new n.d(this,2);this._bindTextureDirectly(f.TEXTURE_2D,u,!0),f.texImage2D(f.TEXTURE_2D,0,x.internalFormat,x.format,x.type,s),this._rescaleTexture(u,O,T,x.format,(()=>{this._releaseTexture(u),this._bindTextureDirectly(f.TEXTURE_2D,O,!0),m()}))}return!0}),C,x,g,b,Q,Y,F)}_getTexImageParametersForCreateTexture(u,G){let s,T;return 1===this.webGLVersion?(s=this._getInternalFormat(u,G),T=s):(s=this._getInternalFormat(u,!1),T=this._getRGBABufferInternalSizedFormat(0,u,G)),{internalFormat:T,format:s,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(u,G,s,T,z){}_unpackFlipY(u){this._unpackFlipYCached!==u&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,u?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=u))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(u){return u.isCube?this._gl.TEXTURE_CUBE_MAP:u.is3D?this._gl.TEXTURE_3D:u.is2DArray||u.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=this._getTextureTarget(G),z=this._getSamplingParameters(u,G.useMipMaps||s);this._setTextureParameterInteger(T,this._gl.TEXTURE_MAG_FILTER,z.mag,G),this._setTextureParameterInteger(T,this._gl.TEXTURE_MIN_FILTER,z.min),s&&(G.generateMipMaps=!0,this._gl.generateMipmap(T)),this._bindTextureDirectly(T,null),G.samplingMode=u}updateTextureDimensions(u,G,s){}updateTextureWrappingMode(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=this._getTextureTarget(u);null!==G&&(this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(G),u),u._cachedWrapU=G),null!==s&&(this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(s),u),u._cachedWrapV=s),(u.is2DArray||u.is3D)&&null!==T&&(this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(T),u),u._cachedWrapR=T),this._bindTextureDirectly(z,null)}_uploadCompressedDataToTextureDirectly(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const f=this._gl;let C=f.TEXTURE_2D;if(u.isCube&&(C=f.TEXTURE_CUBE_MAP_POSITIVE_X+O),u._useSRGBBuffer)switch(G){case 37492:case 36196:this._caps.etc2?G=f.COMPRESSED_SRGB8_ETC2:u._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?G=f.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u._useSRGBBuffer=!1;break;case 36492:G=f.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:G=f.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?G=f.COMPRESSED_SRGB_S3TC_DXT1_EXT:u._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?G=f.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:u._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?G=f.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:u._useSRGBBuffer=!1;break;default:u._useSRGBBuffer=!1}this._gl.compressedTexImage2D(C,m,G,s,T,0,z)}_uploadDataToTextureDirectly(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=this._gl,f=this._getWebGLTextureType(u.type),C=this._getInternalFormat(u.format),x=void 0===z?this._getRGBABufferInternalSizedFormat(u.type,u.format,u._useSRGBBuffer):this._getInternalFormat(z,u._useSRGBBuffer);this._unpackFlipY(u.invertY);let g=m.TEXTURE_2D;u.isCube&&(g=m.TEXTURE_CUBE_MAP_POSITIVE_X+s);const b=Math.round(Math.log(u.width)*Math.LOG2E),Q=Math.round(Math.log(u.height)*Math.LOG2E),Y=O?u.width:Math.pow(2,Math.max(b-T,0)),n=O?u.height:Math.pow(2,Math.max(Q-T,0));m.texImage2D(g,T,x,Y,n,0,C,f,G)}updateTextureData(u,G,s,T,z,O){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const x=this._gl,g=this._getWebGLTextureType(u.type),b=this._getInternalFormat(u.format);this._unpackFlipY(u.invertY);let Q=x.TEXTURE_2D,Y=x.TEXTURE_2D;u.isCube&&(Y=x.TEXTURE_CUBE_MAP_POSITIVE_X+m,Q=x.TEXTURE_CUBE_MAP),this._bindTextureDirectly(Q,u,!0),x.texSubImage2D(Y,f,s,T,z,O,b,g,G),C&&this._gl.generateMipmap(Y),this._bindTextureDirectly(Q,null)}_uploadArrayBufferViewToTexture(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const z=this._gl,O=u.isCube?z.TEXTURE_CUBE_MAP:z.TEXTURE_2D;this._bindTextureDirectly(O,u,!0),this._uploadDataToTextureDirectly(u,G,s,T),this._bindTextureDirectly(O,null,!0)}_prepareWebGLTextureContinuation(u,G,s,T,z){const O=this._gl;if(!O)return;const m=this._getSamplingParameters(z,!s);O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,m.mag),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,m.min),s||T||O.generateMipmap(O.TEXTURE_2D),this._bindTextureDirectly(O.TEXTURE_2D,null),G&&G.removePendingData(u),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear()}_prepareWebGLTexture(u,G,s,T,z,O,m,f,C,x){const g=this.getCaps().maxTextureSize,Q=Math.min(g,this.needPOTTextures?(0,b.h)(T.width,g):T.width),Y=Math.min(g,this.needPOTTextures?(0,b.h)(T.height,g):T.height),n=this._gl;n&&(u._hardwareTexture?(this._bindTextureDirectly(n.TEXTURE_2D,u,!0),this._unpackFlipY(void 0===z||!!z),u.baseWidth=T.width,u.baseHeight=T.height,u.width=Q,u.height=Y,u.isReady=!0,u.type=-1!==u.type?u.type:0,u.format=-1!==u.format?u.format:x??(".jpg"!==G||u._useSRGBBuffer?5:4),f(Q,Y,T,G,u,(()=>{this._prepareWebGLTextureContinuation(u,s,O,m,C)}))||this._prepareWebGLTextureContinuation(u,s,O,m,C)):s&&s.removePendingData(u))}_getInternalFormatFromDepthTextureFormat(u,G,s){const T=this._gl;if(!G)return T.STENCIL_INDEX8;let z=s?T.DEPTH_STENCIL:T.DEPTH_COMPONENT;return this.webGLVersion>1?15===u?z=T.DEPTH_COMPONENT16:16===u?z=T.DEPTH_COMPONENT24:17===u||13===u?z=s?T.DEPTH24_STENCIL8:T.DEPTH_COMPONENT24:14===u?z=T.DEPTH_COMPONENT32F:18===u&&(z=s?T.DEPTH32F_STENCIL8:T.DEPTH_COMPONENT32F):z=T.DEPTH_COMPONENT16,z}_setupFramebufferDepthAttachments(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,O=arguments.length>5?arguments[5]:void 0;const m=this._gl;O=O??(u?13:14);const f=this._getInternalFormatFromDepthTextureFormat(O,G,u);return u&&G?this._createRenderBuffer(s,T,z,m.DEPTH_STENCIL,f,m.DEPTH_STENCIL_ATTACHMENT):G?this._createRenderBuffer(s,T,z,f,f,m.DEPTH_ATTACHMENT):u?this._createRenderBuffer(s,T,z,f,f,m.STENCIL_ATTACHMENT):null}_createRenderBuffer(u,G,s,T,z,O){let m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const f=this._gl.createRenderbuffer();return this._updateRenderBuffer(f,u,G,s,T,z,O,m)}_updateRenderBuffer(u,G,s,T,z,O,m){let f=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this._gl;return C.bindRenderbuffer(C.RENDERBUFFER,u),T>1&&C.renderbufferStorageMultisample?C.renderbufferStorageMultisample(C.RENDERBUFFER,T,O,G,s):C.renderbufferStorage(C.RENDERBUFFER,z,G,s),C.framebufferRenderbuffer(C.FRAMEBUFFER,m,C.RENDERBUFFER,u),f&&C.bindRenderbuffer(C.RENDERBUFFER,null),u}_releaseTexture(u){this._deleteTexture(u._hardwareTexture),this.unbindAllTextures();const G=this._internalTexturesCache.indexOf(u);-1!==G&&this._internalTexturesCache.splice(G,1),u._lodTextureHigh&&u._lodTextureHigh.dispose(),u._lodTextureMid&&u._lodTextureMid.dispose(),u._lodTextureLow&&u._lodTextureLow.dispose(),u._irradianceTexture&&u._irradianceTexture.dispose()}_deleteTexture(u){null===u||void 0===u||u.release()}_setProgram(u){this._currentProgram!==u&&((0,T.n)(u,this._gl),this._currentProgram=u)}bindSamplers(u){const G=u.getPipelineContext();this._setProgram(G.program);const s=u.getSamplers();for(let T=0;T<s.length;T++){const G=u.getUniform(s[T]);G&&(this._boundUniforms[T]=G)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=!1;const m=G&&G._associatedChannel>-1;s&&m&&(this._activeChannel=G._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==G||T){if(this._activateCurrentTexture(),G&&G.isMultiview)throw O.d.Error(["_bindTextureDirectly called with a multiview texture!",u,G]),"_bindTextureDirectly called with a multiview texture!";var f;this._gl.bindTexture(u,(null===G||void 0===G||null===(f=G._hardwareTexture)||void 0===f?void 0:f.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=G,G&&(G._associatedChannel=this._activeChannel)}else s&&(z=!0,this._activateCurrentTexture());return m&&!s&&this._bindSamplerUniformToChannel(G._associatedChannel,this._activeChannel),z}_bindTexture(u,G,s){if(void 0===u)return;G&&(G._associatedChannel=u),this._activeChannel=u;const T=G?this._getTextureTarget(G):this._gl.TEXTURE_2D;this._bindTextureDirectly(T,G)}unbindAllTextures(){for(let u=0;u<this._maxSimultaneousTextures;u++)this._activeChannel=u,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(u,G,s,T){void 0!==u&&(G&&(this._boundUniforms[u]=G),this._setTexture(u,s))}_bindSamplerUniformToChannel(u,G){const s=this._boundUniforms[u];s&&s._currentState!==G&&(this._gl.uniform1i(s,G),s._currentState=G)}_getTextureWrapMode(u){switch(u){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(u,G){let s,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!G)return null!=this._boundTexturesCache[u]&&(this._activeChannel=u,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(G.video){this._activeChannel=u;const s=G.getInternalTexture();s&&(s._associatedChannel=u),G.update()}else if(4===G.delayLoadState)return G.delayLoad(),!1;s=z?G.depthStencilTexture:G.isReady()?G.getInternalTexture():G.isCube?this.emptyCubeTexture:G.is3D?this.emptyTexture3D:G.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!T&&s&&(s._associatedChannel=u);let O=!0;this._boundTexturesCache[u]===s&&(T||this._bindSamplerUniformToChannel(s._associatedChannel,u),O=!1),this._activeChannel=u;const m=this._getTextureTarget(s);if(O&&this._bindTextureDirectly(m,s,T),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==G.coordinatesMode){s._cachedCoordinatesMode=G.coordinatesMode;const u=3!==G.coordinatesMode&&5!==G.coordinatesMode?1:0;G.wrapU=u,G.wrapV=u}s._cachedWrapU!==G.wrapU&&(s._cachedWrapU=G.wrapU,this._setTextureParameterInteger(m,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(G.wrapU),s)),s._cachedWrapV!==G.wrapV&&(s._cachedWrapV=G.wrapV,this._setTextureParameterInteger(m,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(G.wrapV),s)),s.is3D&&s._cachedWrapR!==G.wrapR&&(s._cachedWrapR=G.wrapR,this._setTextureParameterInteger(m,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(G.wrapR),s)),this._setAnisotropicLevel(m,s,G.anisotropicFilteringLevel)}return!0}setTextureArray(u,G,s,T){if(void 0!==u&&G){this._textureUnits&&this._textureUnits.length===s.length||(this._textureUnits=new Int32Array(s.length));for(let G=0;G<s.length;G++){const T=s[G].getInternalTexture();T?(this._textureUnits[G]=u+G,T._associatedChannel=u+G):this._textureUnits[G]=-1}this._gl.uniform1iv(G,this._textureUnits);for(let u=0;u<s.length;u++)this._setTexture(this._textureUnits[u],s[u],!0)}}_setAnisotropicLevel(u,G,s){const T=this._caps.textureAnisotropicFilterExtension;11!==G.samplingMode&&3!==G.samplingMode&&2!==G.samplingMode&&(s=1),T&&G._cachedAnisotropicFilteringLevel!==s&&(this._setTextureParameterFloat(u,T.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s,this._caps.maxAnisotropy),G),G._cachedAnisotropicFilteringLevel=s)}_setTextureParameterFloat(u,G,s,T){this._bindTextureDirectly(u,T,!0,!0),this._gl.texParameterf(u,G,s)}_setTextureParameterInteger(u,G,s,T){T&&this._bindTextureDirectly(u,T,!0,!0),this._gl.texParameteri(u,G,s)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let u=0;u<this._caps.maxVertexAttribs;u++)this.disableAttributeByIndex(u)}else for(let u=0,G=this._vertexAttribArraysEnabled.length;u<G;u++)u>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[u]||this.disableAttributeByIndex(u)}releaseEffects(){const u=Object.keys(this._compiledEffects);for(const G of u){this._compiledEffects[G].dispose()}this._compiledEffects={}}dispose(){var u;((0,m.k)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(u=this._gl.getExtension("WEBGL_lose_context"))||void 0===u||u.loseContext());(0,T.y)(this._gl)}attachContextLostEvent(u){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",u,!1)}attachContextRestoredEvent(u){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",u,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(u){const G=this._gl;for(;G.getError()!==G.NO_ERROR;);let s=!0;const T=G.createTexture();G.bindTexture(G.TEXTURE_2D,T),G.texImage2D(G.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(u),1,1,0,G.RGBA,this._getWebGLTextureType(u),null),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.NEAREST);const z=G.createFramebuffer();G.bindFramebuffer(G.FRAMEBUFFER,z),G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,T,0);const O=G.checkFramebufferStatus(G.FRAMEBUFFER);if(s=s&&O===G.FRAMEBUFFER_COMPLETE,s=s&&G.getError()===G.NO_ERROR,s&&(G.clear(G.COLOR_BUFFER_BIT),s=s&&G.getError()===G.NO_ERROR),s){G.bindFramebuffer(G.FRAMEBUFFER,null);const u=G.RGBA,T=G.UNSIGNED_BYTE,z=new Uint8Array(4);G.readPixels(0,0,1,1,u,T,z),s=s&&G.getError()===G.NO_ERROR}for(G.deleteTexture(T),G.deleteFramebuffer(z),G.bindFramebuffer(G.FRAMEBUFFER,null);!s&&G.getError()!==G.NO_ERROR;);return s}_getWebGLTextureType(u){if(1===this._webGLVersion){switch(u){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(u){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=G?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(u){case 0:s=this._gl.ALPHA;break;case 1:s=this._gl.LUMINANCE;break;case 2:s=this._gl.LUMINANCE_ALPHA;break;case 6:s=this._gl.RED;break;case 7:s=this._gl.RG;break;case 4:s=G?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:s=G?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(u){case 8:s=this._gl.RED_INTEGER;break;case 9:s=this._gl.RG_INTEGER;break;case 10:s=this._gl.RGB_INTEGER;break;case 11:s=this._gl.RGBA_INTEGER}return s}_getRGBABufferInternalSizedFormat(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==G)switch(G){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return s?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(u){case 3:switch(G){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(G){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return s?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(G){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(G){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(G){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(G){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(G){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(G){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(G){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(u,G,s,T){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const m=z?4:3,f=z?this._gl.RGBA:this._gl.RGB,C=new Uint8Array(T*s*m);return O&&this.flushFramebuffer(),this._gl.readPixels(u,G,s,T,f,this._gl.UNSIGNED_BYTE,C),Promise.resolve(C)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const u=Q.b._CreateCanvas(1,1),G=u.getContext("webgl")||u.getContext("experimental-webgl");this._IsSupported=null!=G&&!!window.WebGLRenderingContext}catch(u){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const u=Q.b._CreateCanvas(1,1),G=u.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||u.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!G}catch(u){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}j._TempClearColorUint32=new Uint32Array(4),j._TempClearColorInt32=new Int32Array(4),j.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],j._ConcatenateShader=F.f,j._IsSupported=null,j._HasMajorPerformanceCaveat=null},11002:(u,G,s)=>{"use strict";var T;s.d(G,{e:()=>z}),function(u){u[u.PointerMove=0]="PointerMove",u[u.PointerDown=1]="PointerDown",u[u.PointerUp=2]="PointerUp"}(T||(T={}));class z{}z.DOM_DELTA_PIXEL=0,z.DOM_DELTA_LINE=1,z.DOM_DELTA_PAGE=2},11e3:(u,G,s)=>{"use strict";s.d(G,{d:()=>T,g:()=>O,j:()=>z});class T{}T.KEYDOWN=1,T.KEYUP=2;class z{constructor(u,G){this.type=u,this.event=G}}class O extends z{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(u){this.skipOnKeyboardObservable=u}constructor(u,G){super(u,G),this.type=u,this.event=G,this.skipOnKeyboardObservable=!1}}},10991:(u,G,s)=>{"use strict";s.d(G,{d:()=>z,e:()=>m,i:()=>f});var T=s(10904);class z{}z.POINTERDOWN=1,z.POINTERUP=2,z.POINTERMOVE=4,z.POINTERWHEEL=8,z.POINTERPICK=16,z.POINTERTAP=32,z.POINTERDOUBLETAP=64;class O{constructor(u,G){this.type=u,this.event=G}}class m extends O{constructor(u,G,s,z){super(u,G),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new T.m(s,z)}}class f extends O{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(u,G),this._pickInfo=s,this._inputManager=T}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10558:(u,G,s)=>{"use strict";s.r(G),s.d(G,{SceneInstrumentation:()=>O});var T=s(10564),z=s(10734);class O{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(u){u!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=u,u?(this._onBeforeActiveMeshesEvaluationObserver=this.wf.onBeforeActiveMeshesEvaluationObservable.add((()=>{T.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.wf.onAfterActiveMeshesEvaluationObservable.add((()=>{T.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.wf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(u){u!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=u,u?(this._onBeforeRenderTargetsRenderObserver=this.wf.onBeforeRenderTargetsRenderObservable.add((()=>{T.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.wf.onAfterRenderTargetsRenderObservable.add((()=>{T.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.wf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(u){u!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=u,u?(this._onBeforeParticlesRenderingObserver=this.wf.onBeforeParticlesRenderingObservable.add((()=>{T.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.wf.onAfterParticlesRenderingObservable.add((()=>{T.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.wf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(u){u!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=u,this.wf.spriteManagers&&(u?(this._onBeforeSpritesRenderingObserver=this.wf.onBeforeSpritesRenderingObservable.add((()=>{T.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.wf.onAfterSpritesRenderingObservable.add((()=>{T.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.wf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.wf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(u){u!==this._capturePhysicsTime&&this.wf.onBeforePhysicsObservable&&(this._capturePhysicsTime=u,u?(this._onBeforePhysicsObserver=this.wf.onBeforePhysicsObservable.add((()=>{T.e.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.wf.onAfterPhysicsObservable.add((()=>{T.e.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.wf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.wf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(u){u!==this._captureAnimationsTime&&(this._captureAnimationsTime=u,u?this._onAfterAnimationsObserver=this.wf.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.wf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(u){this._captureFrameTime=u}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(u){this._captureInterFrameTime=u}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(u){u!==this._captureRenderTime&&(this._captureRenderTime=u,u?(this._onBeforeDrawPhaseObserver=this.wf.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),T.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.wf.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),T.e.EndPerformanceCounter("Main render")}))):(this.wf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(u){u!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=u,u?(this._onBeforeCameraRenderObserver=this.wf.onBeforeCameraRenderObservable.add((u=>{this._cameraRenderTime.beginMonitoring(),T.e.StartPerformanceCounter(`Rendering camera ${u.name}`)})),this._onAfterCameraRenderObserver=this.wf.onAfterCameraRenderObservable.add((u=>{this._cameraRenderTime.endMonitoring(!1),T.e.EndPerformanceCounter(`Rendering camera ${u.name}`)}))):(this.wf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.wf.getEngine()._drawCalls}constructor(u){this.wf=u,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new z.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new z.e,this._captureFrameTime=!1,this._frameTime=new z.e,this._captureRenderTime=!1,this._renderTime=new z.e,this._captureInterFrameTime=!1,this._interFrameTime=new z.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new z.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new z.e,this._capturePhysicsTime=!1,this._physicsTime=new z.e,this._captureAnimationsTime=!1,this._animationsTime=new z.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new z.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=u.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(T.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.wf.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=u.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(T.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Xi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Xi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Xi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Xi(),this._captureRenderTime&&this._renderTime.Xi(),this._captureCameraRenderTime&&this._cameraRenderTime.Xi()}))}dispose(){this.wf.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.wf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.wf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.wf.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.wf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.wf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.wf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.wf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.wf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.wf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.wf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.wf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.wf=null}}},11936:(u,G,s)=>{"use strict";s.d(G,{d:()=>g});var T=s(10863),z=s(10866),O=s(10904),m=s(11161),f=s(11890),C=s(11938),x=s(10715);m.b.AddNodeConstructor("Light_Type_1",((u,G)=>()=>new g(u,O.q.Zero(),G)));class g extends C.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(u){this._shadowFrustumSize=u,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(u){this._shadowOrthoScale=u,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(u){this._orthoLeft=u}get orthoRight(){return this._orthoRight}set orthoRight(u){this._orthoRight=u}get orthoTop(){return this._orthoTop}set orthoTop(u){this._orthoTop=u}get orthoBottom(){return this._orthoBottom}set orthoBottom(u){this._orthoBottom=u}constructor(u,G,s){super(u,s),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=G.scale(-1),this.direction=G}getClassName(){return"kb"}getTypeID(){return f.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(u,G,s){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(u):this._setDefaultAutoExtendShadowProjectionMatrix(u,G,s)}_setDefaultFixedFrustumShadowProjectionMatrix(u){const G=this.va().activeCamera;G&&O.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:G.Mi,void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,u,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(u,G,s){const T=this.va().activeCamera;if(!T)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const u=O.q.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let T=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let m=0;m<s.length;m++){const f=s[m];if(!f)continue;const C=f.getBoundingInfo().boundingBox;for(let s=0;s<C.vectorsWorld.length;s++)O.q.TransformCoordinatesToRef(C.vectorsWorld[s],G,u),u.x<this._orthoLeft&&(this._orthoLeft=u.x),u.y<this._orthoBottom&&(this._orthoBottom=u.y),u.x>this._orthoRight&&(this._orthoRight=u.x),u.y>this._orthoTop&&(this._orthoTop=u.y),this.autoCalcShadowZBounds&&(u.z<T&&(T=u.z),u.z>z&&(z=u.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=T,this._shadowMaxZ=z)}const z=this._orthoRight-this._orthoLeft,m=this._orthoTop-this._orthoBottom,f=void 0!==this.shadowMinZ?this.shadowMinZ:T.Mi,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,x=this.va().getEngine().useReverseDepthBuffer;O.d.OrthoOffCenterLHToRef(this._orthoLeft-z*this.shadowOrthoScale,this._orthoRight+z*this.shadowOrthoScale,this._orthoBottom-m*this.shadowOrthoScale,this._orthoTop+m*this.shadowOrthoScale,x?C:f,x?f:C,u,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(u,G){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,G),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,G),this)}transferToNodeMaterialEffect(u,G){return this.computeTransformedInformation()?(u.setFloat3(G,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(u.setFloat3(G,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(u){const G=this._scene.getEngine();return!G.useReverseDepthBuffer&&G.isNDCHalfZRange?0:1}getDepthMaxZ(u){const G=this._scene.getEngine();return G.useReverseDepthBuffer&&G.isNDCHalfZRange?0:1}prepareLightSpecificDefines(u,G){u["DIRLIGHT"+G]=!0}}(0,T.b)([(0,z.M)()],g.prototype,"shadowFrustumSize",null),(0,T.b)([(0,z.M)()],g.prototype,"shadowOrthoScale",null),(0,T.b)([(0,z.M)()],g.prototype,"autoUpdateExtends",void 0),(0,T.b)([(0,z.M)()],g.prototype,"autoCalcShadowZBounds",void 0),(0,T.b)([(0,z.M)("orthoLeft")],g.prototype,"_orthoLeft",void 0),(0,T.b)([(0,z.M)("orthoRight")],g.prototype,"_orthoRight",void 0),(0,T.b)([(0,z.M)("orthoTop")],g.prototype,"_orthoTop",void 0),(0,T.b)([(0,z.M)("orthoBottom")],g.prototype,"_orthoBottom",void 0),(0,x.g)("BABYLON.DirectionalLight",g)},12285:(u,G,s)=>{"use strict";s.d(G,{d:()=>g});var T=s(10863),z=s(10866),O=s(10904),m=s(10930),f=s(11161),C=s(11890),x=s(10715);f.b.AddNodeConstructor("Light_Type_3",((u,G)=>()=>new g(u,O.q.Zero(),G)));class g extends C.e{constructor(u,G,s){super(u,s),this.groundColor=new m.b(0,0,0),this.direction=G||O.q.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(u){return this.direction=O.q.Normalize(u.Nc(O.q.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(u,G){const s=O.q.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",s.x,s.y,s.z,0,G),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Qi),G),this}transferToNodeMaterialEffect(u,G){const s=O.q.Normalize(this.direction);return u.setFloat3(G,s.x,s.y,s.z),this}Gj(){return this._worldMatrix||(this._worldMatrix=O.d.Identity()),this._worldMatrix}getTypeID(){return C.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(u,G){u["HEMILIGHT"+G]=!0}}(0,T.b)([(0,z.k)()],g.prototype,"groundColor",void 0),(0,T.b)([(0,z.J)()],g.prototype,"direction",void 0),(0,x.g)("BABYLON.HemisphericLight",g)},11890:(u,G,s)=>{"use strict";s.d(G,{e:()=>Q});var T=s(10863),z=s(10866),O=s(10904),m=s(10930),f=s(11161),C=s(10954),x=s(10715),g=s(11030),b=s(10935);class Q extends f.b{get range(){return this._range}set range(u){this._range=u,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(u){this._intensityMode=u,this._computePhotometricScale()}get i(){return this._radius}set i(u){this._radius=u,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(u){this._shadowEnabled!==u&&(this._shadowEnabled=u,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(u){this._includedOnlyMeshes=u,this._hookArrayForIncludedOnly(u)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(u){this._excludedMeshes=u,this._hookArrayForExcluded(u)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(u){this._excludeWithLayerMask=u,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(u){this._includeOnlyWithLayerMask=u,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(u){this._lightmapMode!==u&&(this._lightmapMode=u,this._markMeshesAsLightDirty())}getViewMatrix(u){return null}getProjectionMatrix(u,G){return null}constructor(u,G){super(u,G,!1),this.$g=new m.b(1,1,1),this.ah=new m.b(1,1,1),this.falloffType=Q.FALLOFF_DEFAULT,this.Qi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=Q.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new C.c(this.va().getEngine(),void 0,void 0,u),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(u,G){return this}_bindLight(u,G,s,T){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const O=u.toString();let f=!1;if(this._uniformBuffer.bindToEffect(s,"Light"+O),this._renderId!==G.getRenderId()||this._lastUseSpecular!==T||!this._uniformBuffer.useUbo){this._renderId=G.getRenderId(),this._lastUseSpecular=T;const u=this.getScaledIntensity();this.transferToEffect(s,O),this.$g.scaleToRef(u,m.f.hb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",m.f.hb[0],this.range,O),T&&(this.ah.scaleToRef(u,m.f.hb[1]),this._uniformBuffer.updateColor4("vLightSpecular",m.f.hb[1],this.i,O)),f=!0}if(this.transferTexturesToEffect(s,O),G.shadowsEnabled&&this.shadowEnabled&&z){const u=this.getShadowGenerator(G.activeCamera)??this.getShadowGenerator();u&&(u.bindShadowLight(O,s),f=!0)}f?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(u){let G="Name: "+this.name;if(G+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let s=0;s<this.animations.length;s++)G+=", animation[0]: "+this.animations[s].toString(u);return G}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Af(u){super.Af(u),this._resyncMeshes()}getShadowGenerator(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(u)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return O.q.Zero()}canAffectMesh(u){return!u||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(u))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(u))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&u.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&u.layerMask)))}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const u=this._shadowGenerators.values();for(let G=u.next();!0!==G.done;G=u.next()){G.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const u=this._parentContainer.lights.indexOf(this);u>-1&&this._parentContainer.lights.splice(u,1),this._parentContainer=null}for(const s of this.va().meshes)s._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(u,G)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Qi}clone(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=Q.GetConstructorFromName(this.getTypeID(),u,this.va());if(!s)return null;const T=b.e.Clone(s,this);return u&&(T.name=u),G&&(T.parent=G),T.Af(this.isEnabled()),this.onClonedObservable.notifyObservers(T),T}serialize(){const u=b.e.Serialize(this);return u.uniqueId=this.uniqueId,u.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(u),this.excludedMeshes.length>0&&(u.excludedMeshesIds=[],this.excludedMeshes.forEach((G=>{u.excludedMeshesIds.push(G.id)}))),this.includedOnlyMeshes.length>0&&(u.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((G=>{u.includedOnlyMeshesIds.push(G.id)}))),b.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}static GetConstructorFromName(u,G,s){const T=f.b.Construct("Light_Type_"+u,G,s);return T||null}static Parse(u,G){const s=Q.GetConstructorFromName(u.type,u.name,G);if(!s)return null;const T=b.e.Parse(s,u,G);if(u.excludedMeshesIds&&(T._excludedMeshesIds=u.excludedMeshesIds),u.includedOnlyMeshesIds&&(T._includedOnlyMeshesIds=u.includedOnlyMeshesIds),void 0!==u.parentId&&(T._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(T._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.falloffType&&(T.falloffType=u.falloffType),void 0!==u.lightmapMode&&(T.lightmapMode=u.lightmapMode),u.animations){for(let G=0;G<u.animations.length;G++){const s=u.animations[G],z=(0,x.e)("BABYLON.Animation");z&&T.animations.push(z.Parse(s))}f.b.ParseAnimationRanges(T,u,G)}return u.autoAnimate&&G.beginAnimation(T,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&T.Af(u.isEnabled),T}_hookArrayForExcluded(u){var G=this;const s=u.push;u.push=function(){for(var T=arguments.length,z=new Array(T),O=0;O<T;O++)z[O]=arguments[O];const m=s.apply(u,z);for(const u of z)u._resyncLightSource(G);return m};const T=u.splice;u.splice=(G,s)=>{const z=T.apply(u,[G,s]);for(const u of z)u._resyncLightSource(this);return z};for(const z of u)z._resyncLightSource(this)}_hookArrayForIncludedOnly(u){var G=this;const s=u.push;u.push=function(){for(var T=arguments.length,z=new Array(T),O=0;O<T;O++)z[O]=arguments[O];const m=s.apply(u,z);return G._resyncMeshes(),m};const T=u.splice;u.splice=(G,s)=>{const z=T.apply(u,[G,s]);return this._resyncMeshes(),z},this._resyncMeshes()}_resyncMeshes(){for(const u of this.va().meshes)u._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const u of this.va().meshes)-1!==u.lightSources.indexOf(this)&&u._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let u=0;const G=this.getTypeID();let s=this.intensityMode;switch(s===Q.INTENSITYMODE_AUTOMATIC&&(s=G===Q.LIGHTTYPEID_DIRECTIONALLIGHT?Q.INTENSITYMODE_ILLUMINANCE:Q.INTENSITYMODE_LUMINOUSINTENSITY),G){case Q.LIGHTTYPEID_POINTLIGHT:case Q.LIGHTTYPEID_SPOTLIGHT:switch(s){case Q.INTENSITYMODE_LUMINOUSPOWER:u=1/(4*Math.PI);break;case Q.INTENSITYMODE_LUMINOUSINTENSITY:u=1;break;case Q.INTENSITYMODE_LUMINANCE:u=this.i*this.i}break;case Q.LIGHTTYPEID_DIRECTIONALLIGHT:switch(s){case Q.INTENSITYMODE_ILLUMINANCE:u=1;break;case Q.INTENSITYMODE_LUMINANCE:{let G=this.i;G=Math.max(G,.001);u=2*Math.PI*(1-Math.cos(G));break}}break;case Q.LIGHTTYPEID_HEMISPHERICLIGHT:u=1}return u}_reorderLightsInScene(){const u=this.va();0!=this._renderPriority&&(u.requireLightSorting=!0),this.va().sortLightsByPriority()}}Q.FALLOFF_DEFAULT=g.d.FALLOFF_DEFAULT,Q.FALLOFF_PHYSICAL=g.d.FALLOFF_PHYSICAL,Q.FALLOFF_GLTF=g.d.FALLOFF_GLTF,Q.FALLOFF_STANDARD=g.d.FALLOFF_STANDARD,Q.LIGHTMAP_DEFAULT=g.d.LIGHTMAP_DEFAULT,Q.LIGHTMAP_SPECULAR=g.d.LIGHTMAP_SPECULAR,Q.LIGHTMAP_SHADOWSONLY=g.d.LIGHTMAP_SHADOWSONLY,Q.INTENSITYMODE_AUTOMATIC=g.d.INTENSITYMODE_AUTOMATIC,Q.INTENSITYMODE_LUMINOUSPOWER=g.d.INTENSITYMODE_LUMINOUSPOWER,Q.INTENSITYMODE_LUMINOUSINTENSITY=g.d.INTENSITYMODE_LUMINOUSINTENSITY,Q.INTENSITYMODE_ILLUMINANCE=g.d.INTENSITYMODE_ILLUMINANCE,Q.INTENSITYMODE_LUMINANCE=g.d.INTENSITYMODE_LUMINANCE,Q.LIGHTTYPEID_POINTLIGHT=g.d.LIGHTTYPEID_POINTLIGHT,Q.LIGHTTYPEID_DIRECTIONALLIGHT=g.d.LIGHTTYPEID_DIRECTIONALLIGHT,Q.LIGHTTYPEID_SPOTLIGHT=g.d.LIGHTTYPEID_SPOTLIGHT,Q.LIGHTTYPEID_HEMISPHERICLIGHT=g.d.LIGHTTYPEID_HEMISPHERICLIGHT,(0,T.b)([(0,z.k)()],Q.prototype,"diffuse",void 0),(0,T.b)([(0,z.k)()],Q.prototype,"specular",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"falloffType",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"intensity",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"range",null),(0,T.b)([(0,z.M)()],Q.prototype,"intensityMode",null),(0,T.b)([(0,z.M)()],Q.prototype,"i",null),(0,T.b)([(0,z.M)()],Q.prototype,"_renderPriority",void 0),(0,T.b)([(0,z.d)("_reorderLightsInScene")],Q.prototype,"renderPriority",void 0),(0,T.b)([(0,z.M)("shadowEnabled")],Q.prototype,"_shadowEnabled",void 0),(0,T.b)([(0,z.M)("excludeWithLayerMask")],Q.prototype,"_excludeWithLayerMask",void 0),(0,T.b)([(0,z.M)("includeOnlyWithLayerMask")],Q.prototype,"_includeOnlyWithLayerMask",void 0),(0,T.b)([(0,z.M)("lightmapMode")],Q.prototype,"_lightmapMode",void 0)},11030:(u,G,s)=>{"use strict";s.d(G,{d:()=>T});class T{static CompareLightsPriority(u,G){return u.shadowEnabled!==G.shadowEnabled?(G.shadowEnabled?1:0)-(u.shadowEnabled?1:0):G.renderPriority-u.renderPriority}}T.FALLOFF_DEFAULT=0,T.FALLOFF_PHYSICAL=1,T.FALLOFF_GLTF=2,T.FALLOFF_STANDARD=3,T.LIGHTMAP_DEFAULT=0,T.LIGHTMAP_SPECULAR=1,T.LIGHTMAP_SHADOWSONLY=2,T.INTENSITYMODE_AUTOMATIC=0,T.INTENSITYMODE_LUMINOUSPOWER=1,T.INTENSITYMODE_LUMINOUSINTENSITY=2,T.INTENSITYMODE_ILLUMINANCE=3,T.INTENSITYMODE_LUMINANCE=4,T.LIGHTTYPEID_POINTLIGHT=0,T.LIGHTTYPEID_DIRECTIONALLIGHT=1,T.LIGHTTYPEID_SPOTLIGHT=2,T.LIGHTTYPEID_HEMISPHERICLIGHT=3},11938:(u,G,s)=>{"use strict";s.d(G,{e:()=>C});var T=s(10863),z=s(10866),O=s(10904),m=s(11890),f=s(11201);class C extends m.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=O.d.Identity(),this._projectionMatrix=O.d.Identity()}_setPosition(u){this._position=u}get position(){return this._position}set position(u){this._setPosition(u)}_setDirection(u){this._direction=u}get direction(){return this._direction}set direction(u){this._setDirection(u)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(u){this._shadowMinZ=u,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(u){this._shadowMaxZ=u,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=O.q.Zero()),O.q.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=O.q.Zero()),O.q.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(u){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(u){return this.direction=O.q.Normalize(u.Nc(this.position)),this.direction}getRotation(){this.direction.normalize();const u=O.q.Cross(this.direction,f.e.Y),G=O.q.Cross(u,this.direction);return O.q.RotationFromAxis(u,G,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=O.q.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Gj(u){return!u&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=O.d.Identity()),O.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(u){return void 0!==this.shadowMinZ?this.shadowMinZ:u.Mi}getDepthMaxZ(u){return void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ}setShadowProjectionMatrix(u,G,s){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(G,s,u):this._setDefaultShadowProjectionMatrix(u,G,s),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(u){const G=O.l.gb[0];let s=this.position;this.computeTransformedInformation()&&(s=this.transformedPosition),O.q.NormalizeToRef(this.getShadowDirection(u),G),1===Math.abs(O.q.Dot(G,O.q.Up()))&&(G.z=1e-13);const T=O.l.gb[1];return s.addToRef(G,T),O.d.LookAtLHToRef(s,T,O.q.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(u,G){return this.setShadowProjectionMatrix(this._projectionMatrix,u??this._viewMatrix,G??[]),this._projectionMatrix}}(0,T.b)([(0,z.J)()],C.prototype,"position",null),(0,T.b)([(0,z.J)()],C.prototype,"direction",null),(0,T.b)([(0,z.M)()],C.prototype,"shadowMinZ",null),(0,T.b)([(0,z.M)()],C.prototype,"shadowMaxZ",null)},11526:(u,G,s)=>{"use strict";s.d(G,{c:()=>m,g:()=>O,i:()=>f});const T={},z={};function O(u,G){T[u]=G}function m(u,G){z[u]=G}function f(u){return z[u]?z[u]:null}},11265:(u,G,s)=>{"use strict";s.d(G,{c:()=>B,d:()=>H});var T,z=s(10564),O=s(10568),m=s(10889),f=s(10619),C=s(10584),x=s(11186),g=s(10622),b=s(10625),Q=s(10720),Y=s(10645);!function(u){u[u.Clean=0]="Clean",u[u.Stop=1]="Stop",u[u.Sync=2]="Sync",u[u.NoSync=3]="NoSync"}(T||(T={}));const n=new O.e,V={};let F=!1;function r(){return V[".babylon"]}function c(u){const G=V[u];return G||(C.d.Warn("Unable to find a plugin to load "+u+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),r())}function j(u,G,s){let T="Unable to load from "+(u.rawData?"binary data":u.url);return G?T+=`: ${G}`:s&&(T+=`: ${s}`),T}function l(u,G,s,T,z,O,m,f,C){var x;const b="data:"===(Q=u.url).substring(0,5)?Q.substring(5):null;var Q;if(u.rawData&&!m)throw"When using ArrayBufferView to load data the file extension must be provided.";const F=m?c(m):b?function(u){for(const G in V){const s=V[G].plugin;if(s.canDirectLoad&&s.canDirectLoad(u))return V[G]}return r()}(u.url):function(u){const G=u.indexOf("?");-1!==G&&(u=u.substring(0,G));const s=u.lastIndexOf(".");return c(u.substring(s,u.length).toLowerCase())}(u.url);if(!F)throw new Error(`No plugin or fallback for ${m??u.url}`);if(!1===(null===C||void 0===C||null===(x=C[F.plugin.name])||void 0===x?void 0:x.enabled))throw new Error(`The '${F.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(u.rawData&&!F.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(u=>{if(F.plugin.createPlugin){const G=F.plugin.createPlugin(C??{});return G instanceof Promise?(G.then(u).catch((u=>{z("Error instantiating plugin.",u)})),null):(u(G),G)}return u(F.plugin),F.plugin})((C=>{var x;if(!C)throw`The loader plugin corresponding to the '${m}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(n.notifyObservers(C),b&&(C.canDirectLoad&&C.canDirectLoad(u.url)||!(0,g.f)(u.url))){if(C.directLoad){const u=C.directLoad(G,b);u instanceof Promise?u.then((u=>{s(C,u)})).catch((u=>{z("Error in directLoad of _loadData: "+u,u)})):s(C,u)}else s(C,b);return}const Q=F.isBinary,V=(u,T)=>{G.u?z("Scene has been disposed"):s(C,u,T)};let r=null,c=!1;null===(x=C._i)||void 0===x||x.add((()=>{c=!0,r&&(r.abort(),r=null),O()}));const j=()=>{if(c)return;const s=(u,G)=>{z(null===u||void 0===u?void 0:u.statusText,G)};if(!C.loadFile&&u.rawData)throw"Plugin does not support loading ArrayBufferView.";r=C.loadFile?C.loadFile(G,u.rawData||u.file||u.url,u.rootUrl,V,T,Q,s,f):G._loadFile(u.file||u.url,V,T,!0,Q,s)},l=G.getEngine();let P=l.enableOfflineSupport;if(P){let s=!1;for(const T of G.disableOfflineSupportExceptionRules)if(T.test(u.url)){s=!0;break}P=!s}P&&Y.b.OfflineProviderFactory?G.offlineProvider=Y.b.OfflineProviderFactory(u.url,j,l.disableManifestCheck):j()}))}function P(u,G){let s,T,O=null,m=null;if(G)if(G.name)s=`file:${G.name}`,T=G.name,O=G;else if(ArrayBuffer.isView(G))s="",T=(0,Q.c)(),m=G;else if(G.startsWith("data:"))s=G,T="";else if(u){const O=G;if("/"===O.substring(0,1))return z.e.Error("Wrong sceneFilename parameter"),null;s=u+O,T=O}else s=G,T=z.e.GetFilename(G),u=z.e.GetFolderPath(G);else s=u,T=z.e.GetFilename(u),u=z.e.GetFolderPath(u);return{url:s,rootUrl:u,name:T,file:O,rawData:m}}function H(u){if("string"===typeof u.extensions){const G=u.extensions;V[G.toLowerCase()]={plugin:u,isBinary:!1}}else{const G=u.extensions;Object.keys(G).forEach((s=>{V[s.toLowerCase()]={plugin:u,isBinary:G[s].isBinary}}))}}function X(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.d.LastCreatedScene,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!T)return C.d.Error("No scene available to import mesh to"),null;const Y=P(G,s);if(!Y)return null;const n={};T.addPendingData(n);const V=()=>{T.removePendingData(n)},F=(u,G)=>{const s=j(Y,u,G);m?m(T,s,new b.g(s,b.f.SceneLoaderError,G)):C.d.Error(s),V()},r=O?u=>{try{O(u)}catch(G){F("Error in onProgress callback: "+G,G)}}:void 0,c=(u,G,s,O,m,f,C,x)=>{if(T.importedMeshesFiles.push(Y.url),z)try{z(u,G,s,O,m,f,C,x)}catch(g){F("Error in onSuccess callback: "+g,g)}T.removePendingData(n)};return l(Y,T,((G,s,z)=>{if(G.rewriteRootURL&&(Y.rootUrl=G.rewriteRootURL(Y.rootUrl,z)),G.importMesh){const z=[],O=[],m=[];if(!G.importMesh(u,T,s,Y.rootUrl,z,O,m,F))return;T.loadingPluginName=G.name,c(z,O,m,[],[],[],[],[])}else{G.importMeshAsync(u,T,s,Y.rootUrl,r,Y.name).then((u=>{T.loadingPluginName=G.name,c(u.meshes,u.fj,u.skeletons,u.animationGroups,u.transformNodes,u.geometries,u.lights,u.spriteManagers)})).catch((u=>{F(u.message,u)}))}}),r,F,V,x,g,Q)}function p(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.d.LastCreatedEngine,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return s?d(u,G,new m.e(s),T,O,C,x,g,b):(z.e.Error("No engine available"),null)}function q(u,G,s,T,z,O,m){return new Promise(((f,C)=>{p(u,G,s,(u=>{f(u)}),T,((u,G,s)=>{C(s||new Error(G))}),z,O,m)}))}function d(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.d.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!s)return C.d.Error("No scene available to append to"),null;const Y=P(u,G);if(!Y)return null;const n={};s.addPendingData(n);const V=()=>{s.removePendingData(n)};x.c.ShowLoadingScreen&&!F&&(F=!0,s.getEngine().displayLoadingUI(),s.executeWhenReady((()=>{s.getEngine().hideLoadingUI(),F=!1})));const r=(u,G)=>{const T=j(Y,u,G);O?O(s,T,new b.g(T,b.f.SceneLoaderError,G)):C.d.Error(T),V()},c=z?u=>{try{z(u)}catch(G){r("Error in onProgress callback",G)}}:void 0,H=()=>{if(T)try{T(s)}catch(u){r("Error in onSuccess callback",u)}s.removePendingData(n)};return l(Y,s,((u,G)=>{if(u.load){if(!u.load(s,G,Y.rootUrl,r))return;s.loadingPluginName=u.name,H()}else{u.loadAsync(s,G,Y.rootUrl,c,Y.name).then((()=>{s.loadingPluginName=u.name,H()})).catch((u=>{r(u.message,u)}))}}),c,r,V,m,g,Q)}function v(u,G,s,T,z,O,m){return new Promise(((f,C)=>{d(u,G,s,(u=>{f(u)}),T,((u,G,s)=>{C(s||new Error(G))}),z,O,m)}))}function W(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.d.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!s)return C.d.Error("No scene available to load asset container to"),null;const Q=P(u,G);if(!Q)return null;const Y={};s.addPendingData(Y);const n=()=>{s.removePendingData(Y)},V=(u,G)=>{const T=j(Q,u,G);O?O(s,T,new b.g(T,b.f.SceneLoaderError,G)):C.d.Error(T),n()},F=z?u=>{try{z(u)}catch(G){V("Error in onProgress callback",G)}}:void 0,r=u=>{if(T)try{T(u)}catch(G){V("Error in onSuccess callback",G)}s.removePendingData(Y)};return l(Q,s,((u,G)=>{if(u.loadAssetContainer){const T=u.loadAssetContainer(s,G,Q.rootUrl,V);if(!T)return;T.populateRootNodes(),s.loadingPluginName=u.name,r(T)}else if(u.loadAssetContainerAsync){u.loadAssetContainerAsync(s,G,Q.rootUrl,F,Q.name).then((G=>{G.populateRootNodes(),s.loadingPluginName=u.name,r(G)})).catch((u=>{V(u.message,u)}))}else V("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),F,V,n,m,x,g)}function M(u,G,s,T,z,O,m){return new Promise(((f,C)=>{W(u,G,s,(u=>{f(u)}),T,((u,G,s)=>{C(s||new Error(G))}),z,O,m)}))}function o(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.d.LastCreatedScene,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!s)return void C.d.Error("No scene available to load animations to");if(T){for(const u of s.animatables)u.reset();s.stopAllAnimations(),s.animationGroups.slice().forEach((u=>{u.dispose()}));s.getNodes().forEach((u=>{u.animations&&(u.animations=[])}))}else switch(z){case 0:s.animationGroups.slice().forEach((u=>{u.dispose()}));break;case 1:s.animationGroups.forEach((u=>{u.stop()}));break;case 2:s.animationGroups.forEach((u=>{u.reset(),u.restart()}));break;case 3:break;default:return void C.d.Error("Unknown animation group loading mode value '"+z+"'")}const n=s.animatables.length;W(u,G,s,(u=>{u.mergeAnimationsTo(s,s.animatables.slice(n),O),u.dispose(),s.onAnimationFileImportedObservable.notifyObservers(s),m&&m(s)}),x,g,b,Q,Y)}function R(u,G,s,T,z,O,m,f,C,x){return new Promise(((g,b)=>{o(u,G,s,T,z,O,(u=>{g(u)}),m,((u,G,s)=>{b(s||new Error(G))}),f,C,x)}))}class B{static get ForceFullSceneLoadingForIncremental(){return x.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){x.c.ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return x.c.ShowLoadingScreen}static set ShowLoadingScreen(u){x.c.ShowLoadingScreen=u}static get loggingLevel(){return x.c.loggingLevel}static set loggingLevel(u){x.c.loggingLevel=u}static get CleanBoneMatrixWeights(){return x.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){x.c.CleanBoneMatrixWeights=u}static GetDefaultPlugin(){return r()}static GetPluginForExtension(u){var G;return null===(G=c(u))||void 0===G?void 0:G.plugin}static IsPluginForExtensionAvailable(u){return function(u){return!!V[u]}(u)}static RegisterPlugin(u){H(u)}static ImportMesh(u,G,s,T,z,O,m,f,C){return X(u,G,s,T,z,O,m,f,C)}static ImportMeshAsync(u,G,s,T,z,O,m){return function(u,G,s,T,z,O,m,f){return new Promise(((C,x)=>{X(u,G,s,T,((u,G,s,T,z,O,m,f)=>{C({meshes:u,fj:G,skeletons:s,animationGroups:T,transformNodes:z,geometries:O,lights:m,spriteManagers:f})}),z,((u,G,s)=>{x(s||new Error(G))}),O,m,f)}))}(u,G,s,T,z,O,m)}static Load(u,G,s,T,z,O,m,f){return p(u,G,s,T,z,O,m,f)}static LoadAsync(u,G,s,T,z,O){return q(u,G,s,T,z,O)}static Append(u,G,s,T,z,O,m,f){return d(u,G,s,T,z,O,m,f)}static AppendAsync(u,G,s,T,z,O){return v(u,G,s,T,z,O)}static LoadAssetContainer(u,G,s,T,z,O,m,f){return W(u,G,s,T,z,O,m,f)}static LoadAssetContainerAsync(u,G,s,T,z,O){return M(u,G,s,T,z,O)}static ImportAnimations(u,G,s,T,z,O,m,f,C,x,g){o(u,G,s,T,z,O,m,f,C,x,g)}static ImportAnimationsAsync(u,G,s,T,z,O,m,f,C,x,g){return R(u,G,s,T,z,O,f,x,g)}}B.NO_LOGGING=0,B.MINIMAL_LOGGING=1,B.SUMMARY_LOGGING=2,B.DETAILED_LOGGING=3,B.OnPluginActivatedObservable=n},11186:(u,G,s)=>{"use strict";s.d(G,{c:()=>T});class T{static get ForceFullSceneLoadingForIncremental(){return T._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){T._ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return T._ShowLoadingScreen}static set ShowLoadingScreen(u){T._ShowLoadingScreen=u}static get loggingLevel(){return T._LoggingLevel}static set loggingLevel(u){T._LoggingLevel=u}static get CleanBoneMatrixWeights(){return T._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){T._CleanBoneMatrixWeights=u}}T._ForceFullSceneLoadingForIncremental=!1,T._ShowLoadingScreen=!0,T._CleanBoneMatrixWeights=!1,T._LoggingLevel=0},11865:(u,G,s)=>{"use strict";s.d(G,{b:()=>h});var T=s(10863),z=s(10866),O=s(10584),m=s(10881),f=s(11852),C=s(10889),x=s(10904),g=s(10961),b=s(11091),Q=s(11138);class Y extends b.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class n extends Q.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRBRDF",90,new Y,G),this._useEnergyConservation=n.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=n.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=n.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=n.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16],this._enable(!0)}prepareDefines(u){u.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,u.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,u.SPHERICAL_HARMONICS=this._useSphericalHarmonics,u.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}n.DEFAULT_USE_ENERGY_CONSERVATION=!0,n.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,n.DEFAULT_USE_SPHERICAL_HARMONICS=!0,n.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useEnergyConservation",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSphericalHarmonics",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var V=s(11039),F=s(10930),r=s(10927),c=s(11045),j=s(11098),l=s(11102),P=s(11126),H=(s(11868),s(11130)),X=s(11085);class p extends b.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class q extends Q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRClearCoat",100,new p,G),this._isEnabled=!1,this.isEnabled=!1,this.Qi=1,this.roughness=0,this._indexOfRefraction=q._DefaultIndexOfRefraction,this.indexOfRefraction=q._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=F.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,G,s){if(!this._isEnabled)return!0;const T=this._material._disableBumpMap;if(u._areTexturesDirty&&G.texturesEnabled){if(this._texture&&P.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&P.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(s.getCaps().standardDerivatives&&this._bumpTexture&&P.e.ClearCoatBumpTextureEnabled&&!T&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&P.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,G){this._isEnabled?(u.CLEARCOAT=!0,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,u._areTexturesDirty&&G.texturesEnabled&&(this._texture&&P.e.ClearCoatTextureEnabled?(0,X.T)(this._texture,u,"CLEARCOAT_TEXTURE"):u.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&P.e.ClearCoatTextureEnabled?(0,X.T)(this._textureRoughness,u,"CLEARCOAT_TEXTURE_ROUGHNESS"):u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&P.e.ClearCoatBumpTextureEnabled?(0,X.T)(this._bumpTexture,u,"CLEARCOAT_BUMP"):u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===q._DefaultIndexOfRefraction,this._isTintEnabled?(u.CLEARCOAT_TINT=!0,this._tintTexture&&P.e.ClearCoatTintTextureEnabled?((0,X.T)(this._tintTexture,u,"CLEARCOAT_TINT_TEXTURE"),u.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):u.CLEARCOAT_TINT_TEXTURE=!1):(u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1))):(u.CLEARCOAT=!1,u.CLEARCOAT_TEXTURE=!1,u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.CLEARCOAT_DEFAULTIOR=!1,u.CLEARCOAT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,u.CLEARCOAT_BUMPDIRECTUV=0,u.CLEARCOAT_REMAP_F0=!1,u.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(u,G,s,T){if(!this._isEnabled)return;const z=T.materialDefines,O=this._material.isFrozen,m=this._material._disableBumpMap,f=this._material._invertNormalMapX,C=this._material._invertNormalMapY;if(!u.useUbo||!O||!u.isSync){var x,g,b,Q;if((this._texture||this._textureRoughness)&&P.e.ClearCoatTextureEnabled)u.updateFloat4("vClearCoatInfos",(null===(x=this._texture)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(g=this._texture)||void 0===g?void 0:g.level)??0,(null===(b=this._textureRoughness)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(Q=this._textureRoughness)||void 0===Q?void 0:Q.level)??0),this._texture&&(0,X.n)(this._texture,u,"clearCoat"),this._textureRoughness&&!z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,X.n)(this._textureRoughness,u,"clearCoatRoughness");this._bumpTexture&&s.getCaps().standardDerivatives&&P.e.ClearCoatTextureEnabled&&!m&&(u.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,X.n)(this._bumpTexture,u,"clearCoatBump"),G._mirroredCameraPosition?u.updateFloat2("vClearCoatTangentSpaceParams",f?1:-1,C?1:-1):u.updateFloat2("vClearCoatTangentSpaceParams",f?-1:1,C?-1:1)),this._tintTexture&&P.e.ClearCoatTintTextureEnabled&&(u.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,X.n)(this._tintTexture,u,"clearCoatTint")),u.updateFloat2("vClearCoatParams",this.Qi,this.roughness);const T=1-this._indexOfRefraction,O=1+this._indexOfRefraction,Y=Math.pow(-T/O,2),n=1/this._indexOfRefraction;u.updateFloat4("vClearCoatRefractionParams",Y,n,T,O),this._isTintEnabled&&(u.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),u.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}G.texturesEnabled&&(this._texture&&P.e.ClearCoatTextureEnabled&&u.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&P.e.ClearCoatTextureEnabled&&u.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&s.getCaps().standardDerivatives&&P.e.ClearCoatBumpTextureEnabled&&!m&&u.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&P.e.ClearCoatTintTextureEnabled&&u.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(u){return this._texture===u||(this._textureRoughness===u||(this._bumpTexture===u||this._tintTexture===u))}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness),this._bumpTexture&&u.push(this._bumpTexture),this._tintTexture&&u.push(this._tintTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&u.push(this._tintTexture)}dispose(u){var G,s,T,z;u&&(null===(G=this._texture)||void 0===G||G.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose(),null===(T=this._bumpTexture)||void 0===T||T.dispose(),null===(z=this._tintTexture)||void 0===z||z.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(u,G,s){return u.CLEARCOAT_BUMP&&G.addFallback(s++,"CLEARCOAT_BUMP"),u.CLEARCOAT_TINT&&G.addFallback(s++,"CLEARCOAT_TINT"),u.CLEARCOAT&&G.addFallback(s++,"CLEARCOAT"),s}getSamplers(u){u.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}q._DefaultIndexOfRefraction=1.5,(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isEnabled",void 0),(0,T.b)([(0,z.M)()],q.prototype,"intensity",void 0),(0,T.b)([(0,z.M)()],q.prototype,"roughness",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"indexOfRefraction",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"texture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMainTexture",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"textureRoughness",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"remapF0OnInterfaceChange",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"bumpTexture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isTintEnabled",void 0),(0,T.b)([(0,z.k)()],q.prototype,"tintColor",void 0),(0,T.b)([(0,z.M)()],q.prototype,"tintColorAtDistance",void 0),(0,T.b)([(0,z.M)()],q.prototype,"tintThickness",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"tintTexture",void 0);class d extends b.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class v extends Q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRIridescence",110,new d,G),this._isEnabled=!1,this.isEnabled=!1,this.Qi=1,this.minimumThickness=v._DefaultMinimumThickness,this.maximumThickness=v._DefaultMaximumThickness,this.indexOfRefraction=v._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,G){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&G.texturesEnabled){if(this._texture&&P.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&P.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,G){this._isEnabled?(u.IRIDESCENCE=!0,u._areTexturesDirty&&G.texturesEnabled&&(this._texture&&P.e.IridescenceTextureEnabled?(0,X.T)(this._texture,u,"IRIDESCENCE_TEXTURE"):u.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&P.e.IridescenceTextureEnabled?(0,X.T)(this._thicknessTexture,u,"IRIDESCENCE_THICKNESS_TEXTURE"):u.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(u.IRIDESCENCE=!1,u.IRIDESCENCE_TEXTURE=!1,u.IRIDESCENCE_THICKNESS_TEXTURE=!1,u.IRIDESCENCE_TEXTUREDIRECTUV=0,u.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(u,G){if(!this._isEnabled)return;const s=this._material.isFrozen;if(!u.useUbo||!s||!u.isSync){var T,z,O,m;if((this._texture||this._thicknessTexture)&&P.e.IridescenceTextureEnabled)u.updateFloat4("vIridescenceInfos",(null===(T=this._texture)||void 0===T?void 0:T.coordinatesIndex)??0,(null===(z=this._texture)||void 0===z?void 0:z.level)??0,(null===(O=this._thicknessTexture)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(m=this._thicknessTexture)||void 0===m?void 0:m.level)??0),this._texture&&(0,X.n)(this._texture,u,"iridescence"),this._thicknessTexture&&(0,X.n)(this._thicknessTexture,u,"iridescenceThickness");u.updateFloat4("vIridescenceParams",this.Qi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}G.texturesEnabled&&(this._texture&&P.e.IridescenceTextureEnabled&&u.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&P.e.IridescenceTextureEnabled&&u.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(u){return this._texture===u||this._thicknessTexture===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._thicknessTexture&&u.push(this._thicknessTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture)}dispose(u){var G,s;u&&(null===(G=this._texture)||void 0===G||G.dispose(),null===(s=this._thicknessTexture)||void 0===s||s.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(u,G,s){return u.IRIDESCENCE&&G.addFallback(s++,"IRIDESCENCE"),s}getSamplers(u){u.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}v._DefaultMinimumThickness=100,v._DefaultMaximumThickness=400,v._DefaultIndexOfRefraction=1.3,(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,T.b)([(0,z.M)()],v.prototype,"intensity",void 0),(0,T.b)([(0,z.M)()],v.prototype,"minimumThickness",void 0),(0,T.b)([(0,z.M)()],v.prototype,"maximumThickness",void 0),(0,T.b)([(0,z.M)()],v.prototype,"indexOfRefraction",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"thicknessTexture",void 0);class W extends b.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class M extends Q.b{set angle(u){this.direction.x=Math.cos(u),this.direction.y=Math.sin(u)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRAnisotropic",110,new W,G),this._isEnabled=!1,this.isEnabled=!1,this.Qi=1,this.direction=new x.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16]}isReadyForSubMesh(u,G){return!this._isEnabled||!(u._areTexturesDirty&&G.texturesEnabled&&this._texture&&P.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(u,G,s){this._isEnabled?(u.ANISOTROPIC=this._isEnabled,this._isEnabled&&!s.isVerticesDataPresent(g.f.TangentKind)&&(u._needUVs=!0,u.MAINUV1=!0),u._areTexturesDirty&&G.texturesEnabled&&(this._texture&&P.e.AnisotropicTextureEnabled?(0,X.T)(this._texture,u,"ANISOTROPIC_TEXTURE"):u.ANISOTROPIC_TEXTURE=!1),u._areMiscDirty&&(u.ANISOTROPIC_LEGACY=this._legacy)):(u.ANISOTROPIC=!1,u.ANISOTROPIC_TEXTURE=!1,u.ANISOTROPIC_TEXTUREDIRECTUV=0,u.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(u,G){if(!this._isEnabled)return;const s=this._material.isFrozen;u.useUbo&&s&&u.isSync||(this._texture&&P.e.AnisotropicTextureEnabled&&(u.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,X.n)(this._texture,u,"anisotropy")),u.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Qi)),G.texturesEnabled&&this._texture&&P.e.AnisotropicTextureEnabled&&u.setTexture("anisotropySampler",this._texture)}hasTexture(u){return this._texture===u}getActiveTextures(u){this._texture&&u.push(this._texture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture)}dispose(u){u&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(u,G,s){return u.ANISOTROPIC&&G.addFallback(s++,"ANISOTROPIC"),s}getSamplers(u){u.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(u,G,s){super.parse(u,G,s),void 0===u.legacy&&(this.legacy=!0)}}(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,T.b)([(0,z.M)()],M.prototype,"intensity",void 0),(0,T.b)([(0,z.F)()],M.prototype,"direction",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsMiscDirty")],M.prototype,"legacy",void 0);class o extends b.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class R extends Q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"Sheen",120,new o,G),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Qi=1,this.color=F.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,G){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&G.texturesEnabled){if(this._texture&&P.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&P.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,G){this._isEnabled?(u.SHEEN=!0,u.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,u.SHEEN_ROUGHNESS=null!==this._roughness,u.SHEEN_ALBEDOSCALING=this._albedoScaling,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u._areTexturesDirty&&G.texturesEnabled&&(this._texture&&P.e.SheenTextureEnabled?((0,X.T)(this._texture,u,"SHEEN_TEXTURE"),u.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):u.SHEEN_TEXTURE=!1,this._textureRoughness&&P.e.SheenTextureEnabled?(0,X.T)(this._textureRoughness,u,"SHEEN_TEXTURE_ROUGHNESS"):u.SHEEN_TEXTURE_ROUGHNESS=!1)):(u.SHEEN=!1,u.SHEEN_TEXTURE=!1,u.SHEEN_TEXTURE_ROUGHNESS=!1,u.SHEEN_LINKWITHALBEDO=!1,u.SHEEN_ROUGHNESS=!1,u.SHEEN_ALBEDOSCALING=!1,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.SHEEN_GAMMATEXTURE=!1,u.SHEEN_TEXTUREDIRECTUV=0,u.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(u,G,s,T){if(!this._isEnabled)return;const z=T.materialDefines,O=this._material.isFrozen;if(!u.useUbo||!O||!u.isSync){var m,f,C,x;if((this._texture||this._textureRoughness)&&P.e.SheenTextureEnabled)u.updateFloat4("vSheenInfos",(null===(m=this._texture)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(f=this._texture)||void 0===f?void 0:f.level)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.level)??0),this._texture&&(0,X.n)(this._texture,u,"sheen"),this._textureRoughness&&!z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,X.n)(this._textureRoughness,u,"sheenRoughness");u.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Qi),null!==this._roughness&&u.updateFloat("vSheenRoughness",this._roughness)}G.texturesEnabled&&(this._texture&&P.e.SheenTextureEnabled&&u.setTexture("sheenSampler",this._texture),this._textureRoughness&&!z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&P.e.SheenTextureEnabled&&u.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(u){return this._texture===u||this._textureRoughness===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness)}dispose(u){var G,s;u&&(null===(G=this._texture)||void 0===G||G.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(u,G,s){return u.SHEEN&&G.addFallback(s++,"SHEEN"),s}getSamplers(u){u.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"linkSheenWithAlbedo",void 0),(0,T.b)([(0,z.M)()],R.prototype,"intensity",void 0),(0,T.b)([(0,z.k)()],R.prototype,"color",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useRoughnessFromMainTexture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"roughness",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"textureRoughness",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"albedoScaling",void 0);class B extends b.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class D extends Q.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(u){this._scene.enableSubSurfaceForPrePass()&&u&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(u))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(u){this._volumeIndexOfRefraction=u>=1?u:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"PBRSubSurface",130,new B,G),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=F.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=F.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=u.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=u._dirtyCallbacks[32]}isReadyForSubMesh(u,G){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(u._areTexturesDirty&&G.texturesEnabled){if(this._thicknessTexture&&P.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&P.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&P.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const u=this._getRefractionTexture(G);if(u&&P.e.RefractionTextureEnabled&&!u.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,G){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return u.SUBSURFACE=!1,u.SS_DISPERSION=!1,u.SS_TRANSLUCENCY=!1,u.SS_SCATTERING=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,u.SS_HAS_THICKNESS=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,u.SS_REFRACTIONMAP_3D=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(u.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(u._areTexturesDirty){if(u.SUBSURFACE=!0,u.SS_DISPERSION=this._isDispersionEnabled,u.SS_TRANSLUCENCY=this._isTranslucencyEnabled,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_SCATTERING=this._isScatteringEnabled,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_HAS_THICKNESS=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_REFRACTIONMAP_3D=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,u._areTexturesDirty&&G.texturesEnabled&&(this._thicknessTexture&&P.e.ThicknessTextureEnabled&&(0,X.T)(this._thicknessTexture,u,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&P.e.RefractionIntensityTextureEnabled&&(0,X.T)(this._refractionIntensityTexture,u,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&P.e.TranslucencyIntensityTextureEnabled&&(0,X.T)(this._translucencyIntensityTexture,u,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&P.e.TranslucencyColorTextureEnabled&&(0,X.T)(this._translucencyColorTexture,u,"SS_TRANSLUCENCYCOLOR_TEXTURE")),u.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,u.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&G.texturesEnabled){const s=this._getRefractionTexture(G);s&&P.e.RefractionTextureEnabled&&(u.SS_REFRACTION=!0,u.SS_REFRACTIONMAP_3D=s.isCube,u.SS_GAMMAREFRACTION=s.gammaSpace,u.SS_RGBDREFRACTION=s.isRGBD,u.SS_LINEARSPECULARREFRACTION=s.linearSpecularLOD,u.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&s.isCube?!s.invertZ:s.invertZ,u.SS_LODINREFRACTIONALPHA=s.lodLevelInAlpha,u.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,u.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=s.isCube&&s.boundingBoxSize,u.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(u.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(u,G,s,T){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)u.updateFloat2("vThicknessParam",0,0);else{T.getRenderingMesh().getWorldMatrix().decompose(x.l.gb[0]);const G=Math.max(Math.abs(x.l.gb[0].x),Math.abs(x.l.gb[0].y),Math.abs(x.l.gb[0].z));u.updateFloat2("vThicknessParam",this.minimumThickness*G,(this.maximumThickness-this.minimumThickness)*G)}}bindForSubMesh(u,G,s,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const z=T.materialDefines,O=this._material.isFrozen,m=this._material.realTimeFiltering,f=z.LODBASEDMICROSFURACE,C=this._getRefractionTexture(G);if(!u.useUbo||!O||!u.isSync){if(this._thicknessTexture&&P.e.ThicknessTextureEnabled&&(u.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,X.n)(this._thicknessTexture,u,"thickness")),this._refractionIntensityTexture&&P.e.RefractionIntensityTextureEnabled&&z.SS_REFRACTIONINTENSITY_TEXTURE&&(u.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,X.n)(this._refractionIntensityTexture,u,"refractionIntensity")),this._translucencyColorTexture&&P.e.TranslucencyColorTextureEnabled&&z.SS_TRANSLUCENCYCOLOR_TEXTURE&&(u.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,X.n)(this._translucencyColorTexture,u,"translucencyColor")),this._translucencyIntensityTexture&&P.e.TranslucencyIntensityTextureEnabled&&z.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(u.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,X.n)(this._translucencyIntensityTexture,u,"translucencyIntensity")),C&&P.e.RefractionTextureEnabled){u.xj("refractionMatrix",C.getRefractionTextureMatrix());let G=1;C.isCube||C.depth&&(G=C.depth);const s=C.getSize().width,T=this.volumeIndexOfRefraction;if(u.updateFloat4("vRefractionInfos",C.level,1/T,G,this._invertRefractionY?-1:1),u.updateFloat4("vRefractionMicrosurfaceInfos",s,C.lodGenerationScale,C.lodGenerationOffset,1/this.indexOfRefraction),m&&u.updateFloat2("vRefractionFilteringInfo",s,Math.log2(s)),C.boundingBoxSize){const G=C;u.updateVector3("vRefractionPosition",G.boundingBoxPosition),u.updateVector3("vRefractionSize",G.boundingBoxSize)}}this._isScatteringEnabled&&u.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),u.updateColor3("vDiffusionDistance",this.diffusionDistance),u.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),u.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),u.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),u.updateFloat("dispersion",this.dispersion)}G.texturesEnabled&&(this._thicknessTexture&&P.e.ThicknessTextureEnabled&&u.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&P.e.RefractionIntensityTextureEnabled&&z.SS_REFRACTIONINTENSITY_TEXTURE&&u.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&P.e.TranslucencyIntensityTextureEnabled&&z.SS_TRANSLUCENCYINTENSITY_TEXTURE&&u.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&P.e.TranslucencyColorTextureEnabled&&z.SS_TRANSLUCENCYCOLOR_TEXTURE&&u.setTexture("translucencyColorSampler",this._translucencyColorTexture),C&&P.e.RefractionTextureEnabled&&(f?u.setTexture("refractionSampler",C):(u.setTexture("refractionSampler",C._lodTextureMid||C),u.setTexture("refractionSamplerLow",C._lodTextureLow||C),u.setTexture("refractionSamplerHigh",C._lodTextureHigh||C))))}_getRefractionTexture(u){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?u.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(u){P.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&u.push(this._refractionTexture)}hasTexture(u){return this._thicknessTexture===u||(this._refractionTexture===u||(this._refractionIntensityTexture===u||(this._translucencyIntensityTexture===u||this._translucencyColorTexture===u)))}hasRenderTargetTextures(){return!!(P.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(u){this._thicknessTexture&&u.push(this._thicknessTexture),this._refractionTexture&&u.push(this._refractionTexture),this._translucencyColorTexture&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&u.push(this._translucencyIntensityTexture)}getAnimatables(u){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&u.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&u.push(this._translucencyIntensityTexture)}dispose(u){u&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(u,G,s){return u.SS_SCATTERING&&G.addFallback(s++,"SS_SCATTERING"),u.SS_TRANSLUCENCY&&G.addFallback(s++,"SS_TRANSLUCENCY"),s}getSamplers(u){u.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isRefractionEnabled",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isTranslucencyEnabled",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isDispersionEnabled",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markScenePrePassDirty")],D.prototype,"isScatteringEnabled",void 0),(0,T.b)([(0,z.M)()],D.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,T.b)([(0,z.M)()],D.prototype,"refractionIntensity",void 0),(0,T.b)([(0,z.M)()],D.prototype,"translucencyIntensity",void 0),(0,T.b)([(0,z.M)()],D.prototype,"useAlbedoToTintRefraction",void 0),(0,T.b)([(0,z.M)()],D.prototype,"useAlbedoToTintTranslucency",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"thicknessTexture",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"refractionTexture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"indexOfRefraction",void 0),(0,T.b)([(0,z.M)()],D.prototype,"_volumeIndexOfRefraction",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"volumeIndexOfRefraction",null),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"invertRefractionY",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"linkRefractionWithTransparency",void 0),(0,T.b)([(0,z.M)()],D.prototype,"minimumThickness",void 0),(0,T.b)([(0,z.M)()],D.prototype,"maximumThickness",void 0),(0,T.b)([(0,z.M)()],D.prototype,"useThicknessAsDepth",void 0),(0,T.b)([(0,z.k)()],D.prototype,"tintColor",void 0),(0,T.b)([(0,z.M)()],D.prototype,"tintColorAtDistance",void 0),(0,T.b)([(0,z.M)()],D.prototype,"dispersion",void 0),(0,T.b)([(0,z.k)()],D.prototype,"diffusionDistance",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"useMaskFromThicknessTexture",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"refractionIntensityTexture",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"translucencyIntensityTexture",void 0),(0,T.b)([(0,z.k)()],D.prototype,"translucencyColor",void 0),(0,T.b)([(0,z.D)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"translucencyColorTexture",void 0),(0,T.b)([(0,z.M)(),(0,z.d)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"useGltfStyleTextures",void 0);var k=s(11132),w=s(11088),L=s(11141);const S={effect:null,subMesh:null};class e extends b.b{constructor(u){super(u),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class h extends j.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(u){this._realTimeFiltering=u,this.pg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(u){this._realTimeFilteringQuality=u,this.pg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=u||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(u,G){super(u,G,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||h.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new x.s(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=h.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=F.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new F.b(0,0,0),this._albedoColor=new F.b(1,1,1),this._reflectivityColor=new F.b(1,1,1),this._reflectionColor=new F.b(1,1,1),this._emissiveColor=new F.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=h.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new m.e(16),this._globalAmbientColor=new F.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new n(this),this.clearCoat=new q(this),this.iridescence=new v(this),this.anisotropy=new M(this),this.sheen=new R(this),this.subSurface=new D(this),this.detailMap=new k.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),P.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,f.b)(this.va()),this.prePassConfiguration=new V.c}get hasRenderTargetTextures(){return!!(P.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var u;return this._transparencyMode===h.PBRMATERIAL_OPAQUE||this._transparencyMode===h.PBRMATERIAL_ALPHATEST||(null===(u=this.subSurface)||void 0===u?void 0:u.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var u;return!!this._forceAlphaTest||(null===(u=this.subSurface)||void 0===u||!u.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===h.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.nc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==h.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.nc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(u,G,s){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const T=G._drawWrapper;if(T.effect&&this.isFrozen&&T._wasPreviouslyReady&&T._wasPreviouslyUsingInstances===s)return!0;G.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),G.materialDefines=new e(this._eventInfo.defineNames));const z=G.materialDefines;if(this._isReadyForSubMesh(G))return!0;const m=this.va(),f=m.getEngine();if(z._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,m.texturesEnabled)){if(this._albedoTexture&&P.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&P.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&P.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const u=this._getReflectionTexture();if(u&&P.e.ReflectionTextureEnabled){if(!u.isReadyOrNotBlocking())return!1;var C;if(u.irradianceTexture){if(!u.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!u.sphericalPolynomial&&null!==(C=u.getInternalTexture())&&void 0!==C&&C._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&P.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&P.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(P.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(f.getCaps().standardDerivatives&&this._bumpTexture&&P.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&P.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=z,this._eventInfo.subMesh=G,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(z._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;f.getCaps().standardDerivatives||u.isVerticesDataPresent(g.f.NormalKind)||(u.createNormals(!0),O.d.Warn("PBRMaterial: Normals have been created for the mesh: "+u.name));const x=G.effect,b=z._areLightsDisposed;let Q=this._prepareEffect(u,z,this.onCompiled,this.onError,s,null,G.getRenderingMesh().hasThinInstances),Y=!1;if(Q)if(this._onEffectCreatedObservable&&(S.effect=Q,S.subMesh=G,this._onEffectCreatedObservable.notifyObservers(S)),this.allowShaderHotSwapping&&x&&!Q.isReady()){if(Q=x,z.markAsUnprocessed(),Y=this.isFrozen,b)return z._areLightsDisposed=!0,!1}else m.resetCachedMaterial(),G.setEffect(Q,z,this._materialContext);return!(!G.effect||!G.effect.isReady())&&(z._renderId=m.getRenderId(),T._wasPreviouslyReady=!Y,T._wasPreviouslyUsingInstances=!!s,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(u,G){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(u,G,O,m,f),!G.isDirty)return null;G.markAsProcessed();const C=this.va().getEngine(),x=new H.e;let b=0;G.USESPHERICALINVERTEX&&x.addFallback(b++,"USESPHERICALINVERTEX"),G.FOG&&x.addFallback(b,"FOG"),G.SPECULARAA&&x.addFallback(b,"SPECULARAA"),G.POINTSIZE&&x.addFallback(b,"POINTSIZE"),G.LOGARITHMICDEPTH&&x.addFallback(b,"LOGARITHMICDEPTH"),G.PARALLAX&&x.addFallback(b,"PARALLAX"),G.PARALLAX_RHS&&x.addFallback(b,"PARALLAX_RHS"),G.PARALLAXOCCLUSION&&x.addFallback(b++,"PARALLAXOCCLUSION"),G.ENVIRONMENTBRDF&&x.addFallback(b++,"ENVIRONMENTBRDF"),G.TANGENT&&x.addFallback(b++,"TANGENT"),G.BUMP&&x.addFallback(b++,"BUMP"),b=(0,X.r)(G,x,this._maxSimultaneousLights,b++),G.SPECULARTERM&&x.addFallback(b++,"SPECULARTERM"),G.USESPHERICALFROMREFLECTIONMAP&&x.addFallback(b++,"USESPHERICALFROMREFLECTIONMAP"),G.USEIRRADIANCEMAP&&x.addFallback(b++,"USEIRRADIANCEMAP"),G.LIGHTMAP&&x.addFallback(b++,"LIGHTMAP"),G.NORMAL&&x.addFallback(b++,"NORMAL"),G.AMBIENT&&x.addFallback(b++,"AMBIENT"),G.EMISSIVE&&x.addFallback(b++,"EMISSIVE"),G.VERTEXCOLOR&&x.addFallback(b++,"VERTEXCOLOR"),G.MORPHTARGETS&&x.addFallback(b++,"MORPHTARGETS"),G.MULTIVIEW&&x.addFallback(0,"MULTIVIEW");const Q=[g.f.PositionKind];G.NORMAL&&Q.push(g.f.NormalKind),G.TANGENT&&Q.push(g.f.TangentKind);for(let s=1;s<=6;++s)G["UV"+s]&&Q.push(`uv${1===s?"":s}`);G.VERTEXCOLOR&&Q.push(g.f.ColorKind),(0,X.x)(Q,u,G,x),(0,X.B)(Q,G),(0,X.F)(Q,u,G),(0,X.t)(Q,u,G);let Y="pbr";const n=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],F=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],c=["Material","Scene","Mesh"],j={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:G.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=x,this._eventInfo.fallbackRank=b,this._eventInfo.defines=G,this._eventInfo.uniforms=n,this._eventInfo.attributes=Q,this._eventInfo.samplers=F,this._eventInfo.uniformBuffersNames=c,this._eventInfo.customCode=void 0,this._eventInfo.mesh=u,this._eventInfo.indexParameters=j,this._callbackPluginEventGeneric(128,this._eventInfo),L.d.AddUniformsAndSamplers(n,F),V.c.AddUniforms(n),V.c.AddSamplers(F),(0,w.b)(n),r.b&&(r.b.PrepareUniforms(n,G),r.b.PrepareSamplers(F,G)),(0,X.bb)({uniformsNames:n,uniformBuffersNames:c,samplers:F,defines:G,maxSimultaneousLights:this._maxSimultaneousLights});const l={};this.customShaderNameResolve&&(Y=this.customShaderNameResolve(Y,n,c,F,G,Q,l));const P=G.toString(),p=C.createEffect(Y,{attributes:Q,uniformsNames:n,uniformBuffersNames:c,samplers:F,defines:P,fallbacks:x,onCompiled:T,onError:z,indexParameters:j,processFinalCode:l.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:G.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([s.e(21),s.e(43)]).then(s.bind(s,13176)),Promise.all([s.e(22),s.e(44)]).then(s.bind(s,13186))]):await Promise.all([Promise.all([s.e(25),s.e(45)]).then(s.bind(s,13191)),Promise.all([s.e(27),s.e(46)]).then(s.bind(s,13213))]),this._shadersLoaded=!0}},C);return this._eventInfo.customCode=void 0,p}_prepareDefines(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=this.va(),m=O.getEngine();(0,X.P)(O,u,G,!0,this._maxSimultaneousLights,this._disableLighting),G._needNormals=!0,(0,X.V)(O,G);const f=this.needAlphaBlendingForMesh(u)&&this.va().useOrderIndependentTransparency;if((0,X.$)(O,G,this.canRenderToMRT&&!f),(0,X.Z)(O,G,f),L.d.PrepareDefines(m.currentRenderPassId,u,G),G.METALLICWORKFLOW=this.isMetallicWorkflow(),G._areTexturesDirty){G._needUVs=!1;for(let u=1;u<=6;++u)G["MAINUV"+u]=!1;if(O.texturesEnabled){G.ALBEDODIRECTUV=0,G.AMBIENTDIRECTUV=0,G.OPACITYDIRECTUV=0,G.EMISSIVEDIRECTUV=0,G.REFLECTIVITYDIRECTUV=0,G.MICROSURFACEMAPDIRECTUV=0,G.METALLIC_REFLECTANCEDIRECTUV=0,G.REFLECTANCEDIRECTUV=0,G.BUMPDIRECTUV=0,G.LIGHTMAPDIRECTUV=0,m.getCaps().textureLOD&&(G.LODBASEDMICROSFURACE=!0),this._albedoTexture&&P.e.DiffuseTextureEnabled?((0,X.T)(this._albedoTexture,G,"ALBEDO"),G.GAMMAALBEDO=this._albedoTexture.gammaSpace):G.ALBEDO=!1,this._ambientTexture&&P.e.AmbientTextureEnabled?((0,X.T)(this._ambientTexture,G,"AMBIENT"),G.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):G.AMBIENT=!1,this._opacityTexture&&P.e.OpacityTextureEnabled?((0,X.T)(this._opacityTexture,G,"OPACITY"),G.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):G.OPACITY=!1;const u=this._getReflectionTexture();if(u&&P.e.ReflectionTextureEnabled){switch(G.REFLECTION=!0,G.GAMMAREFLECTION=u.gammaSpace,G.RGBDREFLECTION=u.isRGBD,G.LODINREFLECTIONALPHA=u.lodLevelInAlpha,G.LINEARSPECULARREFLECTION=u.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(G.NUM_SAMPLES=""+this.realTimeFilteringQuality,m._features.needTypeSuffixInShaderConstants&&(G.NUM_SAMPLES=G.NUM_SAMPLES+"u"),G.REALTIME_FILTERING=!0):G.REALTIME_FILTERING=!1,G.INVERTCUBICMAP=u.coordinatesMode===l.b.INVCUBIC_MODE,G.REFLECTIONMAP_3D=u.isCube,G.REFLECTIONMAP_OPPOSITEZ=G.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!u.invertZ:u.invertZ,G.REFLECTIONMAP_CUBIC=!1,G.REFLECTIONMAP_EXPLICIT=!1,G.REFLECTIONMAP_PLANAR=!1,G.REFLECTIONMAP_PROJECTION=!1,G.REFLECTIONMAP_SKYBOX=!1,G.REFLECTIONMAP_SPHERICAL=!1,G.REFLECTIONMAP_EQUIRECTANGULAR=!1,G.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,G.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,u.coordinatesMode){case l.b.EXPLICIT_MODE:G.REFLECTIONMAP_EXPLICIT=!0;break;case l.b.PLANAR_MODE:G.REFLECTIONMAP_PLANAR=!0;break;case l.b.PROJECTION_MODE:G.REFLECTIONMAP_PROJECTION=!0;break;case l.b.SKYBOX_MODE:G.REFLECTIONMAP_SKYBOX=!0;break;case l.b.SPHERICAL_MODE:G.REFLECTIONMAP_SPHERICAL=!0;break;case l.b.EQUIRECTANGULAR_MODE:G.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case l.b.FIXED_EQUIRECTANGULAR_MODE:G.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case l.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:G.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case l.b.CUBIC_MODE:case l.b.INVCUBIC_MODE:default:G.REFLECTIONMAP_CUBIC=!0,G.USE_LOCAL_REFLECTIONMAP_CUBIC=!!u.boundingBoxSize}u.coordinatesMode!==l.b.SKYBOX_MODE&&(u.irradianceTexture?(G.USEIRRADIANCEMAP=!0,G.USESPHERICALFROMREFLECTIONMAP=!1):u.isCube&&(G.USESPHERICALFROMREFLECTIONMAP=!0,G.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||m.getCaps().maxVaryingVectors<=8?G.USESPHERICALINVERTEX=!1:G.USESPHERICALINVERTEX=!0))}else G.REFLECTION=!1,G.REFLECTIONMAP_3D=!1,G.REFLECTIONMAP_SPHERICAL=!1,G.REFLECTIONMAP_PLANAR=!1,G.REFLECTIONMAP_CUBIC=!1,G.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,G.REFLECTIONMAP_PROJECTION=!1,G.REFLECTIONMAP_SKYBOX=!1,G.REFLECTIONMAP_EXPLICIT=!1,G.REFLECTIONMAP_EQUIRECTANGULAR=!1,G.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,G.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,G.INVERTCUBICMAP=!1,G.USESPHERICALFROMREFLECTIONMAP=!1,G.USEIRRADIANCEMAP=!1,G.USESPHERICALINVERTEX=!1,G.REFLECTIONMAP_OPPOSITEZ=!1,G.LODINREFLECTIONALPHA=!1,G.GAMMAREFLECTION=!1,G.RGBDREFLECTION=!1,G.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&P.e.LightmapTextureEnabled?((0,X.T)(this._lightmapTexture,G,"LIGHTMAP"),G.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,G.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,G.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):G.LIGHTMAP=!1,this._emissiveTexture&&P.e.EmissiveTextureEnabled?((0,X.T)(this._emissiveTexture,G,"EMISSIVE"),G.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):G.EMISSIVE=!1,P.e.SpecularTextureEnabled?(this._metallicTexture?((0,X.T)(this._metallicTexture,G,"REFLECTIVITY"),G.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,G.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,G.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,G.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,G.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,X.T)(this._reflectivityTexture,G,"REFLECTIVITY"),G.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,G.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,G.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):G.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(G.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,X.T)(this._metallicReflectanceTexture,G,"METALLIC_REFLECTANCE"),G.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):G.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,X.T)(this._reflectanceTexture,G,"REFLECTANCE"),G.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):G.REFLECTANCE=!1):(G.METALLIC_REFLECTANCE=!1,G.REFLECTANCE=!1),this._microSurfaceTexture?(0,X.T)(this._microSurfaceTexture,G,"MICROSURFACEMAP"):G.MICROSURFACEMAP=!1):(G.REFLECTIVITY=!1,G.MICROSURFACEMAP=!1),m.getCaps().standardDerivatives&&this._bumpTexture&&P.e.BumpTextureEnabled&&!this._disableBumpMap?((0,X.T)(this._bumpTexture,G,"BUMP"),this._useParallax&&this._albedoTexture&&P.e.DiffuseTextureEnabled?(G.PARALLAX=!0,G.PARALLAX_RHS=O.useRightHandedSystem,G.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):G.PARALLAX=!1,G.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(G.BUMP=!1,G.PARALLAX=!1,G.PARALLAX_RHS=!1,G.PARALLAXOCCLUSION=!1,G.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&P.e.ReflectionTextureEnabled?(G.ENVIRONMENTBRDF=!0,G.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(G.ENVIRONMENTBRDF=!1,G.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?G.ALPHAFROMALBEDO=!0:G.ALPHAFROMALBEDO=!1}G.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===h.LIGHTFALLOFF_STANDARD?(G.USEPHYSICALLIGHTFALLOFF=!1,G.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===h.LIGHTFALLOFF_GLTF?(G.USEPHYSICALLIGHTFALLOFF=!1,G.USEGLTFLIGHTFALLOFF=!0):(G.USEPHYSICALLIGHTFALLOFF=!0,G.USEGLTFLIGHTFALLOFF=!1),G.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ig&&this._twoSidedLighting?G.TWOSIDEDLIGHTING=!0:G.TWOSIDEDLIGHTING=!1,G.SPECULARAA=m.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(G._areTexturesDirty||G._areMiscDirty)&&(G.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,G.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,G.ALPHABLEND=this.needAlphaBlendingForMesh(u),G.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,G.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),G._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(G),G.FORCENORMALFORWARD=this._forceNormalForward,G.RADIANCEOCCLUSION=this._useRadianceOcclusion,G.HORIZONOCCLUSION=this._useHorizonOcclusion,G._areMiscDirty&&((0,X.U)(u,O,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(u)||this._forceAlphaTest,G,this._applyDecalMapAfterDetailMap),G.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!u.isVerticesDataPresent(g.f.NormalKind),G.DEBUGMODE=this._debugMode),(0,X.L)(O,m,this,G,!!s,T,z),this._eventInfo.defines=G,this._eventInfo.mesh=u,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,X.J)(u,G,!0,!0,!0,this._transparencyMode!==h.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(u,G,s){const T={clipPlane:!1,useInstances:!1,...s};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const s=new e(this._eventInfo.defineNames),z=this._prepareEffect(u,s,void 0,void 0,T.useInstances,T.clipPlane,u.hasThinInstances);this._onEffectCreatedObservable&&(S.effect=z,S.subMesh=null,this._onEffectCreatedObservable.notifyObservers(S)),z.isReady()?G&&G(this):z.onCompileObservable.add((()=>{G&&G(this)}))})()}buildUniformLayout(){const u=this._uniformBuffer;u.addUniform("vAlbedoInfos",2),u.addUniform("vAmbientInfos",4),u.addUniform("vOpacityInfos",2),u.addUniform("vEmissiveInfos",2),u.addUniform("vLightmapInfos",2),u.addUniform("vReflectivityInfos",3),u.addUniform("vMicroSurfaceSamplerInfos",2),u.addUniform("vReflectionInfos",2),u.addUniform("vReflectionFilteringInfo",2),u.addUniform("vReflectionPosition",3),u.addUniform("vReflectionSize",3),u.addUniform("vBumpInfos",3),u.addUniform("albedoMatrix",16),u.addUniform("ambientMatrix",16),u.addUniform("opacityMatrix",16),u.addUniform("emissiveMatrix",16),u.addUniform("lightmapMatrix",16),u.addUniform("reflectivityMatrix",16),u.addUniform("microSurfaceSamplerMatrix",16),u.addUniform("bumpMatrix",16),u.addUniform("vTangentSpaceParams",2),u.addUniform("reflectionMatrix",16),u.addUniform("vReflectionColor",3),u.addUniform("vAlbedoColor",4),u.addUniform("vLightingIntensity",4),u.addUniform("vReflectionMicrosurfaceInfos",3),u.addUniform("pointSize",1),u.addUniform("vReflectivityColor",4),u.addUniform("vEmissiveColor",3),u.addUniform("vAmbientColor",3),u.addUniform("vDebugMode",2),u.addUniform("vMetallicReflectanceFactors",4),u.addUniform("vMetallicReflectanceInfos",2),u.addUniform("metallicReflectanceMatrix",16),u.addUniform("vReflectanceInfos",2),u.addUniform("reflectanceMatrix",16),u.addUniform("vSphericalL00",3),u.addUniform("vSphericalL1_1",3),u.addUniform("vSphericalL10",3),u.addUniform("vSphericalL11",3),u.addUniform("vSphericalL2_2",3),u.addUniform("vSphericalL2_1",3),u.addUniform("vSphericalL20",3),u.addUniform("vSphericalL21",3),u.addUniform("vSphericalL22",3),u.addUniform("vSphericalX",3),u.addUniform("vSphericalY",3),u.addUniform("vSphericalZ",3),u.addUniform("vSphericalXX_ZZ",3),u.addUniform("vSphericalYY_ZZ",3),u.addUniform("vSphericalZZ",3),u.addUniform("vSphericalXY",3),u.addUniform("vSphericalYZ",3),u.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(u,G,s){const T=this.va(),z=s.materialDefines;if(!z)return;const O=s.effect;if(!O)return;this._activeEffect=O,G.getMeshUniformBuffer().bindToEffect(O,"Mesh"),G.transferToEffect(u);const m=T.getEngine();this._uniformBuffer.bindToEffect(O,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,T,G,u,this.isFrozen),L.d.Bind(m.currentRenderPassId,this._activeEffect,G,u),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),z.OBJECTSPACE_NORMALMAP&&(u.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const f=this._mustRebind(T,O,s,G.visibility);(0,X.c)(G,this._activeEffect,this.prePassConfiguration);let x=null;const g=this._uniformBuffer;if(f){if(this.bindViewProjection(O),x=this._getReflectionTexture(),!g.useUbo||!this.isFrozen||!g.isSync||s._drawWrapper._forceRebindOnNextCall){var b;if(T.texturesEnabled){if(this._albedoTexture&&P.e.DiffuseTextureEnabled&&(g.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,X.n)(this._albedoTexture,g,"albedo")),this._ambientTexture&&P.e.AmbientTextureEnabled&&(g.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,X.n)(this._ambientTexture,g,"ambient")),this._opacityTexture&&P.e.OpacityTextureEnabled&&(g.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,X.n)(this._opacityTexture,g,"opacity")),x&&P.e.ReflectionTextureEnabled){if(g.xj("reflectionMatrix",x.getReflectionTextureMatrix()),g.updateFloat2("vReflectionInfos",x.level,0),x.boundingBoxSize){const u=x;g.updateVector3("vReflectionPosition",u.boundingBoxPosition),g.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this.realTimeFiltering){const u=x.getSize().width;g.updateFloat2("vReflectionFilteringInfo",u,Math.log2(u))}if(!z.USEIRRADIANCEMAP){const u=x.sphericalPolynomial;if(z.USESPHERICALFROMREFLECTIONMAP&&u)if(z.SPHERICAL_HARMONICS){const G=u.preScaledHarmonics;g.updateVector3("vSphericalL00",G.l00),g.updateVector3("vSphericalL1_1",G.l1_1),g.updateVector3("vSphericalL10",G.l10),g.updateVector3("vSphericalL11",G.l11),g.updateVector3("vSphericalL2_2",G.l2_2),g.updateVector3("vSphericalL2_1",G.l2_1),g.updateVector3("vSphericalL20",G.l20),g.updateVector3("vSphericalL21",G.l21),g.updateVector3("vSphericalL22",G.l22)}else g.updateFloat3("vSphericalX",u.x.x,u.x.y,u.x.z),g.updateFloat3("vSphericalY",u.y.x,u.y.y,u.y.z),g.updateFloat3("vSphericalZ",u.z.x,u.z.y,u.z.z),g.updateFloat3("vSphericalXX_ZZ",u.xx.x-u.zz.x,u.xx.y-u.zz.y,u.xx.z-u.zz.z),g.updateFloat3("vSphericalYY_ZZ",u.yy.x-u.zz.x,u.yy.y-u.zz.y,u.yy.z-u.zz.z),g.updateFloat3("vSphericalZZ",u.zz.x,u.zz.y,u.zz.z),g.updateFloat3("vSphericalXY",u.xy.x,u.xy.y,u.xy.z),g.updateFloat3("vSphericalYZ",u.yz.x,u.yz.y,u.yz.z),g.updateFloat3("vSphericalZX",u.zx.x,u.zx.y,u.zx.z)}g.updateFloat3("vReflectionMicrosurfaceInfos",x.getSize().width,x.lodGenerationScale,x.lodGenerationOffset)}this._emissiveTexture&&P.e.EmissiveTextureEnabled&&(g.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,X.n)(this._emissiveTexture,g,"emissive")),this._lightmapTexture&&P.e.LightmapTextureEnabled&&(g.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,X.n)(this._lightmapTexture,g,"lightmap")),P.e.SpecularTextureEnabled&&(this._metallicTexture?(g.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,X.n)(this._metallicTexture,g,"reflectivity")):this._reflectivityTexture&&(g.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,X.n)(this._reflectivityTexture,g,"reflectivity")),this._metallicReflectanceTexture&&(g.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,X.n)(this._metallicReflectanceTexture,g,"metallicReflectance")),this._reflectanceTexture&&z.REFLECTANCE&&(g.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,X.n)(this._reflectanceTexture,g,"reflectance")),this._microSurfaceTexture&&(g.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,X.n)(this._microSurfaceTexture,g,"microSurfaceSampler"))),this._bumpTexture&&m.getCaps().standardDerivatives&&P.e.BumpTextureEnabled&&!this._disableBumpMap&&(g.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,X.n)(this._bumpTexture,g,"bump"),T._mirroredCameraPosition?g.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):g.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&g.updateFloat("pointSize",this.pointSize),z.METALLICWORKFLOW){var Q;F.f.hb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,F.f.hb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,g.updateColor4("vReflectivityColor",F.f.hb[0],1);const u=(null===(Q=this.subSurface)||void 0===Q?void 0:Q._indexOfRefraction)??1.5,G=1,s=Math.pow((u-G)/(u+G),2);this._metallicReflectanceColor.scaleToRef(s*this._metallicF0Factor,F.f.hb[0]);const T=this._metallicF0Factor;g.updateColor4("vMetallicReflectanceFactors",F.f.hb[0],T)}else g.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);g.updateColor3("vEmissiveColor",P.e.EmissiveTextureEnabled?this._emissiveColor:F.b.BlackReadOnly),g.updateColor3("vReflectionColor",this._reflectionColor),!z.SS_REFRACTION&&null!==(b=this.subSurface)&&void 0!==b&&b._linkRefractionWithTransparency?g.updateColor4("vAlbedoColor",this._albedoColor,1):g.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*T.environmentIntensity,this._lightingInfos.w=this._specularIntensity,g.updateVector4("vLightingIntensity",this._lightingInfos),T.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),g.updateColor3("vAmbientColor",this._globalAmbientColor),g.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}T.texturesEnabled&&(this._albedoTexture&&P.e.DiffuseTextureEnabled&&g.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&P.e.AmbientTextureEnabled&&g.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&P.e.OpacityTextureEnabled&&g.setTexture("opacitySampler",this._opacityTexture),x&&P.e.ReflectionTextureEnabled&&(z.LODBASEDMICROSFURACE?g.setTexture("reflectionSampler",x):(g.setTexture("reflectionSampler",x._lodTextureMid||x),g.setTexture("reflectionSamplerLow",x._lodTextureLow||x),g.setTexture("reflectionSamplerHigh",x._lodTextureHigh||x)),z.USEIRRADIANCEMAP&&g.setTexture("irradianceSampler",x.irradianceTexture)),z.ENVIRONMENTBRDF&&g.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&P.e.EmissiveTextureEnabled&&g.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&P.e.LightmapTextureEnabled&&g.setTexture("lightmapSampler",this._lightmapTexture),P.e.SpecularTextureEnabled&&(this._metallicTexture?g.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&g.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&g.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&z.REFLECTANCE&&g.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&g.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&m.getCaps().standardDerivatives&&P.e.BumpTextureEnabled&&!this._disableBumpMap&&g.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(G)&&this.va().depthPeelingRenderer.bind(O),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,w.f)(this._activeEffect,this,T),this.bindEyePosition(O)}else T.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(f||!this.isFrozen){var Y;if(T.lightsEnabled&&!this._disableLighting&&(0,X.h)(T,G,this._activeEffect,z,this._maxSimultaneousLights),(T.fogEnabled&&G.applyFog&&T.fogMode!==C.e.FOGMODE_NONE||x||this.subSurface.refractionTexture||G.receiveShadows||z.PREPASS)&&this.bindView(O),(0,X.d)(T,G,this._activeEffect,!0),z.NUM_MORPH_INFLUENCERS&&(0,X.j)(G,this._activeEffect),z.BAKED_VERTEX_ANIMATION_TEXTURE)null===(Y=G.bakedVertexAnimationManager)||void 0===Y||Y.bind(O,z.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,X.i)(z,this._activeEffect,T)}this._afterBind(G,this._activeEffect,s),g.update()}getAnimatables(){const u=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&u.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&u.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&u.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&u.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&u.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?u.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&u.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&u.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&u.push(this._microSurfaceTexture),u}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const u=super.getActiveTextures();return this._albedoTexture&&u.push(this._albedoTexture),this._ambientTexture&&u.push(this._ambientTexture),this._opacityTexture&&u.push(this._opacityTexture),this._reflectionTexture&&u.push(this._reflectionTexture),this._emissiveTexture&&u.push(this._emissiveTexture),this._reflectivityTexture&&u.push(this._reflectivityTexture),this._metallicTexture&&u.push(this._metallicTexture),this._metallicReflectanceTexture&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&u.push(this._microSurfaceTexture),this._bumpTexture&&u.push(this._bumpTexture),this._lightmapTexture&&u.push(this._lightmapTexture),u}hasTexture(u){return!!super.hasTexture(u)||(this._albedoTexture===u||(this._ambientTexture===u||(this._opacityTexture===u||(this._reflectionTexture===u||(this._emissiveTexture===u||(this._reflectivityTexture===u||(this._metallicTexture===u||(this._metallicReflectanceTexture===u||(this._reflectanceTexture===u||(this._microSurfaceTexture===u||(this._bumpTexture===u||this._lightmapTexture===u)))))))))))}setPrePassRenderer(){var u;if(null===(u=this.subSurface)||void 0===u||!u.isScatteringEnabled)return!1;const G=this.va().enableSubSurfaceForPrePass();return G&&(G.enabled=!0),!0}dispose(u,G){var s,T,z,O,m,f,C,x,g,b,Q,Y;(this._breakShaderLoadedCheck=!0,G)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(s=this._albedoTexture)||void 0===s||s.dispose(),null===(T=this._ambientTexture)||void 0===T||T.dispose(),null===(z=this._opacityTexture)||void 0===z||z.dispose(),null===(O=this._reflectionTexture)||void 0===O||O.dispose(),null===(m=this._emissiveTexture)||void 0===m||m.dispose(),null===(f=this._metallicTexture)||void 0===f||f.dispose(),null===(C=this._reflectivityTexture)||void 0===C||C.dispose(),null===(x=this._bumpTexture)||void 0===x||x.dispose(),null===(g=this._lightmapTexture)||void 0===g||g.dispose(),null===(b=this._metallicReflectanceTexture)||void 0===b||b.dispose(),null===(Q=this._reflectanceTexture)||void 0===Q||Q.dispose(),null===(Y=this._microSurfaceTexture)||void 0===Y||Y.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(u,G)}}h.PBRMATERIAL_OPAQUE=c.d.MATERIAL_OPAQUE,h.PBRMATERIAL_ALPHATEST=c.d.MATERIAL_ALPHATEST,h.PBRMATERIAL_ALPHABLEND=c.d.MATERIAL_ALPHABLEND,h.PBRMATERIAL_ALPHATESTANDBLEND=c.d.MATERIAL_ALPHATESTANDBLEND,h.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,h.LIGHTFALLOFF_PHYSICAL=0,h.LIGHTFALLOFF_GLTF=1,h.LIGHTFALLOFF_STANDARD=2,h.ForceGLSL=!1,(0,T.b)([(0,z.s)()],h.prototype,"_imageProcessingConfiguration",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsMiscDirty")],h.prototype,"debugMode",void 0)},10698:(u,G,s)=>{"use strict";s.d(G,{c:()=>m});var T=s(10584);const z=new Map;function O(u,G){(function(u){return z.delete(u)})(u)&&T.d.Warn(`Extension with the name '${name}' already exists`),z.set(u,G)}function m(u,G){"image/ktx"!==G&&"image/ktx2"!==G||(u=".ktx"),z.has(u)||(u.endsWith(".dds")&&O(".dds",(()=>s.e(12).then(s.bind(s,12559)).then((u=>new u._DDSTextureLoader)))),u.endsWith(".basis")&&O(".basis",(()=>s.e(13).then(s.bind(s,12566)).then((u=>new u._BasisTextureLoader)))),u.endsWith(".env")&&O(".env",(()=>s.e(14).then(s.bind(s,12570)).then((u=>new u._ENVTextureLoader)))),u.endsWith(".hdr")&&O(".hdr",(()=>s.e(15).then(s.bind(s,12574)).then((u=>new u._HDRTextureLoader)))),(u.endsWith(".ktx")||u.endsWith(".ktx2"))&&(O(".ktx",(()=>s.e(16).then(s.bind(s,12576)).then((u=>new u._KTXTextureLoader)))),O(".ktx2",(()=>s.e(16).then(s.bind(s,12576)).then((u=>new u._KTXTextureLoader))))),u.endsWith(".tga")&&O(".tga",(()=>s.e(17).then(s.bind(s,12581)).then((u=>new u._TGATextureLoader)))),u.endsWith(".exr")&&O(".exr",(()=>s.e(18).then(s.bind(s,12590)).then((u=>new u._ExrTextureLoader)))));const T=z.get(u);return T?Promise.resolve(T(G)):null}},11107:(u,G,s)=>{"use strict";s.d(G,{c:()=>Q});var T=s(10863),z=s(10866),O=s(10568),m=s(10904),f=s(10619),C=s(10720),x=(s(10622),s(11112));class g{get wrapU(){return this._wrapU}set wrapU(u){this._wrapU=u}get wrapV(){return this._wrapV}set wrapV(u){this._wrapV=u}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(u){this._texture&&(this._texture.isCube=u)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(u){this._texture&&(this._texture.is3D=u)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(u){this._texture&&(this._texture.is2DArray=u)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(u){return void 0!==(null===u||void 0===u?void 0:u.shareDepth)}constructor(u){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=x.e.Zero(),this._cachedBaseSize=x.e.Zero(),this._initialSamplingMode=2,this._texture=g._IsRenderTargetWrapper(u)?u.texture:u,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(u){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(u,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var b=s(10935);class Q extends g{set nc(u){this._hasAlpha!==u&&(this._hasAlpha=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get nc(){return this._hasAlpha}set getAlphaFromRGB(u){this._getAlphaFromRGB!==u&&(this._getAlphaFromRGB=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(u){this._coordinatesIndex!==u&&(this._coordinatesIndex=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(u){this._coordinatesMode!==u&&(this._coordinatesMode=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(u){this._wrapU=u}get wrapV(){return this._wrapV}set wrapV(u){this._wrapV=u}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(u){this._texture?this._texture.isCube=u:this._isCube=u}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(u){this._texture&&(this._texture.is3D=u)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(u){this._texture&&(this._texture.is2DArray=u)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(u){var G;if(this._texture){if(this._texture._gammaSpace===u)return;this._texture._gammaSpace=u}else{if(this._gammaSpace===u)return;this._gammaSpace=u}null===(G=this.va())||void 0===G||G.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(u){var G;u!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=u),null===(G=this.va())||void 0===G||G.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(u){this._texture&&(this._texture._lodGenerationOffset=u)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(u){this._texture&&(this._texture._lodGenerationScale=u)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(u){this._texture&&(this._texture._linearSpecularLOD=u)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(u){this._texture&&(this._texture._irradianceTexture=u)}get uid(){return this._uid||(this._uid=(0,C.c)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=Q.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this._i=new O.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,u?Q._IsScene(u)?this._scene=u:this._engine=u:this._scene=f.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=G,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return m.d.IdentityReadOnly}getReflectionTextureMatrix(){return m.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(u){}get canRescale(){return!1}_getFromCache(u,G,s,T,z,O){const m=this._getEngine();if(!m)return null;const f=m._getUseSRGBBuffer(!!z,G),C=m.getLoadedTexturesCache();for(let x=0;x<C.length;x++){const m=C[x];if((void 0===z||f===m._useSRGBBuffer)&&(void 0===T||T===m.invertY)&&m.url===u&&m.generateMipMaps===!G&&(!s||s===m.samplingMode)&&(void 0===O||O===m.isCube))return m.incrementReferences(),m}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const u=this.va();u&&u.markAllMaterialsAsDirty(1)}readPixels(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const x=this._getEngine();if(!x)return null;const g=this.getSize();let b=g.width,Q=g.height;0!==G&&(b/=Math.pow(2,G),Q/=Math.pow(2,G),b=Math.round(b),Q=Math.round(Q)),f=Math.min(b,f),C=Math.min(Q,C);try{return this._texture.isCube?x._readTexturePixels(this._texture,f,C,u,G,s,T,z,O,m):x._readTexturePixels(this._texture,f,C,-1,G,s,T,z,O,m)}catch(Y){return null}}_readPixelsSync(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const O=this.getSize();let m=O.width,f=O.height;const C=this._getEngine();if(!C)return null;0!=G&&(m/=Math.pow(2,G),f/=Math.pow(2,G),m=Math.round(m),f=Math.round(f));try{return this._texture.isCube?C._readTexturePixelsSync(this._texture,m,f,u,G,s,T,z):C._readTexturePixelsSync(this._texture,m,f,-1,G,s,T,z)}catch(x){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const u=this._scene.textures.indexOf(this);if(u>=0&&this._scene.textures.splice(u,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const u=this._parentContainer.textures.indexOf(this);u>-1&&this._parentContainer.textures.splice(u,1),this._parentContainer=null}}this._i.notifyObservers(this),this._i.clear(),this.metadata=null,super.dispose()}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!u)return null;const G=b.e.Serialize(this);return b.e.AppendSerializedAnimations(this,G),G}static WhenAllReady(u,G){let s=u.length;if(0!==s)for(let T=0;T<u.length;T++){const z=u[T];if(z.isReady())0===--s&&G();else{const u=z.onLoadObservable;u?u.addOnce((()=>{0===--s&&G()})):0===--s&&G()}}else G()}static _IsScene(u){return"Scene"===u.getClassName()}}Q.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,T.b)([(0,z.M)()],Q.prototype,"uniqueId",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"name",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"metadata",void 0),(0,T.b)([(0,z.M)("nc")],Q.prototype,"_hasAlpha",void 0),(0,T.b)([(0,z.M)("getAlphaFromRGB")],Q.prototype,"_getAlphaFromRGB",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"level",void 0),(0,T.b)([(0,z.M)("coordinatesIndex")],Q.prototype,"_coordinatesIndex",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"optimizeUVAllocation",void 0),(0,T.b)([(0,z.M)("coordinatesMode")],Q.prototype,"_coordinatesMode",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"wrapU",null),(0,T.b)([(0,z.M)()],Q.prototype,"wrapV",null),(0,T.b)([(0,z.M)()],Q.prototype,"wrapR",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"anisotropicFilteringLevel",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"isCube",null),(0,T.b)([(0,z.M)()],Q.prototype,"is3D",null),(0,T.b)([(0,z.M)()],Q.prototype,"is2DArray",null),(0,T.b)([(0,z.M)()],Q.prototype,"gammaSpace",null),(0,T.b)([(0,z.M)()],Q.prototype,"invertZ",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"lodLevelInAlpha",void 0),(0,T.b)([(0,z.M)()],Q.prototype,"lodGenerationOffset",null),(0,T.b)([(0,z.M)()],Q.prototype,"lodGenerationScale",null),(0,T.b)([(0,z.M)()],Q.prototype,"linearSpecularLOD",null),(0,T.b)([(0,z.D)()],Q.prototype,"irradianceTexture",null),(0,T.b)([(0,z.M)()],Q.prototype,"isRenderTarget",void 0)},11868:(u,G,s)=>{"use strict";var T=s(11390),z=s(11107);z.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(z.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=T.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((u=>{this._texture._sphericalPolynomial=u,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(u){this._texture&&(this._texture._sphericalPolynomial=u)},enumerable:!0,configurable:!0})},11911:(u,G,s)=>{"use strict";s.d(G,{d:()=>Q});var T=s(10863),z=s(10866),O=s(10564),m=s(10904),f=s(11107),C=s(11102),x=s(10715),g=s(10568),b=s(10935);s(11432);class Q extends f.c{set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const G=this.va();G&&G.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(u){this._rotationY=u,this.setReflectionTextureMatrix(m.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(u,G,s){let T="";return u.forEach((u=>T+=u)),new Q(T,G,null,s,u)}static CreateFromPrefilteredData(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=G.useDelayedTextureLoading;G.useDelayedTextureLoading=!1;const O=new Q(u,G,null,!1,null,null,null,void 0,!0,s,T);return G.useDelayedTextureLoading=z,O}constructor(u,G){var s;let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]&&arguments[10],V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,r=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0;super(G),this.onLoadObservable=new g.e,this.boundingBoxPosition=m.q.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new m.d,this._buffer=null,this.name=u,this.url=u,this._noMipmap=z,this.nc=!1,this.isCube=!0,this._textureMatrix=m.d.Identity(),this.coordinatesMode=C.b.CUBIC_MODE;let j=null,l=null;null===T||Array.isArray(T)?(this._noMipmap=z,this._format=b,this._createPolynomials=n,j=T,this._loaderOptions=r,this._useSRGBBuffer=c,this._lodScale=V,this._lodOffset=F):(j=T.extensions??null,this._noMipmap=T.noMipmap??!1,O=T.files??null,l=T.buffer??null,this._format=T.format??5,Q=T.prefiltered??!1,Y=T.forcedExtension??null,this._createPolynomials=T.createPolynomials??!1,this._lodScale=T.lodScale??.8,this._lodOffset=T.lodOffset??0,this._loaderOptions=T.loaderOptions,this._useSRGBBuffer=T.useSRGBBuffer,f=T.X??null,x=T.onError??null),(u||O)&&this.updateURL(u,Y,f,Q,x,j,null===(s=this.va())||void 0===s?void 0:s.useDelayedTextureLoading,O,l)}getClassName(){return"CubeTexture"}updateURL(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=u),this.url=u,G&&(this._forcedExtension=G);const x=u.lastIndexOf("."),g=G||(x>-1?u.substring(x).toLowerCase():""),b=0===g.indexOf(".dds"),Q=0===g.indexOf(".env"),Y=0===g.indexOf(".basis");if(Q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=T,T&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),f)this._files=f;else if(Y||Q||b||O||(O=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,O){for(let G=0;G<O.length;G++)this._files.push(u+O[G]);this._extensions=O}this._buffer=C,m?(this.delayLoadState=4,this._delayedOnLoad=s,this._delayedOnError=z):this._loadTexture(s,z)}delayLoad(u){4===this.delayLoadState&&(u&&(this._forcedExtension=u),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(u){var G,s;if(u.updateFlag===this._textureMatrix.updateFlag)return;u.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(s=this.va())||void 0===s||s.markAllMaterialsAsDirty(1,(u=>-1!==u.getActiveTextures().indexOf(this))));if(this._textureMatrix=u,null===(G=this.va())||void 0===G||!G.useRightHandedSystem)return;const T=m.l.gb[0],z=m.l.Quaternion[0],O=m.l.gb[1];this._textureMatrix.decompose(T,z,O),z.z*=-1,z.w*=-1,m.d.ComposeToRef(T,z,O,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var u;return null!==(u=this.va())&&void 0!==u&&u.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=this.va(),T=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const z=()=>{var G;(this.onLoadObservable.notifyObservers(this),T)&&(T.dispose(),null===(G=this.va())||void 0===G||G.markAllMaterialsAsDirty(1));u&&u()},m=(u,s)=>{this._loadingError=!0,this._errorObject={message:u,exception:s},G&&G(u,s),C.b.OnTextureLoadErrorObservable.notifyObservers(this)};var f;this._texture?this._texture.isReady?O.e.SetImmediate((()=>z())):this._texture.onLoadedObservable.add((()=>z())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,s,this._lodScale,this._lodOffset,u,m,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,s,this._files,this._noMipmap,u,m,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(f=this._texture)||void 0===f||f.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(u,G,s){const T=b.e.Parse((()=>{let T=!1;return u.prefiltered&&(T=u.prefiltered),new Q(s+(u.url??u.name),G,u.extensions,!1,u.files||null,null,null,void 0,T,u.forcedExtension)}),u,G);if(u.boundingBoxPosition&&(T.boundingBoxPosition=m.q.Ag(u.boundingBoxPosition)),u.boundingBoxSize&&(T.boundingBoxSize=m.q.Ag(u.boundingBoxSize)),u.animations)for(let z=0;z<u.animations.length;z++){const G=u.animations[z],s=(0,x.e)("BABYLON.Animation");s&&T.animations.push(s.Parse(G))}return T}clone(){let u=0;const G=b.e.Clone((()=>{const G=new Q(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return u=G.uniqueId,G}),this);return G.uniqueId=u,G}}(0,T.b)([(0,z.M)()],Q.prototype,"url",void 0),(0,T.b)([(0,z.J)()],Q.prototype,"boundingBoxPosition",void 0),(0,T.b)([(0,z.J)()],Q.prototype,"boundingBoxSize",null),(0,T.b)([(0,z.M)("rotationY")],Q.prototype,"rotationY",null),(0,T.b)([(0,z.M)("files")],Q.prototype,"_files",void 0),(0,T.b)([(0,z.M)("forcedExtension")],Q.prototype,"_forcedExtension",void 0),(0,T.b)([(0,z.M)("extensions")],Q.prototype,"_extensions",void 0),(0,T.b)([(0,z.t)("textureMatrix")],Q.prototype,"_textureMatrix",void 0),(0,T.b)([(0,z.t)("textureMatrixRefraction")],Q.prototype,"_textureMatrixRefraction",void 0),C.b._CubeTextureParser=Q.Parse,(0,x.g)("BABYLON.CubeTexture",Q)},12308:(u,G,s)=>{"use strict";s.d(G,{d:()=>C});var T=s(10584),z=s(11102),O=s(10725),m=s(11312),f=s(10683);m.ThinEngine.prototype.createDynamicTexture=function(u,G,s,T){const z=new f.d(this,4);return z.baseWidth=u,z.baseHeight=G,s&&(u=this.needPOTTextures?(0,O.h)(u,this._caps.maxTextureSize):u,G=this.needPOTTextures?(0,O.h)(G,this._caps.maxTextureSize):G),z.width=u,z.height=G,z.isReady=!1,z.generateMipMaps=s,z.samplingMode=T,this.updateTextureSamplingMode(T,z),this._internalTexturesCache.push(z),z},m.ThinEngine.prototype.updateDynamicTexture=function(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!u)return;const m=this._gl,f=m.TEXTURE_2D,C=this._bindTextureDirectly(f,u,!0,O);this._unpackFlipY(void 0===s?u.invertY:s),T&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const x=this._getWebGLTextureType(u.type),g=this._getInternalFormat(z||u.format),b=this._getRGBABufferInternalSizedFormat(u.type,g);m.texImage2D(f,0,b,g,x,G),u.generateMipMaps&&m.generateMipmap(f),C||this._bindTextureDirectly(f,null),T&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),z&&(u.format=z),u._dynamicTextureSource=G,u._premulAlpha=T,u.invertY=s||!1,u.isReady=!0};class C extends z.b{constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,f=arguments.length>6?arguments[6]:void 0;const C=!s||s._isScene;super(null,C?s:null===s||void 0===s?void 0:s.wf,C?!T:s,f,O,void 0,void 0,void 0,void 0,m),this.name=u,this.wrapU=z.b.CLAMP_ADDRESSMODE,this.wrapV=z.b.CLAMP_ADDRESSMODE,this._generateMipMaps=T;const x=this._getEngine();if(!x)return;if(G.getContext)this._canvas=G,this._ownCanvas=!1,this._texture=x.createDynamicTexture(this._canvas.width,this._canvas.height,T,O);else{this._canvas=x.createCanvas(1,1),this._ownCanvas=!0;const u=G;u.width||0===u.width?this._texture=x.createDynamicTexture(u.width,u.height,T,O):this._texture=x.createDynamicTexture(G,G,T,O)}const g=this.getSize();this._canvas.width!==g.width&&(this._canvas.width=g.width),this._canvas.height!==g.height&&(this._canvas.height=g.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(u){this._canvas.width=u.width,this._canvas.height=u.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(u.width,u.height,this._generateMipMaps,this.samplingMode)}scale(u){const G=this.getSize();G.width*=u,G.height*=u,this._recreate(G)}scaleTo(u,G){const s=this.getSize();s.width=u,s.height=G,this._recreate(s)}getContext(){return this._context}clear(u){const G=this.getSize();u&&(this._context.fillStyle=u),this._context.clearRect(0,0,G.width,G.height)}update(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===u||u,G,this._format||void 0,void 0,s)}drawText(u,G,s,T,z,O,m){let f=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(O&&(this._context.fillStyle=O,this._context.fillRect(0,0,C.width,C.height)),this._context.font=T,null===G||void 0===G){const s=this._context.measureText(u);G=(C.width-s.width)/2}if(null===s||void 0===s){const u=parseInt(T.replace(/\D/g,""));s=C.height/2+u/3.65}this._context.fillStyle=z||"",this._context.fillText(u,G,s),f&&this.update(m)}dispose(){var u,G;(super.dispose(),this._ownCanvas)&&(null===(u=this._canvas)||void 0===u||null===(G=u.remove)||void 0===G||G.call(u));this._canvas=null,this._context=null}clone(){const u=this.va();if(!u)return this;const G=this.getSize(),s=new C(this.name,G,u,this._generateMipMaps);return s.nc=this.nc,s.level=this.level,s.wrapU=this.wrapU,s.wrapV=this.wrapV,s}serialize(){const u=this.va();u&&!u.isReady()&&T.d.Warn("The scene must be ready before serializing the dynamic texture");const G=super.serialize();return C._IsCanvasElement(this._canvas)&&(G.base64String=this._canvas.toDataURL()),G.invertY=this._invertY,G.samplingMode=this.samplingMode,G}static _IsCanvasElement(u){return void 0!==u.toDataURL}_rebuild(){this.update()}}},10683:(u,G,s)=>{"use strict";s.d(G,{d:()=>m});var T,z=s(10568),O=s(10691);!function(u){u[u.Unknown=0]="Unknown",u[u.Url=1]="Url",u[u.Temp=2]="Temp",u[u.Raw=3]="Raw",u[u.Dynamic=4]="Dynamic",u[u.RenderTarget=5]="RenderTarget",u[u.MultiRenderTarget=6]="MultiRenderTarget",u[u.Cube=7]="Cube",u[u.CubeRaw=8]="CubeRaw",u[u.CubePrefiltered=9]="CubePrefiltered",u[u.Raw3D=10]="Raw3D",u[u.Raw2DArray=11]="Raw2DArray",u[u.DepthStencil=12]="DepthStencil",u[u.CubeRawRGBD=13]="CubeRawRGBD",u[u.Depth=14]="Depth"}(T||(T={}));class m extends O.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(u){this.generateMipMaps=u}get uniqueId(){return this._uniqueId}_setUniqueId(u){this._uniqueId=u}getEngine(){return this._engine}get source(){return this._source}constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new z.e,this.onErrorObservable=new z.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=u,this._source=G,this._uniqueId=m._Counter++,s||(this._hardwareTexture=u._createHardwareTexture())}incrementReferences(){this._references++}updateSize(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,u,G,s),this.width=u,this.height=G,this.depth=s,this.baseWidth=u,this.baseHeight=G,this.baseDepth=s,this._size=u*G*s}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const u=this.onRebuildCallback(this),G=G=>{G._swapAndDie(this,!1),this.isReady=u.isReady};return void(u.isAsync?u.proxy.then(G):G(u.proxy))}let u;switch(this.source){case 2:case 12:case 14:break;case 1:return void(u=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(u=>{u._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:u=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),u._swapAndDie(this,!1),this.isReady=!0;break;case 10:u=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),u._swapAndDie(this,!1),this.isReady=!0;break;case 11:u=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),u._swapAndDie(this,!1),this.isReady=!0;break;case 4:u=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),u._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(u=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{u._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:u=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),u._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return u=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(u=>{u&&u._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(u._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(u){var G;let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(G=this._hardwareTexture)||void 0===G||G.setUsage(u._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),u._hardwareTexture=this._hardwareTexture,s&&(u._isRGBD=this._isRGBD),this._lodTextureHigh&&(u._lodTextureHigh&&u._lodTextureHigh.dispose(),u._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(u._lodTextureMid&&u._lodTextureMid.dispose(),u._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(u._lodTextureLow&&u._lodTextureLow.dispose(),u._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(u._irradianceTexture&&u._irradianceTexture.dispose(),u._irradianceTexture=this._irradianceTexture);const T=this._engine.getLoadedTexturesCache();let z=T.indexOf(this);-1!==z&&T.splice(z,1),z=T.indexOf(u),-1===z&&T.push(u)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}m._Counter=0},11336:(u,G,s)=>{"use strict";s.d(G,{b:()=>z});var T=s(11102);class z extends T.b{constructor(u,G,s,z,O){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>9?arguments[9]:void 0,b=arguments.length>10?arguments[10]:void 0;super(null,O,!m,f,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,g),this.format=z,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==x||(C=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==x||(C=1),this._texture=this._engine.createRawTexture(u,G,s,z,m,f,C,null,x,g??0,b??!1),this.wrapU=T.b.CLAMP_ADDRESSMODE,this.wrapV=T.b.CLAMP_ADDRESSMODE)}update(u){this._getEngine().updateRawTexture(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const u=new z(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return u._texture=this._texture,this._texture.incrementReferences(),u}static CreateLuminanceTexture(u,G,s,T){return new z(u,G,s,1,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(u,G,s,T){return new z(u,G,s,2,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(u,G,s,T){return new z(u,G,s,0,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(u,G,s,T){return new z(u,G,s,4,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(u,G,s,T){return new z(u,G,s,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(u,G,s,T){return new z(u,G,s,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(u,G,s,O){let m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.b.TRILINEAR_SAMPLINGMODE;return new z(u,G,s,6,O,m,f,C,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(u,G,s,O){let m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.b.TRILINEAR_SAMPLINGMODE;return new z(u,G,s,6,O,m,f,C,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11726:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(11102);class z extends T.b{get depth(){return this._depth}constructor(u,G,s,z,O,m){let f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:T.b.TRILINEAR_SAMPLINGMODE,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10?arguments[10]:void 0;super(null,m,!f,C),this.format=O,this._texture=m.getEngine().createRawTexture2DArray(u,G,s,z,O,f,C,x,null,g,b),this._depth=z,this.is2DArray=!0}update(u){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(u,G,s,T,O){return new z(u,G,s,T,5,O,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11407:(u,G,s)=>{"use strict";s.d(G,{c:()=>Q});var T=s(10568),z=s(10904),O=s(11102),m=s(10972),f=s(10980),C=s(10918),x=s(10725),g=s(10650),b=s(10584);g.e.prototype.setDepthStencilTexture=function(u,G){this._engine.setDepthStencilTexture(this._samplers[u],this._uniforms[u],G,u)};class Q extends O.b{get renderList(){return this._renderList}set renderList(u){this._renderList!==u&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),u&&(this._unObserveRenderList=(0,C.f)(u,this._renderListHasChanged)),this._renderList=u)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(u){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(u)}set onBeforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u)}set onAfterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(u)}set onClear(u){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(u)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(u,G){let s;s=Array.isArray(u)?u:[u];for(let T=0;T<s.length;++T)for(let u=0;u<this._renderPassIds.length;++u)s[T].setMaterialForRenderPass(this._renderPassIds[u],void 0!==G?Array.isArray(G)?G[u]:G:void 0)}get isMulti(){var u;return(null===(u=this._renderTarget)||void 0===u?void 0:u.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const G=this.va();G&&G.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var u;return(null===(u=this._renderTarget)||void 0===u?void 0:u._depthStencilTexture)??null}constructor(u,G,s){let m,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:O.b.TRILINEAR_SAMPLINGMODE,Y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],n=arguments.length>9&&void 0!==arguments[9]&&arguments[9],V=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,r=arguments.length>12&&void 0!==arguments[12]&&arguments[12],c=arguments.length>13?arguments[13]:void 0,j=arguments.length>14?arguments[14]:void 0,l=arguments.length>15&&void 0!==arguments[15]&&arguments[15],P=arguments.length>16&&void 0!==arguments[16]&&arguments[16],H=!0;if("object"===typeof C){const u=C;C=!!u.generateMipMaps,x=u.doNotChangeAspectRatio??!0,g=u.type??0,b=!!u.isCube,Q=u.samplingMode??O.b.TRILINEAR_SAMPLINGMODE,Y=u.generateDepthBuffer??!0,n=!!u.generateStencilBuffer,V=!!u.isMulti,F=u.format??5,r=!!u.delayAllocation,c=u.samples,j=u.creationFlags,l=!!u.noColorAttachment,P=!!u.useSRGBBuffer,m=u.colorAttachment,H=u.gammaSpace??H}if(super(null,s,!C,void 0,Q,void 0,void 0,void 0,void 0,F),this._unObserveRenderList=null,this._renderListHasChanged=(u,G)=>{const s=this._renderList?this._renderList.length:0;var T;(0===G&&s>0||0===s)&&(null===(T=this.va())||void 0===T||T.meshes.forEach((u=>{u._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new T.e,this.onAfterUnbindObservable=new T.e,this.onBeforeRenderObservable=new T.e,this.onAfterRenderObservable=new T.e,this.onClearObservable=new T.e,this.onResizeObservable=new T.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=z.q.Zero(),this._dumpToolsLoading=!1,!(s=this.va()))return;const X=this.va().getEngine();this._gammaSpace=H,this._coordinatesMode=O.b.PROJECTION_MODE,this.renderList=[],this.name=u,this.isRenderTarget=!0,this._initialSizeParameter=G,this._renderPassIds=[],this._isCubeData=b,this._processSizeParameter(G),this.renderPassId=this._renderPassIds[0],this._resizeObserver=X.onResizeObservable.add((()=>{})),this._generateMipMaps=!!C,this._doNotChangeAspectRatio=x,this._renderingManager=new f.b(s),this._renderingManager._useSceneAutoClearSetup=!0,V||(this._renderTargetOptions={generateMipMaps:C,type:g,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:Y,generateStencilBuffer:n,samples:c,creationFlags:j,noColorAttachment:l,useSRGBBuffer:P,colorAttachment:m,label:this.name},this.samplingMode===O.b.NEAREST_SAMPLINGMODE&&(this.wrapU=O.b.CLAMP_ADDRESSMODE,this.wrapV=O.b.CLAMP_ADDRESSMODE),r||(b?(this._renderTarget=s.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=O.b.INVCUBIC_MODE,this._textureMatrix=z.d.Identity()):this._renderTarget=s.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==c&&(this.samples=c)))}createDepthStencilTexture(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,m=arguments.length>5?arguments[5]:void 0;null===(u=this._renderTarget)||void 0===u||u.createDepthStencilTexture(G,s,T,z,O,m)}_releaseRenderPassId(){if(this._scene){const u=this._scene.getEngine();for(let G=0;G<this._renderPassIds.length;++G)u.releaseRenderPassId(this._renderPassIds[G])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const u=this._scene.getEngine(),G=this._isCubeData?6:this.getRenderLayers()||1;for(let s=0;s<G;++s)this._renderPassIds[s]=u.createRenderPassId(`RenderTargetTexture - ${this.name}#${s}`)}_processSizeParameter(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(u.ratio){this._sizeRatio=u.ratio;const G=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(G.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(G.getRenderHeight(),this._sizeRatio)}}else this._size=u;G&&this._createRenderPassId()}get samples(){var u;return(null===(u=this._renderTarget)||void 0===u?void 0:u.samples)??this._samples}set samples(u){this._renderTarget&&(this._samples=this._renderTarget.setSamples(u))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(u){this._refreshRate=u,this.resetRefreshCounter()}addPostProcess(u){if(!this._postProcessManager){const u=this.va();if(!u)return;this._postProcessManager=new m.e(u),this._postProcesses=new Array}this._postProcesses.push(u),this._postProcesses[0].Ji=!1}clearPostProcesses(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(u)for(const u of this._postProcesses)u.dispose();this._postProcesses=[]}}removePostProcess(u){if(!this._postProcesses)return;const G=this._postProcesses.indexOf(u);-1!==G&&(this._postProcesses.splice(G,1),this._postProcesses.length>0&&(this._postProcesses[0].Ji=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const u=this._size.layers;if(u)return u;const G=this._size.depth;return G||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(u){const G=Math.max(1,this.getRenderSize()*u);this.resize(G)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(u){var G;const s=this.isCube;null===(G=this._renderTarget)||void 0===G||G.dispose(),this._renderTarget=null;const T=this.va();T&&(this._processSizeParameter(u,!1),this._renderTarget=s?T.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):T.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(u,G)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(s.bind(s,11902)).then((u=>this._dumpTools=u))),this._render(!1,!1,!0)}_render(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=this.va();if(!T)return s;const z=T.getEngine();if(void 0!==this.useCameraPostProcesses&&(u=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let u=0;u<this._waitingRenderList.length;u++){const G=this._waitingRenderList[u],s=T.getMeshById(G);s&&this.renderList.push(s)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const u=this.va();if(!u)return s;const G=u.meshes;for(let s=0;s<G.length;s++){const u=G[s];this.renderListPredicate(u)&&this.renderList.push(u)}}const O=z.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const m=this.activeCamera??T.activeCamera,f=T.activeCamera;m&&(m!==T.activeCamera&&(T.setTransformMatrix(m.getViewMatrix(),m.getProjectionMatrix(!0)),T.activeCamera=m),z.setViewport(m.rigParent?m.rigParent.viewport:m.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let C=s;if(s){T.getViewMatrix()||T.updateTransformMatrix();const u=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let O=0;O<u&&C;O++){let u=null;const G=this.renderList?this.renderList:T.getActiveMeshes().data,m=this.renderList?this.renderList.length:T.getActiveMeshes().length;z.currentRenderPassId=this._renderPassIds[O],this.onBeforeRenderObservable.notifyObservers(O),this.getCustomRenderList&&(u=this.getCustomRenderList(O,G,m)),u||(u=G),this._doNotChangeAspectRatio||T.updateTransformMatrix(!0);for(let T=0;T<u.length&&C;++T){const G=u[T];if(G.isEnabled()&&!G.isBlocked&&G.isVisible&&G.xf)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(G,this.refreshRate,s)){C=!1;continue}}else if(!G.isReady(!0)){C=!1;continue}}this.onAfterRenderObservable.notifyObservers(O),(this.is2DArray||this.is3D||this.isCube)&&(T.incrementRenderId(),T.resetCachedMaterial())}const G=this.particleSystemList||T.fj;for(const s of G)s.isReady()||(C=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let x=0;x<6;x++)this._renderToTarget(x,u,G,void 0,m),T.incrementRenderId(),T.resetCachedMaterial();else this._renderToTarget(0,u,G,void 0,m);else for(let x=0;x<this.getRenderLayers();x++)this._renderToTarget(0,u,G,x,m),T.incrementRenderId(),T.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),z.currentRenderPassId=O,T.activeCamera=f,f&&(this.activeCamera&&this.activeCamera!==T.activeCamera&&T.setTransformMatrix(f.getViewMatrix(),f.getProjectionMatrix(!0)),z.setViewport(f.viewport)),T.resetCachedMaterial(),C}_bestReflectionRenderTargetDimension(u,G){const s=u*G,T=(0,x.n)(s+16384/(128+s));return Math.min((0,x.e)(u),T)}_prepareRenderingManager(u,G,s,T){const z=this.va();if(!z)return;this._renderingManager.reset();const O=z.getRenderId();for(let f=0;f<G;f++){const G=u[f];if(G&&!G.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(G,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!G.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!G._internalAbstractMeshDataInfo._currentLODIsUpToDate&&s&&(G._internalAbstractMeshDataInfo._currentLOD=z.customLODSelector?z.customLODSelector(G,s):G.getLOD(s),G._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!G._internalAbstractMeshDataInfo._currentLOD)continue;let u,m=G._internalAbstractMeshDataInfo._currentLOD;if(m!==G&&0!==m.billboardMode&&m.Gj(),m._preActivateForIntermediateRendering(O),u=!(!T||!s)&&0===(G.layerMask&s.layerMask),G.isEnabled()&&G.isVisible&&G.xf&&!u){if(m!==G&&m._activate(O,!0),G._activate(O,!0)&&G.xf.length){G.isAnInstance?G._internalAbstractMeshDataInfo._actAsRegularMesh&&(m=G):m._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,m._internalAbstractMeshDataInfo._isActiveIntermediate=!0,z._prepareSkeleton(m);for(let u=0;u<m.xf.length;u++){const G=m.xf[u];this._renderingManager.dispatch(G,m)}}G._postActivate()}}}const m=this.particleSystemList||z.fj;for(let f=0;f<m.length;f++){const u=m[f],G=u.k;u.isStarted()&&G&&(!G.position||G.isEnabled())&&this._renderingManager.dispatchParticles(u)}}_bindFrameBuffer(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.va();if(!s)return;const T=s.getEngine();this._renderTarget&&T.bindFramebuffer(this._renderTarget,this.isCube?u:void 0,void 0,void 0,this.ignoreCameraViewport,0,G)}_unbindFrameBuffer(u,G){this._renderTarget&&u.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(G)}))}_prepareFrame(u,G,s,T){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):T&&u.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(G,s)}_renderToTarget(u,G,s){var T,z;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const f=this.va();if(!f)return;const C=f.getEngine();this._prepareFrame(f,u,O,G),null===(T=C._debugPushGroup)||void 0===T||T.call(C,`render to face #${u} layer #${O}`,2),this.is2DArray||this.is3D?(C.currentRenderPassId=this._renderPassIds[O],this.onBeforeRenderObservable.notifyObservers(O)):(C.currentRenderPassId=this._renderPassIds[u],this.onBeforeRenderObservable.notifyObservers(u));if(C.snapshotRendering&&1===C.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(C):this.skipInitialClear||C.clear(this.clearColor||f.clearColor,!0,!0,!0);else{var x;let T=null;const z=this.renderList?this.renderList:f.getActiveMeshes().data,g=this.renderList?this.renderList.length:f.getActiveMeshes().length;this.getCustomRenderList&&(T=this.getCustomRenderList(this.is2DArray||this.is3D?O:u,z,g)),T?this._prepareRenderingManager(T,T.length,m,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(z,g,m,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),T=z);for(const G of f._beforeRenderTargetClearStage)G.action(this,u,O);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(C):this.skipInitialClear||C.clear(this.clearColor||f.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0);for(const G of f._beforeRenderTargetDrawStage)G.action(this,u,O);this._renderingManager.render(this.customRenderFunction,T,this.renderParticles,this.renderSprites);for(const G of f._afterRenderTargetDrawStage)G.action(this,u,O);const Q=(null===(x=this._texture)||void 0===x?void 0:x.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,u,this._postProcesses,this.ignoreCameraViewport):G&&f.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,u);for(const G of f._afterRenderTargetPostProcessStage)G.action(this,u,O);this._texture&&(this._texture.generateMipMaps=Q),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0),s&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),C):b.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(z=C._debugPopGroup)||void 0===z||z.call(C,2),this._unbindFrameBuffer(C,u),this._texture&&this.isCube&&5===u&&C.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(u,G,s,T)}setRenderingAutoClearDepthStencil(u,G){this._renderingManager.setRenderingAutoClearDepthStencil(u,G),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const u=this.getSize(),G=new Q(this.name,u,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return G.nc=this.nc,G.level=this.level,G.coordinatesMode=this.coordinatesMode,this.renderList&&(G.renderList=this.renderList.slice(0)),G}serialize(){if(!this.name)return null;const u=super.serialize();if(u.renderTargetSize=this.getRenderSize(),u.renderList=[],this.renderList)for(let G=0;G<this.renderList.length;G++)u.renderList.push(this.renderList[G].id);return u}disposeFramebufferObjects(){var u;null===(u=this._renderTarget)||void 0===u||u.dispose(!0)}releaseInternalTexture(){var u;null===(u=this._renderTarget)||void 0===u||u.releaseTextures(),this._texture=null}dispose(){var u;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const G=this.va();if(!G)return;let s=G.customRenderTargets.indexOf(this);s>=0&&G.customRenderTargets.splice(s,1);for(const T of G.cameras)s=T.customRenderTargets.indexOf(this),s>=0&&T.customRenderTargets.splice(s,1);null===(u=this._renderTarget)||void 0===u||u.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===Q.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=Q.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}Q.REFRESHRATE_RENDER_ONCE=0,Q.REFRESHRATE_RENDER_ONEVERYFRAME=1,Q.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,O.b._CreateRenderTargetTexture=(u,G,s,T,z)=>new Q(u,G,s,T)},11102:(u,G,s)=>{"use strict";s.d(G,{b:()=>j});var T=s(10863),z=s(10866),O=s(10568),m=s(10904),f=s(11107),C=s(10715),x=s(10609),g=s(10640),b=s(10707),Q=s(11018),Y=s(10627);function n(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=G.width,z=G.height;if(u instanceof Float32Array){let G=u.byteLength/u.BYTES_PER_ELEMENT;const s=new Uint8Array(G);for(;--G>=0;){let T=u[G];T<0?T=0:T>1&&(T=1),s[G]=255*T}u=s}const O=document.createElement("canvas");O.width=T,O.height=z;const m=O.getContext("2d");if(!m)return null;const f=m.createImageData(T,z);if(f.data.set(u),m.putImageData(f,0,0),s){const u=document.createElement("canvas");u.width=T,u.height=z;const G=u.getContext("2d");return G?(G.translate(0,z),G.scale(1,-1),G.drawImage(O,0,0),u.toDataURL("image/png")):null}return O.toDataURL("image/png")}function V(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const T=u.getInternalTexture();if(!T)return null;const z=u._readPixelsSync(G,s);return z?n(z,u.getSize(),T.invertY):null}async function F(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const T=u.getInternalTexture();if(!T)return null;const z=await u.readPixels(G,s);return z?n(z,u.getSize(),T.invertY):null}var r=s(11121),c=s(10935);class j extends f.c{static _CreateVideoTexture(u,G,s){arguments.length>5&&void 0!==arguments[5]||j.TRILINEAR_SAMPLINGMODE;throw(0,x.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(u){this._isBlocking=u}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(u,G,s,T){let z,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.TRILINEAR_SAMPLINGMODE,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9?arguments[9]:void 0,Y=arguments.length>10?arguments[10]:void 0,n=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0,F=arguments.length>13?arguments[13]:void 0;super(G),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new O.e,this._isBlocking=!0,this.name=u||"",this.url=u;let c=!1,l=null,P=!0;"object"===typeof s&&null!==s?(z=s.noMipmap??!1,T=s.invertY??!r.e,m=s.samplingMode??j.TRILINEAR_SAMPLINGMODE,f=s.X??null,C=s.onError??null,x=s.buffer??null,b=s.deleteBuffer??!1,Q=s.format,Y=s.mimeType,n=s.loaderOptions,V=s.creationFlags,c=s.useSRGBBuffer??!1,l=s.internalTexture??null,P=s.gammaSpace??P):z=!!s,this._gammaSpace=P,this._noMipmap=z,this._invertY=void 0===T?!r.e:T,this._initialSamplingMode=m,this._buffer=x,this._deleteBuffer=b,this._mimeType=Y,this._loaderOptions=n,this._creationFlags=V,this._useSRGBBuffer=c,this._forcedExtension=F,Q&&(this._format=Q);const H=this.va(),X=this._getEngine();if(!X)return;X.onBeforeTextureInitObservable.notifyObservers(this);const p=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),f&&f(),!this.isBlocking&&H&&H.resetCachedMaterial()},q=(u,G)=>{this._loadingError=!0,this._errorObject={message:u,exception:G},C&&C(u,G),j.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!l)return this._delayedOnLoad=p,void(this._delayedOnError=q);if(this._texture=l??this._getFromCache(this.url,z,m,this._invertY,c,this.isCube),this._texture)if(this._texture.isReady)g.e.SetImmediate((()=>p()));else{const u=this._texture.onLoadedObservable.add(p);this._texture.onErrorObservable.add((G=>{var s;q(G.message,G.exception),null===(s=this._texture)||void 0===s||s.onLoadedObservable.remove(u)}))}else if(H&&H.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=p,this._delayedOnError=q;else{try{this._texture=X.createTexture(this.url,z,this._invertY,H,m,p,q,this._buffer,void 0,this._format,this._forcedExtension,Y,n,V,c)}catch(d){throw q("error loading",d),d}b&&(this._buffer=null)}}updateURL(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(u=>u.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=u),this.url=u,this._buffer=G,this._forcedExtension=T,this.delayLoadState=4,s&&(this._delayedOnLoad=s),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const u=this.va();u&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?g.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=u.getEngine().createTexture(this.url,this._noMipmap,this._invertY,u,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(u,G,s,T){u*=this._cachedUScale,G*=this._cachedVScale,u-=this.uRotationCenter*this._cachedUScale,G-=this.vRotationCenter*this._cachedVScale,s-=this.wRotationCenter,m.q.TransformCoordinatesFromFloatsToRef(u,G,s,this._rowGenerationMatrix,T),T.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,T.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,T.z+=this.wRotationCenter}getTextureMatrix(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*u===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*u,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=m.d.Zero(),this._rowGenerationMatrix=new m.d,this._t0=m.q.Zero(),this._t1=m.q.Zero(),this._t2=m.q.Zero()),m.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(m.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,m.l.Matrix[0]),m.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,m.l.Matrix[1]),m.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,m.l.Matrix[2]),m.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,m.l.Matrix[3]),m.l.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(m.l.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(m.l.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(m.l.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.fi(this._t0),this._t2.fi(this._t0),m.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const G=this.va();if(!G)return this._cachedTextureMatrix;const s=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&s!==this._cachedIdentity3x2&&G.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const u=this.va();if(!u)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==j.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===u.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=m.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=m.d.Zero());const G=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case j.PLANAR_MODE:m.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case j.PROJECTION_MODE:{m.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const G=u.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=G.updateFlag,G.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:m.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return G&&u.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const u={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return c.e.Clone((()=>new j(this._texture?this._texture.url:null,this.va(),u)),this)}serialize(){var u;const G=this.name;j.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const s=super.serialize(j._SerializeInternalTextureUniqueId);if(!s)return null;var T;((j.SerializeBuffers||j.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(s.base64String=this._buffer,s.name=s.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?s.base64String="data:image/png;base64,"+(0,Y.k)(this._buffer):(j.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(s.base64String=!this._engine||this._engine._features.supportSyncTextureRead?V(this):F(this))),s.invertY=this._invertY,s.samplingMode=this.samplingMode,s._creationFlags=this._creationFlags,s._useSRGBBuffer=this._useSRGBBuffer,j._SerializeInternalTextureUniqueId)&&(s.internalTextureUniqueId=null===(T=this._texture)||void 0===T?void 0:T.uniqueId);return s.internalTextureLabel=null===(u=this._texture)||void 0===u?void 0:u.label,s.noMipmap=this._noMipmap,this.name=G,s}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(u,G,s){if(u.customType){const T=b.e.Instantiate(u.customType).Parse(u,G,s);return u.samplingMode&&T.updateSamplingMode&&T._samplingMode&&T._samplingMode!==u.samplingMode&&T.updateSamplingMode(u.samplingMode),T}if(u.isCube&&!u.isRenderTarget)return j._CubeTextureParser(u,G,s);const T=void 0!==u.internalTextureUniqueId;if(!u.name&&!u.isRenderTarget&&!T)return null;let z;if(T){const s=G.getEngine().getLoadedTexturesCache();for(const G of s)if(G.uniqueId===u.internalTextureUniqueId){z=G;break}}const O=G=>{if(G&&G._texture&&(G._texture._cachedWrapU=null,G._texture._cachedWrapV=null,G._texture._cachedWrapR=null),u.samplingMode){const s=u.samplingMode;G&&G.samplingMode!==s&&G.updateSamplingMode(s)}if(G&&u.animations)for(let s=0;s<u.animations.length;s++){const T=u.animations[s],z=(0,C.e)("BABYLON.Animation");z&&G.animations.push(z.Parse(T))}G&&G._texture&&(T&&!z&&G._texture._setUniqueId(u.internalTextureUniqueId),G._texture.label=u.internalTextureLabel)};return c.e.Parse((()=>{let T=!0;if(u.noMipmap&&(T=!1),u.mirrorPlane){const s=j._CreateMirror(u.name,u.renderTargetSize,G,T);return s._waitingRenderList=u.renderList,s.mirrorPlane=Q.d.Ag(u.mirrorPlane),O(s),s}if(u.isRenderTarget){let s=null;if(u.isCube){if(G.reflectionProbes)for(let T=0;T<G.reflectionProbes.length;T++){const s=G.reflectionProbes[T];if(s.name===u.name)return s.cubeTexture}}else s=j._CreateRenderTargetTexture(u.name,u.renderTargetSize,G,T,u._creationFlags??0),s._waitingRenderList=u.renderList;return O(s),s}if(u.isVideo){const z=j._CreateVideoTexture(s+(u.url||u.name),s+(u.src||u.url),G,T,u.invertY,u.samplingMode,u.settings||{});return O(z),z}{let m;if(u.base64String&&!z)m=j.CreateFromBase64String(u.base64String,u.base64String,G,!T,u.invertY,u.samplingMode,(()=>{O(m)}),u._creationFlags??0,u._useSRGBBuffer??!1),m.name=u.name;else{let f;f=u.name&&(u.name.indexOf("://")>0||u.name.startsWith("data:"))?u.name:s+u.name,u.url&&(u.url.startsWith("data:")||j.UseSerializedUrlIfAny)&&(f=u.url);const C={noMipmap:!T,invertY:u.invertY,samplingMode:u.samplingMode,X:()=>{O(m)},internalTexture:z};m=new j(f,G,C)}return m}}),u,G)}static CreateFromBase64String(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:j.TRILINEAR_SAMPLINGMODE;return new j("data:"+G,s,T,z,O,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:j.TRILINEAR_SAMPLINGMODE,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,g=arguments.length>10?arguments[10]:void 0,b=arguments.length>11?arguments[11]:void 0;return"data:"!==u.substring(0,5)&&(u="data:"+u),new j(u,s,z,O,m,f,C,G,T,x,void 0,void 0,g,b)}}j.SerializeBuffers=!0,j.ForceSerializeBuffers=!1,j.OnTextureLoadErrorObservable=new O.e,j._SerializeInternalTextureUniqueId=!1,j._CubeTextureParser=(u,G,s)=>{throw(0,x.c)("CubeTexture")},j._CreateMirror=(u,G,s,T)=>{throw(0,x.c)("MirrorTexture")},j._CreateRenderTargetTexture=(u,G,s,T,z)=>{throw(0,x.c)("RenderTargetTexture")},j.NEAREST_SAMPLINGMODE=1,j.NEAREST_NEAREST_MIPLINEAR=8,j.BILINEAR_SAMPLINGMODE=2,j.LINEAR_LINEAR_MIPNEAREST=11,j.TRILINEAR_SAMPLINGMODE=3,j.LINEAR_LINEAR_MIPLINEAR=3,j.NEAREST_NEAREST_MIPNEAREST=4,j.NEAREST_LINEAR_MIPNEAREST=5,j.NEAREST_LINEAR_MIPLINEAR=6,j.NEAREST_LINEAR=7,j.NEAREST_NEAREST=1,j.LINEAR_NEAREST_MIPNEAREST=9,j.LINEAR_NEAREST_MIPLINEAR=10,j.LINEAR_LINEAR=2,j.LINEAR_NEAREST=12,j.EXPLICIT_MODE=0,j.SPHERICAL_MODE=1,j.PLANAR_MODE=2,j.CUBIC_MODE=3,j.PROJECTION_MODE=4,j.SKYBOX_MODE=5,j.INVCUBIC_MODE=6,j.EQUIRECTANGULAR_MODE=7,j.FIXED_EQUIRECTANGULAR_MODE=8,j.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,j.CLAMP_ADDRESSMODE=0,j.WRAP_ADDRESSMODE=1,j.MIRROR_ADDRESSMODE=2,j.UseSerializedUrlIfAny=!1,(0,T.b)([(0,z.M)()],j.prototype,"url",void 0),(0,T.b)([(0,z.M)()],j.prototype,"uOffset",void 0),(0,T.b)([(0,z.M)()],j.prototype,"vOffset",void 0),(0,T.b)([(0,z.M)()],j.prototype,"uScale",void 0),(0,T.b)([(0,z.M)()],j.prototype,"vScale",void 0),(0,T.b)([(0,z.M)()],j.prototype,"uAng",void 0),(0,T.b)([(0,z.M)()],j.prototype,"vAng",void 0),(0,T.b)([(0,z.M)()],j.prototype,"wAng",void 0),(0,T.b)([(0,z.M)()],j.prototype,"uRotationCenter",void 0),(0,T.b)([(0,z.M)()],j.prototype,"vRotationCenter",void 0),(0,T.b)([(0,z.M)()],j.prototype,"wRotationCenter",void 0),(0,T.b)([(0,z.M)()],j.prototype,"homogeneousRotationInUVTransform",void 0),(0,T.b)([(0,z.M)()],j.prototype,"isBlocking",null),(0,C.g)("BABYLON.Texture",j),c.e._TextureParser=j.Parse},10691:(u,G,s)=>{"use strict";s.d(G,{c:()=>T});class T{get wrapU(){return this._cachedWrapU}set wrapU(u){this._cachedWrapU=u}get wrapV(){return this._cachedWrapV}set wrapV(u){this._cachedWrapV=u}get wrapR(){return this._cachedWrapR}set wrapR(u){this._cachedWrapR=u}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(u){this._cachedAnisotropicFilteringLevel=u}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(u){this._comparisonFunction=u}get useMipMaps(){return this._useMipMaps}set useMipMaps(u){this._useMipMaps=u}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=u,this._cachedWrapV=G,this._cachedWrapR=s,this._cachedAnisotropicFilteringLevel=T,this.samplingMode=z,this._comparisonFunction=O,this}compareSampler(u){return this._cachedWrapU===u._cachedWrapU&&this._cachedWrapV===u._cachedWrapV&&this._cachedWrapR===u._cachedWrapR&&this._cachedAnisotropicFilteringLevel===u._cachedAnisotropicFilteringLevel&&this.samplingMode===u.samplingMode&&this._comparisonFunction===u._comparisonFunction&&this._useMipMaps===u._useMipMaps}}},11088:(u,G,s)=>{"use strict";function T(u){-1===u.indexOf("vClipPlane")&&u.push("vClipPlane"),-1===u.indexOf("vClipPlane2")&&u.push("vClipPlane2"),-1===u.indexOf("vClipPlane3")&&u.push("vClipPlane3"),-1===u.indexOf("vClipPlane4")&&u.push("vClipPlane4"),-1===u.indexOf("vClipPlane5")&&u.push("vClipPlane5"),-1===u.indexOf("vClipPlane6")&&u.push("vClipPlane6")}function z(u,G,s){const T=!!(u.clipPlane??G.clipPlane),z=!!(u.clipPlane2??G.clipPlane2),O=!!(u.clipPlane3??G.clipPlane3),m=!!(u.clipPlane4??G.clipPlane4),f=!!(u.clipPlane5??G.clipPlane5),C=!!(u.clipPlane6??G.clipPlane6);T&&s.push("#define CLIPPLANE"),z&&s.push("#define CLIPPLANE2"),O&&s.push("#define CLIPPLANE3"),m&&s.push("#define CLIPPLANE4"),f&&s.push("#define CLIPPLANE5"),C&&s.push("#define CLIPPLANE6")}function O(u,G,s){let T=!1;const z=!!(u.clipPlane??G.clipPlane),O=!!(u.clipPlane2??G.clipPlane2),m=!!(u.clipPlane3??G.clipPlane3),f=!!(u.clipPlane4??G.clipPlane4),C=!!(u.clipPlane5??G.clipPlane5),x=!!(u.clipPlane6??G.clipPlane6);return s.CLIPPLANE!==z&&(s.CLIPPLANE=z,T=!0),s.CLIPPLANE2!==O&&(s.CLIPPLANE2=O,T=!0),s.CLIPPLANE3!==m&&(s.CLIPPLANE3=m,T=!0),s.CLIPPLANE4!==f&&(s.CLIPPLANE4=f,T=!0),s.CLIPPLANE5!==C&&(s.CLIPPLANE5=C,T=!0),s.CLIPPLANE6!==x&&(s.CLIPPLANE6=x,T=!0),T}function m(u,G,s){let T=G.clipPlane??s.clipPlane;f(u,"vClipPlane",T),T=G.clipPlane2??s.clipPlane2,f(u,"vClipPlane2",T),T=G.clipPlane3??s.clipPlane3,f(u,"vClipPlane3",T),T=G.clipPlane4??s.clipPlane4,f(u,"vClipPlane4",T),T=G.clipPlane5??s.clipPlane5,f(u,"vClipPlane5",T),T=G.clipPlane6??s.clipPlane6,f(u,"vClipPlane6",T)}function f(u,G,s){s&&u.setFloat4(G,s.ab.x,s.ab.y,s.ab.z,s.d)}s.d(G,{b:()=>T,f:()=>m,g:()=>O,k:()=>z})},10939:(u,G,s)=>{"use strict";function T(u){u.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}s.d(G,{e:()=>T})},11317:(u,G,s)=>{"use strict";function T(u){return void 0===u.getPipelineContext}s.d(G,{d:()=>T})},11083:(u,G,s)=>{"use strict";s.d(G,{d:()=>T});class T{static GetEffect(u){return void 0===u.getPipelineContext?u.effect:u}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=u.createDrawContext(),G&&(this.materialContext=u.createMaterialContext())}setEffect(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var T;(this.effect=u,void 0!==G&&(this.defines=G),s)&&(null===(T=this.drawContext)||void 0===T||T.reset())}dispose(){var u;null===(u=this.drawContext)||void 0===u||u.dispose()}}},10661:(u,G,s)=>{"use strict";s.d(G,{e:()=>b,h:()=>Y,k:()=>x,l:()=>g});var T=s(10577),z=s(10668),O=s(10655),m=s(10584),f=s(10630),C=s(10634);function x(u,G){return(0,z.B)(G).cachedPipelines[u]}function g(u){const G=u._name,s=u.context;if(G&&s){const u=(0,z.B)(s),T=u.cachedPipelines[G];null===T||void 0===T||T.dispose(),delete u.cachedPipelines[G]}}function b(u,G,s,z,O,m,C){let x,g;const b=(0,T.k)()?null===m||void 0===m?void 0:m.getHostDocument():null;x="string"===typeof G?G:G.vertexSource?"source:"+G.vertexSource:G.vertexElement?(null===b||void 0===b?void 0:b.getElementById(G.vertexElement))||G.vertexElement:G.vertex||G,g="string"===typeof G?G:G.fragmentSource?"source:"+G.fragmentSource:G.fragmentElement?(null===b||void 0===b?void 0:b.getElementById(G.fragmentElement))||G.fragmentElement:G.fragment||G;const Y=[void 0,void 0],n=()=>{if(Y[0]&&Y[1]){u.isFragment=!0;const[T,x]=Y;(0,f.i)(x,u,((m,x)=>{C&&(C._fragmentSourceCodeBeforeMigration=x),s&&(m=s("fragment",m));const g=(0,f.e)(T,m,u);u=null;const b=function(u,G,s,T){if(s){return{vertexSourceCode:(1===T?"//":"")+"#define SHADER_NAME vertex:"+(s.vertexElement||s.vertex||s.spectorName||s)+"\n"+u,fragmentSourceCode:(1===T?"//":"")+"#define SHADER_NAME fragment:"+(s.fragmentElement||s.fragment||s.spectorName||s)+"\n"+G}}return{vertexSourceCode:u,fragmentSourceCode:G}}(g.vertexCode,g.fragmentCode,G,O);null===z||void 0===z||z(b.vertexSourceCode,b.fragmentSourceCode)}),m)}};Q(x,"Vertex","",(G=>{(0,f.h)(u),(0,f.i)(G,u,((u,T)=>{C&&(C._rawVertexSourceCode=G,C._vertexSourceCodeBeforeMigration=T),s&&(u=s("vertex",u)),Y[0]=u,n()}),m)}),O),Q(g,"Fragment","Pixel",(u=>{C&&(C._rawFragmentSourceCode=u),Y[1]=u,n()}),O)}function Q(u,G,s,z,m,f){if("undefined"!==typeof HTMLElement&&u instanceof HTMLElement){return void z((0,T.b)(u))}if("source:"===u.substring(0,7))return void z(u.substring(7));if("base64:"===u.substring(0,7)){return void z(window.atob(u.substring(7)))}const x=O.b.GetShadersStore(m);if(x[u+G+"Shader"])return void z(x[u+G+"Shader"]);if(s&&x[u+s+"Shader"])return void z(x[u+s+"Shader"]);let g;if(g="."===u[0]||"/"===u[0]||u.indexOf("http")>-1?u:O.b.GetShadersRepository(m)+u,!(f=f||C.l))throw new Error("loadFileInjection is not defined");f(g+"."+G.toLowerCase()+".fx",z)}const Y=(u,G,s,T)=>{try{const O=u.existingPipelineContext||G(u.shaderProcessingContext);if(O._name=u.name,u.name&&u.context){(0,z.B)(u.context).cachedPipelines[u.name]=O}return s(O,u.vertex,u.fragment,!!u.createAsRaw,"","",u.rebuildRebind,u.defines,u.transformFeedbackVaryings,"",(()=>{T(O,(()=>{var G;null===(G=u.onRenderingStateCompiled)||void 0===G||G.call(u,O)}))})),O}catch(O){throw m.d.Error("Error compiling effect"),O}}},10650:(u,G,s)=>{"use strict";s.d(G,{e:()=>f});var T=s(10568),z=s(10584),O=s(10655),m=s(10661);class f{static get ShadersRepository(){return O.b.ShadersRepository}static set ShadersRepository(u){O.b.ShadersRepository=u}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new T.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9?arguments[9]:void 0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,V=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new T.e,this.onErrorObservable=new T.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=u,this._key=Y;const F=this._key.replace(/\r/g,"").replace(/\n/g,"|");let r;if(G.attributes){const u=G;if(this._engine=s,this._attributesNames=u.attributes,this._uniformsNames=u.uniformsNames.concat(u.samplers),this._samplerList=u.samplers.slice(),this.defines=u.defines,this.onError=u.onError,this.onCompiled=u.onCompiled,this._fallbacks=u.fallbacks,this._indexParameters=u.indexParameters,this._transformFeedbackVaryings=u.transformFeedbackVaryings||null,this._multiTarget=!!u.multiTarget,this._shaderLanguage=u.shaderLanguage??0,u.uniformBuffersNames){this._uniformBuffersNamesList=u.uniformBuffersNames.slice();for(let G=0;G<u.uniformBuffersNames.length;G++)this._uniformBuffersNames[u.uniformBuffersNames[G]]=G}this._processFinalCode=u.processFinalCode??null,this._processCodeAfterIncludes=u.processCodeAfterIncludes??void 0,r=u.existingPipelineContext}else this._engine=O,this.defines=null==C?"":C,this._uniformsNames=s.concat(z),this._samplerList=z?z.slice():[],this._attributesNames=G,this._uniformBuffersNamesList=[],this._shaderLanguage=n,this.onError=b,this.onCompiled=g,this._indexParameters=Q,this._fallbacks=x;"WEBGL2"===this._engine.shaderPlatformName&&(r=(0,m.k)(F,this._engine._gl)??r),this._attributeLocationByName={},this.uniqueId=f._UniqueIdSeed++,r?(this._pipelineContext=r,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,V)}async _processShaderCodeAsync(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3?arguments[3]:void 0;T&&await T(),this._processingContext=s||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const z={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:u??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:O.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,m.e)(z,this.name,this._processFinalCode,((u,s)=>{this._vertexSourceCode=u,this._fragmentSourceCode=s,this._prepareEffect(G)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(u){return this._attributes[u]}getAttributeLocationByName(u){return this._attributeLocationByName[u]}getAttributesCount(){return this._attributes.length}getUniformIndex(u){return this._uniformsNames.indexOf(u)}getUniform(u){return this._uniforms[u]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(u){this.isReady()?u(this):(this.onCompileObservable.add((G=>{u(G)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(u){try{if(this._isReadyInternal())return}catch(G){return void this._processCompilationErrors(G,u)}this._isDisposed||setTimeout((()=>{this._checkIsReady(u)}),16)}get vertexSourceCode(){var u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(u=this._pipelineContext)||void 0===u?void 0:u._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(u,G,s,T){this._isReady=!1,this._vertexSourceCodeOverride=u,this._fragmentSourceCodeOverride=G,this.onError=(u,G)=>{T&&T(G)},this.onCompiled=()=>{var u,G;const T=this.getEngine().scenes;if(T)for(let s=0;s<T.length;s++)T[s].markAllMaterialsAsDirty(63);null===(u=(G=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===u||u.call(G,s)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(u){if(this._pipelineContext=u,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let G=0;G<this._attributesNames.length;G++){const u=this._attributesNames[G];this._attributeLocationByName[u]=this._attributes[G]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),f.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=this._pipelineContext;this._isReady=!1;try{const s=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),T=s?null:this.defines,z=s?this._vertexSourceCodeOverride:this._vertexSourceCode,O=s?this._fragmentSourceCodeOverride:this._fragmentSourceCode,f=this._engine;this._pipelineContext=(0,m.h)({existingPipelineContext:u?G:null,vertex:z,fragment:O,context:"WEBGL2"===f.shaderPlatformName?f._gl:void 0,rebuildRebind:(u,G,s,T)=>this._rebuildProgram(u,G,s,T),defines:T,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:s,parallelShaderCompile:f._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:s=>{G&&!u&&this._engine._deletePipelineContext(G),s&&this._onRenderingStateCompiled(s)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(G)}catch(s){this._processCompilationErrors(s,G)}}_getShaderCodeAndErrorLine(u,G,s){const T=s?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let z=null;if(G&&u){const O=G.match(T);if(O&&2===O.length){const G=parseInt(O[1]),T=u.split("\n",-1);T.length>=G&&(z=`Offending line [${G}] in ${s?"fragment":"vertex"} code: ${T[G-1]}`)}}return[u,z]}_processCompilationErrors(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=u.message;const s=this._attributesNames,T=this._fallbacks;if(z.d.Error("Unable to compile effect:"),z.d.Error("Uniforms: "+this._uniformsNames.map((function(u){return" "+u}))),z.d.Error("Attributes: "+s.map((function(u){return" "+u}))),z.d.Error("Defines:\n"+this.defines),f.LogShaderCodeOnCompilationError){var O,m;let u=null,G=null,s=null;var C;if(null!==(O=this._pipelineContext)&&void 0!==O&&O._getVertexShaderCode()&&([s,u]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),s&&(z.d.Error("Vertex code:"),z.d.Error(s))),null!==(m=this._pipelineContext)&&void 0!==m&&m._getFragmentShaderCode())[s,G]=this._getShaderCodeAndErrorLine(null===(C=this._pipelineContext)||void 0===C?void 0:C._getFragmentShaderCode(),this._compilationError,!0),s&&(z.d.Error("Fragment code:"),z.d.Error(s));u&&z.d.Error(u),G&&z.d.Error(G)}z.d.Error("Error: "+this._compilationError);const x=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};G&&(this._pipelineContext=G,this._isReady=!0,x()),T?(this._pipelineContext=null,T.hasMoreFallbacks?(this._allFallbacksProcessed=!1,z.d.Error("Trying next fallback."),this.defines=T.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,x(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,G||x())}get isSupported(){return""===this._compilationError}_bindTexture(u,G){this._engine._bindTexture(this._samplers[u],G,u)}setTexture(u,G){this._engine.setTexture(this._samplers[u],this._uniforms[u],G,u)}setTextureArray(u,G){const s=u+"Ex";if(-1===this._samplerList.indexOf(s+"0")){const T=this._samplerList.indexOf(u);for(let u=1;u<G.length;u++){const G=s+(u-1).toString();this._samplerList.splice(T+u,0,G)}let z=0;for(const u of this._samplerList)this._samplers[u]=z,z+=1}this._engine.setTextureArray(this._samplers[u],this._uniforms[u],G,u)}bindUniformBuffer(u,G){const s=this._uniformBuffersNames[G];void 0===s||f._BaseCache[s]===u&&this._engine._features.useUBOBindingCache||(f._BaseCache[s]=u,this._engine.bindUniformBufferBase(u,s,G))}bindUniformBlock(u,G){this._engine.bindUniformBlock(this._pipelineContext,u,G)}setInt(u,G){return this._pipelineContext.setInt(u,G),this}setInt2(u,G,s){return this._pipelineContext.setInt2(u,G,s),this}setInt3(u,G,s,T){return this._pipelineContext.setInt3(u,G,s,T),this}setInt4(u,G,s,T,z){return this._pipelineContext.setInt4(u,G,s,T,z),this}setIntArray(u,G){return this._pipelineContext.setIntArray(u,G),this}setIntArray2(u,G){return this._pipelineContext.setIntArray2(u,G),this}setIntArray3(u,G){return this._pipelineContext.setIntArray3(u,G),this}setIntArray4(u,G){return this._pipelineContext.setIntArray4(u,G),this}setUInt(u,G){return this._pipelineContext.setUInt(u,G),this}setUInt2(u,G,s){return this._pipelineContext.setUInt2(u,G,s),this}setUInt3(u,G,s,T){return this._pipelineContext.setUInt3(u,G,s,T),this}setUInt4(u,G,s,T,z){return this._pipelineContext.setUInt4(u,G,s,T,z),this}setUIntArray(u,G){return this._pipelineContext.setUIntArray(u,G),this}setUIntArray2(u,G){return this._pipelineContext.setUIntArray2(u,G),this}setUIntArray3(u,G){return this._pipelineContext.setUIntArray3(u,G),this}setUIntArray4(u,G){return this._pipelineContext.setUIntArray4(u,G),this}setFloatArray(u,G){return this._pipelineContext.setArray(u,G),this}setFloatArray2(u,G){return this._pipelineContext.setArray2(u,G),this}setFloatArray3(u,G){return this._pipelineContext.setArray3(u,G),this}setFloatArray4(u,G){return this._pipelineContext.setArray4(u,G),this}setArray(u,G){return this._pipelineContext.setArray(u,G),this}setArray2(u,G){return this._pipelineContext.setArray2(u,G),this}setArray3(u,G){return this._pipelineContext.setArray3(u,G),this}setArray4(u,G){return this._pipelineContext.setArray4(u,G),this}setMatrices(u,G){return this._pipelineContext.setMatrices(u,G),this}setMatrix(u,G){return this._pipelineContext.setMatrix(u,G),this}setMatrix3x3(u,G){return this._pipelineContext.setMatrix3x3(u,G),this}setMatrix2x2(u,G){return this._pipelineContext.setMatrix2x2(u,G),this}setFloat(u,G){return this._pipelineContext.setFloat(u,G),this}setBool(u,G){return this._pipelineContext.setInt(u,G?1:0),this}setVector2(u,G){return this._pipelineContext.setVector2(u,G),this}setFloat2(u,G,s){return this._pipelineContext.setFloat2(u,G,s),this}setVector3(u,G){return this._pipelineContext.setVector3(u,G),this}setFloat3(u,G,s,T){return this._pipelineContext.setFloat3(u,G,s,T),this}setVector4(u,G){return this._pipelineContext.setVector4(u,G),this}setQuaternion(u,G){return this._pipelineContext.setQuaternion(u,G),this}setFloat4(u,G,s,T,z){return this._pipelineContext.setFloat4(u,G,s,T,z),this}setColor3(u,G){return this._pipelineContext.setColor3(u,G),this}setColor4(u,G,s){return this._pipelineContext.setColor4(u,G,s),this}setDirectColor4(u,G){return this._pipelineContext.setDirectColor4(u,G),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,m.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;G&&(O.b.GetShadersStore(T)[`${u}PixelShader`]=G),s&&(O.b.GetShadersStore(T)[`${u}VertexShader`]=s)}static ResetCache(){f._BaseCache={}}}f.LogShaderCodeOnCompilationError=!0,f.AutomaticallyClearCodeCache=!1,f._UniqueIdSeed=0,f._BaseCache={},f.ShadersStore=O.b.ShadersStore,f.IncludesShadersStore=O.b.IncludesShadersStore},11130:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this.Ok=null}unBindMesh(){this.Ok=null}addFallback(u,G){this._defines[u]||(u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u),this._defines[u]=new Array),this._defines[u].push(G)}addCPUSkinningFallback(u,G){this.Ok=G,u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(u,G){if(this.Ok&&this.Ok.computeBonesUsingShaders&&this.Ok.numBoneInfluencers>0){this.Ok.computeBonesUsingShaders=!1,u=u.replace("#define NUM_BONE_INFLUENCERS "+this.Ok.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),G._bonesComputationForcedToCPU=!0;const s=this.Ok.va();for(let u=0;u<s.meshes.length;u++){const T=s.meshes[u];if(T.material){if(T.computeBonesUsingShaders&&0!==T.numBoneInfluencers)if(T.material.getEffect()===G)T.computeBonesUsingShaders=!1;else if(T.xf)for(const u of T.xf){if(u.effect===G){T.computeBonesUsingShaders=!1;break}}}else!this.Ok.material&&T.computeBonesUsingShaders&&T.numBoneInfluencers>0&&(T.computeBonesUsingShaders=!1)}}else{const G=this._defines[this._currentRank];if(G)for(let s=0;s<G.length;s++)u=u.replace("#define "+G[s],"");this._currentRank++}return u}}},11420:(u,G,s)=>{"use strict";s.d(G,{c:()=>x,d:()=>g});var T=s(10961),z=s(11170),O=s(10568),m=s(10650),f=s(11083);s(11429);const C={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class x{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;this._fullscreenViewport=new z.b(0,0,1,1);const s=G.xa??C.xa,O=G.indices??C.indices;this.jd=u,this._vertexBuffers={[T.f.PositionKind]:new T.f(u,s,T.f.PositionKind,!1,!1,2)},this._indexBuffer=u.createIndexBuffer(O),this._onContextRestoredObserver=u.onContextRestoredObservable.add((()=>{this._indexBuffer=u.createIndexBuffer(O);for(const u in this._vertexBuffers){this._vertexBuffers[u]._rebuild()}}))}setViewport(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.jd.setViewport(u)}bindBuffers(u){this.jd.bindBuffers(this._vertexBuffers,this._indexBuffer,u)}applyEffectWrapper(u){this.jd.setState(!0),this.jd.depthCullingState.depthTest=!1,this.jd.stencilState.stencilTest=!1,this.jd.enableEffect(u.drawWrapper),this.bindBuffers(u.effect),u.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.jd.depthCullingState.depthTest,this._savedStateStencilTest=this.jd.stencilState.stencilTest}restoreStates(){this.jd.depthCullingState.depthTest=this._savedStateDepthTest,this.jd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.jd.drawElementsType(0,0,6)}_isRenderTargetTexture(u){return void 0!==u.renderTarget}render(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!u.effect.isReady())return;this.saveStates(),this.setViewport();const s=null===G?null:this._isRenderTargetTexture(G)?G.renderTarget:G;s&&this.jd.bindFramebuffer(s),this.applyEffectWrapper(u),this.draw(),s&&this.jd.unBindFramebuffer(s),this.restoreStates()}dispose(){const u=this._vertexBuffers[T.f.PositionKind];u&&(u.dispose(),delete this._vertexBuffers[T.f.PositionKind]),this._indexBuffer&&this.jd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.jd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class g{static RegisterShaderCodeProcessing(u,G){G?g._CustomShaderCodeProcessing[u??""]=G:delete g._CustomShaderCodeProcessing[u??""]}static _GetShaderCodeProcessing(u){return g._CustomShaderCodeProcessing[u]??g._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(u){this.options.name=u}isReady(){var u;return(null===(u=this._drawWrapper.effect)||void 0===u?void 0:u.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(u){this._drawWrapper.effect=u}constructor(u){this.alphaMode=0,this.onEffectCreatedObservable=new O.e(void 0,!0),this.onApplyObservable=new O.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...u,name:u.name||"effectWrapper",jd:u.jd,uniforms:u.uniforms||u.uniformNames||[],uniformNames:void 0,samplers:u.samplers||u.samplerNames||[],samplerNames:void 0,attributeNames:u.attributeNames||["position"],uniformBuffers:u.uniformBuffers||[],defines:u.defines||"",useShaderStore:u.useShaderStore||!1,vertexUrl:u.vertexUrl||u.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:u.fragmentShader||"pass",indexParameters:u.indexParameters,blockCompilation:u.blockCompilation||!1,shaderLanguage:u.shaderLanguage||0,onCompiled:u.onCompiled||void 0,extraInitializations:u.extraInitializations||void 0,extraInitializationsAsync:u.extraInitializationsAsync||void 0,useAsPostProcess:u.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),u.vertexUrl||u.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.jd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new f.d(this.options.jd),this._webGPUReady=1===this.options.shaderLanguage;const G=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,G,this.options.extraInitializations)}_gatherImports(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(u&&this._webGPUReady?G.push(Promise.all([s.e(37).then(s.bind(s,13140))])):G.push(Promise.all([Promise.resolve().then(s.bind(s,11429))])))}_postConstructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,T&&this._importPromises.push(...T);const z=this.options.jd.isWebGPU&&!g.ForceGLSL;this._gatherImports(z,this._importPromises),void 0!==s&&s(z,this._importPromises),z&&this._webGPUReady&&(this.options.shaderLanguage=1),u||this.updateEffect(G)}updateEffect(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0;const x=g._GetShaderCodeProcessing(this.name);if(null!==x&&void 0!==x&&x.defineCustomBindings){var b,Q;const T=(null===(b=G)||void 0===b?void 0:b.slice())??[];T.push(...this.options.uniforms);const z=(null===(Q=s)||void 0===Q?void 0:Q.slice())??[];z.push(...this.options.samplers),u=x.defineCustomBindings(this.name,u,T,z),G=T,s=z}this.options.defines=u||"";const Y=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let n;n=this.options.extraInitializationsAsync?async()=>{null===Y||void 0===Y||Y(),await this.options.extraInitializationsAsync}:Y,this.options.useShaderStore?this._drawWrapper.effect=this.options.jd.createEffect({vertex:f??this._shaderPath.vertex,fragment:C??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:G||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:s||this.options.samplers,defines:null!==u?u:"",fallbacks:null,onCompiled:z??this.options.onCompiled,onError:O??null,indexParameters:T||this.options.indexParameters,processCodeAfterIncludes:null!==x&&void 0!==x&&x.processCodeAfterIncludes?(u,G)=>x.processCodeAfterIncludes(this.name,u,G):null,processFinalCode:null!==x&&void 0!==x&&x.processFinalCode?(u,G)=>x.processFinalCode(this.name,u,G):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:n},this.options.jd):this._drawWrapper.effect=new m.e(this._shaderPath,this.options.attributeNames,G||this.options.uniforms,s||this.options.samplerNames,this.options.jd,u,void 0,z||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,n),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var u,G;this.options.useAsPostProcess&&(this.options.jd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(u=g._GetShaderCodeProcessing(this.name))||void 0===u||null===(G=u.bindCustomBindings)||void 0===G||G.call(u,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}g.ForceGLSL=!1,g._CustomShaderCodeProcessing={}},10945:(u,G,s)=>{"use strict";s.d(G,{c:()=>O,d:()=>z});var T=s(10939);function z(u,G){G.EXPOSURE&&u.push("exposureLinear"),G.CONTRAST&&u.push("contrast"),G.COLORGRADING&&u.push("colorTransformSettings"),(G.VIGNETTE||G.DITHER)&&u.push("vInverseScreenSize"),G.VIGNETTE&&(u.push("vignetteSettings1"),u.push("vignetteSettings2")),G.COLORCURVES&&(0,T.e)(u),G.DITHER&&u.push("ditherIntensity")}function O(u,G){G.COLORGRADING&&u.push("txColorTransform")}},10927:(u,G,s)=>{"use strict";s.d(G,{b:()=>Y});var T=s(10863),z=s(10866),O=s(10568),m=s(10930),f=s(10935),C=s(10939);class x{constructor(){this._dirty=!0,this._tempColor=new m.e(0,0,0,0),this._globalCurve=new m.e(0,0,0,0),this._highlightsCurve=new m.e(0,0,0,0),this._midtonesCurve=new m.e(0,0,0,0),this._shadowsCurve=new m.e(0,0,0,0),this._positiveCurve=new m.e(0,0,0,0),this._negativeCurve=new m.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(u){this._globalHue=u,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(u){this._globalDensity=u,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(u){this._globalSaturation=u,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(u){this._globalExposure=u,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(u){this._highlightsHue=u,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(u){this._highlightsDensity=u,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(u){this._highlightsSaturation=u,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(u){this._highlightsExposure=u,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(u){this._midtonesHue=u,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(u){this._midtonesDensity=u,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(u){this._midtonesSaturation=u,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(u){this._midtonesExposure=u,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(u){this._shadowsHue=u,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(u){this._shadowsDensity=u,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(u){this._shadowsSaturation=u,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(u){this._shadowsExposure=u,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";u._dirty&&(u._dirty=!1,u._getColorGradingDataToRef(u._globalHue,u._globalDensity,u._globalSaturation,u._globalExposure,u._globalCurve),u._getColorGradingDataToRef(u._highlightsHue,u._highlightsDensity,u._highlightsSaturation,u._highlightsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._highlightsCurve),u._getColorGradingDataToRef(u._midtonesHue,u._midtonesDensity,u._midtonesSaturation,u._midtonesExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._midtonesCurve),u._getColorGradingDataToRef(u._shadowsHue,u._shadowsDensity,u._shadowsSaturation,u._shadowsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._shadowsCurve),u._highlightsCurve.subtractToRef(u._midtonesCurve,u._positiveCurve),u._midtonesCurve.subtractToRef(u._shadowsCurve,u._negativeCurve)),G&&(G.setFloat4(s,u._positiveCurve.r,u._positiveCurve.g,u._positiveCurve.b,u._positiveCurve.a),G.setFloat4(T,u._midtonesCurve.r,u._midtonesCurve.g,u._midtonesCurve.b,u._midtonesCurve.a),G.setFloat4(z,u._negativeCurve.r,u._negativeCurve.g,u._negativeCurve.b,u._negativeCurve.a))}_getColorGradingDataToRef(u,G,s,T,z){null!=u&&(u=x._Clamp(u,0,360),G=x._Clamp(G,-100,100),s=x._Clamp(s,-100,100),T=x._Clamp(T,-100,100),G=x._ApplyColorGradingSliderNonlinear(G),G*=.5,T=x._ApplyColorGradingSliderNonlinear(T),G<0&&(G*=-1,u=(u+180)%360),x._FromHSBToRef(u,G,50+.25*T,z),z.scaleToRef(2,z),z.a=1+.01*s)}static _ApplyColorGradingSliderNonlinear(u){u/=100;let G=Math.abs(u);return G=Math.pow(G,2),u<0&&(G*=-1),G*=100,G}static _FromHSBToRef(u,G,s,T){let z=x._Clamp(u,0,360);const O=x._Clamp(G/100,0,1),m=x._Clamp(s/100,0,1);if(0===O)T.r=m,T.g=m,T.b=m;else{z/=60;const u=Math.floor(z),G=z-u,s=m*(1-O),f=m*(1-O*G),C=m*(1-O*(1-G));switch(u){case 0:T.r=m,T.g=C,T.b=s;break;case 1:T.r=f,T.g=m,T.b=s;break;case 2:T.r=s,T.g=m,T.b=C;break;case 3:T.r=s,T.g=f,T.b=m;break;case 4:T.r=C,T.g=s,T.b=m;break;default:T.r=m,T.g=s,T.b=f}}T.a=1}static _Clamp(u,G,s){return Math.min(Math.max(u,G),s)}clone(){return f.e.Clone((()=>new x),this)}serialize(){return f.e.Serialize(this)}static Parse(u){return f.e.Parse((()=>new x),u,null,null)}}x.PrepareUniforms=C.e,(0,T.b)([(0,z.M)()],x.prototype,"_globalHue",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_globalDensity",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_globalSaturation",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_globalExposure",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_highlightsHue",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_highlightsDensity",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_highlightsSaturation",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_highlightsExposure",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_midtonesHue",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_midtonesDensity",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_midtonesSaturation",void 0),(0,T.b)([(0,z.M)()],x.prototype,"_midtonesExposure",void 0),f.e._ColorCurvesParser=x.Parse;var g=s(10725),b=s(10945),Q=s(10715);class Y{constructor(){this.colorCurves=new x,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=Y.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new m.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=Y.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new O.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(u){this._colorCurvesEnabled!==u&&(this._colorCurvesEnabled=u,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(u){this._colorGradingTexture!==u&&(this._colorGradingTexture=u,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(u){this._colorGradingEnabled!==u&&(this._colorGradingEnabled=u,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(u){this._colorGradingWithGreenDepth!==u&&(this._colorGradingWithGreenDepth=u,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(u){this._colorGradingBGR!==u&&(this._colorGradingBGR=u,this._updateParameters())}get exposure(){return this._exposure}set exposure(u){this._exposure!==u&&(this._exposure=u,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(u){this._toneMappingEnabled!==u&&(this._toneMappingEnabled=u,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(u){this._toneMappingType!==u&&(this._toneMappingType=u,this._updateParameters())}get contrast(){return this._contrast}set contrast(u){this._contrast!==u&&(this._contrast=u,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(u){this.vignetteCenterY=u}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(u){this.vignetteCenterX=u}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(u){this._vignetteBlendMode!==u&&(this._vignetteBlendMode=u,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(u){this._vignetteEnabled!==u&&(this._vignetteEnabled=u,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(u){this._ditheringEnabled!==u&&(this._ditheringEnabled=u,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(u){this._ditheringIntensity!==u&&(this._ditheringIntensity=u,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(u){this._skipFinalColorClamp!==u&&(this._skipFinalColorClamp=u,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(u){this._applyByPostProcess!==u&&(this._applyByPostProcess=u,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(u){this._isEnabled!==u&&(this._isEnabled=u,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(u){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return u.VIGNETTE=!1,u.TONEMAPPING=0,u.CONTRAST=!1,u.EXPOSURE=!1,u.COLORCURVES=!1,u.COLORGRADING=!1,u.COLORGRADING3D=!1,u.DITHER=!1,u.IMAGEPROCESSING=!1,u.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(u.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(u.VIGNETTE=this.vignetteEnabled,u.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===Y._VIGNETTEMODE_MULTIPLY,u.VIGNETTEBLENDMODEOPAQUE=!u.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case Y.TONEMAPPING_KHR_PBR_NEUTRAL:u.TONEMAPPING=3;break;case Y.TONEMAPPING_ACES:u.TONEMAPPING=2;break;default:u.TONEMAPPING=1}else u.TONEMAPPING=0;u.CONTRAST=1!==this.contrast,u.EXPOSURE=1!==this.exposure,u.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,u.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,u.COLORGRADING?u.COLORGRADING3D=this.colorGradingTexture.is3D:u.COLORGRADING3D=!1,u.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,u.SAMPLER3DBGRMAP=this.colorGradingBGR,u.DITHER=this._ditheringEnabled,u.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,u.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,u.IMAGEPROCESSING=u.VIGNETTE||!!u.TONEMAPPING||u.CONTRAST||u.EXPOSURE||u.COLORCURVES||u.COLORGRADING||u.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(u,G){if(this._colorCurvesEnabled&&this.colorCurves&&x.Bind(this.colorCurves,u),this._vignetteEnabled||this._ditheringEnabled){const s=1/u.getEngine().getRenderWidth(),T=1/u.getEngine().getRenderHeight();if(u.setFloat2("vInverseScreenSize",s,T),this._ditheringEnabled&&u.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const z=null!=G?G:T/s;let O=Math.tan(.5*this.vignetteCameraFov),m=O*z;const f=Math.sqrt(m*O);m=(0,g.m)(m,f,this.vignetteStretch),O=(0,g.m)(O,f,this.vignetteStretch),u.setFloat4("vignetteSettings1",m,O,-m*this.vignetteCenterX,-O*this.vignetteCenterY);const C=-2*this.vignetteWeight;u.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,C)}}if(u.setFloat("exposureLinear",this.exposure),u.setFloat("contrast",this.contrast),this.colorGradingTexture){u.setTexture("txColorTransform",this.colorGradingTexture);const G=this.colorGradingTexture.getSize().height;u.setFloat4("colorTransformSettings",(G-1)/G,.5/G,G,this.colorGradingTexture.level)}}clone(){return f.e.Clone((()=>new Y),this)}serialize(){return f.e.Serialize(this)}static Parse(u){const G=f.e.Parse((()=>new Y),u,null,null);return void 0!==u.vignetteCentreX&&(G.vignetteCenterX=u.vignetteCentreX),void 0!==u.vignetteCentreY&&(G.vignetteCenterY=u.vignetteCentreY),G}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}Y.TONEMAPPING_STANDARD=0,Y.TONEMAPPING_ACES=1,Y.TONEMAPPING_KHR_PBR_NEUTRAL=2,Y.PrepareUniforms=b.d,Y.PrepareSamplers=b.c,Y._VIGNETTEMODE_MULTIPLY=0,Y._VIGNETTEMODE_OPAQUE=1,(0,T.b)([(0,z.i)()],Y.prototype,"colorCurves",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_colorCurvesEnabled",void 0),(0,T.b)([(0,z.D)("colorGradingTexture")],Y.prototype,"_colorGradingTexture",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_colorGradingEnabled",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_colorGradingWithGreenDepth",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_colorGradingBGR",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_exposure",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_toneMappingEnabled",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_toneMappingType",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_contrast",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"vignetteStretch",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"vignetteCenterX",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"vignetteCenterY",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"vignetteWeight",void 0),(0,T.b)([(0,z.o)()],Y.prototype,"vignetteColor",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"vignetteCameraFov",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_vignetteBlendMode",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_vignetteEnabled",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_ditheringEnabled",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_ditheringIntensity",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_skipFinalColorClamp",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_applyByPostProcess",void 0),(0,T.b)([(0,z.M)()],Y.prototype,"_isEnabled",void 0),f.e._ImageProcessingConfigurationParser=Y.Parse,(0,Q.g)("BABYLON.ImageProcessingConfiguration",Y)},11132:(u,G,s)=>{"use strict";s.d(G,{d:()=>b});var T=s(10863),z=s(11045),O=s(10866),m=s(11126),f=s(11091),C=s(11138),x=s(11085);class g extends f.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class b extends C.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(u,"DetailMap",140,new g,G),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=z.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,G,s){return!this._isEnabled||!(u._areTexturesDirty&&G.texturesEnabled&&s.getCaps().standardDerivatives&&this._texture&&m.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(u,G){if(this._isEnabled){u.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const s=G.getEngine();u._areTexturesDirty&&(s.getCaps().standardDerivatives&&this._texture&&m.e.DetailTextureEnabled&&this._isEnabled?((0,x.T)(this._texture,u,"DETAIL"),u.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):u.DETAIL=!1)}else u.DETAIL=!1}bindForSubMesh(u,G){if(!this._isEnabled)return;const s=this._material.isFrozen;u.useUbo&&s&&u.isSync||this._texture&&m.e.DetailTextureEnabled&&(u.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,x.n)(this._texture,u,"detail")),G.texturesEnabled&&this._texture&&m.e.DetailTextureEnabled&&u.setTexture("detailSampler",this._texture)}hasTexture(u){return this._texture===u}getActiveTextures(u){this._texture&&u.push(this._texture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture)}dispose(u){var G;u&&(null===(G=this._texture)||void 0===G||G.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(u){u.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,T.b)([(0,O.D)("detailTexture"),(0,O.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"texture",void 0),(0,T.b)([(0,O.M)()],b.prototype,"diffuseBlendLevel",void 0),(0,T.b)([(0,O.M)()],b.prototype,"roughnessBlendLevel",void 0),(0,T.b)([(0,O.M)()],b.prototype,"bumpLevel",void 0),(0,T.b)([(0,O.M)(),(0,O.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"normalBlendMethod",void 0),(0,T.b)([(0,O.M)(),(0,O.d)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"isEnabled",void 0)},11045:(u,G,s)=>{"use strict";s.d(G,{d:()=>F});var T=s(10863),z=s(10866),O=s(10564),m=s(10568),f=s(10619),C=s(11050),x=s(10954),g=s(10584),b=s(11018),Q=s(11083),Y=s(10935);class n{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(u){this._func=u}get funcRef(){return this._funcRef}set funcRef(u){this._funcRef=u}get funcMask(){return this._funcMask}set funcMask(u){this._funcMask=u}get opStencilFail(){return this._opStencilFail}set opStencilFail(u){this._opStencilFail=u}get opDepthFail(){return this._opDepthFail}set opDepthFail(u){this._opDepthFail=u}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(u){this._opStencilDepthPass=u}get mask(){return this._mask}set mask(u){this._mask=u}get enabled(){return this._enabled}set enabled(u){this._enabled=u}getClassName(){return"MaterialStencilState"}copyTo(u){Y.e.Clone((()=>u),this)}serialize(){return Y.e.Serialize(this)}parse(u,G,s){Y.e.Parse((()=>this),u,G,s)}}(0,T.b)([(0,z.M)()],n.prototype,"func",null),(0,T.b)([(0,z.M)()],n.prototype,"funcRef",null),(0,T.b)([(0,z.M)()],n.prototype,"funcMask",null),(0,T.b)([(0,z.M)()],n.prototype,"opStencilFail",null),(0,T.b)([(0,z.M)()],n.prototype,"opDepthFail",null),(0,T.b)([(0,z.M)()],n.prototype,"opStencilDepthPass",null),(0,T.b)([(0,z.M)()],n.prototype,"mask",null),(0,T.b)([(0,z.M)()],n.prototype,"enabled",null);var V=s(11085);class F{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(u){if(this._alpha===u)return;const G=this._alpha;this._alpha=u,1!==G&&1!==u||this.pg(F.MiscDirtyFlag+F.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ig(u){this._backFaceCulling!==u&&(this._backFaceCulling=u,this.pg(F.TextureDirtyFlag))}get Ig(){return this._backFaceCulling}set cullBackFaces(u){this._cullBackFaces!==u&&(this._cullBackFaces=u,this.pg(F.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(u){this._blockDirtyMechanism!==u&&(this._blockDirtyMechanism=u,u||this.Vi())}atomicMaterialsUpdate(u){this.blockDirtyMechanism=!0;try{u(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new m.e),this._onBindObservable}set onBind(u){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(u)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new m.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new m.e),this._onEffectCreatedObservable}set alphaMode(u){this._alphaMode!==u&&(this._alphaMode=u,this.pg(F.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(u){this._needDepthPrePass!==u&&(this._needDepthPrePass=u,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(u){this._fogEnabled!==u&&(this._fogEnabled=u,this.pg(F.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case F.WireFrameFillMode:case F.LineListDrawMode:case F.LineLoopDrawMode:case F.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(u){this.fillMode=u?F.WireFrameFillMode:F.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case F.PointFillMode:case F.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(u){this.fillMode=u?F.PointFillMode:F.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(u){this._fillMode!==u&&(this._fillMode=u,this.pg(F.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(u){const G=this.va().getEngine().getCaps().fragmentDepthSupported;u&&!G&&g.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=u&&G,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(u){this._drawWrapper=u}constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this._i=new m.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new n,this._useUBO=!1,this._fillMode=F.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=u;const z=G||f.d.LastCreatedScene;z&&(this._scene=z,this._dirtyCallbacks={},this._forceGLSL=T,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=u||O.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Q.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new x.c(this._scene.getEngine(),void 0,void 0,u),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),s||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),F.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var u;const G=this.va().getEngine();null===(u=this._uniformBuffer)||void 0===u||u.dispose(),G.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new x.c(G,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new x.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(u){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Vi(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Vi(),this.checkReadyOnlyOnce=!1}isReady(u,G){return!0}isReadyForSubMesh(u,G,s){const T=G.materialDefines;return!!T&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=T,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(u){return null!==this.sideOrientation?this.sideOrientation:u.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(u){this._transparencyMode!==u&&(this._transparencyMode=u,this._forceAlphaTest=u===F.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===F.MATERIAL_OPAQUE||this._transparencyMode===F.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(u){return u.visibility<1||!this._disableAlphaBlending&&(u.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(u){return!this.needAlphaBlendingForMesh(u)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Vi(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=this.va().meshes;for(const s of G)if(s.xf)for(const G of s.xf)if(G.Ha()===this)for(const s of G._drawWrappers)s&&this._materialContext===s.materialContext&&(s._wasPreviouslyReady=!1,s._wasPreviouslyUsingInstances=null,s._forceRebindOnNextCall=u);u&&this.pg(F.AllDirtyFlag)}_preBind(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=this._scene.getEngine(),T=(null==G?this.sideOrientation:G)===F.ClockWiseSideOrientation;return s.enableEffect(u||this._getDrawWrapper()),s.setState(this.Ig,this.zOffset,!1,T,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),T}bind(u,G){}buildUniformLayout(){const u=this._uniformBuffer;this._eventInfo.ubo=u,this._callbackPluginEventGeneric(8,this._eventInfo),u.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(u,G,s){const T=s._drawWrapper;this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),T._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(u){}bindView(u){this._useUBO?this._needToBindSceneUbo=!0:u.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(u){this._useUBO?this._needToBindSceneUbo=!0:(u.setMatrix("viewProjection",this.va().getTransformMatrix()),u.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(u,G){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(u,G)}_afterBind(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&G&&(this._needToBindSceneUbo=!1,(0,V.k)(G,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=u?u.visibility:1,this._onBindObservable&&u&&this._onBindObservable.notifyObservers(u),this.disableDepthWrite){const u=this._scene.getEngine();this._cachedDepthWriteState=u.getDepthWrite(),u.setDepthWrite(!1)}if(this.disableColorWrite){const u=this._scene.getEngine();this._cachedColorWriteState=u.getColorWrite(),u.setColorWrite(!1)}if(0!==this.depthFunction){const u=this._scene.getEngine();this._cachedDepthFunctionState=u.getDepthFunction()||0,u.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(u){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=u,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(u){return null}_clonePlugins(u,G){const s={};if(this._serializePlugins(s),F._ParsePlugins(s,u,this._scene,G),this.pluginManager)for(const T of this.pluginManager._plugins){const G=u.pluginManager.getPlugin(T.name);G&&T.copyTo(G)}}getBindedMeshes(){if(this.meshMap){const u=[];for(const G in this.meshMap){const s=this.meshMap[G];s&&u.push(s)}return u}return this._scene.meshes.filter((u=>u.material===this))}forceCompilation(u,G,s,T){const z={clipPlane:!1,useInstances:!1,...s},O=this.va(),m=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const f=()=>{if(!this._scene||!this._scene.getEngine())return;const s=O.clipPlane;if(z.clipPlane&&(O.clipPlane=new b.d(0,0,0,1)),this._storeEffectOnSubMeshes){let s=!0,O=null;if(u.xf){const G=new C.d(0,0,0,0,0,u,void 0,!1,!1);G.materialDefines&&(G.materialDefines._renderId=-1),this.isReadyForSubMesh(u,G,z.useInstances)||(G.effect&&G.effect.getCompilationError()&&G.effect.allFallbacksProcessed()?O=G.effect.getCompilationError():(s=!1,setTimeout(f,16)))}s&&(this.allowShaderHotSwapping=m,O&&T&&T(O),G&&G(this))}else this.isReady()?(this.allowShaderHotSwapping=m,G&&G(this)):setTimeout(f,16);z.clipPlane&&(O.clipPlane=s)};f()}forceCompilationAsync(u,G){return new Promise(((s,T)=>{this.forceCompilation(u,(()=>{s()}),G,(u=>{T(u)}))}))}pg(u){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(F._DirtyCallbackArray.length=0,u&F.TextureDirtyFlag&&F._DirtyCallbackArray.push(F._TextureDirtyCallBack),u&F.LightDirtyFlag&&F._DirtyCallbackArray.push(F._LightsDirtyCallBack),u&F.FresnelDirtyFlag&&F._DirtyCallbackArray.push(F._FresnelDirtyCallBack),u&F.AttributesDirtyFlag&&F._DirtyCallbackArray.push(F._AttributeDirtyCallBack),u&F.MiscDirtyFlag&&F._DirtyCallbackArray.push(F._MiscDirtyCallBack),u&F.PrePassDirtyFlag&&F._DirtyCallbackArray.push(F._PrePassDirtyCallBack),F._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(F._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const u=this.va().meshes;for(const G of u)if(G.xf)for(const u of G.xf)u.Ha()===this&&u.resetDrawCache()}_markAllSubMeshesAsDirty(u){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const G=this.va().meshes;for(const s of G)if(s.xf)for(const G of s.xf)if(G.Ha(!1)===this)for(const s of G._drawWrappers)s&&s.defines&&s.defines.markAllAsDirty&&this._materialContext===s.materialContext&&u(s.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const u=this.va().enablePrePassRenderer();u&&u.pg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(F._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(F._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(F._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(F._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(F._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(F._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(F._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(F._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(F._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(F._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const u=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this._i.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(u)}))}}setPrePassRenderer(u){return!1}dispose(u,G,s){const T=this.va();if(T.stopAnimation(this),T.freeProcessedMaterials(),T.removeMaterial(this),this._eventInfo.forceDisposeTextures=G,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const u=this._parentContainer.materials.indexOf(this);u>-1&&this._parentContainer.materials.splice(u,1),this._parentContainer=null}if(!0!==s)if(this.meshMap)for(const z in this.meshMap){const G=this.meshMap[z];G&&(G.material=null,this.releaseVertexArrayObject(G,u))}else{const G=T.meshes;for(const s of G)s.material!==this||s.sourceMesh||(s.material=null,this.releaseVertexArrayObject(s,u))}this._uniformBuffer.dispose(),u&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this._i.notifyObservers(this),this._i.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(u,G){const s=u.sj;if(s)if(this._storeEffectOnSubMeshes){if(u.xf)for(const T of u.xf)s._releaseVertexArrayObject(T.effect),G&&T.effect&&T.effect.dispose()}else s._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const u=Y.e.Serialize(this);return u.stencil=this.stencil.serialize(),u.uniqueId=this.uniqueId,this._serializePlugins(u),u}_serializePlugins(u){if(u.plugins={},this.pluginManager)for(const G of this.pluginManager._plugins)u.plugins[G.getClassName()]=G.serialize()}static Parse(u,G,s){if(u.customType){if("BABYLON.PBRMaterial"===u.customType&&u.overloadedAlbedo&&(u.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return g.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else u.customType="BABYLON.StandardMaterial";const T=O.e.Instantiate(u.customType).Parse(u,G,s);return T._loadedUniqueId=u.uniqueId,T}static _ParsePlugins(u,G,s,T){if(u.plugins)for(const f in u.plugins){var z,m;const C=u.plugins[f];let x=null===(z=G.pluginManager)||void 0===z?void 0:z.getPlugin(C.name);if(!x){const u=O.e.Instantiate("BABYLON."+f);u&&(x=new u(G))}null===(m=x)||void 0===m||m.parse(C,s,T)}}}F.TriangleFillMode=0,F.WireFrameFillMode=1,F.PointFillMode=2,F.PointListDrawMode=3,F.LineListDrawMode=4,F.LineLoopDrawMode=5,F.LineStripDrawMode=6,F.TriangleStripDrawMode=7,F.TriangleFanDrawMode=8,F.ClockWiseSideOrientation=0,F.CounterClockWiseSideOrientation=1,F.TextureDirtyFlag=1,F.LightDirtyFlag=2,F.FresnelDirtyFlag=4,F.AttributesDirtyFlag=8,F.MiscDirtyFlag=16,F.PrePassDirtyFlag=32,F.AllDirtyFlag=63,F.MATERIAL_OPAQUE=0,F.MATERIAL_ALPHATEST=1,F.MATERIAL_ALPHABLEND=2,F.MATERIAL_ALPHATESTANDBLEND=3,F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,F.MATERIAL_NORMALBLENDMETHOD_RNM=1,F.OnEventObservable=new m.e,F._AllDirtyCallBack=u=>u.markAllAsDirty(),F._ImageProcessingDirtyCallBack=u=>u.markAsImageProcessingDirty(),F._TextureDirtyCallBack=u=>u.markAsTexturesDirty(),F._FresnelDirtyCallBack=u=>u.markAsFresnelDirty(),F._MiscDirtyCallBack=u=>u.markAsMiscDirty(),F._PrePassDirtyCallBack=u=>u.markAsPrePassDirty(),F._LightsDirtyCallBack=u=>u.markAsLightDirty(),F._AttributeDirtyCallBack=u=>u.markAsAttributesDirty(),F._FresnelAndMiscDirtyCallBack=u=>{F._FresnelDirtyCallBack(u),F._MiscDirtyCallBack(u)},F._TextureAndMiscDirtyCallBack=u=>{F._TextureDirtyCallBack(u),F._MiscDirtyCallBack(u)},F._DirtyCallbackArray=[],F._RunDirtyCallBacks=u=>{for(const G of F._DirtyCallbackArray)G(u)},(0,T.b)([(0,z.M)()],F.prototype,"id",void 0),(0,T.b)([(0,z.M)()],F.prototype,"uniqueId",void 0),(0,T.b)([(0,z.M)()],F.prototype,"name",void 0),(0,T.b)([(0,z.M)()],F.prototype,"metadata",void 0),(0,T.b)([(0,z.M)()],F.prototype,"checkReadyOnEveryCall",void 0),(0,T.b)([(0,z.M)()],F.prototype,"checkReadyOnlyOnce",void 0),(0,T.b)([(0,z.M)()],F.prototype,"state",void 0),(0,T.b)([(0,z.M)("alpha")],F.prototype,"_alpha",void 0),(0,T.b)([(0,z.M)("Ig")],F.prototype,"_backFaceCulling",void 0),(0,T.b)([(0,z.M)("cullBackFaces")],F.prototype,"_cullBackFaces",void 0),(0,T.b)([(0,z.M)()],F.prototype,"sideOrientation",void 0),(0,T.b)([(0,z.M)("alphaMode")],F.prototype,"_alphaMode",void 0),(0,T.b)([(0,z.M)()],F.prototype,"_needDepthPrePass",void 0),(0,T.b)([(0,z.M)()],F.prototype,"disableDepthWrite",void 0),(0,T.b)([(0,z.M)()],F.prototype,"disableColorWrite",void 0),(0,T.b)([(0,z.M)()],F.prototype,"forceDepthWrite",void 0),(0,T.b)([(0,z.M)()],F.prototype,"depthFunction",void 0),(0,T.b)([(0,z.M)()],F.prototype,"separateCullingPass",void 0),(0,T.b)([(0,z.M)("fogEnabled")],F.prototype,"_fogEnabled",void 0),(0,T.b)([(0,z.M)()],F.prototype,"pointSize",void 0),(0,T.b)([(0,z.M)()],F.prototype,"zOffset",void 0),(0,T.b)([(0,z.M)()],F.prototype,"zOffsetUnits",void 0),(0,T.b)([(0,z.M)()],F.prototype,"pointsCloud",null),(0,T.b)([(0,z.M)()],F.prototype,"fillMode",null),(0,T.b)([(0,z.M)()],F.prototype,"useLogarithmicDepth",null),(0,T.b)([(0,z.M)()],F.prototype,"transparencyMode",null)},11091:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{constructor(u){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=u,u)for(const G in u)Object.prototype.hasOwnProperty.call(u,G)&&this._setDefaultValue(G)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||u,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const u of Object.keys(this))"_"!==u[0]&&this._keys.push(u);if(this._externalProperties)for(const u in this._externalProperties)-1===this._keys.indexOf(u)&&this._keys.push(u)}isEqual(u){if(this._keys.length!==u._keys.length)return!1;for(let G=0;G<this._keys.length;G++){const s=this._keys[G];if(this[s]!==u[s])return!1}return!0}cloneTo(u){this._keys.length!==u._keys.length&&(u._keys=this._keys.slice(0));for(let G=0;G<this._keys.length;G++){const s=this._keys[G];u[s]=this[s]}}reset(){this._keys.forEach((u=>this._setDefaultValue(u)))}_setDefaultValue(u){var G,s,T,z;const O=(null===(G=this._externalProperties)||void 0===G||null===(s=G[u])||void 0===s?void 0:s.type)??typeof this[u],m=null===(T=this._externalProperties)||void 0===T||null===(z=T[u])||void 0===z?void 0:z.default;switch(O){case"number":this[u]=m??0;break;case"string":this[u]=m??"";break;default:this[u]=m??!1}}toString(){let u="";for(let G=0;G<this._keys.length;G++){const s=this._keys[G],T=this[s];switch(typeof T){case"number":case"string":u+="#define "+s+" "+T+"\n";break;default:T&&(u+="#define "+s+"\n")}}return u}}},11126:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(10645);class z{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(u){this._DiffuseTextureEnabled!==u&&(this._DiffuseTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(u){this._DetailTextureEnabled!==u&&(this._DetailTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(u){this._DecalMapEnabled!==u&&(this._DecalMapEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(u){this._AmbientTextureEnabled!==u&&(this._AmbientTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(u){this._OpacityTextureEnabled!==u&&(this._OpacityTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(u){this._ReflectionTextureEnabled!==u&&(this._ReflectionTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(u){this._EmissiveTextureEnabled!==u&&(this._EmissiveTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(u){this._SpecularTextureEnabled!==u&&(this._SpecularTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(u){this._BumpTextureEnabled!==u&&(this._BumpTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(u){this._LightmapTextureEnabled!==u&&(this._LightmapTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(u){this._RefractionTextureEnabled!==u&&(this._RefractionTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(u){this._ColorGradingTextureEnabled!==u&&(this._ColorGradingTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(u){this._FresnelEnabled!==u&&(this._FresnelEnabled=u,T.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(u){this._ClearCoatTextureEnabled!==u&&(this._ClearCoatTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(u){this._ClearCoatBumpTextureEnabled!==u&&(this._ClearCoatBumpTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(u){this._ClearCoatTintTextureEnabled!==u&&(this._ClearCoatTintTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(u){this._SheenTextureEnabled!==u&&(this._SheenTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(u){this._AnisotropicTextureEnabled!==u&&(this._AnisotropicTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(u){this._ThicknessTextureEnabled!==u&&(this._ThicknessTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(u){this._RefractionIntensityTextureEnabled!==u&&(this._RefractionIntensityTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(u){this._TranslucencyIntensityTextureEnabled!==u&&(this._TranslucencyIntensityTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(u){this._TranslucencyColorTextureEnabled!==u&&(this._TranslucencyColorTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(u){this._IridescenceTextureEnabled!==u&&(this._IridescenceTextureEnabled=u,T.b.MarkAllMaterialsAsDirty(1))}}z._DiffuseTextureEnabled=!0,z._DetailTextureEnabled=!0,z._DecalMapEnabled=!0,z._AmbientTextureEnabled=!0,z._OpacityTextureEnabled=!0,z._ReflectionTextureEnabled=!0,z._EmissiveTextureEnabled=!0,z._SpecularTextureEnabled=!0,z._BumpTextureEnabled=!0,z._LightmapTextureEnabled=!0,z._RefractionTextureEnabled=!0,z._ColorGradingTextureEnabled=!0,z._FresnelEnabled=!0,z._ClearCoatTextureEnabled=!0,z._ClearCoatBumpTextureEnabled=!0,z._ClearCoatTintTextureEnabled=!0,z._SheenTextureEnabled=!0,z._AnisotropicTextureEnabled=!0,z._ThicknessTextureEnabled=!0,z._RefractionIntensityTextureEnabled=!0,z._TranslucencyIntensityTextureEnabled=!0,z._TranslucencyColorTextureEnabled=!0,z._IridescenceTextureEnabled=!0},11085:(u,G,s)=>{"use strict";s.d(G,{$:()=>R,B:()=>H,F:()=>b,J:()=>W,L:()=>v,P:()=>q,T:()=>V,U:()=>p,V:()=>M,Z:()=>o,bb:()=>D,c:()=>c,d:()=>g,db:()=>Q,h:()=>l,i:()=>x,j:()=>Y,k:()=>n,n:()=>F,r:()=>X,t:()=>r,x:()=>P});var T=s(10584),z=s(10930),O=s(10619),m=s(11030),f=s(11088);const C=z.b.Black();function x(u,G,s){if(!u||u.LOGARITHMICDEPTH||u.indexOf&&u.indexOf("LOGARITHMICDEPTH")>=0){const u=s.activeCamera;1===u.mode&&T.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),G.setFloat("logarithmicDepthConstant",2/(Math.log(u.maxZ+1)/Math.LN2))}}function g(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s&&u.fogEnabled&&(!G||G.applyFog)&&0!==u.fogMode&&(s.setFloat4("vFogInfos",u.fogMode,u.fogStart,u.fogEnd,u.fogDensity),T?(u.fogColor.toLinearSpaceToRef(C,u.getEngine().useExactSrgbConversions),s.setColor3("vFogColor",C)):s.setColor3("vFogColor",u.fogColor))}function b(u,G,s){const z=s.NUM_MORPH_INFLUENCERS;if(z>0&&O.d.LastCreatedEngine){const m=O.d.LastCreatedEngine.getCaps().maxVertexAttribs,f=G.morphTargetManager;if(null!==f&&void 0!==f&&f.isUsingTextureForTargets)return;const C=f&&f.supportsNormals&&s.NORMAL,x=f&&f.supportsTangents&&s.TANGENT,g=f&&f.supportsUVs&&s.UV1;for(let s=0;s<z;s++)u.push("position"+s),C&&u.push("normal"+s),x&&u.push("tangent"+s),g&&u.push("uv_"+s),u.length>m&&T.d.Error("Cannot add more vertex attributes for mesh "+G.name)}}function Q(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.push("world0"),u.push("world1"),u.push("world2"),u.push("world3"),G&&(u.push("previousWorld0"),u.push("previousWorld1"),u.push("previousWorld2"),u.push("previousWorld3"))}function Y(u,G){const s=u.morphTargetManager;u&&s&&G.setFloatArray("morphTargetInfluences",s.influences)}function n(u,G){G.bindToEffect(u,"Scene")}function V(u,G,s){G._needUVs=!0,G[s]=!0,u.optimizeUVAllocation&&u.getTextureMatrix().isIdentityAs3x2()?(G[s+"DIRECTUV"]=u.coordinatesIndex+1,G["MAINUV"+(u.coordinatesIndex+1)]=!0):G[s+"DIRECTUV"]=0}function F(u,G,s){const T=u.getTextureMatrix();G.xj(s+"Matrix",T)}function r(u,G,s){s.BAKED_VERTEX_ANIMATION_TEXTURE&&s.INSTANCES&&u.push("bakedVertexAnimationSettingsInstanced")}function c(u,G,s){var T;if(G&&u&&(u.computeBonesUsingShaders&&G._bonesComputationForcedToCPU&&(u.computeBonesUsingShaders=!1),u.useBones&&u.computeBonesUsingShaders&&u.skeleton)){const z=u.skeleton;if(z.isUsingTextureForMatrices&&G.getUniformIndex("boneTextureWidth")>-1){const s=z.getTransformMatrixTexture(u);G.setTexture("boneSampler",s),G.setFloat("boneTextureWidth",4*(z.bones.length+1))}else{const O=z.getTransformMatrices(u);O&&(G.setMatrices("mBones",O),s&&u.va().prePassRenderer&&u.va().prePassRenderer.getIndex(2)&&(s.previousBones[u.uniqueId]||(s.previousBones[u.uniqueId]=O.slice()),G.setMatrices("mPreviousBones",s.previousBones[u.uniqueId]),T=O,s.previousBones[u.uniqueId].set(T)))}}}function j(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];u._bindLight(G,s,T,z,O)}function l(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const O=Math.min(G.lightSources.length,z);for(let m=0;m<O;m++){j(G.lightSources[m],m,u,s,"boolean"===typeof T?T:T.SPECULARTERM,G.receiveShadows)}}function P(u,G,s,T){s.NUM_BONE_INFLUENCERS>0&&(T.addCPUSkinningFallback(0,G),u.push("matricesIndices"),u.push("matricesWeights"),s.NUM_BONE_INFLUENCERS>4&&(u.push("matricesIndicesExtra"),u.push("matricesWeightsExtra")))}function H(u,G){(G.INSTANCES||G.THIN_INSTANCES)&&Q(u,!!G.PREPASS_VELOCITY),G.INSTANCESCOLOR&&u.push("instanceColor")}function X(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=0;for(let O=0;O<s&&u["LIGHT"+O];O++)O>0&&(z=T+O,G.addFallback(z,"LIGHT"+O)),u.SHADOWS||(u["SHADOW"+O]&&G.addFallback(T,"SHADOW"+O),u["SHADOWPCF"+O]&&G.addFallback(T,"SHADOWPCF"+O),u["SHADOWPCSS"+O]&&G.addFallback(T,"SHADOWPCSS"+O),u["SHADOWPOISSON"+O]&&G.addFallback(T,"SHADOWPOISSON"+O),u["SHADOWESM"+O]&&G.addFallback(T,"SHADOWESM"+O),u["SHADOWCLOSEESM"+O]&&G.addFallback(T,"SHADOWCLOSEESM"+O));return z++}function p(u,G,s,T,z,O,m){let f=arguments.length>7&&void 0!==arguments[7]&&arguments[7];m._areMiscDirty&&(m.LOGARITHMICDEPTH=s,m.POINTSIZE=T,m.FOG=z&&function(u,G){return G.fogEnabled&&u.applyFog&&0!==G.fogMode}(u,G),m.NONUNIFORMSCALING=u.nonUniformScaling,m.ALPHATEST=O,m.DECAL_AFTER_DETAIL=f)}function q(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!s._areLightsDirty)return s._needNormals;let m=0;const f={needNormals:s._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(u.lightsEnabled&&!O)for(const x of G.lightSources)if(d(u,G,x,m,s,T,f),m++,m===z)break;s.SPECULARTERM=f.specularEnabled,s.SHADOWS=f.shadowEnabled;for(let x=m;x<z;x++)void 0!==s["LIGHT"+x]&&(s["LIGHT"+x]=!1,s["HEMILIGHT"+x]=!1,s["POINTLIGHT"+x]=!1,s["DIRLIGHT"+x]=!1,s["SPOTLIGHT"+x]=!1,s["SHADOW"+x]=!1,s["SHADOWCSM"+x]=!1,s["SHADOWCSMDEBUG"+x]=!1,s["SHADOWCSMNUM_CASCADES"+x]=!1,s["SHADOWCSMUSESHADOWMAXZ"+x]=!1,s["SHADOWCSMNOBLEND"+x]=!1,s["SHADOWCSM_RIGHTHANDED"+x]=!1,s["SHADOWPCF"+x]=!1,s["SHADOWPCSS"+x]=!1,s["SHADOWPOISSON"+x]=!1,s["SHADOWESM"+x]=!1,s["SHADOWCLOSEESM"+x]=!1,s["SHADOWCUBE"+x]=!1,s["SHADOWLOWQUALITY"+x]=!1,s["SHADOWMEDIUMQUALITY"+x]=!1);const C=u.getEngine().getCaps();return void 0===s.SHADOWFLOAT&&(f.needRebuild=!0),s.SHADOWFLOAT=f.shadowEnabled&&(C.textureFloatRender&&C.textureFloatLinearFiltering||C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering),s.LIGHTMAPEXCLUDED=f.lightmapMode,f.needRebuild&&s.rebuild(),f.needNormals}function d(u,G,s,T,z,O,f){switch(f.needNormals=!0,void 0===z["LIGHT"+T]&&(f.needRebuild=!0),z["LIGHT"+T]=!0,z["SPOTLIGHT"+T]=!1,z["HEMILIGHT"+T]=!1,z["POINTLIGHT"+T]=!1,z["DIRLIGHT"+T]=!1,s.prepareLightSpecificDefines(z,T),z["LIGHT_FALLOFF_PHYSICAL"+T]=!1,z["LIGHT_FALLOFF_GLTF"+T]=!1,z["LIGHT_FALLOFF_STANDARD"+T]=!1,s.falloffType){case m.d.FALLOFF_GLTF:z["LIGHT_FALLOFF_GLTF"+T]=!0;break;case m.d.FALLOFF_PHYSICAL:z["LIGHT_FALLOFF_PHYSICAL"+T]=!0;break;case m.d.FALLOFF_STANDARD:z["LIGHT_FALLOFF_STANDARD"+T]=!0}if(O&&!s.ah.equalsFloats(0,0,0)&&(f.specularEnabled=!0),z["SHADOW"+T]=!1,z["SHADOWCSM"+T]=!1,z["SHADOWCSMDEBUG"+T]=!1,z["SHADOWCSMNUM_CASCADES"+T]=!1,z["SHADOWCSMUSESHADOWMAXZ"+T]=!1,z["SHADOWCSMNOBLEND"+T]=!1,z["SHADOWCSM_RIGHTHANDED"+T]=!1,z["SHADOWPCF"+T]=!1,z["SHADOWPCSS"+T]=!1,z["SHADOWPOISSON"+T]=!1,z["SHADOWESM"+T]=!1,z["SHADOWCLOSEESM"+T]=!1,z["SHADOWCUBE"+T]=!1,z["SHADOWLOWQUALITY"+T]=!1,z["SHADOWMEDIUMQUALITY"+T]=!1,G&&G.receiveShadows&&u.shadowsEnabled&&s.shadowEnabled){const G=s.getShadowGenerator(u.activeCamera)??s.getShadowGenerator();if(G){const u=G.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(f.shadowEnabled=!0,G.prepareDefines(z,T))}}s.lightmapMode!=m.d.LIGHTMAP_DEFAULT?(f.lightmapMode=!0,z["LIGHTMAPEXCLUDED"+T]=!0,z["LIGHTMAPNOSPECULAR"+T]=s.lightmapMode==m.d.LIGHTMAP_SHADOWSONLY):(z["LIGHTMAPEXCLUDED"+T]=!1,z["LIGHTMAPNOSPECULAR"+T]=!1)}function v(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=function(u,G){let s=!1;if(u.activeCamera){const T=G.CAMERA_ORTHOGRAPHIC?1:0,z=G.CAMERA_PERSPECTIVE?1:0,O=1===u.activeCamera.mode?1:0,m=0===u.activeCamera.mode?1:0;(T^O||z^m)&&(G.CAMERA_ORTHOGRAPHIC=1===O,G.CAMERA_PERSPECTIVE=1===m,s=!0)}return s}(u,T);!1!==O&&(C=(0,f.g)(s,u,T)),T.DEPTHPREPASS!==!G.getColorWrite()&&(T.DEPTHPREPASS=!T.DEPTHPREPASS,C=!0),T.INSTANCES!==z&&(T.INSTANCES=z,C=!0),T.THIN_INSTANCES!==m&&(T.THIN_INSTANCES=m,C=!0),C&&T.markAsUnprocessed()}function W(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!G._areAttributesDirty&&G._needNormals===G._normals&&G._needUVs===G._uvs)return!1;G._normals=G._needNormals,G._uvs=G._needUVs,G.NORMAL=G._needNormals&&u.isVerticesDataPresent("normal"),G._needNormals&&u.isVerticesDataPresent("tangent")&&(G.TANGENT=!0);for(let f=1;f<=6;++f)G["UV"+f]=!!G._needUVs&&u.isVerticesDataPresent(`uv${1===f?"":f}`);if(s){const s=u.useVertexColors&&u.isVerticesDataPresent("color");G.VERTEXCOLOR=s,G.VERTEXALPHA=u.hasVertexAlpha&&s&&O}return u.isVerticesDataPresent("instanceColor")&&(u.hasInstances||u.hasThinInstances)&&(G.INSTANCESCOLOR=!0),T&&function(u,G){if(u.useBones&&u.computeBonesUsingShaders&&u.skeleton){G.NUM_BONE_INFLUENCERS=u.numBoneInfluencers;const s=void 0!==G.BONETEXTURE;if(u.skeleton.isUsingTextureForMatrices&&s)G.BONETEXTURE=!0;else{G.BonesPerMesh=u.skeleton.bones.length+1,G.BONETEXTURE=!s&&void 0;const T=u.va().prePassRenderer;if(T&&T.enabled){const s=-1===T.excludedSkinnedMesh.indexOf(u);G.BONES_VELOCITY_ENABLED=s}}}else G.NUM_BONE_INFLUENCERS=0,G.BonesPerMesh=0,void 0!==G.BONETEXTURE&&(G.BONETEXTURE=!1)}(u,G),z&&function(u,G){const s=u.morphTargetManager;s?(G.MORPHTARGETS_UV=s.supportsUVs&&G.UV1,G.MORPHTARGETS_TANGENT=s.supportsTangents&&G.TANGENT,G.MORPHTARGETS_NORMAL=s.supportsNormals&&G.NORMAL,G.NUM_MORPH_INFLUENCERS=s.numMaxInfluencers||s.numInfluencers,G.MORPHTARGETS=G.NUM_MORPH_INFLUENCERS>0,G.MORPHTARGETS_TEXTURE=s.isUsingTextureForTargets):(G.MORPHTARGETS_UV=!1,G.MORPHTARGETS_TANGENT=!1,G.MORPHTARGETS_NORMAL=!1,G.MORPHTARGETS=!1,G.NUM_MORPH_INFLUENCERS=0)}(u,G),m&&function(u,G){const s=u.bakedVertexAnimationManager;G.BAKED_VERTEX_ANIMATION_TEXTURE=!(!s||!s.isEnabled)}(u,G),!0}function M(u,G){if(u.activeCamera){const s=G.MULTIVIEW;G.MULTIVIEW=null!==u.activeCamera.outputRenderTarget&&u.activeCamera.outputRenderTarget.getViewCount()>1,G.MULTIVIEW!=s&&G.markAsUnprocessed()}}function o(u,G,s){const T=G.ORDER_INDEPENDENT_TRANSPARENCY,z=G.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;G.ORDER_INDEPENDENT_TRANSPARENCY=u.useOrderIndependentTransparency&&s,G.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!u.getEngine().getCaps().textureFloatLinearFiltering,T===G.ORDER_INDEPENDENT_TRANSPARENCY&&z===G.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||G.markAsUnprocessed()}function R(u,G,s){const T=G.PREPASS;if(!G._arePrePassDirty)return;const z=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(u.prePassRenderer&&u.prePassRenderer.enabled&&s){G.PREPASS=!0,G.SCENE_MRT_COUNT=u.prePassRenderer.mrtCount,G.PREPASS_NORMAL_WORLDSPACE=u.prePassRenderer.generateNormalsInWorldSpace,G.PREPASS_COLOR=!0,G.PREPASS_COLOR_INDEX=0;for(let s=0;s<z.length;s++){const T=u.prePassRenderer.getIndex(z[s].type);-1!==T?(G[z[s].define]=!0,G[z[s].index]=T):G[z[s].define]=!1}}else{G.PREPASS=!1;for(let u=0;u<z.length;u++)G[z[u].define]=!1}G.PREPASS!=T&&(G.markAsUnprocessed(),G.markAsImageProcessingDirty())}function B(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];z&&z.push("Light"+u),O||(G.push("vLightData"+u,"vLightDiffuse"+u,"vLightSpecular"+u,"vLightDirection"+u,"vLightFalloff"+u,"vLightGround"+u,"lightMatrix"+u,"shadowsInfo"+u,"depthValues"+u),s.push("shadowTexture"+u),s.push("depthTexture"+u),G.push("viewFrustumZ"+u,"cascadeBlendFactor"+u,"lightSizeUVCorrection"+u,"depthCorrection"+u,"penumbraDarkness"+u,"frustumLengths"+u),T&&(s.push("projectionLightTexture"+u),G.push("textureProjectionMatrix"+u)))}function D(u,G,s){let T,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,O=null;if(u.uniformsNames){const m=u;T=m.uniformsNames,O=m.uniformBuffersNames,G=m.samplers,s=m.defines,z=m.maxSimultaneousLights||0}else T=u,G||(G=[]);for(let m=0;m<z&&s["LIGHT"+m];m++)B(m,T,G,s["PROJECTEDLIGHTTEXTURE"+m],O);s.NUM_MORPH_INFLUENCERS&&(T.push("morphTargetInfluences"),T.push("morphTargetCount")),s.BAKED_VERTEX_ANIMATION_TEXTURE&&(T.push("bakedVertexAnimationSettings"),T.push("bakedVertexAnimationTextureSizeInverted"),T.push("bakedVertexAnimationTime"),G.push("bakedVertexAnimationTexture"))}},11141:(u,G,s)=>{"use strict";s.d(G,{d:()=>O});var T,z=s(10904);!function(u){u[u.Zero=0]="Zero",u[u.One=1]="One",u[u.MaxViewZ=2]="MaxViewZ"}(T||(T={}));class O{static CreateConfiguration(u){return O._Configurations[u]={defines:{},previousWorldMatrices:{},previousViewProjection:z.d.Zero(),currentViewProjection:z.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},O._Configurations[u]}static DeleteConfiguration(u){delete O._Configurations[u]}static GetConfiguration(u){return O._Configurations[u]}static AddUniformsAndSamplers(u,G){u.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(u,G){for(const s of G)if(s.xf)for(const G of s.xf)G._removeDrawWrapper(u)}static PrepareDefines(u,G,s){if(!s._arePrePassDirty)return;const T=O._Configurations[u];if(!T)return;s.PREPASS=!0,s.PREPASS_COLOR=!1,s.PREPASS_COLOR_INDEX=-1;let z=0;for(let m=0;m<O.GeometryTextureDescriptions.length;m++){const u=O.GeometryTextureDescriptions[m],G=u.define,f=u.defineIndex,C=T.defines[f];void 0!==C?(s[G]=!0,s[f]=C,z++):(s[G]=!1,delete s[f])}s.SCENE_MRT_COUNT=z,s.BONES_VELOCITY_ENABLED=G.useBones&&G.computeBonesUsingShaders&&G.skeleton&&!G.skeleton.isUsingTextureForMatrices&&-1===T.excludedSkinnedMesh.indexOf(G)}static Bind(u,G,s,T){const z=O._Configurations[u];if(z&&(void 0!==z.defines.PREPASS_VELOCITY_INDEX||void 0!==z.defines.PREPASS_VELOCITY_LINEAR_INDEX)){z.previousWorldMatrices[s.uniqueId]||(z.previousWorldMatrices[s.uniqueId]=T.clone());const u=s.va();z.previousViewProjection||(z.previousViewProjection=u.getTransformMatrix().clone(),z.currentViewProjection=u.getTransformMatrix().clone());const O=u.getEngine();if(z.currentViewProjection.updateFlag!==u.getTransformMatrix().updateFlag?(z.lastUpdateFrameId=O.frameId,z.previousViewProjection.p(z.currentViewProjection),z.currentViewProjection.p(u.getTransformMatrix())):z.lastUpdateFrameId!==O.frameId&&(z.lastUpdateFrameId=O.frameId,z.previousViewProjection.p(z.currentViewProjection)),G.setMatrix("previousWorld",z.previousWorldMatrices[s.uniqueId]),G.setMatrix("previousViewProjection",z.previousViewProjection),z.previousWorldMatrices[s.uniqueId]=T.clone(),s.useBones&&s.computeBonesUsingShaders&&s.skeleton){const u=s.skeleton;if(!u.isUsingTextureForMatrices||-1===G.getUniformIndex("boneTextureWidth")){const T=u.getTransformMatrices(s);T&&(z.previousBones[s.uniqueId]||(z.previousBones[s.uniqueId]=T.slice()),G.setMatrices("mPreviousBones",z.previousBones[s.uniqueId]),z.previousBones[s.uniqueId].set(T))}}}}}O.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],O._Configurations={}},11138:(u,G,s)=>{"use strict";s.d(G,{b:()=>r});var T=s(10863),z=s(10866),O=s(11045),m=s(10619),f=s(10630),C=s(10655);const x=new RegExp("^([gimus]+)!");class g{constructor(u){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=u,this._scene=u.va(),this._engine=this._scene.getEngine()}_addPlugin(u){for(let T=0;T<this._plugins.length;++T)if(this._plugins[T].name===u.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!u.isCompatible(this._material.shaderLanguage))throw`The plugin "${u.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const G=u.getClassName();g._MaterialPluginClassToMainDefine[G]||(g._MaterialPluginClassToMainDefine[G]="MATERIALPLUGIN_"+ ++g._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(u,G)=>this._handlePluginEvent(u,G),this._plugins.push(u),this._plugins.sort(((u,G)=>u.priority-G.priority)),this._codeInjectionPoints={};const s={};s[g._MaterialPluginClassToMainDefine[G]]={type:"boolean",default:!0};for(const T of this._plugins)T.collectDefines(s),this._collectPointNames("vertex",T.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",T.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=s,!0}_activatePlugin(u){-1===this._activePlugins.indexOf(u)&&(this._activePlugins.push(u),this._activePlugins.sort(((u,G)=>u.priority-G.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),u.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(u),this._activePluginsForExtraEvents.sort(((u,G)=>u.priority-G.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(u){for(let G=0;G<this._plugins.length;++G)if(this._plugins[G].name===u)return this._plugins[G];return null}_handlePluginEventIsReadyForSubMesh(u){let G=!0;for(const s of this._activePlugins)G=G&&s.isReadyForSubMesh(u.defines,this._scene,this._engine,u.subMesh);u.isReadyForSubMesh=G}_handlePluginEventPrepareDefinesBeforeAttributes(u){for(const G of this._activePlugins)G.prepareDefinesBeforeAttributes(u.defines,this._scene,u.mesh)}_handlePluginEventPrepareDefines(u){for(const G of this._activePlugins)G.prepareDefines(u.defines,this._scene,u.mesh)}_handlePluginEventHardBindForSubMesh(u){for(const G of this._activePluginsForExtraEvents)G.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,u.subMesh)}_handlePluginEventBindForSubMesh(u){for(const G of this._activePlugins)G.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,u.subMesh)}_handlePluginEventHasRenderTargetTextures(u){let G=!1;for(const s of this._activePluginsForExtraEvents)if(G=s.hasRenderTargetTextures(),G)break;u.hasRenderTargetTextures=G}_handlePluginEventFillRenderTargetTextures(u){for(const G of this._activePluginsForExtraEvents)G.fillRenderTargetTextures(u.renderTargets)}_handlePluginEvent(u,G){switch(u){case 512:{const u=G;for(const G of this._activePlugins)G.getActiveTextures(u.activeTextures);break}case 256:{const u=G;for(const G of this._activePlugins)G.getAnimatables(u.animatables);break}case 1024:{const u=G;let s=!1;for(const G of this._activePlugins)if(s=G.hasTexture(u.texture),s)break;u.hasTexture=s;break}case 2:{const u=G;for(const G of this._plugins)G.dispose(u.forceDisposeTextures);break}case 4:G.defineNames=this._defineNamesFromPlugins;break;case 128:{const u=G;for(const G of this._activePlugins)u.fallbackRank=G.addFallbacks(u.defines,u.fallbacks,u.fallbackRank),G.getAttributes(u.attributes,this._scene,u.mesh);this._uniformList.length>0&&u.uniforms.push(...this._uniformList),this._samplerList.length>0&&u.samplers.push(...this._samplerList),this._uboList.length>0&&u.uniformBuffersNames.push(...this._uboList),u.customCode=this._injectCustomCode(u,u.customCode);break}case 8:{const u=G;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const s=1===this._material.shaderLanguage;for(const G of this._plugins){const T=G.getUniforms(this._material.shaderLanguage);if(T){if(T.ubo)for(const G of T.ubo){if(G.size&&G.type){const T=G.arraySize??0;if(u.ubo.addUniform(G.name,G.size,T),s){let u;switch(G.type){case"mat4":u="mat4x4f";break;case"float":u="f32";break;default:u=`${G.type}f`}this._uboDeclaration+=`uniform ${G.name}: ${u}${T>0?`[${T}]`:""};\n`}else this._uboDeclaration+=`${G.type} ${G.name}${T>0?`[${T}]`:""};\n`}this._uniformList.push(G.name)}T.vertex&&(this._vertexDeclaration+=T.vertex+"\n"),T.fragment&&(this._fragmentDeclaration+=T.fragment+"\n")}G.getSamplers(this._samplerList),G.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(u,G){if(G)for(const s in G)this._codeInjectionPoints[u]||(this._codeInjectionPoints[u]={}),this._codeInjectionPoints[u][s]=!0}_injectCustomCode(u,G){return(s,T)=>{var z;G&&(T=G(s,T)),this._uboDeclaration&&(T=T.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(T=T.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(T=T.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const O=null===(z=this._codeInjectionPoints)||void 0===z?void 0:z[s];if(!O)return T;let m=null;for(let G in O){let z="";for(const T of this._activePlugins){var g;let O=null===(g=T.getCustomCode(s,this._material.shaderLanguage))||void 0===g?void 0:g[G];if(O){if(T.resolveIncludes){if(null===m){const G=0;m={defines:[],indexParameters:u.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:C.b.GetShadersRepository(G),includesShadersStore:C.b.GetIncludesShadersStore(G),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}m.isFragment="fragment"===s,(0,f.j)(O,m,(u=>O=u))}z+=O+"\n"}}if(z.length>0)if("!"===G.charAt(0)){G=G.substring(1);let u="g";if("!"===G.charAt(0))u="",G=G.substring(1);else{const s=x.exec(G);s&&s.length>=2&&(u=s[1],G=G.substring(u.length+1))}u.indexOf("g")<0&&(u+="g");const s=T,O=new RegExp(G,u);let m=O.exec(s);for(;null!==m;){let u=z;for(let G=0;G<m.length;++G)u=u.replace("$"+G,m[G]);T=T.replace(m[0],u),m=O.exec(s)}}else{const u="#define "+G;T=T.replace(u,"\n"+z+"\n"+u)}}return T}}}g._MaterialPluginClassToMainDefine={},g._MaterialPluginCounter=0,m.d.OnEnginesDisposedObservable.add((()=>{n()}));const b=[];let Q=!1,Y=null;function n(){b.length=0,Q=!1,O.d.OnEventObservable.remove(Y),Y=null}var V=s(10935),F=s(10715);class r{isCompatible(u){return 0===u}_enable(u){u&&this._pluginManager._activatePlugin(this)}constructor(u,G,s,T){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=u,this.name=G,this.priority=s,this.resolveIncludes=m,u.pluginManager||(u.pluginManager=new g(u),u._i.add((()=>{u.pluginManager=void 0}))),this._pluginDefineNames=T,this._pluginManager=u.pluginManager,z&&this._pluginManager._addPlugin(this),O&&this._enable(!0),this.markAllDefinesAsDirty=u._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(u,G,s,T){return!0}hardBindForSubMesh(u,G,s,T){}bindForSubMesh(u,G,s,T){}dispose(u){}getCustomCode(u){return null}collectDefines(u){if(this._pluginDefineNames)for(const G of Object.keys(this._pluginDefineNames)){if("_"===G[0])continue;const s=typeof this._pluginDefineNames[G];u[G]={type:"number"===s?"number":"string"===s?"string":"boolean"===s?"boolean":"object",default:this._pluginDefineNames[G]}}}prepareDefinesBeforeAttributes(u,G,s){}prepareDefines(u,G,s){}hasTexture(u){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(u){}getActiveTextures(u){}getAnimatables(u){}addFallbacks(u,G,s){return s}getSamplers(u){}getAttributes(u,G,s){}getUniformBuffersNames(u){}getUniforms(){return{}}copyTo(u){V.e.Clone((()=>u),this)}serialize(){return V.e.Serialize(this)}parse(u,G,s){V.e.Parse((()=>this),u,G,s)}}(0,T.b)([(0,z.M)()],r.prototype,"name",void 0),(0,T.b)([(0,z.M)()],r.prototype,"priority",void 0),(0,T.b)([(0,z.M)()],r.prototype,"resolveIncludes",void 0),(0,T.b)([(0,z.M)()],r.prototype,"registerForExtraEvents",void 0),(0,F.g)("BABYLON.MaterialPluginBase",r)},11210:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(11045),z=s(10896),O=s(10715);class m extends T.d{get yf(){return this._subMaterials}set yf(u){this._subMaterials=u,this._hookArray(u)}getChildren(){return this.yf}constructor(u,G){super(u,G,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.yf=[],this._storeEffectOnSubMeshes=!0}_hookArray(u){var G=this;const s=u.push;u.push=function(){for(var T=arguments.length,z=new Array(T),O=0;O<T;O++)z[O]=arguments[O];const m=s.apply(u,z);return G._markAllSubMeshesAsTexturesDirty(),m};const T=u.splice;u.splice=(G,s)=>{const z=T.apply(u,[G,s]);return this._markAllSubMeshesAsTexturesDirty(),z}}getSubMaterial(u){return u<0||u>=this.yf.length?this.va().defaultMaterial:this.yf[u]}getActiveTextures(){return super.getActiveTextures().concat(...this.yf.map((u=>u?u.getActiveTextures():[])))}hasTexture(u){if(super.hasTexture(u))return!0;for(let s=0;s<this.yf.length;s++){var G;if(null!==(G=this.yf[s])&&void 0!==G&&G.hasTexture(u))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(u,G,s){for(let T=0;T<this.yf.length;T++){const z=this.yf[T];if(z){if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(u,G,s))return!1;continue}if(!z.isReady(u))return!1}}return!0}clone(u,G){const s=new m(u,this.va());for(let T=0;T<this.yf.length;T++){let z=null;const O=this.yf[T];z=G&&O?O.clone(u+"-"+O.name):this.yf[T],s.yf.push(z)}return s}serialize(){const u={};u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,z.c&&(u.tags=z.c.GetTags(this)),u.materialsUniqueIds=[],u.materials=[];for(let G=0;G<this.yf.length;G++){const s=this.yf[G];s?(u.materialsUniqueIds.push(s.uniqueId),u.materials.push(s.id)):(u.materialsUniqueIds.push(null),u.materials.push(null))}return u}dispose(u,G,s){const T=this.va();if(!T)return;if(s)for(let O=0;O<this.yf.length;O++){const s=this.yf[O];s&&s.dispose(u,G)}const z=T.multiMaterials.indexOf(this);z>=0&&T.multiMaterials.splice(z,1),super.dispose(u,G)}static ParseMultiMaterial(u,G){const s=new m(u.name,G);return s.id=u.id,s._loadedUniqueId=u.uniqueId,z.c&&z.c.AddTagsTo(s,u.tags),u.materialsUniqueIds?s._waitingSubMaterialsUniqueIds=u.materialsUniqueIds:u.materials.forEach((u=>s.yf.push(G.getLastMaterialById(u)))),s}}(0,O.g)("BABYLON.MultiMaterial",m)},11039:(u,G,s)=>{"use strict";s.d(G,{c:()=>T});class T{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(u){u.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(u){}bindForSubMesh(u,G,s,T,z){if(G.prePassRenderer&&G.prePassRenderer.enabled&&G.prePassRenderer.currentRTisSceneRT&&(-1!==G.prePassRenderer.getIndex(2)||-1!==G.prePassRenderer.getIndex(11))){this.previousWorldMatrices[s.uniqueId]||(this.previousWorldMatrices[s.uniqueId]=T.clone()),this.previousViewProjection||(this.previousViewProjection=G.getTransformMatrix().clone(),this.currentViewProjection=G.getTransformMatrix().clone());const z=G.getEngine();this.currentViewProjection.updateFlag!==G.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=z.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(G.getTransformMatrix())):this._lastUpdateFrameId!==z.frameId&&(this._lastUpdateFrameId=z.frameId,this.previousViewProjection.p(this.currentViewProjection)),u.setMatrix("previousWorld",this.previousWorldMatrices[s.uniqueId]),u.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[s.uniqueId]=T.clone()}}}},11098:(u,G,s)=>{"use strict";s.d(G,{c:()=>O});var T=s(10904),z=s(11045);class O extends z.d{constructor(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(u,G,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new T.d,this._storeEffectOnSubMeshes=s}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(u,G){return!!u&&(!this._storeEffectOnSubMeshes||(!u.xf||0===u.xf.length||this.isReadyForSubMesh(u,u.xf[0],G)))}_isReadyForSubMesh(u){const G=u.materialDefines;return!(this.checkReadyOnEveryCall||!u.effect||!G||G._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(u){this._activeEffect.setMatrix("world",u)}bindOnlyNormalMatrix(u){this._activeEffect.setMatrix("normalMatrix",u)}bind(u,G){G&&this.bindForSubMesh(u,G,G.xf[0])}_afterBind(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;super._afterBind(u,G,s),this.va()._cachedEffect=G,s?s._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return s._drawWrapper._forceRebindOnNextCall||u.isCachedMaterialInvalid(this,G,T)}dispose(u,G,s){this._activeEffect=void 0,super.dispose(u,G,s)}}},10861:(u,G,s)=>{"use strict";s.d(G,{c:()=>d});var T=s(10863),z=s(10866),O=s(10881),m=s(10889),f=s(10904),C=s(10930),x=s(10961),g=s(11039),b=s(10927),Q=s(11045),Y=s(11091),n=s(11098),V=s(11102),F=s(10715),r=s(11126),c=s(11130),j=s(11132),l=s(11088),P=s(11085),H=s(10935),X=s(11141);const p={effect:null,subMesh:null};class q extends Y.b{constructor(u){super(u),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(u){const G=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const s of G)this[s]=s===u}}class d extends n.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=u||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(u){this.imageProcessingConfiguration.colorCurvesEnabled=u}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(u){this.imageProcessingConfiguration.colorGradingEnabled=u}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(u){this._imageProcessingConfiguration.toneMappingEnabled=u}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(u){this._imageProcessingConfiguration.exposure=u}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(u){this._imageProcessingConfiguration.contrast=u}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(u){this._imageProcessingConfiguration.colorGradingTexture=u}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(u){this._imageProcessingConfiguration.colorCurves=u}get canRenderToMRT(){return!0}constructor(u,G){super(u,G,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||d.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new C.b(0,0,0),this.diffuseColor=new C.b(1,1,1),this.specularColor=new C.b(1,1,1),this.emissiveColor=new C.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new O.e(16),this._worldViewProjectionMatrix=f.d.Zero(),this._globalAmbientColor=new C.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new j.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new g.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"mb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Q.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.nc&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Q.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.nc||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(u,G){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const z=G._drawWrapper;if(z.effect&&this.isFrozen&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===T)return!0;G.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),G.materialDefines=new q(this._eventInfo.defineNames));const O=this.va(),m=G.materialDefines;if(this._isReadyForSubMesh(G))return!0;const f=O.getEngine();m._needNormals=(0,P.P)(O,u,m,!0,this._maxSimultaneousLights,this._disableLighting),(0,P.V)(O,m);const C=this.needAlphaBlendingForMesh(u)&&this.va().useOrderIndependentTransparency;if((0,P.$)(O,m,this.canRenderToMRT&&!C),(0,P.Z)(O,m,C),X.d.PrepareDefines(f.currentRenderPassId,u,m),m._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,m._needUVs=!1;for(let u=1;u<=6;++u)m["MAINUV"+u]=!1;if(O.texturesEnabled){if(m.DIFFUSEDIRECTUV=0,m.BUMPDIRECTUV=0,m.AMBIENTDIRECTUV=0,m.OPACITYDIRECTUV=0,m.EMISSIVEDIRECTUV=0,m.SPECULARDIRECTUV=0,m.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&d.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._diffuseTexture,m,"DIFFUSE")}else m.DIFFUSE=!1;if(this._ambientTexture&&d.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._ambientTexture,m,"AMBIENT")}else m.AMBIENT=!1;if(this._opacityTexture&&d.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._opacityTexture,m,"OPACITY"),m.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else m.OPACITY=!1;if(this._reflectionTexture&&d.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(m._needNormals=!0,m.REFLECTION=!0,m.ROUGHNESS=this._roughness>0,m.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,m.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===V.b.INVCUBIC_MODE,m.REFLECTIONMAP_3D=this._reflectionTexture.isCube,m.REFLECTIONMAP_OPPOSITEZ=m.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,m.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case V.b.EXPLICIT_MODE:m.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case V.b.PLANAR_MODE:m.setReflectionMode("REFLECTIONMAP_PLANAR");break;case V.b.PROJECTION_MODE:m.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case V.b.SKYBOX_MODE:m.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case V.b.SPHERICAL_MODE:m.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case V.b.EQUIRECTANGULAR_MODE:m.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case V.b.FIXED_EQUIRECTANGULAR_MODE:m.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case V.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:m.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case V.b.CUBIC_MODE:case V.b.INVCUBIC_MODE:default:m.setReflectionMode("REFLECTIONMAP_CUBIC")}m.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else m.REFLECTION=!1,m.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&d.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._emissiveTexture,m,"EMISSIVE")}else m.EMISSIVE=!1;if(this._lightmapTexture&&d.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._lightmapTexture,m,"LIGHTMAP"),m.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,m.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else m.LIGHTMAP=!1;if(this._specularTexture&&d.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,P.T)(this._specularTexture,m,"SPECULAR"),m.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else m.SPECULAR=!1;if(O.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&d.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,P.T)(this._bumpTexture,m,"BUMP"),m.PARALLAX=this._useParallax,m.PARALLAX_RHS=O.useRightHandedSystem,m.PARALLAXOCCLUSION=this._useParallaxOcclusion,m.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else m.BUMP=!1,m.PARALLAX=!1,m.PARALLAX_RHS=!1,m.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&d.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;m._needUVs=!0,m.REFRACTION=!0,m.REFRACTIONMAP_3D=this._refractionTexture.isCube,m.RGBDREFRACTION=this._refractionTexture.isRGBD,m.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else m.REFRACTION=!1;m.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else m.DIFFUSE=!1,m.AMBIENT=!1,m.OPACITY=!1,m.REFLECTION=!1,m.EMISSIVE=!1,m.LIGHTMAP=!1,m.BUMP=!1,m.REFRACTION=!1;m.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),m.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,m.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,m.SPECULAROVERALPHA=this._useSpecularOverAlpha,m.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,m.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,m.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(u)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=m,this._eventInfo.subMesh=G,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(m._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(m),m.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,m.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}m._areFresnelDirty&&(d.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(m.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,m.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,m.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,m.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,m.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,m.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,m._needNormals=!0,m.FRESNEL=!0):m.FRESNEL=!1),(0,P.U)(u,O,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(u)||this._forceAlphaTest,m,this._applyDecalMapAfterDetailMap),(0,P.L)(O,f,this,m,T,null,G.getRenderingMesh().hasThinInstances),this._eventInfo.defines=m,this._eventInfo.mesh=u,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,P.J)(u,m,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let Q=!1;if(m.isDirty){const T=m._areLightsDisposed;m.markAsProcessed();const z=new c.e;m.REFLECTION&&z.addFallback(0,"REFLECTION"),m.SPECULAR&&z.addFallback(0,"SPECULAR"),m.BUMP&&z.addFallback(0,"BUMP"),m.PARALLAX&&z.addFallback(1,"PARALLAX"),m.PARALLAX_RHS&&z.addFallback(1,"PARALLAX_RHS"),m.PARALLAXOCCLUSION&&z.addFallback(0,"PARALLAXOCCLUSION"),m.SPECULAROVERALPHA&&z.addFallback(0,"SPECULAROVERALPHA"),m.FOG&&z.addFallback(1,"FOG"),m.POINTSIZE&&z.addFallback(0,"POINTSIZE"),m.LOGARITHMICDEPTH&&z.addFallback(0,"LOGARITHMICDEPTH"),(0,P.r)(m,z,this._maxSimultaneousLights),m.SPECULARTERM&&z.addFallback(0,"SPECULARTERM"),m.DIFFUSEFRESNEL&&z.addFallback(1,"DIFFUSEFRESNEL"),m.OPACITYFRESNEL&&z.addFallback(2,"OPACITYFRESNEL"),m.REFLECTIONFRESNEL&&z.addFallback(3,"REFLECTIONFRESNEL"),m.EMISSIVEFRESNEL&&z.addFallback(4,"EMISSIVEFRESNEL"),m.FRESNEL&&z.addFallback(4,"FRESNEL"),m.MULTIVIEW&&z.addFallback(0,"MULTIVIEW");const C=[x.f.PositionKind];m.NORMAL&&C.push(x.f.NormalKind),m.TANGENT&&C.push(x.f.TangentKind);for(let u=1;u<=6;++u)m["UV"+u]&&C.push(`uv${1===u?"":u}`);m.VERTEXCOLOR&&C.push(x.f.ColorKind),(0,P.x)(C,u,m,z),(0,P.B)(C,m),(0,P.F)(C,u,m),(0,P.t)(C,u,m);let Y="default";const n=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],V=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],F=["Material","Scene","Mesh"],r={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:m.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=z,this._eventInfo.fallbackRank=0,this._eventInfo.defines=m,this._eventInfo.uniforms=n,this._eventInfo.attributes=C,this._eventInfo.samplers=V,this._eventInfo.uniformBuffersNames=F,this._eventInfo.customCode=void 0,this._eventInfo.mesh=u,this._eventInfo.indexParameters=r,this._callbackPluginEventGeneric(128,this._eventInfo),X.d.AddUniformsAndSamplers(n,V),g.c.AddUniforms(n),g.c.AddSamplers(V),b.b&&(b.b.PrepareUniforms(n,m),b.b.PrepareSamplers(V,m)),(0,P.bb)({uniformsNames:n,uniformBuffersNames:F,samplers:V,defines:m,maxSimultaneousLights:this._maxSimultaneousLights}),(0,l.b)(n);const j={};this.customShaderNameResolve&&(Y=this.customShaderNameResolve(Y,n,F,V,m,C,j));const H=m.toString(),q=G.effect;let d=O.getEngine().createEffect(Y,{attributes:C,uniformsNames:n,uniformBuffersNames:F,samplers:V,defines:H,fallbacks:z,onCompiled:this.onCompiled,onError:this.onError,indexParameters:r,processFinalCode:j.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:m.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([s.e(21),s.e(19)]).then(s.bind(s,12598)),Promise.all([s.e(22),s.e(20)]).then(s.bind(s,12751))]):await Promise.all([Promise.all([s.e(25),s.e(24)]).then(s.bind(s,12839)),Promise.all([s.e(27),s.e(26)]).then(s.bind(s,13002))]),this._shadersLoaded=!0}},f);if(this._eventInfo.customCode=void 0,d)if(this._onEffectCreatedObservable&&(p.effect=d,p.subMesh=G,this._onEffectCreatedObservable.notifyObservers(p)),this.allowShaderHotSwapping&&q&&!d.isReady()){if(d=q,m.markAsUnprocessed(),Q=this.isFrozen,T)return m._areLightsDisposed=!0,!1}else O.resetCachedMaterial(),G.setEffect(d,m,this._materialContext)}return!(!G.effect||!G.effect.isReady())&&(m._renderId=O.getRenderId(),z._wasPreviouslyReady=!Q,z._wasPreviouslyUsingInstances=T,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const u=this._uniformBuffer;u.addUniform("diffuseLeftColor",4),u.addUniform("diffuseRightColor",4),u.addUniform("opacityParts",4),u.addUniform("reflectionLeftColor",4),u.addUniform("reflectionRightColor",4),u.addUniform("refractionLeftColor",4),u.addUniform("refractionRightColor",4),u.addUniform("emissiveLeftColor",4),u.addUniform("emissiveRightColor",4),u.addUniform("vDiffuseInfos",2),u.addUniform("vAmbientInfos",2),u.addUniform("vOpacityInfos",2),u.addUniform("vReflectionInfos",2),u.addUniform("vReflectionPosition",3),u.addUniform("vReflectionSize",3),u.addUniform("vEmissiveInfos",2),u.addUniform("vLightmapInfos",2),u.addUniform("vSpecularInfos",2),u.addUniform("vBumpInfos",3),u.addUniform("diffuseMatrix",16),u.addUniform("ambientMatrix",16),u.addUniform("opacityMatrix",16),u.addUniform("reflectionMatrix",16),u.addUniform("emissiveMatrix",16),u.addUniform("lightmapMatrix",16),u.addUniform("specularMatrix",16),u.addUniform("bumpMatrix",16),u.addUniform("vTangentSpaceParams",2),u.addUniform("pointSize",1),u.addUniform("alphaCutOff",1),u.addUniform("refractionMatrix",16),u.addUniform("vRefractionInfos",4),u.addUniform("vRefractionPosition",3),u.addUniform("vRefractionSize",3),u.addUniform("vSpecularColor",4),u.addUniform("vEmissiveColor",3),u.addUniform("vDiffuseColor",4),u.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(u,G,s){const T=this.va(),z=s.materialDefines;if(!z)return;const O=s.effect;if(!O)return;this._activeEffect=O,G.getMeshUniformBuffer().bindToEffect(O,"Mesh"),G.transferToEffect(u),this._uniformBuffer.bindToEffect(O,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,T,G,u,this.isFrozen),X.d.Bind(T.getEngine().currentRenderPassId,this._activeEffect,G,u),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),z.OBJECTSPACE_NORMALMAP&&(u.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const f=this._mustRebind(T,O,s,G.visibility);(0,P.c)(G,O);const x=this._uniformBuffer;if(f){if(this.bindViewProjection(O),!x.useUbo||!this.isFrozen||!x.isSync||s._drawWrapper._forceRebindOnNextCall){if(d.FresnelEnabled&&z.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(x.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),x.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&x.updateColor4("opacityParts",new C.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(x.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),x.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(x.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),x.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(x.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),x.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),T.texturesEnabled){if(this._diffuseTexture&&d.DiffuseTextureEnabled&&(x.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,P.n)(this._diffuseTexture,x,"diffuse")),this._ambientTexture&&d.AmbientTextureEnabled&&(x.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,P.n)(this._ambientTexture,x,"ambient")),this._opacityTexture&&d.OpacityTextureEnabled&&(x.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,P.n)(this._opacityTexture,x,"opacity")),this._hasAlphaChannel()&&x.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&d.ReflectionTextureEnabled&&(x.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),x.xj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const u=this._reflectionTexture;x.updateVector3("vReflectionPosition",u.boundingBoxPosition),x.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this._emissiveTexture&&d.EmissiveTextureEnabled&&(x.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,P.n)(this._emissiveTexture,x,"emissive")),this._lightmapTexture&&d.LightmapTextureEnabled&&(x.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,P.n)(this._lightmapTexture,x,"lightmap")),this._specularTexture&&d.SpecularTextureEnabled&&(x.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,P.n)(this._specularTexture,x,"specular")),this._bumpTexture&&T.getEngine().getCaps().standardDerivatives&&d.BumpTextureEnabled&&(x.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,P.n)(this._bumpTexture,x,"bump"),T._mirroredCameraPosition?x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&d.RefractionTextureEnabled){let u=1;if(this._refractionTexture.isCube||(x.xj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(u=this._refractionTexture.depth)),x.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,u,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const u=this._refractionTexture;x.updateVector3("vRefractionPosition",u.boundingBoxPosition),x.updateVector3("vRefractionSize",u.boundingBoxSize)}}}this.pointsCloud&&x.updateFloat("pointSize",this.pointSize),x.updateColor4("vSpecularColor",this.specularColor,this.specularPower),x.updateColor3("vEmissiveColor",d.EmissiveTextureEnabled?this.emissiveColor:C.b.BlackReadOnly),x.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),T.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),x.updateColor3("vAmbientColor",this._globalAmbientColor)}T.texturesEnabled&&(this._diffuseTexture&&d.DiffuseTextureEnabled&&O.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&d.AmbientTextureEnabled&&O.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&d.OpacityTextureEnabled&&O.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&d.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?O.setTexture("reflectionCubeSampler",this._reflectionTexture):O.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&d.EmissiveTextureEnabled&&O.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&d.LightmapTextureEnabled&&O.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&d.SpecularTextureEnabled&&O.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&T.getEngine().getCaps().standardDerivatives&&d.BumpTextureEnabled&&O.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&d.RefractionTextureEnabled&&(this._refractionTexture.isCube?O.setTexture("refractionCubeSampler",this._refractionTexture):O.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(G)&&this.va().depthPeelingRenderer.bind(O),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,l.f)(O,this,T),this.bindEyePosition(O)}else T.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(f||!this.isFrozen){var g;if(T.lightsEnabled&&!this._disableLighting&&(0,P.h)(T,G,O,z,this._maxSimultaneousLights),(T.fogEnabled&&G.applyFog&&T.fogMode!==m.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||G.receiveShadows||z.PREPASS)&&this.bindView(O),(0,P.d)(T,G,O),z.NUM_MORPH_INFLUENCERS&&(0,P.j)(G,O),z.BAKED_VERTEX_ANIMATION_TEXTURE)null===(g=G.bakedVertexAnimationManager)||void 0===g||g.bind(O,z.INSTANCES);this.useLogarithmicDepth&&(0,P.i)(z,O,T),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(G,this._activeEffect,s),x.update()}getAnimatables(){const u=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&u.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&u.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&u.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&u.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&u.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&u.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&u.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&u.push(this._refractionTexture),u}getActiveTextures(){const u=super.getActiveTextures();return this._diffuseTexture&&u.push(this._diffuseTexture),this._ambientTexture&&u.push(this._ambientTexture),this._opacityTexture&&u.push(this._opacityTexture),this._reflectionTexture&&u.push(this._reflectionTexture),this._emissiveTexture&&u.push(this._emissiveTexture),this._specularTexture&&u.push(this._specularTexture),this._bumpTexture&&u.push(this._bumpTexture),this._lightmapTexture&&u.push(this._lightmapTexture),this._refractionTexture&&u.push(this._refractionTexture),u}hasTexture(u){return!!super.hasTexture(u)||(this._diffuseTexture===u||(this._ambientTexture===u||(this._opacityTexture===u||(this._reflectionTexture===u||(this._emissiveTexture===u||(this._specularTexture===u||(this._bumpTexture===u||(this._lightmapTexture===u||this._refractionTexture===u))))))))}dispose(u,G){var s,T,z,O,m,f,C,x,g;G&&(null===(s=this._diffuseTexture)||void 0===s||s.dispose(),null===(T=this._ambientTexture)||void 0===T||T.dispose(),null===(z=this._opacityTexture)||void 0===z||z.dispose(),null===(O=this._reflectionTexture)||void 0===O||O.dispose(),null===(m=this._emissiveTexture)||void 0===m||m.dispose(),null===(f=this._specularTexture)||void 0===f||f.dispose(),null===(C=this._bumpTexture)||void 0===C||C.dispose(),null===(x=this._lightmapTexture)||void 0===x||x.dispose(),null===(g=this._refractionTexture)||void 0===g||g.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(u,G)}clone(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const T=H.e.Clone((()=>new d(u,this.va())),this,{cloneTexturesOnlyOnce:G});return T.name=u,T.id=u,this.stencil.copyTo(T.stencil),this._clonePlugins(T,s),T}static Parse(u,G,s){const T=H.e.Parse((()=>new d(u.name,G)),u,G,s);return u.stencil&&T.stencil.parse(u.stencil,G,s),Q.d._ParsePlugins(u,T,G,s),T}static get DiffuseTextureEnabled(){return r.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(u){r.e.DiffuseTextureEnabled=u}static get DetailTextureEnabled(){return r.e.DetailTextureEnabled}static set DetailTextureEnabled(u){r.e.DetailTextureEnabled=u}static get AmbientTextureEnabled(){return r.e.AmbientTextureEnabled}static set AmbientTextureEnabled(u){r.e.AmbientTextureEnabled=u}static get OpacityTextureEnabled(){return r.e.OpacityTextureEnabled}static set OpacityTextureEnabled(u){r.e.OpacityTextureEnabled=u}static get ReflectionTextureEnabled(){return r.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(u){r.e.ReflectionTextureEnabled=u}static get EmissiveTextureEnabled(){return r.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(u){r.e.EmissiveTextureEnabled=u}static get SpecularTextureEnabled(){return r.e.SpecularTextureEnabled}static set SpecularTextureEnabled(u){r.e.SpecularTextureEnabled=u}static get BumpTextureEnabled(){return r.e.BumpTextureEnabled}static set BumpTextureEnabled(u){r.e.BumpTextureEnabled=u}static get LightmapTextureEnabled(){return r.e.LightmapTextureEnabled}static set LightmapTextureEnabled(u){r.e.LightmapTextureEnabled=u}static get RefractionTextureEnabled(){return r.e.RefractionTextureEnabled}static set RefractionTextureEnabled(u){r.e.RefractionTextureEnabled=u}static get ColorGradingTextureEnabled(){return r.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(u){r.e.ColorGradingTextureEnabled=u}static get FresnelEnabled(){return r.e.FresnelEnabled}static set FresnelEnabled(u){r.e.FresnelEnabled=u}}d.ForceGLSL=!1,(0,T.b)([(0,z.D)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"diffuseTexture",void 0),(0,T.b)([(0,z.D)("ambientTexture")],d.prototype,"_ambientTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"ambientTexture",void 0),(0,T.b)([(0,z.D)("opacityTexture")],d.prototype,"_opacityTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"opacityTexture",void 0),(0,T.b)([(0,z.D)("reflectionTexture")],d.prototype,"_reflectionTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectionTexture",void 0),(0,T.b)([(0,z.D)("emissiveTexture")],d.prototype,"_emissiveTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"emissiveTexture",void 0),(0,T.b)([(0,z.D)("specularTexture")],d.prototype,"_specularTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"specularTexture",void 0),(0,T.b)([(0,z.D)("bumpTexture")],d.prototype,"_bumpTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture",void 0),(0,T.b)([(0,z.D)("lightmapTexture")],d.prototype,"_lightmapTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"lightmapTexture",void 0),(0,T.b)([(0,z.D)("refractionTexture")],d.prototype,"_refractionTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"refractionTexture",void 0),(0,T.b)([(0,z.k)("ambient")],d.prototype,"ambientColor",void 0),(0,T.b)([(0,z.k)("diffuse")],d.prototype,"diffuseColor",void 0),(0,T.b)([(0,z.k)("specular")],d.prototype,"specularColor",void 0),(0,T.b)([(0,z.k)("emissive")],d.prototype,"emissiveColor",void 0),(0,T.b)([(0,z.M)()],d.prototype,"specularPower",void 0),(0,T.b)([(0,z.M)("useAlphaFromDiffuseTexture")],d.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"useAlphaFromDiffuseTexture",void 0),(0,T.b)([(0,z.M)("useEmissiveAsIllumination")],d.prototype,"_useEmissiveAsIllumination",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useEmissiveAsIllumination",void 0),(0,T.b)([(0,z.M)("linkEmissiveWithDiffuse")],d.prototype,"_linkEmissiveWithDiffuse",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"linkEmissiveWithDiffuse",void 0),(0,T.b)([(0,z.M)("useSpecularOverAlpha")],d.prototype,"_useSpecularOverAlpha",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useSpecularOverAlpha",void 0),(0,T.b)([(0,z.M)("useReflectionOverAlpha")],d.prototype,"_useReflectionOverAlpha",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useReflectionOverAlpha",void 0),(0,T.b)([(0,z.M)("disableLighting")],d.prototype,"_disableLighting",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),(0,T.b)([(0,z.M)("useObjectSpaceNormalMap")],d.prototype,"_useObjectSpaceNormalMap",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useObjectSpaceNormalMap",void 0),(0,T.b)([(0,z.M)("useParallax")],d.prototype,"_useParallax",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useParallax",void 0),(0,T.b)([(0,z.M)("useParallaxOcclusion")],d.prototype,"_useParallaxOcclusion",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useParallaxOcclusion",void 0),(0,T.b)([(0,z.M)()],d.prototype,"parallaxScaleBias",void 0),(0,T.b)([(0,z.M)("roughness")],d.prototype,"_roughness",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"roughness",void 0),(0,T.b)([(0,z.M)()],d.prototype,"indexOfRefraction",void 0),(0,T.b)([(0,z.M)()],d.prototype,"invertRefractionY",void 0),(0,T.b)([(0,z.M)()],d.prototype,"alphaCutOff",void 0),(0,T.b)([(0,z.M)("useLightmapAsShadowmap")],d.prototype,"_useLightmapAsShadowmap",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useLightmapAsShadowmap",void 0),(0,T.b)([(0,z.p)("diffuseFresnelParameters")],d.prototype,"_diffuseFresnelParameters",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelDirty")],d.prototype,"diffuseFresnelParameters",void 0),(0,T.b)([(0,z.p)("opacityFresnelParameters")],d.prototype,"_opacityFresnelParameters",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],d.prototype,"opacityFresnelParameters",void 0),(0,T.b)([(0,z.p)("reflectionFresnelParameters")],d.prototype,"_reflectionFresnelParameters",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelDirty")],d.prototype,"reflectionFresnelParameters",void 0),(0,T.b)([(0,z.p)("refractionFresnelParameters")],d.prototype,"_refractionFresnelParameters",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelDirty")],d.prototype,"refractionFresnelParameters",void 0),(0,T.b)([(0,z.p)("emissiveFresnelParameters")],d.prototype,"_emissiveFresnelParameters",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelDirty")],d.prototype,"emissiveFresnelParameters",void 0),(0,T.b)([(0,z.M)("useReflectionFresnelFromSpecular")],d.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsFresnelDirty")],d.prototype,"useReflectionFresnelFromSpecular",void 0),(0,T.b)([(0,z.M)("useGlossinessFromSpecularMapAlpha")],d.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,T.b)([(0,z.M)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),(0,T.b)([(0,z.M)("invertNormalMapX")],d.prototype,"_invertNormalMapX",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertNormalMapX",void 0),(0,T.b)([(0,z.M)("invertNormalMapY")],d.prototype,"_invertNormalMapY",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertNormalMapY",void 0),(0,T.b)([(0,z.M)("twoSidedLighting")],d.prototype,"_twoSidedLighting",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"twoSidedLighting",void 0),(0,T.b)([(0,z.M)("applyDecalMapAfterDetailMap")],d.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,T.b)([(0,z.d)("_markAllSubMeshesAsMiscDirty")],d.prototype,"applyDecalMapAfterDetailMap",void 0),(0,F.g)("BABYLON.StandardMaterial",d),m.e.DefaultMaterialFactory=u=>new d("default material",u)},10954:(u,G,s)=>{"use strict";s.d(G,{c:()=>O});var T=s(10584),z=s(10564);class O{constructor(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=u,this._noUBO=!u.supportsUniformBuffers||z,this._dynamic=s,this._name=T??"no-name",this._data=G||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.xj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.xj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(u){let G;if(G=u<=2?u:4,this._uniformLocationPointer%G!==0){const u=this._uniformLocationPointer;this._uniformLocationPointer+=G-this._uniformLocationPointer%G;const s=this._uniformLocationPointer-u;for(let G=0;G<s;G++)this._data.push(0)}}addUniform(u,G){let s,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[u]){if(T>0){if(G instanceof Array)throw"addUniform should not be use with Array in UBO: "+u;if(this._fillAlignment(4),this._uniformArraySizes[u]={strideSize:G,arraySize:T},16==G)G*=T;else{G=G*T+(4-G)*T}s=[];for(let u=0;u<G;u++)s.push(0)}else{if(G instanceof Array)s=G,G=s.length;else{s=[];for(let u=0;u<G;u++)s.push(0)}this._fillAlignment(G)}this._uniformSizes[u]=G,this._uniformLocations[u]=this._uniformLocationPointer,this._uniformLocationPointer+=G;for(let u=0;u<G;u++)this._data.push(s[u]);this._needSync=!0}}addMatrix(u,G){this.addUniform(u,Array.prototype.slice.call(G.$i()))}addFloat2(u,G,s){const T=[G,s];this.addUniform(u,T)}addFloat3(u,G,s,T){const z=[G,s,T];this.addUniform(u,z)}addColor3(u,G){const s=[G.r,G.g,G.b];this.addUniform(u,s)}addColor4(u,G,s){const T=[G.r,G.g,G.b,s];this.addUniform(u,T)}addVector3(u,G){const s=[G.x,G.y,G.z];this.addUniform(u,s)}addMatrix3x3(u){this.addUniform(u,12)}addMatrix2x2(u){this.addUniform(u,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const u=[];let G=0;for(const s in this._uniformLocations)if(u.push(s),10===++G)break;return u.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(u,G){for(let s=0;s<u.length;++s)if(u[s]!==G[s])return!1;return!0}_copyBuffer(u,G){for(let s=0;s<u.length;++s)G[s]=u[s]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(O._UpdatedUbosInFrame[this._name]||(O._UpdatedUbosInFrame[this._name]=0),O._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(u,G,s){this._checkNewFrame();let z=this._uniformLocations[u];if(void 0===z){if(this._buffer)return void T.d.Error("Cannot add an uniform after UBO has been created. uniformName="+u);this.addUniform(u,s),z=this._uniformLocations[u]}if(this._buffer||this.create(),this._dynamic)for(let T=0;T<s;T++)this._bufferData[z+T]=G[T];else{let u=!1;for(let T=0;T<s;T++)(16===s&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[z+T]!==Math.fround(G[T]))&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[z+T]=G[T]);this._needSync=this._needSync||u}}updateUniformArray(u,G,s){this._checkNewFrame();const O=this._uniformLocations[u];if(void 0===O)return void T.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const m=this._uniformArraySizes[u];if(this._dynamic)for(let T=0;T<s;T++)this._bufferData[O+T]=G[T];else{let u=!1,T=0,f=0;for(let C=0;C<s;C++)if(this._bufferData[O+4*f+T]!==z.e.FloatRound(G[C])&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[O+4*f+T]=G[C]),T++,T===m.strideSize){for(;T<4;T++)this._bufferData[O+4*f+T]=0;T=0,f++}this._needSync=this._needSync||u}}_cacheMatrix(u,G){this._checkNewFrame();const s=this._valueCache[u],T=G.updateFlag;return(void 0===s||s!==T)&&(this._valueCache[u]=T,!0)}_updateMatrix3x3ForUniform(u,G){for(let s=0;s<3;s++)O._TempBuffer[4*s]=G[3*s],O._TempBuffer[4*s+1]=G[3*s+1],O._TempBuffer[4*s+2]=G[3*s+2],O._TempBuffer[4*s+3]=0;this.updateUniform(u,O._TempBuffer,12)}_updateMatrix3x3ForEffect(u,G){this._currentEffect.setMatrix3x3(u,G)}_updateMatrix2x2ForEffect(u,G){this._currentEffect.setMatrix2x2(u,G)}_updateMatrix2x2ForUniform(u,G){for(let s=0;s<2;s++)O._TempBuffer[4*s]=G[2*s],O._TempBuffer[4*s+1]=G[2*s+1],O._TempBuffer[4*s+2]=0,O._TempBuffer[4*s+3]=0;this.updateUniform(u,O._TempBuffer,8)}_updateFloatForEffect(u,G){this._currentEffect.setFloat(u,G)}_updateFloatForUniform(u,G){O._TempBuffer[0]=G,this.updateUniform(u,O._TempBuffer,1)}_updateFloat2ForEffect(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(u+T,G,s)}_updateFloat2ForUniform(u,G,s){O._TempBuffer[0]=G,O._TempBuffer[1]=s,this.updateUniform(u,O._TempBuffer,2)}_updateFloat3ForEffect(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(u+z,G,s,T)}_updateFloat3ForUniform(u,G,s,T){O._TempBuffer[0]=G,O._TempBuffer[1]=s,O._TempBuffer[2]=T,this.updateUniform(u,O._TempBuffer,3)}_updateFloat4ForEffect(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(u+O,G,s,T,z)}_updateFloat4ForUniform(u,G,s,T,z){O._TempBuffer[0]=G,O._TempBuffer[1]=s,O._TempBuffer[2]=T,O._TempBuffer[3]=z,this.updateUniform(u,O._TempBuffer,4)}_updateFloatArrayForEffect(u,G){this._currentEffect.setFloatArray(u,G)}_updateFloatArrayForUniform(u,G){this.updateUniformArray(u,G,G.length)}_updateArrayForEffect(u,G){this._currentEffect.setArray(u,G)}_updateArrayForUniform(u,G){this.updateUniformArray(u,G,G.length)}_updateIntArrayForEffect(u,G){this._currentEffect.setIntArray(u,G)}_updateIntArrayForUniform(u,G){O._TempBufferInt32View.set(G),this.updateUniformArray(u,O._TempBuffer,G.length)}_updateUIntArrayForEffect(u,G){this._currentEffect.setUIntArray(u,G)}_updateUIntArrayForUniform(u,G){O._TempBufferUInt32View.set(G),this.updateUniformArray(u,O._TempBuffer,G.length)}_updateMatrixForEffect(u,G){this._currentEffect.setMatrix(u,G)}_updateMatrixForUniform(u,G){this._cacheMatrix(u,G)&&this.updateUniform(u,G.$i(),16)}_updateMatricesForEffect(u,G){this._currentEffect.setMatrices(u,G)}_updateMatricesForUniform(u,G){this.updateUniform(u,G,G.length)}_updateVector3ForEffect(u,G){this._currentEffect.setVector3(u,G)}_updateVector3ForUniform(u,G){O._TempBuffer[0]=G.x,O._TempBuffer[1]=G.y,O._TempBuffer[2]=G.z,this.updateUniform(u,O._TempBuffer,3)}_updateVector4ForEffect(u,G){this._currentEffect.setVector4(u,G)}_updateVector4ForUniform(u,G){O._TempBuffer[0]=G.x,O._TempBuffer[1]=G.y,O._TempBuffer[2]=G.z,O._TempBuffer[3]=G.w,this.updateUniform(u,O._TempBuffer,4)}_updateColor3ForEffect(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(u+s,G)}_updateColor3ForUniform(u,G){O._TempBuffer[0]=G.r,O._TempBuffer[1]=G.g,O._TempBuffer[2]=G.b,this.updateUniform(u,O._TempBuffer,3)}_updateColor4ForEffect(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(u+T,G,s)}_updateDirectColor4ForEffect(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(u+s,G)}_updateColor4ForUniform(u,G,s){O._TempBuffer[0]=G.r,O._TempBuffer[1]=G.g,O._TempBuffer[2]=G.b,O._TempBuffer[3]=s,this.updateUniform(u,O._TempBuffer,4)}_updateDirectColor4ForUniform(u,G){O._TempBuffer[0]=G.r,O._TempBuffer[1]=G.g,O._TempBuffer[2]=G.b,O._TempBuffer[3]=G.a,this.updateUniform(u,O._TempBuffer,4)}_updateIntForEffect(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(u+s,G)}_updateIntForUniform(u,G){O._TempBufferInt32View[0]=G,this.updateUniform(u,O._TempBuffer,1)}_updateInt2ForEffect(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(u+T,G,s)}_updateInt2ForUniform(u,G,s){O._TempBufferInt32View[0]=G,O._TempBufferInt32View[1]=s,this.updateUniform(u,O._TempBuffer,2)}_updateInt3ForEffect(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(u+z,G,s,T)}_updateInt3ForUniform(u,G,s,T){O._TempBufferInt32View[0]=G,O._TempBufferInt32View[1]=s,O._TempBufferInt32View[2]=T,this.updateUniform(u,O._TempBuffer,3)}_updateInt4ForEffect(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(u+O,G,s,T,z)}_updateInt4ForUniform(u,G,s,T,z){O._TempBufferInt32View[0]=G,O._TempBufferInt32View[1]=s,O._TempBufferInt32View[2]=T,O._TempBufferInt32View[3]=z,this.updateUniform(u,O._TempBuffer,4)}_updateUIntForEffect(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(u+s,G)}_updateUIntForUniform(u,G){O._TempBufferUInt32View[0]=G,this.updateUniform(u,O._TempBuffer,1)}_updateUInt2ForEffect(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(u+T,G,s)}_updateUInt2ForUniform(u,G,s){O._TempBufferUInt32View[0]=G,O._TempBufferUInt32View[1]=s,this.updateUniform(u,O._TempBuffer,2)}_updateUInt3ForEffect(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(u+z,G,s,T)}_updateUInt3ForUniform(u,G,s,T){O._TempBufferUInt32View[0]=G,O._TempBufferUInt32View[1]=s,O._TempBufferUInt32View[2]=T,this.updateUniform(u,O._TempBuffer,3)}_updateUInt4ForEffect(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(u+O,G,s,T,z)}_updateUInt4ForUniform(u,G,s,T,z){O._TempBufferUInt32View[0]=G,O._TempBufferUInt32View[1]=s,O._TempBufferUInt32View[2]=T,O._TempBufferUInt32View[3]=z,this.updateUniform(u,O._TempBuffer,4)}setTexture(u,G){this._currentEffect.setTexture(u,G)}setTextureArray(u,G){this._currentEffect.setTextureArray(u,G)}bindTexture(u,G){this._currentEffect._bindTexture(u,G)}updateUniformDirectly(u,G){this.updateUniform(u,G,G.length),this.update()}bindToEffect(u,G){this._currentEffect=u,this._currentEffectName=G}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(u){if(!this._buffers)return this._buffer===u;for(let G=0;G<this._buffers.length;++G){if(this._buffers[G][0]===u)return this._bufferIndex=G,this._buffer=u,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const u=this._engine._uniformBuffers,G=u.indexOf(this);if(-1!==G&&(u[G]=u[u.length-1],u.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let s=0;s<this._buffers.length;++s){const u=this._buffers[s][0];this._engine._releaseBuffer(u)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}O._UpdatedUbosInFrame={},O._MAX_UNIFORM_SIZE=256,O._TempBuffer=new Float32Array(O._MAX_UNIFORM_SIZE),O._TempBufferInt32View=new Int32Array(O._TempBuffer.buffer),O._TempBufferUInt32View=new Uint32Array(O._TempBuffer.buffer)},11201:(u,G,s)=>{"use strict";s.d(G,{e:()=>m,f:()=>T});var T,z,O=s(10904);!function(u){u[u.LOCAL=0]="LOCAL",u[u.WORLD=1]="WORLD",u[u.BONE=2]="BONE"}(T||(T={}));class m{}m.X=new O.q(1,0,0),m.Y=new O.q(0,1,0),m.Z=new O.q(0,0,1),function(u){u[u.X=0]="X",u[u.Y=1]="Y",u[u.Z=2]="Z"}(z||(z={}))},10930:(u,G,s)=>{"use strict";s.d(G,{b:()=>b,e:()=>Q,f:()=>Y});var T=s(10918),z=s(10715),O=s(10913),m=s(10924);function f(u){return Math.pow(u,O.l)}function C(u){return u<=.04045?.0773993808*u:Math.pow(.947867299*(u+.055),2.4)}function x(u){return Math.pow(u,O.j)}function g(u){return u<=.0031308?12.92*u:1.055*Math.pow(u,.41666)-.055}class b{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=u,this.g=G,this.b=s}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"hb"}getHashCode(){let u=255*this.r|0;return u=397*u^255*this.g,u=397*u^255*this.b,u}toArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[G]=this.r,u[G+1]=this.g,u[G+2]=this.b,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(u,G,this),this}toColor4(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Q(this.r,this.g,this.b,u)}$i(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(u){return new b(this.r*u.r,this.g*u.g,this.b*u.b)}multiplyToRef(u,G){return G.r=this.r*u.r,G.g=this.g*u.g,G.b=this.b*u.b,G}multiplyInPlace(u){return this.r*=u.r,this.g*=u.g,this.b*=u.b,this}multiplyByFloats(u,G,s){return new b(this.r*u,this.g*G,this.b*s)}divide(u){throw new ReferenceError("Can not divide a color")}divideToRef(u,G){throw new ReferenceError("Can not divide a color")}divideInPlace(u){throw new ReferenceError("Can not divide a color")}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u.r,u.g,u.b)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u.r,u.g,u.b)}minimizeInPlaceFromFloats(u,G,s){return this.r=Math.min(u,this.r),this.g=Math.min(G,this.g),this.b=Math.min(s,this.b),this}maximizeInPlaceFromFloats(u,G,s){return this.r=Math.max(u,this.r),this.g=Math.max(G,this.g),this.b=Math.max(s,this.b),this}floorToRef(u){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(u){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b}equalsFloats(u,G,s){return this.equalsToFloats(u,G,s)}equalsToFloats(u,G,s){return this.r===u&&this.g===G&&this.b===s}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.e;return(0,m.s)(this.r,u.r,G)&&(0,m.s)(this.g,u.g,G)&&(0,m.s)(this.b,u.b,G)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(u){throw new ReferenceError("Can not negate a color")}scale(u){return new b(this.r*u,this.g*u,this.b*u)}scaleInPlace(u){return this.r*=u,this.g*=u,this.b*=u,this}scaleToRef(u,G){return G.r=this.r*u,G.g=this.g*u,G.b=this.b*u,G}scaleAndAddToRef(u,G){return G.r+=this.r*u,G.g+=this.g*u,G.b+=this.b*u,G}clampToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;return s.r=(0,m.b)(this.r,u,G),s.g=(0,m.b)(this.g,u,G),s.b=(0,m.b)(this.b,u,G),s}add(u){return new b(this.r+u.r,this.g+u.g,this.b+u.b)}addInPlace(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this}addInPlaceFromFloats(u,G,s){return this.r+=u,this.g+=G,this.b+=s,this}addToRef(u,G){return G.r=this.r+u.r,G.g=this.g+u.g,G.b=this.b+u.b,G}Nc(u){return new b(this.r-u.r,this.g-u.g,this.b-u.b)}subtractToRef(u,G){return G.r=this.r-u.r,G.g=this.g-u.g,G.b=this.b-u.b,G}fi(u){return this.r-=u.r,this.g-=u.g,this.b-=u.b,this}subtractFromFloats(u,G,s){return new b(this.r-u,this.g-G,this.b-s)}subtractFromFloatsToRef(u,G,s,T){return T.r=this.r-u,T.g=this.g-G,T.b=this.b-s,T}clone(){return new b(this.r,this.g,this.b)}p(u){return this.r=u.r,this.g=u.g,this.b=u.b,this}hf(u,G,s){return this.r=u,this.g=G,this.b=s,this}set(u,G,s){return this.hf(u,G,s)}vj(u){return this.r=this.g=this.b=u,this}toHexString(){const u=Math.round(255*this.r),G=Math.round(255*this.g),s=Math.round(255*this.b);return"#"+(0,m.r)(u)+(0,m.r)(G)+(0,m.r)(s)}fromHexString(u){return"#"!==u.substring(0,1)||7!==u.length||(this.r=parseInt(u.substring(1,3),16)/255,this.g=parseInt(u.substring(3,5),16)/255,this.b=parseInt(u.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new b)}toHSVToRef(u){const G=this.r,s=this.g,T=this.b,z=Math.max(G,s,T),O=Math.min(G,s,T);let m=0,f=0;const C=z,x=z-O;return 0!==z&&(f=x/z),z!=O&&(z==G?(m=(s-T)/x,s<T&&(m+=6)):z==s?m=(T-G)/x+2:z==T&&(m=(G-s)/x+4),m*=60),u.r=m,u.g=f,u.b=C,u}toLinearSpace(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=new b;return this.toLinearSpaceToRef(G,u),G}toLinearSpaceToRef(u){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(u.r=C(this.r),u.g=C(this.g),u.b=C(this.b)):(u.r=f(this.r),u.g=f(this.g),u.b=f(this.b)),this}toGammaSpace(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=new b;return this.toGammaSpaceToRef(G,u),G}toGammaSpaceToRef(u){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(u.r=g(this.r),u.g=g(this.g),u.b=g(this.b)):(u.r=x(this.r),u.g=x(this.g),u.b=x(this.b)),this}static HSVtoRGBToRef(u,G,s,T){const z=s*G,O=u/60,m=z*(1-Math.abs(O%2-1));let f=0,C=0,x=0;O>=0&&O<=1?(f=z,C=m):O>=1&&O<=2?(f=m,C=z):O>=2&&O<=3?(C=z,x=m):O>=3&&O<=4?(C=m,x=z):O>=4&&O<=5?(f=m,x=z):O>=5&&O<=6&&(f=z,x=m);const g=s-z;return T.r=f+g,T.g=C+g,T.b=x+g,T}static FromHSV(u,G,s){const T=new b(0,0,0);return b.HSVtoRGBToRef(u,G,s,T),T}static FromHexString(u){return new b(0,0,0).fromHexString(u)}static Ag(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new b(u[G],u[G+1],u[G+2])}static FromArrayToRef(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;s.r=u[G],s.g=u[G+1],s.b=u[G+2]}static FromInts(u,G,s){return new b(u/255,G/255,s/255)}static Lerp(u,G,s){const T=new b(0,0,0);return b.LerpToRef(u,G,s,T),T}static LerpToRef(u,G,s,T){T.r=u.r+(G.r-u.r)*s,T.g=u.g+(G.g-u.g)*s,T.b=u.b+(G.b-u.b)*s}static Hermite(u,G,s,T,z){const O=z*z,m=z*O,f=2*m-3*O+1,C=-2*m+3*O,x=m-2*O+z,g=m-O,Q=u.r*f+s.r*C+G.r*x+T.r*g,Y=u.g*f+s.g*C+G.g*x+T.g*g,n=u.b*f+s.b*C+G.b*x+T.b*g;return new b(Q,Y,n)}static Hermite1stDerivative(u,G,s,T,z){const O=b.Black();return this.Hermite1stDerivativeToRef(u,G,s,T,z,O),O}static Hermite1stDerivativeToRef(u,G,s,T,z,O){const m=z*z;O.r=6*(m-z)*u.r+(3*m-4*z+1)*G.r+6*(-m+z)*s.r+(3*m-2*z)*T.r,O.g=6*(m-z)*u.g+(3*m-4*z+1)*G.g+6*(-m+z)*s.g+(3*m-2*z)*T.g,O.b=6*(m-z)*u.b+(3*m-4*z+1)*G.b+6*(-m+z)*s.b+(3*m-2*z)*T.b}static Red(){return new b(1,0,0)}static Green(){return new b(0,1,0)}static Blue(){return new b(0,0,1)}static Black(){return new b(0,0,0)}static get BlackReadOnly(){return b._BlackReadOnly}static White(){return new b(1,1,1)}static Purple(){return new b(.5,0,.5)}static Magenta(){return new b(1,0,1)}static Yellow(){return new b(1,1,0)}static Gray(){return new b(.5,.5,.5)}static Teal(){return new b(0,1,1)}static Random(){return new b(Math.random(),Math.random(),Math.random())}}b._BlackReadOnly=b.Black(),Object.defineProperties(b.prototype,{dimension:{value:[3]},rank:{value:1}});class Q{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=u,this.g=G,this.b=s,this.a=T}$i(){return[this.r,this.g,this.b,this.a]}toArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[G]=this.r,u[G+1]=this.g,u[G+2]=this.b,u[G+3]=this.a,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=u[G],this.g=u[G+1],this.b=u[G+2],this.a=u[G+3],this}equals(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b&&this.a===u.a}add(u){return new Q(this.r+u.r,this.g+u.g,this.b+u.b,this.a+u.a)}addToRef(u,G){return G.r=this.r+u.r,G.g=this.g+u.g,G.b=this.b+u.b,G.a=this.a+u.a,G}addInPlace(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this.a+=u.a,this}addInPlaceFromFloats(u,G,s,T){return this.r+=u,this.g+=G,this.b+=s,this.a+=T,this}Nc(u){return new Q(this.r-u.r,this.g-u.g,this.b-u.b,this.a-u.a)}subtractToRef(u,G){return G.r=this.r-u.r,G.g=this.g-u.g,G.b=this.b-u.b,G.a=this.a-u.a,G}fi(u){return this.r-=u.r,this.g-=u.g,this.b-=u.b,this.a-=u.a,this}subtractFromFloats(u,G,s,T){return new Q(this.r-u,this.g-G,this.b-s,this.a-T)}subtractFromFloatsToRef(u,G,s,T,z){return z.r=this.r-u,z.g=this.g-G,z.b=this.b-s,z.a=this.a-T,z}scale(u){return new Q(this.r*u,this.g*u,this.b*u,this.a*u)}scaleInPlace(u){return this.r*=u,this.g*=u,this.b*=u,this.a*=u,this}scaleToRef(u,G){return G.r=this.r*u,G.g=this.g*u,G.b=this.b*u,G.a=this.a*u,G}scaleAndAddToRef(u,G){return G.r+=this.r*u,G.g+=this.g*u,G.b+=this.b*u,G.a+=this.a*u,G}clampToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;return s.r=(0,m.b)(this.r,u,G),s.g=(0,m.b)(this.g,u,G),s.b=(0,m.b)(this.b,u,G),s.a=(0,m.b)(this.a,u,G),s}multiply(u){return new Q(this.r*u.r,this.g*u.g,this.b*u.b,this.a*u.a)}multiplyToRef(u,G){return G.r=this.r*u.r,G.g=this.g*u.g,G.b=this.b*u.b,G.a=this.a*u.a,G}multiplyInPlace(u){return this.r*=u.r,this.g*=u.g,this.b*=u.b,this.a*=u.a,this}multiplyByFloats(u,G,s,T){return new Q(this.r*u,this.g*G,this.b*s,this.a*T)}divide(u){throw new ReferenceError("Can not divide a color")}divideToRef(u,G){throw new ReferenceError("Can not divide a color")}divideInPlace(u){throw new ReferenceError("Can not divide a color")}minimizeInPlace(u){return this.r=Math.min(this.r,u.r),this.g=Math.min(this.g,u.g),this.b=Math.min(this.b,u.b),this.a=Math.min(this.a,u.a),this}maximizeInPlace(u){return this.r=Math.max(this.r,u.r),this.g=Math.max(this.g,u.g),this.b=Math.max(this.b,u.b),this.a=Math.max(this.a,u.a),this}minimizeInPlaceFromFloats(u,G,s,T){return this.r=Math.min(u,this.r),this.g=Math.min(G,this.g),this.b=Math.min(s,this.b),this.a=Math.min(T,this.a),this}maximizeInPlaceFromFloats(u,G,s,T){return this.r=Math.max(u,this.r),this.g=Math.max(G,this.g),this.b=Math.max(s,this.b),this.a=Math.max(T,this.a),this}floorToRef(u){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(u){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(u){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.e;return(0,m.s)(this.r,u.r,G)&&(0,m.s)(this.g,u.g,G)&&(0,m.s)(this.b,u.b,G)&&(0,m.s)(this.a,u.a,G)}equalsToFloats(u,G,s,T){return this.r===u&&this.g===G&&this.b===s&&this.a===T}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let u=255*this.r|0;return u=397*u^255*this.g,u=397*u^255*this.b,u=397*u^255*this.a,u}clone(){return(new Q).p(this)}p(u){return this.r=u.r,this.g=u.g,this.b=u.b,this.a=u.a,this}hf(u,G,s,T){return this.r=u,this.g=G,this.b=s,this.a=T,this}set(u,G,s,T){return this.hf(u,G,s,T)}vj(u){return this.r=this.g=this.b=this.a=u,this}toHexString(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=Math.round(255*this.r),s=Math.round(255*this.g),T=Math.round(255*this.b);if(u)return"#"+(0,m.r)(G)+(0,m.r)(s)+(0,m.r)(T);const z=Math.round(255*this.a);return"#"+(0,m.r)(G)+(0,m.r)(s)+(0,m.r)(T)+(0,m.r)(z)}fromHexString(u){return"#"!==u.substring(0,1)||9!==u.length&&7!==u.length||(this.r=parseInt(u.substring(1,3),16)/255,this.g=parseInt(u.substring(3,5),16)/255,this.b=parseInt(u.substring(5,7),16)/255,9===u.length&&(this.a=parseInt(u.substring(7,9),16)/255)),this}toLinearSpace(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=new Q;return this.toLinearSpaceToRef(G,u),G}toLinearSpaceToRef(u){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(u.r=C(this.r),u.g=C(this.g),u.b=C(this.b)):(u.r=f(this.r),u.g=f(this.g),u.b=f(this.b)),u.a=this.a,this}toGammaSpace(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=new Q;return this.toGammaSpaceToRef(G,u),G}toGammaSpaceToRef(u){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(u.r=g(this.r),u.g=g(this.g),u.b=g(this.b)):(u.r=x(this.r),u.g=x(this.g),u.b=x(this.b)),u.a=this.a,this}static FromHexString(u){return"#"!==u.substring(0,1)||9!==u.length&&7!==u.length?new Q(0,0,0,0):new Q(0,0,0,1).fromHexString(u)}static Lerp(u,G,s){return Q.LerpToRef(u,G,s,new Q)}static LerpToRef(u,G,s,T){return T.r=u.r+(G.r-u.r)*s,T.g=u.g+(G.g-u.g)*s,T.b=u.b+(G.b-u.b)*s,T.a=u.a+(G.a-u.a)*s,T}static Hermite(u,G,s,T,z){const O=z*z,m=z*O,f=2*m-3*O+1,C=-2*m+3*O,x=m-2*O+z,g=m-O,b=u.r*f+s.r*C+G.r*x+T.r*g,Y=u.g*f+s.g*C+G.g*x+T.g*g,n=u.b*f+s.b*C+G.b*x+T.b*g,V=u.a*f+s.a*C+G.a*x+T.a*g;return new Q(b,Y,n,V)}static Hermite1stDerivative(u,G,s,T,z){const O=new Q;return this.Hermite1stDerivativeToRef(u,G,s,T,z,O),O}static Hermite1stDerivativeToRef(u,G,s,T,z,O){const m=z*z;O.r=6*(m-z)*u.r+(3*m-4*z+1)*G.r+6*(-m+z)*s.r+(3*m-2*z)*T.r,O.g=6*(m-z)*u.g+(3*m-4*z+1)*G.g+6*(-m+z)*s.g+(3*m-2*z)*T.g,O.b=6*(m-z)*u.b+(3*m-4*z+1)*G.b+6*(-m+z)*s.b+(3*m-2*z)*T.b,O.a=6*(m-z)*u.a+(3*m-4*z+1)*G.a+6*(-m+z)*s.a+(3*m-2*z)*T.a}static FromColor3(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Q(u.r,u.g,u.b,G)}static Ag(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Q(u[G],u[G+1],u[G+2],u[G+3])}static FromArrayToRef(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;s.r=u[G],s.g=u[G+1],s.b=u[G+2],s.a=u[G+3]}static FromInts(u,G,s,T){return new Q(u/255,G/255,s/255,T/255)}static CheckColors4(u,G){if(u.length===3*G){const G=[];for(let s=0;s<u.length;s+=3){const T=s/3*4;G[T]=u[s],G[T+1]=u[s+1],G[T+2]=u[s+2],G[T+3]=1}return G}return u}}Object.defineProperties(Q.prototype,{dimension:{value:[4]},rank:{value:1}});class Y{}Y.hb=(0,T.c)(3,b.Black),Y.ob=(0,T.c)(3,(()=>new Q(0,0,0,0))),(0,z.g)("BABYLON.Color3",b),(0,z.g)("BABYLON.Color4",Q)},10913:(u,G,s)=>{"use strict";s.d(G,{e:()=>m,h:()=>O,j:()=>T,l:()=>z});const T=1/2.2,z=2.2,O=(1+Math.sqrt(5))/2,m=.001},11013:(u,G,s)=>{"use strict";s.d(G,{d:()=>z});var T=s(11018);class z{static GetPlanes(u){const G=[];for(let s=0;s<6;s++)G.push(new T.d(0,0,0,0));return z.GetPlanesToRef(u,G),G}static GetNearPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]+s[2],G.ab.y=s[7]+s[6],G.ab.z=s[11]+s[10],G.d=s[15]+s[14],G.normalize()}static GetFarPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]-s[2],G.ab.y=s[7]-s[6],G.ab.z=s[11]-s[10],G.d=s[15]-s[14],G.normalize()}static GetLeftPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]+s[0],G.ab.y=s[7]+s[4],G.ab.z=s[11]+s[8],G.d=s[15]+s[12],G.normalize()}static GetRightPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]-s[0],G.ab.y=s[7]-s[4],G.ab.z=s[11]-s[8],G.d=s[15]-s[12],G.normalize()}static GetTopPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]-s[1],G.ab.y=s[7]-s[5],G.ab.z=s[11]-s[9],G.d=s[15]-s[13],G.normalize()}static GetBottomPlaneToRef(u,G){const s=u.m;G.ab.x=s[3]+s[1],G.ab.y=s[7]+s[5],G.ab.z=s[11]+s[9],G.d=s[15]+s[13],G.normalize()}static GetPlanesToRef(u,G){z.GetNearPlaneToRef(u,G[0]),z.GetFarPlaneToRef(u,G[1]),z.GetLeftPlaneToRef(u,G[2]),z.GetRightPlaneToRef(u,G[3]),z.GetTopPlaneToRef(u,G[4]),z.GetBottomPlaneToRef(u,G[5])}static IsPointInFrustum(u,G){for(let s=0;s<6;s++)if(G[s].dotCoordinate(u)<0)return!1;return!0}}},11078:(u,G,s)=>{"use strict";s.d(G,{e:()=>f,i:()=>C});var T=s(10863),z=s(10904),O=s(10866);class m{static extractMinAndMaxIndexed(u,G,s,T,z,O){for(let m=s;m<s+T;m++){const s=3*G[m],T=u[s],f=u[s+1],C=u[s+2];z.minimizeInPlaceFromFloats(T,f,C),O.maximizeInPlaceFromFloats(T,f,C)}}static extractMinAndMax(u,G,s,T,z,O){for(let m=G,f=G*T;m<G+s;m++,f+=T){const G=u[f],s=u[f+1],T=u[f+2];z.minimizeInPlaceFromFloats(G,s,T),O.maximizeInPlaceFromFloats(G,s,T)}}}function f(u,G,s,T){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const f=new z.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new z.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return m.extractMinAndMaxIndexed(u,G,s,T,f,C),O&&(f.x-=f.x*O.x+O.y,f.y-=f.y*O.x+O.y,f.z-=f.z*O.x+O.y,C.x+=C.x*O.x+O.y,C.y+=C.y*O.x+O.y,C.z+=C.z*O.x+O.y),{minimum:f,maximum:C}}function C(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;const f=new z.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new z.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O||(O=3),m.extractMinAndMax(u,G,s,O,f,C),T&&(f.x-=f.x*T.x+T.y,f.y-=f.y*T.x+T.y,f.z-=f.z*T.x+T.y,C.x+=C.x*T.x+T.y,C.y+=C.y*T.x+T.y,C.z+=C.z*T.x+T.y),{minimum:f,maximum:C}}(0,T.b)([O.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T,z]=G;return!Array.isArray(T)&&!Array.isArray(z)}))],m,"extractMinAndMaxIndexed",null),(0,T.b)([O.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T]=G;return!Array.isArray(T)}))],m,"extractMinAndMax",null)},11380:(u,G,s)=>{"use strict";s.d(G,{b:()=>T.l});s(11201),s(10930),s(10913),s(11013),s(11382),s(11018),s(11112);var T=s(10904);s(11170)},11382:(u,G,s)=>{"use strict";s.d(G,{e:()=>f,g:()=>g,h:()=>b});var T,z=s(10924),O=s(10904),m=s(10913);!function(u){u[u.CW=0]="CW",u[u.CCW=1]="CCW"}(T||(T={}));class f{static Interpolate(u,G,s,T,z){const O=1-3*T+3*G,m=3*T-6*G,f=3*G;let C=u;for(let x=0;x<5;x++){const G=C*C;C-=(O*(G*C)+m*G+f*C-u)*(1/(3*O*G+2*m*C+f)),C=Math.min(1,Math.max(0,C))}return 3*Math.pow(1-C,2)*C*s+3*(1-C)*Math.pow(C,2)*z+Math.pow(C,3)}}class C{constructor(u){this._radians=u,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(u,G){const s=G.Nc(u),T=Math.atan2(s.y,s.x);return new C(T)}static BetweenTwoVectors(u,G){let s=u.lengthSquared()*G.lengthSquared();if(0===s)return new C(Math.PI/2);s=Math.sqrt(s);let T=u.dot(G)/s;T=(0,z.b)(T,-1,1);const O=Math.acos(T);return new C(O)}static FromRadians(u){return new C(u)}static FromDegrees(u){return new C(u*Math.PI/180)}}class x{constructor(u,G,s){this.startPoint=u,this.midPoint=G,this.endPoint=s;const T=Math.pow(G.x,2)+Math.pow(G.y,2),z=(Math.pow(u.x,2)+Math.pow(u.y,2)-T)/2,m=(T-Math.pow(s.x,2)-Math.pow(s.y,2))/2,f=(u.x-G.x)*(G.y-s.y)-(G.x-s.x)*(u.y-G.y);this.centerPoint=new O.m((z*(G.y-s.y)-m*(u.y-G.y))/f,((u.x-G.x)*m-(G.x-s.x)*z)/f),this.i=this.centerPoint.Nc(this.startPoint).length(),this.startAngle=C.BetweenTwoPoints(this.centerPoint,this.startPoint);const x=this.startAngle.degrees();let g=C.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),b=C.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();g-x>180&&(g-=360),g-x<-180&&(g+=360),b-g>180&&(b-=360),b-g<-180&&(b+=360),this.orientation=g-x<0?0:1,this.angle=C.FromDegrees(0===this.orientation?x-b:b-x)}}class g{constructor(u,G){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new O.m(u,G))}addLineTo(u,G){if(this.closed)return this;const s=new O.m(u,G),T=this._points[this._points.length-1];return this._points.push(s),this._length+=s.Nc(T).length(),this}addArcTo(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const m=this._points[this._points.length-1],f=new O.m(u,G),C=new O.m(s,T),g=new x(m,f,C);let b=g.angle.radians()/z;0===g.orientation&&(b*=-1);let Q=g.startAngle.radians()+b;for(let O=0;O<z;O++){const u=Math.cos(Q)*g.i+g.centerPoint.x,G=Math.sin(Q)*g.i+g.centerPoint.y;this.addLineTo(u,G),Q+=b}return this}addQuadraticCurveTo(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const O=(u,G,s,T)=>(1-u)*(1-u)*G+2*u*(1-u)*s+u*u*T,m=this._points[this._points.length-1];for(let f=0;f<=z;f++){const C=f/z,x=O(C,m.x,u,s),g=O(C,m.y,G,T);this.addLineTo(x,g)}return this}addBezierCurveTo(u,G,s,T,z,O){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const f=(u,G,s,T,z)=>(1-u)*(1-u)*(1-u)*G+3*u*(1-u)*(1-u)*s+3*u*u*(1-u)*T+u*u*u*z,C=this._points[this._points.length-1];for(let x=0;x<=m;x++){const g=x/m,b=f(g,C.x,u,s,z),Q=f(g,C.y,G,T,O);this.addLineTo(b,Q)}return this}isPointInside(u){let G=!1;const s=this._points.length;for(let T=s-1,z=0;z<s;T=z++){let s=this._points[T],O=this._points[z],m=O.x-s.x,f=O.y-s.y;if(Math.abs(f)>Number.EPSILON){if(f<0&&(s=this._points[z],m=-m,O=this._points[T],f=-f),u.y<s.y||u.y>O.y)continue;if(u.y===s.y&&u.x===s.x)return!0;{const T=f*(u.x-s.x)-m*(u.y-s.y);if(0===T)return!0;if(T<0)continue;G=!G}}else{if(u.y!==s.y)continue;if(O.x<=u.x&&u.x<=s.x||s.x<=u.x&&u.x<=O.x)return!0}}return G}close(){return this.closed=!0,this}length(){let u=this._length;if(this.closed){const G=this._points[this._points.length-1];u+=this._points[0].Nc(G).length()}return u}area(){const u=this._points.length;let G=0;for(let s=u-1,T=0;T<u;s=T++)G+=this._points[s].x*this._points[T].y-this._points[T].x*this._points[s].y;return.5*G}getPoints(){return this._points}getPointAtLengthPosition(u){if(u<0||u>1)return O.m.Zero();const G=u*this.length();let s=0;for(let T=0;T<this._points.length;T++){const u=(T+1)%this._points.length,z=this._points[T],m=this._points[u].Nc(z),f=m.length()+s;if(G>=s&&G<=f){const u=m.normalize(),T=G-s;return new O.m(z.x+u.x*T,z.y+u.y*T)}s=f}return O.m.Zero()}static StartingAt(u,G){return new g(u,G)}}class b{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=u,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:O.q.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:O.d.Identity()};for(let z=0;z<u.length;z++)this._curve[z]=u[z].clone();this._raw=s||!1,this._alignTangentsWithPath=T,this._compute(G,T)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(u){return this._updatePointAtData(u).point}getTangentAt(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(u,G),G?O.q.TransformCoordinates(O.q.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(u,G),G?O.q.TransformCoordinates(O.q.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(u,G),G?O.q.TransformCoordinates(O.q.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(u){return this.length()*u}getPreviousPointIndexAt(u){return this._updatePointAtData(u),this._pointAtData.previousPointArrayIndex}getSubPositionAt(u){return this._updatePointAtData(u),this._pointAtData.subPosition}getClosestPositionTo(u){let G=Number.MAX_VALUE,s=0;for(let T=0;T<this._curve.length-1;T++){const z=this._curve[T+0],m=this._curve[T+1].Nc(z).normalize(),f=this._distances[T+1]-this._distances[T+0],C=Math.min(Math.max(O.q.Dot(m,u.Nc(z).normalize()),0)*O.q.Distance(z,u)/f,1),x=O.q.Distance(z.add(m.scale(C*f)),u);x<G&&(G=x,s=(this._distances[T+0]+f*C)/this.length())}return s}slice(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(u<0&&(u=1- -1*u%1),G<0&&(G=1- -1*G%1),u>G){const s=u;u=G,G=s}const s=this.getCurve(),T=this.getPointAt(u);let z=this.getPreviousPointIndexAt(u);const O=this.getPointAt(G),m=this.getPreviousPointIndexAt(G)+1,f=[];return 0!==u&&(z++,f.push(T)),f.push(...s.slice(z,m)),1===G&&1!==u||f.push(O),new b(f,this.getNormalAt(u),this._raw,this._alignTangentsWithPath)}update(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let T=0;T<u.length;T++)this._curve[T].x=u[T].x,this._curve[T].y=u[T].y,this._curve[T].z=u[T].z;return this._compute(G,s),this}_compute(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this._curve.length;if(s<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[s-1]=this._curve[s-1].Nc(this._curve[s-2]),this._raw||this._tangents[s-1].normalize();const T=this._tangents[0],z=this._normalVector(T,u);let m,f,C,x,g;this._normals[0]=z,this._raw||this._normals[0].normalize(),this._binormals[0]=O.q.Cross(T,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let b=1;b<s;b++)m=this._getLastNonNullVector(b),b<s-1&&(f=this._getFirstNonNullVector(b),this._tangents[b]=G?f:m.add(f),this._tangents[b].normalize()),this._distances[b]=this._distances[b-1]+this._curve[b].Nc(this._curve[b-1]).length(),C=this._tangents[b],g=this._binormals[b-1],this._normals[b]=O.q.Cross(g,C),this._raw||(0===this._normals[b].length()?(x=this._normals[b-1],this._normals[b]=x.clone()):this._normals[b].normalize()),this._binormals[b]=O.q.Cross(C,this._normals[b]),this._raw||this._binormals[b].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(u){let G=1,s=this._curve[u+G].Nc(this._curve[u]);for(;0===s.length()&&u+G+1<this._curve.length;)G++,s=this._curve[u+G].Nc(this._curve[u]);return s}_getLastNonNullVector(u){let G=1,s=this._curve[u].Nc(this._curve[u-G]);for(;0===s.length()&&u>G+1;)G++,s=this._curve[u].Nc(this._curve[u-G]);return s}_normalVector(u,G){let s,T=u.length();if(0===T&&(T=1),void 0===G||null===G){let G;G=(0,z.s)(Math.abs(u.y)/T,1,m.e)?(0,z.s)(Math.abs(u.x)/T,1,m.e)?(0,z.s)(Math.abs(u.z)/T,1,m.e)?O.q.Zero():new O.q(0,0,1):new O.q(1,0,0):new O.q(0,-1,0),s=O.q.Cross(u,G)}else s=O.q.Cross(u,G),O.q.CrossToRef(s,u,s);return s.normalize(),s}_updatePointAtData(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===u)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=u;const s=this.getPoints();if(u<=0)return this._setPointAtData(0,0,s[0],0,G);if(u>=1)return this._setPointAtData(1,1,s[s.length-1],s.length-1,G);let T,z=s[0],m=0;const f=u*this.length();for(let C=1;C<s.length;C++){T=s[C];const x=O.q.Distance(z,T);if(m+=x,m===f)return this._setPointAtData(u,1,T,C,G);if(m>f){const s=(m-f)/x,O=z.Nc(T),g=T.add(O.scaleInPlace(s));return this._setPointAtData(u,1-s,g,C-1,G)}z=T}return this._pointAtData}_setPointAtData(u,G,s,T,z){return this._pointAtData.point=s,this._pointAtData.position=u,this._pointAtData.subPosition=G,this._pointAtData.previousPointArrayIndex=T,this._pointAtData.interpolateReady=z,z&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=O.d.Identity();const u=this._pointAtData.previousPointArrayIndex;if(u!==this._tangents.length-1){const G=u+1,s=this._tangents[u].clone(),T=this._normals[u].clone(),z=this._binormals[u].clone(),m=this._tangents[G].clone(),f=this._normals[G].clone(),C=this._binormals[G].clone(),x=O.h.RotationQuaternionFromAxis(T,z,s),g=O.h.RotationQuaternionFromAxis(f,C,m);O.h.Slerp(x,g,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11018:(u,G,s)=>{"use strict";s.d(G,{d:()=>z});var T=s(10904);class z{constructor(u,G,s,z){this.ab=new T.q(u,G,s),this.d=z}$i(){return[this.ab.x,this.ab.y,this.ab.z,this.d]}clone(){return new z(this.ab.x,this.ab.y,this.ab.z,this.d)}getClassName(){return"Plane"}getHashCode(){let u=this.ab.getHashCode();return u=397*u^this.d,u}normalize(){const u=Math.sqrt(this.ab.x*this.ab.x+this.ab.y*this.ab.y+this.ab.z*this.ab.z);let G=0;return 0!==u&&(G=1/u),this.ab.x*=G,this.ab.y*=G,this.ab.z*=G,this.d*=G,this}transform(u){const G=z._TmpMatrix;u.invertToRef(G);const s=G.m,T=this.ab.x,O=this.ab.y,m=this.ab.z,f=this.d,C=T*s[0]+O*s[1]+m*s[2]+f*s[3],x=T*s[4]+O*s[5]+m*s[6]+f*s[7],g=T*s[8]+O*s[9]+m*s[10]+f*s[11],b=T*s[12]+O*s[13]+m*s[14]+f*s[15];return new z(C,x,g,b)}dotCoordinate(u){return this.ab.x*u.x+this.ab.y*u.y+this.ab.z*u.z+this.d}copyFromPoints(u,G,s){const T=G.x-u.x,z=G.y-u.y,O=G.z-u.z,m=s.x-u.x,f=s.y-u.y,C=s.z-u.z,x=z*C-O*f,g=O*m-T*C,b=T*f-z*m,Q=Math.sqrt(x*x+g*g+b*b);let Y;return Y=0!==Q?1/Q:0,this.ab.x=x*Y,this.ab.y=g*Y,this.ab.z=b*Y,this.d=-(this.ab.x*u.x+this.ab.y*u.y+this.ab.z*u.z),this}isFrontFacingTo(u,G){return T.q.Dot(this.ab,u)<=G}signedDistanceTo(u){return T.q.Dot(u,this.ab)+this.d}static Ag(u){return new z(u[0],u[1],u[2],u[3])}static FromPoints(u,G,s){const T=new z(0,0,0,0);return T.copyFromPoints(u,G,s),T}static FromPositionAndNormal(u,G){const s=new z(0,0,0,0);return this.FromPositionAndNormalToRef(u,G,s)}static FromPositionAndNormalToRef(u,G,s){return s.ab.p(G),s.ab.normalize(),s.d=-u.dot(s.ab),s}static SignedDistanceToPlaneFromPositionAndNormal(u,G,s){const z=-(G.x*u.x+G.y*u.y+G.z*u.z);return T.q.Dot(s,G)+z}}z._TmpMatrix=T.d.Identity()},10924:(u,G,s)=>{"use strict";function T(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(u-G)<=s}function z(u,G){return u===G?u:Math.random()*(G-u)+u}function O(u,G,s){return u+(G-u)*s}function m(u,G,s,T,z){const O=z*z,m=z*O;return u*(2*m-3*O+1)+s*(-2*m+3*O)+G*(m-2*O+z)+T*(m-O)}function f(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(s,Math.max(G,u))}function C(u){return u-=2*Math.PI*Math.floor((u+Math.PI)/(2*Math.PI))}function x(u){const G=u.toString(16);return u<=15?("0"+G).toUpperCase():G.toUpperCase()}function g(u){if(Math.log2)return Math.floor(Math.log2(u));if(u<0)return NaN;if(0===u)return-1/0;let G=0;if(u<1){for(;u<1;)G++,u*=2;G=-G}else if(u>1)for(;u>1;)G++,u=Math.floor(u/2);return G}function b(u,G){const s=u%G;return 0===s?G:b(G,s)}s.d(G,{b:()=>f,f:()=>m,j:()=>b,l:()=>g,m:()=>O,n:()=>C,q:()=>z,r:()=>x,s:()=>T})},11112:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{constructor(u,G){this.width=u,this.height=G}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let u=0|this.width;return u=397*u^this.height,u}p(u){this.width=u.width,this.height=u.height}hf(u,G){return this.width=u,this.height=G,this}set(u,G){return this.hf(u,G)}multiplyByFloats(u,G){return new T(this.width*u,this.height*G)}clone(){return new T(this.width,this.height)}equals(u){return!!u&&(this.width===u.width&&this.height===u.height)}get surface(){return this.width*this.height}static Zero(){return new T(0,0)}add(u){return new T(this.width+u.width,this.height+u.height)}Nc(u){return new T(this.width-u.width,this.height-u.height)}scale(u){return new T(this.width*u,this.height*u)}static Lerp(u,G,s){const z=u.width+(G.width-u.width)*s,O=u.height+(G.height-u.height)*s;return new T(z,O)}}},10904:(u,G,s)=>{"use strict";s.d(G,{d:()=>n,h:()=>Y,l:()=>F,m:()=>g,q:()=>b,s:()=>Q});var T=s(10913),z=s(10918),O=s(10715),m=s(10676),f=s(10619),C=s(10924);const x=u=>parseInt(u.toString().replace(/\W/g,""));class g{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=u,this.y=G}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let u=x(this.x);return u=397*u^x(this.y),u}toArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[G]=this.x,u[G+1]=this.y,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return g.FromArrayToRef(u,G,this),this}$i(){return[this.x,this.y]}p(u){return this.x=u.x,this.y=u.y,this}hf(u,G){return this.x=u,this.y=G,this}set(u,G){return this.hf(u,G)}vj(u){return this.hf(u,u)}add(u){return new g(this.x+u.x,this.y+u.y)}addToRef(u,G){return G.x=this.x+u.x,G.y=this.y+u.y,G}addInPlace(u){return this.x+=u.x,this.y+=u.y,this}addInPlaceFromFloats(u,G){return this.x+=u,this.y+=G,this}addVector3(u){return new g(this.x+u.x,this.y+u.y)}Nc(u){return new g(this.x-u.x,this.y-u.y)}subtractToRef(u,G){return G.x=this.x-u.x,G.y=this.y-u.y,G}fi(u){return this.x-=u.x,this.y-=u.y,this}multiplyInPlace(u){return this.x*=u.x,this.y*=u.y,this}multiply(u){return new g(this.x*u.x,this.y*u.y)}multiplyToRef(u,G){return G.x=this.x*u.x,G.y=this.y*u.y,G}multiplyByFloats(u,G){return new g(this.x*u,this.y*G)}divide(u){return new g(this.x/u.x,this.y/u.y)}divideToRef(u,G){return G.x=this.x/u.x,G.y=this.y/u.y,G}divideInPlace(u){return this.x=this.x/u.x,this.y=this.y/u.y,this}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u.x,u.y)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u.x,u.y)}minimizeInPlaceFromFloats(u,G){return this.x=Math.min(u,this.x),this.y=Math.min(G,this.y),this}maximizeInPlaceFromFloats(u,G){return this.x=Math.max(u,this.x),this.y=Math.max(G,this.y),this}subtractFromFloats(u,G){return new g(this.x-u,this.y-G)}subtractFromFloatsToRef(u,G,s){return s.x=this.x-u,s.y=this.y-G,s}negate(){return new g(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(u){return u.x=-this.x,u.y=-this.y,u}scaleInPlace(u){return this.x*=u,this.y*=u,this}scale(u){return new g(this.x*u,this.y*u)}scaleToRef(u,G){return G.x=this.x*u,G.y=this.y*u,G}scaleAndAddToRef(u,G){return G.x+=this.x*u,G.y+=this.y*u,G}equals(u){return u&&this.x===u.x&&this.y===u.y}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.e;return u&&(0,C.s)(this.x,u.x,G)&&(0,C.s)(this.y,u.y,G)}equalsToFloats(u,G){return this.x===u&&this.y===G}floor(){return new g(Math.floor(this.x),Math.floor(this.y))}floorToRef(u){return u.x=Math.floor(this.x),u.y=Math.floor(this.y),u}fract(){return new g(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(u){return u.x=this.x-Math.floor(this.x),u.y=this.y-Math.floor(this.y),u}rotateToRef(u,G){const s=Math.cos(u),T=Math.sin(u),z=s*this.x-T*this.y,O=T*this.x+s*this.y;return G.x=z,G.y=O,G}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){const u=new g;return this.normalizeToRef(u),u}normalizeToRef(u){const G=this.length();return 0===G&&(u.x=this.x,u.y=this.y),this.scaleToRef(1/G,u)}clone(){return new g(this.x,this.y)}dot(u){return this.x*u.x+this.y*u.y}static Zero(){return new g(0,0)}static One(){return new g(1,1)}static Random(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new g((0,C.q)(u,G),(0,C.q)(u,G))}static RandomToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).hf((0,C.q)(u,G),(0,C.q)(u,G))}static get ZeroReadOnly(){return g._ZeroReadOnly}static Ag(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new g(u[G],u[G+1])}static FromArrayToRef(u,G,s){return s.x=u[G],s.y=u[G+1],s}static FromFloatsToRef(u,G,s){return s.hf(u,G),s}static CatmullRom(u,G,s,T,z){const O=z*z,m=z*O,f=.5*(2*G.x+(-u.x+s.x)*z+(2*u.x-5*G.x+4*s.x-T.x)*O+(-u.x+3*G.x-3*s.x+T.x)*m),C=.5*(2*G.y+(-u.y+s.y)*z+(2*u.y-5*G.y+4*s.y-T.y)*O+(-u.y+3*G.y-3*s.y+T.y)*m);return new g(f,C)}static ClampToRef(u,G,s,T){return T.x=(0,C.b)(u.x,G.x,s.x),T.y=(0,C.b)(u.y,G.y,s.y),T}static Clamp(u,G,s){const T=(0,C.b)(u.x,G.x,s.x),z=(0,C.b)(u.y,G.y,s.y);return new g(T,z)}static Hermite(u,G,s,T,z){const O=z*z,m=z*O,f=2*m-3*O+1,C=-2*m+3*O,x=m-2*O+z,b=m-O,Q=u.x*f+s.x*C+G.x*x+T.x*b,Y=u.y*f+s.y*C+G.y*x+T.y*b;return new g(Q,Y)}static Hermite1stDerivative(u,G,s,T,z){return this.Hermite1stDerivativeToRef(u,G,s,T,z,new g)}static Hermite1stDerivativeToRef(u,G,s,T,z,O){const m=z*z;return O.x=6*(m-z)*u.x+(3*m-4*z+1)*G.x+6*(-m+z)*s.x+(3*m-2*z)*T.x,O.y=6*(m-z)*u.y+(3*m-4*z+1)*G.y+6*(-m+z)*s.y+(3*m-2*z)*T.y,O}static Lerp(u,G,s){return g.LerpToRef(u,G,s,new g)}static LerpToRef(u,G,s,T){return T.x=u.x+(G.x-u.x)*s,T.y=u.y+(G.y-u.y)*s,T}static Dot(u,G){return u.x*G.x+u.y*G.y}static Normalize(u){return g.NormalizeToRef(u,new g)}static NormalizeToRef(u,G){return u.normalizeToRef(G),G}static Minimize(u,G){const s=u.x<G.x?u.x:G.x,T=u.y<G.y?u.y:G.y;return new g(s,T)}static Maximize(u,G){const s=u.x>G.x?u.x:G.x,T=u.y>G.y?u.y:G.y;return new g(s,T)}static Transform(u,G){return g.TransformToRef(u,G,new g)}static TransformToRef(u,G,s){const T=G.m,z=u.x*T[0]+u.y*T[4]+T[12],O=u.x*T[1]+u.y*T[5]+T[13];return s.x=z,s.y=O,s}static PointInTriangle(u,G,s,T){const z=.5*(-s.y*T.x+G.y*(-s.x+T.x)+G.x*(s.y-T.y)+s.x*T.y),O=z<0?-1:1,m=(G.y*T.x-G.x*T.y+(T.y-G.y)*u.x+(G.x-T.x)*u.y)*O,f=(G.x*s.y-G.y*s.x+(G.y-s.y)*u.x+(s.x-G.x)*u.y)*O;return m>0&&f>0&&m+f<2*z*O}static Distance(u,G){return Math.sqrt(g.DistanceSquared(u,G))}static DistanceSquared(u,G){const s=u.x-G.x,T=u.y-G.y;return s*s+T*T}static Center(u,G){return g.CenterToRef(u,G,new g)}static CenterToRef(u,G,s){return s.hf((u.x+G.x)/2,(u.y+G.y)/2)}static DistanceOfPointFromSegment(u,G,s){const T=g.DistanceSquared(G,s);if(0===T)return g.Distance(u,G);const z=s.Nc(G),O=Math.max(0,Math.min(1,g.Dot(u.Nc(G),z)/T)),m=G.add(z.multiplyByFloats(O,O));return g.Distance(u,m)}}g._ZeroReadOnly=g.Zero(),Object.defineProperties(g.prototype,{dimension:{value:[2]},rank:{value:1}});class b{get x(){return this._x}set x(u){this._x=u,this._isDirty=!0}get y(){return this._y}set y(u){this._y=u,this._isDirty=!0}get z(){return this._z}set z(u){this._z=u,this._isDirty=!0}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=u,this._y=G,this._z=s}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"gb"}getHashCode(){let u=x(this._x);return u=397*u^x(this._y),u=397*u^x(this._z),u}$i(){return[this._x,this._y,this._z]}toArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[G]=this._x,u[G+1]=this._y,u[G+2]=this._z,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(u,G,this),this}toQuaternion(){return Y.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(u){return this._x+=u._x,this._y+=u._y,this._z+=u._z,this._isDirty=!0,this}addInPlaceFromFloats(u,G,s){return this._x+=u,this._y+=G,this._z+=s,this._isDirty=!0,this}add(u){return new b(this._x+u._x,this._y+u._y,this._z+u._z)}addToRef(u,G){return G._x=this._x+u._x,G._y=this._y+u._y,G._z=this._z+u._z,G._isDirty=!0,G}fi(u){return this._x-=u._x,this._y-=u._y,this._z-=u._z,this._isDirty=!0,this}Nc(u){return new b(this._x-u._x,this._y-u._y,this._z-u._z)}subtractToRef(u,G){return this.subtractFromFloatsToRef(u._x,u._y,u._z,G)}subtractFromFloats(u,G,s){return new b(this._x-u,this._y-G,this._z-s)}subtractFromFloatsToRef(u,G,s,T){return T._x=this._x-u,T._y=this._y-G,T._z=this._z-s,T._isDirty=!0,T}negate(){return new b(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(u){return u._x=-1*this._x,u._y=-1*this._y,u._z=-1*this._z,u._isDirty=!0,u}scaleInPlace(u){return this._x*=u,this._y*=u,this._z*=u,this._isDirty=!0,this}scale(u){return new b(this._x*u,this._y*u,this._z*u)}scaleToRef(u,G){return G._x=this._x*u,G._y=this._y*u,G._z=this._z*u,G._isDirty=!0,G}getNormalToRef(u){const G=this.length();let s=Math.acos(this.y/G);const T=Math.atan2(this.z,this.x);s>Math.PI/2?s-=Math.PI/2:s+=Math.PI/2;const z=G*Math.sin(s)*Math.cos(T),O=G*Math.cos(s),m=G*Math.sin(s)*Math.sin(T);return u.set(z,O,m),u}applyRotationQuaternionToRef(u,G){const s=this._x,T=this._y,z=this._z,O=u._x,m=u._y,f=u._z,C=u._w,x=2*(m*z-f*T),g=2*(f*s-O*z),b=2*(O*T-m*s);return G._x=s+C*x+m*b-f*g,G._y=T+C*g+f*x-O*b,G._z=z+C*b+O*g-m*x,G._isDirty=!0,G}applyRotationQuaternionInPlace(u){return this.applyRotationQuaternionToRef(u,this)}applyRotationQuaternion(u){return this.applyRotationQuaternionToRef(u,new b)}scaleAndAddToRef(u,G){return G._x+=this._x*u,G._y+=this._y*u,G._z+=this._z*u,G._isDirty=!0,G}projectOnPlane(u,G){return this.projectOnPlaneToRef(u,G,new b)}projectOnPlaneToRef(u,G,s){const T=u.ab,z=u.d,O=V.gb[0];this.subtractToRef(G,O),O.normalize();const m=b.Dot(O,T);if(Math.abs(m)<1e-10)s.vj(1/0);else{const u=-(b.Dot(G,T)+z)/m,f=O.scaleInPlace(u);G.addToRef(f,s)}return s}equals(u){return u&&this._x===u._x&&this._y===u._y&&this._z===u._z}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.e;return u&&(0,C.s)(this._x,u._x,G)&&(0,C.s)(this._y,u._y,G)&&(0,C.s)(this._z,u._z,G)}equalsToFloats(u,G,s){return this._x===u&&this._y===G&&this._z===s}multiplyInPlace(u){return this._x*=u._x,this._y*=u._y,this._z*=u._z,this._isDirty=!0,this}multiply(u){return this.multiplyByFloats(u._x,u._y,u._z)}multiplyToRef(u,G){return G._x=this._x*u._x,G._y=this._y*u._y,G._z=this._z*u._z,G._isDirty=!0,G}multiplyByFloats(u,G,s){return new b(this._x*u,this._y*G,this._z*s)}divide(u){return new b(this._x/u._x,this._y/u._y,this._z/u._z)}divideToRef(u,G){return G._x=this._x/u._x,G._y=this._y/u._y,G._z=this._z/u._z,G._isDirty=!0,G}divideInPlace(u){return this._x=this._x/u._x,this._y=this._y/u._y,this._z=this._z/u._z,this._isDirty=!0,this}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u._x,u._y,u._z)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u._x,u._y,u._z)}minimizeInPlaceFromFloats(u,G,s){return u<this._x&&(this.x=u),G<this._y&&(this.y=G),s<this._z&&(this.z=s),this}maximizeInPlaceFromFloats(u,G,s){return u>this._x&&(this.x=u),G>this._y&&(this.y=G),s>this._z&&(this.z=s),this}isNonUniformWithinEpsilon(u){const G=Math.abs(this._x),s=Math.abs(this._y);if(!(0,C.s)(G,s,u))return!0;const T=Math.abs(this._z);return!(0,C.s)(G,T,u)||!(0,C.s)(s,T,u)}get isNonUniform(){const u=Math.abs(this._x);if(u!==Math.abs(this._y))return!0;return u!==Math.abs(this._z)}floorToRef(u){return u._x=Math.floor(this._x),u._y=Math.floor(this._y),u._z=Math.floor(this._z),u._isDirty=!0,u}floor(){return new b(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(u){return u._x=this.x-Math.floor(this._x),u._y=this.y-Math.floor(this._y),u._z=this.z-Math.floor(this._z),u._isDirty=!0,u}fract(){return new b(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(u){if("xyz"===(u=u.toLowerCase()))return this;const G=V.gb[0].p(this);return this.x=G[u[0]],this.y=G[u[1]],this.z=G[u[2]],this}rotateByQuaternionToRef(u,G){return u.toRotationMatrix(V.Matrix[0]),b.TransformCoordinatesToRef(this,V.Matrix[0],G),G}rotateByQuaternionAroundPointToRef(u,G,s){return this.subtractToRef(G,V.gb[0]),V.gb[0].rotateByQuaternionToRef(u,V.gb[0]),G.addToRef(V.gb[0],s),s}cross(u){return b.CrossToRef(this,u,new b)}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){return this.normalizeToRef(new b)}normalizeToRef(u){const G=this.length();return 0===G||1===G?(u._x=this._x,u._y=this._y,u._z=this._z,u._isDirty=!0,u):this.scaleToRef(1/G,u)}clone(){return new b(this._x,this._y,this._z)}p(u){return this.hf(u._x,u._y,u._z)}hf(u,G,s){return this._x=u,this._y=G,this._z=s,this._isDirty=!0,this}set(u,G,s){return this.hf(u,G,s)}vj(u){return this._x=this._y=this._z=u,this._isDirty=!0,this}static GetClipFactor(u,G,s,T){const z=b.Dot(u,s);return(z-T)/(z-b.Dot(G,s))}static GetAngleBetweenVectors(u,G,s){const T=u.normalizeToRef(V.gb[1]),z=G.normalizeToRef(V.gb[2]);let O=b.Dot(T,z);O=(0,C.b)(O,-1,1);const m=Math.acos(O),f=V.gb[3];return b.CrossToRef(T,z,f),b.Dot(f,s)>0?isNaN(m)?0:m:isNaN(m)?-Math.PI:-Math.acos(O)}static GetAngleBetweenVectorsOnPlane(u,G,s){V.gb[0].p(u);const T=V.gb[0];V.gb[1].p(G);const z=V.gb[1];V.gb[2].p(s);const O=V.gb[2],m=V.gb[3],f=V.gb[4];T.normalize(),z.normalize(),O.normalize(),b.CrossToRef(O,T,m),b.CrossToRef(m,O,f);const x=Math.atan2(b.Dot(z,m),b.Dot(z,f));return(0,C.n)(x)}static PitchYawRollToMoveBetweenPointsToRef(u,G,s){const T=F.gb[0];return G.subtractToRef(u,T),s._y=Math.atan2(T.x,T.z)||0,s._x=Math.atan2(Math.sqrt(T.x**2+T.z**2),T.y)||0,s._z=0,s._isDirty=!0,s}static PitchYawRollToMoveBetweenPoints(u,G){const s=b.Zero();return b.PitchYawRollToMoveBetweenPointsToRef(u,G,s)}static SlerpToRef(u,G,s,z){s=(0,C.b)(s,0,1);const O=V.gb[0],m=V.gb[1];O.p(u);const f=O.length();O.normalizeFromLength(f),m.p(G);const x=m.length();m.normalizeFromLength(x);const g=b.Dot(O,m);let Q,Y;if(g<1-T.e){const u=Math.acos(g),G=1/Math.sin(u);Q=Math.sin((1-s)*u)*G,Y=Math.sin(s*u)*G}else Q=1-s,Y=s;return O.scaleInPlace(Q),m.scaleInPlace(Y),z.p(O).addInPlace(m),z.scaleInPlace((0,C.m)(f,x,s)),z}static SmoothToRef(u,G,s,T,z){return b.SlerpToRef(u,G,0===T?1:s/T,z),z}static Ag(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new b(u[G],u[G+1],u[G+2])}static FromFloatArray(u,G){return b.Ag(u,G)}static FromArrayToRef(u,G,s){return s._x=u[G],s._y=u[G+1],s._z=u[G+2],s._isDirty=!0,s}static FromFloatArrayToRef(u,G,s){return b.FromArrayToRef(u,G,s)}static FromFloatsToRef(u,G,s,T){return T.hf(u,G,s),T}static Zero(){return new b(0,0,0)}static One(){return new b(1,1,1)}static Up(){return new b(0,1,0)}static get UpReadOnly(){return b._UpReadOnly}static get DownReadOnly(){return b._DownReadOnly}static get RightReadOnly(){return b._RightReadOnly}static get LeftReadOnly(){return b._LeftReadOnly}static get LeftHandedForwardReadOnly(){return b._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return b._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return b._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return b._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return b._ZeroReadOnly}static get OneReadOnly(){return b._OneReadOnly}static Down(){return new b(0,-1,0)}static Forward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new b(1,0,0)}static Left(){return new b(-1,0,0)}static Random(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new b((0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G))}static RandomToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).hf((0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G))}static TransformCoordinates(u,G){const s=b.Zero();return b.TransformCoordinatesToRef(u,G,s),s}static TransformCoordinatesToRef(u,G,s){return b.TransformCoordinatesFromFloatsToRef(u._x,u._y,u._z,G,s),s}static TransformCoordinatesFromFloatsToRef(u,G,s,T,z){const O=T.m,m=u*O[0]+G*O[4]+s*O[8]+O[12],f=u*O[1]+G*O[5]+s*O[9]+O[13],C=u*O[2]+G*O[6]+s*O[10]+O[14],x=1/(u*O[3]+G*O[7]+s*O[11]+O[15]);return z._x=m*x,z._y=f*x,z._z=C*x,z._isDirty=!0,z}static TransformNormal(u,G){const s=b.Zero();return b.TransformNormalToRef(u,G,s),s}static TransformNormalToRef(u,G,s){return this.TransformNormalFromFloatsToRef(u._x,u._y,u._z,G,s),s}static TransformNormalFromFloatsToRef(u,G,s,T,z){const O=T.m;return z._x=u*O[0]+G*O[4]+s*O[8],z._y=u*O[1]+G*O[5]+s*O[9],z._z=u*O[2]+G*O[6]+s*O[10],z._isDirty=!0,z}static CatmullRom(u,G,s,T,z){const O=z*z,m=z*O,f=.5*(2*G._x+(-u._x+s._x)*z+(2*u._x-5*G._x+4*s._x-T._x)*O+(-u._x+3*G._x-3*s._x+T._x)*m),C=.5*(2*G._y+(-u._y+s._y)*z+(2*u._y-5*G._y+4*s._y-T._y)*O+(-u._y+3*G._y-3*s._y+T._y)*m),x=.5*(2*G._z+(-u._z+s._z)*z+(2*u._z-5*G._z+4*s._z-T._z)*O+(-u._z+3*G._z-3*s._z+T._z)*m);return new b(f,C,x)}static Clamp(u,G,s){const T=new b;return b.ClampToRef(u,G,s,T),T}static ClampToRef(u,G,s,T){let z=u._x;z=z>s._x?s._x:z,z=z<G._x?G._x:z;let O=u._y;O=O>s._y?s._y:O,O=O<G._y?G._y:O;let m=u._z;return m=m>s._z?s._z:m,m=m<G._z?G._z:m,T.hf(z,O,m),T}static CheckExtends(u,G,s){G.minimizeInPlace(u),s.maximizeInPlace(u)}static Hermite(u,G,s,T,z){const O=z*z,m=z*O,f=2*m-3*O+1,C=-2*m+3*O,x=m-2*O+z,g=m-O,Q=u._x*f+s._x*C+G._x*x+T._x*g,Y=u._y*f+s._y*C+G._y*x+T._y*g,n=u._z*f+s._z*C+G._z*x+T._z*g;return new b(Q,Y,n)}static Hermite1stDerivative(u,G,s,T,z){const O=new b;return this.Hermite1stDerivativeToRef(u,G,s,T,z,O),O}static Hermite1stDerivativeToRef(u,G,s,T,z,O){const m=z*z;return O._x=6*(m-z)*u._x+(3*m-4*z+1)*G._x+6*(-m+z)*s._x+(3*m-2*z)*T._x,O._y=6*(m-z)*u._y+(3*m-4*z+1)*G._y+6*(-m+z)*s._y+(3*m-2*z)*T._y,O._z=6*(m-z)*u._z+(3*m-4*z+1)*G._z+6*(-m+z)*s._z+(3*m-2*z)*T._z,O._isDirty=!0,O}static Lerp(u,G,s){const T=new b(0,0,0);return b.LerpToRef(u,G,s,T),T}static LerpToRef(u,G,s,T){return T._x=u._x+(G._x-u._x)*s,T._y=u._y+(G._y-u._y)*s,T._z=u._z+(G._z-u._z)*s,T._isDirty=!0,T}static Dot(u,G){return u._x*G._x+u._y*G._y+u._z*G._z}dot(u){return this._x*u._x+this._y*u._y+this._z*u._z}static Cross(u,G){const s=new b;return b.CrossToRef(u,G,s),s}static CrossToRef(u,G,s){const T=u._y*G._z-u._z*G._y,z=u._z*G._x-u._x*G._z,O=u._x*G._y-u._y*G._x;return s.hf(T,z,O),s}static Normalize(u){const G=b.Zero();return b.NormalizeToRef(u,G),G}static NormalizeToRef(u,G){return u.normalizeToRef(G),G}static Project(u,G,s,T){const z=new b;return b.ProjectToRef(u,G,s,T,z),z}static ProjectToRef(u,G,s,T,z){var O;const m=T.width,C=T.height,x=T.x,g=T.y,Q=V.Matrix[1],Y=null===(O=f.d.LastCreatedEngine)||void 0===O?void 0:O.isNDCHalfZRange,F=Y?1:.5,r=Y?0:.5;n.FromValuesToRef(m/2,0,0,0,0,-C/2,0,0,0,0,F,0,x+m/2,C/2+g,r,1,Q);const c=V.Matrix[0];return G.multiplyToRef(s,c),c.multiplyToRef(Q,c),b.TransformCoordinatesToRef(u,c,z),z}static Reflect(u,G){return this.ReflectToRef(u,G,new b)}static ReflectToRef(u,G,s){const T=F.gb[0];return T.p(G).scaleInPlace(2*b.Dot(u,G)),s.p(u).fi(T)}static _UnprojectFromInvertedMatrixToRef(u,G,s){b.TransformCoordinatesToRef(u,G,s);const T=G.m,z=u._x*T[3]+u._y*T[7]+u._z*T[11]+T[15];return(0,C.s)(z,1)&&s.scaleInPlace(1/z),s}static UnprojectFromTransform(u,G,s,T,z){return this.Unproject(u,G,s,T,z,n.IdentityReadOnly)}static Unproject(u,G,s,T,z,O){const m=new b;return b.UnprojectToRef(u,G,s,T,z,O,m),m}static UnprojectToRef(u,G,s,T,z,O,m){return b.UnprojectFloatsToRef(u._x,u._y,u._z,G,s,T,z,O,m),m}static UnprojectFloatsToRef(u,G,s,T,z,O,m,C,x){var g;const Q=V.Matrix[0];O.multiplyToRef(m,Q),Q.multiplyToRef(C,Q),Q.invert();const Y=V.gb[0];return Y.x=u/T*2-1,Y.y=-(G/z*2-1),null!==(g=f.d.LastCreatedEngine)&&void 0!==g&&g.isNDCHalfZRange?Y.z=s:Y.z=2*s-1,b._UnprojectFromInvertedMatrixToRef(Y,Q,x),x}static Minimize(u,G){const s=new b;return s.p(u),s.minimizeInPlace(G),s}static Maximize(u,G){const s=new b;return s.p(u),s.maximizeInPlace(G),s}static Distance(u,G){return Math.sqrt(b.DistanceSquared(u,G))}static DistanceSquared(u,G){const s=u._x-G._x,T=u._y-G._y,z=u._z-G._z;return s*s+T*T+z*z}static ProjectOnTriangleToRef(u,G,s,z,O){const m=V.gb[0],f=V.gb[1],x=V.gb[2],g=V.gb[3],Q=V.gb[4];s.subtractToRef(G,m),z.subtractToRef(G,f),z.subtractToRef(s,x);const Y=m.length(),n=f.length(),F=x.length();if(Y<T.e||n<T.e||F<T.e)return O.p(G),b.Distance(u,G);u.subtractToRef(G,Q),b.CrossToRef(m,f,g);const r=g.length();if(r<T.e)return O.p(G),b.Distance(u,G);g.normalizeFromLength(r);let c=Q.length();if(c<T.e)return O.p(G),0;Q.normalizeFromLength(c);const j=b.Dot(g,Q),l=V.gb[5],P=V.gb[6];l.p(g).scaleInPlace(-c*j),P.p(u).addInPlace(l);const H=V.gb[4],X=V.gb[5],p=V.gb[7],q=V.gb[8];H.p(m).scaleInPlace(1/Y),q.p(f).scaleInPlace(1/n),H.addInPlace(q).scaleInPlace(-1),X.p(m).scaleInPlace(-1/Y),q.p(x).scaleInPlace(1/F),X.addInPlace(q).scaleInPlace(-1),p.p(x).scaleInPlace(-1/F),q.p(f).scaleInPlace(-1/n),p.addInPlace(q).scaleInPlace(-1);const d=V.gb[9];let v;d.p(P).fi(G),b.CrossToRef(H,d,q),v=b.Dot(q,g);const W=v;d.p(P).fi(s),b.CrossToRef(X,d,q),v=b.Dot(q,g);const M=v;d.p(P).fi(z),b.CrossToRef(p,d,q),v=b.Dot(q,g);const o=v,R=V.gb[10];let B,D;W>0&&M<0?(R.p(m),B=G,D=s):M>0&&o<0?(R.p(x),B=s,D=z):(R.p(f).scaleInPlace(-1),B=z,D=G);const k=V.gb[9],w=V.gb[4];B.subtractToRef(P,q),D.subtractToRef(P,k),b.CrossToRef(q,k,w);if(!(b.Dot(w,g)<0))return O.p(P),Math.abs(c*j);const L=V.gb[5];b.CrossToRef(R,w,L),L.normalize();const S=V.gb[9];S.p(B).fi(P);const e=S.length();if(e<T.e)return O.p(B),b.Distance(u,B);S.normalizeFromLength(e);const h=b.Dot(L,S),I=V.gb[7];I.p(P).addInPlace(L.scaleInPlace(e*h)),q.p(I).fi(B),c=R.length(),R.normalizeFromLength(c);let i=b.Dot(q,R)/Math.max(c,T.e);return i=(0,C.b)(i,0,1),I.p(B).addInPlace(R.scaleInPlace(i*c)),O.p(I),b.Distance(u,I)}static Center(u,G){return b.CenterToRef(u,G,b.Zero())}static CenterToRef(u,G,s){return s.hf((u._x+G._x)/2,(u._y+G._y)/2,(u._z+G._z)/2)}static RotationFromAxis(u,G,s){const T=new b;return b.RotationFromAxisToRef(u,G,s,T),T}static RotationFromAxisToRef(u,G,s,T){const z=V.Quaternion[0];return Y.RotationQuaternionFromAxisToRef(u,G,s,z),z.toEulerAnglesToRef(T),T}}b._UpReadOnly=b.Up(),b._DownReadOnly=b.Down(),b._LeftHandedForwardReadOnly=b.Forward(!1),b._RightHandedForwardReadOnly=b.Forward(!0),b._LeftHandedBackwardReadOnly=b.Backward(!1),b._RightHandedBackwardReadOnly=b.Backward(!0),b._RightReadOnly=b.Right(),b._LeftReadOnly=b.Left(),b._ZeroReadOnly=b.Zero(),b._OneReadOnly=b.One(),Object.defineProperties(b.prototype,{dimension:{value:[3]},rank:{value:1}});class Q{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=u,this.y=G,this.z=s,this.w=T}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let u=x(this.x);return u=397*u^x(this.y),u=397*u^x(this.z),u=397*u^x(this.w),u}$i(){return[this.x,this.y,this.z,this.w]}toArray(u,G){return void 0===G&&(G=0),u[G]=this.x,u[G+1]=this.y,u[G+2]=this.z,u[G+3]=this.w,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Q.FromArrayToRef(u,G,this),this}addInPlace(u){return this.x+=u.x,this.y+=u.y,this.z+=u.z,this.w+=u.w,this}addInPlaceFromFloats(u,G,s,T){return this.x+=u,this.y+=G,this.z+=s,this.w+=T,this}add(u){return new Q(this.x+u.x,this.y+u.y,this.z+u.z,this.w+u.w)}addToRef(u,G){return G.x=this.x+u.x,G.y=this.y+u.y,G.z=this.z+u.z,G.w=this.w+u.w,G}fi(u){return this.x-=u.x,this.y-=u.y,this.z-=u.z,this.w-=u.w,this}Nc(u){return new Q(this.x-u.x,this.y-u.y,this.z-u.z,this.w-u.w)}subtractToRef(u,G){return G.x=this.x-u.x,G.y=this.y-u.y,G.z=this.z-u.z,G.w=this.w-u.w,G}subtractFromFloats(u,G,s,T){return new Q(this.x-u,this.y-G,this.z-s,this.w-T)}subtractFromFloatsToRef(u,G,s,T,z){return z.x=this.x-u,z.y=this.y-G,z.z=this.z-s,z.w=this.w-T,z}negate(){return new Q(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(u){return u.x=-this.x,u.y=-this.y,u.z=-this.z,u.w=-this.w,u}scaleInPlace(u){return this.x*=u,this.y*=u,this.z*=u,this.w*=u,this}scale(u){return new Q(this.x*u,this.y*u,this.z*u,this.w*u)}scaleToRef(u,G){return G.x=this.x*u,G.y=this.y*u,G.z=this.z*u,G.w=this.w*u,G}scaleAndAddToRef(u,G){return G.x+=this.x*u,G.y+=this.y*u,G.z+=this.z*u,G.w+=this.w*u,G}equals(u){return u&&this.x===u.x&&this.y===u.y&&this.z===u.z&&this.w===u.w}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.e;return u&&(0,C.s)(this.x,u.x,G)&&(0,C.s)(this.y,u.y,G)&&(0,C.s)(this.z,u.z,G)&&(0,C.s)(this.w,u.w,G)}equalsToFloats(u,G,s,T){return this.x===u&&this.y===G&&this.z===s&&this.w===T}multiplyInPlace(u){return this.x*=u.x,this.y*=u.y,this.z*=u.z,this.w*=u.w,this}multiply(u){return new Q(this.x*u.x,this.y*u.y,this.z*u.z,this.w*u.w)}multiplyToRef(u,G){return G.x=this.x*u.x,G.y=this.y*u.y,G.z=this.z*u.z,G.w=this.w*u.w,G}multiplyByFloats(u,G,s,T){return new Q(this.x*u,this.y*G,this.z*s,this.w*T)}divide(u){return new Q(this.x/u.x,this.y/u.y,this.z/u.z,this.w/u.w)}divideToRef(u,G){return G.x=this.x/u.x,G.y=this.y/u.y,G.z=this.z/u.z,G.w=this.w/u.w,G}divideInPlace(u){return this.divideToRef(u,this)}minimizeInPlace(u){return u.x<this.x&&(this.x=u.x),u.y<this.y&&(this.y=u.y),u.z<this.z&&(this.z=u.z),u.w<this.w&&(this.w=u.w),this}maximizeInPlace(u){return u.x>this.x&&(this.x=u.x),u.y>this.y&&(this.y=u.y),u.z>this.z&&(this.z=u.z),u.w>this.w&&(this.w=u.w),this}minimizeInPlaceFromFloats(u,G,s,T){return this.x=Math.min(u,this.x),this.y=Math.min(G,this.y),this.z=Math.min(s,this.z),this.w=Math.min(T,this.w),this}maximizeInPlaceFromFloats(u,G,s,T){return this.x=Math.max(u,this.x),this.y=Math.max(G,this.y),this.z=Math.max(s,this.z),this.w=Math.max(T,this.w),this}floorToRef(u){return u.x=Math.floor(this.x),u.y=Math.floor(this.y),u.z=Math.floor(this.z),u.w=Math.floor(this.w),u}floor(){return new Q(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(u){return u.x=this.x-Math.floor(this.x),u.y=this.y-Math.floor(this.y),u.z=this.z-Math.floor(this.z),u.w=this.w-Math.floor(this.w),u}fract(){return new Q(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){return this.normalizeToRef(new Q)}normalizeToRef(u){const G=this.length();return 0===G||1===G?(u.x=this.x,u.y=this.y,u.z=this.z,u.w=this.w,u):this.scaleToRef(1/G,u)}toVector3(){return new b(this.x,this.y,this.z)}clone(){return new Q(this.x,this.y,this.z,this.w)}p(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this}hf(u,G,s,T){return this.x=u,this.y=G,this.z=s,this.w=T,this}set(u,G,s,T){return this.hf(u,G,s,T)}vj(u){return this.x=this.y=this.z=this.w=u,this}dot(u){return this.x*u.x+this.y*u.y+this.z*u.z+this.w*u.w}static Ag(u,G){return G||(G=0),new Q(u[G],u[G+1],u[G+2],u[G+3])}static FromArrayToRef(u,G,s){return s.x=u[G],s.y=u[G+1],s.z=u[G+2],s.w=u[G+3],s}static FromFloatArrayToRef(u,G,s){return Q.FromArrayToRef(u,G,s),s}static FromFloatsToRef(u,G,s,T,z){return z.x=u,z.y=G,z.z=s,z.w=T,z}static Zero(){return new Q(0,0,0,0)}static One(){return new Q(1,1,1,1)}static Random(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Q((0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G))}static RandomToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;return s.x=(0,C.q)(u,G),s.y=(0,C.q)(u,G),s.z=(0,C.q)(u,G),s.w=(0,C.q)(u,G),s}static Clamp(u,G,s){return Q.ClampToRef(u,G,s,new Q)}static ClampToRef(u,G,s,T){return T.x=(0,C.b)(u.x,G.x,s.x),T.y=(0,C.b)(u.y,G.y,s.y),T.z=(0,C.b)(u.z,G.z,s.z),T.w=(0,C.b)(u.w,G.w,s.w),T}static CheckExtends(u,G,s){G.minimizeInPlace(u),s.maximizeInPlace(u)}static get ZeroReadOnly(){return Q._ZeroReadOnly}static Normalize(u){return Q.NormalizeToRef(u,new Q)}static NormalizeToRef(u,G){return u.normalizeToRef(G),G}static Minimize(u,G){const s=new Q;return s.p(u),s.minimizeInPlace(G),s}static Maximize(u,G){const s=new Q;return s.p(u),s.maximizeInPlace(G),s}static Distance(u,G){return Math.sqrt(Q.DistanceSquared(u,G))}static DistanceSquared(u,G){const s=u.x-G.x,T=u.y-G.y,z=u.z-G.z,O=u.w-G.w;return s*s+T*T+z*z+O*O}static Center(u,G){return Q.CenterToRef(u,G,new Q)}static CenterToRef(u,G,s){return s.x=(u.x+G.x)/2,s.y=(u.y+G.y)/2,s.z=(u.z+G.z)/2,s.w=(u.w+G.w)/2,s}static TransformCoordinates(u,G){return Q.TransformCoordinatesToRef(u,G,new Q)}static TransformCoordinatesToRef(u,G,s){return Q.TransformCoordinatesFromFloatsToRef(u._x,u._y,u._z,G,s),s}static TransformCoordinatesFromFloatsToRef(u,G,s,T,z){const O=T.m,m=u*O[0]+G*O[4]+s*O[8]+O[12],f=u*O[1]+G*O[5]+s*O[9]+O[13],C=u*O[2]+G*O[6]+s*O[10]+O[14],x=u*O[3]+G*O[7]+s*O[11]+O[15];return z.x=m,z.y=f,z.z=C,z.w=x,z}static TransformNormal(u,G){return Q.TransformNormalToRef(u,G,new Q)}static TransformNormalToRef(u,G,s){const T=G.m,z=u.x*T[0]+u.y*T[4]+u.z*T[8],O=u.x*T[1]+u.y*T[5]+u.z*T[9],m=u.x*T[2]+u.y*T[6]+u.z*T[10];return s.x=z,s.y=O,s.z=m,s.w=u.w,s}static TransformNormalFromFloatsToRef(u,G,s,T,z,O){const m=z.m;return O.x=u*m[0]+G*m[4]+s*m[8],O.y=u*m[1]+G*m[5]+s*m[9],O.z=u*m[2]+G*m[6]+s*m[10],O.w=T,O}static FromVector3(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Q(u._x,u._y,u._z,G)}static Dot(u,G){return u.x*G.x+u.y*G.y+u.z*G.z+u.w*G.w}}Q._ZeroReadOnly=Q.Zero(),Object.defineProperties(Q.prototype,{dimension:{value:[4]},rank:{value:1}});class Y{get x(){return this._x}set x(u){this._x=u,this._isDirty=!0}get y(){return this._y}set y(u){this._y=u,this._isDirty=!0}get z(){return this._z}set z(u){this._z=u,this._isDirty=!0}get w(){return this._w}set w(u){this._w=u,this._isDirty=!0}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=u,this._y=G,this._z=s,this._w=T}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let u=x(this._x);return u=397*u^x(this._y),u=397*u^x(this._z),u=397*u^x(this._w),u}$i(){return[this._x,this._y,this._z,this._w]}toArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[G]=this._x,u[G+1]=this._y,u[G+2]=this._z,u[G+3]=this._w,this}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Y.FromArrayToRef(u,G,this)}equals(u){return u&&this._x===u._x&&this._y===u._y&&this._z===u._z&&this._w===u._w}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.e;return u&&(0,C.s)(this._x,u._x,G)&&(0,C.s)(this._y,u._y,G)&&(0,C.s)(this._z,u._z,G)&&(0,C.s)(this._w,u._w,G)}clone(){return new Y(this._x,this._y,this._z,this._w)}p(u){return this._x=u._x,this._y=u._y,this._z=u._z,this._w=u._w,this._isDirty=!0,this}hf(u,G,s,T){return this._x=u,this._y=G,this._z=s,this._w=T,this._isDirty=!0,this}set(u,G,s,T){return this.hf(u,G,s,T)}vj(u){return this.hf(u,u,u,u)}add(u){return new Y(this._x+u._x,this._y+u._y,this._z+u._z,this._w+u._w)}addInPlace(u){return this._x+=u._x,this._y+=u._y,this._z+=u._z,this._w+=u._w,this._isDirty=!0,this}addToRef(u,G){return G._x=this._x+u._x,G._y=this._y+u._y,G._z=this._z+u._z,G._w=this._w+u._w,G._isDirty=!0,G}addInPlaceFromFloats(u,G,s,T){return this._x+=u,this._y+=G,this._z+=s,this._w+=T,this._isDirty=!0,this}subtractToRef(u,G){return G._x=this._x-u._x,G._y=this._y-u._y,G._z=this._z-u._z,G._w=this._w-u._w,G._isDirty=!0,G}subtractFromFloats(u,G,s,T){return this.subtractFromFloatsToRef(u,G,s,T,new Y)}subtractFromFloatsToRef(u,G,s,T,z){return z._x=this._x-u,z._y=this._y-G,z._z=this._z-s,z._w=this._w-T,z._isDirty=!0,z}Nc(u){return new Y(this._x-u._x,this._y-u._y,this._z-u._z,this._w-u._w)}fi(u){return this._x-=u._x,this._y-=u._y,this._z-=u._z,this._w-=u._w,this._isDirty=!0,this}scale(u){return new Y(this._x*u,this._y*u,this._z*u,this._w*u)}scaleToRef(u,G){return G._x=this._x*u,G._y=this._y*u,G._z=this._z*u,G._w=this._w*u,G._isDirty=!0,G}scaleInPlace(u){return this._x*=u,this._y*=u,this._z*=u,this._w*=u,this._isDirty=!0,this}scaleAndAddToRef(u,G){return G._x+=this._x*u,G._y+=this._y*u,G._z+=this._z*u,G._w+=this._w*u,G._isDirty=!0,G}multiply(u){const G=new Y(0,0,0,1);return this.multiplyToRef(u,G),G}multiplyToRef(u,G){const s=this._x*u._w+this._y*u._z-this._z*u._y+this._w*u._x,T=-this._x*u._z+this._y*u._w+this._z*u._x+this._w*u._y,z=this._x*u._y-this._y*u._x+this._z*u._w+this._w*u._z,O=-this._x*u._x-this._y*u._y-this._z*u._z+this._w*u._w;return G.hf(s,T,z,O),G}multiplyInPlace(u){return this.multiplyToRef(u,this)}multiplyByFloats(u,G,s,T){return this._x*=u,this._y*=G,this._z*=s,this._w*=T,this._isDirty=!0,this}divide(u){throw new ReferenceError("Can not divide a quaternion")}divideToRef(u,G){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(u){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new Y)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(u){return u._x=-this._x,u._y=-this._y,u._z=-this._z,u._w=-this._w,u._isDirty=!0,u}equalsToFloats(u,G,s,T){return this._x===u&&this._y===G&&this._z===s&&this._w===T}floorToRef(u){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(u){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(u){return u.hf(-this._x,-this._y,-this._z,this._w),u}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new Y(-this._x,-this._y,-this._z,this._w)}invert(){const u=this.conjugate(),G=this.lengthSquared();return 0==G||1==G||u.scaleInPlace(1/G),u}invertInPlace(){this.conjugateInPlace();const u=this.lengthSquared();return 0==u||1==u||this.scaleInPlace(1/u),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){const u=new Y(0,0,0,1);return this.normalizeToRef(u),u}normalizeToRef(u){const G=this.length();return 0===G||1===G?u.hf(this._x,this._y,this._z,this._w):this.scaleToRef(1/G,u)}toEulerAngles(){const u=b.Zero();return this.toEulerAnglesToRef(u),u}toEulerAnglesToRef(u){const G=this._z,s=this._x,T=this._y,z=this._w,O=T*G-s*z,m=.4999999;if(O<-m)u._y=2*Math.atan2(T,z),u._x=Math.PI/2,u._z=0,u._isDirty=!0;else if(O>m)u._y=2*Math.atan2(T,z),u._x=-Math.PI/2,u._z=0,u._isDirty=!0;else{const m=z*z,f=G*G,C=s*s,x=T*T;u._z=Math.atan2(2*(s*T+G*z),-f-C+x+m),u._x=Math.asin(-2*O),u._y=Math.atan2(2*(G*s+T*z),f-C-x+m),u._isDirty=!0}return u}toAlphaBetaGammaToRef(u){const G=this._z,s=this._x,T=this._y,z=this._w,O=Math.sqrt(s*s+T*T),m=Math.sqrt(G*G+z*z),f=2*Math.atan2(O,m),C=2*Math.atan2(G,z),x=2*Math.atan2(T,s),g=(C+x)/2,b=(C-x)/2;return u.set(b,f,g),u}toRotationMatrix(u){return n.FromQuaternionToRef(this,u),u}fromRotationMatrix(u){return Y.FromRotationMatrixToRef(u,this),this}dot(u){return this._x*u._x+this._y*u._y+this._z*u._z+this._w*u._w}static FromRotationMatrix(u){const G=new Y;return Y.FromRotationMatrixToRef(u,G),G}static FromRotationMatrixToRef(u,G){const s=u.m,T=s[0],z=s[4],O=s[8],m=s[1],f=s[5],C=s[9],x=s[2],g=s[6],b=s[10],Q=T+f+b;let Y;return Q>0?(Y=.5/Math.sqrt(Q+1),G._w=.25/Y,G._x=(g-C)*Y,G._y=(O-x)*Y,G._z=(m-z)*Y,G._isDirty=!0):T>f&&T>b?(Y=2*Math.sqrt(1+T-f-b),G._w=(g-C)/Y,G._x=.25*Y,G._y=(z+m)/Y,G._z=(O+x)/Y,G._isDirty=!0):f>b?(Y=2*Math.sqrt(1+f-T-b),G._w=(O-x)/Y,G._x=(z+m)/Y,G._y=.25*Y,G._z=(C+g)/Y,G._isDirty=!0):(Y=2*Math.sqrt(1+b-T-f),G._w=(m-z)/Y,G._x=(O+x)/Y,G._y=(C+g)/Y,G._z=.25*Y,G._isDirty=!0),G}static Dot(u,G){return u._x*G._x+u._y*G._y+u._z*G._z+u._w*G._w}static AreClose(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const T=Y.Dot(u,G);return 1-T*T<=s}static SmoothToRef(u,G,s,T,z){let O=0===T?1:s/T;return O=(0,C.b)(O,0,1),Y.SlerpToRef(u,G,O,z),z}static Zero(){return new Y(0,0,0,0)}static Inverse(u){return new Y(-u._x,-u._y,-u._z,u._w)}static InverseToRef(u,G){return G.set(-u._x,-u._y,-u._z,u._w),G}static Identity(){return new Y(0,0,0,1)}static IsIdentity(u){return u&&0===u._x&&0===u._y&&0===u._z&&1===u._w}static RotationAxis(u,G){return Y.RotationAxisToRef(u,G,new Y)}static RotationAxisToRef(u,G,s){s._w=Math.cos(G/2);const T=Math.sin(G/2)/u.length();return s._x=u._x*T,s._y=u._y*T,s._z=u._z*T,s._isDirty=!0,s}static Ag(u,G){return G||(G=0),new Y(u[G],u[G+1],u[G+2],u[G+3])}static FromArrayToRef(u,G,s){return s._x=u[G],s._y=u[G+1],s._z=u[G+2],s._w=u[G+3],s._isDirty=!0,s}static FromFloatsToRef(u,G,s,T,z){return z.hf(u,G,s,T),z}static FromEulerAngles(u,G,s){const T=new Y;return Y.RotationYawPitchRollToRef(G,u,s,T),T}static FromEulerAnglesToRef(u,G,s,T){return Y.RotationYawPitchRollToRef(G,u,s,T),T}static FromEulerVector(u){const G=new Y;return Y.RotationYawPitchRollToRef(u._y,u._x,u._z,G),G}static FromEulerVectorToRef(u,G){return Y.RotationYawPitchRollToRef(u._y,u._x,u._z,G),G}static FromUnitVectorsToRef(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.e;const O=b.Dot(u,G)+1;return O<z?Math.abs(u.x)>Math.abs(u.z)?s.set(-u.y,u.x,0,0):s.set(0,-u.z,u.y,0):(b.CrossToRef(u,G,F.gb[0]),s.set(F.gb[0].x,F.gb[0].y,F.gb[0].z,O)),s.normalize()}static RotationYawPitchRoll(u,G,s){const T=new Y;return Y.RotationYawPitchRollToRef(u,G,s,T),T}static RotationYawPitchRollToRef(u,G,s,T){const z=.5*s,O=.5*G,m=.5*u,f=Math.sin(z),C=Math.cos(z),x=Math.sin(O),g=Math.cos(O),b=Math.sin(m),Q=Math.cos(m);return T._x=Q*x*C+b*g*f,T._y=b*g*C-Q*x*f,T._z=Q*g*f-b*x*C,T._w=Q*g*C+b*x*f,T._isDirty=!0,T}static RotationAlphaBetaGamma(u,G,s){const T=new Y;return Y.RotationAlphaBetaGammaToRef(u,G,s,T),T}static RotationAlphaBetaGammaToRef(u,G,s,T){const z=.5*(s+u),O=.5*(s-u),m=.5*G;return T._x=Math.cos(O)*Math.sin(m),T._y=Math.sin(O)*Math.sin(m),T._z=Math.sin(z)*Math.cos(m),T._w=Math.cos(z)*Math.cos(m),T._isDirty=!0,T}static RotationQuaternionFromAxis(u,G,s){const T=new Y(0,0,0,0);return Y.RotationQuaternionFromAxisToRef(u,G,s,T),T}static RotationQuaternionFromAxisToRef(u,G,s,T){const z=V.Matrix[0];return u=u.normalizeToRef(V.gb[0]),G=G.normalizeToRef(V.gb[1]),s=s.normalizeToRef(V.gb[2]),n.FromXYZAxesToRef(u,G,s,z),Y.FromRotationMatrixToRef(z,T),T}static FromLookDirectionLH(u,G){const s=new Y;return Y.FromLookDirectionLHToRef(u,G,s),s}static FromLookDirectionLHToRef(u,G,s){const T=V.Matrix[0];return n.LookDirectionLHToRef(u,G,T),Y.FromRotationMatrixToRef(T,s),s}static FromLookDirectionRH(u,G){const s=new Y;return Y.FromLookDirectionRHToRef(u,G,s),s}static FromLookDirectionRHToRef(u,G,s){const T=V.Matrix[0];return n.LookDirectionRHToRef(u,G,T),Y.FromRotationMatrixToRef(T,s)}static Slerp(u,G,s){const T=Y.Identity();return Y.SlerpToRef(u,G,s,T),T}static SlerpToRef(u,G,s,T){let z,O,m=u._x*G._x+u._y*G._y+u._z*G._z+u._w*G._w,f=!1;if(m<0&&(f=!0,m=-m),m>.999999)O=1-s,z=f?-s:s;else{const u=Math.acos(m),G=1/Math.sin(u);O=Math.sin((1-s)*u)*G,z=f?-Math.sin(s*u)*G:Math.sin(s*u)*G}return T._x=O*u._x+z*G._x,T._y=O*u._y+z*G._y,T._z=O*u._z+z*G._z,T._w=O*u._w+z*G._w,T._isDirty=!0,T}static Hermite(u,G,s,T,z){const O=z*z,m=z*O,f=2*m-3*O+1,C=-2*m+3*O,x=m-2*O+z,g=m-O,b=u._x*f+s._x*C+G._x*x+T._x*g,Q=u._y*f+s._y*C+G._y*x+T._y*g,n=u._z*f+s._z*C+G._z*x+T._z*g,V=u._w*f+s._w*C+G._w*x+T._w*g;return new Y(b,Q,n,V)}static Hermite1stDerivative(u,G,s,T,z){const O=new Y;return this.Hermite1stDerivativeToRef(u,G,s,T,z,O),O}static Hermite1stDerivativeToRef(u,G,s,T,z,O){const m=z*z;return O._x=6*(m-z)*u._x+(3*m-4*z+1)*G._x+6*(-m+z)*s._x+(3*m-2*z)*T._x,O._y=6*(m-z)*u._y+(3*m-4*z+1)*G._y+6*(-m+z)*s._y+(3*m-2*z)*T._y,O._z=6*(m-z)*u._z+(3*m-4*z+1)*G._z+6*(-m+z)*s._z+(3*m-2*z)*T._z,O._w=6*(m-z)*u._w+(3*m-4*z+1)*G._w+6*(-m+z)*s._w+(3*m-2*z)*T._w,O._isDirty=!0,O}static Normalize(u){const G=Y.Zero();return Y.NormalizeToRef(u,G),G}static NormalizeToRef(u,G){return u.normalizeToRef(G),G}static Clamp(u,G,s){const T=new Y;return Y.ClampToRef(u,G,s,T),T}static ClampToRef(u,G,s,T){return T.hf((0,C.b)(u.x,G.x,s.x),(0,C.b)(u.y,G.y,s.y),(0,C.b)(u.z,G.z,s.z),(0,C.b)(u.w,G.w,s.w))}static Random(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Y((0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G))}static RandomToRef(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).hf((0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G),(0,C.q)(u,G))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(u,G){return Math.sqrt(Y.DistanceSquared(u,G))}static DistanceSquared(u,G){const s=u.x-G.x,T=u.y-G.y,z=u.z-G.z,O=u.w-G.w;return s*s+T*T+z*z+O*O}static Center(u,G){return Y.CenterToRef(u,G,Y.Zero())}static CenterToRef(u,G,s){return s.hf((u.x+G.x)/2,(u.y+G.y)/2,(u.z+G.z)/2,(u.w+G.w)/2)}}Object.defineProperties(Y.prototype,{dimension:{value:[4]},rank:{value:1}});class n{static get Use64Bits(){return m.e.MatrixUse64Bits}get m(){return this.Hj}markAsUpdated(){this.updateFlag=n._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=u,this._isIdentity3x2=u||s,this._isIdentityDirty=!this._isIdentity&&G,this._isIdentity3x2Dirty=!this._isIdentity3x2&&T}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,m.e.MatrixTrackPrecisionChange&&m.e.MatrixTrackedMatrices.push(this),this.Hj=new m.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const u=this.Hj;this._isIdentity=1===u[0]&&0===u[1]&&0===u[2]&&0===u[3]&&0===u[4]&&1===u[5]&&0===u[6]&&0===u[7]&&0===u[8]&&0===u[9]&&1===u[10]&&0===u[11]&&0===u[12]&&0===u[13]&&0===u[14]&&1===u[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Hj[0]||1!==this.Hj[5]||1!==this.Hj[15]||0!==this.Hj[1]||0!==this.Hj[2]||0!==this.Hj[3]||0!==this.Hj[4]||0!==this.Hj[6]||0!==this.Hj[7]||0!==this.Hj[8]||0!==this.Hj[9]||0!==this.Hj[10]||0!==this.Hj[11]||0!==this.Hj[12]||0!==this.Hj[13]||0!==this.Hj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const u=this.Hj,G=u[0],s=u[1],T=u[2],z=u[3],O=u[4],m=u[5],f=u[6],C=u[7],x=u[8],g=u[9],b=u[10],Q=u[11],Y=u[12],n=u[13],V=u[14],F=u[15],r=b*F-V*Q,c=g*F-n*Q,j=g*V-n*b,l=x*F-Y*Q,P=x*V-b*Y,H=x*n-Y*g;return G*+(m*r-f*c+C*j)+s*-(O*r-f*l+C*P)+T*+(O*c-m*l+C*H)+z*-(O*j-m*P+f*H)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!u)return this.Hj;const s=this.Hj;for(let T=0;T<16;T++)u[G+T]=s[T];return this}$i(){return this.Hj}Oc(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return n.FromArrayToRef(u,G,this)}hf(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];return n.FromArrayToRef(G,0,this)}set(){const u=this.Hj;for(let G=0;G<16;G++)u[G]=G<0||arguments.length<=G?void 0:arguments[G];return this.markAsUpdated(),this}vj(u){const G=this.Hj;for(let s=0;s<16;s++)G[s]=u;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return n.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(u){const G=new n;return this.addToRef(u,G),G}addToRef(u,G){const s=this.Hj,T=G.Hj,z=u.m;for(let O=0;O<16;O++)T[O]=s[O]+z[O];return G.markAsUpdated(),G}addToSelf(u){const G=this.Hj,s=u.m;return G[0]+=s[0],G[1]+=s[1],G[2]+=s[2],G[3]+=s[3],G[4]+=s[4],G[5]+=s[5],G[6]+=s[6],G[7]+=s[7],G[8]+=s[8],G[9]+=s[9],G[10]+=s[10],G[11]+=s[11],G[12]+=s[12],G[13]+=s[13],G[14]+=s[14],G[15]+=s[15],this.markAsUpdated(),this}addInPlace(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]+=s[T];return this.markAsUpdated(),this}addInPlaceFromFloats(){const u=this.Hj;for(let G=0;G<16;G++)u[G]+=G<0||arguments.length<=G?void 0:arguments[G];return this.markAsUpdated(),this}Nc(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]-=s[T];return this.markAsUpdated(),this}subtractToRef(u,G){const s=this.Hj,T=u.m,z=G.Hj;for(let O=0;O<16;O++)z[O]=s[O]-T[O];return G.markAsUpdated(),G}fi(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]-=s[T];return this.markAsUpdated(),this}subtractFromFloats(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];return this.subtractFromFloatsToRef(...G,new n)}subtractFromFloatsToRef(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];const T=G.pop(),z=this.Hj,O=T.Hj,m=G;for(let f=0;f<16;f++)O[f]=z[f]-m[f];return T.markAsUpdated(),T}invertToRef(u){if(!0===this._isIdentity)return n.IdentityToRef(u),u;const G=this.Hj,s=G[0],T=G[1],z=G[2],O=G[3],m=G[4],f=G[5],C=G[6],x=G[7],g=G[8],b=G[9],Q=G[10],Y=G[11],V=G[12],F=G[13],r=G[14],c=G[15],j=Q*c-r*Y,l=b*c-F*Y,P=b*r-F*Q,H=g*c-V*Y,X=g*r-Q*V,p=g*F-V*b,q=+(f*j-C*l+x*P),d=-(m*j-C*H+x*X),v=+(m*l-f*H+x*p),W=-(m*P-f*X+C*p),M=s*q+T*d+z*v+O*W;if(0===M)return u.p(this),u;const o=1/M,R=C*c-r*x,B=f*c-F*x,D=f*r-F*C,k=m*c-V*x,w=m*r-V*C,L=m*F-V*f,S=C*Y-Q*x,e=f*Y-b*x,h=f*Q-b*C,I=m*Y-g*x,i=m*Q-g*C,J=m*b-g*f,A=-(T*j-z*l+O*P),N=+(s*j-z*H+O*X),y=-(s*l-T*H+O*p),a=+(s*P-T*X+z*p),K=+(T*R-z*B+O*D),Z=-(s*R-z*k+O*w),t=+(s*B-T*k+O*L),E=-(s*D-T*w+z*L),U=-(T*S-z*e+O*h),uu=+(s*S-z*I+O*i),Gu=-(s*e-T*I+O*J),su=+(s*h-T*i+z*J);return n.FromValuesToRef(q*o,A*o,K*o,U*o,d*o,N*o,Z*o,uu*o,v*o,y*o,t*o,Gu*o,W*o,a*o,E*o,su*o,u),u}addAtIndex(u,G){return this.Hj[u]+=G,this.markAsUpdated(),this}multiplyAtIndex(u,G){return this.Hj[u]*=G,this.markAsUpdated(),this}setTranslationFromFloats(u,G,s){return this.Hj[12]=u,this.Hj[13]=G,this.Hj[14]=s,this.markAsUpdated(),this}addTranslationFromFloats(u,G,s){return this.Hj[12]+=u,this.Hj[13]+=G,this.Hj[14]+=s,this.markAsUpdated(),this}setTranslation(u){return this.setTranslationFromFloats(u._x,u._y,u._z)}getTranslation(){return new b(this.Hj[12],this.Hj[13],this.Hj[14])}getTranslationToRef(u){return u.x=this.Hj[12],u.y=this.Hj[13],u.z=this.Hj[14],u}removeRotationAndScaling(){const u=this.m;return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,u[12],u[13],u[14],u[15],this),this._updateIdentityStatus(0===u[12]&&0===u[13]&&0===u[14]&&1===u[15]),this}p(u){u.copyToArray(this.Hj);const G=u;return this.updateFlag=G.updateFlag,this._updateIdentityStatus(G._isIdentity,G._isIdentityDirty,G._isIdentity3x2,G._isIdentity3x2Dirty),this}copyToArray(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.Hj;return u[G]=s[0],u[G+1]=s[1],u[G+2]=s[2],u[G+3]=s[3],u[G+4]=s[4],u[G+5]=s[5],u[G+6]=s[6],u[G+7]=s[7],u[G+8]=s[8],u[G+9]=s[9],u[G+10]=s[10],u[G+11]=s[11],u[G+12]=s[12],u[G+13]=s[13],u[G+14]=s[14],u[G+15]=s[15],this}multiply(u){const G=new n;return this.multiplyToRef(u,G),G}multiplyInPlace(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]*=s[T];return this.markAsUpdated(),this}multiplyByFloats(){const u=this.Hj;for(let G=0;G<16;G++)u[G]*=G<0||arguments.length<=G?void 0:arguments[G];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];const T=G.pop(),z=this.Hj,O=T.Hj,m=G;for(let f=0;f<16;f++)O[f]=z[f]*m[f];return T.markAsUpdated(),T}multiplyToRef(u,G){return this._isIdentity?(G.p(u),G):u._isIdentity?(G.p(this),G):(this.multiplyToArray(u,G.Hj,0),G.markAsUpdated(),G)}multiplyToArray(u,G,s){const T=this.Hj,z=u.m,O=T[0],m=T[1],f=T[2],C=T[3],x=T[4],g=T[5],b=T[6],Q=T[7],Y=T[8],n=T[9],V=T[10],F=T[11],r=T[12],c=T[13],j=T[14],l=T[15],P=z[0],H=z[1],X=z[2],p=z[3],q=z[4],d=z[5],v=z[6],W=z[7],M=z[8],o=z[9],R=z[10],B=z[11],D=z[12],k=z[13],w=z[14],L=z[15];return G[s]=O*P+m*q+f*M+C*D,G[s+1]=O*H+m*d+f*o+C*k,G[s+2]=O*X+m*v+f*R+C*w,G[s+3]=O*p+m*W+f*B+C*L,G[s+4]=x*P+g*q+b*M+Q*D,G[s+5]=x*H+g*d+b*o+Q*k,G[s+6]=x*X+g*v+b*R+Q*w,G[s+7]=x*p+g*W+b*B+Q*L,G[s+8]=Y*P+n*q+V*M+F*D,G[s+9]=Y*H+n*d+V*o+F*k,G[s+10]=Y*X+n*v+V*R+F*w,G[s+11]=Y*p+n*W+V*B+F*L,G[s+12]=r*P+c*q+j*M+l*D,G[s+13]=r*H+c*d+j*o+l*k,G[s+14]=r*X+c*v+j*R+l*w,G[s+15]=r*p+c*W+j*B+l*L,this}divide(u){return this.divideToRef(u,new n)}divideToRef(u,G){const s=this.Hj,T=u.m,z=G.Hj;for(let O=0;O<16;O++)z[O]=s[O]/T[O];return G.markAsUpdated(),G}divideInPlace(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]/=s[T];return this.markAsUpdated(),this}minimizeInPlace(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]=Math.min(G[T],s[T]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const u=this.Hj;for(let G=0;G<16;G++)u[G]=Math.min(u[G],G<0||arguments.length<=G?void 0:arguments[G]);return this.markAsUpdated(),this}maximizeInPlace(u){const G=this.Hj,s=u.m;for(let T=0;T<16;T++)G[T]=Math.min(G[T],s[T]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const u=this.Hj;for(let G=0;G<16;G++)u[G]=Math.min(u[G],G<0||arguments.length<=G?void 0:arguments[G]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new n)}negateInPlace(){const u=this.Hj;for(let G=0;G<16;G++)u[G]=-u[G];return this.markAsUpdated(),this}negateToRef(u){const G=this.Hj,s=u.Hj;for(let T=0;T<16;T++)s[T]=-G[T];return u.markAsUpdated(),u}equals(u){const G=u;if(!G)return!1;if((this._isIdentity||G._isIdentity)&&!this._isIdentityDirty&&!G._isIdentityDirty)return this._isIdentity&&G._isIdentity;const s=this.m,T=G.m;return s[0]===T[0]&&s[1]===T[1]&&s[2]===T[2]&&s[3]===T[3]&&s[4]===T[4]&&s[5]===T[5]&&s[6]===T[6]&&s[7]===T[7]&&s[8]===T[8]&&s[9]===T[9]&&s[10]===T[10]&&s[11]===T[11]&&s[12]===T[12]&&s[13]===T[13]&&s[14]===T[14]&&s[15]===T[15]}equalsWithEpsilon(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.Hj,T=u.m;for(let z=0;z<16;z++)if(!(0,C.s)(s[z],T[z],G))return!1;return!0}equalsToFloats(){const u=this.Hj;for(let G=0;G<16;G++)if(u[G]!=(G<0||arguments.length<=G?void 0:arguments[G]))return!1;return!0}floor(){return this.floorToRef(new n)}floorToRef(u){const G=this.Hj,s=u.Hj;for(let T=0;T<16;T++)s[T]=Math.floor(G[T]);return u.markAsUpdated(),u}fract(){return this.fractToRef(new n)}fractToRef(u){const G=this.Hj,s=u.Hj;for(let T=0;T<16;T++)s[T]=G[T]-Math.floor(G[T]);return u.markAsUpdated(),u}clone(){const u=new n;return u.p(this),u}getClassName(){return"Matrix"}getHashCode(){let u=x(this.Hj[0]);for(let G=1;G<16;G++)u=397*u^x(this.Hj[G]);return u}decomposeToTransformNode(u){return u.rotationQuaternion=u.rotationQuaternion||new Y,this.decompose(u.vf,u.rotationQuaternion,u.position)}decompose(u,G,s,T){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return s&&s.vj(0),u&&u.vj(1),G&&G.hf(0,0,0,1),!0;const O=this.Hj;if(s&&s.hf(O[12],O[13],O[14]),(u=u||V.gb[0]).x=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2]),u.y=Math.sqrt(O[4]*O[4]+O[5]*O[5]+O[6]*O[6]),u.z=Math.sqrt(O[8]*O[8]+O[9]*O[9]+O[10]*O[10]),T){const G=(z?T.absoluteScaling.x:T.vf.x)<0?-1:1,s=(z?T.absoluteScaling.y:T.vf.y)<0?-1:1,O=(z?T.absoluteScaling.z:T.vf.z)<0?-1:1;u.x*=G,u.y*=s,u.z*=O}else this.determinant()<=0&&(u.y*=-1);if(0===u._x||0===u._y||0===u._z)return G&&G.hf(0,0,0,1),!1;if(G){const s=1/u._x,T=1/u._y,z=1/u._z;n.FromValuesToRef(O[0]*s,O[1]*s,O[2]*s,0,O[4]*T,O[5]*T,O[6]*T,0,O[8]*z,O[9]*z,O[10]*z,0,0,0,0,1,V.Matrix[0]),Y.FromRotationMatrixToRef(V.Matrix[0],G)}return!0}getRow(u){if(u<0||u>3)return null;const G=4*u;return new Q(this.Hj[G+0],this.Hj[G+1],this.Hj[G+2],this.Hj[G+3])}getRowToRef(u,G){if(u>=0&&u<=3){const s=4*u;G.x=this.Hj[s+0],G.y=this.Hj[s+1],G.z=this.Hj[s+2],G.w=this.Hj[s+3]}return G}setRow(u,G){return this.setRowFromFloats(u,G.x,G.y,G.z,G.w)}transpose(){const u=new n;return n.TransposeToRef(this,u),u}transposeToRef(u){return n.TransposeToRef(this,u),u}setRowFromFloats(u,G,s,T,z){if(u<0||u>3)return this;const O=4*u;return this.Hj[O+0]=G,this.Hj[O+1]=s,this.Hj[O+2]=T,this.Hj[O+3]=z,this.markAsUpdated(),this}scale(u){const G=new n;return this.scaleToRef(u,G),G}scaleToRef(u,G){for(let s=0;s<16;s++)G.Hj[s]=this.Hj[s]*u;return G.markAsUpdated(),G}scaleAndAddToRef(u,G){for(let s=0;s<16;s++)G.Hj[s]+=this.Hj[s]*u;return G.markAsUpdated(),G}scaleInPlace(u){const G=this.Hj;for(let s=0;s<16;s++)G[s]*=u;return this.markAsUpdated(),this}toNormalMatrix(u){const G=V.Matrix[0];this.invertToRef(G),G.transposeToRef(u);const s=u.Hj;return n.FromValuesToRef(s[0],s[1],s[2],0,s[4],s[5],s[6],0,s[8],s[9],s[10],0,0,0,0,1,u),u}getRotationMatrix(){const u=new n;return this.getRotationMatrixToRef(u),u}getRotationMatrixToRef(u){const G=V.gb[0];if(!this.decompose(G))return n.IdentityToRef(u),u;const s=this.Hj,T=1/G._x,z=1/G._y,O=1/G._z;return n.FromValuesToRef(s[0]*T,s[1]*T,s[2]*T,0,s[4]*z,s[5]*z,s[6]*z,0,s[8]*O,s[9]*O,s[10]*O,0,0,0,0,1,u),u}toggleModelMatrixHandInPlace(){const u=this.Hj;return u[2]*=-1,u[6]*=-1,u[8]*=-1,u[9]*=-1,u[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const u=this.Hj;return u[8]*=-1,u[9]*=-1,u[10]*=-1,u[11]*=-1,this.markAsUpdated(),this}static Ag(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=new n;return n.FromArrayToRef(u,G,s),s}static FromArrayToRef(u,G,s){for(let T=0;T<16;T++)s.Hj[T]=u[T+G];return s.markAsUpdated(),s}static FromFloat32ArrayToRefScaled(u,G,s,T){return T.Hj[0]=u[0+G]*s,T.Hj[1]=u[1+G]*s,T.Hj[2]=u[2+G]*s,T.Hj[3]=u[3+G]*s,T.Hj[4]=u[4+G]*s,T.Hj[5]=u[5+G]*s,T.Hj[6]=u[6+G]*s,T.Hj[7]=u[7+G]*s,T.Hj[8]=u[8+G]*s,T.Hj[9]=u[9+G]*s,T.Hj[10]=u[10+G]*s,T.Hj[11]=u[11+G]*s,T.Hj[12]=u[12+G]*s,T.Hj[13]=u[13+G]*s,T.Hj[14]=u[14+G]*s,T.Hj[15]=u[15+G]*s,T.markAsUpdated(),T}static get IdentityReadOnly(){return n._IdentityReadOnly}static FromValuesToRef(u,G,s,T,z,O,m,f,C,x,g,b,Q,Y,n,V,F){const r=F.Hj;r[0]=u,r[1]=G,r[2]=s,r[3]=T,r[4]=z,r[5]=O,r[6]=m,r[7]=f,r[8]=C,r[9]=x,r[10]=g,r[11]=b,r[12]=Q,r[13]=Y,r[14]=n,r[15]=V,F.markAsUpdated()}static FromValues(u,G,s,T,z,O,m,f,C,x,g,b,Q,Y,V,F){const r=new n,c=r.Hj;return c[0]=u,c[1]=G,c[2]=s,c[3]=T,c[4]=z,c[5]=O,c[6]=m,c[7]=f,c[8]=C,c[9]=x,c[10]=g,c[11]=b,c[12]=Q,c[13]=Y,c[14]=V,c[15]=F,r.markAsUpdated(),r}static Compose(u,G,s){const T=new n;return n.ComposeToRef(u,G,s,T),T}static ComposeToRef(u,G,s,T){const z=T.Hj,O=G._x,m=G._y,f=G._z,C=G._w,x=O+O,g=m+m,b=f+f,Q=O*x,Y=O*g,n=O*b,V=m*g,F=m*b,r=f*b,c=C*x,j=C*g,l=C*b,P=u._x,H=u._y,X=u._z;return z[0]=(1-(V+r))*P,z[1]=(Y+l)*P,z[2]=(n-j)*P,z[3]=0,z[4]=(Y-l)*H,z[5]=(1-(Q+r))*H,z[6]=(F+c)*H,z[7]=0,z[8]=(n+j)*X,z[9]=(F-c)*X,z[10]=(1-(Q+V))*X,z[11]=0,z[12]=s._x,z[13]=s._y,z[14]=s._z,z[15]=1,T.markAsUpdated(),T}static Identity(){const u=n.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return u._updateIdentityStatus(!0),u}static IdentityToRef(u){return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,u),u._updateIdentityStatus(!0),u}static Zero(){const u=n.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return u._updateIdentityStatus(!1),u}static RotationX(u){const G=new n;return n.RotationXToRef(u,G),G}static Invert(u){const G=new n;return u.invertToRef(G),G}static RotationXToRef(u,G){const s=Math.sin(u),T=Math.cos(u);return n.FromValuesToRef(1,0,0,0,0,T,s,0,0,-s,T,0,0,0,0,1,G),G._updateIdentityStatus(1===T&&0===s),G}static RotationY(u){const G=new n;return n.RotationYToRef(u,G),G}static RotationYToRef(u,G){const s=Math.sin(u),T=Math.cos(u);return n.FromValuesToRef(T,0,-s,0,0,1,0,0,s,0,T,0,0,0,0,1,G),G._updateIdentityStatus(1===T&&0===s),G}static RotationZ(u){const G=new n;return n.RotationZToRef(u,G),G}static RotationZToRef(u,G){const s=Math.sin(u),T=Math.cos(u);return n.FromValuesToRef(T,s,0,0,-s,T,0,0,0,0,1,0,0,0,0,1,G),G._updateIdentityStatus(1===T&&0===s),G}static RotationAxis(u,G){const s=new n;return n.RotationAxisToRef(u,G,s),s}static RotationAxisToRef(u,G,s){const T=Math.sin(-G),z=Math.cos(-G),O=1-z;u=u.normalizeToRef(V.gb[0]);const m=s.Hj;return m[0]=u._x*u._x*O+z,m[1]=u._x*u._y*O-u._z*T,m[2]=u._x*u._z*O+u._y*T,m[3]=0,m[4]=u._y*u._x*O+u._z*T,m[5]=u._y*u._y*O+z,m[6]=u._y*u._z*O-u._x*T,m[7]=0,m[8]=u._z*u._x*O-u._y*T,m[9]=u._z*u._y*O+u._x*T,m[10]=u._z*u._z*O+z,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,s.markAsUpdated(),s}static RotationAlignToRef(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=b.Dot(G,u),m=s.Hj;if(O<-1+T.e)m[0]=-1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=z?1:-1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=z?-1:1,m[11]=0;else{const s=b.Cross(G,u),T=1/(1+O);m[0]=s._x*s._x*T+O,m[1]=s._y*s._x*T-s._z,m[2]=s._z*s._x*T+s._y,m[3]=0,m[4]=s._x*s._y*T+s._z,m[5]=s._y*s._y*T+O,m[6]=s._z*s._y*T-s._x,m[7]=0,m[8]=s._x*s._z*T-s._y,m[9]=s._y*s._z*T+s._x,m[10]=s._z*s._z*T+O,m[11]=0}return m[12]=0,m[13]=0,m[14]=0,m[15]=1,s.markAsUpdated(),s}static RotationYawPitchRoll(u,G,s){const T=new n;return n.RotationYawPitchRollToRef(u,G,s,T),T}static RotationYawPitchRollToRef(u,G,s,T){return Y.RotationYawPitchRollToRef(u,G,s,V.Quaternion[0]),V.Quaternion[0].toRotationMatrix(T),T}static Scaling(u,G,s){const T=new n;return n.ScalingToRef(u,G,s,T),T}static ScalingToRef(u,G,s,T){return n.FromValuesToRef(u,0,0,0,0,G,0,0,0,0,s,0,0,0,0,1,T),T._updateIdentityStatus(1===u&&1===G&&1===s),T}static Translation(u,G,s){const T=new n;return n.TranslationToRef(u,G,s,T),T}static TranslationToRef(u,G,s,T){return n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,u,G,s,1,T),T._updateIdentityStatus(0===u&&0===G&&0===s),T}static Lerp(u,G,s){const T=new n;return n.LerpToRef(u,G,s,T),T}static LerpToRef(u,G,s,T){const z=T.Hj,O=u.m,m=G.m;for(let f=0;f<16;f++)z[f]=O[f]*(1-s)+m[f]*s;return T.markAsUpdated(),T}static DecomposeLerp(u,G,s){const T=new n;return n.DecomposeLerpToRef(u,G,s,T),T}static DecomposeLerpToRef(u,G,s,T){const z=V.gb[0],O=V.Quaternion[0],m=V.gb[1];u.decompose(z,O,m);const f=V.gb[2],C=V.Quaternion[1],x=V.gb[3];G.decompose(f,C,x);const g=V.gb[4];b.LerpToRef(z,f,s,g);const Q=V.Quaternion[2];Y.SlerpToRef(O,C,s,Q);const F=V.gb[5];return b.LerpToRef(m,x,s,F),n.ComposeToRef(g,Q,F,T),T}static LookAtLH(u,G,s){const T=new n;return n.LookAtLHToRef(u,G,s,T),T}static LookAtLHToRef(u,G,s,T){const z=V.gb[0],O=V.gb[1],m=V.gb[2];G.subtractToRef(u,m),m.normalize(),b.CrossToRef(s,m,z);const f=z.lengthSquared();0===f?z.x=1:z.normalizeFromLength(Math.sqrt(f)),b.CrossToRef(m,z,O),O.normalize();const C=-b.Dot(z,u),x=-b.Dot(O,u),g=-b.Dot(m,u);return n.FromValuesToRef(z._x,O._x,m._x,0,z._y,O._y,m._y,0,z._z,O._z,m._z,0,C,x,g,1,T),T}static LookAtRH(u,G,s){const T=new n;return n.LookAtRHToRef(u,G,s,T),T}static LookAtRHToRef(u,G,s,T){const z=V.gb[0],O=V.gb[1],m=V.gb[2];u.subtractToRef(G,m),m.normalize(),b.CrossToRef(s,m,z);const f=z.lengthSquared();0===f?z.x=1:z.normalizeFromLength(Math.sqrt(f)),b.CrossToRef(m,z,O),O.normalize();const C=-b.Dot(z,u),x=-b.Dot(O,u),g=-b.Dot(m,u);return n.FromValuesToRef(z._x,O._x,m._x,0,z._y,O._y,m._y,0,z._z,O._z,m._z,0,C,x,g,1,T),T}static LookDirectionLH(u,G){const s=new n;return n.LookDirectionLHToRef(u,G,s),s}static LookDirectionLHToRef(u,G,s){const T=V.gb[0];T.p(u),T.scaleInPlace(-1);const z=V.gb[1];return b.CrossToRef(G,T,z),n.FromValuesToRef(z._x,z._y,z._z,0,G._x,G._y,G._z,0,T._x,T._y,T._z,0,0,0,0,1,s),s}static LookDirectionRH(u,G){const s=new n;return n.LookDirectionRHToRef(u,G,s),s}static LookDirectionRHToRef(u,G,s){const T=V.gb[2];return b.CrossToRef(G,u,T),n.FromValuesToRef(T._x,T._y,T._z,0,G._x,G._y,G._z,0,u._x,u._y,u._z,0,0,0,0,1,s),s}static OrthoLH(u,G,s,T,z){const O=new n;return n.OrthoLHToRef(u,G,s,T,O,z),O}static OrthoLHToRef(u,G,s,T,z,O){const m=2/u,f=2/G,C=2/(T-s),x=-(T+s)/(T-s);return n.FromValuesToRef(m,0,0,0,0,f,0,0,0,0,C,0,0,0,x,1,z),O&&z.multiplyToRef(r,z),z._updateIdentityStatus(1===m&&1===f&&1===C&&0===x),z}static OrthoOffCenterLH(u,G,s,T,z,O,m){const f=new n;return n.OrthoOffCenterLHToRef(u,G,s,T,z,O,f,m),f}static OrthoOffCenterLHToRef(u,G,s,T,z,O,m,f){const C=2/(G-u),x=2/(T-s),g=2/(O-z),b=-(O+z)/(O-z),Q=(u+G)/(u-G),Y=(T+s)/(s-T);return n.FromValuesToRef(C,0,0,0,0,x,0,0,0,0,g,0,Q,Y,b,1,m),f&&m.multiplyToRef(r,m),m.markAsUpdated(),m}static ObliqueOffCenterLHToRef(u,G,s,T,z,O,m,f,C,x,g){const b=-m*Math.cos(f),Q=-m*Math.sin(f);return n.TranslationToRef(0,0,-C,V.Matrix[1]),n.FromValuesToRef(1,0,0,0,0,1,0,0,b,Q,1,0,0,0,0,1,V.Matrix[0]),V.Matrix[1].multiplyToRef(V.Matrix[0],V.Matrix[0]),n.TranslationToRef(0,0,C,V.Matrix[1]),V.Matrix[0].multiplyToRef(V.Matrix[1],V.Matrix[0]),n.OrthoOffCenterLHToRef(u,G,s,T,z,O,x,g),V.Matrix[0].multiplyToRef(x,x),x}static OrthoOffCenterRH(u,G,s,T,z,O,m){const f=new n;return n.OrthoOffCenterRHToRef(u,G,s,T,z,O,f,m),f}static OrthoOffCenterRHToRef(u,G,s,T,z,O,m,f){return n.OrthoOffCenterLHToRef(u,G,s,T,z,O,m,f),m.Hj[10]*=-1,m}static ObliqueOffCenterRHToRef(u,G,s,T,z,O,m,f,C,x,g){const b=m*Math.cos(f),Q=m*Math.sin(f);return n.TranslationToRef(0,0,C,V.Matrix[1]),n.FromValuesToRef(1,0,0,0,0,1,0,0,b,Q,1,0,0,0,0,1,V.Matrix[0]),V.Matrix[1].multiplyToRef(V.Matrix[0],V.Matrix[0]),n.TranslationToRef(0,0,-C,V.Matrix[1]),V.Matrix[0].multiplyToRef(V.Matrix[1],V.Matrix[0]),n.OrthoOffCenterRHToRef(u,G,s,T,z,O,x,g),V.Matrix[0].multiplyToRef(x,x),x}static PerspectiveLH(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const m=new n,f=2*s/u,C=2*s/G,x=(T+s)/(T-s),g=-2*T*s/(T-s),b=Math.tan(O);return n.FromValuesToRef(f,0,0,0,0,C,0,b,0,0,x,1,0,0,g,0,m),z&&m.multiplyToRef(r,m),m._updateIdentityStatus(!1),m}static PerspectiveFovLH(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const f=new n;return n.PerspectiveFovLHToRef(u,G,s,T,f,!0,z,O,m),f}static PerspectiveFovLHToRef(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const x=s,g=T,b=1/Math.tan(.5*u),Q=O?b/G:b,Y=O?b:b*G,V=C&&0===x?-1:0!==g?(g+x)/(g-x):1,F=C&&0===x?2*g:0!==g?-2*g*x/(g-x):-2*x,c=Math.tan(f);return n.FromValuesToRef(Q,0,0,0,0,Y,0,c,0,0,V,1,0,0,F,0,z),m&&z.multiplyToRef(r,z),z._updateIdentityStatus(!1),z}static PerspectiveFovReverseLHToRef(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const C=1/Math.tan(.5*u),x=O?C/G:C,g=O?C:C*G,b=Math.tan(f);return n.FromValuesToRef(x,0,0,0,0,g,0,b,0,0,-s,1,0,0,1,0,z),m&&z.multiplyToRef(r,z),z._updateIdentityStatus(!1),z}static PerspectiveFovRH(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const f=new n;return n.PerspectiveFovRHToRef(u,G,s,T,f,!0,z,O,m),f}static PerspectiveFovRHToRef(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const x=s,g=T,b=1/Math.tan(.5*u),Q=O?b/G:b,Y=O?b:b*G,V=C&&0===x?1:0!==g?-(g+x)/(g-x):-1,F=C&&0===x?2*g:0!==g?-2*g*x/(g-x):-2*x,c=Math.tan(f);return n.FromValuesToRef(Q,0,0,0,0,Y,0,c,0,0,V,-1,0,0,F,0,z),m&&z.multiplyToRef(r,z),z._updateIdentityStatus(!1),z}static PerspectiveFovReverseRHToRef(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const C=1/Math.tan(.5*u),x=O?C/G:C,g=O?C:C*G,b=Math.tan(f);return n.FromValuesToRef(x,0,0,0,0,g,0,b,0,0,-s,-1,0,0,-1,0,z),m&&z.multiplyToRef(r,z),z._updateIdentityStatus(!1),z}static GetFinalMatrix(u,G,s,T,z,O){const m=u.width,f=u.height,C=u.x,x=u.y,g=n.FromValues(m/2,0,0,0,0,-f/2,0,0,0,0,O-z,0,C+m/2,f/2+x,z,1),b=new n;return G.multiplyToRef(s,b),b.multiplyToRef(T,b),b.multiplyToRef(g,b)}static GetAsMatrix2x2(u){const G=u.m,s=[G[0],G[1],G[4],G[5]];return m.e.MatrixUse64Bits?s:new Float32Array(s)}static GetAsMatrix3x3(u){const G=u.m,s=[G[0],G[1],G[2],G[4],G[5],G[6],G[8],G[9],G[10]];return m.e.MatrixUse64Bits?s:new Float32Array(s)}static Transpose(u){const G=new n;return n.TransposeToRef(u,G),G}static TransposeToRef(u,G){const s=u.m,T=s[0],z=s[4],O=s[8],m=s[12],f=s[1],C=s[5],x=s[9],g=s[13],b=s[2],Q=s[6],Y=s[10],n=s[14],V=s[3],F=s[7],r=s[11],c=s[15],j=G.Hj;return j[0]=T,j[1]=z,j[2]=O,j[3]=m,j[4]=f,j[5]=C,j[6]=x,j[7]=g,j[8]=b,j[9]=Q,j[10]=Y,j[11]=n,j[12]=V,j[13]=F,j[14]=r,j[15]=c,G.markAsUpdated(),G._updateIdentityStatus(u._isIdentity,u._isIdentityDirty),G}static Reflection(u){const G=new n;return n.ReflectionToRef(u,G),G}static ReflectionToRef(u,G){u.normalize();const s=u.ab.x,T=u.ab.y,z=u.ab.z,O=-2*s,m=-2*T,f=-2*z;return n.FromValuesToRef(O*s+1,m*s,f*s,0,O*T,m*T+1,f*T,0,O*z,m*z,f*z+1,0,O*u.d,m*u.d,f*u.d,1,G),G}static FromXYZAxesToRef(u,G,s,T){return n.FromValuesToRef(u._x,u._y,u._z,0,G._x,G._y,G._z,0,s._x,s._y,s._z,0,0,0,0,1,T),T}static FromQuaternionToRef(u,G){const s=u._x*u._x,T=u._y*u._y,z=u._z*u._z,O=u._x*u._y,m=u._z*u._w,f=u._z*u._x,C=u._y*u._w,x=u._y*u._z,g=u._x*u._w;return G.Hj[0]=1-2*(T+z),G.Hj[1]=2*(O+m),G.Hj[2]=2*(f-C),G.Hj[3]=0,G.Hj[4]=2*(O-m),G.Hj[5]=1-2*(z+s),G.Hj[6]=2*(x+g),G.Hj[7]=0,G.Hj[8]=2*(f+C),G.Hj[9]=2*(x-g),G.Hj[10]=1-2*(T+s),G.Hj[11]=0,G.Hj[12]=0,G.Hj[13]=0,G.Hj[14]=0,G.Hj[15]=1,G.markAsUpdated(),G}}n._UpdateFlagSeed=0,n._IdentityReadOnly=n.Identity(),Object.defineProperties(n.prototype,{dimension:{value:[4,4]},rank:{value:2}});class V{}V.gb=(0,z.d)(11,b.Zero),V.Matrix=(0,z.d)(2,n.Identity),V.Quaternion=(0,z.d)(3,Y.Zero);class F{}F.Vector2=(0,z.d)(3,g.Zero),F.gb=(0,z.d)(13,b.Zero),F.Vector4=(0,z.d)(3,Q.Zero),F.Quaternion=(0,z.d)(3,Y.Zero),F.Matrix=(0,z.d)(8,n.Identity),(0,O.g)("BABYLON.Vector2",g),(0,O.g)("BABYLON.Vector3",b),(0,O.g)("BABYLON.Vector4",Q),(0,O.g)("BABYLON.Matrix",n);const r=n.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11170:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});class T{constructor(u,G,s,T){this.x=u,this.y=G,this.width=s,this.height=T}toGlobal(u,G){return new T(this.x*u,this.y*G,this.width*u,this.height*G)}toGlobalToRef(u,G,s){return s.x=this.x*u,s.y=this.y*G,s.width=this.width*u,s.height=this.height*G,this}clone(){return new T(this.x,this.y,this.width,this.height)}}},11378:(u,G,s)=>{"use strict";s.d(G,{e:()=>x,h:()=>g});var T=s(10904),z=s(11380);const O=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],m=[()=>1,u=>u.y,u=>u.z,u=>u.x,u=>u.x*u.y,u=>u.y*u.z,u=>3*u.z*u.z-1,u=>u.x*u.z,u=>u.x*u.x-u.y*u.y],f=(u,G)=>O[u]*m[u](G),C=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class x{constructor(){this.preScaled=!1,this.l00=T.q.Zero(),this.l1_1=T.q.Zero(),this.l10=T.q.Zero(),this.l11=T.q.Zero(),this.l2_2=T.q.Zero(),this.l2_1=T.q.Zero(),this.l20=T.q.Zero(),this.l21=T.q.Zero(),this.l22=T.q.Zero()}addLight(u,G,s){z.b.gb[0].set(G.r,G.g,G.b);const T=z.b.gb[0],O=z.b.gb[1];T.scaleToRef(s,O),O.scaleToRef(f(0,u),z.b.gb[2]),this.l00.addInPlace(z.b.gb[2]),O.scaleToRef(f(1,u),z.b.gb[2]),this.l1_1.addInPlace(z.b.gb[2]),O.scaleToRef(f(2,u),z.b.gb[2]),this.l10.addInPlace(z.b.gb[2]),O.scaleToRef(f(3,u),z.b.gb[2]),this.l11.addInPlace(z.b.gb[2]),O.scaleToRef(f(4,u),z.b.gb[2]),this.l2_2.addInPlace(z.b.gb[2]),O.scaleToRef(f(5,u),z.b.gb[2]),this.l2_1.addInPlace(z.b.gb[2]),O.scaleToRef(f(6,u),z.b.gb[2]),this.l20.addInPlace(z.b.gb[2]),O.scaleToRef(f(7,u),z.b.gb[2]),this.l21.addInPlace(z.b.gb[2]),O.scaleToRef(f(8,u),z.b.gb[2]),this.l22.addInPlace(z.b.gb[2])}scaleInPlace(u){this.l00.scaleInPlace(u),this.l1_1.scaleInPlace(u),this.l10.scaleInPlace(u),this.l11.scaleInPlace(u),this.l2_2.scaleInPlace(u),this.l2_1.scaleInPlace(u),this.l20.scaleInPlace(u),this.l21.scaleInPlace(u),this.l22.scaleInPlace(u)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(C[0]),this.l1_1.scaleInPlace(C[1]),this.l10.scaleInPlace(C[2]),this.l11.scaleInPlace(C[3]),this.l2_2.scaleInPlace(C[4]),this.l2_1.scaleInPlace(C[5]),this.l20.scaleInPlace(C[6]),this.l21.scaleInPlace(C[7]),this.l22.scaleInPlace(C[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(O[0]),this.l1_1.scaleInPlace(O[1]),this.l10.scaleInPlace(O[2]),this.l11.scaleInPlace(O[3]),this.l2_2.scaleInPlace(O[4]),this.l2_1.scaleInPlace(O[5]),this.l20.scaleInPlace(O[6]),this.l21.scaleInPlace(O[7]),this.l22.scaleInPlace(O[8])}updateFromArray(u){return T.q.FromArrayToRef(u[0],0,this.l00),T.q.FromArrayToRef(u[1],0,this.l1_1),T.q.FromArrayToRef(u[2],0,this.l10),T.q.FromArrayToRef(u[3],0,this.l11),T.q.FromArrayToRef(u[4],0,this.l2_2),T.q.FromArrayToRef(u[5],0,this.l2_1),T.q.FromArrayToRef(u[6],0,this.l20),T.q.FromArrayToRef(u[7],0,this.l21),T.q.FromArrayToRef(u[8],0,this.l22),this}updateFromFloatsArray(u){return T.q.FromFloatsToRef(u[0],u[1],u[2],this.l00),T.q.FromFloatsToRef(u[3],u[4],u[5],this.l1_1),T.q.FromFloatsToRef(u[6],u[7],u[8],this.l10),T.q.FromFloatsToRef(u[9],u[10],u[11],this.l11),T.q.FromFloatsToRef(u[12],u[13],u[14],this.l2_2),T.q.FromFloatsToRef(u[15],u[16],u[17],this.l2_1),T.q.FromFloatsToRef(u[18],u[19],u[20],this.l20),T.q.FromFloatsToRef(u[21],u[22],u[23],this.l21),T.q.FromFloatsToRef(u[24],u[25],u[26],this.l22),this}static Ag(u){return(new x).updateFromArray(u)}static FromPolynomial(u){const G=new x;return G.l00=u.xx.scale(.376127).add(u.yy.scale(.376127)).add(u.zz.scale(.376126)),G.l1_1=u.y.scale(.977204),G.l10=u.z.scale(.977204),G.l11=u.x.scale(.977204),G.l2_2=u.xy.scale(1.16538),G.l2_1=u.yz.scale(1.16538),G.l20=u.zz.scale(1.34567).Nc(u.xx.scale(.672834)).Nc(u.yy.scale(.672834)),G.l21=u.zx.scale(1.16538),G.l22=u.xx.scale(1.16538).Nc(u.yy.scale(1.16538)),G.l1_1.scaleInPlace(-1),G.l11.scaleInPlace(-1),G.l2_1.scaleInPlace(-1),G.l21.scaleInPlace(-1),G.scaleInPlace(Math.PI),G}}class g{constructor(){this.x=T.q.Zero(),this.y=T.q.Zero(),this.z=T.q.Zero(),this.xx=T.q.Zero(),this.yy=T.q.Zero(),this.zz=T.q.Zero(),this.xy=T.q.Zero(),this.yz=T.q.Zero(),this.zx=T.q.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=x.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(u){z.b.gb[0].hf(u.r,u.g,u.b);const G=z.b.gb[0];this.xx.addInPlace(G),this.yy.addInPlace(G),this.zz.addInPlace(G)}scaleInPlace(u){this.x.scaleInPlace(u),this.y.scaleInPlace(u),this.z.scaleInPlace(u),this.xx.scaleInPlace(u),this.yy.scaleInPlace(u),this.zz.scaleInPlace(u),this.yz.scaleInPlace(u),this.zx.scaleInPlace(u),this.xy.scaleInPlace(u)}updateFromHarmonics(u){return this._harmonics=u,this.x.p(u.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(u.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(u.l10),this.z.scaleInPlace(1.02333),this.xx.p(u.l00),z.b.gb[0].p(u.l20).scaleInPlace(.247708),z.b.gb[1].p(u.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).fi(z.b.gb[0]).addInPlace(z.b.gb[1]),this.yy.p(u.l00),this.yy.scaleInPlace(.886277).fi(z.b.gb[0]).fi(z.b.gb[1]),this.zz.p(u.l00),z.b.gb[0].p(u.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(z.b.gb[0]),this.yz.p(u.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(u.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(u.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(u){return(new g).updateFromHarmonics(u)}static Ag(u){const G=new g;return T.q.FromArrayToRef(u[0],0,G.x),T.q.FromArrayToRef(u[1],0,G.y),T.q.FromArrayToRef(u[2],0,G.z),T.q.FromArrayToRef(u[3],0,G.xx),T.q.FromArrayToRef(u[4],0,G.yy),T.q.FromArrayToRef(u[5],0,G.zz),T.q.FromArrayToRef(u[6],0,G.yz),T.q.FromArrayToRef(u[7],0,G.zx),T.q.FromArrayToRef(u[8],0,G.xy),G}}},11219:(u,G,s)=>{"use strict";s.d(G,{e:()=>x});var T=s(10904),z=s(10930),O=s(11148),m=s(11173),f=s(11121);s(11226);function C(u){let G=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],O=[];let C=[];const x=u.width||u.size||1,g=u.height||u.size||1,b=u.depth||u.size||1,Q=u.wrap||!1;let Y=void 0===u.topBaseAt?1:u.topBaseAt,n=void 0===u.bottomBaseAt?0:u.bottomBaseAt;Y=(Y+4)%4,n=(n+4)%4;let V=[2,0,3,1][Y],F=[2,0,1,3][n],r=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Q){G=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],r=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let u=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],s=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const T=[17,18,19,16],z=[22,23,20,21];for(;V>0;)u.unshift(u.pop()),T.unshift(T.pop()),V--;for(;F>0;)s.unshift(s.pop()),z.unshift(z.pop()),F--;u=u.flat(),s=s.flat(),r=r.concat(u).concat(s),G.push(T[0],T[2],T[3],T[0],T[1],T[2]),G.push(z[0],z[2],z[3],z[0],z[1],z[2])}const c=[x/2,g/2,b/2];C=r.reduce(((u,G,s)=>u.concat(G*c[s%3])),[]);const j=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,l=u.faceUV||new Array(6),P=u.faceColors,H=[];for(let m=0;m<6;m++)void 0===l[m]&&(l[m]=new T.s(0,0,1,1)),P&&void 0===P[m]&&(P[m]=new z.e(1,1,1,1));for(let T=0;T<6;T++)if(O.push(l[T].z,f.e?1-l[T].w:l[T].w),O.push(l[T].x,f.e?1-l[T].w:l[T].w),O.push(l[T].x,f.e?1-l[T].y:l[T].y),O.push(l[T].z,f.e?1-l[T].y:l[T].y),P)for(let u=0;u<4;u++)H.push(P[T].r,P[T].g,P[T].b,P[T].a);m.b._ComputeSides(j,C,G,s,O,u.frontUVs,u.backUVs);const X=new m.b;if(X.indices=G,X.xa=C,X.ya=s,X.Aa=O,P){const u=j===m.b.DOUBLESIDE?H.concat(H):H;X.za=u}return X}function x(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new O.c(u,s);G.sideOrientation=O.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return C(G).Ca(T,G.updatable),T}m.b.CreateBox=C,O.c.CreateBox=function(u,G){return x(u,{size:G,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11534:(u,G,s)=>{"use strict";s.d(G,{d:()=>f});var T=s(11148),z=s(11173),O=s(11121);function m(u){const G=[],s=[],T=[],m=[],f=u.i||.5,C=u.Nk||64,x=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,g=0===u.sideOrientation?0:u.sideOrientation||z.b.DEFAULTSIDE;G.push(0,0,0),m.push(.5,.5);const b=2*Math.PI*x,Q=1===x?b/C:b/(C-1);let Y=0;for(let z=0;z<C;z++){const u=Math.cos(Y),s=Math.sin(Y),T=(u+1)/2,z=(1-s)/2;G.push(f*u,f*s,0),m.push(T,O.e?1-z:z),Y+=Q}1===x&&(G.push(G[3],G[4],G[5]),m.push(m[2],O.e?1-m[3]:m[3]));const n=G.length/3;for(let z=1;z<n-1;z++)s.push(z+1,0,z);z.b.ComputeNormals(G,s,T),z.b._ComputeSides(g,G,s,T,m,u.frontUVs,u.backUVs);const V=new z.b;return V.indices=s,V.xa=G,V.ya=T,V.Aa=m,V}function f(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new T.c(u,s);G.sideOrientation=T.c._GetDefaultSideOrientation(G.sideOrientation),z._originalBuilderSideOrientation=G.sideOrientation;return m(G).Ca(z,G.updatable),z}z.b.pb=m,T.c.pb=function(u,G,s){return f(u,{i:G,Nk:s,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11226:(u,G,s)=>{"use strict";s.d(G,{e:()=>F,d:()=>c,h:()=>r});var T=s(10904),z=s(10930),O=s(11148),m=s(11173),f=s(10961);O.c._GroundMeshParser=(u,G)=>C.Parse(u,G);class C extends O.c{constructor(u,G){super(u,G),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=u,this._subdivisionsY=u,this.subdivide(u);const s=this;s.createOrUpdateSubmeshesOctree&&s.createOrUpdateSubmeshesOctree(G)}getHeightAtCoordinates(u,G){const s=this.getWorldMatrix(),z=T.l.Matrix[5];s.invertToRef(z);const O=T.l.gb[8];if(T.q.TransformCoordinatesFromFloatsToRef(u,0,G,z,O),u=O.x,G=O.z,u<this._minX||u>=this._maxX||G<=this._minZ||G>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const m=this._getFacetAt(u,G),f=-(m.x*u+m.z*G+m.w)/m.y;return T.q.TransformCoordinatesFromFloatsToRef(0,f,0,s,O),O.y}getNormalAtCoordinates(u,G){const s=new T.q(0,1,0);return this.getNormalAtCoordinatesToRef(u,G,s),s}getNormalAtCoordinatesToRef(u,G,s){const z=this.getWorldMatrix(),O=T.l.Matrix[5];z.invertToRef(O);const m=T.l.gb[8];if(T.q.TransformCoordinatesFromFloatsToRef(u,0,G,O,m),u=m.x,G=m.z,u<this._minX||u>this._maxX||G<this._minZ||G>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(u,G);return T.q.TransformNormalFromFloatsToRef(f.x,f.y,f.z,z,s),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(u,G){const s=Math.floor((u+this._maxX)*this._subdivisionsX/this._width),T=Math.floor(-(G+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),z=this._heightQuads[T*this._subdivisionsX+s];let O;return O=G<z.slope.x*u+z.slope.y?z.facet1:z.facet2,O}_initHeightQuads(){const u=this._subdivisionsX,G=this._subdivisionsY;this._heightQuads=new Array;for(let s=0;s<G;s++)for(let G=0;G<u;G++){const z={slope:T.m.Zero(),facet1:new T.s(0,0,0,0),facet2:new T.s(0,0,0,0)};this._heightQuads[s*u+G]=z}return this}_computeHeightQuads(){const u=this.getVerticesData(f.f.PositionKind);if(!u)return this;const G=T.l.gb[3],s=T.l.gb[2],z=T.l.gb[1],O=T.l.gb[0],m=T.l.gb[4],C=T.l.gb[5],x=T.l.gb[6],g=T.l.gb[7],b=T.l.gb[8];let Q=0,Y=0,n=0,V=0,F=0,r=0,c=0;const j=this._subdivisionsX,l=this._subdivisionsY;for(let f=0;f<l;f++)for(let l=0;l<j;l++){Q=3*l,Y=f*(j+1)*3,n=(f+1)*(j+1)*3,G.x=u[Y+Q],G.y=u[Y+Q+1],G.z=u[Y+Q+2],s.x=u[Y+Q+3],s.y=u[Y+Q+4],s.z=u[Y+Q+5],z.x=u[n+Q],z.y=u[n+Q+1],z.z=u[n+Q+2],O.x=u[n+Q+3],O.y=u[n+Q+4],O.z=u[n+Q+5],V=(O.z-G.z)/(O.x-G.x),F=G.z-V*G.x,s.subtractToRef(G,m),z.subtractToRef(G,C),O.subtractToRef(G,x),T.q.CrossToRef(x,C,g),T.q.CrossToRef(m,x,b),g.normalize(),b.normalize(),r=-(g.x*G.x+g.y*G.y+g.z*G.z),c=-(b.x*s.x+b.y*s.y+b.z*s.z);const P=this._heightQuads[f*j+l];P.slope.hf(V,F),P.facet1.hf(g.x,g.y,g.z,r),P.facet2.hf(b.x,b.y,b.z,c)}return this}serialize(u){super.serialize(u),u.subdivisionsX=this._subdivisionsX,u.subdivisionsY=this._subdivisionsY,u.minX=this._minX,u.maxX=this._maxX,u.Mi=this._minZ,u.maxZ=this._maxZ,u.width=this._width,u.height=this._height}static Parse(u,G){const s=new C(u.name,G);return s._subdivisionsX=u.subdivisionsX||1,s._subdivisionsY=u.subdivisionsY||1,s._minX=u.minX,s._maxX=u.maxX,s._minZ=u.Mi,s._maxZ=u.maxZ,s._width=u.width,s._height=u.height,s}}var x=s(10564),g=s(10619),b=s(10913),Q=s(11121);function Y(u){const G=[],s=[],z=[],O=[];let f,C;const x=u.width||u.size||1,g=u.height||u.size||1,b=0|(u.subdivisionsX||u.subdivisions||1),Y=0|(u.subdivisionsY||u.subdivisions||1);for(f=0;f<=Y;f++)for(C=0;C<=b;C++){const u=new T.q(C*x/b-x/2,0,(Y-f)*g/Y-g/2),G=new T.q(0,1,0);s.push(u.x,u.y,u.z),z.push(G.x,G.y,G.z),O.push(C/b,Q.e?f/Y:1-f/Y)}for(f=0;f<Y;f++)for(C=0;C<b;C++)G.push(C+1+(f+1)*(b+1)),G.push(C+1+f*(b+1)),G.push(C+f*(b+1)),G.push(C+(f+1)*(b+1)),G.push(C+1+(f+1)*(b+1)),G.push(C+f*(b+1));const n=new m.b;return n.indices=G,n.xa=s,n.ya=z,n.Aa=O,n}function n(u){const G=void 0!==u.xmin&&null!==u.xmin?u.xmin:-1,s=void 0!==u.zmin&&null!==u.zmin?u.zmin:-1,z=void 0!==u.xmax&&null!==u.xmax?u.xmax:1,O=void 0!==u.zmax&&null!==u.zmax?u.zmax:1,f=u.subdivisions||{w:1,h:1},C=u.precision||{w:1,h:1},x=[],g=[],b=[],Q=[];let Y,n,V,F;f.h=f.h<1?1:f.h,f.w=f.w<1?1:f.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const r=(z-G)/f.w,c=(O-s)/f.h;function j(u,G,s,z){const O=g.length/3,m=C.w+1;for(Y=0;Y<C.h;Y++)for(n=0;n<C.w;n++){const u=[O+n+Y*m,O+(n+1)+Y*m,O+(n+1)+(Y+1)*m,O+n+(Y+1)*m];x.push(u[1]),x.push(u[2]),x.push(u[3]),x.push(u[0]),x.push(u[1]),x.push(u[3])}const f=T.q.Zero(),V=new T.q(0,1,0);for(Y=0;Y<=C.h;Y++)for(f.z=Y*(z-G)/C.h+G,n=0;n<=C.w;n++)f.x=n*(s-u)/C.w+u,f.y=0,g.push(f.x,f.y,f.z),b.push(V.x,V.y,V.z),Q.push(n/C.w,Y/C.h)}for(V=0;V<f.h;V++)for(F=0;F<f.w;F++)j(G+F*r,s+V*c,G+(F+1)*r,s+(V+1)*c);const l=new m.b;return l.indices=x,l.xa=g,l.ya=b,l.Aa=Q,l}function V(u){const G=[],s=[],O=[],f=[];let C,x;const g=u.colorFilter||new z.b(.3,.59,.11),Q=u.alphaFilter||0;let Y=!1;if(u.minHeight>u.maxHeight){Y=!0;const G=u.maxHeight;u.maxHeight=u.minHeight,u.minHeight=G}for(C=0;C<=u.subdivisions;C++)for(x=0;x<=u.subdivisions;x++){const G=new T.q(x*u.width/u.subdivisions-u.width/2,0,(u.subdivisions-C)*u.height/u.subdivisions-u.height/2),z=4*(((G.x+u.width/2)/u.width*(u.bufferWidth-1)|0)+((1-(G.z+u.height/2)/u.height)*(u.bufferHeight-1)|0)*u.bufferWidth);let m=u.buffer[z]/255,n=u.buffer[z+1]/255,V=u.buffer[z+2]/255;const F=u.buffer[z+3]/255;Y&&(m=1-m,n=1-n,V=1-V);const r=m*g.r+n*g.g+V*g.b;G.y=F>=Q?u.minHeight+(u.maxHeight-u.minHeight)*r:u.minHeight-b.e,u.heightBuffer&&(u.heightBuffer[C*(u.subdivisions+1)+x]=G.y),s.push(G.x,G.y,G.z),O.push(0,0,0),f.push(x/u.subdivisions,1-C/u.subdivisions)}for(C=0;C<u.subdivisions;C++)for(x=0;x<u.subdivisions;x++){const T=x+1+(C+1)*(u.subdivisions+1),z=x+1+C*(u.subdivisions+1),O=x+C*(u.subdivisions+1),m=x+(C+1)*(u.subdivisions+1),f=s[3*T+1]>=u.minHeight,g=s[3*z+1]>=u.minHeight,b=s[3*O+1]>=u.minHeight;f&&g&&b&&(G.push(T),G.push(z),G.push(O));s[3*m+1]>=u.minHeight&&f&&b&&(G.push(m),G.push(T),G.push(O))}m.b.ComputeNormals(s,G,O);const n=new m.b;return n.indices=G,n.xa=s,n.ya=O,n.Aa=f,n}function F(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=new C(u,arguments.length>2?arguments[2]:void 0);s._setReady(!1),s._subdivisionsX=G.subdivisionsX||G.subdivisions||1,s._subdivisionsY=G.subdivisionsY||G.subdivisions||1,s._width=G.width||1,s._height=G.height||1,s._maxX=s._width/2,s._maxZ=s._height/2,s._minX=-s._maxX,s._minZ=-s._maxZ;return Y(G).Ca(s,G.updatable),s._setReady(!0),s}function r(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new O.c(u,s);return n(G).Ca(T,G.updatable),T}function c(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=s.width||10,m=s.height||10,f=s.subdivisions||1,b=s.minHeight||0,Q=s.maxHeight||1,Y=s.colorFilter||new z.b(.3,.59,.11),n=s.alphaFilter||0,F=s.updatable,r=s.onReady;T=T||g.d.LastCreatedScene;const c=new C(u,T);let j;c._subdivisionsX=f,c._subdivisionsY=f,c._width=O,c._height=m,c._maxX=c._width/2,c._maxZ=c._height/2,c._minX=-c._maxX,c._minZ=-c._maxZ,c._setReady(!1),s.passHeightBufferInCallback&&(j=new Float32Array((f+1)*(f+1)));const l=(u,G,s)=>{V({width:O,height:m,subdivisions:f,minHeight:b,maxHeight:Q,colorFilter:Y,buffer:u,bufferWidth:G,bufferHeight:s,alphaFilter:n,heightBuffer:j}).Ca(c,F),r&&r(c,j),c._setReady(!0)};if("string"===typeof G){const u=u=>{var G;const s=u.width,z=u.height;if(T.u)return;const O=null===(G=T)||void 0===G?void 0:G.getEngine().resizeImageBitmap(u,s,z);l(O,s,z)};x.e.LoadImage(G,u,s.onError?s.onError:()=>{},T.offlineProvider)}else l(G.data,G.width,G.height);return c}m.b.CreateGround=Y,m.b.CreateTiledGround=n,m.b.CreateGroundFromHeightMap=V,O.c.CreateGround=(u,G,s,T,z,O)=>F(u,{width:G,height:s,subdivisions:T,updatable:O},z),O.c.CreateTiledGround=(u,G,s,T,z,O,m,f,C)=>r(u,{xmin:G,zmin:s,xmax:T,zmax:z,subdivisions:O,precision:m,updatable:C},f),O.c.CreateGroundFromHeightMap=(u,G,s,T,z,O,m,f,C,x,g)=>c(u,G,{width:s,height:T,subdivisions:z,minHeight:O,maxHeight:m,updatable:C,onReady:x,alphaFilter:g},f)},12299:(u,G,s)=>{"use strict";s.d(G,{c:()=>M,g:()=>v,h:()=>W});var T=s(10904),z=s(11148),O=s(11173),m=s(10930),f=s(10961),C=s(11882),x=s(11045),g=s(10935),b=s(10889),Q=s(11102),Y=s(10715),n=s(11130),V=s(10615),F=s(11098),r=s(10619),c=s(11088),j=s(11085);const l={effect:null,subMesh:null};class P extends F.c{constructor(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(u,G,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new T.d,this._cachedWorldViewProjectionMatrix=new T.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=s,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","ab","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...z}}get shaderPath(){return this._shaderPath}set shaderPath(u){this._shaderPath=u}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(u){-1===this._options.uniforms.indexOf(u)&&this._options.uniforms.push(u)}setTexture(u,G){return-1===this._options.samplers.indexOf(u)&&this._options.samplers.push(u),this._textures[u]=G,this}removeTexture(u){delete this._textures[u]}setTextureArray(u,G){return-1===this._options.samplers.indexOf(u)&&this._options.samplers.push(u),this._checkUniform(u),this._textureArrays[u]=G,this}setExternalTexture(u,G){return-1===this._options.externalTextures.indexOf(u)&&this._options.externalTextures.push(u),this._externalTextures[u]=G,this}setFloat(u,G){return this._checkUniform(u),this._floats[u]=G,this}setInt(u,G){return this._checkUniform(u),this._ints[u]=G,this}setUInt(u,G){return this._checkUniform(u),this._uints[u]=G,this}setFloats(u,G){return this._checkUniform(u),this._floatsArrays[u]=G,this}setColor3(u,G){return this._checkUniform(u),this._colors3[u]=G,this}setColor3Array(u,G){return this._checkUniform(u),this._colors3Arrays[u]=G.reduce(((u,G)=>(G.toArray(u,u.length),u)),[]),this}setColor4(u,G){return this._checkUniform(u),this._colors4[u]=G,this}setColor4Array(u,G){return this._checkUniform(u),this._colors4Arrays[u]=G.reduce(((u,G)=>(G.toArray(u,u.length),u)),[]),this}setVector2(u,G){return this._checkUniform(u),this._vectors2[u]=G,this}setVector3(u,G){return this._checkUniform(u),this._vectors3[u]=G,this}setVector4(u,G){return this._checkUniform(u),this._vectors4[u]=G,this}setQuaternion(u,G){return this._checkUniform(u),this._quaternions[u]=G,this}setQuaternionArray(u,G){return this._checkUniform(u),this._quaternionsArrays[u]=G.reduce(((u,G)=>(G.toArray(u,u.length),u)),[]),this}setMatrix(u,G){return this._checkUniform(u),this._matrices[u]=G,this}setMatrices(u,G){this._checkUniform(u);const s=new Float32Array(16*G.length);for(let T=0;T<G.length;T++){G[T].copyToArray(s,16*T)}return this._matrixArrays[u]=s,this}setMatrix3x3(u,G){return this._checkUniform(u),this._matrices3x3[u]=G,this}setMatrix2x2(u,G){return this._checkUniform(u),this._matrices2x2[u]=G,this}setArray2(u,G){return this._checkUniform(u),this._vectors2Arrays[u]=G,this}setArray3(u,G){return this._checkUniform(u),this._vectors3Arrays[u]=G,this}setArray4(u,G){return this._checkUniform(u),this._vectors4Arrays[u]=G,this}setUniformBuffer(u,G){return-1===this._options.uniformBuffers.indexOf(u)&&this._options.uniformBuffers.push(u),this._uniformBuffers[u]=G,this}setTextureSampler(u,G){return-1===this._options.samplerObjects.indexOf(u)&&this._options.samplerObjects.push(u),this._textureSamplers[u]=G,this}setStorageBuffer(u,G){return-1===this._options.storageBuffers.indexOf(u)&&this._options.storageBuffers.push(u),this._storageBuffers[u]=G,this}setDefine(u,G){const s=u.trimEnd()+" ",T=this.options.defines.findIndex((G=>G===u||G.startsWith(s)));return T>=0&&this.options.defines.splice(T,1),("boolean"!==typeof G||G)&&this.options.defines.push(s+G),this}isReadyForSubMesh(u,G,s){return this.isReady(u,s,G)}isReady(u,G,s){var T;const z=s&&this._storeEffectOnSubMeshes;if(this.isFrozen){const u=z?s._drawWrapper:this._drawWrapper;if(u.effect&&u._wasPreviouslyReady&&u._wasPreviouslyUsingInstances===G)return!0}const O=this.va(),m=O.getEngine(),C=[],x=[],g=new n.e;let Q=this._shaderPath,Y=this._options.uniforms,V=this._options.uniformBuffers,F=this._options.samplers;m.getCaps().multiview&&O.activeCamera&&O.activeCamera.outputRenderTarget&&O.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,C.push("#define MULTIVIEW"),-1!==Y.indexOf("viewProjection")&&-1===Y.indexOf("viewProjectionR")&&Y.push("viewProjectionR"));for(let f=0;f<this._options.defines.length;f++){const u=0===this._options.defines[f].indexOf("#define")?this._options.defines[f]:`#define ${this._options.defines[f]}`;C.push(u)}for(let f=0;f<this._options.attributes.length;f++)x.push(this._options.attributes[f]);if(u&&u.isVerticesDataPresent(f.f.ColorKind)&&(-1===x.indexOf(f.f.ColorKind)&&x.push(f.f.ColorKind),C.push("#define VERTEXCOLOR")),G&&(C.push("#define INSTANCES"),(0,j.db)(x,this._materialHelperNeedsPreviousMatrices),null!==u&&void 0!==u&&u.hasThinInstances&&(C.push("#define THIN_INSTANCES"),u&&u.isVerticesDataPresent(f.f.ColorInstanceKind)&&(x.push(f.f.ColorInstanceKind),C.push("#define INSTANCESCOLOR")))),u&&u.useBones&&u.computeBonesUsingShaders&&u.skeleton){x.push(f.f.MatricesIndicesKind),x.push(f.f.MatricesWeightsKind),u.numBoneInfluencers>4&&(x.push(f.f.MatricesIndicesExtraKind),x.push(f.f.MatricesWeightsExtraKind));const G=u.skeleton;C.push("#define NUM_BONE_INFLUENCERS "+u.numBoneInfluencers),g.addCPUSkinningFallback(0,u),G.isUsingTextureForMatrices?(C.push("#define BONETEXTURE"),-1===Y.indexOf("boneTextureWidth")&&Y.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(C.push("#define BonesPerMesh "+(G.bones.length+1)),-1===Y.indexOf("mBones")&&Y.push("mBones"))}else C.push("#define NUM_BONE_INFLUENCERS 0");let r=0;const P=u?u.morphTargetManager:null;if(P){const u=P.supportsUVs&&-1!==C.indexOf("#define UV1"),G=P.supportsTangents&&-1!==C.indexOf("#define TANGENT"),s=P.supportsNormals&&-1!==C.indexOf("#define NORMAL");r=P.numMaxInfluencers||P.numInfluencers,u&&C.push("#define MORPHTARGETS_UV"),G&&C.push("#define MORPHTARGETS_TANGENT"),s&&C.push("#define MORPHTARGETS_NORMAL"),r>0&&C.push("#define MORPHTARGETS"),P.isUsingTextureForTargets&&(C.push("#define MORPHTARGETS_TEXTURE"),-1===Y.indexOf("morphTargetTextureIndices")&&Y.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),C.push("#define NUM_MORPH_INFLUENCERS "+r);for(let T=0;T<r;T++)x.push(f.f.PositionKind+T),s&&x.push(f.f.NormalKind+T),G&&x.push(f.f.TangentKind+T),u&&x.push(f.f.UVKind+"_"+T);r>0&&(Y=Y.slice(),Y.push("morphTargetInfluences"),Y.push("morphTargetCount"),Y.push("morphTargetTextureInfo"),Y.push("morphTargetTextureIndices"))}else C.push("#define NUM_MORPH_INFLUENCERS 0");if(u){const G=u.bakedVertexAnimationManager;G&&G.isEnabled&&(C.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===Y.indexOf("bakedVertexAnimationSettings")&&Y.push("bakedVertexAnimationSettings"),-1===Y.indexOf("bakedVertexAnimationTextureSizeInverted")&&Y.push("bakedVertexAnimationTextureSizeInverted"),-1===Y.indexOf("bakedVertexAnimationTime")&&Y.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,j.t)(x,u,C)}for(const f in this._textures)if(!this._textures[f].isReady())return!1;u&&this._shouldTurnAlphaTestOn(u)&&C.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,c.b)(Y),(0,c.k)(this,O,C)),O.fogEnabled&&null!==u&&void 0!==u&&u.applyFog&&O.fogMode!==b.e.FOGMODE_NONE&&(C.push("#define FOG"),-1===Y.indexOf("view")&&Y.push("view"),-1===Y.indexOf("vFogInfos")&&Y.push("vFogInfos"),-1===Y.indexOf("vFogColor")&&Y.push("vFogColor")),this._useLogarithmicDepth&&(C.push("#define LOGARITHMICDEPTH"),-1===Y.indexOf("logarithmicDepthConstant")&&Y.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(Y=Y.slice(),V=V.slice(),F=F.slice(),Q=this.customShaderNameResolve(this.name,Y,V,F,C,x));const H=z?s._getDrawWrapper(void 0,!0):this._drawWrapper,X=(null===H||void 0===H?void 0:H.effect)??null,p=(null===H||void 0===H?void 0:H.defines)??null,q=C.join("\n");let d=X;return p!==q&&(d=m.createEffect(Q,{attributes:x,uniformsNames:Y,uniformBuffersNames:V,samplers:F,defines:q,fallbacks:g,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:r},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},m),z?s.setEffect(d,q,this._materialContext):H&&H.setEffect(d,q),this._onEffectCreatedObservable&&(l.effect=d,l.subMesh=s??(null===u||void 0===u?void 0:u.xf[0])??null,this._onEffectCreatedObservable.notifyObservers(l))),H._wasPreviouslyUsingInstances=!!G,!((null===(T=d)||void 0===T||!T.isReady())??1)&&(X!==d&&O.resetCachedMaterial(),H._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(u,G){const s=this.va(),T=G??this.getEffect();T&&(-1!==this._options.uniforms.indexOf("world")&&T.setMatrix("world",u),-1!==this._options.uniforms.indexOf("worldView")&&(u.multiplyToRef(s.getViewMatrix(),this._cachedWorldViewMatrix),T.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(u.multiplyToRef(s.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),T.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&T.setMatrix("view",s.getViewMatrix()))}bindForSubMesh(u,G,s){var T;this.bind(u,G,null===(T=s._drawWrapperOverride)||void 0===T?void 0:T.effect,s)}bind(u,G,s,T){const z=T&&this._storeEffectOnSubMeshes,O=s??(z?T.effect:this.getEffect());if(!O)return;const m=this.va();this._activeEffect=O,this.bindOnlyWorldMatrix(u,s);const f=this._options.uniformBuffers;let C=!1;if(O&&f&&f.length>0&&m.getEngine().supportsUniformBuffers)for(let b=0;b<f.length;++b){switch(f[b]){case"Mesh":G&&(G.getMeshUniformBuffer().bindToEffect(O,"Mesh"),G.transferToEffect(u));break;case"Scene":(0,j.k)(O,m.getSceneUniformBuffer()),m.finalizeSceneUbo(),C=!0}}const x=G&&z?this._mustRebind(m,O,T,G.visibility):m.getCachedMaterial()!==this;if(O&&x){let u;for(u in C||-1===this._options.uniforms.indexOf("view")||O.setMatrix("view",m.getViewMatrix()),C||-1===this._options.uniforms.indexOf("projection")||O.setMatrix("projection",m.getProjectionMatrix()),C||-1===this._options.uniforms.indexOf("viewProjection")||(O.setMatrix("viewProjection",m.getTransformMatrix()),this._multiview&&O.setMatrix("viewProjectionR",m._transformMatrixR)),m.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&O.setVector3("cameraPosition",m.activeCamera.globalPosition),(0,j.c)(G,O),(0,c.f)(O,this,m),this._useLogarithmicDepth&&(0,j.i)(z?T.materialDefines:O.defines,O,m),G&&(0,j.d)(m,G,O),this._textures)O.setTexture(u,this._textures[u]);for(u in this._textureArrays)O.setTextureArray(u,this._textureArrays[u]);for(u in this._ints)O.setInt(u,this._ints[u]);for(u in this._uints)O.setUInt(u,this._uints[u]);for(u in this._floats)O.setFloat(u,this._floats[u]);for(u in this._floatsArrays)O.setArray(u,this._floatsArrays[u]);for(u in this._colors3)O.setColor3(u,this._colors3[u]);for(u in this._colors3Arrays)O.setArray3(u,this._colors3Arrays[u]);for(u in this._colors4){const G=this._colors4[u];O.setFloat4(u,G.r,G.g,G.b,G.a)}for(u in this._colors4Arrays)O.setArray4(u,this._colors4Arrays[u]);for(u in this._vectors2)O.setVector2(u,this._vectors2[u]);for(u in this._vectors3)O.setVector3(u,this._vectors3[u]);for(u in this._vectors4)O.setVector4(u,this._vectors4[u]);for(u in this._quaternions)O.setQuaternion(u,this._quaternions[u]);for(u in this._matrices)O.setMatrix(u,this._matrices[u]);for(u in this._matrixArrays)O.setMatrices(u,this._matrixArrays[u]);for(u in this._matrices3x3)O.setMatrix3x3(u,this._matrices3x3[u]);for(u in this._matrices2x2)O.setMatrix2x2(u,this._matrices2x2[u]);for(u in this._vectors2Arrays)O.setArray2(u,this._vectors2Arrays[u]);for(u in this._vectors3Arrays)O.setArray3(u,this._vectors3Arrays[u]);for(u in this._vectors4Arrays)O.setArray4(u,this._vectors4Arrays[u]);for(u in this._quaternionsArrays)O.setArray4(u,this._quaternionsArrays[u]);for(u in this._uniformBuffers){const G=this._uniformBuffers[u].getBuffer();G&&O.bindUniformBuffer(G,u)}const s=m.getEngine(),f=s.setExternalTexture;if(f)for(u in this._externalTextures)f.call(s,u,this._externalTextures[u]);const x=s.setTextureSampler;if(x)for(u in this._textureSamplers)x.call(s,u,this._textureSamplers[u]);const g=s.setStorageBuffer;if(g)for(u in this._storageBuffers)g.call(s,u,this._storageBuffers[u])}if(O&&G&&(x||!this.isFrozen)){const u=G.morphTargetManager;u&&u.numInfluencers>0&&(0,j.j)(G,O);const s=G.bakedVertexAnimationManager;if(s&&s.isEnabled){var g;const u=z?T._drawWrapper:this._drawWrapper;null===(g=G.bakedVertexAnimationManager)||void 0===g||g.bind(O,!!u._wasPreviouslyUsingInstances)}}this._afterBind(G,O,T)}getActiveTextures(){const u=super.getActiveTextures();for(const G in this._textures)u.push(this._textures[G]);for(const G in this._textureArrays){const s=this._textureArrays[G];for(let G=0;G<s.length;G++)u.push(s[G])}return u}hasTexture(u){if(super.hasTexture(u))return!0;for(const G in this._textures)if(this._textures[G]===u)return!0;for(const G in this._textureArrays){const s=this._textureArrays[G];for(let G=0;G<s.length;G++)if(s[G]===u)return!0}return!1}clone(u){const G=g.e.Clone((()=>new P(u,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);G.name=u,G.id=u,"object"===typeof G._shaderPath&&(G._shaderPath={...G._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((u=>{const G=this._options[u];Array.isArray(G)&&(this._options[u]=G.slice(0))})),this.stencil.copyTo(G.stencil);for(const s in this._textures)G.setTexture(s,this._textures[s]);for(const s in this._textureArrays)G.setTextureArray(s,this._textureArrays[s]);for(const s in this._externalTextures)G.setExternalTexture(s,this._externalTextures[s]);for(const s in this._ints)G.setInt(s,this._ints[s]);for(const s in this._uints)G.setUInt(s,this._uints[s]);for(const s in this._floats)G.setFloat(s,this._floats[s]);for(const s in this._floatsArrays)G.setFloats(s,this._floatsArrays[s]);for(const s in this._colors3)G.setColor3(s,this._colors3[s]);for(const s in this._colors3Arrays)G._colors3Arrays[s]=this._colors3Arrays[s];for(const s in this._colors4)G.setColor4(s,this._colors4[s]);for(const s in this._colors4Arrays)G._colors4Arrays[s]=this._colors4Arrays[s];for(const s in this._vectors2)G.setVector2(s,this._vectors2[s]);for(const s in this._vectors3)G.setVector3(s,this._vectors3[s]);for(const s in this._vectors4)G.setVector4(s,this._vectors4[s]);for(const s in this._quaternions)G.setQuaternion(s,this._quaternions[s]);for(const s in this._quaternionsArrays)G._quaternionsArrays[s]=this._quaternionsArrays[s];for(const s in this._matrices)G.setMatrix(s,this._matrices[s]);for(const s in this._matrixArrays)G._matrixArrays[s]=this._matrixArrays[s].slice();for(const s in this._matrices3x3)G.setMatrix3x3(s,this._matrices3x3[s]);for(const s in this._matrices2x2)G.setMatrix2x2(s,this._matrices2x2[s]);for(const s in this._vectors2Arrays)G.setArray2(s,this._vectors2Arrays[s]);for(const s in this._vectors3Arrays)G.setArray3(s,this._vectors3Arrays[s]);for(const s in this._vectors4Arrays)G.setArray4(s,this._vectors4Arrays[s]);for(const s in this._uniformBuffers)G.setUniformBuffer(s,this._uniformBuffers[s]);for(const s in this._textureSamplers)G.setTextureSampler(s,this._textureSamplers[s]);for(const s in this._storageBuffers)G.setStorageBuffer(s,this._storageBuffers[s]);return G}dispose(u,G,s){if(G){let u;for(u in this._textures)this._textures[u].dispose();for(u in this._textureArrays){const G=this._textureArrays[u];for(let u=0;u<G.length;u++)G[u].dispose()}}this._textures={},super.dispose(u,G,s)}serialize(){const u=g.e.Serialize(this);let G;for(G in u.customType="BABYLON.ShaderMaterial",u.uniqueId=this.uniqueId,u.options=this._options,u.shaderPath=this._shaderPath,u.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,u.stencil=this.stencil.serialize(),u.textures={},this._textures)u.textures[G]=this._textures[G].serialize();for(G in u.textureArrays={},this._textureArrays){u.textureArrays[G]=[];const s=this._textureArrays[G];for(let T=0;T<s.length;T++)u.textureArrays[G].push(s[T].serialize())}for(G in u.ints={},this._ints)u.ints[G]=this._ints[G];for(G in u.uints={},this._uints)u.uints[G]=this._uints[G];for(G in u.floats={},this._floats)u.floats[G]=this._floats[G];for(G in u.floatsArrays={},this._floatsArrays)u.floatsArrays[G]=this._floatsArrays[G];for(G in u.colors3={},this._colors3)u.colors3[G]=this._colors3[G].$i();for(G in u.colors3Arrays={},this._colors3Arrays)u.colors3Arrays[G]=this._colors3Arrays[G];for(G in u.colors4={},this._colors4)u.colors4[G]=this._colors4[G].$i();for(G in u.colors4Arrays={},this._colors4Arrays)u.colors4Arrays[G]=this._colors4Arrays[G];for(G in u.vectors2={},this._vectors2)u.vectors2[G]=this._vectors2[G].$i();for(G in u.vectors3={},this._vectors3)u.vectors3[G]=this._vectors3[G].$i();for(G in u.vectors4={},this._vectors4)u.vectors4[G]=this._vectors4[G].$i();for(G in u.quaternions={},this._quaternions)u.quaternions[G]=this._quaternions[G].$i();for(G in u.matrices={},this._matrices)u.matrices[G]=this._matrices[G].$i();for(G in u.matrixArray={},this._matrixArrays)u.matrixArray[G]=this._matrixArrays[G];for(G in u.matrices3x3={},this._matrices3x3)u.matrices3x3[G]=this._matrices3x3[G];for(G in u.matrices2x2={},this._matrices2x2)u.matrices2x2[G]=this._matrices2x2[G];for(G in u.vectors2Arrays={},this._vectors2Arrays)u.vectors2Arrays[G]=this._vectors2Arrays[G];for(G in u.vectors3Arrays={},this._vectors3Arrays)u.vectors3Arrays[G]=this._vectors3Arrays[G];for(G in u.vectors4Arrays={},this._vectors4Arrays)u.vectors4Arrays[G]=this._vectors4Arrays[G];for(G in u.quaternionsArrays={},this._quaternionsArrays)u.quaternionsArrays[G]=this._quaternionsArrays[G];return u}static Parse(u,G,s){const z=g.e.Parse((()=>new P(u.name,G,u.shaderPath,u.options,u.storeEffectOnSubMeshes)),u,G,s);let O;for(O in u.stencil&&z.stencil.parse(u.stencil,G,s),u.textures)z.setTexture(O,Q.b.Parse(u.textures[O],G,s));for(O in u.textureArrays){const T=u.textureArrays[O],m=[];for(let u=0;u<T.length;u++)m.push(Q.b.Parse(T[u],G,s));z.setTextureArray(O,m)}for(O in u.ints)z.setInt(O,u.ints[O]);for(O in u.uints)z.setUInt(O,u.uints[O]);for(O in u.floats)z.setFloat(O,u.floats[O]);for(O in u.floatsArrays)z.setFloats(O,u.floatsArrays[O]);for(O in u.colors3)z.setColor3(O,m.b.Ag(u.colors3[O]));for(O in u.colors3Arrays){const G=u.colors3Arrays[O].reduce(((u,G,s)=>(s%3===0?u.push([G]):u[u.length-1].push(G),u)),[]).map((u=>m.b.Ag(u)));z.setColor3Array(O,G)}for(O in u.colors4)z.setColor4(O,m.e.Ag(u.colors4[O]));for(O in u.colors4Arrays){const G=u.colors4Arrays[O].reduce(((u,G,s)=>(s%4===0?u.push([G]):u[u.length-1].push(G),u)),[]).map((u=>m.e.Ag(u)));z.setColor4Array(O,G)}for(O in u.vectors2)z.setVector2(O,T.m.Ag(u.vectors2[O]));for(O in u.vectors3)z.setVector3(O,T.q.Ag(u.vectors3[O]));for(O in u.vectors4)z.setVector4(O,T.s.Ag(u.vectors4[O]));for(O in u.quaternions)z.setQuaternion(O,T.h.Ag(u.quaternions[O]));for(O in u.matrices)z.setMatrix(O,T.d.Ag(u.matrices[O]));for(O in u.matrixArray)z._matrixArrays[O]=new Float32Array(u.matrixArray[O]);for(O in u.matrices3x3)z.setMatrix3x3(O,u.matrices3x3[O]);for(O in u.matrices2x2)z.setMatrix2x2(O,u.matrices2x2[O]);for(O in u.vectors2Arrays)z.setArray2(O,u.vectors2Arrays[O]);for(O in u.vectors3Arrays)z.setArray3(O,u.vectors3Arrays[O]);for(O in u.vectors4Arrays)z.setArray4(O,u.vectors4Arrays[O]);for(O in u.quaternionsArrays)z.setArray4(O,u.quaternionsArrays[O]);return z}static ParseFromFileAsync(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((z,O)=>{const m=new V.e;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const G=JSON.parse(m.responseText),O=this.Parse(G,s||r.d.LastCreatedScene,T);u&&(O.name=u),z(O)}else O("Unable to load the ShaderMaterial")})),m.open("GET",G),m.send()}))}static ParseFromSnippetAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((T,z)=>{const O=new V.e;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const z=JSON.parse(JSON.parse(O.responseText).jsonPayload),m=JSON.parse(z.shaderMaterial),f=this.Parse(m,G||r.d.LastCreatedScene,s);f.snippetId=u,T(f)}else z("Unable to load the snippet "+u)})),O.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),O.send()}))}}P.SnippetUrl="https://snippet.babylonjs.com",P.CreateFromSnippetAsync=P.ParseFromSnippetAsync,(0,Y.g)("BABYLON.ShaderMaterial",P),z.c._LinesMeshParser=(u,G)=>H.Parse(u,G);class H extends z.c{_isShaderMaterial(u){return"ShaderMaterial"===u.getClassName()}constructor(u){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0;super(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G,arguments.length>4?arguments[4]:void 0),this.useVertexColor=T,this.useVertexAlpha=z,this.color=new m.b(1,1,1),this.alpha=1,this._shaderLanguage=0,G&&(this.color=G.color.clone(),this.alpha=G.alpha,this.useVertexColor=G.useVertexColor,this.useVertexAlpha=G.useVertexAlpha),this.intersectionThreshold=.1;const C={attributes:[f.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===z?C.needAlphaBlending=!1:C.defines.push("#define VERTEXALPHA"),T?(C.defines.push("#define VERTEXCOLOR"),C.attributes.push(f.f.ColorKind)):(C.uniforms.push("color"),this._color4=new m.e),O)this.material=O;else{this.va().getEngine().isWebGPU&&!H.ForceGLSL&&(this._shaderLanguage=1),C.shaderLanguage=this._shaderLanguage,C.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([s.e(23).then(s.bind(s,13215)),s.e(47).then(s.bind(s,13223))]):await Promise.all([s.e(28).then(s.bind(s,13228)),s.e(48).then(s.bind(s,13233))])},this.material=new P("colorShader",this.va(),"color",C,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(u){this._lineMaterial=u,this._lineMaterial.fillMode=x.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(u){}_bind(u,G){if(!this._geometry)return this;const s=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(G,s):this._geometry._bind(G,s,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:u,g:G,b:s}=this.color;this._color4.set(u,G,s,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(u,G,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const T=this.va().getEngine();return this._unIndexed?T.drawArraysType(x.d.LineListDrawMode,u.verticesStart,u.verticesCount,s):T.drawElementsType(x.d.LineListDrawMode,u.indexStart,u.indexCount,s),this}dispose(u){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(u)}clone(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;return new H(u,this.va(),G,this,s)}ed(u){const G=new X(u,this);if(this.instancedBuffers){G.instancedBuffers={};for(const u in this.instancedBuffers)G.instancedBuffers[u]=this.instancedBuffers[u]}return G}serialize(u){super.serialize(u),u.color=this.color.$i(),u.alpha=this.alpha}static Parse(u,G){const s=new H(u.name,G);return s.color=m.b.Ag(u.color),s.alpha=u.alpha,s}}H.ForceGLSL=!1;class X extends C.d{constructor(u,G){super(u,G),this.intersectionThreshold=G.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var p=s(10584);function q(u){const G=[],s=[],T=u.lines,z=u.za,m=[];let f=0;for(let O=0;O<T.length;O++){const u=T[O];for(let T=0;T<u.length;T++){const{x:C,y:x,z:g}=u[T];if(s.push(C,x,g),z){const u=z[O],{r:G,g:s,b:f,a:C}=u[T];m.push(G,s,f,C)}T>0&&(G.push(f-1),G.push(f)),f++}}const C=new O.b;return C.indices=G,C.xa=s,z&&(C.za=m),C}function d(u){const G=u.dashSize||3,s=u.gapSize||1,z=u.dashNb||200,m=u.points,f=[],C=[],x=T.q.Zero();let g=0,b=0,Q=0,Y=0,n=0,V=0,F=0;for(F=0;F<m.length-1;F++)m[F+1].subtractToRef(m[F],x),g+=x.length();for(Q=g/z,Y=G*Q/(G+s),F=0;F<m.length-1;F++){m[F+1].subtractToRef(m[F],x),b=Math.floor(x.length()/Q),x.normalize();for(let u=0;u<b;u++)n=Q*u,f.push(m[F].x+n*x.x,m[F].y+n*x.y,m[F].z+n*x.z),f.push(m[F].x+(n+Y)*x.x,m[F].y+(n+Y)*x.y,m[F].z+(n+Y)*x.z),C.push(V,V+1),V+=2}const r=new O.b;return r.xa=f,r.indices=C,r}function v(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=G.instance,z=G.lines,O=G.za;if(T){const u=T.getVerticesData(f.f.PositionKind);let G,s;O&&(G=T.getVerticesData(f.f.ColorKind));let m=0,C=0;for(let T=0;T<z.length;T++){const f=z[T];for(let z=0;z<f.length;z++)u[m]=f[z].x,u[m+1]=f[z].y,u[m+2]=f[z].z,O&&G&&(s=O[T],G[C]=s[z].r,G[C+1]=s[z].g,G[C+2]=s[z].b,G[C+3]=s[z].a,C+=4),m+=3}return T.updateVerticesData(f.f.PositionKind,u,!1,!1),O&&G&&T.updateVerticesData(f.f.ColorKind,G,!1,!1),T.refreshBoundingInfo(),T}const m=new H(u,s,null,void 0,void 0,!!O,G.useVertexAlpha,G.material);return q(G).Ca(m,G.updatable),m}function W(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=G.za?[G.za]:null;return v(u,{lines:[G.points],updatable:G.updatable,instance:G.instance,za:T,useVertexAlpha:G.useVertexAlpha,material:G.material},s)}function M(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=G.points,m=G.instance,f=G.gapSize||1,C=G.dashSize||3;if(m){const u=u=>{const G=T.q.Zero(),s=u.length/6;let z=0,f=0,C=0,x=0,g=0,b=0,Q=0,Y=0;for(Q=0;Q<O.length-1;Q++)O[Q+1].subtractToRef(O[Q],G),z+=G.length();C=z/s;const n=m._creationDataStorage.dashSize;for(x=n*C/(n+m._creationDataStorage.gapSize),Q=0;Q<O.length-1;Q++)for(O[Q+1].subtractToRef(O[Q],G),f=Math.floor(G.length()/C),G.normalize(),Y=0;Y<f&&b<u.length;)g=C*Y,u[b]=O[Q].x+g*G.x,u[b+1]=O[Q].y+g*G.y,u[b+2]=O[Q].z+g*G.z,u[b+3]=O[Q].x+(g+x)*G.x,u[b+4]=O[Q].y+(g+x)*G.y,u[b+5]=O[Q].z+(g+x)*G.z,b+=6,Y++;for(;b<u.length;)u[b]=O[Q].x,u[b+1]=O[Q].y,u[b+2]=O[Q].z,b+=3};return(G.dashNb||G.dashSize||G.gapSize||G.useVertexAlpha||G.material)&&p.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),m.updateMeshPositions(u,!1),m}const x=new H(u,s,null,void 0,void 0,void 0,G.useVertexAlpha,G.material);return d(G).Ca(x,G.updatable),x._creationDataStorage=new z.f,x._creationDataStorage.dashSize=C,x._creationDataStorage.gapSize=f,x}O.b.CreateLineSystem=q,O.b.CreateDashedLines=d,z.c.qb=function(u,G){return W(u,{points:G,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},z.c.CreateDashedLines=function(u,G,s,T,z){return M(u,{points:G,dashSize:s,gapSize:T,dashNb:z,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11267:(u,G,s)=>{"use strict";s.d(G,{d:()=>f,h:()=>C});var T=s(11148),z=s(11173),O=s(11121);function m(u){const G=[],s=[],T=[],m=[],f=u.width||u.size||1,C=u.height||u.size||1,x=0===u.sideOrientation?0:u.sideOrientation||z.b.DEFAULTSIDE,g=f/2,b=C/2;s.push(-g,-b,0),T.push(0,0,-1),m.push(0,O.e?1:0),s.push(g,-b,0),T.push(0,0,-1),m.push(1,O.e?1:0),s.push(g,b,0),T.push(0,0,-1),m.push(1,O.e?0:1),s.push(-g,b,0),T.push(0,0,-1),m.push(0,O.e?0:1),G.push(0),G.push(1),G.push(2),G.push(0),G.push(2),G.push(3),z.b._ComputeSides(x,s,G,T,m,u.frontUVs,u.backUVs);const Q=new z.b;return Q.indices=G,Q.xa=s,Q.ya=T,Q.Aa=m,Q}function f(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new T.c(u,s);G.sideOrientation=T.c._GetDefaultSideOrientation(G.sideOrientation),z._originalBuilderSideOrientation=G.sideOrientation;return m(G).Ca(z,G.updatable),G.sourcePlane&&(z.translate(G.sourcePlane.ab,-G.sourcePlane.d),z.setDirection(G.sourcePlane.ab.scale(-1))),z}const C={Bf:f};z.b.Bf=m,T.c.Bf=(u,G,s,T,z)=>f(u,{size:G,width:G,height:G,sideOrientation:z,updatable:T},s)},11517:(u,G,s)=>{"use strict";s.d(G,{c:()=>C});var T=s(10904),z=s(11148),O=s(11173),m=s(11121);function f(u){const G=0|(u.segments||32),s=u.diameterX||u.diameter||1,z=u.diameterY||u.diameter||1,f=u.diameterZ||u.diameter||1,C=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,x=u.slice&&u.slice<=0?1:u.slice||1,g=0===u.sideOrientation?0:u.sideOrientation||O.b.DEFAULTSIDE,b=!!u.dedupTopBottomIndices,Q=new T.q(s/2,z/2,f/2),Y=2+G,n=2*Y,V=[],F=[],r=[],c=[];for(let O=0;O<=Y;O++){const u=O/Y,G=u*Math.PI*x;for(let s=0;s<=n;s++){const z=s/n,O=z*Math.PI*2*C,f=T.d.RotationZ(-G),x=T.d.RotationY(O),g=T.q.TransformCoordinates(T.q.Up(),f),b=T.q.TransformCoordinates(g,x),Y=b.multiply(Q),V=b.divide(Q).normalize();F.push(Y.x,Y.y,Y.z),r.push(V.x,V.y,V.z),c.push(z,m.e?1-u:u)}if(O>0){const u=F.length/3;for(let G=u-2*(n+1);G+n+2<u;G++)b?(O>1&&(V.push(G),V.push(G+1),V.push(G+n+1)),(O<Y||x<1)&&(V.push(G+n+1),V.push(G+1),V.push(G+n+2))):(V.push(G),V.push(G+1),V.push(G+n+1),V.push(G+n+1),V.push(G+1),V.push(G+n+2))}}O.b._ComputeSides(g,F,V,r,c,u.frontUVs,u.backUVs);const j=new O.b;return j.indices=V,j.xa=F,j.ya=r,j.Aa=c,j}function C(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return f(G).Ca(T,G.updatable),T}O.b.CreateSphere=f,z.c.CreateSphere=(u,G,s,T,z,O)=>C(u,{segments:G,diameterX:s,diameterY:s,diameterZ:s,sideOrientation:O,updatable:z},T)},11924:(u,G,s)=>{"use strict";s.d(G,{c:()=>b});var T=s(10564),z=s(11927),O=s(11181),m=s(10961),f=s(11173),C=s(10584);function x(u,G,s,T,z){let O=null,m=null,f=null;try{let C;O=new u.Decoder,m=new u.DecoderBuffer,m.Init(G,G.byteLength);const x=O.GetEncodedGeometryType(m);switch(x){case u.TRIANGULAR_MESH:{const G=new u.Mesh;if(C=O.DecodeBufferToMesh(m,G),!C.ok()||0===G.ptr)throw new Error(C.error_msg());const s=3*G.num_faces(),z=4*s,x=u._malloc(z);try{O.GetTrianglesUInt32Array(G,z,x);const m=new Uint32Array(s);m.set(new Uint32Array(u.HEAPF32.buffer,x,s)),T(m)}finally{u._free(x)}f=G;break}case u.POINT_CLOUD:{const G=new u.PointCloud;if(C=O.DecodeBufferToPointCloud(m,G),!C.ok()||!G.ptr)throw new Error(C.error_msg());f=G;break}default:throw new Error(`Invalid geometry type ${x}`)}const g=f.num_points(),b=(G,s,T,O)=>{const m=O.data_type(),f=O.num_components(),C=O.normalized(),x=O.byte_stride(),b=O.byte_offset(),Q={[u.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:u.HEAPF32},[u.DT_INT8]:{typedArrayConstructor:Int8Array,heap:u.HEAP8},[u.DT_INT16]:{typedArrayConstructor:Int16Array,heap:u.HEAP16},[u.DT_INT32]:{typedArrayConstructor:Int32Array,heap:u.HEAP32},[u.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:u.HEAPU8},[u.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:u.HEAPU16},[u.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:u.HEAPU32}}[m];if(!Q)throw new Error(`Invalid data type ${m}`);const Y=g*f,n=Y*Q.typedArrayConstructor.BYTES_PER_ELEMENT,V=u._malloc(n);try{G.GetAttributeDataArrayForAllPoints(s,O,m,n,V);const u=new Q.typedArrayConstructor(Q.heap.buffer,V,Y);z(T,u.slice(),f,b,x,C)}finally{u._free(V)}};if(s)for(const u in s){const G=s[u],T=O.GetAttributeByUniqueId(f,G);b(O,f,u,T)}else{const G={position:u.POSITION,ab:u.NORMAL,color:u.COLOR,uv:u.TEX_COORD};for(const u in G){const s=O.GetAttributeId(f,G[u]);if(-1!==s){const G=O.GetAttribute(f,s);b(O,f,u,G)}}}return g}finally{f&&u.destroy(f),m&&u.destroy(m),O&&u.destroy(O)}}function g(){let u;onmessage=G=>{const s=G.data;switch(s.id){case"init":{const G=s.decoder;G.url&&importScripts(G.url);const T=G.wasmBinary?{wasmBinary:G.wasmBinary}:{};u=DracoDecoderModule(T),postMessage({id:"initDone"});break}case"decodeMesh":if(!u)throw new Error("Draco decoder module is not available");u.then((u=>{const G=x(u,s.dataView,s.attributes,(u=>{postMessage({id:"indices",data:u},[u.buffer])}),((u,G,s,T,z,O)=>{postMessage({id:"attribute",kind:u,data:G,size:s,byteOffset:T,byteStride:z,normalized:O},[G.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:G})}))}}}class b{static get DecoderAvailable(){const u=b.Configuration.decoder;return!!(u.wasmUrl&&u.wasmBinaryUrl&&"object"===typeof WebAssembly||u.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return b._Default||(b._Default=new b),b._Default}static ResetDefault(u){b._Default&&(u||b._Default.dispose(),b._Default=null)}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultNumWorkers;const G=b.Configuration.decoder;if(G.workerPool||"object"===typeof u&&u.workerPool)this._workerPoolPromise=Promise.resolve(G.workerPool||u.workerPool);else{const s=G.wasmBinary||"object"===typeof u&&u.wasmBinary,O="number"===typeof u?u:u.numWorkers,m=O&&"function"===typeof Worker&&"function"===typeof URL,f=m||!m&&!G.jsModule,C=G.wasmUrl&&G.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:f?T.e.GetBabylonScriptURL(G.wasmUrl,!0):"",wasmBinaryPromise:s?Promise.resolve(s):T.e.LoadFileAsync(T.e.GetBabylonScriptURL(G.wasmBinaryUrl,!0))}:{url:f?T.e.GetBabylonScriptURL(G.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};m?this._workerPoolPromise=C.wasmBinaryPromise.then((u=>{const G=`${x}(${g})()`,s=URL.createObjectURL(new Blob([G],{type:"application/javascript"}));return new z.e(O,(()=>function(u,G,s){return new Promise(((T,z)=>{const O=G=>{u.removeEventListener("error",O),u.removeEventListener("message",m),z(G)},m=G=>{"initDone"===G.data.id&&(u.removeEventListener("error",O),u.removeEventListener("message",m),T(u))};if(u.addEventListener("error",O),u.addEventListener("message",m),G){const T=G.slice(0);u.postMessage({id:"init",decoder:{url:s,wasmBinary:T}},[T])}else u.postMessage({id:"init",decoder:{url:s}})}))}(new Worker(s),u,C.url)))})):this._decoderModulePromise=C.wasmBinaryPromise.then((async u=>{if("undefined"===typeof DracoDecoderModule&&!G.jsModule){if(!C.url)throw new Error("Draco decoder module is not available");await T.e.LoadBabylonScriptAsync(C.url)}return await(s=u,z=G.jsModule,new Promise((u=>{(z||DracoDecoderModule)({wasmBinary:s}).then((G=>{u({module:G})}))})));var s,z}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((u=>{u.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(u,G,s){const T=u instanceof ArrayBuffer?new Int8Array(u):new Int8Array(u.buffer,u.byteOffset,u.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((u=>new Promise(((z,O)=>{u.push(((u,m)=>{let f=null;const x=[],g=G=>{u.removeEventListener("error",g),u.removeEventListener("message",b),O(G),m()},b=G=>{const T=G.data;switch(T.id){case"decodeMeshDone":u.removeEventListener("error",g),u.removeEventListener("message",b),z({indices:f,attributes:x,totalVertices:T.totalVertices}),m();break;case"indices":f=T.data;break;case"attribute":x.push({kind:T.kind,data:T.data,size:T.size,byteOffset:T.byteOffset,byteStride:T.byteStride,normalized:(O=T.kind,Q=T.normalized,s&&void 0!==s[O]?(Q!==s[O]&&C.d.Warn(`Normalized flag from Draco data (${Q}) does not match normalized flag from glTF accessor (${s[O]}). Using flag from glTF accessor.`),s[O]):Q)})}var O,Q};u.addEventListener("error",g),u.addEventListener("message",b);const Q=T.slice();u.postMessage({id:"decodeMesh",dataView:Q,attributes:G},[Q.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((u=>{let s=null;const z=[],O=x(u.module,T,G,(u=>{s=u}),((u,G,s,T,O,m)=>{z.push({kind:u,data:G,size:s,byteOffset:T,byteStride:O,normalized:m})}));return{indices:s,attributes:z,totalVertices:O}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(u,G,s,T){const z=await this.decodeMeshToMeshDataAsync(s,T),f=new O.d(u,G);z.indices&&f.setIndices(z.indices);for(const O of z.attributes)f.setVerticesBuffer(new m.f(G.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),z.totalVertices);return f}async _decodeMeshToGeometryForGltfAsync(u,G,s,T,z){const f=await this.decodeMeshToMeshDataAsync(s,T,z),C=new O.d(u,G);f.indices&&C.setIndices(f.indices);for(const O of f.attributes)C.setVerticesBuffer(new m.f(G.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),f.totalVertices);return C}async decodeMeshAsync(u,G){const s=await this.decodeMeshToMeshDataAsync(u,G),T=new f.b;s.indices&&(T.indices=s.indices);for(const z of s.attributes){const u=m.f.GetFloatData(z.data,z.size,m.f.GetDataType(z.data),z.byteOffset,z.byteStride,z.normalized,s.totalVertices);T.set(u,z.kind)}return T}}b.Configuration={decoder:{wasmUrl:`${T.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${T.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${T.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},b.DefaultNumWorkers=b.GetDefaultNumWorkers(),b._Default=null},11319:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(10969);class z extends T.e{constructor(u){super(),this._buffer=u}get underlyingResource(){return this._buffer}}},11191:(u,G,s)=>{"use strict";s.d(G,{d:()=>X});var T=s(10863),z=s(10568),O=s(10904),m=s(10961),f=s(11173),C=s(11193),x=s(10959),g=s(11059),b=s(10954);class Q{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new O.q(0,0,0),this._diffPositionForCollisions=new O.q(0,0,0),this._collisionResponse=!0}}var Y=s(10609),n=s(11078),V=s(10930),F=s(10913),r=s(11201),c=s(10715),j=s(10866),l=s(10645);class P{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=O.q.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class H{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new P,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new Q,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class X extends C.d{static get BILLBOARDMODE_NONE(){return C.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return C.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return C.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return C.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return C.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return C.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(u){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=u}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(u){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=u}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=u}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=u}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(u){this._internalAbstractMeshDataInfo._collisionRetryCount=u}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(u){this._internalAbstractMeshDataInfo._morphTargetManager!==u&&(this._internalAbstractMeshDataInfo._morphTargetManager=u,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(u){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==u&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=u,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(u){return!!super._updateNonUniformScalingState(u)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(u){this._internalAbstractMeshDataInfo._rawBoundingInfo=u}set Ck(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(u)}set onCollisionPositionChange(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(u)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(u){if(this._internalAbstractMeshDataInfo._visibility===u)return;const G=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=u,(1===G&&1!==u||1!==G&&1===u)&&this._markSubMeshesAsDirty((u=>{u.markAsMiscDirty(),u.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(u){this._internalAbstractMeshDataInfo._inheritVisibility=u}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let u=this._parentNode;for(;u;){const G=u.isVisible;if("undefined"!==typeof G)return G;u=u.parent}}return this._isVisible}set isVisible(u){this._isVisible=u}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(u){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=u}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(u){this._internalAbstractMeshDataInfo._renderingGroupId=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){this._setMaterial(u)}_setMaterial(u){this._internalAbstractMeshDataInfo._material!==u&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=u,u&&u.meshMap&&(u.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.xf&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(u){var G;return null===(G=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===G?void 0:G[u]}setMaterialForRenderPass(u,G){this.resetDrawCache(u),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[u]=G}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(u){this._internalAbstractMeshDataInfo._receiveShadows!==u&&(this._internalAbstractMeshDataInfo._receiveShadows=u,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(u){this._internalAbstractMeshDataInfo._hasVertexAlpha!==u&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=u,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(u){this._internalAbstractMeshDataInfo._useVertexColors!==u&&(this._internalAbstractMeshDataInfo._useVertexColors=u,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(u){this._internalAbstractMeshDataInfo._numBoneInfluencers!==u&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=u,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(u){this._internalAbstractMeshDataInfo._applyFog!==u&&(this._internalAbstractMeshDataInfo._applyFog=u,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(u){this._internalAbstractMeshDataInfo._enableDistantPicking=u}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(u){u!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=u,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(u)?-1:u}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=u}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(u)?-1:u}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(u){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=u}get lightSources(){return this._lightSources}set skeleton(u){const G=this._internalAbstractMeshDataInfo._skeleton;G&&G.needInitialSkinMatrix&&G._unregisterMeshWithPoseMatrix(this),u&&u.needInitialSkinMatrix&&u._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=u,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(u){var G;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(u,s,!1),G=this,this._internalAbstractMeshDataInfo=new H,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.si=X.ti,this.onCollideObservable=new z.e,this.onCollisionPositionChangeObservable=new z.e,this.onMaterialChangedObservable=new z.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.me=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=V.b.Red(),this.outlineWidth=.02,this.overlayColor=V.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.fg=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new O.q(.5,1,.5),this.ellipsoidOffset=new O.q(0,0,0),this.edgesWidth=1,this.edgesColor=new V.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,wh:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new z.e,this._onCollisionPositionChange=function(u,s){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s.subtractToRef(G._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,G._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),G._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>l.b.CollisionsEpsilon&&G.position.addInPlace(G._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),T&&G.onCollideObservable.notifyObservers(T),G.onCollisionPositionChangeObservable.notifyObservers(G.position)},s=this.va(),s.ai(this),this._resyncLightSources(),this._uniformBuffer=new b.c(this.va().getEngine(),void 0,void 0,u,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),s.performancePriority){case 2:this.Da=!0;case 1:this.fg=!0,this.me=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(u){const G=this._uniformBuffer;G.xj("world",u),G.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),G.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(u){let G="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");G+=", # of submeshes: "+(this.xf?this.xf.length:0);const s=this._internalAbstractMeshDataInfo._skeleton;return s&&(G+=", skeleton: "+s.name),u&&(G+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],G+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.wh?"YES":"NO")),G}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==C.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(G||this.actionManager.isRecursive)){if(!u)return this.actionManager;if(this.actionManager.hasSpecificTrigger(u))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.xf){for(const u of this.xf)u._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const u of this.va().lights)u.isEnabled()&&u.canAffectMesh(this)&&this._lightSources.push(u);this._markSubMeshesAsLightDirty()}_resyncLightSource(u){const G=u.isEnabled()&&u.canAffectMesh(this),s=this._lightSources.indexOf(u);let T=!1;if(-1===s){if(!G)return;this._lightSources.push(u)}else{if(G)return;T=!0,this._lightSources.splice(s,1)}this._markSubMeshesAsLightDirty(T)}_unBindEffect(){for(const u of this.xf)u.setEffect(null)}_removeLightSource(u,G){const s=this._lightSources.indexOf(u);-1!==s&&(this._lightSources.splice(s,1),this._markSubMeshesAsLightDirty(G))}_markSubMeshesAsDirty(u){if(this.xf)for(const G of this.xf)for(let s=0;s<G._drawWrappers.length;++s){const T=G._drawWrappers[s];T&&T.defines&&T.defines.markAllAsDirty&&u(T.defines)}}_markSubMeshesAsLightDirty(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((G=>G.markAsLightDirty(u)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((u=>u.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((u=>u.markAsMiscDirty()))}pg(u){return this._currentRenderId=Number.MAX_VALUE,super.pg(u),this._isDirty=!0,this}resetDrawCache(u){if(this.xf)for(const G of this.xf)G.resetDrawCache(u)}get isBlocked(){return!1}getLOD(u){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}kf(){return null}getVerticesData(u){return null}Ga(u,G,s,T){return this}updateVerticesData(u,G,s,T){return this}setIndices(u,G){return this}isVerticesDataPresent(u){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(u){return this._boundingInfo=u,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(u,G,s){return this._boundingInfo=new g.c(u,G,s),this._boundingInfo}normalizeToUnitCube(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(u,G,s)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(m.f.MatricesIndicesKind)&&this.isVerticesDataPresent(m.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(u){}_activate(u,G){return this._renderId=u,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===C.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(u,G,s){return this.position.addInPlace(this.calcMovePOV(u,G,s)),this}calcMovePOV(u,G,s){const T=new O.d;(this.rotationQuaternion?this.rotationQuaternion:O.h.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(T);const z=O.q.Zero(),m=this.definedFacingForward?-1:1;return O.q.TransformCoordinatesFromFloatsToRef(u*m,G,s*m,T,z),z}rotatePOV(u,G,s){return this.rotation.addInPlace(this.calcRotatePOV(u,G,s)),this}calcRotatePOV(u,G,s){const T=this.definedFacingForward?1:-1;return new O.q(u*T,G,s*T)}Fa(u,G){if(u){const s=(0,n.i)(u,0,this.getTotalVertices(),G);this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new g.c(s.minimum,s.maximum)}if(this.xf)for(let s=0;s<this.xf.length;s++)this.xf[s].refreshBoundingInfo(u);this.Ea()}_refreshBoundingInfoDirect(u){if(this._boundingInfo?this._boundingInfo.reConstruct(u.minimum,u.maximum):this._boundingInfo=new g.c(u.minimum,u.maximum),this.xf)for(let G=0;G<this.xf.length;G++)this.xf[G].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(u,G,s,T,z,f,C){!function(u,G,s,T,z,f,C){const x=O.l.gb[0],g=O.l.Matrix[0],b=O.l.Matrix[1],Q=G===m.f.NormalKind?O.q.TransformNormalFromFloatsToRef:O.q.TransformCoordinatesFromFloatsToRef;for(let m=0,Y=0;m<u.length;m+=3,Y+=4){let G,n;for(g.reset(),G=0;G<4;G++)n=z[Y+G],n>0&&(O.d.FromFloat32ArrayToRefScaled(s,Math.floor(16*T[Y+G]),n,b),g.addToSelf(b));if(f&&C)for(G=0;G<4;G++)n=C[Y+G],n>0&&(O.d.FromFloat32ArrayToRefScaled(s,Math.floor(16*f[Y+G]),n,b),g.addToSelf(b));Q(u[m],u[m+1],u[m+2],g,x),x.toArray(u,m)}}(u,G,s,T,z,f,C)}_getData(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.f.PositionKind;const T=u.cache,z=u=>{if(T){const G=T._vertexData||(T._vertexData={});return G[u]||this.copyVerticesData(u,G),G[u]}return this.getVerticesData(u)};if(G||(G=z(s)),!G)return null;if(T?(T._outputData?T._outputData.set(G):T._outputData=new Float32Array(G),G=T._outputData):(u.applyMorph&&this.morphTargetManager||u.applySkeleton&&this.skeleton)&&(G=G.slice()),u.applyMorph&&this.morphTargetManager&&function(u,G,s){let T=null;switch(G){case m.f.PositionKind:T=u=>u.getPositions();break;case m.f.NormalKind:T=u=>u.getNormals();break;case m.f.TangentKind:T=u=>u.getTangents();break;case m.f.UVKind:T=u=>u.getUVs();break;default:return}for(let z=0;z<u.length;z++){let G=u[z];for(let O=0;O<s.numTargets;O++){const m=s.getTarget(O),f=m.influence;if(0!==f){const s=T(m);s&&(G+=(s[z]-u[z])*f)}}u[z]=G}}(G,s,this.morphTargetManager),u.applySkeleton&&this.skeleton){const u=z(m.f.MatricesIndicesKind),T=z(m.f.MatricesWeightsKind);if(T&&u){const O=this.numBoneInfluencers>4,f=O?z(m.f.MatricesIndicesExtraKind):null,C=O?z(m.f.MatricesWeightsExtraKind):null,x=this.skeleton.getTransformMatrices(this);X._ApplySkeleton(G,s,x,u,T,f,C)}}if(!1!==u.updatePositionsArray&&s===m.f.PositionKind){const u=this._internalAbstractMeshDataInfo._positions||[],s=u.length;if(u.length=G.length/3,s<u.length)for(let G=s;G<u.length;G++)u[G]=new O.q;for(let T=0,z=0;T<u.length;T++,z+=3)u[T].hf(G[z],G[z+1],G[z+2]);this._internalAbstractMeshDataInfo._positions=u}return G}getNormalsData(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:u,applyMorph:G,updatePositionsArray:!1},null,m.f.NormalKind)}xe(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:u,applyMorph:G,updatePositionsArray:!1},s,m.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new g.c(O.q.Zero(),O.q.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(u){if(!this.xf)return this;const G=this.xf.length;for(let s=0;s<G;s++){const T=this.xf[s];(G>1||!T.IsGlobal)&&T.updateBoundingInfo(u)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(u){return this.getBoundingInfo().isInFrustum(u,this.si)}isCompletelyInFrustum(u){return this.getBoundingInfo().isCompletelyInFrustum(u)}intersectsMesh(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;const T=this.getBoundingInfo(),z=u.getBoundingInfo();if(T.intersects(z,G))return!0;if(s)for(const O of this.getChildMeshes())if(O.intersectsMesh(u,G,!0))return!0;return!1}intersectsPoint(u){return this.getBoundingInfo().intersectsPoint(u)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(u){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=u}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(u){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const G=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=G.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,G.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,u,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(u,G,s){var T;if(this._generatePointsArray(),!this._positions)return this;if(!u._lastColliderWorldVertices||!u._lastColliderTransformMatrix.equals(G)){u._lastColliderTransformMatrix=G.clone(),u._lastColliderWorldVertices=[],u._trianglePlanes=[];const s=u.verticesStart,T=u.verticesStart+u.verticesCount;for(let z=s;z<T;z++)u._lastColliderWorldVertices.push(O.q.TransformCoordinates(this._positions[z],G))}return s._collide(u._trianglePlanes,u._lastColliderWorldVertices,this.kf(),u.indexStart,u.indexStart+u.indexCount,u.verticesStart,!!u.Ha(),this,this._shouldConvertRHS(),7===(null===(T=u.Ha())||void 0===T?void 0:T.fillMode)),this}_processCollisionsForSubMeshes(u,G){const s=this._scene.getCollidingSubMeshCandidates(this,u),T=s.length;for(let z=0;z<T;z++){const O=s.data[z];T>1&&!O._checkCollision(u)||this._collideForSubMesh(O,G,u)}return this}_shouldConvertRHS(){return!1}_checkCollision(u){if(!this.getBoundingInfo()._checkCollision(u))return this;const G=O.l.Matrix[0],s=O.l.Matrix[1];return O.d.ScalingToRef(1/u._radius.x,1/u._radius.y,1/u._radius.z,G),this.worldMatrixFromCache.multiplyToRef(G,s),this._processCollisionsForSubMeshes(u,s),this}_generatePointsArray(){return!1}intersects(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=new x.c,C=this.getClassName(),g="InstancedLinesMesh"===C||"LinesMesh"===C||"GreasedLineMesh"===C?this.intersectionThreshold:0,b=this.getBoundingInfo();if(!this.xf)return f;if(!m&&(!u.intersectsSphere(b.boundingSphere,g)||!u.intersectsBox(b.boundingBox,g)))return f;if(T)return f.hit=!m,f.pickedMesh=m?null:this,f.distance=m?0:O.q.Distance(u.origin,b.boundingSphere.center),f.subMeshId=0,f;if(!this._generatePointsArray())return f;let Q=null;const Y=this._scene.getIntersectingSubMeshCandidates(this,u),n=Y.length;let V=!1;for(let O=0;O<n;O++){const u=Y.data[O].Ha();if(u&&(7==u.fillMode||0==u.fillMode||1==u.fillMode||2==u.fillMode||4==u.fillMode)){V=!0;break}}if(!V)return f.hit=!0,f.pickedMesh=this,f.distance=O.q.Distance(u.origin,b.boundingSphere.center),f.subMeshId=-1,f;for(let O=0;O<n;O++){const T=Y.data[O];if(n>1&&!m&&!T.canIntersects(u))continue;const z=T.intersects(u,this._positions,this.kf(),G,s);if(z&&(G||!Q||z.distance<Q.distance)&&(Q=z,Q.subMeshId=O,G))break}if(Q){const G=z??this.getWorldMatrix(),s=O.l.gb[0],T=O.l.gb[1];O.q.TransformCoordinatesToRef(u.origin,G,s),u.direction.scaleToRef(Q.distance,T);const m=O.q.TransformNormal(T,G).addInPlace(s);return f.hit=!0,f.distance=O.q.Distance(s,m),f.pickedPoint=m,f.pickedMesh=this,f.bu=Q.bu||0,f.bv=Q.bv||0,f.subMeshFaceId=Q.faceId,f.faceId=Q.faceId+Y.data[Q.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),f.subMeshId=Q.subMeshId,f}return f}clone(u,G,s){return null}releaseSubMeshes(){if(this.xf)for(;this.xf.length;)this.xf[0].dispose();else this.xf=[];return this}dispose(u){let G,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const T=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),T.freeActiveMeshes(),T.freeRenderingGroups(),T.renderingManager.maintainStateBetweenFrames&&T.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((u=>u!==this&&u.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),G=0;G<this._intersectionsInProgress.length;G++){const u=this._intersectionsInProgress[G],s=u._intersectionsInProgress.indexOf(this);u._intersectionsInProgress.splice(s,1)}this._intersectionsInProgress.length=0;T.lights.forEach((u=>{let G=u.includedOnlyMeshes.indexOf(this);-1!==G&&u.includedOnlyMeshes.splice(G,1),G=u.excludedMeshes.indexOf(this),-1!==G&&u.excludedMeshes.splice(G,1);const s=u.getShadowGenerators();if(s){const u=s.values();for(let s=u.next();!0!==s.done;s=u.next()){const u=s.value.getShadowMap();u&&u.renderList&&(G=u.renderList.indexOf(this),-1!==G&&u.renderList.splice(G,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const z=T.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,z.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),z.wipeCaches(),T.Kg(this),this._parentContainer){const u=this._parentContainer.meshes.indexOf(this);u>-1&&this._parentContainer.meshes.splice(u,1),this._parentContainer=null}if(s&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!u)for(G=0;G<T.fj.length;G++)T.fj[G].k===this&&(T.fj[G].dispose(),G--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(u,s)}_initFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetNormals||(u.facetNormals=[]),u.facetPositions||(u.facetPositions=[]),u.facetPartitioning||(u.facetPartitioning=new Array),u.facetNb=this.kf().length/3|0,u.partitioningSubdivisions=u.partitioningSubdivisions?u.partitioningSubdivisions:10,u.partitioningBBoxRatio=u.partitioningBBoxRatio?u.partitioningBBoxRatio:1.01;for(let G=0;G<u.facetNb;G++)u.facetNormals[G]=O.q.Zero(),u.facetPositions[G]=O.q.Zero();return u.facetDataEnabled=!0,this}updateFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetDataEnabled||this._initFacetData();const G=this.getVerticesData(m.f.PositionKind),s=this.kf(),T=this.getVerticesData(m.f.NormalKind),z=this.getBoundingInfo();if(u.facetDepthSort&&!u.facetDepthSortEnabled){if(u.facetDepthSortEnabled=!0,s instanceof Uint16Array)u.depthSortedIndices=new Uint16Array(s);else if(s instanceof Uint32Array)u.depthSortedIndices=new Uint32Array(s);else{let G=!1;for(let u=0;u<s.length;u++)if(s[u]>65535){G=!0;break}u.depthSortedIndices=G?new Uint32Array(s):new Uint16Array(s)}if(u.facetDepthSortFunction=function(u,G){return G.sqDistance-u.sqDistance},!u.facetDepthSortFrom){const G=this.va().activeCamera;u.facetDepthSortFrom=G?G.position:O.q.Zero()}u.depthSortedFacets=[];for(let G=0;G<u.facetNb;G++){const s={ind:3*G,sqDistance:0};u.depthSortedFacets.push(s)}u.invertedMatrix=O.d.Identity(),u.facetDepthSortOrigin=O.q.Zero()}u.bbSize.x=z.maximum.x-z.minimum.x>F.e?z.maximum.x-z.minimum.x:F.e,u.bbSize.y=z.maximum.y-z.minimum.y>F.e?z.maximum.y-z.minimum.y:F.e,u.bbSize.z=z.maximum.z-z.minimum.z>F.e?z.maximum.z-z.minimum.z:F.e;let C=u.bbSize.x>u.bbSize.y?u.bbSize.x:u.bbSize.y;if(C=C>u.bbSize.z?C:u.bbSize.z,u.subDiv.max=u.partitioningSubdivisions,u.subDiv.X=Math.floor(u.subDiv.max*u.bbSize.x/C),u.subDiv.Y=Math.floor(u.subDiv.max*u.bbSize.y/C),u.subDiv.Z=Math.floor(u.subDiv.max*u.bbSize.z/C),u.subDiv.X=u.subDiv.X<1?1:u.subDiv.X,u.subDiv.Y=u.subDiv.Y<1?1:u.subDiv.Y,u.subDiv.Z=u.subDiv.Z<1?1:u.subDiv.Z,u.facetParameters.facetNormals=this.getFacetLocalNormals(),u.facetParameters.facetPositions=this.getFacetLocalPositions(),u.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),u.facetParameters.bInfo=z,u.facetParameters.bbSize=u.bbSize,u.facetParameters.subDiv=u.subDiv,u.facetParameters.ratio=this.partitioningBBoxRatio,u.facetParameters.depthSort=u.facetDepthSort,u.facetDepthSort&&u.facetDepthSortEnabled&&(this.Gj(!0),this._worldMatrix.invertToRef(u.invertedMatrix),O.q.TransformCoordinatesToRef(u.facetDepthSortFrom,u.invertedMatrix,u.facetDepthSortOrigin),u.facetParameters.distanceTo=u.facetDepthSortOrigin),u.facetParameters.depthSortedFacets=u.depthSortedFacets,T&&f.b.ComputeNormals(G,s,T,u.facetParameters),u.facetDepthSort&&u.facetDepthSortEnabled){u.depthSortedFacets.sort(u.facetDepthSortFunction);const G=u.depthSortedIndices.length/3|0;for(let T=0;T<G;T++){const G=u.depthSortedFacets[T].ind;u.depthSortedIndices[3*T]=s[G],u.depthSortedIndices[3*T+1]=s[G+1],u.depthSortedIndices[3*T+2]=s[G+2]}this.updateIndices(u.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetNormals||this.updateFacetData(),u.facetNormals}getFacetLocalPositions(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPositions||this.updateFacetData(),u.facetPositions}getFacetLocalPartitioning(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPartitioning||this.updateFacetData(),u.facetPartitioning}getFacetPosition(u){const G=O.q.Zero();return this.getFacetPositionToRef(u,G),G}getFacetPositionToRef(u,G){const s=this.getFacetLocalPositions()[u],T=this.getWorldMatrix();return O.q.TransformCoordinatesToRef(s,T,G),this}getFacetNormal(u){const G=O.q.Zero();return this.getFacetNormalToRef(u,G),G}getFacetNormalToRef(u,G){const s=this.getFacetLocalNormals()[u];return O.q.TransformNormalToRef(s,this.getWorldMatrix(),G),this}getFacetsAtLocalCoordinates(u,G,s){const T=this.getBoundingInfo(),z=this._internalAbstractMeshDataInfo._facetData,O=Math.floor((u-T.minimum.x*z.partitioningBBoxRatio)*z.subDiv.X*z.partitioningBBoxRatio/z.bbSize.x),m=Math.floor((G-T.minimum.y*z.partitioningBBoxRatio)*z.subDiv.Y*z.partitioningBBoxRatio/z.bbSize.y),f=Math.floor((s-T.minimum.z*z.partitioningBBoxRatio)*z.subDiv.Z*z.partitioningBBoxRatio/z.bbSize.z);return O<0||O>z.subDiv.max||m<0||m>z.subDiv.max||f<0||f>z.subDiv.max?null:z.facetPartitioning[O+z.subDiv.max*m+z.subDiv.max*z.subDiv.max*f]}getClosestFacetAtCoordinates(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const f=this.getWorldMatrix(),C=O.l.Matrix[5];f.invertToRef(C);const x=O.l.gb[8];O.q.TransformCoordinatesFromFloatsToRef(u,G,s,C,x);const g=this.getClosestFacetAtLocalCoordinates(x.x,x.y,x.z,T,z,m);return T&&O.q.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,f,T),g}getClosestFacetAtLocalCoordinates(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=null,f=0,C=0,x=0,g=0,b=0,Q=0,Y=0,n=0;const V=this.getFacetLocalPositions(),F=this.getFacetLocalNormals(),r=this.getFacetsAtLocalCoordinates(u,G,s);if(!r)return null;let c,j,l,P=Number.MAX_VALUE,H=P;for(let X=0;X<r.length;X++)c=r[X],j=F[c],l=V[c],g=(u-l.x)*j.x+(G-l.y)*j.y+(s-l.z)*j.z,(!z||z&&O&&g>=0||z&&!O&&g<=0)&&(g=j.x*l.x+j.y*l.y+j.z*l.z,b=-(j.x*u+j.y*G+j.z*s-g)/(j.x*j.x+j.y*j.y+j.z*j.z),Q=u+j.x*b,Y=G+j.y*b,n=s+j.z*b,f=Q-u,C=Y-G,x=n-s,H=f*f+C*C+x*x,H<P&&(P=H,m=c,T&&(T.x=Q,T.y=Y,T.z=n)));return m}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetDataEnabled&&(u.facetDataEnabled=!1,u.facetPositions=[],u.facetNormals=[],u.facetPartitioning=new Array,u.facetParameters=null,u.depthSortedIndices=new Uint32Array(0)),this}updateIndices(u,G){return this}createNormals(u){const G=this.getVerticesData(m.f.PositionKind),s=this.kf();let T;return T=this.isVerticesDataPresent(m.f.NormalKind)?this.getVerticesData(m.f.NormalKind):[],f.b.ComputeNormals(G,s,T,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(m.f.NormalKind,T,u),this}alignWithNormal(u,G){G||(G=r.e.Y);const s=O.l.gb[0],T=O.l.gb[1];return O.q.CrossToRef(G,u,T),O.q.CrossToRef(u,T,s),this.rotationQuaternion?O.h.RotationQuaternionFromAxisToRef(s,u,T,this.rotationQuaternion):O.q.RotationFromAxisToRef(s,u,T,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,Y.c)("EdgesRenderer")}enableEdgesRendering(u,G,s){throw(0,Y.c)("EdgesRenderer")}gj(){return this._scene.fj.filter((u=>u.k===this))}}X.OCCLUSION_TYPE_NONE=0,X.OCCLUSION_TYPE_OPTIMISTIC=1,X.OCCLUSION_TYPE_STRICT=2,X.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,X.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,X.CULLINGSTRATEGY_STANDARD=0,X.ti=1,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,T.b)([j.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T,z,O,m,f]=G;return!Array.isArray(T)&&!Array.isArray(z)&&!Array.isArray(O)&&!Array.isArray(m)&&!Array.isArray(f)}))],X,"_ApplySkeleton",null),(0,c.g)("BABYLON.AbstractMesh",X)},11181:(u,G,s)=>{"use strict";s.d(G,{d:()=>F});var T=s(10904),z=s(10930),O=s(11173),m=s(10961),f=s(11050),C=s(11186),x=s(11059),g=s(10564),b=s(10896),Q=s(11078),Y=s(10619),n=s(11121),V=s(10584);class F{get boundingBias(){return this._boundingBias}set boundingBias(u){this._boundingBias?this._boundingBias.p(u):this._boundingBias=u.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(u){const G=new F(F.RandomId(),u.va());return G.Ca(u),G}get meshes(){return this._meshes}constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=G||Y.d.LastCreatedScene,this._scene&&(this.id=u,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=T,s?this.setAllVerticesData(s,T):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),z&&(this.Ca(z),z.Gj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let u=0;u<this._meshes.length;u++)if(!this._meshes[u].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const u=new Set;for(const G in this._vertexBuffers)u.add(this._vertexBuffers[G].getWrapperBuffer());u.forEach((u=>{u._rebuild()}))}setAllVerticesData(u,G){u.applyToGeometry(this,G),this._notifyUpdate()}Ga(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;s&&Array.isArray(G)&&(G=new Float32Array(G));const z=new m.f(this._engine,G,u,{updatable:s,postponeInternalCreation:0===this._meshes.length,stride:T,label:"Geometry_"+this.id+"_"+u});this.setVerticesBuffer(z)}removeVerticesData(u){this._vertexBuffers[u]&&(this._vertexBuffers[u].dispose(),delete this._vertexBuffers[u]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=u.getKind();this._vertexBuffers[z]&&s&&this._vertexBuffers[z].dispose(),u._buffer&&u._buffer._increaseReferences(),this._vertexBuffers[z]=u;const O=this._meshes,f=O.length;if(z===m.f.PositionKind){this._totalVertices=G??u._maxVerticesCount,this._updateExtend(u.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const s=this._extend&&this._extend.minimum||new T.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),z=this._extend&&this._extend.maximum||new T.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let u=0;u<f;u++){const G=O[u];G.buildBoundingInfo(s,z),G._createGlobalSubMesh(G.isUnIndexed),G.Gj(!0),G.synchronizeInstances()}}this._notifyUpdate(z)}updateVerticesDataDirectly(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getVertexBuffer(u);z&&(z.updateDirectly(G,s,T),this._notifyUpdate(u))}updateVerticesData(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=this.getVertexBuffer(u);T&&(T.update(G),u===m.f.PositionKind&&this.Ea(s,G),this._notifyUpdate(u))}Ea(u,G){if(u&&this._updateExtend(G),this._resetPointsArrayCache(),u){const u=this._meshes;for(const G of u){G.hasBoundingInfo?G.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):G.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const u=G.xf;for(const G of u)G.refreshBoundingInfo()}}}_bind(u,G,s,T){if(!u)return;void 0===G&&(G=this._indexBuffer);const z=this.getVertexBuffers();if(!z)return;if(G!=this._indexBuffer||!this._vertexArrayObjects&&!T)return void this._engine.bindBuffers(z,G,u,s);const O=T||this._vertexArrayObjects,m=this._engine;O[u.key]||(O[u.key]=m.recordVertexArrayObject(z,G,u,s)),m.bindVertexArrayObject(O[u.key],G)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(u,G,s){const T=this.getVertexBuffer(u);return T?T.getFloatData(this._totalVertices,s||G&&1!==this._meshes.length):null}copyVerticesData(u,G){const s=this.getVertexBuffer(u);if(!s)return;G[u]||(G[u]=new Float32Array(this._totalVertices*s.getSize()));const T=s.getData();T&&function(u,G,s,T,z,O,f,C){const x=G*m.f.GetTypeByteLength(s),g=f*G;if(C.length!==g)throw new Error("Output length is not valid");if(s===m.f.FLOAT&&z===x)if(u instanceof Array){const G=T/4;C.set(u,G)}else if(u instanceof ArrayBuffer){const G=new Float32Array(u,T,g);C.set(G)}else{const G=u.byteOffset+T;if(G%4)return V.d.Warn("CopyFloatData: copied misaligned data."),void C.set(new Float32Array(u.buffer.slice(G,G+4*g)));const s=new Float32Array(u.buffer,G,g);C.set(s)}else m.f.ForEach(u,T,z,G,s,g,O,((u,G)=>C[G]=u))}(T,s.getSize(),s.type,s.byteOffset,s.byteStride,s.normalized,this._totalVertices,G[u])}isVertexBufferUpdatable(u){const G=this._vertexBuffers[u];return!!G&&G.isUpdatable()}getVertexBuffer(u){return this.isReady()?this._vertexBuffers[u]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(u){return this._vertexBuffers?void 0!==this._vertexBuffers[u]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}getVerticesDataKinds(){const u=[];let G;if(!this._vertexBuffers&&this._delayInfo)for(G in this._delayInfo)u.push(G);else for(G in this._vertexBuffers)u.push(G);return u}updateIndices(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const T=u.length!==this._indices.length;if(s||(this._indices=u.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,u,G),T)for(const u of this._meshes)u._createGlobalSubMesh(!0)}else this.setIndices(u,null,!0)}setIndexBuffer(u,G,s){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=u,this._totalVertices=G,this._totalIndices=s,u.is32Bits||(u.is32Bits=this._totalIndices>65535);for(const T of this._meshes)T._createGlobalSubMesh(!0),T.synchronizeInstances();this._notifyUpdate()}setIndices(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=u,this._indexBufferIsUpdatable=s,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,s,"Geometry_"+this.id+"_IndexBuffer")),void 0!=G&&(this._totalVertices=G);for(const z of this._meshes)z._createGlobalSubMesh(!T),z.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}kf(u,G){if(!this.isReady())return null;const s=this._indices;return G||u&&1!==this._meshes.length?s.slice():s}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u&&this._vertexArrayObjects&&this._vertexArrayObjects[u.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[u.key]),delete this._vertexArrayObjects[u.key])}releaseForMesh(u,G){const s=this._meshes,T=s.indexOf(u);-1!==T&&(s.splice(T,1),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject(),u._geometry=null,0===s.length&&G&&this.dispose())}Ca(u){if(u._geometry===this)return;const G=u._geometry;G&&G.releaseForMesh(u),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject();const s=this._meshes;u._geometry=this,u._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),s.push(u),this.isReady()?this._applyToMesh(u):this._boundingInfo&&u.setBoundingInfo(this._boundingInfo)}_updateExtend(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!u&&(u=this.getVerticesData(m.f.PositionKind),!u))return;this._extend=(0,Q.i)(u,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(u){const G=this._meshes.length;for(const s in this._vertexBuffers)1===G&&this._vertexBuffers[s].create(),s===m.f.PositionKind&&(this._extend||this._updateExtend(),u.buildBoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(u.isUnIndexed),u.Ea());1===G&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),u._syncGeometryWithMorphTargetManager(),u.synchronizeInstances()}_notifyUpdate(u){this.onGeometryUpdated&&this.onGeometryUpdated(this,u),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const G of this._meshes)G._markSubMeshesAsAttributesDirty()}load(u,G){2!==this.delayLoadState&&(this.isReady()?G&&G():(this.delayLoadState=2,this._queueLoad(u,G)))}_queueLoad(u,G){this.delayLoadingFile&&(u.addPendingData(this),u._loadFile(this.delayLoadingFile,(s=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(s),this),this.delayLoadState=1,this._delayInfo=[],u.removePendingData(this);const T=this._meshes,z=T.length;for(let u=0;u<z;u++)this._applyToMesh(T[u]);G&&G()}),void 0,!0))}toLeftHanded(){const u=this.kf(!1);if(null!=u&&u.length>0){for(let G=0;G<u.length;G+=3){const s=u[G+0];u[G+0]=u[G+2],u[G+2]=s}this.setIndices(u)}const G=this.getVerticesData(m.f.PositionKind,!1);if(null!=G&&G.length>0){for(let u=0;u<G.length;u+=3)G[u+2]=-G[u+2];this.Ga(m.f.PositionKind,G,!1)}const s=this.getVerticesData(m.f.NormalKind,!1);if(null!=s&&s.length>0){for(let u=0;u<s.length;u+=3)s[u+2]=-s[u+2];this.Ga(m.f.NormalKind,s,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const u=this.getVerticesData(m.f.PositionKind);if(!u||0===u.length)return!1;for(let G=3*this._positionsCache.length,s=this._positionsCache.length;G<u.length;G+=3,++s)this._positionsCache[s]=T.q.Ag(u,G);for(let G=0,s=0;G<u.length;G+=3,++s)this._positionsCache[s].set(u[0+G],u[1+G],u[2+G]);return this._positionsCache.length=u.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const s in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[s]);this._vertexArrayObjects={};const u=this._meshes,G=u.length;for(let s=0;s<G;s++)u[s]._invalidateInstanceVertexArrayObject()}}dispose(){const u=this._meshes,G=u.length;let s;for(s=0;s<G;s++)this.releaseForMesh(u[s]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const T in this._vertexBuffers)this._vertexBuffers[T].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const u=this._parentContainer.geometries.indexOf(this);u>-1&&this._parentContainer.geometries.splice(u,1),this._parentContainer=null}this._isDisposed=!0}j(u){const G=new O.b;G.indices=[];const s=this.kf();if(s)for(let O=0;O<s.length;O++)G.indices.push(s[O]);let T,z=!1,m=!1;for(T in this._vertexBuffers){const u=this.getVerticesData(T);if(u&&(u instanceof Float32Array?G.set(new Float32Array(u),T):G.set(u.slice(0),T),!m)){const u=this.getVertexBuffer(T);u&&(z=u.isUpdatable(),m=!z)}}const f=new F(u,this._scene,G,z);for(T in f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(T);return f._boundingInfo=new x.c(this._extend.minimum,this._extend.maximum),f}serialize(){const u={};return u.id=this.id,u.uniqueId=this.uniqueId,u.updatable=this._updatable,b.c&&b.c.HasTags(this)&&(u.tags=b.c.GetTags(this)),u}_toNumberArray(u){return Array.isArray(u)?u:Array.prototype.slice.call(u)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const u in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,u)&&(this._vertexBuffers[u]._buffer._data=null)}serializeVerticeData(){const u=this.serialize();return this.isVerticesDataPresent(m.f.PositionKind)&&(u.xa=this._toNumberArray(this.getVerticesData(m.f.PositionKind)),this.isVertexBufferUpdatable(m.f.PositionKind)&&(u.xa._updatable=!0)),this.isVerticesDataPresent(m.f.NormalKind)&&(u.ya=this._toNumberArray(this.getVerticesData(m.f.NormalKind)),this.isVertexBufferUpdatable(m.f.NormalKind)&&(u.ya._updatable=!0)),this.isVerticesDataPresent(m.f.TangentKind)&&(u.tangents=this._toNumberArray(this.getVerticesData(m.f.TangentKind)),this.isVertexBufferUpdatable(m.f.TangentKind)&&(u.tangents._updatable=!0)),this.isVerticesDataPresent(m.f.UVKind)&&(u.Aa=this._toNumberArray(this.getVerticesData(m.f.UVKind)),this.isVertexBufferUpdatable(m.f.UVKind)&&(u.Aa._updatable=!0)),this.isVerticesDataPresent(m.f.UV2Kind)&&(u.uvs2=this._toNumberArray(this.getVerticesData(m.f.UV2Kind)),this.isVertexBufferUpdatable(m.f.UV2Kind)&&(u.uvs2._updatable=!0)),this.isVerticesDataPresent(m.f.UV3Kind)&&(u.uvs3=this._toNumberArray(this.getVerticesData(m.f.UV3Kind)),this.isVertexBufferUpdatable(m.f.UV3Kind)&&(u.uvs3._updatable=!0)),this.isVerticesDataPresent(m.f.UV4Kind)&&(u.uvs4=this._toNumberArray(this.getVerticesData(m.f.UV4Kind)),this.isVertexBufferUpdatable(m.f.UV4Kind)&&(u.uvs4._updatable=!0)),this.isVerticesDataPresent(m.f.UV5Kind)&&(u.uvs5=this._toNumberArray(this.getVerticesData(m.f.UV5Kind)),this.isVertexBufferUpdatable(m.f.UV5Kind)&&(u.uvs5._updatable=!0)),this.isVerticesDataPresent(m.f.UV6Kind)&&(u.uvs6=this._toNumberArray(this.getVerticesData(m.f.UV6Kind)),this.isVertexBufferUpdatable(m.f.UV6Kind)&&(u.uvs6._updatable=!0)),this.isVerticesDataPresent(m.f.ColorKind)&&(u.za=this._toNumberArray(this.getVerticesData(m.f.ColorKind)),this.isVertexBufferUpdatable(m.f.ColorKind)&&(u.za._updatable=!0)),this.isVerticesDataPresent(m.f.MatricesIndicesKind)&&(u.matricesIndices=this._toNumberArray(this.getVerticesData(m.f.MatricesIndicesKind)),u.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(m.f.MatricesIndicesKind)&&(u.matricesIndices._updatable=!0)),this.isVerticesDataPresent(m.f.MatricesWeightsKind)&&(u.matricesWeights=this._toNumberArray(this.getVerticesData(m.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(m.f.MatricesWeightsKind)&&(u.matricesWeights._updatable=!0)),u.indices=this._toNumberArray(this.kf()),u}static ExtractFromMesh(u,G){const s=u._geometry;return s?s.j(G):null}static RandomId(){return g.e.RandomId()}static _GetGeometryByLoadedUniqueId(u,G){for(let s=0;s<G.geometries.length;s++)if(G.geometries[s]._loadedUniqueId===u)return G.geometries[s];return null}static _ImportGeometry(u,G){const s=G.va(),T=u.geometryUniqueId,O=u.geometryId;if(T||O){const u=T?this._GetGeometryByLoadedUniqueId(T,s):s.getGeometryById(O);u&&u.Ca(G)}else if(u instanceof ArrayBuffer){const s=G._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){const T=new Float32Array(u,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);G.Ga(m.f.PositionKind,T,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){const T=new Float32Array(u,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);G.Ga(m.f.NormalKind,T,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){const T=new Float32Array(u,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);G.Ga(m.f.TangentKind,T,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){const T=new Float32Array(u,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UVKind,T,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){const T=new Float32Array(u,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UV2Kind,T,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){const T=new Float32Array(u,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UV3Kind,T,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){const T=new Float32Array(u,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UV4Kind,T,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){const T=new Float32Array(u,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UV5Kind,T,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){const T=new Float32Array(u,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);if(n.e)for(let u=1;u<T.length;u+=2)T[u]=1-T[u];G.Ga(m.f.UV6Kind,T,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){const T=new Float32Array(u,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);G.Ga(m.f.ColorKind,T,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){const T=new Int32Array(u,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),z=[];for(let u=0;u<T.length;u++){const G=T[u];z.push(255&G),z.push((65280&G)>>8),z.push((16711680&G)>>16),z.push(G>>24&255)}G.Ga(m.f.MatricesIndicesKind,z,!1)}if(s.matricesIndicesExtraAttrDesc&&s.matricesIndicesExtraAttrDesc.count>0){const T=new Int32Array(u,s.matricesIndicesExtraAttrDesc.offset,s.matricesIndicesExtraAttrDesc.count),z=[];for(let u=0;u<T.length;u++){const G=T[u];z.push(255&G),z.push((65280&G)>>8),z.push((16711680&G)>>16),z.push(G>>24&255)}G.Ga(m.f.MatricesIndicesExtraKind,z,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){const T=new Float32Array(u,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);G.Ga(m.f.MatricesWeightsKind,T,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){const T=new Int32Array(u,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);G.setIndices(T,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){const T=new Int32Array(u,s.subMeshesAttrDesc.offset,5*s.subMeshesAttrDesc.count);G.xf=[];for(let u=0;u<s.subMeshesAttrDesc.count;u++){const s=T[5*u+0],z=T[5*u+1],O=T[5*u+2],m=T[5*u+3],C=T[5*u+4];f.d.AddToMesh(s,z,O,m,C,G)}}}else if(u.xa&&u.ya&&u.indices){if(G.Ga(m.f.PositionKind,u.xa,u.xa._updatable),G.Ga(m.f.NormalKind,u.ya,u.ya._updatable),u.tangents&&G.Ga(m.f.TangentKind,u.tangents,u.tangents._updatable),u.Aa&&G.Ga(m.f.UVKind,u.Aa,u.Aa._updatable),u.uvs2&&G.Ga(m.f.UV2Kind,u.uvs2,u.uvs2._updatable),u.uvs3&&G.Ga(m.f.UV3Kind,u.uvs3,u.uvs3._updatable),u.uvs4&&G.Ga(m.f.UV4Kind,u.uvs4,u.uvs4._updatable),u.uvs5&&G.Ga(m.f.UV5Kind,u.uvs5,u.uvs5._updatable),u.uvs6&&G.Ga(m.f.UV6Kind,u.uvs6,u.uvs6._updatable),u.za&&G.Ga(m.f.ColorKind,z.e.CheckColors4(u.za,u.xa.length/3),u.za._updatable),u.matricesIndices)if(u.matricesIndices._isExpanded)delete u.matricesIndices._isExpanded,G.Ga(m.f.MatricesIndicesKind,u.matricesIndices,u.matricesIndices._updatable);else{const s=[];for(let G=0;G<u.matricesIndices.length;G++){const T=u.matricesIndices[G];s.push(255&T),s.push((65280&T)>>8),s.push((16711680&T)>>16),s.push(T>>24&255)}G.Ga(m.f.MatricesIndicesKind,s,u.matricesIndices._updatable)}if(u.matricesIndicesExtra)if(u.matricesIndicesExtra._isExpanded)delete u.matricesIndices._isExpanded,G.Ga(m.f.MatricesIndicesExtraKind,u.matricesIndicesExtra,u.matricesIndicesExtra._updatable);else{const s=[];for(let G=0;G<u.matricesIndicesExtra.length;G++){const T=u.matricesIndicesExtra[G];s.push(255&T),s.push((65280&T)>>8),s.push((16711680&T)>>16),s.push(T>>24&255)}G.Ga(m.f.MatricesIndicesExtraKind,s,u.matricesIndicesExtra._updatable)}u.matricesWeights&&(F._CleanMatricesWeights(u,G),G.Ga(m.f.MatricesWeightsKind,u.matricesWeights,u.matricesWeights._updatable)),u.matricesWeightsExtra&&G.Ga(m.f.MatricesWeightsExtraKind,u.matricesWeightsExtra,u.matricesWeights._updatable),G.setIndices(u.indices,null)}if(u.xf){G.xf=[];for(let s=0;s<u.xf.length;s++){const T=u.xf[s];f.d.AddToMesh(T.materialIndex,T.verticesStart,T.verticesCount,T.indexStart,T.indexCount,G)}}G._shouldGenerateFlatShading&&(G.convertToFlatShadedMesh(),G._shouldGenerateFlatShading=!1),G.Gj(!0),s.onMeshImportedObservable.notifyObservers(G)}static _CleanMatricesWeights(u,G){const s=.001;if(!C.c.CleanBoneMatrixWeights)return;let T=0;if(!(u.skeletonId>-1))return;{const s=G.va().getLastSkeletonById(u.skeletonId);if(!s)return;T=s.bones.length}const z=G.getVerticesData(m.f.MatricesIndicesKind),O=G.getVerticesData(m.f.MatricesIndicesExtraKind),f=u.matricesWeights,x=u.matricesWeightsExtra,g=u.numBoneInfluencer,b=f.length;for(let m=0;m<b;m+=4){let u=0,G=-1;for(let T=0;T<4;T++){const z=f[m+T];u+=z,z<s&&G<0&&(G=T)}if(x)for(let T=0;T<4;T++){const z=x[m+T];u+=z,z<s&&G<0&&(G=T+4)}if((G<0||G>g-1)&&(G=g-1),u>s){const G=1/u;for(let u=0;u<4;u++)f[m+u]*=G;if(x)for(let u=0;u<4;u++)x[m+u]*=G}else G>=4?(x[m+G-4]=1-u,O[m+G-4]=T):(f[m+G]=1-u,z[m+G]=T)}G.Ga(m.f.MatricesIndicesKind,z),u.matricesWeightsExtra&&G.Ga(m.f.MatricesIndicesExtraKind,O)}static Parse(u,G,s){const z=new F(u.id,G,void 0,u.updatable);return z._loadedUniqueId=u.uniqueId,b.c&&b.c.AddTagsTo(z,u.tags),u.delayLoadingFile?(z.delayLoadState=4,z.delayLoadingFile=s+u.delayLoadingFile,z._boundingInfo=new x.c(T.q.Ag(u.boundingBoxMinimum),T.q.Ag(u.boundingBoxMaximum)),z._delayInfo=[],u.hasUVs&&z._delayInfo.push(m.f.UVKind),u.hasUVs2&&z._delayInfo.push(m.f.UV2Kind),u.hasUVs3&&z._delayInfo.push(m.f.UV3Kind),u.hasUVs4&&z._delayInfo.push(m.f.UV4Kind),u.hasUVs5&&z._delayInfo.push(m.f.UV5Kind),u.hasUVs6&&z._delayInfo.push(m.f.UV6Kind),u.hasColors&&z._delayInfo.push(m.f.ColorKind),u.hasMatricesIndices&&z._delayInfo.push(m.f.MatricesIndicesKind),u.hasMatricesWeights&&z._delayInfo.push(m.f.MatricesWeightsKind),z._delayLoadingFunction=O.b.ImportVertexData):O.b.ImportVertexData(u,z),G.pushGeometry(z,!0),z}}},11882:(u,G,s)=>{"use strict";s.d(G,{d:()=>Q});var T=s(10904),z=s(10584),O=s(11191),m=s(11148),f=s(10592),C=s(11193),x=s(10961),g=s(10564),b=s(10715);m.c._instancedMeshFactory=(u,G)=>{const s=new Q(u,G);if(G.instancedBuffers){s.instancedBuffers={};for(const u in G.instancedBuffers)s.instancedBuffers[u]=G.instancedBuffers[u]}return s};class Q extends O.d{constructor(u,G){super(u,G.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,G.wj(this),this._sourceMesh=G,this._unIndexed=G._unIndexed,this.position.p(G.position),this.rotation.p(G.rotation),this.vf.p(G.vf),G.rotationQuaternion&&(this.rotationQuaternion=G.rotationQuaternion.clone()),this.animations=G.animations.slice();for(const s of G.getAnimationRanges())null!=s&&this.createAnimationRange(s.name,s.from,s.to);this.infiniteDistance=G.infiniteDistance,this.setPivotMatrix(G.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(u){var G;(null===(G=this._sourceMesh)||void 0===G?void 0:G.receiveShadows)!==u&&g.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(u){var G;(null===(G=this._sourceMesh)||void 0===G?void 0:G.material)!==u&&g.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(u){var G;(null===(G=this._sourceMesh)||void 0===G?void 0:G.visibility)!==u&&g.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(u){var G;(null===(G=this._sourceMesh)||void 0===G?void 0:G.skeleton)!==u&&g.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(u){this._sourceMesh&&u!==this._sourceMesh.renderingGroupId&&z.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}ed(u){return this._sourceMesh.ed(u)}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(u,!0)}getVerticesData(u,G,s){return this._sourceMesh.getVerticesData(u,G,s)}copyVerticesData(u,G){this._sourceMesh.copyVerticesData(u,G)}Ga(u,G,s,T){return this.sourceMesh&&this.sourceMesh.Ga(u,G,s,T),this.sourceMesh}updateVerticesData(u,G,s,T){return this.sourceMesh&&this.sourceMesh.updateVerticesData(u,G,s,T),this.sourceMesh}setIndices(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(u,G),this.sourceMesh}isVerticesDataPresent(u){return this._sourceMesh.isVerticesDataPresent(u)}kf(){return this._sourceMesh.kf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let u,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;u="object"===typeof G?G:{applySkeleton:G,applyMorph:s};const T=this._sourceMesh.sj?this._sourceMesh.sj.boundingBias:null;return this.Fa(this._sourceMesh._getData(u,null,x.f.PositionKind),T),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(u,G){if(super._activate(u,G),this._sourceMesh.xf||z.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,u),G){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==C.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new T.d);const u=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,T.l.gb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Gj(!0)),this._currentLOD.position.p(T.l.gb[7]),this._currentLOD._masterMesh=u,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(u){if(!u)return this;const G=this.sourceMesh.getLODLevels();if(G&&0!==G.length){const G=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(u,G.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(u){return this.sourceMesh._preActivateForIntermediateRendering(u)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.xf)for(let u=0;u<this._sourceMesh.xf.length;u++)this._sourceMesh.xf[u].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const T=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).ed(u);if(f.e.DeepCopy(this,T,["name","xf","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),G&&(T.parent=G),!s)for(let z=0;z<this.va().meshes.length;z++){const u=this.va().meshes[z];u.parent===this&&u.clone(u.name,T)}return T.Gj(!0),this.onClonedObservable.notifyObservers(T),T}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.uj(this),super.dispose(u,G)}_serializeAsParent(u){super._serializeAsParent(u),u.parentId=this._sourceMesh.uniqueId,u.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;const T=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0,G&&G.newSourcedMesh);T&&s&&s(this,T);for(const z of this.getChildTransformNodes(!0))z.instantiateHierarchy(T,G,s);return T}}m.c.prototype.registerInstancedBuffer=function(u,G){var s,T;if(null===(s=this._userInstancedBuffersStorage)||void 0===s||null===(T=s.vertexBuffers[u])||void 0===T||T.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const u of this.instances)u.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[u]=null,this._userInstancedBuffersStorage.strides[u]=G,this._userInstancedBuffersStorage.sizes[u]=32*G,this._userInstancedBuffersStorage.data[u]=new Float32Array(this._userInstancedBuffersStorage.sizes[u]),this._userInstancedBuffersStorage.vertexBuffers[u]=new x.f(this.getEngine(),this._userInstancedBuffersStorage.data[u],u,!0,!1,G,!0);for(const z of this.instances)z.instancedBuffers[u]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},m.c.prototype._processInstancedBuffers=function(u,G){const s=u?u.length:0;for(const T in this.instancedBuffers){let z=this._userInstancedBuffersStorage.sizes[T];const O=this._userInstancedBuffersStorage.strides[T],m=(s+1)*O;for(;z<m;)z*=2;this._userInstancedBuffersStorage.data[T].length!=z&&(this._userInstancedBuffersStorage.data[T]=new Float32Array(z),this._userInstancedBuffersStorage.sizes[T]=z,this._userInstancedBuffersStorage.vertexBuffers[T]&&(this._userInstancedBuffersStorage.vertexBuffers[T].dispose(),this._userInstancedBuffersStorage.vertexBuffers[T]=null));const f=this._userInstancedBuffersStorage.data[T];let C=0;if(G){const u=this.instancedBuffers[T];u.toArray?u.toArray(f,C):u.copyToArray?u.copyToArray(f,C):f[C]=u,C+=O}for(let G=0;G<s;G++){const s=u[G].instancedBuffers[T];s.toArray?s.toArray(f,C):s.copyToArray?s.copyToArray(f,C):f[C]=s,C+=O}this._userInstancedBuffersStorage.vertexBuffers[T]?this._userInstancedBuffersStorage.vertexBuffers[T].updateDirectly(f,0):(this._userInstancedBuffersStorage.vertexBuffers[T]=new x.f(this.getEngine(),this._userInstancedBuffersStorage.data[T],T,!0,!1,O,!0),this._invalidateInstanceVertexArrayObject())}},m.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const u in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[u]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},m.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const u in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[u]&&this._userInstancedBuffersStorage.vertexBuffers[u].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,b.g)("BABYLON.InstancedMesh",Q)},11148:(u,G,s)=>{"use strict";s.d(G,{c:()=>R,f:()=>d});var T=s(10568),z=s(10564),O=s(10592),m=s(10896),f=s(11152),C=s(11154),x=s(10904),g=s(10930),b=s(11161),Q=s(10961),Y=s(11173),n=s(11181),V=s(11191),F=s(11050),r=s(11045),c=s(11210),j=s(11186),l=s(10935),P=s(10584),H=s(10715),X=s(10609),p=s(10986);class q{constructor(u,G){this.distanceOrScreenCoverage=u,this.mesh=G}}class d{}class v{constructor(){this.visibleInstances={},this.batchCache=new W,this.batchCacheReplacementModeInFrozenMode=new W,this.instancesBufferSize=2048}}class W{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class M{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class o{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class R extends V.d{static _GetDefaultSideOrientation(u){return u||R.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(u){this._internalMeshDataInfo._useLODScreenCoverage=u,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(u&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(Q.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(Q.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new T.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new T.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new T.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new T.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new T.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(u){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(u)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(u){this._internalMeshDataInfo._forcedInstanceCount=u}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(u){this._internalMeshDataInfo._sideOrientation=u,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===u||!this._scene.useRightHandedSystem&&0===u}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(u){this.sideOrientation=u,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(u){this._internalMeshDataInfo._overrideRenderingFillMode=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){u&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(u.sideOrientation=null),this._setMaterial(u)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(u){this._unIndexed!==u&&(this._unIndexed=u,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(u){this._instanceDataStorage.manualUpdate=u}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(u){this._instanceDataStorage.previousManualUpdate=u}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(u){this._instanceDataStorage.forceMatrixUpdates=u}_copySource(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=this.va();if(u._geometry&&u._geometry.Ca(this),O.e.DeepCopy(u,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","sj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=u,T.useClonedMeshMap&&(u._internalMeshDataInfo.meshMap||(u._internalMeshDataInfo.meshMap={}),u._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=u._originalBuilderSideOrientation,this._creationDataStorage=u._creationDataStorage,u._ranges){const G=u._ranges;for(const u in G)Object.prototype.hasOwnProperty.call(G,u)&&G[u]&&this.createAnimationRange(u,G[u].from,G[u].to)}if(u.metadata&&u.metadata.clone?this.metadata=u.metadata.clone():this.metadata=u.metadata,this._internalMetadata=u._internalMetadata,m.c&&m.c.HasTags(u)&&m.c.AddTagsTo(this,m.c.GetTags(u,!0)),this.Af(u.isEnabled(!1)),this.parent=u.parent,this.setPivotMatrix(u.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+u.id,this.material=u.material,!G){const G=u.getDescendants(!0);for(let u=0;u<G.length;u++){const s=G[u];s.clone&&s.clone(this.name+"."+s.name,this)}}if(u.morphTargetManager&&(this.morphTargetManager=u.morphTargetManager),T.getPhysicsEngine){const G=T.getPhysicsEngine();if(s&&G)if(1===G.getPluginVersion()){const s=G.getImpostorForPhysicsObject(u);s&&(this.physicsImpostor=s.clone(this))}else 2===G.getPluginVersion()&&u.physicsBody&&u.physicsBody.clone(this)}for(let z=0;z<T.fj.length;z++){const G=T.fj[z];G.k===u&&G.clone(G.name,this)}this.skeleton=u.skeleton,this.refreshBoundingInfo(!0,!0),this.Gj(!0)}constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0,m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(u,G),this._internalMeshDataInfo=new o,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new v,this._thinInstanceDataStorage=new M,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=R.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,G=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(u,G,s)=>{u&&s&&(this._uniformBuffer?this.transferToEffect(G):s.bindOnlyWorldMatrix(G))},z&&this._copySource(z,O,m),null!==s&&(this.parent=s),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=u=>{u.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new T.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),z&&z.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;const T=0===this.getTotalVertices()||G&&G.doNotInstantiate&&(!0===G.doNotInstantiate||G.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),u||this.parent,!0):this.ed("instance of "+(this.name||this.id));T.parent=u||this.parent,T.position=this.position.clone(),T.vf=this.vf.clone(),this.rotationQuaternion?T.rotationQuaternion=this.rotationQuaternion.clone():T.rotation=this.rotation.clone(),s&&s(this,T);for(const z of this.getChildTransformNodes(!0))"InstancedMesh"===z.getClassName()&&"Mesh"===T.getClassName()&&z.sourceMesh===this?z.instantiateHierarchy(T,{doNotInstantiate:G&&G.doNotInstantiate||!1,newSourcedMesh:T},s):z.instantiateHierarchy(T,G,s);return T}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(u){let G=super.toString(u);if(G+=", n vertices: "+this.getTotalVertices(),G+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let s=0;s<this.animations.length;s++)G+=", animation[0]: "+this.animations[s].toString(u);if(u)if(this._geometry){const u=this.kf(),s=this.getVerticesData(Q.f.PositionKind);s&&u&&(G+=", flat shading: "+(s.length/3===u.length?"YES":"NO"))}else G+=", flat shading: UNKNOWN";return G}_unBindEffect(){super._unBindEffect();for(const u of this.instances)u._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const u=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((G,s)=>G.distanceOrScreenCoverage<s.distanceOrScreenCoverage?u:G.distanceOrScreenCoverage>s.distanceOrScreenCoverage?-u:0))}addLODLevel(u,G){if(G&&G._masterMesh)return P.d.Warn("You cannot use a mesh as LOD level twice"),this;const s=new q(u,G);return this._internalMeshDataInfo._LODLevels.push(s),G&&(G._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(u){const G=this._internalMeshDataInfo;for(let s=0;s<G._LODLevels.length;s++){const T=G._LODLevels[s];if(T.distanceOrScreenCoverage===u)return T.mesh}return null}removeLODLevel(u){const G=this._internalMeshDataInfo;for(let s=0;s<G._LODLevels.length;s++)G._LODLevels[s].mesh===u&&(G._LODLevels.splice(s,1),u&&(u._masterMesh=null));return this._sortLODLevels(),this}getLOD(u,G){const s=this._internalMeshDataInfo;if(!s._LODLevels||0===s._LODLevels.length)return this;const T=G||this.getBoundingInfo().boundingSphere,z=u.mode===C.e.ORTHOGRAPHIC_CAMERA?u.Mi:T.centerWorld.Nc(u.globalPosition).length();let O=z,m=1;if(s._useLODScreenCoverage){const G=u.screenArea;let s=T.radiusWorld*u.Mi/z;s=s*s*Math.PI,O=s/G,m=-1}if(m*s._LODLevels[s._LODLevels.length-1].distanceOrScreenCoverage>m*O)return this.onLODLevelSelection&&this.onLODLevelSelection(O,this,this),this;for(let f=0;f<s._LODLevels.length;f++){const u=s._LODLevels[f];if(m*u.distanceOrScreenCoverage<m*O){if(u.mesh){if(4===u.mesh.delayLoadState)return u.mesh._checkDelayState(),this;if(2===u.mesh.delayLoadState)return this;u.mesh._preActivate(),u.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(O,this,u.mesh),u.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(O,this,this),this}get sj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(u,G,s,T){var z,O;if(!this._geometry)return null;let m=T||null===(z=this._userInstancedBuffersStorage)||void 0===z||null===(O=z.vertexBuffers[u])||void 0===O?void 0:O.getFloatData(this.instances.length+1,s||G&&1!==this._geometry.meshes.length);return m||(m=this._geometry.getVerticesData(u,G,s)),m}copyVerticesData(u,G){this._geometry&&this._geometry.copyVerticesData(u,G)}getVertexBuffer(u,G){var s;return this._geometry?(G||null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u])??this._geometry.getVertexBuffer(u):null}isVerticesDataPresent(u,G){var s;return this._geometry?!G&&void 0!==(null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u])||this._geometry.isVerticesDataPresent(u):!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}isVertexBufferUpdatable(u,G){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(u);if(!G){var s;const G=null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u];if(G)return G.isUpdatable()}return this._geometry.isVertexBufferUpdatable(u)}getVerticesDataKinds(u){if(!this._geometry){const u=[];return this._delayInfo&&this._delayInfo.forEach((function(G){u.push(G)})),u}const G=this._geometry.getVerticesDataKinds();if(!u&&this._userInstancedBuffersStorage)for(const s in this._userInstancedBuffersStorage.vertexBuffers)-1===G.indexOf(s)&&G.push(s);return G}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}kf(u,G){return this._geometry?this._geometry.kf(u,G):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(u))return!1;if(!this.xf||0===this.xf.length)return!0;if(!u)return!0;const s=this.getEngine(),T=this.va(),z=G||s.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Gj();const O=this.material||T.defaultMaterial;if(O)if(O._storeEffectOnSubMeshes)for(const Q of this.xf){const u=Q.Ha();if(u)if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,Q,z))return!1}else if(!u.isReady(this,z))return!1}else if(!O.isReady(this,z))return!1;const m=s.currentRenderPassId;for(const Q of this.lightSources){const u=Q.getShadowGenerators();if(!u)continue;const G=u.values();for(let T=G.next();!0!==T.done;T=G.next()){var f,C,x,g;const u=T.value;if(u&&(null===(f=u.getShadowMap())||void 0===f||!f.renderList||null!==(C=u.getShadowMap())&&void 0!==C&&C.renderList&&-1!==(null===(x=u.getShadowMap())||void 0===x||null===(g=x.renderList)||void 0===g?void 0:g.indexOf(this)))){const G=u.getShadowMap().renderPassIds??[s.currentRenderPassId];for(let T=0;T<G.length;++T){s.currentRenderPassId=G[T];for(const G of this.xf){var b;if(!u.isReady(G,z,(null===(b=G.Ha())||void 0===b?void 0:b.needAlphaBlendingForMesh(this))??!1))return s.currentRenderPassId=m,!1}}s.currentRenderPassId=m}}}for(const Q of this._internalMeshDataInfo._LODLevels)if(Q.mesh&&!Q.mesh.isReady(z))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}th(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(u){this._instanceDataStorage.overridenInstanceCount=u}_preActivate(){const u=this._internalMeshDataInfo,G=this.va().getRenderId();return u._preActivateId===G||(u._preActivateId=G,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(u){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=u),this}_registerInstanceForRenderId(u,G){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:G,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[G]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=G,this._instanceDataStorage.visibleInstances[G]=new Array),this._instanceDataStorage.visibleInstances[G].push(u),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let u,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;u="object"===typeof G?G:{applySkeleton:G,applyMorph:s};const T=this.sj?this.sj.boundingBias:null;return this.Fa(this._getData(u,null,Q.f.PositionKind),T),this}_createGlobalSubMesh(u){const G=this.getTotalVertices();if(!G||!this.kf())return null;if(this.xf&&this.xf.length>0){const s=this.kf();if(!s)return null;const T=s.length;let z=!1;if(u)z=!0;else for(const u of this.xf){if(u.indexStart+u.indexCount>T){z=!0;break}if(u.verticesStart+u.verticesCount>G){z=!0;break}}if(!z)return this.xf[0]}return this.releaseSubMeshes(),new F.d(0,0,G,0,this.getTotalIndices(),this)}subdivide(u){if(u<1)return;const G=this.getTotalIndices();let s=G/u|0,T=0;for(;s%3!==0;)s++;this.releaseSubMeshes();for(let z=0;z<u&&!(T>=G);z++)F.d.CreateFromIndices(0,T,z===u-1?G-T:s,this,void 0,!1),T+=s;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(u,G,s,T);else{const T=new Y.b;T.set(G,u);const z=this.va();new n.d(n.d.RandomId(),z,T,s,this)}return this}removeVerticesData(u){this._geometry&&this._geometry.removeVerticesData(u)}markVerticesDataAsUpdatable(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this.getVertexBuffer(u);s&&s.isUpdatable()!==G&&this.Ga(u,this.getVerticesData(u),G)}setVerticesBuffer(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=n.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(u,null,G),this}updateVerticesData(u,G,s,T){return this._geometry?(T?(this.makeGeometryUnique(),this.updateVerticesData(u,G,s,!1)):this._geometry.updateVerticesData(u,G,s),this):this}updateMeshPositions(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this.getVerticesData(Q.f.PositionKind);if(!s)return this;if(u(s),this.updateVerticesData(Q.f.PositionKind,s,!1,!1),G){const u=this.kf(),G=this.getVerticesData(Q.f.NormalKind);if(!G)return this;Y.b.ComputeNormals(s,u,G),this.updateVerticesData(Q.f.NormalKind,G,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const u=this._geometry,G=this._geometry.j(n.d.RandomId());return u.releaseForMesh(this,!0),G.Ca(this),this}setIndexBuffer(u,G,s){let T=this._geometry;T||(T=new n.d(n.d.RandomId(),this.va(),void 0,void 0,this)),T.setIndexBuffer(u,G,s)}setIndices(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(u,G,s,T);else{const G=new Y.b;G.indices=u;const T=this.va();new n.d(n.d.RandomId(),T,G,s,this)}return this}updateIndices(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(u,G,s),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(u,G,s){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const z=this.va().getEngine();let O;if(this._unIndexed)if(this._getRenderingFillMode(s)===r.d.WireFrameFillMode)O=u._getLinesIndexBuffer(this.kf(),z);else O=null;else switch(this._getRenderingFillMode(s)){case r.d.PointFillMode:O=null;break;case r.d.WireFrameFillMode:O=u._getLinesIndexBuffer(this.kf(),z);break;default:case r.d.TriangleFillMode:O=this._geometry.getIndexBuffer()}return this._bindDirect(G,O,T)}_bindDirect(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(u),s&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(u,G,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(u,G),this):this}_draw(u,G,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const T=this.va().getEngine();return this._unIndexed&&G!==r.d.WireFrameFillMode||G==r.d.PointFillMode?T.drawArraysType(G,u.verticesStart,u.verticesCount,this.forcedInstanceCount||s):G==r.d.WireFrameFillMode?T.drawElementsType(G,0,u._linesIndexCount,this.forcedInstanceCount||s):T.drawElementsType(G,u.indexStart,u.indexCount,this.forcedInstanceCount||s),this}registerBeforeRender(u){return this.onBeforeRenderObservable.add(u),this}unregisterBeforeRender(u){return this.onBeforeRenderObservable.removeCallback(u),this}registerAfterRender(u){return this.onAfterRenderObservable.add(u),this}unregisterAfterRender(u){return this.onAfterRenderObservable.removeCallback(u),this}_getInstancesRenderList(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(G)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[u]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[u]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const s=this.va(),T=s._isInIntermediateRendering(),z=T?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,O=this._instanceDataStorage.batchCache;if(O.mustReturn=!1,O.renderSelf[u]=G||!z&&this.isEnabled()&&this.isVisible,O.visibleInstances[u]=null,this._instanceDataStorage.visibleInstances&&!G){const G=this._instanceDataStorage.visibleInstances,z=s.getRenderId(),m=T?G.intermediateDefaultRenderId:G.defaultRenderId;O.visibleInstances[u]=G[z],!O.visibleInstances[u]&&m&&(O.visibleInstances[u]=G[m])}return O.hardwareInstancedRendering[u]=!G&&this._instanceDataStorage.hardwareInstancedRendering&&null!==O.visibleInstances[u]&&void 0!==O.visibleInstances[u],this._instanceDataStorage.previousBatch=O,O}_renderWithInstances(u,G,s,T,z){const O=s.visibleInstances[u._id],m=O?O.length:0,f=this._instanceDataStorage,C=f.instancesBufferSize;let g=f.instancesBuffer,b=f.instancesPreviousBuffer;const Y=16*(m+1)*4;for(;f.instancesBufferSize<Y;)f.instancesBufferSize*=2;f.instancesData&&C==f.instancesBufferSize||(f.instancesData=new Float32Array(f.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!f.instancesPreviousData||C!=f.instancesBufferSize)&&(f.instancesPreviousData=new Float32Array(f.instancesBufferSize/4));let n=0,V=0;const F=s.renderSelf[u._id],r=!g||C!==f.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!f.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||f.isFrozen&&!r)V=(F?1:0)+m;else{const G=this.getWorldMatrix();if(F&&(this._scene.needsPreviousWorldMatrices&&(f.masterMeshPreviousWorldMatrix?(f.masterMeshPreviousWorldMatrix.copyToArray(f.instancesPreviousData,n),f.masterMeshPreviousWorldMatrix.p(G)):(f.masterMeshPreviousWorldMatrix=G.clone(),f.masterMeshPreviousWorldMatrix.copyToArray(f.instancesPreviousData,n))),G.copyToArray(f.instancesData,n),n+=16,V++),O){var c;if(R.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(c=u.Ha())&&void 0!==c&&c.needAlphaBlendingForMesh(u.getRenderingMesh())){const u=this._scene.activeCamera.globalPosition;for(let G=0;G<O.length;G++){const s=O[G];s._distanceToCamera=x.q.Distance(s.getBoundingInfo().boundingSphere.centerWorld,u)}O.sort(((u,G)=>u._distanceToCamera>G._distanceToCamera?-1:u._distanceToCamera<G._distanceToCamera?1:0))}for(let u=0;u<O.length;u++){const G=O[u],s=G.getWorldMatrix();s.copyToArray(f.instancesData,n),this._scene.needsPreviousWorldMatrices&&(G._previousWorldMatrix?(G._previousWorldMatrix.copyToArray(f.instancesPreviousData,n),G._previousWorldMatrix.p(s)):(G._previousWorldMatrix=s.clone(),G._previousWorldMatrix.copyToArray(f.instancesPreviousData,n))),n+=16,V++}}}return r?(g&&g.dispose(),b&&b.dispose(),g=new Q.b(z,f.instancesData,!0,16,!1,!0),f.instancesBuffer=g,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=g.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=g.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=g.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=g.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(b=new Q.b(z,f.instancesPreviousData,!0,16,!1,!0),f.instancesPreviousBuffer=b,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=b.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=b.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=b.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=b.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(g.updateDirectly(f.instancesData,0,V),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||b.updateDirectly(f.instancesPreviousData,0,V)),this._processInstancedBuffers(O,F),this.va()._activeIndices.addCount(u.indexCount*V,!1),z._currentDrawContext&&(z._currentDrawContext.useInstancing=!0),this._bind(u,T,G),this._draw(u,G,V),!this._scene.needsPreviousWorldMatrices||r||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||b.updateDirectly(f.instancesData,0,V),z.unbindInstanceAttributes(),this}_renderWithThinInstances(u,G,s,T){var z;const O=(null===(z=this._thinInstanceDataStorage)||void 0===z?void 0:z.instancesCount)??0;this.va()._activeIndices.addCount(u.indexCount*O,!1),T._currentDrawContext&&(T._currentDrawContext.useInstancing=!0),this._bind(u,s,G),this._draw(u,G,O),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,O):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),T.unbindInstanceAttributes()}_processInstancedBuffers(u,G){}_processRendering(u,G,s,T,z,O,m,f){const C=this.va(),x=C.getEngine();if(T=this._getRenderingFillMode(T),O&&G.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(G,T,s,x),this;if(O)this._renderWithInstances(G,T,z,s,x);else{x._currentDrawContext&&(x._currentDrawContext.useInstancing=!1);let s=0;z.renderSelf[G._id]&&(m&&m(!1,u.getWorldMatrix(),f),s++,this._draw(G,T,this._instanceDataStorage.overridenInstanceCount));const O=z.visibleInstances[G._id];if(O){const u=O.length;s+=u;for(let s=0;s<u;s++){const u=O[s].getWorldMatrix();m&&m(!0,u,f),this._draw(G,T)}}C._activeIndices.addCount(G.indexCount*s,!1)}return this}_rebuild(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(u&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const G in this._userInstancedBuffersStorage.vertexBuffers){const s=this._userInstancedBuffersStorage.vertexBuffers[G];s&&(u&&s.dispose(),this._userInstancedBuffersStorage.vertexBuffers[G]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(u)}_freeze(){if(this.xf){for(let u=0;u<this.xf.length;u++)this._getInstancesRenderList(u);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(u,G,s,T){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const O=this._scene.getEngine(),m=O.currentRenderPassId;if(void 0!==u&&(O.currentRenderPassId=u),T)(!z||z&&T.isInFrustum(this._scene._frustumPlanes))&&this.render(T,!!G,s);else for(let f=0;f<this.xf.length;f++){const u=this.xf[f];(!z||z&&u.isInFrustum(this._scene._frustumPlanes))&&this.render(u,!!G,s)}return void 0!==u&&(O.currentRenderPassId=m),this}directRender(){if(!this.xf)return this;for(const u of this.xf)this.render(u,!1);return this}render(u,G,s){var T,z,O;const m=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const f=(null===(T=m.activeCameras)||void 0===T?void 0:T.length)??0;if((f>1&&m.activeCamera===m.activeCameras[0]||f<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const C=this._getInstancesRenderList(u._id,!!s);if(C.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const x=m.getEngine();let g=0,b=null;this.ignoreCameraMaxZ&&m.activeCamera&&!m._isInIntermediateRendering()&&(g=m.activeCamera.maxZ,b=m.activeCamera,m.activeCamera.maxZ=0,m.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const Q=u.getRenderingMesh(),Y=C.hardwareInstancedRendering[u._id]||Q.hasThinInstances||!!this._userInstancedBuffersStorage&&!u.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,n=this._instanceDataStorage,V=u.Ha();if(!V)return b&&(b.maxZ=g,m.updateTransformMatrix(!0)),this;if(n.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===V){if(V._storeEffectOnSubMeshes&&(null===(z=u._drawWrapper)||void 0===z||!z._wasPreviouslyReady)||!V._storeEffectOnSubMeshes&&!V._getDrawWrapper()._wasPreviouslyReady)return b&&(b.maxZ=g,m.updateTransformMatrix(!0)),this}else{if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,u,Y))return b&&(b.maxZ=g,m.updateTransformMatrix(!0)),this}else if(!V.isReady(this,Y))return b&&(b.maxZ=g,m.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=V}let F;G&&x.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),F=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?u._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const c=(null===(O=F)||void 0===O?void 0:O.effect)??null;for(const r of m._beforeRenderingMeshStage)r.action(this,u,C,c);if(!F||!c)return b&&(b.maxZ=g,m.updateTransformMatrix(!0)),this;const j=s||this;let l;if(n.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ig&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)l=n.sideOrientation;else{const u=j._getWorldMatrixDeterminant();l=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),u<0&&(l=l===r.d.ClockWiseSideOrientation?r.d.CounterClockWiseSideOrientation:r.d.ClockWiseSideOrientation),n.sideOrientation=l}const P=this._internalMeshDataInfo._effectiveMaterial._preBind(F,l);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&x.setDepthWrite(!0);const H=this._internalMeshDataInfo._effectiveMaterial,X=H.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),Y||this._bind(u,c,X,!1);const p=j.getWorldMatrix();H._storeEffectOnSubMeshes?H.bindForSubMesh(p,this,u):H.bind(p,this),!H.Ig&&H.separateCullingPass&&(x.setState(!0,H.zOffset,!1,!P,H.cullBackFaces,H.stencil,H.zOffsetUnits),this._processRendering(this,u,c,X,C,Y,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),x.setState(!0,H.zOffset,!1,P,H.cullBackFaces,H.stencil,H.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(u)),this._processRendering(this,u,c,X,C,Y,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const r of m._afterRenderingMeshStage)r.action(this,u,C,c);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),b&&(b.maxZ=g,m.updateTransformMatrix(!0)),2!==m.performancePriority||n.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(Q.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(Q.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const u=this.getVerticesData(Q.f.MatricesWeightsKind),G=u.length;for(let s=0;s<G;s+=4){const G=u[s]+u[s+1]+u[s+2]+u[s+3];if(0===G)u[s]=1;else{const T=1/G;u[s]*=T,u[s+1]*=T,u[s+2]*=T,u[s+3]*=T}}this.Ga(Q.f.MatricesWeightsKind,u)}_normalizeSkinWeightsAndExtra(){const u=this.getVerticesData(Q.f.MatricesWeightsExtraKind),G=this.getVerticesData(Q.f.MatricesWeightsKind),s=G.length;for(let T=0;T<s;T+=4){let s=G[T]+G[T+1]+G[T+2]+G[T+3];if(s+=u[T]+u[T+1]+u[T+2]+u[T+3],0===s)G[T]=1;else{const z=1/s;G[T]*=z,G[T+1]*=z,G[T+2]*=z,G[T+3]*=z,u[T]*=z,u[T+1]*=z,u[T+2]*=z,u[T+3]*=z}}this.Ga(Q.f.MatricesWeightsKind,G),this.Ga(Q.f.MatricesWeightsKind,u)}validateSkinning(){const u=this.getVerticesData(Q.f.MatricesWeightsExtraKind),G=this.getVerticesData(Q.f.MatricesWeightsKind);if(null===G||null==this.skeleton)return{skinned:!1,valid:!0,fm:"not skinned"};const s=G.length;let T=0,z=0,O=0,m=0;const f=null===u?4:8,C=[];for(let Q=0;Q<=f;Q++)C[Q]=0;for(let Q=0;Q<s;Q+=4){let s=G[Q],x=s,g=0===x?0:1;for(let z=1;z<f;z++){const O=z<4?G[Q+z]:u[Q+z-4];O>s&&T++,0!==O&&g++,x+=O,s=O}if(C[g]++,g>O&&(O=g),0===x)z++;else{const s=1/x;let T=0;for(let z=0;z<f;z++)T+=z<4?Math.abs(G[Q+z]-G[Q+z]*s):Math.abs(u[Q+z-4]-u[Q+z-4]*s);T>.001&&m++}}const x=this.skeleton.bones.length,g=this.getVerticesData(Q.f.MatricesIndicesKind),b=this.getVerticesData(Q.f.MatricesIndicesExtraKind);let Y=0;for(let Q=0;Q<s;Q+=4)for(let u=0;u<f;u++){const G=u<4?g[Q+u]:b[Q+u-4];(G>=x||G<0)&&Y++}return{skinned:!0,valid:0===z&&0===m&&0===Y,fm:"Number of Weights = "+s/4+"\nMaximum influences = "+O+"\nMissing Weights = "+z+"\nNot Sorted = "+T+"\nNot Normalized = "+m+"\nWeightCounts = ["+C+"]\nNumber of bones = "+x+"\nBad Bone Indices = "+Y}}_checkDelayState(){const u=this.va();return this._geometry?this._geometry.load(u):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(u)),this}_queueLoad(u){u.addPendingData(this);const G=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return z.e.LoadFile(this.delayLoadingFile,(G=>{G instanceof ArrayBuffer?this._delayLoadingFunction(G,this):this._delayLoadingFunction(JSON.parse(G),this),this.instances.forEach((u=>{u.refreshBoundingInfo(),u._syncSubMeshes()})),this.delayLoadState=1,u.removePendingData(this)}),(()=>{}),u.offlineProvider,G),this}isInFrustum(u){return 2!==this.delayLoadState&&(!!super.isInFrustum(u)&&(this._checkDelayState(),!0))}setMaterialById(u){const G=this.va().materials;let s;for(s=G.length-1;s>-1;s--)if(G[s].id===u)return this.material=G[s],this;const T=this.va().multiMaterials;for(s=T.length-1;s>-1;s--)if(T[s].id===u)return this.material=T[s],this;return this}getAnimatables(){const u=[];return this.material&&u.push(this.material),this.skeleton&&u.push(this.skeleton),u}bakeTransformIntoVertices(u){if(!this.isVerticesDataPresent(Q.f.PositionKind))return this;const G=this.xf.splice(0);this._resetPointsArrayCache();let s=this.getVerticesData(Q.f.PositionKind);const T=x.q.Zero();let z;for(z=0;z<s.length;z+=3)x.q.TransformCoordinatesFromFloatsToRef(s[z],s[z+1],s[z+2],u,T).toArray(s,z);if(this.Ga(Q.f.PositionKind,s,this.getVertexBuffer(Q.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(Q.f.NormalKind)){for(s=this.getVerticesData(Q.f.NormalKind),z=0;z<s.length;z+=3)x.q.TransformNormalFromFloatsToRef(s[z],s[z+1],s[z+2],u,T).normalize().toArray(s,z);this.Ga(Q.f.NormalKind,s,this.getVertexBuffer(Q.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(Q.f.TangentKind)){for(s=this.getVerticesData(Q.f.TangentKind),z=0;z<s.length;z+=4)x.q.TransformNormalFromFloatsToRef(s[z],s[z+1],s[z+2],u,T).normalize().toArray(s,z);this.Ga(Q.f.TangentKind,s,this.getVertexBuffer(Q.f.TangentKind).isUpdatable())}return u.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.xf=G,this}bakeCurrentTransformIntoVertices(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Gj(!0)),this.resetLocalMatrix(u),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),u,this,G,s)}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const s=this._internalMeshDataInfo;if(s._onBeforeDrawObservable&&s._onBeforeDrawObservable.clear(),s._onBeforeBindObservable&&s._onBeforeBindObservable.clear(),s._onBeforeRenderObservable&&s._onBeforeRenderObservable.clear(),s._onAfterRenderObservable&&s._onAfterRenderObservable.clear(),s._onBetweenPassObservable&&s._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(s.meshMap)for(const u in s.meshMap){const G=s.meshMap[u];G&&(G._internalMeshDataInfo._source=null,s.meshMap[u]=void 0)}s._source&&s._source._internalMeshDataInfo.meshMap&&(s._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const u=this.va().meshes;for(const G of u){const u=G;u._internalMeshDataInfo&&u._internalMeshDataInfo._source&&u._internalMeshDataInfo._source===this&&(u._internalMeshDataInfo._source=null)}}s._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(u,G)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(u,G,s,T,O,m){let f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0;const x=this.va();return z.e.LoadImage(u,(u=>{const z=u.width,C=u.height,x=this.getEngine().createCanvas(z,C).getContext("2d");x.drawImage(u,0,0);const g=x.getImageData(0,0,z,C).data;this.applyDisplacementMapFromBuffer(g,z,C,G,s,O,m,f),T&&T(this)}),C||(()=>{}),x.offlineProvider),this}applyDisplacementMapFromBuffer(u,G,s,T,z,O,m){let f=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(Q.f.PositionKind)||!this.isVerticesDataPresent(Q.f.NormalKind)||!this.isVerticesDataPresent(Q.f.UVKind))return P.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const C=this.getVerticesData(Q.f.PositionKind,!0,!0),g=this.getVerticesData(Q.f.NormalKind),b=this.getVerticesData(Q.f.UVKind);let n=x.q.Zero();const V=x.q.Zero(),F=x.m.Zero();O=O||x.m.Zero(),m=m||new x.m(1,1);for(let Q=0;Q<C.length;Q+=3){x.q.FromArrayToRef(C,Q,n),x.q.FromArrayToRef(g,Q,V),x.m.FromArrayToRef(b,Q/3*2,F);const f=4*((Math.abs(F.x*m.x+O.x%1)*(G-1)%G|0)+(Math.abs(F.y*m.y+O.y%1)*(s-1)%s|0)*G),Y=.3*(u[f]/255)+.59*(u[f+1]/255)+.11*(u[f+2]/255);V.normalize(),V.scaleInPlace(T+(z-T)*Y),n=n.add(V),n.toArray(C,Q)}return Y.b.ComputeNormals(C,this.kf(),g),f?(this.Ga(Q.f.PositionKind,C),this.Ga(Q.f.NormalKind,g),this.Ga(Q.f.UVKind,b)):(this.updateVerticesData(Q.f.PositionKind,C),this.updateVerticesData(Q.f.NormalKind,g)),this}_getFlattenedNormals(u,G){const s=new Float32Array(3*u.length);let T=0;const z=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let O=0;O<u.length;O+=3){const m=x.q.Ag(G,3*u[O]),f=x.q.Ag(G,3*u[O+1]),C=x.q.Ag(G,3*u[O+2]),g=m.Nc(f),b=C.Nc(f),Q=x.q.Normalize(x.q.Cross(g,b));z&&Q.scaleInPlace(-1);for(let u=0;u<3;u++)s[T++]=Q.x,s[T++]=Q.y,s[T++]=Q.z}return s}_convertToUnIndexedMesh(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=this.getVerticesDataKinds().filter((u=>{var G;return!(null!==(G=this.getVertexBuffer(u))&&void 0!==G&&G.getIsInstanced())})),s=this.kf(),T={},z=(u,G)=>{const T=new Float32Array(s.length*G);let z=0;for(let O=0;O<s.length;O++)for(let m=0;m<G;m++)T[z++]=u[s[O]*G+m];return T},O=this.getBoundingInfo(),m=this.sj?this.xf.slice(0):[];for(const f of G)T[f]=this.getVerticesData(f);for(const f of G){const G=this.getVertexBuffer(f),O=G.getSize();if(u&&f===Q.f.NormalKind){const u=this._getFlattenedNormals(s,T[Q.f.PositionKind]);this.Ga(Q.f.NormalKind,u,G.isUpdatable(),O)}else this.Ga(f,z(T[f],O),G.isUpdatable(),O)}if(this.morphTargetManager){for(let G=0;G<this.morphTargetManager.numTargets;G++){const T=this.morphTargetManager.getTarget(G),O=T.getPositions();T.setPositions(z(O,3));const m=T.getNormals();m&&T.setNormals(u?this._getFlattenedNormals(s,O):z(m,3));const f=T.getTangents();f&&T.setTangents(z(f,3));const C=T.getUVs();C&&T.setUVs(z(C,2))}this.morphTargetManager.synchronize()}for(let f=0;f<s.length;f++)s[f]=f;this.setIndices(s),this._unIndexed=!0,this.releaseSubMeshes();for(const f of m){const u=f.getBoundingInfo();F.d.AddToMesh(f.materialIndex,f.indexStart,f.indexCount,f.indexStart,f.indexCount,this).setBoundingInfo(u)}return this.setBoundingInfo(O),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=Y.b.ExtractFromMesh(this);let s;if(u&&this.isVerticesDataPresent(Q.f.NormalKind)&&G.ya){for(s=0;s<G.ya.length;s++)G.ya[s]*=-1;this.Ga(Q.f.NormalKind,G.ya,this.isVertexBufferUpdatable(Q.f.NormalKind))}if(G.indices){let u;for(s=0;s<G.indices.length;s+=3)u=G.indices[s+1],G.indices[s+1]=G.indices[s+2],G.indices[s+2]=u;this.setIndices(G.indices,null,this.isVertexBufferUpdatable(Q.f.PositionKind),!0)}return this}increaseVertices(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const G=Y.b.ExtractFromMesh(this),s=G.indices&&!Array.isArray(G.indices)&&Array.from?Array.from(G.indices):G.indices,T=G.xa&&!Array.isArray(G.xa)&&Array.from?Array.from(G.xa):G.xa,z=G.Aa&&!Array.isArray(G.Aa)&&Array.from?Array.from(G.Aa):G.Aa,O=G.ya&&!Array.isArray(G.ya)&&Array.from?Array.from(G.ya):G.ya;if(s&&T){G.indices=s,G.xa=T,z&&(G.Aa=z),O&&(G.ya=O);const m=u+1,f=new Array;for(let u=0;u<m+1;u++)f[u]=new Array;let C,g;const b=new x.q(0,0,0),Y=new x.q(0,0,0),n=new x.m(0,0),V=new Array,F=new Array,r=new Array;let c,j,l,P=T.length;z&&(j=z.length),O&&(l=O.length);for(let u=0;u<s.length;u+=3){F[0]=s[u],F[1]=s[u+1],F[2]=s[u+2];for(let u=0;u<3;u++)if(C=F[u],g=F[(u+1)%3],void 0===r[C]&&void 0===r[g]?(r[C]=new Array,r[g]=new Array):(void 0===r[C]&&(r[C]=new Array),void 0===r[g]&&(r[g]=new Array)),void 0===r[C][g]&&void 0===r[g][C]){r[C][g]=[],b.x=(T[3*g]-T[3*C])/m,b.y=(T[3*g+1]-T[3*C+1])/m,b.z=(T[3*g+2]-T[3*C+2])/m,O&&(Y.x=(O[3*g]-O[3*C])/m,Y.y=(O[3*g+1]-O[3*C+1])/m,Y.z=(O[3*g+2]-O[3*C+2])/m),z&&(n.x=(z[2*g]-z[2*C])/m,n.y=(z[2*g+1]-z[2*C+1])/m),r[C][g].push(C);for(let u=1;u<m;u++)r[C][g].push(T.length/3),T[P++]=T[3*C]+u*b.x,T[P++]=T[3*C+1]+u*b.y,T[P++]=T[3*C+2]+u*b.z,O&&(O[l++]=O[3*C]+u*Y.x,O[l++]=O[3*C+1]+u*Y.y,O[l++]=O[3*C+2]+u*Y.z),z&&(z[j++]=z[2*C]+u*n.x,z[j++]=z[2*C+1]+u*n.y);r[C][g].push(g),r[g][C]=new Array,c=r[C][g].length;for(let u=0;u<c;u++)r[g][C][u]=r[C][g][c-1-u]}f[0][0]=s[u],f[1][0]=r[s[u]][s[u+1]][1],f[1][1]=r[s[u]][s[u+2]][1];for(let G=2;G<m;G++){f[G][0]=r[s[u]][s[u+1]][G],f[G][G]=r[s[u]][s[u+2]][G],b.x=(T[3*f[G][G]]-T[3*f[G][0]])/G,b.y=(T[3*f[G][G]+1]-T[3*f[G][0]+1])/G,b.z=(T[3*f[G][G]+2]-T[3*f[G][0]+2])/G,O&&(Y.x=(O[3*f[G][G]]-O[3*f[G][0]])/G,Y.y=(O[3*f[G][G]+1]-O[3*f[G][0]+1])/G,Y.z=(O[3*f[G][G]+2]-O[3*f[G][0]+2])/G),z&&(n.x=(z[2*f[G][G]]-z[2*f[G][0]])/G,n.y=(z[2*f[G][G]+1]-z[2*f[G][0]+1])/G);for(let u=1;u<G;u++)f[G][u]=T.length/3,T[P++]=T[3*f[G][0]]+u*b.x,T[P++]=T[3*f[G][0]+1]+u*b.y,T[P++]=T[3*f[G][0]+2]+u*b.z,O&&(O[l++]=O[3*f[G][0]]+u*Y.x,O[l++]=O[3*f[G][0]+1]+u*Y.y,O[l++]=O[3*f[G][0]+2]+u*Y.z),z&&(z[j++]=z[2*f[G][0]]+u*n.x,z[j++]=z[2*f[G][0]+1]+u*n.y)}f[m]=r[s[u+1]][s[u+2]],V.push(f[0][0],f[1][0],f[1][1]);for(let u=1;u<m;u++){let G;for(G=0;G<u;G++)V.push(f[u][G],f[u+1][G],f[u+1][G+1]),V.push(f[u][G],f[u+1][G+1],f[u][G+1]);V.push(f[u][G],f[u+1][G],f[u+1][G+1])}}G.indices=V,G.Ca(this,this.isVertexBufferUpdatable(Q.f.PositionKind))}else P.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const u=Y.b.ExtractFromMesh(this),G=u.Aa,s=u.indices,T=u.xa,z=u.za,O=u.matricesIndices,m=u.matricesWeights,f=u.matricesIndicesExtra,C=u.matricesWeightsExtra;if(void 0===s||void 0===T||null===s||null===T)P.d.Warn("VertexData contains empty entries");else{const x=new Array,g=new Array,b=new Array,n=new Array,V=new Array,F=new Array,r=new Array,c=new Array;let j=new Array,l=0;const P={};let H,X;for(let u=0;u<s.length;u+=3){X=[s[u],s[u+1],s[u+2]],j=[];for(let u=0;u<3;u++){j[u]="";for(let G=0;G<3;G++)Math.abs(T[3*X[u]+G])<1e-8&&(T[3*X[u]+G]=0),j[u]+=T[3*X[u]+G]+"|"}if(j[0]!=j[1]&&j[0]!=j[2]&&j[1]!=j[2])for(let u=0;u<3;u++){if(H=P[j[u]],void 0===H){P[j[u]]=l,H=l++;for(let G=0;G<3;G++)x.push(T[3*X[u]+G]);if(null!==z&&void 0!==z)for(let G=0;G<4;G++)n.push(z[4*X[u]+G]);if(null!==G&&void 0!==G)for(let s=0;s<2;s++)b.push(G[2*X[u]+s]);if(null!==O&&void 0!==O)for(let G=0;G<4;G++)V.push(O[4*X[u]+G]);if(null!==m&&void 0!==m)for(let G=0;G<4;G++)F.push(m[4*X[u]+G]);if(null!==f&&void 0!==f)for(let G=0;G<4;G++)r.push(f[4*X[u]+G]);if(null!==C&&void 0!==C)for(let G=0;G<4;G++)c.push(C[4*X[u]+G])}g.push(H)}}const p=new Array;Y.b.ComputeNormals(x,g,p),u.xa=x,u.indices=g,u.ya=p,null!==G&&void 0!==G&&(u.Aa=b),null!==z&&void 0!==z&&(u.za=n),null!==O&&void 0!==O&&(u.matricesIndices=V),null!==m&&void 0!==m&&(u.matricesWeights=F),null!==f&&void 0!==f&&(u.matricesIndicesExtra=r),null!==m&&void 0!==m&&(u.matricesWeightsExtra=c),u.Ca(this,this.isVertexBufferUpdatable(Q.f.PositionKind))}}static _instancedMeshFactory(u,G){throw(0,X.c)("InstancedMesh")}static _PhysicsImpostorParser(u,G,s){throw(0,X.c)("PhysicsImpostor")}ed(u){const G=R._instancedMeshFactory(u,this);return G.parent=this.parent,G}synchronizeInstances(){for(let u=0;u<this.instances.length;u++){this.instances[u]._syncSubMeshes()}return this}optimizeIndices(u){const G=this.kf(),s=this.getVerticesData(Q.f.PositionKind);if(!s||!G)return this;const T=[];for(let z=0;z<s.length;z+=3)T.push(x.q.Ag(s,z));const O=[];return z.d.SyncAsyncForLoop(T.length,40,(u=>{const G=T.length-1-u,s=T[G];for(let z=0;z<G;++z){const u=T[z];if(s.equals(u)){O[G]=z;break}}}),(()=>{for(let u=0;u<G.length;++u)G[u]=O[G[u]]||G[u];const s=this.xf.slice(0);this.setIndices(G),this.xf=s,u&&u(this)})),this}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,u.type=this.getClassName(),m.c&&m.c.HasTags(this)&&(u.tags=m.c.GetTags(this)),u.position=this.position.$i(),this.rotationQuaternion?u.rotationQuaternion=this.rotationQuaternion.$i():this.rotation&&(u.rotation=this.rotation.$i()),u.vf=this.vf.$i(),this._postMultiplyPivotMatrix?u.pivotMatrix=this.getPivotMatrix().$i():u.localMatrix=this.getPivotMatrix().$i(),u.isEnabled=this.isEnabled(!1),u.isVisible=this.isVisible,u.infiniteDistance=this.infiniteDistance,u.pickable=this.me,u.receiveShadows=this.receiveShadows,u.billboardMode=this.billboardMode,u.visibility=this.visibility,u.fg=this.fg,u.checkCollisions=this.checkCollisions,u.ellipsoid=this.ellipsoid.$i(),u.ellipsoidOffset=this.ellipsoidOffset.$i(),u.Da=this.Da,u.isBlocker=this.isBlocker,u.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(u),u.isUnIndexed=this.isUnIndexed;const G=this._geometry;if(G&&this.xf){u.geometryUniqueId=G.uniqueId,u.geometryId=G.id,u.xf=[];for(let G=0;G<this.xf.length;G++){const s=this.xf[G];u.xf.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(u.materialUniqueId=this.material.uniqueId,u.materialId=this.material.id):(this.material=null,u.materialUniqueId=this._scene.defaultMaterial.uniqueId,u.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(u.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(u.skeletonId=this.skeleton.id,u.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(p.d.NAME_PHYSICSENGINE)){const G=this.getPhysicsImpostor();G&&(u.physicsMass=G.getParam("mass"),u.physicsFriction=G.getParam("friction"),u.physicsRestitution=G.getParam("mass"),u.physicsImpostor=G.type)}this.metadata&&(u.metadata=this.metadata),u.instances=[];for(let s=0;s<this.instances.length;s++){const G=this.instances[s];if(G.doNotSerialize)continue;const T={name:G.name,id:G.id,isEnabled:G.isEnabled(!1),isVisible:G.isVisible,me:G.me,checkCollisions:G.checkCollisions,position:G.position.$i(),vf:G.vf.$i()};if(G.parent&&G.parent._serializeAsParent(T),G.rotationQuaternion?T.rotationQuaternion=G.rotationQuaternion.$i():G.rotation&&(T.rotation=G.rotation.$i()),this.va()._getComponent(p.d.NAME_PHYSICSENGINE)){const u=G.getPhysicsImpostor();u&&(T.physicsMass=u.getParam("mass"),T.physicsFriction=u.getParam("friction"),T.physicsRestitution=u.getParam("mass"),T.physicsImpostor=u.type)}G.metadata&&(T.metadata=G.metadata),G.actionManager&&(T.actions=G.actionManager.serialize(G.name)),u.instances.push(T),l.e.AppendSerializedAnimations(G,T),T.ranges=G.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(u.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const G={data:{},sizes:{},strides:{}};for(const u in this._userThinInstanceBuffersStorage.data)G.data[u]=Array.from(this._userThinInstanceBuffersStorage.data[u]),G.sizes[u]=this._userThinInstanceBuffersStorage.sizes[u],G.strides[u]=this._userThinInstanceBuffersStorage.strides[u];u.thinInstances.userThinInstance=G}return l.e.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.layerMask=this.layerMask,u.alphaIndex=this.alphaIndex,u.hasVertexAlpha=this.hasVertexAlpha,u.overlayAlpha=this.overlayAlpha,u.overlayColor=this.overlayColor.$i(),u.renderOverlay=this.renderOverlay,u.applyFog=this.applyFog,this.actionManager&&(u.actions=this.actionManager.serialize(this.name)),u}_syncGeometryWithMorphTargetManager(){if(!this.sj)return;this._markSubMeshesAsAttributesDirty();const u=this._internalAbstractMeshDataInfo._morphTargetManager;if(u&&u.vertexCount){if(u.vertexCount!==this.getTotalVertices())return P.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(u.isUsingTextureForTargets)return;for(let G=0;G<u.numInfluencers;G++){const s=u.getActiveTarget(G),T=s.getPositions();if(!T)return void P.d.Error("Invalid morph target. Target must have positions.");this.sj.Ga(Q.f.PositionKind+G,T,!1,3);const z=s.getNormals();z&&this.sj.Ga(Q.f.NormalKind+G,z,!1,3);const O=s.getTangents();O&&this.sj.Ga(Q.f.TangentKind+G,O,!1,3);const m=s.getUVs();m&&this.sj.Ga(Q.f.UVKind+"_"+G,m,!1,2)}}else{let u=0;for(;this.sj.isVerticesDataPresent(Q.f.PositionKind+u);)this.sj.removeVerticesData(Q.f.PositionKind+u),this.sj.isVerticesDataPresent(Q.f.NormalKind+u)&&this.sj.removeVerticesData(Q.f.NormalKind+u),this.sj.isVerticesDataPresent(Q.f.TangentKind+u)&&this.sj.removeVerticesData(Q.f.TangentKind+u),this.sj.isVerticesDataPresent(Q.f.UVKind+u)&&this.sj.removeVerticesData(Q.f.UVKind+"_"+u),u++}}static Parse(u,G,s){let T;if(T=u.type&&"LinesMesh"===u.type?R._LinesMeshParser(u,G):u.type&&"GroundMesh"===u.type?R._GroundMeshParser(u,G):u.type&&"GoldbergMesh"===u.type?R._GoldbergMeshParser(u,G):u.type&&"GreasedLineMesh"===u.type?R._GreasedLineMeshParser(u,G):u.type&&"TrailMesh"===u.type?R._TrailMeshParser(u,G):new R(u.name,G),T.id=u.id,T._waitingParsedUniqueId=u.uniqueId,m.c&&m.c.AddTagsTo(T,u.tags),T.position=x.q.Ag(u.position),void 0!==u.metadata&&(T.metadata=u.metadata),u.rotationQuaternion?T.rotationQuaternion=x.h.Ag(u.rotationQuaternion):u.rotation&&(T.rotation=x.q.Ag(u.rotation)),T.vf=x.q.Ag(u.vf),u.localMatrix?T.setPreTransformMatrix(x.d.Ag(u.localMatrix)):u.pivotMatrix&&T.setPivotMatrix(x.d.Ag(u.pivotMatrix)),T.Af(u.isEnabled),T.isVisible=u.isVisible,T.infiniteDistance=u.infiniteDistance,T.fg=!!u.fg,T.showBoundingBox=u.showBoundingBox,T.showSubMeshesBoundingBox=u.showSubMeshesBoundingBox,void 0!==u.applyFog&&(T.applyFog=u.applyFog),void 0!==u.pickable&&(T.me=u.pickable),void 0!==u.alphaIndex&&(T.alphaIndex=u.alphaIndex),T.receiveShadows=u.receiveShadows,void 0!==u.billboardMode&&(T.billboardMode=u.billboardMode),void 0!==u.visibility&&(T.visibility=u.visibility),T.checkCollisions=u.checkCollisions,T.Da=!!u.Da,u.ellipsoid&&(T.ellipsoid=x.q.Ag(u.ellipsoid)),u.ellipsoidOffset&&(T.ellipsoidOffset=x.q.Ag(u.ellipsoidOffset)),null!=u.overrideMaterialSideOrientation&&(T.sideOrientation=u.overrideMaterialSideOrientation),void 0!==u.sideOrientation&&(T.sideOrientation=u.sideOrientation),void 0!==u.isBlocker&&(T.isBlocker=u.isBlocker),T._shouldGenerateFlatShading=u.useFlatShading,u.wh&&(T._waitingData.wh=u.wh),void 0!==u.parentId&&(T._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(T._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.actions&&(T._waitingData.actions=u.actions),void 0!==u.overlayAlpha&&(T.overlayAlpha=u.overlayAlpha),void 0!==u.overlayColor&&(T.overlayColor=g.b.Ag(u.overlayColor)),void 0!==u.renderOverlay&&(T.renderOverlay=u.renderOverlay),T.isUnIndexed=!!u.isUnIndexed,T.hasVertexAlpha=u.hasVertexAlpha,u.delayLoadingFile?(T.delayLoadState=4,T.delayLoadingFile=s+u.delayLoadingFile,T.buildBoundingInfo(x.q.Ag(u.boundingBoxMinimum),x.q.Ag(u.boundingBoxMaximum)),u._binaryInfo&&(T._binaryInfo=u._binaryInfo),T._delayInfo=[],u.hasUVs&&T._delayInfo.push(Q.f.UVKind),u.hasUVs2&&T._delayInfo.push(Q.f.UV2Kind),u.hasUVs3&&T._delayInfo.push(Q.f.UV3Kind),u.hasUVs4&&T._delayInfo.push(Q.f.UV4Kind),u.hasUVs5&&T._delayInfo.push(Q.f.UV5Kind),u.hasUVs6&&T._delayInfo.push(Q.f.UV6Kind),u.hasColors&&T._delayInfo.push(Q.f.ColorKind),u.hasMatricesIndices&&T._delayInfo.push(Q.f.MatricesIndicesKind),u.hasMatricesWeights&&T._delayInfo.push(Q.f.MatricesWeightsKind),T._delayLoadingFunction=n.d._ImportGeometry,j.c.ForceFullSceneLoadingForIncremental&&T._checkDelayState()):n.d._ImportGeometry(u,T),u.materialUniqueId?T._waitingMaterialId=u.materialUniqueId:u.materialId&&(T._waitingMaterialId=u.materialId),u.morphTargetManagerId>-1&&(T._waitingMorphTargetManagerId=u.morphTargetManagerId),void 0!==u.skeletonId&&null!==u.skeletonId&&(T.skeleton=G.getLastSkeletonById(u.skeletonId),u.numBoneInfluencers&&(T.numBoneInfluencers=u.numBoneInfluencers)),u.animations){for(let G=0;G<u.animations.length;G++){const s=u.animations[G],z=(0,H.e)("BABYLON.Animation");z&&T.animations.push(z.Parse(s))}b.b.ParseAnimationRanges(T,u,G)}if(u.autoAnimate&&G.beginAnimation(T,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),u.layerMask&&!isNaN(u.layerMask)?T.layerMask=Math.abs(parseInt(u.layerMask)):T.layerMask=268435455,u.physicsImpostor&&(T.physicsImpostor=R._PhysicsImpostorParser(G,T,u)),u.lodMeshIds&&(T._waitingData.lods={ids:u.lodMeshIds,distances:u.lodDistances?u.lodDistances:null,coverages:u.lodCoverages?u.lodCoverages:null}),u.instances)for(let z=0;z<u.instances.length;z++){const s=u.instances[z],O=T.ed(s.name);if(s.id&&(O.id=s.id),m.c&&(s.tags?m.c.AddTagsTo(O,s.tags):m.c.AddTagsTo(O,u.tags)),O.position=x.q.Ag(s.position),void 0!==s.metadata&&(O.metadata=s.metadata),void 0!==s.parentId&&(O._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(O._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.isEnabled&&null!==s.isEnabled&&O.Af(s.isEnabled),void 0!==s.isVisible&&null!==s.isVisible&&(O.isVisible=s.isVisible),void 0!==s.me&&null!==s.me&&(O.me=s.me),s.rotationQuaternion?O.rotationQuaternion=x.h.Ag(s.rotationQuaternion):s.rotation&&(O.rotation=x.q.Ag(s.rotation)),O.vf=x.q.Ag(s.vf),void 0!=s.checkCollisions&&null!=s.checkCollisions&&(O.checkCollisions=s.checkCollisions),void 0!=s.pickable&&null!=s.pickable&&(O.me=s.pickable),void 0!=s.showBoundingBox&&null!=s.showBoundingBox&&(O.showBoundingBox=s.showBoundingBox),void 0!=s.showSubMeshesBoundingBox&&null!=s.showSubMeshesBoundingBox&&(O.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox),void 0!=s.alphaIndex&&null!=s.showSubMeshesBoundingBox&&(O.alphaIndex=s.alphaIndex),s.physicsImpostor&&(O.physicsImpostor=R._PhysicsImpostorParser(G,O,s)),void 0!==s.actions&&(O._waitingData.actions=s.actions),s.animations){for(let u=0;u<s.animations.length;u++){const G=s.animations[u],T=(0,H.e)("BABYLON.Animation");T&&O.animations.push(T.Parse(G))}b.b.ParseAnimationRanges(O,s,G),s.autoAnimate&&G.beginAnimation(O,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1)}}if(u.thinInstances){const G=u.thinInstances;if(T.thinInstanceEnablePicking=!!G.enablePicking,G.matrixData?(T.Kj("matrix",new Float32Array(G.matrixData),16,!1),T._thinInstanceDataStorage.matrixBufferSize=G.matrixBufferSize,T._thinInstanceDataStorage.instancesCount=G.instancesCount):T._thinInstanceDataStorage.matrixBufferSize=G.matrixBufferSize,u.thinInstances.userThinInstance){const G=u.thinInstances.userThinInstance;for(const u in G.data)T.Kj(u,new Float32Array(G.data[u]),G.strides[u],!1),T._userThinInstanceBuffersStorage.sizes[u]=G.sizes[u]}}return T}setPositionsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourcePositions){const G=this.getVerticesData(Q.f.PositionKind);if(!G)return u._sourcePositions;u._sourcePositions=new Float32Array(G),this.isVertexBufferUpdatable(Q.f.PositionKind)||this.Ga(Q.f.PositionKind,G,!0)}return u._sourcePositions}setNormalsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourceNormals){const G=this.getVerticesData(Q.f.NormalKind);if(!G)return u._sourceNormals;u._sourceNormals=new Float32Array(G),this.isVertexBufferUpdatable(Q.f.NormalKind)||this.Ga(Q.f.NormalKind,G,!0)}return u._sourceNormals}applySkeleton(u){if(!this.sj)return this;if(this.sj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.sj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(Q.f.PositionKind))return this;if(!this.isVerticesDataPresent(Q.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(Q.f.MatricesWeightsKind))return this;const G=this.isVerticesDataPresent(Q.f.NormalKind),s=this._internalMeshDataInfo;if(!s._sourcePositions){const u=this.xf.slice();this.setPositionsForCPUSkinning(),this.xf=u}G&&!s._sourceNormals&&this.setNormalsForCPUSkinning();let T=this.getVerticesData(Q.f.PositionKind);if(!T)return this;T instanceof Float32Array||(T=new Float32Array(T));let z=this.getVerticesData(Q.f.NormalKind);if(G){if(!z)return this;z instanceof Float32Array||(z=new Float32Array(z))}const O=this.getVerticesData(Q.f.MatricesIndicesKind),m=this.getVerticesData(Q.f.MatricesWeightsKind);if(!m||!O)return this;const f=this.numBoneInfluencers>4,C=f?this.getVerticesData(Q.f.MatricesIndicesExtraKind):null,g=f?this.getVerticesData(Q.f.MatricesWeightsExtraKind):null,b=u.getTransformMatrices(this),Y=x.q.Zero(),n=new x.d,V=new x.d;let F,r=0;for(let Q=0;Q<T.length;Q+=3,r+=4){let u;for(F=0;F<4;F++)u=m[r+F],u>0&&(x.d.FromFloat32ArrayToRefScaled(b,Math.floor(16*O[r+F]),u,V),n.addToSelf(V));if(f)for(F=0;F<4;F++)u=g[r+F],u>0&&(x.d.FromFloat32ArrayToRefScaled(b,Math.floor(16*C[r+F]),u,V),n.addToSelf(V));x.q.TransformCoordinatesFromFloatsToRef(s._sourcePositions[Q],s._sourcePositions[Q+1],s._sourcePositions[Q+2],n,Y),Y.toArray(T,Q),G&&(x.q.TransformNormalFromFloatsToRef(s._sourceNormals[Q],s._sourceNormals[Q+1],s._sourceNormals[Q+2],n,Y),Y.toArray(z,Q)),n.reset()}return this.updateVerticesData(Q.f.PositionKind,T),G&&this.updateVerticesData(Q.f.NormalKind,z),this}static MinMax(u){let G=null,s=null;return u.forEach((function(u){const T=u.getBoundingInfo().boundingBox;G&&s?(G.minimizeInPlace(T.minimumWorld),s.maximizeInPlace(T.maximumWorld)):(G=T.minimumWorld,s=T.maximumWorld)})),G&&s?{min:G,max:s}:{min:x.q.Zero(),max:x.q.Zero()}}static Center(u){const G=u instanceof Array?R.MinMax(u):u;return x.q.Center(G.min,G.max)}static MergeMeshes(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;return(0,f.h)(R._MergeMeshesCoroutine(u,G,s,T,z,O,!1))}static MergeMeshesAsync(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;return(0,f.g)(R._MergeMeshesCoroutine(u,G,s,T,z,O,!0),(0,f.c)())}static*_MergeMeshesCoroutine(u){let G,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;if(0===(u=u.filter(Boolean)).length)return null;if(!T){let s=0;for(G=0;G<u.length;G++)if(s+=u[G].getTotalVertices(),s>=65536)return P.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}m&&(O=!1);const C=new Array,x=new Array,g=new Array,b=u[0].sideOrientation;for(G=0;G<u.length;G++){const s=u[G];if(s.isAnInstance)return P.d.Warn("Cannot merge instance meshes."),null;if(b!==s.sideOrientation)return P.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(O&&g.push(s.getTotalIndices()),m)if(s.material){const u=s.material;if(u instanceof c.b){for(let G=0;G<u.yf.length;G++)C.indexOf(u.yf[G])<0&&C.push(u.yf[G]);for(let G=0;G<s.xf.length;G++)x.push(C.indexOf(u.yf[s.xf[G].materialIndex])),g.push(s.xf[G].indexCount)}else{C.indexOf(u)<0&&C.push(u);for(let G=0;G<s.xf.length;G++)x.push(C.indexOf(u)),g.push(s.xf[G].indexCount)}}else for(let u=0;u<s.xf.length;u++)x.push(0),g.push(s.xf[u].indexCount)}const Q=u[0],n=u=>{const G=u.Gj(!0);return{vertexData:Y.b.ExtractFromMesh(u,!1,!1),transform:G}},{vertexData:V,transform:r}=n(Q);f&&(yield);const j=new Array(u.length-1);for(let Y=1;Y<u.length;Y++)j[Y-1]=n(u[Y]),f&&(yield);const l=V._mergeCoroutine(r,j,T,f,!s);let H=l.next();for(;!H.done;)f&&(yield),H=l.next();const X=H.value;z||(z=new R(Q.name+"_merged",Q.va()));const p=X._applyToCoroutine(z,void 0,f);let q=p.next();for(;!q.done;)f&&(yield),q=p.next();if(z.checkCollisions=Q.checkCollisions,z.sideOrientation=Q.sideOrientation,s)for(G=0;G<u.length;G++)u[G].dispose();if(O||m){z.releaseSubMeshes(),G=0;let u=0;for(;G<g.length;)F.d.CreateFromIndices(0,u,g[G],z,void 0,!1),u+=g[G],G++;for(const G of z.xf)G.refreshBoundingInfo();z.Gj(!0)}if(m){const u=new c.b(Q.name+"_merged",Q.va());u.yf=C;for(let G=0;G<z.xf.length;G++)z.xf[G].materialIndex=x[G];z.material=u}else z.material=Q.material;return z}wj(u){u._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(u)}uj(u){const G=u._indexInSourceMeshInstanceArray;if(-1!=G){if(G!==this.instances.length-1){const u=this.instances[this.instances.length-1];this.instances[G]=u,u._indexInSourceMeshInstanceArray=G}u._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===r.d.CounterClockWiseSideOrientation}_getRenderingFillMode(u){const G=this.va();return G.forcePointsCloud?r.d.PointFillMode:G.forceWireframe?r.d.WireFrameFillMode:this.overrideRenderingFillMode??u}setMaterialByID(u){return this.setMaterialById(u)}static CreateRibbon(u,G,s,T,z,O,m,f,C){throw new Error("Import MeshBuilder to populate this function")}static pb(u,G,s,T,z,O){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(u,G,s,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(u,G,s,T,z,O){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(u,G,s,T){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(u,G,s,T,z,O,m,f,C){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(u,G,s,T,z,O,m){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(u,G,s,T,z,O,m,f,C,x){throw new Error("Import MeshBuilder to populate this function")}static qb(u,G,s,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(u,G,s,T,z,O,m,f){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(u,G,s,T,z,O,m){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(u,G,s,T,z,O,m,f){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(u,G,s,T,z,O,m,f,C,x){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(u,G,s,T,z,O,m,f,C,x,g,b){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(u,G,s,T,z,O,m){throw new Error("Import MeshBuilder to populate this function")}static Bf(u,G,s,T,z){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(u,G,s,T,z,O){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(u,G,s,T,z,O,m,f,C){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(u,G,s,T,z,O,m,f,C,x,g){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(u,G,s,T,z,O,m,f,C,x){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(u,G,s){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(u,G,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(u,G,s,T,z,O){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(u,G,s){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(u){throw new Error("Import MeshBuilder to populate this function")}}R.FRONTSIDE=Y.b.FRONTSIDE,R.BACKSIDE=Y.b.BACKSIDE,R.DOUBLESIDE=Y.b.DOUBLESIDE,R.DEFAULTSIDE=Y.b.DEFAULTSIDE,R.NO_CAP=0,R.CAP_START=1,R.CAP_END=2,R.CAP_ALL=3,R.NO_FLIP=0,R.FLIP_TILE=1,R.ROTATE_TILE=2,R.FLIP_ROW=3,R.ROTATE_ROW=4,R.FLIP_N_ROTATE_TILE=5,R.FLIP_N_ROTATE_ROW=6,R.CENTER=0,R.LEFT=1,R.RIGHT=2,R.TOP=3,R.BOTTOM=4,R.INSTANCEDMESH_SORT_TRANSPARENT=!1,R._GroundMeshParser=(u,G)=>{throw(0,X.c)("GroundMesh")},R._GoldbergMeshParser=(u,G)=>{throw(0,X.c)("GoldbergMesh")},R._LinesMeshParser=(u,G)=>{throw(0,X.c)("LinesMesh")},R._GreasedLineMeshParser=(u,G)=>{throw(0,X.c)("GreasedLineMesh")},R._GreasedLineRibbonMeshParser=(u,G)=>{throw(0,X.c)("GreasedLineRibbonMesh")},R._TrailMeshParser=(u,G)=>{throw(0,X.c)("TrailMesh")},(0,H.g)("BABYLON.Mesh",R)},11173:(u,G,s)=>{"use strict";s.d(G,{b:()=>n});var T=s(10863),z=s(10904),O=s(10961),m=s(10609),f=s(10930),C=s(10584),x=s(10866),g=s(11152),b=s(10625),Q=s(11050);class Y{}class n{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,g.f)(this._applyToCoroutine.bind(this)),this.uniqueId=n._UniqueIDGenerator,n._UniqueIDGenerator++}set(u,G){switch(u.length||C.d.Warn(`Setting vertex data kind '${G}' with an empty array`),G){case O.f.PositionKind:this.xa=u;break;case O.f.NormalKind:this.ya=u;break;case O.f.TangentKind:this.tangents=u;break;case O.f.UVKind:this.Aa=u;break;case O.f.UV2Kind:this.uvs2=u;break;case O.f.UV3Kind:this.uvs3=u;break;case O.f.UV4Kind:this.uvs4=u;break;case O.f.UV5Kind:this.uvs5=u;break;case O.f.UV6Kind:this.uvs6=u;break;case O.f.ColorKind:this.za=u;break;case O.f.MatricesIndicesKind:this.matricesIndices=u;break;case O.f.MatricesWeightsKind:this.matricesWeights=u;break;case O.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=u;break;case O.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=u}}Ca(u,G){return this._applyTo(u,G,!1),this}applyToGeometry(u,G){return this._applyTo(u,G,!1),this}updateMesh(u){return this._update(u),this}updateGeometry(u){return this._update(u),this}*_applyToCoroutine(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;if(this.xa&&(u.Ga(O.f.PositionKind,this.xa,G),s&&(yield)),this.ya&&(u.Ga(O.f.NormalKind,this.ya,G),s&&(yield)),this.tangents&&(u.Ga(O.f.TangentKind,this.tangents,G),s&&(yield)),this.Aa&&(u.Ga(O.f.UVKind,this.Aa,G),s&&(yield)),this.uvs2&&(u.Ga(O.f.UV2Kind,this.uvs2,G),s&&(yield)),this.uvs3&&(u.Ga(O.f.UV3Kind,this.uvs3,G),s&&(yield)),this.uvs4&&(u.Ga(O.f.UV4Kind,this.uvs4,G),s&&(yield)),this.uvs5&&(u.Ga(O.f.UV5Kind,this.uvs5,G),s&&(yield)),this.uvs6&&(u.Ga(O.f.UV6Kind,this.uvs6,G),s&&(yield)),this.za&&(u.Ga(O.f.ColorKind,this.za,G),this.hasVertexAlpha&&void 0!==u.hasVertexAlpha&&(u.hasVertexAlpha=!0),s&&(yield)),this.matricesIndices&&(u.Ga(O.f.MatricesIndicesKind,this.matricesIndices,G),s&&(yield)),this.matricesWeights&&(u.Ga(O.f.MatricesWeightsKind,this.matricesWeights,G),s&&(yield)),this.matricesIndicesExtra&&(u.Ga(O.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,G),s&&(yield)),this.matricesWeightsExtra&&(u.Ga(O.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,G),s&&(yield)),this.indices?(u.setIndices(this.indices,null,G),s&&(yield)):u.setIndices([],null),u.xf&&this.materialInfos&&this.materialInfos.length>1){const G=u;G.xf=[];for(const u of this.materialInfos)new Q.d(u.materialIndex,u.verticesStart,u.verticesCount,u.indexStart,u.indexCount,G)}return this}_update(u,G,s){return this.xa&&u.updateVerticesData(O.f.PositionKind,this.xa,G,s),this.ya&&u.updateVerticesData(O.f.NormalKind,this.ya,G,s),this.tangents&&u.updateVerticesData(O.f.TangentKind,this.tangents,G,s),this.Aa&&u.updateVerticesData(O.f.UVKind,this.Aa,G,s),this.uvs2&&u.updateVerticesData(O.f.UV2Kind,this.uvs2,G,s),this.uvs3&&u.updateVerticesData(O.f.UV3Kind,this.uvs3,G,s),this.uvs4&&u.updateVerticesData(O.f.UV4Kind,this.uvs4,G,s),this.uvs5&&u.updateVerticesData(O.f.UV5Kind,this.uvs5,G,s),this.uvs6&&u.updateVerticesData(O.f.UV6Kind,this.uvs6,G,s),this.za&&u.updateVerticesData(O.f.ColorKind,this.za,G,s),this.matricesIndices&&u.updateVerticesData(O.f.MatricesIndicesKind,this.matricesIndices,G,s),this.matricesWeights&&u.updateVerticesData(O.f.MatricesWeightsKind,this.matricesWeights,G,s),this.matricesIndicesExtra&&u.updateVerticesData(O.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,G,s),this.matricesWeightsExtra&&u.updateVerticesData(O.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,G,s),this.indices&&u.setIndices(this.indices,null),this}static _TransformVector3Coordinates(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const O=z.l.gb[0],m=z.l.gb[1];for(let f=s;f<s+T;f+=3)z.q.FromArrayToRef(u,f,O),z.q.TransformCoordinatesToRef(O,G,m),u[f]=m.x,u[f+1]=m.y,u[f+2]=m.z}static _TransformVector3Normals(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const O=z.l.gb[0],m=z.l.gb[1];for(let f=s;f<s+T;f+=3)z.q.FromArrayToRef(u,f,O),z.q.TransformNormalToRef(O,G,m),u[f]=m.x,u[f+1]=m.y,u[f+2]=m.z}static _TransformVector4Normals(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.length;const O=z.l.Vector4[0],m=z.l.Vector4[1];for(let f=s;f<s+T;f+=4)z.s.FromArrayToRef(u,f,O),z.s.TransformNormalToRef(O,G,m),u[f]=m.x,u[f+1]=m.y,u[f+2]=m.z,u[f+3]=m.w}static _FlipFaces(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.length;for(let T=G;T<G+s;T+=3){const G=u[T+1];u[T+1]=u[T+2],u[T+2]=G}}transform(u){const G=u.determinant()<0;return this.xa&&n._TransformVector3Coordinates(this.xa,u),this.ya&&n._TransformVector3Normals(this.ya,u),this.tangents&&n._TransformVector4Normals(this.tangents,u),G&&this.indices&&n._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const u=[];for(const G of this.materialInfos){const s=new n;if(this.xa&&(s.xa=this.xa.slice(3*G.verticesStart,3*(G.verticesCount+G.verticesStart))),this.ya&&(s.ya=this.ya.slice(3*G.verticesStart,3*(G.verticesCount+G.verticesStart))),this.tangents&&(s.tangents=this.tangents.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.za&&(s.za=this.za.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.Aa&&(s.Aa=this.Aa.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.uvs2&&(s.uvs2=this.uvs2.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.uvs3&&(s.uvs3=this.uvs3.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.uvs4&&(s.uvs4=this.uvs4.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.uvs5&&(s.uvs5=this.uvs5.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.uvs6&&(s.uvs6=this.uvs6.slice(2*G.verticesStart,2*(G.verticesCount+G.verticesStart))),this.matricesIndices&&(s.matricesIndices=this.matricesIndices.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.matricesIndicesExtra&&(s.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.matricesWeights&&(s.matricesWeights=this.matricesWeights.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.matricesWeightsExtra&&(s.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*G.verticesStart,4*(G.verticesCount+G.verticesStart))),this.indices){s.indices=[];for(let u=G.indexStart;u<G.indexStart+G.indexCount;u++)s.indices.push(this.indices[u]-G.verticesStart)}const T=new Y;T.indexStart=0,T.indexCount=s.indices?s.indices.length:0,T.materialIndex=G.materialIndex,T.verticesStart=0,T.verticesCount=(s.xa?s.xa.length:0)/3,s.materialInfos=[T],u.push(s)}return u}merge(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=Array.isArray(u)?u.map((u=>({vertexData:u}))):[{vertexData:u}];return(0,g.h)(this._mergeCoroutine(void 0,O,G,!1,s,T,z))}*_mergeCoroutine(u,G){var s,T;let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let g=G.map((u=>u.vertexData)),b=this;if(x)for(const O of g)O&&(O._validate(),!this.ya&&O.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&O.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&O.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&O.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&O.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&O.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&O.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&O.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&O.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&O.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&O.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&O.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&O.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const O of g)if(O)if(x)this.ya&&!O.ya&&(O.ya=new Float32Array(O.xa.length)),this.tangents&&!O.tangents&&(O.tangents=new Float32Array(O.xa.length/3*4)),this.Aa&&!O.Aa&&(O.Aa=new Float32Array(O.xa.length/3*2)),this.uvs2&&!O.uvs2&&(O.uvs2=new Float32Array(O.xa.length/3*2)),this.uvs3&&!O.uvs3&&(O.uvs3=new Float32Array(O.xa.length/3*2)),this.uvs4&&!O.uvs4&&(O.uvs4=new Float32Array(O.xa.length/3*2)),this.uvs5&&!O.uvs5&&(O.uvs5=new Float32Array(O.xa.length/3*2)),this.uvs6&&!O.uvs6&&(O.uvs6=new Float32Array(O.xa.length/3*2)),this.za&&!O.za&&(O.za=new Float32Array(O.xa.length/3*4),O.za.fill(1)),this.matricesIndices&&!O.matricesIndices&&(O.matricesIndices=new Float32Array(O.xa.length/3*4)),this.matricesWeights&&!O.matricesWeights&&(O.matricesWeights=new Float32Array(O.xa.length/3*4)),this.matricesIndicesExtra&&!O.matricesIndicesExtra&&(O.matricesIndicesExtra=new Float32Array(O.xa.length/3*4)),this.matricesWeightsExtra&&!O.matricesWeightsExtra&&(O.matricesWeightsExtra=new Float32Array(O.xa.length/3*4));else if(O._validate(),!this.ya!==!O.ya||!this.tangents!==!O.tangents||!this.Aa!==!O.Aa||!this.uvs2!==!O.uvs2||!this.uvs3!==!O.uvs3||!this.uvs4!==!O.uvs4||!this.uvs5!==!O.uvs5||!this.uvs6!==!O.uvs6||!this.za!==!O.za||!this.matricesIndices!==!O.matricesIndices||!this.matricesWeights!==!O.matricesWeights||!this.matricesIndicesExtra!==!O.matricesIndicesExtra||!this.matricesWeightsExtra!==!O.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(C){let s=0,T=0,z=0;const O=[];let m=null;const f=[];for(const G of this.splitBasedOnMaterialID())f.push({vertexData:G,transform:u});for(const u of G)if(u.vertexData)for(const G of u.vertexData.splitBasedOnMaterialID())f.push({vertexData:G,transform:u.transform});f.sort(((u,G)=>{const s=u.vertexData.materialInfos?u.vertexData.materialInfos[0].materialIndex:0,T=G.vertexData.materialInfos?G.vertexData.materialInfos[0].materialIndex:0;return s>T?1:s===T?0:-1}));for(const u of f){const G=u.vertexData;if(s=G.materialInfos?G.materialInfos[0].materialIndex:0,m&&m.materialIndex===s)m.indexCount+=G.indices.length,m.verticesCount+=G.xa.length/3;else{const u=new Y;u.materialIndex=s,u.indexStart=T,u.indexCount=G.indices.length,u.verticesStart=z,u.verticesCount=G.xa.length/3,O.push(u),m=u}T+=G.indices.length,z+=G.xa.length/3}const C=f.splice(0,1)[0];b=C.vertexData,u=C.transform,g=f.map((u=>u.vertexData)),G=f,this.materialInfos=O}const Q=g.reduce(((u,G)=>{var s;return u+((null===(s=G.indices)||void 0===s?void 0:s.length)??0)}),(null===(s=b.indices)||void 0===s?void 0:s.length)??0);let V=f||g.some((u=>u.indices===b.indices))?null===(T=b.indices)||void 0===T?void 0:T.slice():b.indices;if(Q>0){var F;let s=(null===(F=V)||void 0===F?void 0:F.length)??0;if(V||(V=new Array(Q)),V.length!==Q){if(Array.isArray(V))V.length=Q;else{const u=z||V instanceof Uint32Array?new Uint32Array(Q):new Uint16Array(Q);u.set(V),V=u}u&&u.determinant()<0&&n._FlipFaces(V,0,s)}let T=b.xa?b.xa.length/3:0;for(const{vertexData:u,transform:z}of G)if(u.indices){for(let G=0;G<u.indices.length;G++)V[s+G]=u.indices[G]+T;z&&z.determinant()<0&&n._FlipFaces(V,s,u.indices.length),T+=u.xa.length/3,s+=u.indices.length,m&&(yield)}}return this.indices=V,this.xa=n._MergeElement(O.f.PositionKind,b.xa,u,G.map((u=>[u.vertexData.xa,u.transform]))),m&&(yield),b.ya&&(this.ya=n._MergeElement(O.f.NormalKind,b.ya,u,G.map((u=>[u.vertexData.ya,u.transform]))),m&&(yield)),b.tangents&&(this.tangents=n._MergeElement(O.f.TangentKind,b.tangents,u,G.map((u=>[u.vertexData.tangents,u.transform]))),m&&(yield)),b.Aa&&(this.Aa=n._MergeElement(O.f.UVKind,b.Aa,u,G.map((u=>[u.vertexData.Aa,u.transform]))),m&&(yield)),b.uvs2&&(this.uvs2=n._MergeElement(O.f.UV2Kind,b.uvs2,u,G.map((u=>[u.vertexData.uvs2,u.transform]))),m&&(yield)),b.uvs3&&(this.uvs3=n._MergeElement(O.f.UV3Kind,b.uvs3,u,G.map((u=>[u.vertexData.uvs3,u.transform]))),m&&(yield)),b.uvs4&&(this.uvs4=n._MergeElement(O.f.UV4Kind,b.uvs4,u,G.map((u=>[u.vertexData.uvs4,u.transform]))),m&&(yield)),b.uvs5&&(this.uvs5=n._MergeElement(O.f.UV5Kind,b.uvs5,u,G.map((u=>[u.vertexData.uvs5,u.transform]))),m&&(yield)),b.uvs6&&(this.uvs6=n._MergeElement(O.f.UV6Kind,b.uvs6,u,G.map((u=>[u.vertexData.uvs6,u.transform]))),m&&(yield)),b.za&&(this.za=n._MergeElement(O.f.ColorKind,b.za,u,G.map((u=>[u.vertexData.za,u.transform]))),(void 0!==b.hasVertexAlpha||G.some((u=>void 0!==u.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=b.hasVertexAlpha||G.some((u=>u.vertexData.hasVertexAlpha))),m&&(yield)),b.matricesIndices&&(this.matricesIndices=n._MergeElement(O.f.MatricesIndicesKind,b.matricesIndices,u,G.map((u=>[u.vertexData.matricesIndices,u.transform]))),m&&(yield)),b.matricesWeights&&(this.matricesWeights=n._MergeElement(O.f.MatricesWeightsKind,b.matricesWeights,u,G.map((u=>[u.vertexData.matricesWeights,u.transform]))),m&&(yield)),b.matricesIndicesExtra&&(this.matricesIndicesExtra=n._MergeElement(O.f.MatricesIndicesExtraKind,b.matricesIndicesExtra,u,G.map((u=>[u.vertexData.matricesIndicesExtra,u.transform]))),m&&(yield)),b.matricesWeightsExtra&&(this.matricesWeightsExtra=n._MergeElement(O.f.MatricesWeightsExtraKind,b.matricesWeightsExtra,u,G.map((u=>[u.vertexData.matricesWeightsExtra,u.transform])))),this}static _MergeElement(u,G,s,T){const z=T.filter((u=>null!==u[0]&&void 0!==u[0]));if(!G&&0==z.length)return G;if(!G)return this._MergeElement(u,z[0][0],z[0][1],z.slice(1));const m=z.reduce(((u,G)=>u+G[0].length),G.length),f=u===O.f.PositionKind?n._TransformVector3Coordinates:u===O.f.NormalKind?n._TransformVector3Normals:u===O.f.TangentKind?n._TransformVector4Normals:()=>{};if(G instanceof Float32Array){const u=new Float32Array(m);u.set(G),s&&f(u,s,0,G.length);let T=G.length;for(const[G,s]of z)u.set(G,T),s&&f(u,s,T,G.length),T+=G.length;return u}{const u=new Array(m);for(let s=0;s<G.length;s++)u[s]=G[s];s&&f(u,s,0,G.length);let T=G.length;for(const[G,s]of z){for(let s=0;s<G.length;s++)u[T+s]=G[s];s&&f(u,s,T,G.length),T+=G.length}return u}}_validate(){if(!this.xa)throw new b.g("Positions are required",b.f.MeshInvalidPositionsError);const u=(u,G)=>{const s=O.f.DeduceStride(u);if(G.length%s!==0)throw new Error("The "+u+"s array count must be a multiple of "+s);return G.length/s},G=u(O.f.PositionKind,this.xa),s=(s,T)=>{const z=u(s,T);if(z!==G)throw new Error("The "+s+"s element count ("+z+") does not match the positions count ("+G+")")};this.ya&&s(O.f.NormalKind,this.ya),this.tangents&&s(O.f.TangentKind,this.tangents),this.Aa&&s(O.f.UVKind,this.Aa),this.uvs2&&s(O.f.UV2Kind,this.uvs2),this.uvs3&&s(O.f.UV3Kind,this.uvs3),this.uvs4&&s(O.f.UV4Kind,this.uvs4),this.uvs5&&s(O.f.UV5Kind,this.uvs5),this.uvs6&&s(O.f.UV6Kind,this.uvs6),this.za&&s(O.f.ColorKind,this.za),this.matricesIndices&&s(O.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&s(O.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&s(O.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&s(O.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const u=this.serialize();return n.Parse(u)}serialize(){const u={};if(this.xa&&(u.xa=Array.from(this.xa)),this.ya&&(u.ya=Array.from(this.ya)),this.tangents&&(u.tangents=Array.from(this.tangents)),this.Aa&&(u.Aa=Array.from(this.Aa)),this.uvs2&&(u.uvs2=Array.from(this.uvs2)),this.uvs3&&(u.uvs3=Array.from(this.uvs3)),this.uvs4&&(u.uvs4=Array.from(this.uvs4)),this.uvs5&&(u.uvs5=Array.from(this.uvs5)),this.uvs6&&(u.uvs6=Array.from(this.uvs6)),this.za&&(u.za=Array.from(this.za),u.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(u.matricesIndices=Array.from(this.matricesIndices),u.matricesIndices._isExpanded=!0),this.matricesWeights&&(u.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(u.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),u.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(u.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),u.indices=Array.from(this.indices),this.materialInfos){u.materialInfos=[];for(const G of this.materialInfos){const s={indexStart:G.indexStart,indexCount:G.indexCount,materialIndex:G.materialIndex,verticesStart:G.verticesStart,verticesCount:G.verticesCount};u.materialInfos.push(s)}}return u}static ExtractFromMesh(u,G,s){return n._ExtractFrom(u,G,s)}static ExtractFromGeometry(u,G,s){return n._ExtractFrom(u,G,s)}static _ExtractFrom(u,G,s){const T=new n;if(u.isVerticesDataPresent(O.f.PositionKind)&&(T.xa=u.getVerticesData(O.f.PositionKind,G,s)),u.isVerticesDataPresent(O.f.NormalKind)&&(T.ya=u.getVerticesData(O.f.NormalKind,G,s)),u.isVerticesDataPresent(O.f.TangentKind)&&(T.tangents=u.getVerticesData(O.f.TangentKind,G,s)),u.isVerticesDataPresent(O.f.UVKind)&&(T.Aa=u.getVerticesData(O.f.UVKind,G,s)),u.isVerticesDataPresent(O.f.UV2Kind)&&(T.uvs2=u.getVerticesData(O.f.UV2Kind,G,s)),u.isVerticesDataPresent(O.f.UV3Kind)&&(T.uvs3=u.getVerticesData(O.f.UV3Kind,G,s)),u.isVerticesDataPresent(O.f.UV4Kind)&&(T.uvs4=u.getVerticesData(O.f.UV4Kind,G,s)),u.isVerticesDataPresent(O.f.UV5Kind)&&(T.uvs5=u.getVerticesData(O.f.UV5Kind,G,s)),u.isVerticesDataPresent(O.f.UV6Kind)&&(T.uvs6=u.getVerticesData(O.f.UV6Kind,G,s)),u.isVerticesDataPresent(O.f.ColorKind)){const z=u.sj||u,m=z.getVertexBuffer(O.f.ColorKind),f=z.getVerticesData(O.f.ColorKind,G,s);if(3===m.getSize()){const u=new Float32Array(4*f.length/3);for(let G=0,s=0;G<f.length;G+=3,s+=4)u[s]=f[G],u[s+1]=f[G+1],u[s+2]=f[G+2],u[s+3]=1;T.za=u}else{if(4!==m.getSize())throw new Error(`Unexpected number of color components: ${m.getSize()}`);T.za=f}}return u.isVerticesDataPresent(O.f.MatricesIndicesKind)&&(T.matricesIndices=u.getVerticesData(O.f.MatricesIndicesKind,G,s)),u.isVerticesDataPresent(O.f.MatricesWeightsKind)&&(T.matricesWeights=u.getVerticesData(O.f.MatricesWeightsKind,G,s)),u.isVerticesDataPresent(O.f.MatricesIndicesExtraKind)&&(T.matricesIndicesExtra=u.getVerticesData(O.f.MatricesIndicesExtraKind,G,s)),u.isVerticesDataPresent(O.f.MatricesWeightsExtraKind)&&(T.matricesWeightsExtra=u.getVerticesData(O.f.MatricesWeightsExtraKind,G,s)),T.indices=u.kf(G,s),T}static CreateRibbon(u){throw(0,m.c)("ribbonBuilder")}static CreateBox(u){throw(0,m.c)("boxBuilder")}static CreateTiledBox(u){throw(0,m.c)("tiledBoxBuilder")}static CreateTiledPlane(u){throw(0,m.c)("tiledPlaneBuilder")}static CreateSphere(u){throw(0,m.c)("sphereBuilder")}static CreateCylinder(u){throw(0,m.c)("cylinderBuilder")}static CreateTorus(u){throw(0,m.c)("torusBuilder")}static CreateLineSystem(u){throw(0,m.c)("linesBuilder")}static CreateDashedLines(u){throw(0,m.c)("linesBuilder")}static CreateGround(u){throw(0,m.c)("groundBuilder")}static CreateTiledGround(u){throw(0,m.c)("groundBuilder")}static CreateGroundFromHeightMap(u){throw(0,m.c)("groundBuilder")}static Bf(u){throw(0,m.c)("planeBuilder")}static pb(u){throw(0,m.c)("discBuilder")}static CreatePolygon(u,G,s,T,z,O,f){throw(0,m.c)("polygonBuilder")}static CreateIcoSphere(u){throw(0,m.c)("icoSphereBuilder")}static CreatePolyhedron(u){throw(0,m.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||z.q.Up();throw(0,m.c)("capsuleBuilder")}static CreateTorusKnot(u){throw(0,m.c)("torusKnotBuilder")}static ComputeNormals(u,G,s,T){let O=0,m=0,f=0,C=0,x=0,g=0,b=0,Q=0,Y=0,n=0,V=0,F=0,r=0,c=0,j=0,l=0,P=0,H=0,X=0,p=0,q=!1,d=!1,v=!1,W=!1,M=1,o=0,R=null;T&&(q=!!T.facetNormals,d=!!T.facetPositions,v=!!T.facetPartitioning,M=!0===T.useRightHandedSystem?-1:1,o=T.ratio||0,W=!!T.depthSort,R=T.distanceTo,W&&void 0===R&&(R=z.q.Zero()));let B=0,D=0,k=0,w=0;for(v&&T&&T.bbSize&&(B=T.subDiv.X*o/T.bbSize.x,D=T.subDiv.Y*o/T.bbSize.y,k=T.subDiv.Z*o/T.bbSize.z,w=T.subDiv.max*T.subDiv.max,T.facetPartitioning.length=0),O=0;O<u.length;O++)s[O]=0;const L=G.length/3|0;for(O=0;O<L;O++){if(F=3*G[3*O],r=F+1,c=F+2,j=3*G[3*O+1],l=j+1,P=j+2,H=3*G[3*O+2],X=H+1,p=H+2,m=u[F]-u[j],f=u[r]-u[l],C=u[c]-u[P],x=u[H]-u[j],g=u[X]-u[l],b=u[p]-u[P],Q=M*(f*b-C*g),Y=M*(C*x-m*b),n=M*(m*g-f*x),V=Math.sqrt(Q*Q+Y*Y+n*n),V=0===V?1:V,Q/=V,Y/=V,n/=V,q&&T&&(T.facetNormals[O].x=Q,T.facetNormals[O].y=Y,T.facetNormals[O].z=n),d&&T&&(T.facetPositions[O].x=(u[F]+u[j]+u[H])/3,T.facetPositions[O].y=(u[r]+u[l]+u[X])/3,T.facetPositions[O].z=(u[c]+u[P]+u[p])/3),v&&T){const G=Math.floor((T.facetPositions[O].x-T.bInfo.minimum.x*o)*B),s=Math.floor((T.facetPositions[O].y-T.bInfo.minimum.y*o)*D),z=Math.floor((T.facetPositions[O].z-T.bInfo.minimum.z*o)*k),m=Math.floor((u[F]-T.bInfo.minimum.x*o)*B),f=Math.floor((u[r]-T.bInfo.minimum.y*o)*D),C=Math.floor((u[c]-T.bInfo.minimum.z*o)*k),x=Math.floor((u[j]-T.bInfo.minimum.x*o)*B),g=Math.floor((u[l]-T.bInfo.minimum.y*o)*D),b=Math.floor((u[P]-T.bInfo.minimum.z*o)*k),Q=Math.floor((u[H]-T.bInfo.minimum.x*o)*B),Y=Math.floor((u[X]-T.bInfo.minimum.y*o)*D),n=Math.floor((u[p]-T.bInfo.minimum.z*o)*k),V=m+T.subDiv.max*f+w*C,q=x+T.subDiv.max*g+w*b,d=Q+T.subDiv.max*Y+w*n,v=G+T.subDiv.max*s+w*z;T.facetPartitioning[v]=T.facetPartitioning[v]?T.facetPartitioning[v]:new Array,T.facetPartitioning[V]=T.facetPartitioning[V]?T.facetPartitioning[V]:new Array,T.facetPartitioning[q]=T.facetPartitioning[q]?T.facetPartitioning[q]:new Array,T.facetPartitioning[d]=T.facetPartitioning[d]?T.facetPartitioning[d]:new Array,T.facetPartitioning[V].push(O),q!=V&&T.facetPartitioning[q].push(O),d!=q&&d!=V&&T.facetPartitioning[d].push(O),v!=V&&v!=q&&v!=d&&T.facetPartitioning[v].push(O)}if(W&&T&&T.facetPositions){const u=T.depthSortedFacets[O];u.ind=3*O,u.sqDistance=z.q.DistanceSquared(T.facetPositions[O],R)}s[F]+=Q,s[r]+=Y,s[c]+=n,s[j]+=Q,s[l]+=Y,s[P]+=n,s[H]+=Q,s[X]+=Y,s[p]+=n}for(O=0;O<s.length/3;O++)Q=s[3*O],Y=s[3*O+1],n=s[3*O+2],V=Math.sqrt(Q*Q+Y*Y+n*n),V=0===V?1:V,Q/=V,Y/=V,n/=V,s[3*O]=Q,s[3*O+1]=Y,s[3*O+2]=n}static _ComputeSides(u,G,s,T,O,m,f){const C=s.length,x=T.length;let g,b;switch(u=u||n.DEFAULTSIDE){case n.FRONTSIDE:break;case n.BACKSIDE:for(g=0;g<C;g+=3){const u=s[g];s[g]=s[g+2],s[g+2]=u}for(b=0;b<x;b++)T[b]=-T[b];break;case n.DOUBLESIDE:{const u=G.length,Q=u/3;for(let s=0;s<u;s++)G[u+s]=G[s];for(g=0;g<C;g+=3)s[g+C]=s[g+2]+Q,s[g+1+C]=s[g+1]+Q,s[g+2+C]=s[g]+Q;for(b=0;b<x;b++)T[x+b]=-T[b];const Y=O.length;let n=0;for(n=0;n<Y;n++)O[n+Y]=O[n];for(m=m||new z.s(0,0,1,1),f=f||new z.s(0,0,1,1),n=0,g=0;g<Y/2;g++)O[n]=m.x+(m.z-m.x)*O[n],O[n+1]=m.y+(m.w-m.y)*O[n+1],O[n+Y]=f.x+(f.z-f.x)*O[n+Y],O[n+Y+1]=f.y+(f.w-f.y)*O[n+Y+1],n+=2;break}}}static Parse(u){const G=new n,s=u.xa;s&&G.set(s,O.f.PositionKind);const T=u.ya;T&&G.set(T,O.f.NormalKind);const z=u.tangents;z&&G.set(z,O.f.TangentKind);const m=u.Aa;m&&G.set(m,O.f.UVKind);const C=u.uvs2;C&&G.set(C,O.f.UV2Kind);const x=u.uvs3;x&&G.set(x,O.f.UV3Kind);const g=u.uvs4;g&&G.set(g,O.f.UV4Kind);const b=u.uvs5;b&&G.set(b,O.f.UV5Kind);const Q=u.uvs6;Q&&G.set(Q,O.f.UV6Kind);const V=u.za;V&&(G.set(f.e.CheckColors4(V,s.length/3),O.f.ColorKind),void 0!==u.hasVertexAlpha&&(G.hasVertexAlpha=u.hasVertexAlpha));const F=u.matricesIndices;F&&G.set(F,O.f.MatricesIndicesKind);const r=u.matricesWeights;r&&G.set(r,O.f.MatricesWeightsKind);const c=u.indices;c&&(G.indices=c);const j=u.materialInfos;if(j){G.materialInfos=[];for(const u of j){const s=new Y;s.indexCount=u.indexCount,s.indexStart=u.indexStart,s.verticesCount=u.verticesCount,s.verticesStart=u.verticesStart,s.materialIndex=u.materialIndex,G.materialInfos.push(s)}}return G}static ImportVertexData(u,G){const s=n.Parse(u);G.setAllVerticesData(s,u.updatable)}}n.FRONTSIDE=0,n.BACKSIDE=1,n.DOUBLESIDE=2,n.DEFAULTSIDE=0,n._UniqueIDGenerator=0,(0,T.b)([x.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T]=G;return!Array.isArray(T)}))],n,"_TransformVector3Coordinates",null),(0,T.b)([x.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T]=G;return!Array.isArray(T)}))],n,"_TransformVector3Normals",null),(0,T.b)([x.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T]=G;return!Array.isArray(T)}))],n,"_TransformVector4Normals",null),(0,T.b)([x.h.filter((function(){for(var u=arguments.length,G=new Array(u),s=0;s<u;s++)G[s]=arguments[s];let[T]=G;return!Array.isArray(T)}))],n,"_FlipFaces",null)},12295:(u,G,s)=>{"use strict";s.d(G,{c:()=>Vu});var T=s(10904),z=s(11148),O=s(10961),m=s(11173),f=s(11121);function C(u){let G=u.pathArray;const s=u.closeArray||!1,T=u.closePath||!1,z=u.invertUV||!1,C=Math.floor(G[0].length/2);let x=u.offset||C;x=x>C?C:Math.floor(x);const g=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,b=u.Aa,Q=u.za,Y=[],n=[],V=[],F=[],r=[],c=[],j=[],l=[];let P;const H=[],X=[];let p,q,d;if(G.length<2){const u=[],s=[];for(q=0;q<G[0].length-x;q++)u.push(G[0][q]),s.push(G[0][q+x]);G=[u,s]}let v=0;const W=T?1:0,M=s?1:0;let o,R,B,D,k,w;for(P=G[0].length,p=0;p<G.length+M;p++){for(j[p]=0,r[p]=[0],o=p===G.length?G[0]:G[p],R=o.length,P=P<R?P:R,d=0;d<R;)Y.push(o[d].x,o[d].y,o[d].z),d>0&&(B=o[d].Nc(o[d-1]).length(),D=B+j[p],r[p].push(D),j[p]=D),d++;T&&(d--,Y.push(o[0].x,o[0].y,o[0].z),B=o[d].Nc(o[0]).length(),D=B+j[p],r[p].push(D),j[p]=D),H[p]=R+W,X[p]=v,v+=R+W}let L,S,e=null,h=null;for(q=0;q<P+W;q++)for(l[q]=0,c[q]=[0],p=0;p<G.length-1+M;p++)k=G[p],w=p===G.length-1?G[0]:G[p+1],q===P?(e=k[0],h=w[0]):(e=k[q],h=w[q]),B=h.Nc(e).length(),D=B+l[q],c[q].push(D),l[q]=D;if(b)for(p=0;p<b.length;p++)F.push(b[p].x,f.e?1-b[p].y:b[p].y);else for(p=0;p<G.length+M;p++)for(q=0;q<P+W;q++)L=0!=j[p]?r[p][q]/j[p]:0,S=0!=l[q]?c[q][p]/l[q]:0,z?F.push(S,L):F.push(L,f.e?1-S:S);p=0;let I=0,i=H[p]-1,J=H[p+1]-1,A=i<J?i:J,N=X[1]-X[0];const y=H.length-1;for(;I<=A&&p<y;)n.push(I,I+N,I+1),n.push(I+N+1,I+1,I+N),I+=1,I===A&&(p++,N=X[p+1]-X[p],i=H[p]-1,J=H[p+1]-1,I=X[p],A=i<J?i+I:J+I);if(m.b.ComputeNormals(Y,n,V),T){let u=0,s=0;for(p=0;p<G.length;p++){u=3*X[p],s=p+1<G.length?3*(X[p+1]-1):V.length-3,V[u]=.5*(V[u]+V[s]),V[u+1]=.5*(V[u+1]+V[s+1]),V[u+2]=.5*(V[u+2]+V[s+2]);const T=Math.sqrt(V[u]*V[u]+V[u+1]*V[u+1]+V[u+2]*V[u+2]);V[u]/=T,V[u+1]/=T,V[u+2]/=T,V[s]=V[u],V[s+1]=V[u+1],V[s+2]=V[u+2]}}if(s){let u=3*X[0],s=3*X[G.length];for(q=0;q<P+W;q++){V[u]=.5*(V[u]+V[s]),V[u+1]=.5*(V[u+1]+V[s+1]),V[u+2]=.5*(V[u+2]+V[s+2]);const G=Math.sqrt(V[u]*V[u]+V[u+1]*V[u+1]+V[u+2]*V[u+2]);V[u]/=G,V[u+1]/=G,V[u+2]/=G,V[s]=V[u],V[s+1]=V[u+1],V[s+2]=V[u+2],u+=3,s+=3}}m.b._ComputeSides(g,Y,n,V,F,u.frontUVs,u.backUVs);let a=null;if(Q){a=new Float32Array(4*Q.length);for(let u=0;u<Q.length;u++)a[4*u]=Q[u].r,a[4*u+1]=Q[u].g,a[4*u+2]=Q[u].b,a[4*u+3]=Q[u].a}const K=new m.b,Z=new Float32Array(Y),t=new Float32Array(V),E=new Float32Array(F);return K.indices=n,K.xa=Z,K.ya=t,K.Aa=E,a&&K.set(a,O.f.ColorKind),T&&(K._idx=X),K}function x(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=G.pathArray,g=G.closeArray,b=G.closePath,Q=z.c._GetDefaultSideOrientation(G.sideOrientation),Y=G.instance,n=G.updatable;if(Y){const u=T.l.gb[0].vj(Number.MAX_VALUE),s=T.l.gb[1].vj(-Number.MAX_VALUE),C=G=>{let T=x[0].length;const O=Y;let m=0;const f=O._originalBuilderSideOrientation===z.c.DOUBLESIDE?2:1;for(let z=1;z<=f;++z)for(let f=0;f<x.length;++f){const z=x[f],C=z.length;T=T<C?T:C;for(let O=0;O<T;++O){const T=z[O];G[m]=T.x,G[m+1]=T.y,G[m+2]=T.z,u.minimizeInPlaceFromFloats(T.x,T.y,T.z),s.maximizeInPlaceFromFloats(T.x,T.y,T.z),m+=3}if(O._creationDataStorage&&O._creationDataStorage.closePath){const u=z[0];G[m]=u.x,G[m+1]=u.y,G[m+2]=u.z,m+=3}}},g=Y.getVerticesData(O.f.PositionKind);if(C(g),Y.hasBoundingInfo?Y.getBoundingInfo().reConstruct(u,s,Y._worldMatrix):Y.buildBoundingInfo(u,s,Y._worldMatrix),Y.updateVerticesData(O.f.PositionKind,g,!1,!1),G.za){const u=Y.getVerticesData(O.f.ColorKind);for(let s=0,T=0;s<G.za.length;s++,T+=4){const z=G.za[s];u[T]=z.r,u[T+1]=z.g,u[T+2]=z.b,u[T+3]=z.a}Y.updateVerticesData(O.f.ColorKind,u,!1,!1)}if(G.Aa){const u=Y.getVerticesData(O.f.UVKind);for(let s=0;s<G.Aa.length;s++)u[2*s]=G.Aa[s].x,u[2*s+1]=f.e?1-G.Aa[s].y:G.Aa[s].y;Y.updateVerticesData(O.f.UVKind,u,!1,!1)}if(!Y.areNormalsFrozen||Y.isFacetDataEnabled){const u=Y.kf(),G=Y.getVerticesData(O.f.NormalKind),s=Y.isFacetDataEnabled?Y.getFacetDataParameters():null;if(m.b.ComputeNormals(g,u,G,s),Y._creationDataStorage&&Y._creationDataStorage.closePath){let u=0,s=0;for(let T=0;T<x.length;T++)u=3*Y._creationDataStorage.idx[T],s=T+1<x.length?3*(Y._creationDataStorage.idx[T+1]-1):G.length-3,G[u]=.5*(G[u]+G[s]),G[u+1]=.5*(G[u+1]+G[s+1]),G[u+2]=.5*(G[u+2]+G[s+2]),G[s]=G[u],G[s+1]=G[u+1],G[s+2]=G[u+2]}Y.areNormalsFrozen||Y.updateVerticesData(O.f.NormalKind,G,!1,!1)}return Y}{const T=new z.c(u,s);T._originalBuilderSideOrientation=Q,T._creationDataStorage=new z.f;const O=C(G);return b&&(T._creationDataStorage.idx=O._idx),T._creationDataStorage.closePath=b,T._creationDataStorage.closeArray=g,O.Ca(T,n),T}}m.b.CreateRibbon=C,z.c.CreateRibbon=function(u,G){return x(u,{pathArray:G,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var g=s(11534),b=s(11219),Q=s(10930);function Y(u){const G=u.pattern||z.c.NO_FLIP,s=u.tileWidth||u.tileSize||1,T=u.tileHeight||u.tileSize||1,O=u.alignHorizontal||0,f=u.alignVertical||0,C=u.width||u.size||1,x=Math.floor(C/s);let g=C-x*s;const b=u.height||u.size||1,Q=Math.floor(b/T);let Y=b-Q*T;const n=s*x/2,V=T*Q/2;let F=0,r=0,c=0,j=0,l=0,P=0;if(g>0||Y>0){switch(c=-n,j=-V,l=n,P=V,O){case z.c.CENTER:g/=2,c-=g,l+=g;break;case z.c.LEFT:l+=g,F=-g/2;break;case z.c.RIGHT:c-=g,F=g/2}switch(f){case z.c.CENTER:Y/=2,j-=Y,P+=Y;break;case z.c.BOTTOM:P+=Y,r=-Y/2;break;case z.c.TOP:j-=Y,r=Y/2}}const H=[],X=[],p=[];p[0]=[0,0,1,0,1,1,0,1],p[1]=[0,0,1,0,1,1,0,1],G!==z.c.ROTATE_TILE&&G!==z.c.ROTATE_ROW||(p[1]=[1,1,0,1,0,0,1,0]),G!==z.c.FLIP_TILE&&G!==z.c.FLIP_ROW||(p[1]=[1,0,0,0,0,1,1,1]),G!==z.c.FLIP_N_ROTATE_TILE&&G!==z.c.FLIP_N_ROTATE_ROW||(p[1]=[0,1,1,1,1,0,0,0]);let q=[];const d=[],v=[];let W=0;for(let m=0;m<Q;m++)for(let u=0;u<x;u++)H.push(u*s-n+F,m*T-V+r,0),H.push((u+1)*s-n+F,m*T-V+r,0),H.push((u+1)*s-n+F,(m+1)*T-V+r,0),H.push(u*s-n+F,(m+1)*T-V+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),q=G===z.c.FLIP_TILE||G===z.c.ROTATE_TILE||G===z.c.FLIP_N_ROTATE_TILE?q.concat(p[(u%2+m%2)%2]):G===z.c.FLIP_ROW||G===z.c.ROTATE_ROW||G===z.c.FLIP_N_ROTATE_ROW?q.concat(p[m%2]):q.concat(p[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),W+=4;if(g>0||Y>0){const u=Y>0&&(f===z.c.CENTER||f===z.c.TOP),m=Y>0&&(f===z.c.CENTER||f===z.c.BOTTOM),C=g>0&&(O===z.c.CENTER||O===z.c.RIGHT),b=g>0&&(O===z.c.CENTER||O===z.c.LEFT);let p,M,o,R,B=[];if(u&&C&&(H.push(c+F,j+r,0),H.push(-n+F,j+r,0),H.push(-n+F,j+Y+r,0),H.push(c+F,j+Y+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,p=1-g/s,M=1-Y/T,o=1,R=1,B=[p,M,o,M,o,R,p,R],G===z.c.ROTATE_ROW&&(B=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),G===z.c.FLIP_ROW&&(B=[1-p,M,1-o,M,1-o,R,1-p,R]),G===z.c.FLIP_N_ROTATE_ROW&&(B=[p,1-M,o,1-M,o,1-R,p,1-R]),q=q.concat(B),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&b&&(H.push(n+F,j+r,0),H.push(l+F,j+r,0),H.push(l+F,j+Y+r,0),H.push(n+F,j+Y+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,p=0,M=1-Y/T,o=g/s,R=1,B=[p,M,o,M,o,R,p,R],(G===z.c.ROTATE_ROW||G===z.c.ROTATE_TILE&&x%2===0)&&(B=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),(G===z.c.FLIP_ROW||G===z.c.FLIP_TILE&&x%2===0)&&(B=[1-p,M,1-o,M,1-o,R,1-p,R]),(G===z.c.FLIP_N_ROTATE_ROW||G===z.c.FLIP_N_ROTATE_TILE&&x%2===0)&&(B=[p,1-M,o,1-M,o,1-R,p,1-R]),q=q.concat(B),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&C&&(H.push(c+F,V+r,0),H.push(-n+F,V+r,0),H.push(-n+F,P+r,0),H.push(c+F,P+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,p=1-g/s,M=0,o=1,R=Y/T,B=[p,M,o,M,o,R,p,R],(G===z.c.ROTATE_ROW&&Q%2===1||G===z.c.ROTATE_TILE&&Q%1===0)&&(B=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),(G===z.c.FLIP_ROW&&Q%2===1||G===z.c.FLIP_TILE&&Q%2===0)&&(B=[1-p,M,1-o,M,1-o,R,1-p,R]),(G===z.c.FLIP_N_ROTATE_ROW&&Q%2===1||G===z.c.FLIP_N_ROTATE_TILE&&Q%2===0)&&(B=[p,1-M,o,1-M,o,1-R,p,1-R]),q=q.concat(B),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&b&&(H.push(n+F,V+r,0),H.push(l+F,V+r,0),H.push(l+F,P+r,0),H.push(n+F,P+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,p=0,M=0,o=g/s,R=Y/T,B=[p,M,o,M,o,R,p,R],(G===z.c.ROTATE_ROW&&Q%2===1||G===z.c.ROTATE_TILE&&(Q+x)%2===1)&&(B=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),(G===z.c.FLIP_ROW&&Q%2===1||G===z.c.FLIP_TILE&&(Q+x)%2===1)&&(B=[1-p,M,1-o,M,1-o,R,1-p,R]),(G===z.c.FLIP_N_ROTATE_ROW&&Q%2===1||G===z.c.FLIP_N_ROTATE_TILE&&(Q+x)%2===1)&&(B=[p,1-M,o,1-M,o,1-R,p,1-R]),q=q.concat(B),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u){const u=[];p=0,M=1-Y/T,o=1,R=1,u[0]=[p,M,o,M,o,R,p,R],u[1]=[p,M,o,M,o,R,p,R],G!==z.c.ROTATE_TILE&&G!==z.c.ROTATE_ROW||(u[1]=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),G!==z.c.FLIP_TILE&&G!==z.c.FLIP_ROW||(u[1]=[1-p,M,1-o,M,1-o,R,1-p,R]),G!==z.c.FLIP_N_ROTATE_TILE&&G!==z.c.FLIP_N_ROTATE_ROW||(u[1]=[p,1-M,o,1-M,o,1-R,p,1-R]);for(let T=0;T<x;T++)H.push(T*s-n+F,j+r,0),H.push((T+1)*s-n+F,j+r,0),H.push((T+1)*s-n+F,j+Y+r,0),H.push(T*s-n+F,j+Y+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,q=G===z.c.FLIP_TILE||G===z.c.ROTATE_TILE||G===z.c.FLIP_N_ROTATE_TILE?q.concat(u[(T+1)%2]):G===z.c.FLIP_ROW||G===z.c.ROTATE_ROW||G===z.c.FLIP_N_ROTATE_ROW?q.concat(u[1]):q.concat(u[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const u=[];p=0,M=0,o=1,R=Y/T,u[0]=[p,M,o,M,o,R,p,R],u[1]=[p,M,o,M,o,R,p,R],G!==z.c.ROTATE_TILE&&G!==z.c.ROTATE_ROW||(u[1]=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),G!==z.c.FLIP_TILE&&G!==z.c.FLIP_ROW||(u[1]=[1-p,M,1-o,M,1-o,R,1-p,R]),G!==z.c.FLIP_N_ROTATE_TILE&&G!==z.c.FLIP_N_ROTATE_ROW||(u[1]=[p,1-M,o,1-M,o,1-R,p,1-R]);for(let T=0;T<x;T++)H.push(T*s-n+F,P-Y+r,0),H.push((T+1)*s-n+F,P-Y+r,0),H.push((T+1)*s-n+F,P+r,0),H.push(T*s-n+F,P+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,q=G===z.c.FLIP_TILE||G===z.c.ROTATE_TILE||G===z.c.FLIP_N_ROTATE_TILE?q.concat(u[(T+Q)%2]):G===z.c.FLIP_ROW||G===z.c.ROTATE_ROW||G===z.c.FLIP_N_ROTATE_ROW?q.concat(u[Q%2]):q.concat(u[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const u=[];p=1-g/s,M=0,o=1,R=1,u[0]=[p,M,o,M,o,R,p,R],u[1]=[p,M,o,M,o,R,p,R],G!==z.c.ROTATE_TILE&&G!==z.c.ROTATE_ROW||(u[1]=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),G!==z.c.FLIP_TILE&&G!==z.c.FLIP_ROW||(u[1]=[1-p,M,1-o,M,1-o,R,1-p,R]),G!==z.c.FLIP_N_ROTATE_TILE&&G!==z.c.FLIP_N_ROTATE_ROW||(u[1]=[p,1-M,o,1-M,o,1-R,p,1-R]);for(let s=0;s<Q;s++)H.push(c+F,s*T-V+r,0),H.push(c+g+F,s*T-V+r,0),H.push(c+g+F,(s+1)*T-V+r,0),H.push(c+F,(s+1)*T-V+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,q=G===z.c.FLIP_TILE||G===z.c.ROTATE_TILE||G===z.c.FLIP_N_ROTATE_TILE?q.concat(u[(s+1)%2]):G===z.c.FLIP_ROW||G===z.c.ROTATE_ROW||G===z.c.FLIP_N_ROTATE_ROW?q.concat(u[s%2]):q.concat(u[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const u=[];p=0,M=0,o=g/T,R=1,u[0]=[p,M,o,M,o,R,p,R],u[1]=[p,M,o,M,o,R,p,R],G!==z.c.ROTATE_TILE&&G!==z.c.ROTATE_ROW||(u[1]=[1-p,1-M,1-o,1-M,1-o,1-R,1-p,1-R]),G!==z.c.FLIP_TILE&&G!==z.c.FLIP_ROW||(u[1]=[1-p,M,1-o,M,1-o,R,1-p,R]),G!==z.c.FLIP_N_ROTATE_TILE&&G!==z.c.FLIP_N_ROTATE_ROW||(u[1]=[p,1-M,o,1-M,o,1-R,p,1-R]);for(let s=0;s<Q;s++)H.push(l-g+F,s*T-V+r,0),H.push(l+F,s*T-V+r,0),H.push(l+F,(s+1)*T-V+r,0),H.push(l-g+F,(s+1)*T-V+r,0),v.push(W,W+1,W+3,W+1,W+2,W+3),W+=4,q=G===z.c.FLIP_TILE||G===z.c.ROTATE_TILE||G===z.c.FLIP_N_ROTATE_TILE?q.concat(u[(s+x)%2]):G===z.c.FLIP_ROW||G===z.c.ROTATE_ROW||G===z.c.FLIP_N_ROTATE_ROW?q.concat(u[s%2]):q.concat(u[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),X.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE;m.b._ComputeSides(M,H,v,X,q,u.frontUVs,u.backUVs);const o=new m.b;o.indices=v,o.xa=H,o.ya=X,o.Aa=q;const R=M===m.b.DOUBLESIDE?d.concat(d):d;return o.za=R,o}function n(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return Y(G).Ca(T,G.updatable),T}function V(u){const G=u.faceUV||new Array(6),s=u.faceColors,O=u.pattern||z.c.NO_FLIP,C=u.width||u.size||1,x=u.height||u.size||1,g=u.depth||u.size||1,b=u.tileWidth||u.tileSize||1,n=u.tileHeight||u.tileSize||1,V=u.alignHorizontal||0,F=u.alignVertical||0,r=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE;for(let z=0;z<6;z++)void 0===G[z]&&(G[z]=new T.s(0,0,1,1)),s&&void 0===s[z]&&(s[z]=new Q.e(1,1,1,1));const c=C/2,j=x/2,l=g/2,P=[];for(let T=0;T<2;T++)P[T]=Y({pattern:O,tileWidth:b,tileHeight:n,width:C,height:x,alignVertical:F,alignHorizontal:V,sideOrientation:r});for(let T=2;T<4;T++)P[T]=Y({pattern:O,tileWidth:b,tileHeight:n,width:g,height:x,alignVertical:F,alignHorizontal:V,sideOrientation:r});let H=F;F===z.c.BOTTOM?H=z.c.TOP:F===z.c.TOP&&(H=z.c.BOTTOM);for(let T=4;T<6;T++)P[T]=Y({pattern:O,tileWidth:b,tileHeight:n,width:C,height:g,alignVertical:H,alignHorizontal:V,sideOrientation:r});let X=[],p=[],q=[],d=[];const v=[],W=[],M=[],o=[];let R=0,B=0;for(let z=0;z<6;z++){const u=P[z].xa.length;W[z]=[],M[z]=[];for(let G=0;G<u/3;G++)W[z].push(new T.q(P[z].xa[3*G],P[z].xa[3*G+1],P[z].xa[3*G+2])),M[z].push(new T.q(P[z].ya[3*G],P[z].ya[3*G+1],P[z].ya[3*G+2]));R=P[z].Aa.length,o[z]=[];for(let s=0;s<R;s+=2)o[z][s]=G[z].x+(G[z].z-G[z].x)*P[z].Aa[s],o[z][s+1]=G[z].y+(G[z].w-G[z].y)*P[z].Aa[s+1],f.e&&(o[z][s+1]=1-o[z][s+1]);if(q=q.concat(o[z]),d=d.concat(P[z].indices.map((u=>u+B))),B+=W[z].length,s)for(let G=0;G<4;G++)v.push(s[z].r,s[z].g,s[z].b,s[z].a)}const D=new T.q(0,0,l),k=T.d.RotationY(Math.PI);X=W[0].map((u=>T.q.TransformNormal(u,k).add(D))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]),p=M[0].map((u=>T.q.TransformNormal(u,k))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]),X=X.concat(W[1].map((u=>u.Nc(D))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),p=p.concat(M[1].map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]));const w=new T.q(c,0,0),L=T.d.RotationY(-Math.PI/2);X=X.concat(W[2].map((u=>T.q.TransformNormal(u,L).add(w))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),p=p.concat(M[2].map((u=>T.q.TransformNormal(u,L))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]));const S=T.d.RotationY(Math.PI/2);X=X.concat(W[3].map((u=>T.q.TransformNormal(u,S).Nc(w))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),p=p.concat(M[3].map((u=>T.q.TransformNormal(u,S))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]));const e=new T.q(0,j,0),h=T.d.RotationX(Math.PI/2);X=X.concat(W[4].map((u=>T.q.TransformNormal(u,h).add(e))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),p=p.concat(M[4].map((u=>T.q.TransformNormal(u,h))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[]));const I=T.d.RotationX(-Math.PI/2);X=X.concat(W[5].map((u=>T.q.TransformNormal(u,I).Nc(e))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),p=p.concat(M[5].map((u=>T.q.TransformNormal(u,I))).map((u=>[u.x,u.y,u.z])).reduce(((u,G)=>u.concat(G)),[])),m.b._ComputeSides(r,X,d,p,q);const i=new m.b;if(i.indices=d,i.xa=X,i.ya=p,i.Aa=q,s){const u=r===m.b.DOUBLESIDE?v.concat(v):v;i.za=u}return i}function F(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return V(G).Ca(T,G.updatable),T}m.b.CreateTiledPlane=Y;m.b.CreateTiledBox=V;var r=s(11517),c=s(10889),j=s(11201);function l(u){const G=u.height||2;let s=0===u.diameterTop?0:u.diameterTop||u.diameter||1,O=0===u.diameterBottom?0:u.diameterBottom||u.diameter||1;s=s||1e-5,O=O||1e-5;const C=0|(u.Nk||24),x=0|(u.subdivisions||1),g=!!u.hasRings,b=!!u.enclose,Y=0===u.cap?0:u.cap||z.c.CAP_ALL,n=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1,V=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,F=u.faceUV||new Array(3),r=u.faceColors,c=2+(1+(1!==n&&b?2:0))*(g?x:1);let l;for(l=0;l<c;l++)r&&void 0===r[l]&&(r[l]=new Q.e(1,1,1,1));for(l=0;l<c;l++)F&&void 0===F[l]&&(F[l]=new T.s(0,0,1,1));const P=[],H=[],X=[],p=[],q=[],d=2*Math.PI*n/C;let v,W,M;const o=(O-s)/2/G,R=T.q.Zero(),B=T.q.Zero(),D=T.q.Zero(),k=T.q.Zero(),w=T.q.Zero(),L=j.e.Y;let S,e,h,I=1,i=1,J=0,A=0;for(S=0;S<=x;S++)for(W=S/x,M=(W*(s-O)+O)/2,I=g&&0!==S&&S!==x?2:1,h=0;h<I;h++){for(g&&(i+=h),b&&(i+=2*h),e=0;e<=C;e++)v=e*d,R.x=Math.cos(-v)*M,R.y=-G/2+W*G,R.z=Math.sin(-v)*M,0===s&&S===x?(B.x=X[X.length-3*(C+1)],B.y=X[X.length-3*(C+1)+1],B.z=X[X.length-3*(C+1)+2]):(B.x=R.x,B.z=R.z,B.y=Math.sqrt(B.x*B.x+B.z*B.z)*o,B.normalize()),0===e&&(D.p(R),k.p(B)),H.push(R.x,R.y,R.z),X.push(B.x,B.y,B.z),A=g?J!==i?F[i].y:F[i].w:F[i].y+(F[i].w-F[i].y)*W,p.push(F[i].x+(F[i].z-F[i].x)*e/C,f.e?1-A:A),r&&q.push(r[i].r,r[i].g,r[i].b,r[i].a);1!==n&&b&&(H.push(R.x,R.y,R.z),H.push(0,R.y,0),H.push(0,R.y,0),H.push(D.x,D.y,D.z),T.q.CrossToRef(L,B,w),w.normalize(),X.push(w.x,w.y,w.z,w.x,w.y,w.z),T.q.CrossToRef(k,L,w),w.normalize(),X.push(w.x,w.y,w.z,w.x,w.y,w.z),A=g?J!==i?F[i+1].y:F[i+1].w:F[i+1].y+(F[i+1].w-F[i+1].y)*W,p.push(F[i+1].x,f.e?1-A:A),p.push(F[i+1].z,f.e?1-A:A),A=g?J!==i?F[i+2].y:F[i+2].w:F[i+2].y+(F[i+2].w-F[i+2].y)*W,p.push(F[i+2].x,f.e?1-A:A),p.push(F[i+2].z,f.e?1-A:A),r&&(q.push(r[i+1].r,r[i+1].g,r[i+1].b,r[i+1].a),q.push(r[i+1].r,r[i+1].g,r[i+1].b,r[i+1].a),q.push(r[i+2].r,r[i+2].g,r[i+2].b,r[i+2].a),q.push(r[i+2].r,r[i+2].g,r[i+2].b,r[i+2].a))),J!==i&&(J=i)}const N=1!==n&&b?C+4:C;for(S=0,i=0;i<x;i++){let u=0,G=0,s=0,T=0;for(e=0;e<C;e++)u=S*(N+1)+e,G=(S+1)*(N+1)+e,s=S*(N+1)+(e+1),T=(S+1)*(N+1)+(e+1),P.push(u,G,s),P.push(T,s,G);1!==n&&b&&(P.push(u+2,G+2,s+2),P.push(T+2,s+2,G+2),P.push(u+4,G+4,s+4),P.push(T+4,s+4,G+4)),S=g?S+2:S+1}const y=u=>{const z=u?s/2:O/2;if(0===z)return;let m,x,g;const b=u?F[c-1]:F[0];let Q=null;r&&(Q=u?r[c-1]:r[0]);const Y=H.length/3,V=u?G/2:-G/2,j=new T.q(0,V,0);H.push(j.x,j.y,j.z),X.push(0,u?1:-1,0);const l=b.y+.5*(b.w-b.y);p.push(b.x+.5*(b.z-b.x),f.e?1-l:l),Q&&q.push(Q.r,Q.g,Q.b,Q.a);const d=new T.m(.5,.5);for(g=0;g<=C;g++){m=2*Math.PI*g*n/C;const G=Math.cos(-m),s=Math.sin(-m);x=new T.q(G*z,V,s*z);const O=new T.m(G*d.x+.5,s*d.y+.5);H.push(x.x,x.y,x.z),X.push(0,u?1:-1,0);const Y=b.y+(b.w-b.y)*O.y;p.push(b.x+(b.z-b.x)*O.x,f.e?1-Y:Y),Q&&q.push(Q.r,Q.g,Q.b,Q.a)}for(g=0;g<C;g++)u?(P.push(Y),P.push(Y+(g+2)),P.push(Y+(g+1))):(P.push(Y),P.push(Y+(g+1)),P.push(Y+(g+2)))};Y!==z.c.CAP_START&&Y!==z.c.CAP_ALL||y(!1),Y!==z.c.CAP_END&&Y!==z.c.CAP_ALL||y(!0),m.b._ComputeSides(V,H,P,X,p,u.frontUVs,u.backUVs);const a=new m.b;return a.indices=P,a.xa=H,a.ya=X,a.Aa=p,r&&(a.za=q),a}function P(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return l(G).Ca(T,G.updatable),T}function H(u){const G=[],s=[],z=[],O=[],C=u.diameter||1,x=u.thickness||.5,g=0|(u.Nk||16),b=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,Q=g+1;for(let m=0;m<=g;m++){const u=m/g,b=m*Math.PI*2/g-Math.PI/2,Y=T.d.Translation(C/2,0,0).multiply(T.d.RotationY(b));for(let C=0;C<=g;C++){const b=1-C/g,n=C*Math.PI*2/g+Math.PI,V=Math.cos(n),F=Math.sin(n);let r=new T.q(V,F,0),c=r.scale(x/2);const j=new T.m(u,b);c=T.q.TransformCoordinates(c,Y),r=T.q.TransformNormal(r,Y),s.push(c.x,c.y,c.z),z.push(r.x,r.y,r.z),O.push(j.x,f.e?1-j.y:j.y);const l=(m+1)%Q,P=(C+1)%Q;G.push(m*Q+C),G.push(m*Q+P),G.push(l*Q+C),G.push(m*Q+P),G.push(l*Q+P),G.push(l*Q+C)}}m.b._ComputeSides(b,s,G,z,O,u.frontUVs,u.backUVs);const Y=new m.b;return Y.indices=G,Y.xa=s,Y.ya=z,Y.Aa=O,Y}function X(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return H(G).Ca(T,G.updatable),T}m.b.CreateCylinder=l,z.c.CreateCylinder=(u,G,s,T,O,m,f,C,x)=>{void 0!==f&&f instanceof c.e||(void 0!==f&&(x=C||z.c.DEFAULTSIDE,C=f),f=m,m=1);return P(u,{height:G,diameterTop:s,diameterBottom:T,Nk:O,subdivisions:m,sideOrientation:x,updatable:C},f)};function p(u){const G=[],s=[],z=[],O=[],C=u.i||2,x=u.tube||.5,g=u.radialSegments||32,b=u.tubularSegments||32,Q=u.p||2,Y=u.q||3,n=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,V=u=>{const G=Math.cos(u),s=Math.sin(u),z=Y/Q*u,O=Math.cos(z),m=C*(2+O)*.5*G,f=C*(2+O)*s*.5,x=C*Math.sin(z)*.5;return new T.q(m,f,x)};let F,r;for(F=0;F<=g;F++){const u=F%g/g*2*Q*Math.PI,G=V(u),z=V(u+.01),m=z.Nc(G);let C=z.add(G);const Y=T.q.Cross(m,C);for(C=T.q.Cross(Y,m),Y.normalize(),C.normalize(),r=0;r<b;r++){const u=r%b/b*2*Math.PI,T=-x*Math.cos(u),z=x*Math.sin(u);s.push(G.x+T*C.x+z*Y.x),s.push(G.y+T*C.y+z*Y.y),s.push(G.z+T*C.z+z*Y.z),O.push(F/g),O.push(f.e?1-r/b:r/b)}}for(F=0;F<g;F++)for(r=0;r<b;r++){const u=(r+1)%b,s=F*b+r,T=(F+1)*b+r,z=(F+1)*b+u,O=F*b+u;G.push(O),G.push(T),G.push(s),G.push(O),G.push(z),G.push(T)}m.b.ComputeNormals(s,G,z),m.b._ComputeSides(n,s,G,z,O,u.frontUVs,u.backUVs);const c=new m.b;return c.indices=G,c.xa=s,c.ya=z,c.Aa=O,c}function q(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return p(G).Ca(T,G.updatable),T}m.b.CreateTorus=H,z.c.CreateTorus=(u,G,s,T,z,O,m)=>X(u,{diameter:G,thickness:s,Nk:T,sideOrientation:m,updatable:O},z);m.b.CreateTorusKnot=p,z.c.CreateTorusKnot=(u,G,s,T,z,O,m,f,C,x)=>q(u,{i:G,tube:s,radialSegments:T,tubularSegments:z,p:O,q:m,sideOrientation:x,updatable:C},f);var d=s(12299),v=s(10584),W=s(11382),M=s(10913),o=s(10619);class R extends T.m{constructor(u,G){super(u.x,u.y),this.index=G}}class B{constructor(){this.elements=[]}add(u){const G=[];return u.forEach((u=>{const s=new R(u,this.elements.length);G.push(s),this.elements.push(s)})),G}computeBounds(){const u=new T.m(this.elements[0].x,this.elements[0].y),G=new T.m(this.elements[0].x,this.elements[0].y);return this.elements.forEach((s=>{s.x<u.x?u.x=s.x:s.x>G.x&&(G.x=s.x),s.y<u.y?u.y=s.y:s.y>G.y&&(G.y=s.y)})),{min:u,max:G,width:G.x-u.x,height:G.y-u.y}}}class D{_addToepoint(u){for(const G of u)this._epoints.push(G.x,G.y)}constructor(u,G,s){let T,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new B,this._outlinepoints=new B,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=z,this._name=u,this._scene=s||o.d.LastCreatedScene,T=G instanceof W.g?G.getPoints():G,this._addToepoint(T),this._points.add(T),this._outlinepoints.add(T),"undefined"===typeof this.bjsEarcut&&v.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(u){this._points.add(u);const G=new B;return G.add(u),this._holes.push(G),this._eholes.push(this._epoints.length/2),this._addToepoint(u),this}build(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const T=new z.c(this._name,this._scene),m=this.buildVertexData(G,s);return T.Ga(O.f.PositionKind,m.xa,u),T.Ga(O.f.NormalKind,m.ya,u),T.Ga(O.f.UVKind,m.Aa,u),T.setIndices(m.indices),T}buildVertexData(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const s=new m.b,T=[],z=[],O=[],f=this._points.computeBounds();this._points.elements.forEach((u=>{T.push(0,1,0),z.push(u.x,0,u.y),O.push((u.x-f.min.x)/f.width,(u.y-f.min.y)/f.height)}));const C=[],x=this.bjsEarcut(this._epoints,this._eholes,2);for(let m=0;m<x.length;m++)C.push(x[m]);if(u>0){const s=z.length/3;this._points.elements.forEach((G=>{T.push(0,-1,0),z.push(G.x,-u,G.y),O.push(1-(G.x-f.min.x)/f.width,1-(G.y-f.min.y)/f.height)}));const m=C.length;for(let u=0;u<m;u+=3){const G=C[u+0],T=C[u+1],z=C[u+2];C.push(z+s),C.push(T+s),C.push(G+s)}this._addSide(z,T,O,C,f,this._outlinepoints,u,!1,G),this._holes.forEach((s=>{this._addSide(z,T,O,C,f,s,u,!0,G)}))}return s.indices=C,s.xa=z,s.ya=T,s.Aa=O,s}_addSide(u,G,s,z,O,m,f,C,x){let g=u.length/3,b=0;for(let Q=0;Q<m.elements.length;Q++){const Y=m.elements[Q],n=m.elements[(Q+1)%m.elements.length];u.push(Y.x,0,Y.y),u.push(Y.x,-f,Y.y),u.push(n.x,0,n.y),u.push(n.x,-f,n.y);const V=m.elements[(Q+m.elements.length-1)%m.elements.length],F=m.elements[(Q+2)%m.elements.length];let r=new T.q(-(n.y-Y.y),0,n.x-Y.x),c=new T.q(-(Y.y-V.y),0,Y.x-V.x),j=new T.q(-(F.y-n.y),0,F.x-n.x);C||(r=r.scale(-1),c=c.scale(-1),j=j.scale(-1));const l=r.normalizeToNew();let P=c.normalizeToNew(),H=j.normalizeToNew();const X=T.q.Dot(P,l);P=X>x?X<M.e-1?new T.q(Y.x,0,Y.y).Nc(new T.q(n.x,0,n.y)).normalize():c.add(r).normalize():l;const p=T.q.Dot(j,r);H=p>x?p<M.e-1?new T.q(n.x,0,n.y).Nc(new T.q(Y.x,0,Y.y)).normalize():j.add(r).normalize():l,s.push(b/O.width,0),s.push(b/O.width,1),b+=r.length(),s.push(b/O.width,0),s.push(b/O.width,1),G.push(P.x,P.y,P.z),G.push(P.x,P.y,P.z),G.push(H.x,H.y,H.z),G.push(H.x,H.y,H.z),C?(z.push(g),z.push(g+2),z.push(g+1),z.push(g+1),z.push(g+2),z.push(g+3)):(z.push(g),z.push(g+1),z.push(g+2),z.push(g+1),z.push(g+3),z.push(g+2)),g+=4}}}function k(u,G,s,z,C,x,g){const b=s||new Array(3),Y=z,n=[],V=g||!1;for(let O=0;O<3;O++)void 0===b[O]&&(b[O]=new T.s(0,0,1,1)),Y&&void 0===Y[O]&&(Y[O]=new Q.e(1,1,1,1));const F=u.getVerticesData(O.f.PositionKind),r=u.getVerticesData(O.f.NormalKind),c=u.getVerticesData(O.f.UVKind),j=u.kf(),l=F.length/9;let P=0,H=0,X=0,p=0,q=0;const d=[0];if(V)for(let T=l;T<F.length/3;T+=4)H=F[3*(T+2)]-F[3*T],X=F[3*(T+2)+2]-F[3*T+2],p=Math.sqrt(H*H+X*X),q+=p,d.push(q);let v=0,W=0;for(let T=0;T<r.length;T+=3)Math.abs(r[T+1])<.001&&(W=1),Math.abs(r[T+1]-1)<.001&&(W=0),Math.abs(r[T+1]+1)<.001&&(W=2),v=T/3,1===W?(P=v-l,c[2*v]=P%4<1.5?V?b[W].x+(b[W].z-b[W].x)*d[Math.floor(P/4)]/q:b[W].x:V?b[W].x+(b[W].z-b[W].x)*d[Math.floor(P/4)+1]/q:b[W].z,c[2*v+1]=P%2===0?f.e?1-b[W].w:b[W].w:f.e?1-b[W].y:b[W].y):(c[2*v]=(1-c[2*v])*b[W].x+c[2*v]*b[W].z,c[2*v+1]=(1-c[2*v+1])*b[W].y+c[2*v+1]*b[W].w,f.e&&(c[2*v+1]=1-c[2*v+1])),Y&&n.push(Y[W].r,Y[W].g,Y[W].b,Y[W].a);m.b._ComputeSides(G,F,j,r,c,C,x);const M=new m.b;if(M.indices=j,M.xa=F,M.ya=r,M.Aa=c,Y){const u=G===m.b.DOUBLESIDE?n.concat(n):n;M.za=u}return M}function w(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation);const m=G.shape,f=G.holes||[],C=G.depth||0,x=G.smoothingThreshold||2,g=[];let b=[];for(let z=0;z<m.length;z++)g[z]=new T.m(m[z].x,m[z].z);g[0].equalsWithEpsilon(g[g.length-1],1e-8)&&g.pop();const Q=new D(u,g,s||o.d.LastCreatedScene,O);for(let z=0;z<f.length;z++){b=[];for(let u=0;u<f[z].length;u++)b.push(new T.m(f[z][u].x,f[z][u].z));Q.addHole(b)}const Y=Q.build(!1,C,x);Y._originalBuilderSideOrientation=G.sideOrientation;return k(Y,G.sideOrientation,G.faceUV,G.faceColors,G.frontUVs,G.backUVs,G.wrap).Ca(Y,G.updatable),Y}function L(u,G){return w(u,G,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function S(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=G.path,O=G.shape,m=G.scale||1,f=G.rotation||0,C=0===G.cap?0:G.cap||z.c.NO_CAP,x=G.updatable,g=z.c._GetDefaultSideOrientation(G.sideOrientation),b=G.instance||null,Q=G.invertUV||!1,Y=G.closeShape||!1;return h(u,O,T,m,f,null,null,G.closePath||!1,Y,C,!1,s,!!x,g,b,Q,G.frontUVs||null,G.backUVs||null,G.firstNormal||null,!!G.adjustFrame)}function e(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=G.path,O=G.shape,m=G.scaleFunction||(()=>1),f=G.rotationFunction||(()=>0),C=G.closePath||G.ribbonCloseArray||!1,x=G.closeShape||G.ribbonClosePath||!1,g=0===G.cap?0:G.cap||z.c.NO_CAP,b=G.updatable,Q=G.firstNormal||null,Y=G.adjustFrame||!1;return h(u,O,T,null,null,m,f,C,x,g,!0,s,!!b,z.c._GetDefaultSideOrientation(G.sideOrientation),G.instance||null,G.invertUV||!1,G.frontUVs||null,G.backUVs||null,Q,Y)}function h(u,G,s,O,m,f,C,g,b,Q,Y,n,V,F,r,c,j,l,P,H){const X=(u,G,s,O,m,f,C,x,g,b,Q)=>{const Y=s.getTangents(),n=s.getNormals(),V=s.getBinormals(),F=s.getDistances();if(Q)for(let z=0;z<Y.length;z++)if(0==Y[z].x&&0==Y[z].y&&0==Y[z].z&&Y[z].p(Y[z-1]),0==n[z].x&&0==n[z].y&&0==n[z].z&&n[z].p(n[z-1]),0==V[z].x&&0==V[z].y&&0==V[z].z&&V[z].p(V[z-1]),z>0){let u=Y[z-1];T.q.Dot(u,Y[z])<0&&Y[z].scaleInPlace(-1),u=n[z-1],T.q.Dot(u,n[z])<0&&n[z].scaleInPlace(-1),u=V[z-1],T.q.Dot(u,V[z])<0&&V[z].scaleInPlace(-1)}let r=0;const c=b&&x?x:()=>null!==f?f:0,j=b&&C?C:()=>null!==m?m:1;let l=g===z.c.NO_CAP||g===z.c.CAP_END?0:2;const P=T.l.Matrix[0];for(let z=0;z<G.length;z++){const s=[],m=c(z,F[z]),f=j(z,F[z]);T.d.RotationAxisToRef(Y[z],r,P);for(let O=0;O<u.length;O++){const m=Y[z].scale(u[O].z).add(n[z].scale(u[O].x)).add(V[z].scale(u[O].y)),C=T.q.Zero();T.q.TransformCoordinatesToRef(m,P,C),C.scaleInPlace(f).addInPlace(G[z]),s[O]=C}O[l]=s,r+=m,l++}const H=u=>{const G=Array(),s=T.q.Zero();let z;for(z=0;z<u.length;z++)s.addInPlace(u[z]);for(s.scaleInPlace(1/u.length),z=0;z<u.length;z++)G.push(s);return G};switch(g){case z.c.NO_CAP:break;case z.c.CAP_START:O[0]=H(O[2]),O[1]=O[2];break;case z.c.CAP_END:O[l]=O[l-1],O[l+1]=H(O[l-1]);break;case z.c.CAP_ALL:O[0]=H(O[2]),O[1]=O[2],O[l]=O[l-1],O[l+1]=H(O[l-1])}return O};let p,q;if(r){const u=r._creationDataStorage;return p=P?u.path3D.update(s,P):u.path3D.update(s),q=X(G,s,u.path3D,u.pathArray,O,m,f,C,u.cap,Y,H),r=x("",{pathArray:q,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:r},n||void 0)}p=P?new W.h(s,P):new W.h(s);q=X(G,s,p,new Array,O,m,f,C,Q=Q<0||Q>3?0:Q,Y,H);const d=x(u,{pathArray:q,closeArray:g,closePath:b,updatable:V,sideOrientation:F,invertUV:c,frontUVs:j||void 0,backUVs:l||void 0},n);return d._creationDataStorage.pathArray=q,d._creationDataStorage.path3D=p,d._creationDataStorage.cap=Q,d}m.b.CreatePolygon=k,z.c.CreatePolygon=function(u,G,s,T,z,O){return w(u,{shape:G,holes:T,updatable:z,sideOrientation:O},s,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},z.c.ExtrudePolygon=function(u,G,s,T,z,O,m){return L(u,{shape:G,holes:z,depth:s,updatable:O,sideOrientation:m},T,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function I(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=G.arc?G.arc<=0||G.arc>1?1:G.arc:1,m=void 0===G.closed||G.closed,f=G.shape,C=G.i||1,g=G.Nk||64,b=G.clip||0,Q=G.updatable,Y=z.c._GetDefaultSideOrientation(G.sideOrientation),n=G.cap||z.c.NO_CAP,V=2*Math.PI,F=[],r=G.invertUV||!1;let c=0,j=0;const l=V/g*O;let P,H;for(c=0;c<=g-b;c++){for(H=[],n!=z.c.CAP_START&&n!=z.c.CAP_ALL||(H.push(new T.q(0,f[0].y,0)),H.push(new T.q(Math.cos(c*l)*f[0].x*C,f[0].y,Math.sin(c*l)*f[0].x*C))),j=0;j<f.length;j++)P=new T.q(Math.cos(c*l)*f[j].x*C,f[j].y,Math.sin(c*l)*f[j].x*C),H.push(P);n!=z.c.CAP_END&&n!=z.c.CAP_ALL||(H.push(new T.q(Math.cos(c*l)*f[f.length-1].x*C,f[f.length-1].y,Math.sin(c*l)*f[f.length-1].x*C)),H.push(new T.q(0,f[f.length-1].y,0))),F.push(H)}return x(u,{pathArray:F,closeArray:m,sideOrientation:Y,updatable:Q,invertUV:r,frontUVs:G.frontUVs,backUVs:G.backUVs},s)}z.c.ExtrudeShape=function(u,G,s,T,O,m){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;return S(u,{shape:G,path:s,scale:T,rotation:O,cap:0===m?0:m||z.c.NO_CAP,sideOrientation:x,instance:g,updatable:C},f)},z.c.ExtrudeShapeCustom=(u,G,s,T,O,m,f,C,x,g,b,Q)=>e(u,{shape:G,path:s,scaleFunction:T,rotationFunction:O,ribbonCloseArray:m,ribbonClosePath:f,cap:0===C?0:C||z.c.NO_CAP,sideOrientation:b,instance:Q,updatable:g},x);z.c.CreateLathe=(u,G,s,T,z,O,m)=>I(u,{shape:G,i:s,Nk:T,sideOrientation:m,updatable:O},z);var i=s(11267),J=s(11226);function A(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=G.path;let m=G.instance,f=1;void 0!==G.i?f=G.i:m&&(f=m._creationDataStorage.i);const C=G.Nk||64,g=G.radiusFunction||null;let b=G.cap||z.c.NO_CAP;const Q=G.invertUV||!1,Y=G.updatable,n=z.c._GetDefaultSideOrientation(G.sideOrientation);G.arc=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1;const V=(u,G,s,O,m,f,C,x)=>{const g=G.getTangents(),b=G.getNormals(),Q=G.getDistances(),Y=2*Math.PI/m*x,n=f||(()=>O);let V,F,r,c;const j=T.l.Matrix[0];let l=C===z.c.NO_CAP||C===z.c.CAP_END?0:2;for(let z=0;z<u.length;z++){F=n(z,Q[z]),V=Array(),r=b[z];for(let G=0;G<m;G++)T.d.RotationAxisToRef(g[z],Y*G,j),c=V[G]?V[G]:T.q.Zero(),T.q.TransformCoordinatesToRef(r,j,c),c.scaleInPlace(F).addInPlace(u[z]),V[G]=c;s[l]=V,l++}const P=(G,s)=>{const T=Array();for(let z=0;z<G;z++)T.push(u[s]);return T};switch(C){case z.c.NO_CAP:break;case z.c.CAP_START:s[0]=P(m,0),s[1]=s[2].slice(0);break;case z.c.CAP_END:s[l]=s[l-1].slice(0),s[l+1]=P(m,u.length-1);break;case z.c.CAP_ALL:s[0]=P(m,0),s[1]=s[2].slice(0),s[l]=s[l-1].slice(0),s[l+1]=P(m,u.length-1)}return s};let F,r;if(m){const u=m._creationDataStorage,s=G.arc||u.arc;return F=u.path3D.update(O),r=V(O,F,u.pathArray,f,u.Nk,g,u.cap,s),m=x("",{pathArray:r,instance:m}),u.path3D=F,u.pathArray=r,u.arc=s,u.i=f,m}F=new W.h(O);b=b<0||b>3?0:b,r=V(O,F,new Array,f,C,g,b,G.arc);const c=x(u,{pathArray:r,closePath:!0,closeArray:!1,updatable:Y,sideOrientation:n,invertUV:Q,frontUVs:G.frontUVs,backUVs:G.backUVs},s);return c._creationDataStorage.pathArray=r,c._creationDataStorage.path3D=F,c._creationDataStorage.Nk=C,c._creationDataStorage.cap=b,c._creationDataStorage.arc=G.arc,c._creationDataStorage.i=f,c}function N(u){const G=[];G[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},G[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},G[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},G[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},G[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},G[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},G[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},G[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},G[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},G[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},G[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},G[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},G[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},G[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},G[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const s=u.type&&(u.type<0||u.type>=G.length)?0:u.type||0,z=u.size,O=u.sizeX||z||1,C=u.sizeY||z||1,x=u.sizeZ||z||1,g=u.custom||G[s],b=g.face.length,Y=u.faceUV||new Array(b),n=u.faceColors,V=void 0===u.flat||u.flat,F=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,r=[],c=[],j=[],l=[],P=[];let H=0,X=0;const p=[];let q,d,v,W,M,o,R=0,B=0;if(V)for(B=0;B<b;B++)n&&void 0===n[B]&&(n[B]=new Q.e(1,1,1,1)),Y&&void 0===Y[B]&&(Y[B]=new T.s(0,0,1,1));if(V)for(B=0;B<b;B++){const u=g.face[B].length;for(v=2*Math.PI/u,W=.5*Math.tan(v/2),M=.5,R=0;R<u;R++)r.push(g.vertex[g.face[B][R]][0]*O,g.vertex[g.face[B][R]][1]*C,g.vertex[g.face[B][R]][2]*x),p.push(H),H++,q=Y[B].x+(Y[B].z-Y[B].x)*(.5+W),d=Y[B].y+(Y[B].w-Y[B].y)*(M-.5),l.push(q,f.e?1-d:d),o=W*Math.cos(v)-M*Math.sin(v),M=W*Math.sin(v)+M*Math.cos(v),W=o,n&&P.push(n[B].r,n[B].g,n[B].b,n[B].a);for(R=0;R<u-2;R++)c.push(p[0+X],p[R+2+X],p[R+1+X]);X+=u}else{for(R=0;R<g.vertex.length;R++)r.push(g.vertex[R][0]*O,g.vertex[R][1]*C,g.vertex[R][2]*x),l.push(0,f.e?1:0);for(B=0;B<b;B++)for(R=0;R<g.face[B].length-2;R++)c.push(g.face[B][0],g.face[B][R+2],g.face[B][R+1])}m.b.ComputeNormals(r,c,j),m.b._ComputeSides(F,r,c,j,l,u.frontUVs,u.backUVs);const D=new m.b;return D.xa=r,D.indices=c,D.ya=j,D.Aa=l,n&&V&&(D.za=P),D}function y(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return N(G).Ca(T,G.updatable),T}z.c.CreateTube=(u,G,s,T,z,O,m,f,C,x)=>A(u,{path:G,i:s,Nk:T,radiusFunction:z,arc:1,cap:O,updatable:f,sideOrientation:C,instance:x},m);function a(u){const G=u.sideOrientation||m.b.DEFAULTSIDE,s=u.i||1,z=void 0===u.flat||u.flat,O=0|(u.subdivisions||4),C=u.radiusX||s,x=u.radiusY||s,g=u.radiusZ||s,b=(1+Math.sqrt(5))/2,Q=[-1,b,-0,1,b,0,-1,-b,0,1,-b,0,0,-1,-b,0,1,-b,0,-1,b,0,1,b,b,0,1,b,0,-1,-b,0,1,-b,0,-1],Y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],n=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],V=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],F=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],r=[],c=[],j=[],l=[];let P=0;const H=new Array(3),X=new Array(3);let p;for(p=0;p<3;p++)H[p]=T.q.Zero(),X[p]=T.m.Zero();for(let m=0;m<20;m++){for(p=0;p<3;p++){const u=Y[3*m+p];H[p].hf(Q[3*n[u]],Q[3*n[u]+1],Q[3*n[u]+2]),H[p].normalize(),X[p].hf(.134765625*V[2*u]+.05859375+-.0390625*F[m],.2333984375*V[2*u+1]+.025390625+.01953125*F[m])}const u=(u,G,s,m)=>{const b=T.q.Lerp(H[0],H[2],G/O),Q=T.q.Lerp(H[1],H[2],G/O),Y=O===G?H[2]:T.q.Lerp(b,Q,u/(O-G));let n;if(Y.normalize(),z){const u=T.q.Lerp(H[0],H[2],m/O),G=T.q.Lerp(H[1],H[2],m/O);n=T.q.Lerp(u,G,s/(O-m))}else n=new T.q(Y.x,Y.y,Y.z);n.x/=C,n.y/=x,n.z/=g,n.normalize();const V=T.m.Lerp(X[0],X[2],G/O),F=T.m.Lerp(X[1],X[2],G/O),p=O===G?X[2]:T.m.Lerp(V,F,u/(O-G));c.push(Y.x*C,Y.y*x,Y.z*g),j.push(n.x,n.y,n.z),l.push(p.x,f.e?1-p.y:p.y),r.push(P),P++};for(let G=0;G<O;G++)for(let s=0;s+G<O;s++)u(s,G,s+1/3,G+1/3),u(s+1,G,s+1/3,G+1/3),u(s,G+1,s+1/3,G+1/3),s+G+1<O&&(u(s+1,G,s+2/3,G+2/3),u(s+1,G+1,s+2/3,G+2/3),u(s,G+1,s+2/3,G+2/3))}m.b._ComputeSides(G,c,r,j,l,u.frontUVs,u.backUVs);const q=new m.b;return q.indices=r,q.xa=c,q.ya=j,q.Aa=l,q}function K(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new z.c(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),T._originalBuilderSideOrientation=G.sideOrientation;return a(G).Ca(T,G.updatable),T}m.b.CreatePolyhedron=N,z.c.CreatePolyhedron=(u,G,s)=>y(u,G,s);m.b.CreateIcoSphere=a,z.c.CreateIcoSphere=(u,G,s)=>K(u,G,s);var Z=s(10924);const t=new T.q(1,0,0),E=new T.q(-1,0,0),U=new T.q(0,1,0),uu=new T.q(0,-1,0),Gu=new T.q(0,0,1),su=new T.q(0,0,-1);class Tu{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.q.Zero(),G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.q.Up(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.m.Zero(),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=u,this.ab=G,this.uv=s,this.vertexIdx=z,this.vertexIdxForBones=O,this.localPositionOverride=m,this.localNormalOverride=f,this.matrixIndicesOverride=C,this.matrixWeightsOverride=x}clone(){var u,G,s,T;return new Tu(this.position.clone(),this.ab.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(u=this.localPositionOverride)||void 0===u?void 0:u.slice(),null===(G=this.localNormalOverride)||void 0===G?void 0:G.slice(),null===(s=this.matrixIndicesOverride)||void 0===s?void 0:s.slice(),null===(T=this.matrixWeightsOverride)||void 0===T?void 0:T.slice())}}function zu(u,G,s){var C,x,g,b;const Q=!!G.skeleton,Y=s.localMode||Q,n=G.kf(),V=Q?G.xe(!0,!0):G.getVerticesData(O.f.PositionKind),F=Q?G.getNormalsData(!0,!0):G.getVerticesData(O.f.NormalKind),r=Y?Q?G.getVerticesData(O.f.PositionKind):V:null,c=Y?Q?G.getVerticesData(O.f.NormalKind):F:null,j=G.getVerticesData(O.f.UVKind),l=Q?G.getVerticesData(O.f.MatricesIndicesKind):null,P=Q?G.getVerticesData(O.f.MatricesWeightsKind):null,H=Q?G.getVerticesData(O.f.MatricesIndicesExtraKind):null,X=Q?G.getVerticesData(O.f.MatricesWeightsExtraKind):null,p=s.position||T.q.Zero();let q=s.ab||T.q.Up();const d=s.size||T.q.One(),v=s.angle||0;if(!q){const u=new T.q(0,0,1),s=G.va().activeCamera,z=T.q.TransformCoordinates(u,s.getWorldMatrix());q=s.globalPosition.Nc(z)}const W=-Math.atan2(q.z,q.x)-Math.PI/2,M=Math.sqrt(q.x*q.x+q.z*q.z),o=Math.atan2(q.y,M),R=new m.b;R.indices=[],R.xa=[],R.ya=[],R.Aa=[],R.matricesIndices=Q?[]:null,R.matricesWeights=Q?[]:null,R.matricesIndicesExtra=H?[]:null,R.matricesWeightsExtra=X?[]:null;let B=0;const D=(u,G)=>{const z=new Tu;if(!n||!V||!F)return z;const O=n[u];if(z.vertexIdx=3*O,z.vertexIdxForBones=4*O,z.position=new T.q(V[3*O],V[3*O+1],V[3*O+2]),T.q.TransformCoordinatesToRef(z.position,G,z.position),z.ab=new T.q(F[3*O],F[3*O+1],F[3*O+2]),T.q.TransformNormalToRef(z.ab,G,z.ab),s.captureUVS&&j){const u=j[2*O+1];z.uv=new T.m(j[2*O],f.e?1-u:u)}return z},k=[0,0,0,0],w=(u,G)=>{if(0===u.length)return u;const s=.5*Math.abs(T.q.Dot(d,G)),z=(u,G,s,T)=>{for(let z=0;z<T;++z)if(u[s+z]===G)return s+z;return-1},O=(u,O)=>{const m=T.q.GetClipFactor(u.position,O.position,G,s);let f=k,C=k;if(l&&P){const G=u.matrixIndicesOverride?0:u.vertexIdxForBones,s=u.matrixIndicesOverride??l,T=u.matrixWeightsOverride??P,x=O.matrixIndicesOverride?0:O.vertexIdxForBones,g=O.matrixIndicesOverride??l,b=O.matrixWeightsOverride??P;f=[0,0,0,0],C=[0,0,0,0];let Q=0;for(let u=0;u<4;++u)if(T[G+u]>0){const O=z(g,s[G+u],x,4);f[Q]=s[G+u],C[Q]=(0,Z.m)(T[G+u],O>=0?b[O]:0,m),Q++}for(let u=0;u<4&&Q<4;++u){const T=g[x+u];-1===z(s,T,G,4)&&(f[Q]=T,C[Q]=(0,Z.m)(0,b[x+u],m),Q++)}const Y=C[0]+C[1]+C[2]+C[3];C[0]/=Y,C[1]/=Y,C[2]/=Y,C[3]/=Y}const x=u.localPositionOverride?u.localPositionOverride[0]:(null===r||void 0===r?void 0:r[u.vertexIdx])??0,g=u.localPositionOverride?u.localPositionOverride[1]:(null===r||void 0===r?void 0:r[u.vertexIdx+1])??0,b=u.localPositionOverride?u.localPositionOverride[2]:(null===r||void 0===r?void 0:r[u.vertexIdx+2])??0,Q=O.localPositionOverride?O.localPositionOverride[0]:(null===r||void 0===r?void 0:r[O.vertexIdx])??0,Y=O.localPositionOverride?O.localPositionOverride[1]:(null===r||void 0===r?void 0:r[O.vertexIdx+1])??0,n=O.localPositionOverride?O.localPositionOverride[2]:(null===r||void 0===r?void 0:r[O.vertexIdx+2])??0,V=u.localNormalOverride?u.localNormalOverride[0]:(null===c||void 0===c?void 0:c[u.vertexIdx])??0,F=u.localNormalOverride?u.localNormalOverride[1]:(null===c||void 0===c?void 0:c[u.vertexIdx+1])??0,j=u.localNormalOverride?u.localNormalOverride[2]:(null===c||void 0===c?void 0:c[u.vertexIdx+2])??0,H=V+((O.localNormalOverride?O.localNormalOverride[0]:(null===c||void 0===c?void 0:c[O.vertexIdx])??0)-V)*m,X=F+((O.localNormalOverride?O.localNormalOverride[1]:(null===c||void 0===c?void 0:c[O.vertexIdx+1])??0)-F)*m,p=j+((O.localNormalOverride?O.localNormalOverride[2]:(null===c||void 0===c?void 0:c[O.vertexIdx+2])??0)-j)*m,q=Math.sqrt(H*H+X*X+p*p);return new Tu(T.q.Lerp(u.position,O.position,m),T.q.Lerp(u.ab,O.ab,m).normalize(),T.m.Lerp(u.uv,O.uv,m),-1,-1,r?[x+(Q-x)*m,g+(Y-g)*m,b+(n-b)*m]:null,c?[H/q,X/q,p/q]:null,f,C)};let m=null;u.length>3&&(m=[]);for(let f=0;f<u.length;f+=3){let z=0,C=null,x=null,g=null,b=null;const Q=T.q.Dot(u[f].position,G)-s>0,Y=T.q.Dot(u[f+1].position,G)-s>0,n=T.q.Dot(u[f+2].position,G)-s>0;switch(z=(Q?1:0)+(Y?1:0)+(n?1:0),z){case 0:u.length>3?(m.push(u[f]),m.push(u[f+1]),m.push(u[f+2])):m=u;break;case 1:if(m=m??new Array,Q&&(C=u[f+1],x=u[f+2],g=O(u[f],C),b=O(u[f],x)),Y){C=u[f],x=u[f+2],g=O(u[f+1],C),b=O(u[f+1],x),m.push(g),m.push(x.clone()),m.push(C.clone()),m.push(x.clone()),m.push(g.clone()),m.push(b);break}n&&(C=u[f],x=u[f+1],g=O(u[f+2],C),b=O(u[f+2],x)),C&&x&&g&&b&&(m.push(C.clone()),m.push(x.clone()),m.push(g),m.push(b),m.push(g.clone()),m.push(x.clone()));break;case 2:m=m??new Array,Q||(C=u[f].clone(),x=O(C,u[f+1]),g=O(C,u[f+2]),m.push(C),m.push(x),m.push(g)),Y||(C=u[f+1].clone(),x=O(C,u[f+2]),g=O(C,u[f]),m.push(C),m.push(x),m.push(g)),n||(C=u[f+2].clone(),x=O(C,u[f]),g=O(C,u[f+1]),m.push(C),m.push(x),m.push(g))}}return m},L=G instanceof z.c?G:null,S=null===L||void 0===L?void 0:L._thinInstanceDataStorage.matrixData,e=(null===L||void 0===L?void 0:L.Ej)||1,h=T.l.Matrix[0];h.p(T.d.IdentityReadOnly);for(let z=0;z<e;++z){if(null!==L&&void 0!==L&&L.hasThinInstances&&S){const u=16*z;h.setRowFromFloats(0,S[u+0],S[u+1],S[u+2],S[u+3]),h.setRowFromFloats(1,S[u+4],S[u+5],S[u+6],S[u+7]),h.setRowFromFloats(2,S[u+8],S[u+9],S[u+10],S[u+11]),h.setRowFromFloats(3,S[u+12],S[u+13],S[u+14],S[u+15])}const u=T.d.RotationYawPitchRoll(W,o,v).multiply(T.d.Translation(p.x,p.y,p.z)),O=T.d.Invert(u),m=G.getWorldMatrix(),C=h.multiply(m).multiply(O),x=new Array(3);for(let G=0;G<n.length;G+=3){let u=x;if(u[0]=D(G,C),u[1]=D(G+1,C),u[2]=D(G+2,C),!(s.cullBackFaces&&-u[0].ab.z<=0&&-u[1].ab.z<=0&&-u[2].ab.z<=0)&&(u=w(u,t),u&&(u=w(u,E),u&&(u=w(u,U),u&&(u=w(u,uu),u&&(u=w(u,Gu),u&&(u=w(u,su),u)))))))for(let G=0;G<u.length;G++){const T=u[G];if(R.indices.push(B),Y?(T.localPositionOverride?(R.xa[3*B]=T.localPositionOverride[0],R.xa[3*B+1]=T.localPositionOverride[1],R.xa[3*B+2]=T.localPositionOverride[2]):r&&(R.xa[3*B]=r[T.vertexIdx],R.xa[3*B+1]=r[T.vertexIdx+1],R.xa[3*B+2]=r[T.vertexIdx+2]),T.localNormalOverride?(R.ya[3*B]=T.localNormalOverride[0],R.ya[3*B+1]=T.localNormalOverride[1],R.ya[3*B+2]=T.localNormalOverride[2]):c&&(R.ya[3*B]=c[T.vertexIdx],R.ya[3*B+1]=c[T.vertexIdx+1],R.ya[3*B+2]=c[T.vertexIdx+2])):(T.position.toArray(R.xa,3*B),T.ab.toArray(R.ya,3*B)),R.matricesIndices&&R.matricesWeights&&(T.matrixIndicesOverride?(R.matricesIndices[4*B]=T.matrixIndicesOverride[0],R.matricesIndices[4*B+1]=T.matrixIndicesOverride[1],R.matricesIndices[4*B+2]=T.matrixIndicesOverride[2],R.matricesIndices[4*B+3]=T.matrixIndicesOverride[3]):(l&&(R.matricesIndices[4*B]=l[T.vertexIdxForBones],R.matricesIndices[4*B+1]=l[T.vertexIdxForBones+1],R.matricesIndices[4*B+2]=l[T.vertexIdxForBones+2],R.matricesIndices[4*B+3]=l[T.vertexIdxForBones+3]),H&&R.matricesIndicesExtra&&(R.matricesIndicesExtra[4*B]=H[T.vertexIdxForBones],R.matricesIndicesExtra[4*B+1]=H[T.vertexIdxForBones+1],R.matricesIndicesExtra[4*B+2]=H[T.vertexIdxForBones+2],R.matricesIndicesExtra[4*B+3]=H[T.vertexIdxForBones+3])),T.matrixWeightsOverride?(R.matricesWeights[4*B]=T.matrixWeightsOverride[0],R.matricesWeights[4*B+1]=T.matrixWeightsOverride[1],R.matricesWeights[4*B+2]=T.matrixWeightsOverride[2],R.matricesWeights[4*B+3]=T.matrixWeightsOverride[3]):(P&&(R.matricesWeights[4*B]=P[T.vertexIdxForBones],R.matricesWeights[4*B+1]=P[T.vertexIdxForBones+1],R.matricesWeights[4*B+2]=P[T.vertexIdxForBones+2],R.matricesWeights[4*B+3]=P[T.vertexIdxForBones+3]),X&&R.matricesWeightsExtra&&(R.matricesWeightsExtra[4*B]=X[T.vertexIdxForBones],R.matricesWeightsExtra[4*B+1]=X[T.vertexIdxForBones+1],R.matricesWeightsExtra[4*B+2]=X[T.vertexIdxForBones+2],R.matricesWeightsExtra[4*B+3]=X[T.vertexIdxForBones+3]))),s.captureUVS)T.uv.toArray(R.Aa,2*B);else{R.Aa.push(.5+T.position.x/d.x);const u=.5+T.position.y/d.y;R.Aa.push(f.e?1-u:u)}B++}}}0===R.indices.length&&(R.indices=null),0===R.xa.length&&(R.xa=null),0===R.ya.length&&(R.ya=null),0===R.Aa.length&&(R.Aa=null),0===(null===(C=R.matricesIndices)||void 0===C?void 0:C.length)&&(R.matricesIndices=null),0===(null===(x=R.matricesWeights)||void 0===x?void 0:x.length)&&(R.matricesWeights=null),0===(null===(g=R.matricesIndicesExtra)||void 0===g?void 0:g.length)&&(R.matricesIndicesExtra=null),0===(null===(b=R.matricesWeightsExtra)||void 0===b?void 0:b.length)&&(R.matricesWeightsExtra=null);const I=new z.c(u,G.va());return R.Ca(I),Y?(I.skeleton=G.skeleton,I.parent=G):(I.position=p.clone(),I.rotation=new T.q(o,W,v)),I.Gj(!0),I.refreshBoundingInfo(!0,!0),I}function Ou(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Nk:16,height:1,i:.25,capSubdivisions:6};const G=0|Math.max(u.subdivisions?u.subdivisions:2,1),s=0|Math.max(u.Nk?u.Nk:16,3),z=Math.max(u.height?u.height:1,0),O=Math.max(u.i?u.i:.25,0),C=0|Math.max(u.capSubdivisions?u.capSubdivisions:6,1),x=s,g=G,b=Math.max(u.radiusTop?u.radiusTop:O,0),Q=Math.max(u.radiusBottom?u.radiusBottom:O,0),Y=z-(b+Q),n=2*Math.PI,V=Math.max(u.topCapSubdivisions?u.topCapSubdivisions:C,1),F=Math.max(u.bottomCapSubdivisions?u.bottomCapSubdivisions:C,1),r=Math.acos((Q-b)/z);let c=[];const j=[],l=[],P=[];let H=0;const X=[],p=.5*Y,q=.5*Math.PI;let d,v;const W=T.q.Zero(),M=T.q.Zero(),o=Math.cos(r),R=Math.sin(r),B=new T.m(b*R,p+b*o).Nc(new T.m(Q*R,Q*o-p)).length(),D=b*r+B+Q*(q-r);let k=0;for(v=0;v<=V;v++){const u=[],G=q-r*(v/V);k+=b*r/V;const s=Math.cos(G),T=Math.sin(G),z=s*b;for(d=0;d<=x;d++){const G=d/x,O=G*n+0,m=Math.sin(O),C=Math.cos(O);M.x=z*m,M.y=p+T*b,M.z=z*C,j.push(M.x,M.y,M.z),W.set(s*m,T,s*C),l.push(W.x,W.y,W.z),P.push(G,f.e?k/D:1-k/D),u.push(H),H++}X.push(u)}const w=z-b-Q+o*b-o*Q,L=R*(Q-b)/w;for(v=1;v<=g;v++){const u=[];k+=B/g;const G=R*(v*(Q-b)/g+b);for(d=0;d<=x;d++){const s=d/x,T=s*n+0,z=Math.sin(T),O=Math.cos(T);M.x=G*z,M.y=p+o*b-v*w/g,M.z=G*O,j.push(M.x,M.y,M.z),W.set(z,L,O).normalize(),l.push(W.x,W.y,W.z),P.push(s,f.e?k/D:1-k/D),u.push(H),H++}X.push(u)}for(v=1;v<=F;v++){const u=[],G=q-r-(Math.PI-r)*(v/F);k+=Q*r/F;const s=Math.cos(G),T=Math.sin(G),z=s*Q;for(d=0;d<=x;d++){const G=d/x,O=G*n+0,m=Math.sin(O),C=Math.cos(O);M.x=z*m,M.y=T*Q-p,M.z=z*C,j.push(M.x,M.y,M.z),W.set(s*m,T,s*C),l.push(W.x,W.y,W.z),P.push(G,f.e?k/D:1-k/D),u.push(H),H++}X.push(u)}for(d=0;d<x;d++)for(v=0;v<V+g+F;v++){const u=X[v][d],G=X[v+1][d],s=X[v+1][d+1],T=X[v][d+1];c.push(u),c.push(G),c.push(T),c.push(G),c.push(s),c.push(T)}if(c=c.reverse(),u.orientation&&!u.orientation.equals(T.q.Up())){const G=new T.d;u.orientation.clone().scale(.5*Math.PI).cross(T.q.Up()).toQuaternion().toRotationMatrix(G);const s=T.q.Zero();for(let u=0;u<j.length;u+=3)s.set(j[u],j[u+1],j[u+2]),T.q.TransformCoordinatesToRef(s.clone(),G,s),j[u]=s.x,j[u+1]=s.y,j[u+2]=s.z}const S=new m.b;return S.xa=j,S.ya=l,S.Aa=P,S.indices=c,S}function mu(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:T.q.Up(),subdivisions:2,Nk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new z.c(u,s);return Ou(G).Ca(O,G.updatable),O}z.c.CreateDecal=(u,G,s,T,z,O)=>zu(u,G,{position:s,ab:T,size:z,angle:O});z.c.CreateCapsule=(u,G,s)=>mu(u,G,s),m.b.CreateCapsule=Ou;class fu{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=u,this.y=G,u!==Math.floor(u)&&(u=Math.floor(u),v.d.Warn("x is not an integer, floor(x) used")),G!==Math.floor(G)&&(G=Math.floor(G),v.d.Warn("y is not an integer, floor(y) used"))}clone(){return new fu(this.x,this.y)}rotate60About(u){const G=this.x;return this.x=u.x+u.y-this.y,this.y=G+this.y-u.x,this}rotateNeg60About(u){const G=this.x;return this.x=G+this.y-u.y,this.y=u.x+u.y-G,this}rotate120(u,G){u!==Math.floor(u)&&(u=Math.floor(u),v.d.Warn("m not an integer only floor(m) used")),G!==Math.floor(G)&&(G=Math.floor(G),v.d.Warn("n not an integer only floor(n) used"));const s=this.x;return this.x=u-s-this.y,this.y=G+s,this}rotateNeg120(u,G){u!==Math.floor(u)&&(u=Math.floor(u),v.d.Warn("m is not an integer, floor(m) used")),G!==Math.floor(G)&&(G=Math.floor(G),v.d.Warn("n is not an integer,   floor(n) used"));const s=this.x;return this.x=this.y-G,this.y=u+G-s-this.y,this}toCartesianOrigin(u,G){const s=T.q.Zero();return s.x=u.x+2*this.x*G+this.y*G,s.y=u.y+Math.sqrt(3)*this.y*G,s}static Zero(){return new fu(0,0)}}class Cu{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new xu("icosahedron","Regular",[[0,M.h,-1],[-M.h,1,0],[-1,0,-M.h],[1,0,-M.h],[M.h,1,0],[0,M.h,1],[-1,0,M.h],[-M.h,-1,0],[0,-M.h,-1],[M.h,-1,0],[1,0,M.h],[0,-M.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let u=12;const G={},s=this.m,T=this.n;let z,O,m,f,C,x=s,g=1,b=0;0!==T&&(x=(0,Z.j)(s,T)),g=s/x,b=T/x;const Q=fu.Zero(),Y=new fu(s,T),n=new fu(-T,s+T),V=fu.Zero(),F=fu.Zero(),r=fu.Zero();let c,j,l,P,H=[];const X=[],p=this.vertByDist,q=(s,T,z,O)=>{c=s+"|"+z,j=T+"|"+O,c in G||j in G?c in G&&!(j in G)?G[j]=G[c]:j in G&&!(c in G)&&(G[c]=G[j]):(G[c]=u,G[j]=u,u++),p[z][0]>2?X[G[c]]=[-p[z][0],p[z][1],G[c]]:X[G[c]]=[H[p[z][0]],p[z][1],G[c]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let d=0;d<20;d++){if(H=this.IDATA.face[d],m=H[2],f=H[1],C=H[0],l=Q.x+"|"+Q.y,c=d+"|"+l,c in G||(G[c]=m,X[m]=[H[p[l][0]],p[l][1]]),l=Y.x+"|"+Y.y,c=d+"|"+l,c in G||(G[c]=f,X[f]=[H[p[l][0]],p[l][1]]),l=n.x+"|"+n.y,c=d+"|"+l,c in G||(G[c]=C,X[C]=[H[p[l][0]],p[l][1]]),z=this.IDATA.edgematch[d][0],O=this.IDATA.edgematch[d][1],"B"===O)for(let u=1;u<x;u++)F.x=s-u*(g+b),F.y=T+u*g,r.x=-u*b,r.y=u*(g+b),l=F.x+"|"+F.y,P=r.x+"|"+r.y,q(d,z,l,P);if("O"===O)for(let u=1;u<x;u++)r.x=-u*b,r.y=u*(g+b),V.x=u*g,V.y=u*b,l=r.x+"|"+r.y,P=V.x+"|"+V.y,q(d,z,l,P);if(z=this.IDATA.edgematch[d][2],O=this.IDATA.edgematch[d][3],O&&"A"===O)for(let u=1;u<x;u++)V.x=u*g,V.y=u*b,F.x=s-(x-u)*(g+b),F.y=T+(x-u)*g,l=V.x+"|"+V.y,P=F.x+"|"+F.y,q(d,z,l,P);for(let s=0;s<this.vertices.length;s++)l=this.vertices[s].x+"|"+this.vertices[s].y,c=d+"|"+l,c in G||(G[c]=u++,p[l][0]>2?X[G[c]]=[-p[l][0],p[l][1],G[c]]:X[G[c]]=[H[p[l][0]],p[l][1],G[c]])}this.closestTo=X,this.vecToidx=G}calcCoeffs(){const u=this.m,G=this.n,s=Math.sqrt(3)/3,T=u*u+G*G+u*G;this.coau=(u+G)/T,this.cobu=-G/T,this.coav=-s*(u-G)/T,this.cobv=s*(2*u+G)/T}createInnerFacets(){const u=this.m,G=this.n;for(let s=0;s<G+u+1;s++)for(let u=this.min[s];u<this.max[s]+1;u++)u<this.max[s]&&u<this.max[s+1]+1&&this.innerFacets.push(["|"+u+"|"+s,"|"+u+"|"+(s+1),"|"+(u+1)+"|"+s]),s>0&&u<this.max[s-1]&&u+1<this.max[s]+1&&this.innerFacets.push(["|"+u+"|"+s,"|"+(u+1)+"|"+s,"|"+(u+1)+"|"+(s-1)])}edgeVecsABOB(){const u=this.m,G=this.n,s=new fu(-G,u+G);for(let T=1;T<u+G;T++){const u=new fu(this.min[T],T),G=new fu(this.min[T-1],T-1),z=new fu(this.min[T+1],T+1),O=u.clone(),m=G.clone(),f=z.clone();O.rotate60About(s),m.rotate60About(s),f.rotate60About(s);const C=new fu(this.max[O.y],O.y),x=new fu(this.max[O.y-1],O.y-1),g=new fu(this.max[O.y-1]-1,O.y-1);O.x===C.x&&O.y===C.y||(O.x!==x.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,x,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,g,C])):O.y===f.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,G,x]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([u,x,z])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([u,G,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([u,x,C])))}}mapABOBtoOBOA(){const u=new fu(0,0);for(let G=0;G<this.isoVecsABOB.length;G++){const s=[];for(let T=0;T<3;T++)u.x=this.isoVecsABOB[G][T].x,u.y=this.isoVecsABOB[G][T].y,0===this.vertexTypes[G][T]&&u.rotateNeg120(this.m,this.n),s.push(u.clone());this.isoVecsOBOA.push(s)}}mapABOBtoBAOA(){const u=new fu(0,0);for(let G=0;G<this.isoVecsABOB.length;G++){const s=[];for(let T=0;T<3;T++)u.x=this.isoVecsABOB[G][T].x,u.y=this.isoVecsABOB[G][T].y,1===this.vertexTypes[G][T]&&u.rotate120(this.m,this.n),s.push(u.clone());this.isoVecsBAOA.push(s)}}MapToFace(u,G){const s=this.IDATA.face[u],z=s[2],O=s[1],m=s[0],f=T.q.Ag(this.IDATA.vertex[z]),C=T.q.Ag(this.IDATA.vertex[O]),x=T.q.Ag(this.IDATA.vertex[m]),g=C.Nc(f),b=x.Nc(f),Q=g.scale(this.coau).add(b.scale(this.cobu)),Y=g.scale(this.coav).add(b.scale(this.cobv)),n=[];let V,F=T.l.gb[0];for(let T=0;T<this.cartesian.length;T++)F=Q.scale(this.cartesian[T].x).add(Y.scale(this.cartesian[T].y)).add(f),n[T]=[F.x,F.y,F.z],V=u+"|"+this.vertices[T].x+"|"+this.vertices[T].y,G.vertex[this.vecToidx[V]]=[F.x,F.y,F.z]}build(u,G){const s=[],T=fu.Zero(),z=new fu(u,G),O=new fu(-G,u+G);s.push(T,z,O);for(let l=G;l<u+1;l++)for(let G=0;G<u+1-l;G++)s.push(new fu(G,l));if(G>0){const T=(0,Z.j)(u,G),z=u/T,O=G/T;for(let f=1;f<T;f++)s.push(new fu(f*z,f*O)),s.push(new fu(-f*O,f*(z+O))),s.push(new fu(u-f*(z+O),G+f*z));const m=u/G;for(let f=1;f<G;f++)for(let T=0;T<f*m;T++)s.push(new fu(T,f)),s.push(new fu(T,f).rotate120(u,G)),s.push(new fu(T,f).rotateNeg120(u,G))}s.sort(((u,G)=>u.x-G.x)),s.sort(((u,G)=>u.y-G.y));const m=new Array(u+G+1),f=new Array(u+G+1);for(let l=0;l<m.length;l++)m[l]=1/0,f[l]=-1/0;let C=0,x=0;const g=s.length;for(let l=0;l<g;l++)x=s[l].x,C=s[l].y,m[C]=Math.min(x,m[C]),f[C]=Math.max(x,f[C]);const b=(s,T)=>{const z=s.clone();return"A"===T&&z.rotateNeg120(u,G),"B"===T&&z.rotate120(u,G),z.x<0?z.y:z.x+z.y},Q=[],Y=[],n=[],V=[],F={},r=[];let c=-1,j=-1;for(let l=0;l<g;l++)Q[l]=s[l].toCartesianOrigin(new fu(0,0),.5),Y[l]=b(s[l],"O"),n[l]=b(s[l],"A"),V[l]=b(s[l],"B"),Y[l]===n[l]&&n[l]===V[l]?(c=3,j=Y[l]):Y[l]===n[l]?(c=4,j=Y[l]):n[l]===V[l]?(c=5,j=n[l]):V[l]===Y[l]&&(c=6,j=Y[l]),Y[l]<n[l]&&Y[l]<V[l]&&(c=2,j=Y[l]),n[l]<Y[l]&&n[l]<V[l]&&(c=1,j=n[l]),V[l]<n[l]&&V[l]<Y[l]&&(c=0,j=V[l]),r.push([c,j,s[l].x,s[l].y]);r.sort(((u,G)=>u[2]-G[2])),r.sort(((u,G)=>u[3]-G[3])),r.sort(((u,G)=>u[1]-G[1])),r.sort(((u,G)=>u[0]-G[0]));for(let l=0;l<r.length;l++)F[r[l][2]+"|"+r[l][3]]=[r[l][0],r[l][1],l];return this.m=u,this.n=G,this.vertices=s,this.vertByDist=F,this.cartesian=Q,this.min=m,this.max=f,this}}class xu{constructor(u,G,s,T){this.name=u,this.category=G,this.vertex=s,this.face=T}}class gu extends xu{innerToData(u,G){for(let s=0;s<G.innerFacets.length;s++)this.face.push(G.innerFacets[s].map((s=>G.vecToidx[u+s])))}mapABOBtoDATA(u,G){const s=G.IDATA.edgematch[u][0];for(let T=0;T<G.isoVecsABOB.length;T++){const z=[];for(let O=0;O<3;O++)0===G.vertexTypes[T][O]?z.push(u+"|"+G.isoVecsABOB[T][O].x+"|"+G.isoVecsABOB[T][O].y):z.push(s+"|"+G.isoVecsABOB[T][O].x+"|"+G.isoVecsABOB[T][O].y);this.face.push([G.vecToidx[z[0]],G.vecToidx[z[1]],G.vecToidx[z[2]]])}}mapOBOAtoDATA(u,G){const s=G.IDATA.edgematch[u][0];for(let T=0;T<G.isoVecsOBOA.length;T++){const z=[];for(let O=0;O<3;O++)1===G.vertexTypes[T][O]?z.push(u+"|"+G.isoVecsOBOA[T][O].x+"|"+G.isoVecsOBOA[T][O].y):z.push(s+"|"+G.isoVecsOBOA[T][O].x+"|"+G.isoVecsOBOA[T][O].y);this.face.push([G.vecToidx[z[0]],G.vecToidx[z[1]],G.vecToidx[z[2]]])}}mapBAOAtoDATA(u,G){const s=G.IDATA.edgematch[u][2];for(let T=0;T<G.isoVecsBAOA.length;T++){const z=[];for(let O=0;O<3;O++)1===G.vertexTypes[T][O]?z.push(u+"|"+G.isoVecsBAOA[T][O].x+"|"+G.isoVecsBAOA[T][O].y):z.push(s+"|"+G.isoVecsBAOA[T][O].x+"|"+G.isoVecsBAOA[T][O].y);this.face.push([G.vecToidx[z[0]],G.vecToidx[z[1]],G.vecToidx[z[2]]])}}orderData(u){const G=[];for(let O=0;O<13;O++)G[O]=[];const s=u.closestTo;for(let O=0;O<s.length;O++)s[O][0]>-1?s[O][1]>0&&G[s[O][0]].push([O,s[O][1]]):G[12].push([O,s[O][0]]);const T=[];for(let O=0;O<12;O++)T[O]=O;let z=12;for(let O=0;O<12;O++){G[O].sort(((u,G)=>u[1]-G[1]));for(let u=0;u<G[O].length;u++)T[G[O][u][0]]=z++}for(let O=0;O<G[12].length;O++)T[G[12][O][0]]=z++;for(let O=0;O<this.vertex.length;O++)this.vertex[O].push(T[O]);this.vertex.sort(((u,G)=>u[3]-G[3]));for(let O=0;O<this.vertex.length;O++)this.vertex[O].pop();for(let O=0;O<this.face.length;O++)for(let u=0;u<this.face[O].length;u++)this.face[O][u]=T[this.face[O][u]];this.sharedNodes=G[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(u,G){const s=[],T=[];let z=G.pop();T.push(z);let O=this.face[z].indexOf(u);O=(O+2)%3;let m=this.face[z][O];s.push(m);let f=0;for(;G.length>0;)z=G[f],this.face[z].indexOf(m)>-1?(O=(this.face[z].indexOf(m)+1)%3,m=this.face[z][O],s.push(m),T.push(z),G.splice(f,1),f=0):f++;return this.adjacentFaces.push(s),T}toGoldbergPolyhedronData(){const u=new xu("GeoDual","Goldberg",[],[]);u.name="GD dual";const G=this.vertex.length,s=new Array(G);for(let C=0;C<G;C++)s[C]=[];for(let C=0;C<this.face.length;C++)for(let u=0;u<3;u++)s[this.face[C][u]].push(C);let T=0,z=0,O=0,m=[],f=[];this.adjacentFaces=[];for(let C=0;C<s.length;C++)u.face[C]=this.setOrder(C,s[C].concat([])),s[C].forEach((G=>{T=0,z=0,O=0,m=this.face[G];for(let u=0;u<3;u++)f=this.vertex[m[u]],T+=f[0],z+=f[1],O+=f[2];u.vertex[G]=[T/3,z/3,O/3]}));return u}static BuildGeodesicData(u){const G=new gu("Geodesic-m-n","Geodesic",[[0,M.h,-1],[-M.h,1,0],[-1,0,-M.h],[1,0,-M.h],[M.h,1,0],[0,M.h,1],[-1,0,M.h],[-M.h,-1,0],[0,-M.h,-1],[M.h,-1,0],[1,0,M.h],[0,-M.h,1]],[]);u.setIndices(),u.calcCoeffs(),u.createInnerFacets(),u.edgeVecsABOB(),u.mapABOBtoOBOA(),u.mapABOBtoBAOA();for(let s=0;s<u.IDATA.face.length;s++)u.MapToFace(s,G),G.innerToData(s,u),"B"===u.IDATA.edgematch[s][1]&&G.mapABOBtoDATA(s,u),"O"===u.IDATA.edgematch[s][1]&&G.mapOBOAtoDATA(s,u),"A"===u.IDATA.edgematch[s][3]&&G.mapBAOAtoDATA(s,u);G.orderData(u);return G.vertex=G.vertex.map((function(u){const G=u[0],s=u[1],T=u[2],z=Math.sqrt(G*G+s*s+T*T);return u[0]*=1/z,u[1]*=1/z,u[2]*=1/z,u})),G}}z.c._GoldbergMeshParser=(u,G)=>bu.Parse(u,G);class bu extends z.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(u,G){return void 0===G?(u>this.goldbergData.nbUnsharedFaces-1&&(v.d.Warn("Maximum number of unshared faces used"),u=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+u):(u>11&&(v.d.Warn("Last pole used"),u=11),G>this.goldbergData.nbFacesAtPole-1&&(v.d.Warn("Maximum number of faces at a pole used"),G=this.goldbergData.nbFacesAtPole-1),12+u*this.goldbergData.nbFacesAtPole+G)}_changeGoldbergFaceColors(u){for(let s=0;s<u.length;s++){const G=u[s][0],T=u[s][1],z=u[s][2];for(let u=G;u<T+1;u++)this.goldbergData.faceColors[u]=z}const G=[];for(let s=0;s<12;s++)for(let u=0;u<5;u++)G.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);for(let s=12;s<this.goldbergData.faceColors.length;s++)for(let u=0;u<6;u++)G.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);return G}setGoldbergFaceColors(u){const G=this._changeGoldbergFaceColors(u);this.Ga(O.f.ColorKind,G)}updateGoldbergFaceColors(u){const G=this._changeGoldbergFaceColors(u);this.updateVerticesData(O.f.ColorKind,G)}_changeGoldbergFaceUVs(u){const G=this.getVerticesData(O.f.UVKind);for(let s=0;s<u.length;s++){const T=u[s][0],z=u[s][1],O=u[s][2],m=u[s][3],f=u[s][4],C=[],x=[];let g,b;for(let u=0;u<5;u++)g=O.x+m*Math.cos(f+u*Math.PI/2.5),b=O.y+m*Math.sin(f+u*Math.PI/2.5),g<0&&(g=0),g>1&&(g=1),C.push(g,b);for(let u=0;u<6;u++)g=O.x+m*Math.cos(f+u*Math.PI/3),b=O.y+m*Math.sin(f+u*Math.PI/3),g<0&&(g=0),g>1&&(g=1),x.push(g,b);for(let u=T;u<Math.min(12,z+1);u++)for(let s=0;s<5;s++)G[10*u+2*s]=C[2*s],G[10*u+2*s+1]=C[2*s+1];for(let u=Math.max(12,T);u<z+1;u++)for(let s=0;s<6;s++)G[12*u-24+2*s]=x[2*s],G[12*u-23+2*s]=x[2*s+1]}return G}setGoldbergFaceUVs(u){const G=this._changeGoldbergFaceUVs(u);this.Ga(O.f.UVKind,G)}updateGoldbergFaceUVs(u){const G=this._changeGoldbergFaceUVs(u);this.updateVerticesData(O.f.UVKind,G)}placeOnGoldbergFaceAt(u,G,s){const z=T.q.RotationFromAxis(this.goldbergData.faceXaxis[G],this.goldbergData.faceYaxis[G],this.goldbergData.faceZaxis[G]);u.rotation=z,u.position=this.goldbergData.faceCenters[G].add(this.goldbergData.faceXaxis[G].scale(s.x)).add(this.goldbergData.faceYaxis[G].scale(s.y)).add(this.goldbergData.faceZaxis[G].scale(s.z))}serialize(u){super.serialize(u),u.type="GoldbergMesh";const G={};if(G.adjacentFaces=this.goldbergData.adjacentFaces,G.nbSharedFaces=this.goldbergData.nbSharedFaces,G.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,G.nbFaces=this.goldbergData.nbFaces,G.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){G.faceColors=[];for(const u of this.goldbergData.faceColors)G.faceColors.push(u.$i())}if(this.goldbergData.faceCenters){G.faceCenters=[];for(const u of this.goldbergData.faceCenters)G.faceCenters.push(u.$i())}if(this.goldbergData.faceZaxis){G.faceZaxis=[];for(const u of this.goldbergData.faceZaxis)G.faceZaxis.push(u.$i())}if(this.goldbergData.faceYaxis){G.faceYaxis=[];for(const u of this.goldbergData.faceYaxis)G.faceYaxis.push(u.$i())}if(this.goldbergData.faceXaxis){G.faceXaxis=[];for(const u of this.goldbergData.faceXaxis)G.faceXaxis.push(u.$i())}u.goldbergData=G}static Parse(u,G){const s=u.goldbergData;s.faceColors=s.faceColors.map((u=>Q.e.Ag(u))),s.faceCenters=s.faceCenters.map((u=>T.q.Ag(u))),s.faceZaxis=s.faceZaxis.map((u=>T.q.Ag(u))),s.faceXaxis=s.faceXaxis.map((u=>T.q.Ag(u))),s.faceYaxis=s.faceYaxis.map((u=>T.q.Ag(u)));const z=new bu(u.name,G);return z.goldbergData=s,z}}var Qu=s(11193);class Yu{constructor(u){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=u}moveTo(u,G){this._currentPath=new W.g(u,G),this._tempPaths.push(this._currentPath)}lineTo(u,G){this._currentPath.addLineTo(u,G)}quadraticCurveTo(u,G,s,T){this._currentPath.addQuadraticCurveTo(u,G,s,T,this._resolution)}bezierCurveTo(u,G,s,T,z,O){this._currentPath.addBezierCurveTo(u,G,s,T,z,O,this._resolution)}extractHoles(){for(const u of this._tempPaths)u.area()>0?this._holes.push(u):this._paths.push(u);if(!this._paths.length&&this._holes.length){const u=this._holes;this._holes=this._paths,this._paths=u}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function nu(u,G,s,T,z,O){const m=O.glyphs[u]||O.glyphs["?"];if(!m)return null;const f=new Yu(z);if(m.o){const u=m.o.split(" ");for(let z=0,O=u.length;z<O;){switch(u[z++]){case"m":{const O=parseInt(u[z++])*G+s,m=parseInt(u[z++])*G+T;f.moveTo(O,m);break}case"l":{const O=parseInt(u[z++])*G+s,m=parseInt(u[z++])*G+T;f.lineTo(O,m);break}case"q":{const O=parseInt(u[z++])*G+s,m=parseInt(u[z++])*G+T,C=parseInt(u[z++])*G+s,x=parseInt(u[z++])*G+T;f.quadraticCurveTo(C,x,O,m);break}case"b":{const O=parseInt(u[z++])*G+s,m=parseInt(u[z++])*G+T,C=parseInt(u[z++])*G+s,x=parseInt(u[z++])*G+T,g=parseInt(u[z++])*G+s,b=parseInt(u[z++])*G+T;f.bezierCurveTo(C,x,g,b,O,m);break}}}}return f.extractHoles(),{offsetX:m.ha*G,shapePath:f}}const Vu={CreateBox:b.e,CreateTiledBox:F,CreateSphere:r.c,pb:g.d,CreateIcoSphere:K,CreateRibbon:x,CreateCylinder:P,CreateTorus:X,CreateTorusKnot:q,CreateLineSystem:d.g,qb:d.h,CreateDashedLines:d.c,ExtrudeShape:S,ExtrudeShapeCustom:e,CreateLathe:I,CreateTiledPlane:n,Bf:i.d,CreateGround:J.e,CreateTiledGround:J.h,CreateGroundFromHeightMap:J.d,CreatePolygon:w,ExtrudePolygon:L,CreateTube:A,CreatePolyhedron:y,CreateGeodesic:function(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=G.m||1;T!==Math.floor(T)&&(T=Math.floor(T),v.d.Warn("m not an integer only floor(m) used"));let z=G.n||0;if(z!==Math.floor(z)&&(z=Math.floor(z),v.d.Warn("n not an integer only floor(n) used")),z>T){const u=z;z=T,T=u,v.d.Warn("n > m therefore m and n swapped")}const O=new Cu;return O.build(T,z),y(u,{custom:gu.BuildGeodesicData(O),size:G.size,sizeX:G.sizeX,sizeY:G.sizeY,sizeZ:G.sizeZ,faceUV:G.faceUV,faceColors:G.faceColors,flat:G.flat,updatable:G.updatable,sideOrientation:G.sideOrientation,frontUVs:G.frontUVs,backUVs:G.backUVs},s)},CreateGoldberg:function(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=G.size,C=G.sizeX||O||1,x=G.sizeY||O||1,g=G.sizeZ||O||1;let b=G.m||1;b!==Math.floor(b)&&(b=Math.floor(b),v.d.Warn("m not an integer only floor(m) used"));let Y=G.n||0;if(Y!==Math.floor(Y)&&(Y=Math.floor(Y),v.d.Warn("n not an integer only floor(n) used")),Y>b){const u=Y;Y=b,b=u,v.d.Warn("n > m therefore m and n swapped")}const n=new Cu;n.build(b,Y);const V=gu.BuildGeodesicData(n),F=V.toGoldbergPolyhedronData(),r=new bu(u,s);G.sideOrientation=z.c._GetDefaultSideOrientation(G.sideOrientation),r._originalBuilderSideOrientation=G.sideOrientation;(function(u,G){const s=u.size,z=u.sizeX||s||1,O=u.sizeY||s||1,C=u.sizeZ||s||1,x=0===u.sideOrientation?0:u.sideOrientation||m.b.DEFAULTSIDE,g=[],b=[],Q=[],Y=[];let n=1/0,V=-1/0,F=1/0,r=-1/0;for(let T=0;T<G.vertex.length;T++)n=Math.min(n,G.vertex[T][0]*z),V=Math.max(V,G.vertex[T][0]*z),F=Math.min(F,G.vertex[T][1]*O),r=Math.max(r,G.vertex[T][1]*O);let c=0;for(let m=0;m<G.face.length;m++){const u=G.face[m],s=T.q.Ag(G.vertex[u[0]]),x=T.q.Ag(G.vertex[u[2]]),j=T.q.Ag(G.vertex[u[1]]),l=x.Nc(s),P=j.Nc(s),H=T.q.Cross(P,l).normalize();for(let T=0;T<u.length;T++){Q.push(H.x,H.y,H.z);const s=G.vertex[u[T]];g.push(s[0]*z,s[1]*O,s[2]*C);const m=(s[1]*O-F)/(r-F);Y.push((s[0]*z-n)/(V-n),f.e?1-m:m)}for(let G=0;G<u.length-2;G++)b.push(c,c+G+2,c+G+1);c+=u.length}m.b._ComputeSides(x,g,b,Q,Y);const j=new m.b;return j.xa=g,j.indices=b,j.ya=Q,j.Aa=Y,j})(G,F).Ca(r,G.updatable),r.goldbergData.nbSharedFaces=V.sharedNodes,r.goldbergData.nbUnsharedFaces=V.poleNodes,r.goldbergData.adjacentFaces=V.adjacentFaces,r.goldbergData.nbFaces=r.goldbergData.nbSharedFaces+r.goldbergData.nbUnsharedFaces,r.goldbergData.nbFacesAtPole=(r.goldbergData.nbUnsharedFaces-12)/12;for(let z=0;z<V.vertex.length;z++)r.goldbergData.faceCenters.push(T.q.Ag(V.vertex[z])),r.goldbergData.faceCenters[z].x*=C,r.goldbergData.faceCenters[z].y*=x,r.goldbergData.faceCenters[z].z*=g,r.goldbergData.faceColors.push(new Q.e(1,1,1,1));for(let z=0;z<F.face.length;z++){const u=F.face[z],G=T.q.Ag(F.vertex[u[0]]),s=T.q.Ag(F.vertex[u[2]]),O=T.q.Ag(F.vertex[u[1]]),m=s.Nc(G),f=O.Nc(G),C=T.q.Cross(f,m).normalize(),x=T.q.Cross(f,C).normalize();r.goldbergData.faceXaxis.push(f.normalize()),r.goldbergData.faceYaxis.push(C),r.goldbergData.faceZaxis.push(x)}return r},CreateDecal:zu,CreateCapsule:mu,CreateText:function(u,G,s){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const C=function(u,G,s,T){const z=Array.from(u),O=G/T.resolution,m=(T.boundingBox.yMax-T.boundingBox.yMin+T.underlineThickness)*O,f=[];let C=0,x=0;for(let g=0;g<z.length;g++){const u=z[g];if("\n"===u)C=0,x-=m;else{const G=nu(u,O,C,x,s,T);G&&(C+=G.offsetX,f.push(G.shapePath))}}return f}(G,O.size||50,O.resolution||8,s),x=[];let g=0;for(const n of C){if(!n.paths.length)continue;const G=n.holes.slice();for(const s of n.paths){var b,Q;const C=[],Y=[],n=s.getPoints();for(const u of n)Y.push(new T.q(u.x,0,u.y));const V=G.slice();for(const u of V){const z=u.getPoints();let O=!1;for(const u of z)if(s.isPointInside(u)){O=!0;break}if(!O)continue;const m=[];for(const u of z)m.push(new T.q(u.x,0,u.y));C.push(m),G.splice(G.indexOf(u),1)}if(!C.length&&G.length)for(const u of G){const G=u.getPoints(),s=[];for(const u of G)s.push(new T.q(u.x,0,u.y));C.push(s)}const F=L(u,{shape:Y,holes:C.length?C:void 0,depth:O.depth||1,faceUV:O.faceUV||(null===(b=O.perLetterFaceUV)||void 0===b?void 0:b.call(O,g)),faceColors:O.faceColors||(null===(Q=O.perLetterFaceColors)||void 0===Q?void 0:Q.call(O,g)),sideOrientation:z.c._GetDefaultSideOrientation(O.sideOrientation||z.c.DOUBLESIDE)},m,f);x.push(F),g++}}const Y=z.c.MergeMeshes(x,!0,!0);if(Y){const G=Y.getBoundingInfo().boundingBox;Y.position.x+=-(G.minimumWorld.x+G.maximumWorld.x)/2,Y.position.y+=-(G.minimumWorld.y+G.maximumWorld.y)/2,Y.position.z+=-(G.minimumWorld.z+G.maximumWorld.z)/2+G.extendSize.z,Y.name=u;const s=new Qu.d("pivot",m);s.rotation.x=-Math.PI/2,Y.parent=s,Y.bakeCurrentTransformIntoVertices(),Y.parent=null,s.dispose()}return Y}}},11050:(u,G,s)=>{"use strict";s.d(G,{d:()=>C});var T=s(10961),z=s(11055),O=s(11059),m=s(11078),f=s(11083);class C{get materialDefines(){var u;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(u=this._getDrawWrapper())||void 0===u?void 0:u.defines}set materialDefines(u){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=u}_getDrawWrapper(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u=u??this._engine.currentRenderPassId;let s=this._drawWrappers[u];return!s&&G&&(this._drawWrappers[u]=s=new f.d(this.Ok.va().getEngine())),s}_removeDrawWrapper(u){var G;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(G=this._drawWrappers[u])||void 0===G||G.dispose());this._drawWrappers[u]=void 0}get effect(){var u;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(u=this._getDrawWrapper())||void 0===u?void 0:u.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(u){this._mainDrawWrapperOverride=u}setEffect(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this._drawWrapper;z.setEffect(u,G,T),void 0!==s&&(z.materialContext=s),u||(z.defines=null,z.materialContext=void 0)}resetDrawCache(u){if(this._drawWrappers){if(void 0!==u)return void this._removeDrawWrapper(u);for(const u of this._drawWrappers)null===u||void 0===u||u.dispose()}this._drawWrappers=[]}static AddToMesh(u,G,s,T,z,O,m){return new C(u,G,s,T,z,O,m,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(u,G,s,T,z,O,m){let f=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],C=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=u,this.verticesStart=G,this.verticesCount=s,this.indexStart=T,this.indexCount=z,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this.Ok=O,this._renderingMesh=m||O,C&&O.xf.push(this),this._engine=this.Ok.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=O.xf.length-1,f&&(this.refreshBoundingInfo(),O.Gj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this.Ok.getTotalVertices()&&0===this.indexStart&&this.indexCount===this.Ok.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this.Ok.hasThinInstances?this.Ok.getBoundingInfo():this._boundingInfo}setBoundingInfo(u){return this._boundingInfo=u,this}getMesh(){return this.Ok}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this.Ok._internalAbstractMeshDataInfo._actAsRegularMesh?this.Ok:null}getEffectiveMesh(){const u=this.Ok._internalAbstractMeshDataInfo._actAsRegularMesh?this.Ok:null;return u||this._renderingMesh}Ha(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const G=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!G)return u?this.Ok.va().defaultMaterial:null;if(this._isMultiMaterial(G)){const u=G.getSubMaterial(this.materialIndex);return this._currentMaterial!==u&&(this._currentMaterial=u,this.resetDrawCache()),u}return G}_isMultiMaterial(u){return void 0!==u.getSubMaterial}refreshBoundingInfo(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.sj)return this;if(u||(u=this._renderingMesh.getVerticesData(T.f.PositionKind)),!u)return this._boundingInfo=this.Ok.getBoundingInfo(),this;const G=this._renderingMesh.kf();let s;if(0===this.indexStart&&this.indexCount===G.length){const u=this._renderingMesh.getBoundingInfo();s={minimum:u.minimum.clone(),maximum:u.maximum.clone()}}else s=(0,m.e)(u,G,this.indexStart,this.indexCount,this._renderingMesh.sj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new O.c(s.minimum,s.maximum),this}_checkCollision(u){return this.getBoundingInfo()._checkCollision(u)}updateBoundingInfo(u){let G=this.getBoundingInfo();return G||(this.refreshBoundingInfo(),G=this.getBoundingInfo()),G&&G.update(u),this}isInFrustum(u){const G=this.getBoundingInfo();return!!G&&G.isInFrustum(u,this.Ok.si)}isCompletelyInFrustum(u){const G=this.getBoundingInfo();return!!G&&G.isCompletelyInFrustum(u)}render(u){return this._renderingMesh.render(this,u,this.Ok._internalAbstractMeshDataInfo._actAsRegularMesh?this.Ok:void 0),this}_getLinesIndexBuffer(u,G){if(!this._linesIndexBuffer){const s=[];for(let G=this.indexStart;G<this.indexStart+this.indexCount;G+=3)s.push(u[G],u[G+1],u[G+1],u[G+2],u[G+2],u[G]);this._linesIndexBuffer=G.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer}canIntersects(u){const G=this.getBoundingInfo();return!!G&&u.intersectsBox(G.boundingBox)}intersects(u,G,s,T,z){const O=this.Ha();if(!O)return null;let m=3,f=!1;switch(O.fillMode){case 3:case 5:case 6:case 8:return null;case 7:m=1,f=!0}return 4===O.fillMode?s.length?this._intersectLines(u,G,s,this.Ok.intersectionThreshold,T):this._intersectUnIndexedLines(u,G,s,this.Ok.intersectionThreshold,T):!s.length&&this.Ok._unIndexed?this._intersectUnIndexedTriangles(u,G,s,T,z):this._intersectTriangles(u,G,s,m,f,T,z)}_intersectLines(u,G,s,T,O){let m=null;for(let f=this.indexStart;f<this.indexStart+this.indexCount;f+=2){const C=G[s[f]],x=G[s[f+1]],g=u.intersectionSegment(C,x,T);if(!(g<0)&&((O||!m||g<m.distance)&&(m=new z.b(null,null,g),m.faceId=f/2,O)))break}return m}_intersectUnIndexedLines(u,G,s,T,O){let m=null;for(let f=this.verticesStart;f<this.verticesStart+this.verticesCount;f+=2){const s=G[f],C=G[f+1],x=u.intersectionSegment(s,C,T);if(!(x<0)&&((O||!m||x<m.distance)&&(m=new z.b(null,null,x),m.faceId=f/2,O)))break}return m}_intersectTriangles(u,G,s,T,z,O,m){let f=null,C=-1;for(let x=this.indexStart;x<this.indexStart+this.indexCount-(3-T);x+=T){C++;const T=s[x],g=s[x+1],b=s[x+2];if(z&&4294967295===b){x+=2;continue}const Q=G[T],Y=G[g],n=G[b];if(!Q||!Y||!n)continue;if(m&&!m(Q,Y,n,u,T,g,b))continue;const V=u.intersectsTriangle(Q,Y,n);if(V){if(V.distance<0)continue;if((O||!f||V.distance<f.distance)&&(f=V,f.faceId=C,O))break}}return f}_intersectUnIndexedTriangles(u,G,s,T,z){let O=null;for(let m=this.verticesStart;m<this.verticesStart+this.verticesCount;m+=3){const s=G[m],f=G[m+1],C=G[m+2];if(z&&!z(s,f,C,u,-1,-1,-1))continue;const x=u.intersectsTriangle(s,f,C);if(x){if(x.distance<0)continue;if((T||!O||x.distance<O.distance)&&(O=x,O.faceId=m/3,T))break}}return O}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(u,G){const s=new C(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,u,G,!1);if(!this.IsGlobal){const u=this.getBoundingInfo();if(!u)return s;s._boundingInfo=new O.c(u.minimum,u.maximum)}return s}dispose(){this._linesIndexBuffer&&(this.Ok.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this.Ok.xf.indexOf(this);this.Ok.xf.splice(u,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(u,G,s,T,z){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=Number.MAX_VALUE,f=-Number.MAX_VALUE;const x=(z||T).kf();for(let C=G;C<G+s;C++){const u=x[C];u<m&&(m=u),u>f&&(f=u)}return new C(u,m,f-m+1,G,s,T,z,O)}}},11917:(u,G,s)=>{"use strict";var T=s(11148),z=s(10961),O=s(10904),m=s(10584),f=s(11059);T.c.prototype.thinInstanceAdd=function(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return m.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(u)?u.length:1);const s=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(u))for(let T=0;T<u.length;++T)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,u[T],T===u.length-1&&G);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,u,G);return s},T.c.prototype.thinInstanceAddSelf=function(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(O.d.IdentityReadOnly,u)},T.c.prototype.thinInstanceRegisterAttribute=function(u,G){u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),this.removeVerticesData(u),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[u]=G,this._userThinInstanceBuffersStorage.sizes[u]=G*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[u]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[u]),this._userThinInstanceBuffersStorage.vertexBuffers[u]=new z.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[u],u,!0,!1,G,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])},T.c.prototype.thinInstanceSetMatrixAt=function(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||u>=this._thinInstanceDataStorage.instancesCount)return!1;const T=this._thinInstanceDataStorage.matrixData;return G.copyToArray(T,16*u),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[u]=G),s&&(this.Jj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},T.c.prototype.thinInstanceSetAttributeAt=function(u,G,s){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[u]||G>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(u,0),this._userThinInstanceBuffersStorage.data[u].set(s,G*this._userThinInstanceBuffersStorage.strides[u]),T&&this.Jj(u),!0)},Object.defineProperty(T.c.prototype,"Ej",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(u){var G;const s=this._thinInstanceDataStorage.matrixData??(null===(G=this.source)||void 0===G?void 0:G._thinInstanceDataStorage.matrixData);u<=(s?s.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=u)},enumerable:!0,configurable:!0}),T.c.prototype._thinInstanceCreateMatrixBuffer=function(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=new z.b(this.getEngine(),G,!s,16,!1,!0);for(let z=0;z<4;z++)this.setVerticesBuffer(T.createVertexBuffer(u+z,4*z,4));return T},T.c.prototype.Kj=function(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var O;if(s=s||16,"matrix"===u)null===(O=this._thinInstanceDataStorage.matrixBuffer)||void 0===O||O.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=G?G.length:32*s,this._thinInstanceDataStorage.matrixData=G,this._thinInstanceDataStorage.worldMatrices=null,null!==G?(this._thinInstanceDataStorage.instancesCount=G.length/s,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",G,T),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===u){var m;null===(m=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=G,null!==G&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",G,T))}else{var f;if(u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),null===G)null!==(f=this._userThinInstanceBuffersStorage)&&void 0!==f&&f.data[u]&&(this.removeVerticesData(u),delete this._userThinInstanceBuffersStorage.data[u],delete this._userThinInstanceBuffersStorage.strides[u],delete this._userThinInstanceBuffersStorage.sizes[u],delete this._userThinInstanceBuffersStorage.vertexBuffers[u]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[u]=G,this._userThinInstanceBuffersStorage.strides[u]=s,this._userThinInstanceBuffersStorage.sizes[u]=G.length,this._userThinInstanceBuffersStorage.vertexBuffers[u]=new z.f(this.getEngine(),G,u,!T,!1,s,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},T.c.prototype.Jj=function(u){var G;if("matrix"===u)this.Dj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(u),null===(G=this._thinInstanceDataStorage.matrixBuffer)||void 0===G||G.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===u){var s;this.Dj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(u),null===(s=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===s||s.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var T;u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),null!==(T=this._userThinInstanceBuffersStorage)&&void 0!==T&&T.vertexBuffers[u]&&(this.Dj&&!this._userThinInstanceBuffersStorage.vertexBuffers[u].isUpdatable()&&this._thinInstanceRecreateBuffer(u),this._userThinInstanceBuffersStorage.vertexBuffers[u].updateDirectly(this._userThinInstanceBuffersStorage.data[u],0))}},T.c.prototype.thinInstancePartialBufferUpdate=function(u,G,s){var T;"matrix"===u?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(G,s):(u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),null!==(T=this._userThinInstanceBuffersStorage)&&void 0!==T&&T.vertexBuffers[u]&&this._userThinInstanceBuffersStorage.vertexBuffers[u].updateDirectly(G,s))},T.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const u=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let G=0;G<this._thinInstanceDataStorage.instancesCount;++G)this._thinInstanceDataStorage.worldMatrices[G]=O.d.Ag(u,16*G)}return this._thinInstanceDataStorage.worldMatrices},T.c.prototype.thinInstanceRefreshBoundingInfo=function(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const T=this._thinInstanceDataStorage.boundingVectors;if(u||!this.rawBoundingInfo){T.length=0,this.refreshBoundingInfo(G,s);const u=this.getBoundingInfo();this.rawBoundingInfo=new f.c(u.minimum,u.maximum)}const z=this.getBoundingInfo(),m=this._thinInstanceDataStorage.matrixData;if(0===T.length)for(let O=0;O<z.boundingBox.vectors.length;++O)T.push(z.boundingBox.vectors[O].clone());O.l.gb[0].vj(Number.POSITIVE_INFINITY),O.l.gb[1].vj(Number.NEGATIVE_INFINITY);for(let f=0;f<this._thinInstanceDataStorage.instancesCount;++f){O.d.FromArrayToRef(m,16*f,O.l.Matrix[0]);for(let u=0;u<T.length;++u)O.q.TransformCoordinatesToRef(T[u],O.l.Matrix[0],O.l.gb[2]),O.l.gb[0].minimizeInPlace(O.l.gb[2]),O.l.gb[1].maximizeInPlace(O.l.gb[2])}z.reConstruct(O.l.gb[0],O.l.gb[1]),this.Ea()},T.c.prototype._thinInstanceRecreateBuffer=function(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var s;if("matrix"===u)null===(s=this._thinInstanceDataStorage.matrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,G);else if("previousMatrix"===u){var T;if(this._scene.needsPreviousWorldMatrices)null===(T=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===T||T.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,G)}else{var O;u===z.f.ColorKind&&(u=z.f.ColorInstanceKind),null===(O=this._userThinInstanceBuffersStorage.vertexBuffers[u])||void 0===O||O.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[u]=new z.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[u],u,!G,!1,this._userThinInstanceBuffersStorage.strides[u],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},T.c.prototype._thinInstanceUpdateBufferSize=function(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u===z.f.ColorKind&&(u=z.f.ColorInstanceKind);const s="matrix"===u;if(!s&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[u]))return;const T=s?16:this._userThinInstanceBuffersStorage.strides[u],O=s?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[u];let m=s?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[u];const f=(this._thinInstanceDataStorage.instancesCount+G)*T;let C=O;for(;C<f;)C*=2;if(!m||O!=C){if(m){const u=new Float32Array(C);u.set(m,0),m=u}else m=new Float32Array(C);var x,g,b;if(s){if(null===(x=this._thinInstanceDataStorage.matrixBuffer)||void 0===x||x.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",m,!1),this._thinInstanceDataStorage.matrixData=m,this._thinInstanceDataStorage.matrixBufferSize=C,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(g=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===g||g.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",m,!1)}else null===(b=this._userThinInstanceBuffersStorage.vertexBuffers[u])||void 0===b||b.dispose(),this._userThinInstanceBuffersStorage.data[u]=m,this._userThinInstanceBuffersStorage.sizes[u]=C,this._userThinInstanceBuffersStorage.vertexBuffers[u]=new z.f(this.getEngine(),m,u,!0,!1,T,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[u])}},T.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},T.c.prototype._disposeThinInstanceSpecificData=function(){var u;null!==(u=this._thinInstanceDataStorage)&&void 0!==u&&u.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11193:(u,G,s)=>{"use strict";s.d(G,{d:()=>b});var T=s(10863),z=s(10866),O=s(10935),m=s(10568),f=s(10904),C=s(11161),x=s(10715);const g=f.d.Compose(f.q.One(),f.h.FromEulerAngles(0,Math.PI,0),f.q.Zero());class b extends C.b{get billboardMode(){return this._billboardMode}set billboardMode(u){this._billboardMode!==u&&(this._billboardMode=u,this._cache.useBillboardPosition=0!==(this._billboardMode&b.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(u){u!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=u,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==b.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(u){this._infiniteDistance!==u&&(this._infiniteDistance=u)}constructor(u){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new f.q(0,0,1),this._up=new f.q(0,1,0),this._right=new f.q(1,0,0),this._position=f.q.Zero(),this._rotation=f.q.Zero(),this._rotationQuaternion=null,this._scaling=f.q.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=b.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Ij=f.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=f.q.Zero(),this._absoluteScaling=f.q.Zero(),this._absoluteRotationQuaternion=f.h.Identity(),this._pivotMatrix=f.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new m.e,this._nonUniformScaling=!1,G&&this.va().addTransformNode(this)}getClassName(){return"sb"}get position(){return this._position}set position(u){this._position=u,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(u){this._rotation=u,this._rotationQuaternion=null,this._markAsDirtyInternal()}get vf(){return this._scaling}set vf(u){this._scaling=u,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(u){this._rotationQuaternion=u,u&&this._rotation.vj(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return f.q.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return f.q.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return f.q.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(u){return this._poseMatrix?(this._poseMatrix.p(u),this):(this._poseMatrix=u.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=f.d.Identity()),this._poseMatrix}_isSynchronized(){const u=this._cache;return this._billboardMode===u.billboardMode&&this._billboardMode===b.BILLBOARDMODE_NONE&&(!u.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const u=this._cache;u.localMatrixUpdated=!1,u.billboardMode=-1,u.infiniteDistance=!1,u.useBillboardPosition=!1,u.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(u){return this.setPivotMatrix(u,!1)}setPivotMatrix(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(u),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=G,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=f.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;const T=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0);T&&s&&s(this,T);for(const z of this.getChildTransformNodes(!0))z.instantiateHierarchy(T,G,s);return T}wh(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.vj(0),this._rotationQuaternion=this._rotationQuaternion||f.h.Identity(),u.decompose(this._scaling,this._rotationQuaternion,this._position),this.Gj(!0)):(this._worldMatrix=u,this._absolutePosition.hf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Gj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Gj(!0),this}get ej(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Gj(),this._absolutePosition}setAbsolutePosition(u){if(!u)return this;let G,s,T;if(void 0===u.x){if(arguments.length<3)return this;G=arguments[0],s=arguments[1],T=arguments[2]}else G=u.x,s=u.y,T=u.z;if(this.parent){const u=f.l.Matrix[0];this.parent.getWorldMatrix().invertToRef(u),f.q.TransformCoordinatesFromFloatsToRef(G,s,T,u,this.position)}else this.position.x=G,this.position.y=s,this.position.z=T;return this._absolutePosition.p(u),this}setPositionWithLocalVector(u){return this.Gj(),this.position=f.q.TransformNormal(u,this.Ij),this}getPositionExpressedInLocalSpace(){this.Gj();const u=f.l.Matrix[0];return this.Ij.invertToRef(u),f.q.TransformNormal(this.position,u)}locallyTranslate(u){return this.Gj(!0),this.position=f.q.TransformCoordinates(u,this.Ij),this}lookAt(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const O=b._LookAtVectorCache,m=0===z?this.position:this.getAbsolutePosition();if(u.subtractToRef(m,O),this.setDirection(O,G,s,T),1===z&&this.parent)if(this.rotationQuaternion){const u=f.l.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);const G=f.l.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(G),G.invert(),u.multiplyToRef(G,u),this.rotationQuaternion.fromRotationMatrix(u)}else{const u=f.l.Quaternion[0];f.h.FromEulerVectorToRef(this.rotation,u);const G=f.l.Matrix[0];u.toRotationMatrix(G);const s=f.l.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.invert(),G.multiplyToRef(s,G),u.fromRotationMatrix(G),u.toEulerAnglesToRef(this.rotation)}return this}$d(u){const G=f.q.Zero();return this.getDirectionToRef(u,G),G}getDirectionToRef(u,G){return f.q.TransformNormalToRef(u,this.getWorldMatrix(),G),this}setDirection(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const z=-Math.atan2(u.z,u.x)+Math.PI/2,O=Math.sqrt(u.x*u.x+u.z*u.z),m=-Math.atan2(u.y,O);return this.rotationQuaternion?f.h.RotationYawPitchRollToRef(z+G,m+s,T,this.rotationQuaternion):(this.rotation.x=m+s,this.rotation.y=z+G,this.rotation.z=T),this}setPivotPoint(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Gj(!0);const s=this.getWorldMatrix();if(1==G){const G=f.l.Matrix[0];s.invertToRef(G),u=f.q.TransformCoordinates(u,G)}return this.setPivotMatrix(f.d.Translation(-u.x,-u.y,-u.z),!0)}getPivotPoint(){const u=f.q.Zero();return this.getPivotPointToRef(u),u}getPivotPointToRef(u){return u.x=-this._pivotMatrix.m[12],u.y=-this._pivotMatrix.m[13],u.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const u=f.q.Zero();return this.getAbsolutePivotPointToRef(u),u}getAbsolutePivotPointToRef(u){return this.getPivotPointToRef(u),f.q.TransformCoordinatesToRef(u,this.getWorldMatrix(),u),this}pg(u){if(this._isDirty)return this;if(this._children)for(const G of this._children)G.pg(u);return super.pg(u)}setParent(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!u&&!this.parent)return this;const T=f.l.Quaternion[0],z=f.l.gb[0],O=f.l.gb[1],m=f.l.Matrix[1];f.d.IdentityToRef(m);const C=f.l.Matrix[0];this.Gj(!0);let x=this.rotationQuaternion;return x||(x=b._TmpRotation,f.h.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,x)),f.d.ComposeToRef(this.vf,x,this.position,C),this.parent&&C.multiplyToRef(this.parent.Gj(!0),C),u&&(u.Gj(!0).invertToRef(m),C.multiplyToRef(m,C)),C.decompose(O,T,z,G?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(T):T.toEulerAnglesToRef(this.rotation),this.vf.p(O),this.position.p(z),this.parent=u,s&&this.setPivotMatrix(f.d.Identity()),this}addChild(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.setParent(this,G),this}removeChild(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.setParent(null,G),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(u){return this._nonUniformScaling!==u&&(this._nonUniformScaling=u,!0)}attachToBone(u,G){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=G,this.parent=u,u.getSkeleton().prepare(!0),u.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=u?this._currentParentWhenAttachingToBone:null,this):(u&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(u,G,s){let T;if(u.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.vj(0)),s&&0!==s){if(this.parent){const s=this.parent.getWorldMatrix(),T=f.l.Matrix[0];s.invertToRef(T),u=f.q.TransformNormal(u,T),s.determinant()<0&&(G*=-1)}T=f.h.RotationAxisToRef(u,G,b._RotationAxisCache),T.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else T=f.h.RotationAxisToRef(u,G,b._RotationAxisCache),this.rotationQuaternion.multiplyToRef(T,this.rotationQuaternion);return this}rotateAround(u,G,s){G.normalize(),this.rotationQuaternion||(this.rotationQuaternion=f.h.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.vj(0));const T=f.l.gb[0],z=f.l.gb[1],O=f.l.gb[2],m=f.l.Quaternion[0],C=f.l.Matrix[0],x=f.l.Matrix[1],g=f.l.Matrix[2],b=f.l.Matrix[3];return u.subtractToRef(this.position,T),f.d.TranslationToRef(T.x,T.y,T.z,C),f.d.TranslationToRef(-T.x,-T.y,-T.z,x),f.d.RotationAxisToRef(G,s,g),x.multiplyToRef(g,b),b.multiplyToRef(C,b),b.decompose(z,m,O),this.position.addInPlace(O),m.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(u,G,s){const T=u.scale(G);if(s&&0!==s)this.setAbsolutePosition(this.getAbsolutePosition().add(T));else{const u=this.getPositionExpressedInLocalSpace().add(T);this.setPositionWithLocalVector(u)}return this}addRotation(u,G,s){let T;this.rotationQuaternion?T=this.rotationQuaternion:(T=f.l.Quaternion[1],f.h.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,T));const z=f.l.Quaternion[0];return f.h.RotationYawPitchRollToRef(G,u,s,z),T.multiplyInPlace(z),this.rotationQuaternion||T.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==b.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Gj(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const s=this.va().getRenderId();if(!this._isDirty&&!u&&(this._currentRenderId===s||this.isSynchronized()))return this._currentRenderId=s,this._worldMatrix;G=G||this.va().activeCamera,this._updateCache();const T=this._cache;T.pivotMatrixUpdated=!1,T.billboardMode=this.billboardMode,T.infiniteDistance=this.infiniteDistance,T.parent=this._parentNode,this._currentRenderId=s,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const z=this._getEffectiveParent(),O=b._TmpScaling;let m,C=this._position;if(this._infiniteDistance&&!this.parent&&G){const u=G.getWorldMatrix(),s=new f.q(u.m[12],u.m[13],u.m[14]);C=b._TmpTranslation,C.hf(this._position.x+s.x,this._position.y+s.y,this._position.z+s.z)}if(O.hf(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,m=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(f.h.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.hf(0,0,0))}}else m=b._TmpRotation,f.h.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,m);if(this._usePivotMatrix){const u=f.l.Matrix[1];f.d.ScalingToRef(O.x,O.y,O.z,u);const G=f.l.Matrix[0];m.toRotationMatrix(G),this._pivotMatrix.multiplyToRef(u,f.l.Matrix[4]),f.l.Matrix[4].multiplyToRef(G,this.Ij),this._postMultiplyPivotMatrix&&this.Ij.multiplyToRef(this._pivotMatrixInverse,this.Ij),this.Ij.addTranslationFromFloats(C.x,C.y,C.z)}else f.d.ComposeToRef(O,m,C,this.Ij);if(z&&z.getWorldMatrix){if(u&&z.Gj(u),T.useBillboardPath){if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),u.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),f.l.Matrix[7])}else f.l.Matrix[7].p(z.getWorldMatrix());const u=f.l.gb[5],G=f.l.gb[6],s=f.l.Quaternion[0];f.l.Matrix[7].decompose(G,s,u),f.d.ScalingToRef(G.x,G.y,G.z,f.l.Matrix[7]),f.l.Matrix[7].setTranslation(u),b.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(s,u),this.Ij.setTranslation(u)),this.Ij.multiplyToRef(f.l.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),this.Ij.multiplyToRef(u.getFinalMatrix(),f.l.Matrix[6]),f.l.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Ij.multiplyToRef(z.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Ij);if(T.useBillboardPath&&G&&this.billboardMode&&!T.useBillboardPosition){const u=f.l.gb[0];if(this._worldMatrix.getTranslationToRef(u),f.l.Matrix[1].p(G.getViewMatrix()),this._scene.useRightHandedSystem&&f.l.Matrix[1].multiplyToRef(g,f.l.Matrix[1]),f.l.Matrix[1].setTranslationFromFloats(0,0,0),f.l.Matrix[1].invertToRef(f.l.Matrix[0]),(this.billboardMode&b.BILLBOARDMODE_ALL)!==b.BILLBOARDMODE_ALL){f.l.Matrix[0].decompose(void 0,f.l.Quaternion[0],void 0);const u=f.l.gb[1];f.l.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&b.BILLBOARDMODE_X)!==b.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&b.BILLBOARDMODE_Y)!==b.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&b.BILLBOARDMODE_Z)!==b.BILLBOARDMODE_Z&&(u.z=0),f.d.RotationYawPitchRollToRef(u.y,u.x,u.z,f.l.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(f.l.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(f.l.gb[0])}else if(T.useBillboardPath&&G&&T.useBillboardPosition){const u=f.l.gb[0];this._worldMatrix.getTranslationToRef(u);const s=G.globalPosition;this._worldMatrix.invertToRef(f.l.Matrix[1]);const T=f.l.gb[1];f.q.TransformCoordinatesToRef(s,f.l.Matrix[1],T),T.normalize();const z=-Math.atan2(T.z,T.x)+Math.PI/2,O=Math.sqrt(T.x*T.x+T.z*T.z),m=-Math.atan2(T.y,O);if(f.h.RotationYawPitchRollToRef(z,m,0,f.l.Quaternion[0]),(this.billboardMode&b.BILLBOARDMODE_ALL)!==b.BILLBOARDMODE_ALL){const u=f.l.gb[1];f.l.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&b.BILLBOARDMODE_X)!==b.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&b.BILLBOARDMODE_Y)!==b.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&b.BILLBOARDMODE_Z)!==b.BILLBOARDMODE_Z&&(u.z=0),f.d.RotationYawPitchRollToRef(u.y,u.x,u.z,f.l.Matrix[0])}else f.d.FromQuaternionToRef(f.l.Quaternion[0],f.l.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(f.l.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(f.l.gb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):z&&z._nonUniformScaling?this._updateNonUniformScalingState(z._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.hf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=f.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Gj(),u){const u=this.getChildren();for(let G=0;G<u.length;++G){const s=u[G];if(s){s.Gj();const u=f.l.Matrix[0];s.Ij.multiplyToRef(this.Ij,u);const G=f.l.Quaternion[0];u.decompose(s.vf,G,s.position),s.rotationQuaternion?s.rotationQuaternion.p(G):G.toEulerAnglesToRef(s.rotation)}}}this.vf.hf(1,1,1),this.position.hf(0,0,0),this.rotation.hf(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=f.h.Identity()),this._worldMatrix=f.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.add(u),this}unregisterAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.removeCallback(u),this}getPositionInCameraSpace(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u||(u=this.va().activeCamera),f.q.TransformCoordinates(this.getAbsolutePosition(),u.getViewMatrix())}getDistanceToCamera(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return u||(u=this.va().activeCamera),this.getAbsolutePosition().Nc(u.globalPosition).length()}clone(u,G,s){const T=O.e.Clone((()=>new b(u,this.va())),this);if(T.name=u,T.id=u,G&&(T.parent=G),!s){const G=this.getDescendants(!0);for(let s=0;s<G.length;s++){const z=G[s];z.clone&&z.clone(u+"."+z.name,T)}}return T}serialize(u){const G=O.e.Serialize(this,u);return G.type=this.getClassName(),G.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(G),G.localMatrix=this.getPivotMatrix().$i(),G.isEnabled=this.isEnabled(),O.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G}static Parse(u,G,s){const T=O.e.Parse((()=>new b(u.name,G)),u,G,s);if(u.localMatrix?T.setPreTransformMatrix(f.d.Ag(u.localMatrix)):u.pivotMatrix&&T.setPivotMatrix(f.d.Ag(u.pivotMatrix)),T.Af(u.isEnabled),T._waitingParsedUniqueId=u.uniqueId,void 0!==u.parentId&&(T._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(T._waitingParentInstanceIndex=u.parentInstanceIndex),u.animations){for(let G=0;G<u.animations.length;G++){const s=u.animations[G],z=(0,x.e)("BABYLON.Animation");z&&T.animations.push(z.Parse(s))}C.b.ParseAnimationRanges(T,u,G)}return u.autoAnimate&&G.beginAnimation(T,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),T}getChildTransformNodes(u,G){const s=[];return this._getDescendants(s,u,(u=>(!G||G(u))&&u instanceof b)),s}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const u=this._parentContainer.transformNodes.indexOf(this);u>-1&&this._parentContainer.transformNodes.splice(u,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),u){const u=this.getChildTransformNodes(!0);for(const G of u)G.parent=null,G.Gj(!0)}super.dispose(u,G)}normalizeToUnitCube(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,T=null,z=null;G&&(this.rotationQuaternion?(z=this.rotationQuaternion.clone(),this.rotationQuaternion.hf(0,0,0,1)):this.rotation&&(T=this.rotation.clone(),this.rotation.hf(0,0,0)));const O=this.getHierarchyBoundingVectors(u,s),m=O.max.Nc(O.min),f=Math.max(m.x,m.y,m.z);if(0===f)return this;const C=1/f;return this.vf.scaleInPlace(C),G&&(this.rotationQuaternion&&z?this.rotationQuaternion.p(z):this.rotation&&T&&this.rotation.p(T)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}b.BILLBOARDMODE_NONE=0,b.BILLBOARDMODE_X=1,b.BILLBOARDMODE_Y=2,b.BILLBOARDMODE_Z=4,b.BILLBOARDMODE_ALL=7,b.BILLBOARDMODE_USE_POSITION=128,b.BillboardUseParentOrientation=!1,b._TmpRotation=f.h.Zero(),b._TmpScaling=f.q.Zero(),b._TmpTranslation=f.q.Zero(),b._LookAtVectorCache=new f.q(0,0,0),b._RotationAxisCache=new f.h,(0,T.b)([(0,z.J)("position")],b.prototype,"_position",void 0),(0,T.b)([(0,z.J)("rotation")],b.prototype,"_rotation",void 0),(0,T.b)([(0,z.z)("rotationQuaternion")],b.prototype,"_rotationQuaternion",void 0),(0,T.b)([(0,z.J)("vf")],b.prototype,"_scaling",void 0),(0,T.b)([(0,z.M)("billboardMode")],b.prototype,"_billboardMode",void 0),(0,T.b)([(0,z.M)()],b.prototype,"scalingDeterminant",void 0),(0,T.b)([(0,z.M)("infiniteDistance")],b.prototype,"_infiniteDistance",void 0),(0,T.b)([(0,z.M)()],b.prototype,"ignoreNonUniformScaling",void 0),(0,T.b)([(0,z.M)()],b.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11390:(u,G,s)=>{"use strict";s.d(G,{e:()=>x});var T=s(10904),z=s(10924),O=s(11378),m=s(10913),f=s(10930);class C{constructor(u,G,s,T){this.name=u,this.worldAxisForNormal=G,this.worldAxisForFileX=s,this.worldAxisForFileY=T}}class x{static ConvertCubeMapTextureToSphericalPolynomial(u){var G;if(!u.isCube)return null;null===(G=u.va())||void 0===G||G.getEngine().flushFramebuffer();const s=u.getSize().width,T=u.readPixels(0,void 0,void 0,!1),z=u.readPixels(1,void 0,void 0,!1);let O,m;u.isRenderTarget?(O=u.readPixels(3,void 0,void 0,!1),m=u.readPixels(2,void 0,void 0,!1)):(O=u.readPixels(2,void 0,void 0,!1),m=u.readPixels(3,void 0,void 0,!1));const f=u.readPixels(4,void 0,void 0,!1),C=u.readPixels(5,void 0,void 0,!1),x=u.gammaSpace;let g=0;return 1!=u.textureType&&2!=u.textureType||(g=1),new Promise((u=>{Promise.all([z,T,O,m,f,C]).then((G=>{let[T,z,O,m,f,C]=G;const b={size:s,right:z,left:T,up:O,down:m,front:f,back:C,format:5,type:g,gammaSpace:x};u(this.ConvertCubeMapToSphericalPolynomial(b))}))}))}static _AreaElement(u,G){return Math.atan2(u*G,Math.sqrt(u*u+G*G+1))}static ConvertCubeMapToSphericalPolynomial(u){const G=new O.e;let s=0;const T=2/u.size,C=T,x=.5*T,g=x-1;for(let O=0;O<6;O++){const b=this._FileFaces[O],Q=u[b.name];let Y=g;const n=5===u.format?4:3;for(let O=0;O<u.size;O++){let V=g;for(let C=0;C<u.size;C++){const g=b.worldAxisForFileX.scale(V).add(b.worldAxisForFileY.scale(Y)).add(b.worldAxisForNormal);g.normalize();const F=this._AreaElement(V-x,Y-x)-this._AreaElement(V-x,Y+x)-this._AreaElement(V+x,Y-x)+this._AreaElement(V+x,Y+x);let r=Q[O*u.size*n+C*n+0],c=Q[O*u.size*n+C*n+1],j=Q[O*u.size*n+C*n+2];isNaN(r)&&(r=0),isNaN(c)&&(c=0),isNaN(j)&&(j=0),0===u.type&&(r/=255,c/=255,j/=255),u.gammaSpace&&(r=Math.pow((0,z.b)(r),m.l),c=Math.pow((0,z.b)(c),m.l),j=Math.pow((0,z.b)(j),m.l));const l=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const u=Math.max(r,c,j);if(u>l){const G=l/u;r*=G,c*=G,j*=G}}else r=(0,z.b)(r,0,l),c=(0,z.b)(c,0,l),j=(0,z.b)(j,0,l);const P=new f.b(r,c,j);G.addLight(g,P,F),s+=F,V+=T}Y+=C}}const b=6*(4*Math.PI)/6/s;return G.scaleInPlace(b),G.convertIncidentRadianceToIrradiance(),G.convertIrradianceToLambertianRadiance(),O.h.FromHarmonics(G)}}x._FileFaces=[new C("right",new T.q(1,0,0),new T.q(0,0,-1),new T.q(0,-1,0)),new C("left",new T.q(-1,0,0),new T.q(0,0,1),new T.q(0,-1,0)),new C("up",new T.q(0,1,0),new T.q(1,0,0),new T.q(0,0,1)),new C("down",new T.q(0,-1,0),new T.q(1,0,0),new T.q(0,0,-1)),new C("front",new T.q(0,0,1),new T.q(1,0,0),new T.q(0,-1,0)),new C("back",new T.q(0,0,-1),new T.q(-1,0,0),new T.q(0,-1,0))],x.MAX_HDRI_VALUE=4096,x.PRESERVE_CLAMPED_COLORS=!1},10918:(u,G,s)=>{"use strict";function T(u,G){const s=[];for(let T=0;T<u;++T)s.push(G());return s}function z(u,G){return T(u,G)}s.d(G,{c:()=>T,d:()=>z,f:()=>m});const O=["push","splice","pop","shift","unshift"];function m(u,G){const s=O.map((s=>function(u,G,s){const T=u[G];if("function"!==typeof T)return null;const z=function(){const T=u.length,O=z.previous.apply(u,arguments);return s(G,T),O};return T.next=z,z.previous=T,u[G]=z,()=>{const s=z.previous;if(!s)return;const T=z.next;T?(s.next=T,T.previous=s):(s.next=void 0,u[G]=s),z.next=void 0,z.previous=void 0}}(u,s,G)));return()=>{s.forEach((u=>{null===u||void 0===u||u()}))}}},11852:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(11102),z=s(11856);let O=0;const m=u=>{if(!u.environmentBRDFTexture){const G=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const s=u._blockEntityCollection;u._blockEntityCollection=!1;const m=T.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+O++,u,!0,!1,T.b.BILINEAR_SAMPLINGMODE);u._blockEntityCollection=s;const f=u.getEngine().getLoadedTexturesCache(),C=f.indexOf(m.getInternalTexture());-1!==C&&f.splice(C,1),m.isRGBD=!0,m.wrapU=T.b.CLAMP_ADDRESSMODE,m.wrapV=T.b.CLAMP_ADDRESSMODE,u.environmentBRDFTexture=m,u.useDelayedTextureLoading=G,z.e.ExpandRGBDTexture(m);const x=u.getEngine().onContextRestoredObservable.add((()=>{m.isRGBD=!0;const G=u.onBeforeRenderObservable.add((()=>{m.isReady()&&(u.onBeforeRenderObservable.remove(G),z.e.ExpandRGBDTexture(m))}))}));u._i.add((()=>{u.getEngine().onContextRestoredObservable.remove(x)}))}return u.environmentBRDFTexture}},11152:(u,G,s)=>{"use strict";function T(u,G,s){try{const T=u.next();T.done?G(T):T.value?T.value.then((()=>{T.value=void 0,G(T)}),s):G(T)}catch(T){s(T)}}function z(){let u,G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(s,z,O)=>{const m=performance.now();void 0===u||m-u>G?(u=m,setTimeout((()=>{T(s,z,O)}),0)):T(s,z,O)}}function O(u,G,s,T,z){const O=()=>{let m;const f=u=>{u.done?s(u.value):void 0===m?m=!0:O()};do{m=void 0,z&&z.aborted?T(new Error("Aborted")):G(u,f,T),void 0===m&&(m=!1)}while(m)};O()}function m(u,G){let s;return O(u,T,(u=>s=u),(u=>{throw u}),G),s}function f(u,G,s){return new Promise(((T,z)=>{O(u,G,T,z,s)}))}function C(u,G){return function(){return m(u(...arguments),G)}}s.d(G,{c:()=>z,f:()=>C,g:()=>f,h:()=>m})},11388:(u,G,s)=>{"use strict";s.d(G,{e:()=>n});var T=s(10924),z=s(10584),O=s(11390),m=s(11399);s(11432);const f=131072,C=131072;function x(u){return u.charCodeAt(0)+(u.charCodeAt(1)<<8)+(u.charCodeAt(2)<<16)+(u.charCodeAt(3)<<24)}const g=x("DXT1"),b=x("DXT3"),Q=x("DXT5"),Y=x("DX10");class n{static GetDDSInfo(u){const G=new Int32Array(u.buffer,u.byteOffset,31),s=new Int32Array(u.buffer,u.byteOffset,35);let T=1;G[2]&f&&(T=Math.max(1,G[7]));const z=G[21],O=z===Y?s[32]:0;let m=0;switch(z){case 113:m=2;break;case 116:m=1;break;case Y:if(10===O){m=2;break}if(2===O){m=1;break}}return{width:G[4],height:G[3],mipmapCount:T,isFourCC:4===(4&G[20]),isRGB:64===(64&G[20]),isLuminance:(G[20]&C)===C,isCube:512===(512&G[28]),isCompressed:z===g||z===b||z===Q,dxgiFormat:O,textureType:m}}static _GetHalfFloatAsFloatRGBAArrayBuffer(u,G,s,T,z,O){const f=new Float32Array(T),C=new Uint16Array(z,s);let x=0;for(let g=0;g<G;g++)for(let G=0;G<u;G++){const s=4*(G+g*u);f[x]=(0,m.g)(C[s]),f[x+1]=(0,m.g)(C[s+1]),f[x+2]=(0,m.g)(C[s+2]),n.StoreLODInAlphaChannel?f[x+3]=O:f[x+3]=(0,m.g)(C[s+3]),x+=4}return f}static _GetHalfFloatRGBAArrayBuffer(u,G,s,T,z,O){if(n.StoreLODInAlphaChannel){const f=new Uint16Array(T),C=new Uint16Array(z,s);let x=0;for(let s=0;s<G;s++)for(let G=0;G<u;G++){const T=4*(G+s*u);f[x]=C[T],f[x+1]=C[T+1],f[x+2]=C[T+2],f[x+3]=(0,m.h)(O),x+=4}return f}return new Uint16Array(z,s,T)}static _GetFloatRGBAArrayBuffer(u,G,s,T,z,O){if(n.StoreLODInAlphaChannel){const m=new Float32Array(T),f=new Float32Array(z,s);let C=0;for(let s=0;s<G;s++)for(let G=0;G<u;G++){const T=4*(G+s*u);m[C]=f[T],m[C+1]=f[T+1],m[C+2]=f[T+2],m[C+3]=O,C+=4}return m}return new Float32Array(z,s,T)}static _GetFloatAsHalfFloatRGBAArrayBuffer(u,G,s,T,z,O){const f=new Uint16Array(T),C=new Float32Array(z,s);let x=0;for(let g=0;g<G;g++)for(let G=0;G<u;G++)f[x]=(0,m.h)(C[x]),f[x+1]=(0,m.h)(C[x+1]),f[x+2]=(0,m.h)(C[x+2]),n.StoreLODInAlphaChannel?f[x+3]=(0,m.h)(O):f[x+3]=(0,m.h)(C[x+3]),x+=4;return f}static _GetFloatAsUIntRGBAArrayBuffer(u,G,s,z,O,m){const f=new Uint8Array(z),C=new Float32Array(O,s);let x=0;for(let g=0;g<G;g++)for(let G=0;G<u;G++){const s=4*(G+g*u);f[x]=255*(0,T.b)(C[s]),f[x+1]=255*(0,T.b)(C[s+1]),f[x+2]=255*(0,T.b)(C[s+2]),n.StoreLODInAlphaChannel?f[x+3]=m:f[x+3]=255*(0,T.b)(C[s+3]),x+=4}return f}static _GetHalfFloatAsUIntRGBAArrayBuffer(u,G,s,z,O,f){const C=new Uint8Array(z),x=new Uint16Array(O,s);let g=0;for(let b=0;b<G;b++)for(let G=0;G<u;G++){const s=4*(G+b*u);C[g]=255*(0,T.b)((0,m.g)(x[s])),C[g+1]=255*(0,T.b)((0,m.g)(x[s+1])),C[g+2]=255*(0,T.b)((0,m.g)(x[s+2])),n.StoreLODInAlphaChannel?C[g+3]=f:C[g+3]=255*(0,T.b)((0,m.g)(x[s+3])),g+=4}return C}static _GetRGBAArrayBuffer(u,G,s,T,z,O,m,f,C){const x=new Uint8Array(T),g=new Uint8Array(z,s);let b=0;for(let Q=0;Q<G;Q++)for(let G=0;G<u;G++){const s=4*(G+Q*u);x[b]=g[s+O],x[b+1]=g[s+m],x[b+2]=g[s+f],x[b+3]=g[s+C],b+=4}return x}static _ExtractLongWordOrder(u){return 0===u||255===u||-16777216===u?0:1+n._ExtractLongWordOrder(u>>8)}static _GetRGBArrayBuffer(u,G,s,T,z,O,m,f){const C=new Uint8Array(T),x=new Uint8Array(z,s);let g=0;for(let b=0;b<G;b++)for(let G=0;G<u;G++){const s=3*(G+b*u);C[g]=x[s+O],C[g+1]=x[s+m],C[g+2]=x[s+f],g+=3}return C}static _GetLuminanceArrayBuffer(u,G,s,T,z){const O=new Uint8Array(T),m=new Uint8Array(z,s);let f=0;for(let C=0;C<G;C++)for(let G=0;G<u;G++){const s=G+C*u;O[f]=m[s],f++}return O}static UploadDDSLevels(u,G,s,T,m,C){let x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,V=arguments.length>7?arguments[7]:void 0,F=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],r=null;T.sphericalPolynomial&&(r=[]);const c=!!u.getCaps().s3tc;G.generateMipMaps=m;const j=new Int32Array(s.buffer,s.byteOffset,31);let l,P,H,X,p,q,d,v=0,W=0,M=1;if(542327876!==j[0])return void z.d.Error("Invalid magic number in DDS header");if(!T.isFourCC&&!T.isRGB&&!T.isLuminance)return void z.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(T.isCompressed&&!c)return void z.d.Error("Compressed textures are not supported on this platform.");let o=j[22];X=j[1]+4;let R=!1;if(T.isFourCC)switch(l=j[21],l){case g:M=8,W=33777;break;case b:M=16,W=33778;break;case Q:M=16,W=33779;break;case 113:R=!0,o=64;break;case 116:R=!0,o=128;break;case Y:{X+=20;let u=!1;switch(T.dxgiFormat){case 10:R=!0,o=64,u=!0;break;case 2:R=!0,o=128,u=!0;break;case 88:T.isRGB=!0,T.isFourCC=!1,o=32,u=!0}if(u)break}default:return void z.d.Error(["Unsupported FourCC code:",(B=l,String.fromCharCode(255&B,B>>8&255,B>>16&255,B>>24&255))])}var B;const D=n._ExtractLongWordOrder(j[23]),k=n._ExtractLongWordOrder(j[24]),w=n._ExtractLongWordOrder(j[25]),L=n._ExtractLongWordOrder(j[26]);R&&(W=u._getRGBABufferInternalSizedFormat(T.textureType)),q=1,j[2]&f&&!1!==m&&(q=Math.max(1,j[7]));const S=V||0,e=u.getCaps();for(let z=S;z<C;z++){for(P=j[4],H=j[3],d=0;d<q;++d){if(-1===x||x===d){const O=-1===x?d:0;if(!T.isCompressed&&T.isFourCC){G.format=5,v=P*H*4;let T=null;if(u._badOS||u._badDesktopOS||!e.textureHalfFloat&&!e.textureFloat)128===o?(T=n._GetFloatAsUIntRGBAArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,O),r&&0==O&&r.push(n._GetFloatRGBAArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,O))):64===o&&(T=n._GetHalfFloatAsUIntRGBAArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,O),r&&0==O&&r.push(n._GetHalfFloatAsFloatRGBAArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,O))),G.type=0;else{const u=e.textureFloat&&(F&&e.textureFloatLinearFiltering||!F),z=e.textureHalfFloat&&(F&&e.textureHalfFloatLinearFiltering||!F),m=(128===o||64===o&&!z)&&u?1:(64===o||128===o&&!u)&&z?2:0;let f,C=null;if(128===o)switch(m){case 1:f=n._GetFloatRGBAArrayBuffer,C=null;break;case 2:f=n._GetFloatAsHalfFloatRGBAArrayBuffer,C=n._GetFloatRGBAArrayBuffer;break;case 0:f=n._GetFloatAsUIntRGBAArrayBuffer,C=n._GetFloatRGBAArrayBuffer}else switch(m){case 1:f=n._GetHalfFloatAsFloatRGBAArrayBuffer,C=null;break;case 2:f=n._GetHalfFloatRGBAArrayBuffer,C=n._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:f=n._GetHalfFloatAsUIntRGBAArrayBuffer,C=n._GetHalfFloatAsFloatRGBAArrayBuffer}G.type=m,T=f(P,H,s.byteOffset+X,v,s.buffer,O),r&&0==O&&r.push(C?C(P,H,s.byteOffset+X,v,s.buffer,O):T)}T&&u._uploadDataToTextureDirectly(G,T,z,O)}else if(T.isRGB)G.type=0,24===o?(G.format=4,v=P*H*3,p=n._GetRGBArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,D,k,w),u._uploadDataToTextureDirectly(G,p,z,O)):(G.format=5,v=P*H*4,p=n._GetRGBAArrayBuffer(P,H,s.byteOffset+X,v,s.buffer,D,k,w,L),u._uploadDataToTextureDirectly(G,p,z,O));else if(T.isLuminance){const T=u._getUnpackAlignement(),m=P;v=Math.floor((P+T-1)/T)*T*(H-1)+m,p=n._GetLuminanceArrayBuffer(P,H,s.byteOffset+X,v,s.buffer),G.format=1,G.type=0,u._uploadDataToTextureDirectly(G,p,z,O)}else v=Math.max(4,P)/4*Math.max(4,H)/4*M,p=new Uint8Array(s.buffer,s.byteOffset+X,v),G.type=0,u._uploadCompressedDataToTextureDirectly(G,W,P,H,p,z,O)}X+=o?P*H*(o/8):v,P*=.5,H*=.5,P=Math.max(1,P),H=Math.max(1,H)}if(void 0!==V)break}r&&r.length>0?T.sphericalPolynomial=O.e.ConvertCubeMapToSphericalPolynomial({size:j[4],right:r[0],left:r[1],up:r[2],down:r[3],front:r[4],back:r[5],format:5,type:1,gammaSpace:!1}):T.sphericalPolynomial=void 0}}n.StoreLODInAlphaChannel=!1},10875:(u,G,s)=>{"use strict";s.d(G,{d:()=>O,e:()=>m});const T={},z={};function O(u){const G=u.getClassName();return z[G]||(z[G]={}),z[G]}function m(u){const G=u.getClassName();if(T[G])return T[G];T[G]={};const s=T[G];let O=u,m=G;for(;m;){const u=z[m];for(const z in u)s[z]=u[z];let G,T=!1;do{if(G=Object.getPrototypeOf(O),!G.getClassName){T=!0;break}if(G.getClassName()!==m)break;O=G}while(G);if(T)break;m=G.getClassName(),O=G}return s}},10866:(u,G,s)=>{"use strict";s.d(G,{D:()=>f,F:()=>g,J:()=>b,M:()=>m,d:()=>O,h:()=>c,i:()=>Y,k:()=>C,o:()=>n,p:()=>x,s:()=>V,t:()=>r,v:()=>Q,z:()=>F});var T=s(10875);function z(u,G){return(s,z)=>{const O=(0,T.d)(s);O[z]||(O[z]={type:u,sourceName:G})}}function O(u){return function(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(s,T)=>{const z=G||"_"+T;Object.defineProperty(s,T,{get:function(){return this[z]},set:function(G){"function"===typeof this.equals&&this.equals(G)||this[z]!==G&&(this[z]=G,s[u].apply(this))},enumerable:!0,configurable:!0})}}(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function m(u){return z(0,u)}function f(u){return z(1,u)}function C(u){return z(2,u)}function x(u){return z(3,u)}function g(u){return z(4,u)}function b(u){return z(5,u)}function Q(u){return z(6,u)}function Y(u){return z(7,u)}function n(u){return z(8,u)}function V(u){return z(9,u)}function F(u){return z(10,u)}function r(u){return z(12,u)}function c(u,G,s,T){const z=s.value;s.value=function(){let s=z;if("undefined"!==typeof _native&&_native[G]){const u=_native[G];s=T?function(){return T(...arguments)?u(...arguments):z(...arguments)}:u}return u[G]=s,s(...arguments)}}c.filter=function(u){return(G,s,T)=>c(G,s,T,u)}},10935:(u,G,s)=>{"use strict";s.d(G,{e:()=>x});var T=s(10609),z=s(10896),O=s(10930),m=s(10904),f=s(10875);const C=function(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const O=u();z.c&&z.c.HasTags(G)&&z.c.AddTagsTo(O,z.c.GetTags(G,!0));const m=(0,f.e)(O),C={};for(const z in m){const u=m[z],f=G[z],g=u.type;if(void 0!==f&&null!==f&&("uniqueId"!==z||x.AllowLoadingUniqueId))switch(g){case 0:case 6:case 11:O[z]=f;break;case 1:T.cloneTexturesOnlyOnce&&C[f.uniqueId]?O[z]=C[f.uniqueId]:(O[z]=s||f.isRenderTarget?f:f.clone(),C[f.uniqueId]=O[z]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:O[z]=s?f:f.clone()}}return O};class x{static AppendSerializedAnimations(u,G){if(u.animations){G.animations=[];for(let s=0;s<u.animations.length;s++){const T=u.animations[s];G.animations.push(T.serialize())}}}static Serialize(u,G){G||(G={}),z.c&&(G.tags=z.c.GetTags(u));const s=(0,f.e)(u);for(const T in s){const z=s[T],O=z.sourceName||T,m=z.type,f=u[T];if(void 0!==f&&null!==f&&("uniqueId"!==T||x.AllowLoadingUniqueId))switch(m){case 0:G[O]=f;break;case 1:case 3:case 7:case 9:G[O]=f.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:G[O]=f.$i();break;case 6:case 11:G[O]=f.id}}return G}static ParseProperties(u,G,s,T){T||(T="");const z=(0,f.e)(G);for(const f in z){const C=z[f],g=u[C.sourceName||f],b=C.type;if(void 0!==g&&null!==g&&("uniqueId"!==f||x.AllowLoadingUniqueId)){const u=G;switch(b){case 0:u[f]=g;break;case 1:s&&(u[f]=x._TextureParser(g,s,T));break;case 2:u[f]=O.b.Ag(g);break;case 3:u[f]=x._FresnelParametersParser(g);break;case 4:u[f]=m.m.Ag(g);break;case 5:u[f]=m.q.Ag(g);break;case 6:s&&(u[f]=s.getLastMeshById(g));break;case 7:u[f]=x._ColorCurvesParser(g);break;case 8:u[f]=O.e.Ag(g);break;case 9:u[f]=x._ImageProcessingConfigurationParser(g);break;case 10:u[f]=m.h.Ag(g);break;case 11:s&&(u[f]=s.getCameraById(g));break;case 12:u[f]=m.d.Ag(g)}}}}static Parse(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=u();return z.c&&z.c.AddTagsTo(O,G.tags),x.ParseProperties(G,O,s,T),O}static Clone(u,G){return C(u,G,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(u,G){return C(u,G,!0)}}x.AllowLoadingUniqueId=!1,x._ImageProcessingConfigurationParser=u=>{throw(0,T.c)("ImageProcessingConfiguration")},x._FresnelParametersParser=u=>{throw(0,T.c)("FresnelParameters")},x._ColorCurvesParser=u=>{throw(0,T.c)("ColorCurves")},x._TextureParser=(u,G,s)=>{throw(0,T.c)("Texture")}},10592:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(10584);const z=(u,G,s)=>u?u.getClassName&&"Mesh"===u.getClassName()?null:!u.getClassName||"SubMesh"!==u.getClassName()&&"PhysicsBody"!==u.getClassName()?u.clone?u.clone():Array.isArray(u)?u.slice():s&&"object"===typeof u?{...u}:null:u.clone(G):null;class O{static DeepCopy(u,G,s,O){let m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const f=function(u){const G=[];do{Object.getOwnPropertyNames(u).forEach((function(u){-1===G.indexOf(u)&&G.push(u)}))}while(u=Object.getPrototypeOf(u));return G}(u);for(const x of f){if("_"===x[0]&&(!O||-1===O.indexOf(x)))continue;if(x.endsWith("Observable"))continue;if(s&&-1!==s.indexOf(x))continue;const f=u[x],g=typeof f;if("function"!==g)try{if("object"===g)if(f instanceof Uint8Array)G[x]=Uint8Array.from(f);else if(f instanceof Array){if(G[x]=[],f.length>0)if("object"==typeof f[0])for(let u=0;u<f.length;u++){const s=z(f[u],G,m);-1===G[x].indexOf(s)&&G[x].push(s)}else G[x]=f.slice(0)}else G[x]=z(f,G,m);else G[x]=f}catch(C){T.d.Warn(C.message)}}}}},10609:(u,G,s)=>{"use strict";s.d(G,{c:()=>z});const T={};function z(u){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!T[u])return T[u]=!0,`${u} needs to be imported before as it contains a side-effect required by your code.`}},10577:(u,G,s)=>{"use strict";function T(){return"undefined"!==typeof window}function z(){return"undefined"!==typeof navigator}function O(){return"undefined"!==typeof document}function m(u){let G="",s=u.firstChild;for(;s;)3===s.nodeType&&(G+=s.textContent),s=s.nextSibling;return G}s.d(G,{b:()=>m,d:()=>O,h:()=>z,k:()=>T})},11902:(u,G,s)=>{"use strict";s.r(G),s.d(G,{Dispose:()=>Q,DumpData:()=>b,DumpDataAsync:()=>g,DumpFramebuffer:()=>x,DumpTools:()=>Y});var T=s(11420),z=s(10564),O=s(10924),m=s(10619);let f,C=null;async function x(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0;const f=await s.readPixels(0,0,u,G);b(u,G,new Uint8Array(f.buffer),T,z,O,!0,void 0,m)}function g(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7?arguments[7]:void 0;return new Promise((C=>{b(u,G,s,(u=>C(u)),T,z,O,m,f)}))}function b(u,G,x,g){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((u,G)=>{let z,O=null;const C={Xg:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(s.bind(s,11312)).then((x=>{let{ThinEngine:g}=x;try{z=new OffscreenCanvas(100,100),O=new g(z,!1,C)}catch(Y){z=document.createElement("canvas"),O=new g(z,!1,C)}m.d.Instances.pop(),m.d.OnEnginesDisposedObservable.add((u=>{O&&u!==O&&!O.u&&0===m.d.Instances.length&&Q()})),O.getCaps().parallelShaderCompile=void 0;const b=new T.c(O);s.e(34).then(s.bind(s,13121)).then((s=>{let{passPixelShader:m}=s;if(!O)return void G("Engine is not defined");const C=new T.d({jd:O,name:m.name,fragmentShader:m.shader,samplerNames:["textureSampler"]});f={canvas:z,jd:O,renderer:b,wrapper:C},u(f)}))})).catch(G)}))),await C})().then((s=>{if(s.jd.setSize(u,G,!0),x instanceof Float32Array){const u=new Uint8Array(x.length);let G=x.length;for(;G--;){const s=x[G];u[G]=Math.round(255*(0,O.b)(s))}x=u}const T=s.jd.createRawTexture(x,u,G,5,!1,!n,1);s.renderer.setViewport(),s.renderer.applyEffectWrapper(s.wrapper),s.wrapper.effect._bindTexture("textureSampler",T),s.renderer.draw(),V?z.e.ToBlob(s.canvas,(u=>{const G=new FileReader;G.onload=u=>{const G=u.target.result;g&&g(G)},G.readAsArrayBuffer(u)}),b,F):z.e.EncodeScreenshotCanvasData(s.canvas,g,b,Y,F),T.dispose()}))}function Q(){var u;f?(f.wrapper.dispose(),f.renderer.dispose(),f.jd.dispose()):null===(u=C)||void 0===u||u.then((u=>{u.wrapper.dispose(),u.renderer.dispose(),u.jd.dispose()}));C=null,f=null}const Y={DumpData:b,DumpDataAsync:g,DumpFramebuffer:x,Dispose:Q};z.e.DumpData=b,z.e.DumpDataAsync=g,z.e.DumpFramebuffer=x},11900:(u,G,s)=>{"use strict";s.d(G,{b:()=>n,c:()=>r,f:()=>l,h:()=>P});var T=s(10564),z=s(10904),O=s(10924),m=s(11378),f=s(10683),C=s(11107),x=(s(10889),s(11412)),g=s(10584);s(11856),s(11868),s(11902);const b="image/png",Q=2,Y=[134,22,135,150,246,214,150,54];function n(u){const G=new DataView(u.buffer,u.byteOffset,u.byteLength);let s=0;for(let m=0;m<Y.length;m++)if(G.getUint8(s++)!==Y[m])return g.d.Error("Not a babylon environment map"),null;let T="",z=0;for(;z=G.getUint8(s++);)T+=String.fromCharCode(z);let O=JSON.parse(T);return O=V(O),O.ah&&(O.ah.specularDataPosition=s,O.ah.lodGenerationScale=O.ah.lodGenerationScale||.8),O}function V(u){if(u.version>Q)throw new Error(`Unsupported babylon environment map version "${u.version}". Latest supported version is "${Q}".`);return 2===u.version?u:u={...u,version:2,imageType:b}}function F(u,G){const s=(G=V(G)).ah;let T=Math.log2(G.width);if(T=Math.round(T)+1,s.mipmaps.length!==6*T)throw new Error(`Unsupported specular mipmaps number "${s.mipmaps.length}"`);const z=new Array(T);for(let O=0;O<T;O++){z[O]=new Array(6);for(let G=0;G<6;G++){const T=s.mipmaps[6*O+G];z[O][G]=new Uint8Array(u.buffer,u.byteOffset+s.specularDataPosition+T.position,T.length)}}return z}function r(u,G,s){const T=(s=V(s)).ah;if(!T)return Promise.resolve();u._lodGenerationScale=T.lodGenerationScale;return j(u,F(G,s),s.imageType)}function c(u,G,s,T,z,O,m,f,C,x,g){return new Promise(((b,Q)=>{if(s){const s=G.createTexture(null,!0,!0,null,1,null,(u=>{Q(u)}),u);null===T||void 0===T||T.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{T.externalTextureSamplerBinding=!0,T.onApply=T=>{T._bindTexture("textureSampler",s),T.setFloat2("scale",1,G._features.needsInvertingBitmap&&u instanceof ImageBitmap?-1:1)},G.scenes.length&&(G.scenes[0].postProcessManager.directRender([T],x,!0,O,m),G.restoreDefaultFramebuffer(),s.dispose(),URL.revokeObjectURL(z),b())}))}))}else{if(G._uploadImageToTexture(g,u,O,m),f){const s=C[m];s&&G._uploadImageToTexture(s._texture,u,O,0)}b()}}))}async function j(u,G){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b;if(!T.e.IsExponentOfTwo(u.width))throw new Error("Texture size must be a power of two");const m=(0,O.l)(u.width)+1,g=u.getEngine();let Q=!1,Y=!1,n=null,V=null,F=null;const r=g.getCaps();u.format=5,u.type=0,u.generateMipMaps=!0,u._cachedAnisotropicFilteringLevel=null,g.updateTextureSamplingMode(3,u),r.textureLOD?g._features.supportRenderAndCopyToLodForFloatTextures?r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(Q=!0,u.type=2):r.textureFloatRender&&r.textureFloatLinearFiltering&&(Q=!0,u.type=1):Q=!1:(Q=!1,Y=!0,F={});let j=0;if(Q)g.isWebGPU?(j=1,await s.e(39).then(s.bind(s,13148))):await s.e(41).then(s.bind(s,13162)),n=new x.c("rgbdDecode","rgbdDecode",null,null,1,null,3,g,!1,void 0,u.type,void 0,null,!1,void 0,j),u._isRGBD=!1,u.invertY=!1,V=g.createRenderTargetCubeTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:u.type,format:5});else if(u._isRGBD=!0,u.invertY=!0,Y){const G=3,s=u._lodGenerationScale,T=u._lodGenerationOffset;for(let z=0;z<G;z++){const O=(m-1)*s+T,x=T+(O-T)*(1-z/(G-1)),b=Math.round(Math.min(Math.max(x,0),O)),Q=new f.d(g,2);Q.isCube=!0,Q.invertY=!0,Q.generateMipMaps=!1,g.updateTextureSamplingMode(2,Q);const Y=new C.c(null);switch(Y._isCube=!0,Y._texture=Q,F[b]=Y,z){case 0:u._lodTextureLow=Y;break;case 1:u._lodTextureMid=Y;break;case 2:u._lodTextureHigh=Y}}}const l=[];for(let s=0;s<G.length;s++)for(let T=0;T<6;T++){const O=G[s][T],m=new Blob([O],{type:z}),f=URL.createObjectURL(m);let C;if(g._features.forceBitmapOverHTMLImageElement)C=g.createImageBitmap(m,{premultiplyAlpha:"none"}).then((G=>c(G,g,Q,n,f,T,s,Y,F,V,u)));else{const G=new Image;G.src=f,C=new Promise(((z,O)=>{G.onload=()=>{c(G,g,Q,n,f,T,s,Y,F,V,u).then((()=>z())).catch((u=>{O(u)}))},G.onerror=u=>{O(u)}}))}l.push(C)}if(G.length<m){let s;const T=Math.pow(2,m-1-G.length),z=T*T*4;switch(u.type){case 0:s=new Uint8Array(z);break;case 2:s=new Uint16Array(z);break;case 1:s=new Float32Array(z)}for(let O=G.length;O<m;O++)for(let G=0;G<6;G++)g._uploadArrayBufferViewToTexture(u,s,G,O)}return Promise.all(l).then((()=>{V&&(g._releaseTexture(u),V._swapAndDie(u)),n&&n.dispose(),Y&&(u._lodTextureHigh&&u._lodTextureHigh._texture&&(u._lodTextureHigh._texture.isReady=!0),u._lodTextureMid&&u._lodTextureMid._texture&&(u._lodTextureMid._texture.isReady=!0),u._lodTextureLow&&u._lodTextureLow._texture&&(u._lodTextureLow._texture.isReady=!0))}))}function l(u,G){const s=(G=V(G)).irradiance;if(!s)return;const T=new m.h;z.q.FromArrayToRef(s.x,0,T.x),z.q.FromArrayToRef(s.y,0,T.y),z.q.FromArrayToRef(s.z,0,T.z),z.q.FromArrayToRef(s.xx,0,T.xx),z.q.FromArrayToRef(s.yy,0,T.yy),z.q.FromArrayToRef(s.zz,0,T.zz),z.q.FromArrayToRef(s.yz,0,T.yz),z.q.FromArrayToRef(s.zx,0,T.zx),z.q.FromArrayToRef(s.xy,0,T.xy),u._sphericalPolynomial=T}function P(u,G,s,T,z){const O=j(u.getEngine().createRawCubeTexture(null,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression),G).then((()=>u));return u.onRebuildCallback=u=>({proxy:O,isReady:!0,isAsync:!0}),u._source=13,u._bufferViewArrayArray=G,u._lodGenerationScale=T,u._lodGenerationOffset=z,u._sphericalPolynomial=s,j(u,G).then((()=>(u.isReady=!0,u)))}},10625:(u,G,s)=>{"use strict";s.d(G,{c:()=>T,f:()=>z,g:()=>O});class T extends Error{}T._setPrototypeOf=Object.setPrototypeOf||((u,G)=>(u.__proto__=G,u));const z={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class O extends T{constructor(u,G,s){super(u),this.errorCode=G,this.innerError=s,this.name="RuntimeError",T._setPrototypeOf(this,O.prototype)}}},10622:(u,G,s)=>{"use strict";s.d(G,{c:()=>M,e:()=>j,f:()=>v,j:()=>p,i:()=>F,l:()=>H,m:()=>X,o:()=>q,q:()=>l});var T=s(10615),z=s(10577),O=s(10568);class m{}m.FilesToLoad={};var f=s(10625),C=s(10627),x=s(10630),g=s(10619),b=s(10584),Q=s(10640),Y=s(10634),n=s(10645);const V=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class F extends f.g{constructor(u,G){super(u,f.f.LoadFileError),this.name="LoadFileError",f.c._setPrototypeOf(this,F.prototype),G instanceof T.e?this.request=G:this.file=G}}class r extends f.g{constructor(u,G){super(u,f.f.RequestFileError),this.request=G,this.name="RequestFileError",f.c._setPrototypeOf(this,r.prototype)}}class c extends f.g{constructor(u,G){super(u,f.f.ReadFileError),this.file=G,this.name="ReadFileError",f.c._setPrototypeOf(this,c.prototype)}}const j={DefaultRetryStrategy:class{static ExponentialBackoff(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(s,T,z)=>0!==T.status||z>=u||-1!==s.indexOf("file:")?-1:Math.pow(2,z)*G}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:u=>u,ScriptBaseUrl:"",ScriptPreprocessUrl:u=>u,CleanUrl:u=>u=u.replace(/#/gm,"%23")},l=(u,G)=>{if((!u||0!==u.indexOf("data:"))&&j.CorsBehavior)if("string"===typeof j.CorsBehavior||j.CorsBehavior instanceof String)G.crossOrigin=j.CorsBehavior;else{const s=j.CorsBehavior(u);s&&(G.crossOrigin=s)}},P={getRequiredSize:null},H=function(u,G,s,z){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",f=arguments.length>5?arguments[5]:void 0;const x=g.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===x||void 0===x||!x._features.forceBitmapOverHTMLImageElement))return s("LoadImage is only supported in web or BabylonNative environments."),null;let b,Q=!1;u instanceof ArrayBuffer||ArrayBuffer.isView(u)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(b=URL.createObjectURL(new Blob([u],{type:O})),Q=!0):b=`data:${O};base64,`+(0,C.k)(u):u instanceof Blob?(b=URL.createObjectURL(u),Q=!0):(b=j.CleanUrl(u),b=j.PreprocessUrl(b));const Y=G=>{if(s){const T=b||u.toString();s(`Error while trying to load image: ${0===T.indexOf("http")||T.length<=128?T:T.slice(0,128)+"..."}`,G)}};if(null!==x&&void 0!==x&&x._features.forceBitmapOverHTMLImageElement)return p(b,(T=>{x.createImageBitmap(new Blob([T],{type:O}),{premultiplyAlpha:"none",...f}).then((u=>{G(u),Q&&URL.revokeObjectURL(b)})).catch((G=>{s&&s("Error while trying to load image: "+u,G)}))}),void 0,z||void 0,!0,((u,G)=>{Y(G)})),null;const n=new Image;if(P.getRequiredSize){const G=P.getRequiredSize(u);G.width&&(n.width=G.width),G.height&&(n.height=G.height)}l(b,n);const V=[],F=()=>{V.forEach((u=>{u.target.removeEventListener(u.name,u.handler)})),V.length=0};V.push({target:n,name:"load",handler:()=>{F(),G(n),Q&&n.src&&URL.revokeObjectURL(n.src)}}),V.push({target:n,name:"error",handler:u=>{F(),Y(u),Q&&n.src&&URL.revokeObjectURL(n.src)}}),V.push({target:document,name:"securitypolicyviolation",handler:u=>{if(u.blockedURI!==n.src||"fm"===u.disposition)return;F();const G=new Error(`CSP violation of policy ${u.effectiveDirective} ${u.blockedURI}. Current policy is ${u.originalPolicy}`);g.d.UseFallbackTexture=!1,Y(G),Q&&n.src&&URL.revokeObjectURL(n.src),n.src=""}}),V.forEach((u=>{u.target.addEventListener(u.name,u.handler)}));const r="blob:"===b.substring(0,5),c="data:"===b.substring(0,5),H=()=>{r||c||!T.e.IsCustomRequestAvailable?n.src=b:p(b,((u,G,s)=>{const T=new Blob([u],{type:!O&&s?s:O}),z=URL.createObjectURL(T);Q=!0,n.src=z}),void 0,z||void 0,!0,((u,G)=>{Y(G)}))},X=()=>{z&&z.loadImage(b,n)};if(!r&&!c&&z&&z.enableTexturesOffline)z.open(X,H);else{if(-1!==b.indexOf("file:")){const u=decodeURIComponent(b.substring(5).toLowerCase());if(m.FilesToLoad[u]&&"undefined"!==typeof URL){try{let G;try{G=URL.createObjectURL(m.FilesToLoad[u])}catch(q){G=URL.createObjectURL(m.FilesToLoad[u])}n.src=G,Q=!0}catch(d){n.src=""}return n}}H()}return n},X=(u,G,s,T,z)=>{const m=new FileReader,f={onCompleteObservable:new O.e,abort:()=>m.abort()};return m.onloadend=()=>f.onCompleteObservable.notifyObservers(f),z&&(m.onerror=()=>{z(new c(`Unable to read ${u.name}`,u))}),m.onload=u=>{G(u.target.result)},s&&(m.onprogress=s),T?m.readAsArrayBuffer(u):m.readAsText(u),f},p=(u,G,s,T,z,C,x)=>{if(u.name)return X(u,G,s,z,C?u=>{C(void 0,u)}:void 0);const g=u;if(-1!==g.indexOf("file:")){let u=decodeURIComponent(g.substring(5).toLowerCase());0===u.indexOf("./")&&(u=u.substring(2));const T=m.FilesToLoad[u];if(T)return X(T,G,s,z,C?u=>C(void 0,new F(u.message,u.file)):void 0)}const{match:Y,type:n}=W(g);if(Y){const u={onCompleteObservable:new O.e,abort:()=>()=>{}};try{const u=z?M(g):o(g);G(u,void 0,n)}catch(f){C?C(void 0,f):b.d.Error(f.message||"Failed to parse the Data URL")}return Q.e.SetImmediate((()=>{u.onCompleteObservable.notifyObservers(u)})),u}return q(g,((u,s)=>{G(u,null===s||void 0===s?void 0:s.responseURL,null===s||void 0===s?void 0:s.getResponseHeader("content-type"))}),s,T,z,C?u=>{C(u.request,new F(u.message,u.request))}:void 0,x)},q=(u,G,s,m,f,C,x)=>{u=j.CleanUrl(u),u=j.PreprocessUrl(u);const g=j.BaseUrl+u;let Q=!1;const Y={onCompleteObservable:new O.e,abort:()=>Q=!0},n=()=>{let u,O=new T.e,m=null;const n=()=>{O&&(s&&O.removeEventListener("progress",s),u&&O.removeEventListener("readystatechange",u),O.removeEventListener("loadend",V))};let V=()=>{n(),Y.onCompleteObservable.notifyObservers(Y),Y.onCompleteObservable.clear(),s=void 0,u=null,V=null,C=void 0,x=void 0,G=void 0};Y.abort=()=>{Q=!0,V&&V(),O&&O.readyState!==(XMLHttpRequest.DONE||4)&&O.abort(),null!==m&&(clearTimeout(m),m=null),O=null};const F=u=>{const G=u.message||"Unknown error";C&&O?C(new r(G,O)):b.d.Error(G)},c=b=>{if(O){if(O.open("GET",g),x)try{x(O)}catch(Y){return void F(Y)}f&&(O.responseType="arraybuffer"),s&&O.addEventListener("progress",s),V&&O.addEventListener("loadend",V),u=()=>{if(!Q&&O&&O.readyState===(XMLHttpRequest.DONE||4)){if(u&&O.removeEventListener("readystatechange",u),O.status>=200&&O.status<300||0===O.status&&(!(0,z.k)()||d())){try{G&&G(f?O.response:O.responseText,O)}catch(Y){F(Y)}return}const s=j.DefaultRetryStrategy;if(s){const u=s(g,O,b);if(-1!==u)return n(),O=new T.e,void(m=setTimeout((()=>c(b+1)),u))}const x=new r("Error status: "+O.status+" "+O.statusText+" - Unable to load "+g,O);C&&C(x)}},O.addEventListener("readystatechange",u),O.send()}};c(0)};if(m&&m.enableSceneOffline){const T=u=>{u&&u.status>400?C&&C(u):n()},z=()=>{m&&m.loadFile(j.BaseUrl+u,(u=>{!Q&&G&&G(u),Y.onCompleteObservable.notifyObservers(Y)}),s?u=>{!Q&&s&&s(u)}:void 0,T,f)};m.open(z,T)}else n();return Y},d=()=>"undefined"!==typeof location&&"file:"===location.protocol,v=u=>V.test(u),W=u=>{const G=V.exec(u);if(null===G||0===G.length)return{match:!1,type:""};return{match:!0,type:G[0].replace("data:","").replace("base64,","")}};function M(u){return(0,C.e)(u.split(",")[1])}const o=u=>(0,C.h)(u.split(",")[1]);let R;n.b._FileToolsLoadImage=H,Y.d.loadFile=p,x.n.loadFile=p;((u,G,s,T,z,O,m,f,C,x)=>{R={DecodeBase64UrlToBinary:u,DecodeBase64UrlToString:G,DefaultRetryStrategy:s.DefaultRetryStrategy,BaseUrl:s.BaseUrl,CorsBehavior:s.CorsBehavior,PreprocessUrl:s.PreprocessUrl,IsBase64DataUrl:T,IsFileURL:z,LoadFile:O,LoadImage:m,ReadFile:f,RequestFile:C,SetCorsBehavior:x},Object.defineProperty(R,"DefaultRetryStrategy",{get:function(){return s.DefaultRetryStrategy},set:function(u){s.DefaultRetryStrategy=u}}),Object.defineProperty(R,"BaseUrl",{get:function(){return s.BaseUrl},set:function(u){s.BaseUrl=u}}),Object.defineProperty(R,"PreprocessUrl",{get:function(){return s.PreprocessUrl},set:function(u){s.PreprocessUrl=u}}),Object.defineProperty(R,"CorsBehavior",{get:function(){return s.CorsBehavior},set:function(u){s.CorsBehavior=u}})})(M,o,j,v,d,p,H,X,q,l)},10720:(u,G,s)=>{"use strict";function T(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(u=>{const G=16*Math.random()|0;return("x"===u?G:3&G|8).toString(16)}))}s.d(G,{c:()=>T})},10707:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(10584),z=s(10715);class O{static Instantiate(u){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[u])return this.RegisteredExternalClasses[u];const G=(0,z.e)(u);if(G)return G;T.d.Warn(u+" not found, you may have missed an import.");const s=u.split(".");let O=window||this;for(let T=0,z=s.length;T<z;T++)O=O[s[T]];return"function"!==typeof O?null:O}}O.RegisteredExternalClasses={}},10584:(u,G,s)=>{"use strict";s.d(G,{d:()=>T});class T{static _CheckLimit(u,G){let s=T._LogLimitOutputs[u];return s?s.current++:(s={limit:G,current:1},T._LogLimitOutputs[u]=s),s.current<=s.limit}static _GenerateLimitMessage(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=T._LogLimitOutputs[u];if(!s||!T.MessageLimitReached)return;const z=this._Levels[G];s.current===s.limit&&T[z.name](T.MessageLimitReached.replace(/%LIMIT%/g,""+s.limit).replace(/%TYPE%/g,z.name??""))}static _AddLogEntry(u){T._LogCache=u+T._LogCache,T.OnNewCacheEntry&&T.OnNewCacheEntry(u)}static _FormatMessage(u){const G=u=>u<10?"0"+u:""+u,s=new Date;return"["+G(s.getHours())+":"+G(s.getMinutes())+":"+G(s.getSeconds())+"]: "+u}static _LogDisabled(u,G){}static _LogEnabled(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;const z=Array.isArray(G)?G[0]:G;if(void 0!==s&&!T._CheckLimit(z,s))return;const O=T._FormatMessage(z),m=this._Levels[u],f=Array.isArray(G)?G.slice(1):[];m.logFunc&&m.logFunc("BJS - "+O,...f);const C=`<div style='color:${m.color}'>${O}</div><br>`;T._AddLogEntry(C),T._GenerateLimitMessage(z,u)}static get LogCache(){return T._LogCache}static ClearLogCache(){T._LogCache="",T._LogLimitOutputs={},T.errorsCount=0}static set LogLevels(u){T.Log=T._LogDisabled,T.Warn=T._LogDisabled,T.Error=T._LogDisabled,[T.MessageLogLevel,T.WarningLogLevel,T.ErrorLogLevel].forEach((G=>{if((u&G)===G){const u=this._Levels[G];T[u.name]=T._LogEnabled.bind(T,G)}}))}}T.NoneLogLevel=0,T.MessageLogLevel=1,T.WarningLogLevel=2,T.ErrorLogLevel=4,T.AllLogLevel=7,T.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",T._LogCache="",T._LogLimitOutputs={},T._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],T.errorsCount=0,T.Log=T._LogEnabled.bind(T,T.MessageLogLevel),T.Warn=T._LogEnabled.bind(T,T.WarningLogLevel),T.Error=T._LogEnabled.bind(T,T.ErrorLogLevel)},10568:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});class T{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0;this.initialize(u,G,s,T)}initialize(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0;return this.mask=u,this.skipNextObservers=G,this.target=s,this.currentTarget=T,this}}class z{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=u,this.mask=G,this.scope=s,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class O{static FromPromise(u,G){const s=new O;return u.then((u=>{s.notifyObservers(u)})).catch((u=>{if(!G)throw u;G.notifyObservers(u)})),s}get observers(){return this._observers}constructor(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=G,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new T(0),u&&(this._onObserverAdded=u)}add(u){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!u)return null;const T=new z(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return T.unregisterOnNextCall=s,G?this._observers.unshift(T):this._observers.push(T),this._onObserverAdded&&this._onObserverAdded(T),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(T,this._lastNotifiedValue),T._remove=()=>{this.remove(T)},T}addOnce(u){return this.add(u,void 0,void 0,void 0,!0)}remove(u){if(!u)return!1;u._remove=null;return-1!==this._observers.indexOf(u)&&(this._deferUnregister(u),!0)}removeCallback(u,G){for(let s=0;s<this._observers.length;s++){const T=this._observers[s];if(!T._willBeUnregistered&&(T.callback===u&&(!G||G===T.scope)))return this._deferUnregister(T),!0}return!1}_deferUnregister(u){u._willBeUnregistered||(this._numObserversMarkedAsDeleted++,u.unregisterOnNextCall=!1,u._willBeUnregistered=!0,setTimeout((()=>{this._remove(u)}),0))}_remove(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!u)return!1;const s=this._observers.indexOf(u);return-1!==s&&(G&&this._numObserversMarkedAsDeleted--,this._observers.splice(s,1),!0)}makeObserverTopPriority(u){this._remove(u,!1),this._observers.unshift(u)}makeObserverBottomPriority(u){this._remove(u,!1),this._observers.push(u)}notifyObservers(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),!this._observers.length)return!0;const O=this._eventState;O.mask=G,O.target=s,O.currentTarget=T,O.skipNextObservers=!1,O.lastReturnValue=u,O.userInfo=z;for(const m of this._observers)if(!m._willBeUnregistered&&(m.mask&G&&(m.unregisterOnNextCall&&this._deferUnregister(m),m.scope?O.lastReturnValue=m.callback.apply(m.scope,[u,O]):O.lastReturnValue=m.callback(u,O)),O.skipNextObservers))return!1;return!0}notifyObserver(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=G),u._willBeUnregistered)return;const T=this._eventState;T.mask=s,T.skipNextObservers=!1,u.unregisterOnNextCall&&this._deferUnregister(u),u.callback(G,T)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const u=this._observers.pop();u&&(u._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const u=new O;return u._observers=this._observers.slice(0),u}hasSpecificMask(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const G of this._observers)if(G.mask&u||G.mask===u)return!0;return!1}}},10734:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(10601);class z{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(u,G){z.Enabled&&(this._current+=u,G&&this._fetchResult())}beginMonitoring(){z.Enabled&&(this._startMonitoringTime=T.e.Now)}endMonitoring(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!z.Enabled)return;u&&this.fetchNewFrame();const G=T.e.Now;this._current=G-this._startMonitoringTime,u&&this._fetchResult()}Xi(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const u=T.e.Now;u-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=u,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}z.Enabled=!0},10601:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(10577);class z{static get Now(){return(0,T.k)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11856:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(11412),z=s(11399);class O{static ExpandRGBDTexture(u){const G=u._texture;if(!G||!u.isRGBD)return;const z=G.getEngine(),O=z.getCaps(),m=G.isReady;let f=!1;O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(f=!0,G.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(f=!0,G.type=1),f&&(G.isReady=!1,G._isRGBD=!1,G.invertY=!1);const C=async()=>{const O=z.isWebGPU,m=O?1:0;G.isReady=!1,O?await Promise.all([s.e(39).then(s.bind(s,13148)),s.e(40).then(s.bind(s,13156))]):await Promise.all([s.e(41).then(s.bind(s,13162)),s.e(42).then(s.bind(s,13171))]);const f=new T.c("rgbdDecode","rgbdDecode",null,null,1,null,3,z,!1,void 0,G.type,void 0,null,!1,void 0,m);f.externalTextureSamplerBinding=!0;const C=z.createRenderTargetTexture(G.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:G.samplingMode,type:G.type,format:5});f.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled((()=>{f.onApply=u=>{u._bindTexture("textureSampler",G),u.setFloat2("scale",1,1)},u.va().postProcessManager.directRender([f],C,!0),z.restoreDefaultFramebuffer(),z._releaseTexture(G),f&&f.dispose(),C._swapAndDie(G),G.isReady=!0}))}))};f&&(m?C():u.onLoadObservable.addOnce(C))}static EncodeTextureToRGBD(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,z.e)("rgbdEncode",u,G,s,1,5)}}},10881:(u,G,s)=>{"use strict";s.d(G,{b:()=>z,e:()=>T});class T{constructor(u){this.length=0,this.data=new Array(u),this._id=T._GlobalId++}push(u){this.data[this.length++]=u,this.length>this.data.length&&(this.data.length*=2)}forEach(u){for(let G=0;G<this.length;G++)u(this.data[G])}sort(u){this.data.sort(u)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(u){if(0!==u.length){this.length+u.length>this.data.length&&(this.data.length=2*(this.length+u.length));for(let G=0;G<u.length;G++)this.data[this.length++]=(u.data||u)[G]}}indexOf(u){const G=this.data.indexOf(u);return G>=this.length?-1:G}contains(u){return-1!==this.indexOf(u)}}T._GlobalId=0;class z extends T{constructor(){super(...arguments),this._duplicateId=0}push(u){super.push(u),u.__smartArrayFlags||(u.__smartArrayFlags={}),u.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(u){return(!u.__smartArrayFlags||u.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(u),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(u){if(0!==u.length){this.length+u.length>this.data.length&&(this.data.length=2*(this.length+u.length));for(let G=0;G<u.length;G++){const s=(u.data||u)[G];this.pushNoDuplicate(s)}}}}},10627:(u,G,s)=>{"use strict";s.d(G,{e:()=>m,h:()=>O,j:()=>T,k:()=>z});const T=u=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(u);let G="";for(let s=0;s<u.byteLength;s++)G+=String.fromCharCode(u[s]);return G},z=u=>{const G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s,T,z,O,m,f,C,x="",g=0;const b=ArrayBuffer.isView(u)?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):new Uint8Array(u);for(;g<b.length;)s=b[g++],T=g<b.length?b[g++]:Number.NaN,z=g<b.length?b[g++]:Number.NaN,O=s>>2,m=(3&s)<<4|T>>4,f=(15&T)<<2|z>>6,C=63&z,isNaN(T)?f=C=64:isNaN(z)&&(C=64),x+=G.charAt(O)+G.charAt(m)+G.charAt(f)+G.charAt(C);return x},O=u=>atob(u),m=u=>{const G=O(u),s=G.length,T=new Uint8Array(new ArrayBuffer(s));for(let z=0;z<s;z++)T[z]=G.charCodeAt(z);return T.buffer}},10896:(u,G,s)=>{"use strict";s.d(G,{c:()=>z});class T{static Eval(u,G){return"true"===(u=u.match(/\([^()]*\)/g)?u.replace(/\([^()]*\)/g,(u=>(u=u.slice(1,u.length-1),T._HandleParenthesisContent(u,G)))):T._HandleParenthesisContent(u,G))||"false"!==u&&T.Eval(u,G)}static _HandleParenthesisContent(u,G){let s;G=G||(u=>"true"===u);const z=u.split("||");for(const O in z)if(Object.prototype.hasOwnProperty.call(z,O)){let u=T._SimplifyNegation(z[O].trim());const m=u.split("&&");if(m.length>1)for(let z=0;z<m.length;++z){const O=T._SimplifyNegation(m[z].trim());if(s="true"!==O&&"false"!==O?"!"===O[0]?!G(O.substring(1)):G(O):"true"===O,!s){u="false";break}}if(s||"true"===u){s=!0;break}s="true"!==u&&"false"!==u?"!"===u[0]?!G(u.substring(1)):G(u):"true"===u}return s?"true":"false"}static _SimplifyNegation(u){return"!true"===(u=(u=u.replace(/^[\s!]+/,(u=>(u=u.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?u="false":"!false"===u&&(u="true"),u}}class z{static EnableFor(u){u._tags=u._tags||{},u.hasTags=()=>z.HasTags(u),u.addTags=G=>z.AddTagsTo(u,G),u.removeTags=G=>z.RemoveTagsFrom(u,G),u.matchesTagsQuery=G=>z.MatchesQuery(u,G)}static DisableFor(u){delete u._tags,delete u.hasTags,delete u.addTags,delete u.removeTags,delete u.matchesTagsQuery}static HasTags(u){if(!u._tags)return!1;const G=u._tags;for(const s in G)if(Object.prototype.hasOwnProperty.call(G,s))return!0;return!1}static GetTags(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!u._tags)return null;if(G){const G=[];for(const s in u._tags)Object.prototype.hasOwnProperty.call(u._tags,s)&&!0===u._tags[s]&&G.push(s);return G.join(" ")}return u._tags}static AddTagsTo(u,G){if(!G)return;if("string"!==typeof G)return;G.split(" ").forEach((function(G){z._AddTagTo(u,G)}))}static _AddTagTo(u,G){""!==(G=G.trim())&&"true"!==G&&"false"!==G&&(G.match(/[\s]/)||G.match(/^([!]|([|]|[&]){2})/)||(z.EnableFor(u),u._tags[G]=!0))}static RemoveTagsFrom(u,G){if(!z.HasTags(u))return;const s=G.split(" ");for(const T in s)z._RemoveTagFrom(u,s[T])}static _RemoveTagFrom(u,G){delete u._tags[G]}static MatchesQuery(u,G){return void 0===G||(""===G?z.HasTags(u):T.Eval(G,(G=>z.HasTags(u)&&u._tags[G])))}}},11399:(u,G,s)=>{"use strict";s.d(G,{e:()=>C,g:()=>Q,h:()=>b});s(11102),s(11407);var T=s(11412),z=s(10645),O=s(10715),m=s(10935);class f extends T.c{getClassName(){return"PassPostProcess"}constructor(u,G){super(u,"pass",null,null,G,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(u,G){u?(this._webGPUReady=!0,G.push(Promise.all([s.e(33).then(s.bind(s,13117))]))):G.push(Promise.all([s.e(34).then(s.bind(s,13121))])),super._gatherImports(u,G)}static _Parse(u,G,s,T){return m.e.Parse((()=>new f(u.name,u.options,G,u.renderTargetSamplingMode,u._engine,u.reusable)),u,s,T)}}(0,O.g)("BABYLON.PassPostProcess",f);T.c;function C(u,G,s,z,O,m,f,C){const x=G.getEngine();return G.isReady=!1,O=O??G.samplingMode,z=z??G.type,m=m??G.format,f=f??G.width,C=C??G.height,-1===z&&(z=0),new Promise((g=>{const b=new T.c("postprocess",u,null,null,1,null,O,x,!1,void 0,z,void 0,null,!1,m);b.externalTextureSamplerBinding=!0;const Q=x.createRenderTargetTexture({width:f,height:C},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O,type:z,format:m});b.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled((()=>{b.onApply=u=>{u._bindTexture("textureSampler",G),u.setFloat2("scale",1,1)},s.postProcessManager.directRender([b],Q,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(G),b&&b.dispose(),Q._swapAndDie(G),G.type=z,G.format=5,G.isReady=!0,g(G)}))}))}))}let x,g;function b(u){x||(x=new Float32Array(1),g=new Int32Array(x.buffer)),x[0]=u;const G=g[0];let s=G>>16&32768,T=G>>12&2047;const z=G>>23&255;return z<103?s:z>142?(s|=31744,s|=(255==z?0:1)&&8388607&G,s):z<113?(T|=2048,s|=(T>>114-z)+(T>>113-z&1),s):(s|=z-112<<10|T>>1,s+=1&T,s)}function Q(u){const G=(32768&u)>>15,s=(31744&u)>>10,T=1023&u;return 0===s?(G?-1:1)*Math.pow(2,-14)*(T/Math.pow(2,10)):31==s?T?NaN:1/0*(G?-1:1):(G?-1:1)*Math.pow(2,s-15)*(1+T/Math.pow(2,10))}z.b._RescalePostProcessFactory=u=>new f("rescale",1,null,2,u,!1,0)},10640:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});var T=s(10577);class z{static SetImmediate(u){(0,T.k)()&&window.setImmediate?window.setImmediate(u):setTimeout(u,1)}}},10725:(u,G,s)=>{"use strict";function T(u){let G=1;do{G*=2}while(G<u);return G===u}function z(u,G,s){return u*(1-s)+G*s}function O(u){const G=m(u),s=f(u);return G-u>u-s?s:G}function m(u){return u--,u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,u|=u>>16,++u}function f(u){return u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,(u|=u>>16)-(u>>1)}function C(u,G){let s;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:s=f(u);break;case 2:s=O(u);break;default:s=m(u)}return Math.min(s,G)}s.d(G,{e:()=>f,h:()=>C,k:()=>T,m:()=>z,n:()=>O})},10564:(u,G,s)=>{"use strict";s.d(G,{d:()=>r,e:()=>F});var T=s(10568),z=s(10577),O=s(10584),m=s(10592),f=s(10601),C=s(10609),x=s(10615),g=s(10619),b=s(10622),Q=s(10640),Y=s(10707),n=s(10720),V=s(10725);class F{static get BaseUrl(){return b.e.BaseUrl}static set BaseUrl(u){b.e.BaseUrl=u}static get CleanUrl(){return b.e.CleanUrl}static set CleanUrl(u){b.e.CleanUrl=u}static IsAbsoluteUrl(u){return 0===u.indexOf("//")||-1!==u.indexOf("://")&&(-1!==u.indexOf(".")&&(-1!==u.indexOf("/")&&(!(u.indexOf(":")>u.indexOf("/"))&&(u.indexOf("://")<u.indexOf(".")||(0===u.indexOf("data:")||0===u.indexOf("blob:"))))))}static set ScriptBaseUrl(u){b.e.ScriptBaseUrl=u}static get ScriptBaseUrl(){return b.e.ScriptBaseUrl}static set ScriptPreprocessUrl(u){b.e.ScriptPreprocessUrl=u}static get ScriptPreprocessUrl(){return b.e.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return b.e.DefaultRetryStrategy}static set DefaultRetryStrategy(u){b.e.DefaultRetryStrategy=u}static get CorsBehavior(){return b.e.CorsBehavior}static set CorsBehavior(u){b.e.CorsBehavior=u}static get UseFallbackTexture(){return g.d.UseFallbackTexture}static set UseFallbackTexture(u){g.d.UseFallbackTexture=u}static get RegisteredExternalClasses(){return Y.e.RegisteredExternalClasses}static set RegisteredExternalClasses(u){Y.e.RegisteredExternalClasses=u}static get fallbackTexture(){return g.d.FallbackTexture}static set fallbackTexture(u){g.d.FallbackTexture=u}static FetchToRef(u,G,s,T,z,O){const m=4*((Math.abs(u)*s%s|0)+(Math.abs(G)*T%T|0)*s);O.r=z[m]/255,O.g=z[m+1]/255,O.b=z[m+2]/255,O.a=z[m+3]/255}static Mix(u,G,s){return 0}static Instantiate(u){return Y.e.Instantiate(u)}static SetImmediate(u){Q.e.SetImmediate(u)}static IsExponentOfTwo(u){return!0}static FloatRound(u){return Math.fround(u)}static GetFilename(u){const G=u.lastIndexOf("/");return G<0?u:u.substring(G+1)}static GetFolderPath(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=u.lastIndexOf("/");return s<0?G?u:"":u.substring(0,s+1)}static ToDegrees(u){return 180*u/Math.PI}static ToRadians(u){return u*Math.PI/180}static SmoothAngleChange(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const T=this.ToRadians(u),z=this.ToRadians(G);return this.ToDegrees(Math.atan2((1-s)*Math.sin(z)+s*Math.sin(T),(1-s)*Math.cos(z)+s*Math.cos(T)))}static MakeArray(u,G){return!0===G||void 0!==u&&null!=u?Array.isArray(u)?u:[u]:null}static GetPointerPrefix(u){return(0,z.k)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(u,G){(0,b.q)(u,G)}static SetReferrerPolicyBehavior(u,G){G.referrerPolicy=u}static get PreprocessUrl(){return b.e.PreprocessUrl}static set PreprocessUrl(u){b.e.PreprocessUrl=u}static LoadImage(u,G,s,T,z,O){return(0,b.l)(u,G,s,T,z,O)}static LoadFile(u,G,s,T,z,O){return(0,b.j)(u,G,s,T,z,O)}static LoadFileAsync(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((s,T)=>{(0,b.j)(u,(u=>{s(u)}),void 0,void 0,G,((u,G)=>{T(G)}))}))}static GetBabylonScriptURL(u,G){if(!u)return"";if(F.ScriptBaseUrl&&u.startsWith(F._DefaultCdnUrl)){const G="/"===F.ScriptBaseUrl[F.ScriptBaseUrl.length-1]?F.ScriptBaseUrl.substring(0,F.ScriptBaseUrl.length-1):F.ScriptBaseUrl;u=u.replace(F._DefaultCdnUrl,G)}return u=F.ScriptPreprocessUrl(u),G&&(u=F.GetAbsoluteUrl(u)),u}static LoadBabylonScript(u,G,s,T){u=F.GetBabylonScriptURL(u),F.LoadScript(u,G,s)}static LoadBabylonScriptAsync(u){return u=F.GetBabylonScriptURL(u),F.LoadScriptAsync(u)}static LoadScript(u,G,s,T){let O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(u),G&&G()}catch(C){null===s||void 0===s||s(`Unable to load script '${u}' in worker`,C)}return}if(!(0,z.k)())return void(null===s||void 0===s||s(`Cannot load script '${u}' outside of a window or a worker`));const m=document.getElementsByTagName("head")[0],f=document.createElement("script");O?(f.setAttribute("type","module"),f.innerText=u):(f.setAttribute("type","text/javascript"),f.setAttribute("src",u)),T&&(f.id=T),f.onload=()=>{G&&G()},f.onerror=G=>{s&&s(`Unable to load script '${u}'`,G)},m.appendChild(f)}static LoadScriptAsync(u,G){return new Promise(((s,T)=>{this.LoadScript(u,(()=>{s()}),((u,G)=>{T(G||new Error(u))}),G)}))}static ReadFileAsDataURL(u,G,s){const z=new FileReader,O={onCompleteObservable:new T.e,abort:()=>z.abort()};return z.onloadend=()=>{O.onCompleteObservable.notifyObservers(O)},z.onload=u=>{G(u.target.result)},z.onprogress=s,z.readAsDataURL(u),O}static ReadFile(u,G,s,T,z){return(0,b.m)(u,G,s,T,z)}static FileAsURL(u){const G=new Blob([u]);return window.URL.createObjectURL(G)}static Format(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return u.toFixed(G)}static DeepCopy(u,G,s,T){m.e.DeepCopy(u,G,s,T)}static IsEmpty(u){for(const G in u)if(Object.prototype.hasOwnProperty.call(u,G))return!1;return!0}static RegisterTopRootEvents(u,G){for(let T=0;T<G.length;T++){const z=G[T];u.addEventListener(z.name,z.handler,!1);try{window.parent&&window.parent.addEventListener(z.name,z.handler,!1)}catch(s){}}}static UnregisterTopRootEvents(u,G){for(let T=0;T<G.length;T++){const z=G[T];u.removeEventListener(z.name,z.handler);try{u.parent&&u.parent.removeEventListener(z.name,z.handler)}catch(s){}}}static async DumpFramebuffer(u,G,s,T){throw(0,C.c)("DumpTools")}static DumpData(u,G,s,T){throw(0,C.c)("DumpTools")}static DumpDataAsync(u,G,s){throw(0,C.c)("DumpTools")}static _IsOffScreenCanvas(u){return void 0!==u.convertToBlob}static ToBlob(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",T=arguments.length>3?arguments[3]:void 0;F._IsOffScreenCanvas(u)||u.toBlob||(u.toBlob=function(u,G,s){setTimeout((()=>{const T=atob(this.toDataURL(G,s).split(",")[1]),z=T.length,O=new Uint8Array(z);for(let u=0;u<z;u++)O[u]=T.charCodeAt(u);u(new Blob([O]))}))}),F._IsOffScreenCanvas(u)?u.convertToBlob({type:s,quality:T}).then((u=>G(u))):u.toBlob((function(u){G(u)}),s,T)}static DownloadBlob(u,G){if("download"in document.createElement("a")){if(!G){const u=new Date;G="screenshot_"+((u.getFullYear()+"-"+(u.getMonth()+1)).slice(2)+"-"+u.getDate()+"_"+u.getHours()+"-"+("0"+u.getMinutes()).slice(-2))+".png"}F.Download(u,G)}else if(u&&"undefined"!==typeof URL){const G=URL.createObjectURL(u),s=window.open("");if(!s)return;const T=s.document.createElement("img");T.onload=function(){URL.revokeObjectURL(G)},T.src=G,s.document.body.appendChild(T)}}static EncodeScreenshotCanvasData(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;if("string"!==typeof T&&G){if(G){if(F._IsOffScreenCanvas(u))return void u.convertToBlob({type:s,quality:z}).then((u=>{const s=new FileReader;s.readAsDataURL(u),s.onloadend=()=>{const u=s.result;G(u)}}));const T=u.toDataURL(s,z);G(T)}}else this.ToBlob(u,(function(u){u&&F.DownloadBlob(u,T),G&&G("")}),s,z)}static Download(u,G){if("undefined"===typeof URL)return;const s=window.URL.createObjectURL(u),T=document.createElement("a");document.body.appendChild(T),T.style.display="none",T.href=s,T.download=G,T.addEventListener("click",(()=>{T.parentElement&&T.parentElement.removeChild(T)})),T.click(),window.URL.revokeObjectURL(s)}static BackCompatCameraNoPreventDefault(u){return"boolean"===typeof u[0]?u[0]:"boolean"===typeof u[1]&&u[1]}static CreateScreenshot(u,G,s,T){throw(0,C.c)("ScreenshotTools")}static CreateScreenshotAsync(u,G,s){throw(0,C.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(u,G,s,T){throw(0,C.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(u,G,s){throw(0,C.c)("ScreenshotTools")}static RandomId(){return(0,n.c)()}static IsBase64(u){return(0,b.f)(u)}static DecodeBase64(u){return(0,b.c)(u)}static get errorsCount(){return O.d.errorsCount}static Log(u){O.d.Log(u)}static Warn(u){O.d.Warn(u)}static Error(u){O.d.Error(u)}static get LogCache(){return O.d.LogCache}static ClearLogCache(){O.d.ClearLogCache()}static set LogLevels(u){O.d.LogLevels=u}static set PerformanceLogLevel(u){return(u&F.PerformanceUserMarkLogLevel)===F.PerformanceUserMarkLogLevel?(F.StartPerformanceCounter=F._StartUserMark,void(F.EndPerformanceCounter=F._EndUserMark)):(u&F.PerformanceConsoleLogLevel)===F.PerformanceConsoleLogLevel?(F.StartPerformanceCounter=F._StartPerformanceConsole,void(F.EndPerformanceCounter=F._EndPerformanceConsole)):(F.StartPerformanceCounter=F._StartPerformanceCounterDisabled,void(F.EndPerformanceCounter=F._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(u,G){}static _EndPerformanceCounterDisabled(u,G){}static _StartUserMark(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!F._Performance){if(!(0,z.k)())return;F._Performance=window.performance}G&&F._Performance.mark&&F._Performance.mark(u+"-Begin")}static _EndUserMark(u){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&F._Performance.mark&&(F._Performance.mark(u+"-End"),F._Performance.measure(u,u+"-Begin",u+"-End"))}static _StartPerformanceConsole(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];G&&(F._StartUserMark(u,G),console.time&&console.time(u))}static _EndPerformanceConsole(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];G&&(F._EndUserMark(u,G),console.timeEnd(u))}static get Now(){return f.e.Now}static GetClassName(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=null;if(!G&&u.getClassName)s=u.getClassName();else{if(u instanceof Object){s=(G?u:Object.getPrototypeOf(u)).constructor.__bjsclassName__}s||(s=typeof u)}return s}static First(u,G){for(const s of u)if(G(s))return s;return null}static getFullClassName(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=null,T=null;if(!G&&u.getClassName)s=u.getClassName();else{if(u instanceof Object){const z=G?u:Object.getPrototypeOf(u);s=z.constructor.__bjsclassName__,T=z.constructor.__bjsmoduleName__}s||(s=typeof u)}return s?(null!=T?T+".":"")+s:null}static DelayAsync(u){return new Promise((G=>{setTimeout((()=>{G()}),u)}))}static IsSafari(){return!!(0,z.h)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}F.UseCustomRequestHeaders=!1,F.CustomRequestHeaders=x.e.CustomRequestHeaders,F.GetDOMTextContent=z.b,F._DefaultCdnUrl="https://cdn.babylonjs.com",F.GetAbsoluteUrl="object"===typeof document?u=>{const G=document.createElement("a");return G.href=u,G.href}:"function"===typeof URL&&"object"===typeof location?u=>new URL(u,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},F.NoneLogLevel=O.d.NoneLogLevel,F.MessageLogLevel=O.d.MessageLogLevel,F.WarningLogLevel=O.d.WarningLogLevel,F.ErrorLogLevel=O.d.ErrorLogLevel,F.AllLogLevel=O.d.AllLogLevel,F.IsWindowObjectExist=z.k,F.PerformanceNoneLogLevel=0,F.PerformanceUserMarkLogLevel=1,F.PerformanceConsoleLogLevel=2,F.StartPerformanceCounter=F._StartPerformanceCounterDisabled,F.EndPerformanceCounter=F._EndPerformanceCounterDisabled;class r{constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=u,this.index=T-1,this._done=!1,this._fn=G,this._successCallback=s}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(u,G,s){const T=new r(u,G,s,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return T.executeNext(),T}static SyncAsyncForLoop(u,G,s,T,z){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return r.Run(Math.ceil(u/G),(T=>{z&&z()?T.breakLoop():setTimeout((()=>{for(let O=0;O<G;++O){const m=T.index*G+O;if(m>=u)break;if(s(m),z&&z()){T.breakLoop();break}}T.executeNext()}),O)}),T)}}F.Mix=V.m,F.IsExponentOfTwo=V.k,g.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10715:(u,G,s)=>{"use strict";s.d(G,{e:()=>O,g:()=>z});const T={};function z(u,G){T[u]=G}function O(u){return T[u]}},11021:(u,G,s)=>{"use strict";s.d(G,{c:()=>T});class T{static get UniqueId(){const u=this._UniqueIdCounter;return this._UniqueIdCounter++,u}}T._UniqueIdCounter=1},10615:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(T.CustomRequestHeaders).length>0||T.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const u in T.CustomRequestHeaders){const G=T.CustomRequestHeaders[u];G&&this._xhr.setRequestHeader(u,G)}}_shouldSkipRequestModifications(u){return T.SkipRequestModificationForBabylonCDN&&(u.includes("preview.babylonjs.com")||u.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(u){this._xhr.onprogress=u}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(u){this._xhr.responseType=u}get timeout(){return this._xhr.timeout}set timeout(u){this._xhr.timeout=u}addEventListener(u,G,s){this._xhr.addEventListener(u,G,s)}removeEventListener(u,G,s){this._xhr.removeEventListener(u,G,s)}abort(){this._xhr.abort()}send(u){T.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(u)}open(u,G){for(const s of T.CustomRequestModifiers){if(this._shouldSkipRequestModifications(G))return;s(this._xhr,G)}G=(G=G.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=G,this._xhr.open(u,G,!0)}setRequestHeader(u,G){this._xhr.setRequestHeader(u,G)}getResponseHeader(u){return this._xhr.getResponseHeader(u)}}T.CustomRequestHeaders={},T.CustomRequestModifiers=new Array,T.SkipRequestModificationForBabylonCDN=!0},11927:(u,G,s)=>{"use strict";s.d(G,{e:()=>z});class T{constructor(u){this._pendingActions=new Array,this._workerInfos=u.map((u=>({workerPromise:Promise.resolve(u),idle:!0})))}dispose(){for(const u of this._workerInfos)u.workerPromise.then((u=>{u.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(u){this._executeOnIdleWorker(u)||this._pendingActions.push(u)}_executeOnIdleWorker(u){for(const G of this._workerInfos)if(G.idle)return this._execute(G,u),!0;return!1}_execute(u,G){u.idle=!1,u.workerPromise.then((s=>{G(s,(()=>{const G=this._pendingActions.shift();G?this._execute(u,G):u.idle=!0}))}))}}class z extends T{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.DefaultOptions;super([]),this._maxWorkers=u,this._createWorkerAsync=G,this._options=s}push(u){if(!this._executeOnIdleWorker(u))if(this._workerInfos.length<this._maxWorkers){const G={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(G),this._execute(G,u)}else this._pendingActions.push(u)}_execute(u,G){u.timeoutId&&(clearTimeout(u.timeoutId),delete u.timeoutId),super._execute(u,((s,T)=>{G(s,(()=>{T(),u.idle&&(u.timeoutId=setTimeout((()=>{u.workerPromise.then((u=>{u.terminate()}));const G=this._workerInfos.indexOf(u);-1!==G&&this._workerInfos.splice(G,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}z.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11304:(u,G,s)=>{"use strict";s.d(G,{b:()=>ru});var T=s(10904),z=s(11091);class O extends z.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var m=s(10930),f=(s(11308),s(10715));class C{get noiseTexture(){return this._noiseTexture}set noiseTexture(u){this._noiseTexture!==u&&(this._noiseTexture=u,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(u){this._isAnimationSheetEnabled!=u&&(this._isAnimationSheetEnabled=u,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(u){this._useLogarithmicDepth=u&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:T.q.Zero()}set direction1(u){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=u)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:T.q.Zero()}set direction2(u){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=u)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:T.q.Zero()}set minEmitBox(u){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=u)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:T.q.Zero()}set maxEmitBox(u){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=u)}get billboardMode(){return this._billboardMode}set billboardMode(u){this._billboardMode!==u&&(this._billboardMode=u,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(u){this._isBillboardBased!==u&&(this._isBillboardBased=u,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u)}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(!u&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=u)}_reset(){}_removeGradientAndTexture(u,G,s){if(!G)return this;let T=0;for(const z of G){if(z.gradient===u){G.splice(T,1);break}T++}return s&&s.dispose(),this}constructor(u){this.animations=[],this.renderingGroupId=0,this.k=T.q.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new T.q(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new T.m(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gf=new T.q(0,0,0),this._useLogarithmicDepth=!1,this.gravity=T.q.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new m.e(1,1,1,1),this.color2=new m.e(1,1,1,1),this.colorDead=new m.e(0,0,0,1),this.textureMask=new m.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new O,this.id=u,this.name=u}createPointEmitter(u,G){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new T.q(0,1,0),arguments.length>2&&void 0!==arguments[2]||new T.q(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new T.q(0,1,0),arguments.length>4&&void 0!==arguments[4]||new T.q(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new T.q(0,1,0),arguments.length>3&&void 0!==arguments[3]||new T.q(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(u,G,s,T){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,(0,f.g)("BABYLON.BaseParticleSystem",C);var x=s(10924),g=s(10592);class b{constructor(){this.direction1=new T.q(0,1,0),this.direction2=new T.q(0,1,0),this.minEmitBox=new T.q(-.5,-.5,-.5),this.maxEmitBox=new T.q(.5,.5,.5)}startDirectionFunction(u,G,s,z){const O=(0,x.q)(this.direction1.x,this.direction2.x),m=(0,x.q)(this.direction1.y,this.direction2.y),f=(0,x.q)(this.direction1.z,this.direction2.z);if(z)return G.x=O,G.y=m,void(G.z=f);T.q.TransformNormalFromFloatsToRef(O,m,f,u,G)}startPositionFunction(u,G,s,z){const O=(0,x.q)(this.minEmitBox.x,this.maxEmitBox.x),m=(0,x.q)(this.minEmitBox.y,this.maxEmitBox.y),f=(0,x.q)(this.minEmitBox.z,this.maxEmitBox.z);if(z)return G.x=O,G.y=m,void(G.z=f);T.q.TransformCoordinatesFromFloatsToRef(O,m,f,u,G)}clone(){const u=new b;return g.e.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2),u.setVector3("minEmitBox",this.minEmitBox),u.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3),u.addUniform("minEmitBox",3),u.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.direction1=this.direction1.$i(),u.direction2=this.direction2.$i(),u.minEmitBox=this.minEmitBox.$i(),u.maxEmitBox=this.maxEmitBox.$i(),u}parse(u){T.q.FromArrayToRef(u.direction1,0,this.direction1),T.q.FromArrayToRef(u.direction2,0,this.direction2),T.q.FromArrayToRef(u.minEmitBox,0,this.minEmitBox),T.q.FromArrayToRef(u.maxEmitBox,0,this.maxEmitBox)}}class Q{get i(){return this._radius}set i(u){this._radius=u,this._buildHeight()}get angle(){return this._angle}set angle(u){this._angle=u,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=s,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=G,this.i=u}startDirectionFunction(u,G,s,z){z?T.l.gb[0].p(s.pf).normalize():s.position.subtractToRef(u.getTranslation(),T.l.gb[0]).normalize();const O=(0,x.q)(0,this.directionRandomizer),m=(0,x.q)(0,this.directionRandomizer),f=(0,x.q)(0,this.directionRandomizer);G.x=T.l.gb[0].x+O,G.y=T.l.gb[0].y+m,G.z=T.l.gb[0].z+f,G.normalize()}startPositionFunction(u,G,s,z){const O=(0,x.q)(0,2*Math.PI);let m;this.emitFromSpawnPointOnly?m=1e-4:(m=(0,x.q)(0,this.heightRange),m=1-m*m);let f=this._radius-(0,x.q)(0,this._radius*this.radiusRange);f*=m;const C=f*Math.sin(O),g=f*Math.cos(O),b=m*this._height;if(z)return G.x=C,G.y=b,void(G.z=g);T.q.TransformCoordinatesFromFloatsToRef(C,b,g,u,G)}clone(){const u=new Q(this._radius,this._angle,this.directionRandomizer);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat2("i",this._radius,this.radiusRange),u.setFloat("coneAngle",this._angle),u.setFloat2("height",this._height,this.heightRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("i",2),u.addUniform("coneAngle",1),u.addUniform("height",2),u.addUniform("directionRandomizer",1)}getEffectDefines(){let u="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(u+="\n#define CONEEMITTERSPAWNPOINT"),u}getClassName(){return"ConeParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.i=this._radius,u.angle=this._angle,u.directionRandomizer=this.directionRandomizer,u.radiusRange=this.radiusRange,u.heightRange=this.heightRange,u.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,u}parse(u){this.i=u.i,this.angle=u.angle,this.directionRandomizer=u.directionRandomizer,this.radiusRange=void 0!==u.radiusRange?u.radiusRange:1,this.heightRange=void 0!==u.radiusRange?u.heightRange:1,this.emitFromSpawnPointOnly=void 0!==u.emitFromSpawnPointOnly&&u.emitFromSpawnPointOnly}}class Y extends Q{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0);super(u,G),this.direction1=s,this.direction2=z}startDirectionFunction(u,G){const s=(0,x.q)(this.direction1.x,this.direction2.x),z=(0,x.q)(this.direction1.y,this.direction2.y),O=(0,x.q)(this.direction1.z,this.direction2.z);T.q.TransformNormalFromFloatsToRef(s,z,O,u,G)}clone(){const u=new Y(this.i,this.angle,this.direction1,this.direction2);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.$i(),u.direction2=this.direction2.$i(),u}parse(u){super.parse(u),this.direction1.p(u.direction1),this.direction2.p(u.direction2)}}class n{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=u,this.height=G,this.radiusRange=s,this.directionRandomizer=z,this._tempVector=T.q.Zero()}startDirectionFunction(u,G,s,z,O){s.position.subtractToRef(u.getTranslation(),this._tempVector),this._tempVector.normalize(),T.q.TransformNormalToRef(this._tempVector,O,this._tempVector);const m=(0,x.q)(-this.directionRandomizer/2,this.directionRandomizer/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,x.q)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=m,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),z?G.p(this._tempVector):T.q.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,u,G)}startPositionFunction(u,G,s,z){const O=(0,x.q)(-this.height/2,this.height/2),m=(0,x.q)(0,2*Math.PI),f=(0,x.q)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(f)*this.i,g=C*Math.cos(m),b=C*Math.sin(m);z?G.hf(g,O,b):T.q.TransformCoordinatesFromFloatsToRef(g,O,b,u,G)}clone(){const u=new n(this.i,this.directionRandomizer);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("height",this.height),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("height",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.i=this.i,u.height=this.height,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.i=u.i,this.height=u.height,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class V extends n{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.q(0,1,0);super(u,G,s),this.direction1=z,this.direction2=O}startDirectionFunction(u,G,s,z){const O=(0,x.q)(this.direction1.x,this.direction2.x),m=(0,x.q)(this.direction1.y,this.direction2.y),f=(0,x.q)(this.direction1.z,this.direction2.z);z?G.hf(O,m,f):T.q.TransformNormalFromFloatsToRef(O,m,f,u,G)}clone(){const u=new V(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("height",this.height),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("height",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.$i(),u.direction2=this.direction2.$i(),u}parse(u){super.parse(u),T.q.FromArrayToRef(u.direction1,0,this.direction1),T.q.FromArrayToRef(u.direction2,0,this.direction2)}}class F{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=u,this.radiusRange=G,this.directionRandomizer=s}startDirectionFunction(u,G,s,z){const O=s.position.Nc(u.getTranslation()).normalize(),m=(0,x.q)(0,this.directionRandomizer),f=(0,x.q)(0,this.directionRandomizer),C=(0,x.q)(0,this.directionRandomizer);O.x+=m,O.y+=f,O.z+=C,O.normalize(),z?G.p(O):T.q.TransformNormalFromFloatsToRef(O.x,O.y,O.z,u,G)}startPositionFunction(u,G,s,z){const O=this.i-(0,x.q)(0,this.i*this.radiusRange),m=(0,x.q)(0,1),f=(0,x.q)(0,2*Math.PI),C=Math.acos(2*m-1),g=O*Math.cos(f)*Math.sin(C),b=O*Math.cos(C),Q=O*Math.sin(f)*Math.sin(C);z?G.hf(g,Math.abs(b),Q):T.q.TransformCoordinatesFromFloatsToRef(g,Math.abs(b),Q,u,G)}clone(){const u=new F(this.i,this.directionRandomizer);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.i=this.i,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.i=u.i,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class r{constructor(){this.direction1=new T.q(0,1,0),this.direction2=new T.q(0,1,0)}startDirectionFunction(u,G,s,z){const O=(0,x.q)(this.direction1.x,this.direction2.x),m=(0,x.q)(this.direction1.y,this.direction2.y),f=(0,x.q)(this.direction1.z,this.direction2.z);z?G.hf(O,m,f):T.q.TransformNormalFromFloatsToRef(O,m,f,u,G)}startPositionFunction(u,G,s,z){z?G.hf(0,0,0):T.q.TransformCoordinatesFromFloatsToRef(0,0,0,u,G)}clone(){const u=new r;return g.e.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.direction1=this.direction1.$i(),u.direction2=this.direction2.$i(),u}parse(u){T.q.FromArrayToRef(u.direction1,0,this.direction1),T.q.FromArrayToRef(u.direction2,0,this.direction2)}}class c{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=u,this.radiusRange=G,this.directionRandomizer=s}startDirectionFunction(u,G,s,z){const O=s.position.Nc(u.getTranslation()).normalize(),m=(0,x.q)(0,this.directionRandomizer),f=(0,x.q)(0,this.directionRandomizer),C=(0,x.q)(0,this.directionRandomizer);O.x+=m,O.y+=f,O.z+=C,O.normalize(),z?G.p(O):T.q.TransformNormalFromFloatsToRef(O.x,O.y,O.z,u,G)}startPositionFunction(u,G,s,z){const O=this.i-(0,x.q)(0,this.i*this.radiusRange),m=(0,x.q)(0,1),f=(0,x.q)(0,2*Math.PI),C=Math.acos(2*m-1),g=O*Math.cos(f)*Math.sin(C),b=O*Math.cos(C),Q=O*Math.sin(f)*Math.sin(C);z?G.hf(g,b,Q):T.q.TransformCoordinatesFromFloatsToRef(g,b,Q,u,G)}clone(){const u=new c(this.i,this.directionRandomizer);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("radiusRange",this.radiusRange),u.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("radiusRange",1),u.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.i=this.i,u.radiusRange=this.radiusRange,u.directionRandomizer=this.directionRandomizer,u}parse(u){this.i=u.i,this.radiusRange=u.radiusRange,this.directionRandomizer=u.directionRandomizer}}class j extends c{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.q(0,1,0),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0);super(u),this.direction1=G,this.direction2=s}startDirectionFunction(u,G){const s=(0,x.q)(this.direction1.x,this.direction2.x),z=(0,x.q)(this.direction1.y,this.direction2.y),O=(0,x.q)(this.direction1.z,this.direction2.z);T.q.TransformNormalFromFloatsToRef(s,z,O,u,G)}clone(){const u=new j(this.i,this.direction1,this.direction2);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setFloat("i",this.i),u.setFloat("radiusRange",this.radiusRange),u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("i",1),u.addUniform("radiusRange",1),u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const u=super.serialize();return u.direction1=this.direction1.$i(),u.direction2=this.direction2.$i(),u}parse(u){super.parse(u),this.direction1.p(u.direction1),this.direction2.p(u.direction2)}}class l{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(u,G,s,z){const O=T.l.gb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,s,O);const u=T.l.gb[1];O.subtractToRef(s.position,u),u.scaleToRef(1/s.lifeTime,O)}else O.set(0,0,0);z?G.p(O):T.q.TransformNormalToRef(O,u,G)}startPositionFunction(u,G,s,z){const O=T.l.gb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,s,O):O.set(0,0,0),z?G.p(O):T.q.TransformCoordinatesToRef(O,u,G)}clone(){const u=new l;return g.e.DeepCopy(this,u),u}applyToShader(u){}buildUniformLayout(u){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const u={};return u.type=this.getClassName(),u.particlePositionGenerator=this.particlePositionGenerator,u.particleDestinationGenerator=this.particleDestinationGenerator,u}parse(u){u.particlePositionGenerator&&(this.particlePositionGenerator=u.particlePositionGenerator),u.particleDestinationGenerator&&(this.particleDestinationGenerator=u.particleDestinationGenerator)}}var P=s(10961);class H{get mesh(){return this.Ok}set mesh(u){this.Ok!==u&&(this.Ok=u,u?(this._indices=u.kf(),this._positions=u.getVerticesData(P.f.PositionKind),this._normals=u.getVerticesData(P.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=T.q.Zero(),this.Ok=null,this.direction1=new T.q(0,1,0),this.direction2=new T.q(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=u}startDirectionFunction(u,G,s,z){if(this.useMeshNormalsForDirection&&this._normals)return void T.q.TransformNormalToRef(this._storedNormal,u,G);const O=(0,x.q)(this.direction1.x,this.direction2.x),m=(0,x.q)(this.direction1.y,this.direction2.y),f=(0,x.q)(this.direction1.z,this.direction2.z);z?G.hf(O,m,f):T.q.TransformNormalFromFloatsToRef(O,m,f,u,G)}startPositionFunction(u,G,s,z){if(!this._indices||!this._positions)return;const O=3*Math.random()*(this._indices.length/3)|0,m=Math.random(),f=Math.random()*(1-m),C=1-m-f,x=this._indices[O],g=this._indices[O+1],b=this._indices[O+2],Q=T.l.gb[0],Y=T.l.gb[1],n=T.l.gb[2],V=T.l.gb[3];T.q.FromArrayToRef(this._positions,3*x,Q),T.q.FromArrayToRef(this._positions,3*g,Y),T.q.FromArrayToRef(this._positions,3*b,n),V.x=m*Q.x+f*Y.x+C*n.x,V.y=m*Q.y+f*Y.y+C*n.y,V.z=m*Q.z+f*Y.z+C*n.z,z?G.hf(V.x,V.y,V.z):T.q.TransformCoordinatesFromFloatsToRef(V.x,V.y,V.z,u,G),this.useMeshNormalsForDirection&&this._normals&&(T.q.FromArrayToRef(this._normals,3*x,Q),T.q.FromArrayToRef(this._normals,3*g,Y),T.q.FromArrayToRef(this._normals,3*b,n),this._storedNormal.x=m*Q.x+f*Y.x+C*n.x,this._storedNormal.y=m*Q.y+f*Y.y+C*n.y,this._storedNormal.z=m*Q.z+f*Y.z+C*n.z)}clone(){const u=new H(this.mesh);return g.e.DeepCopy(this,u),u}applyToShader(u){u.setVector3("direction1",this.direction1),u.setVector3("direction2",this.direction2)}buildUniformLayout(u){u.addUniform("direction1",3),u.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var u;const G={};return G.type=this.getClassName(),G.direction1=this.direction1.$i(),G.direction2=this.direction2.$i(),G.meshId=null===(u=this.mesh)||void 0===u?void 0:u.id,G.useMeshNormalsForDirection=this.useMeshNormalsForDirection,G}parse(u,G){T.q.FromArrayToRef(u.direction1,0,this.direction1),T.q.FromArrayToRef(u.direction2,0,this.direction2),u.meshId&&G&&(this.mesh=G.getLastMeshById(u.meshId)),this.useMeshNormalsForDirection=u.useMeshNormalsForDirection}}var X=s(10650);class p{_isUbo(u){return void 0!==u.addUniform}constructor(u){this._isUbo(u)?(this.setMatrix3x3=u.updateMatrix3x3.bind(u),this.setMatrix2x2=u.updateMatrix2x2.bind(u),this.setFloat=u.updateFloat.bind(u),this.setFloat2=u.updateFloat2.bind(u),this.setFloat3=u.updateFloat3.bind(u),this.setFloat4=u.updateFloat4.bind(u),this.setFloatArray=u.updateFloatArray.bind(u),this.setArray=u.updateArray.bind(u),this.setIntArray=u.updateIntArray.bind(u),this.setMatrix=u.xj.bind(u),this.setMatrices=u.updateMatrices.bind(u),this.setVector3=u.updateVector3.bind(u),this.setVector4=u.updateVector4.bind(u),this.setColor3=u.updateColor3.bind(u),this.setColor4=u.updateColor4.bind(u),this.setDirectColor4=u.updateDirectColor4.bind(u),this.setInt=u.updateInt.bind(u),this.setInt2=u.updateInt2.bind(u),this.setInt3=u.updateInt3.bind(u),this.setInt4=u.updateInt4.bind(u)):(this.setMatrix3x3=u.setMatrix3x3.bind(u),this.setMatrix2x2=u.setMatrix2x2.bind(u),this.setFloat=u.setFloat.bind(u),this.setFloat2=u.setFloat2.bind(u),this.setFloat3=u.setFloat3.bind(u),this.setFloat4=u.setFloat4.bind(u),this.setFloatArray=u.setFloatArray.bind(u),this.setArray=u.setArray.bind(u),this.setIntArray=u.setIntArray.bind(u),this.setMatrix=u.setMatrix.bind(u),this.setMatrices=u.setMatrices.bind(u),this.setVector3=u.setVector3.bind(u),this.setVector4=u.setVector4.bind(u),this.setColor3=u.setColor3.bind(u),this.setColor4=u.setColor4.bind(u),this.setDirectColor4=u.setDirectColor4.bind(u),this.setInt=u.setInt.bind(u),this.setInt2=u.setInt2.bind(u),this.setInt3=u.setInt3.bind(u),this.setInt4=u.setInt4.bind(u))}}var q=s(10655);const d="gpuUpdateParticlesPixelShader",v="#version 300 es\nvoid main() {discard;}\n";q.b.ShadersStore[d]=v;const W="gpuUpdateParticlesVertexShader",M="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";q.b.ShadersStore[W]=M;(0,f.g)("BABYLON.WebGL2ParticleSystem",class{constructor(u,G){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=u,this._engine=G,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var u;return(null===(u=this._updateEffect)||void 0===u?void 0:u.isReady())??!1}createUpdateBuffer(u){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof l&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=u,this._updateEffect=new X.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new p(this._updateEffect)}createVertexBuffers(u,G){this._updateVAO.push(this._createUpdateVAO(u)),this._renderVAO.push(this._engine.recordVertexArrayObject(G,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=G}createParticleBuffer(u){return u}bindDrawBuffers(u,G,s){s?this._engine.bindBuffers(this._renderVertexBuffers,s,G):this._engine.bindVertexArrayObject(this._renderVAO[u],null)}preUpdateParticleBuffer(){const u=this._engine;if(this._engine.enableEffect(this._updateEffect),!u.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(u,G,s){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[u],null);const T=this._engine;T.bindTransformFeedbackBuffer(G.getBuffer()),T.setRasterizerState(!1),T.beginTransformFeedback(!0),T.drawArraysType(3,0,s),T.endTransformFeedback(),T.setRasterizerState(!0),T.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let u=0;u<this._updateVAO.length;u++)this._engine.releaseVertexArrayObject(this._updateVAO[u]);this._updateVAO.length=0;for(let u=0;u<this._renderVAO.length;u++)this._engine.releaseVertexArrayObject(this._renderVAO[u]);this._renderVAO.length=0}_createUpdateVAO(u){const G={};G.position=u.createVertexBuffer("position",0,3);let s=3;G.age=u.createVertexBuffer("age",s,1),s+=1,G.size=u.createVertexBuffer("size",s,3),s+=3,G.life=u.createVertexBuffer("life",s,1),s+=1,G.seed=u.createVertexBuffer("seed",s,4),s+=4,G.direction=u.createVertexBuffer("direction",s,3),s+=3,this._parent.particleEmitterType instanceof l&&(G.initialPosition=u.createVertexBuffer("initialPosition",s,3),s+=3),this._parent._colorGradientsTexture||(G.color=u.createVertexBuffer("color",s,4),s+=4),this._parent._isBillboardBased||(G.initialDirection=u.createVertexBuffer("initialDirection",s,3),s+=3),this._parent.noiseTexture&&(G.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",s,3),s+=3,G.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",s,3),s+=3),this._parent._angularSpeedGradientsTexture?(G.angle=u.createVertexBuffer("angle",s,1),s+=1):(G.angle=u.createVertexBuffer("angle",s,2),s+=2),this._parent._isAnimationSheetEnabled&&(G.cellIndex=u.createVertexBuffer("cellIndex",s,1),s+=1,this._parent.spriteRandomStartCell&&(G.cellStartOffset=u.createVertexBuffer("cellStartOffset",s,1),s+=1));const T=this._engine.recordVertexArrayObject(G,null,this._updateEffect);return this._engine.bindArrayBuffer(null),T}});class o{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,T=arguments.length>3?arguments[3]:void 0;this._engine=u,this._label=T,this._engine._storageBuffers.push(this),this._create(G,s)}_create(u,G){this._bufferSize=u,this._creationFlags=G,this._buffer=this._engine.createStorageBuffer(u,G,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(u,G,s){this._buffer&&this._engine.updateStorageBuffer(this._buffer,u,G,s)}read(u,G,s,T){return this._engine.readFromStorageBuffer(this._buffer,u,G,s,T)}dispose(){const u=this._engine._storageBuffers,G=u.indexOf(this);-1!==G&&(u[G]=u[u.length-1],u.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=s(10863),B=s(10866),D=s(10935),k=s(11102),w=s(11021),L=s(10584),S=s(10691),e=s(10734);class h{constructor(){this._gpuTimeInFrameId=-1,this.counter=new e.e}_addDuration(u,G){u<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==u?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(G,!1),this._gpuTimeInFrameId=u):this.counter.addCount(G,!1))}}class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=u,this._engine=G,this.uniqueId=w.c.UniqueId,G.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new h),this._engine.getCaps().supportComputeShaders?T.bindingsMapping?(this._context=G.createComputeContext(),this._shaderPath=s,this._options={bindingsMapping:{},defines:[],...T}):L.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):L.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=this._bindings[u];this._bindings[u]={type:s?0:4,object:G,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!T||T.object!==G||T.type!==this._bindings[u].type)}setStorageTexture(u,G){const s=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==G),this._bindings[u]={type:1,object:G,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setExternalTexture(u,G){const s=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==G),this._bindings[u]={type:6,object:G,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setVideoTexture(u,G){return!!G.externalTexture&&(this.setExternalTexture(u,G.externalTexture),!0)}setUniformBuffer(u,G){const s=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==G),this._bindings[u]={type:I._BufferIsDataBuffer(G)?7:2,object:G,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setStorageBuffer(u,G){const s=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==G),this._bindings[u]={type:I._BufferIsDataBuffer(G)?7:3,object:G,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setTextureSampler(u,G){const s=this._bindings[u];this._contextIsDirty||(this._contextIsDirty=!s||!G.compareSampler(s.object)),this._bindings[u]={type:5,object:G,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}isReady(){let u=this._effect;for(const z in this._bindings){const u=this._bindings[z],G=u.type,s=u.object;switch(G){case 0:case 4:case 1:if(!s.isReady())return!1;break;case 6:if(!s.isReady())return!1;break}}const G=[],s=this._shaderPath;if(this._options.defines)for(let z=0;z<this._options.defines.length;z++)G.push(this._options.defines[z]);const T=G.join("\n");return this._cachedDefines!==T&&(this._cachedDefines=T,u=this._engine.createComputeEffect(s,{defines:T,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=u),!!u.isReady()}dispatch(u,G,s){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,u,G,s,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const s=I._BufferIsDataBuffer(u)?u:u.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,s,G,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const G in this._bindings){const s=this._bindings[G];if(!this._options.bindingsMapping[G])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+G+"'");switch(s.type){case 0:{const T=this._samplers[G],z=s.object;var u;if(!T||!z._texture||!T.compareSampler(z._texture))this._samplers[G]=(new S.c).setParameters(z.wrapU,z.wrapV,z.wrapR,z.anisotropicFilteringLevel,z._texture.samplingMode,null===(u=z._texture)||void 0===u?void 0:u._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const u=s.object;u.getBuffer()!==s.buffer&&(s.buffer=u.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((z=>{const O=()=>{this.dispatch(u,G,s)?z():setTimeout(O,T)};O()}))}serialize(){const u=D.e.Serialize(this);u.options=this._options,u.shaderPath=this._shaderPath,u.mj={},u.textures={};for(const G in this._bindings){const s=this._bindings[G],T=s.object;switch(s.type){case 0:case 4:case 1:{const z=T.serialize();z&&(u.textures[G]=z,u.mj[G]={type:s.type});break}}}return u}static Parse(u,G,s){const T=D.e.Parse((()=>new I(u.name,G.getEngine(),u.shaderPath,u.options)),u,G,s);for(const z in u.textures){const O=u.mj[z],m=k.b.Parse(u.textures[z],G,s);0===O.type?T.setTexture(z,m):4===O.type?T.setTexture(z,m,!1):T.setStorageTexture(z,m)}return T}static _BufferIsDataBuffer(u){return void 0!==u.underlyingResource}}(0,R.b)([(0,B.M)()],I.prototype,"name",void 0),(0,R.b)([(0,B.M)()],I.prototype,"fastMode",void 0),(0,f.g)("BABYLON.ComputeShader",I);var i=s(10954);const J="gpuUpdateParticlesComputeShader",A="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";q.b.ShadersStoreWGSL[J]=A;(0,f.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(u,G){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=u,this._engine=G}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var u;return(null===(u=this._updateComputeShader)||void 0===u?void 0:u.isReady())??!1}createUpdateBuffer(u){var G;const s={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(s.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(s.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(s.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(s.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(s.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(s.noiseTexture={group:1,binding:11}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:s,defines:u.split("\n")}),null===(G=this._simParamsComputeShader)||void 0===G||G.dispose(),this._simParamsComputeShader=new i.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new p(this._simParamsComputeShader)}createVertexBuffers(u,G){this._renderVertexBuffers.push(G)}createParticleBuffer(u){const G=new o(this._engine,4*u.length,11,"ComputeShaderParticleSystemBuffer");return G.update(u),this._bufferComputeShader.push(G),G.getBuffer()}bindDrawBuffers(u,G,s){this._engine.bindBuffers(this._renderVertexBuffers[u],s,G)}preUpdateParticleBuffer(){}updateParticleBuffer(u,G,s){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[u]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^u]),this._updateComputeShader.dispatch(Math.ceil(s/64))}releaseBuffers(){var u;for(let G=0;G<this._bufferComputeShader.length;++G)this._bufferComputeShader[G].dispose();this._bufferComputeShader.length=0,null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class N{constructor(u,G,s){this.gradient=u,this.color1=G,this.color2=s}getColorToRef(u){this.color2?m.e.LerpToRef(this.color1,this.color2,Math.random(),u):u.p(this.color1)}}class y{constructor(u,G){this.gradient=u,this.color=G}}class a{constructor(u,G,s){this.gradient=u,this.factor1=G,this.factor2=s}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class K{static GetCurrentGradient(u,G,s){if(G[0].gradient>u)return void s(G[0],G[0],1);for(let z=0;z<G.length-1;z++){const T=G[z],O=G[z+1];if(u>=T.gradient&&u<=O.gradient){return void s(T,O,(u-T.gradient)/(O.gradient-T.gradient))}}const T=G.length-1;s(G[T],G[T],1)}}var Z=s(10568),t=s(11336),E=s(10619);class U{constructor(u){this.particleSystem=u,this.position=T.q.Zero(),this.direction=T.q.Zero(),this.color=new m.e(0,0,0,0),this.colorStep=new m.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new T.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new m.e(0,0,0,0),this._currentColor2=new m.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=U._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let u=this.age,G=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===G?(G=1,u=this._randomCellOffset):u+=this._randomCellOffset);const s=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let T;T=this._initialSpriteCellLoop?(0,x.b)(u*G%this.lifeTime/this.lifeTime):(0,x.b)(u*G/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+T*s|0}_inheritParticleInfoToSubEmitter(u){if(u.particleSystem.k.position){const G=u.particleSystem.k;if(G.position.p(this.position),u.inheritDirection){const u=T.l.gb[0];this.direction.normalizeToRef(u),G.setDirection(u,0,Math.PI/2)}}else{u.particleSystem.k.p(this.position)}this.direction.scaleToRef(u.inheritedVelocityAmount/2,T.l.gb[0]),u.particleSystem._inheritedVelocityOffset.p(T.l.gb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((u=>{this._inheritParticleInfoToSubEmitter(u)}))}_reset(){this.age=0,this.id=U._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(u){u.position.p(this.position),this._initialDirection?u._initialDirection?u._initialDirection.p(this._initialDirection):u._initialDirection=this._initialDirection.clone():u._initialDirection=null,u.direction.p(this.direction),this.pf&&(u.pf?u.pf.p(this.pf):u.pf=this.pf.clone()),u.color.p(this.color),u.colorStep.p(this.colorStep),u.lifeTime=this.lifeTime,u.age=this.age,u._randomCellOffset=this._randomCellOffset,u.size=this.size,u.scale.p(this.scale),u.angle=this.angle,u.angularSpeed=this.angularSpeed,u.particleSystem=this.particleSystem,u.cellIndex=this.cellIndex,u.id=this.id,u._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(u._currentColorGradient=this._currentColorGradient,u._currentColor1.p(this._currentColor1),u._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(u._currentSizeGradient=this._currentSizeGradient,u._currentSize1=this._currentSize1,u._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(u._currentAngularSpeedGradient=this._currentAngularSpeedGradient,u._currentAngularSpeed1=this._currentAngularSpeed1,u._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(u._currentVelocityGradient=this._currentVelocityGradient,u._currentVelocity1=this._currentVelocity1,u._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(u._currentLimitVelocityGradient=this._currentLimitVelocityGradient,u._currentLimitVelocity1=this._currentLimitVelocity1,u._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(u._currentDragGradient=this._currentDragGradient,u._currentDrag1=this._currentDrag1,u._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(u._initialStartSpriteCellID=this._initialStartSpriteCellID,u._initialEndSpriteCellID=this._initialEndSpriteCellID,u._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(u.remapData&&this.remapData?u.remapData.p(this.remapData):u.remapData=new T.s(0,0,0,0)),this._randomNoiseCoordinates1&&(u._randomNoiseCoordinates1?(u._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),u._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(u._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),u._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}U._Count=0;var uu=s(11083),Gu=(s(11341),s(11088)),su=s(11085),Tu=s(10945);class zu extends C{set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}get useRampGradients(){return this._useRampGradients}set useRampGradients(u){this._useRampGradients!==u&&(this._useRampGradients=u,this._resetEffect())}get particles(){return this.hj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.hj.length}getClassName(){return"tb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(u=this._customWrappers[G])||void 0===u?void 0:u.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[u]??this._customWrappers[0]}setCustomEffect(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[G]=new uu.d(this._engine),this._customWrappers[G].effect=u,this._customWrappers[G].drawContext&&(this._customWrappers[G].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(u),this._emitterInverseWorldMatrix=T.d.Identity(),this._inheritedVelocityOffset=new T.q,this._i=new Z.e,this.onStoppedObservable=new Z.e,this.hj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new m.e(0,0,0,0),this._colorDiff=new m.e(0,0,0,0),this._scaledDirection=T.q.Zero(),this._scaledGravity=T.q.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=u=>{},this.recycleParticle=u=>{const G=this.hj.pop();G!==u&&G.copyTo(u),this._stockParticles.push(G)},this._createParticle=()=>{let u;return 0!==this._stockParticles.length?(u=this._stockParticles.pop(),u._reset()):u=new U(this),this._prepareParticle(u),u},this._shadersLoaded=!1,this._capacity=G,this._epsilon=f,this._isAnimationSheetEnabled=O,s&&"Scene"!==s.getClassName()?(this._engine=s,this.defaultProjectionMatrix=T.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=s||E.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new uu.d(this._engine)},this._customWrappers[0].effect=z,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new b;let C=null;this.updateFunction=u=>{let G=null;var s;this.noiseTexture&&(G=this.noiseTexture.getSize(),null===(s=this.noiseTexture.getContent())||void 0===s||s.then((u=>{C=u})));const z=u===this.hj;for(let O=0;O<u.length;O++){const s=u[O];let f=this._scaledUpdateSpeed;const g=s.age;if(s.age+=f,s.age>s.lifeTime){const u=s.age-g;f=(s.lifeTime-g)*f/u,s.age=s.lifeTime}const b=s.age/s.lifeTime;this._colorGradients&&this._colorGradients.length>0?K.GetCurrentGradient(b,this._colorGradients,((u,G,T)=>{u!==s._currentColorGradient&&(s._currentColor1.p(s._currentColor2),G.getColorToRef(s._currentColor2),s._currentColorGradient=u),m.e.LerpToRef(s._currentColor1,s._currentColor2,T,s.color)})):(s.colorStep.scaleToRef(f,this._scaledColorStep),s.color.addInPlace(this._scaledColorStep),s.color.a<0&&(s.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&K.GetCurrentGradient(b,this._angularSpeedGradients,((u,G,T)=>{u!==s._currentAngularSpeedGradient&&(s._currentAngularSpeed1=s._currentAngularSpeed2,s._currentAngularSpeed2=G.getFactor(),s._currentAngularSpeedGradient=u),s.angularSpeed=(0,x.m)(s._currentAngularSpeed1,s._currentAngularSpeed2,T)})),s.angle+=s.angularSpeed*f;let Q=f;if(this._velocityGradients&&this._velocityGradients.length>0&&K.GetCurrentGradient(b,this._velocityGradients,((u,G,T)=>{u!==s._currentVelocityGradient&&(s._currentVelocity1=s._currentVelocity2,s._currentVelocity2=G.getFactor(),s._currentVelocityGradient=u),Q*=(0,x.m)(s._currentVelocity1,s._currentVelocity2,T)})),s.direction.scaleToRef(Q,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&K.GetCurrentGradient(b,this._limitVelocityGradients,((u,G,T)=>{u!==s._currentLimitVelocityGradient&&(s._currentLimitVelocity1=s._currentLimitVelocity2,s._currentLimitVelocity2=G.getFactor(),s._currentLimitVelocityGradient=u);const z=(0,x.m)(s._currentLimitVelocity1,s._currentLimitVelocity2,T);s.direction.length()>z&&s.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&K.GetCurrentGradient(b,this._dragGradients,((u,G,T)=>{u!==s._currentDragGradient&&(s._currentDrag1=s._currentDrag2,s._currentDrag2=G.getFactor(),s._currentDragGradient=u);const z=(0,x.m)(s._currentDrag1,s._currentDrag2,T);this._scaledDirection.scaleInPlace(1-z)})),this.isLocal&&s.pf?(s.pf.addInPlace(this._scaledDirection),T.q.TransformCoordinatesToRef(s.pf,this._emitterWorldMatrix,s.position)):s.position.addInPlace(this._scaledDirection),C&&G&&s._randomNoiseCoordinates1){const u=this._fetchR(s._randomNoiseCoordinates1.x,s._randomNoiseCoordinates1.y,G.width,G.height,C),z=this._fetchR(s._randomNoiseCoordinates1.z,s._randomNoiseCoordinates2.x,G.width,G.height,C),O=this._fetchR(s._randomNoiseCoordinates2.y,s._randomNoiseCoordinates2.z,G.width,G.height,C),m=T.l.gb[0],x=T.l.gb[1];m.hf((2*u-1)*this.noiseStrength.x,(2*z-1)*this.noiseStrength.y,(2*O-1)*this.noiseStrength.z),m.scaleToRef(f,x),s.direction.addInPlace(x)}this.gravity.scaleToRef(f,this._scaledGravity),s.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&K.GetCurrentGradient(b,this._sizeGradients,((u,G,T)=>{u!==s._currentSizeGradient&&(s._currentSize1=s._currentSize2,s._currentSize2=G.getFactor(),s._currentSizeGradient=u),s.size=(0,x.m)(s._currentSize1,s._currentSize2,T)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&K.GetCurrentGradient(b,this._colorRemapGradients,((u,G,T)=>{const z=(0,x.m)(u.factor1,G.factor1,T),O=(0,x.m)(u.factor2,G.factor2,T);s.remapData.x=z,s.remapData.y=O-z})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&K.GetCurrentGradient(b,this._alphaRemapGradients,((u,G,T)=>{const z=(0,x.m)(u.factor1,G.factor1,T),O=(0,x.m)(u.factor2,G.factor2,T);s.remapData.z=z,s.remapData.w=O-z}))),this._isAnimationSheetEnabled&&s.updateCellIndex(),s._inheritParticleInfoToSubEmitters(),s.age>=s.lifeTime&&(this._emitFromParticle(s),s._attachedSubEmitters&&(s._attachedSubEmitters.forEach((u=>{u.particleSystem.disposeOnStop=!0,u.particleSystem.stop()})),s._attachedSubEmitters=null),this.recycleParticle(s),z&&O--)}}}serialize(u){throw new Error("Method not implemented.")}clone(u,G){throw new Error("Method not implemented.")}_addFactorGradient(u,G,s,T){const z=new a(G,s,T);u.push(z),u.sort(((u,G)=>u.gradient<G.gradient?-1:u.gradient>G.gradient?1:0))}_removeFactorGradient(u,G){if(!u)return;let s=0;for(const T of u){if(T.gradient===G){u.splice(s,1);break}s++}}addLifeTimeGradient(u,G,s){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,u,G,s),this}removeLifeTimeGradient(u){return this._removeFactorGradient(this._lifeTimeGradients,u),this}addSizeGradient(u,G,s){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,u,G,s),this}removeSizeGradient(u){return this._removeFactorGradient(this._sizeGradients,u),this}addColorRemapGradient(u,G,s){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,u,G,s),this}removeColorRemapGradient(u){return this._removeFactorGradient(this._colorRemapGradients,u),this}addAlphaRemapGradient(u,G,s){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,u,G,s),this}removeAlphaRemapGradient(u){return this._removeFactorGradient(this._alphaRemapGradients,u),this}addAngularSpeedGradient(u,G,s){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,u,G,s),this}removeAngularSpeedGradient(u){return this._removeFactorGradient(this._angularSpeedGradients,u),this}addVelocityGradient(u,G,s){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,u,G,s),this}removeVelocityGradient(u){return this._removeFactorGradient(this._velocityGradients,u),this}addLimitVelocityGradient(u,G,s){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,u,G,s),this}removeLimitVelocityGradient(u){return this._removeFactorGradient(this._limitVelocityGradients,u),this}addDragGradient(u,G,s){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,u,G,s),this}removeDragGradient(u){return this._removeFactorGradient(this._dragGradients,u),this}addEmitRateGradient(u,G,s){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,u,G,s),this}removeEmitRateGradient(u){return this._removeFactorGradient(this._emitRateGradients,u),this}addStartSizeGradient(u,G,s){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,u,G,s),this}removeStartSizeGradient(u){return this._removeFactorGradient(this._startSizeGradients,u),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const u=new Uint8Array(4*this._rawTextureWidth),G=m.f.hb[0];for(let s=0;s<this._rawTextureWidth;s++){const T=s/this._rawTextureWidth;K.GetCurrentGradient(T,this._rampGradients,((T,z,O)=>{m.b.LerpToRef(T.color,z.color,O,G),u[4*s]=255*G.r,u[4*s+1]=255*G.g,u[4*s+2]=255*G.b,u[4*s+3]=255}))}this._rampGradientsTexture=t.b.CreateRGBATexture(u,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((u,G)=>u.gradient<G.gradient?-1:u.gradient>G.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(u,G){this._rampGradients||(this._rampGradients=[]);const s=new y(u,G);return this._rampGradients.push(s),this._syncRampGradientTexture(),this}removeRampGradient(u){return this._removeGradientAndTexture(u,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(u,G,s){this._colorGradients||(this._colorGradients=[]);const T=new N(u,G,s);return this._colorGradients.push(T),this._colorGradients.sort(((u,G)=>u.gradient<G.gradient?-1:u.gradient>G.gradient?1:0)),this}removeColorGradient(u){if(!this._colorGradients)return this;let G=0;for(const s of this._colorGradients){if(s.gradient===u){this._colorGradients.splice(G,1);break}G++}return this}resetDrawCache(){for(const u of this._drawWrappers)if(u)for(const G of u)null===G||void 0===G||G.dispose();this._drawWrappers=[]}_fetchR(u,G,s,T,z){return z[4*(((u=.5*Math.abs(u)+.5)*s%s|0)+((G=.5*Math.abs(G)+.5)*T%T|0)*s)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const u=this._engine,G=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*G),this._vertexBuffer=new P.b(u,this._vertexData,!0,G);let s=0;const T=this._vertexBuffer.createVertexBuffer(P.f.PositionKind,s,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.f.PositionKind]=T,s+=3;const z=this._vertexBuffer.createVertexBuffer(P.f.ColorKind,s,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.f.ColorKind]=z,s+=4;const O=this._vertexBuffer.createVertexBuffer("angle",s,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=O,s+=1;const m=this._vertexBuffer.createVertexBuffer("size",s,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=m,s+=2,this._isAnimationSheetEnabled){const u=this._vertexBuffer.createVertexBuffer("cellIndex",s,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=u,s+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const u=this._vertexBuffer.createVertexBuffer("direction",s,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=u,s+=3}if(this._useRampGradients){const u=this._vertexBuffer.createVertexBuffer("remapData",s,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=u,s+=4}let f;if(this._useInstancing){const G=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.b(u,G,!1,2),f=this._spriteBuffer.createVertexBuffer("offset",0,2)}else f=this._vertexBuffer.createVertexBuffer("offset",s,2,this._vertexBufferSize,this._useInstancing),s+=2;this._vertexBuffers.offset=f,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const u=[],G=[];let s=0;for(let T=0;T<this._capacity;T++)u.push(s),u.push(s+1),u.push(s+2),u.push(s),u.push(s+2),u.push(s+3),G.push(s,s+1,s+1,s+2,s+2,s+3,s+3,s,s,s+3),s+=4;this._indexBuffer=this._engine.createIndexBuffer(u),this._linesIndexBuffer=this._engine.createIndexBuffer(G)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(u)setTimeout((()=>{this.start(0)}),u);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var G;-1!==(null===(G=this.k)||void 0===G?void 0:G.getClassName().indexOf("Mesh"))&&this.k.Gj(!0);const u=this.noiseTexture;if(u&&u.onGeneratedObservable)u.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let G=0;G<this.preWarmCycles;G++)this.animate(!0),u.render()}))}));else for(let G=0;G<this.preWarmCycles;G++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(u))}_postStop(u){}reset(){this._stockParticles.length=0,this.hj.length=0}_appendParticleVertex(u,G,s,z){let O=u*this._vertexBufferSize;if(this._vertexData[O++]=G.position.x+this.gf.x,this._vertexData[O++]=G.position.y+this.gf.y,this._vertexData[O++]=G.position.z+this.gf.z,this._vertexData[O++]=G.color.r,this._vertexData[O++]=G.color.g,this._vertexData[O++]=G.color.b,this._vertexData[O++]=G.color.a,this._vertexData[O++]=G.angle,this._vertexData[O++]=G.scale.x*G.size,this._vertexData[O++]=G.scale.y*G.size,this._isAnimationSheetEnabled&&(this._vertexData[O++]=G.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[O++]=G.direction.x,this._vertexData[O++]=G.direction.y,this._vertexData[O++]=G.direction.z);else if(G._initialDirection){let u=G._initialDirection;this.isLocal&&(T.q.TransformNormalToRef(u,this._emitterWorldMatrix,T.l.gb[0]),u=T.l.gb[0]),0===u.x&&0===u.z&&(u.x=.001),this._vertexData[O++]=u.x,this._vertexData[O++]=u.y,this._vertexData[O++]=u.z}else{let u=G.direction;this.isLocal&&(T.q.TransformNormalToRef(u,this._emitterWorldMatrix,T.l.gb[0]),u=T.l.gb[0]),0===u.x&&0===u.z&&(u.x=.001),this._vertexData[O++]=u.x,this._vertexData[O++]=u.y,this._vertexData[O++]=u.z}this._useRampGradients&&G.remapData&&(this._vertexData[O++]=G.remapData.x,this._vertexData[O++]=G.remapData.y,this._vertexData[O++]=G.remapData.z,this._vertexData[O++]=G.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===s?s=this._epsilon:1===s&&(s=1-this._epsilon),0===z?z=this._epsilon:1===z&&(z=1-this._epsilon)),this._vertexData[O++]=s,this._vertexData[O++]=z)}_prepareParticle(u){}_update(u){if(this._alive=this.hj.length>0,this.k.position){const u=this.k;this._emitterWorldMatrix=u.getWorldMatrix()}else{const u=this.k;this._emitterWorldMatrix=T.d.Translation(u.x,u.y,u.z)}let G;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.hj);for(let s=0;s<u&&this.hj.length!==this._capacity;s++){if(G=this._createParticle(),this.hj.push(G),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const u=(0,x.b)(this._actualFrame/this.targetStopDuration);K.GetCurrentGradient(u,this._lifeTimeGradients,((s,T)=>{const z=s,O=T,m=z.getFactor(),f=O.getFactor(),C=(u-z.gradient)/(O.gradient-z.gradient);G.lifeTime=(0,x.m)(m,f,C)}))}else G.lifeTime=(0,x.q)(this.minLifeTime,this.maxLifeTime);const u=(0,x.q)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,G.position,G,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,G.position,G,this.isLocal),this.isLocal&&(G.pf?G.pf.p(G.position):G.pf=G.position.clone(),T.q.TransformCoordinatesToRef(G.pf,this._emitterWorldMatrix,G.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,G.direction,G,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,G.direction,G,this.isLocal,this._emitterInverseWorldMatrix),0===u?G._initialDirection?G._initialDirection.p(G.direction):G._initialDirection=G.direction.clone():G._initialDirection=null,G.direction.scaleInPlace(u),this._sizeGradients&&0!==this._sizeGradients.length?(G._currentSizeGradient=this._sizeGradients[0],G._currentSize1=G._currentSizeGradient.getFactor(),G.size=G._currentSize1,this._sizeGradients.length>1?G._currentSize2=this._sizeGradients[1].getFactor():G._currentSize2=G._currentSize1):G.size=(0,x.q)(this.minSize,this.maxSize),G.scale.hf((0,x.q)(this.minScaleX,this.maxScaleX),(0,x.q)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const u=this._actualFrame/this.targetStopDuration;K.GetCurrentGradient(u,this._startSizeGradients,((u,s,T)=>{u!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=s.getFactor(),this._currentStartSizeGradient=u);const z=(0,x.m)(this._currentStartSize1,this._currentStartSize2,T);G.scale.scaleInPlace(z)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(G._currentAngularSpeedGradient=this._angularSpeedGradients[0],G.angularSpeed=G._currentAngularSpeedGradient.getFactor(),G._currentAngularSpeed1=G.angularSpeed,this._angularSpeedGradients.length>1?G._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():G._currentAngularSpeed2=G._currentAngularSpeed1):G.angularSpeed=(0,x.q)(this.minAngularSpeed,this.maxAngularSpeed),G.angle=(0,x.q)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(G._currentVelocityGradient=this._velocityGradients[0],G._currentVelocity1=G._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?G._currentVelocity2=this._velocityGradients[1].getFactor():G._currentVelocity2=G._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(G._currentLimitVelocityGradient=this._limitVelocityGradients[0],G._currentLimitVelocity1=G._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?G._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():G._currentLimitVelocity2=G._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(G._currentDragGradient=this._dragGradients[0],G._currentDrag1=G._currentDragGradient.getFactor(),this._dragGradients.length>1?G._currentDrag2=this._dragGradients[1].getFactor():G._currentDrag2=G._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)G._currentColorGradient=this._colorGradients[0],G._currentColorGradient.getColorToRef(G.color),G._currentColor1.p(G.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(G._currentColor2):G._currentColor2.p(G.color);else{const u=(0,x.q)(0,1);m.e.LerpToRef(this.color1,this.color2,u,G.color),this.colorDead.subtractToRef(G.color,this._colorDiff),this._colorDiff.scaleToRef(1/G.lifeTime,G.colorStep)}this._isAnimationSheetEnabled&&(G._initialStartSpriteCellID=this.startSpriteCellID,G._initialEndSpriteCellID=this.endSpriteCellID,G._initialSpriteCellLoop=this.spriteCellLoop),G.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(G.remapData=new T.s(0,1,0,1)),this.noiseTexture&&(G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.hf(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2.hf(Math.random(),Math.random(),Math.random())):(G._randomNoiseCoordinates1=new T.q(Math.random(),Math.random(),Math.random()),G._randomNoiseCoordinates2=new T.q(Math.random(),Math.random(),Math.random()))),G._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=[P.f.PositionKind,P.f.ColorKind,"angle","offset","size"];return u&&T.push("cellIndex"),G||T.push("direction"),s&&T.push("remapData"),T}static _GetEffectCreationOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Gu.b)(T),u&&T.push("particlesInfos"),G&&T.push("logarithmicDepthConstant"),s&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Gu.k)(this,this._scene,u),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&u.push("#define FOG")),this._isAnimationSheetEnabled&&u.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&u.push("#define LOGARITHMICDEPTH"),G===C.BLENDMODE_MULTIPLY&&u.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&u.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(u.push("#define BILLBOARD"),this.billboardMode){case 2:u.push("#define BILLBOARDY");break;case 8:case 9:u.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&u.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:u.push("#define BILLBOARDMODE_ALL")}s&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),u.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(u,G,s){G.push(...zu._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),u.push(...zu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),s.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Tu.d)(u,this._imageProcessingConfigurationDefines),(0,Tu.c)(s,this._imageProcessingConfigurationDefines))}_getWrapper(u){const G=this._getCustomDrawWrapper(u);if(null!==G&&void 0!==G&&G.effect)return G;const s=[];this.fillDefines(s,u);const T=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let z=this._drawWrappers[T];z||(z=this._drawWrappers[T]=[]);let O=z[u];O||(O=new uu.d(this._engine),O.drawContext&&(O.drawContext.useInstancing=this._useInstancing),z[u]=O);const m=s.join("\n");if(O.defines!==m){const u=[],G=[],s=[];this.fillUniformsAttributesAndSamplerNames(G,u,s),O.setEffect(this._engine.createEffect("particles",u,G,s,m,void 0,void 0,void 0,void 0,this._shaderLanguage),m)}return O}animate(){var u;let G,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!s&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(s?this.preWarmStepOffset:(null===(u=this._scene)||void 0===u?void 0:u.getAnimationRatio())||1),this.manualEmitCount>-1)G=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let u=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const G=this._actualFrame/this.targetStopDuration;K.GetCurrentGradient(G,this._emitRateGradients,((G,s,T)=>{G!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=s.getFactor(),this._currentEmitRateGradient=G),u=(0,x.m)(this._currentEmitRate1,this._currentEmitRate2,T)}))}G=u*this._scaledUpdateSpeed|0,this._newPartsExcess+=u*this._scaledUpdateSpeed-G}if(this._newPartsExcess>1&&(G+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?G=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(G),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!s){let u=0;for(let G=0;G<this.hj.length;G++){const s=this.hj[G];this._appendParticleVertices(u,s),u+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.hj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(u,G){this._appendParticleVertex(u++,G,0,0),this._useInstancing||(this._appendParticleVertex(u++,G,1,0),this._appendParticleVertex(u++,G,1,1),this._appendParticleVertex(u++,G,0,1))}rebuild(){var u;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(u=this._spriteBuffer)||void 0===u||u._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!zu.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(s.bind(s,11627)),Promise.resolve().then(s.bind(s,11582))])):await Promise.all([Promise.resolve().then(s.bind(s,11564)),Promise.resolve().then(s.bind(s,11551))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(u){const G=this._getWrapper(u),s=G.effect,z=this._engine;z.enableEffect(G);const O=this.defaultViewMatrix??this._scene.getViewMatrix();if(s.setTexture("diffuseSampler",this.particleTexture),s.setMatrix("view",O),s.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const u=this.particleTexture.getBaseSize();s.setFloat3("particlesInfos",this.spriteCellWidth/u.width,this.spriteCellHeight/u.height,this.spriteCellWidth/u.width)}if(s.setVector2("translationPivot",this.translationPivot),s.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const u=this._scene.activeCamera;s.setVector3("eyePosition",u.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),s.setTexture("rampSampler",this._rampGradientsTexture));const m=s.defines;var f,x,g,b,Q,Y;(this._scene&&((0,Gu.f)(s,this,this._scene),this.applyFog&&(0,su.d)(this._scene,void 0,s)),m.indexOf("#define BILLBOARDMODE_ALL")>=0&&(O.invertToRef(T.l.Matrix[0]),s.setMatrix("invView",T.l.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?z.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,s):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,s)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?z.bindBuffers(this._vertexBuffers,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBuffer:this._indexBuffer,s):z.bindBuffers(this._vertexBuffers,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBufferUseInstancing:null,s);switch(this.useLogarithmicDepth&&this._scene&&(0,su.i)(m,s,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(s),u){case C.BLENDMODE_ADD:z.setAlphaMode(1);break;case C.BLENDMODE_ONEONE:z.setAlphaMode(6);break;case C.BLENDMODE_STANDARD:z.setAlphaMode(2);break;case C.BLENDMODE_MULTIPLY:z.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(s),this._useInstancing)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?z.drawElementsType(6,0,10,this.hj.length):z.drawArraysType(7,0,4,this.hj.length):null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?z.drawElementsType(1,0,10*this.hj.length):z.drawElementsType(0,0,6*this.hj.length);return this.hj.length}render(){if(!this.isReady()||!this.hj.length)return 0;const u=this._engine;u.setState&&(u.setState(!1),this.forceDepthWrite&&u.setDepthWrite(!0));let G=0;return G=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),G}_onDispose(){}dispose(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),u&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),u&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(G,s),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const u=this._scene.fj.indexOf(this);u>-1&&this._scene.fj.splice(u,1),this._scene._activeParticleSystems.dispose()}this._i.notifyObservers(this),this._i.clear(),this.onStoppedObservable.clear(),this.reset()}}zu.ForceGLSL=!1;var Ou,mu=s(10609);!function(u){u[u.ATTACHED=0]="ATTACHED",u[u.END=1]="END"}(Ou||(Ou={}));class fu{constructor(u){if(this.particleSystem=u,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!u.k||!u.k.dispose){const G=(0,f.e)("BABYLON.AbstractMesh");u.k=new G("SubemitterSystemEmitter",u.va()),u._disposeEmitterOnDispose=!0}}clone(){let u=this.particleSystem.k;if(u){if(u instanceof T.q)u=u.clone();else if(-1!==u.getClassName().indexOf("Mesh")){u=new((0,f.e)("BABYLON.Mesh"))("",u.va()),u.isVisible=!1}}else u=new T.q;const G=new fu(this.particleSystem.clone(this.particleSystem.name,u));return G.particleSystem.name+="Clone",G.type=this.type,G.inheritDirection=this.inheritDirection,G.inheritedVelocityAmount=this.inheritedVelocityAmount,G.particleSystem._disposeEmitterOnDispose=!0,G.particleSystem.disposeOnStop=!0,G}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};return G.type=this.type,G.inheritDirection=this.inheritDirection,G.inheritedVelocityAmount=this.inheritedVelocityAmount,G.particleSystem=this.particleSystem.serialize(u),G}static _ParseParticleSystem(u,G,s){throw(0,mu.c)("ParseParticle")}static Parse(u,G,s){const T=u.particleSystem,z=new fu(fu._ParseParticleSystem(T,G,s,!0));return z.type=u.type,z.inheritDirection=u.inheritDirection,z.inheritedVelocityAmount=u.inheritedVelocityAmount,z.particleSystem._isSubEmitter=!0,z}dispose(){this.particleSystem.dispose()}}var Cu=s(10645);function xu(u,G){const s=new r;return s.direction1=u,s.direction2=G,s}function gu(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function bu(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Qu(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.q(0,1,0),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0);return new j(u,G,s)}function Yu(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function nu(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.q(0,1,0);return new V(u,G,s,z,O)}function Vu(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Q(u,G)}function Fu(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0);return new Y(u,G,s,z)}class ru extends zu{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=u=>{if(!this._subEmitters||0===this._subEmitters.length)return;const G=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[G].forEach((G=>{if(1===G.type){const s=G.clone();u._inheritParticleInfoToSubEmitter(s),s.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(s.particleSystem),s.particleSystem.start()}}))}}createPointEmitter(u,G){const s=xu(u,G);return this.particleEmitterType=s,s}createHemisphericEmitter(){const u=gu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createSphereEmitter(){const u=bu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createDirectedSphereEmitter(){const u=Qu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.q(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0));return this.particleEmitterType=u,u}createCylinderEmitter(){const u=Yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=u,u}createDirectedCylinderEmitter(){const u=nu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.q(0,1,0));return this.particleEmitterType=u,u}createConeEmitter(){const u=Vu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=u,u}createDirectedConeEmitter(){const u=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0));return this.particleEmitterType=u,u}createBoxEmitter(u,G,s,T){const z=new b;return this.particleEmitterType=z,this.direction1=u,this.direction2=G,this.minEmitBox=s,this.maxEmitBox=T,z}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((u=>{u instanceof ru?this._subEmitters.push([new fu(u)]):u instanceof fu?this._subEmitters.push([u]):u instanceof Array&&this._subEmitters.push(u)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((u=>{u.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const u=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==u&&this._rootParticleSystem.activeSubSystems.splice(u,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(u){u&&this._stopSubEmitters()}_prepareParticle(u){if(this._subEmitters&&this._subEmitters.length>0){const G=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];u._attachedSubEmitters=[],G.forEach((G=>{if(0===G.type){const s=G.clone();u._attachedSubEmitters.push(s),s.particleSystem.start()}}))}}_onDispose(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var s;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),u)&&(null===(s=this.particles)||void 0===s||s.forEach((u=>{if(u._attachedSubEmitters)for(let G=u._attachedSubEmitters.length-1;G>=0;G-=1)u._attachedSubEmitters[G].dispose()})));if(G&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let u=0;u<this._subEmitters.length;u++)for(const G of this._subEmitters[u])G.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(u,G,s,z){let O;O=s instanceof Cu.b?null:s;const C=(0,f.e)("BABYLON.Texture");if(C&&O&&(u.texture?G.particleTexture=C.Parse(u.texture,O,z):u.textureName&&(G.particleTexture=new C(z+u.textureName,O,!1,void 0===u.invertY||u.invertY),G.particleTexture.name=u.textureName)),u.emitterId||0===u.emitterId||void 0!==u.k?u.emitterId&&O?G.k=O.getLastMeshById(u.emitterId):G.k=T.q.Ag(u.k):G.k=T.q.Zero(),G.isLocal=!!u.isLocal,void 0!==u.renderingGroupId&&(G.renderingGroupId=u.renderingGroupId),void 0!==u.isBillboardBased&&(G.isBillboardBased=u.isBillboardBased),void 0!==u.billboardMode&&(G.billboardMode=u.billboardMode),void 0!==u.useLogarithmicDepth&&(G.useLogarithmicDepth=u.useLogarithmicDepth),u.animations){for(let s=0;s<u.animations.length;s++){const T=u.animations[s],z=(0,f.e)("BABYLON.Animation");z&&G.animations.push(z.Parse(T))}G.beginAnimationOnStart=u.beginAnimationOnStart,G.beginAnimationFrom=u.beginAnimationFrom,G.beginAnimationTo=u.beginAnimationTo,G.beginAnimationLoop=u.beginAnimationLoop}if(u.autoAnimate&&O&&O.beginAnimation(G,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),G.startDelay=0|u.startDelay,G.minAngularSpeed=u.minAngularSpeed,G.maxAngularSpeed=u.maxAngularSpeed,G.minSize=u.minSize,G.maxSize=u.maxSize,u.minScaleX&&(G.minScaleX=u.minScaleX,G.maxScaleX=u.maxScaleX,G.minScaleY=u.minScaleY,G.maxScaleY=u.maxScaleY),void 0!==u.preWarmCycles&&(G.preWarmCycles=u.preWarmCycles,G.preWarmStepOffset=u.preWarmStepOffset),void 0!==u.minInitialRotation&&(G.minInitialRotation=u.minInitialRotation,G.maxInitialRotation=u.maxInitialRotation),G.minLifeTime=u.minLifeTime,G.maxLifeTime=u.maxLifeTime,G.minEmitPower=u.minEmitPower,G.maxEmitPower=u.maxEmitPower,G.emitRate=u.emitRate,G.gravity=T.q.Ag(u.gravity),u.noiseStrength&&(G.noiseStrength=T.q.Ag(u.noiseStrength)),G.color1=m.e.Ag(u.color1),G.color2=m.e.Ag(u.color2),G.colorDead=m.e.Ag(u.colorDead),G.updateSpeed=u.updateSpeed,G.targetStopDuration=u.targetStopDuration,G.blendMode=u.blendMode,u.colorGradients)for(const T of u.colorGradients)G.addColorGradient(T.gradient,m.e.Ag(T.color1),T.color2?m.e.Ag(T.color2):void 0);if(u.rampGradients){for(const s of u.rampGradients)G.addRampGradient(s.gradient,m.b.Ag(s.color));G.useRampGradients=u.useRampGradients}if(u.colorRemapGradients)for(const T of u.colorRemapGradients)G.addColorRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.alphaRemapGradients)for(const T of u.alphaRemapGradients)G.addAlphaRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.sizeGradients)for(const T of u.sizeGradients)G.addSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.angularSpeedGradients)for(const T of u.angularSpeedGradients)G.addAngularSpeedGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.velocityGradients)for(const T of u.velocityGradients)G.addVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.dragGradients)for(const T of u.dragGradients)G.addDragGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.emitRateGradients)for(const T of u.emitRateGradients)G.addEmitRateGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.startSizeGradients)for(const T of u.startSizeGradients)G.addStartSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.lifeTimeGradients)for(const T of u.lifeTimeGradients)G.addLifeTimeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(u.limitVelocityGradients){for(const s of u.limitVelocityGradients)G.addLimitVelocityGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);G.limitVelocityDamping=u.limitVelocityDamping}if(u.noiseTexture&&O){const s=(0,f.e)("BABYLON.ProceduralTexture");G.noiseTexture=s.Parse(u.noiseTexture,O,z)}let x;if(u.particleEmitterType){switch(u.particleEmitterType.type){case"SphereParticleEmitter":x=new c;break;case"SphereDirectedParticleEmitter":x=new j;break;case"ConeEmitter":case"ConeParticleEmitter":x=new Q;break;case"ConeDirectedParticleEmitter":x=new Y;break;case"CylinderParticleEmitter":x=new n;break;case"CylinderDirectedParticleEmitter":x=new V;break;case"HemisphericParticleEmitter":x=new F;break;case"PointParticleEmitter":x=new r;break;case"MeshParticleEmitter":x=new H;break;case"CustomParticleEmitter":x=new l;break;default:x=new b}x.parse(u.particleEmitterType,O)}else x=new b,x.parse(u,O);G.particleEmitterType=x,G.startSpriteCellID=u.startSpriteCellID,G.endSpriteCellID=u.endSpriteCellID,G.spriteCellLoop=u.spriteCellLoop??!0,G.spriteCellWidth=u.spriteCellWidth,G.spriteCellHeight=u.spriteCellHeight,G.spriteCellChangeSpeed=u.spriteCellChangeSpeed,G.spriteRandomStartCell=u.spriteRandomStartCell,G.disposeOnStop=u.disposeOnStop??!1,G.manualEmitCount=u.manualEmitCount??-1}static Parse(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0;const f=u.name;let C,x,g=null,b=null;if(G instanceof Cu.b?C=G:(x=G,C=x.getEngine()),u.customShader&&C.createEffectForParticles){b=u.customShader;const G=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";g=C.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,G)}const Q=new ru(f,O||u.Aj,G,g,u.isAnimationSheetEnabled);if(Q.customShader=b,Q._rootUrl=s,u.id&&(Q.id=u.id),u.subEmitters){Q.subEmitters=[];for(const T of u.subEmitters){const u=[];for(const z of T)u.push(fu.Parse(z,G,s));Q.subEmitters.push(u)}}return ru._Parse(u,Q,G,s),u.textureMask&&(Q.textureMask=m.e.Ag(u.textureMask)),u.gf&&(Q.gf=T.q.Ag(u.gf)),u.preventAutoStart&&(Q.preventAutoStart=u.preventAutoStart),z||Q.preventAutoStart||Q.start(),Q}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};if(ru._Serialize(G,this,u),G.textureMask=this.textureMask.$i(),G.customShader=this.customShader,G.preventAutoStart=this.preventAutoStart,G.gf=this.gf.$i(),this.subEmitters){G.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const s of this._subEmitters){const T=[];for(const G of s)T.push(G.serialize(u));G.subEmitters.push(T)}}return G}static _Serialize(u,G,s){if(u.name=G.name,u.id=G.id,u.Aj=G.getCapacity(),u.disposeOnStop=G.disposeOnStop,u.manualEmitCount=G.manualEmitCount,G.k.position){const s=G.k;u.emitterId=s.id}else{const s=G.k;u.k=s.$i()}G.particleEmitterType&&(u.particleEmitterType=G.particleEmitterType.serialize()),G.particleTexture&&(s?u.texture=G.particleTexture.serialize():(u.textureName=G.particleTexture.name,u.invertY=!!G.particleTexture._invertY)),u.isLocal=G.isLocal,D.e.AppendSerializedAnimations(G,u),u.beginAnimationOnStart=G.beginAnimationOnStart,u.beginAnimationFrom=G.beginAnimationFrom,u.beginAnimationTo=G.beginAnimationTo,u.beginAnimationLoop=G.beginAnimationLoop,u.startDelay=G.startDelay,u.renderingGroupId=G.renderingGroupId,u.isBillboardBased=G.isBillboardBased,u.billboardMode=G.billboardMode,u.minAngularSpeed=G.minAngularSpeed,u.maxAngularSpeed=G.maxAngularSpeed,u.minSize=G.minSize,u.maxSize=G.maxSize,u.minScaleX=G.minScaleX,u.maxScaleX=G.maxScaleX,u.minScaleY=G.minScaleY,u.maxScaleY=G.maxScaleY,u.minEmitPower=G.minEmitPower,u.maxEmitPower=G.maxEmitPower,u.minLifeTime=G.minLifeTime,u.maxLifeTime=G.maxLifeTime,u.emitRate=G.emitRate,u.gravity=G.gravity.$i(),u.noiseStrength=G.noiseStrength.$i(),u.color1=G.color1.$i(),u.color2=G.color2.$i(),u.colorDead=G.colorDead.$i(),u.updateSpeed=G.updateSpeed,u.targetStopDuration=G.targetStopDuration,u.blendMode=G.blendMode,u.preWarmCycles=G.preWarmCycles,u.preWarmStepOffset=G.preWarmStepOffset,u.minInitialRotation=G.minInitialRotation,u.maxInitialRotation=G.maxInitialRotation,u.startSpriteCellID=G.startSpriteCellID,u.spriteCellLoop=G.spriteCellLoop,u.endSpriteCellID=G.endSpriteCellID,u.spriteCellChangeSpeed=G.spriteCellChangeSpeed,u.spriteCellWidth=G.spriteCellWidth,u.spriteCellHeight=G.spriteCellHeight,u.spriteRandomStartCell=G.spriteRandomStartCell,u.isAnimationSheetEnabled=G.isAnimationSheetEnabled,u.useLogarithmicDepth=G.useLogarithmicDepth;const T=G.getColorGradients();if(T){u.colorGradients=[];for(const G of T){const s={gradient:G.gradient,color1:G.color1.$i()};G.color2?s.color2=G.color2.$i():s.color2=G.color1.$i(),u.colorGradients.push(s)}}const z=G.getRampGradients();if(z){u.rampGradients=[];for(const G of z){const s={gradient:G.gradient,color:G.color.$i()};u.rampGradients.push(s)}u.useRampGradients=G.useRampGradients}const O=G.getColorRemapGradients();if(O){u.colorRemapGradients=[];for(const G of O){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.colorRemapGradients.push(s)}}const m=G.getAlphaRemapGradients();if(m){u.alphaRemapGradients=[];for(const G of m){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.alphaRemapGradients.push(s)}}const f=G.getSizeGradients();if(f){u.sizeGradients=[];for(const G of f){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.sizeGradients.push(s)}}const C=G.getAngularSpeedGradients();if(C){u.angularSpeedGradients=[];for(const G of C){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.angularSpeedGradients.push(s)}}const x=G.getVelocityGradients();if(x){u.velocityGradients=[];for(const G of x){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.velocityGradients.push(s)}}const g=G.getDragGradients();if(g){u.dragGradients=[];for(const G of g){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.dragGradients.push(s)}}const b=G.getEmitRateGradients();if(b){u.emitRateGradients=[];for(const G of b){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.emitRateGradients.push(s)}}const Q=G.getStartSizeGradients();if(Q){u.startSizeGradients=[];for(const G of Q){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.startSizeGradients.push(s)}}const Y=G.getLifeTimeGradients();if(Y){u.lifeTimeGradients=[];for(const G of Y){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.lifeTimeGradients.push(s)}}const n=G.getLimitVelocityGradients();if(n){u.limitVelocityGradients=[];for(const G of n){const s={gradient:G.gradient,factor1:G.factor1};void 0!==G.factor2?s.factor2=G.factor2:s.factor2=G.factor1,u.limitVelocityGradients.push(s)}u.limitVelocityDamping=G.limitVelocityDamping}G.noiseTexture&&(u.noiseTexture=G.noiseTexture.serialize())}clone(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let z=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){z=this.customShader;const u=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",G=O.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,u);T[0]?T[0].effect=G:this.setCustomEffect(G,0)}const m=this.serialize(s),f=ru.Parse(m,this._scene||this._engine,this._rootUrl);return f.name=u,f.customShader=z,f._customWrappers=T,void 0===G&&(G=this.k),this.noiseTexture&&(f.noiseTexture=this.noiseTexture.clone()),f.k=G,this.preventAutoStart||f.start(),f}}ru.BILLBOARDMODE_Y=2,ru.BILLBOARDMODE_ALL=7,ru.BILLBOARDMODE_STRETCHED=8,ru.BILLBOARDMODE_STRETCHED_LOCAL=9,fu._ParseParticleSystem=ru.Parse;var cu=s(10927),ju=s(10889),lu=s(11350);lu.d.prototype.createTransformFeedback=function(){const u=this._gl.createTransformFeedback();if(!u)throw new Error("Unable to create Transform Feedback");return u},lu.d.prototype.deleteTransformFeedback=function(u){this._gl.deleteTransformFeedback(u)},lu.d.prototype.bindTransformFeedback=function(u){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,u)},lu.d.prototype.beginTransformFeedback=function(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(u?this._gl.POINTS:this._gl.TRIANGLES)},lu.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},lu.d.prototype.setTranformFeedbackVaryings=function(u,G){this._gl.transformFeedbackVaryings(u,G,this._gl.INTERLEAVED_ATTRIBS)},lu.d.prototype.bindTransformFeedbackBuffer=function(u){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,u?u.underlyingResource:null)},lu.d.prototype.readTransformFeedbackBuffer=function(u){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,u)};const Pu="clipPlaneFragmentDeclaration2",Hu="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";q.b.IncludesShadersStore[Pu]=Hu;s(11445),s(11452),s(11459),s(11465),s(11468),s(11473),s(11482),s(11488);const Xu="gpuRenderParticlesPixelShader",pu="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";q.b.ShadersStore[Xu]=pu;const qu="clipPlaneVertexDeclaration2",du="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";q.b.IncludesShadersStore[qu]=du;s(11491),s(11496),s(11505),s(11510);const vu="gpuRenderParticlesVertexShader",Wu="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";q.b.ShadersStore[vu]=Wu;class Mu extends C{static get IsSupported(){if(!E.d.LastCreatedEngine)return!1;const u=E.d.LastCreatedEngine.getCaps();return u.supportTransformFeedbacks||u.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(u){this._maxActiveParticleCount=Math.min(u,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(u){this.maxActiveParticleCount=u}createPointEmitter(u,G){const s=xu(u,G);return this.particleEmitterType=s,s}createHemisphericEmitter(){const u=gu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createSphereEmitter(){const u=bu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=u,u}createDirectedSphereEmitter(){const u=Qu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.q(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0));return this.particleEmitterType=u,u}createCylinderEmitter(){const u=Yu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=u,u}createDirectedCylinderEmitter(){const u=nu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.q(0,1,0));return this.particleEmitterType=u,u}createConeEmitter(){const u=Vu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=u,u}createDirectedConeEmitter(){const u=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.q(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.q(0,1,0));return this.particleEmitterType=u,u}createBoxEmitter(u,G,s,T){const z=new b;return this.particleEmitterType=z,this.direction1=u,this.direction2=G,this.minEmitBox=s,this.maxEmitBox=T,z}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ru.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ru.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ru.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";u?setTimeout((()=>{this.start(0)}),u):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var u;let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(u=this._customWrappers[G])||void 0===u?void 0:u.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[u]??this._customWrappers[0]}setCustomEffect(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[G]=new uu.d(this._engine),this._customWrappers[G].effect=u}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(u,G,s){return super._removeGradientAndTexture(u,G,s),this._releaseBuffers(),this}addColorGradient(u,G){this._colorGradients||(this._colorGradients=[]);const s=new N(u,G);return this._colorGradients.push(s),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(u&&this._colorGradients.sort(((u,G)=>u.gradient<G.gradient?-1:u.gradient>G.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(u){return this._removeGradientAndTexture(u,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const G in this._drawWrappers){var u;null===(u=this._drawWrappers[G].drawContext)||void 0===u||u.reset()}}_addFactorGradient(u,G,s){const T=new a(G,s);u.push(T),this._releaseBuffers()}addSizeGradient(u,G){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,u,G),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(u){return this._removeGradientAndTexture(u,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(u,G){if(!u)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&u.sort(((u,G)=>u.gradient<G.gradient?-1:u.gradient>G.gradient?1:0));const s=this;s[G]&&(s[G].dispose(),s[G]=null)}addAngularSpeedGradient(u,G){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,u,G),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(u){return this._removeGradientAndTexture(u,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(u,G){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,u,G),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(u){return this._removeGradientAndTexture(u,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(u,G){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,u,G),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(u){return this._removeGradientAndTexture(u,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(u,G){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,u,G),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(u){return this._removeGradientAndTexture(u,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(u){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(u),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this._i=new Z.e,this.onStoppedObservable=new Z.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,s&&"Scene"!==s.getClassName()?(this._engine=s,this.defaultProjectionMatrix=T.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=s||E.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,f.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,f.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,f.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,f.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new uu.d(this._engine)},this._customWrappers[0].effect=z,this._drawWrappers={0:new uu.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(G=G??{}).randomTextureSize||delete G.randomTextureSize;const m={Aj:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...G},C=G;isFinite(C)&&(m.Aj=C),this._capacity=m.Aj,this._maxActiveParticleCount=m.Aj,this._currentActiveCount=0,this._isAnimationSheetEnabled=O,this.particleEmitterType=new b;const x=Math.min(this._engine.getCaps().maxTextureSize,m.randomTextureSize);let g=[];for(let T=0;T<x;++T)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture=new t.b(new Float32Array(g),x,1,5,s,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,g=[];for(let T=0;T<x;++T)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture2=new t.b(new Float32Array(g),x,1,5,s,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=x}_reset(){this._releaseBuffers()}_createVertexBuffers(u,G,s){const T={};T.position=G.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let z=3;T.age=G.createVertexBuffer("age",z,1,this._attributesStrideSize,!0),z+=1,T.size=G.createVertexBuffer("size",z,3,this._attributesStrideSize,!0),z+=3,T.life=G.createVertexBuffer("life",z,1,this._attributesStrideSize,!0),z+=1,z+=4,this.billboardMode===ru.BILLBOARDMODE_STRETCHED&&(T.direction=G.createVertexBuffer("direction",z,3,this._attributesStrideSize,!0)),z+=3,this._platform.alignDataInBuffer&&(z+=1),this.particleEmitterType instanceof l&&(z+=3,this._platform.alignDataInBuffer&&(z+=1)),this._colorGradientsTexture||(T.color=G.createVertexBuffer("color",z,4,this._attributesStrideSize,!0),z+=4),this._isBillboardBased||(T.initialDirection=G.createVertexBuffer("initialDirection",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),this.noiseTexture&&(T.noiseCoordinates1=G.createVertexBuffer("noiseCoordinates1",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1),T.noiseCoordinates2=G.createVertexBuffer("noiseCoordinates2",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),T.angle=G.createVertexBuffer("angle",z,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?z++:z+=2,this._isAnimationSheetEnabled&&(T.cellIndex=G.createVertexBuffer("cellIndex",z,1,this._attributesStrideSize,!0),z+=1,this.spriteRandomStartCell&&(T.cellStartOffset=G.createVertexBuffer("cellStartOffset",z,1,this._attributesStrideSize,!0),z+=1)),T.offset=s.createVertexBuffer("offset",0,2),T.uv=s.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(T),this._platform.createVertexBuffers(u,T),this.resetDrawCache()}_initialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!u)return;const G=this._engine,s=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof l&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const z=this.particleEmitterType instanceof l,O=T.l.gb[0];let m=0;for(let T=0;T<this._capacity;T++)if(s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),z?(this.particleEmitterType.particleDestinationGenerator(T,null,O),s.push(O.x),s.push(O.y),s.push(O.z)):(s.push(0),s.push(0),s.push(0)),this._platform.alignDataInBuffer&&s.push(0),m+=16,z&&(this.particleEmitterType.particlePositionGenerator(T,null,O),s.push(O.x),s.push(O.y),s.push(O.z),this._platform.alignDataInBuffer&&s.push(0),m+=4),this._colorGradientsTexture||(s.push(0),s.push(0),s.push(0),s.push(0),m+=4),this.isBillboardBased||(s.push(0),s.push(0),s.push(0),this._platform.alignDataInBuffer&&s.push(0),m+=4),this.noiseTexture&&(s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),this._platform.alignDataInBuffer&&s.push(0),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),this._platform.alignDataInBuffer&&s.push(0),m+=8),s.push(0),m+=1,this._angularSpeedGradientsTexture||(s.push(0),m+=1),this._isAnimationSheetEnabled&&(s.push(0),m+=1,this.spriteRandomStartCell&&(s.push(0),m+=1)),this._platform.alignDataInBuffer){let u=3-(m+3&3);for(m+=u;u-- >0;)s.push(0)}const f=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(s),x=this._platform.createParticleBuffer(s);this._buffer0=new P.b(G,C,!1,this._attributesStrideSize),this._buffer1=new P.b(G,x,!1,this._attributesStrideSize),this._spriteBuffer=new P.b(G,f,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let u=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(u+="\n#define BILLBOARD"),this._colorGradientsTexture&&(u+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(u+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(u+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(u+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(u+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(u+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(u+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(u+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(u+="\n#define NOISE"),this.isLocal&&(u+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===u||(this._cachedUpdateDefines=u,this._updateBuffer=this._platform.createUpdateBuffer(u)),this._platform.isUpdateBufferReady()}_getWrapper(u){const G=this._getCustomDrawWrapper(u);if(null!==G&&void 0!==G&&G.effect)return G;const s=[];this.fillDefines(s,u);let T=this._drawWrappers[u];T||(T=new uu.d(this._engine),T.drawContext&&(T.drawContext.useInstancing=!0),this._drawWrappers[u]=T);const z=s.join("\n");if(T.defines!==z){const u=[],G=[],s=[];this.fillUniformsAttributesAndSamplerNames(G,u,s),T.setEffect(this._engine.createEffect("gpuRenderParticles",u,G,s,z),z)}return T}static _GetAttributeNamesOrOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=[P.f.PositionKind,"age","life","size","angle"];return u||z.push(P.f.ColorKind),G&&z.push("cellIndex"),s||z.push("initialDirection"),T&&z.push("direction"),z.push("offset",P.f.UVKind),z}static _GetEffectCreationOptions(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["emitterWM","gf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Gu.b)(T),u&&T.push("sheetInfos"),G&&T.push("logarithmicDepthConstant"),s&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Gu.k)(this,this._scene,u),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==ju.e.FOGMODE_NONE&&u.push("#define FOG")),G===ru.BLENDMODE_MULTIPLY&&u.push("#define BLENDMULTIPLYMODE"),this.isLocal&&u.push("#define LOCAL"),this.useLogarithmicDepth&&u.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(u.push("#define BILLBOARD"),this.billboardMode){case ru.BILLBOARDMODE_Y:u.push("#define BILLBOARDY");break;case ru.BILLBOARDMODE_STRETCHED:u.push("#define BILLBOARDSTRETCHED");break;case ru.BILLBOARDMODE_ALL:u.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&u.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&u.push("#define ANIMATESHEET"),s&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),u.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(u,G,s){G.push(...Mu._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ru.BILLBOARDMODE_STRETCHED)),u.push(...Mu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),s.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(cu.b.PrepareUniforms(u,this._imageProcessingConfigurationDefines),cu.b.PrepareSamplers(s,this._imageProcessingConfigurationDefines))}animate(){var u;let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(G?this.preWarmStepOffset:(null===(u=this._scene)||void 0===u?void 0:u.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(u,G){const s=this[G];if(!u||!u.length||s)return;const T=new Float32Array(this._rawTextureWidth);for(let z=0;z<this._rawTextureWidth;z++){const G=z/this._rawTextureWidth;K.GetCurrentGradient(G,u,((u,G,s)=>{T[z]=(0,x.m)(u.factor1,G.factor1,s)}))}this[G]=t.b.CreateRTexture(T,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[G].name=G.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const u=new Uint8Array(4*this._rawTextureWidth),G=m.f.ob[0];for(let s=0;s<this._rawTextureWidth;s++){const T=s/this._rawTextureWidth;K.GetCurrentGradient(T,this._colorGradients,((T,z,O)=>{m.e.LerpToRef(T.color1,z.color1,O,G),u[4*s]=255*G.r,u[4*s+1]=255*G.g,u[4*s+2]=255*G.b,u[4*s+3]=255*G.a}))}this._colorGradientsTexture=t.b.CreateRGBATexture(u,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(u,G){var s,z,O,m;const f=this._getWrapper(u),C=f.effect;this._engine.enableEffect(f);const x=(null===(s=this._scene)||void 0===s?void 0:s.getViewMatrix())||T.d.IdentityReadOnly;if(C.setMatrix("view",x),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("gf",this.gf),this.isLocal&&C.setMatrix("emitterWM",G),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const u=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/u.width,this.spriteCellHeight/u.height,u.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const u=this._scene.activeCamera;C.setVector3("eyePosition",u.globalPosition)}const g=C.defines;if(this._scene&&((0,Gu.f)(C,this,this._scene),this.applyFog&&(0,su.d)(this._scene,void 0,C)),g.indexOf("#define BILLBOARDMODE_ALL")>=0){const u=x.clone();u.invert(),C.setMatrix("invView",u)}switch(this.useLogarithmicDepth&&this._scene&&(0,su.i)(g,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),u){case ru.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case ru.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case ru.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case ru.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,C,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(u){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!u)if(this.k.position){u=this.k.getWorldMatrix()}else{const G=this.k;u=T.l.Matrix[0],T.d.TranslationToRef(G.x,G.y,G.z,u)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",u),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const G=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=G}render(){let u,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!G&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const u=0|this._accumulatedCount;this._accumulatedCount-=u,this._currentActiveCount+=u}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){u=this.k.getWorldMatrix()}else{const G=this.k;u=T.l.Matrix[0],T.d.TranslationToRef(G.x,G.y,G.z,u)}const z=this._engine;this.updateInAnimate||this._update(u);let O=0;return G||s||(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0),O=this.blendMode===ru.BLENDMODE_MULTIPLYADD?this._render(ru.BLENDMODE_MULTIPLY,u)+this._render(ru.BLENDMODE_ADD,u):this._render(this.blendMode,u),this._engine.setAlphaMode(0)),O}rebuild(){const u=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(u,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,u()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const G in this._drawWrappers){this._drawWrappers[G].dispose()}if(this._drawWrappers={},this._scene){const u=this._scene.fj.indexOf(this);u>-1&&this._scene.fj.splice(u,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let G=0;G<this._renderVertexBuffers.length;++G){const u=this._renderVertexBuffers[G];for(const G in u)u[G].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),u&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),u&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this._i.notifyObservers(this),this._i.clear()}clone(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let z=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){z=this.customShader;const u=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";T[0]=O.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,u,void 0,void 0,void 0,this)}const m=this.serialize(s),f=Mu.Parse(m,this._scene||this._engine,this._rootUrl);return f.name=u,f.customShader=z,f._customWrappers=T,void 0===G&&(G=this.k),this.noiseTexture&&(f.noiseTexture=this.noiseTexture.clone()),f.k=G,f}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={};return ru._Serialize(G,this,u),G.activeParticleCount=this.activeParticleCount,G.randomTextureSize=this._randomTextureSize,G.customShader=this.customShader,G}static Parse(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const O=u.name;let m,f;G instanceof Cu.b?m=G:(f=G,m=f.getEngine());const C=new Mu(O,{Aj:z||u.Aj,randomTextureSize:u.randomTextureSize},G,null,u.isAnimationSheetEnabled);if(C._rootUrl=s,u.customShader&&m.createEffectForParticles){const G=u.customShader,s=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"",T=m.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,s,void 0,void 0,void 0,C);C.setCustomEffect(T,0),C.customShader=G}return u.id&&(C.id=u.id),u.activeParticleCount&&(C.activeParticleCount=u.activeParticleCount),ru._Parse(u,C,G,s),u.preventAutoStart&&(C.preventAutoStart=u.preventAutoStart),T||C.preventAutoStart||C.start(),C}}var ou=s(10564),Ru=s(11517),Bu=s(10861);class Du{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(u){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const G of this.systems)G.k=u;this._emitterNode=u}setEmitterAsSphere(u,G,s){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:u,renderingGroupId:G};const T=(0,Ru.c)("emitterSphere",{diameter:u.diameter,segments:u.segments},s);T.renderingGroupId=G;const z=new Bu.c("emitterSphereMaterial",s);z.emissiveColor=u.color,T.material=z;for(const O of this.systems)O.k=T;this._emitterNode=T}start(u){for(const G of this.systems)u&&(G.k=u),G.start()}dispose(){for(const u of this.systems)u.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G={systems:[]};for(const s of this.systems)G.systems.push(s.serialize(u));return this._emitterNode&&(G.k=this._emitterCreationOptions),G}static Parse(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;const z=new Du,O=this.BaseAssetsUrl+"/textures/";G=G||E.d.LastCreatedScene;for(const m of u.systems)z.systems.push(s?Mu.Parse(m,G,O,!0,T):ru.Parse(m,G,O,!0,T));if(u.k){const s=u.k.options;if("Sphere"===u.k.kind)z.setEmitterAsSphere({diameter:s.diameter,segments:s.segments,color:m.b.Ag(s.color)},u.k.renderingGroupId,G)}return z}}Du.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ku=s(10615);class wu{static CreateDefault(u){let G,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,T=arguments.length>2?arguments[2]:void 0;return G=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Mu("default system",{Aj:s},T):new ru("default system",s,T),G.k=u,G.particleTexture=new k.b("https://assets.babylonjs.com/textures/flare.png",G.va()),G.createConeEmitter(.1,Math.PI/4),G.color1=new m.e(1,1,1,1),G.color2=new m.e(1,1,1,1),G.colorDead=new m.e(1,1,1,0),G.minSize=.1,G.maxSize=.1,G.minEmitPower=2,G.maxEmitPower=2,G.updateSpeed=1/60,G.emitRate=30,G}static CreateAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;G||(G=E.d.LastCreatedScene);const z={};return G.addPendingData(z),new Promise(((O,m)=>{if(s&&!Mu.IsSupported)return G.removePendingData(z),m("Particle system with GPU is not supported.");ou.e.LoadFile(`${wu.BaseAssetsUrl}/systems/${u}.json`,(u=>{G.removePendingData(z);const m=JSON.parse(u.toString());return O(Du.Parse(m,G,s,T))}),void 0,void 0,void 0,(()=>(G.removePendingData(z),m(`An error occurred with the creation of your particle system. Check if your type '${u}' exists.`))))}))}static ExportSet(u){const G=new Du;for(const s of u)G.systems.push(s);return G}static ParseFromFileAsync(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",O=arguments.length>5?arguments[5]:void 0;return new Promise(((m,f)=>{const C=new ku.e;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const G=JSON.parse(C.responseText);let f;f=T?Mu.Parse(G,s,z,!1,O):ru.Parse(G,s,z,!1,O),u&&(f.name=u),m(f)}else f("Unable to load the particle system")})),C.open("GET",G),C.send()}))}static ParseFromSnippetAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0;if("_BLANK"===u){const u=this.CreateDefault(null);return u.start(),Promise.resolve(u)}return new Promise(((O,m)=>{const f=new ku.e;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const m=JSON.parse(JSON.parse(f.responseText).jsonPayload),C=JSON.parse(m.particleSystem);let x;x=s?Mu.Parse(C,G,T,!1,z):ru.Parse(C,G,T,!1,z),x.snippetId=u,O(x)}else m("Unable to load the snippet "+u)})),f.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),f.send()}))}}wu.BaseAssetsUrl=Du.BaseAssetsUrl,wu.SnippetUrl="https://snippet.babylonjs.com",wu.CreateFromSnippetAsync=wu.ParseFromSnippetAsync;var Lu=s(11148),Su=s(10986),eu=s(11526);(0,eu.g)(Su.d.NAME_PARTICLESYSTEM,((u,G,s,T)=>{const z=(0,eu.i)(Su.d.NAME_PARTICLESYSTEM);if(z&&void 0!==u.fj&&null!==u.fj)for(let O=0,m=u.fj.length;O<m;O++){const m=u.fj[O];s.fj.push(z(m,G,T))}})),(0,eu.c)(Su.d.NAME_PARTICLESYSTEM,((u,G,s)=>{if(u.activeParticleCount){return Mu.Parse(u,G,s)}return ru.Parse(u,G,s)})),Cu.b.prototype.createEffectForParticles=function(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",O=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=[],b=[];const Q=[];return C?C.fillUniformsAttributesAndSamplerNames(b,g,Q):(g=ru._GetAttributeNamesOrOptions(),b=ru._GetEffectCreationOptions()),-1===z.indexOf(" BILLBOARD")&&(z+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===z.indexOf(" ANIMATESHEET")&&(z+="\n#define ANIMATESHEET\n"),-1===T.indexOf("diffuseSampler")&&T.push("diffuseSampler"),this.createEffect({vertex:(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:u},g,b.concat(G),Q.concat(T),z,O,m,f,void 0,x,(async()=>{0===x?await Promise.resolve().then(s.bind(s,11564)):await Promise.resolve().then(s.bind(s,11627))}))},Lu.c.prototype.getEmittedParticleSystems=function(){const u=[];for(let G=0;G<this.va().fj.length;G++){const s=this.va().fj[G];s.k===this&&u.push(s)}return u},Lu.c.prototype.getHierarchyEmittedParticleSystems=function(){const u=[],G=this.getDescendants();G.push(this);for(let s=0;s<this.va().fj.length;s++){const T=this.va().fj[s],z=T.k;z.position&&-1!==G.indexOf(z)&&u.push(T)}return u};s(11059),s(11073),s(11191);s(11173),s(11534),s(11201),s(11050),s(11210);s(11380);var hu;s(11543),s(11107);!function(u){u[u.Color=2]="Color",u[u.UV=1]="UV",u[u.Random=0]="Random",u[u.Stated=3]="Stated"}(hu||(hu={}));s(11551),s(11564),s(11582),s(11627)},11412:(u,G,s)=>{"use strict";s.d(G,{c:()=>n});var T=s(10863),z=s(10881),O=s(10568),m=s(10904),f=s(10650),C=s(10866),x=s(10935),g=s(10715),b=s(10645),Q=s(10725),Y=s(11420);b.b.prototype.setTextureFromPostProcess=function(u,G,s){var T;let z=null;G&&(G._forcedOutputTexture?z=G._forcedOutputTexture:G._textures.data[G._currentRenderTextureInd]&&(z=G._textures.data[G._currentRenderTextureInd])),this._bindTexture(u,(null===(T=z)||void 0===T?void 0:T.texture)??null,s)},b.b.prototype.setTextureFromPostProcessOutput=function(u,G,s){var T;this._bindTexture(u,(null===G||void 0===G||null===(T=G._outputTexture)||void 0===T?void 0:T.texture)??null,s)},f.e.prototype.setTextureFromPostProcess=function(u,G){this._engine.setTextureFromPostProcess(this._samplers[u],G,u)},f.e.prototype.setTextureFromPostProcessOutput=function(u,G){this._engine.setTextureFromPostProcessOutput(this._samplers[u],G,u)};class n{static get ForceGLSL(){return Y.d.ForceGLSL}static set ForceGLSL(u){Y.d.ForceGLSL=u}static RegisterShaderCodeProcessing(u,G){Y.d.RegisterShaderCodeProcessing(u,G)}get name(){return this._effectWrapper.name}set name(u){this._effectWrapper.name=u}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(u){this._effectWrapper.alphaMode=u}get samples(){return this._samples}set samples(u){this._samples=Math.min(u,this._engine.getCaps().maxMSAASamples),this._textures.forEach((u=>{u.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(u){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),u&&(this._onActivateObserver=this.onActivateObservable.add(u))}set onSizeChanged(u){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(u)}set onApply(u){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(u)}set onBeforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u)}set onAfterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(u)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(u){this._forcedOutputTexture=u}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.hf(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(u,G,s,T,f,C){var x;let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,b=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",c=arguments.length>12?arguments[12]:void 0,j=arguments.length>13&&void 0!==arguments[13]&&arguments[13],l=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,P=arguments.length>15?arguments[15]:void 0,H=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ji=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new z.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new m.m(1,1),this._texelSize=m.m.Zero(),this.onActivateObservable=new O.e,this.onSizeChangedObservable=new O.e,this.onApplyObservable=new O.e,this.onBeforeRenderObservable=new O.e,this.onAfterRenderObservable=new O.e;let X,p=1,q=null;if(s&&!Array.isArray(s)){const u=s;s=u.uniforms??null,T=u.samplers??null,p=u.size??1,C=u.camera??null,g=u.samplingMode??1,b=u.jd,Q=u.reusable,V=Array.isArray(u.defines)?u.defines.join("\n"):u.defines??null,F=u.textureType??0,r=u.vertexUrl??"postprocess",c=u.indexParameters,j=u.blockCompilation??!1,l=u.textureFormat??5,P=u.shaderLanguage??0,q=u.uniformBuffers??null,H=u.extraInitializations,X=u.effectWrapper}else f&&(p="number"===typeof f?f:{width:f.width,height:f.height});const d=!!X;if(this._effectWrapper=X??new Y.d({name:u,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:G,jd:b||(null===(x=C)||void 0===x?void 0:x.va().getEngine()),uniforms:s,samplers:T,uniformBuffers:q,defines:V,vertexUrl:r,indexParameters:c,blockCompilation:j,shaderLanguage:P,extraInitializations:H}),this.name=u,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=C?(this._camera=C,this._scene=C.va(),C.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):b&&(this._engine=b,this._engine.postProcesses.push(this)),this._options=p,this.renderTargetSamplingMode=g||1,this._reusable=Q||!1,this._textureType=F,this._textureFormat=l,this._shaderLanguage=P||0,this._samplers=T||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=G,this._vertexUrl=r,this._parameters=s||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=q||[],this._indexParameters=c,!d){this._webGPUReady=1===this._shaderLanguage;const u=[];this._gatherImports(this._engine.isWebGPU&&!n.ForceGLSL,u),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(j,V,H,u)}}_gatherImports(){let u=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?u.push(Promise.all([s.e(37).then(s.bind(s,13140))])):u.push(Promise.all([Promise.resolve().then(s.bind(s,11429))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(u){return this._disposeTextures(),this._shareOutputWithPostProcess=u,this}useOwnOutput(){0==this._textures.length&&(this._textures=new z.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0,f=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(u,G,s,T,z,O,m,f),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let z=0;z<this._textureCache.length;z++)if(this._textureCache[z].texture.width===u.width&&this._textureCache[z].texture.height===u.height&&this._textureCache[z].postProcessChannel===s&&this._textureCache[z].texture._generateDepthBuffer===G.generateDepthBuffer&&this._textureCache[z].texture.samples===G.samples)return this._textureCache[z].texture;const T=this._engine.createRenderTargetTexture(u,G);return this._textureCache.push({texture:T,postProcessChannel:s,lastUsedRenderId:-1}),T}_flushTextureCache(){const u=this._renderId;for(let G=this._textureCache.length-1;G>=0;G--)if(u-this._textureCache[G].lastUsedRenderId>100){let u=!1;for(let s=0;s<this._textures.length;s++)if(this._textures.data[s]===this._textureCache[G].texture){u=!0;break}u||(this._textureCache[G].texture.dispose(),this._textureCache.splice(G,1))}}resize(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=u,this.height=G;let O=null;if(s)for(let C=0;C<s._postProcesses.length;C++)if(null!==s._postProcesses[C]){O=s._postProcesses[C];break}const m={width:this.width,height:this.height},f={generateMipMaps:T,generateDepthBuffer:z||O===this,generateStencilBuffer:(z||O===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(m,f,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(m,f,1)),this._texelSize.hf(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let u;if(this._shareOutputWithPostProcess)u=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)u=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let G;u=this.inputTexture;for(let s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture===u){G=this._textureCache[s];break}G&&(G.lastUsedRenderId=this._renderId)}return u}activate(u){var G,s;let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0;const O=(u=u||this._camera).va(),m=O.getEngine(),f=m.getCaps().maxTextureSize,C=(T?T.width:this._engine.getRenderWidth(!0))*this._options|0,x=(T?T.height:this._engine.getRenderHeight(!0))*this._options|0;let g=this._options.width||C,b=this._options.height||x;const Y=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let n=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const u=m.currentViewport;u&&(g*=u.width,b*=u.height)}(Y||this.alwaysForcePOT)&&(this._options.width||(g=m.needPOTTextures?(0,Q.h)(g,f,this.scaleMode):g),this._options.height||(b=m.needPOTTextures?(0,Q.h)(b,f,this.scaleMode):b)),this.width===g&&this.height===b&&(n=this._getTarget())||this.resize(g,b,u,Y,z),this._textures.forEach((u=>{u.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(u,this.samples)})),this._flushTextureCache(),this._renderId++}return n||(n=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.hf(C/g,x/b),this._engine.bindFramebuffer(n,0,C,x,this.forceFullscreenViewport)):(this._scaleRatio.hf(1,1),this._engine.bindFramebuffer(n,0,void 0,void 0,this.forceFullscreenViewport)),null===(G=(s=this._engine)._debugInsertMarker)||void 0===G||G.call(s,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(u),this.Ji&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:O.clearColor,O._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),n}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let u;var G;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),u=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(G=u)||void 0===G?void 0:G.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let u=this._textureCache.length-1;u>=0;u--)this._textureCache[u].texture.dispose();this._textureCache.length=0}setPrePassRenderer(u){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=u.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(u){let G;if(u=u||this._camera,this._disposeTextures(),this._scene&&(G=this._scene.postProcesses.indexOf(this),-1!==G&&this._scene.postProcesses.splice(G,1)),this._parentContainer){const u=this._parentContainer.postProcesses.indexOf(this);u>-1&&this._parentContainer.postProcesses.splice(u,1),this._parentContainer=null}if(G=this._engine.postProcesses.indexOf(this),-1!==G&&this._engine.postProcesses.splice(G,1),u){if(u.detachPostProcess(this),G=u._postProcesses.indexOf(this),0===G&&u._postProcesses.length>0){const u=this._camera._getFirstPostProcess();u&&u.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const u=x.e.Serialize(this),G=this.getCamera()||this._scene&&this._scene.activeCamera;return u.customType="BABYLON."+this.getClassName(),u.cameraId=G?G.id:null,u.reusable=this._reusable,u.textureType=this._textureType,u.fragmentUrl=this._fragmentUrl,u.parameters=this._parameters,u.samplers=this._samplers,u.uniformBuffers=this._uniformBuffers,u.options=this._options,u.defines=this._postProcessDefines,u.textureFormat=this._textureFormat,u.vertexUrl=this._vertexUrl,u.indexParameters=this._indexParameters,u}clone(){const u=this.serialize();u._engine=this._engine,u.cameraId=null;const G=n.Parse(u,this._scene,"");return G?(G.onActivateObservable=this.onActivateObservable.clone(),G.onSizeChangedObservable=this.onSizeChangedObservable.clone(),G.onApplyObservable=this.onApplyObservable.clone(),G.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),G.onAfterRenderObservable=this.onAfterRenderObservable.clone(),G._prePassEffectConfiguration=this._prePassEffectConfiguration,G):null}static Parse(u,G,s){const T=(0,g.e)(u.customType);if(!T||!T._Parse)return null;const z=G?G.getCameraById(u.cameraId):null;return T._Parse(u,z,G,s)}static _Parse(u,G,s,T){return x.e.Parse((()=>new n(u.name,u.fragmentUrl,u.parameters,u.samplers,u.options,G,u.renderTargetSamplingMode,u._engine,u.reusable,u.defines,u.textureType,u.vertexUrl,u.indexParameters,!1,u.textureFormat)),u,s,T)}}(0,T.b)([(0,C.M)()],n.prototype,"uniqueId",void 0),(0,T.b)([(0,C.M)()],n.prototype,"name",null),(0,T.b)([(0,C.M)()],n.prototype,"width",void 0),(0,T.b)([(0,C.M)()],n.prototype,"height",void 0),(0,T.b)([(0,C.M)()],n.prototype,"renderTargetSamplingMode",void 0),(0,T.b)([(0,C.o)()],n.prototype,"clearColor",void 0),(0,T.b)([(0,C.M)()],n.prototype,"Ji",void 0),(0,T.b)([(0,C.M)()],n.prototype,"forceAutoClearInAlphaMode",void 0),(0,T.b)([(0,C.M)()],n.prototype,"alphaMode",null),(0,T.b)([(0,C.M)()],n.prototype,"alphaConstants",void 0),(0,T.b)([(0,C.M)()],n.prototype,"enablePixelPerfectMode",void 0),(0,T.b)([(0,C.M)()],n.prototype,"forceFullscreenViewport",void 0),(0,T.b)([(0,C.M)()],n.prototype,"scaleMode",void 0),(0,T.b)([(0,C.M)()],n.prototype,"alwaysForcePOT",void 0),(0,T.b)([(0,C.M)("samples")],n.prototype,"_samples",void 0),(0,T.b)([(0,C.M)()],n.prototype,"adaptScaleToCurrentViewport",void 0),(0,g.g)("BABYLON.PostProcess",n)},10972:(u,G,s)=>{"use strict";s.d(G,{e:()=>O});var T=s(10961),z=s(10568);class O{constructor(u){this._vertexBuffers={},this.onBeforeRenderObservable=new z.e,this._scene=u}_prepareBuffers(){if(this._vertexBuffers[T.f.PositionKind])return;const u=[];u.push(1,1),u.push(-1,1),u.push(-1,-1),u.push(1,-1),this._vertexBuffers[T.f.PositionKind]=new T.f(this._scene.getEngine(),u,T.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const u=[];u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(u)}_rebuild(){const u=this._vertexBuffers[T.f.PositionKind];u&&(u._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=this._scene.activeCamera;return!!s&&(G=G||s._postProcesses.filter((u=>null!=u)),!(!G||0===G.length||!this._scene.postProcessesEnabled)&&(G[0].activate(s,u,null!==G&&void 0!==G),!0))}directRender(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=this._scene.getEngine();for(let C=0;C<u.length;C++){var f;if(C<u.length-1)u[C+1].activate(this._scene.activeCamera,null===G||void 0===G?void 0:G.texture);else G?m.bindFramebuffer(G,T,void 0,void 0,s,z):O||m.restoreDefaultFramebuffer(),null===(f=m._debugInsertMarker)||void 0===f||f.call(m,`post process ${u[C].name} output`);const x=u[C],g=x.apply();g&&(x.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),m.bindBuffers(this._vertexBuffers,this._indexBuffer,g),m.drawElementsType(0,0,6),x.onAfterRenderObservable.notifyObservers(g))}m.setDepthBuffer(!0),m.setDepthWrite(!0)}_finalizeFrame(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=this._scene.activeCamera;if(!O)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(T=T||O._postProcesses.filter((u=>null!=u))).length||!this._scene.postProcessesEnabled)return;const m=this._scene.getEngine();for(let C=0,x=T.length;C<x;C++){const g=T[C];var f;if(C<x-1)g._outputTexture=T[C+1].activate(O,null===G||void 0===G?void 0:G.texture);else G?(m.bindFramebuffer(G,s,void 0,void 0,z),g._outputTexture=G):(m.restoreDefaultFramebuffer(),g._outputTexture=null),null===(f=m._debugInsertMarker)||void 0===f||f.call(m,`post process ${T[C].name} output`);if(u)break;const b=g.apply();b&&(g.onBeforeRenderObservable.notifyObservers(b),this._prepareBuffers(),m.bindBuffers(this._vertexBuffers,this._indexBuffer,b),m.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(b))}m.setDepthBuffer(!0),m.setDepthWrite(!0),m.setAlphaMode(0)}dispose(){const u=this._vertexBuffers[T.f.PositionKind];u&&(u.dispose(),this._vertexBuffers[T.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},10980:(u,G,s)=>{"use strict";s.d(G,{b:()=>f});var T=s(10881),z=s(10904);class O{set opaqueSortCompareFn(u){this._opaqueSortCompareFn=u||O.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(u){this._alphaTestSortCompareFn=u||O.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(u){this._transparentSortCompareFn=u||O.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=u,this._opaqueSubMeshes=new T.e(256),this._transparentSubMeshes=new T.e(256),this._alphaTestSubMeshes=new T.e(256),this._depthOnlySubMeshes=new T.e(256),this._particleSystems=new T.e(256),this._spriteManagers=new T.e(256),this._empty=!0,this._edgesRenderers=new T.b(16),this._scene=G,this.opaqueSortCompareFn=s,this.alphaTestSortCompareFn=z,this.transparentSortCompareFn=O}render(u,G,s,T){if(u)return void u(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const z=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(z.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),z.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const O=z.getStencilBuffer();if(z.setStencilBuffer(!1),G&&this._renderSprites(),s&&this._renderParticles(T),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(z.setStencilBuffer(O),this._scene.useOrderIndependentTransparency){const u=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);u.length&&this._renderTransparent(u)}else this._renderTransparent(this._transparentSubMeshes);z.setAlphaMode(0)}if(z.setStencilBuffer(!1),this._edgesRenderers.length){for(let u=0;u<this._edgesRenderers.length;u++)this._edgesRenderers.data[u].render();z.setAlphaMode(0)}z.setStencilBuffer(O)}_renderOpaqueSorted(u){O._RenderSorted(u,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(u){O._RenderSorted(u,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(u){O._RenderSorted(u,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(u,G,s,T){let m,f=0;const C=s?s.globalPosition:O._ZeroVector;if(T)for(;f<u.length;f++)m=u.data[f],m._alphaIndex=m.getMesh().alphaIndex,m._distanceToCamera=z.q.Distance(m.getBoundingInfo().boundingSphere.centerWorld,C);const x=u.length===u.data.length?u.data:u.data.slice(0,u.length);G&&x.sort(G);const g=x[0].getMesh().va();for(f=0;f<x.length;f++)if(m=x[f],!g._activeMeshesFrozenButKeepClipping||m.isInFrustum(g._frustumPlanes)){if(T){const u=m.Ha();if(u&&u.needDepthPrePass){const G=u.va().getEngine();G.setColorWrite(!1),G.setAlphaMode(0),m.render(!1),G.setColorWrite(!0)}}m.render(T)}}static defaultTransparentSortCompare(u,G){return u._alphaIndex>G._alphaIndex?1:u._alphaIndex<G._alphaIndex?-1:O.backToFrontSortCompare(u,G)}static backToFrontSortCompare(u,G){return u._distanceToCamera<G._distanceToCamera?1:u._distanceToCamera>G._distanceToCamera?-1:0}static frontToBackSortCompare(u,G){return u._distanceToCamera<G._distanceToCamera?-1:u._distanceToCamera>G._distanceToCamera?1:0}static PainterSortCompare(u,G){const s=u.getMesh(),T=G.getMesh();return s.material&&T.material?s.material.uniqueId-T.material.uniqueId:s.uniqueId-T.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(u,G,s){void 0===G&&(G=u.getMesh()),void 0===s&&(s=u.Ha()),null!==s&&void 0!==s&&(s.needAlphaBlendingForMesh(G)?this._transparentSubMeshes.push(u):s.needAlphaTesting()?(s.needDepthPrePass&&this._depthOnlySubMeshes.push(u),this._alphaTestSubMeshes.push(u)):(s.needDepthPrePass&&this._depthOnlySubMeshes.push(u),this._opaqueSubMeshes.push(u)),G._renderingGroup=this,G._edgesRenderer&&G.isEnabled()&&G.isVisible&&G._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(G._edgesRenderer),this._empty=!1)}dispatchSprites(u){this._spriteManagers.push(u),this._empty=!1}dispatchParticles(u){this._particleSystems.push(u),this._empty=!1}_renderParticles(u){if(0===this._particleSystems.length)return;const G=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let s=0;s<this._particleSystems.length;s++){const T=this._particleSystems.data[s];if(0===(G&&G.layerMask&T.layerMask))continue;const z=T.k;z.position&&u&&-1===u.indexOf(z)||this._scene._activeParticles.addCount(T.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const u=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let G=0;G<this._spriteManagers.length;G++){const s=this._spriteManagers.data[G];0!==(u&&u.layerMask&s.layerMask)&&s.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}O._ZeroVector=z.q.Zero();class m{}class f{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(u){u!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=u,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const u of this._scene.meshes)if(u.xf)for(const G of u.xf)G._wasDispatched=!1;if(this._scene.spriteManagers)for(const u of this._scene.spriteManagers)u._wasDispatched=!1;for(const u of this._scene.fj)u._wasDispatched=!1}constructor(u){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new m,this._maintainStateBetweenFrames=!1,this._scene=u;for(let G=f.MIN_RENDERINGGROUPS;G<f.MAX_RENDERINGGROUPS;G++)this._autoClearDepthStencil[G]={Ji:!0,depth:!0,stencil:!0}}getRenderingGroup(u){const G=u||0;return this._prepareRenderingGroup(G),this._renderingGroups[G]}_clearDepthStencilBuffer(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,u,G),this._depthStencilBufferAlreadyCleaned=!0)}render(u,G,s,T){const z=this._renderingGroupInfo;if(z.wf=this._scene,z.camera=this._scene.activeCamera,this._scene.spriteManagers&&T)for(let O=0;O<this._scene.spriteManagers.length;O++){const u=this._scene.spriteManagers[O];this.dispatchSprites(u)}for(let O=f.MIN_RENDERINGGROUPS;O<f.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===f.MIN_RENDERINGGROUPS;const m=this._renderingGroups[O];if(!m||m._empty)continue;const C=1<<O;if(z.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(z,C),f.AUTOCLEAR){const u=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];u&&u.Ji&&this._clearDepthStencilBuffer(u.depth,u.stencil)}for(const u of this._scene._beforeRenderingGroupDrawStage)u.action(O);m.render(u,T,s,G);for(const u of this._scene._afterRenderingGroupDrawStage)u.action(O);this._scene.onAfterRenderingGroupObservable.notifyObservers(z,C)}}reset(){if(!this.maintainStateBetweenFrames)for(let u=f.MIN_RENDERINGGROUPS;u<f.MAX_RENDERINGGROUPS;u++){const G=this._renderingGroups[u];G&&G.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let u=f.MIN_RENDERINGGROUPS;u<f.MAX_RENDERINGGROUPS;u++){const G=this._renderingGroups[u];G&&G.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let u=f.MIN_RENDERINGGROUPS;u<f.MAX_RENDERINGGROUPS;u++){const G=this._renderingGroups[u];G&&G.dispose()}}_prepareRenderingGroup(u){void 0===this._renderingGroups[u]&&(this._renderingGroups[u]=new O(u,this._scene,this._customOpaqueSortCompareFn[u],this._customAlphaTestSortCompareFn[u],this._customTransparentSortCompareFn[u]))}dispatchSprites(u){this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatchSprites(u))}dispatchParticles(u){this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatchParticles(u))}dispatch(u,G,s){void 0===G&&(G=u.getMesh()),this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatch(u,G,s))}setRenderingOrder(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[u]=G,this._customAlphaTestSortCompareFn[u]=s,this._customTransparentSortCompareFn[u]=T,this._renderingGroups[u]){const G=this._renderingGroups[u];G.opaqueSortCompareFn=this._customOpaqueSortCompareFn[u],G.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[u],G.transparentSortCompareFn=this._customTransparentSortCompareFn[u]}}setRenderingAutoClearDepthStencil(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[u]={Ji:G,depth:s,stencil:T}}getAutoClearDepthStencilSetup(u){return this._autoClearDepthStencil[u]}}f.MAX_RENDERINGGROUPS=4,f.MIN_RENDERINGGROUPS=0,f.AUTOCLEAR=!0},11613:(u,G,s)=>{"use strict";const T="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11586:(u,G,s)=>{"use strict";const T="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11648:(u,G,s)=>{"use strict";const T="clipPlaneVertex",z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11630:(u,G,s)=>{"use strict";const T="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11625:(u,G,s)=>{"use strict";const T="fogFragment",z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11610:(u,G,s)=>{"use strict";const T="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11651:(u,G,s)=>{"use strict";const T="fogVertex",z="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11639:(u,G,s)=>{"use strict";const T="fogVertexDeclaration",z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11601:(u,G,s)=>{"use strict";const T="helperFunctions",z="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11591:(u,G,s)=>{"use strict";const T="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11606:(u,G,s)=>{"use strict";const T="imageProcessingFunctions",z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";s(10655).b.IncludesShadersStoreWGSL[T]=z},11596:(u,G,s)=>{"use strict";const T="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11619:(u,G,s)=>{"use strict";const T="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11655:(u,G,s)=>{"use strict";const T="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";s(10655).b.IncludesShadersStoreWGSL[T]=z},11582:(u,G,s)=>{"use strict";s.r(G),s.d(G,{particlesPixelShaderWGSL:()=>m});var T=s(10655);s(11586),s(11591),s(11596),s(11601),s(11606),s(11610),s(11613),s(11619),s(11625);const z="particlesPixelShader",O="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.b.ShadersStoreWGSL[z]=O;const m={name:z,shader:O}},11627:(u,G,s)=>{"use strict";s.r(G),s.d(G,{particlesVertexShaderWGSL:()=>m});var T=s(10655);s(11630),s(11639),s(11596),s(11648),s(11651),s(11655);const z="particlesVertexShader",O="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.b.ShadersStoreWGSL[z]=O;const m={name:z,shader:O}},11473:(u,G,s)=>{"use strict";const T="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11559:(u,G,s)=>{"use strict";const T="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11496:(u,G,s)=>{"use strict";const T="clipPlaneVertex",z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11573:(u,G,s)=>{"use strict";const T="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11488:(u,G,s)=>{"use strict";const T="fogFragment",z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11468:(u,G,s)=>{"use strict";const T="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11505:(u,G,s)=>{"use strict";const T="fogVertex",z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11491:(u,G,s)=>{"use strict";const T="fogVertexDeclaration",z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11459:(u,G,s)=>{"use strict";const T="helperFunctions",z="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";s(10655).b.IncludesShadersStore[T]=z},11445:(u,G,s)=>{"use strict";const T="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11465:(u,G,s)=>{"use strict";const T="imageProcessingFunctions",z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";s(10655).b.IncludesShadersStore[T]=z},11452:(u,G,s)=>{"use strict";const T="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11482:(u,G,s)=>{"use strict";const T="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11510:(u,G,s)=>{"use strict";const T="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";s(10655).b.IncludesShadersStore[T]=z},11551:(u,G,s)=>{"use strict";s.r(G),s.d(G,{particlesPixelShader:()=>m});var T=s(10655);s(11559),s(11445),s(11452),s(11459),s(11465),s(11468),s(11473),s(11482),s(11488);const z="particlesPixelShader",O="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.b.ShadersStore[z]=O;const m={name:z,shader:O}},11564:(u,G,s)=>{"use strict";s.r(G),s.d(G,{particlesVertexShader:()=>m});var T=s(10655);s(11573),s(11491),s(11452),s(11496),s(11505),s(11510);const z="particlesVertexShader",O="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.b.ShadersStore[z]=O;const m={name:z,shader:O}},11429:(u,G,s)=>{"use strict";s.r(G),s.d(G,{postprocessVertexShader:()=>O});const T="postprocessVertexShader",z="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";s(10655).b.ShadersStore[T]=z;const O={name:T,shader:z}},11010:(u,G,s)=>{"use strict";s.d(G,{e:()=>T});class T{}T._IsPickingAvailable=!1},11161:(u,G,s)=>{"use strict";s.d(G,{b:()=>b});var T=s(10863),z=s(10904),O=s(10866),m=s(10568),f=s(10619),C=s(10609),x=s(10935);class g{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new m.e,this._onClonedObservable=new m.e}}class b{static AddNodeConstructor(u,G){this._NodeConstructors[u]=G}static Construct(u,G,s,T){const z=this._NodeConstructors[u];return z?z(G,s,T):null}set accessibilityTag(u){this._accessibilityTag=u,this.onAccessibilityTagChangedObservable.notifyObservers(u)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(u){this._nodeDataStorage._doNotSerialize=u}u(){return this._nodeDataStorage._isDisposed}set parent(u){if(this._parentNode===u)return;const G=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const G=this._parentNode._children.indexOf(this);-1!==G&&this._parentNode._children.splice(G,1),u||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=u,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),G||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(u){u.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const u=this._scene.rootNodes,G=u.length-1;u[this._nodeDataStorage._sceneRootNodesIndex]=u[G],u[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}getClassName(){return"Node"}set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new g,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new m.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=z.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this._i=new m.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=u,this.id=u,this._scene=G||f.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),s&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(u)||(u.init(),this._scene.isLoading&&!G?this._scene.onDataLoadedObservable.addOnce((()=>{u.attach(this)})):u.attach(this),this._behaviors.push(u)),this}removeBehavior(u){const G=this._behaviors.indexOf(u);return-1===G||(this._behaviors[G].detach(),this._behaviors.splice(G,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(u){for(const G of this._behaviors)if(G.name===u)return G;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Gj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(u){!u&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(u){return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_updateCache(u){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}pg(u){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((u=>{u._syncParentEnabledState()}))}Af(u){this._nodeDataStorage._isEnabled!==u&&(this._nodeDataStorage._isEnabled=u,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(u))}isDescendantOf(u){return!!this.parent&&(this.parent===u||this.parent.isDescendantOf(u))}_getDescendants(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;if(this._children)for(let T=0;T<this._children.length;T++){const z=this._children[T];s&&!s(z)||u.push(z),G||z._getDescendants(u,!1,s)}}getDescendants(u,G){const s=[];return this._getDescendants(s,u,G),s}getChildMeshes(u,G){const s=[];return this._getDescendants(s,u,(u=>(!G||G(u))&&void 0!==u.si)),s}getChildren(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(G,u)}_setReady(u){u!==this._nodeDataStorage._isReady&&(u?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(u){for(let G=0;G<this.animations.length;G++){const s=this.animations[G];if(s.name===u)return s}return null}createAnimationRange(u,G,s){if(!this._ranges[u]){this._ranges[u]=b._AnimationRangeFactory(u,G,s);for(let T=0,z=this.animations.length;T<z;T++)this.animations[T]&&this.animations[T].createRange(u,G,s)}}deleteAnimationRange(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let s=0,T=this.animations.length;s<T;s++)this.animations[s]&&this.animations[s].deleteRange(u,G);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}clone(u,G,s){const T=x.e.Clone((()=>new b(u,this.va())),this);if(G&&(T.parent=G),!s){const G=this.getDescendants(!0);for(let s=0;s<G.length;s++){const z=G[s];z.clone(u+"."+z.name,T)}}return T}getAnimationRanges(){const u=[];let G;for(G in this._ranges)u.push(this._ranges[G]);return u}beginAnimation(u,G,s,T){const z=this.getAnimationRange(u);return z?this._scene.beginAnimation(this,z.from,z.to,G,s,T):null}serializeAnimationRanges(){const u=[];for(const G in this._ranges){const s=this._ranges[G];if(!s)continue;const T={};T.name=G,T.from=s.from,T.to=s.to,u.push(T)}return u}Gj(u){return this._worldMatrix||(this._worldMatrix=z.d.Identity()),this._worldMatrix}dispose(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!u){const s=this.getDescendants(!0);for(const T of s)T.dispose(u,G)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this._i.notifyObservers(this),this._i.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const s of this._behaviors)s.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(u,G,s){if(G.ranges)for(let T=0;T<G.ranges.length;T++){const s=G.ranges[T];u.createAnimationRange(s.name,s.from,s.to)}}getHierarchyBoundingVectors(){let u,G,s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Gj(!0);const O=this;if(O.getBoundingInfo&&O.xf){const s=O.getBoundingInfo();u=s.boundingBox.minimumWorld.clone(),G=s.boundingBox.maximumWorld.clone()}else u=new z.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new z.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(s){const s=this.getDescendants(!1);for(const O of s){const s=O;if(s.Gj(!0),T&&!T(s))continue;if(!s.getBoundingInfo||0===s.getTotalVertices())continue;const m=s.getBoundingInfo().boundingBox,f=m.minimumWorld,C=m.maximumWorld;z.q.CheckExtends(f,u,G),z.q.CheckExtends(C,u,G)}}return{min:u,max:G}}}b._AnimationRangeFactory=(u,G,s)=>{throw(0,C.c)("AnimationRange")},b._NodeConstructors={},(0,T.b)([(0,O.M)()],b.prototype,"name",void 0),(0,T.b)([(0,O.M)()],b.prototype,"id",void 0),(0,T.b)([(0,O.M)()],b.prototype,"uniqueId",void 0),(0,T.b)([(0,O.M)()],b.prototype,"state",void 0),(0,T.b)([(0,O.M)()],b.prototype,"metadata",void 0)},10889:(u,G,s)=>{"use strict";s.d(G,{e:()=>uu});var T=s(10564),z=s(10601),O=s(10568),m=s(10881);class f{constructor(){this._count=0,this._data={}}p(u){this.clear(),u.forEach(((u,G)=>this.add(u,G)))}get(u){const G=this._data[u];if(void 0!==G)return G}getOrAddWithFactory(u,G){let s=this.get(u);return void 0!==s||(s=G(u),s&&this.add(u,s)),s}getOrAdd(u,G){const s=this.get(u);return void 0!==s?s:(this.add(u,G),G)}contains(u){return void 0!==this._data[u]}add(u,G){return void 0===this._data[u]&&(this._data[u]=G,++this._count,!0)}set(u,G){return void 0!==this._data[u]&&(this._data[u]=G,!0)}getAndRemove(u){const G=this.get(u);return void 0!==G?(delete this._data[u],--this._count,G):null}remove(u){return!!this.contains(u)&&(delete this._data[u],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(u){for(const G in this._data){u(G,this._data[G])}}first(u){for(const G in this._data){const s=u(G,this._data[G]);if(s)return s}return null}}var C=s(10896),x=s(10904),g=s(10927),b=s(10954),Q=s(10959);class Y{constructor(u,G,s,T,z,O){this.source=u,this.pointerX=G,this.pointerY=s,this.meshUnderPointer=T,this.sourceEvent=z,this.additionalData=O}static CreateNew(u,G,s){const T=u.va();return new Y(u,T.pointerX,T.pointerY,T.meshUnderPointer||u,G,s)}static CreateNewFromSprite(u,G,s,T){return new Y(u,G.pointerX,G.pointerY,G.meshUnderPointer,s,T)}static CreateNewFromScene(u,G){return new Y(null,u.pointerX,u.pointerY,u.meshUnderPointer,G)}static CreateNewFromPrimitive(u,G,s,T){return new Y(u,G.x,G.y,null,s,T)}}var n=s(10972),V=s(10980),F=s(10986),r=s(10577),c=s(10619),j=s(10609),l=s(10991);class P{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const u in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,u))return!0;return!1}static get HasPickTriggers(){for(const u in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,u)){const G=parseInt(u);if(G>=1&&G<=7)return!0}return!1}static HasSpecificTrigger(u){for(const G in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,G)){if(parseInt(G)===u)return!0}return!1}}P.Triggers={};var H,X,p,q,d,v,W,M=s(11e3);!function(u){u[u.Generic=0]="Generic",u[u.Keyboard=1]="Keyboard",u[u.Mouse=2]="Mouse",u[u.Touch=3]="Touch",u[u.DualShock=4]="DualShock",u[u.Xbox=5]="Xbox",u[u.Switch=6]="Switch",u[u.DualSense=7]="DualSense"}(H||(H={})),function(u){u[u.Horizontal=0]="Horizontal",u[u.Vertical=1]="Vertical",u[u.LeftClick=2]="LeftClick",u[u.MiddleClick=3]="MiddleClick",u[u.RightClick=4]="RightClick",u[u.BrowserBack=5]="BrowserBack",u[u.BrowserForward=6]="BrowserForward",u[u.MouseWheelX=7]="MouseWheelX",u[u.MouseWheelY=8]="MouseWheelY",u[u.MouseWheelZ=9]="MouseWheelZ",u[u.Move=12]="Move"}(X||(X={})),function(u){u[u.Horizontal=0]="Horizontal",u[u.Vertical=1]="Vertical",u[u.LeftClick=2]="LeftClick",u[u.MiddleClick=3]="MiddleClick",u[u.RightClick=4]="RightClick",u[u.BrowserBack=5]="BrowserBack",u[u.BrowserForward=6]="BrowserForward",u[u.MouseWheelX=7]="MouseWheelX",u[u.MouseWheelY=8]="MouseWheelY",u[u.MouseWheelZ=9]="MouseWheelZ",u[u.DeltaHorizontal=10]="DeltaHorizontal",u[u.DeltaVertical=11]="DeltaVertical"}(p||(p={})),function(u){u[u.Cross=0]="Cross",u[u.Circle=1]="Circle",u[u.Square=2]="Square",u[u.Triangle=3]="Triangle",u[u.L1=4]="L1",u[u.R1=5]="R1",u[u.L2=6]="L2",u[u.R2=7]="R2",u[u.Share=8]="Share",u[u.Options=9]="Options",u[u.L3=10]="L3",u[u.R3=11]="R3",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.TouchPad=17]="TouchPad",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(q||(q={})),function(u){u[u.Cross=0]="Cross",u[u.Circle=1]="Circle",u[u.Square=2]="Square",u[u.Triangle=3]="Triangle",u[u.L1=4]="L1",u[u.R1=5]="R1",u[u.L2=6]="L2",u[u.R2=7]="R2",u[u.Create=8]="Create",u[u.Options=9]="Options",u[u.L3=10]="L3",u[u.R3=11]="R3",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.TouchPad=17]="TouchPad",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(d||(d={})),function(u){u[u.A=0]="A",u[u.B=1]="B",u[u.X=2]="X",u[u.Y=3]="Y",u[u.LB=4]="LB",u[u.RB=5]="RB",u[u.LT=6]="LT",u[u.RT=7]="RT",u[u.Back=8]="Back",u[u.Start=9]="Start",u[u.LS=10]="LS",u[u.RS=11]="RS",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.LStickXAxis=17]="LStickXAxis",u[u.LStickYAxis=18]="LStickYAxis",u[u.RStickXAxis=19]="RStickXAxis",u[u.RStickYAxis=20]="RStickYAxis"}(v||(v={})),function(u){u[u.B=0]="B",u[u.A=1]="A",u[u.Y=2]="Y",u[u.X=3]="X",u[u.L=4]="L",u[u.R=5]="R",u[u.ZL=6]="ZL",u[u.ZR=7]="ZR",u[u.Minus=8]="Minus",u[u.Plus=9]="Plus",u[u.LS=10]="LS",u[u.RS=11]="RS",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.Capture=17]="Capture",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(W||(W={}));var o=s(11002);class R{static CreateDeviceEvent(u,G,s,T,z,O,m){switch(u){case H.Keyboard:return this._CreateKeyboardEvent(s,T,z,O);case H.Mouse:if(s===X.MouseWheelX||s===X.MouseWheelY||s===X.MouseWheelZ)return this._CreateWheelEvent(u,G,s,T,z,O);case H.Touch:return this._CreatePointerEvent(u,G,s,T,z,O,m);default:throw`Unable to generate event for device ${H[u]}`}}static _CreatePointerEvent(u,G,s,T,z,O,m){const f=this._CreateMouseEvent(u,G,s,T,z,O);u===H.Mouse?(f.deviceType=H.Mouse,f.pointerId=1,f.pointerType="mouse"):(f.deviceType=H.Touch,f.pointerId=m??G,f.pointerType="touch");let C=0;return C+=z.pollInput(u,G,X.LeftClick),C+=2*z.pollInput(u,G,X.RightClick),C+=4*z.pollInput(u,G,X.MiddleClick),f.buttons=C,s===X.Move?f.type="pointermove":s>=X.LeftClick&&s<=X.RightClick&&(f.type=1===T?"pointerdown":"pointerup",f.button=s-2),f}static _CreateWheelEvent(u,G,s,T,z,O){const m=this._CreateMouseEvent(u,G,s,T,z,O);switch(m.pointerId=1,m.type="wheel",m.deltaMode=o.e.DOM_DELTA_PIXEL,m.deltaX=0,m.deltaY=0,m.deltaZ=0,s){case X.MouseWheelX:m.deltaX=T;break;case X.MouseWheelY:m.deltaY=T;break;case X.MouseWheelZ:m.deltaZ=T}return m}static _CreateMouseEvent(u,G,s,T,z,O){const m=this._CreateEvent(O),f=z.pollInput(u,G,X.Horizontal),C=z.pollInput(u,G,X.Vertical);return O?(m.movementX=0,m.movementY=0,m.offsetX=m.movementX-O.getBoundingClientRect().x,m.offsetY=m.movementY-O.getBoundingClientRect().y):(m.movementX=z.pollInput(u,G,10),m.movementY=z.pollInput(u,G,11),m.offsetX=0,m.offsetY=0),this._CheckNonCharacterKeys(m,z),m.clientX=f,m.clientY=C,m.x=f,m.y=C,m.deviceType=u,m.deviceSlot=G,m.inputIndex=s,m}static _CreateKeyboardEvent(u,G,s,T){const z=this._CreateEvent(T);return this._CheckNonCharacterKeys(z,s),z.deviceType=H.Keyboard,z.deviceSlot=0,z.inputIndex=u,z.type=1===G?"keydown":"keyup",z.key=String.fromCharCode(u),z.keyCode=u,z}static _CheckNonCharacterKeys(u,G){const s=G.isDeviceAvailable(H.Keyboard),T=s&&1===G.pollInput(H.Keyboard,0,18),z=s&&1===G.pollInput(H.Keyboard,0,17),O=s&&(1===G.pollInput(H.Keyboard,0,91)||1===G.pollInput(H.Keyboard,0,92)||1===G.pollInput(H.Keyboard,0,93)),m=s&&1===G.pollInput(H.Keyboard,0,16);u.altKey=T,u.ctrlKey=z,u.metaKey=O,u.shiftKey=m}static _CreateEvent(u){const G={preventDefault:()=>{}};return G.target=u,G}}class B{constructor(u,G,s){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(u,G,((u,G,T,z)=>{const O=R.CreateDeviceEvent(u,G,T,z,this);s(u,G,O)})):this._createDummyNativeInput()}pollInput(u,G,s){return this._nativeInput.pollInput(u,G,s)}isDeviceAvailable(u){return u===H.Mouse||u===H.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const D=Object.keys(X).length/2;class k{constructor(u,G,s,z){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=T.e.IsSafari(),this._usingMacOS=(0,r.h)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=u=>{},this._keyboardUpEvent=u=>{},this._keyboardBlurEvent=u=>{},this._pointerMoveEvent=u=>{},this._pointerDownEvent=u=>{},this._pointerUpEvent=u=>{},this._pointerCancelEvent=u=>{},this._pointerWheelEvent=u=>{},this._pointerBlurEvent=u=>{},this._pointerMacOSChromeOutEvent=u=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,r.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,r.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=u=>{},this._gamepadDisconnectedEvent=u=>{},this._eventPrefix=T.e.GetPointerPrefix(u),this._engine=u,this._onDeviceConnected=G,this._onDeviceDisconnected=s,this._onInputChanged=z,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(u,G,s){const z=this._inputs[u][G];if(!z)throw`Unable to find device ${H[u]}`;u>=H.DualShock&&u<=H.DualSense&&this._updateDevice(u,G,s);const O=z[s];if(void 0===O)throw`Unable to find input ${s} for device ${H[u]} in slot ${G}`;return s===X.Move&&T.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),O}isDeviceAvailable(u){return void 0!==this._inputs[u]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const u=null===this||void 0===this?void 0:this._engine.getInputElement();if(u&&(!this._eventsAttached||this._elementToAttachTo!==u)){if(this._disableEvents(),this._inputs)for(const u of this._inputs)if(u)for(const G in u){const s=u[+G];if(s)for(let u=0;u<s.length;u++)s[u]=0}this._elementToAttachTo=u,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const u=navigator.getGamepads();for(const G of u)G&&this._addGamePad(G)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(H.Mouse,0,0,0)}_addGamePad(u){const G=this._getGamepadDeviceType(u.id),s=u.index;this._gamepads=this._gamepads||new Array(u.index+1),this._registerDevice(G,s,u.buttons.length+u.axes.length),this._gamepads[s]=G}_addPointerDevice(u,G,s,T){this._pointerActive||(this._pointerActive=!0),this._registerDevice(u,G,D);const z=this._inputs[u][G];z[0]=s,z[1]=T}_registerDevice(u,G,s){if(void 0===G)throw`Unable to register device ${H[u]} to undefined slot.`;if(this._inputs[u]||(this._inputs[u]={}),!this._inputs[u][G]){const T=new Array(s);T.fill(0),this._inputs[u][G]=T,this._onDeviceConnected(u,G)}}_unregisterDevice(u,G){this._inputs[u][G]&&(delete this._inputs[u][G],this._onDeviceDisconnected(u,G))}_handleKeyActions(){this._keyboardDownEvent=u=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(H.Keyboard,0,255));const G=this._inputs[H.Keyboard][0];if(G){G[u.keyCode]=1;const s=u;s.inputIndex=u.keyCode,this._usingMacOS&&u.metaKey&&"Meta"!==u.key&&(this._metaKeys.includes(u.keyCode)||this._metaKeys.push(u.keyCode)),this._onInputChanged(H.Keyboard,0,s)}},this._keyboardUpEvent=u=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(H.Keyboard,0,255));const G=this._inputs[H.Keyboard][0];if(G){G[u.keyCode]=0;const s=u;if(s.inputIndex=u.keyCode,this._usingMacOS&&"Meta"===u.key&&this._metaKeys.length>0){for(const u of this._metaKeys){const s=R.CreateDeviceEvent(H.Keyboard,0,u,0,this,this._elementToAttachTo);G[u]=0,this._onInputChanged(H.Keyboard,0,s)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(H.Keyboard,0,s)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const u=this._inputs[H.Keyboard][0];for(let G=0;G<u.length;G++)if(0!==u[G]){u[G]=0;const s=R.CreateDeviceEvent(H.Keyboard,0,G,0,this,this._elementToAttachTo);this._onInputChanged(H.Keyboard,0,s)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,r.h)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let T=0;T<this._maxTouchPoints;T++)this._activeTouchIds[T]=-1;this._pointerMoveEvent=u=>{const G=this._getPointerType(u);let s=G===H.Mouse?0:this._activeTouchIds.indexOf(u.pointerId);if(G===H.Touch&&-1===s){const z=this._activeTouchIds.indexOf(-1);if(!(z>=0))return void T.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);s=z,this._activeTouchIds[z]=u.pointerId,this._onDeviceConnected(G,s)}this._inputs[G]||(this._inputs[G]={}),this._inputs[G][s]||this._addPointerDevice(G,s,u.clientX,u.clientY);const z=this._inputs[G][s];if(z){const T=u;T.inputIndex=X.Move,z[X.Horizontal]=u.clientX,z[X.Vertical]=u.clientY,G===H.Touch&&0===z[X.LeftClick]&&(z[X.LeftClick]=1),void 0===u.pointerId&&(u.pointerId=this._mouseId),this._onInputChanged(G,s,T),this._usingSafari||-1===u.button||(T.inputIndex=u.button+2,z[u.button+2]=z[u.button+2]?0:1,this._onInputChanged(G,s,T))}},this._pointerDownEvent=u=>{const G=this._getPointerType(u);let s=G===H.Mouse?0:u.pointerId;if(G===H.Touch){let G=this._activeTouchIds.indexOf(u.pointerId);if(-1===G&&(G=this._activeTouchIds.indexOf(-1)),!(G>=0))return void T.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);s=G,this._activeTouchIds[G]=u.pointerId}this._inputs[G]||(this._inputs[G]={}),this._inputs[G][s]?G===H.Touch&&this._onDeviceConnected(G,s):this._addPointerDevice(G,s,u.clientX,u.clientY);const z=this._inputs[G][s];if(z){const T=z[X.Horizontal],m=z[X.Vertical];if(G===H.Mouse){if(void 0===u.pointerId&&(u.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(O){}}else if(u.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(u.pointerId)}catch(O){}z[X.Horizontal]=u.clientX,z[X.Vertical]=u.clientY,z[u.button+2]=1;const f=u;f.inputIndex=u.button+2,this._onInputChanged(G,s,f),T===u.clientX&&m===u.clientY||(f.inputIndex=X.Move,this._onInputChanged(G,s,f))}},this._pointerUpEvent=u=>{var G;const s=this._getPointerType(u),T=s===H.Mouse?0:this._activeTouchIds.indexOf(u.pointerId);if(s===H.Touch){if(-1===T)return;this._activeTouchIds[T]=-1}const z=null===(G=this._inputs[s])||void 0===G?void 0:G[T];if(z&&0!==z[u.button+2]){var O,m,f,C;const G=z[X.Horizontal],x=z[X.Vertical];z[X.Horizontal]=u.clientX,z[X.Vertical]=u.clientY,z[u.button+2]=0;const g=u;void 0===u.pointerId&&(u.pointerId=this._mouseId),G===u.clientX&&x===u.clientY||(g.inputIndex=X.Move,this._onInputChanged(s,T,g)),g.inputIndex=u.button+2,s===H.Mouse&&this._mouseId>=0&&null!==(O=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==O&&O.call(m,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):u.pointerId&&null!==(f=(C=this._elementToAttachTo).hasPointerCapture)&&void 0!==f&&f.call(C,u.pointerId)&&this._elementToAttachTo.releasePointerCapture(u.pointerId),this._onInputChanged(s,T,g),s===H.Touch&&this._onDeviceDisconnected(s,T)}},this._pointerCancelEvent=u=>{if("mouse"===u.pointerType){var G,s;const u=this._inputs[H.Mouse][0];this._mouseId>=0&&null!==(G=(s=this._elementToAttachTo).hasPointerCapture)&&void 0!==G&&G.call(s,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let G=X.LeftClick;G<=X.BrowserForward;G++)if(1===u[G]){u[G]=0;const s=R.CreateDeviceEvent(H.Mouse,0,G,0,this,this._elementToAttachTo);this._onInputChanged(H.Mouse,0,s)}}else{var T,z;const G=this._activeTouchIds.indexOf(u.pointerId);if(-1===G)return;null!==(T=(z=this._elementToAttachTo).hasPointerCapture)&&void 0!==T&&T.call(z,u.pointerId)&&this._elementToAttachTo.releasePointerCapture(u.pointerId),this._inputs[H.Touch][G][X.LeftClick]=0;const s=R.CreateDeviceEvent(H.Touch,G,X.LeftClick,0,this,this._elementToAttachTo,u.pointerId);this._onInputChanged(H.Touch,G,s),this._activeTouchIds[G]=-1,this._onDeviceDisconnected(H.Touch,G)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let u=!1;const G=function(){};try{const s=Object.defineProperty({},"passive",{get:function(){u=!0}});this._elementToAttachTo.addEventListener("test",G,s),this._elementToAttachTo.removeEventListener("test",G,s)}catch(s){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(H.Mouse)){var u,G;const s=this._inputs[H.Mouse][0];this._mouseId>=0&&null!==(u=(G=this._elementToAttachTo).hasPointerCapture)&&void 0!==u&&u.call(G,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let u=X.LeftClick;u<=X.BrowserForward;u++)if(1===s[u]){s[u]=0;const G=R.CreateDeviceEvent(H.Mouse,0,u,0,this,this._elementToAttachTo);this._onInputChanged(H.Mouse,0,G)}}if(this.isDeviceAvailable(H.Touch)){const u=this._inputs[H.Touch];for(let G=0;G<this._activeTouchIds.length;G++){var s,T,z;const O=this._activeTouchIds[G];if(null!==(s=(T=this._elementToAttachTo).hasPointerCapture)&&void 0!==s&&s.call(T,O)&&this._elementToAttachTo.releasePointerCapture(O),-1!==O&&1===(null===(z=u[G])||void 0===z?void 0:z[X.LeftClick])){u[G][X.LeftClick]=0;const s=R.CreateDeviceEvent(H.Touch,G,X.LeftClick,0,this,this._elementToAttachTo,O);this._onInputChanged(H.Touch,G,s),this._activeTouchIds[G]=-1,this._onDeviceDisconnected(H.Touch,G)}}}},this._pointerWheelEvent=u=>{const G=H.Mouse;this._inputs[G]||(this._inputs[G]=[]),this._inputs[G][0]||(this._pointerActive=!0,this._registerDevice(G,0,D));const s=this._inputs[G][0];if(s){s[X.MouseWheelX]=u.deltaX||0,s[X.MouseWheelY]=u.deltaY||u.wheelDelta||0,s[X.MouseWheelZ]=u.deltaZ||0;const T=u;void 0===u.pointerId&&(u.pointerId=this._mouseId),0!==s[X.MouseWheelX]&&(T.inputIndex=X.MouseWheelX,this._onInputChanged(G,0,T)),0!==s[X.MouseWheelY]&&(T.inputIndex=X.MouseWheelY,this._onInputChanged(G,0,T)),0!==s[X.MouseWheelZ]&&(T.inputIndex=X.MouseWheelZ,this._onInputChanged(G,0,T))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=u=>{u.buttons>1&&this._pointerCancelEvent(u)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!u&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(H.Mouse)){const u=this._inputs[H.Mouse][0];u[X.MouseWheelX]=0,u[X.MouseWheelY]=0,u[X.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=u=>{this._addGamePad(u.gamepad)},this._gamepadDisconnectedEvent=u=>{if(this._gamepads){const G=this._getGamepadDeviceType(u.gamepad.id),s=u.gamepad.index;this._unregisterDevice(G,s),delete this._gamepads[s]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(u,G,s){const T=navigator.getGamepads()[G];if(T&&u===this._gamepads[G]){const z=this._inputs[u][G];s>=T.buttons.length?z[s]=T.axes[s-T.buttons.length].valueOf():z[s]=T.buttons[s].value}}_getGamepadDeviceType(u){return-1!==u.indexOf("054c")?-1!==u.indexOf("0ce6")?H.DualSense:H.DualShock:-1!==u.indexOf("Xbox One")||-1!==u.search("Xbox 360")||-1!==u.search("xinput")?H.Xbox:-1!==u.indexOf("057e")?H.Switch:H.Generic}_getPointerType(u){let G=H.Mouse;return("touch"===u.pointerType||"pen"===u.pointerType||u.touches)&&(G=H.Touch),G}}class w{constructor(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=G,this.deviceSlot=s,this.onInputChangedObservable=new O.e,this._deviceInputSystem=u}getInput(u){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,u)}}class L{constructor(u){this._registeredManagers=new Array,this._refCount=0,this.registerManager=u=>{for(let G=0;G<this._devices.length;G++){const s=this._devices[G];for(const T in s){const s=+T;u._addDevice(new w(this._deviceInputSystem,G,s))}}this._registeredManagers.push(u)},this.unregisterManager=u=>{const G=this._registeredManagers.indexOf(u);G>-1&&this._registeredManagers.splice(G,1)};const G=Object.keys(H).length/2;this._devices=new Array(G);const s=(u,G)=>{this._devices[u]||(this._devices[u]=new Array),this._devices[u][G]||(this._devices[u][G]=G);for(const s of this._registeredManagers){const T=new w(this._deviceInputSystem,u,G);s._addDevice(T)}},T=(u,G)=>{var s;null!==(s=this._devices[u])&&void 0!==s&&s[G]&&delete this._devices[u][G];for(const T of this._registeredManagers)T._removeDevice(u,G)},z=(u,G,s)=>{if(s)for(const T of this._registeredManagers)T._onInputChanged(u,G,s)};"undefined"!==typeof _native?this._deviceInputSystem=new B(s,T,z):this._deviceInputSystem=new k(u,s,T,z)}dispose(){this._deviceInputSystem.dispose()}}class S{getDeviceSource(u,G){if(void 0===G){if(void 0===this._firstDevice[u])return null;G=this._firstDevice[u]}return this._devices[u]&&void 0!==this._devices[u][G]?this._devices[u][G]:null}getDeviceSources(u){return this._devices[u]?this._devices[u].filter((u=>!!u)):[]}constructor(u){const G=Object.keys(H).length/2;this._devices=new Array(G),this._firstDevice=new Array(G),this._engine=u,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new L(u)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new O.e((u=>{for(const G of this._devices)if(G)for(const s of G)s&&this.onDeviceConnectedObservable.notifyObserver(u,s)})),this.onDeviceDisconnectedObservable=new O.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=u._i.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine._i.remove(this._onDisposeObserver)}_addDevice(u){this._devices[u.deviceType]||(this._devices[u.deviceType]=new Array),this._devices[u.deviceType][u.deviceSlot]||(this._devices[u.deviceType][u.deviceSlot]=u,this._updateFirstDevices(u.deviceType)),this.onDeviceConnectedObservable.notifyObservers(u)}_removeDevice(u,G){var s,T;const z=null===(s=this._devices[u])||void 0===s?void 0:s[G];this.onDeviceDisconnectedObservable.notifyObservers(z),null!==(T=this._devices[u])&&void 0!==T&&T[G]&&delete this._devices[u][G],this._updateFirstDevices(u)}_onInputChanged(u,G,s){var T,z;null===(T=this._devices[u])||void 0===T||null===(z=T[G])||void 0===z||z.onInputChangedObservable.notifyObservers(s)}_updateFirstDevices(u){switch(u){case H.Keyboard:case H.Mouse:this._firstDevice[u]=0;break;case H.Touch:case H.DualSense:case H.DualShock:case H.Xbox:case H.Switch:case H.Generic:{delete this._firstDevice[u];const G=this._devices[u];if(G)for(let s=0;s<G.length;s++)if(G[s]){this._firstDevice[u]=s;break}break}}}}var e=s(11010);class h{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(u){this._singleClick=u}set doubleClick(u){this._doubleClick=u}set hasSwiped(u){this._hasSwiped=u}set ignore(u){this._ignore=u}}class I{constructor(u){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new x.m(0,0),this._previousStartingPointerPosition=new x.m(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=u||c.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(u){return this._meshUnderPointerId[u]||null}get unTranslatedPointer(){return new x.m(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(u){this._pointerX=u}get pointerY(){return this._pointerY}set pointerY(u){this._pointerY=u}_updatePointerPosition(u){const G=this._scene.getEngine().getInputElementClientRect();G&&(this._pointerX=u.clientX-G.left,this._pointerY=u.clientY-G.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(u,G){const s=this._scene,T=s.getEngine(),z=T.getInputElement();z&&(z.tabIndex=T.canvasTabIndex,s.doNotHandleCursors||(z.style.cursor=s.defaultCursor)),this._setCursorAndPointerOverMesh(u,G,s);for(const C of s._pointerMoveStage){var O;const s=!(null===(O=u=u||this._pickMove(G))||void 0===O||!O.pickedMesh);u=C.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,s,z)}const m=G.inputIndex>=X.MouseWheelX&&G.inputIndex<=X.MouseWheelZ?l.d.POINTERWHEEL:l.d.POINTERMOVE;let f;s.onPointerMove&&(u=u||this._pickMove(G),s.onPointerMove(G,u,m)),u?(f=new l.i(m,G,u),this._setRayOnPointerInfo(u,G)):(f=new l.i(m,G,null,this),this._movePointerInfo=f),s.onPointerObservable.hasObservers()&&s.onPointerObservable.notifyObservers(f,m)}_setRayOnPointerInfo(u,G){const s=this._scene;u&&e.e._IsPickingAvailable&&(u.ray||(u.ray=s.createPickingRay(G.offsetX,G.offsetY,x.d.Identity(),s.activeCamera)))}_addCameraPointerObserver(u,G){return this._cameraObserverCount++,this._scene.onPointerObservable.add(u,G)}_removeCameraPointerObserver(u){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(u)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(u,G,s){const T=this._scene,z=new l.e(s,G,this._unTranslatedPointerX,this._unTranslatedPointerY);return u&&(z.originalPickingInfo=u,z.ray=u.ray,"xr-near"===G.pointerType&&u.originMesh&&(z.nearInteractionPickingInfo=u)),T.onPrePointerObservable.notifyObservers(z,s),!!z.skipOnPointerObservable}_pickMove(u){const G=this._scene,s=G.Mc(this._unTranslatedPointerX,this._unTranslatedPointerY,G.pointerMovePredicate,G.pointerMoveFastCheck,G.cameraToUseForPointers,G.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(s,u,G),s}_setCursorAndPointerOverMesh(u,G,s){const T=s.getEngine().getInputElement();if(null!==u&&void 0!==u&&u.pickedMesh){if(this.setPointerOverMesh(u.pickedMesh,G.pointerId,u,G),!s.doNotHandleCursors&&T&&this._pointerOverMesh){const u=this._pointerOverMesh._getActionManagerForTrigger();u&&u.hasPointerTriggers&&(T.style.cursor=u.hoverCursor||s.hoverCursor)}}else this.setPointerOverMesh(null,G.pointerId,u,G)}simulatePointerMove(u,G){const s=new PointerEvent("pointermove",G);s.inputIndex=X.Move,this._checkPrePointerObservable(u,s,l.d.POINTERMOVE)||this._processPointerMove(u,s)}simulatePointerDown(u,G){const s=new PointerEvent("pointerdown",G);s.inputIndex=s.button+2,this._checkPrePointerObservable(u,s,l.d.POINTERDOWN)||this._processPointerDown(u,s)}_processPointerDown(u,G){var s;const T=this._scene;if(null!==(s=u)&&void 0!==s&&s.pickedMesh){this._pickedDownMesh=u.pickedMesh;const s=u.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,Y.CreateNew(u.pickedMesh,G,u)),G.button){case 0:s.processTrigger(2,Y.CreateNew(u.pickedMesh,G,u));break;case 1:s.processTrigger(4,Y.CreateNew(u.pickedMesh,G,u));break;case 2:s.processTrigger(3,Y.CreateNew(u.pickedMesh,G,u))}s.hasSpecificTrigger(8)&&window.setTimeout((()=>{const u=T.Mc(this._unTranslatedPointerX,this._unTranslatedPointerY,(u=>u.me&&u.isVisible&&u.isReady()&&u.actionManager&&u.actionManager.hasSpecificTrigger(8)&&u===this._pickedDownMesh),!1,T.cameraToUseForPointers);null!==u&&void 0!==u&&u.pickedMesh&&s&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>I.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,s.processTrigger(8,Y.CreateNew(u.pickedMesh,G)))}),I.LongPressDelay)}}else for(const m of T._pointerDownStage)u=m.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,G,!1);let z;const O=l.d.POINTERDOWN;u?(T.onPointerDown&&T.onPointerDown(G,u,O),z=new l.i(O,G,u),this._setRayOnPointerInfo(u,G)):z=new l.i(O,G,null,this),T.onPointerObservable.hasObservers()&&T.onPointerObservable.notifyObservers(z,O)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(u,G,s){const T=new PointerEvent("pointerup",G);T.inputIndex=X.Move;const z=new h;s?z.doubleClick=!0:z.singleClick=!0,this._checkPrePointerObservable(u,T,l.d.POINTERUP)||this._processPointerUp(u,T,z)}_processPointerUp(u,G,s){var T;const z=this._scene;if(null!==(T=u)&&void 0!==T&&T.pickedMesh){if(this._pickedUpMesh=u.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(z.onPointerPick&&z.onPointerPick(G,u),s.singleClick&&!s.ignore&&z.onPointerObservable.observers.length>this._cameraObserverCount)){const s=l.d.POINTERPICK,T=new l.i(s,G,u);this._setRayOnPointerInfo(u,G),z.onPointerObservable.notifyObservers(T,s)}const T=u.pickedMesh._getActionManagerForTrigger();if(T&&!s.ignore){T.processTrigger(7,Y.CreateNew(u.pickedMesh,G,u)),!s.hasSwiped&&s.singleClick&&T.processTrigger(1,Y.CreateNew(u.pickedMesh,G,u));const z=u.pickedMesh._getActionManagerForTrigger(6);s.doubleClick&&z&&z.processTrigger(6,Y.CreateNew(u.pickedMesh,G,u))}}else if(!s.ignore)for(const O of z._pointerUpStage)u=O.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,G,s.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const u=this._pickedDownMesh._getActionManagerForTrigger(16);u&&u.processTrigger(16,Y.CreateNew(this._pickedDownMesh,G))}if(!s.ignore){const T=new l.i(l.d.POINTERUP,G,u);if(this._setRayOnPointerInfo(u,G),z.onPointerObservable.notifyObservers(T,l.d.POINTERUP),z.onPointerUp&&z.onPointerUp(G,u,l.d.POINTERUP),!s.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let T=0;if(s.singleClick?T=l.d.POINTERTAP:s.doubleClick&&(T=l.d.POINTERDOUBLETAP),T){const s=new l.i(T,G,u);z.onPointerObservable.hasObservers()&&z.onPointerObservable.hasSpecificMask(T)&&z.onPointerObservable.notifyObservers(s,T)}}}}isPointerCaptured(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[u]}attachControl(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=this._scene,O=z.getEngine();T||(T=O.getInputElement()),this._alreadyAttached&&this.Ii(),T&&(this._alreadyAttachedTo=T),this._deviceSourceManager=new S(O),this._initActionManager=u=>{if(!this._meshPickProceed){const G=z.skipPointerUpPicking||0===z._registeredActions&&!this._checkForPicking()&&!z.onPointerUp?null:z.Mc(this._unTranslatedPointerX,this._unTranslatedPointerY,z.pointerUpPredicate,z.pointerUpFastCheck,z.cameraToUseForPointers,z.pointerUpTrianglePredicate);this._currentPickResult=G,G&&(u=G.hit&&G.pickedMesh?G.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return u},this._delayedSimpleClick=(u,G,s)=>{if((Date.now()-this._previousStartingPointerTime>I.DoubleClickDelay&&!this._doubleClickOccured||u!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,G.singleClick=!0,G.ignore=!1,this._delayedClicks[u])){const G=this._delayedClicks[u].evt,s=l.d.POINTERTAP,T=new l.i(s,G,this._currentPickResult);z.onPointerObservable.hasObservers()&&z.onPointerObservable.hasSpecificMask(s)&&z.onPointerObservable.notifyObservers(T,s),this._delayedClicks[u]=null}},this._initClickEvent=(u,G,s,T)=>{const z=new h;this._currentPickResult=null;let O=null,m=u.hasSpecificMask(l.d.POINTERPICK)||G.hasSpecificMask(l.d.POINTERPICK)||u.hasSpecificMask(l.d.POINTERTAP)||G.hasSpecificMask(l.d.POINTERTAP)||u.hasSpecificMask(l.d.POINTERDOUBLETAP)||G.hasSpecificMask(l.d.POINTERDOUBLETAP);!m&&P&&(O=this._initActionManager(O,z),O&&(m=O.hasPickTriggers));let f=!1;if(m){const m=s.button;if(z.hasSwiped=this._isPointerSwiping(),!z.hasSwiped){let g=!I.ExclusiveDoubleClickMode;if(g||(g=!u.hasSpecificMask(l.d.POINTERDOUBLETAP)&&!G.hasSpecificMask(l.d.POINTERDOUBLETAP),g&&!P.HasSpecificTrigger(6)&&(O=this._initActionManager(O,z),O&&(g=!O.hasSpecificTrigger(6)))),g)(Date.now()-this._previousStartingPointerTime>I.DoubleClickDelay||m!==this._previousButtonPressed)&&(z.singleClick=!0,T(z,this._currentPickResult),f=!0);else{const u={evt:s,clickInfo:z,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,m,z,T),I.DoubleClickDelay)};this._delayedClicks[m]=u}let b=u.hasSpecificMask(l.d.POINTERDOUBLETAP)||G.hasSpecificMask(l.d.POINTERDOUBLETAP);if(!b&&P.HasSpecificTrigger(6)&&(O=this._initActionManager(O,z),O&&(b=O.hasSpecificTrigger(6))),b)if(m===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<I.DoubleClickDelay&&!this._doubleClickOccured){if(z.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=m,I.ExclusiveDoubleClickMode){var C;if(this._delayedClicks[m])clearTimeout(null===(C=this._delayedClicks[m])||void 0===C?void 0:C.timeoutId),this._delayedClicks[m]=null;T(z,this._previousPickResult)}else T(z,this._currentPickResult);else{var x;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,z.doubleClick=!0,z.ignore=!1,I.ExclusiveDoubleClickMode&&this._delayedClicks[m])clearTimeout(null===(x=this._delayedClicks[m])||void 0===x?void 0:x.timeoutId),this._delayedClicks[m]=null;T(z,this._currentPickResult)}f=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=m}}f||T(z,this._currentPickResult)},this._onPointerMove=u=>{if(this._updatePointerPosition(u),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>I.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>I.DragMovementThreshold),O.isPointerLock&&O._verifyPointerLock(),this._checkPrePointerObservable(null,u,u.inputIndex>=X.MouseWheelX&&u.inputIndex<=X.MouseWheelZ?l.d.POINTERWHEEL:l.d.POINTERMOVE))return;if(!z.cameraToUseForPointers&&!z.activeCamera)return;if(z.Ri)return void this._processPointerMove(new Q.c,u);z.pointerMovePredicate||(z.pointerMovePredicate=u=>u.me&&u.isVisible&&u.isReady()&&u.isEnabled()&&(u.enablePointerMoveEvents||z.constantlyUpdateMeshUnderPointer||null!==u._getActionManagerForTrigger())&&(!z.cameraToUseForPointers||0!==(z.cameraToUseForPointers.layerMask&u.layerMask)));const G=z._registeredActions>0||z.constantlyUpdateMeshUnderPointer?this._pickMove(u):null;this._processPointerMove(G,u)},this._onPointerDown=u=>{const G=this._activePointerIds.indexOf(-1);if(-1===G?this._activePointerIds.push(u.pointerId):this._activePointerIds[G]=u.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,I.ExclusiveDoubleClickMode)for(let T=0;T<this._delayedClicks.length;T++)if(this._delayedClicks[T])if(u.button===T){var s;clearTimeout(null===(s=this._delayedClicks[T])||void 0===s?void 0:s.timeoutId)}else{const u=this._delayedClicks[T].clickInfo;this._doubleClickOccured=!1,u.singleClick=!0,u.ignore=!1;const G=this._delayedClicks[T].evt,s=l.d.POINTERTAP,O=new l.i(s,G,this._currentPickResult);z.onPointerObservable.hasObservers()&&z.onPointerObservable.hasSpecificMask(s)&&z.onPointerObservable.notifyObservers(O,s),this._delayedClicks[T]=null}if(this._updatePointerPosition(u),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=u.button),z.preventDefaultOnPointerDown&&T&&(u.preventDefault(),T.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,u,l.d.POINTERDOWN))return;if(!z.cameraToUseForPointers&&!z.activeCamera)return;let O;this._pointerCaptures[u.pointerId]=!0,z.pointerDownPredicate||(z.pointerDownPredicate=u=>u.me&&u.isVisible&&u.isReady()&&u.isEnabled()&&(!z.cameraToUseForPointers||0!==(z.cameraToUseForPointers.layerMask&u.layerMask))),this._pickedDownMesh=null,O=z.skipPointerDownPicking||0===z._registeredActions&&!this._checkForPicking()&&!z.onPointerDown?new Q.c:z.Mc(this._unTranslatedPointerX,this._unTranslatedPointerY,z.pointerDownPredicate,z.pointerDownFastCheck,z.cameraToUseForPointers,z.pointerDownTrianglePredicate),this._processPointerDown(O,u)},this._onPointerUp=u=>{const G=this._activePointerIds.indexOf(u.pointerId);-1!==G&&(this._activePointerIds[G]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(u),z.preventDefaultOnPointerUp&&T&&(u.preventDefault(),T.focus()),this._initClickEvent(z.onPrePointerObservable,z.onPointerObservable,u,((G,s)=>{if(z.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!G.ignore)){if(this._checkPrePointerObservable(null,u,l.d.POINTERUP))return this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===u.buttons&&(this._pointerCaptures[u.pointerId]=!1));G.hasSwiped||(G.singleClick&&z.onPrePointerObservable.hasSpecificMask(l.d.POINTERTAP)&&this._checkPrePointerObservable(null,u,l.d.POINTERTAP)&&(this._skipPointerTap=!0),G.doubleClick&&z.onPrePointerObservable.hasSpecificMask(l.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,u,l.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[u.pointerId]?(0===u.buttons&&(this._pointerCaptures[u.pointerId]=!1),(z.cameraToUseForPointers||z.activeCamera)&&(z.pointerUpPredicate||(z.pointerUpPredicate=u=>u.me&&u.isVisible&&u.isReady()&&u.isEnabled()&&(!z.cameraToUseForPointers||0!==(z.cameraToUseForPointers.layerMask&u.layerMask))),!this._meshPickProceed&&(P&&P.HasTriggers||this._checkForPicking()||z.onPointerUp)&&this._initActionManager(null,G),s||(s=this._currentPickResult),this._processPointerUp(s,u,G),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=u=>{const G=M.d.KEYDOWN;if(z.onPreKeyboardObservable.hasObservers()){const s=new M.g(G,u);if(z.onPreKeyboardObservable.notifyObservers(s,G),s.skipOnKeyboardObservable)return}if(z.onKeyboardObservable.hasObservers()){const s=new M.j(G,u);z.onKeyboardObservable.notifyObservers(s,G)}z.actionManager&&z.actionManager.processTrigger(14,Y.CreateNewFromScene(z,u))},this._onKeyUp=u=>{const G=M.d.KEYUP;if(z.onPreKeyboardObservable.hasObservers()){const s=new M.g(G,u);if(z.onPreKeyboardObservable.notifyObservers(s,G),s.skipOnKeyboardObservable)return}if(z.onKeyboardObservable.hasObservers()){const s=new M.j(G,u);z.onKeyboardObservable.notifyObservers(s,G)}z.actionManager&&z.actionManager.processTrigger(15,Y.CreateNewFromScene(z,u))},this._deviceSourceManager.onDeviceConnectedObservable.add((T=>{T.deviceType===H.Mouse?T.onInputChangedObservable.add((z=>{this._originMouseEvent=z,z.inputIndex===X.LeftClick||z.inputIndex===X.MiddleClick||z.inputIndex===X.RightClick||z.inputIndex===X.BrowserBack||z.inputIndex===X.BrowserForward?G&&1===T.getInput(z.inputIndex)?this._onPointerDown(z):u&&0===T.getInput(z.inputIndex)&&this._onPointerUp(z):s&&(z.inputIndex===X.Move?this._onPointerMove(z):z.inputIndex!==X.MouseWheelX&&z.inputIndex!==X.MouseWheelY&&z.inputIndex!==X.MouseWheelZ||this._onPointerMove(z))})):T.deviceType===H.Touch?T.onInputChangedObservable.add((z=>{z.inputIndex===X.LeftClick&&(G&&1===T.getInput(z.inputIndex)?(this._onPointerDown(z),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):u&&0===T.getInput(z.inputIndex)&&(this._onPointerUp(z),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),s&&z.inputIndex===X.Move&&this._onPointerMove(z)})):T.deviceType===H.Keyboard&&T.onInputChangedObservable.add((u=>{"keydown"===u.type?this._onKeyDown(u):"keyup"===u.type&&this._onKeyUp(u)}))})),this._alreadyAttached=!0}Ii(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[G]===u&&(!u||!u._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const z=this._meshUnderPointerId[G];let O;z&&(O=z._getActionManagerForTrigger(10),O&&O.processTrigger(10,Y.CreateNew(z,T,{pointerId:G}))),u?(this._meshUnderPointerId[G]=u,this._pointerOverMesh=u,O=u._getActionManagerForTrigger(9),O&&O.processTrigger(9,Y.CreateNew(u,T,{pointerId:G,pickResult:s}))):(delete this._meshUnderPointerId[G],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(u){this._pointerOverMesh===u&&(this._pointerOverMesh=null),this._pickedDownMesh===u&&(this._pickedDownMesh=null),this._pickedUpMesh===u&&(this._pickedUpMesh=null);for(const G in this._meshUnderPointerId)this._meshUnderPointerId[G]===u&&delete this._meshUnderPointerId[G]}}I.DragMovementThreshold=10,I.LongPressDelay=500,I.DoubleClickDelay=300,I.ExclusiveDoubleClickMode=!1;var i=s(10734),J=s(10930),A=s(11013),N=s(11021),y=s(10622),a=s(11030),K=s(10918);class Z{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Ri=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var t,E=s(10584),U=s(10715);!function(u){u[u.BackwardCompatible=0]="BackwardCompatible",u[u.Intermediate=1]="Intermediate",u[u.Aggressive=2]="Aggressive"}(t||(t={}));class uu{static DefaultMaterialFactory(u){throw(0,j.c)("mb")}static CollisionCoordinatorFactory(){throw(0,j.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(u){u!==this._clearColor&&(this._clearColor=u,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(u){if(u!==this._performancePriority){switch(this._performancePriority=u,u){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ri=!1,this.Ji=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ri=!0,this.Ji=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Ri=!0,this.Ji=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(u)}}set forceWireframe(u){this._forceWireframe!==u&&(this._forceWireframe=u,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(u){this._skipFrustumClipping!==u&&(this._skipFrustumClipping=u)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(u){this._forcePointsCloud!==u&&(this._forcePointsCloud=u,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(u){this._environmentTexture!==u&&(this._environmentTexture=u,this.markAllMaterialsAsDirty(1))}getNodes(){let u=[];return u=u.concat(this.meshes),u=u.concat(this.lights),u=u.concat(this.cameras),u=u.concat(this.transformNodes),this.skeletons.forEach((G=>u=u.concat(G.bones))),u}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}set beforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),u&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u))}set afterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),u&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(u))}set beforeCameraRender(u){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(u)}set afterCameraRender(u){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(u)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(u){this._pointerPickingConfiguration.pointerDownPredicate=u}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(u){this._pointerPickingConfiguration.pointerUpPredicate=u}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(u){this._pointerPickingConfiguration.pointerMovePredicate=u}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(u){this._pointerPickingConfiguration.pointerDownFastCheck=u}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(u){this._pointerPickingConfiguration.pointerUpFastCheck=u}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(u){this._pointerPickingConfiguration.pointerMoveFastCheck=u}get Ri(){return this._pointerPickingConfiguration.Ri}set Ri(u){this._pointerPickingConfiguration.Ri=u}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(u){this._pointerPickingConfiguration.skipPointerDownPicking=u}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(u){this._pointerPickingConfiguration.skipPointerUpPicking=u}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return I.DragMovementThreshold}static set DragMovementThreshold(u){I.DragMovementThreshold=u}static get LongPressDelay(){return I.LongPressDelay}static set LongPressDelay(u){I.LongPressDelay=u}static get DoubleClickDelay(){return I.DoubleClickDelay}static set DoubleClickDelay(u){I.DoubleClickDelay=u}static get ExclusiveDoubleClickMode(){return I.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(u){I.ExclusiveDoubleClickMode=u}bindEyePosition(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,z=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return x.l.Vector4[0].set(T.x,T.y,T.z,z?-1:1),u&&(s?u.setFloat3(G,x.l.Vector4[0].x,x.l.Vector4[0].y,x.l.Vector4[0].z):u.setVector4(G,x.l.Vector4[0])),x.l.Vector4[0]}finalizeSceneUbo(){const u=this.getSceneUniformBuffer(),G=this.bindEyePosition(null);return u.updateFloat4("vEyePosition",G.x,G.y,G.z,G.w),u.update(),u}set useRightHandedSystem(u){this._useRightHandedSystem!==u&&(this._useRightHandedSystem=u,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(u){this._currentStepId=u}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(u){this._fogEnabled!==u&&(this._fogEnabled=u,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(u){this._fogMode!==u&&(this._fogMode=u,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(u){this._shadowsEnabled!==u&&(this._shadowsEnabled=u,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(u){this._lightsEnabled!==u&&(this._lightsEnabled=u,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(u){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),u&&(this._unObserveActiveCameras=(0,K.f)(u,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=u}get activeCamera(){return this._activeCamera}set activeCamera(u){u!==this._activeCamera&&(this._activeCamera=u,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.ki||(this.ki=uu.DefaultMaterialFactory(this)),this.ki}set defaultMaterial(u){this.ki=u}set texturesEnabled(u){this._texturesEnabled!==u&&(this._texturesEnabled=u,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(u){if(this._frameGraph)return this._frameGraph=u,void(u||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=u,u&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(u){this._skeletonsEnabled!==u&&(this._skeletonsEnabled=u,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=uu.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const u of this._transientComponents)u.register();this._transientComponents.length=0}}o(u){this._components.push(u),this._transientComponents.push(u);const G=u;G.addFromContainer&&G.serialize&&this._serializableComponents.push(G)}_getComponent(u){for(const G of this._components)if(G.name===u)return G;return null}constructor(u,G){this._inputManager=new I(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ji=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new J.e(.2,.2,.3,1),this.onClearColorChangedObservable=new O.e,this.ambientColor=new J.b(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new O.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Vj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this._i=new O.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new O.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new O.e,this.onAfterRenderCameraObservable=new O.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new O.e,this.onAfterAnimationsObservable=new O.e,this.onBeforeDrawPhaseObservable=new O.e,this.onAfterDrawPhaseObservable=new O.e,this.onReadyObservable=new O.e,this.onBeforeCameraRenderObservable=new O.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new O.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new O.e,this.onAfterActiveMeshesEvaluationObservable=new O.e,this.onBeforeParticlesRenderingObservable=new O.e,this.onAfterParticlesRenderingObservable=new O.e,this.onDataLoadedObservable=new O.e,this.onNewCameraAddedObservable=new O.e,this.onCameraRemovedObservable=new O.e,this.onNewLightAddedObservable=new O.e,this.onLightRemovedObservable=new O.e,this.onNewGeometryAddedObservable=new O.e,this.onGeometryRemovedObservable=new O.e,this.onNewTransformNodeAddedObservable=new O.e,this.onTransformNodeRemovedObservable=new O.e,this.onNewMeshAddedObservable=new O.e,this.onMeshRemovedObservable=new O.e,this.onNewSkeletonAddedObservable=new O.e,this.onSkeletonRemovedObservable=new O.e,this.onNewMaterialAddedObservable=new O.e,this.onNewMultiMaterialAddedObservable=new O.e,this.onMaterialRemovedObservable=new O.e,this.onMultiMaterialRemovedObservable=new O.e,this.onNewTextureAddedObservable=new O.e,this.onTextureRemovedObservable=new O.e,this.onBeforeRenderTargetsRenderObservable=new O.e,this.onAfterRenderTargetsRenderObservable=new O.e,this.onBeforeStepObservable=new O.e,this.onAfterStepObservable=new O.e,this.onActiveCameraChanged=new O.e,this.onActiveCamerasChanged=new O.e,this.onBeforeRenderingGroupObservable=new O.e,this.onAfterRenderingGroupObservable=new O.e,this.onMeshImportedObservable=new O.e,this.onAnimationFileImportedObservable=new O.e,this._registeredForLateAnimationBindings=new m.b(256),this._pointerPickingConfiguration=new Z,this.onPrePointerObservable=new O.e,this.onPointerObservable=new O.e,this.onPreKeyboardObservable=new O.e,this.onKeyboardObservable=new O.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=uu.FOGMODE_NONE,this.fogColor=new J.b(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new x.q(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new m.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new i.e,this._activeIndices=new i.e,this._activeParticles=new i.e,this._activeBones=new i.e,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new m.e(256),this._processedMaterials=new m.e(256),this._renderTargets=new m.b(256),this._materialsRenderTargets=new m.b(256),this._activeParticleSystems=new m.e(256),this._activeSkeletons=new m.b(32),this._softwareSkinnedMeshes=new m.b(32),this._activeAnimatables=new Array,this._transformMatrix=x.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=F.e.Create(),this._beforeClearStage=F.e.Create(),this._beforeRenderTargetClearStage=F.e.Create(),this._gatherRenderTargetsStage=F.e.Create(),this._gatherActiveCameraRenderTargetsStage=F.e.Create(),this._isReadyForMeshStage=F.e.Create(),this._beforeEvaluateActiveMeshStage=F.e.Create(),this._evaluateSubMeshStage=F.e.Create(),this._preActiveMeshStage=F.e.Create(),this._cameraDrawRenderTargetStage=F.e.Create(),this._beforeCameraDrawStage=F.e.Create(),this._beforeRenderTargetDrawStage=F.e.Create(),this._beforeRenderingGroupDrawStage=F.e.Create(),this._beforeRenderingMeshStage=F.e.Create(),this._afterRenderingMeshStage=F.e.Create(),this._afterRenderingGroupDrawStage=F.e.Create(),this._afterCameraDrawStage=F.e.Create(),this._afterCameraPostProcessStage=F.e.Create(),this._afterRenderTargetDrawStage=F.e.Create(),this._afterRenderTargetPostProcessStage=F.e.Create(),this._afterRenderStage=F.e.Create(),this._pointerMoveStage=F.e.Create(),this._pointerDownStage=F.e.Create(),this._pointerUpStage=F.e.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const s={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...G};u=this._engine=u||c.d.LastCreatedEngine,s.virtual?u._virtualScenes.push(this):(c.d._LastCreatedScene=this,u.scenes.push(this)),this._uid=null,this._renderingManager=new V.b(this),n.e&&(this.postProcessManager=new n.e(this)),(0,r.k)()&&this.attachControl(),this._createUbo(),g.b&&(this._imageProcessingConfiguration=new g.b),this.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=s.useMaterialMeshMap,this.useClonedMeshMap=s.useClonedMeshMap,G&&G.virtual||u.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(u){return this._defaultSubMeshCandidates.data=u.xf,this._defaultSubMeshCandidates.length=u.xf.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=u=>this._getDefaultSubMeshCandidates(u),this.getIntersectingSubMeshCandidates=(u,G)=>this._getDefaultSubMeshCandidates(u),this.getCollidingSubMeshCandidates=(u,G)=>this._getDefaultSubMeshCandidates(u)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(u){this._inputManager.pointerX=u}get pointerY(){return this._inputManager.pointerY}set pointerY(u){this._inputManager.pointerY=u}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==G||this._cachedMaterial!==u||this._cachedVisibility!==s}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(u,G){return this._inputManager.simulatePointerMove(u,G),this}simulatePointerDown(u,G){return this._inputManager.simulatePointerDown(u,G),this}simulatePointerUp(u,G,s){return this._inputManager.simulatePointerUp(u,G,s),this}isPointerCaptured(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(u)}attachControl(){let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(u,G,s)}Ii(){this._inputManager.Ii()}isReady(){var u,G;let s,T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const z=this.getEngine(),O=z.currentRenderPassId;z.currentRenderPassId=(null===(u=this.activeCamera)||void 0===u?void 0:u.renderPassId)??O;let m=!0;for(this._pendingData.length>0&&(m=!1),null===(G=this.prePassRenderer)||void 0===G||G.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&m&&(m=this.depthPeelingRenderer.isReady()),T&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),s=0;s<this.meshes.length;s++){const u=this.meshes[s];if(!u.xf||0===u.xf.length)continue;if(!u.isReady(!0)){m=!1;continue}const G=u.hasThinInstances||"InstancedMesh"===u.getClassName()||"InstancedLinesMesh"===u.getClassName()||z.getCaps().instancedArrays&&u.instances.length>0;for(const s of this._isReadyForMeshStage)s.action(u,G)||(m=!1);if(!T)continue;const O=u.material||this.defaultMaterial;if(O)if(O._storeEffectOnSubMeshes)for(const s of u.xf){const u=s.Ha();u&&u.hasRenderTargetTextures&&null!=u.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(u)&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures()))}else O.hasRenderTargetTextures&&null!=O.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(O)&&(this._processedMaterials.push(O),this._materialsRenderTargets.concatWithNoDuplicate(O.getRenderTargetTextures()))}if(T)for(s=0;s<this._materialsRenderTargets.length;++s){this._materialsRenderTargets.data[s].isReadyForRendering()||(m=!1)}for(s=0;s<this.geometries.length;s++){2===this.geometries[s].delayLoadState&&(m=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const f of this.activeCameras)f.isReady(!0)||(m=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(m=!1));for(const f of this.fj)f.isReady()||(m=!1);if(this.layers)for(const f of this.layers)f.isReady()||(m=!1);return z.areAllEffectsReady()||(m=!1),z.currentRenderPassId=O,m}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(u){this.onBeforeRenderObservable.add(u)}unregisterBeforeRender(u){this.onBeforeRenderObservable.removeCallback(u)}registerAfterRender(u){this.onAfterRenderObservable.add(u)}unregisterAfterRender(u){this.onAfterRenderObservable.removeCallback(u)}_executeOnceBeforeRender(u){const G=()=>{u(),setTimeout((()=>{this.unregisterBeforeRender(G)}))};this.registerBeforeRender(G)}executeOnceBeforeRender(u,G){void 0!==G?setTimeout((()=>{this._executeOnceBeforeRender(u)}),G):this._executeOnceBeforeRender(u)}addPendingData(u){this._pendingData.push(u)}removePendingData(u){const G=this.isLoading,s=this._pendingData.indexOf(u);-1!==s&&this._pendingData.splice(s,1),G&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(u),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(G)}whenReadyAsync(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((G=>{this.executeWhenReady((()=>{G()}),u)}))}_checkIsReady(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(u)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(u)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=z.e.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(u,G,s,T){s||T||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===u.updateFlag&&this._projectionUpdateFlag===G.updateFlag||(this._viewUpdateFlag=u.updateFlag,this._projectionUpdateFlag=G.updateFlag,this._viewMatrix=u,this._projectionMatrix=G,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?A.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=A.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(s,T):this._sceneUbo.useUbo&&(this._sceneUbo.xj("viewProjection",this._transformMatrix),this._sceneUbo.xj("view",this._viewMatrix),this._sceneUbo.xj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(u){const G=new b.c(this._engine,void 0,!1,u??"wf");return G.addUniform("viewProjection",16),G.addUniform("view",16),G.addUniform("projection",16),G.addUniform("vEyePosition",4),G}setSceneUniformBuffer(u){this._sceneUbo=u,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return N.c.UniqueId}ai(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(u),u._resyncLightSources(),u.parent||u._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(u),G&&u.getChildMeshes().forEach((u=>{this.ai(u)})))}Kg(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.meshes.indexOf(u);return-1!==s&&(this.meshes.splice(s,1),u.parent||u._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(u),this.onMeshRemovedObservable.notifyObservers(u),G&&u.getChildMeshes().forEach((u=>{this.Kg(u)})),s}addTransformNode(u){this._blockEntityCollection||u.va()===this&&-1!==u._indexInSceneTransformNodesArray||(u._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(u),u.parent||u._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(u))}removeTransformNode(u){const G=u._indexInSceneTransformNodesArray;if(-1!==G){if(G!==this.transformNodes.length-1){const u=this.transformNodes[this.transformNodes.length-1];this.transformNodes[G]=u,u._indexInSceneTransformNodesArray=G}u._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),u.parent||u._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(u),G}removeSkeleton(u){const G=this.skeletons.indexOf(u);return-1!==G&&(this.skeletons.splice(G,1),this.onSkeletonRemovedObservable.notifyObservers(u),this._executeActiveContainerCleanup(this._activeSkeletons)),G}removeMorphTargetManager(u){const G=this.morphTargetManagers.indexOf(u);return-1!==G&&this.morphTargetManagers.splice(G,1),G}removeLight(u){const G=this.lights.indexOf(u);if(-1!==G){for(const G of this.meshes)G._removeLightSource(u,!1);this.lights.splice(G,1),this.sortLightsByPriority(),u.parent||u._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(u),G}removeCamera(u){const G=this.cameras.indexOf(u);if(-1!==G&&(this.cameras.splice(G,1),u.parent||u._removeFromSceneRootNodes()),this.activeCameras){const G=this.activeCameras.indexOf(u);-1!==G&&this.activeCameras.splice(G,1)}return this.activeCamera===u&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(u),G}removeParticleSystem(u){const G=this.fj.indexOf(u);return-1!==G&&(this.fj.splice(G,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),G}removeAnimation(u){const G=this.animations.indexOf(u);return-1!==G&&this.animations.splice(G,1),G}stopAnimation(u,G,s){}removeAnimationGroup(u){const G=this.animationGroups.indexOf(u);return-1!==G&&this.animationGroups.splice(G,1),G}removeMultiMaterial(u){const G=this.multiMaterials.indexOf(u);return-1!==G&&this.multiMaterials.splice(G,1),this.onMultiMaterialRemovedObservable.notifyObservers(u),G}removeMaterial(u){const G=u._indexInSceneMaterialArray;if(-1!==G&&G<this.materials.length){if(G!==this.materials.length-1){const u=this.materials[this.materials.length-1];this.materials[G]=u,u._indexInSceneMaterialArray=G}u._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(u),G}removeActionManager(u){const G=this.actionManagers.indexOf(u);return-1!==G&&this.actionManagers.splice(G,1),G}removeTexture(u){const G=this.textures.indexOf(u);return-1!==G&&this.textures.splice(G,1),this.onTextureRemovedObservable.notifyObservers(u),G}addLight(u){if(!this._blockEntityCollection){this.lights.push(u),this.sortLightsByPriority(),u.parent||u._addToSceneRootNodes();for(const G of this.meshes)-1===G.lightSources.indexOf(u)&&(G.lightSources.push(u),G._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(u)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(a.d.CompareLightsPriority)}addCamera(u){this._blockEntityCollection||(this.cameras.push(u),this.onNewCameraAddedObservable.notifyObservers(u),u.parent||u._addToSceneRootNodes())}addSkeleton(u){this._blockEntityCollection||(this.skeletons.push(u),this.onNewSkeletonAddedObservable.notifyObservers(u))}addParticleSystem(u){this._blockEntityCollection||this.fj.push(u)}addAnimation(u){this._blockEntityCollection||this.animations.push(u)}addAnimationGroup(u){this._blockEntityCollection||this.animationGroups.push(u)}addMultiMaterial(u){this._blockEntityCollection||(this.multiMaterials.push(u),this.onNewMultiMaterialAddedObservable.notifyObservers(u))}addMaterial(u){this._blockEntityCollection||u.va()===this&&-1!==u._indexInSceneMaterialArray||(u._indexInSceneMaterialArray=this.materials.length,this.materials.push(u),this.onNewMaterialAddedObservable.notifyObservers(u))}addMorphTargetManager(u){this._blockEntityCollection||this.morphTargetManagers.push(u)}addGeometry(u){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=this.geometries.length),this.geometries.push(u))}addActionManager(u){this.actionManagers.push(u)}addTexture(u){this._blockEntityCollection||(this.textures.push(u),this.onNewTextureAddedObservable.notifyObservers(u))}switchActiveCamera(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Ii(),this.activeCamera=u,G&&u.attachControl())}setActiveCameraById(u){const G=this.getCameraById(u);return G?(this.activeCamera=G,G):null}setActiveCameraByName(u){const G=this.getCameraByName(u);return G?(this.activeCamera=G,G):null}getAnimationGroupByName(u){for(let G=0;G<this.animationGroups.length;G++)if(this.animationGroups[G].name===u)return this.animationGroups[G];return null}_getMaterial(u,G){for(let s=0;s<this.materials.length;s++){const u=this.materials[s];if(G(u))return u}if(u)for(let s=0;s<this.multiMaterials.length;s++){const u=this.multiMaterials[s];if(G(u))return u}return null}getMaterialByUniqueID(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(G,(G=>G.uniqueId===u))}getMaterialById(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(G,(G=>G.id===u))}getMaterialByName(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(G,(G=>G.name===u))}getLastMaterialById(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let s=this.materials.length-1;s>=0;s--)if(this.materials[s].id===u)return this.materials[s];if(G)for(let s=this.multiMaterials.length-1;s>=0;s--)if(this.multiMaterials[s].id===u)return this.multiMaterials[s];return null}getTextureByUniqueId(u){for(let G=0;G<this.textures.length;G++)if(this.textures[G].uniqueId===u)return this.textures[G];return null}getTextureByName(u){for(let G=0;G<this.textures.length;G++)if(this.textures[G].name===u)return this.textures[G];return null}getCameraById(u){for(let G=0;G<this.cameras.length;G++)if(this.cameras[G].id===u)return this.cameras[G];return null}getCameraByUniqueId(u){for(let G=0;G<this.cameras.length;G++)if(this.cameras[G].uniqueId===u)return this.cameras[G];return null}getCameraByName(u){for(let G=0;G<this.cameras.length;G++)if(this.cameras[G].name===u)return this.cameras[G];return null}getBoneById(u){for(let G=0;G<this.skeletons.length;G++){const s=this.skeletons[G];for(let G=0;G<s.bones.length;G++)if(s.bones[G].id===u)return s.bones[G]}return null}getBoneByName(u){for(let G=0;G<this.skeletons.length;G++){const s=this.skeletons[G];for(let G=0;G<s.bones.length;G++)if(s.bones[G].name===u)return s.bones[G]}return null}getLightByName(u){for(let G=0;G<this.lights.length;G++)if(this.lights[G].name===u)return this.lights[G];return null}getLightById(u){for(let G=0;G<this.lights.length;G++)if(this.lights[G].id===u)return this.lights[G];return null}getLightByUniqueId(u){for(let G=0;G<this.lights.length;G++)if(this.lights[G].uniqueId===u)return this.lights[G];return null}getParticleSystemById(u){for(let G=0;G<this.fj.length;G++)if(this.fj[G].id===u)return this.fj[G];return null}getGeometryById(u){for(let G=0;G<this.geometries.length;G++)if(this.geometries[G].id===u)return this.geometries[G];return null}_getGeometryByUniqueId(u){if(this._geometriesByUniqueId){const G=this._geometriesByUniqueId[u];if(void 0!==G)return this.geometries[G]}else for(let G=0;G<this.geometries.length;G++)if(this.geometries[G].uniqueId===u)return this.geometries[G];return null}pushGeometry(u,G){return!(!G&&this._getGeometryByUniqueId(u.uniqueId))&&(this.addGeometry(u),this.onNewGeometryAddedObservable.notifyObservers(u),!0)}removeGeometry(u){let G;if(this._geometriesByUniqueId){if(G=this._geometriesByUniqueId[u.uniqueId],void 0===G)return!1}else if(G=this.geometries.indexOf(u),G<0)return!1;if(G!==this.geometries.length-1){const u=this.geometries[this.geometries.length-1];u&&(this.geometries[G]=u,this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=G))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(u),!0}getGeometries(){return this.geometries}getMeshById(u){for(let G=0;G<this.meshes.length;G++)if(this.meshes[G].id===u)return this.meshes[G];return null}getMeshesById(u){return this.meshes.filter((function(G){return G.id===u}))}getTransformNodeById(u){for(let G=0;G<this.transformNodes.length;G++)if(this.transformNodes[G].id===u)return this.transformNodes[G];return null}getTransformNodeByUniqueId(u){for(let G=0;G<this.transformNodes.length;G++)if(this.transformNodes[G].uniqueId===u)return this.transformNodes[G];return null}getTransformNodesById(u){return this.transformNodes.filter((function(G){return G.id===u}))}getMeshByUniqueId(u){for(let G=0;G<this.meshes.length;G++)if(this.meshes[G].uniqueId===u)return this.meshes[G];return null}getLastMeshById(u){for(let G=this.meshes.length-1;G>=0;G--)if(this.meshes[G].id===u)return this.meshes[G];return null}getLastTransformNodeById(u){for(let G=this.transformNodes.length-1;G>=0;G--)if(this.transformNodes[G].id===u)return this.transformNodes[G];return null}getLastEntryById(u){let G;for(G=this.meshes.length-1;G>=0;G--)if(this.meshes[G].id===u)return this.meshes[G];for(G=this.transformNodes.length-1;G>=0;G--)if(this.transformNodes[G].id===u)return this.transformNodes[G];for(G=this.cameras.length-1;G>=0;G--)if(this.cameras[G].id===u)return this.cameras[G];for(G=this.lights.length-1;G>=0;G--)if(this.lights[G].id===u)return this.lights[G];return null}getNodeById(u){const G=this.getMeshById(u);if(G)return G;const s=this.getTransformNodeById(u);if(s)return s;const T=this.getLightById(u);if(T)return T;const z=this.getCameraById(u);if(z)return z;const O=this.getBoneById(u);return O||null}getNodeByName(u){const G=this.getMeshByName(u);if(G)return G;const s=this.getTransformNodeByName(u);if(s)return s;const T=this.getLightByName(u);if(T)return T;const z=this.getCameraByName(u);if(z)return z;const O=this.getBoneByName(u);return O||null}getMeshByName(u){for(let G=0;G<this.meshes.length;G++)if(this.meshes[G].name===u)return this.meshes[G];return null}getTransformNodeByName(u){for(let G=0;G<this.transformNodes.length;G++)if(this.transformNodes[G].name===u)return this.transformNodes[G];return null}getLastSkeletonById(u){for(let G=this.skeletons.length-1;G>=0;G--)if(this.skeletons[G].id===u)return this.skeletons[G];return null}getSkeletonByUniqueId(u){for(let G=0;G<this.skeletons.length;G++)if(this.skeletons[G].uniqueId===u)return this.skeletons[G];return null}getSkeletonById(u){for(let G=0;G<this.skeletons.length;G++)if(this.skeletons[G].id===u)return this.skeletons[G];return null}getSkeletonByName(u){for(let G=0;G<this.skeletons.length;G++)if(this.skeletons[G].name===u)return this.skeletons[G];return null}getMorphTargetManagerById(u){for(let G=0;G<this.morphTargetManagers.length;G++)if(this.morphTargetManagers[G].uniqueId===u)return this.morphTargetManagers[G];return null}getMorphTargetById(u){for(let G=0;G<this.morphTargetManagers.length;++G){const s=this.morphTargetManagers[G];for(let G=0;G<s.numTargets;++G){const T=s.getTarget(G);if(T.id===u)return T}}return null}getMorphTargetByName(u){for(let G=0;G<this.morphTargetManagers.length;++G){const s=this.morphTargetManagers[G];for(let G=0;G<s.numTargets;++G){const T=s.getTarget(G);if(T.name===u)return T}}return null}getPostProcessByName(u){for(let G=0;G<this.postProcesses.length;++G){const s=this.postProcesses[G];if(s.name===u)return s}return null}isActiveMesh(u){return-1!==this._activeMeshes.indexOf(u)}get uid(){return this._uid||(this._uid=T.e.RandomId()),this._uid}addExternalData(u,G){return this._externalData||(this._externalData=new f),this._externalData.add(u,G)}getExternalData(u){return this._externalData?this._externalData.get(u):null}getOrAddExternalDataWithFactory(u,G){return this._externalData||(this._externalData=new f),this._externalData.getOrAddWithFactory(u,G)}removeExternalData(u){return this._externalData.remove(u)}_evaluateSubMesh(u,G,s,T){if(T||u.isInFrustum(this._frustumPlanes)){for(const T of this._evaluateSubMeshStage)T.action(G,u);const s=u.Ha();null!==s&&void 0!==s&&(s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(u,G,s))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(u){this._preventFreeActiveMeshesAndRenderingGroups!==u&&(u&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=u)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let u=0;u<this.activeCameras.length;u++){const G=this.activeCameras[u];G&&G._activeMeshes&&G._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let u=0;u<this.textures.length;u++){const G=this.textures[u];G&&G.renderList&&G.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=z,this._skipEvaluateActiveMeshesCompletely=u,T)for(let u=0;u<this._activeMeshes.length;u++)this._activeMeshes.data[u]._freeze();G&&G()}else s&&s("No active camera found")})),this}unfreezeActiveMeshes(){for(let u=0;u<this.meshes.length;u++){const G=this.meshes[u];G._internalAbstractMeshDataInfo&&(G._internalAbstractMeshDataInfo._isActive=!1)}for(let u=0;u<this._activeMeshes.length;u++)this._activeMeshes.data[u]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(u){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>u.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var u;if(this._activeMeshes.length>0)null===(u=this.activeCamera)||void 0===u||u._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const u=this._activeMeshes.length;for(let G=0;G<u;G++){this._activeMeshes.data[G].Gj()}}if(this._activeParticleSystems){const u=this._activeParticleSystems.length;for(let G=0;G<u;G++)this._activeParticleSystems.data[G].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const T of this._beforeEvaluateActiveMeshStage)T.action();const G=this.getActiveMeshCandidates(),s=G.length;for(let T=0;T<s;T++){const u=G.data[T];if(u._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,u.isBlocked)continue;if(this._totalVertices.addCount(u.getTotalVertices(),!1),!u.isReady()||!u.isEnabled()||u.vf.hasAZeroComponent)continue;u.Gj(),u.actionManager&&u.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(u);let s=this.customLODSelector?this.customLODSelector(u,this.activeCamera):u.getLOD(this.activeCamera);if(u._internalAbstractMeshDataInfo._currentLOD=s,u._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==s&&null!==s&&(s!==u&&0!==s.billboardMode&&s.Gj(),u._preActivate(),u.isVisible&&u.visibility>0&&0!==(u.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||u.fg||u.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(u),this.activeCamera._activeMeshes.push(u),s!==u&&s._activate(this._renderId,!1);for(const G of this._preActiveMeshStage)G.action(u);u._activate(this._renderId,!1)&&(u.isAnInstance?u._internalAbstractMeshDataInfo._actAsRegularMesh&&(s=u):s._internalAbstractMeshDataInfo._onlyForInstances=!1,s._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(u,s)),u._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let u=0;u<this.fj.length;u++){const G=this.fj[u];if(!G.isStarted()||!G.k)continue;const s=G.k;s.position&&!s.isEnabled()||(this._activeParticleSystems.push(G),G.animate(),this._renderingManager.dispatchParticles(G))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(u){this._skeletonsEnabled&&u.skeleton&&(this._activeSkeletons.pushNoDuplicate(u.skeleton)&&(u.skeleton.prepare(),this._activeBones.addCount(u.skeleton.bones.length,!1)),u.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(u)&&this.frameGraph&&u.applySkeleton(u.skeleton))}_activeMesh(u,G){this._prepareSkeleton(G);let s=u.hasInstances||u.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||G.fg;if(G&&G.xf&&G.xf.length>0){const T=this.getActiveSubMeshCandidates(G),z=T.length;s=s||1===z;for(let O=0;O<z;O++){const z=T.data[O];this._evaluateSubMesh(z,G,u,s)}}}updateTransformMatrix(u){const G=this.activeCamera;if(G)if(G._renderingMultiview){const s=G._rigCameras[0],T=G._rigCameras[1];this.setTransformMatrix(s.getViewMatrix(),s.getProjectionMatrix(u),T.getViewMatrix(),T.getProjectionMatrix(u))}else this.setTransformMatrix(G.getViewMatrix(),G.getProjectionMatrix(u))}_bindFrameBuffer(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];u&&u._multiviewTexture?u._multiviewTexture._bindFrameBuffer():u&&u.outputRenderTarget?u.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),G&&this._clearFrameBuffer(u)}_clearFrameBuffer(u){if(u&&u._multiviewTexture);else if(u&&u.outputRenderTarget&&!u._renderingMultiview){const G=u.outputRenderTarget;G.onClearObservable.hasObservers()?G.onClearObservable.notifyObservers(this._engine):G.skipInitialClear||u.isRightCamera||(this.Ji&&this._engine.clear(G.clearColor||this._clearColor,!G._cleared,!0,!0),G._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(u,G){var s;let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(u&&u._skipRendering)return;const O=this._engine;if(this._activeCamera=u,!this.activeCamera)throw new Error("Active camera not set");if(O.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&z){let G=!0;u._renderingMultiview&&u.outputRenderTarget&&(G=u.outputRenderTarget.skipInitialClear,this.Ji&&(this._defaultFrameBufferCleared=!1,u.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),u._renderingMultiview&&u.outputRenderTarget&&(u.outputRenderTarget.skipInitialClear=G)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let T=0;T<this._softwareSkinnedMeshes.length;T++){const u=this._softwareSkinnedMeshes.data[T];u.applySkeleton(u.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),u.customRenderTargets&&u.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(u.customRenderTargets),G&&G.customRenderTargets&&G.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(G.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const T of this._gatherActiveCameraRenderTargetsStage)T.action(this._renderTargets);let m=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){T.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let u=0;u<this._renderTargets.length;u++){const G=this._renderTargets.data[u];if(G._shouldRender()){this._renderId++;const u=G.activeCamera&&G.activeCamera!==this.activeCamera;G.render(u,this.dumpNextRenderTargets),m=!0}}T.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const u of this._cameraDrawRenderTargetStage)m=u.action(this.activeCamera)||m;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(s=u.outputRenderTarget)||void 0===s?void 0:s.renderPassId)??u.renderPassId??0,m&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||u._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const T of this._beforeCameraDrawStage)T.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),O.snapshotRendering&&1===O.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const T of this._afterCameraDrawStage)T.action(this.activeCamera);if(this.postProcessManager&&!u._multiviewTexture){const G=u.outputRenderTarget?u.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(u.isIntermediate,G)}for(const T of this._afterCameraPostProcessStage)T.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===u.cameraRigMode||u._renderingMultiview)return u._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(u,void 0,G),void this.onAfterRenderCameraObservable.notifyObservers(u);if(u._useMultiviewToSingleView)this._renderMultiviewToSingleView(u);else{this.onBeforeCameraRenderObservable.notifyObservers(u);for(let G=0;G<u._rigCameras.length;G++)this._renderForCamera(u._rigCameras[G],u)}this._activeCamera=u,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(u)}_checkIntersections(){for(let u=0;u<this._meshesForIntersections.length;u++){const G=this._meshesForIntersections.data[u];if(G.actionManager)for(let u=0;G.actionManager&&u<G.actionManager.actions.length;u++){const s=G.actionManager.actions[u];if(12===s.trigger||13===s.trigger){const u=s.getTriggerParameter(),T=u.mesh?u.mesh:u,z=T.intersectsMesh(G,u.usePreciseIntersection),O=G._intersectionsInProgress.indexOf(T);z&&-1===O?12===s.trigger?(s._executeCurrent(Y.CreateNew(G,void 0,T)),G._intersectionsInProgress.push(T)):13===s.trigger&&G._intersectionsInProgress.push(T):!z&&O>-1&&(13===s.trigger&&s._executeCurrent(Y.CreateNew(G,void 0,T)),G.actionManager.hasSpecificTrigger(13,(u=>{const G=u.mesh?u.mesh:u;return T===G}))&&13!==s.trigger||G._intersectionsInProgress.splice(O,1))}}}}_advancePhysicsEngineStep(u){}_animate(u){}animate(){if(this._engine.isDeterministicLockStep()){let u=Math.max(uu.MinDeltaTime,Math.min(this._engine.getDeltaTime(),uu.MaxDeltaTime))+this._timeAccumulator;const G=this._engine.getTimeStep(),s=1e3/G/1e3;let T=0;const z=this._engine.getLockstepMaxSteps();let O=Math.floor(u/G);for(O=Math.min(O,z);u>0&&T<O;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=G*s,this._animate(G),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(G),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,T++,u-=G;this._timeAccumulator=u<0?0:u}else{const u=this.useConstantAnimationDeltaTime?16:Math.max(uu.MinDeltaTime,Math.min(this._engine.getDeltaTime(),uu.MaxDeltaTime));this._animationRatio=.06*u,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(u)}}_clear(){(this.autoClearDepthAndStencil||this.Ji)&&this._engine.clear(this._clearColor,this.Ji||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(u){var G;if(null===u||void 0===u||!u.outputRenderTarget||null!==u&&void 0!==u&&u.isRigCamera||(u.outputRenderTarget._cleared=!1),null!==u&&void 0!==u&&null!==(G=u.rigCameras)&&void 0!==G&&G.length)for(let s=0;s<u.rigCameras.length;++s){const G=u.rigCameras[s].outputRenderTarget;G&&(G._cleared=!1)}}resetDrawCache(u){if(this.meshes)for(const G of this.meshes)G.resetDrawCache(u)}_renderWithFrameGraph(){var u;let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),G)for(const z of this.cameras)if(z.update(),0!==z.cameraRigMode)for(let u=0;u<z._rigCameras.length;u++)z._rigCameras[u].update();for(const z of this._beforeClearStage)z.action();const s=this.getActiveMeshCandidates(),T=s.length;for(let z=0;z<T;z++){const u=s.data[z];u.isBlocked||(this._totalVertices.addCount(u.getTotalVertices(),!1),u.isReady()&&u.isEnabled()&&!u.vf.hasAZeroComponent&&(u.Gj(),u.actionManager&&u.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(u)))}if(this.particlesEnabled)for(let z=0;z<this.fj.length;z++){const u=this.fj[z];if(!u.isStarted()||!u.k)continue;const G=u.k;G.position&&!G.isEnabled()||(this._activeParticleSystems.push(u),u.animate())}null===(u=this.frameGraph)||void 0===u||u.execute()}render(){var u;let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(u=this.activeCameras)&&void 0!==u&&u.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),s||this.animate();for(const u of this._beforeCameraUpdateStage)u.action();if(G)if(this.activeCameras&&this.activeCameras.length>0)for(let u=0;u<this.activeCameras.length;u++){const G=this.activeCameras[u];if(G.update(),0!==G.cameraRigMode)for(let u=0;u<G._rigCameras.length;u++)G._rigCameras[u].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let u=0;u<this.activeCamera._rigCameras.length;u++)this.activeCamera._rigCameras[u].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(G,s);else{var z;const u=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const G=null!==(z=this.activeCameras)&&void 0!==z&&z.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){T.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let s=0;s<this.customRenderTargets.length;s++){const T=this.customRenderTargets[s];if(T._shouldRender()){if(this._renderId++,this.activeCamera=T.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");u.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),T.render(G!==this.activeCamera,this.dumpNextRenderTargets)}}T.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===G||void 0===G?void 0:G.renderPassId)??0,this.activeCamera=G,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const s of this._beforeClearStage)s.action();this._clearFrameBuffer(this.activeCamera);for(const s of this._gatherRenderTargetsStage)s.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let s=0;s<this.activeCameras.length;s++)this._processSubCameras(this.activeCameras[s],s>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const u of this._afterRenderStage)u.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let u=0;u<this._toBeDisposed.length;u++){const G=this._toBeDisposed[u];G&&G.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let u=0;u<this.materials.length;u++)this.materials[u].freeze()}unfreezeMaterials(){for(let u=0;u<this.materials.length;u++)this.materials[u].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((u=>{u.onAnimationEndObservable.clear(),u.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const u=this._activeRequests.slice();for(const z of u)z.abort();this._activeRequests.length=0;try{this._i.notifyObservers(this)}catch(T){E.d.Error("An error occurred while calling onDisposeObservable!",T)}this.Ii();if(this._engine.getInputElement())for(let z=0;z<this.cameras.length;z++)this.cameras[z].Ii();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(u=>u.dispose(!0))),this._disposeList(this.transformNodes,(u=>u.dispose(!0)));const G=this.cameras;this._disposeList(G),this.ki&&this.ki.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.fj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let s=this._engine.scenes.indexOf(this);s>-1&&this._engine.scenes.splice(s,1),c.d._LastCreatedScene===this&&(this._engine.scenes.length>0?c.d._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:c.d._LastCreatedScene=null),s=this._engine._virtualScenes.indexOf(this),s>-1&&this._engine._virtualScenes.splice(s,1),this._engine.wipeCaches(!0),this._i.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(u,G){const s=u.slice(0);G=G??(u=>u.dispose());for(const T of s)G(T);u.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let u=0;u<this.meshes.length;u++){const G=this.meshes[u].sj;G&&G.clearCachedData()}}cleanCachedTextureBuffer(){for(const u of this.textures){u._buffer&&(u._buffer=null)}}getWorldExtends(u){const G=new x.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new x.q(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u=u||(()=>!0),this.meshes.filter(u).forEach((u=>{if(u.Gj(!0),!u.xf||0===u.xf.length||u.infiniteDistance)return;const T=u.getBoundingInfo(),z=T.boundingBox.minimumWorld,O=T.boundingBox.maximumWorld;x.q.CheckExtends(z,G,s),x.q.CheckExtends(O,G,s)})),{min:G,max:s}}createPickingRay(u,G,s,T){throw(0,j.c)("Ray")}createPickingRayToRef(u,G,s,T,z){throw(0,j.c)("Ray")}createPickingRayInCameraSpace(u,G,s){throw(0,j.c)("Ray")}createPickingRayInCameraSpaceToRef(u,G,s,T){throw(0,j.c)("Ray")}Mc(u,G,s,T,z,O){const m=(0,j.c)("Ray",!0);return m&&E.d.Warn(m),new Q.c}pickWithBoundingInfo(u,G,s,T,z){const O=(0,j.c)("Ray",!0);return O&&E.d.Warn(O),new Q.c}pickWithRay(u,G,s,T){throw(0,j.c)("Ray")}multiPick(u,G,s,T,z){throw(0,j.c)("Ray")}multiPickWithRay(u,G,s){throw(0,j.c)("Ray")}setPointerOverMesh(u,G,s){this._inputManager.setPointerOverMesh(u,G,s)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const u of this.geometries)u._rebuild();for(const u of this.meshes)u._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const u of this._components)u.rebuild();for(const u of this.fj)u.rebuild();if(this.spriteManagers)for(const u of this.spriteManagers)u.rebuild()}_rebuildTextures(){for(const u of this.textures)u._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(u,G,s){if(void 0===G)return u;const T=[];for(const z in u){const O=u[z];C.c&&C.c.MatchesQuery(O,G)&&(!s||s(O))&&T.push(O)}return T}getMeshesByTags(u,G){return this._getByTags(this.meshes,u,G)}getCamerasByTags(u,G){return this._getByTags(this.cameras,u,G)}getLightsByTags(u,G){return this._getByTags(this.lights,u,G)}getMaterialByTags(u,G){return this._getByTags(this.materials,u,G).concat(this._getByTags(this.multiMaterials,u,G))}getTransformNodesByTags(u,G){return this._getByTags(this.transformNodes,u,G)}setRenderingOrder(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(u,G,s,T)}setRenderingAutoClearDepthStencil(u,G){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(u,G,s,T)}getAutoClearDepthStencilSetup(u){return this._renderingManager.getAutoClearDepthStencilSetup(u)}_forceBlockMaterialDirtyMechanism(u){this._blockMaterialDirtyMechanism=u}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(u){this._blockMaterialDirtyMechanism!==u&&(this._blockMaterialDirtyMechanism=u,u||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(u,G){if(!this._blockMaterialDirtyMechanism)for(const s of this.materials)G&&!G(s)||s.pg(u)}_loadFile(u,G,s,T,z,O,m){const f=(0,y.j)(u,G,s,T?this.offlineProvider:void 0,z,O,m);return this._activeRequests.push(f),f.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),f}_loadFileAsync(u,G,s,T,z){return new Promise(((O,m)=>{this._loadFile(u,(u=>{O(u)}),G,s,T,((u,G)=>{m(G)}),z)}))}_requestFile(u,G,s,T,z,O,m){const f=(0,y.o)(u,G,s,T?this.offlineProvider:void 0,z,O,m);return this._activeRequests.push(f),f.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),f}_requestFileAsync(u,G,s,T,z){return new Promise(((O,m)=>{this._requestFile(u,(u=>{O(u)}),G,s,T,(u=>{m(u)}),z)}))}_readFile(u,G,s,T,z){const O=(0,y.m)(u,G,s,T,z);return this._activeRequests.push(O),O.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),O}_readFileAsync(u,G,s){return new Promise(((T,z)=>{this._readFile(u,(u=>{T(u)}),G,s,(u=>{z(u)}))}))}getPerfCollector(){throw(0,j.c)("performanceViewerSceneExtension")}setActiveCameraByID(u){return this.setActiveCameraById(u)}getMaterialByID(u){return this.getMaterialById(u)}getLastMaterialByID(u){return this.getLastMaterialById(u)}getTextureByUniqueID(u){return this.getTextureByUniqueId(u)}getCameraByID(u){return this.getCameraById(u)}getCameraByUniqueID(u){return this.getCameraByUniqueId(u)}getBoneByID(u){return this.getBoneById(u)}getLightByID(u){return this.getLightById(u)}getLightByUniqueID(u){return this.getLightByUniqueId(u)}getParticleSystemByID(u){return this.getParticleSystemById(u)}getGeometryByID(u){return this.getGeometryById(u)}getMeshByID(u){return this.getMeshById(u)}getMeshByUniqueID(u){return this.getMeshByUniqueId(u)}getLastMeshByID(u){return this.getLastMeshById(u)}getMeshesByID(u){return this.getMeshesById(u)}getTransformNodeByID(u){return this.getTransformNodeById(u)}getTransformNodeByUniqueID(u){return this.getTransformNodeByUniqueId(u)}getTransformNodesByID(u){return this.getTransformNodesById(u)}getNodeByID(u){return this.getNodeById(u)}getLastEntryByID(u){return this.getLastEntryById(u)}getLastSkeletonByID(u){return this.getLastSkeletonById(u)}}uu.FOGMODE_NONE=0,uu.FOGMODE_EXP=1,uu.FOGMODE_EXP2=2,uu.FOGMODE_LINEAR=3,uu.MinDeltaTime=1,uu.MaxDeltaTime=1e3,(0,U.g)("BABYLON.Scene",uu)},10986:(u,G,s)=>{"use strict";s.d(G,{d:()=>T,e:()=>z});class T{}T.NAME_EFFECTLAYER="EffectLayer",T.NAME_LAYER="Layer",T.NAME_LENSFLARESYSTEM="LensFlareSystem",T.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",T.NAME_PARTICLESYSTEM="tb",T.NAME_GAMEPAD="Gamepad",T.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",T.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",T.NAME_PREPASSRENDERER="PrePassRenderer",T.NAME_DEPTHRENDERER="DepthRenderer",T.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",T.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",T.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",T.NAME_SPRITE="Sprite",T.NAME_SUBSURFACE="SubSurface",T.NAME_OUTLINERENDERER="Outline",T.NAME_PROCEDURALTEXTURE="ProceduralTexture",T.NAME_SHADOWGENERATOR="ShadowGenerator",T.NAME_OCTREE="wb",T.NAME_PHYSICSENGINE="PhysicsEngine",T.NAME_AUDIO="Audio",T.NAME_FLUIDRENDERER="FluidRenderer",T.STEP_ISREADYFORMESH_EFFECTLAYER=0,T.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,T.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,T.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,T.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,T.STEP_BEFORECAMERADRAW_PREPASS=0,T.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,T.STEP_BEFORECAMERADRAW_LAYER=2,T.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,T.STEP_BEFORERENDERTARGETDRAW_LAYER=1,T.STEP_BEFORERENDERINGMESH_PREPASS=0,T.STEP_BEFORERENDERINGMESH_OUTLINE=1,T.STEP_AFTERRENDERINGMESH_PREPASS=0,T.STEP_AFTERRENDERINGMESH_OUTLINE=1,T.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,T.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,T.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,T.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,T.STEP_BEFORECLEAR_PREPASS=1,T.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,T.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,T.STEP_AFTERRENDERTARGETDRAW_LAYER=1,T.STEP_AFTERCAMERADRAW_PREPASS=0,T.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,T.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,T.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,T.STEP_AFTERCAMERADRAW_LAYER=4,T.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,T.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,T.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,T.STEP_AFTERRENDER_AUDIO=0,T.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,T.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,T.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,T.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,T.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,T.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,T.STEP_POINTERMOVE_SPRITE=0,T.STEP_POINTERDOWN_SPRITE=0,T.STEP_POINTERUP_SPRITE=0;class z extends Array{constructor(u){super(...u)}static Create(){return Object.create(z.prototype)}registerStep(u,G,s){let T=0,z=Number.MAX_VALUE;for(;T<this.length;T++){if(z=this[T].index,u<z)break}this.splice(T,0,{index:u,component:G,action:s.bind(G)})}clear(){this.length=0}}},10863:(u,G,s)=>{"use strict";s.d(G,{b:()=>T});function T(u,G,s,T){var z,O=arguments.length,m=O<3?G:null===T?T=Object.getOwnPropertyDescriptor(G,s):T;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)m=Reflect.decorate(u,G,s,T);else for(var f=u.length-1;f>=0;f--)(z=u[f])&&(m=(O<3?z(m):O>3?z(G,s,m):z(G,s))||m);return O>3&&m&&Object.defineProperty(G,s,m),m}Object.create;Object.create},11813:(u,G,s)=>{"use strict";class T{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((u,G)=>{this._resolve=u,this._reject=G}))}}var z=s(10904),O=s(10930),m=s(10564),f=s(11154),C=s(11819),x=s(11831),g=s(10568),b=s(11336),Q=s(11838),Y=s(11844),n=s(10619),V=s(10584),F=s(10592);class r{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(u){this._useTextureToStoreBoneMatrices=u,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(u,G,s){this.name=u,this.id=G,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=z.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new g.e,this.bones=[],this._scene=s||n.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const T=this._scene.getEngine().getCaps();this._canUseTextureForBones=T.textureFloat&&T.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((u=>!u.getParent()))}getTransformMatrices(u){if(this.needInitialSkinMatrix){if(!u)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return u._bonesTransformMatrices||this.prepare(!0),u._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(u){return this.needInitialSkinMatrix&&u._transformMatrixTexture?u._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(u){let G=`Name: ${this.name}, nBones: ${this.bones.length}`;if(G+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,u){G+=", Ranges: {";let u=!0;for(const s in this._ranges)u&&(G+=", ",u=!1),G+=s;G+="}"}return G}getBoneIndexByName(u){for(let G=0,s=this.bones.length;G<s;G++)if(this.bones[G].name===u)return G;return-1}createAnimationRange(u,G,s){if(!this._ranges[u]){this._ranges[u]=new Y.c(u,G,s);for(let T=0,z=this.bones.length;T<z;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].createRange(u,G,s)}}deleteAnimationRange(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let s=0,T=this.bones.length;s<T;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].deleteRange(u,G);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}getAnimationRanges(){const u=[];let G;for(G in this._ranges)u.push(this._ranges[G]);return u}copyAnimationRange(u,G){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[G]||!u.getAnimationRange(G))return!1;let T=!0;const z=this._getHighestAnimationFrame()+1,O={},m=u.bones;let f,C;for(C=0,f=m.length;C<f;C++)O[m[C].name]=m[C];this.bones.length!==m.length&&(V.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${m.length}`),T=!1);const x=s&&this.dimensionsAtRest&&u.dimensionsAtRest?this.dimensionsAtRest.divide(u.dimensionsAtRest):null;for(C=0,f=this.bones.length;C<f;C++){const u=this.bones[C].name,m=O[u];m?T=T&&this.bones[C].copyAnimationRange(m,G,z,s,x):(V.d.Warn("copyAnimationRange: not same rig, missing source bone "+u),T=!1)}const g=u.getAnimationRange(G);return g&&(this._ranges[G]=new Y.c(G,g.from+z,g.to+z)),T}returnToRest(){for(const u of this.bones)-1!==u._index&&u.returnToRest()}_getHighestAnimationFrame(){let u=0;for(let G=0,s=this.bones.length;G<s;G++)if(this.bones[G].animations[0]){const s=this.bones[G].animations[0].getHighestFrame();u<s&&(u=s)}return u}beginAnimation(u,G,s,T){const z=this.getAnimationRange(u);return z?this._scene.beginAnimation(this,z.from,z.to,G,s,T):null}static MakeAnimationAdditive(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const T=u.getAnimationRange(s);if(!T)return null;const z=u._scene.getAllAnimatablesByTarget(u);let O=null;for(let f=0;f<z.length;f++){const u=z[f];if(u.fromFrame===(null===T||void 0===T?void 0:T.from)&&u.toFrame===(null===T||void 0===T?void 0:T.to)){O=u;break}}const m=u.getAnimatables();for(let f=0;f<m.length;f++){const u=m[f].animations;if(u)for(let T=0;T<u.length;T++)Q.b.MakeAnimationAdditive(u[T],G,s)}return O&&(O.isAdditive=!0),u}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(u){this._meshesWithPoseMatrix.push(u)}_unregisterMeshWithPoseMatrix(u){const G=this._meshesWithPoseMatrix.indexOf(u);G>-1&&this._meshesWithPoseMatrix.splice(G,1)}_computeTransformMatrices(u,G){this.onBeforeComputeObservable.notifyObservers(this);for(let s=0;s<this.bones.length;s++){const T=this.bones[s];T._childUpdateId++;const z=T.getParent();if(z?T.getLocalMatrix().multiplyToRef(z.getFinalMatrix(),T.getFinalMatrix()):G?T.getLocalMatrix().multiplyToRef(G,T.getFinalMatrix()):T.getFinalMatrix().p(T.getLocalMatrix()),-1!==T._index){const G=null===T._index?s:T._index;T.getAbsoluteInverseBindMatrix().multiplyToArray(T.getFinalMatrix(),u,16*G)}}this._identity.copyToArray(u,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const u=this.va().getRenderId();if(this._currentRenderId===u)return;this._currentRenderId=u}if(this._numBonesWithLinkedTransformNode>0)for(const u of this.bones)if(u._linkedTransformNode){const G=u._linkedTransformNode;u.position=G.position,G.rotationQuaternion?u.rotationQuaternion=G.rotationQuaternion:u.rotation=G.rotation,u.vf=G.vf}if(this.needInitialSkinMatrix)for(const u of this._meshesWithPoseMatrix){const G=u.getPoseMatrix();let s=this._isDirty;if(u._bonesTransformMatrices&&u._bonesTransformMatrices.length===16*(this.bones.length+1)||(u._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),s=!0),s){if(this._synchronizedWithMesh!==u){this._synchronizedWithMesh=u;for(const u of this.bones)if(!u.getParent()){u.getBindMatrix().multiplyToRef(G,z.l.Matrix[1]),u._updateAbsoluteBindMatrices(z.l.Matrix[1])}if(this.isUsingTextureForMatrices){const G=4*(this.bones.length+1);u._transformMatrixTexture&&u._transformMatrixTexture.getSize().width===G||(u._transformMatrixTexture&&u._transformMatrixTexture.dispose(),u._transformMatrixTexture=b.b.CreateRGBATexture(u._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(u._bonesTransformMatrices,G),this.isUsingTextureForMatrices&&u._transformMatrixTexture&&u._transformMatrixTexture.update(u._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=b.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let u=0;u<this.bones.length;u++)this._animatables.push(this.bones[u])}return this._animatables}clone(u,G){const s=new r(u,G||u,this._scene);s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){const u=this.bones[T];let G=null;const z=u.getParent();if(z){const u=this.bones.indexOf(z);G=s.bones[u]}const O=new x.b(u.name,s,G,u.getBindMatrix().clone(),u.getRestMatrix().clone());O._index=u._index,u._linkedTransformNode&&O.linkTransformNode(u._linkedTransformNode),F.e.DeepCopy(u.animations,O.animations)}if(this._ranges){s._ranges={};for(const u in this._ranges){const G=this._ranges[u];G&&(s._ranges[u]=G.clone())}}return this._isDirty=!0,s.prepare(!0),s}enableBlending(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((G=>{G.animations.forEach((G=>{G.enableBlending=!0,G.blendingSpeed=u}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const u=this._parentContainer.skeletons.indexOf(this);u>-1&&this._parentContainer.skeletons.splice(u,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const u={};u.name=this.name,u.id=this.id,this.dimensionsAtRest&&(u.dimensionsAtRest=this.dimensionsAtRest.$i()),u.bones=[],u.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let s=0;s<this.bones.length;s++){var G;const T=this.bones[s],z=T.getParent(),O={parentBoneIndex:z?this.bones.indexOf(z):-1,index:T.getIndex(),name:T.name,id:T.id,matrix:T.getBindMatrix().$i(),rest:T.getRestMatrix().$i(),linkedTransformNodeId:null===(G=T.getTransformNode())||void 0===G?void 0:G.id};u.bones.push(O),T.length&&(O.length=T.length),T.metadata&&(O.metadata=T.metadata),T.animations&&T.animations.length>0&&(O.animation=T.animations[0].serialize()),u.ranges=[];for(const G in this._ranges){const s=this._ranges[G];if(!s)continue;const T={};T.name=G,T.from=s.from,T.to=s.to,u.ranges.push(T)}}return u}static Parse(u,G){const s=new r(u.name,u.id,G);let T;for(u.dimensionsAtRest&&(s.dimensionsAtRest=z.q.Ag(u.dimensionsAtRest)),s.needInitialSkinMatrix=u.needInitialSkinMatrix,T=0;T<u.bones.length;T++){const G=u.bones[T],O=u.bones[T].index;let m=null;G.parentBoneIndex>-1&&(m=s.bones[G.parentBoneIndex]);const f=G.rest?z.d.Ag(G.rest):null,C=new x.b(G.name,s,m,z.d.Ag(G.matrix),f,null,O);void 0!==G.id&&null!==G.id&&(C.id=G.id),G.length&&(C.length=G.length),G.metadata&&(C.metadata=G.metadata),G.animation&&C.animations.push(Q.b.Parse(G.animation)),void 0!==G.linkedTransformNodeId&&null!==G.linkedTransformNodeId&&(s._hasWaitingData=!0,C._waitingTransformNodeId=G.linkedTransformNodeId)}if(u.ranges)for(T=0;T<u.ranges.length;T++){const G=u.ranges[T];s.createAnimationRange(G.name,G.from,G.to)}return s}computeAbsoluteMatrices(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||u)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(u)}getPoseMatrix(){let u=null;return this._meshesWithPoseMatrix.length>0&&(u=this._meshesWithPoseMatrix[0].getPoseMatrix()),u}sortBones(){const u=[],G=new Array(this.bones.length);for(let s=0;s<this.bones.length;s++)this._sortBones(s,u,G);this.bones=u}_sortBones(u,G,s){if(s[u])return;s[u]=!0;const T=this.bones[u];if(!T)return;void 0===T._index&&(T._index=u);const z=T.getParent();z&&this._sortBones(this.bones.indexOf(z),G,s),G.push(T)}setCurrentPoseAsRest(){this.bones.forEach((u=>{u.setCurrentPoseAsRest()}))}}var c=s(11045),j=s(10863),l=s(10866),P=s(11852),H=s(11865),X=s(10715),p=s(10935);class q extends H.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(u){this.subSurface.refractionTexture=u,u?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(u){this.subSurface.indexOfRefraction=u}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(u){this.subSurface.invertRefractionY=u}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(u){this.subSurface.linkRefractionWithTransparency=u,u&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===H.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(u){u!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=u?H.b.LIGHTFALLOFF_PHYSICAL:H.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===H.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(u){u!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=u?H.b.LIGHTFALLOFF_GLTF:H.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(u){this.imageProcessingConfiguration.colorCurvesEnabled=u}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(u){this.imageProcessingConfiguration.colorGradingEnabled=u}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(u){this._imageProcessingConfiguration.toneMappingEnabled=u}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(u){this._imageProcessingConfiguration.exposure=u}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(u){this._imageProcessingConfiguration.contrast=u}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(u){this._imageProcessingConfiguration.colorGradingTexture=u}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(u){this._imageProcessingConfiguration.colorCurves=u}constructor(u,G){super(u,G,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=O.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new O.b(0,0,0),this.albedoColor=new O.b(1,1,1),this.reflectivityColor=new O.b(1,1,1),this.reflectionColor=new O.b(1,1,1),this.emissiveColor=new O.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,P.b)(this.va())}getClassName(){return"PBRMaterial"}clone(u){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const T=p.e.Clone((()=>new q(u,this.va())),this,{cloneTexturesOnlyOnce:G});return T.id=u,T.name=u,this.stencil.copyTo(T.stencil),this._clonePlugins(T,s),T}serialize(){const u=super.serialize();return u.customType="BABYLON.PBRMaterial",u}static Parse(u,G,s){const T=p.e.Parse((()=>new q(u.name,G)),u,G,s);return u.stencil&&T.stencil.parse(u.stencil,G,s),c.d._ParsePlugins(u,T,G,s),u.clearCoat&&T.clearCoat.parse(u.clearCoat,G,s),u.anisotropy&&T.anisotropy.parse(u.anisotropy,G,s),u.brdf&&T.brdf.parse(u.brdf,G,s),u.sheen&&T.sheen.parse(u.sheen,G,s),u.subSurface&&T.subSurface.parse(u.subSurface,G,s),u.iridescence&&T.iridescence.parse(u.iridescence,G,s),T}}q.PBRMATERIAL_OPAQUE=H.b.PBRMATERIAL_OPAQUE,q.PBRMATERIAL_ALPHATEST=H.b.PBRMATERIAL_ALPHATEST,q.PBRMATERIAL_ALPHABLEND=H.b.PBRMATERIAL_ALPHABLEND,q.PBRMATERIAL_ALPHATESTANDBLEND=H.b.PBRMATERIAL_ALPHATESTANDBLEND,q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=H.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"directIntensity",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveIntensity",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"environmentIntensity",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"specularIntensity",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"disableBumpMap",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"albedoTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTexture",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTextureStrength",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"opacityTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectivityTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicTexture",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallic",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"roughness",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicF0Factor",void 0),(0,j.b)([(0,l.k)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicReflectanceColor",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicReflectanceTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectanceTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"microSurfaceTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"bumpTexture",void 0),(0,j.b)([(0,l.D)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty",null)],q.prototype,"lightmapTexture",void 0),(0,j.b)([(0,l.k)("ambient"),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientColor",void 0),(0,j.b)([(0,l.k)("albedo"),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"albedoColor",void 0),(0,j.b)([(0,l.k)("reflectivity"),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectivityColor",void 0),(0,j.b)([(0,l.k)("reflection"),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionColor",void 0),(0,j.b)([(0,l.k)("emissive"),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveColor",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"microSurface",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLightmapAsShadowmap",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"useAlphaFromAlbedoTexture",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"forceAlphaTest",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"alphaCutOff",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useSpecularOverAlpha",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAmbientInGrayScale",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,j.b)([(0,l.M)()],q.prototype,"usePhysicalLightFalloff",null),(0,j.b)([(0,l.M)()],q.prototype,"useGLTFLightFalloff",null),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRadianceOverAlpha",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useObjectSpaceNormalMap",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallax",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallaxOcclusion",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"parallaxScaleBias",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsLightsDirty")],q.prototype,"disableLighting",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"forceIrradianceInFragment",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsLightsDirty")],q.prototype,"maxSimultaneousLights",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapX",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapY",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"twoSidedLighting",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAlphaFresnel",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLinearAlphaFresnel",void 0),(0,j.b)([(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"environmentBRDFTexture",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"forceNormalForward",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"enableSpecularAntiAliasing",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useHorizonOcclusion",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRadianceOcclusion",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsMiscDirty")],q.prototype,"unlit",void 0),(0,j.b)([(0,l.M)(),(0,l.d)("_markAllSubMeshesAsMiscDirty")],q.prototype,"applyDecalMapAfterDetailMap",void 0),(0,X.g)("BABYLON.PBRMaterial",q);var d=s(11102),v=s(11193),W=s(10961),M=s(11181),o=s(11191),R=s(11148);class B{get influence(){return this._influence}set influence(u){if(this._influence===u)return;const G=this._influence;this._influence=u,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===G||0===u)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=u,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new g.e,this._onDataLayoutChanged=new g.e,this._animationPropertiesOverride=null,this.id=u,this._scene=s||n.d.LastCreatedScene,this.influence=G,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(u){const G=this.hasPositions;this._positions=u,G!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(u){const G=this.hasNormals;this._normals=u,G!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(u){const G=this.hasTangents;this._tangents=u,G!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(u){const G=this.hasUVs;this._uvs=u,G!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const u=p.e.Clone((()=>new B(this.name,this.influence,this._scene)),this);return u._positions=this._positions,u._normals=this._normals,u._tangents=this._tangents,u._uvs=this._uvs,u}serialize(){const u={};return u.name=this.name,u.influence=this.influence,u.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(u.id=this.id),this.hasNormals&&(u.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(u.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(u.Aa=Array.prototype.slice.call(this.getUVs())),p.e.AppendSerializedAnimations(this,u),u}getClassName(){return"MorphTarget"}static Parse(u,G){const s=new B(u.name,u.influence);if(s.setPositions(u.xa),null!=u.id&&(s.id=u.id),u.ya&&s.setNormals(u.ya),u.tangents&&s.setTangents(u.tangents),u.Aa&&s.setUVs(u.Aa),u.animations){for(let G=0;G<u.animations.length;G++){const T=u.animations[G],z=(0,X.e)("BABYLON.Animation");z&&s.animations.push(z.Parse(T))}u.autoAnimate&&G&&G.beginAnimation(s,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1)}return s}static FromMesh(u,G,s){G||(G=u.name);const T=new B(G,s,u.va());return T.setPositions(u.getVerticesData(W.f.PositionKind)),u.isVerticesDataPresent(W.f.NormalKind)&&T.setNormals(u.getVerticesData(W.f.NormalKind)),u.isVerticesDataPresent(W.f.TangentKind)&&T.setTangents(u.getVerticesData(W.f.TangentKind)),u.isVerticesDataPresent(W.f.UVKind)&&T.setUVs(u.getVerticesData(W.f.UVKind)),T}}(0,j.b)([(0,l.M)()],B.prototype,"id",void 0);var D=s(10881),k=s(11726);class w{set areUpdatesFrozen(u){u?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new D.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,u||(u=n.d.LastCreatedScene),this._scene=u,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const u=this._scene.getEngine().getCaps();this._canUseTextureForTargets=u.canUseGLVertexID&&u.textureFloat&&u.maxVertexTextureImageUnits>0&&u.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(u){this._numMaxInfluencers!==u&&(this._numMaxInfluencers=u,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(u){this._useTextureToStoreTargets=u}get isUsingTextureForTargets(){var u;return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(u=this._scene)&&void 0!==u&&u.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(u){return this._activeTargets.data[u]}getTarget(u){return this._targets[u]}getTargetByName(u){for(const G of this._targets)if(G.name===u)return G;return null}addTarget(u){this._targets.push(u),this._targetInfluenceChangedObservers.push(u.onInfluenceChanged.add((u=>{this._syncActiveTargets(u)}))),this._targetDataLayoutChangedObservers.push(u._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(u){const G=this._targets.indexOf(u);G>=0&&(this._targets.splice(G,1),u.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(G,1)[0]),u._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(G,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(u)}_bind(u){u.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),u.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),u.setTexture("morphTargets",this._targetStoreTexture),u.setInt("morphTargetCount",this.numInfluencers)}clone(){const u=new w(this._scene);for(const G of this._targets)u.addTarget(G.clone());return u.enableNormalMorphing=this.enableNormalMorphing,u.enableTangentMorphing=this.enableTangentMorphing,u.enableUVMorphing=this.enableUVMorphing,u}serialize(){const u={};u.id=this.uniqueId,u.targets=[];for(const G of this._targets)u.targets.push(G.serialize());return u}_syncActiveTargets(u){if(this.areUpdatesFrozen)return;let G=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let s=-1;for(const T of this._targets){if(s++,0===T.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=w.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(T),this._morphTargetTextureIndices[G]=s,this._tempInfluences[G++]=T.influence,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs;const u=T.getPositions();if(u){const G=u.length/3;if(0===this._vertexCount)this._vertexCount=G;else if(this._vertexCount!==G)return void V.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==G&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,G)),this._influences&&this._influences.length===G||(this._influences=new Float32Array(G));for(let T=0;T<G;T++)this._influences[T]=this._tempInfluences[T];u&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const u=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>u&&(this._textureHeight=Math.ceil(this._textureWidth/u),this._textureWidth=u);let G=!0;if(this._targetStoreTexture){const u=this._targetStoreTexture.getSize();u.width===this._textureWidth&&u.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(G=!1)}if(G){this._targetStoreTexture&&this._targetStoreTexture.dispose();const u=this._targets.length,G=new Float32Array(u*this._textureWidth*this._textureHeight*4);let s=0;for(let T=0;T<u;T++){const u=this._targets[T],z=u.getPositions(),O=u.getNormals(),m=u.getUVs(),f=u.getTangents();if(!z)return void(0===T&&V.d.Error("Invalid morph target. Target must have positions."));s=T*this._textureWidth*this._textureHeight*4;for(let T=0;T<this._vertexCount;T++)G[s]=z[3*T],G[s+1]=z[3*T+1],G[s+2]=z[3*T+2],s+=4,this._supportsNormals&&O&&(G[s]=O[3*T],G[s+1]=O[3*T+1],G[s+2]=O[3*T+2],s+=4),this._supportsUVs&&m&&(G[s]=m[2*T],G[s+1]=m[2*T+1],s+=4),this._supportsTangents&&f&&(G[s]=f[3*T],G[s+1]=f[3*T+1],G[s+2]=f[3*T+2],s+=4)}this._targetStoreTexture=k.e.CreateRGBATexture(G,this._textureWidth,this._textureHeight,u,this._scene,!1,!1,1,1)}}for(const u of this._scene.meshes)u.morphTargetManager===this&&u._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const u=this._parentContainer.morphTargetManagers.indexOf(this);u>-1&&this._parentContainer.morphTargetManagers.splice(u,1),this._parentContainer=null}for(const u of this._targets)this._scene.stopAnimation(u)}}static Parse(u,G){const s=new w(G);for(const T of u.targets)s.addTarget(B.Parse(T,G));return s}}w.EnableTextureStorage=!0,w.MaxActiveMorphTargetsInVertexAttributeMode=8;var L=s(11875),S=s(10622),e=s(11059);function h(u,G,s,T){return z.q.Ag(G,s).scaleInPlace(T)}class I{constructor(u,G,s,T){this.type=u,this.name=G,this.getValue=s,this.getStride=T}_buildAnimation(u,G,s){const T=new Q.b(u,this.name,G,this.type);return T.setKeys(s),T}}class i extends I{buildAnimations(u,G,s,T,z){z(u._babylonTransformNode,this._buildAnimation(G,s,T))}}const J={translation:[new i(Q.b.ANIMATIONTYPE_VECTOR3,"position",h,(()=>3))],rotation:[new i(Q.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(u,G,s,T){return z.h.Ag(G,s).scaleInPlace(T)}),(()=>4))],scale:[new i(Q.b.ANIMATIONTYPE_VECTOR3,"vf",h,(()=>3))],weights:[new class extends I{buildAnimations(u,G,s,T,z){if(u._numMorphTargets)for(let O=0;O<u._numMorphTargets;O++){const m=new Q.b(`${G}_${O}`,this.name,s,this.type);if(m.setKeys(T.map((u=>({frame:u.frame,inTangent:u.inTangent?u.inTangent[O]:void 0,value:u.value[O],outTangent:u.outTangent?u.outTangent[O]:void 0,interpolation:u.interpolation})))),u._primitiveBabylonMeshes)for(const G of u._primitiveBabylonMeshes)if(G.morphTargetManager){const u=G.morphTargetManager.getTarget(O),s=m.clone();u.animations.push(s),z(u,s)}}}}(Q.b.ANIMATIONTYPE_FLOAT,"influence",(function(u,G,s,T){const z=new Array(u._numMorphTargets);for(let O=0;O<z.length;O++)z[O]=G[s++]*T;return z}),(u=>u._numMorphTargets))]},A=new Map,N=A;function y(u,G,s){a(u)&&V.d.Warn(`Extension with the name '${u}' already exists`),A.set(u,{isGLTFExtension:G,factory:s})}function a(u){return A.delete(u)}function K(){const u=u=>u&&"object"===typeof u;for(var G=arguments.length,s=new Array(G),T=0;T<G;T++)s[T]=arguments[T];return s.reduce(((G,s)=>(Object.keys(s).forEach((T=>{const z=G[T],O=s[T];Array.isArray(z)&&Array.isArray(O)?G[T]=z.concat(...O):u(z)&&u(O)?G[T]=K(z,O):G[T]=O})),G)),{})}class Z{static Get(u,G,s){if(!G||void 0==s||!G[s])throw new Error(`${u}: Failed to find index (${s})`);return G[s]}static TryGet(u,G){return u&&void 0!=G&&u[G]?u[G]:null}static Assign(u){if(u)for(let G=0;G<u.length;G++)u[G].index=G}}class t{static RegisterExtension(u,G){y(u,!1,G)}static UnregisterExtension(u){return a(u)}get Ei(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(u){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=u}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((u=>u.dispose&&u.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(u,G,s,T,z,O){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=G,this._assetContainer=s,this._loadData(T);let O=null;if(u){const G={};if(this._gltf.nodes)for(const u of this._gltf.nodes)u.name&&(G[u.name]=u.index);O=(u instanceof Array?u:[u]).map((u=>{const s=G[u];if(void 0===s)throw new Error(`Failed to find node '${u}'`);return s}))}return this._loadAsync(z,m,O,(()=>({meshes:this._getMeshes(),fj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=u,this._loadData(G),this._loadAsync(s,z,null,(()=>{})))))}_loadAsync(u,G,s,T){return Promise.resolve().then((async()=>{this._rootUrl=u,this._uniqueRootUrl=!u.startsWith("file:")&&G?u:`${u}${Date.now()}/`,this._fileName=G,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const z=`${L.k[L.k.LOADING]} => ${L.k[L.k.READY]}`,O=`${L.k[L.k.LOADING]} => ${L.k[L.k.COMPLETE]}`;this._parent._startPerformanceCounter(z),this._parent._startPerformanceCounter(O),this._parent._setState(L.k.LOADING),this._extensionsOnLoading();const f=new Array;if(!this.parent.loadOnlyMaterials)if(s)f.push(this.loadSceneAsync("/nodes",{nodes:s,index:-1}));else if(void 0!=this._gltf.wf||this._gltf.scenes&&this._gltf.scenes[0]){const u=Z.Get("/scene",this._gltf.scenes,this._gltf.wf||0);f.push(this.loadSceneAsync(`/scenes/${u.index}`,u))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let u=0;u<this._gltf.materials.length;++u){const G=this._gltf.materials[u],s="/materials/"+u,T=c.d.TriangleFillMode;f.push(this._loadMaterialAsync(s,G,null,T,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&f.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&f.push(this._compileShadowGeneratorsAsync());return Promise.all(f).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Af(!0),this._extensionsOnReady(),this._parent._setState(L.k.READY),this._startAnimations(),T()))).then((u=>(this._parent._endPerformanceCounter(z),m.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(O),this._parent._setState(L.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(u=>{this._parent.onErrorObservable.notifyObservers(u),this._parent.onErrorObservable.clear(),this.dispose()}))})),u)))})).catch((u=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(u),this._parent.onErrorObservable.clear(),this.dispose()),u}))}_loadData(u){if(this._gltf=u.json,this._setupData(),u.bin){const G=this._gltf.buffers;if(G&&G[0]&&!G[0].uri){const s=G[0];(s.byteLength<u.bin.byteLength-3||s.byteLength>u.bin.byteLength)&&V.d.Warn(`Binary buffer length (${s.byteLength}) from JSON does not match chunk length (${u.bin.byteLength})`),this._bin=u.bin}else V.d.Warn("Unexpected BIN chunk")}}_setupData(){if(Z.Assign(this._gltf.accessors),Z.Assign(this._gltf.animations),Z.Assign(this._gltf.buffers),Z.Assign(this._gltf.bufferViews),Z.Assign(this._gltf.cameras),Z.Assign(this._gltf.images),Z.Assign(this._gltf.materials),Z.Assign(this._gltf.meshes),Z.Assign(this._gltf.nodes),Z.Assign(this._gltf.samplers),Z.Assign(this._gltf.scenes),Z.Assign(this._gltf.skins),Z.Assign(this._gltf.textures),this._gltf.nodes){const u={};for(const s of this._gltf.nodes)if(s.children)for(const G of s.children)u[G]=s.index;const G=this._createRootNode();for(const s of this._gltf.nodes){const T=u[s.index];s.parent=void 0===T?G:this._gltf.nodes[T]}}}async _loadExtensionsAsync(){const u=[];if(N.forEach(((G,s)=>{var T;!1===(null===(T=this.parent.extensionOptions[s])||void 0===T?void 0:T.enabled)?G.isGLTFExtension&&this.isExtensionUsed(s)&&V.d.Warn(`Extension ${s} is used but has been explicitly disabled.`):G.isGLTFExtension&&!this.isExtensionUsed(s)||u.push((async()=>{const u=await G.factory(this);return u.name!==s&&V.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${u.name} !== ${s}`),this._parent.onExtensionLoadedObservable.notifyObservers(u),u})())})),this._extensions.push(...await Promise.all(u)),this._extensions.sort(((u,G)=>(u.order||Number.MAX_VALUE)-(G.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const s of this._gltf.extensionsRequired){if(!this._extensions.some((u=>u.name===s&&u.enabled))){var G;if(!1===(null===(G=this.parent.extensionOptions[s])||void 0===G?void 0:G.enabled))throw new Error(`Required extension ${s} is disabled`);throw new Error(`Required extension ${s} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new R.c("__root__",this._babylonScene);this._rootBabylonMesh=u,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Af(!1);const G={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case L.i.AUTO:this._babylonScene.useRightHandedSystem||(G.rotation=[0,1,0,0],G.scale=[1,1,-1],t._LoadTransform(G,this._rootBabylonMesh));break;case L.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(u),G}loadSceneAsync(u,G){const s=this._extensionsLoadSceneAsync(u,G);if(s)return s;const T=new Array;if(this.logOpen(`${u} ${G.name||""}`),G.nodes)for(const z of G.nodes){const G=Z.Get(`${u}/nodes/${z}`,this._gltf.nodes,z);T.push(this.loadNodeAsync(`/nodes/${G.index}`,G,(u=>{u.parent=this._rootBabylonMesh})))}for(const z of this._postSceneLoadActions)z();return T.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(T).then((()=>{}))}_forEachPrimitive(u,G){if(u._primitiveBabylonMeshes)for(const s of u._primitiveBabylonMeshes)G(s)}_getGeometries(){const u=[],G=this._gltf.nodes;if(G)for(const s of G)this._forEachPrimitive(s,(G=>{const s=G.sj;s&&-1===u.indexOf(s)&&u.push(s)}));return u}_getMeshes(){const u=[];this._rootBabylonMesh instanceof o.d&&u.push(this._rootBabylonMesh);const G=this._gltf.nodes;if(G)for(const s of G)this._forEachPrimitive(s,(G=>{u.push(G)}));return u}_getTransformNodes(){const u=[],G=this._gltf.nodes;if(G)for(const s of G)s._babylonTransformNode&&"sb"===s._babylonTransformNode.getClassName()&&u.push(s._babylonTransformNode),s._babylonTransformNodeForSkin&&u.push(s._babylonTransformNodeForSkin);return u}_getSkeletons(){const u=[],G=this._gltf.skins;if(G)for(const s of G)s._data&&u.push(s._data.babylonSkeleton);return u}_getAnimationGroups(){const u=[],G=this._gltf.animations;if(G)for(const s of G)s._babylonAnimationGroup&&u.push(s._babylonAnimationGroup);return u}_startAnimations(){switch(this._parent.animationStartMode){case L.f.NONE:break;case L.f.FIRST:{const u=this._getAnimationGroups();0!==u.length&&u[0].start(!0);break}case L.f.ALL:{const u=this._getAnimationGroups();for(const G of u)G.start(!0);break}default:return void V.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadNodeAsync(u,G,s);if(T)return T;if(G._babylonTransformNode)throw new Error(`${u}: Invalid recursive node hierarchy`);const z=new Array;this.logOpen(`${u} ${G.name||""}`);const O=T=>{if(t.AddPointerMetadata(T,u),t._LoadTransform(G,T),void 0!=G.camera){const s=Z.Get(`${u}/camera`,this._gltf.cameras,G.camera);z.push(this.loadCameraAsync(`/cameras/${s.index}`,s,(u=>{u.parent=T})))}if(G.children)for(const s of G.children){const G=Z.Get(`${u}/children/${s}`,this._gltf.nodes,s);z.push(this.loadNodeAsync(`/nodes/${G.index}`,G,(u=>{u.parent=T})))}s(T)},m=void 0!=G.mesh,f=this._parent.loadSkins&&void 0!=G.skin;if(!m||f){const u=G.name||`node${G.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new v.d(u,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==G.mesh?G._babylonTransformNode=s:G._babylonTransformNodeForSkin=s,O(s)}if(m)if(f){const s=Z.Get(`${u}/mesh`,this._gltf.meshes,G.mesh);z.push(this._loadMeshAsync(`/meshes/${s.index}`,G,s,(s=>{const T=G._babylonTransformNodeForSkin;s.metadata=K(T.metadata,s.metadata||{});const O=Z.Get(`${u}/skin`,this._gltf.skins,G.skin);z.push(this._loadSkinAsync(`/skins/${O.index}`,G,O,(u=>{this._forEachPrimitive(G,(G=>{G.skeleton=u})),this._postSceneLoadActions.push((()=>{if(void 0!=O.skeleton){const u=Z.Get(`/skins/${O.index}/skeleton`,this._gltf.nodes,O.skeleton).parent;G.index===u.index?s.parent=T.parent:s.parent=u._babylonTransformNode}else s.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:T,skinnedNode:s})}))})))})))}else{const s=Z.Get(`${u}/mesh`,this._gltf.meshes,G.mesh);z.push(this._loadMeshAsync(`/meshes/${s.index}`,G,s,O))}return this.logClose(),Promise.all(z).then((()=>(this._forEachPrimitive(G,(u=>{u.sj&&u.sj.useBoundingInfoFromGeometry?u.Ea():u.refreshBoundingInfo(!0,!0)})),G._babylonTransformNode)))}_loadMeshAsync(u,G,s,T){const z=s.primitives;if(!z||!z.length)throw new Error(`${u}: Primitives are missing`);void 0==z[0].index&&Z.Assign(z);const O=new Array;this.logOpen(`${u} ${s.name||""}`);const m=G.name||`node${G.index}`;if(1===z.length){const T=s.primitives[0];O.push(this._loadMeshPrimitiveAsync(`${u}/primitives/${T.index}`,m,G,s,T,(u=>{G._babylonTransformNode=u,G._primitiveBabylonMeshes=[u]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,G._babylonTransformNode=new v.d(m,this._babylonScene),G._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G._primitiveBabylonMeshes=[];for(const T of z)O.push(this._loadMeshPrimitiveAsync(`${u}/primitives/${T.index}`,`${m}_primitive${T.index}`,G,s,T,(u=>{u.parent=G._babylonTransformNode,G._primitiveBabylonMeshes.push(u)})))}return T(G._babylonTransformNode),this.logClose(),Promise.all(O).then((()=>G._babylonTransformNode))}_loadMeshPrimitiveAsync(u,G,s,T,z,O){const m=this._extensionsLoadMeshPrimitiveAsync(u,G,s,T,z,O);if(m)return m;this.logOpen(`${u}`);const f=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==s.skin&&!T.primitives[0].targets;let C,x;if(f&&z._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=z._instanceData.babylonSourceMesh.ed(G),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x=z._instanceData.promise;else{const O=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new R.c(G,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.sideOrientation=this._babylonScene.useRightHandedSystem?c.d.CounterClockWiseSideOrientation:c.d.ClockWiseSideOrientation,this._createMorphTargets(u,s,T,z,m),O.push(this._loadVertexDataAsync(u,z,m).then((G=>this._loadMorphTargetsAsync(u,z,m,G).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,G.Ca(m),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const g=t._GetDrawMode(u,z.mode);if(void 0==z.material){let u=this._defaultBabylonMaterialData[g];u||(u=this._createDefaultMaterial("__GLTFLoader._default",g),this._parent.onMaterialLoadedObservable.notifyObservers(u),this._defaultBabylonMaterialData[g]=u),m.material=u}else if(!this.parent.skipMaterials){const G=Z.Get(`${u}/material`,this._gltf.materials,z.material);O.push(this._loadMaterialAsync(`/materials/${G.index}`,G,m,g,(u=>{m.material=u})))}x=Promise.all(O),f&&(z._instanceData={babylonSourceMesh:m,promise:x}),C=m}return t.AddPointerMetadata(C,u),this._parent.onMeshLoadedObservable.notifyObservers(C),O(C),this.logClose(),x.then((()=>C))}_loadVertexDataAsync(u,G,s){const T=this._extensionsLoadVertexDataAsync(u,G,s);if(T)return T;const O=G.attributes;if(!O)throw new Error(`${u}: Attributes are missing`);const m=new Array,f=new M.d(s.name,this._babylonScene);if(void 0==G.indices)s.isUnIndexed=!0;else{const s=Z.Get(`${u}/indices`,this._gltf.accessors,G.indices);m.push(this._loadIndicesAccessorAsync(`/accessors/${s.index}`,s).then((u=>{f.setIndices(u)})))}const C=(G,T,C)=>{if(void 0==O[G])return;s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(T)&&s._delayInfo.push(T);const x=Z.Get(`${u}/attributes/${G}`,this._gltf.accessors,O[G]);m.push(this._loadVertexAccessorAsync(`/accessors/${x.index}`,x,T).then((u=>{if(u.getKind()===W.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!s.skeleton&&x.min&&x.max){const u=z.l.gb[0].hf(...x.min),G=z.l.gb[1].hf(...x.max);if(x.normalized&&5126!==x.componentType){let s=1;switch(x.componentType){case 5120:s=127;break;case 5121:s=255;break;case 5122:s=32767;break;case 5123:s=65535}const T=1/s;u.scaleInPlace(T),G.scaleInPlace(T)}f._boundingInfo=new e.c(u,G),f.useBoundingInfoFromGeometry=!0}f.setVerticesBuffer(u,x.count)}))),T==W.f.MatricesIndicesExtraKind&&(s.numBoneInfluencers=8),C&&C(x)};return C("POSITION",W.f.PositionKind),C("NORMAL",W.f.NormalKind),C("TANGENT",W.f.TangentKind),C("TEXCOORD_0",W.f.UVKind),C("TEXCOORD_1",W.f.UV2Kind),C("TEXCOORD_2",W.f.UV3Kind),C("TEXCOORD_3",W.f.UV4Kind),C("TEXCOORD_4",W.f.UV5Kind),C("TEXCOORD_5",W.f.UV6Kind),C("JOINTS_0",W.f.MatricesIndicesKind),C("WEIGHTS_0",W.f.MatricesWeightsKind),C("JOINTS_1",W.f.MatricesIndicesExtraKind),C("WEIGHTS_1",W.f.MatricesWeightsExtraKind),C("COLOR_0",W.f.ColorKind,(u=>{"VEC4"===u.type&&(s.hasVertexAlpha=!0)})),Promise.all(m).then((()=>f))}_createMorphTargets(u,G,s,T,z){if(!T.targets||!this._parent.loadMorphTargets)return;if(void 0==G._numMorphTargets)G._numMorphTargets=T.targets.length;else if(T.targets.length!==G._numMorphTargets)throw new Error(`${u}: Primitives do not have the same number of targets`);const O=s.extras?s.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,z.morphTargetManager=new w(this._babylonScene),z.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.morphTargetManager.areUpdatesFrozen=!0;for(let m=0;m<T.targets.length;m++){const u=G.weights?G.weights[m]:s.weights?s.weights[m]:0,T=O?O[m]:`morphTarget${m}`;z.morphTargetManager.addTarget(new B(T,u,z.va()))}}_loadMorphTargetsAsync(u,G,s,T){if(!G.targets||!this._parent.loadMorphTargets)return Promise.resolve();const z=new Array,O=s.morphTargetManager;for(let m=0;m<O.numTargets;m++){const s=O.getTarget(m);z.push(this._loadMorphTargetVertexDataAsync(`${u}/targets/${m}`,T,G.targets[m],s))}return Promise.all(z).then((()=>{O.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(u,G,s,T){const z=new Array,O=(T,O,m)=>{if(void 0==s[T])return;const f=G.getVertexBuffer(O);if(!f)return;const C=Z.Get(`${u}/${T}`,this._gltf.accessors,s[T]);z.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((u=>{m(f,u)})))};return O("POSITION",W.f.PositionKind,((u,G)=>{const s=new Float32Array(G.length);u.forEach(G.length,((u,T)=>{s[T]=G[T]+u})),T.setPositions(s)})),O("NORMAL",W.f.NormalKind,((u,G)=>{const s=new Float32Array(G.length);u.forEach(s.length,((u,T)=>{s[T]=G[T]+u})),T.setNormals(s)})),O("TANGENT",W.f.TangentKind,((u,G)=>{const s=new Float32Array(G.length/3*4);let z=0;u.forEach(G.length/3*4,((u,T)=>{(T+1)%4!==0&&(s[z]=G[z]+u,z++)})),T.setTangents(s)})),Promise.all(z).then((()=>{}))}static _LoadTransform(u,G){if(void 0!=u.skin)return;let s=z.q.Zero(),T=z.h.Identity(),O=z.q.One();if(u.matrix){z.d.Ag(u.matrix).decompose(O,T,s)}else u.translation&&(s=z.q.Ag(u.translation)),u.rotation&&(T=z.h.Ag(u.rotation)),u.scale&&(O=z.q.Ag(u.scale));G.position=s,G.rotationQuaternion=T,G.vf=O}_loadSkinAsync(u,G,s,T){if(!this._parent.loadSkins)return Promise.resolve();const z=this._extensionsLoadSkinAsync(u,G,s);if(z)return z;if(s._data)return T(s._data.babylonSkeleton),s._data.promise;const O=`skeleton${s.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new r(s.name||O,O,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(u,s,m);const f=this._loadSkinInverseBindMatricesDataAsync(u,s).then((u=>{this._updateBoneMatrices(m,u)}));return s._data={babylonSkeleton:m,promise:f},T(m),f}_loadBones(u,G,s){if(void 0==G.skeleton||this._parent.alwaysComputeSkeletonRootNode){const s=this._findSkeletonRootNode(`${u}/joints`,G.joints);if(s)if(void 0===G.skeleton)G.skeleton=s.index;else{const T=(u,G)=>{for(;G.parent;G=G.parent)if(G.parent===u)return!0;return!1},z=Z.Get(`${u}/skeleton`,this._gltf.nodes,G.skeleton);z===s||T(z,s)||(V.d.Warn(`${u}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),G.skeleton=s.index)}else V.d.Warn(`${u}: Failed to find common root`)}const T={};for(const z of G.joints){const O=Z.Get(`${u}/joints/${z}`,this._gltf.nodes,z);this._loadBone(O,G,s,T)}}_findSkeletonRootNode(u,G){if(0===G.length)return null;const s={};for(const z of G){const G=[];let T=Z.Get(`${u}/${z}`,this._gltf.nodes,z);for(;-1!==T.index;)G.unshift(T),T=T.parent;s[z]=G}let T=null;for(let z=0;;++z){let u=s[G[0]];if(z>=u.length)return T;const O=u[z];for(let m=1;m<G.length;++m)if(u=s[G[m]],z>=u.length||O!==u[z])return T;T=O}}_loadBone(u,G,s,T){u._isJoint=!0;let z=T[u.index];if(z)return z;let O=null;u.index!==G.skeleton&&(u.parent&&-1!==u.parent.index?O=this._loadBone(u.parent,G,s,T):void 0!==G.skeleton&&V.d.Warn(`/skins/${G.index}/skeleton: Skeleton node is not a common root`));const m=G.joints.indexOf(u.index);return z=new x.b(u.name||`joint${u.index}`,s,O,this._getNodeMatrix(u),null,null,m),T[u.index]=z,this._postSceneLoadActions.push((()=>{z.linkTransformNode(u._babylonTransformNode)})),z}_loadSkinInverseBindMatricesDataAsync(u,G){if(void 0==G.inverseBindMatrices)return Promise.resolve(null);const s=Z.Get(`${u}/inverseBindMatrices`,this._gltf.accessors,G.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${s.index}`,s)}_updateBoneMatrices(u,G){for(const s of u.bones){const u=z.d.Identity(),T=s._index;G&&-1!==T&&(z.d.FromArrayToRef(G,16*T,u),u.invertToRef(u));const O=s.getParent();O&&u.multiplyToRef(O.getAbsoluteInverseBindMatrix(),u),s.xj(u,!1,!1),s._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(u){return u.matrix?z.d.Ag(u.matrix):z.d.Compose(u.scale?z.q.Ag(u.scale):z.q.One(),u.rotation?z.h.Ag(u.rotation):z.h.Identity(),u.translation?z.q.Ag(u.translation):z.q.Zero())}loadCameraAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadCameraAsync(u,G,s);if(T)return T;const O=new Array;this.logOpen(`${u} ${G.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new C.d(G.name||`camera${G.index}`,z.q.Zero(),this._babylonScene,!1);switch(m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.ignoreParentScaling=!0,G._babylonCamera=m,m.rotation.set(0,Math.PI,0),G.type){case"perspective":{const s=G.perspective;if(!s)throw new Error(`${u}: Camera perspective properties are missing`);m.fov=s.yfov,m.Mi=s.znear,m.maxZ=s.zfar||0;break}case"orthographic":if(!G.orthographic)throw new Error(`${u}: Camera orthographic properties are missing`);m.mode=f.e.ORTHOGRAPHIC_CAMERA,m.orthoLeft=-G.orthographic.xmag,m.orthoRight=G.orthographic.xmag,m.orthoBottom=-G.orthographic.ymag,m.orthoTop=G.orthographic.ymag,m.Mi=G.orthographic.znear,m.maxZ=G.orthographic.zfar;break;default:throw new Error(`${u}: Invalid camera type (${G.type})`)}return t.AddPointerMetadata(m,u),this._parent.onCameraLoadedObservable.notifyObservers(m),s(m),this.logClose(),Promise.all(O).then((()=>m))}_loadAnimationsAsync(){const u=this._gltf.animations;if(!u)return Promise.resolve();const G=new Array;for(let s=0;s<u.length;s++){const T=u[s];G.push(this.loadAnimationAsync(`/animations/${T.index}`,T).then((u=>{0===u.targetedAnimations.length&&u.dispose()})))}return Promise.all(G).then((()=>{}))}loadAnimationAsync(u,G){const T=this._extensionsLoadAnimationAsync(u,G);return T||s.e(38).then(s.bind(s,13145)).then((s=>{let{AnimationGroup:T}=s;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new T(G.name||`animation${G.index}`,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G._babylonAnimationGroup=z;const O=new Array;Z.Assign(G.channels),Z.Assign(G.samplers);for(const m of G.channels)O.push(this._loadAnimationChannelAsync(`${u}/channels/${m.index}`,u,G,m,((u,G)=>{u.animations=u.animations||[],u.animations.push(G),z.addTargetedAnimation(G,u)})));return Promise.all(O).then((()=>(z.normalize(0),z)))}))}_loadAnimationChannelAsync(u,G,s,T,z){const O=this._extensionsLoadAnimationChannelAsync(u,G,s,T,z);if(O)return O;if(void 0==T.target.node)return Promise.resolve();const m=Z.Get(`${u}/target/node`,this._gltf.nodes,T.target.node),f=T.target.path,C="weights"===f;if(C&&!m._numMorphTargets||!C&&!m._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!m._isJoint)return Promise.resolve();let x;switch(f){case"translation":x=J.translation;break;case"rotation":x=J.rotation;break;case"scale":x=J.scale;break;case"weights":x=J.weights;break;default:throw new Error(`${u}/target/path: Invalid value (${T.target.path})`)}const g={object:m,info:x};return this._loadAnimationChannelFromTargetInfoAsync(u,G,s,T,g,z)}_loadAnimationChannelFromTargetInfoAsync(u,G,s,T,z,O){const m=this.parent.targetFps,f=1/m,C=Z.Get(`${u}/sampler`,s.samplers,T.sampler);return this._loadAnimationSamplerAsync(`${G}/samplers/${T.sampler}`,C).then((u=>{let G=0;const C=z.object,x=z.info;for(const z of x){const x=z.getStride(C),g=u.input,b=u.output,Q=new Array(g.length);let Y=0;switch(u.interpolation){case"STEP":for(let u=0;u<g.length;u++){const G=z.getValue(C,b,Y,1);Y+=x,Q[u]={frame:g[u]*m,value:G,interpolation:1}}break;case"CUBICSPLINE":for(let u=0;u<g.length;u++){const G=z.getValue(C,b,Y,f);Y+=x;const s=z.getValue(C,b,Y,1);Y+=x;const T=z.getValue(C,b,Y,f);Y+=x,Q[u]={frame:g[u]*m,inTangent:G,value:s,outTangent:T}}break;case"LINEAR":for(let u=0;u<g.length;u++){const G=z.getValue(C,b,Y,1);Y+=x,Q[u]={frame:g[u]*m,value:G}}}if(Y>0){const u=`${s.name||`animation${s.index}`}_channel${T.index}_${G}`;z.buildAnimations(C,u,m,Q,((u,s)=>{++G,O(u,s)}))}}}))}_loadAnimationSamplerAsync(u,G){if(G._data)return G._data;const s=G.interpolation||"LINEAR";switch(s){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${u}/interpolation: Invalid value (${G.interpolation})`)}const T=Z.Get(`${u}/input`,this._gltf.accessors,G.input),z=Z.Get(`${u}/output`,this._gltf.accessors,G.output);return G._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${T.index}`,T),this._loadFloatAccessorAsync(`/accessors/${z.index}`,z)]).then((u=>{let[G,T]=u;return{input:G,interpolation:s,output:T}})),G._data}loadBufferAsync(u,G,s,T){const z=this._extensionsLoadBufferAsync(u,G,s,T);if(z)return z;if(!G._data)if(G.uri)G._data=this.loadUriAsync(`${u}/uri`,G,G.uri);else{if(!this._bin)throw new Error(`${u}: Uri is missing or the binary glTF is missing its binary chunk`);G._data=this._bin.readAsync(0,G.byteLength)}return G._data.then((G=>{try{return new Uint8Array(G.buffer,G.byteOffset+s,T)}catch(z){throw new Error(`${u}: ${z.message}`)}}))}loadBufferViewAsync(u,G){const s=this._extensionsLoadBufferViewAsync(u,G);if(s)return s;if(G._data)return G._data;const T=Z.Get(`${u}/buffer`,this._gltf.buffers,G.buffer);return G._data=this.loadBufferAsync(`/buffers/${T.index}`,T,G.byteOffset||0,G.byteLength),G._data}_loadAccessorAsync(u,G,s){if(G._data)return G._data;const T=t._GetNumComponents(u,G.type),z=T*W.f.GetTypeByteLength(G.componentType),O=T*G.count;if(void 0==G.bufferView)G._data=Promise.resolve(new s(O));else{const m=Z.Get(`${u}/bufferView`,this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((f=>{if(5126!==G.componentType||G.normalized||m.byteStride&&m.byteStride!==z){const u=new s(O);return W.f.ForEach(f,G.byteOffset||0,m.byteStride||z,T,G.componentType,u.length,G.normalized||!1,((G,s)=>{u[s]=G})),u}return t._GetTypedArray(u,G.componentType,f,G.byteOffset,O)}))}if(G.sparse){const O=G.sparse;G._data=G._data.then((m=>{const f=m,C=Z.Get(`${u}/sparse/indices/bufferView`,this._gltf.bufferViews,O.indices.bufferView),x=Z.Get(`${u}/sparse/values/bufferView`,this._gltf.bufferViews,O.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${x.index}`,x)]).then((m=>{let[C,x]=m;const g=t._GetTypedArray(`${u}/sparse/indices`,O.indices.componentType,C,O.indices.byteOffset,O.count),b=T*O.count;let Q;if(5126!==G.componentType||G.normalized){const m=t._GetTypedArray(`${u}/sparse/values`,G.componentType,x,O.values.byteOffset,b);Q=new s(b),W.f.ForEach(m,0,z,T,G.componentType,Q.length,G.normalized||!1,((u,G)=>{Q[G]=u}))}else Q=t._GetTypedArray(`${u}/sparse/values`,G.componentType,x,O.values.byteOffset,b);let Y=0;for(let u=0;u<g.length;u++){let G=g[u]*T;for(let u=0;u<T;u++)f[G++]=Q[Y++]}return f}))}))}return G._data}_loadFloatAccessorAsync(u,G){return this._loadAccessorAsync(u,G,Float32Array)}_loadIndicesAccessorAsync(u,G){if("SCALAR"!==G.type)throw new Error(`${u}/type: Invalid value ${G.type}`);if(5121!==G.componentType&&5123!==G.componentType&&5125!==G.componentType)throw new Error(`${u}/componentType: Invalid value ${G.componentType}`);if(G._data)return G._data;if(G.sparse){const s=t._GetTypedArrayConstructor(`${u}/componentType`,G.componentType);G._data=this._loadAccessorAsync(u,G,s)}else{const s=Z.Get(`${u}/bufferView`,this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((s=>t._GetTypedArray(u,G.componentType,s,G.byteOffset,G.count)))}return G._data}_loadVertexBufferViewAsync(u){if(u._babylonBuffer)return u._babylonBuffer;const G=this._babylonScene.getEngine();return u._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((u=>new W.b(G,u,!1))),u._babylonBuffer}_loadVertexAccessorAsync(u,G,s){var T;if(null!==(T=G._babylonVertexBuffer)&&void 0!==T&&T[s])return G._babylonVertexBuffer[s];G._babylonVertexBuffer||(G._babylonVertexBuffer={});const z=this._babylonScene.getEngine();if(G.sparse||void 0==G.bufferView)G._babylonVertexBuffer[s]=this._loadFloatAccessorAsync(u,G).then((u=>new W.f(z,u,s,!1)));else{const T=Z.Get(`${u}/bufferView`,this._gltf.bufferViews,G.bufferView);G._babylonVertexBuffer[s]=this._loadVertexBufferViewAsync(T).then((O=>{const m=t._GetNumComponents(u,G.type);return new W.f(z,O,s,!1,void 0,T.byteStride,void 0,G.byteOffset,m,G.componentType,G.normalized,!0,void 0,!0)}))}return G._babylonVertexBuffer[s]}_loadMaterialMetallicRoughnessPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return G&&(G.baseColorFactor?(s.albedoColor=O.b.Ag(G.baseColorFactor),s.alpha=G.baseColorFactor[3]):s.albedoColor=O.b.White(),s.metallic=void 0==G.metallicFactor?1:G.metallicFactor,s.roughness=void 0==G.roughnessFactor?1:G.roughnessFactor,G.baseColorTexture&&T.push(this.loadTextureInfoAsync(`${u}/baseColorTexture`,G.baseColorTexture,(u=>{u.name=`${s.name} (Base Color)`,s.albedoTexture=u}))),G.metallicRoughnessTexture&&(G.metallicRoughnessTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${u}/metallicRoughnessTexture`,G.metallicRoughnessTexture,(u=>{u.name=`${s.name} (Metallic Roughness)`,s.metallicTexture=u}))),s.useMetallnessFromMetallicTextureBlue=!0,s.useRoughnessFromMetallicTextureGreen=!0,s.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(T).then((()=>{}))}_loadMaterialAsync(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const O=this._extensionsLoadMaterialAsync(u,G,s,T,z);if(O)return O;G._data=G._data||{};let m=G._data[T];if(!m){this.logOpen(`${u} ${G.name||""}`);const s=this.createMaterial(u,G,T);m={babylonMaterial:s,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(u,G,s)},G._data[T]=m,t.AddPointerMetadata(s,u),this._parent.onMaterialLoadedObservable.notifyObservers(s),this.logClose()}return s&&(m.babylonMeshes.push(s),s._i.addOnce((()=>{const u=m.babylonMeshes.indexOf(s);-1!==u&&m.babylonMeshes.splice(u,1)}))),z(m.babylonMaterial),m.promise.then((()=>m.babylonMaterial))}_createDefaultMaterial(u,G){this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new q(u,this._babylonScene);return s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.fillMode=G,s.enableSpecularAntiAliasing=!0,s.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,s.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,s.transparencyMode=q.PBRMATERIAL_OPAQUE,s.metallic=1,s.roughness=1,s}createMaterial(u,G,s){const T=this._extensionsCreateMaterial(u,G,s);if(T)return T;const z=G.name||`material${G.index}`;return this._createDefaultMaterial(z,s)}loadMaterialPropertiesAsync(u,G,s){const T=this._extensionsLoadMaterialPropertiesAsync(u,G,s);if(T)return T;const z=new Array;return z.push(this.loadMaterialBasePropertiesAsync(u,G,s)),G.pbrMetallicRoughness&&z.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${u}/pbrMetallicRoughness`,G.pbrMetallicRoughness,s)),this.loadMaterialAlphaProperties(u,G,s),Promise.all(z).then((()=>{}))}loadMaterialBasePropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.emissiveColor=G.emissiveFactor?O.b.Ag(G.emissiveFactor):new O.b(0,0,0),G.doubleSided&&(s.Ig=!1,s.twoSidedLighting=!0),G.normalTexture&&(G.normalTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${u}/normalTexture`,G.normalTexture,(u=>{u.name=`${s.name} (Normal)`,s.bumpTexture=u}))),s.invertNormalMapX=!this._babylonScene.useRightHandedSystem,s.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=G.normalTexture.scale&&s.bumpTexture&&(s.bumpTexture.level=G.normalTexture.scale),s.forceIrradianceInFragment=!0),G.occlusionTexture&&(G.occlusionTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${u}/occlusionTexture`,G.occlusionTexture,(u=>{u.name=`${s.name} (Occlusion)`,s.ambientTexture=u}))),s.useAmbientInGrayScale=!0,void 0!=G.occlusionTexture.strength&&(s.ambientTextureStrength=G.occlusionTexture.strength)),G.emissiveTexture&&T.push(this.loadTextureInfoAsync(`${u}/emissiveTexture`,G.emissiveTexture,(u=>{u.name=`${s.name} (Emissive)`,s.emissiveTexture=u}))),Promise.all(T).then((()=>{}))}loadMaterialAlphaProperties(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);switch(G.alphaMode||"OPAQUE"){case"OPAQUE":s.transparencyMode=q.PBRMATERIAL_OPAQUE,s.alpha=1;break;case"MASK":s.transparencyMode=q.PBRMATERIAL_ALPHATEST,s.alphaCutOff=void 0==G.alphaCutoff?.5:G.alphaCutoff,s.albedoTexture&&(s.albedoTexture.nc=!0);break;case"BLEND":s.transparencyMode=q.PBRMATERIAL_ALPHABLEND,s.albedoTexture&&(s.albedoTexture.nc=!0,s.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${u}/alphaMode: Invalid value (${G.alphaMode})`)}}loadTextureInfoAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureInfoAsync(u,G,s);if(T)return T;if(this.logOpen(`${u}`),G.texCoord>=6)throw new Error(`${u}/texCoord: Invalid value (${G.texCoord})`);const z=Z.Get(`${u}/index`,this._gltf.textures,G.index);z._textureInfo=G;const O=this._loadTextureAsync(`/textures/${G.index}`,z,(T=>{T.coordinatesIndex=G.texCoord||0,t.AddPointerMetadata(T,u),this._parent.onTextureLoadedObservable.notifyObservers(T),s(T)}));return this.logClose(),O}_loadTextureAsync(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureAsync(u,G,s);if(T)return T;this.logOpen(`${u} ${G.name||""}`);const z=void 0==G.sampler?t.DefaultSampler:Z.Get(`${u}/sampler`,this._gltf.samplers,G.sampler),O=Z.Get(`${u}/source`,this._gltf.images,G.source),m=this._createTextureAsync(u,z,O,s,void 0,!G._textureInfo.nonColorData);return this.logClose(),m}_createTextureAsync(u,G,s){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},O=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;const f=this._loadSampler(`/samplers/${G.index}`,G),C=new Array,x=new T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g={noMipmap:f.noMipMaps,invertY:!1,samplingMode:f.samplingMode,X:()=>{this._disposed||x.resolve()},onError:(G,s)=>{this._disposed||x.reject(new Error(`${u}: ${s&&s.message?s.message:G||"Failed to load texture"}`))},mimeType:s.mimeType,loaderOptions:O,useSRGBBuffer:!!m&&this._parent.useSRGBBuffers},b=new d.b(null,this._babylonScene,g);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(x.promise),C.push(this.loadImageAsync(`/images/${s.index}`,s).then((u=>{const G=s.uri||`${this._fileName}#image${s.index}`,T=`data:${this._uniqueRootUrl}${G}`;b.updateURL(T,u);const z=b.getInternalTexture();z&&(z.label=s.name)}))),b.wrapU=f.wrapU,b.wrapV=f.wrapV,z(b),this._parent.useGltfTextureNames&&(b.name=s.name||s.uri||`image${s.index}`),Promise.all(C).then((()=>b))}_loadSampler(u,G){return G._data||(G._data={noMipMaps:9728===G.minFilter||9729===G.minFilter,samplingMode:t._GetTextureSamplingMode(u,G),wrapU:t._GetTextureWrapMode(`${u}/wrapS`,G.wrapS),wrapV:t._GetTextureWrapMode(`${u}/wrapT`,G.wrapT)}),G._data}loadImageAsync(u,G){if(!G._data){if(this.logOpen(`${u} ${G.name||""}`),G.uri)G._data=this.loadUriAsync(`${u}/uri`,G,G.uri);else{const s=Z.Get(`${u}/bufferView`,this._gltf.bufferViews,G.bufferView);G._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}this.logClose()}return G._data}loadUriAsync(u,G,s){const T=this._extensionsLoadUriAsync(u,G,s);if(T)return T;if(!t._ValidateUri(s))throw new Error(`${u}: '${s}' is invalid`);if((0,S.f)(s)){const G=new Uint8Array((0,S.c)(s));return this.log(`${u}: Decoded ${s.substring(0,64)}... (${G.length} bytes)`),Promise.resolve(G)}return this.log(`${u}: Loading ${s}`),this._parent.preprocessUrlAsync(this._rootUrl+s).then((G=>new Promise(((T,z)=>{this._parent._loadFile(this._babylonScene,G,(G=>{this._disposed||(this.log(`${u}: Loaded ${s} (${G.byteLength} bytes)`),T(new Uint8Array(G)))}),!0,(G=>{z(new S.i(`${u}: Failed to load '${s}'${G?": "+G.status+" "+G.statusText:""}`,G))}))}))))}static AddPointerMetadata(u,G){u.metadata=u.metadata||{};const s=u._internalMetadata=u._internalMetadata||{},T=s.Ei=s.Ei||{};(T.pointers=T.pointers||[]).push(G)}static _GetTextureWrapMode(u,G){switch(G=void 0==G?10497:G){case 33071:return d.b.CLAMP_ADDRESSMODE;case 33648:return d.b.MIRROR_ADDRESSMODE;case 10497:return d.b.WRAP_ADDRESSMODE;default:return V.d.Warn(`${u}: Invalid value (${G})`),d.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(u,G){const s=void 0==G.magFilter?9729:G.magFilter,T=void 0==G.minFilter?9987:G.minFilter;if(9729===s)switch(T){case 9728:return d.b.LINEAR_NEAREST;case 9729:return d.b.LINEAR_LINEAR;case 9984:return d.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return d.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return d.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return d.b.LINEAR_LINEAR_MIPLINEAR;default:return V.d.Warn(`${u}/minFilter: Invalid value (${T})`),d.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==s&&V.d.Warn(`${u}/magFilter: Invalid value (${s})`),T){case 9728:return d.b.NEAREST_NEAREST;case 9729:return d.b.NEAREST_LINEAR;case 9984:return d.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return d.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return d.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return d.b.NEAREST_LINEAR_MIPLINEAR;default:return V.d.Warn(`${u}/minFilter: Invalid value (${T})`),d.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(u,G){switch(G){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${u}: Invalid component type ${G}`)}}static _GetTypedArray(u,G,s,T,z){const O=s.buffer;T=s.byteOffset+(T||0);const m=t._GetTypedArrayConstructor(`${u}/componentType`,G),f=W.f.GetTypeByteLength(G);return T%f!==0?(V.d.Warn(`${u}: Copying buffer as byte offset (${T}) is not a multiple of component type byte length (${f})`),new m(O.slice(T,T+z*f),0)):new m(O,T,z)}static _GetNumComponents(u,G){switch(G){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${u}: Invalid type (${G})`)}static _ValidateUri(u){return m.e.IsBase64(u)||-1===u.indexOf("..")}static _GetDrawMode(u,G){switch(void 0==G&&(G=4),G){case 0:return c.d.PointListDrawMode;case 1:return c.d.LineListDrawMode;case 2:return c.d.LineLoopDrawMode;case 3:return c.d.LineStripDrawMode;case 4:return c.d.TriangleFillMode;case 5:return c.d.TriangleStripDrawMode;case 6:return c.d.TriangleFanDrawMode}throw new Error(`${u}: Invalid mesh primitive mode (${G})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const u=new Array;if(this._gltf.materials)for(const G of this._gltf.materials)if(G._data)for(const s in G._data){const T=G._data[s];for(const G of T.babylonMeshes){G.Gj(!0);const s=T.babylonMaterial;u.push(s.forceCompilationAsync(G)),u.push(s.forceCompilationAsync(G,{useInstances:!0})),this._parent.useClipPlane&&(u.push(s.forceCompilationAsync(G,{clipPlane:!0})),u.push(s.forceCompilationAsync(G,{clipPlane:!0,useInstances:!0})))}}return Promise.all(u).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const u=new Array,G=this._babylonScene.lights;for(const s of G){const G=s.getShadowGenerator();G&&u.push(G.forceCompilationAsync())}return Promise.all(u).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(u){for(const G of this._extensions)G.enabled&&u(G)}_applyExtensions(u,G,s){for(const T of this._extensions)if(T.enabled){const z=`${T.name}.${G}`,O=u;O._activeLoaderExtensionFunctions=O._activeLoaderExtensionFunctions||{};const m=O._activeLoaderExtensionFunctions;if(!m[z]){m[z]=!0;try{const u=s(T);if(u)return u}finally{delete m[z]}}}return null}_extensionsOnLoading(){this._forEachExtensions((u=>u.onLoading&&u.onLoading()))}_extensionsOnReady(){this._forEachExtensions((u=>u.onReady&&u.onReady()))}_extensionsLoadSceneAsync(u,G){return this._applyExtensions(G,"loadScene",(s=>s.loadSceneAsync&&s.loadSceneAsync(u,G)))}_extensionsLoadNodeAsync(u,G,s){return this._applyExtensions(G,"loadNode",(T=>T.loadNodeAsync&&T.loadNodeAsync(u,G,s)))}_extensionsLoadCameraAsync(u,G,s){return this._applyExtensions(G,"loadCamera",(T=>T.loadCameraAsync&&T.loadCameraAsync(u,G,s)))}_extensionsLoadVertexDataAsync(u,G,s){return this._applyExtensions(G,"loadVertexData",(T=>T._loadVertexDataAsync&&T._loadVertexDataAsync(u,G,s)))}_extensionsLoadMeshPrimitiveAsync(u,G,s,T,z,O){return this._applyExtensions(z,"loadMeshPrimitive",(m=>m._loadMeshPrimitiveAsync&&m._loadMeshPrimitiveAsync(u,G,s,T,z,O)))}_extensionsLoadMaterialAsync(u,G,s,T,z){return this._applyExtensions(G,"loadMaterial",(O=>O._loadMaterialAsync&&O._loadMaterialAsync(u,G,s,T,z)))}_extensionsCreateMaterial(u,G,s){return this._applyExtensions(G,"createMaterial",(T=>T.createMaterial&&T.createMaterial(u,G,s)))}_extensionsLoadMaterialPropertiesAsync(u,G,s){return this._applyExtensions(G,"loadMaterialProperties",(T=>T.loadMaterialPropertiesAsync&&T.loadMaterialPropertiesAsync(u,G,s)))}_extensionsLoadTextureInfoAsync(u,G,s){return this._applyExtensions(G,"loadTextureInfo",(T=>T.loadTextureInfoAsync&&T.loadTextureInfoAsync(u,G,s)))}_extensionsLoadTextureAsync(u,G,s){return this._applyExtensions(G,"loadTexture",(T=>T._loadTextureAsync&&T._loadTextureAsync(u,G,s)))}_extensionsLoadAnimationAsync(u,G){return this._applyExtensions(G,"loadAnimation",(s=>s.loadAnimationAsync&&s.loadAnimationAsync(u,G)))}_extensionsLoadAnimationChannelAsync(u,G,s,T,z){return this._applyExtensions(s,"loadAnimationChannel",(O=>O._loadAnimationChannelAsync&&O._loadAnimationChannelAsync(u,G,s,T,z)))}_extensionsLoadSkinAsync(u,G,s){return this._applyExtensions(s,"loadSkin",(T=>T._loadSkinAsync&&T._loadSkinAsync(u,G,s)))}_extensionsLoadUriAsync(u,G,s){return this._applyExtensions(G,"loadUri",(T=>T._loadUriAsync&&T._loadUriAsync(u,G,s)))}_extensionsLoadBufferViewAsync(u,G){return this._applyExtensions(G,"loadBufferView",(s=>s.loadBufferViewAsync&&s.loadBufferViewAsync(u,G)))}_extensionsLoadBufferAsync(u,G,s,T){return this._applyExtensions(G,"loadBuffer",(z=>z.loadBufferAsync&&z.loadBufferAsync(u,G,s,T)))}static LoadExtensionAsync(u,G,s,T){if(!G.extensions)return null;const z=G.extensions[s];return z?T(`${u}/extensions/${s}`,z):null}static LoadExtraAsync(u,G,s,T){if(!G.extras)return null;const z=G.extras[s];return z?T(`${u}/extras/${s}`,z):null}isExtensionUsed(u){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(u)}logOpen(u){this._parent._logOpen(u)}logClose(){this._parent._logClose()}log(u){this._parent._log(u)}startPerformanceCounter(u){this._parent._startPerformanceCounter(u)}endPerformanceCounter(u){this._parent._endPerformanceCounter(u)}}t.DefaultSampler={index:-1},L.e._CreateGLTF2Loader=u=>new t(u);var E=s(11378),U=s(11900),uu=s(11911);class Gu extends uu.d{constructor(u,G,s){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",u),this._texture=u.getEngine().createRawCubeTexture(G,s,T,z,O,m,f,C)}update(u,G,s,T){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,u,G,s,T,z)}updateRGBDAsync(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,U.h)(this._texture,u,G,s,T).then((()=>{}))}clone(){return p.e.Clone((()=>{const u=this.va(),G=this._texture,s=new Gu(u,G._bufferViewArray,G.width,G.format,G.type,G.generateMipMaps,G.invertY,G.samplingMode,G._compression);return 13===G.source&&s.updateRGBDAsync(G._bufferViewArrayArray,G._sphericalPolynomial,G._lodGenerationScale,G._lodGenerationOffset),s}),this)}}const su="EXT_lights_image_based";class Tu{constructor(u){this.name=su,this._loader=u,this.enabled=this._loader.isExtensionUsed(su)}dispose(){this._loader=null,delete this._lights}onLoading(){const u=this._loader.Ei.extensions;if(u&&u[this.name]){const G=u[this.name];this._lights=G.lights}}loadSceneAsync(u,G){return t.LoadExtensionAsync(u,G,this.name,((s,T)=>{this._loader._allMaterialsDirtyRequired=!0;const z=new Array;z.push(this._loader.loadSceneAsync(u,G)),this._loader.logOpen(`${s}`);const O=Z.Get(`${s}/light`,this._lights,T.fb);return z.push(this._loadLightAsync(`/extensions/${this.name}/lights/${T.fb}`,O).then((u=>{this._loader.babylonScene.environmentTexture=u}))),this._loader.logClose(),Promise.all(z).then((()=>{}))}))}_loadLightAsync(u,G){if(!G._loaded){const s=new Array;this._loader.logOpen(`${u}`);const T=new Array(G.specularImages.length);for(let z=0;z<G.specularImages.length;z++){const O=G.specularImages[z];T[z]=new Array(O.length);for(let G=0;G<O.length;G++){const m=`${u}/specularImages/${z}/${G}`;this._loader.logOpen(`${m}`);const f=O[G],C=Z.Get(m,this._loader.Ei.images,f);s.push(this._loader.loadImageAsync(`/images/${f}`,C).then((u=>{T[z][G]=u}))),this._loader.logClose()}}this._loader.logClose(),G._loaded=Promise.all(s).then((()=>{const s=new Gu(this._loader.babylonScene,null,G.specularImageSize);if(s.name=G.name||"environment",G._babylonTexture=s,void 0!=G.Qi&&(s.level=G.Qi),G.rotation){let u=z.h.Ag(G.rotation);this._loader.babylonScene.useRightHandedSystem||(u=z.h.Inverse(u)),z.d.FromQuaternionToRef(u,s.getReflectionTextureMatrix())}if(!G.irradianceCoefficients)throw new Error(`${u}: Irradiance coefficients are missing`);const O=E.e.Ag(G.irradianceCoefficients);O.scaleInPlace(G.Qi),O.convertIrradianceToLambertianRadiance();const m=E.h.FromHarmonics(O),f=(T.length-1)/Math.log2(G.specularImageSize);return s.updateRGBDAsync(T,m,f)}))}return G._loaded.then((()=>G._babylonTexture))}}a(su),y(su,!0,(u=>new Tu(u)));s(11917);const zu="EXT_mesh_gpu_instancing";class Ou{constructor(u){this.name=zu,this._loader=u,this.enabled=this._loader.isExtensionUsed(zu)}dispose(){this._loader=null}loadNodeAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((u,T)=>{this._loader._disableInstancedMesh++;const O=this._loader.loadNodeAsync(`/nodes/${G.index}`,G,s);if(this._loader._disableInstancedMesh--,!G._primitiveBabylonMeshes)return O;const m=new Array;let f=0;const C=G=>{if(void 0==T.attributes[G])return void m.push(Promise.resolve(null));const s=Z.Get(`${u}/attributes/${G}`,this._loader.Ei.accessors,T.attributes[G]);if(m.push(this._loader._loadFloatAccessorAsync(`/accessors/${s.bufferView}`,s)),0===f)f=s.count;else if(f!==s.count)throw new Error(`${u}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),O.then((u=>Promise.all(m).then((s=>{let[T,O,m]=s;const C=new Float32Array(16*f);z.l.gb[0].hf(0,0,0),z.l.Quaternion[0].hf(0,0,0,1),z.l.gb[1].hf(1,1,1);for(let u=0;u<f;++u)T&&z.q.FromArrayToRef(T,3*u,z.l.gb[0]),O&&z.h.FromArrayToRef(O,4*u,z.l.Quaternion[0]),m&&z.q.FromArrayToRef(m,3*u,z.l.gb[1]),z.d.ComposeToRef(z.l.gb[1],z.l.Quaternion[0],z.l.gb[0],z.l.Matrix[0]),z.l.Matrix[0].copyToArray(C,16*u);for(const u of G._primitiveBabylonMeshes)u.Kj("matrix",C,16,!0);return u}))))}))}}a(zu),y(zu,!0,(u=>new Ou(u)));class mu{static get Default(){return mu._Default||(mu._Default=new mu),mu._Default}constructor(){const u=mu.Configuration.decoder;this._decoderModulePromise=m.e.LoadBabylonScriptAsync(u.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(u,G,s,T,z){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const O=await MeshoptDecoder.decodeGltfBufferAsync(G,s,u,T,z);return MeshoptDecoder.useWorkers(0),O}))}}mu.Configuration={decoder:{url:`${m.e._DefaultCdnUrl}/meshopt_decoder.js`}},mu._Default=null;const fu="EXT_meshopt_compression";class Cu{constructor(u){this.name=fu,this.enabled=u.isExtensionUsed(fu),this._loader=u}dispose(){this._loader=null}loadBufferViewAsync(u,G){return t.LoadExtensionAsync(u,G,this.name,((s,T)=>{const z=G;if(z._meshOptData)return z._meshOptData;const O=Z.Get(`${u}/buffer`,this._loader.Ei.buffers,T.buffer);return z._meshOptData=this._loader.loadBufferAsync(`/buffers/${O.index}`,O,T.byteOffset||0,T.byteLength).then((u=>mu.Default.decodeGltfBufferAsync(u,T.count,T.byteStride,T.mode,T.filter))),z._meshOptData}))}}a(fu),y(fu,!0,(u=>new Cu(u)));const xu="EXT_texture_webp";class gu{constructor(u){this.name=xu,this._loader=u,this.enabled=u.isExtensionUsed(xu)}dispose(){this._loader=null}_loadTextureAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=void 0==G.sampler?t.DefaultSampler:Z.Get(`${u}/sampler`,this._loader.Ei.samplers,G.sampler),m=Z.Get(`${T}/source`,this._loader.Ei.images,z.source);return this._loader._createTextureAsync(u,O,m,(u=>{s(u)}),void 0,!G._textureInfo.nonColorData)}))}}a(xu),y(xu,!0,(u=>new gu(u)));const bu="EXT_texture_avif";class Qu{constructor(u){this.name=bu,this._loader=u,this.enabled=u.isExtensionUsed(bu)}dispose(){this._loader=null}_loadTextureAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=void 0==G.sampler?t.DefaultSampler:Z.Get(`${u}/sampler`,this._loader.Ei.samplers,G.sampler),m=Z.Get(`${T}/source`,this._loader.Ei.images,z.source);return this._loader._createTextureAsync(u,O,m,(u=>{s(u)}),void 0,!G._textureInfo.nonColorData)}))}}a(bu),y(bu,!0,(u=>new Qu(u)));var Yu=s(11924);const nu="KHR_draco_mesh_compression";class Vu{constructor(u){this.name=nu,this.useNormalizedFlagFromAccessor=!0,this._loader=u,this.enabled=Yu.c.DecoderAvailable&&this._loader.isExtensionUsed(nu)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{if(void 0!=G.mode&&4!==G.mode&&5!==G.mode)throw new Error(`${u}: Unsupported mode ${G.mode}`);const O={},m={},f=(u,T)=>{const f=z.attributes[u];if(void 0!=f&&(s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(T)&&s._delayInfo.push(T),O[T]=f,this.useNormalizedFlagFromAccessor)){const s=Z.TryGet(this._loader.Ei.accessors,G.attributes[u]);s&&(m[T]=s.normalized||!1)}};f("POSITION",W.f.PositionKind),f("NORMAL",W.f.NormalKind),f("TANGENT",W.f.TangentKind),f("TEXCOORD_0",W.f.UVKind),f("TEXCOORD_1",W.f.UV2Kind),f("TEXCOORD_2",W.f.UV3Kind),f("TEXCOORD_3",W.f.UV4Kind),f("TEXCOORD_4",W.f.UV5Kind),f("TEXCOORD_5",W.f.UV6Kind),f("JOINTS_0",W.f.MatricesIndicesKind),f("WEIGHTS_0",W.f.MatricesWeightsKind),f("COLOR_0",W.f.ColorKind);const C=Z.Get(T,this._loader.Ei.bufferViews,z.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((G=>(this.dracoCompression||Yu.c.Default)._decodeMeshToGeometryForGltfAsync(s.name,this._loader.babylonScene,G,O,m).catch((G=>{throw new Error(`${u}: ${G.message}`)}))))),C._dracoBabylonGeometry}))}}a(nu),y(nu,!0,(u=>new Vu(u)));var Fu=s(11936),ru=s(11161),cu=s(11890),ju=s(11938);ru.b.AddNodeConstructor("Light_Type_0",((u,G)=>()=>new lu(u,z.q.Zero(),G)));class lu extends ju.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(u){this._shadowAngle=u,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(u){const G=this.needCube();if(this._direction=u,this.needCube()!==G&&this._shadowGenerators){const u=this._shadowGenerators.values();for(let G=u.next();!0!==G.done;G=u.next()){G.value.recreateShadowMap()}}}constructor(u,G,s){super(u,s),this._shadowAngle=Math.PI/2,this.position=G}getClassName(){return"PointLight"}getTypeID(){return cu.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(u){if(this.direction)return super.getShadowDirection(u);switch(u){case 0:return new z.q(1,0,0);case 1:return new z.q(-1,0,0);case 2:return new z.q(0,-1,0);case 3:return new z.q(0,1,0);case 4:return new z.q(0,0,1);case 5:return new z.q(0,0,-1)}return z.q.Zero()}_setDefaultShadowProjectionMatrix(u,G,s){const T=this.va().activeCamera;if(!T)return;const O=void 0!==this.shadowMinZ?this.shadowMinZ:T.Mi,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,f=this.va().getEngine().useReverseDepthBuffer;z.d.PerspectiveFovLHToRef(this.shadowAngle,1,f?m:O,f?O:m,u,!0,this._scene.getEngine().isNDCHalfZRange,void 0,f)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(u,G){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,G):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,G),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,G),this}transferToNodeMaterialEffect(u,G){return this.computeTransformedInformation()?u.setFloat3(G,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):u.setFloat3(G,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(u,G){u["POINTLIGHT"+G]=!0}}(0,j.b)([(0,l.M)()],lu.prototype,"shadowAngle",null),(0,X.g)("BABYLON.PointLight",lu),ru.b.AddNodeConstructor("Light_Type_2",((u,G)=>()=>new Pu(u,z.q.Zero(),z.q.Zero(),0,0,G)));class Pu extends ju.e{get angle(){return this._angle}set angle(u){this._angle=u,this._cosHalfAngle=Math.cos(.5*u),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(u){this._innerAngle=u,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(u){this._shadowAngleScale=u,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(u){this._projectionTextureLightNear=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(u){this._projectionTextureLightFar=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(u){this._projectionTextureUpDirection=u,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(u){this._projectionTexture!==u&&(this._projectionTexture=u,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Pu._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Pu._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(u){return void 0!==u.onGeneratedObservable}static _IsTexture(u){return void 0!==u.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(u){this._projectionTextureProjectionLightMatrix=u,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(u,G,s,T,O,m){super(u,m),this._innerAngle=0,this._projectionTextureMatrix=z.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=z.q.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=z.q.Zero(),this._projectionTextureViewLightMatrix=z.d.Zero(),this._projectionTextureProjectionLightMatrix=z.d.Zero(),this._projectionTextureScalingMatrix=z.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=G,this.direction=s,this.angle=T,this.exponent=O}getClassName(){return"SpotLight"}getTypeID(){return cu.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(u){super._setDirection(u),this._projectionTextureViewLightDirty=!0}_setPosition(u){super._setPosition(u),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(u,G,s){const T=this.va().activeCamera;if(!T)return;this._shadowAngleScale=this._shadowAngleScale||1;const O=this._shadowAngleScale*this._angle,m=void 0!==this.shadowMinZ?this.shadowMinZ:T.Mi,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,C=this.va().getEngine().useReverseDepthBuffer;z.d.PerspectiveFovLHToRef(O,1,C?f:m,C?m:f,u,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),z.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const u=this.projectionTextureLightFar,G=this.projectionTextureLightNear,s=u/(u-G),T=-s*G,O=1/Math.tan(this._angle/2);z.d.FromValuesToRef(O/1,0,0,0,0,O,0,0,0,0,s,1,0,0,T,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof d.b){const u=this._projectionTexture.uScale/2,G=this._projectionTexture.vScale/2;z.d.FromValuesToRef(u,0,0,0,0,G,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(u,G){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),u.setMatrix("textureProjectionMatrix"+G,this._projectionTextureMatrix),u.setTexture("projectionLightTexture"+G,this.projectionTexture)),this}transferToEffect(u,G){let s;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,G),s=z.q.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,G),s=z.q.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",s.x,s.y,s.z,this._cosHalfAngle,G),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,G),this}transferToNodeMaterialEffect(u,G){let s;return s=this.computeTransformedInformation()?z.q.Normalize(this.transformedDirection):z.q.Normalize(this.direction),this.va().useRightHandedSystem?u.setFloat3(G,-s.x,-s.y,-s.z):u.setFloat3(G,s.x,s.y,s.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(u){const G=this._scene.getEngine(),s=void 0!==this.shadowMinZ?this.shadowMinZ:u.Mi;return G.useReverseDepthBuffer&&G.isNDCHalfZRange?s:this._scene.getEngine().isNDCHalfZRange?0:s}getDepthMaxZ(u){const G=this._scene.getEngine(),s=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ;return G.useReverseDepthBuffer&&G.isNDCHalfZRange?0:s}prepareLightSpecificDefines(u,G){u["SPOTLIGHT"+G]=!0,u["PROJECTEDLIGHTTEXTURE"+G]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,j.b)([(0,l.M)()],Pu.prototype,"angle",null),(0,j.b)([(0,l.M)()],Pu.prototype,"innerAngle",null),(0,j.b)([(0,l.M)()],Pu.prototype,"shadowAngleScale",null),(0,j.b)([(0,l.M)()],Pu.prototype,"exponent",void 0),(0,j.b)([(0,l.M)()],Pu.prototype,"projectionTextureLightNear",null),(0,j.b)([(0,l.M)()],Pu.prototype,"projectionTextureLightFar",null),(0,j.b)([(0,l.M)()],Pu.prototype,"projectionTextureUpDirection",null),(0,j.b)([(0,l.D)("projectedLightTexture")],Pu.prototype,"_projectionTexture",void 0),(0,X.g)("BABYLON.SpotLight",Pu);const Hu="KHR_lights_punctual";class Xu{constructor(u){this.name=Hu,this._loader=u,this.enabled=this._loader.isExtensionUsed(Hu)}dispose(){this._loader=null,delete this._lights}onLoading(){const u=this._loader.Ei.extensions;if(u&&u[this.name]){const G=u[this.name];this._lights=G.lights,Z.Assign(this._lights)}}loadNodeAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,m)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(u,G,(u=>{let G;const f=Z.Get(T,this._lights,m.fb),C=f.name||u.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,f.type){case"directional":{const u=new Fu.d(C,z.q.Backward(),this._loader.babylonScene);u.position.vj(0),G=u;break}case"point":G=new lu(C,z.q.Zero(),this._loader.babylonScene);break;case"spot":{const u=new Pu(C,z.q.Zero(),z.q.Backward(),0,1,this._loader.babylonScene);u.angle=2*(f.spot&&f.spot.outerConeAngle||Math.PI/4),u.innerAngle=2*(f.spot&&f.spot.innerConeAngle||0),G=u;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${T}: Invalid light type (${f.type})`)}G._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,f._babylonLight=G,G.falloffType=cu.e.FALLOFF_GLTF,G.$g=f.color?O.b.Ag(f.color):O.b.White(),G.Qi=void 0==f.Qi?1:f.Qi,G.range=void 0==f.range?Number.MAX_VALUE:f.range,G.parent=u,this._loader._babylonLights.push(G),t.AddPointerMetadata(G,T),s(u)})))))}}a(Hu),y(Hu,!0,(u=>new Xu(u)));const pu="KHR_materials_pbrSpecularGlossiness";class qu{constructor(u){this.name=pu,this.order=200,this._loader=u,this.enabled=this._loader.isExtensionUsed(pu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialBasePropertiesAsync(u,G,s)),O.push(this._loadSpecularGlossinessPropertiesAsync(T,z,s)),this._loader.loadMaterialAlphaProperties(u,G,s),Promise.all(O).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.metallic=null,s.roughness=null,G.diffuseFactor?(s.albedoColor=O.b.Ag(G.diffuseFactor),s.alpha=G.diffuseFactor[3]):s.albedoColor=O.b.White(),s.reflectivityColor=G.specularFactor?O.b.Ag(G.specularFactor):O.b.White(),s.microSurface=void 0==G.glossinessFactor?1:G.glossinessFactor,G.diffuseTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTexture`,G.diffuseTexture,(u=>{u.name=`${s.name} (Diffuse)`,s.albedoTexture=u}))),G.specularGlossinessTexture&&(T.push(this._loader.loadTextureInfoAsync(`${u}/specularGlossinessTexture`,G.specularGlossinessTexture,(u=>{u.name=`${s.name} (Specular Glossiness)`,s.reflectivityTexture=u,s.reflectivityTexture.nc=!0}))),s.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(T).then((()=>{}))}}a(pu),y(pu,!0,(u=>new qu(u)));const du="KHR_materials_unlit";class vu{constructor(u){this.name=du,this.order=210,this._loader=u,this.enabled=this._loader.isExtensionUsed(du)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,(()=>this._loadUnlitPropertiesAsync(u,G,s)))}_loadUnlitPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;s.unlit=!0;const z=G.pbrMetallicRoughness;return z&&(z.baseColorFactor?(s.albedoColor=O.b.Ag(z.baseColorFactor),s.alpha=z.baseColorFactor[3]):s.albedoColor=O.b.White(),z.baseColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/baseColorTexture`,z.baseColorTexture,(u=>{u.name=`${s.name} (Base Color)`,s.albedoTexture=u})))),G.doubleSided&&(s.Ig=!1,s.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(u,G,s),Promise.all(T).then((()=>{}))}}a(du),y(du,!0,(u=>new vu(u)));const Wu="KHR_materials_clearcoat";class Mu{constructor(u){this.name=Wu,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(Wu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadClearCoatPropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadClearCoatPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.clearCoat.isEnabled=!0,s.clearCoat.useRoughnessFromMainTexture=!1,s.clearCoat.remapF0OnInterfaceChange=!1,void 0!=G.clearcoatFactor?s.clearCoat.Qi=G.clearcoatFactor:s.clearCoat.Qi=0,G.clearcoatTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatTexture`,G.clearcoatTexture,(u=>{u.name=`${s.name} (ClearCoat)`,s.clearCoat.texture=u}))),void 0!=G.clearcoatRoughnessFactor?s.clearCoat.roughness=G.clearcoatRoughnessFactor:s.clearCoat.roughness=0,G.clearcoatRoughnessTexture&&(G.clearcoatRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatRoughnessTexture`,G.clearcoatRoughnessTexture,(u=>{u.name=`${s.name} (ClearCoat Roughness)`,s.clearCoat.textureRoughness=u})))),G.clearcoatNormalTexture&&(G.clearcoatNormalTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${u}/clearcoatNormalTexture`,G.clearcoatNormalTexture,(u=>{u.name=`${s.name} (ClearCoat Normal)`,s.clearCoat.bumpTexture=u}))),s.invertNormalMapX=!s.va().useRightHandedSystem,s.invertNormalMapY=s.va().useRightHandedSystem,void 0!=G.clearcoatNormalTexture.scale&&(s.clearCoat.bumpTexture.level=G.clearcoatNormalTexture.scale)),Promise.all(T).then((()=>{}))}}a(Wu),y(Wu,!0,(u=>new Mu(u)));const ou="KHR_materials_iridescence";class Ru{constructor(u){this.name=ou,this.order=195,this._loader=u,this.enabled=this._loader.isExtensionUsed(ou)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadIridescencePropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadIridescencePropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.iridescence.isEnabled=!0,s.iridescence.Qi=G.iridescenceFactor??0,s.iridescence.indexOfRefraction=G.iridescenceIor??G.iridescenceIOR??1.3,s.iridescence.minimumThickness=G.iridescenceThicknessMinimum??100,s.iridescence.maximumThickness=G.iridescenceThicknessMaximum??400,G.iridescenceTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/iridescenceTexture`,G.iridescenceTexture,(u=>{u.name=`${s.name} (Iridescence)`,s.iridescence.texture=u}))),G.iridescenceThicknessTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/iridescenceThicknessTexture`,G.iridescenceThicknessTexture,(u=>{u.name=`${s.name} (Iridescence Thickness)`,s.iridescence.thicknessTexture=u}))),Promise.all(T).then((()=>{}))}}a(ou),y(ou,!0,(u=>new Ru(u)));const Bu="KHR_materials_anisotropy";class Du{constructor(u){this.name=Bu,this.order=195,this._loader=u,this.enabled=this._loader.isExtensionUsed(Bu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadIridescencePropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadIridescencePropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.anisotropy.isEnabled=!0,s.anisotropy.Qi=G.anisotropyStrength??0,s.anisotropy.angle=G.anisotropyRotation??0,G.anisotropyTexture&&(G.anisotropyTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${u}/anisotropyTexture`,G.anisotropyTexture,(u=>{u.name=`${s.name} (Anisotropy Intensity)`,s.anisotropy.texture=u})))),Promise.all(T).then((()=>{}))}}a(Bu),y(Bu,!0,(u=>new Du(u)));const ku="KHR_materials_emissive_strength";class wu{constructor(u){this.name=ku,this.order=170,this._loader=u,this.enabled=this._loader.isExtensionUsed(ku)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>this._loader.loadMaterialPropertiesAsync(u,G,s).then((()=>{this._loadEmissiveProperties(T,z,s)}))))}_loadEmissiveProperties(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);void 0!==G.emissiveStrength&&(s.emissiveIntensity=G.emissiveStrength)}}a(ku),y(ku,!0,(u=>new wu(u)));const Lu="KHR_materials_sheen";class Su{constructor(u){this.name=Lu,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(Lu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadSheenPropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadSheenPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return s.sheen.isEnabled=!0,s.sheen.Qi=1,void 0!=G.sheenColorFactor?s.sheen.color=O.b.Ag(G.sheenColorFactor):s.sheen.color=O.b.Black(),G.sheenColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/sheenColorTexture`,G.sheenColorTexture,(u=>{u.name=`${s.name} (Sheen Color)`,s.sheen.texture=u}))),void 0!==G.sheenRoughnessFactor?s.sheen.roughness=G.sheenRoughnessFactor:s.sheen.roughness=0,G.sheenRoughnessTexture&&(G.sheenRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${u}/sheenRoughnessTexture`,G.sheenRoughnessTexture,(u=>{u.name=`${s.name} (Sheen Roughness)`,s.sheen.textureRoughness=u})))),s.sheen.albedoScaling=!0,s.sheen.useRoughnessFromMainTexture=!1,Promise.all(T).then((()=>{}))}}a(Lu),y(Lu,!0,(u=>new Su(u)));const eu="KHR_materials_specular";class hu{constructor(u){this.name=eu,this.order=190,this._loader=u,this.enabled=this._loader.isExtensionUsed(eu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadSpecularPropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadSpecularPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const T=new Array;return void 0!==G.specularFactor&&(s.metallicF0Factor=G.specularFactor),void 0!==G.specularColorFactor&&(s.metallicReflectanceColor=O.b.Ag(G.specularColorFactor)),G.specularTexture&&(G.specularTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${u}/specularTexture`,G.specularTexture,(u=>{u.name=`${s.name} (Specular)`,s.metallicReflectanceTexture=u,s.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),G.specularColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${u}/specularColorTexture`,G.specularColorTexture,(u=>{u.name=`${s.name} (Specular Color)`,s.reflectanceTexture=u}))),Promise.all(T).then((()=>{}))}}a(eu),y(eu,!0,(u=>new hu(u)));const Iu="KHR_materials_ior";class iu{constructor(u){this.name=Iu,this.order=180,this._loader=u,this.enabled=this._loader.isExtensionUsed(Iu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadIorPropertiesAsync(T,z,s)),Promise.all(O).then((()=>{}))}))}_loadIorPropertiesAsync(u,G,s){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);return void 0!==G.ior?s.indexOfRefraction=G.ior:s.indexOfRefraction=iu._DEFAULT_IOR,Promise.resolve()}}iu._DEFAULT_IOR=1.5,a(Iu),y(Iu,!0,(u=>new iu(u)));const Ju="KHR_materials_variants";class Au{constructor(u){this.name=Ju,this._loader=u,this.enabled=this._loader.isExtensionUsed(Ju)}dispose(){this._loader=null}static GetAvailableVariants(u){const G=this._GetExtensionMetadata(u);return G?Object.keys(G.variants):[]}getAvailableVariants(u){return Au.GetAvailableVariants(u)}static SelectVariant(u,G){const s=this._GetExtensionMetadata(u);if(!s)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Ju} extension`);const T=u=>{const G=s.variants[u];if(G)for(const s of G)s.mesh.material=s.material};if(G instanceof Array)for(const z of G)T(z);else T(G);s.lastSelected=G}selectVariant(u,G){Au.SelectVariant(u,G)}static Reset(u){const G=this._GetExtensionMetadata(u);if(!G)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Ju} extension`);for(const s of G.original)s.mesh.material=s.material;G.lastSelected=null}reset(u){Au.Reset(u)}static GetLastSelectedVariant(u){const G=this._GetExtensionMetadata(u);if(!G)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Ju} extension`);return G.lastSelected}getLastSelectedVariant(u){return Au.GetLastSelectedVariant(u)}static _GetExtensionMetadata(u){var G,s;return(null===u||void 0===u||null===(G=u._internalMetadata)||void 0===G||null===(s=G.Ei)||void 0===s?void 0:s[Ju])||null}onLoading(){const u=this._loader.Ei.extensions;if(u&&u[this.name]){const G=u[this.name];this._variants=G.variants}}_loadMeshPrimitiveAsync(u,G,s,T,z,O){return t.LoadExtensionAsync(u,z,this.name,((m,f)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(u,G,s,T,z,(G=>{if(O(G),G instanceof R.c){const s=t._GetDrawMode(u,z.mode),T=this._loader.rootBabylonMesh,O=T?T._internalMetadata=T._internalMetadata||{}:{},x=O.Ei=O.Ei||{},g=x[Ju]=x[Ju]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:G,material:G.material});for(let u=0;u<f.mappings.length;++u){const z=f.mappings[u],O=Z.Get(`${m}/mappings/${u}/material`,this._loader.Ei.materials,z.material);C.push(this._loader._loadMaterialAsync(`#/materials/${z.material}`,O,G,s,(u=>{for(let s=0;s<z.variants.length;++s){const O=z.variants[s],m=Z.Get(`/extensions/${Ju}/variants/${O}`,this._variants,O);g.variants[m.name]=g.variants[m.name]||[],g.variants[m.name].push({mesh:G,material:u}),G.onClonedObservable.add((u=>{const s=u;let z=null,O=s;do{if(O=O.parent,!O)return;z=Au._GetExtensionMetadata(O)}while(null===z);if(T&&z===Au._GetExtensionMetadata(T)){O._internalMetadata={};for(const u in T._internalMetadata)O._internalMetadata[u]=T._internalMetadata[u];O._internalMetadata.Ei=[];for(const u in T._internalMetadata.Ei)O._internalMetadata.Ei[u]=T._internalMetadata.Ei[u];O._internalMetadata.Ei[Ju]={lastSelected:null,original:[],variants:{}};for(const u of z.original)O._internalMetadata.Ei[Ju].original.push({mesh:u.mesh,material:u.material});for(const u in z.variants)if(Object.prototype.hasOwnProperty.call(z.variants,u)){O._internalMetadata.Ei[Ju].variants[u]=[];for(const G of z.variants[u])O._internalMetadata.Ei[Ju].variants[u].push({mesh:G.mesh,material:G.material})}z=O._internalMetadata.Ei[Ju]}for(const T of z.original)T.mesh===G&&(T.mesh=s);for(const T of z.variants[m.name])T.mesh===G&&(T.mesh=s)}))}})))}}}))),Promise.all(C).then((u=>{let[G]=u;return G}))}))}}a(Ju),y(Ju,!0,(u=>new Au(u)));var Nu=s(11407);class yu{}yu.AUTOSAMPLERSUFFIX="Sampler",yu.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",yu.ALPHA_DISABLE=0,yu.ALPHA_ADD=1,yu.ALPHA_COMBINE=2,yu.ALPHA_SUBTRACT=3,yu.ALPHA_MULTIPLY=4,yu.ALPHA_MAXIMIZED=5,yu.ALPHA_ONEONE=6,yu.ALPHA_PREMULTIPLIED=7,yu.ALPHA_PREMULTIPLIED_PORTERDUFF=8,yu.ALPHA_INTERPOLATE=9,yu.ALPHA_SCREENMODE=10,yu.ALPHA_ONEONE_ONEONE=11,yu.ALPHA_ALPHATOCOLOR=12,yu.ALPHA_REVERSEONEMINUS=13,yu.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,yu.ALPHA_ONEONE_ONEZERO=15,yu.ALPHA_EXCLUSION=16,yu.ALPHA_LAYER_ACCUMULATE=17,yu.ALPHA_EQUATION_ADD=0,yu.ALPHA_EQUATION_SUBSTRACT=1,yu.ALPHA_EQUATION_REVERSE_SUBTRACT=2,yu.ALPHA_EQUATION_MAX=3,yu.ALPHA_EQUATION_MIN=4,yu.ALPHA_EQUATION_DARKEN=5,yu.DELAYLOADSTATE_NONE=0,yu.DELAYLOADSTATE_LOADED=1,yu.DELAYLOADSTATE_LOADING=2,yu.DELAYLOADSTATE_NOTLOADED=4,yu.NEVER=512,yu.ALWAYS=519,yu.LESS=513,yu.EQUAL=514,yu.LEQUAL=515,yu.GREATER=516,yu.GEQUAL=518,yu.NOTEQUAL=517,yu.KEEP=7680,yu.ZERO=0,yu.REPLACE=7681,yu.INCR=7682,yu.DECR=7683,yu.INVERT=5386,yu.INCR_WRAP=34055,yu.DECR_WRAP=34056,yu.TEXTURE_CLAMP_ADDRESSMODE=0,yu.TEXTURE_WRAP_ADDRESSMODE=1,yu.TEXTURE_MIRROR_ADDRESSMODE=2,yu.TEXTURE_CREATIONFLAG_STORAGE=1,yu.TEXTUREFORMAT_ALPHA=0,yu.TEXTUREFORMAT_LUMINANCE=1,yu.TEXTUREFORMAT_LUMINANCE_ALPHA=2,yu.TEXTUREFORMAT_RGB=4,yu.TEXTUREFORMAT_RGBA=5,yu.TEXTUREFORMAT_RED=6,yu.TEXTUREFORMAT_R=6,yu.TEXTUREFORMAT_RG=7,yu.TEXTUREFORMAT_RED_INTEGER=8,yu.TEXTUREFORMAT_R_INTEGER=8,yu.TEXTUREFORMAT_RG_INTEGER=9,yu.TEXTUREFORMAT_RGB_INTEGER=10,yu.TEXTUREFORMAT_RGBA_INTEGER=11,yu.TEXTUREFORMAT_BGRA=12,yu.TEXTUREFORMAT_DEPTH24_STENCIL8=13,yu.TEXTUREFORMAT_DEPTH32_FLOAT=14,yu.TEXTUREFORMAT_DEPTH16=15,yu.TEXTUREFORMAT_DEPTH24=16,yu.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,yu.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,yu.TEXTUREFORMAT_STENCIL8=19,yu.TEXTUREFORMAT_UNDEFINED=4294967295,yu.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,yu.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,yu.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,yu.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,yu.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,yu.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,yu.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,yu.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,yu.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,yu.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,yu.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,yu.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,yu.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,yu.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,yu.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,yu.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,yu.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,yu.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,yu.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,yu.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,yu.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,yu.TEXTURETYPE_UNSIGNED_BYTE=0,yu.TEXTURETYPE_UNSIGNED_INT=0,yu.TEXTURETYPE_FLOAT=1,yu.TEXTURETYPE_HALF_FLOAT=2,yu.TEXTURETYPE_BYTE=3,yu.TEXTURETYPE_SHORT=4,yu.TEXTURETYPE_UNSIGNED_SHORT=5,yu.TEXTURETYPE_INT=6,yu.TEXTURETYPE_UNSIGNED_INTEGER=7,yu.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,yu.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,yu.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,yu.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,yu.TEXTURETYPE_UNSIGNED_INT_24_8=12,yu.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,yu.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,yu.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,yu.TEXTURETYPE_UNDEFINED=16,yu.TEXTURE_2D=3553,yu.TEXTURE_2D_ARRAY=35866,yu.TEXTURE_CUBE_MAP=34067,yu.TEXTURE_CUBE_MAP_ARRAY=3735928559,yu.TEXTURE_3D=32879,yu.TEXTURE_NEAREST_SAMPLINGMODE=1,yu.TEXTURE_NEAREST_NEAREST=1,yu.TEXTURE_BILINEAR_SAMPLINGMODE=2,yu.TEXTURE_LINEAR_LINEAR=2,yu.TEXTURE_TRILINEAR_SAMPLINGMODE=3,yu.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,yu.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,yu.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,yu.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,yu.TEXTURE_NEAREST_LINEAR=7,yu.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,yu.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,yu.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,yu.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,yu.TEXTURE_LINEAR_NEAREST=12,yu.TEXTURE_EXPLICIT_MODE=0,yu.TEXTURE_SPHERICAL_MODE=1,yu.TEXTURE_PLANAR_MODE=2,yu.TEXTURE_CUBIC_MODE=3,yu.TEXTURE_PROJECTION_MODE=4,yu.TEXTURE_SKYBOX_MODE=5,yu.TEXTURE_INVCUBIC_MODE=6,yu.TEXTURE_EQUIRECTANGULAR_MODE=7,yu.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,yu.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,yu.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,yu.TEXTURE_FILTERING_QUALITY_HIGH=64,yu.TEXTURE_FILTERING_QUALITY_MEDIUM=16,yu.TEXTURE_FILTERING_QUALITY_LOW=8,yu.SCALEMODE_FLOOR=1,yu.SCALEMODE_NEAREST=2,yu.SCALEMODE_CEILING=3,yu.MATERIAL_TextureDirtyFlag=1,yu.MATERIAL_LightDirtyFlag=2,yu.MATERIAL_FresnelDirtyFlag=4,yu.MATERIAL_AttributesDirtyFlag=8,yu.MATERIAL_MiscDirtyFlag=16,yu.MATERIAL_PrePassDirtyFlag=32,yu.MATERIAL_AllDirtyFlag=63,yu.MATERIAL_TriangleFillMode=0,yu.MATERIAL_WireFrameFillMode=1,yu.MATERIAL_PointFillMode=2,yu.MATERIAL_PointListDrawMode=3,yu.MATERIAL_LineListDrawMode=4,yu.MATERIAL_LineLoopDrawMode=5,yu.MATERIAL_LineStripDrawMode=6,yu.MATERIAL_TriangleStripDrawMode=7,yu.MATERIAL_TriangleFanDrawMode=8,yu.MATERIAL_ClockWiseSideOrientation=0,yu.MATERIAL_CounterClockWiseSideOrientation=1,yu.ACTION_NothingTrigger=0,yu.ACTION_OnPickTrigger=1,yu.ACTION_OnLeftPickTrigger=2,yu.ACTION_OnRightPickTrigger=3,yu.ACTION_OnCenterPickTrigger=4,yu.ACTION_OnPickDownTrigger=5,yu.ACTION_OnDoublePickTrigger=6,yu.ACTION_OnPickUpTrigger=7,yu.ACTION_OnPickOutTrigger=16,yu.ACTION_OnLongPressTrigger=8,yu.ACTION_OnPointerOverTrigger=9,yu.ACTION_OnPointerOutTrigger=10,yu.ACTION_OnEveryFrameTrigger=11,yu.ACTION_OnIntersectionEnterTrigger=12,yu.ACTION_OnIntersectionExitTrigger=13,yu.ACTION_OnKeyDownTrigger=14,yu.ACTION_OnKeyUpTrigger=15,yu.PARTICLES_BILLBOARDMODE_Y=2,yu.PARTICLES_BILLBOARDMODE_ALL=7,yu.PARTICLES_BILLBOARDMODE_STRETCHED=8,yu.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,yu.MESHES_CULLINGSTRATEGY_STANDARD=0,yu.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,yu.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,yu.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,yu.SCENELOADER_NO_LOGGING=0,yu.SCENELOADER_MINIMAL_LOGGING=1,yu.SCENELOADER_SUMMARY_LOGGING=2,yu.SCENELOADER_DETAILED_LOGGING=3,yu.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,yu.PREPASS_POSITION_TEXTURE_TYPE=1,yu.PREPASS_VELOCITY_TEXTURE_TYPE=2,yu.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,yu.PREPASS_COLOR_TEXTURE_TYPE=4,yu.PREPASS_DEPTH_TEXTURE_TYPE=5,yu.PREPASS_NORMAL_TEXTURE_TYPE=6,yu.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,yu.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,yu.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,yu.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,yu.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,yu.PREPASS_ALBEDO_TEXTURE_TYPE=12,yu.BUFFER_CREATIONFLAG_READ=1,yu.BUFFER_CREATIONFLAG_WRITE=2,yu.BUFFER_CREATIONFLAG_READWRITE=3,yu.BUFFER_CREATIONFLAG_UNIFORM=4,yu.BUFFER_CREATIONFLAG_VERTEX=8,yu.BUFFER_CREATIONFLAG_INDEX=16,yu.BUFFER_CREATIONFLAG_STORAGE=32,yu.BUFFER_CREATIONFLAG_INDIRECT=64,yu.RENDERPASS_MAIN=0,yu.INPUT_ALT_KEY=18,yu.INPUT_CTRL_KEY=17,yu.INPUT_META_KEY1=91,yu.INPUT_META_KEY2=92,yu.INPUT_META_KEY3=93,yu.INPUT_SHIFT_KEY=16,yu.SNAPSHOTRENDERING_STANDARD=0,yu.SNAPSHOTRENDERING_FAST=1,yu.PERSPECTIVE_CAMERA=0,yu.ORTHOGRAPHIC_CAMERA=1,yu.FOVMODE_VERTICAL_FIXED=0,yu.FOVMODE_HORIZONTAL_FIXED=1,yu.RIG_MODE_NONE=0,yu.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,yu.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,yu.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,yu.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,yu.RIG_MODE_STEREOSCOPIC_INTERLACED=14,yu.RIG_MODE_VR=20,yu.RIG_MODE_CUSTOM=22,yu.MAX_SUPPORTED_UV_SETS=6,yu.GL_ALPHA_EQUATION_ADD=32774,yu.GL_ALPHA_EQUATION_MIN=32775,yu.GL_ALPHA_EQUATION_MAX=32776,yu.GL_ALPHA_EQUATION_SUBTRACT=32778,yu.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,yu.GL_ALPHA_FUNCTION_SRC=768,yu.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,yu.GL_ALPHA_FUNCTION_SRC_ALPHA=770,yu.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,yu.GL_ALPHA_FUNCTION_DST_ALPHA=772,yu.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,yu.GL_ALPHA_FUNCTION_DST_COLOR=774,yu.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,yu.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,yu.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,yu.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,yu.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,yu.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,yu.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,yu.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,yu.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,yu.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,yu.SnippetUrl="https://snippet.babylonjs.com",yu.FOGMODE_NONE=0,yu.FOGMODE_EXP=1,yu.FOGMODE_EXP2=2,yu.FOGMODE_LINEAR=3,yu.BYTE=5120,yu.UNSIGNED_BYTE=5121,yu.SHORT=5122,yu.UNSIGNED_SHORT=5123,yu.INT=5124,yu.UNSIGNED_INT=5125,yu.FLOAT=5126,yu.PositionKind="position",yu.NormalKind="ab",yu.TangentKind="tangent",yu.UVKind="uv",yu.UV2Kind="uv2",yu.UV3Kind="uv3",yu.UV4Kind="uv4",yu.UV5Kind="uv5",yu.UV6Kind="uv6",yu.ColorKind="color",yu.ColorInstanceKind="instanceColor",yu.MatricesIndicesKind="matricesIndices",yu.MatricesWeightsKind="matricesWeights",yu.MatricesIndicesExtraKind="matricesIndicesExtra",yu.MatricesWeightsExtraKind="matricesWeightsExtra";class au{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:yu.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(u,G){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...au._GetDefaultOptions(),...u},this._scene=G,this._scene._transmissionHelper=this,this.onErrorObservable=new g.e,this._scene._i.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(u){if(!Object.keys(u).filter((G=>this._options[G]!==u[G])).length)return;const G={...this._options,...u},s=this._options;this._options=G,G.renderSize===s.renderSize&&G.renderTargetTextureType===s.renderTargetTextureType&&G.generateMipmaps===s.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=G.samples,this._opaqueRenderTarget.lodGenerationScale=G.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=G.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(u){return!!u&&!!(u instanceof q&&u.subSurface.isRefractionEnabled)}_addMesh(u){this._materialObservers[u.uniqueId]=u.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),m.e.SetImmediate((()=>{this._shouldRenderAsTransmission(u.material)?(u.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(u)&&this._transparentMeshesCache.push(u)):-1===this._opaqueMeshesCache.indexOf(u)&&this._opaqueMeshesCache.push(u)}))}_removeMesh(u){u.onMaterialChangedObservable.remove(this._materialObservers[u.uniqueId]),delete this._materialObservers[u.uniqueId];let G=this._transparentMeshesCache.indexOf(u);-1!==G&&this._transparentMeshesCache.splice(G,1),G=this._opaqueMeshesCache.indexOf(u),-1!==G&&this._opaqueMeshesCache.splice(G,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(u){const G=this._transparentMeshesCache.indexOf(u),s=this._opaqueMeshesCache.indexOf(u);this._shouldRenderAsTransmission(u.material)?(u.material instanceof q&&(u.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==s?(this._opaqueMeshesCache.splice(s,1),this._transparentMeshesCache.push(u)):-1===G&&this._transparentMeshesCache.push(u)):-1!==G?(this._transparentMeshesCache.splice(G,1),this._opaqueMeshesCache.push(u)):-1===s&&this._opaqueMeshesCache.push(u)}_isRenderTargetValid(){var u;return null!==(null===(u=this._opaqueRenderTarget)||void 0===u?void 0:u.getInternalTexture())}_setupRenderTargets(){var u;let G,s;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Nu.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(u=this._options.clearColor)||void 0===u?void 0:u.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((u=>{s=this._scene.environmentIntensity,this._scene.environmentIntensity=1,G=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?u.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(u.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=s,this._scene.imageProcessingConfiguration._applyByPostProcess=G})),this._transparentMeshesCache.forEach((u=>{this._shouldRenderAsTransmission(u.material)&&(u.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ku="KHR_materials_transmission";class Zu{constructor(u){this.name=Ku,this.order=175,this._loader=u,this.enabled=this._loader.isExtensionUsed(Ku),this.enabled&&(u.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadTransparentPropertiesAsync(T,G,s,z)),Promise.all(O).then((()=>{}))}))}_loadTransparentPropertiesAsync(u,G,s,T){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const z=s;if(z.subSurface.isRefractionEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.useAlbedoToTintRefraction=!0,void 0===T.transmissionFactor)return z.subSurface.refractionIntensity=0,z.subSurface.isRefractionEnabled=!1,Promise.resolve();{var O;z.subSurface.refractionIntensity=T.transmissionFactor;const u=z.va();if(z.subSurface.refractionIntensity&&!u._transmissionHelper)new au({},z.va());else if(z.subSurface.refractionIntensity&&(null===(O=u._transmissionHelper)||void 0===O||!O._isRenderTargetValid())){var m;null===(m=u._transmissionHelper)||void 0===m||m._setupRenderTargets()}}return z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,T.transmissionTexture?(T.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${u}/transmissionTexture`,T.transmissionTexture,void 0).then((u=>{u.name=`${s.name} (Transmission)`,z.subSurface.refractionIntensityTexture=u,z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(Ku),y(Ku,!0,(u=>new Zu(u)));const tu="KHR_materials_diffuse_transmission";class Eu{constructor(u){this.name=tu,this.order=174,this._loader=u,this.enabled=this._loader.isExtensionUsed(tu),this.enabled&&(u.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadTranslucentPropertiesAsync(T,G,s,z)),Promise.all(O).then((()=>{}))}))}_loadTranslucentPropertiesAsync(u,G,s,T){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);const z=s;if(z.subSurface.isTranslucencyEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,z.subSurface.useAlbedoToTintTranslucency=!1,void 0===T.diffuseTransmissionFactor)return z.subSurface.translucencyIntensity=0,z.subSurface.isTranslucencyEnabled=!1,Promise.resolve();z.subSurface.translucencyIntensity=T.diffuseTransmissionFactor;const m=new Array;return z.subSurface.useGltfStyleTextures=!0,T.diffuseTransmissionTexture&&(T.diffuseTransmissionTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTransmissionTexture`,T.diffuseTransmissionTexture).then((u=>{u.name=`${s.name} (Diffuse Transmission)`,z.subSurface.translucencyIntensityTexture=u})))),void 0!==T.diffuseTransmissionColorFactor?z.subSurface.translucencyColor=O.b.Ag(T.diffuseTransmissionColorFactor):z.subSurface.translucencyColor=O.b.White(),T.diffuseTransmissionColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${u}/diffuseTransmissionColorTexture`,T.diffuseTransmissionColorTexture).then((u=>{u.name=`${s.name} (Diffuse Transmission Color)`,z.subSurface.translucencyColorTexture=u}))),Promise.all(m).then((()=>{}))}}a(tu),y(tu,!0,(u=>new Eu(u)));const Uu="KHR_materials_volume";class uG{constructor(u){this.name=Uu,this.order=173,this._loader=u,this.enabled=this._loader.isExtensionUsed(Uu),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadVolumePropertiesAsync(T,G,s,z)),Promise.all(O).then((()=>{}))}))}_loadVolumePropertiesAsync(u,G,s,T){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);if(!s.subSurface.isRefractionEnabled&&!s.subSurface.isTranslucencyEnabled||!T.thicknessFactor)return Promise.resolve();s.subSurface.volumeIndexOfRefraction=s.indexOfRefraction;const z=void 0!==T.attenuationDistance?T.attenuationDistance:Number.MAX_VALUE;return s.subSurface.tintColorAtDistance=z,void 0!==T.attenuationColor&&3==T.attenuationColor.length&&s.subSurface.tintColor.hf(T.attenuationColor[0],T.attenuationColor[1],T.attenuationColor[2]),s.subSurface.minimumThickness=0,s.subSurface.maximumThickness=T.thicknessFactor,s.subSurface.useThicknessAsDepth=!0,T.thicknessTexture?(T.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${u}/thicknessTexture`,T.thicknessTexture).then((u=>{u.name=`${s.name} (Thickness)`,s.subSurface.thicknessTexture=u,s.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(Uu),y(Uu,!0,(u=>new uG(u)));const GG="KHR_materials_dispersion";class sG{constructor(u){this.name=GG,this.order=174,this._loader=u,this.enabled=this._loader.isExtensionUsed(GG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(u,G,s)),O.push(this._loadDispersionPropertiesAsync(T,G,s,z)),Promise.all(O).then((()=>{}))}))}_loadDispersionPropertiesAsync(u,G,s,T){if(!(s instanceof q))throw new Error(`${u}: Material type not supported`);return s.subSurface.isRefractionEnabled&&T.dispersion?(s.subSurface.isDispersionEnabled=!0,s.subSurface.dispersion=T.dispersion,Promise.resolve()):Promise.resolve()}}a(GG),y(GG,!0,(u=>new sG(u)));const TG="KHR_mesh_quantization";class zG{constructor(u){this.name=TG,this.enabled=u.isExtensionUsed(TG)}dispose(){}}a(TG),y(TG,!0,(u=>new zG(u)));const OG="KHR_texture_basisu";class mG{constructor(u){this.name=OG,this._loader=u,this.enabled=u.isExtensionUsed(OG)}dispose(){this._loader=null}_loadTextureAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>{const O=void 0==G.sampler?t.DefaultSampler:Z.Get(`${u}/sampler`,this._loader.Ei.samplers,G.sampler),m=Z.Get(`${T}/source`,this._loader.Ei.images,z.source);return this._loader._createTextureAsync(u,O,m,(u=>{s(u)}),G._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!G._textureInfo.nonColorData)}))}}a(OG),y(OG,!0,(u=>new mG(u)));const fG="KHR_texture_transform";class CG{constructor(u){this.name=fG,this._loader=u,this.enabled=this._loader.isExtensionUsed(fG)}dispose(){this._loader=null}loadTextureInfoAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((T,z)=>this._loader.loadTextureInfoAsync(u,G,(u=>{if(!(u instanceof d.b))throw new Error(`${T}: Texture type not supported`);z.offset&&(u.uOffset=z.offset[0],u.vOffset=z.offset[1]),u.uRotationCenter=0,u.vRotationCenter=0,z.rotation&&(u.wAng=-z.rotation),z.scale&&(u.uScale=z.scale[0],u.vScale=z.scale[1]),void 0!=z.texCoord&&(u.coordinatesIndex=z.texCoord),s(u)}))))}}a(fG),y(fG,!0,(u=>new CG(u)));const xG="KHR_xmp_json_ld";class gG{constructor(u){this.name=xG,this.order=100,this._loader=u,this.enabled=this._loader.isExtensionUsed(xG)}dispose(){this._loader=null}onLoading(){var u,G,s;if(null===this._loader.rootBabylonMesh)return;const T=null===(u=this._loader.Ei.extensions)||void 0===u?void 0:u.KHR_xmp_json_ld,z=null===(G=this._loader.Ei.asset)||void 0===G||null===(s=G.extensions)||void 0===s?void 0:s.KHR_xmp_json_ld;if(T&&z){const u=+z.packet;T.packets&&u<T.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=T.packets[u])}}}function bG(u,G,s,T){return O.b.Ag(G,s).scale(T)}function QG(u,G,s,T){return G[s]*T}function YG(u,G,s,T){return-G[s]*T}function nG(u,G,s,T){return G[s+1]*T}function VG(u,G,s,T){return G[s]*T*2}function FG(u){return{scale:[new cG(Q.b.ANIMATIONTYPE_FLOAT,`${u}.uScale`,QG,(()=>2)),new cG(Q.b.ANIMATIONTYPE_FLOAT,`${u}.vScale`,nG,(()=>2))],offset:[new cG(Q.b.ANIMATIONTYPE_FLOAT,`${u}.uOffset`,QG,(()=>2)),new cG(Q.b.ANIMATIONTYPE_FLOAT,`${u}.vOffset`,nG,(()=>2))],rotation:[new cG(Q.b.ANIMATIONTYPE_FLOAT,`${u}.wAng`,YG,(()=>1))]}}a(xG),y(xG,!0,(u=>new gG(u)));class rG extends I{buildAnimations(u,G,s,T,z){z(u._babylonCamera,this._buildAnimation(G,s,T))}}class cG extends I{buildAnimations(u,G,s,T,z){for(const O in u._data)z(u._data[O].babylonMaterial,this._buildAnimation(G,s,T))}}class jG extends I{buildAnimations(u,G,s,T,z){z(u._babylonLight,this._buildAnimation(G,s,T))}}const lG={__array__:{__target__:!0,...J}},PG={__array__:{__target__:!0,orthographic:{xmag:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"orthoLeft",YG,(()=>1)),new rG(Q.b.ANIMATIONTYPE_FLOAT,"orthoRight",nG,(()=>1))],ymag:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"orthoBottom",YG,(()=>1)),new rG(Q.b.ANIMATIONTYPE_FLOAT,"orthoTop",nG,(()=>1))],zfar:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"maxZ",QG,(()=>1))],znear:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"Mi",QG,(()=>1))]},perspective:{yfov:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"fov",QG,(()=>1))],zfar:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"maxZ",QG,(()=>1))],znear:[new rG(Q.b.ANIMATIONTYPE_FLOAT,"Mi",QG,(()=>1))]}}},HG={nodes:lG,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"albedoColor",bG,(()=>4)),new cG(Q.b.ANIMATIONTYPE_FLOAT,"alpha",(function(u,G,s,T){return G[s+3]*T}),(()=>4))],metallicFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"metallic",QG,(()=>1))],roughnessFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"roughness",QG,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:FG("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:FG("metallicTexture")}}},emissiveFactor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"emissiveColor",bG,(()=>3))],normalTexture:{scale:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",QG,(()=>1))],extensions:{KHR_texture_transform:FG("bumpTexture")}},occlusionTexture:{strength:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",QG,(()=>1))],extensions:{KHR_texture_transform:FG("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:FG("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",QG,(()=>1))],anisotropyRotation:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",QG,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:FG("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",QG,(()=>1))],clearcoatRoughnessFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",QG,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:FG("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",QG,(()=>1))],extensions:{KHR_texture_transform:FG("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:FG("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",QG,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",QG,(()=>1))]},KHR_materials_ior:{ior:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",QG,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",QG,(()=>1))],iridescenceIor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",QG,(()=>1))],iridescenceThicknessMinimum:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",QG,(()=>1))],iridescenceThicknessMaximum:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",QG,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:FG("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:FG("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"sheen.color",bG,(()=>3))],sheenRoughnessFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",QG,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:FG("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:FG("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",QG,(()=>1))],specularColorFactor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",bG,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:FG("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:FG("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",QG,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:FG("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",bG,(()=>3))],attenuationDistance:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",QG,(()=>1))],thicknessFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",QG,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:FG("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new cG(Q.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",QG,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:FG("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new cG(Q.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",bG,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:FG("subSurface.translucencyColorTexture")}}}}}},cameras:PG,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new jG(Q.b.ANIMATIONTYPE_COLOR3,"diffuse",bG,(()=>3))],Qi:[new jG(Q.b.ANIMATIONTYPE_FLOAT,"intensity",QG,(()=>1))],range:[new jG(Q.b.ANIMATIONTYPE_FLOAT,"range",QG,(()=>1))],spot:{innerConeAngle:[new jG(Q.b.ANIMATIONTYPE_FLOAT,"innerAngle",VG,(()=>1))],outerConeAngle:[new jG(Q.b.ANIMATIONTYPE_FLOAT,"angle",VG,(()=>1))]}}}}}};class XG{constructor(u,G){this._gltf=u,this._infoTree=G}convert(u){let G,s=this._gltf,T=this._infoTree;if(!u.startsWith("/"))throw new Error("Path must start with a /");const z=u.split("/");z.shift();for(const O of z){if(T.__array__)T=T.__array__;else if(T=T[O],!T)throw new Error(`Path ${u} is invalid`);if(void 0===s)throw new Error(`Path ${u} is invalid`);s=s[O],T.__target__&&(G=s)}return{object:G,info:T}}}const pG="KHR_animation_pointer";class qG extends XG{constructor(u){super(u,HG)}}class dG{constructor(u){this.name=pG,this._loader=u,this._pathToObjectConverter=new qG(this._loader.Ei)}get enabled(){return this._loader.isExtensionUsed(pG)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(u,G,s,T,z){var O;const m=null===(O=T.target.extensions)||void 0===O?void 0:O.KHR_animation_pointer;if(!m||!this._pathToObjectConverter)return null;"pointer"!==T.target.path&&V.d.Warn(`${u}/target/path: Value (${T.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=T.target.node&&V.d.Warn(`${u}/target/node: Value (${T.target.node}) must not be present when using the ${this.name} extension`);const f=`${u}/extensions/${this.name}`,C=m.pointer;if(!C)throw new Error(`${f}: Pointer is missing`);try{const O=this._pathToObjectConverter.convert(C);return this._loader._loadAnimationChannelFromTargetInfoAsync(u,G,s,T,O,z)}catch(x){return V.d.Warn(`${f}/pointer: Invalid pointer (${C}) skipped`),null}}}a(pG),y(pG,!0,(u=>new dG(u)));class vG{constructor(u,G,s){this.frame=u,this.action=G,this.onlyOnce=s,this.isDone=!1}_clone(){return new vG(this.frame,this.action,this.onlyOnce)}}var WG=s(10609),MG=s(10645);class oG{get loop(){return this._loop}set loop(u){u!==this._loop&&(this._loop=u,this.updateOptions({loop:u}))}get currentTime(){var u;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(u=MG.b.audioEngine)&&void 0!==u&&u.audioContext&&(this.isPlaying||this.isPaused)){const u=this.isPaused?0:MG.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+u}return 0}get spatialSound(){return this._spatialSound}set spatialSound(u){if(u==this._spatialSound)return;const G=this.isPlaying;this.pause(),u?(this._spatialSound=u,this._updateSpatialParameters()):this._disableSpatialSound(),G&&this.play()}constructor(u,G,s){var T;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new g.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=z.q.Zero(),this._localDirection=new z.q(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=u,s=s||n.d.LastCreatedScene)if(this._scene=s,oG._SceneComponentInitialization(s),this._readyToPlayCallback=O,this._customAttenuationFunction=(u,G,s,T,z)=>G<s?u*(1-G/s):0,f&&(this.autoplay=f.autoplay||!1,this._loop=f.loop||!1,void 0!==f.volume&&(this._volume=f.volume),this._spatialSound=f.spatialSound??!1,this.maxDistance=f.maxDistance??100,this.useCustomAttenuation=f.useCustomAttenuation??!1,this.rolloffFactor=f.rolloffFactor||1,this.refDistance=f.refDistance||1,this.distanceModel=f.distanceModel||"linear",this._playbackRate=f.playbackRate||1,this._streaming=f.streaming??!1,this._length=f.length,this._offset=f.offset),null!==(T=MG.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&MG.b.audioEngine.audioContext){this._soundGain=MG.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let u=!0;if(G)try{"string"===typeof G?(this._urlType="String",this._url=G):G instanceof ArrayBuffer?this._urlType="ArrayBuffer":G instanceof HTMLMediaElement?this._urlType="MediaElement":G instanceof MediaStream?this._urlType="MediaStream":G instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(G)&&(this._urlType="Array");let s=[],T=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MG.b.audioEngine.audioContext.createMediaElementSource(G),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MG.b.audioEngine.audioContext.createMediaStreamSource(G),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":G.byteLength>0&&(T=!0,this._soundLoaded(G));break;case"AudioBuffer":this._audioBufferLoaded(G);break;case"String":s.push(G);case"Array":0===s.length&&(s=G);for(let u=0;u<s.length;u++){const G=s[u];if(T=f&&f.skipCodecCheck||-1!==G.indexOf(".mp3",G.length-4)&&MG.b.audioEngine.isMP3supported||-1!==G.indexOf(".ogg",G.length-4)&&MG.b.audioEngine.isOGGsupported||-1!==G.indexOf(".wav",G.length-4)||-1!==G.indexOf(".m4a",G.length-4)||-1!==G.indexOf(".mp4",G.length-4)||-1!==G.indexOf("blob:"),T){this._streaming?(this._htmlAudioElement=new Audio(G),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,m.e.SetCorsBehavior(G,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(G,(u=>{this._soundLoaded(u)}),void 0,!0,!0,(u=>{u&&V.d.Error("XHR "+u.status+" error on: "+G+"."),V.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:u=!1}u?T||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):V.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){V.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),MG.b.audioEngine&&!MG.b.audioEngine.WarnedWebAudioUnsupported&&(V.d.Error("Web Audio is not supported by your browser."),MG.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var u;null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(u){var G;null!==(G=MG.b.audioEngine)&&void 0!==G&&G.audioContext&&(this._audioBuffer=u,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(u){var G;null!==(G=MG.b.audioEngine)&&void 0!==G&&G.audioContext&&MG.b.audioEngine.audioContext.decodeAudioData(u,(u=>{this._audioBufferLoaded(u)}),(u=>{V.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+u)}))}setAudioBuffer(u){var G;null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&(this._audioBuffer=u,this._isReadyToPlay=!0)}updateOptions(u){u&&(this.loop=u.loop??this.loop,this.maxDistance=u.maxDistance??this.maxDistance,this.useCustomAttenuation=u.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=u.rolloffFactor??this.rolloffFactor,this.refDistance=u.refDistance??this.refDistance,this.distanceModel=u.distanceModel??this.distanceModel,this._playbackRate=u.playbackRate??this._playbackRate,this._length=u.length??void 0,this.spatialSound=u.spatialSound??this._spatialSound,this._setOffset(u.offset??void 0),this.setVolume(u.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var u;null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&MG.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??MG.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var u;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(u=this._soundPanner)||void 0===u||u.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var u;null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(u){var G;null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(u),this._isOutputConnected=!0)}setDirectionalCone(u,G,s){G<u?V.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=u,this._coneOuterAngle=G,this._coneOuterGain=s,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(u){if(u!=this._coneInnerAngle){var G;if(this._coneOuterAngle<u)return void V.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=u,null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(u){if(u!=this._coneOuterAngle){var G;if(u<this._coneInnerAngle)return void V.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=u,null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(u){var G;u.equals(this._position)||(this._position.p(u),null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(u){var G;this._localDirection=u,null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const u=this._connectedTransformNode.getWorldMatrix(),G=z.q.TransformNormal(this._localDirection,u);G.normalize(),this._soundPanner.orientationX.value=G.x,this._soundPanner.orientationY.value=G.y,this._soundPanner.orientationZ.value=G.z}updateDistanceFromListener(){var u;if(null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const u=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Nc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,u,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(u){this._customAttenuationFunction=u}play(u,G,s){var T;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(T=MG.b.audioEngine)&&void 0!==T&&T.audioContext)try{var z,O;this._clearTimeoutsAndObservers();let T=u?(null===(z=MG.b.audioEngine)||void 0===z?void 0:z.audioContext.currentTime)+u:null===(O=MG.b.audioEngine)||void 0===O?void 0:O.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=MG.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const u=()=>{var s;if(null!==(s=MG.b.audioEngine)&&void 0!==s&&s.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=G??0;const s=this._htmlAudioElement.play();void 0!==s&&s.catch((()=>{var G,s;(null===(G=MG.b.audioEngine)||void 0===G||G.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(s=MG.b.audioEngine)||void 0===s?void 0:s.onAudioUnlockedObservable.addOnce((()=>{u()})))}))}else{var T;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(T=MG.b.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{u()}))}};u()}}else{var m;const z=()=>{var z;if(null!==(z=MG.b.audioEngine)&&void 0!==z&&z.audioContext){var O;if(s=s||this._length,void 0!==G&&this._setOffset(G),this._soundSource){const u=this._soundSource;u.onended=()=>{u.disconnect()}}if(this._soundSource=null===(O=MG.b.audioEngine)||void 0===O?void 0:O.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var m;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==G&&(this._soundSource.loopStart=G),void 0!==s&&(this._soundSource.loopEnd=(0|G)+s),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},T=u?(null===(m=MG.b.audioEngine)||void 0===m?void 0:m.audioContext.currentTime)+u:MG.b.audioEngine.audioContext.currentTime;const z=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(T,z,this.loop?void 0:s)}}};"suspended"===(null===(m=MG.b.audioEngine)||void 0===m?void 0:m.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var u;"suspended"===(null===(u=MG.b.audioEngine)||void 0===u?void 0:u.audioContext.state)?(MG.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=MG.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{z()})))):z()}),500):z()}this._startTime=T,this.isPlaying=!0,this.isPaused=!1}catch(f){V.d.Error("Error while trying to play audio: "+this.name+", "+f.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(u){var G;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var s;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(s=this._streamingSource)||void 0===s||s.disconnect();this.isPlaying=!1}else if(null!==(G=MG.b.audioEngine)&&void 0!==G&&G.audioContext&&this._soundSource){const G=u?MG.b.audioEngine.audioContext.currentTime+u:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(G)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var G;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(G=this._streamingSource)||void 0===G||G.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(u=MG.b.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=MG.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(u,G){var s;null!==(s=MG.b.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._soundGain&&(G&&MG.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(MG.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,MG.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(u,MG.b.audioEngine.audioContext.currentTime+G)):this._soundGain.gain.value=u),this._volume=u}setPlaybackRate(u){this._playbackRate=u,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(u){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=u,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=u=>this._onRegisterAfterWorldMatrixUpdate(u),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(u){var G;if(u.getBoundingInfo){const G=u.getBoundingInfo();this.setPosition(G.boundingSphere.centerWorld)}else this.setPosition(u.absolutePosition);null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const u=()=>{this._isReadyToPlay?(s._audioBuffer=this.getAudioBuffer(),s._isReadyToPlay=!0,s.autoplay&&s.play(0,this._offset,this._length)):setTimeout(u,300)},G={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},s=new oG(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,G);return this.useCustomAttenuation&&s.setAttenuationFunction(this._customAttenuationFunction),s.setPosition(this._position),s.setPlaybackRate(this._playbackRate),u(),s}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const u={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(u.connectedMeshId=this._connectedTransformNode.id),u.position=this._position.$i(),u.refDistance=this.refDistance,u.distanceModel=this.distanceModel,u.isDirectional=this._isDirectional,u.localDirectionToMesh=this._localDirection.$i(),u.coneInnerAngle=this._coneInnerAngle,u.coneOuterAngle=this._coneOuterAngle,u.coneOuterGain=this._coneOuterGain),u}static Parse(u,G,s,T){const O=u.name;let m;m=u.url?s+u.url:s+O;const f={autoplay:u.autoplay,loop:u.loop,volume:u.volume,spatialSound:u.spatialSound,maxDistance:u.maxDistance,rolloffFactor:u.rolloffFactor,refDistance:u.refDistance,distanceModel:u.distanceModel,playbackRate:u.playbackRate};let C;if(T){const u=()=>{T._isReadyToPlay?(C._audioBuffer=T.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)):setTimeout(u,300)};C=new oG(O,new ArrayBuffer(0),G,null,f),u()}else C=new oG(O,m,G,(()=>{G.removePendingData(C)}),f),G.addPendingData(C);if(u.position){const G=z.q.Ag(u.position);C.setPosition(G)}if(u.isDirectional&&(C.setDirectionalCone(u.coneInnerAngle||360,u.coneOuterAngle||360,u.coneOuterGain||0),u.localDirectionToMesh)){const G=z.q.Ag(u.localDirectionToMesh);C.setLocalDirectionToMesh(G)}if(u.connectedMeshId){const s=G.getMeshById(u.connectedMeshId);s&&C.attachToMesh(s)}return u.metadata&&(C.metadata=u.metadata),C}_setOffset(u){this._offset!==u&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=u)}_clearTimeoutsAndObservers(){var u;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(u=MG.b.audioEngine)||void 0===u||u.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}oG._SceneComponentInitialization=u=>{throw(0,WG.c)("AudioSceneComponent")},(0,X.g)("BABYLON.Sound",oG);class RG{constructor(u,G,s){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],G.length!==s.length)throw new Error("Sounds length does not equal weights length");this.loop=u,this._weights=s;let T=0;for(const O of s)T+=O;const z=T>0?1/T:0;for(let O=0;O<this._weights.length;O++)this._weights[O]*=z;this._sounds=G;for(const O of this._sounds)O.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(u){if(u!==this._coneInnerAngle){if(this._coneOuterAngle<u)return void V.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=u;for(const G of this._sounds)G.directionalConeInnerAngle=u}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(u){if(u!==this._coneOuterAngle){if(u<this._coneInnerAngle)return void V.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=u;for(const G of this._sounds)G.directionalConeOuterAngle=u}}get volume(){return this._volume}set volume(u){if(u!==this._volume)for(const G of this._sounds)G.setVolume(u)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(u){if(!this.isPaused){this.stop();const u=Math.random();let G=0;for(let s=0;s<this._weights.length;s++)if(G+=this._weights[s],u<=G){this._currentIndex=s;break}}const G=this._sounds[this._currentIndex??0];G.isReady()?G.play(0,this.isPaused?void 0:u):G.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class BG{constructor(u){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(u=u||n.d.LastCreatedScene)&&(this._scene=u,this.soundCollection=[],this._options=G,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var u;null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio&&MG.b.audioEngine.audioContext&&(this._outputAudioNode=MG.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(MG.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(MG.b.audioEngine&&MG.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(u){var G;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&u.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==u.soundTrackId&&(-1===u.soundTrackId?this._scene.mainSoundTrack.removeSound(u):this._scene.soundTracks&&this._scene.soundTracks[u.soundTrackId].removeSound(u)),this.soundCollection.push(u),u.soundTrackId=this.id}removeSound(u){const G=this.soundCollection.indexOf(u);-1!==G&&this.soundCollection.splice(G,1)}setVolume(u){var G;null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=u)}switchPanningModelToHRTF(){var u;if(null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio)for(let G=0;G<this.soundCollection.length;G++)this.soundCollection[G].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var u;if(null!==(u=MG.b.audioEngine)&&void 0!==u&&u.canUseWebAudio)for(let G=0;G<this.soundCollection.length;G++)this.soundCollection[G].switchPanningModelToEqualPower()}connectToAnalyser(u){var G;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=u,null!==(G=MG.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,MG.b.audioEngine.masterGain))}}var DG=s(10986),kG=s(10889),wG=(s(11436),s(10601));(0,s(11526).g)(DG.d.NAME_AUDIO,((u,G,s,T)=>{let z,O=[];if(s.Vj=s.Vj||[],void 0!==u.Vj&&null!==u.Vj)for(let f=0,C=u.Vj.length;f<C;f++){var m;const C=u.Vj[f];null!==(m=MG.b.audioEngine)&&void 0!==m&&m.canUseWebAudio?(C.url||(C.url=C.name),O[C.url]?s.Vj.push(oG.Parse(C,G,T,O[C.url])):(z=oG.Parse(C,G,T),O[C.url]=z,s.Vj.push(z))):s.Vj.push(new oG(C.name,null,G))}O=[]})),Object.defineProperty(kG.e.prototype,"mainSoundTrack",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),this._mainSoundTrack||(this._mainSoundTrack=new BG(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),kG.e.prototype.getSoundByName=function(u){let G;for(G=0;G<this.mainSoundTrack.soundCollection.length;G++)if(this.mainSoundTrack.soundCollection[G].name===u)return this.mainSoundTrack.soundCollection[G];if(this.soundTracks)for(let s=0;s<this.soundTracks.length;s++)for(G=0;G<this.soundTracks[s].soundCollection.length;G++)if(this.soundTracks[s].soundCollection[G].name===u)return this.soundTracks[s].soundCollection[G];return null},Object.defineProperty(kG.e.prototype,"audioEnabled",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),u.audioEnabled},set:function(u){let G=this._getComponent(DG.d.NAME_AUDIO);G||(G=new LG(this),this.o(G)),u?G.enableAudio():G.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(kG.e.prototype,"headphone",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),u.headphone},set:function(u){let G=this._getComponent(DG.d.NAME_AUDIO);G||(G=new LG(this),this.o(G)),u?G.switchAudioModeForHeadphones():G.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(kG.e.prototype,"audioListenerPositionProvider",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),u.audioListenerPositionProvider},set:function(u){let G=this._getComponent(DG.d.NAME_AUDIO);if(G||(G=new LG(this),this.o(G)),u&&"function"!==typeof u)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");G.audioListenerPositionProvider=u},enumerable:!0,configurable:!0}),Object.defineProperty(kG.e.prototype,"audioListenerRotationProvider",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),u.audioListenerRotationProvider},set:function(u){let G=this._getComponent(DG.d.NAME_AUDIO);if(G||(G=new LG(this),this.o(G)),u&&"function"!==typeof u)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");G.audioListenerRotationProvider=u},enumerable:!0,configurable:!0}),Object.defineProperty(kG.e.prototype,"audioPositioningRefreshRate",{get:function(){let u=this._getComponent(DG.d.NAME_AUDIO);return u||(u=new LG(this),this.o(u)),u.audioPositioningRefreshRate},set:function(u){let G=this._getComponent(DG.d.NAME_AUDIO);G||(G=new LG(this),this.o(G)),G.audioPositioningRefreshRate=u},enumerable:!0,configurable:!0});class LG{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(u){this.name=DG.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new z.q,this._cachedCameraPosition=new z.q,this._lastCheck=0,this._invertMatrixTemp=new z.d,this._cameraDirectionTemp=new z.q,(u=u||n.d.LastCreatedScene)&&(this.wf=u,u.soundTracks=[],u.Vj=[])}register(){this.wf._afterRenderStage.registerStep(DG.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(u){if(u.Vj=[],this.wf.soundTracks)for(let G=0;G<this.wf.soundTracks.length;G++){const s=this.wf.soundTracks[G];for(let G=0;G<s.soundCollection.length;G++)u.Vj.push(s.soundCollection[G].serialize())}}addFromContainer(u){u.Vj&&u.Vj.forEach((u=>{u.play(),u.autoplay=!0,this.wf.mainSoundTrack.addSound(u)}))}removeFromContainer(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.Vj&&u.Vj.forEach((u=>{u.stop(),u.autoplay=!1,this.wf.mainSoundTrack.removeSound(u),G&&u.dispose()}))}dispose(){const u=this.wf;if(u._mainSoundTrack&&u.mainSoundTrack.dispose(),u.soundTracks)for(let G=0;G<u.soundTracks.length;G++)u.soundTracks[G].dispose()}disableAudio(){const u=this.wf;let G;for(this._audioEnabled=!1,MG.b.audioEngine&&MG.b.audioEngine.audioContext&&MG.b.audioEngine.audioContext.suspend(),G=0;G<u.mainSoundTrack.soundCollection.length;G++)u.mainSoundTrack.soundCollection[G].pause();if(u.soundTracks)for(G=0;G<u.soundTracks.length;G++)for(let s=0;s<u.soundTracks[G].soundCollection.length;s++)u.soundTracks[G].soundCollection[s].pause()}enableAudio(){const u=this.wf;let G;for(this._audioEnabled=!0,MG.b.audioEngine&&MG.b.audioEngine.audioContext&&MG.b.audioEngine.audioContext.resume(),G=0;G<u.mainSoundTrack.soundCollection.length;G++)u.mainSoundTrack.soundCollection[G].isPaused&&u.mainSoundTrack.soundCollection[G].play();if(u.soundTracks)for(G=0;G<u.soundTracks.length;G++)for(let s=0;s<u.soundTracks[G].soundCollection.length;s++)u.soundTracks[G].soundCollection[s].isPaused&&u.soundTracks[G].soundCollection[s].play()}switchAudioModeForHeadphones(){const u=this.wf;if(this._headphone=!0,u.mainSoundTrack.switchPanningModelToHRTF(),u.soundTracks)for(let G=0;G<u.soundTracks.length;G++)u.soundTracks[G].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const u=this.wf;if(this._headphone=!1,u.mainSoundTrack.switchPanningModelToEqualPower(),u.soundTracks)for(let G=0;G<u.soundTracks.length;G++)u.soundTracks[G].switchPanningModelToEqualPower()}_afterRender(){const u=wG.e.Now;if(this._lastCheck&&u-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=u;const G=this.wf;if(!this._audioEnabled||!G._mainSoundTrack||!G.soundTracks||0===G._mainSoundTrack.soundCollection.length&&1===G.soundTracks.length)return;const s=MG.b.audioEngine;if(s&&s.audioContext){let u,T=G.activeCamera;if(G.activeCameras&&G.activeCameras.length>0&&(T=G.activeCameras[0]),this.audioListenerPositionProvider){const u=this.audioListenerPositionProvider();s.audioContext.listener.setPosition(u.x||0,u.y||0,u.z||0)}else T?this._cachedCameraPosition.equals(T.globalPosition)||(this._cachedCameraPosition.p(T.globalPosition),s.audioContext.listener.setPosition(T.globalPosition.x,T.globalPosition.y,T.globalPosition.z)):s.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const u=this.audioListenerRotationProvider();s.audioContext.listener.setOrientation(u.x||0,u.y||0,u.z||0,0,1,0)}else T?(T.rigCameras&&T.rigCameras.length>0&&(T=T.rigCameras[0]),T.getViewMatrix().invertToRef(this._invertMatrixTemp),z.q.TransformNormalToRef(LG._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),s.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):s.audioContext.listener.setOrientation(0,0,0,0,1,0);for(u=0;u<G.mainSoundTrack.soundCollection.length;u++){const s=G.mainSoundTrack.soundCollection[u];s.useCustomAttenuation&&s.updateDistanceFromListener()}if(G.soundTracks)for(u=0;u<G.soundTracks.length;u++)for(let s=0;s<G.soundTracks[u].soundCollection.length;s++){const T=G.soundTracks[u].soundCollection[s];T.useCustomAttenuation&&T.updateDistanceFromListener()}}}}LG._CameraDirection=new z.q(0,0,-1),oG._SceneComponentInitialization=u=>{let G=u._getComponent(DG.d.NAME_AUDIO);G||(G=new LG(u),u.o(G))};const SG="MSFT_audio_emitter";class eG{constructor(u){this.name=SG,this._loader=u,this.enabled=this._loader.isExtensionUsed(SG)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const u=this._loader.Ei.extensions;if(u&&u[this.name]){const G=u[this.name];this._clips=G.clips,this._emitters=G.emitters,Z.Assign(this._clips),Z.Assign(this._emitters)}}loadSceneAsync(u,G){return t.LoadExtensionAsync(u,G,this.name,((s,T)=>{const z=new Array;z.push(this._loader.loadSceneAsync(u,G));for(const u of T.emitters){const G=Z.Get(`${s}/emitters`,this._emitters,u);if(void 0!=G.refDistance||void 0!=G.maxDistance||void 0!=G.rolloffFactor||void 0!=G.distanceModel||void 0!=G.innerAngle||void 0!=G.outerAngle)throw new Error(`${s}: Direction or Distance properties are not allowed on emitters attached to a scene`);z.push(this._loadEmitterAsync(`${s}/emitters/${G.index}`,G))}return Promise.all(z).then((()=>{}))}))}loadNodeAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((u,T)=>{const O=new Array;return this._loader.loadNodeAsync(u,G,(G=>{for(const s of T.emitters){const T=Z.Get(`${u}/emitters`,this._emitters,s);O.push(this._loadEmitterAsync(`${u}/emitters/${T.index}`,T).then((()=>{for(const u of T._babylonSounds)u.attachToMesh(G),void 0==T.innerAngle&&void 0==T.outerAngle||(u.setLocalDirectionToMesh(z.q.Forward()),u.setDirectionalCone(2*m.e.ToDegrees(void 0==T.innerAngle?Math.PI:T.innerAngle),2*m.e.ToDegrees(void 0==T.outerAngle?Math.PI:T.outerAngle),0))})))}s(G)})).then((u=>Promise.all(O).then((()=>u))))}))}loadAnimationAsync(u,G){return t.LoadExtensionAsync(u,G,this.name,((s,T)=>this._loader.loadAnimationAsync(u,G).then((z=>{const O=new Array;Z.Assign(T.events);for(const m of T.events)O.push(this._loadAnimationEventAsync(`${s}/events/${m.index}`,u,G,m,z));return Promise.all(O).then((()=>z))}))))}_loadClipAsync(u,G){if(G._objectURL)return G._objectURL;let s;if(G.uri)s=this._loader.loadUriAsync(u,G,G.uri);else{const T=Z.Get(`${u}/bufferView`,this._loader.Ei.bufferViews,G.bufferView);s=this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}return G._objectURL=s.then((u=>URL.createObjectURL(new Blob([u],{type:G.mimeType})))),G._objectURL}_loadEmitterAsync(u,G){if(G._babylonSounds=G._babylonSounds||[],!G._babylonData){const u=new Array,s=G.name||`emitter${G.index}`,T={loop:!1,autoplay:!1,volume:void 0==G.volume?1:G.volume};for(let O=0;O<G.clips.length;O++){const z=`/extensions/${this.name}/clips`,m=Z.Get(z,this._clips,G.clips[O].clip);u.push(this._loadClipAsync(`${z}/${G.clips[O].clip}`,m).then((u=>{const z=G._babylonSounds[O]=new oG(s,u,this._loader.babylonScene,null,T);z.refDistance=G.refDistance||1,z.maxDistance=G.maxDistance||256,z.rolloffFactor=G.rolloffFactor||1,z.distanceModel=G.distanceModel||"exponential"})))}const z=Promise.all(u).then((()=>{const u=G.clips.map((u=>u.weight||1)),s=new RG(G.loop||!1,G._babylonSounds,u);G.innerAngle&&(s.directionalConeInnerAngle=2*m.e.ToDegrees(G.innerAngle)),G.outerAngle&&(s.directionalConeOuterAngle=2*m.e.ToDegrees(G.outerAngle)),G.volume&&(s.volume=G.volume),G._babylonData.sound=s}));G._babylonData={loaded:z}}return G._babylonData.loaded}_getEventAction(u,G,s,T,z){switch(s){case"play":return u=>{const s=(z||0)+(u-T);G.play(s)};case"stop":return()=>{G.stop()};case"pause":return()=>{G.pause()};default:throw new Error(`${u}: Unsupported action ${s}`)}}_loadAnimationEventAsync(u,G,s,T,z){if(0==z.targetedAnimations.length)return Promise.resolve();const O=z.targetedAnimations[0],m=T.k,f=Z.Get(`/extensions/${this.name}/emitters`,this._emitters,m);return this._loadEmitterAsync(u,f).then((()=>{const G=f._babylonData.sound;if(G){const s=new vG(T.time,this._getEventAction(u,G,T.action,T.time,T.startOffset));O.animation.addEvent(s),z.onAnimationGroupEndObservable.add((()=>{G.stop()})),z.onAnimationGroupPauseObservable.add((()=>{G.pause()}))}}))}}a(SG),y(SG,!0,(u=>new eG(u)));const hG="MSFT_lod";class IG{constructor(u){var G;this.name=hG,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new g.e,this.onMaterialLODsLoadedObservable=new g.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=u,this.maxLODsToLoad=(null===(G=this._loader.parent.extensionOptions[hG])||void 0===G?void 0:G.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(hG)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let u=0;u<this._nodePromiseLODs.length;u++){const G=Promise.all(this._nodePromiseLODs[u]).then((()=>{0!==u&&(this._loader.endPerformanceCounter(`Node LOD ${u}`),this._loader.log(`Loaded node LOD ${u}`)),this.onNodeLODsLoadedObservable.notifyObservers(u),u!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${u+1}`),this._loadBufferLOD(this._nodeBufferLODs,u+1),this._nodeSignalLODs[u]&&this._nodeSignalLODs[u].resolve())}));this._loader._completePromises.push(G)}for(let u=0;u<this._materialPromiseLODs.length;u++){const G=Promise.all(this._materialPromiseLODs[u]).then((()=>{0!==u&&(this._loader.endPerformanceCounter(`Material LOD ${u}`),this._loader.log(`Loaded material LOD ${u}`)),this.onMaterialLODsLoadedObservable.notifyObservers(u),u!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${u+1}`),this._loadBufferLOD(this._materialBufferLODs,u+1),this._materialSignalLODs[u]&&this._materialSignalLODs[u].resolve())}));this._loader._completePromises.push(G)}}loadSceneAsync(u,G){const s=this._loader.loadSceneAsync(u,G);return this._loadBufferLOD(this._bufferLODs,0),s}loadNodeAsync(u,G,s){return t.LoadExtensionAsync(u,G,this.name,((u,z)=>{let O;const m=this._getLODs(u,G,this._loader.Ei.nodes,z.ids);this._loader.logOpen(`${u}`);for(let G=0;G<m.length;G++){const u=m[G];0!==G&&(this._nodeIndexLOD=G,this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new T);const z=u=>{s(u),u.Af(!1)},f=this._loader.loadNodeAsync(`/nodes/${u.index}`,u,z).then((u=>{if(0!==G){const u=m[G-1];u._babylonTransformNode&&(this._disposeTransformNode(u._babylonTransformNode),delete u._babylonTransformNode)}return u.Af(!0),u}));this._nodePromiseLODs[G]=this._nodePromiseLODs[G]||[],0===G?O=f:(this._nodeIndexLOD=null,this._nodePromiseLODs[G].push(f))}return this._loader.logClose(),O}))}_loadMaterialAsync(u,G,s,T,z){return this._nodeIndexLOD?null:t.LoadExtensionAsync(u,G,this.name,((u,O)=>{let m;const f=this._getLODs(u,G,this._loader.Ei.materials,O.ids);this._loader.logOpen(`${u}`);for(let G=0;G<f.length;G++){const u=f[G];0!==G&&(this._materialIndexLOD=G);const O=this._loader._loadMaterialAsync(`/materials/${u.index}`,u,s,T,(u=>{0===G&&z(u)})).then((u=>{if(0!==G){z(u);const s=f[G-1]._data;s[T]&&(this._disposeMaterials([s[T].babylonMaterial]),delete s[T])}return u}));this._materialPromiseLODs[G]=this._materialPromiseLODs[G]||[],0===G?m=O:(this._materialIndexLOD=null,this._materialPromiseLODs[G].push(O))}return this._loader.logClose(),m}))}_loadUriAsync(u,G,s){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const z=this._nodeIndexLOD-1;return this._nodeSignalLODs[z]=this._nodeSignalLODs[z]||new T,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(u,G,s)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const z=this._materialIndexLOD-1;return this._materialSignalLODs[z]=this._materialSignalLODs[z]||new T,this._materialSignalLODs[z].promise.then((()=>this._loader.loadUriAsync(u,G,s)))}return null}loadBufferAsync(u,G,s,z){if(this._loader.parent.useRangeRequests&&!G.uri){if(!this._loader.bin)throw new Error(`${u}: Uri is missing or the binary glTF is missing its binary chunk`);const G=(u,G)=>{const O=s,m=O+z-1;let f=u[G];return f?(f.start=Math.min(f.start,O),f.end=Math.max(f.end,m)):(f={start:O,end:m,loaded:new T},u[G]=f),f.loaded.promise.then((u=>new Uint8Array(u.buffer,u.byteOffset+s-f.start,z)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?G(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?G(this._materialBufferLODs,this._materialIndexLOD):G(this._bufferLODs,0)}return null}_loadBufferLOD(u,G){const s=u[G];s&&(this._loader.log(`Loading buffer range [${s.start}-${s.end}]`),this._loader.bin.readAsync(s.start,s.end-s.start+1).then((u=>{s.loaded.resolve(u)}),(u=>{s.loaded.reject(u)})))}_getLODs(u,G,s,T){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const z=[];for(let O=T.length-1;O>=0;O--)if(z.push(Z.Get(`${u}/ids/${T[O]}`,s,T[O])),z.length===this.maxLODsToLoad)return z;return z.push(G),z}_disposeTransformNode(u){const G=[],s=u.material;s&&G.push(s);for(const z of u.getChildMeshes())z.material&&G.push(z.material);u.dispose();const T=G.filter((u=>this._loader.babylonScene.meshes.every((G=>G.material!=u))));this._disposeMaterials(T)}_disposeMaterials(u){const G={};for(const s of u){for(const u of s.getActiveTextures())G[u.uniqueId]=u;s.dispose()}for(const s in G)for(const u of this._loader.babylonScene.materials)u.hasTexture(G[s])&&delete G[s];for(const s in G)G[s].dispose()}}a(hG),y(hG,!0,(u=>new IG(u)));const iG="MSFT_minecraftMesh";class JG{constructor(u){this.name=iG,this._loader=u,this.enabled=this._loader.isExtensionUsed(iG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtraAsync(u,G,this.name,((T,z)=>{if(z){if(!(s instanceof q))throw new Error(`${T}: Material type not supported`);const z=this._loader.loadMaterialPropertiesAsync(u,G,s);return s.needAlphaBlending()&&(s.forceDepthWrite=!0,s.separateCullingPass=!0),s.Ig=s.forceDepthWrite,s.twoSidedLighting=!0,z}return null}))}}a(iG),y(iG,!0,(u=>new JG(u)));const AG="MSFT_sRGBFactors";class NG{constructor(u){this.name=AG,this._loader=u,this.enabled=this._loader.isExtensionUsed(AG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(u,G,s){return t.LoadExtraAsync(u,G,this.name,((T,z)=>{if(z){if(!(s instanceof q))throw new Error(`${T}: Material type not supported`);const z=this._loader.loadMaterialPropertiesAsync(u,G,s),O=s.va().getEngine().useExactSrgbConversions;return s.albedoTexture||s.albedoColor.toLinearSpaceToRef(s.albedoColor,O),s.reflectivityTexture||s.reflectivityColor.toLinearSpaceToRef(s.reflectivityColor,O),z}return null}))}}a(AG),y(AG,!0,(u=>new NG(u)));var yG,aG=s(10720);!function(u){u[u.Input=0]="Input",u[u.Output=1]="Output"}(yG||(yG={}));class KG{constructor(u,G,s){this._ownerBlock=s,this._connectedPoint=[],this.uniqueId=(0,aG.c)(),this.connectedPointIds=[],this.name=u,this._connectionType=G}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(u){if(this._connectionType===u._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||u._isSingularConnection()&&u._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(u),u._connectedPoint.push(this)}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u.uniqueId=this.uniqueId,u.name=this.name,u._connectionType=this._connectionType,u.connectedPointIds=[],u.className=this.getClassName();for(const G of this._connectedPoint)u.connectedPointIds.push(G.uniqueId)}getClassName(){return"FGConnection"}deserialize(u){this.uniqueId=u.uniqueId,this.name=u.name,this._connectionType=u._connectionType,this.connectedPointIds=u.connectedPointIds}static Parse(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1?arguments[1]:void 0;const s=new(m.e.Instantiate(u.className))(u.name,u._connectionType,G);return s.deserialize(u),s}}class ZG{constructor(u){this.value=this._toInt(u)}_toInt(u){return 0|u}add(u){return new ZG(this.value+u.value)}Nc(u){return new ZG(this.value-u.value)}multiply(u){return new ZG(Math.imul(this.value,u.value))}divide(u){return new ZG(this.value/u.value)}getClassName(){return ZG.ClassName}equals(u){return this.value===u.value}static Parse(u){return new ZG(u.value)}}ZG.ClassName="FlowGraphInteger",(0,X.g)("FlowGraphInteger",ZG);class tG{constructor(u,G){this.typeName=u,this.defaultValue=G}serialize(u){u.typeName=this.typeName,u.defaultValue=this.defaultValue}static Parse(u){return new tG(u.typeName,u.defaultValue)}}const EG=new tG("any",void 0),UG=(new tG("string",""),new tG("number",0)),us=new tG("boolean",!1),Gs=new tG("Vector2",z.m.Zero()),ss=new tG("gb",z.q.Zero()),Ts=(new tG("Vector4",z.s.Zero()),new tG("Matrix",z.d.Identity())),zs=(new tG("hb",O.b.Black()),new tG("ob",new O.e(0,0,0,0)),new tG("Quaternion",z.h.Identity()),new tG("FlowGraphInteger",new ZG(0)));class Os extends KG{constructor(u,G,s,T){super(u,G,s),this.richType=T}_isSingularConnection(){return 0===this.connectionType}setValue(u,G){G._setConnectionValue(this,u)}connectTo(u){super.connectTo(u)}_getValueOrDefault(u){return u._hasConnectionValue(this)?u._getConnectionValue(this):this.richType.defaultValue}getValue(u){return 1===this.connectionType?(u._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(u),this._getValueOrDefault(u)):this.isConnected()?this._connectedPoint[0].getValue(u):this._getValueOrDefault(u)}getClassName(){return"FGDataConnection"}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.richType={},this.richType.serialize(u.richType)}static Parse(u,G){const s=KG.Parse(u,G);return s.richType=tG.Parse(u.richType),s}}function ms(u){return"Mesh"===u||"AbstractMesh"===u||"GroundMesh"===u||"InstanceMesh"===u||"LinesMesh"===u||"GoldbergMesh"===u||"GreasedLineMesh"===u||"TrailMesh"===u}function fs(u){return"Vector2"===u||"gb"===u||"Vector4"===u||"Quaternion"===u||"hb"===u||"ob"===u}function Cs(u,G,s){var T;const z=(null===G||void 0===G||null===(T=G.getClassName)||void 0===T?void 0:T.call(G))??"";ms(z)?s[u]={name:G.name,className:z}:fs(z)?s[u]={value:G.$i(),className:z}:s[u]=G}function xs(u,G,s){const T=G[u];let m;const f=null===T||void 0===T?void 0:T.className;return m=ms(f)?s.getMeshByName(T.name):fs(f)?function(u,G){if("Vector2"===u)return z.m.Ag(G);if("gb"===u)return z.q.Ag(G);if("Vector4"===u)return z.s.Ag(G);if("Quaternion"===u)return z.h.Ag(G);if("hb"===u)return new O.b(G[0],G[1],G[2]);if("ob"===u)return new O.e(G[0],G[1],G[2],G[3]);throw new Error(`Unknown vector class name ${u}`)}(f,T.value):"Matrix"===f?z.d.Ag(T.value):f===ZG.ClassName?ZG.Parse(T):T&&void 0!==T.value?T.value:T,m}(0,X.g)("FGDataConnection",Os);class gs{constructor(u){var G;this.config=u,this.uniqueId=(0,aG.c)(),this.name=(null===(G=this.config)||void 0===G?void 0:G.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(u){}registerDataInput(u,G){const s=new Os(u,0,this,G);return this.dataInputs.push(s),s}registerDataOutput(u,G){const s=new Os(u,1,this,G);return this.dataOutputs.push(s),s}getDataInput(u){return this.dataInputs.find((G=>G.name===u))}getDataOutput(u){return this.dataOutputs.find((G=>G.name===u))}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u.uniqueId=this.uniqueId,u.config={},this.config&&(u.config.name=this.config.name),u.dataInputs=[],u.dataOutputs=[],u.className=this.getClassName();for(const G of this.dataInputs){const s={};G.serialize(s),u.dataInputs.push(s)}for(const G of this.dataOutputs){const s={};G.serialize(s),u.dataOutputs.push(s)}}getClassName(){return"FGBlock"}static Parse(u,G){const s=m.e.Instantiate(u.className),T={},z=G.valueParseFunction??xs;if(u.config)for(const m in u.config)T[m]=z(m,u.config,G.wf);var O;("FGSetPropertyBlock"===(O=u.className)||"FGGetPropertyBlock"===O||"FGPlayAnimationBlock"===O||"FGMeshPickEventBlock"===O)&&(T.pathConverter=G.pathConverter);const f=new s(T);f.uniqueId=u.uniqueId;for(let m=0;m<u.dataInputs.length;m++){const G=f.getDataInput(u.dataInputs[m].name);if(!G)throw new Error("Could not find data input with name "+u.dataInputs[m].name+" in block "+u.className);G.deserialize(u.dataInputs[m])}for(let m=0;m<u.dataOutputs.length;m++){const G=f.getDataOutput(u.dataOutputs[m].name);if(!G)throw new Error("Could not find data output with name "+u.dataOutputs[m].name+" in block "+u.className);G.deserialize(u.dataOutputs[m])}return f.metadata=u.metadata,f.deserialize&&f.deserialize(u),f}}class bs extends KG{_isSingularConnection(){return 1===this.connectionType}_activateSignal(u){var G;0===this.connectionType?(u._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(u,this),u._increaseExecutionId()):null===(G=this._connectedPoint[0])||void 0===G||G._activateSignal(u)}}(0,X.g)("FlowGraphSignalConnection",bs);class Qs extends gs{constructor(u){super(u),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(u){const G=new bs(u,0,this);return this.signalInputs.push(G),G}_registerSignalOutput(u){const G=new bs(u,1,this);return this.signalOutputs.push(G),G}getSignalInput(u){return this.signalInputs.find((G=>G.name===u))}getSignalOutput(u){return this.signalOutputs.find((G=>G.name===u))}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.signalInputs=[],u.signalOutputs=[];for(const G of this.signalInputs){const s={};G.serialize(s),u.signalInputs.push(s)}for(const G of this.signalOutputs){const s={};G.serialize(s),u.signalOutputs.push(s)}}deserialize(u){for(let G=0;G<u.signalInputs.length;G++){const s=this.getSignalInput(u.signalInputs[G].name);if(!s)throw new Error("Could not find signal input with name "+u.signalInputs[G].name+" in block "+u.className);s.deserialize(u.signalInputs[G])}for(let G=0;G<u.signalOutputs.length;G++){const s=this.getSignalOutput(u.signalOutputs[G].name);if(!s)throw new Error("Could not find signal output with name "+u.signalOutputs[G].name+" in block "+u.className);s.deserialize(u.signalOutputs[G])}}getClassName(){return"FGExecutionBlock"}}class Ys extends Qs{constructor(u){super(u),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(u){this._preparePendingTasks(u),u._addPendingBlock(this)}}class ns extends Ys{_execute(u){u._notifyExecuteNode(this),this.out._activateSignal(u)}}class Vs{constructor(u){this.uniqueId=(0,aG.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new g.e,this._configuration=u}hasVariable(u){return u in this._userVariables}setVariable(u,G){this._userVariables[u]=G}getVariable(u){return this._userVariables[u]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(u,G){return`${u.uniqueId}_${G}`}_setExecutionVariable(u,G,s){this._executionVariables[this._getUniqueIdPrefixedName(u,G)]=s}_getExecutionVariable(u,G,s){return this._hasExecutionVariable(u,G)?this._executionVariables[this._getUniqueIdPrefixedName(u,G)]:s}_deleteExecutionVariable(u,G){delete this._executionVariables[this._getUniqueIdPrefixedName(u,G)]}_hasExecutionVariable(u,G){return this._getUniqueIdPrefixedName(u,G)in this._executionVariables}_hasConnectionValue(u){return u.uniqueId in this._connectionValues}_setConnectionValue(u,G){this._connectionValues[u.uniqueId]=G}_getConnectionValue(u){return this._connectionValues[u.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(u){this._pendingBlocks.push(u)}_removePendingBlock(u){const G=this._pendingBlocks.indexOf(u);-1!==G&&this._pendingBlocks.splice(G,1)}_clearPendingBlocks(){for(const u of this._pendingBlocks)u._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(u){this.onNodeExecutedObservable.notifyObservers(u)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Cs;u.uniqueId=this.uniqueId,u._userVariables={};for(const s in this._userVariables)G(s,this._userVariables[s],u._userVariables);u._connectionValues={};for(const s in this._connectionValues)G(s,this._connectionValues[s],u._connectionValues)}getClassName(){return"FGContext"}static Parse(u,G){const s=G.graph.createContext(),T=G.valueParseFunction??xs;s.uniqueId=u.uniqueId;for(const z in u._userVariables){const G=T(z,u._userVariables,s._configuration.wf);s._userVariables[z]=G}for(const z in u._connectionValues){const G=T(z,u._connectionValues,s._configuration.wf);s._connectionValues[z]=G}return s}}(0,j.b)([(0,l.M)()],Vs.prototype,"uniqueId",void 0);var Fs,rs,cs=s(10991);function js(u,G){return!(!u.parent||u.parent!==G&&!js(u.parent,G))}class ls extends ns{constructor(u){super(u),this.config=u}_getReferencedMesh(){const u=this.config.pathConverter.convert(this.config.path),G=u.info.getObject(u.object);if(!G||!(G instanceof o.d))throw new Error("Mesh pick event block requires a valid mesh");return G}_preparePendingTasks(u){let G=u._getExecutionVariable(this,"meshPickObserver");if(!G){const s=this._getReferencedMesh();u._setExecutionVariable(this,"mesh",s),G=s.va().onPointerObservable.add((G=>{var T,z,O;G.type===cs.d.POINTERPICK&&null!==(T=G.pickInfo)&&void 0!==T&&T.pickedMesh&&((null===(z=G.pickInfo)||void 0===z?void 0:z.pickedMesh)===s||js(null===(O=G.pickInfo)||void 0===O?void 0:O.pickedMesh,s))&&this._execute(u)}));const T=s._i.add((()=>this._onDispose));u._setExecutionVariable(this,"meshPickObserver",G),u._setExecutionVariable(this,"meshDisposeObserver",T)}}_onDispose(u){this._cancelPendingTasks(u),u._removePendingBlock(this)}_cancelPendingTasks(u){const G=u._getExecutionVariable(this,"mesh"),s=u._getExecutionVariable(this,"meshPickObserver"),T=u._getExecutionVariable(this,"meshDisposeObserver");G.va().onPointerObservable.remove(s),G._i.remove(T),u._deleteExecutionVariable(this,"mesh"),u._deleteExecutionVariable(this,"meshPickObserver"),u._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return ls.ClassName}serialize(u){super.serialize(u),u.config.path=this.config.path}}ls.ClassName="FGMeshPickEventBlock",(0,X.g)(ls.ClassName,ls),function(u){u[u.Stopped=0]="Stopped",u[u.Started=1]="Started"}(Fs||(Fs={}));class Ps{constructor(u){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=u.wf,this._coordinator=u.coordinator,this._sceneDisposeObserver=this._scene._i.add((()=>this.dispose()))}createContext(){const u=new Vs({wf:this._scene,coordinator:this._coordinator});return this._executionContexts.push(u),u}getContext(u){return this._executionContexts[u]}addEventBlock(u){this._eventBlocks.push(u)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const u of this._executionContexts){const G=this._getContextualOrder();for(const s of G)s._startPendingTasks(u)}}}_getContextualOrder(){const u=[];for(const G of this._eventBlocks)if(G.getClassName()===ls.ClassName){const s=G._getReferencedMesh();let T=0;for(;T<u.length;T++){const G=u[T]._getReferencedMesh();if(s&&G&&js(s,G))break}u.splice(T,0,G)}else u.push(G);return u}dispose(){if(0!==this.state){this.state=0;for(const u of this._executionContexts)u._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene._i.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(u){const G=[],s=new Set;for(const T of this._eventBlocks)G.push(T),s.add(T.uniqueId);for(;G.length>0;){const T=G.pop();u(T);for(const u of T.dataInputs)for(const T of u._connectedPoint)s.has(T._ownerBlock.uniqueId)||(G.push(T._ownerBlock),s.add(T._ownerBlock.uniqueId));if(T instanceof Qs)for(const u of T.signalOutputs)for(const T of u._connectedPoint)s.has(T._ownerBlock.uniqueId)||(G.push(T._ownerBlock),s.add(T._ownerBlock.uniqueId))}}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},G=arguments.length>1?arguments[1]:void 0;u.allBlocks=[],this.visitAllBlocks((G=>{const s={};G.serialize(s),u.allBlocks.push(s)})),u.executionContexts=[];for(const s of this._executionContexts){const T={};s.serialize(T,G),u.executionContexts.push(T)}}static GetDataOutConnectionByUniqueId(u,G){for(const s of u)for(const u of s.dataOutputs)if(u.uniqueId===G)return u;throw new Error("Could not find data out connection with unique id "+G)}static GetSignalInConnectionByUniqueId(u,G){for(const s of u)if(s instanceof Qs)for(const u of s.signalInputs)if(u.uniqueId===G)return u;throw new Error("Could not find signal in connection with unique id "+G)}static Parse(u,G){const s=G.coordinator.createGraph(),T=[],z=G.valueParseFunction??xs;for(const O of u.allBlocks){const u=gs.Parse(O,{wf:G.coordinator.config.wf,pathConverter:G.pathConverter,valueParseFunction:z});T.push(u),u instanceof ns&&s.addEventBlock(u)}for(const O of T){for(const u of O.dataInputs)for(const G of u.connectedPointIds){const s=Ps.GetDataOutConnectionByUniqueId(T,G);u.connectTo(s)}if(O instanceof Qs)for(const u of O.signalOutputs)for(const G of u.connectedPointIds){const s=Ps.GetSignalInConnectionByUniqueId(T,G);u.connectTo(s)}}for(const O of u.executionContexts)Vs.Parse(O,{graph:s,valueParseFunction:z});return s}}class Hs{constructor(u){this.config=u,this._flowGraphs=[],this._customEventsMap=new Map,this.config.wf._i.add((()=>{this.dispose()}));(Hs.SceneCoordinators.get(this.config.wf)??[]).push(this)}createGraph(){const u=new Ps({wf:this.config.wf,coordinator:this});return this._flowGraphs.push(u),u}removeGraph(u){const G=this._flowGraphs.indexOf(u);-1!==G&&(u.dispose(),this._flowGraphs.splice(G,1))}start(){this._flowGraphs.forEach((u=>u.start()))}dispose(){this._flowGraphs.forEach((u=>u.dispose())),this._flowGraphs.length=0;const u=Hs.SceneCoordinators.get(this.config.wf)??[],G=u.indexOf(this);-1!==G&&u.splice(G,1)}serialize(u,G){u._flowGraphs=[],this._flowGraphs.forEach((s=>{const T={};s.serialize(T,G),u._flowGraphs.push(T)}))}static Parse(u,G){var s;const T=G.valueParseFunction??xs,z=new Hs({wf:G.wf});return null===(s=u._flowGraphs)||void 0===s||s.forEach((u=>{Ps.Parse(u,{coordinator:z,valueParseFunction:T,pathConverter:G.pathConverter})})),z}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(u){let G=this._customEventsMap.get(u);return G||(G=new g.e,this._customEventsMap.set(u,G)),G}notifyCustomEvent(u,G){const s=this._customEventsMap.get(u);s&&s.notifyObservers(G)}}Hs.SceneCoordinators=new Map;class Xs extends ns{_preparePendingTasks(u){if(!u._getExecutionVariable(this,"sceneReadyObserver")){const G=u.configuration.wf.onReadyObservable.add((()=>{this._execute(u)}));u._setExecutionVariable(this,"sceneReadyObserver",G)}}_cancelPendingTasks(u){const G=u._getExecutionVariable(this,"sceneReadyObserver");u.configuration.wf.onReadyObservable.remove(G),u._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Xs.ClassName}}Xs.ClassName="FGSceneReadyEventBlock",(0,X.g)("FGSceneReadyEventBlock",Xs);class ps extends ns{_preparePendingTasks(u){if(!u._getExecutionVariable(this,"sceneBeforeRender")){const G=u.configuration.wf.onBeforeRenderObservable.add((()=>{this._execute(u)}));u._setExecutionVariable(this,"sceneBeforeRender",G)}}_cancelPendingTasks(u){const G=u._getExecutionVariable(this,"sceneBeforeRender");u.configuration.wf.onBeforeRenderObservable.remove(G),u._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return ps.ClassName}}ps.ClassName="FGSceneTickEventBlock",(0,X.g)(ps.ClassName,ps);class qs extends Qs{constructor(u){super(u),this.out=this._registerSignalOutput("out")}}class ds extends qs{constructor(u){super(u),this.message=this.registerDataInput("message",EG)}_execute(u){const G=this.message.getValue(u);V.d.Log(G),this.out._activateSignal(u)}getClassName(){return ds.ClassName}}ds.ClassName="FGConsoleLogBlock",(0,X.g)(ds.ClassName,ds),function(u){u[u.INIT=0]="INIT",u[u.STARTED=1]="STARTED",u[u.ENDED=2]="ENDED"}(rs||(rs={}));class vs{constructor(u){this.onEachCountObservable=new g.e,this.onTimerAbortedObservable=new g.e,this.onTimerEndedObservable=new g.e,this.onStateChangedObservable=new g.e,this._observer=null,this._breakOnNextTick=!1,this._tick=u=>{const G=Date.now();this._timer=G-this._startTime;const s={startTime:this._startTime,currentTime:G,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:u},T=this._breakOnNextTick||this._breakCondition(s);T||this._timer>=this._timeToEnd?this._stop(s,T):this.onEachCountObservable.notifyObservers(s)},this._setState(0),this._contextObservable=u.contextObservable,this._observableParameters=u.observableParameters??{},this._breakCondition=u.breakCondition??(()=>!1),this._timeToEnd=u.timeout,u.onEnded&&this.onTimerEndedObservable.add(u.onEnded),u.Th&&this.onEachCountObservable.add(u.Th),u.onAborted&&this.onTimerAbortedObservable.add(u.onAborted)}set breakCondition(u){this._breakCondition=u}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=u,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(u){this._state=u,this.onStateChangedObservable.notifyObservers(this._state)}_stop(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),G?this.onTimerAbortedObservable.notifyObservers(u):this.onTimerEndedObservable.notifyObservers(u)}}class Ws extends Ys{constructor(u){super(u),this.timeout=this.registerDataInput("timeout",UG)}_preparePendingTasks(u){const G=this.timeout.getValue(u);if(void 0!==G&&G>=0){const s=u._getExecutionVariable(this,"runningTimers")||[],T=u.configuration.wf,z=new vs({timeout:G,contextObservable:T.onBeforeRenderObservable,onEnded:()=>this._onEnded(z,u)});z.start(),s.push(z),u._setExecutionVariable(this,"runningTimers",s)}}_execute(u){this._startPendingTasks(u),this.out._activateSignal(u)}_onEnded(u,G){const s=G._getExecutionVariable(this,"runningTimers")||[],T=s.indexOf(u);-1!==T?s.splice(T,1):m.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),G._removePendingBlock(this),this.done._activateSignal(G)}_cancelPendingTasks(u){const G=u._getExecutionVariable(this,"runningTimers")||[];for(const s of G)s.dispose();u._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Ws.ClassName}}Ws.ClassName="FGTimerBlock",(0,X.g)("FGTimerBlock",Ws);class Ms extends qs{constructor(u){super(u),this.config=u;for(let G=0;G<this.config.eventData.length;G++){const u=this.config.eventData[G];this.registerDataInput(u,EG)}}_execute(u){const G=this.config.eventId,s=this.dataInputs.map((G=>G.getValue(u)));u.configuration.coordinator.notifyCustomEvent(G,s),this.out._activateSignal(u)}getClassName(){return Ms.ClassName}}Ms.ClassName="FGSendCustomEventBlock",(0,X.g)("FGSendCustomEventBlock",Ms);class os extends ns{constructor(u){super(u),this.config=u;for(let G=0;G<this.config.eventData.length;G++){const u=this.config.eventData[G];this.registerDataOutput(u,EG)}}_preparePendingTasks(u){const G=u.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=G.add((G=>{for(let s=0;s<G.length;s++)this.dataOutputs[s].setValue(G[s],u);this._execute(u)}))}_cancelPendingTasks(u){const G=u.configuration.coordinator.getCustomEventObservable(this.config.eventId);G?G.remove(this._eventObserver):m.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return os.ClassName}serialize(u){super.serialize(u),u.eventId=this.config.eventId,u.eventData=this.config.eventData}}os.ClassName="FGReceiveCustomEventBlock",(0,X.g)(os.ClassName,os);class Rs extends Qs{constructor(u){super(u),this.config=u,this.outFlows=[];for(let G=0;G<this.config.numberOutputFlows;G++)this.outFlows.push(this._registerSignalOutput(`${G}`))}_execute(u){for(let G=0;G<this.config.numberOutputFlows;G++)this.outFlows[G]._activateSignal(u)}getClassName(){return Rs.ClassName}}Rs.ClassName="FGSequenceBlock",(0,X.g)(Rs.ClassName,Rs);const Bs=new RegExp(/\{(\w+)\}/g);class Ds{constructor(u,G){this.path=u,this.ownerBlock=G,this.templatedInputs=[];let s=Bs.exec(u);for(;s;){const[,T]=s;this.templatedInputs.push(G.registerDataInput(T,zs)),s=Bs.exec(u)}}getAccessor(u,G){let s=this.path;for(const T of this.templatedInputs){const u=T.getValue(G).value;s=s.replace(`{${T.name}}`,u.toString())}return u.convert(s)}}class ks extends gs{constructor(u){super(u),this.config=u,this.value=this.registerDataOutput("value",EG),this.templateComponent=new Ds(u.path,this)}_updateOutputs(u){const G=this.templateComponent.getAccessor(this.config.pathConverter,u),s=G.info.get(G.object);this.value.setValue(s,u)}getClassName(){return ks.ClassName}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.config.path=this.config.path}}ks.ClassName="FGGetPropertyBlock",(0,X.g)(ks.ClassName,ks);class ws extends qs{constructor(u){super(u),this.config=u,this.a=this.registerDataInput("a",EG),this.templateComponent=new Ds(u.path,this)}_execute(u){const G=this.a.getValue(u),s=this.templateComponent.getAccessor(this.config.pathConverter,u);s.info.set(G,s.object),this.out._activateSignal(u)}serialize(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(u),u.config.path=this.config.path}getClassName(){return ws.ClassName}}ws.ClassName="FGSetPropertyBlock",(0,X.g)("FGSetPropertyBlock",ws);const Ls="cachedOperationValue",Ss="cachedExecutionId";class es extends gs{constructor(u,G){super(G),this.value=this.registerDataOutput("value",u)}_updateOutputs(u){const G=u._getExecutionVariable(this,Ss),s=u._getExecutionVariable(this,Ls);if(void 0!==s&&G===u.executionId)this.value.setValue(s,u);else{const G=this._doOperation(u);u._setExecutionVariable(this,Ls,G),u._setExecutionVariable(this,Ss,u.executionId),this.value.setValue(G,u)}}}class hs extends es{constructor(u,G,s,T,z,O){super(s,O),this._operation=T,this._className=z,this.a=this.registerDataInput("a",u),this.b=this.registerDataInput("b",G)}_doOperation(u){return this._operation(this.a.getValue(u),this.b.getValue(u))}getClassName(){return this._className}}class Is extends es{constructor(u,G,s,T){super(u,T),this._operation=G,this._className=s}_doOperation(u){return this._operation()}getClassName(){return this._className}}class is extends es{constructor(u,G,s,T,z){super(G,z),this._operation=s,this._className=T,this.a=this.registerDataInput("a",u)}_doOperation(u){return this._operation(this.a.getValue(u))}getClassName(){return this._className}}class Js extends es{constructor(u,G,s,T,z,O,m){super(T,m),this._operation=z,this._className=O,this.a=this.registerDataInput("a",u),this.b=this.registerDataInput("b",G),this.c=this.registerDataInput("c",s)}_doOperation(u){return this._operation(this.a.getValue(u),this.b.getValue(u),this.c.getValue(u))}getClassName(){return this._className}}function As(u){return u.getClassName?u.getClassName():""}function Ns(u,G){return"Vector2"===u&&"Vector2"===G||"gb"===u&&"gb"===G||"Vector4"===u&&"Vector4"===G}function ys(u,G){return"Matrix"===u&&"Matrix"===G}function as(u,G){return"FlowGraphInteger"===u&&"FlowGraphInteger"===G}class Ks extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicAdd(u,G)),Ks.ClassName,u)}_polymorphicAdd(u,G){const s=As(u),T=As(G);return Ns(s,T)||ys(s,T)||as(s,T)?u.add(G):u+G}}Ks.ClassName="FGAddBlock",(0,X.g)(Ks.ClassName,Ks);class Zs extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicAdd(u,G)),Zs.ClassName,u)}_polymorphicAdd(u,G){const s=As(u),T=As(G);return Ns(s,T)||as(s,T)?u.Nc(G):ys(s,T)?u.add(G.scale(-1)):u-G}}Zs.ClassName="FGSubBlock",(0,X.g)(Zs.ClassName,Zs);class ts extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicMultiply(u,G)),ts.ClassName,u)}_polymorphicMultiply(u,G){const s=As(u),T=As(G);return Ns(s,T)||as(s,T)?u.multiply(G):ys(s,T)?z.d.FromValues(u.m[0]*G.m[0],u.m[4]*G.m[4],u.m[8]*G.m[8],u.m[12]*G.m[12],u.m[1]*G.m[1],u.m[5]*G.m[5],u.m[9]*G.m[9],u.m[13]*G.m[13],u.m[2]*G.m[2],u.m[6]*G.m[6],u.m[10]*G.m[10],u.m[14]*G.m[14],u.m[3]*G.m[3],u.m[7]*G.m[7],u.m[11]*G.m[11],u.m[15]*G.m[15]):u*G}}ts.ClassName="FGMultiplyBlock",(0,X.g)(ts.ClassName,ts);class Es extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicDivide(u,G)),Es.ClassName,u)}_polymorphicDivide(u,G){const s=As(u),T=As(G);return Ns(s,T)||as(s,T)?u.divide(G):ys(s,T)?z.d.FromValues(u.m[0]/G.m[0],u.m[4]/G.m[4],u.m[8]/G.m[8],u.m[12]/G.m[12],u.m[1]/G.m[1],u.m[5]/G.m[5],u.m[9]/G.m[9],u.m[13]/G.m[13],u.m[2]/G.m[2],u.m[6]/G.m[6],u.m[10]/G.m[10],u.m[14]/G.m[14],u.m[3]/G.m[3],u.m[7]/G.m[7],u.m[11]/G.m[11],u.m[15]/G.m[15]):u/G}}Es.ClassName="FGDivideBlock",(0,X.g)(Es.ClassName,Es);class Us extends Is{constructor(u){super(UG,(()=>Math.random()),Us.ClassName,u)}}Us.ClassName="FGRandomBlock",(0,X.g)(Us.ClassName,Us);class uT extends hs{constructor(u){super(EG,EG,UG,((u,G)=>this._polymorphicDot(u,G)),uT.ClassName,u)}_polymorphicDot(u,G){switch(As(u)){case"Vector2":return z.m.Dot(u,G);case"gb":return z.q.Dot(u,G);case"Vector4":return z.s.Dot(u,G);default:throw new Error(`Cannot get dot product of ${u} and ${G}`)}}}uT.ClassName="FGDotBlock",(0,X.g)(uT.ClassName,uT);class GT extends Is{constructor(u){super(UG,(()=>Math.E),GT.ClassName,u)}}GT.ClassName="FGEBlock",(0,X.g)(GT.ClassName,GT);class sT extends Is{constructor(u){super(UG,(()=>Math.PI),sT.ClassName,u)}}sT.ClassName="FGPIBlock",(0,X.g)(sT.ClassName,sT);class TT extends Is{constructor(u){super(UG,(()=>Number.POSITIVE_INFINITY),TT.ClassName,u)}}TT.ClassName="FGInfBlock",(0,X.g)(TT.ClassName,TT);class zT extends Is{constructor(u){super(UG,(()=>Number.NaN),zT.ClassName,u)}}function OT(u,G){switch(As(u)){case"FlowGraphInteger":return new ZG(G(u.value));case"Vector2":return new z.m(G(u.x),G(u.y));case"gb":return new z.q(G(u.x),G(u.y),G(u.z));case"Vector4":return new z.s(G(u.x),G(u.y),G(u.z),G(u.w));case"Matrix":return z.d.FromValues(G(u.m[0]),G(u.m[4]),G(u.m[8]),G(u.m[12]),G(u.m[1]),G(u.m[5]),G(u.m[9]),G(u.m[13]),G(u.m[2]),G(u.m[6]),G(u.m[10]),G(u.m[14]),G(u.m[3]),G(u.m[7]),G(u.m[11]),G(u.m[15]));default:return G(u)}}zT.ClassName="FGNaNBlock",(0,X.g)(zT.ClassName,zT);class mT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicAbs(u)),mT.ClassName,u)}_polymorphicAbs(u){return OT(u,Math.abs)}}mT.ClassName="FGAbsBlock",(0,X.g)(mT.ClassName,mT);class fT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicSign(u)),fT.ClassName,u)}_polymorphicSign(u){return OT(u,Math.sign)}}fT.ClassName="FGSignBlock",(0,X.g)(fT.ClassName,fT);class CT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicTrunc(u)),CT.ClassName,u)}_polymorphicTrunc(u){return OT(u,Math.trunc)}}CT.ClassName="FGTruncBlock",(0,X.g)(CT.ClassName,CT);class xT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicFloor(u)),xT.ClassName,u)}_polymorphicFloor(u){return OT(u,Math.floor)}}xT.ClassName="FGFloorBlock",(0,X.g)(xT.ClassName,xT);class gT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicCeiling(u)),gT.ClassName,u)}_polymorphicCeiling(u){return OT(u,Math.ceil)}}gT.ClassName="FGCeilBlock",(0,X.g)(gT.ClassName,gT);class bT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicFract(u)),bT.ClassName,u)}_polymorphicFract(u){return OT(u,(u=>u-Math.floor(u)))}}bT.ClassName="FGFractBlock",(0,X.g)(bT.ClassName,bT);class QT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicNeg(u)),QT.ClassName,u)}_polymorphicNeg(u){return OT(u,(u=>-u))}}function YT(u,G,s){switch(As(u)){case"FlowGraphInteger":return new ZG(s(u.value,G.value));case"Vector2":return new z.m(s(u.x,G.x),s(u.y,G.y));case"gb":return new z.q(s(u.x,G.x),s(u.y,G.y),s(u.z,G.z));case"Vector4":return new z.s(s(u.x,G.x),s(u.y,G.y),s(u.z,G.z),s(u.w,G.w));case"Matrix":return z.d.FromValues(s(u.m[0],G.m[0]),s(u.m[4],G.m[4]),s(u.m[8],G.m[8]),s(u.m[12],G.m[12]),s(u.m[1],G.m[1]),s(u.m[5],G.m[5]),s(u.m[9],G.m[9]),s(u.m[13],G.m[13]),s(u.m[2],G.m[2]),s(u.m[6],G.m[6]),s(u.m[10],G.m[10]),s(u.m[14],G.m[14]),s(u.m[3],G.m[3]),s(u.m[7],G.m[7]),s(u.m[11],G.m[11]),s(u.m[15],G.m[15]));default:return s(u,G)}}QT.ClassName="FGNegBlock",(0,X.g)(QT.ClassName,QT);class nT extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicRemainder(u,G)),nT.ClassName,u)}_polymorphicRemainder(u,G){return YT(u,G,((u,G)=>u%G))}}nT.ClassName="FGRemainderBlock",(0,X.g)(nT.ClassName,nT);class VT extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicMin(u,G)),VT.ClassName,u)}_polymorphicMin(u,G){return YT(u,G,Math.min)}}VT.ClassName="FGMinBlock",(0,X.g)(VT.ClassName,VT);class FT extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicMax(u,G)),FT.ClassName,u)}_polymorphicMax(u,G){return YT(u,G,Math.max)}}function rT(u,G,s){return Math.min(Math.max(u,Math.min(G,s)),Math.max(G,s))}function cT(u,G,s,T){switch(As(u)){case"FlowGraphInteger":return new ZG(T(u.value,G.value,s.value));case"Vector2":return new z.m(T(u.x,G.x,s.x),T(u.y,G.y,s.y));case"gb":return new z.q(T(u.x,G.x,s.x),T(u.y,G.y,s.y),T(u.z,G.z,s.z));case"Vector4":return new z.s(T(u.x,G.x,s.x),T(u.y,G.y,s.y),T(u.z,G.z,s.z),T(u.w,G.w,s.w));case"Matrix":return z.d.FromValues(T(u.m[0],G.m[0],s.m[0]),T(u.m[4],G.m[4],s.m[4]),T(u.m[8],G.m[8],s.m[8]),T(u.m[12],G.m[12],s.m[12]),T(u.m[1],G.m[1],s.m[1]),T(u.m[5],G.m[5],s.m[5]),T(u.m[9],G.m[9],s.m[9]),T(u.m[13],G.m[13],s.m[13]),T(u.m[2],G.m[2],s.m[2]),T(u.m[6],G.m[6],s.m[6]),T(u.m[10],G.m[10],s.m[10]),T(u.m[14],G.m[14],s.m[14]),T(u.m[3],G.m[3],s.m[3]),T(u.m[7],G.m[7],s.m[7]),T(u.m[11],G.m[11],s.m[11]),T(u.m[15],G.m[15],s.m[15]));default:return T(u,G,s)}}FT.ClassName="FGMaxBlock",(0,X.g)(FT.ClassName,FT);class jT extends Js{constructor(u){super(EG,EG,EG,EG,((u,G,s)=>this._polymorphicClamp(u,G,s)),jT.ClassName,u)}_polymorphicClamp(u,G,s){return cT(u,G,s,rT)}}function lT(u){return Math.min(Math.max(u,0),1)}jT.ClassName="FGClampBlock",(0,X.g)(jT.ClassName,jT);class PT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicSaturate(u)),PT.ClassName,u)}_polymorphicSaturate(u){return OT(u,lT)}}PT.ClassName="FGSaturateBlock",(0,X.g)(PT.ClassName,PT);class HT extends Js{constructor(u){super(EG,EG,EG,EG,((u,G,s)=>this._polymorphicInterpolate(u,G,s)),HT.ClassName,u)}_interpolate(u,G,s){return(1-s)*u+s*G}_polymorphicInterpolate(u,G,s){return cT(u,G,s,this._interpolate)}}HT.ClassName="FGInterpolateBlock",(0,X.g)(HT.ClassName,HT);class XT extends hs{constructor(u){super(EG,EG,us,((u,G)=>this._polymorphicEq(u,G)),XT.ClassName,u)}_polymorphicEq(u,G){const s=As(u),T=As(G);return Ns(s,T)||ys(s,T)||as(s,T)?u.equals(G):u===G}}function pT(u,G,s){const T=As(u);if(T===As(G)){if(""===T)return s(u,G);if("FlowGraphInteger"===T)return s(u.value,G.value);throw new Error(`Cannot compare ${u} and ${G}`)}throw new Error(`${u} and ${G} are of different types.`)}XT.ClassName="FGEqBlock",(0,X.g)(XT.ClassName,XT);class qT extends hs{constructor(u){super(EG,EG,us,((u,G)=>this._polymorphicLessThan(u,G)),qT.ClassName,u)}_polymorphicLessThan(u,G){return pT(u,G,((u,G)=>u<G))}}qT.ClassName="FGLessThanBlock",(0,X.g)(qT.ClassName,qT);class dT extends hs{constructor(u){super(EG,EG,us,((u,G)=>this._polymorphicLessThanOrEqual(u,G)),dT.ClassName,u)}_polymorphicLessThanOrEqual(u,G){return pT(u,G,((u,G)=>u<=G))}}dT.ClassName="FGLessThanOrEqualBlock";class vT extends hs{constructor(u){super(EG,EG,us,((u,G)=>this._polymorphicGreaterThan(u,G)),vT.ClassName,u)}_polymorphicGreaterThan(u,G){return pT(u,G,((u,G)=>u>G))}}vT.ClassName="FGGreaterThanBlock",(0,X.g)(vT.ClassName,vT);class WT extends hs{constructor(u){super(EG,EG,us,((u,G)=>this._polymorphicGreaterThanOrEqual(u,G)),WT.ClassName,u)}_polymorphicGreaterThanOrEqual(u,G){return pT(u,G,((u,G)=>u>=G))}}WT.ClassName="FGGreaterThanOrEqualBlock",(0,X.g)(WT.ClassName,WT);class MT extends is{constructor(u){super(EG,us,(u=>this._polymorphicIsNan(u)),MT.ClassName,u)}_polymorphicIsNan(u){const G=As(u);if(""===G)return isNaN(u);if("FlowGraphInteger"===G)return isNaN(u.value);throw new Error(`Cannot get NaN of ${u}`)}}MT.ClassName="FGIsNanBlock",(0,X.g)(MT.ClassName,MT);class oT extends is{constructor(u){super(EG,us,(u=>this._polymorphicIsInf(u)),oT.ClassName,u)}_polymorphicIsInf(u){const G=As(u);if(""===G)return!isFinite(u);if("FlowGraphInteger"===G)return!isFinite(u.value);throw new Error(`Cannot get isInf of ${u}`)}}oT.ClassName="FGIsInfBlock";class RT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicDegToRad(u)),RT.ClassName,u)}_degToRad(u){return u*Math.PI/180}_polymorphicDegToRad(u){return OT(u,this._degToRad)}}RT.ClassName="FGDegToRadBlock",(0,X.g)(RT.ClassName,RT);class BT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicRadToDeg(u)),BT.ClassName,u)}_radToDeg(u){return 180*u/Math.PI}_polymorphicRadToDeg(u){return OT(u,this._radToDeg)}}BT.ClassName="FGRadToDegBlock",(0,X.g)(BT.ClassName,BT);class DT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicSin(u)),DT.ClassName,u)}_polymorphicSin(u){return OT(u,Math.sin)}}DT.ClassName="FGSinBlock",(0,X.g)(DT.ClassName,DT);class kT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicCos(u)),kT.ClassName,u)}_polymorphicCos(u){return OT(u,Math.cos)}}kT.ClassName="FGCosBlock",(0,X.g)(kT.ClassName,kT);class wT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicTan(u)),wT.ClassName,u)}_polymorphicTan(u){return OT(u,Math.tan)}}wT.ClassName="FGTanBlock",(0,X.g)(wT.ClassName,wT);class LT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicAsin(u)),LT.ClassName,u)}_polymorphicAsin(u){return OT(u,Math.asin)}}LT.ClassName="FGAsinBlock",(0,X.g)(LT.ClassName,LT);class ST extends is{constructor(u){super(EG,EG,(u=>this._polymorphicAcos(u)),ST.ClassName,u)}_polymorphicAcos(u){return OT(u,Math.acos)}}ST.ClassName="FGAcosBlock",(0,X.g)(ST.ClassName,ST);class eT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicAtan(u)),eT.ClassName,u)}_polymorphicAtan(u){return OT(u,Math.atan)}}eT.ClassName="FGAtanBlock",(0,X.g)(eT.ClassName,eT);class hT extends hs{constructor(u){super(EG,EG,EG,((u,G)=>this._polymorphicAtan2(u,G)),hT.ClassName,u)}_polymorphicAtan2(u,G){return YT(u,G,Math.atan2)}}hT.ClassName="FGAtan2Block",(0,X.g)(hT.ClassName,hT);class IT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicSinh(u)),IT.ClassName,u)}_polymorphicSinh(u){return OT(u,Math.sinh)}}IT.ClassName="FGSinhBlock",(0,X.g)(IT.ClassName,IT);class iT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicCosh(u)),iT.ClassName,u)}_polymorphicCosh(u){return OT(u,Math.cosh)}}iT.ClassName="FGCoshBlock",(0,X.g)(iT.ClassName,iT);class JT extends is{constructor(u){super(EG,EG,(u=>this._polymorphicTanh(u)),JT.ClassName,u)}_polymorphicTanh(u){return OT(u,Math.tanh)}}JT.ClassName="FGTanhBlock",(0,X.g)(JT.ClassName,JT);class AT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicAsinh(u)),AT.ClassName,u)}_polymorphicAsinh(u){return OT(u,Math.asinh)}}AT.ClassName="FGAsinhBlock",(0,X.g)(AT.ClassName,AT);class NT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicAcosh(u)),NT.ClassName,u)}_polymorphicAcosh(u){return OT(u,Math.acosh)}}NT.ClassName="FGAcoshBlock",(0,X.g)(NT.ClassName,NT);class yT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicAtanh(u)),yT.ClassName,u)}_polymorphicAtanh(u){return OT(u,Math.atanh)}}yT.ClassName="FGAtanhBlock",(0,X.g)(yT.ClassName,yT);class aT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicExp(u)),aT.ClassName,u)}_polymorphicExp(u){return OT(u,Math.exp)}}aT.ClassName="FGExpBlock",(0,X.g)(aT.ClassName,aT);class KT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicLog(u)),KT.ClassName,u)}_polymorphicLog(u){return OT(u,Math.log)}}KT.ClassName="FGLogBlock",(0,X.g)(KT.ClassName,KT);class ZT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicLog2(u)),ZT.ClassName,u)}_polymorphicLog2(u){return OT(u,Math.log2)}}ZT.ClassName="FGLog2Block",(0,X.g)(ZT.ClassName,ZT);class tT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicLog10(u)),tT.ClassName,u)}_polymorphicLog10(u){return OT(u,Math.log10)}}tT.ClassName="FGLog10Block",(0,X.g)(tT.ClassName,tT);class ET extends is{constructor(u){super(EG,UG,(u=>this._polymorphicSqrt(u)),ET.ClassName,u)}_polymorphicSqrt(u){return OT(u,Math.sqrt)}}ET.ClassName="FGSqrtBlock",(0,X.g)(ET.ClassName,ET);class UT extends is{constructor(u){super(EG,UG,(u=>this._polymorphicCubeRoot(u)),UT.ClassName,u)}_polymorphicCubeRoot(u){return OT(u,Math.cbrt)}}UT.ClassName="FGCubeRootBlock",(0,X.g)(UT.ClassName,UT);class uz extends hs{constructor(u){super(EG,UG,UG,((u,G)=>this._polymorphicPow(u,G)),uz.ClassName,u)}_polymorphicPow(u,G){return YT(u,G,Math.pow)}}uz.ClassName="FGPowBlock",(0,X.g)(uz.ClassName,uz);class Gz extends is{constructor(u){super(EG,UG,(u=>this._polymorphicLength(u)),Gz.ClassName,u)}_polymorphicLength(u){switch(As(u)){case"Vector2":case"gb":case"Vector4":return u.length();default:throw new Error(`Cannot compute length of value ${u}`)}}}Gz.ClassName="FGLengthBlock",(0,X.g)(Gz.ClassName,Gz);class sz extends is{constructor(u){super(EG,EG,(u=>this._polymorphicNormalize(u)),sz.ClassName,u)}_polymorphicNormalize(u){switch(As(u)){case"Vector2":case"gb":case"Vector4":return u.normalize();default:throw new Error(`Cannot normalize value ${u}`)}}}sz.ClassName="FGNormalizeBlock",(0,X.g)(sz.ClassName,sz);class Tz extends hs{constructor(u){super(ss,ss,ss,((u,G)=>z.q.Cross(u,G)),Tz.ClassName,u)}}Tz.ClassName="FGCrossBlock",(0,X.g)(Tz.ClassName,Tz);class zz extends hs{constructor(u){super(Gs,UG,Gs,((u,G)=>z.m.Transform(u,z.d.RotationZ(G))),zz.ClassName,u)}}zz.ClassName="FGRotate2DBlock",(0,X.g)(zz.ClassName,zz);class Oz extends Js{constructor(u){super(ss,ss,UG,ss,((u,G,s)=>z.q.TransformCoordinates(u,z.d.RotationAxis(G,s))),Oz.ClassName,u)}}Oz.ClassName="FGRotate3DBlock",(0,X.g)(Oz.ClassName,Oz);class mz extends is{constructor(u){super(Ts,Ts,(u=>z.d.Transpose(u)),mz.ClassName,u)}}mz.ClassName="FGTransposeBlock",(0,X.g)(mz.ClassName,mz);class fz extends is{constructor(u){super(Ts,UG,(u=>u.determinant()),fz.ClassName,u)}}fz.ClassName="FGDeterminantBlock",(0,X.g)(fz.ClassName,fz);class Cz extends is{constructor(u){super(Ts,Ts,(u=>z.d.Invert(u)),Cz.ClassName,u)}}Cz.ClassName="FGInvertMatrixBlock",(0,X.g)(Cz.ClassName,Cz);class xz extends hs{constructor(u){super(Ts,Ts,Ts,((u,G)=>G.multiply(u)),xz.ClassName,u)}}xz.ClassName="FGMatMulBlock",(0,X.g)(xz.ClassName,xz);class gz extends is{constructor(u){super(zs,zs,(u=>new ZG(~u.value)),gz.ClassName,u)}}gz.ClassName="FGBitwiseNotBlock",(0,X.g)(gz.ClassName,gz);class bz extends hs{constructor(u){super(zs,zs,zs,((u,G)=>new ZG(u.value&G.value)),bz.ClassName,u)}}bz.ClassName="FGBitwiseAndBlock",(0,X.g)(bz.ClassName,bz);class Qz extends hs{constructor(u){super(zs,zs,zs,((u,G)=>new ZG(u.value|G.value)),Qz.ClassName,u)}}Qz.ClassName="FGBitwiseOrBlock",(0,X.g)(Qz.ClassName,Qz);class Yz extends hs{constructor(u){super(zs,zs,zs,((u,G)=>new ZG(u.value^G.value)),Yz.ClassName,u)}}Yz.ClassName="FGBitwiseXorBlock",(0,X.g)(Yz.ClassName,Yz);class nz extends hs{constructor(u){super(zs,zs,zs,((u,G)=>new ZG(u.value<<G.value)),nz.ClassName,u)}}nz.ClassName="FGBitwiseLeftShiftBlock",(0,X.g)(nz.ClassName,nz);class Vz extends hs{constructor(u){super(zs,zs,zs,((u,G)=>new ZG(u.value>>G.value)),Vz.ClassName,u)}}Vz.ClassName="FGBitwiseRightShiftBlock",(0,X.g)(Vz.ClassName,Vz);class Fz extends is{constructor(u){super(zs,zs,(u=>new ZG(Math.clz32(u.value))),Fz.ClassName,u)}}Fz.ClassName="FGCountLeadingZerosBlock",(0,X.g)(Fz.ClassName,Fz);class rz extends is{constructor(u){super(zs,zs,(u=>new ZG(u.value?31-Math.clz32(u.value&-u.value):32)),rz.ClassName,u)}}rz.ClassName="FGCountTrailingZerosBlock",(0,X.g)(rz.ClassName,rz);class cz extends is{constructor(u){super(zs,zs,(u=>new ZG(function(u){let G=0;for(;u;)G+=1&u,u>>=1;return G}(u.value))),cz.ClassName,u)}}cz.ClassName="FGCountOneBitsBlock",(0,X.g)(cz.ClassName,cz);class jz extends qs{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new ZG(0)};super(u),this.config=u,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",zs),this.value=this.registerDataOutput("value",zs)}_execute(u,G){if(G===this.reset)this.value.setValue(this.config.startIndex,u);else{const G=this.value.getValue(u);G.value<this.n.getValue(u).value&&(this.value.setValue(new ZG(G.value+1),u),this.out._activateSignal(u))}}getClassName(){return jz.ClassName}}jz.ClassName="FGDoNBlock",(0,X.g)(jz.ClassName,jz);class lz extends gs{constructor(u){super(u),this.config=u,this.output=this.registerDataOutput(u.variableName,EG)}_updateOutputs(u){const G=this.config.variableName;u.hasVariable(G)&&this.output.setValue(u.getVariable(G),u)}getClassName(){return lz.ClassName}serialize(u){super.serialize(u),u.config.variableName=this.config.variableName}}lz.ClassName="FGGetVariableBlock",(0,X.g)(lz.ClassName,lz);class Pz extends qs{constructor(u){super(u),this.config=u,this.input=this.registerDataInput(u.variableName,EG)}_execute(u){const G=this.config.variableName,s=this.input.getValue(u);u.setVariable(G,s),this.out._activateSignal(u)}getClassName(){return Pz.ClassName}}Pz.ClassName="FGSetVariableBlock",(0,X.g)(Pz.ClassName,Pz);class Hz extends qs{constructor(u){super(u),this.config=u,this.condition=this.registerDataInput("condition",us),this.loopBody=this._registerSignalOutput("loopBody")}_execute(u,G){var s;let T=this.condition.getValue(u);for(null!==(s=this.config)&&void 0!==s&&s.isDo&&!T&&this.loopBody._activateSignal(u);T;)this.loopBody._activateSignal(u),T=this.condition.getValue(u);this.out._activateSignal(u)}getClassName(){return Hz.ClassName}serialize(u){var G;super.serialize(u),u.isDo=null===(G=this.config)||void 0===G?void 0:G.isDo}}Hz.ClassName="FGWhileLoopBlock",(0,X.g)(Hz.ClassName,Hz);const Xz={"lifecycle/onStart":Xs.ClassName,"lifecycle/onTick":ps.ClassName,log:ds.ClassName,"flow/delay":Ws.ClassName,"customEvent/send":Ms.ClassName,"customEvent/receive":os.ClassName,"flow/sequence":Rs.ClassName,"world/get":ks.ClassName,"world/set":ws.ClassName,"flow/doN":jz.ClassName,"variable/get":lz.ClassName,"variable/set":Pz.ClassName,"flow/whileLoop":Hz.ClassName,"math/random":Us.ClassName,"math/e":GT.ClassName,"math/pi":sT.ClassName,"math/inf":TT.ClassName,"math/nan":zT.ClassName,"math/abs":mT.ClassName,"math/sign":fT.ClassName,"math/trunc":CT.ClassName,"math/floor":xT.ClassName,"math/ceil":gT.ClassName,"math/fract":bT.ClassName,"math/neg":QT.ClassName,"math/add":Ks.ClassName,"math/sub":Zs.ClassName,"math/mul":ts.ClassName,"math/div":Es.ClassName,"math/rem":nT.ClassName,"math/min":VT.ClassName,"math/max":FT.ClassName,"math/clamp":jT.ClassName,"math/saturate":PT.ClassName,"math/mix":HT.ClassName,"math/eq":XT.ClassName,"math/lt":qT.ClassName,"math/le":dT.ClassName,"math/gt":vT.ClassName,"math/ge":WT.ClassName,"math/isnan":MT.ClassName,"math/isinf":oT.ClassName,"math/rad":RT.ClassName,"math/deg":BT.ClassName,"math/sin":DT.ClassName,"math/cos":kT.ClassName,"math/tan":wT.ClassName,"math/asin":LT.ClassName,"math/acos":ST.ClassName,"math/atan":eT.ClassName,"math/atan2":hT.ClassName,"math/sinh":IT.ClassName,"math/cosh":iT.ClassName,"math/tanh":JT.ClassName,"math/asinh":AT.ClassName,"math/acosh":NT.ClassName,"math/atanh":yT.ClassName,"math/exp":aT.ClassName,"math/log":KT.ClassName,"math/log2":ZT.ClassName,"math/log10":tT.ClassName,"math/sqrt":ET.ClassName,"math/cbrt":UT.ClassName,"math/pow":uz.ClassName,"math/length":Gz.ClassName,"math/normalize":sz.ClassName,"math/dot":uT.ClassName,"math/cross":Tz.ClassName,"math/rotate2d":zz.ClassName,"math/rotate3d":Oz.ClassName,"math/transpose":mz.ClassName,"math/determinant":fz.ClassName,"math/inverse":Cz.ClassName,"math/matmul":xz.ClassName,"math/not":gz.ClassName,"math/and":bz.ClassName,"math/or":Qz.ClassName,"math/xor":Yz.ClassName,"math/asr":Vz.ClassName,"math/lsl":nz.ClassName,"math/clz":Fz.ClassName,"math/ctz":rz.ClassName,"math/popcnt":cz.ClassName},pz={float2:"Vector2",float3:"gb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function qz(u,G,s){if(void 0!==u.type){const T=G.types&&G.types[u.type];if(!T)throw new Error(`${s}: Unknown type: ${u.type}`);const z=T.signature;if(!z)throw new Error(`${s}: Type ${u.type} has no signature`);const O=pz[z];return{value:u.value,className:O}}return u.value}function dz(u,G,s){const T=Xz[G.type];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${u}: Unknown block type: ${G.type}`);const z=u.toString(),O=function(u,G,s){const T={},z=u.configuration??[];for(const O of z)if("customEvent"===O.id){const u=G.customEvents&&G.customEvents[O.value];if(!u)throw new Error(`/extensions/KHR_interactivity/nodes/${s}: Unknown custom event: ${O.value}`);T.eventId=u.id,T.eventData=u.values.map((u=>u.id))}else if("variable"===O.id){const u=G.variables&&G.variables[O.value];if(!u)throw new Error(`/extensions/KHR_interactivity/nodes/${s}: Unknown variable: ${O.value}`);T.variableName=u.id}else if("path"===O.id){const u=O.value;T.path=u}else T[O.id]=qz(O,G,`/extensions/KHR_interactivity/nodes/${s}`);return T}(G,s,z);return{className:T,config:O,uniqueId:z,metadata:G.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class vz extends XG{constructor(u){super(u,Mz)}}const Wz={__array__:{__target__:!0,translation:{type:"gb",get:u=>u._babylonTransformNode.position,set:(u,G)=>{G._babylonTransformNode.position=u},getObject:u=>u._babylonTransformNode}}},Mz={nodes:Wz},oz="KHR_interactivity";class Rz{constructor(u){this._loader=u,this.name=oz,this.enabled=this._loader.isExtensionUsed(oz),this._pathConverter=new vz(this._loader.Ei)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var u;if(!this._loader.babylonScene||!this._pathConverter)return;const G=this._loader.babylonScene,s=function(u){const G={uniqueId:(0,aG.c)(),_userVariables:{},_connectionValues:{}},s=[G],T=[];for(let O=0;O<u.nodes.length;O++){const G=dz(O,u.nodes[O],u);T.push(G)}for(let O=0;O<u.nodes.length;O++){const s=u.nodes[O],z=T[O],m=s.flows??[];for(const u of m){const G=u.id,s={uniqueId:(0,aG.c)(),name:G,_connectionType:1,connectedPointIds:[]};z.signalOutputs.push(s);const m=u.node,f=u.socket,C=T[m];if(!C)throw new Error(`/extensions/KHR_interactivity/nodes/${O}: Could not find node with id ${m} that connects its input with with node ${O}'s output ${G}`);let x=C.signalInputs.find((u=>u.name===f));x||(x={uniqueId:(0,aG.c)(),name:f,_connectionType:0,connectedPointIds:[]},C.signalInputs.push(x)),x.connectedPointIds.push(s.uniqueId),s.connectedPointIds.push(x.uniqueId)}const f=s.values??[];for(const C of f){const s=C.id,m={uniqueId:(0,aG.c)(),name:s,_connectionType:0,connectedPointIds:[]};if(z.dataInputs.push(m),void 0!==C.value){const s=qz(C,u,`/extensions/KHR_interactivity/nodes/${O}`);G._connectionValues[m.uniqueId]=s}else{if(void 0===C.node||void 0===C.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${O}: Invalid socket ${s} in node ${O}`);{const u=C.node,G=C.socket,z=T[u];if(!z)throw new Error(`/extensions/KHR_interactivity/nodes/${O}: Could not find node with id ${u} that connects its output with node${O}'s input ${s}`);let f=z.dataOutputs.find((u=>u.name===G));f||(f={uniqueId:(0,aG.c)(),name:G,_connectionType:1,connectedPointIds:[]},z.dataOutputs.push(f)),m.connectedPointIds.push(f.uniqueId),f.connectedPointIds.push(m.uniqueId)}}}}const z=u.variables??[];for(let O=0;O<z.length;O++){const s=z[O],T=s.id;G._userVariables[T]=qz(s,u,`/extensions/KHR_interactivity/variables/${O}`)}return{allBlocks:T,executionContexts:s}}(null===(u=this._loader.Ei.extensions)||void 0===u?void 0:u.KHR_interactivity),T=new Hs({wf:G});Ps.Parse(s,{coordinator:T,pathConverter:this._pathConverter}),T.start()}}a(oz),y(oz,!0,(u=>new Rz(u)));const Bz="KHR_node_visibility";class Dz{constructor(u){this.name=Bz,this._loader=u,this.enabled=u.isExtensionUsed(Bz)}async onReady(){var u;null===(u=this._loader.Ei.nodes)||void 0===u||u.forEach((u=>{var G,s,T,z;(null===(G=u._primitiveBabylonMeshes)||void 0===G||G.forEach((u=>{u.inheritVisibility=!0})),null!==(s=u.extensions)&&void 0!==s&&s.KHR_node_visibility)&&(!1===(null===(T=u.extensions)||void 0===T?void 0:T.KHR_node_visibility.visible)&&(u._babylonTransformNode&&(u._babylonTransformNode.isVisible=!1),null===(z=u._primitiveBabylonMeshes)||void 0===z||z.forEach((u=>{u.isVisible=!1}))))}))}dispose(){this._loader=null}}a(Bz),y(Bz,!0,(u=>new Dz(u)));const kz="ExtrasAsMetadata";class wz{_assignExtras(u,G){if(G.extras&&Object.keys(G.extras).length>0){const s=u.metadata=u.metadata||{};(s.Ei=s.Ei||{}).extras=G.extras}}constructor(u){this.name=kz,this.enabled=!0,this._loader=u}dispose(){this._loader=null}loadNodeAsync(u,G,s){return this._loader.loadNodeAsync(u,G,(u=>{this._assignExtras(u,G),s(u)}))}loadCameraAsync(u,G,s){return this._loader.loadCameraAsync(u,G,(u=>{this._assignExtras(u,G),s(u)}))}createMaterial(u,G,s){const T=this._loader.createMaterial(u,G,s);return this._assignExtras(T,G),T}}a(kz),y(kz,!1,(u=>new wz(u)))},11875:(u,G,s)=>{"use strict";s.d(G,{e:()=>o,f:()=>p,i:()=>X,k:()=>q});var T=s(10568),z=s(10564),O=s(11265),m=s(11148),f=s(11193),C=s(11191),x=s(10584),g=s(10619),b=s(11882),Q=s(11890),Y=s(11154);class n{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Vj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(u){this._environmentTexture=u}getNodes(){let u=[];return u=u.concat(this.meshes),u=u.concat(this.lights),u=u.concat(this.cameras),u=u.concat(this.transformNodes),this.skeletons.forEach((G=>u=u.concat(G.bones))),u}}class V extends n{}class F{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((u=>{u.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((u=>{u.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((u=>{u.dispose()})),this.animationGroups.length=0}}class r extends n{constructor(u){super(),this._wasAddedToScene=!1,(u=u||g.d.LastCreatedScene)&&(this.wf=u,this.proceduralTextures=[],u._i.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=u.getEngine().onContextRestoredObservable.add((()=>{for(const u of this.geometries)u._rebuild();for(const u of this.meshes)u._rebuild();for(const u of this.fj)u.rebuild();for(const u of this.textures)u._rebuild()})))}_topologicalSort(u){const G=new Map;for(const m of u)G.set(m.uniqueId,m);const s={dependsOn:new Map,dependedBy:new Map};for(const m of u){const u=m.uniqueId;s.dependsOn.set(u,new Set),s.dependedBy.set(u,new Set)}for(const m of u){const u=m.uniqueId,T=s.dependsOn.get(u);if(m instanceof b.d){const z=m.sourceMesh;G.has(z.uniqueId)&&(T.add(z.uniqueId),s.dependedBy.get(z.uniqueId).add(u))}const z=s.dependedBy.get(u);for(const O of m.getDescendants()){const T=O.uniqueId;if(G.has(T)){z.add(T);s.dependsOn.get(T).add(u)}}}const T=[],z=[];for(const m of u){const u=m.uniqueId;0===s.dependsOn.get(u).size&&(z.push(m),G.delete(u))}const O=z;for(;O.length>0;){const u=O.shift();T.push(u);const z=s.dependedBy.get(u.uniqueId);for(const T of Array.from(z.values())){const z=s.dependsOn.get(T);z.delete(u.uniqueId),0===z.size&&G.get(T)&&(O.push(G.get(T)),G.delete(T))}}return G.size>0&&(x.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),G.forEach((u=>x.d.Error(u.name)))),T}_addNodeAndDescendantsToList(u,G,s,T){if(s&&(!T||T(s))&&!G.has(s.uniqueId)){u.push(s),G.add(s.uniqueId);for(const z of s.getDescendants(!0))this._addNodeAndDescendantsToList(u,G,z,T)}}_isNodeInContainer(u){return u instanceof C.d&&-1!==this.meshes.indexOf(u)||(u instanceof f.d&&-1!==this.transformNodes.indexOf(u)||(u instanceof Q.e&&-1!==this.lights.indexOf(u)||u instanceof Y.e&&-1!==this.cameras.indexOf(u)))}_isValidHierarchy(){for(const u of this.meshes)if(u.parent&&!this._isNodeInContainer(u.parent))return x.d.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.transformNodes)if(u.parent&&!this._isNodeInContainer(u.parent))return x.d.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.lights)if(u.parent&&!this._isNodeInContainer(u.parent))return x.d.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.cameras)if(u.parent&&!this._isNodeInContainer(u.parent))return x.d.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(u){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||z.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const T={},O={},f=new F,C=[],x=[],g={doNotInstantiate:!0,...s},b=[],Q=new Set;for(const z of this.transformNodes)null===z.parent&&this._addNodeAndDescendantsToList(b,Q,z,g.predicate);for(const z of this.meshes)null===z.parent&&this._addNodeAndDescendantsToList(b,Q,z,g.predicate);const Y=this._topologicalSort(b),n=(s,z)=>{if(((G,s)=>{if(T[G.uniqueId]=s.uniqueId,O[s.uniqueId]=s,u&&(s.name=u(G.name)),s instanceof m.c){const u=s;if(u.morphTargetManager){const s=G.morphTargetManager;u.morphTargetManager=s.clone();for(let G=0;G<s.numTargets;G++){const z=s.getTarget(G),m=u.morphTargetManager.getTarget(G);T[z.uniqueId]=m.uniqueId,O[m.uniqueId]=m}}}})(s,z),s.parent){const u=T[s.parent.uniqueId],G=O[u];z.parent=G||s.parent}if(z.position&&s.position&&z.position.p(s.position),z.rotationQuaternion&&s.rotationQuaternion&&z.rotationQuaternion.p(s.rotationQuaternion),z.rotation&&s.rotation&&z.rotation.p(s.rotation),z.vf&&s.vf&&z.vf.p(s.vf),z.material){const m=z;if(m.material)if(G){const G=s.material;if(-1===x.indexOf(G)){let s=G.clone(u?u(G.name):"Clone of "+G.name);if(x.push(G),T[G.uniqueId]=s.uniqueId,O[s.uniqueId]=s,"MultiMaterial"===G.getClassName()){const z=G;for(const G of z.yf)G&&(s=G.clone(u?u(G.name):"Clone of "+G.name),x.push(G),T[G.uniqueId]=s.uniqueId,O[s.uniqueId]=s);z.yf=z.yf.map((u=>u&&O[T[u.uniqueId]]))}}"InstancedMesh"!==m.getClassName()&&(m.material=O[T[G.uniqueId]])}else"MultiMaterial"===m.material.getClassName()?-1===this.wf.multiMaterials.indexOf(m.material)&&this.wf.addMultiMaterial(m.material):-1===this.wf.materials.indexOf(m.material)&&this.wf.addMaterial(m.material)}null===z.parent&&f.rootNodes.push(z)};return Y.forEach((u=>{if("InstancedMesh"===u.getClassName()){const G=u,s=G.sourceMesh,z=T[s.uniqueId],m=("number"===typeof z?O[z]:s).ed(G.name);n(G,m)}else{let G=!0;"sb"===u.getClassName()||"Node"===u.getClassName()||u.skeleton||!u.getTotalVertices||0===u.getTotalVertices()?G=!1:g.doNotInstantiate&&(G="function"===typeof g.doNotInstantiate?!g.doNotInstantiate(u):!g.doNotInstantiate);const s=G?u.ed(`instance of ${u.name}`):u.clone(`Clone of ${u.name}`,null,!0);if(!s)throw new Error(`Could not clone or instantiate node on Asset Container ${u.name}`);n(u,s)}})),this.skeletons.forEach((G=>{if(g.predicate&&!g.predicate(G))return;const s=G.clone(u?u(G.name):"Clone of "+G.name);for(const u of this.meshes)if(u.skeleton===G&&!u.isAnInstance){const G=O[T[u.uniqueId]];if(!G||G.isAnInstance)continue;if(G.skeleton=s,-1!==C.indexOf(s))continue;C.push(s);for(const u of s.bones)u._linkedTransformNode&&(u._linkedTransformNode=O[T[u._linkedTransformNode.uniqueId]])}f.skeletons.push(s)})),this.animationGroups.forEach((G=>{if(g.predicate&&!g.predicate(G))return;const s=G.clone(u?u(G.name):"Clone of "+G.name,(u=>O[T[u.uniqueId]]||u));f.animationGroups.push(s)})),f}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||z.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.wf.environmentTexture=this.environmentTexture);for(const u of this.wf._serializableComponents)u.addFromContainer(this);this.wf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const G=[];this.cameras.forEach((s=>{u&&!u(s)||(this.wf.addCamera(s),G.push(s))})),this.lights.forEach((s=>{u&&!u(s)||(this.wf.addLight(s),G.push(s))})),this.meshes.forEach((s=>{u&&!u(s)||(this.wf.ai(s),G.push(s))})),this.skeletons.forEach((G=>{u&&!u(G)||this.wf.addSkeleton(G)})),this.animations.forEach((G=>{u&&!u(G)||this.wf.addAnimation(G)})),this.animationGroups.forEach((G=>{u&&!u(G)||this.wf.addAnimationGroup(G)})),this.multiMaterials.forEach((G=>{u&&!u(G)||this.wf.addMultiMaterial(G)})),this.materials.forEach((G=>{u&&!u(G)||this.wf.addMaterial(G)})),this.morphTargetManagers.forEach((G=>{u&&!u(G)||this.wf.addMorphTargetManager(G)})),this.geometries.forEach((G=>{u&&!u(G)||this.wf.addGeometry(G)})),this.transformNodes.forEach((s=>{u&&!u(s)||(this.wf.addTransformNode(s),G.push(s))})),this.actionManagers.forEach((G=>{u&&!u(G)||this.wf.addActionManager(G)})),this.textures.forEach((G=>{u&&!u(G)||this.wf.addTexture(G)})),this.reflectionProbes.forEach((G=>{u&&!u(G)||this.wf.addReflectionProbe(G)}));for(const s of G)s.parent&&-1===this.wf.getNodes().indexOf(s.parent)&&(s.setParent?s.setParent(null):s.parent=null)}removeAllFromScene(){this._isValidHierarchy()||z.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.wf.environmentTexture&&(this.wf.environmentTexture=null);for(const u of this.wf._serializableComponents)u.removeFromContainer(this)}removeFromScene(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((G=>{u&&!u(G)||this.wf.removeCamera(G)})),this.lights.forEach((G=>{u&&!u(G)||this.wf.removeLight(G)})),this.meshes.forEach((G=>{u&&!u(G)||this.wf.Kg(G,!0)})),this.skeletons.forEach((G=>{u&&!u(G)||this.wf.removeSkeleton(G)})),this.animations.forEach((G=>{u&&!u(G)||this.wf.removeAnimation(G)})),this.animationGroups.forEach((G=>{u&&!u(G)||this.wf.removeAnimationGroup(G)})),this.multiMaterials.forEach((G=>{u&&!u(G)||this.wf.removeMultiMaterial(G)})),this.materials.forEach((G=>{u&&!u(G)||this.wf.removeMaterial(G)})),this.morphTargetManagers.forEach((G=>{u&&!u(G)||this.wf.removeMorphTargetManager(G)})),this.geometries.forEach((G=>{u&&!u(G)||this.wf.removeGeometry(G)})),this.transformNodes.forEach((G=>{u&&!u(G)||this.wf.removeTransformNode(G)})),this.actionManagers.forEach((G=>{u&&!u(G)||this.wf.removeActionManager(G)})),this.textures.forEach((G=>{u&&!u(G)||this.wf.removeTexture(G)})),this.reflectionProbes.forEach((G=>{u&&!u(G)||this.wf.removeReflectionProbe(G)}))}dispose(){this.cameras.slice(0).forEach((u=>{u.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((u=>{u.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((u=>{u.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((u=>{u.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((u=>{u.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((u=>{u.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((u=>{u.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((u=>{u.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((u=>{u.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((u=>{u.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((u=>{u.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((u=>{u.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((u=>{u.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const u of this.wf._serializableComponents)u.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.wf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(u,G,s){if(u&&G)for(const T of u){let u=!0;if(s)for(const G of s)if(T===G){u=!1;break}u&&(G.push(T),T._parentContainer=this)}}moveAllFromScene(u){this._wasAddedToScene=!1,void 0===u&&(u=new V);for(const G in this)Object.prototype.hasOwnProperty.call(this,G)&&(this[G]=this[G]||("_environmentTexture"===G?null:[]),this._moveAssets(this.wf[G],this[G],u[G]));this.environmentTexture=this.wf.environmentTexture,this.removeAllFromScene()}createRootMesh(){const u=new m.c("assetContainerRootMesh",this.wf);return this.meshes.forEach((G=>{G.parent||u.addChild(G)})),this.meshes.unshift(u),u}mergeAnimationsTo(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.d.LastCreatedScene,G=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!u)return x.d.Error("No scene available to merge animations to"),[];const T=s||(G=>{let s=null;const T=G.animations.length?G.animations[0].targetProperty:"",z=G.name.split(".").join("").split("_primitive")[0];switch(T){case"position":case"rotationQuaternion":s=u.getTransformNodeByName(G.name)||u.getTransformNodeByName(z);break;case"influence":s=u.getMorphTargetByName(G.name)||u.getMorphTargetByName(z);break;default:s=u.getNodeByName(G.name)||u.getNodeByName(z)}return s});this.getNodes().forEach((u=>{const G=T(u);if(null!==G){for(const s of u.animations){const u=G.animations.filter((u=>u.targetProperty===s.targetProperty));for(const s of u){const u=G.animations.indexOf(s,0);u>-1&&G.animations.splice(u,1)}}G.animations=G.animations.concat(u.animations)}}));const z=[];return this.animationGroups.slice().forEach((u=>{z.push(u.clone(u.name,T)),u.animatables.forEach((u=>{u.stop()}))})),G.forEach((G=>{const s=T(G.target);s&&(u.beginAnimation(s,G.fromFrame,G.toFrame,G.loopAnimation,G.speedRatio,G.onAnimationEnd?G.onAnimationEnd:void 0,void 0,!0,void 0,G.onAnimationLoop?G.onAnimationLoop:void 0),u.stopAnimation(G.target))})),z}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.transformNodes.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.lights.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.cameras.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)}))}addAllAssetsToContainer(u){if(!u)return;const G=[],s=new Set;for(G.push(u);G.length>0;){const u=G.pop();if(u instanceof m.c?(u.sj&&-1===this.geometries.indexOf(u.sj)&&this.geometries.push(u.sj),this.meshes.push(u)):u instanceof f.d?this.transformNodes.push(u):u instanceof Q.e?this.lights.push(u):u instanceof Y.e&&this.cameras.push(u),u instanceof C.d){if(u.material&&-1===this.materials.indexOf(u.material)){this.materials.push(u.material);for(const G of u.material.getActiveTextures())-1===this.textures.indexOf(G)&&this.textures.push(G)}u.skeleton&&-1===this.skeletons.indexOf(u.skeleton)&&this.skeletons.push(u.skeleton),u.morphTargetManager&&-1===this.morphTargetManagers.indexOf(u.morphTargetManager)&&this.morphTargetManagers.push(u.morphTargetManager)}for(const T of u.getChildren())s.has(T)||G.push(T);s.add(u)}this.populateRootNodes()}}var c=s(10627);class j{constructor(u){this.byteOffset=0,this.buffer=u}loadAsync(u){return this.buffer.readAsync(this.byteOffset,u).then((u=>{this._dataView=new DataView(u.buffer,u.byteOffset,u.byteLength),this._dataByteOffset=0}))}readUint32(){const u=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,u}readUint8Array(u){const G=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,u);return this._dataByteOffset+=u,this.byteOffset+=u,G}readString(u){return(0,c.j)(this.readUint8Array(u))}skipBytes(u){this._dataByteOffset+=u,this.byteOffset+=u}}var l=s(11897);const P="Z2xURg",H={name:"Ei",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:u=>-1!==u.indexOf("asset")&&-1!==u.indexOf("version")||u.startsWith("data:base64,"+P)||u.startsWith("data:;base64,"+P)||u.startsWith("data:application/octet-stream;base64,"+P)||u.startsWith("data:model/gltf-binary;base64,"+P)};var X,p,q,d=s(10622),v=s(10625);function W(u,G,s){try{return Promise.resolve(new Uint8Array(u,G,s))}catch(T){return Promise.reject(T)}}!function(u){u[u.AUTO=0]="AUTO",u[u.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(X||(X={})),function(u){u[u.NONE=0]="NONE",u[u.FIRST=1]="FIRST",u[u.ALL=2]="ALL"}(p||(p={})),function(u){u[u.LOADING=0]="LOADING",u[u.READY=1]="READY",u[u.COMPLETE=2]="COMPLETE"}(q||(q={}));class M{constructor(){this.coordinateSystemMode=X.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=u=>Promise.resolve(u),this.extensionOptions={}}p(u){u&&(this.onParsed=u.onParsed,this.coordinateSystemMode=u.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=u.animationStartMode??this.animationStartMode,this.loadNodeAnimations=u.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=u.loadSkins??this.loadSkins,this.loadMorphTargets=u.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=u.compileMaterials??this.compileMaterials,this.useClipPlane=u.useClipPlane??this.useClipPlane,this.compileShadowGenerators=u.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=u.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=u.useRangeRequests??this.useRangeRequests,this.createInstances=u.createInstances??this.createInstances,this.alwaysComputeBoundingBox=u.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=u.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=u.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=u.skipMaterials??this.skipMaterials,this.useSRGBBuffers=u.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=u.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=u.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=u.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=u.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=u.customRootNode,this.onMeshLoaded=u.onMeshLoaded,this.onSkinLoaded=u.onSkinLoaded,this.onTextureLoaded=u.onTextureLoaded,this.onMaterialLoaded=u.onMaterialLoaded,this.onCameraLoaded=u.onCameraLoaded,this.extensionOptions=u.extensionOptions??this.extensionOptions)}}class o extends M{constructor(u){super(),this.onParsedObservable=new T.e,this.onMeshLoadedObservable=new T.e,this.onSkinLoadedObservable=new T.e,this.onTextureLoadedObservable=new T.e,this.onMaterialLoadedObservable=new T.e,this.onCameraLoadedObservable=new T.e,this.onCompleteObservable=new T.e,this.onErrorObservable=new T.e,this._i=new T.e,this.onExtensionLoadedObservable=new T.e,this.validate=!1,this.onValidatedObservable=new T.e,this._loader=null,this._state=null,this._requests=new Array,this.name=H.name,this.extensions=H.extensions,this.onLoaderStateChangedObservable=new T.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(u)}set onParsed(u){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),u&&(this._onParsedObserver=this.onParsedObservable.add(u))}set onMeshLoaded(u){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),u&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(u))}set onSkinLoaded(u){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),u&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((G=>u(G.node,G.skinnedNode))))}set onTextureLoaded(u){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),u&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(u))}set onMaterialLoaded(u){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),u&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(u))}set onCameraLoaded(u){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),u&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(u))}set onComplete(u){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(u)}set onError(u){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(u)}set onDispose(u){this._onDisposeObserver&&this._i.remove(this._onDisposeObserver),this._onDisposeObserver=this._i.add(u)}set onExtensionLoaded(u){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(u)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(u){this._loggingEnabled!==u&&(this._loggingEnabled=u,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(u){this._capturePerformanceCounters!==u&&(this._capturePerformanceCounters=u,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(u){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(u)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const u of this._requests)u.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=u=>Promise.resolve(u),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this._i.notifyObservers(void 0),this._i.clear()}loadFile(u,G,s,O,m,f,C,g){if(ArrayBuffer.isView(G))return this._loadBinary(u,G,s,O,C,g),null;this._progressCallback=m;const b=G.name||z.e.GetFilename(G);if(f){if(this.useRangeRequests){this.validate&&x.d.Warn("glTF validation is not supported when range requests are enabled");const s={abort:()=>{},onCompleteObservable:new T.e},z={readAsync:(s,T)=>new Promise(((z,O)=>{this._loadFile(u,G,(u=>{z(new Uint8Array(u))}),!0,(u=>{O(u)}),(u=>{u.setRequestHeader("Range",`bytes=${s}-${s+T-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(z)).then((u=>{s.onCompleteObservable.notifyObservers(s),O(u)}),C?u=>C(void 0,u):void 0),s}return this._loadFile(u,G,(G=>{this._validate(u,new Uint8Array(G,0,G.byteLength),s,b),this._unpackBinaryAsync(new j({readAsync:(u,s)=>W(G,u,s),byteLength:G.byteLength})).then((u=>{O(u)}),C?u=>C(void 0,u):void 0)}),!0,C)}return this._loadFile(u,G,(G=>{try{this._validate(u,G,s,b),O({json:this._parseJson(G)})}catch{C&&C()}}),!1,C)}_loadBinary(u,G,s,T,z,O){this._validate(u,new Uint8Array(G.buffer,G.byteOffset,G.byteLength),s,O),this._unpackBinaryAsync(new j({readAsync:(u,s)=>function(u,G,s){try{if(G<0||G>=u.byteLength)throw new RangeError("Offset is out of range.");if(G+s>u.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(u.buffer,u.byteOffset+G,s))}catch(T){return Promise.reject(T)}}(G,u,s),byteLength:G.byteLength})).then((u=>{T(u)}),z?u=>z(void 0,u):void 0)}importMeshAsync(u,G,s,T,z,O){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(s),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(s),this._loader.importMeshAsync(u,G,null,s,T,z,O))))}loadAsync(u,G,s,T,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(G),this._loader.loadAsync(u,G,s,T,z))))}loadAssetContainerAsync(u,G,s,T,z){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(G);const O=new r(u),m=[];this.onMaterialLoadedObservable.add((u=>{m.push(u)}));const f=[];this.onTextureLoadedObservable.add((u=>{f.push(u)}));const C=[];this.onCameraLoadedObservable.add((u=>{C.push(u)}));const x=[];return this.onMeshLoadedObservable.add((u=>{u.morphTargetManager&&x.push(u.morphTargetManager)})),this._loader.importMeshAsync(null,u,O,G,s,T,z).then((u=>(Array.prototype.push.apply(O.geometries,u.geometries),Array.prototype.push.apply(O.meshes,u.meshes),Array.prototype.push.apply(O.fj,u.fj),Array.prototype.push.apply(O.skeletons,u.skeletons),Array.prototype.push.apply(O.animationGroups,u.animationGroups),Array.prototype.push.apply(O.materials,m),Array.prototype.push.apply(O.textures,f),Array.prototype.push.apply(O.lights,u.lights),Array.prototype.push.apply(O.transformNodes,u.transformNodes),Array.prototype.push.apply(O.cameras,C),Array.prototype.push.apply(O.morphTargetManagers,x),O)))}))}canDirectLoad(u){return H.canDirectLoad(u)}directLoad(u,G){if(G.startsWith("base64,"+P)||G.startsWith(";base64,"+P)||G.startsWith("application/octet-stream;base64,"+P)||G.startsWith("model/gltf-binary;base64,"+P)){const s=(0,d.c)(G);return this._validate(u,new Uint8Array(s,0,s.byteLength)),this._unpackBinaryAsync(new j({readAsync:(u,G)=>W(s,u,G),byteLength:s.byteLength}))}return this._validate(u,G),Promise.resolve({json:this._parseJson(G)})}createPlugin(u){return new o(u[H.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((u,G)=>{this.onCompleteObservable.addOnce((()=>{u()})),this.onErrorObservable.addOnce((u=>{G(u)}))}))}_setState(u){this._state!==u&&(this._state=u,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(q[this._state]))}_loadFile(u,G,s,T,z,O){const m=u._loadFile(G,s,(u=>{this._onProgress(u,m)}),!0,T,z,O);return m.onCompleteObservable.add((()=>{m._lengthComputable=!0,m._total=m._loaded})),this._requests.push(m),m}_onProgress(u,G){if(!this._progressCallback)return;G._lengthComputable=u.lengthComputable,G._loaded=u.loaded,G._total=u.total;let s=!0,T=0,z=0;for(const O of this._requests){if(void 0===O._lengthComputable||void 0===O._loaded||void 0===O._total)return;s=s&&O._lengthComputable,T+=O._loaded,z+=O._total}this._progressCallback({lengthComputable:s,loaded:T,total:s?z:0})}_validate(u,G){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),l.b.ValidateAsync(G,s,T,(G=>this.preprocessUrlAsync(s+G).then((G=>u._loadFileAsync(G,void 0,!0,!0).then((u=>new Uint8Array(u,0,u.byteLength))))))).then((u=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(u),this.onValidatedObservable.clear()}),(u=>{this._endPerformanceCounter("Validate JSON"),z.e.Warn(`Failed to validate: ${u.message}`),this.onValidatedObservable.clear()})))}_getLoader(u){const G=u.json.asset||{};this._log(`Asset version: ${G.version}`),G.minVersion&&this._log(`Asset minimum version: ${G.minVersion}`),G.generator&&this._log(`Asset generator: ${G.generator}`);const s=o._parseVersion(G.version);if(!s)throw new Error("Invalid version: "+G.version);if(void 0!==G.minVersion){const u=o._parseVersion(G.minVersion);if(!u)throw new Error("Invalid minimum version: "+G.minVersion);if(o._compareVersion(u,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+G.minVersion)}const T={1:o._CreateGLTF1Loader,2:o._CreateGLTF2Loader}[s.major];if(!T)throw new Error("Unsupported version: "+G.version);return T(this)}_parseJson(u){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${u.length}`);const G=JSON.parse(u);return this._endPerformanceCounter("Parse JSON"),G}_unpackBinaryAsync(u){return this._startPerformanceCounter("Unpack Binary"),u.loadAsync(20).then((()=>{const G=u.readUint32();if(1179937895!==G)throw new v.g("Unexpected magic: "+G,v.f.GLTFLoaderUnexpectedMagicError);const s=u.readUint32();this.loggingEnabled&&this._log(`Binary version: ${s}`);const T=u.readUint32();let z;switch(this.useRangeRequests||T===u.buffer.byteLength||x.d.Warn(`Length in header does not match actual data length: ${T} != ${u.buffer.byteLength}`),s){case 1:z=this._unpackBinaryV1Async(u,T);break;case 2:z=this._unpackBinaryV2Async(u,T);break;default:throw new Error("Unsupported version: "+s)}return this._endPerformanceCounter("Unpack Binary"),z}))}_unpackBinaryV1Async(u,G){const s=u.readUint32(),T=u.readUint32();if(0!==T)throw new Error(`Unexpected content format: ${T}`);const z=G-u.byteOffset,O={json:this._parseJson(u.readString(s)),bin:null};if(0!==z){const G=u.byteOffset;O.bin={readAsync:(s,T)=>u.buffer.readAsync(G+s,T),byteLength:z}}return Promise.resolve(O)}_unpackBinaryV2Async(u,G){const s=1313821514,T=5130562,z=u.readUint32();if(u.readUint32()!==s)throw new Error("First chunk format is not JSON");return u.byteOffset+z===G?u.loadAsync(z).then((()=>({json:this._parseJson(u.readString(z)),bin:null}))):u.loadAsync(z+8).then((()=>{const O={json:this._parseJson(u.readString(z)),bin:null},m=()=>{const z=u.readUint32();switch(u.readUint32()){case s:throw new Error("Unexpected JSON chunk");case T:{const G=u.byteOffset;O.bin={readAsync:(s,T)=>u.buffer.readAsync(G+s,T),byteLength:z},u.skipBytes(z);break}default:u.skipBytes(z)}return u.byteOffset!==G?u.loadAsync(8).then(m):Promise.resolve(O)};return m()}))}static _parseVersion(u){if("1.0"===u||"1.0.1"===u)return{major:1,minor:0};const G=(u+"").match(/^(\d+)\.(\d+)/);return G?{major:parseInt(G[1]),minor:parseInt(G[2])}:null}static _compareVersion(u,G){return u.major>G.major?1:u.major<G.major?-1:u.minor>G.minor?1:u.minor<G.minor?-1:0}_logOpen(u){this._log(u),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(u){const G=o._logSpaces.substring(0,2*this._logIndentLevel);x.d.Log(`${G}${u}`)}_logDisabled(u){}_startPerformanceCounterEnabled(u){z.e.StartPerformanceCounter(u)}_startPerformanceCounterDisabled(u){}_endPerformanceCounterEnabled(u){z.e.EndPerformanceCounter(u)}_endPerformanceCounterDisabled(u){}}o.IncrementalLoading=!0,o.HomogeneousCoordinates=!1,o._logSpaces="                                ",(0,O.d)(new o)},11897:(u,G,s)=>{"use strict";s.d(G,{b:()=>m});var T=s(10564);function z(u,G,s,T){const z={externalResourceFunction:T};return s&&(z.uri="file:"===G?s:G+s),ArrayBuffer.isView(u)?GLTFValidator.validateBytes(u,z):GLTFValidator.validateString(u,z)}function O(){const u=[];onmessage=G=>{const s=G.data;switch(s.id){case"init":importScripts(s.url);break;case"validate":z(s.data,s.rootUrl,s.fileName,(G=>new Promise(((s,T)=>{const z=u.length;u.push({resolve:s,reject:T}),postMessage({id:"getExternalResource",index:z,uri:G})})))).then((u=>{postMessage({id:"validate.resolve",value:u})}),(u=>{postMessage({id:"validate.reject",reason:u})}));break;case"getExternalResource.resolve":u[s.index].resolve(s.value);break;case"getExternalResource.reject":u[s.index].reject(s.reason)}}}class m{static ValidateAsync(u,G,s,m){return"function"===typeof Worker?new Promise(((f,C)=>{const x=`${z}(${O})()`,g=URL.createObjectURL(new Blob([x],{type:"application/javascript"})),b=new Worker(g),Q=u=>{b.removeEventListener("error",Q),b.removeEventListener("message",Y),C(u)},Y=u=>{const G=u.data;switch(G.id){case"getExternalResource":m(G.uri).then((u=>{b.postMessage({id:"getExternalResource.resolve",index:G.index,value:u},[u.buffer])}),(u=>{b.postMessage({id:"getExternalResource.reject",index:G.index,reason:u})}));break;case"validate.resolve":b.removeEventListener("error",Q),b.removeEventListener("message",Y),f(G.value),b.terminate();break;case"validate.reject":b.removeEventListener("error",Q),b.removeEventListener("message",Y),C(G.reason),b.terminate()}};if(b.addEventListener("error",Q),b.addEventListener("message",Y),b.postMessage({id:"init",url:T.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(u)){const T=u.slice();b.postMessage({id:"validate",data:T,rootUrl:G,fileName:s},[T.buffer])}else b.postMessage({id:"validate",data:u,rootUrl:G,fileName:s})})):(this._LoadScriptPromise||(this._LoadScriptPromise=T.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>z(u,G,s,m))))}}m.Configuration={url:`${T.e._DefaultCdnUrl}/gltf_validator.js`}},12313:(u,G,s)=>{"use strict";s.d(G,{c:()=>X});var T=s(10863),z=s(10866),O=s(10935),m=s(10904),f=s(11091),C=s(11098),x=s(10961),g=s(10889),b=s(10715),Q=s(10655);s(11559),s(11452),s(11468),s(11459),s(11473),s(11482),s(11488);const Y="imageProcessingCompatibility",n="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Q.b.IncludesShadersStore[Y]=n;const V="skyPixelShader",F="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Q.b.ShadersStore[V]=F;s(11573),s(11491),s(11496),s(11510),s(11505);const r="skyVertexShader",c="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Q.b.ShadersStore[r]=c;var j=s(11130),l=s(11088),P=s(11085);class H extends f.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class X extends C.c{constructor(u,G){super(u,G),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new m.q(0,100,0),this.useSunPosition=!1,this.cameraOffset=m.q.Zero(),this.up=m.q.Up(),this.dithering=!1,this._cameraPosition=m.q.Zero(),this._skyOrientation=new m.h}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(u,G){const s=G._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady)return!0;G.materialDefines||(G.materialDefines=new H);const T=G.materialDefines,z=this.va();if(this._isReadyForSubMesh(G))return!0;if((0,P.U)(u,z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,T),(0,P.J)(u,T,!0,!1),T.IMAGEPROCESSINGPOSTPROCESS!==z.imageProcessingConfiguration.applyByPostProcess&&T.markAsMiscDirty(),T.DITHER!==this.dithering&&T.markAsMiscDirty(),T.isDirty){T.markAsProcessed(),z.resetCachedMaterial();const u=new j.e;T.FOG&&u.addFallback(1,"FOG"),T.IMAGEPROCESSINGPOSTPROCESS=z.imageProcessingConfiguration.applyByPostProcess,T.DITHER=this.dithering;const s=[x.f.PositionKind];T.VERTEXCOLOR&&s.push(x.f.ColorKind);const O="sky",m=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,l.b)(m);const f=T.toString();G.setEffect(z.getEngine().createEffect(O,s,m,[],f,u,this.onCompiled,this.onError),T,this._materialContext)}return!(!G.effect||!G.effect.isReady())&&(T._renderId=z.getRenderId(),s._wasPreviouslyReady=!0,!0)}bindForSubMesh(u,G,s){const T=this.va(),z=s.materialDefines;if(!z)return;const O=s.effect;if(!O)return;this._activeEffect=O,this.bindOnlyWorldMatrix(u),this._activeEffect.setMatrix("viewProjection",T.getTransformMatrix()),this._mustRebind(T,O,s)&&((0,l.f)(O,this,T),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.i)(z,O,T)),T.fogEnabled&&G.applyFog&&T.fogMode!==g.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",T.getViewMatrix()),(0,P.d)(T,G,this._activeEffect);const f=T.activeCamera;if(f){const u=f.getWorldMatrix();this._cameraPosition.x=u.m[12],this._cameraPosition.y=u.m[13],this._cameraPosition.z=u.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const u=Math.PI*(this.inclination-.5),G=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(G)*Math.cos(u),this.sunPosition.y=this.distance*Math.sin(-u),this.sunPosition.z=this.distance*Math.sin(G)*Math.cos(u),m.h.FromUnitVectorsToRef(m.q.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(G,this._activeEffect,s)}getAnimatables(){return[]}dispose(u){super.dispose(u)}clone(u){return O.e.Clone((()=>new X(u,this.va())),this)}serialize(){const u=super.serialize();return u.customType="BABYLON.SkyMaterial",u}getClassName(){return"SkyMaterial"}static Parse(u,G,s){return O.e.Parse((()=>new X(u.name,G)),u,G,s)}}(0,T.b)([(0,z.M)()],X.prototype,"luminance",void 0),(0,T.b)([(0,z.M)()],X.prototype,"turbidity",void 0),(0,T.b)([(0,z.M)()],X.prototype,"rayleigh",void 0),(0,T.b)([(0,z.M)()],X.prototype,"mieCoefficient",void 0),(0,T.b)([(0,z.M)()],X.prototype,"mieDirectionalG",void 0),(0,T.b)([(0,z.M)()],X.prototype,"distance",void 0),(0,T.b)([(0,z.M)()],X.prototype,"inclination",void 0),(0,T.b)([(0,z.M)()],X.prototype,"azimuth",void 0),(0,T.b)([(0,z.J)()],X.prototype,"sunPosition",void 0),(0,T.b)([(0,z.M)()],X.prototype,"useSunPosition",void 0),(0,T.b)([(0,z.J)()],X.prototype,"cameraOffset",void 0),(0,T.b)([(0,z.J)()],X.prototype,"up",void 0),(0,T.b)([(0,z.M)()],X.prototype,"dithering",void 0),(0,b.g)("BABYLON.SkyMaterial",X)},10419:(u,G,s)=>{"use strict";function T(u,G){G.headers=u.headers||{},G.statusMessage=u.statusText,G.statusCode=u.status,G.data=u.response}function z(u,G,s){return new Promise((function(z,O){s=s||{};var m,f,C,x=new XMLHttpRequest,g=s.body,b=s.headers||{};for(m in s.timeout&&(x.timeout=s.timeout),x.ontimeout=x.onerror=function(u){u.timeout="timeout"==u.type,O(u)},x.open(u,G.href||G),x.onload=function(){for(C=x.getAllResponseHeaders().trim().split(/[\r\n]+/),T(x,x);f=C.shift();)f=f.split(": "),x.headers[f.shift().toLowerCase()]=f.join(": ");if((f=x.headers["content-type"])&&~f.indexOf("application/json"))try{x.data=JSON.parse(x.data,s.reviver)}catch(u){return T(x,u),O(u)}(x.status>=400?O:z)(x)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(b["content-type"]="application/json",g=JSON.stringify(g)),x.withCredentials=!!s.withCredentials,b)x.setRequestHeader(m,b[m]);x.send(g)}))}s.r(G),s.d(G,{del:()=>C,get:()=>O,patch:()=>f,post:()=>m,put:()=>x,send:()=>z});var O=z.bind(z,"GET"),m=z.bind(z,"POST"),f=z.bind(z,"PATCH"),C=z.bind(z,"DELETE"),x=z.bind(z,"PUT")},12418:(u,G,s)=>{"use strict";s.d(G,{c:()=>b});const T=.5*(Math.sqrt(3)-1),z=(3-Math.sqrt(3))/6,O=1/3,m=1/6,f=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,x=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),g=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const b=class{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const G="function"==typeof u?u:function(u){let G=0,s=0,T=0,z=1;const O=function(){let u=4022871197;return function(G){G=G.toString();for(let s=0;s<G.length;s++){u+=G.charCodeAt(s);let T=.02519603282416938*u;u=T>>>0,T-=u,T*=u,u=T>>>0,T-=u,u+=4294967296*T}return 2.3283064365386963e-10*(u>>>0)}}();G=O(" "),s=O(" "),T=O(" "),G-=O(u),G<0&&(G+=1);s-=O(u),s<0&&(s+=1);T-=O(u),T<0&&(T+=1);return function(){const u=2091639*G+2.3283064365386963e-10*z;return G=s,s=T,T=u-(z=0|u)}}(u);this.p=function(u){const G=new Uint8Array(256);for(let s=0;s<256;s++)G[s]=s;for(let s=0;s<255;s++){const T=s+~~(u()*(256-s)),z=G[s];G[s]=G[T],G[T]=z}return G}(G),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let s=0;s<512;s++)this.perm[s]=this.p[255&s],this.permMod12[s]=this.perm[s]%12}noise2D(u,G){const s=this.permMod12,O=this.perm;let m=0,f=0,C=0;const g=(u+G)*T,b=Math.floor(u+g),Q=Math.floor(G+g),Y=(b+Q)*z,n=u-(b-Y),V=G-(Q-Y);let F,r;n>V?(F=1,r=0):(F=0,r=1);const c=n-F+z,j=V-r+z,l=n-1+2*z,P=V-1+2*z,H=255&b,X=255&Q;let p=.5-n*n-V*V;if(p>=0){const u=3*s[H+O[X]];p*=p,m=p*p*(x[u]*n+x[u+1]*V)}let q=.5-c*c-j*j;if(q>=0){const u=3*s[H+F+O[X+r]];q*=q,f=q*q*(x[u]*c+x[u+1]*j)}let d=.5-l*l-P*P;if(d>=0){const u=3*s[H+1+O[X+1]];d*=d,C=d*d*(x[u]*l+x[u+1]*P)}return 70*(m+f+C)}noise3D(u,G,s){const T=this.permMod12,z=this.perm;let f,C,g,b;const Q=(u+G+s)*O,Y=Math.floor(u+Q),n=Math.floor(G+Q),V=Math.floor(s+Q),F=(Y+n+V)*m,r=u-(Y-F),c=G-(n-F),j=s-(V-F);let l,P,H,X,p,q;r>=c?c>=j?(l=1,P=0,H=0,X=1,p=1,q=0):r>=j?(l=1,P=0,H=0,X=1,p=0,q=1):(l=0,P=0,H=1,X=1,p=0,q=1):c<j?(l=0,P=0,H=1,X=0,p=1,q=1):r<j?(l=0,P=1,H=0,X=0,p=1,q=1):(l=0,P=1,H=0,X=1,p=1,q=0);const d=r-l+m,v=c-P+m,W=j-H+m,M=r-X+2*m,o=c-p+2*m,R=j-q+2*m,B=r-1+.5,D=c-1+.5,k=j-1+.5,w=255&Y,L=255&n,S=255&V;let e=.6-r*r-c*c-j*j;if(e<0)f=0;else{const u=3*T[w+z[L+z[S]]];e*=e,f=e*e*(x[u]*r+x[u+1]*c+x[u+2]*j)}let h=.6-d*d-v*v-W*W;if(h<0)C=0;else{const u=3*T[w+l+z[L+P+z[S+H]]];h*=h,C=h*h*(x[u]*d+x[u+1]*v+x[u+2]*W)}let I=.6-M*M-o*o-R*R;if(I<0)g=0;else{const u=3*T[w+X+z[L+p+z[S+q]]];I*=I,g=I*I*(x[u]*M+x[u+1]*o+x[u+2]*R)}let i=.6-B*B-D*D-k*k;if(i<0)b=0;else{const u=3*T[w+1+z[L+1+z[S+1]]];i*=i,b=i*i*(x[u]*B+x[u+1]*D+x[u+2]*k)}return 32*(f+C+g+b)}noise4D(u,G,s,T){const z=this.perm;let O,m,x,b,Q;const Y=(u+G+s+T)*f,n=Math.floor(u+Y),V=Math.floor(G+Y),F=Math.floor(s+Y),r=Math.floor(T+Y),c=(n+V+F+r)*C,j=u-(n-c),l=G-(V-c),P=s-(F-c),H=T-(r-c);let X=0,p=0,q=0,d=0;j>l?X++:p++,j>P?X++:q++,j>H?X++:d++,l>P?p++:q++,l>H?p++:d++,P>H?q++:d++;const v=X>=3?1:0,W=p>=3?1:0,M=q>=3?1:0,o=d>=3?1:0,R=X>=2?1:0,B=p>=2?1:0,D=q>=2?1:0,k=d>=2?1:0,w=X>=1?1:0,L=p>=1?1:0,S=q>=1?1:0,e=d>=1?1:0,h=j-v+C,I=l-W+C,i=P-M+C,J=H-o+C,A=j-R+2*C,N=l-B+2*C,y=P-D+2*C,a=H-k+2*C,K=j-w+3*C,Z=l-L+3*C,t=P-S+3*C,E=H-e+3*C,U=j-1+4*C,uu=l-1+4*C,Gu=P-1+4*C,su=H-1+4*C,Tu=255&n,zu=255&V,Ou=255&F,mu=255&r;let fu=.6-j*j-l*l-P*P-H*H;if(fu<0)O=0;else{const u=z[Tu+z[zu+z[Ou+z[mu]]]]%32*4;fu*=fu,O=fu*fu*(g[u]*j+g[u+1]*l+g[u+2]*P+g[u+3]*H)}let Cu=.6-h*h-I*I-i*i-J*J;if(Cu<0)m=0;else{const u=z[Tu+v+z[zu+W+z[Ou+M+z[mu+o]]]]%32*4;Cu*=Cu,m=Cu*Cu*(g[u]*h+g[u+1]*I+g[u+2]*i+g[u+3]*J)}let xu=.6-A*A-N*N-y*y-a*a;if(xu<0)x=0;else{const u=z[Tu+R+z[zu+B+z[Ou+D+z[mu+k]]]]%32*4;xu*=xu,x=xu*xu*(g[u]*A+g[u+1]*N+g[u+2]*y+g[u+3]*a)}let gu=.6-K*K-Z*Z-t*t-E*E;if(gu<0)b=0;else{const u=z[Tu+w+z[zu+L+z[Ou+S+z[mu+e]]]]%32*4;gu*=gu,b=gu*gu*(g[u]*K+g[u+1]*Z+g[u+2]*t+g[u+3]*E)}let bu=.6-U*U-uu*uu-Gu*Gu-su*su;if(bu<0)Q=0;else{const u=z[Tu+1+z[zu+1+z[Ou+1+z[mu+1]]]]%32*4;bu*=bu,Q=bu*bu*(g[u]*U+g[u+1]*uu+g[u+2]*Gu+g[u+3]*su)}return 27*(O+m+x+b+Q)}}}}]);