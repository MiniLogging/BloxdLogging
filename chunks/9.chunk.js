"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[9],{12266:(t,U,y)=>{y.d(U,{d:()=>f,g:()=>p,l:()=>c,k:()=>q,o:()=>H});class I{constructor(){this.children=[]}isValid(t){return!0}process(t,U,y){let I="";if(this.line){let y=this.line;const M=U.processor;if(M){var r,Y,mt,X,P,G;M.lineProcessor&&(y=M.lineProcessor(y,U.isFragment,U.processingContext));const I=(null===(r=U.processor)||void 0===r?void 0:r.attributeKeywordName)??"attribute",L=U.isFragment&&null!==(Y=U.processor)&&void 0!==Y&&Y.varyingFragmentKeywordName?null===(mt=U.processor)||void 0===mt?void 0:mt.varyingFragmentKeywordName:!U.isFragment&&null!==(X=U.processor)&&void 0!==X&&X.varyingVertexKeywordName?null===(P=U.processor)||void 0===P?void 0:P.varyingVertexKeywordName:"varying";if(!U.isFragment&&M.attributeProcessor&&this.line.startsWith(I))y=M.attributeProcessor(this.line,t,U.processingContext);else if(M.varyingProcessor&&(null!==(G=M.varyingCheck)&&void 0!==G&&G.call(M,this.line,U.isFragment)||!M.varyingCheck&&this.line.startsWith(L)))y=M.varyingProcessor(this.line,U.isFragment,t,U.processingContext);else if(M.uniformProcessor&&M.uniformRegexp&&M.uniformRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(y=M.uniformProcessor(this.line,U.isFragment,t,U.processingContext));else if(M.uniformBufferProcessor&&M.uniformBufferRegexp&&M.uniformBufferRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(y=M.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0);else if(M.textureProcessor&&M.textureRegexp&&M.textureRegexp.test(this.line))y=M.textureProcessor(this.line,U.isFragment,t,U.processingContext);else if((M.uniformProcessor||M.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!U.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?M.uniformProcessor&&(y=M.uniformProcessor(this.line,U.isFragment,t,U.processingContext)):M.uniformBufferProcessor&&(y=M.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0)}U.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(U.lookForClosingBracketForUniformBuffer=!1,M.endOfUniformBufferProcessor&&(y=M.endOfUniformBufferProcessor(this.line,U.isFragment,U.processingContext)))}I+=y+"\n"}for(const M of this.children)I+=M.process(t,U,y);return this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true",y[this.additionalDefineKey]=t[this.additionalDefineKey]),I}}class r{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(t){this._lines.length=0;for(const U of t){if(!U||"\r"===U)continue;if("#"===U[0]){this._lines.push(U);continue}const t=U.trim();if(!t)continue;if(t.startsWith("//")){this._lines.push(U);continue}const y=t.indexOf(";");if(-1===y)this._lines.push(t);else if(y===t.length-1)t.length>1&&this._lines.push(t);else{const t=U.split(";");for(let U=0;U<t.length;U++){let y=t[U];y&&(y=y.trim(),y&&this._lines.push(y+(U!==t.length-1?";":"")))}}}}}class Y extends I{process(t,U,y){for(let I=0;I<this.children.length;I++){const r=this.children[I];if(r.isValid(t))return r.process(t,U,y)}return""}}class mt extends I{isValid(t){return this.testExpression.isTrue(t)}}class X{isTrue(t){return!0}static postfixToInfix(t){const U=[];for(const y of t)if(void 0===X._OperatorPriority[y])U.push(y);else{const t=U[U.length-1],I=U[U.length-2];U.length-=2,U.push(`(${I}${y}${t})`)}return U[U.length-1]}static infixToPostfix(t){const U=X._InfixToPostfixCache.get(t);if(U)return U.accessTime=Date.now(),U.result;if(!t.includes("&&")&&!t.includes("||")&&!t.includes(")")&&!t.includes("("))return[t];const y=[];let I=-1;const r=()=>{M=M.trim(),""!==M&&(y.push(M),M="")},Y=t=>{I<X._Stack.length-1&&(X._Stack[++I]=t)},mt=()=>X._Stack[I],P=()=>-1===I?"!!INVALID EXPRESSION!!":X._Stack[I--];let G=0,M="";for(;G<t.length;){const U=t.charAt(G),L=G<t.length-1?t.substring(G,2+G):"";if("("===U)M="",Y(U);else if(")"===U){for(r();-1!==I&&"("!==mt();)y.push(P());P()}else if(X._OperatorPriority[L]>1){for(r();-1!==I&&X._OperatorPriority[mt()]>=X._OperatorPriority[L];)y.push(P());Y(L),G++}else M+=U;G++}for(r();-1!==I;)"("===mt()?P():y.push(P());return X._InfixToPostfixCache.size>=X.InfixToPostfixCacheLimitSize&&X.ClearCache(),X._InfixToPostfixCache.set(t,{result:y,accessTime:Date.now()}),y}static ClearCache(){const t=Array.from(X._InfixToPostfixCache.entries()).sort(((t,U)=>t[1].accessTime-U[1].accessTime));for(let U=0;U<X.InfixToPostfixCacheCleanupSize;U++)X._InfixToPostfixCache.delete(t[U][0])}}X.InfixToPostfixCacheLimitSize=5e4,X.InfixToPostfixCacheCleanupSize=25e3,X._InfixToPostfixCache=new Map,X._OperatorPriority={")":0,"(":1,"||":2,"&&":3},X._Stack=["","","","","","","","","","","","","","","","","","","",""];class P extends X{constructor(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=t,this.not=U}isTrue(t){let U=void 0!==t[this.define];return this.not&&(U=!U),U}}class G extends X{isTrue(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)}}class M extends X{isTrue(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)}}class L extends X{constructor(t,U,y){super(),this.define=t,this.operand=U,this.testValue=y}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(t){let U=!1;const y=parseInt(void 0!=t[this.define]?t[this.define]:this.define),I=parseInt(void 0!=t[this.testValue]?t[this.testValue]:this.testValue);if(isNaN(y)||isNaN(I))return!1;switch(this.operand){case">":U=y>I;break;case"<":U=y<I;break;case"<=":U=y<=I;break;case">=":U=y>=I;break;case"==":U=y===I;break;case"!=":U=y!==I}return U}}var h=y(12242),Q=y(12273);const F=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,w=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,D=/__decl__/,l=/light\{X\}.(\w*)/g,g=/\{X\}/g,B=[],b=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function p(t){t.processor&&t.processor.initializeShaders&&t.processor.initializeShaders(t.processingContext)}function c(t,U,y,I){var r;null!==(r=U.processor)&&void 0!==r&&r.preProcessShaderCode&&(t=U.processor.preProcessShaderCode(t,U.isFragment)),q(t,U,(t=>{U.processCodeAfterIncludes&&(t=U.processCodeAfterIncludes(U.isFragment?"fragment":"vertex",t,U.defines));const r=function(t,U,y){let I=function(t,U){var y;if(null!==(y=U.processor)&&void 0!==y&&y.noPrecision)return t;const I=U.shouldUseHighPrecisionShader;-1===t.indexOf("precision highp float")?t=I?"precision highp float;\n"+t:"precision mediump float;\n"+t:I||(t=t.replace("precision highp float","precision mediump float"));return t}(t,U);if(!U.processor)return I;if(0===U.processor.shaderLanguage&&-1!==I.indexOf("#version 3")&&(I=I.replace("#version 300 es",""),!U.processor.parseGLES3))return I;const r=U.defines,Y=d(U,y);U.processor.preProcessor&&(I=U.processor.preProcessor(I,r,Y,U.isFragment,U.processingContext));const mt={};I=a(I,Y,U,mt),U.processor.postProcessor&&(I=U.processor.postProcessor(I,r,U.isFragment,U.processingContext,y?{drawBuffersExtensionDisabled:!y.getCaps().drawBuffersExtension}:{},Y,mt));null!==y&&void 0!==y&&y._features.needShaderCodeInlining&&(I=y.inlineShaderCode(I));return I}(t,U,I);y(r,t)}))}function f(t,U,y){return y.processor&&y.processor.finalizeShaders?y.processor.finalizeShaders(t,U,y.processingContext):{vertexCode:t,fragmentCode:U}}function S(t){const U=/defined\((.+)\)/.exec(t);if(U&&U.length)return new P(U[1].trim(),"!"===t[0]);const y=["==","!=",">=","<=","<",">"];let I="",r=0;for(I of y)if(r=t.indexOf(I),r>-1)break;if(-1===r)return new P(t);const Y=t.substring(0,r).trim(),mt=t.substring(r+I.length).trim();return new L(Y,I,mt)}function N(t,U){const y=new mt,I=t.substring(0,U);let r=t.substring(U);return r=r.substring(0,(r.indexOf("//")+1||r.length+1)-1).trim(),y.testExpression="#ifdef"===I?new P(r):"#ifndef"===I?new P(r,!0):function(t){t=t.replace(F,"defined[$1]");const U=X.infixToPostfix(t),y=[];for(const r of U)if("||"!==r&&"&&"!==r)y.push(r);else if(y.length>=2){let t=y[y.length-1],U=y[y.length-2];y.length-=2;const I="&&"==r?new M:new G;"string"===typeof t&&(t=t.replace(E,"defined($1)")),"string"===typeof U&&(U=U.replace(E,"defined($1)")),I.leftOperand="string"===typeof U?S(U):U,I.rightOperand="string"===typeof t?S(t):t,y.push(I)}let I=y[y.length-1];return"string"===typeof I&&(I=I.replace(E,"defined($1)")),"string"===typeof I?S(I):I}(r),y}function j(t,U,y,r){let Y=t.currentLine;for(;J(t,y,r);){Y=t.currentLine;const mt=Y.substring(0,5).toLowerCase();if("#else"===mt){const y=new I;return U.children.push(y),void J(t,y,r)}if("#elif"===mt){const t=N(Y,5);U.children.push(t),y=t}}}function J(t,U,y){for(;t.canRead;){t.lineIndex++;const r=t.currentLine;if(r.indexOf("#")>=0){const I=b.exec(r);if(I&&I.length){switch(I[0]){case"#ifdef":{const I=new Y;U.children.push(I);const mt=N(r,6);I.children.push(mt),j(t,I,mt,y);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const I=new Y;U.children.push(I);const mt=N(r,7);I.children.push(mt),j(t,I,mt,y);break}case"#if":{const I=new Y,mt=N(r,3);U.children.push(I),I.children.push(mt),j(t,I,mt,y);break}}continue}}const mt=new I;if(mt.line=r,U.children.push(mt),"#"===r[0]&&"d"===r[1]){const t=r.replace(";","").split(" ");mt.additionalDefineKey=t[1],3===t.length&&(mt.additionalDefineValue=t[2])}}return!1}function a(t,U,y,Y){const mt=new I,X=new r;return X.lineIndex=-1,X.lines=t.split("\n"),J(X,mt,Y),mt.process(U,y,Y)}function d(t,U){var y;const I=t.defines,r={};for(const Y of I){const t=Y.replace("#define","").replace(";","").trim().split(" ");r[t[0]]=t.length>1?t[1]:""}return 0===(null===(y=t.processor)||void 0===y?void 0:y.shaderLanguage)&&(r.GL_ES="true"),r.__VERSION__=t.version,r[t.platformName]="true",(0,Q.k)(r,null===U||void 0===U?void 0:U.isNDCHalfZRange,null===U||void 0===U?void 0:U.LX,null===U||void 0===U?void 0:U.useExactSrgbConversions),r}function q(t,U,y){let I;for(B.length=0;null!==(I=w.exec(t));)B.push(I);let r=String(t),Y=[t],mt=!1;for(const X of B){let t=X[1];if(-1!==t.indexOf("__decl__")&&(t=t.replace(D,""),U.supportsUniformBuffers&&(t=t.replace("Vertex","Ubo").replace("Fragment","Ubo")),t+="Declaration"),!U.includesShadersStore[t]){const I=U.shadersRepository+"ShadersInclude/"+t+".fx";return void H.loadFile(I,(I=>{U.includesShadersStore[t]=I,q(Y.join(""),U,y)}))}{let y=U.includesShadersStore[t];if(X[2]){const t=X[3].split(",");for(let U=0;U<t.length;U+=2){const I=new RegExp(t[U],"g"),r=t[U+1];y=y.replace(I,r)}}if(X[4]){const t=X[5];if(-1!==t.indexOf("..")){const I=t.split(".."),r=parseInt(I[0]);let Y=parseInt(I[1]),mt=y.slice(0);y="",isNaN(Y)&&(Y=U.indexParameters[I[1]]);for(let t=r;t<Y;t++)U.supportsUniformBuffers||(mt=mt.replace(l,((t,U)=>U+"{X}"))),y+=mt.replace(g,t.toString())+"\n"}else U.supportsUniformBuffers||(y=y.replace(l,((t,U)=>U+"{X}"))),y=y.replace(g,t)}const I=[];for(const t of Y){const U=t.split(X[0]);for(let t=0;t<U.length-1;t++)I.push(U[t]),I.push(y);I.push(U[U.length-1])}Y=I,mt=mt||y.indexOf("#include<")>=0||y.indexOf("#include <")>=0}}B.length=0,r=Y.join(""),mt?q(r.toString(),U,y):y(r)}const H={loadFile:(t,U,y,I,r,Y)=>{throw(0,h.c)("FileTools")}}},12273:(t,U,y)=>{y.d(U,{e:()=>r,g:()=>Y,k:()=>X,m:()=>mt,o:()=>P});var I=y(12242);y(12212);const r={};function Y(t,U){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(U?U+"\n":"")+t}function mt(t,U,y,Y,mt,X,P){const G=P||r.loadFile;if(G){return G(t,U,y,Y,mt,X)}throw(0,I.c)("FileTools")}function X(t,U,y,I){if(t)return U?t.IS_NDC_HALF_ZRANGE="":delete t.IS_NDC_HALF_ZRANGE,y?t.USE_REVERSE_DEPTHBUFFER="":delete t.USE_REVERSE_DEPTHBUFFER,void(I?t.USE_EXACT_SRGB_CONVERSIONS="":delete t.USE_EXACT_SRGB_CONVERSIONS);{let t="";return U&&(t+="#define IS_NDC_HALF_ZRANGE"),y&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),I&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}function P(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3?arguments[3]:void 0;switch(t){case 3:{const t=(ArrayBuffer,new Int8Array(U));return I&&t.set(new Int8Array(I)),t}case 0:{const t=(ArrayBuffer,new Uint8Array(U));return I&&t.set(new Uint8Array(I)),t}case 4:{const t=U instanceof ArrayBuffer?new Int16Array(U):new Int16Array(y?U/2:U);return I&&t.set(new Int16Array(I)),t}case 5:case 8:case 9:case 10:case 2:{const t=U instanceof ArrayBuffer?new Uint16Array(U):new Uint16Array(y?U/2:U);return I&&t.set(new Uint16Array(I)),t}case 6:{const t=U instanceof ArrayBuffer?new Int32Array(U):new Int32Array(y?U/4:U);return I&&t.set(new Int32Array(I)),t}case 7:case 11:case 12:case 13:case 14:case 15:{const t=U instanceof ArrayBuffer?new Uint32Array(U):new Uint32Array(y?U/4:U);return I&&t.set(new Uint32Array(I)),t}case 1:{const t=U instanceof ArrayBuffer?new Float32Array(U):new Float32Array(y?U/4:U);return I&&t.set(new Float32Array(I)),t}}const r=(ArrayBuffer,new Uint8Array(U));return I&&r.set(new Uint8Array(I)),r}},12296:(t,U,y)=>{y.d(U,{e:()=>I});class I{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?I.ShadersRepository:I.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?I.ShadersStore:I.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?I.IncludesShadersStore:I.IncludesShadersStoreWGSL}}I.ShadersRepository="src/Shaders/",I.ShadersStore={},I.IncludesShadersStore={},I.ShadersRepositoryWGSL="src/ShadersWGSL/",I.ShadersStoreWGSL={},I.IncludesShadersStoreWGSL={}},12306:(t,U,y)=>{y.d(U,{c:()=>h,e:()=>g,h:()=>F,k:()=>Q,o:()=>E,r:()=>l,s:()=>L,v:()=>G,x:()=>M,B:()=>P,D:()=>X});class I{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.wU._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(t){t&&this.program&&t(this.program)}setEngine(t){this.wU=t}_fillEffectInformation(t,U,y,I,r,Y,mt,X){const P=this.wU;if(P.supportsUniformBuffers)for(const M in U)t.bindUniformBlock(M,U[M]);let G;for(this.wU.getUniforms(this,y).forEach(((t,U)=>{I[y[U]]=t})),this._uniforms=I,G=0;G<r.length;G++){null==t.getUniform(r[G])&&(r.splice(G,1),G--)}r.forEach(((t,U)=>{Y[t]=U}));for(const M of P.getAttributes(this,mt))X.push(M)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(t,U){const y=this._valueCache[t],I=U.updateFlag;return(void 0===y||y!==I)&&(this._valueCache[t]=I,!0)}_cacheFloat2(t,U,y){let I=this._valueCache[t];if(!I||2!==I.length)return I=[U,y],this._valueCache[t]=I,!0;let r=!1;return I[0]!==U&&(I[0]=U,r=!0),I[1]!==y&&(I[1]=y,r=!0),r}_cacheFloat3(t,U,y,I){let r=this._valueCache[t];if(!r||3!==r.length)return r=[U,y,I],this._valueCache[t]=r,!0;let Y=!1;return r[0]!==U&&(r[0]=U,Y=!0),r[1]!==y&&(r[1]=y,Y=!0),r[2]!==I&&(r[2]=I,Y=!0),Y}_cacheFloat4(t,U,y,I,r){let Y=this._valueCache[t];if(!Y||4!==Y.length)return Y=[U,y,I,r],this._valueCache[t]=Y,!0;let mt=!1;return Y[0]!==U&&(Y[0]=U,mt=!0),Y[1]!==y&&(Y[1]=y,mt=!0),Y[2]!==I&&(Y[2]=I,mt=!0),Y[3]!==r&&(Y[3]=r,mt=!0),mt}setInt(t,U){const y=this._valueCache[t];void 0!==y&&y===U||this.wU.setInt(this._uniforms[t],U)&&(this._valueCache[t]=U)}setInt2(t,U,y){this._cacheFloat2(t,U,y)&&(this.wU.setInt2(this._uniforms[t],U,y)||(this._valueCache[t]=null))}setInt3(t,U,y,I){this._cacheFloat3(t,U,y,I)&&(this.wU.setInt3(this._uniforms[t],U,y,I)||(this._valueCache[t]=null))}setInt4(t,U,y,I,r){this._cacheFloat4(t,U,y,I,r)&&(this.wU.setInt4(this._uniforms[t],U,y,I,r)||(this._valueCache[t]=null))}setIntArray(t,U){this._valueCache[t]=null,this.wU.setIntArray(this._uniforms[t],U)}setIntArray2(t,U){this._valueCache[t]=null,this.wU.setIntArray2(this._uniforms[t],U)}setIntArray3(t,U){this._valueCache[t]=null,this.wU.setIntArray3(this._uniforms[t],U)}setIntArray4(t,U){this._valueCache[t]=null,this.wU.setIntArray4(this._uniforms[t],U)}setUInt(t,U){const y=this._valueCache[t];void 0!==y&&y===U||this.wU.setUInt(this._uniforms[t],U)&&(this._valueCache[t]=U)}setUInt2(t,U,y){this._cacheFloat2(t,U,y)&&(this.wU.setUInt2(this._uniforms[t],U,y)||(this._valueCache[t]=null))}setUInt3(t,U,y,I){this._cacheFloat3(t,U,y,I)&&(this.wU.setUInt3(this._uniforms[t],U,y,I)||(this._valueCache[t]=null))}setUInt4(t,U,y,I,r){this._cacheFloat4(t,U,y,I,r)&&(this.wU.setUInt4(this._uniforms[t],U,y,I,r)||(this._valueCache[t]=null))}setUIntArray(t,U){this._valueCache[t]=null,this.wU.setUIntArray(this._uniforms[t],U)}setUIntArray2(t,U){this._valueCache[t]=null,this.wU.setUIntArray2(this._uniforms[t],U)}setUIntArray3(t,U){this._valueCache[t]=null,this.wU.setUIntArray3(this._uniforms[t],U)}setUIntArray4(t,U){this._valueCache[t]=null,this.wU.setUIntArray4(this._uniforms[t],U)}setArray(t,U){this._valueCache[t]=null,this.wU.setArray(this._uniforms[t],U)}setArray2(t,U){this._valueCache[t]=null,this.wU.setArray2(this._uniforms[t],U)}setArray3(t,U){this._valueCache[t]=null,this.wU.setArray3(this._uniforms[t],U)}setArray4(t,U){this._valueCache[t]=null,this.wU.setArray4(this._uniforms[t],U)}setMatrices(t,U){U&&(this._valueCache[t]=null,this.wU.setMatrices(this._uniforms[t],U))}setMatrix(t,U){this._cacheMatrix(t,U)&&(this.wU.setMatrices(this._uniforms[t],U.bX())||(this._valueCache[t]=null))}setMatrix3x3(t,U){this._valueCache[t]=null,this.wU.setMatrix3x3(this._uniforms[t],U)}setMatrix2x2(t,U){this._valueCache[t]=null,this.wU.setMatrix2x2(this._uniforms[t],U)}setFloat(t,U){const y=this._valueCache[t];void 0!==y&&y===U||this.wU.setFloat(this._uniforms[t],U)&&(this._valueCache[t]=U)}setVector2(t,U){this._cacheFloat2(t,U.x,U.y)&&(this.wU.setFloat2(this._uniforms[t],U.x,U.y)||(this._valueCache[t]=null))}setFloat2(t,U,y){this._cacheFloat2(t,U,y)&&(this.wU.setFloat2(this._uniforms[t],U,y)||(this._valueCache[t]=null))}setVector3(t,U){this._cacheFloat3(t,U.x,U.y,U.z)&&(this.wU.setFloat3(this._uniforms[t],U.x,U.y,U.z)||(this._valueCache[t]=null))}setFloat3(t,U,y,I){this._cacheFloat3(t,U,y,I)&&(this.wU.setFloat3(this._uniforms[t],U,y,I)||(this._valueCache[t]=null))}setVector4(t,U){this._cacheFloat4(t,U.x,U.y,U.z,U.w)&&(this.wU.setFloat4(this._uniforms[t],U.x,U.y,U.z,U.w)||(this._valueCache[t]=null))}setQuaternion(t,U){this._cacheFloat4(t,U.x,U.y,U.z,U.w)&&(this.wU.setFloat4(this._uniforms[t],U.x,U.y,U.z,U.w)||(this._valueCache[t]=null))}setFloat4(t,U,y,I,r){this._cacheFloat4(t,U,y,I,r)&&(this.wU.setFloat4(this._uniforms[t],U,y,I,r)||(this._valueCache[t]=null))}setColor3(t,U){this._cacheFloat3(t,U.r,U.g,U.b)&&(this.wU.setFloat3(this._uniforms[t],U.r,U.g,U.b)||(this._valueCache[t]=null))}setColor4(t,U,y){this._cacheFloat4(t,U.r,U.g,U.b,y)&&(this.wU.setFloat4(this._uniforms[t],U.r,U.g,U.b,y)||(this._valueCache[t]=null))}setDirectColor4(t,U){this._cacheFloat4(t,U.r,U.g,U.b,U.a)&&(this.wU.setFloat4(this._uniforms[t],U.r,U.g,U.b,U.a)||(this._valueCache[t]=null))}_getVertexShaderCode(){return this.vertexShader?this.wU._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.wU._getShaderSource(this.fragmentShader):null}}var r=y(12273);const Y=new WeakMap,mt={_webGLVersion:2,cachedPipelines:{}};function X(t){let U=Y.get(t);if(!U){if(!t)return mt;U={_webGLVersion:t.TEXTURE_BINDING_3D?2:1,_context:t,parallelShaderCompile:t.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Y.set(t,U)}return U}function P(t){Y.delete(t)}function G(t,U,y,I,r,Y){const mt=X(I);Y||(Y=mt._createShaderProgramInjection??h);return Y(t,D(U,"vertex",I,mt._contextWasLost),D(y,"fragment",I,mt._contextWasLost),I,r,mt.validateShaderPrograms)}function M(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6?arguments[6]:void 0;const P=X(r);mt||(mt=P._createShaderProgramInjection??h);const G=P._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return mt(t,w(U,"vertex",I,G,r,P._contextWasLost),w(y,"fragment",I,G,r,P._contextWasLost),r,Y,P.validateShaderPrograms)}function L(t,U){const y=new I,r=X(t);return r.parallelShaderCompile&&!r.disableParallelShaderCompile&&(y.isParallelCompiled=!0),y.context=r._context,y}function h(t,U,y,I){let r=arguments.length>5?arguments[5]:void 0;const Y=I.createProgram();if(t.program=Y,!Y)throw new Error("Unable to create program");return I.attachShader(Y,U),I.attachShader(Y,y),I.linkProgram(Y),t.context=I,t.vertexShader=U,t.fragmentShader=y,t.isParallelCompiled||F(t,I,r),Y}function Q(t,U,y){const I=t;if(I._isDisposed)return!1;const r=X(U);return!!(r&&r.parallelShaderCompile&&r.parallelShaderCompile.COMPLETION_STATUS_KHR&&I.program&&U.getProgramParameter(I.program,r.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(F(I,U,y),!0)}function F(t,U,y){const I=t.context,r=t.vertexShader,Y=t.fragmentShader,mt=t.program;if(!I.getProgramParameter(mt,I.LINK_STATUS)){if(!U.getShaderParameter(r,U.COMPILE_STATUS)){const y=U.getShaderInfoLog(r);if(y)throw t.vertexCompilationError=y,new Error("VERTEX SHADER "+y)}if(!U.getShaderParameter(Y,U.COMPILE_STATUS)){const y=U.getShaderInfoLog(Y);if(y)throw t.fragmentCompilationError=y,new Error("FRAGMENT SHADER "+y)}const y=I.getProgramInfoLog(mt);if(y)throw t.programLinkError=y,new Error(y)}if(y){I.validateProgram(mt);if(!I.getProgramParameter(mt,I.VALIDATE_STATUS)){const U=I.getProgramInfoLog(mt);if(U)throw t.programValidationError=U,new Error(U)}}I.deleteShader(r),I.deleteShader(Y),t.vertexShader=void 0,t.fragmentShader=void 0,t.onCompiled&&(t.onCompiled(),t.onCompiled=void 0)}function E(t,U,y,I,r,Y,mt,P,L){let h=arguments.length>10?arguments[10]:void 0,Q=arguments.length>11?arguments[11]:void 0,F=arguments.length>12?arguments[12]:void 0;const E=X(t.context);Q||(Q=E.createRawShaderProgramInjection??G),F||(F=E.createShaderProgramInjection??M);const w=t;w.program=I?Q(w,U,y,w.context,L):F(w,U,y,P,w.context,L),w.program.__SPECTOR_rebuildProgram=mt,h()}function w(t,U,y,I,Y,mt){return D((0,r.g)(t,y,I),U,Y,mt)}function D(t,U,y,I){const r=y.createShader("vertex"===U?y.VERTEX_SHADER:y.FRAGMENT_SHADER);if(!r){let t=y.NO_ERROR,r=y.NO_ERROR;for(;(r=y.getError())!==y.NO_ERROR;)t=r;throw new Error(`Something went wrong while creating a gl ${U} shader object. gl error=${t}, gl isContextLost=${y.isContextLost()}, _contextWasLost=${I}`)}return y.shaderSource(r,t),y.compileShader(r),r}function l(t,U){U.useProgram(t)}function g(t,U){const y=t;if(!y.isParallelCompiled)return void U(t);const I=y.onCompiled;y.onCompiled=()=>{null===I||void 0===I||I(),U(t)}}},12301:(t,U,y)=>{y.d(U,{b:()=>L,c:()=>Q,d:()=>G,h:()=>M});var I=y(12212),r=y(12306),Y=y(12296),mt=y(12221),X=y(12266),P=y(12273);function G(t,U){return(0,r.D)(U).cachedPipelines[t]}function M(t){const U=t._name,y=t.context;if(U&&y){const t=(0,r.D)(y),I=t.cachedPipelines[U];null===I||void 0===I||I.dispose(),delete t.cachedPipelines[U]}}function L(t,U,y,r,Y,mt,P){let G,M;const L=(0,I.p)()?null===mt||void 0===mt?void 0:mt.getHostDocument():null;G="string"===typeof U?U:U.vertexSource?"source:"+U.vertexSource:U.vertexElement?(null===L||void 0===L?void 0:L.getElementById(U.vertexElement))||U.vertexElement:U.vertex||U,M="string"===typeof U?U:U.fragmentSource?"source:"+U.fragmentSource:U.fragmentElement?(null===L||void 0===L?void 0:L.getElementById(U.fragmentElement))||U.fragmentElement:U.fragment||U;const Q=[void 0,void 0],F=()=>{if(Q[0]&&Q[1]){t.isFragment=!0;const[I,G]=Q;(0,X.l)(G,t,((mt,G)=>{P&&(P._fragmentSourceCodeBeforeMigration=G),y&&(mt=y("fragment",mt));const M=(0,X.d)(I,mt,t);t=null;const L=function(t,U,y,I){if(y){return{vertexSourceCode:(1===I?"//":"")+"#define SHADER_NAME vertex:"+(y.vertexElement||y.vertex||y.spectorName||y)+"\n"+t,fragmentSourceCode:(1===I?"//":"")+"#define SHADER_NAME fragment:"+(y.fragmentElement||y.fragment||y.spectorName||y)+"\n"+U}}return{vertexSourceCode:t,fragmentSourceCode:U}}(M.vertexCode,M.fragmentCode,U,Y);null===r||void 0===r||r(L.vertexSourceCode,L.fragmentSourceCode)}),mt)}};h(G,"Vertex","",(U=>{(0,X.g)(t),(0,X.l)(U,t,((t,I)=>{P&&(P._rawVertexSourceCode=U,P._vertexSourceCodeBeforeMigration=I),y&&(t=y("vertex",t)),Q[0]=t,F()}),mt)}),Y),h(M,"Fragment","Pixel",(t=>{P&&(P._rawFragmentSourceCode=t),Q[1]=t,F()}),Y)}function h(t,U,y,r,mt,X){if("undefined"!==typeof HTMLElement&&t instanceof HTMLElement){return void r((0,I.e)(t))}if("source:"===t.substring(0,7))return void r(t.substring(7));if("base64:"===t.substring(0,7)){return void r(window.atob(t.substring(7)))}const G=Y.e.GetShadersStore(mt);if(G[t+U+"Shader"])return void r(G[t+U+"Shader"]);if(y&&G[t+y+"Shader"])return void r(G[t+y+"Shader"]);let M;if(M="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:Y.e.GetShadersRepository(mt)+t,!(X=X||P.m))throw new Error("loadFileInjection is not defined");X(M+"."+U.toLowerCase()+".fx",r)}const Q=(t,U,y,I)=>{try{const Y=t.context?(0,r.D)(t.context):null;Y&&(Y.disableParallelShaderCompile=t.disableParallelCompilation);const mt=t.existingPipelineContext||U(t.shaderProcessingContext);return mt._name=t.name,t.name&&Y&&(Y.cachedPipelines[t.name]=mt),y(mt,t.vertex,t.fragment,!!t.createAsRaw,"","",t.rebuildRebind,t.defines,t.transformFeedbackVaryings,"",(()=>{I(mt,(()=>{var U;null===(U=t.onRenderingStateCompiled)||void 0===U||U.call(t,mt)}))})),mt}catch(Y){throw mt.b.Error("Error compiling effect"),Y}}},12287:(t,U,y)=>{y.r(U),y.d(U,{Effect:()=>P});var I=y(12204),r=y(12221),Y=y(12296),mt=y(12301),X=y(12277);class P{static get ShadersRepository(){return Y.e.ShadersRepository}static set ShadersRepository(t){Y.e.ShadersRepository=t}get G(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new I.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9?arguments[9]:void 0,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new I.b,this.onErrorObservable=new I.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=t,this._key=Q;const w=this._key.replace(/\r/g,"").replace(/\n/g,"|");let D;if(U.attributes){const t=U;if(this._engine=y,this._attributesNames=t.attributes,this._uniformsNames=t.uniformsNames.concat(t.samplers),this._samplerList=t.samplers.slice(),this.defines=t.defines,this.onError=t.onError,this.onCompiled=t.onCompiled,this._fallbacks=t.fallbacks,this._indexParameters=t.indexParameters,this._transformFeedbackVaryings=t.transformFeedbackVaryings||null,this._multiTarget=!!t.multiTarget,this._shaderLanguage=t.shaderLanguage??0,this._disableParallelShaderCompilation=!!t.disableParallelShaderCompilation,t.uniformBuffersNames){this._uniformBuffersNamesList=t.uniformBuffersNames.slice();for(let U=0;U<t.uniformBuffersNames.length;U++)this._uniformBuffersNames[t.uniformBuffersNames[U]]=U}this._processFinalCode=t.processFinalCode??null,this._processCodeAfterIncludes=t.processCodeAfterIncludes??void 0,E=t.extraInitializationsAsync,D=t.existingPipelineContext}else this._engine=Y,this.defines=null==X?"":X,this._uniformsNames=y.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=U,this._uniformBuffersNamesList=[],this._shaderLanguage=F,this.onError=L,this.onCompiled=M,this._indexParameters=h,this._fallbacks=G;"WEBGL2"===this._engine.shaderPlatformName&&(D=(0,mt.d)(w,this._engine._gl)??D),this._attributeLocationByName={},this.uniqueId=P._UniqueIdSeed++,D?(this._pipelineContext=D,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.G||this.dispose(!0)}))}async _processShaderCodeAsync(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3?arguments[3]:void 0;I&&await I(),this._processingContext=y||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const r={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:t??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Y.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:Y.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,LX:this._engine.LX,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,mt.b)(r,this.name,this._processFinalCode,((t,y)=>{this._vertexSourceCode=t,this._fragmentSourceCode=y,this._prepareEffect(U)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.G||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(t){return this._attributes[t]}getAttributeLocationByName(t){return this._attributeLocationByName[t]}getAttributesCount(){return this._attributes.length}getUniformIndex(t){return this._uniformsNames.indexOf(t)}getUniform(t){return this._uniforms[t]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((t=>{this.executeWhenCompiled(t)}))}executeWhenCompiled(t){this.isReady()?t(this):(this.onCompileObservable.add((U=>{t(U)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(t){(0,X.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(U=>{this._processCompilationErrors(U,t)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(t=this._pipelineContext)||void 0===t?void 0:t._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(t=this._pipelineContext)||void 0===t?void 0:t._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,LX:this._engine.LX,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(t,U,y,I){this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=U,this.onError=(t,U)=>{I&&I(U)},this.onCompiled=()=>{var t,U;const I=this.getEngine().scenes;if(I)for(let y=0;y<I.length;y++)I[y].markAllMaterialsAsDirty(127);null===(t=(U=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===t||t.call(U,y)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(t){if(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let U=0;U<this._attributesNames.length;U++){const t=this._attributesNames[U];this._attributeLocationByName[t]=this._attributes[U]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),P.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this._pipelineContext;this._isReady=!1;try{const y=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),I=y?null:this.defines,r=y?this._vertexSourceCodeOverride:this._vertexSourceCode,Y=y?this._fragmentSourceCodeOverride:this._fragmentSourceCode,X=this._engine;this._pipelineContext=(0,mt.c)({existingPipelineContext:t?U:null,vertex:r,fragment:Y,context:"WEBGL2"===X.shaderPlatformName||"WEBGL1"===X.shaderPlatformName?X._gl:void 0,rebuildRebind:(t,U,y,I)=>this._rebuildProgram(t,U,y,I),defines:I,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:y,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:y=>{U&&!t&&this._engine._deletePipelineContext(U),y&&this._onRenderingStateCompiled(y)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(U)}catch(y){this._processCompilationErrors(y,U)}}_getShaderCodeAndErrorLine(t,U,y){const I=y?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let r=null;if(U&&t){const Y=U.match(I);if(Y&&2===Y.length){const U=parseInt(Y[1]),I=t.split("\n",-1);I.length>=U&&(r=`Offending line [${U}] in ${y?"fragment":"vertex"} code: ${I[U-1]}`)}}return[t,r]}_processCompilationErrors(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=t.message;const y=this._attributesNames,I=this._fallbacks;if(r.b.Error("Unable to compile effect:"),r.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),r.b.Error(`Attributes: ${y.join(" ")}`),r.b.Error("Defines:\n"+this.defines),P.LogShaderCodeOnCompilationError){var Y,mt;let t=null,U=null,y=null;var X;if(null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getVertexShaderCode()&&([y,t]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),y&&(r.b.Error("Vertex code:"),r.b.Error(y))),null!==(mt=this._pipelineContext)&&void 0!==mt&&mt._getFragmentShaderCode())[y,U]=this._getShaderCodeAndErrorLine(null===(X=this._pipelineContext)||void 0===X?void 0:X._getFragmentShaderCode(),this._compilationError,!0),y&&(r.b.Error("Fragment code:"),r.b.Error(y));t&&r.b.Error(t),U&&r.b.Error(U)}r.b.Error("Error: "+this._compilationError);const G=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};U&&(this._pipelineContext=U,this._isReady=!0,G()),I?(this._pipelineContext=null,I.hasMoreFallbacks?(this._allFallbacksProcessed=!1,r.b.Error("Trying next fallback."),this.defines=I.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,G(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,U||G())}get isSupported(){return""===this._compilationError}_bindTexture(t,U){this._engine._bindTexture(this._samplers[t],U,t)}setTexture(t,U){this._engine.setTexture(this._samplers[t],this._uniforms[t],U,t)}setTextureArray(t,U){const y=t+"Ex";if(-1===this._samplerList.indexOf(y+"0")){const I=this._samplerList.indexOf(t);for(let t=1;t<U.length;t++){const U=y+(t-1).toString();this._samplerList.splice(I+t,0,U)}let r=0;for(const t of this._samplerList)this._samplers[t]=r,r+=1}this._engine.setTextureArray(this._samplers[t],this._uniforms[t],U,t)}bindUniformBuffer(t,U){const y=this._uniformBuffersNames[U];void 0===y||P._BaseCache[y]===t&&this._engine._features.useUBOBindingCache||(P._BaseCache[y]=t,this._engine.bindUniformBufferBase(t,y,U))}bindUniformBlock(t,U){this._engine.bindUniformBlock(this._pipelineContext,t,U)}setInt(t,U){return this._pipelineContext.setInt(t,U),this}setInt2(t,U,y){return this._pipelineContext.setInt2(t,U,y),this}setInt3(t,U,y,I){return this._pipelineContext.setInt3(t,U,y,I),this}setInt4(t,U,y,I,r){return this._pipelineContext.setInt4(t,U,y,I,r),this}setIntArray(t,U){return this._pipelineContext.setIntArray(t,U),this}setIntArray2(t,U){return this._pipelineContext.setIntArray2(t,U),this}setIntArray3(t,U){return this._pipelineContext.setIntArray3(t,U),this}setIntArray4(t,U){return this._pipelineContext.setIntArray4(t,U),this}setUInt(t,U){return this._pipelineContext.setUInt(t,U),this}setUInt2(t,U,y){return this._pipelineContext.setUInt2(t,U,y),this}setUInt3(t,U,y,I){return this._pipelineContext.setUInt3(t,U,y,I),this}setUInt4(t,U,y,I,r){return this._pipelineContext.setUInt4(t,U,y,I,r),this}setUIntArray(t,U){return this._pipelineContext.setUIntArray(t,U),this}setUIntArray2(t,U){return this._pipelineContext.setUIntArray2(t,U),this}setUIntArray3(t,U){return this._pipelineContext.setUIntArray3(t,U),this}setUIntArray4(t,U){return this._pipelineContext.setUIntArray4(t,U),this}setFloatArray(t,U){return this._pipelineContext.setArray(t,U),this}setFloatArray2(t,U){return this._pipelineContext.setArray2(t,U),this}setFloatArray3(t,U){return this._pipelineContext.setArray3(t,U),this}setFloatArray4(t,U){return this._pipelineContext.setArray4(t,U),this}setArray(t,U){return this._pipelineContext.setArray(t,U),this}setArray2(t,U){return this._pipelineContext.setArray2(t,U),this}setArray3(t,U){return this._pipelineContext.setArray3(t,U),this}setArray4(t,U){return this._pipelineContext.setArray4(t,U),this}setMatrices(t,U){return this._pipelineContext.setMatrices(t,U),this}setMatrix(t,U){return this._pipelineContext.setMatrix(t,U),this}setMatrix3x3(t,U){return this._pipelineContext.setMatrix3x3(t,U),this}setMatrix2x2(t,U){return this._pipelineContext.setMatrix2x2(t,U),this}setFloat(t,U){return this._pipelineContext.setFloat(t,U),this}setBool(t,U){return this._pipelineContext.setInt(t,U?1:0),this}setVector2(t,U){return this._pipelineContext.setVector2(t,U),this}setFloat2(t,U,y){return this._pipelineContext.setFloat2(t,U,y),this}setVector3(t,U){return this._pipelineContext.setVector3(t,U),this}setFloat3(t,U,y,I){return this._pipelineContext.setFloat3(t,U,y,I),this}setVector4(t,U){return this._pipelineContext.setVector4(t,U),this}setQuaternion(t,U){return this._pipelineContext.setQuaternion(t,U),this}setFloat4(t,U,y,I,r){return this._pipelineContext.setFloat4(t,U,y,I,r),this}setColor3(t,U){return this._pipelineContext.setColor3(t,U),this}setColor4(t,U,y){return this._pipelineContext.setColor4(t,U,y),this}setDirectColor4(t,U){return this._pipelineContext.setDirectColor4(t,U),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(P.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,mt.h)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;U&&(Y.e.GetShadersStore(I)[`${t}PixelShader`]=U),y&&(Y.e.GetShadersStore(I)[`${t}VertexShader`]=y)}static ResetCache(){P._BaseCache={}}}P.LogShaderCodeOnCompilationError=!0,P.PersistentMode=!1,P.AutomaticallyClearCodeCache=!1,P._UniqueIdSeed=0,P._BaseCache={},P.ShadersStore=Y.e.ShadersStore,P.IncludesShadersStore=Y.e.IncludesShadersStore},12242:(t,U,y)=>{y.d(U,{c:()=>r});const I={};function r(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!I[t])return I[t]=!0,`${t} needs to be imported before as it contains a side-effect required by your code.`}},12212:(t,U,y)=>{function I(){return"undefined"!==typeof window}function r(){return"undefined"!==typeof navigator}function Y(){return"undefined"!==typeof document}function mt(t){let U="",y=t.firstChild;for(;y;)3===y.nodeType&&(U+=y.textContent),y=y.nextSibling;return U}y.d(U,{e:()=>mt,h:()=>Y,l:()=>r,p:()=>I})},12221:(t,U,y)=>{y.d(U,{b:()=>I});class I{static _CheckLimit(t,U){let y=I._LogLimitOutputs[t];return y?y.current++:(y={limit:U,current:1},I._LogLimitOutputs[t]=y),y.current<=y.limit}static _GenerateLimitMessage(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const y=I._LogLimitOutputs[t];if(!y||!I.MessageLimitReached)return;const r=this._Levels[U];y.current===y.limit&&I[r.name](I.MessageLimitReached.replace(/%LIMIT%/g,""+y.limit).replace(/%TYPE%/g,r.name??""))}static _AddLogEntry(t){I._LogCache=t+I._LogCache,I.OnNewCacheEntry&&I.OnNewCacheEntry(t)}static _FormatMessage(t){const U=t=>t<10?"0"+t:""+t,y=new Date;return"["+U(y.getHours())+":"+U(y.getMinutes())+":"+U(y.getSeconds())+"]: "+t}static _LogDisabled(t,U){}static _LogEnabled(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const r=Array.isArray(U)?U[0]:U;if(void 0!==y&&!I._CheckLimit(r,y))return;const Y=I._FormatMessage(r),mt=this._Levels[t],X=Array.isArray(U)?U.slice(1):[];mt.logFunc&&mt.logFunc("BJS - "+Y,...X);const P=`<div style='color:${mt.color}'>${Y}</div><br>`;I._AddLogEntry(P),I._GenerateLimitMessage(r,t)}static get LogCache(){return I._LogCache}static ClearLogCache(){I._LogCache="",I._LogLimitOutputs={},I.errorsCount=0}static set LogLevels(t){I.Log=I._LogDisabled,I.Warn=I._LogDisabled,I.Error=I._LogDisabled;const U=[I.MessageLogLevel,I.WarningLogLevel,I.ErrorLogLevel];for(const y of U)if((t&y)===y){const t=this._Levels[y];I[t.name]=I._LogEnabled.bind(I,y)}}}I.NoneLogLevel=0,I.MessageLogLevel=1,I.WarningLogLevel=2,I.ErrorLogLevel=4,I.AllLogLevel=7,I.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",I._LogCache="",I._LogLimitOutputs={},I._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],I.errorsCount=0,I.Log=I._LogEnabled.bind(I,I.MessageLogLevel),I.Warn=I._LogEnabled.bind(I,I.WarningLogLevel),I.Error=I._LogEnabled.bind(I,I.ErrorLogLevel)},12204:(t,U,y)=>{y.d(U,{b:()=>mt});const I="undefined"!==typeof WeakRef;class r{constructor(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0;this.initialize(t,U,y,I)}initialize(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0;return this.mask=t,this.skipNextObservers=U,this.target=y,this.currentTarget=I,this}}class Y{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=t,this.mask=U,this.scope=y,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(t)}}class mt{static FromPromise(t,U){const y=new mt;return t.then((t=>{y.notifyObservers(t)})).catch((t=>{if(!U)throw t;U.notifyObservers(t)})),y}get observers(){return this._observers}constructor(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=U,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new r(0),t&&(this._onObserverAdded=t)}add(t){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)return null;const r=new Y(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);r.unregisterOnNextCall=y,U?this._observers.unshift(r):this._observers.push(r),this._onObserverAdded&&this._onObserverAdded(r),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(r,this._lastNotifiedValue);const mt=I?new WeakRef(this):{deref:()=>this};return r._remove=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=mt.deref();U&&(t?U.remove(r):U._remove(r))},r}addOnce(t){return this.add(t,void 0,void 0,void 0,!0)}remove(t){if(!t)return!1;t._remove=null;return-1!==this._observers.indexOf(t)&&(this._deferUnregister(t),!0)}removeCallback(t,U){for(let y=0;y<this._observers.length;y++){const I=this._observers[y];if(!I._willBeUnregistered&&(I.callback===t&&(!U||U===I.scope)))return this._deferUnregister(I),!0}return!1}_deferUnregister(t){t._willBeUnregistered||(this._numObserversMarkedAsDeleted++,t.unregisterOnNextCall=!1,t._willBeUnregistered=!0,setTimeout((()=>{this._remove(t)}),0))}_remove(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return!1;const y=this._observers.indexOf(t);return-1!==y&&(U&&this._numObserversMarkedAsDeleted--,this._observers.splice(y,1),!0)}makeObserverTopPriority(t){this._remove(t,!1),this._observers.unshift(t)}makeObserverBottomPriority(t){this._remove(t,!1),this._observers.push(t)}notifyObservers(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,y=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),!this._observers.length)return!0;const Y=this._eventState;Y.mask=U,Y.target=y,Y.currentTarget=I,Y.skipNextObservers=!1,Y.lastReturnValue=t,Y.userInfo=r;for(const mt of this._observers)if(!mt._willBeUnregistered&&(mt.mask&U&&(mt.unregisterOnNextCall&&this._deferUnregister(mt),mt.scope?Y.lastReturnValue=mt.callback.apply(mt.scope,[t,Y]):Y.lastReturnValue=mt.callback(t,Y)),Y.skipNextObservers))return!1;return!0}notifyObserver(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=U),t._willBeUnregistered)return;const I=this._eventState;I.mask=y,I.skipNextObservers=!1,t.unregisterOnNextCall&&this._deferUnregister(t),t.callback(U,I)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const t=this._observers.pop();t&&(t._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const t=new mt;return t._observers=this._observers.slice(0),t}hasSpecificMask(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const U of this._observers)if(U.mask&t||U.mask===t)return!0;return!1}}},12277:(t,U,y)=>{y.d(U,{e:()=>r,g:()=>mt});let I=[];class r{static SetImmediate(t){0===I.length&&setTimeout((()=>{const t=I;I=[];for(const U of t)U()}),1),I.push(t)}}function Y(t,U,y){try{if(t())return U(),!0}catch(I){return null===y||void 0===y||y(I),!0}return!1}const mt=function(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,mt=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Y(t,U,y))return null;const X=setInterval((()=>{Y(t,U,y)?clearInterval(X):(r-=I,r<0&&(clearInterval(X),null===y||void 0===y||y(new Error("Operation timed out after maximum retries. "+(mt||"")),!0)))}),I);return()=>clearInterval(X)}}}]);