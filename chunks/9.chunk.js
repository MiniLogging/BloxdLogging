/*! For license information please see ardsm.9.bc1c6871.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10803:function(V,O){!function(V){"use strict";var O=function(V,Z){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,O){V.__proto__=O}||function(V,O){for(var Z in O)Object.prototype.hasOwnProperty.call(O,Z)&&(V[Z]=O[Z])},O(V,Z)};function Z(V,Z){if("function"!==typeof Z&&null!==Z)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function d(){this.constructor=V}O(V,Z),V.prototype=null===Z?Object.create(Z):(d.prototype=Z.prototype,new d)}function d(V,O,Z,d){var p,r=arguments.length,Y=r<3?O:null===d?d=Object.getOwnPropertyDescriptor(O,Z):d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(V,O,Z,d);else for(var m=V.length-1;m>=0;m--)(p=V[m])&&(Y=(r<3?p(Y):r>3?p(O,Z,Y):p(O,Z))||Y);return r>3&&Y&&Object.defineProperty(O,Z,Y),Y}function p(V,O,Z){if(Z||2===arguments.length)for(var d,p=0,r=O.length;p<r;p++)!d&&p in O||(d||(d=Array.prototype.slice.call(O,0,p)),d[p]=O[p]);return V.concat(d||Array.prototype.slice.call(O))}var r,Y=255,m=213;V.OPERATION=void 0,(r=V.OPERATION||(V.OPERATION={}))[r.ADD=128]="ADD",r[r.REPLACE=0]="REPLACE",r[r.DELETE=64]="DELETE",r[r.DELETE_AND_ADD=192]="DELETE_AND_ADD",r[r.TOUCH=1]="TOUCH",r[r.CLEAR=10]="CLEAR";var a=function(){function O(V,O,Z){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=V,this.setParent(O,Z)}return O.prototype.setParent=function(V,O,Z){var d=this;if(this.indexes||(this.indexes=this.ref instanceof eV?this.ref._definition.indexes:{}),this.parent=V,this.parentIndex=Z,O)if(this.root=O,this.ref instanceof eV){var p=this.ref._definition;for(var r in p.schema){var Y=this.ref[r];if(Y&&Y.$changes){var m=p.indexes[r];Y.$changes.setParent(this.ref,O,m)}}}else"object"===typeof this.ref&&this.ref.forEach((function(V,O){if(V instanceof eV){var Z=V.$changes,p=d.ref.$changes.indexes[O];Z.setParent(d.ref,d.root,p)}}))},O.prototype.operation=function(V){this.changes.set(--this.currentCustomOperation,V)},O.prototype.change=function(O,Z){void 0===Z&&(Z=V.OPERATION.ADD);var d="number"===typeof O?O:this.indexes[O];this.assertValidIndex(d,O);var p=this.changes.get(d);p&&p.op!==V.OPERATION.DELETE&&p.op!==V.OPERATION.TOUCH||this.changes.set(d,{op:p&&p.op===V.OPERATION.DELETE?V.OPERATION.DELETE_AND_ADD:Z,index:d}),this.allChanges.add(d),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var Z="number"===typeof O?O:this.indexes[O];this.assertValidIndex(Z,O),this.changes.has(Z)||this.changes.set(Z,{op:V.OPERATION.TOUCH,index:Z}),this.allChanges.add(Z),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(V){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[V]];var O,Z=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(Z)[0]},O.prototype.getChildrenFilter=function(){var V=this.parent._definition.childFilters;return V&&V[this.parentIndex]},O.prototype.getValue=function(V){return this.ref.getByIndex(V)},O.prototype.delete=function(O){var Z="number"===typeof O?O:this.indexes[O];if(void 0!==Z){var d=this.getValue(Z);this.changes.set(Z,{op:V.OPERATION.DELETE,index:Z}),this.allChanges.delete(Z),delete this.caches[Z],d&&d.$changes&&(d.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(Z,")"))},O.prototype.discard=function(O,Z){var d=this;void 0===O&&(O=!1),void 0===Z&&(Z=!1),this.ref instanceof eV||this.changes.forEach((function(O){if(O.op===V.OPERATION.DELETE){var Z=d.ref.getIndex(O.index);delete d.indexes[Z]}})),this.changes.clear(),this.changed=O,Z&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var V=this;this.changes.forEach((function(O){var Z=V.getValue(O.index);Z&&Z.$changes&&Z.$changes.discardAll()})),this.discard()},O.prototype.cache=function(V,O){this.caches[V]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(V,O){if(void 0===V)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function R(V,O,Z,d){return V[O]||(V[O]=[]),V[O].push(Z),null===d||void 0===d||d.forEach((function(V,O){return Z(V,O)})),function(){return M(V[O],V[O].indexOf(Z))}}function i(O){var Z=this,d="string"!==typeof this.$changes.getType();this.$items.forEach((function(p,r){O.push({refId:Z.$changes.refId,op:V.OPERATION.DELETE,field:r,value:void 0,previousValue:p}),d&&Z.$changes.root.removeRef(p.$changes.refId)}))}function M(V,O){if(-1===O||O>=V.length)return!1;for(var Z=V.length-1,d=O;d<Z;d++)V[d]=V[d+1];return V.length=Z,!0}var c=function(V,O){var Z=V.toString(),d=O.toString();return Z<d?-1:Z>d?1:0};function W(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,O){return"symbol"===typeof O||isNaN(O)?V[O]:V.at(O)},set:function(V,O,Z){if("symbol"===typeof O||isNaN(O))V[O]=Z;else{var d=Array.from(V.$items.keys()),p=parseInt(d[O]||O);void 0===Z||null===Z?V.deleteAt(p):V.setAt(p,Z)}return!0},deleteProperty:function(V,O){return"number"===typeof O?V.deleteAt(O):delete V[O],!0}})}var F=function(){function O(){for(var V=[],O=0;O<arguments.length;O++)V[O]=arguments[O];this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,V)}return O.prototype.ve=function(O,Z){return void 0===Z&&(Z=!0),R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,O,Z?this.$items:void 0)},O.prototype.cb=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,O)},O.is=function(V){return Array.isArray(V)||void 0!==V.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(V){0===V?this.clear():this.splice(V,this.length-V)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var V,O=this,Z=[],d=0;d<arguments.length;d++)Z[d]=arguments[d];return Z.forEach((function(Z){V=O.$refId++,O.setAt(V,Z)})),V},O.prototype.pop=function(){var V=Array.from(this.$indexes.values()).pop();if(void 0!==V){this.$changes.delete(V),this.$indexes.delete(V);var O=this.$items.get(V);return this.$items.delete(V),O}},O.prototype.at=function(V){var O=Array.from(this.$items.keys())[V];return this.$items.get(O)},O.prototype.setAt=function(O,Z){var d,p;if(void 0!==Z&&null!==Z){if(this.$items.get(O)!==Z){void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,O);var r=null!==(p=null===(d=this.$changes.indexes[O])||void 0===d?void 0:d.op)&&void 0!==p?p:V.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,Z),this.$changes.change(O,r)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(V){var O=Array.from(this.$items.keys())[V];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(V){return this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&i.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var V,Z=[],d=0;d<arguments.length;d++)Z[d]=arguments[d];return new(O.bind.apply(O,p([void 0],(V=Array.from(this.$items.values())).concat.apply(V,Z),!1)))},O.prototype.join=function(V){return Array.from(this.$items.values()).join(V)},O.prototype.reverse=function(){var V=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Z,d){V.setAt(O[d],Z)})),this},O.prototype.shift=function(){var V=Array.from(this.$items.keys()).shift();if(void 0!==V){var O=this.$items.get(V);return this.$deleteAt(V),O}},O.prototype.slice=function(V,Z){var d=new O;return d.push.apply(d,Array.from(this.$items.values()).slice(V,Z)),d},O.prototype.sort=function(V){var O=this;void 0===V&&(V=c);var Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(V).forEach((function(V,d){O.setAt(Z[d],V)})),this},O.prototype.splice=function(V,O){void 0===O&&(O=this.length-V);for(var Z=Array.from(this.$items.keys()),d=[],p=V;p<V+O;p++)d.push(this.$items.get(Z[p])),this.$deleteAt(Z[p]);return d},O.prototype.unshift=function(){for(var V=this,O=[],Z=0;Z<arguments.length;Z++)O[Z]=arguments[Z];var d=this.length,p=O.length,r=Array.from(this.$items.values());return O.forEach((function(O,Z){V.setAt(Z,O)})),r.forEach((function(O,Z){V.setAt(p+Z,O)})),d+p},O.prototype.indexOf=function(V,O){return Array.from(this.$items.values()).indexOf(V,O)},O.prototype.lastIndexOf=function(V,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(V,O)},O.prototype.every=function(V,O){return Array.from(this.$items.values()).every(V,O)},O.prototype.some=function(V,O){return Array.from(this.$items.values()).some(V,O)},O.prototype.forEach=function(V,O){Array.from(this.$items.values()).forEach(V,O)},O.prototype.map=function(V,O){return Array.from(this.$items.values()).map(V,O)},O.prototype.filter=function(V,O){return Array.from(this.$items.values()).filter(V,O)},O.prototype.reduce=function(V,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(V,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(V,O){return Array.from(this.$items.values()).find(V,O)},O.prototype.findIndex=function(V,O){return Array.from(this.$items.values()).findIndex(V,O)},O.prototype.fill=function(V,O,Z){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(V,O,Z){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(V,O){return Array.from(this.$items.values()).includes(V,O)},O.prototype.flatMap=function(V,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(V){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var V=Array.from(this.$items.values());return V.findLast.apply(V,arguments)},O.prototype.findLastIndex=function(){var V=Array.from(this.$items.values());return V.findLastIndex.apply(V,arguments)},O.prototype.setIndex=function(V,O){this.$indexes.set(V,O)},O.prototype.getIndex=function(V){return this.$indexes.get(V)},O.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},O.prototype.deleteByIndex=function(V){var O=this.$indexes.get(V);this.$items.delete(O),this.$indexes.delete(V)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(V){return"function"===typeof V.toJSON?V.toJSON():V}))},O.prototype.clone=function(V){return V?new(O.bind.apply(O,p([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,p([void 0],this.map((function(V){return V.$changes?V.clone():V})),!1)))},O}();function Q(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,O){return"symbol"!==typeof O&&"undefined"===typeof V[O]?V.get(O):V[O]},set:function(V,O,Z){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"ve"!==O&&"cb"!==O&&"onChange"!==O?V.set(O,Z):V[O]=Z,!0},deleteProperty:function(V,O){return V.delete(O),!0}})}var b=function(){function O(V){var Z=this;if(this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V)if(V instanceof Map||V instanceof O)V.forEach((function(V,O){return Z.set(O,V)}));else for(var d in V)this.set(d,V[d])}return O.prototype.ve=function(O,Z){return void 0===Z&&(Z=!0),R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,O,Z?this.$items:void 0)},O.prototype.cb=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,O)},O.is=function(V){return void 0!==V.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,Z){if(void 0===Z||null===Z)throw new Error("MapSchema#set('".concat(O,"', ").concat(Z,"): trying to set ").concat(Z," value on '").concat(O,"'."));O=O.toString();var d="undefined"!==typeof this.$changes.indexes[O],p=d?this.$changes.indexes[O]:this.$refId++,r=d?V.OPERATION.REPLACE:V.OPERATION.ADD,Y=void 0!==Z.$changes;if(Y&&Z.$changes.setParent(this,this.$changes.root,p),d){if(!Y&&this.$items.get(O)===Z)return;Y&&this.$items.get(O)!==Z&&(r=V.OPERATION.ADD)}else this.$changes.indexes[O]=p,this.$indexes.set(p,O);return this.$items.set(O,Z),this.$changes.change(O,r),this},O.prototype.get=function(V){return this.$items.get(V)},O.prototype.delete=function(V){return this.$changes.delete(V),this.$items.delete(V)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&i.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(V){return this.$items.has(V)},O.prototype.forEach=function(V){this.$items.forEach(V)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(V,O){this.$indexes.set(V,O)},O.prototype.getIndex=function(V){return this.$indexes.get(V)},O.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},O.prototype.deleteByIndex=function(V){var O=this.$indexes.get(V);this.$items.delete(O),this.$indexes.delete(V)},O.prototype.toJSON=function(){var V={};return this.forEach((function(O,Z){V[Z]="function"===typeof O.toJSON?O.toJSON():O})),V},O.prototype.clone=function(V){var Z;return V?Z=Object.assign(new O,this):(Z=new O,this.forEach((function(V,O){V.$changes?Z.set(O,V.clone()):Z.set(O,V)}))),Z},O}(),U={};function H(V,O){U[V]=O}function S(V){return U[V]}var z=function(){function V(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return V.create=function(O){var Z=new V;return Z.schema=Object.assign({},O&&O.schema||{}),Z.indexes=Object.assign({},O&&O.indexes||{}),Z.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),Z.descriptors=Object.assign({},O&&O.descriptors||{}),Z.deprecated=Object.assign({},O&&O.deprecated||{}),Z},V.prototype.addField=function(V,O){var Z=this.getNextFieldIndex();this.fieldsByIndex[Z]=V,this.indexes[V]=Z,this.schema[V]=Array.isArray(O)?{array:O[0]}:O},V.prototype.hasField=function(V){return void 0!==this.indexes[V]},V.prototype.addFilter=function(V,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[V]]=O,this.indexesWithFilters.push(this.indexes[V]),!0},V.prototype.addChildrenFilter=function(V,O){var Z=this.indexes[V],d=this.schema[V];if(S(Object.keys(d)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Z]=O,!0;console.warn("@filterChildren: field '".concat(V,"' can't have children. Ignoring filter."))},V.prototype.getChildrenFilter=function(V){return this.childFilters&&this.childFilters[this.indexes[V]]},V.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},V}();function G(V){return V._context&&V._context.useFilters}var w=function(){function V(){this.types={},this.schemas=new Map,this.useFilters=!1}return V.prototype.has=function(V){return this.schemas.has(V)},V.prototype.get=function(V){return this.types[V]},V.prototype.add=function(V,O){void 0===O&&(O=this.schemas.size),V._definition=z.create(V._definition),V._typeid=O,this.types[O]=V,this.schemas.set(V,O)},V.create=function(O){return void 0===O&&(O={}),function(Z){return O.context||(O.context=new V),C(Z,O)}},V}(),t=new w;function C(V,O){return void 0===O&&(O={}),function(Z,d){var r=O.context||t,Y=Z.constructor;if(Y._context=r,!V)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(d,"\" is undefined. Make sure you don't have any circular dependencies."));r.has(Y)||r.add(Y);var m=Y._definition;if(m.addField(d,V),m.descriptors[d]){if(m.deprecated[d])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(d,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(U){var a=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(a))}}var R=F.is(V),i=!R&&b.is(V);if("string"!==typeof V&&!eV.is(V)){var M=Object.values(V)[0];"string"===typeof M||r.has(M)||r.add(M)}if(O.manual)m.descriptors[d]={enumerable:!0,configurable:!0,writable:!0};else{var c="_".concat(d);m.descriptors[c]={enumerable:!1,configurable:!1,writable:!0},m.descriptors[d]={get:function(){return this[c]},set:function(V){V!==this[c]&&(void 0!==V&&null!==V?(!R||V instanceof F||(V=new(F.bind.apply(F,p([void 0],V,!1)))),!i||V instanceof b||(V=new b(V)),void 0===V.$proxy&&(i?V=Q(V):R&&(V=W(V))),this.$changes.change(d),V.$changes&&V.$changes.setParent(this,this.$changes.root,this._definition.indexes[d])):this[c]&&this.$changes.delete(d),this[c]=V)},enumerable:!0,configurable:!0}}}}function v(V){return function(O,Z){var d=O.constructor;d._definition.addFilter(Z,V)&&(d._context.useFilters=!0)}}function A(V){return function(O,Z){var d=O.constructor;d._definition.addChildrenFilter(Z,V)&&(d._context.useFilters=!0)}}function l(V){return void 0===V&&(V=!0),function(O,Z){var d=O.constructor._definition;d.deprecated[Z]=!0,V&&(d.descriptors[Z]={get:function(){throw new Error("".concat(Z," is deprecated."))},set:function(V){},enumerable:!1,configurable:!0})}}function I(V,O,Z){for(var d in void 0===Z&&(Z={}),Z.context||(Z.context=V._context||Z.context||t),O)C(O[d],Z)(V.prototype,d);return V}function g(V){for(var O=0,Z=0,d=0,p=V.length;d<p;d++)(O=V.charCodeAt(d))<128?Z+=1:O<2048?Z+=2:O<55296||O>=57344?Z+=3:(d++,Z+=4);return Z}function n(V,O,Z){for(var d=0,p=0,r=Z.length;p<r;p++)(d=Z.charCodeAt(p))<128?V[O++]=d:d<2048?(V[O++]=192|d>>6,V[O++]=128|63&d):d<55296||d>=57344?(V[O++]=224|d>>12,V[O++]=128|d>>6&63,V[O++]=128|63&d):(p++,d=65536+((1023&d)<<10|1023&Z.charCodeAt(p)),V[O++]=240|d>>18,V[O++]=128|d>>12&63,V[O++]=128|d>>6&63,V[O++]=128|63&d)}function e(V,O){V.push(255&O)}function u(V,O){V.push(255&O)}function k(V,O){V.push(255&O),V.push(O>>8&255)}function D(V,O){V.push(255&O),V.push(O>>8&255)}function X(V,O){V.push(255&O),V.push(O>>8&255),V.push(O>>16&255),V.push(O>>24&255)}function o(V,O){var Z=O>>24,d=O>>16,p=O>>8,r=O;V.push(255&r),V.push(255&p),V.push(255&d),V.push(255&Z)}function E(V,O){var Z=Math.floor(O/Math.pow(2,32));o(V,O>>>0),o(V,Z)}function L(V,O){var Z=O/Math.pow(2,32)|0;o(V,O>>>0),o(V,Z)}function J(V,O){K(V,O)}function N(V,O){s(V,O)}var P=new Int32Array(2),f=new Float32Array(P.buffer),q=new Float64Array(P.buffer);function K(V,O){f[0]=O,X(V,P[0])}function s(V,O){q[0]=O,X(V,P[0]),X(V,P[1])}function h(V,O){return u(V,O?1:0)}function x(V,O){O||(O="");var Z=g(O),d=0;if(Z<32)V.push(160|Z),d=1;else if(Z<256)V.push(217),u(V,Z),d=2;else if(Z<65536)V.push(218),D(V,Z),d=3;else{if(!(Z<4294967296))throw new Error("String too long");V.push(219),o(V,Z),d=5}return n(V,V.length,O),d+Z}function y(V,O){return isNaN(O)?y(V,0):isFinite(O)?O!==(0|O)?(V.push(203),s(V,O),9):O>=0?O<128?(u(V,O),1):O<256?(V.push(204),u(V,O),2):O<65536?(V.push(205),D(V,O),3):O<4294967296?(V.push(206),o(V,O),5):(V.push(207),L(V,O),9):O>=-32?(V.push(224|O+32),1):O>=-128?(V.push(208),e(V,O),2):O>=-32768?(V.push(209),k(V,O),3):O>=-2147483648?(V.push(210),X(V,O),5):(V.push(211),E(V,O),9):y(V,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var T=Object.freeze({__proto__:null,utf8Write:n,int8:e,uint8:u,int16:k,uint16:D,int32:X,uint32:o,int64:E,uint64:L,float32:J,float64:N,writeFloat32:K,writeFloat64:s,boolean:h,string:x,number:y});function B(V,O,Z){for(var d="",p=0,r=O,Y=O+Z;r<Y;r++){var m=V[r];0!==(128&m)?192!==(224&m)?224!==(240&m)?240!==(248&m)?console.error("Invalid byte "+m.toString(16)):(p=(7&m)<<18|(63&V[++r])<<12|(63&V[++r])<<6|63&V[++r])>=65536?(p-=65536,d+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):d+=String.fromCharCode(p):d+=String.fromCharCode((15&m)<<12|(63&V[++r])<<6|63&V[++r]):d+=String.fromCharCode((31&m)<<6|63&V[++r]):d+=String.fromCharCode(m)}return d}function j(V,O){return VV(V,O)<<24>>24}function VV(V,O){return V[O.offset++]}function OV(V,O){return ZV(V,O)<<16>>16}function ZV(V,O){return V[O.offset++]|V[O.offset++]<<8}function dV(V,O){return V[O.offset++]|V[O.offset++]<<8|V[O.offset++]<<16|V[O.offset++]<<24}function pV(V,O){return dV(V,O)>>>0}function rV(V,O){return cV(V,O)}function YV(V,O){return WV(V,O)}function mV(V,O){var Z=pV(V,O);return dV(V,O)*Math.pow(2,32)+Z}function aV(V,O){var Z=pV(V,O);return pV(V,O)*Math.pow(2,32)+Z}var RV=new Int32Array(2),iV=new Float32Array(RV.buffer),MV=new Float64Array(RV.buffer);function cV(V,O){return RV[0]=dV(V,O),iV[0]}function WV(V,O){return RV[0]=dV(V,O),RV[1]=dV(V,O),MV[0]}function FV(V,O){return VV(V,O)>0}function QV(V,O){var Z,d=V[O.offset++];d<192?Z=31&d:217===d?Z=VV(V,O):218===d?Z=ZV(V,O):219===d&&(Z=pV(V,O));var p=B(V,O.offset,Z);return O.offset+=Z,p}function bV(V,O){var Z=V[O.offset];return Z<192&&Z>160||217===Z||218===Z||219===Z}function UV(V,O){var Z=V[O.offset++];return Z<128?Z:202===Z?cV(V,O):203===Z?WV(V,O):204===Z?VV(V,O):205===Z?ZV(V,O):206===Z?pV(V,O):207===Z?aV(V,O):208===Z?j(V,O):209===Z?OV(V,O):210===Z?dV(V,O):211===Z?mV(V,O):Z>223?-1*(255-Z+1):void 0}function HV(V,O){var Z=V[O.offset];return Z<128||Z>=202&&Z<=211}function SV(V,O){return V[O.offset]<160}function zV(V,O){return V[O.offset-1]===Y&&(V[O.offset]<128||V[O.offset]>=202&&V[O.offset]<=211)}var GV=Object.freeze({__proto__:null,int8:j,uint8:VV,int16:OV,uint16:ZV,int32:dV,uint32:pV,float32:rV,float64:YV,int64:mV,uint64:aV,readFloat32:cV,readFloat64:WV,boolean:FV,string:QV,stringCheck:bV,number:UV,numberCheck:HV,arrayCheck:SV,switchStructureCheck:zV}),wV=function(){function O(V){var O=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return O.add(V)}))}return O.prototype.ve=function(O,Z){return void 0===Z&&(Z=!0),R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,O,Z?this.$items:void 0)},O.prototype.cb=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,O)},O.is=function(V){return void 0!==V.collection},O.prototype.add=function(V){var O=this.$refId++;return void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,V),this.$changes.change(O),O},O.prototype.at=function(V){var O=Array.from(this.$items.keys())[V];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(V){for(var O,Z,d=this.$items.entries();(Z=d.next())&&!Z.done;)if(V===Z.value[1]){O=Z.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&i.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(V){return Array.from(this.$items.values()).some((function(O){return O===V}))},O.prototype.forEach=function(V){var O=this;this.$items.forEach((function(Z,d,p){return V(Z,d,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(V,O){this.$indexes.set(V,O)},O.prototype.getIndex=function(V){return this.$indexes.get(V)},O.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},O.prototype.deleteByIndex=function(V){var O=this.$indexes.get(V);this.$items.delete(O),this.$indexes.delete(V)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var V=[];return this.forEach((function(O,Z){V.push("function"===typeof O.toJSON?O.toJSON():O)})),V},O.prototype.clone=function(V){var Z;return V?Z=Object.assign(new O,this):(Z=new O,this.forEach((function(V){V.$changes?Z.add(V.clone()):Z.add(V)}))),Z},O}(),tV=function(){function O(V){var O=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return O.add(V)}))}return O.prototype.ve=function(O,Z){return void 0===Z&&(Z=!0),R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,O,Z?this.$items:void 0)},O.prototype.cb=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,O)},O.is=function(V){return void 0!==V.set},O.prototype.add=function(O){var Z,d;if(this.has(O))return!1;var p=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,p);var r=null!==(d=null===(Z=this.$changes.indexes[p])||void 0===Z?void 0:Z.op)&&void 0!==d?d:V.OPERATION.ADD;return this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,O),this.$changes.change(p,r),p},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(V){for(var O,Z,d=this.$items.entries();(Z=d.next())&&!Z.done;)if(V===Z.value[1]){O=Z.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&i.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(V){for(var O,Z=this.$items.values(),d=!1;(O=Z.next())&&!O.done;)if(V===O.value){d=!0;break}return d},O.prototype.forEach=function(V){var O=this;this.$items.forEach((function(Z,d,p){return V(Z,d,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(V,O){this.$indexes.set(V,O)},O.prototype.getIndex=function(V){return this.$indexes.get(V)},O.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},O.prototype.deleteByIndex=function(V){var O=this.$indexes.get(V);this.$items.delete(O),this.$indexes.delete(V)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var V=[];return this.forEach((function(O,Z){V.push("function"===typeof O.toJSON?O.toJSON():O)})),V},O.prototype.clone=function(V){var Z;return V?Z=Object.assign(new O,this):(Z=new O,this.forEach((function(V){V.$changes?Z.add(V.clone()):Z.add(V)}))),Z},O}(),CV=function(){function V(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return V.prototype.addRefId=function(V){this.refIds.has(V)||(this.refIds.add(V),this.containerIndexes.set(V,new Set))},V.get=function(O){return void 0===O.$filterState&&(O.$filterState=new V),O.$filterState},V}(),vV=function(){function V(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return V.prototype.getNextUniqueId=function(){return this.nextUniqueId++},V.prototype.addRef=function(V,O,Z){void 0===Z&&(Z=!0),this.refs.set(V,O),Z&&(this.refCounts[V]=(this.refCounts[V]||0)+1)},V.prototype.removeRef=function(V){this.refCounts[V]=this.refCounts[V]-1,this.deletedRefs.add(V)},V.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},V.prototype.garbageCollectDeletedRefs=function(){var V=this;this.deletedRefs.forEach((function(O){if(!(V.refCounts[O]>0)){var Z=V.refs.get(O);if(Z instanceof eV)for(var d in Z._definition.schema)"string"!==typeof Z._definition.schema[d]&&Z[d]&&Z[d].$changes&&V.removeRef(Z[d].$changes.refId);else{var p=Z.$changes.parent._definition,r=p.schema[p.fieldsByIndex[Z.$changes.parentIndex]];"function"===typeof Object.values(r)[0]&&Array.from(Z.values()).forEach((function(O){return V.removeRef(O.$changes.refId)}))}V.refs.delete(O),delete V.refCounts[O]}})),this.deletedRefs.clear()},V}(),AV=function(V){function O(){return null!==V&&V.apply(this,arguments)||this}return Z(O,V),O}(Error);function lV(V,O,Z,d){var p,r=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":p="number",isNaN(V)&&console.log('trying to encode "NaN" in '.concat(Z.constructor.name,"#").concat(d));break;case"string":p="string",r=!0;break;case"boolean":return}if(typeof V!==p&&(!r||r&&null!==V)){var Y="'".concat(JSON.stringify(V),"'").concat(V&&V.constructor&&" (".concat(V.constructor.name,")")||"");throw new AV("a '".concat(p,"' was expected, but ").concat(Y," was provided in ").concat(Z.constructor.name,"#").concat(d))}}function IV(V,O,Z,d){if(!(V instanceof O))throw new AV("a '".concat(O.name,"' was expected, but '").concat(V.constructor.name,"' was provided in ").concat(Z.constructor.name,"#").concat(d))}function gV(V,O,Z,d,p){lV(Z,V,d,p);var r=T[V];if(!r)throw new AV("a '".concat(V,"' was expected, but ").concat(Z," was provided in ").concat(d.constructor.name,"#").concat(p));r(O,Z)}function nV(V,O,Z){return GV[V](O,Z)}var eV=function(){function O(){for(var V=[],O=0;O<arguments.length;O++)V[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new a(this,void 0,new vV),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Z=this._definition.descriptors;Z&&Object.defineProperties(this,Z),V[0]&&this.assign(V[0])}return O.onError=function(V){console.error(V)},O.is=function(V){return V._definition&&void 0!==V._definition.schema},O.prototype.onChange=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,O)},O.prototype.cb=function(O){return R(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,O)},O.prototype.assign=function(V){return Object.assign(this,V),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(V,O){this.$changes.change(V,O)},O.prototype.listen=function(V,O,Z){var d=this;return void 0===Z&&(Z=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[V]||(this.$callbacks[V]=[]),this.$callbacks[V].push(O),Z&&void 0!==this[V]&&O(this[V],void 0),function(){return M(d.$callbacks[V],d.$callbacks[V].indexOf(O))}},O.prototype.decode=function(Z,d,p){var r;void 0===d&&(d={offset:0}),void 0===p&&(p=this);var m=[],a=this.$changes.root,R=Z.length,i=0;for(a.refs.set(i,this);d.offset<R;){var M=Z[d.offset++];if(M!=Y){var c=p.$changes,W=void 0!==p._definition,Q=W?M>>6<<6:M;if(Q!==V.OPERATION.CLEAR){var U=W?M%(Q||255):UV(Z,d),H=W?p._definition.fieldsByIndex[U]:"",z=c.getType(U),G=void 0,w=void 0,t=void 0;if(W?w=p["_".concat(H)]:(w=p.getByIndex(U),(Q&V.OPERATION.ADD)===V.OPERATION.ADD?(t=p instanceof b?QV(Z,d):U,p.setIndex(U,t)):t=p.getIndex(U)),(Q&V.OPERATION.DELETE)===V.OPERATION.DELETE&&(Q!==V.OPERATION.DELETE_AND_ADD&&p.deleteByIndex(U),w&&w.$changes&&a.removeRef(w.$changes.refId),G=null),void 0!==H){if(Q===V.OPERATION.DELETE);else if(O.is(z)){var C=UV(Z,d);if(G=a.refs.get(C),Q!==V.OPERATION.REPLACE){var v=this.getSchemaType(Z,d,z);G||((G=this.createTypeInstance(v)).$changes.refId=C,w&&(G.$callbacks=w.$callbacks,w.$changes.refId&&C!==w.$changes.refId&&a.removeRef(w.$changes.refId))),a.addRef(C,G,G!==w)}}else if("string"===typeof z)G=nV(z,Z,d);else{var A=S(Object.keys(z)[0]),l=UV(Z,d),I=a.refs.has(l)?w||a.refs.get(l):new A.constructor;if((G=I.clone(!0)).$changes.refId=l,w&&(G.$callbacks=w.$callbacks,w.$changes.refId&&l!==w.$changes.refId)){a.removeRef(w.$changes.refId);for(var g=w.entries(),n=void 0;(n=g.next())&&!n.done;){var e=(r=n.value)[0],u=r[1];m.push({refId:l,op:V.OPERATION.DELETE,field:e,value:void 0,previousValue:u})}}a.addRef(l,G,I!==w)}if(null!==G&&void 0!==G)if(G.$changes&&G.$changes.setParent(c.ref,c.root,U),p instanceof O)p[H]=G;else if(p instanceof b)e=t,p.$items.set(e,G),p.$changes.allChanges.add(U);else if(p instanceof F)p.setAt(U,G);else if(p instanceof wV){var k=p.add(G);p.setIndex(U,k)}else p instanceof tV&&!1!==(k=p.add(G))&&p.setIndex(U,k);w!==G&&m.push({refId:i,op:Q,field:H,dynamicIndex:t,value:G,previousValue:w})}else{console.warn("@colyseus/schema: definition mismatch");for(var D={offset:d.offset};d.offset<R&&(!zV(Z,d)||(D.offset=d.offset+1,!a.refs.has(UV(Z,D))));)d.offset++}}else p.clear(m)}else{i=UV(Z,d);var X=a.refs.get(i);if(!X)throw new Error('"refId" not found: '.concat(i));p=X}}return this._triggerChanges(m),a.garbageCollectDeletedRefs(),m},O.prototype.encode=function(Z,d,p){void 0===Z&&(Z=!1),void 0===d&&(d=[]),void 0===p&&(p=!1);for(var r=this.$changes,m=new WeakSet,a=[r],R=1,i=0;i<R;i++){var M=a[i],c=M.ref,W=c instanceof O;M.ensureRefId(),m.add(M),M!==r&&(M.changed||Z)&&(u(d,Y),y(d,M.refId));for(var F=Z?Array.from(M.allChanges):Array.from(M.changes.values()),Q=0,U=F.length;Q<U;Q++){var H=Z?{op:V.OPERATION.ADD,index:F[Q]}:F[Q],z=H.index,G=W?c._definition.fieldsByIndex&&c._definition.fieldsByIndex[z]:z,w=d.length;if(H.op!==V.OPERATION.TOUCH)if(W)u(d,z|H.op);else{if(u(d,H.op),H.op===V.OPERATION.CLEAR)continue;y(d,z)}if(W||(H.op&V.OPERATION.ADD)!=V.OPERATION.ADD||c instanceof b&&x(d,M.ref.$indexes.get(z)),H.op!==V.OPERATION.DELETE){var t=M.getType(z),C=M.getValue(z);if(C&&C.$changes&&!m.has(C.$changes)&&(a.push(C.$changes),C.$changes.ensureRefId(),R++),H.op!==V.OPERATION.TOUCH){if(O.is(t))IV(C,t,c,G),y(d,C.$changes.refId),(H.op&V.OPERATION.ADD)===V.OPERATION.ADD&&this.tryEncodeTypeId(d,t,C.constructor);else if("string"===typeof t)gV(t,d,C,c,G);else{var v=S(Object.keys(t)[0]);IV(c["_".concat(G)],v.constructor,c,G),y(d,C.$changes.refId)}p&&M.cache(z,d.slice(w))}}}Z||p||M.discard()}return d},O.prototype.encodeAll=function(V){return this.encode(!0,[],V)},O.prototype.applyFilters=function(Z,d){var p,r;void 0===d&&(d=!1);for(var m=this,a=new Set,R=CV.get(Z),i=[this.$changes],M=1,c=[],W=function(W){var F=i[W];if(a.has(F.refId))return"continue";var Q=F.ref,U=Q instanceof O;u(c,Y),y(c,F.refId);var H=R.refIds.has(F),S=d||!H;R.addRefId(F);var z=R.containerIndexes.get(F),G=S?Array.from(F.allChanges):Array.from(F.changes.values());!d&&U&&Q._definition.indexesWithFilters&&Q._definition.indexesWithFilters.forEach((function(O){!z.has(O)&&F.allChanges.has(O)&&(S?G.push(O):G.push({op:V.OPERATION.ADD,index:O}))}));for(var w=0,t=G.length;w<t;w++){var C=S?{op:V.OPERATION.ADD,index:G[w]}:G[w];if(C.op!==V.OPERATION.CLEAR){var v=C.index;if(C.op!==V.OPERATION.DELETE){var A=F.getValue(v),l=F.getType(v);if(U){if((I=Q._definition.filters&&Q._definition.filters[v])&&!I.call(Q,Z,A,m)){A&&A.$changes&&a.add(A.$changes.refId);continue}}else{var I,g=F.parent;if((I=F.getChildrenFilter())&&!I.call(g,Z,Q.$indexes.get(v),A,m)){A&&A.$changes&&a.add(A.$changes.refId);continue}}if(A.$changes&&(i.push(A.$changes),M++),C.op!==V.OPERATION.TOUCH)if(C.op===V.OPERATION.ADD||U)c.push.apply(c,null!==(p=F.caches[v])&&void 0!==p?p:[]),z.add(v);else if(z.has(v))c.push.apply(c,null!==(r=F.caches[v])&&void 0!==r?r:[]);else{if(z.add(v),u(c,V.OPERATION.ADD),y(c,v),Q instanceof b){var n=F.ref.$indexes.get(v);x(c,n)}A.$changes?y(c,A.$changes.refId):T[l](c,A)}else A.$changes&&!U&&(u(c,V.OPERATION.ADD),y(c,v),Q instanceof b&&(n=F.ref.$indexes.get(v),x(c,n)),y(c,A.$changes.refId))}else U?u(c,C.op|v):(u(c,C.op),y(c,v))}else u(c,C.op)}},F=0;F<M;F++)W(F);return c},O.prototype.clone=function(){var V,O=new this.constructor,Z=this._definition.schema;for(var d in Z)"object"===typeof this[d]&&"function"===typeof(null===(V=this[d])||void 0===V?void 0:V.clone)?O[d]=this[d].clone():O[d]=this[d];return O},O.prototype.toJSON=function(){var V=this._definition.schema,O=this._definition.deprecated,Z={};for(var d in V)O[d]||null===this[d]||"undefined"===typeof this[d]||(Z[d]="function"===typeof this[d].toJSON?this[d].toJSON():this["_".concat(d)]);return Z},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(V){return this[this._definition.fieldsByIndex[V]]},O.prototype.deleteByIndex=function(V){this[this._definition.fieldsByIndex[V]]=void 0},O.prototype.tryEncodeTypeId=function(V,O,Z){O._typeid!==Z._typeid&&(u(V,m),y(V,Z._typeid))},O.prototype.getSchemaType=function(V,O,Z){var d;return V[O.offset]===m&&(O.offset++,d=this.constructor._context.get(UV(V,O))),d||Z},O.prototype.createTypeInstance=function(V){var O=new V;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(Z){for(var d,p,r,Y,m,a,R,i,M,c=new Set,W=this.$changes.root.refs,F=function(F){var Q=Z[F],b=Q.refId,U=W.get(b),H=U.$callbacks;if((Q.op&V.OPERATION.DELETE)===V.OPERATION.DELETE&&Q.previousValue instanceof O&&(null===(p=null===(d=Q.previousValue.$callbacks)||void 0===d?void 0:d[V.OPERATION.DELETE])||void 0===p||p.forEach((function(V){return V()}))),!H)return"continue";if(U instanceof O){if(!c.has(b))try{null===(r=null===H||void 0===H?void 0:H[V.OPERATION.REPLACE])||void 0===r||r.forEach((function(V){return V()}))}catch(S){O.onError(S)}try{H.hasOwnProperty(Q.field)&&(null===(Y=H[Q.field])||void 0===Y||Y.forEach((function(V){return V(Q.value,Q.previousValue)})))}catch(S){O.onError(S)}}else Q.op===V.OPERATION.ADD&&void 0===Q.previousValue?null===(m=H[V.OPERATION.ADD])||void 0===m||m.forEach((function(V){var O;return V(Q.value,null!==(O=Q.dynamicIndex)&&void 0!==O?O:Q.field)})):Q.op===V.OPERATION.DELETE?void 0!==Q.previousValue&&(null===(a=H[V.OPERATION.DELETE])||void 0===a||a.forEach((function(V){var O;return V(Q.previousValue,null!==(O=Q.dynamicIndex)&&void 0!==O?O:Q.field)}))):Q.op===V.OPERATION.DELETE_AND_ADD&&(void 0!==Q.previousValue&&(null===(R=H[V.OPERATION.DELETE])||void 0===R||R.forEach((function(V){var O;return V(Q.previousValue,null!==(O=Q.dynamicIndex)&&void 0!==O?O:Q.field)}))),null===(i=H[V.OPERATION.ADD])||void 0===i||i.forEach((function(V){var O;return V(Q.value,null!==(O=Q.dynamicIndex)&&void 0!==O?O:Q.field)}))),Q.value!==Q.previousValue&&(null===(M=H[V.OPERATION.REPLACE])||void 0===M||M.forEach((function(V){var O;return V(Q.value,null!==(O=Q.dynamicIndex)&&void 0!==O?O:Q.field)})));c.add(b)},Q=0;Q<Z.length;Q++)F(Q)},O._definition=z.create(),O}();function uV(V){for(var O=[V.$changes],Z=1,d={},p=d,r=function(V){var Z=O[V];Z.changes.forEach((function(V){var O=Z.ref,d=V.index,r=O._definition?O._definition.fieldsByIndex[d]:O.$indexes.get(d);p[r]=Z.getValue(d)}))},Y=0;Y<Z;Y++)r(Y);return d}var kV={context:new w},DV=function(V){function O(){return null!==V&&V.apply(this,arguments)||this}return Z(O,V),d([C("string",kV)],O.prototype,"name",void 0),d([C("string",kV)],O.prototype,"type",void 0),d([C("number",kV)],O.prototype,"referencedType",void 0),O}(eV),XV=function(V){function O(){var O=null!==V&&V.apply(this,arguments)||this;return O.fields=new F,O}return Z(O,V),d([C("number",kV)],O.prototype,"id",void 0),d([C([DV],kV)],O.prototype,"fields",void 0),O}(eV),oV=function(V){function O(){var O=null!==V&&V.apply(this,arguments)||this;return O.types=new F,O}return Z(O,V),O.encode=function(V){var Z=V.constructor,d=new O;d.rootType=Z._typeid;var p=function(V,O){for(var Z in O){var p=new DV;p.name=Z;var r=void 0;if("string"===typeof O[Z])r=O[Z];else{var Y=O[Z],m=void 0;eV.is(Y)?(r="ref",m=O[Z]):"string"===typeof Y[r=Object.keys(Y)[0]]?r+=":"+Y[r]:m=Y[r],p.referencedType=m?m._typeid:-1}p.type=r,V.fields.push(p)}d.types.push(V)},r=Z._context.types;for(var Y in r){var m=new XV;m.id=Number(Y),p(m,r[Y]._definition.schema)}return d.encodeAll()},O.decode=function(V,d){var p=new w,r=new O;r.decode(V,d);var Y=r.types.reduce((function(V,O){var d=function(V){function O(){return null!==V&&V.apply(this,arguments)||this}return Z(O,V),O}(eV),r=O.id;return V[r]=d,p.add(d,r),V}),{});r.types.forEach((function(V){var O=Y[V.id];V.fields.forEach((function(V){var Z;if(void 0!==V.referencedType){var d=V.type,r=Y[V.referencedType];if(!r){var m=V.type.split(":");d=m[0],r=m[1]}"ref"===d?C(r,{context:p})(O.prototype,V.name):C(((Z={})[d]=r,Z),{context:p})(O.prototype,V.name)}else C(V.type,{context:p})(O.prototype,V.name)}))}));var m=Y[r.rootType],a=new m;for(var R in m._definition.schema){var i=m._definition.schema[R];"string"!==typeof i&&(a[R]="function"===typeof i?new i:new(S(Object.keys(i)[0]).constructor))}return a},d([C([XV],kV)],O.prototype,"types",void 0),d([C("number",kV)],O.prototype,"rootType",void 0),O}(eV);H("map",{constructor:b}),H("array",{constructor:F}),H("set",{constructor:tV}),H("collection",{constructor:wV}),V.ArraySchema=F,V.CollectionSchema=wV,V.Context=w,V.MapSchema=b,V.Reflection=oV,V.ReflectionField=DV,V.ReflectionType=XV,V.Schema=eV,V.SchemaDefinition=z,V.SetSchema=tV,V.decode=GV,V.defineTypes=I,V.deprecated=l,V.dumpChanges=uV,V.encode=T,V.filter=v,V.filterChildren=A,V.hasFilter=G,V.registerType=H,V.type=C,Object.defineProperty(V,"__esModule",{value:!0})}(O)},12413:V=>{V.exports=function(V){return null!=V&&null!=V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}},12390:(V,O,Z)=>{"use strict";var d=Z(12398),p=Z(12404),r=Z(12413);Z.g.__TYPEDARRAY_POOL||(Z.g.__TYPEDARRAY_POOL={UINT8:p([32,0]),UINT16:p([32,0]),UINT32:p([32,0]),INT8:p([32,0]),INT16:p([32,0]),INT32:p([32,0]),FLOAT:p([32,0]),DOUBLE:p([32,0]),DATA:p([32,0]),UINT8C:p([32,0]),BUFFER:p([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,m=Z.g.__TYPEDARRAY_POOL;m.UINT8C||(m.UINT8C=p([32,0])),m.BUFFER||(m.BUFFER=p([32,0]));var a=m.DATA,R=m.BUFFER;function i(V){if(V){var O=V.length||V.byteLength,Z=d.log2(O);a[Z].push(V)}}function M(V){V=d.nextPow2(V);var O=d.log2(V),Z=a[O];return Z.length>0?Z.pop():new ArrayBuffer(V)}function c(V){return new Uint8Array(M(V),0,V)}function W(V){return new Uint16Array(M(2*V),0,V)}function F(V){return new Uint32Array(M(4*V),0,V)}function Q(V){return new Int8Array(M(V),0,V)}function b(V){return new Int16Array(M(2*V),0,V)}function U(V){return new Int32Array(M(4*V),0,V)}function H(V){return new Float32Array(M(4*V),0,V)}function S(V){return new Float64Array(M(8*V),0,V)}function z(V){return Y?new Uint8ClampedArray(M(V),0,V):c(V)}function G(V){return new DataView(M(V),0,V)}O.free=function(V){if(r(V))R[d.log2(V.length)].push(V);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(V)&&(V=V.buffer),!V)return;var O=V.length||V.byteLength,Z=0|d.log2(O);a[Z].push(V)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(V){i(V.buffer)},O.freeArrayBuffer=i,O.freeBuffer=function(V){R[d.log2(V.length)].push(V)},O.malloc=function(V,O){if(void 0===O||"arraybuffer"===O)return M(V);switch(O){case"uint8":return c(V);case"uint16":return W(V);case"uint32":return F(V);case"int8":return Q(V);case"int16":return b(V);case"int32":return U(V);case"float":case"float32":return H(V);case"double":case"float64":return S(V);case"uint8_clamped":return z(V);case"buffer":throw"Buffer not supported";case"data":case"dataview":return G(V);default:return null}return null},O.mallocArrayBuffer=M,O.mallocUint8=c,O.mallocUint16=W,O.mallocUint32=F,O.mallocInt8=Q,O.mallocInt16=b,O.mallocInt32=U,O.mallocFloat32=O.mallocFloat=H,O.mallocFloat64=O.mallocDouble=S,O.mallocUint8Clamped=z,O.mallocDataView=G,O.clearCache=function(){for(var V=0;V<32;++V)m.UINT8[V].length=0,m.UINT16[V].length=0,m.UINT32[V].length=0,m.INT8[V].length=0,m.INT16[V].length=0,m.INT32[V].length=0,m.FLOAT[V].length=0,m.DOUBLE[V].length=0,m.UINT8C[V].length=0,a[V].length=0,R[V].length=0}},12481:(V,O,Z)=>{V.exports=p;var d=Z(141);function p(V,O){if(!(this instanceof p))return new p(V,O);var Z=d.create();d.add(Z,V,O),this.base=d.min(d.create(),V,Z),this.Eg=d.clone(O),this.max=d.max(d.create(),V,Z),this.mag=d.length(this.Eg)}var r=p.prototype;r.width=function(){return this.Eg[0]},r.height=function(){return this.Eg[1]},r.depth=function(){return this.Eg[2]},r.x0=function(){return this.base[0]},r.y0=function(){return this.base[1]},r.z0=function(){return this.base[2]},r.x1=function(){return this.max[0]},r.y1=function(){return this.max[1]},r.z1=function(){return this.max[2]},r.translate=function(V){return d.add(this.max,this.max,V),d.add(this.base,this.base,V),this},r.setPosition=function(V){return d.add(this.max,V,this.Eg),d.j(this.base,V),this},r.expand=function(V){var O=d.create(),Z=d.create();return d.max(O,V.max,this.max),d.min(Z,V.base,this.base),d.fc(O,O,Z),new p(Z,O)},r.intersects=function(V){return!(V.base[0]>this.max[0])&&(!(V.base[1]>this.max[1])&&(!(V.base[2]>this.max[2])&&(!(V.max[0]<this.base[0])&&(!(V.max[1]<this.base[1])&&!(V.max[2]<this.base[2])))))},r.touches=function(V){var O=this.union(V);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},r.union=function(V){if(!this.intersects(V))return null;var O=Math.max(V.base[0],this.base[0]),Z=Math.max(V.base[1],this.base[1]),d=Math.max(V.base[2],this.base[2]);return new p([O,Z,d],[Math.min(V.max[0],this.max[0])-O,Math.min(V.max[1],this.max[1])-Z,Math.min(V.max[2],this.max[2])-d])}},12398:(V,O)=>{"use strict";function Z(V){var O=32;return(V&=-V)&&O--,65535&V&&(O-=16),16711935&V&&(O-=8),252645135&V&&(O-=4),858993459&V&&(O-=2),1431655765&V&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(V){return(V>0)-(V<0)},O.abs=function(V){var O=V>>31;return(V^O)-O},O.min=function(V,O){return O^(V^O)&-(V<O)},O.max=function(V,O){return V^(V^O)&-(V<O)},O.isPow2=function(V){return!(V&V-1)&&!!V},O.log2=function(V){var O,Z;return O=(V>65535)<<4,O|=Z=((V>>>=O)>255)<<3,O|=Z=((V>>>=Z)>15)<<2,(O|=Z=((V>>>=Z)>3)<<1)|(V>>>=Z)>>1},O.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},O.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},O.countTrailingZeros=Z,O.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},O.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},O.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var d=new Array(256);!function(V){for(var O=0;O<256;++O){var Z=O,d=O,p=7;for(Z>>>=1;Z;Z>>>=1)d<<=1,d|=1&Z,--p;V[O]=d<<p&255}}(d),O.reverse=function(V){return d[255&V]<<24|d[V>>>8&255]<<16|d[V>>>16&255]<<8|d[V>>>24&255]},O.interleave2=function(V,O){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(V,O){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>O&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},O.interleave3=function(V,O,Z){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},O.deinterleave3=function(V,O){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>O&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},O.nextCombination=function(V){var O=V|V-1;return O+1|(~O&-~O)-1>>>Z(V)+1}},12387:(V,O,Z)=>{"use strict";V.exports=function(V,O,Z){switch(arguments.length){case 1:return d=[],R(p=V,p,i,!0),d;case 2:return"function"===typeof O?R(V,V,O,!0):function(V,O){return d=[],R(V,O,i,!1),d}(V,O);case 3:return R(V,O,Z,!1);default:throw new Error("box-intersect: Invalid arguments")}var p};var d,p=Z(12390),r=Z(12420),Y=Z(12430);function m(V,O){for(var Z=0;Z<V;++Z)if(!(O[Z]<=O[Z+V]))return!0;return!1}function a(V,O,Z,d){for(var p=0,r=0,Y=0,a=V.length;Y<a;++Y){var R=V[Y];if(!m(O,R)){for(var i=0;i<2*O;++i)Z[p++]=R[i];d[r++]=Y}}return r}function R(V,O,Z,d){var m=V.length,R=O.length;if(!(m<=0||R<=0)){var i=V[0].length>>>1;if(!(i<=0)){var M,c=p.mallocDouble(2*i*m),W=p.mallocInt32(m);if((m=a(V,i,c,W))>0){if(1===i&&d)r.init(m),M=r.sweepComplete(i,Z,0,m,c,W,0,m,c,W);else{var F=p.mallocDouble(2*i*R),Q=p.mallocInt32(R);(R=a(O,i,F,Q))>0&&(r.init(m+R),M=1===i?r.sweepBipartite(i,Z,0,m,c,W,0,R,F,Q):Y(i,Z,d,m,c,W,R,F,Q),p.free(F),p.free(Q))}p.free(c),p.free(W)}return M}}}function i(V,O){d.push([V,O])}},12434:(V,O)=>{"use strict";var Z="d",d="ax",p="fp",r="es",Y="rs",m="re",a="rb",R="bs",i="be",M="bb",c=[Z,d,"vv",Y,m,a,"ri",R,i,M,"bi"];function W(V){var O="bruteForce"+(V?"Full":"Partial"),d=[],Y=c.slice();V||Y.splice(3,0,p);var m=["function "+O+"("+Y.join()+"){"];function a(O,p){var Y=function(V,O,d){var p="bruteForce"+(V?"Red":"Blue")+(O?"Flip":"")+(d?"Full":""),Y=["function ",p,"(",c.join(),"){","var ",r,"=2*",Z,";"],m="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",a="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(d?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return V?Y.push(m,"Q",":",a):Y.push(a,"Q",":",m),d?Y.push("if(y1<x0||x1<y0)continue;"):O?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:p,code:Y.join("")}}(O,p,V);d.push(Y.code),m.push("return "+Y.name+"("+c.join()+");")}m.push("if(re-rs>be-bs){"),V?(a(!0,!1),m.push("}else{"),a(!1,!1)):(m.push("if(fp){"),a(!0,!0),m.push("}else{"),a(!0,!1),m.push("}}else{if(fp){"),a(!1,!0),m.push("}else{"),a(!1,!1),m.push("}")),m.push("}}return "+O);var R=d.join("")+m.join("");return new Function(R)()}O.partial=W(!1),O.full=W(!0)},12430:(V,O,Z)=>{"use strict";V.exports=function(V,O,Z,r,i,l,I,g,n){!function(V,O){var Z=8*p.log2(O+1)*(V+1)|0,r=p.nextPow2(z*Z);w.length<r&&(d.free(w),w=d.mallocInt32(r));var Y=p.nextPow2(G*Z);t.length<Y&&(d.free(t),t=d.mallocDouble(Y))}(V,r+I);var e,u=0,k=2*V;C(u++,0,0,r,0,I,Z?16:0,-1/0,1/0),Z||C(u++,0,0,I,0,r,1,-1/0,1/0);for(;u>0;){var D=(u-=1)*z,X=w[D],o=w[D+1],E=w[D+2],L=w[D+3],J=w[D+4],N=w[D+5],P=u*G,f=t[P],q=t[P+1],K=1&N,s=!!(16&N),h=i,x=l,y=g,T=n;if(K&&(h=g,x=n,y=i,T=l),!(2&N&&o>=(E=b(V,X,o,E,h,x,q)))&&!(4&N&&(o=U(V,X,o,E,h,x,f))>=E)){var B=E-o,j=J-L;if(s){if(V*B*(B+j)<W){if(void 0!==(e=a.scanComplete(V,X,O,o,E,h,x,L,J,y,T)))return e;continue}}else{if(V*Math.min(B,j)<M){if(void 0!==(e=Y(V,X,O,K,o,E,h,x,L,J,y,T)))return e;continue}if(V*B*j<c){if(void 0!==(e=a.scanBipartite(V,X,O,K,o,E,h,x,L,J,y,T)))return e;continue}}var VV=F(V,X,o,E,h,x,f,q);if(o<VV)if(V*(VV-o)<M){if(void 0!==(e=m(V,X+1,O,o,VV,h,x,L,J,y,T)))return e}else if(X===V-2){if(void 0!==(e=K?a.sweepBipartite(V,O,L,J,y,T,o,VV,h,x):a.sweepBipartite(V,O,o,VV,h,x,L,J,y,T)))return e}else C(u++,X+1,o,VV,L,J,K,-1/0,1/0),C(u++,X+1,L,J,o,VV,1^K,-1/0,1/0);if(VV<E){var OV=R(V,X,L,J,y,T),ZV=y[k*OV+X],dV=Q(V,X,OV,J,y,T,ZV);if(dV<J&&C(u++,X,VV,E,dV,J,(4|K)+(s?16:0),ZV,q),L<OV&&C(u++,X,VV,E,L,OV,(2|K)+(s?16:0),f,ZV),OV+1===dV){if(void 0!==(e=s?A(V,X,O,VV,E,h,x,OV,y,T[OV]):v(V,X,O,K,VV,E,h,x,OV,y,T[OV])))return e}else if(OV<dV){var pV;if(s){if(VV<(pV=H(V,X,VV,E,h,x,ZV))){var rV=Q(V,X,VV,pV,h,x,ZV);if(X===V-2){if(VV<rV&&void 0!==(e=a.sweepComplete(V,O,VV,rV,h,x,OV,dV,y,T)))return e;if(rV<pV&&void 0!==(e=a.sweepBipartite(V,O,rV,pV,h,x,OV,dV,y,T)))return e}else VV<rV&&C(u++,X+1,VV,rV,OV,dV,16,-1/0,1/0),rV<pV&&(C(u++,X+1,rV,pV,OV,dV,0,-1/0,1/0),C(u++,X+1,OV,dV,rV,pV,1,-1/0,1/0))}}else VV<(pV=K?S(V,X,VV,E,h,x,ZV):H(V,X,VV,E,h,x,ZV))&&(X===V-2?e=K?a.sweepBipartite(V,O,OV,dV,y,T,VV,pV,h,x):a.sweepBipartite(V,O,VV,pV,h,x,OV,dV,y,T):(C(u++,X+1,VV,pV,OV,dV,K,-1/0,1/0),C(u++,X+1,OV,dV,VV,pV,1^K,-1/0,1/0)))}}}}};var d=Z(12390),p=Z(12398),r=Z(12434),Y=r.partial,m=r.full,a=Z(12420),R=Z(12442),i=Z(12449),M=128,c=1<<22,W=1<<22,F=i("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Q=i("lo===p0",["p0"]),b=i("lo<p0",["p0"]),U=i("hi<=p0",["p0"]),H=i("lo<=p0&&p0<=hi",["p0"]),S=i("lo<p0&&p0<=hi",["p0"]),z=6,G=2,w=d.mallocInt32(1024),t=d.mallocDouble(1024);function C(V,O,Z,d,p,r,Y,m,a){var R=z*V;w[R]=O,w[R+1]=Z,w[R+2]=d,w[R+3]=p,w[R+4]=r,w[R+5]=Y;var i=G*V;t[i]=m,t[i+1]=a}function v(V,O,Z,d,p,r,Y,m,a,R,i){var M=2*V,c=a*M,W=R[c+O];V:for(var F=p,Q=p*M;F<r;++F,Q+=M){var b=Y[Q+O],U=Y[Q+O+V];if(!(W<b||U<W)&&(!d||W!==b)){for(var H,S=m[F],z=O+1;z<V;++z){b=Y[Q+z],U=Y[Q+z+V];var G=R[c+z],w=R[c+z+V];if(U<G||w<b)continue V}if(void 0!==(H=d?Z(i,S):Z(S,i)))return H}}}function A(V,O,Z,d,p,r,Y,m,a,R){var i=2*V,M=m*i,c=a[M+O];V:for(var W=d,F=d*i;W<p;++W,F+=i){var Q=Y[W];if(Q!==R){var b=r[F+O],U=r[F+O+V];if(!(c<b||U<c)){for(var H=O+1;H<V;++H){b=r[F+H],U=r[F+H+V];var S=a[M+H],z=a[M+H+V];if(U<S||z<b)continue V}var G=Z(Q,R);if(void 0!==G)return G}}}}},12442:(V,O,Z)=>{"use strict";V.exports=function(V,O,Z,Y,m,a){if(Y<=Z+1)return Z;var R=Z,i=Y,M=Y+Z>>>1,c=2*V,W=M,F=m[c*M+O];for(;R<i;){if(i-R<p){r(V,O,R,i,m,a),F=m[c*M+O];break}var Q=i-R,b=Math.random()*Q+R|0,U=m[c*b+O],H=Math.random()*Q+R|0,S=m[c*H+O],z=Math.random()*Q+R|0,G=m[c*z+O];U<=S?G>=S?(W=H,F=S):U>=G?(W=b,F=U):(W=z,F=G):S>=G?(W=H,F=S):G>=U?(W=b,F=U):(W=z,F=G);for(var w=c*(i-1),t=c*W,C=0;C<c;++C,++w,++t){var v=m[w];m[w]=m[t],m[t]=v}var A=a[i-1];a[i-1]=a[W],a[W]=A;for(w=c*(i-1),t=c*(W=d(V,O,R,i-1,m,a,F)),C=0;C<c;++C,++w,++t){v=m[w];m[w]=m[t],m[t]=v}A=a[i-1];if(a[i-1]=a[W],a[W]=A,M<W){for(i=W-1;R<i&&m[c*(i-1)+O]===F;)i-=1;i+=1}else{if(!(W<M))break;for(R=W+1;R<i&&m[c*R+O]===F;)R+=1}}return d(V,O,Z,M,m,a,m[c*M+O])};var d=Z(12449)("lo<p0",["p0"]),p=8;function r(V,O,Z,d,p,r){for(var Y=2*V,m=Y*(Z+1)+O,a=Z+1;a<d;++a,m+=Y)for(var R=p[m],i=a,M=Y*(a-1);i>Z&&p[M+O]>R;--i,M-=Y){for(var c=M,W=M+Y,F=0;F<Y;++F,++c,++W){var Q=p[c];p[c]=p[W],p[W]=Q}var b=r[i];r[i]=r[i-1],r[i-1]=b}}},12449:V=>{"use strict";V.exports=function(V,Z){var d="abcdef".split("").concat(Z),p=[];V.indexOf("lo")>=0&&p.push("lo=e[k+n]");V.indexOf("hi")>=0&&p.push("hi=e[k+o]");return d.push(O.replace("_",p.join()).replace("$",V)),Function.apply(void 0,d)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12427:V=>{"use strict";V.exports=function(V,d){d<=4*O?Z(0,d-1,V):R(0,d-1,V)};var O=32;function Z(V,O,Z){for(var d=2*(V+1),p=V+1;p<=O;++p){for(var r=Z[d++],Y=Z[d++],m=p,a=d-2;m-- >V;){var R=Z[a-2],i=Z[a-1];if(R<r)break;if(R===r&&i<Y)break;Z[a]=R,Z[a+1]=i,a-=2}Z[a]=r,Z[a+1]=Y}}function d(V,O,Z){O*=2;var d=Z[V*=2],p=Z[V+1];Z[V]=Z[O],Z[V+1]=Z[O+1],Z[O]=d,Z[O+1]=p}function p(V,O,Z){O*=2,Z[V*=2]=Z[O],Z[V+1]=Z[O+1]}function r(V,O,Z,d){O*=2,Z*=2;var p=d[V*=2],r=d[V+1];d[V]=d[O],d[V+1]=d[O+1],d[O]=d[Z],d[O+1]=d[Z+1],d[Z]=p,d[Z+1]=r}function Y(V,O,Z,d,p){O*=2,p[V*=2]=p[O],p[O]=Z,p[V+1]=p[O+1],p[O+1]=d}function m(V,O,Z){O*=2;var d=Z[V*=2],p=Z[O];return!(d<p)&&(d!==p||Z[V+1]>Z[O+1])}function a(V,O,Z,d){var p=d[V*=2];return p<O||p===O&&d[V+1]<Z}function R(V,i,M){var c=(i-V+1)/6|0,W=V+c,F=i-c,Q=V+i>>1,b=Q-c,U=Q+c,H=W,S=b,z=Q,G=U,w=F,t=V+1,C=i-1,v=0;m(H,S,M)&&(v=H,H=S,S=v),m(G,w,M)&&(v=G,G=w,w=v),m(H,z,M)&&(v=H,H=z,z=v),m(S,z,M)&&(v=S,S=z,z=v),m(H,G,M)&&(v=H,H=G,G=v),m(z,G,M)&&(v=z,z=G,G=v),m(S,w,M)&&(v=S,S=w,w=v),m(S,z,M)&&(v=S,S=z,z=v),m(G,w,M)&&(v=G,G=w,w=v);for(var A=M[2*S],l=M[2*S+1],I=M[2*G],g=M[2*G+1],n=2*H,e=2*z,u=2*w,k=2*W,D=2*Q,X=2*F,o=0;o<2;++o){var E=M[n+o],L=M[e+o],J=M[u+o];M[k+o]=E,M[D+o]=L,M[X+o]=J}p(b,V,M),p(U,i,M);for(var N=t;N<=C;++N)if(a(N,A,l,M))N!==t&&d(N,t,M),++t;else if(!a(N,I,g,M))for(;;){if(a(C,I,g,M)){a(C,A,l,M)?(r(N,t,C,M),++t,--C):(d(N,C,M),--C);break}if(--C<N)break}Y(V,t-1,A,l,M),Y(i,C+1,I,g,M),t-2-V<=O?Z(V,t-2,M):R(V,t-2,M),i-(C+2)<=O?Z(C+2,i,M):R(C+2,i,M),C-t<=O?Z(t,C,M):R(t,C,M)}},12420:(V,O,Z)=>{"use strict";V.exports={init:function(V){var O=p.nextPow2(V);a.length<O&&(d.free(a),a=d.mallocInt32(O));R.length<O&&(d.free(R),R=d.mallocInt32(O));i.length<O&&(d.free(i),i=d.mallocInt32(O));M.length<O&&(d.free(M),M=d.mallocInt32(O));c.length<O&&(d.free(c),c=d.mallocInt32(O));W.length<O&&(d.free(W),W=d.mallocInt32(O));var Z=8*O;F.length<Z&&(d.free(F),F=d.mallocDouble(Z))},sweepBipartite:function(V,O,Z,d,p,m,c,W,U,H){for(var S=0,z=2*V,G=V-1,w=z-1,t=Z;t<d;++t){var C=m[t],v=z*t;F[S++]=p[v+G],F[S++]=-(C+1),F[S++]=p[v+w],F[S++]=C}for(t=c;t<W;++t){C=H[t]+Y;var A=z*t;F[S++]=U[A+G],F[S++]=-C,F[S++]=U[A+w],F[S++]=C}var l=S>>>1;r(F,l);var I=0,g=0;for(t=0;t<l;++t){var n=0|F[2*t+1];if(n>=Y)Q(i,M,g--,n=n-Y|0);else if(n>=0)Q(a,R,I--,n);else if(n<=-Y){n=-n-Y|0;for(var e=0;e<I;++e){if(void 0!==(u=O(a[e],n)))return u}b(i,M,g++,n)}else{n=-n-1|0;for(e=0;e<g;++e){var u;if(void 0!==(u=O(n,i[e])))return u}b(a,R,I++,n)}}},sweepComplete:function(V,O,Z,d,p,Y,m,U,H,S){for(var z=0,G=2*V,w=V-1,t=G-1,C=Z;C<d;++C){var v=Y[C]+1<<1,A=G*C;F[z++]=p[A+w],F[z++]=-v,F[z++]=p[A+t],F[z++]=v}for(C=m;C<U;++C){v=S[C]+1<<1;var l=G*C;F[z++]=H[l+w],F[z++]=1|-v,F[z++]=H[l+t],F[z++]=1|v}var I=z>>>1;r(F,I);var g=0,n=0,e=0;for(C=0;C<I;++C){var u=0|F[2*C+1],k=1&u;if(C<I-1&&u>>1===F[2*C+3]>>1&&(k=2,C+=1),u<0){for(var D=-(u>>1)-1,X=0;X<e;++X){if(void 0!==(o=O(c[X],D)))return o}if(0!==k)for(X=0;X<g;++X){if(void 0!==(o=O(a[X],D)))return o}if(1!==k)for(X=0;X<n;++X){var o;if(void 0!==(o=O(i[X],D)))return o}0===k?b(a,R,g++,D):1===k?b(i,M,n++,D):2===k&&b(c,W,e++,D)}else{D=(u>>1)-1;0===k?Q(a,R,g--,D):1===k?Q(i,M,n--,D):2===k&&Q(c,W,e--,D)}}},scanBipartite:function(V,O,Z,d,p,m,i,M,c,W,U,H){var S=0,z=2*V,G=O,w=O+V,t=1,C=1;d?C=Y:t=Y;for(var v=p;v<m;++v){var A=v+t,l=z*v;F[S++]=i[l+G],F[S++]=-A,F[S++]=i[l+w],F[S++]=A}for(v=c;v<W;++v){A=v+C;var I=z*v;F[S++]=U[I+G],F[S++]=-A}var g=S>>>1;r(F,g);var n=0;for(v=0;v<g;++v){var e=0|F[2*v+1];if(e<0){var u=!1;if((A=-e)>=Y?(u=!d,A-=Y):(u=!!d,A-=1),u)b(a,R,n++,A);else{var k=H[A],D=z*A,X=U[D+O+1],o=U[D+O+1+V];V:for(var E=0;E<n;++E){var L=a[E],J=z*L;if(!(o<i[J+O+1]||i[J+O+1+V]<X)){for(var N=O+2;N<V;++N)if(U[D+N+V]<i[J+N]||i[J+N+V]<U[D+N])continue V;var P,f=M[L];if(void 0!==(P=d?Z(k,f):Z(f,k)))return P}}}}else Q(a,R,n--,e-t)}},scanComplete:function(V,O,Z,d,p,m,R,i,M,c,W){for(var Q=0,b=2*V,U=O,H=O+V,S=d;S<p;++S){var z=S+Y,G=b*S;F[Q++]=m[G+U],F[Q++]=-z,F[Q++]=m[G+H],F[Q++]=z}for(S=i;S<M;++S){z=S+1;var w=b*S;F[Q++]=c[w+U],F[Q++]=-z}var t=Q>>>1;r(F,t);var C=0;for(S=0;S<t;++S){var v=0|F[2*S+1];if(v<0){if((z=-v)>=Y)a[C++]=z-Y;else{var A=W[z-=1],l=b*z,I=c[l+O+1],g=c[l+O+1+V];V:for(var n=0;n<C;++n){var e=a[n],u=R[e];if(u===A)break;var k=b*e;if(!(g<m[k+O+1]||m[k+O+1+V]<I)){for(var D=O+2;D<V;++D)if(c[l+D+V]<m[k+D]||m[k+D+V]<c[l+D])continue V;var X=Z(u,A);if(void 0!==X)return X}}}}else{for(z=v-Y,n=C-1;n>=0;--n)if(a[n]===z){for(D=n+1;D<C;++D)a[D-1]=a[D];break}--C}}}};var d=Z(12390),p=Z(12398),r=Z(12427),Y=1<<28,m=1024,a=d.mallocInt32(m),R=d.mallocInt32(m),i=d.mallocInt32(m),M=d.mallocInt32(m),c=d.mallocInt32(m),W=d.mallocInt32(m),F=d.mallocDouble(8192);function Q(V,O,Z,d){var p=O[d],r=V[Z-1];V[p]=r,O[r]=p}function b(V,O,Z,d){V[Z]=d,O[d]=Z}},12531:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12522:(V,O,Z)=>{var d=Z(12531),p=Z(12537),r=Object.hasOwnProperty,Y=Object.create(null);for(var m in d)r.call(d,m)&&(Y[d[m]]=m);var a=V.exports={to:{},get:{}};function R(V,O,Z){return Math.min(Math.max(O,V),Z)}function i(V){var O=Math.round(V).toString(16).toUpperCase();return O.length<2?"0"+O:O}a.get=function(V){var O,Z;switch(V.substring(0,3).toLowerCase()){case"hsl":O=a.get.hsl(V),Z="hsl";break;case"hwb":O=a.get.hwb(V),Z="hwb";break;default:O=a.get.rgb(V),Z="rgb"}return O?{model:Z,value:O}:null},a.get.rgb=function(V){if(!V)return null;var O,Z,p,Y=[0,0,0,1];if(O=V.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(p=O[2],O=O[1],Z=0;Z<3;Z++){var m=2*Z;Y[Z]=parseInt(O.slice(m,m+2),16)}p&&(Y[3]=parseInt(p,16)/255)}else if(O=V.match(/^#([a-f0-9]{3,4})$/i)){for(p=(O=O[1])[3],Z=0;Z<3;Z++)Y[Z]=parseInt(O[Z]+O[Z],16);p&&(Y[3]=parseInt(p+p,16)/255)}else if(O=V.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Z=0;Z<3;Z++)Y[Z]=parseInt(O[Z+1],0);O[4]&&(O[5]?Y[3]=.01*parseFloat(O[4]):Y[3]=parseFloat(O[4]))}else{if(!(O=V.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=V.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:r.call(d,O[1])?((Y=d[O[1]])[3]=1,Y):null:null;for(Z=0;Z<3;Z++)Y[Z]=Math.round(2.55*parseFloat(O[Z+1]));O[4]&&(O[5]?Y[3]=.01*parseFloat(O[4]):Y[3]=parseFloat(O[4]))}for(Z=0;Z<3;Z++)Y[Z]=R(Y[Z],0,255);return Y[3]=R(Y[3],0,1),Y},a.get.hsl=function(V){if(!V)return null;var O=V.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var Z=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,R(parseFloat(O[2]),0,100),R(parseFloat(O[3]),0,100),R(isNaN(Z)?1:Z,0,1)]}return null},a.get.hwb=function(V){if(!V)return null;var O=V.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var Z=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,R(parseFloat(O[2]),0,100),R(parseFloat(O[3]),0,100),R(isNaN(Z)?1:Z,0,1)]}return null},a.to.hex=function(){var V=p(arguments);return"#"+i(V[0])+i(V[1])+i(V[2])+(V[3]<1?i(Math.round(255*V[3])):"")},a.to.rgb=function(){var V=p(arguments);return V.length<4||1===V[3]?"rgb("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+")":"rgba("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+", "+V[3]+")"},a.to.rgb.percent=function(){var V=p(arguments),O=Math.round(V[0]/255*100),Z=Math.round(V[1]/255*100),d=Math.round(V[2]/255*100);return V.length<4||1===V[3]?"rgb("+O+"%, "+Z+"%, "+d+"%)":"rgba("+O+"%, "+Z+"%, "+d+"%, "+V[3]+")"},a.to.hsl=function(){var V=p(arguments);return V.length<4||1===V[3]?"hsl("+V[0]+", "+V[1]+"%, "+V[2]+"%)":"hsla("+V[0]+", "+V[1]+"%, "+V[2]+"%, "+V[3]+")"},a.to.hwb=function(){var V=p(arguments),O="";return V.length>=4&&1!==V[3]&&(O=", "+V[3]),"hwb("+V[0]+", "+V[1]+"%, "+V[2]+"%"+O+")"},a.to.keyword=function(V){return Y[V.slice(0,3)]}},12520:(V,O,Z)=>{const d=Z(12522),p=Z(12551),r=["keyword","gray","hex"],Y={};for(const W of Object.keys(p))Y[[...p[W].labels].sort().join("")]=W;const m={};function a(V,O){if(!(this instanceof a))return new a(V,O);if(O&&O in r&&(O=null),O&&!(O in p))throw new Error("Unknown model: "+O);let Z,R;if(null==V)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(V instanceof a)this.model=V.model,this.color=[...V.color],this.valpha=V.valpha;else if("string"===typeof V){const O=d.get(V);if(null===O)throw new Error("Unable to parse color from string: "+V);this.model=O.model,R=p[this.model].channels,this.color=O.value.slice(0,R),this.valpha="number"===typeof O.value[R]?O.value[R]:1}else if(V.length>0){this.model=O||"rgb",R=p[this.model].channels;const Z=Array.prototype.slice.call(V,0,R);this.color=c(Z,R),this.valpha="number"===typeof V[R]?V[R]:1}else if("number"===typeof V)this.model="rgb",this.color=[V>>16&255,V>>8&255,255&V],this.valpha=1;else{this.valpha=1;const O=Object.keys(V);"alpha"in V&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof V.alpha?V.alpha:0);const d=O.sort().join("");if(!(d in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(V));this.model=Y[d];const{labels:r}=p[this.model],m=[];for(Z=0;Z<r.length;Z++)m.push(V[r[Z]]);this.color=c(m)}if(m[this.model])for(R=p[this.model].channels,Z=0;Z<R;Z++){const V=m[this.model][Z];V&&(this.color[Z]=V(this.color[Z]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}a.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(V){let O=this.model in d.to?this:this.rgb();O=O.round("number"===typeof V?V:1);const Z=1===O.valpha?O.color:[...O.color,this.valpha];return d.to[O.model](Z)},percentString(V){const O=this.rgb().round("number"===typeof V?V:1),Z=1===O.valpha?O.color:[...O.color,this.valpha];return d.to.rgb.percent(Z)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const V={},{channels:O}=p[this.model],{labels:Z}=p[this.model];for(let d=0;d<O;d++)V[Z[d]]=this.color[d];return 1!==this.valpha&&(V.alpha=this.valpha),V},unitArray(){const V=this.rgb().color;return V[0]/=255,V[1]/=255,V[2]/=255,1!==this.valpha&&V.push(this.valpha),V},unitObject(){const V=this.rgb().object();return V.r/=255,V.g/=255,V.b/=255,1!==this.valpha&&(V.alpha=this.valpha),V},round(V){return V=Math.max(V||0,0),new a([...this.color.map(R(V)),this.valpha],this.model)},alpha(V){return void 0!==V?new a([...this.color,Math.max(0,Math.min(1,V))],this.model):this.valpha},red:i("rgb",0,M(255)),green:i("rgb",1,M(255)),blue:i("rgb",2,M(255)),hue:i(["hsl","hsv","hsl","hwb","hcg"],0,(V=>(V%360+360)%360)),saturationl:i("hsl",1,M(100)),lightness:i("hsl",2,M(100)),saturationv:i("hsv",1,M(100)),value:i("hsv",2,M(100)),chroma:i("hcg",1,M(100)),gray:i("hcg",2,M(100)),white:i("hwb",1,M(100)),wblack:i("hwb",2,M(100)),cyan:i("cmyk",0,M(100)),magenta:i("cmyk",1,M(100)),yellow:i("cmyk",2,M(100)),black:i("cmyk",3,M(100)),x:i("xyz",0,M(95.047)),y:i("xyz",1,M(100)),z:i("xyz",2,M(108.833)),l:i("lab",0,M(100)),a:i("lab",1),b:i("lab",2),keyword(V){return void 0!==V?new a(V):p[this.model].keyword(this.color)},hex(V){return void 0!==V?new a(V):d.to.hex(this.rgb().round().color)},hexa(V){if(void 0!==V)return new a(V);const O=this.rgb().round().color;let Z=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Z.length&&(Z="0"+Z),d.to.hex(O)+Z},rgbNumber(){const V=this.rgb().color;return(255&V[0])<<16|(255&V[1])<<8|255&V[2]},luminosity(){const V=this.rgb().color,O=[];for(const[Z,d]of V.entries()){const V=d/255;O[Z]=V<=.04045?V/12.92:((V+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(V){const O=this.luminosity(),Z=V.luminosity();return O>Z?(O+.05)/(Z+.05):(Z+.05)/(O+.05)},level(V){const O=this.contrast(V);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const V=this.rgb().color;return(2126*V[0]+7152*V[1]+722*V[2])/1e4<128},isLight(){return!this.isDark()},negate(){const V=this.rgb();for(let O=0;O<3;O++)V.color[O]=255-V.color[O];return V},lighten(V){const O=this.hsl();return O.color[2]+=O.color[2]*V,O},darken(V){const O=this.hsl();return O.color[2]-=O.color[2]*V,O},saturate(V){const O=this.hsl();return O.color[1]+=O.color[1]*V,O},desaturate(V){const O=this.hsl();return O.color[1]-=O.color[1]*V,O},whiten(V){const O=this.hwb();return O.color[1]+=O.color[1]*V,O},blacken(V){const O=this.hwb();return O.color[2]+=O.color[2]*V,O},grayscale(){const V=this.rgb().color,O=.3*V[0]+.59*V[1]+.11*V[2];return a.rgb(O,O,O)},fade(V){return this.alpha(this.valpha-this.valpha*V)},opaquer(V){return this.alpha(this.valpha+this.valpha*V)},rotate(V){const O=this.hsl();let Z=O.color[0];return Z=(Z+V)%360,Z=Z<0?360+Z:Z,O.color[0]=Z,O},mix(V,O){if(!V||!V.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof V);const Z=V.rgb(),d=this.rgb(),p=void 0===O?.5:O,r=2*p-1,Y=Z.alpha()-d.alpha(),m=((r*Y===-1?r:(r+Y)/(1+r*Y))+1)/2,R=1-m;return a.rgb(m*Z.red()+R*d.red(),m*Z.green()+R*d.green(),m*Z.blue()+R*d.blue(),Z.alpha()*p+d.alpha()*(1-p))}};for(const W of Object.keys(p)){if(r.includes(W))continue;const{channels:V}=p[W];a.prototype[W]=function(){if(this.model===W)return new a(this);for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];return O.length>0?new a(O,W):new a([...(d=p[this.model][W].raw(this.color),Array.isArray(d)?d:[d]),this.valpha],W);var d},a[W]=function(){for(var O=arguments.length,Z=new Array(O),d=0;d<O;d++)Z[d]=arguments[d];let p=Z[0];return"number"===typeof p&&(p=c(Z,V)),new a(p,W)}}function R(V){return function(O){return function(V,O){return Number(V.toFixed(O))}(O,V)}}function i(V,O,Z){V=Array.isArray(V)?V:[V];for(const d of V)(m[d]||(m[d]=[]))[O]=Z;return V=V[0],function(d){let p;return void 0!==d?(Z&&(d=Z(d)),p=this[V](),p.color[O]=d,p):(p=this[V]().color[O],Z&&(p=Z(p)),p)}}function M(V){return function(O){return Math.max(0,Math.min(V,O))}}function c(V,O){for(let Z=0;Z<O;Z++)"number"!==typeof V[Z]&&(V[Z]=0);return V}V.exports=a},12559:(V,O,Z)=>{const d=Z(12565),p={};for(const Y of Object.keys(d))p[d[Y]]=Y;const r={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};V.exports=r;for(const Y of Object.keys(r)){if(!("channels"in r[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in r[Y]))throw new Error("missing channel labels property: "+Y);if(r[Y].labels.length!==r[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:V,labels:O}=r[Y];delete r[Y].channels,delete r[Y].labels,Object.defineProperty(r[Y],"channels",{value:V}),Object.defineProperty(r[Y],"labels",{value:O})}r.rgb.hsl=function(V){const O=V[0]/255,Z=V[1]/255,d=V[2]/255,p=Math.min(O,Z,d),r=Math.max(O,Z,d),Y=r-p;let m,a;r===p?m=0:O===r?m=(Z-d)/Y:Z===r?m=2+(d-O)/Y:d===r&&(m=4+(O-Z)/Y),m=Math.min(60*m,360),m<0&&(m+=360);const R=(p+r)/2;return a=r===p?0:R<=.5?Y/(r+p):Y/(2-r-p),[m,100*a,100*R]},r.rgb.hsv=function(V){let O,Z,d,p,r;const Y=V[0]/255,m=V[1]/255,a=V[2]/255,R=Math.max(Y,m,a),i=R-Math.min(Y,m,a),M=function(V){return(R-V)/6/i+.5};return 0===i?(p=0,r=0):(r=i/R,O=M(Y),Z=M(m),d=M(a),Y===R?p=d-Z:m===R?p=1/3+O-d:a===R&&(p=2/3+Z-O),p<0?p+=1:p>1&&(p-=1)),[360*p,100*r,100*R]},r.rgb.hwb=function(V){const O=V[0],Z=V[1];let d=V[2];const p=r.rgb.hsl(V)[0],Y=1/255*Math.min(O,Math.min(Z,d));return d=1-1/255*Math.max(O,Math.max(Z,d)),[p,100*Y,100*d]},r.rgb.cmyk=function(V){const O=V[0]/255,Z=V[1]/255,d=V[2]/255,p=Math.min(1-O,1-Z,1-d);return[100*((1-O-p)/(1-p)||0),100*((1-Z-p)/(1-p)||0),100*((1-d-p)/(1-p)||0),100*p]},r.rgb.keyword=function(V){const O=p[V];if(O)return O;let Z,r=1/0;for(const p of Object.keys(d)){const O=d[p],a=(m=O,((Y=V)[0]-m[0])**2+(Y[1]-m[1])**2+(Y[2]-m[2])**2);a<r&&(r=a,Z=p)}var Y,m;return Z},r.keyword.rgb=function(V){return d[V]},r.rgb.xyz=function(V){let O=V[0]/255,Z=V[1]/255,d=V[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92;return[100*(.4124*O+.3576*Z+.1805*d),100*(.2126*O+.7152*Z+.0722*d),100*(.0193*O+.1192*Z+.9505*d)]},r.rgb.lab=function(V){const O=r.rgb.xyz(V);let Z=O[0],d=O[1],p=O[2];Z/=95.047,d/=100,p/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,p=p>.008856?p**(1/3):7.787*p+16/116;return[116*d-16,500*(Z-d),200*(d-p)]},r.hsl.rgb=function(V){const O=V[0]/360,Z=V[1]/100,d=V[2]/100;let p,r,Y;if(0===Z)return Y=255*d,[Y,Y,Y];p=d<.5?d*(1+Z):d+Z-d*Z;const m=2*d-p,a=[0,0,0];for(let R=0;R<3;R++)r=O+1/3*-(R-1),r<0&&r++,r>1&&r--,Y=6*r<1?m+6*(p-m)*r:2*r<1?p:3*r<2?m+(p-m)*(2/3-r)*6:m,a[R]=255*Y;return a},r.hsl.hsv=function(V){const O=V[0];let Z=V[1]/100,d=V[2]/100,p=Z;const r=Math.max(d,.01);d*=2,Z*=d<=1?d:2-d,p*=r<=1?r:2-r;return[O,100*(0===d?2*p/(r+p):2*Z/(d+Z)),100*((d+Z)/2)]},r.hsv.rgb=function(V){const O=V[0]/60,Z=V[1]/100;let d=V[2]/100;const p=Math.floor(O)%6,r=O-Math.floor(O),Y=255*d*(1-Z),m=255*d*(1-Z*r),a=255*d*(1-Z*(1-r));switch(d*=255,p){case 0:return[d,a,Y];case 1:return[m,d,Y];case 2:return[Y,d,a];case 3:return[Y,m,d];case 4:return[a,Y,d];case 5:return[d,Y,m]}},r.hsv.hsl=function(V){const O=V[0],Z=V[1]/100,d=V[2]/100,p=Math.max(d,.01);let r,Y;Y=(2-Z)*d;const m=(2-Z)*p;return r=Z*p,r/=m<=1?m:2-m,r=r||0,Y/=2,[O,100*r,100*Y]},r.hwb.rgb=function(V){const O=V[0]/360;let Z=V[1]/100,d=V[2]/100;const p=Z+d;let r;p>1&&(Z/=p,d/=p);const Y=Math.floor(6*O),m=1-d;r=6*O-Y,0!==(1&Y)&&(r=1-r);const a=Z+r*(m-Z);let R,i,M;switch(Y){default:case 6:case 0:R=m,i=a,M=Z;break;case 1:R=a,i=m,M=Z;break;case 2:R=Z,i=m,M=a;break;case 3:R=Z,i=a,M=m;break;case 4:R=a,i=Z,M=m;break;case 5:R=m,i=Z,M=a}return[255*R,255*i,255*M]},r.cmyk.rgb=function(V){const O=V[0]/100,Z=V[1]/100,d=V[2]/100,p=V[3]/100;return[255*(1-Math.min(1,O*(1-p)+p)),255*(1-Math.min(1,Z*(1-p)+p)),255*(1-Math.min(1,d*(1-p)+p))]},r.xyz.rgb=function(V){const O=V[0]/100,Z=V[1]/100,d=V[2]/100;let p,r,Y;return p=3.2406*O+-1.5372*Z+-.4986*d,r=-.9689*O+1.8758*Z+.0415*d,Y=.0557*O+-.204*Z+1.057*d,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,p=Math.min(Math.max(0,p),1),r=Math.min(Math.max(0,r),1),Y=Math.min(Math.max(0,Y),1),[255*p,255*r,255*Y]},r.xyz.lab=function(V){let O=V[0],Z=V[1],d=V[2];O/=95.047,Z/=100,d/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,d=d>.008856?d**(1/3):7.787*d+16/116;return[116*Z-16,500*(O-Z),200*(Z-d)]},r.lab.xyz=function(V){let O,Z,d;Z=(V[0]+16)/116,O=V[1]/500+Z,d=Z-V[2]/200;const p=Z**3,r=O**3,Y=d**3;return Z=p>.008856?p:(Z-16/116)/7.787,O=r>.008856?r:(O-16/116)/7.787,d=Y>.008856?Y:(d-16/116)/7.787,O*=95.047,Z*=100,d*=108.883,[O,Z,d]},r.lab.lch=function(V){const O=V[0],Z=V[1],d=V[2];let p;p=360*Math.atan2(d,Z)/2/Math.PI,p<0&&(p+=360);return[O,Math.sqrt(Z*Z+d*d),p]},r.lch.lab=function(V){const O=V[0],Z=V[1],d=V[2]/360*2*Math.PI;return[O,Z*Math.cos(d),Z*Math.sin(d)]},r.rgb.ansi16=function(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Z,d,p]=V;let Y=null===O?r.rgb.hsv(V)[2]:O;if(Y=Math.round(Y/50),0===Y)return 30;let m=30+(Math.round(p/255)<<2|Math.round(d/255)<<1|Math.round(Z/255));return 2===Y&&(m+=60),m},r.hsv.ansi16=function(V){return r.rgb.ansi16(r.hsv.rgb(V),V[2])},r.rgb.ansi256=function(V){const O=V[0],Z=V[1],d=V[2];if(O===Z&&Z===d)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(Z/255*5)+Math.round(d/255*5)},r.ansi16.rgb=function(V){let O=V%10;if(0===O||7===O)return V>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const Z=.5*(1+~~(V>50));return[(1&O)*Z*255,(O>>1&1)*Z*255,(O>>2&1)*Z*255]},r.ansi256.rgb=function(V){if(V>=232){const O=10*(V-232)+8;return[O,O,O]}let O;V-=16;return[Math.floor(V/36)/5*255,Math.floor((O=V%36)/6)/5*255,O%6/5*255]},r.rgb.hex=function(V){const O=(((255&Math.round(V[0]))<<16)+((255&Math.round(V[1]))<<8)+(255&Math.round(V[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},r.hex.rgb=function(V){const O=V.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let Z=O[0];3===O[0].length&&(Z=Z.split("").map((V=>V+V)).join(""));const d=parseInt(Z,16);return[d>>16&255,d>>8&255,255&d]},r.rgb.hcg=function(V){const O=V[0]/255,Z=V[1]/255,d=V[2]/255,p=Math.max(Math.max(O,Z),d),r=Math.min(Math.min(O,Z),d),Y=p-r;let m,a;return m=Y<1?r/(1-Y):0,a=Y<=0?0:p===O?(Z-d)/Y%6:p===Z?2+(d-O)/Y:4+(O-Z)/Y,a/=6,a%=1,[360*a,100*Y,100*m]},r.hsl.hcg=function(V){const O=V[1]/100,Z=V[2]/100,d=Z<.5?2*O*Z:2*O*(1-Z);let p=0;return d<1&&(p=(Z-.5*d)/(1-d)),[V[0],100*d,100*p]},r.hsv.hcg=function(V){const O=V[1]/100,Z=V[2]/100,d=O*Z;let p=0;return d<1&&(p=(Z-d)/(1-d)),[V[0],100*d,100*p]},r.hcg.rgb=function(V){const O=V[0]/360,Z=V[1]/100,d=V[2]/100;if(0===Z)return[255*d,255*d,255*d];const p=[0,0,0],r=O%1*6,Y=r%1,m=1-Y;let a=0;switch(Math.floor(r)){case 0:p[0]=1,p[1]=Y,p[2]=0;break;case 1:p[0]=m,p[1]=1,p[2]=0;break;case 2:p[0]=0,p[1]=1,p[2]=Y;break;case 3:p[0]=0,p[1]=m,p[2]=1;break;case 4:p[0]=Y,p[1]=0,p[2]=1;break;default:p[0]=1,p[1]=0,p[2]=m}return a=(1-Z)*d,[255*(Z*p[0]+a),255*(Z*p[1]+a),255*(Z*p[2]+a)]},r.hcg.hsv=function(V){const O=V[1]/100,Z=O+V[2]/100*(1-O);let d=0;return Z>0&&(d=O/Z),[V[0],100*d,100*Z]},r.hcg.hsl=function(V){const O=V[1]/100,Z=V[2]/100*(1-O)+.5*O;let d=0;return Z>0&&Z<.5?d=O/(2*Z):Z>=.5&&Z<1&&(d=O/(2*(1-Z))),[V[0],100*d,100*Z]},r.hcg.hwb=function(V){const O=V[1]/100,Z=O+V[2]/100*(1-O);return[V[0],100*(Z-O),100*(1-Z)]},r.hwb.hcg=function(V){const O=V[1]/100,Z=1-V[2]/100,d=Z-O;let p=0;return d<1&&(p=(Z-d)/(1-d)),[V[0],100*d,100*p]},r.apple.rgb=function(V){return[V[0]/65535*255,V[1]/65535*255,V[2]/65535*255]},r.rgb.apple=function(V){return[V[0]/255*65535,V[1]/255*65535,V[2]/255*65535]},r.gray.rgb=function(V){return[V[0]/100*255,V[0]/100*255,V[0]/100*255]},r.gray.hsl=function(V){return[0,0,V[0]]},r.gray.hsv=r.gray.hsl,r.gray.hwb=function(V){return[0,100,V[0]]},r.gray.cmyk=function(V){return[0,0,0,V[0]]},r.gray.lab=function(V){return[V[0],0,0]},r.gray.hex=function(V){const O=255&Math.round(V[0]/100*255),Z=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},r.rgb.gray=function(V){return[(V[0]+V[1]+V[2])/3/255*100]}},12551:(V,O,Z)=>{const d=Z(12559),p=Z(12568),r={};Object.keys(d).forEach((V=>{r[V]={},Object.defineProperty(r[V],"channels",{value:d[V].channels}),Object.defineProperty(r[V],"labels",{value:d[V].labels});const O=p(V);Object.keys(O).forEach((Z=>{const d=O[Z];r[V][Z]=function(V){const O=function(){for(var O=arguments.length,Z=new Array(O),d=0;d<O;d++)Z[d]=arguments[d];const p=Z[0];if(void 0===p||null===p)return p;p.length>1&&(Z=p);const r=V(Z);if("object"===typeof r)for(let V=r.length,Y=0;Y<V;Y++)r[Y]=Math.round(r[Y]);return r};return"conversion"in V&&(O.conversion=V.conversion),O}(d),r[V][Z].raw=function(V){const O=function(){for(var O=arguments.length,Z=new Array(O),d=0;d<O;d++)Z[d]=arguments[d];const p=Z[0];return void 0===p||null===p?p:(p.length>1&&(Z=p),V(Z))};return"conversion"in V&&(O.conversion=V.conversion),O}(d)}))})),V.exports=r},12568:(V,O,Z)=>{const d=Z(12559);function p(V){const O=function(){const V={},O=Object.keys(d);for(let Z=O.length,d=0;d<Z;d++)V[O[d]]={distance:-1,parent:null};return V}(),Z=[V];for(O[V].distance=0;Z.length;){const V=Z.pop(),p=Object.keys(d[V]);for(let d=p.length,r=0;r<d;r++){const d=p[r],Y=O[d];-1===Y.distance&&(Y.distance=O[V].distance+1,Y.parent=V,Z.unshift(d))}}return O}function r(V,O){return function(Z){return O(V(Z))}}function Y(V,O){const Z=[O[V].parent,V];let p=d[O[V].parent][V],Y=O[V].parent;for(;O[Y].parent;)Z.unshift(O[Y].parent),p=r(d[O[Y].parent][Y],p),Y=O[Y].parent;return p.conversion=Z,p}V.exports=function(V){const O=p(V),Z={},d=Object.keys(O);for(let p=d.length,r=0;r<p;r++){const V=d[r];null!==O[V].parent&&(Z[V]=Y(V,O))}return Z}},12565:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10805:function(V,O,Z){"use strict";var d=this&&this.__createBinding||(Object.create?function(V,O,Z,d){void 0===d&&(d=Z);var p=Object.getOwnPropertyDescriptor(O,Z);p&&!("get"in p?!O.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return O[Z]}}),Object.defineProperty(V,d,p)}:function(V,O,Z,d){void 0===d&&(d=Z),V[d]=O[Z]}),p=this&&this.__setModuleDefault||(Object.create?function(V,O){Object.defineProperty(V,"default",{enumerable:!0,value:O})}:function(V,O){V.default=O}),r=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var O={};if(null!=V)for(var Z in V)"default"!==Z&&Object.prototype.hasOwnProperty.call(V,Z)&&d(O,V,Z);return p(O,V),O},Y=this&&this.__awaiter||function(V,O,Z,d){return new(Z||(Z=Promise))((function(p,r){function Y(V){try{a(d.next(V))}catch(O){r(O)}}function m(V){try{a(d.throw(V))}catch(O){r(O)}}function a(V){var O;V.done?p(V.value):(O=V.value,O instanceof Z?O:new Z((function(V){V(O)}))).then(Y,m)}a((d=d.apply(V,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=O.Platform=void 0;const m=r(Z(10729)),a=Z(10811),R="colyseus-auth-token";!function(V){V.ios="ios",V.android="android"}(O.Platform||(O.Platform={}));O.Auth=class{constructor(V){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=V.replace("ws","http"),(0,a.getItem)(R,(V=>this.token=V))}get hasToken(){return!!this.token}login(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Y(this,void 0,void 0,(function*(){const O=Object.assign({},V);this.hasToken&&(O.token=this.token);const Z=yield this.request("post","/auth",O);this.token=Z.token,(0,a.setItem)(R,this.token);for(let V in Z)this.hasOwnProperty(V)&&(this[V]=Z[V]);return this.registerPingService(),this}))}save(){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(V){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:V})}))}acceptFriendRequest(V){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:V})}))}declineFriendRequest(V){return Y(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:V})}))}blockUser(V){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:V})}))}unblockUser(V){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:V})}))}request(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Y(this,void 0,void 0,(function*(){p.Accept="application/json",this.hasToken&&(p.Authorization="Bearer "+this.token);const r=[];for(const V in Z)r.push(`${V}=${Z[V]}`);const Y=r.length>0?`?${r.join("&")}`:"",a={headers:p};return d&&(a.body=d),(yield m[V](`${this.endpoint}${O}${Y}`,a)).data}))}logout(){this.token=void 0,(0,a.removeItem)(R),this.unregisterPingService()}registerPingService(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),V)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10726:function(V,O,Z){"use strict";var d,p=this&&this.__awaiter||function(V,O,Z,d){return new(Z||(Z=Promise))((function(p,r){function Y(V){try{a(d.next(V))}catch(O){r(O)}}function m(V){try{a(d.throw(V))}catch(O){r(O)}}function a(V){var O;V.done?p(V.value):(O=V.value,O instanceof Z?O:new Z((function(V){V(O)}))).then(Y,m)}a((d=d.apply(V,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const r=Z(10729),Y=Z(10737),m=Z(10742);class a extends Error{constructor(V,O){super(V),this.code=O,Object.setPrototypeOf(this,a.prototype)}}O.MatchMakeError=a;const R="undefined"!==typeof window&&"undefined"!==typeof(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R;if("string"===typeof V){const O=new URL(V),Z="https:"===O.protocol||"wss:"===O.protocol,d=Number(O.port||(Z?443:80));this.settings={hostname:O.hostname,pathname:"/"!==O.pathname?O.pathname:"",port:d,secure:Z}}else void 0===V.port&&(V.port=V.secure?443:80),void 0===V.pathname&&(V.pathname=""),this.settings=V}joinOrCreate(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",V,O,Z)}))}create(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",V,O,Z)}))}join(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",V,O,Z)}))}joinById(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",V,O,Z)}))}reconnect(V,O){return p(this,void 0,void 0,(function*(){if("string"===typeof V&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Z,d]=V.split(":");return yield this.createMatchMakeRequest("reconnect",Z,{reconnectionToken:d},O)}))}getAvailableRooms(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p(this,void 0,void 0,(function*(){return(yield(0,r.get)(this.getHttpEndpoint(`${V}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(V,O,Z){return p(this,void 0,void 0,(function*(){const d=this.createRoom(V.room.name,O);d.roomId=V.room.roomId,d.sessionId=V.sessionId;const r={sessionId:d.sessionId};V.reconnectionToken&&(r.reconnectionToken=V.reconnectionToken);const m=Z||d;return d.connect(this.buildEndpoint(V.room,r),V.devMode&&(()=>p(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${d.roomId}'...`);let Z=0;const r=()=>p(this,void 0,void 0,(function*(){Z++;try{yield this.consumeSeatReservation(V,O,m),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${d.roomId}'`)}catch(p){Z<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Z} out of 8)`),setTimeout(r,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(r,2e3)}))),m),new Promise(((V,O)=>{const Z=(V,Z)=>O(new Y.ServerError(V,Z));m.onError.once(Z),m.onJoin.once((()=>{m.onError.remove(Z),V(m)}))}))}))}createMatchMakeRequest(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0;return p(this,void 0,void 0,(function*(){const p=(yield(0,r.post)(this.getHttpEndpoint(`${V}/${O}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Z)})).data;if(p.error)throw new a(p.error,p.code);return"reconnect"===V&&(p.reconnectionToken=Z.reconnectionToken),yield this.consumeSeatReservation(p,d,Y)}))}createRoom(V,O){return new m.Room(V,O)}buildEndpoint(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=[];for(const p in O)O.hasOwnProperty(p)&&Z.push(`${p}=${O[p]}`);let d=this.settings.secure?"wss://":"ws://";return V.publicAddress?d+=`${V.publicAddress}`:d+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${d}/${V.processId}/${V.roomId}?${Z.join("&")}`}getHttpEndpoint(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${V}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10754:(V,O,Z)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const d=Z(10763);O.Connection=class{constructor(){this.events={},this.transport=new d.WebSocketTransport(this.events)}send(V){this.transport.send(V)}connect(V){this.transport.connect(V)}close(V,O){this.transport.close(V,O)}get isOpen(){return this.transport.isOpen}}},10776:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(V){V[V.HANDSHAKE=9]="HANDSHAKE",V[V.JOIN_ROOM=10]="JOIN_ROOM",V[V.ERROR=11]="ERROR",V[V.LEAVE_ROOM=12]="LEAVE_ROOM",V[V.ROOM_DATA=13]="ROOM_DATA",V[V.ROOM_STATE=14]="ROOM_STATE",V[V.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",V[V.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",V[V.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(V){V[V.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",V[V.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",V[V.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",V[V.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",V[V.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",V[V.AUTH_FAILED=4215]="AUTH_FAILED",V[V.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(V,O){const Z=V[O++];for(var d="",p=0,r=O,Y=O+Z;r<Y;r++){var m=V[r];if(0!==(128&m))if(192!==(224&m))if(224!==(240&m)){if(240!==(248&m))throw new Error("Invalid byte "+m.toString(16));(p=(7&m)<<18|(63&V[++r])<<12|(63&V[++r])<<6|63&V[++r])>=65536?(p-=65536,d+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):d+=String.fromCharCode(p)}else d+=String.fromCharCode((15&m)<<12|(63&V[++r])<<6|63&V[++r]);else d+=String.fromCharCode((31&m)<<6|63&V[++r]);else d+=String.fromCharCode(m)}return d},O.utf8Length=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,Z=0;for(let d=0,p=V.length;d<p;d++)O=V.charCodeAt(d),O<128?Z+=1:O<2048?Z+=2:O<55296||O>=57344?Z+=3:(d++,Z+=4);return Z+1}},10742:function(V,O,Z){"use strict";var d=this&&this.__createBinding||(Object.create?function(V,O,Z,d){void 0===d&&(d=Z);var p=Object.getOwnPropertyDescriptor(O,Z);p&&!("get"in p?!O.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return O[Z]}}),Object.defineProperty(V,d,p)}:function(V,O,Z,d){void 0===d&&(d=Z),V[d]=O[Z]}),p=this&&this.__setModuleDefault||(Object.create?function(V,O){Object.defineProperty(V,"default",{enumerable:!0,value:O})}:function(V,O){V.default=O}),r=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var O={};if(null!=V)for(var Z in V)"default"!==Z&&Object.prototype.hasOwnProperty.call(V,Z)&&d(O,V,Z);return p(O,V),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const Y=r(Z(10748)),m=Z(10754),a=Z(10776),R=Z(10785),i=Z(10794),M=Z(10798),c=Z(10803),W=Z(10737);class F{constructor(V,O){this.onStateChange=(0,M.createSignal)(),this.onError=(0,M.createSignal)(),this.onLeave=(0,M.createSignal)(),this.onJoin=(0,M.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=V,O&&(this.serializer=new((0,R.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((V,O)=>{var Z;return null===(Z=console.warn)||void 0===Z?void 0:Z.call(console,`colyseus.js - onError => (${V}) ${O}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const d=new m.Connection;Z.connection=d,d.events.onmessage=F.prototype.onMessageCallback.bind(Z),d.events.onclose=function(V){var d;if(!Z.hasJoined)return null===(d=console.warn)||void 0===d||d.call(console,`Room connection was closed unexpectedly (${V.code}): ${V.reason}`),void Z.onError.invoke(V.code,V.reason);V.code===W.CloseCode.DEVMODE_RESTART&&O?O():(Z.onLeave.invoke(V.code),Z.destroy())},d.events.onerror=function(V){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${V.code}): ${V.reason}`),Z.onError.invoke(V.code,V.reason)},d.connect(V)}leave(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((V=>O(V))),this.connection?V?this.connection.send([a.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(W.CloseCode.CONSENTED)}))}onMessage(V,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(V),O)}send(V,O){const Z=[a.Protocol.ROOM_DATA];let d;if("string"===typeof V?c.encode.string(Z,V):c.encode.number(Z,V),void 0!==O){const V=Y.encode(O);d=new Uint8Array(Z.length+V.byteLength),d.set(new Uint8Array(Z),0),d.set(new Uint8Array(V),Z.length)}else d=new Uint8Array(Z);this.connection.send(d.buffer)}sendBytes(V,O){const Z=[a.Protocol.ROOM_DATA_BYTES];let d;"string"===typeof V?c.encode.string(Z,V):c.encode.number(Z,V),d=new Uint8Array(Z.length+(O.byteLength||O.length)),d.set(new Uint8Array(Z),0),d.set(new Uint8Array(O),Z.length),this.connection.send(d.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(V){const O=Array.from(new Uint8Array(V.data)),Z=O[0];if(Z===a.Protocol.JOIN_ROOM){let V=1;const Z=(0,a.utf8Read)(O,V);if(V+=(0,a.utf8Length)(Z),this.serializerId=(0,a.utf8Read)(O,V),V+=(0,a.utf8Length)(this.serializerId),!this.serializer){const V=(0,R.getSerializer)(this.serializerId);this.serializer=new V}O.length>V&&this.serializer.handshake&&this.serializer.handshake(O,{offset:V}),this.reconnectionToken=`${this.roomId}:${Z}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([a.Protocol.JOIN_ROOM])}else if(Z===a.Protocol.ERROR){const V={offset:1},Z=c.decode.number(O,V),d=c.decode.string(O,V);this.onError.invoke(Z,d)}else if(Z===a.Protocol.LEAVE_ROOM)this.leave();else if(Z===a.Protocol.ROOM_DATA_SCHEMA){const V={offset:1},Z=this.serializer.getState().constructor._context.get(c.decode.number(O,V)),d=new Z;d.decode(O,V),this.dispatchMessage(Z,d)}else if(Z===a.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(Z===a.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(Z===a.Protocol.ROOM_DATA){const Z={offset:1},d=c.decode.stringCheck(O,Z)?c.decode.string(O,Z):c.decode.number(O,Z),p=O.length>Z.offset?Y.decode(V.data,Z.offset):void 0;this.dispatchMessage(d,p)}else if(Z===a.Protocol.ROOM_DATA_BYTES){const V={offset:1},Z=c.decode.stringCheck(O,V)?c.decode.string(O,V):c.decode.number(O,V);this.dispatchMessage(Z,new Uint8Array(O.slice(V.offset)))}}setState(V){this.serializer.setState(V),this.onStateChange.invoke(this.serializer.getState())}patch(V){this.serializer.patch(V),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(V,O){var Z;const d=this.getMessageHandlerKey(V);this.onMessageHandlers.events[d]?this.onMessageHandlers.emit(d,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",V,O):null===(Z=console.warn)||void 0===Z||Z.call(console,`colyseus.js: onMessage() not registered for type '${V}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(V){switch(typeof V){case"function":return`$${V._typeid}`;case"string":return V;case"number":return`i${V}`;default:throw new Error("invalid message type.")}}}O.Room=F},10811:(V,O)=>{"use strict";let Z;function d(){return Z||(Z="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(V,O){this.cache[V]=O},getItem:function(V){this.cache[V]},removeItem:function(V){delete this.cache[V]}}),Z}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(V,O){d().setItem(V,O)},O.removeItem=function(V){d().removeItem(V)},O.getItem=function(V,O){const Z=d().getItem(V);"undefined"!==typeof Promise&&Z instanceof Promise?Z.then((V=>O(V))):O(Z)}},10794:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(V){let O=this.events[V]||[];for(var Z=arguments.length,d=new Array(Z>1?Z-1:0),p=1;p<Z;p++)d[p-1]=arguments[p];for(let r=0,Y=O.length;r<Y;r++)O[r](...d)},events:{},on(V,O){var Z;return(null===(Z=this.events[V])||void 0===Z?void 0:Z.push(O))||(this.events[V]=[O]),()=>{var Z;this.events[V]=null===(Z=this.events[V])||void 0===Z?void 0:Z.filter((V=>O!==V))}}})},10798:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class Z{constructor(){this.handlers=[]}register(V){return this.handlers.push(V),this}invoke(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];this.handlers.forEach((V=>V.apply(this,O)))}invokeAsync(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];return Promise.all(this.handlers.map((V=>V.apply(this,O))))}remove(V){const O=this.handlers.indexOf(V);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=Z,O.createSignal=function(){const V=new Z;function O(O){return V.register(O,null===this)}return O.once=O=>{const Z=function(){for(var d=arguments.length,p=new Array(d),r=0;r<d;r++)p[r]=arguments[r];O.apply(this,p),V.remove(Z)};V.register(Z)},O.remove=O=>V.remove(O),O.invoke=function(){return V.invoke(...arguments)},O.invokeAsync=function(){return V.invokeAsync(...arguments)},O.clear=()=>V.clear(),O}},10737:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(V){V[V.CONSENTED=4e3]="CONSENTED",V[V.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class Z extends Error{constructor(V,O){super(O),this.name="ServerError",this.code=V}}O.ServerError=Z},10712:(V,O,Z)=>{"use strict";O.b=void 0,Z(10717);var d=Z(10726);Object.defineProperty(O,"b",{enumerable:!0,get:function(){return d.Client}});var p=Z(10776);var r=Z(10742);var Y=Z(10805);const m=Z(10818);const a=Z(10822),R=Z(10785);(0,R.registerSerializer)("schema",m.SchemaSerializer),(0,R.registerSerializer)("none",a.NoneSerializer)},10717:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=V=>null!==V&&"object"===typeof V&&V.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10748:(V,O)=>{"use strict";function Z(V,O){if(this._offset=O,V instanceof ArrayBuffer)this._buffer=V,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(V))throw new Error("Invalid argument");this._buffer=V.buffer,this._view=new DataView(this._buffer,V.byteOffset,V.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,Z.prototype._array=function(V){for(var O=new Array(V),Z=0;Z<V;Z++)O[Z]=this._parse();return O},Z.prototype._map=function(V){for(var O={},Z=0;Z<V;Z++)O[this._parse()]=this._parse();return O},Z.prototype._str=function(V){var O=function(V,O,Z){for(var d="",p=0,r=O,Y=O+Z;r<Y;r++){var m=V.getUint8(r);if(0!==(128&m))if(192!==(224&m))if(224!==(240&m)){if(240!==(248&m))throw new Error("Invalid byte "+m.toString(16));(p=(7&m)<<18|(63&V.getUint8(++r))<<12|(63&V.getUint8(++r))<<6|63&V.getUint8(++r))>=65536?(p-=65536,d+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):d+=String.fromCharCode(p)}else d+=String.fromCharCode((15&m)<<12|(63&V.getUint8(++r))<<6|63&V.getUint8(++r));else d+=String.fromCharCode((31&m)<<6|63&V.getUint8(++r));else d+=String.fromCharCode(m)}return d}(this._view,this._offset,V);return this._offset+=V,O},Z.prototype._bin=function(V){var O=this._buffer.slice(this._offset,this._offset+V);return this._offset+=V,O},Z.prototype._parse=function(){var V,O=this._view.getUint8(this._offset++),Z=0,d=0,p=0,r=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Z=this._view.getUint8(this._offset),this._offset+=1,this._bin(Z);case 197:return Z=this._view.getUint16(this._offset),this._offset+=2,this._bin(Z);case 198:return Z=this._view.getUint32(this._offset),this._offset+=4,this._bin(Z);case 199:if(Z=this._view.getUint8(this._offset),d=this._view.getInt8(this._offset+1),this._offset+=2,-1===d){var Y=this._view.getUint32(this._offset);return p=this._view.getInt32(this._offset+4),r=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*p+r)+Y/1e6)}return[d,this._bin(Z)];case 200:return Z=this._view.getUint16(this._offset),d=this._view.getInt8(this._offset+2),this._offset+=3,[d,this._bin(Z)];case 201:return Z=this._view.getUint32(this._offset),d=this._view.getInt8(this._offset+4),this._offset+=5,[d,this._bin(Z)];case 202:return V=this._view.getFloat32(this._offset),this._offset+=4,V;case 203:return V=this._view.getFloat64(this._offset),this._offset+=8,V;case 204:return V=this._view.getUint8(this._offset),this._offset+=1,V;case 205:return V=this._view.getUint16(this._offset),this._offset+=2,V;case 206:return V=this._view.getUint32(this._offset),this._offset+=4,V;case 207:return p=this._view.getUint32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,p+r;case 208:return V=this._view.getInt8(this._offset),this._offset+=1,V;case 209:return V=this._view.getInt16(this._offset),this._offset+=2,V;case 210:return V=this._view.getInt32(this._offset),this._offset+=4,V;case 211:return p=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,p+r;case 212:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?void(this._offset+=1):[d,this._bin(1)];case 213:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(2)];case 214:return d=this._view.getInt8(this._offset),this._offset+=1,-1===d?(V=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*V)):[d,this._bin(4)];case 215:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?(p=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(p+r)):-1===d?(p=this._view.getUint32(this._offset),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&p)+r)+(p>>>2)/1e6)):[d,this._bin(8)];case 216:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(16)];case 217:return Z=this._view.getUint8(this._offset),this._offset+=1,this._str(Z);case 218:return Z=this._view.getUint16(this._offset),this._offset+=2,this._str(Z);case 219:return Z=this._view.getUint32(this._offset),this._offset+=4,this._str(Z);case 220:return Z=this._view.getUint16(this._offset),this._offset+=2,this._array(Z);case 221:return Z=this._view.getUint32(this._offset),this._offset+=4,this._array(Z);case 222:return Z=this._view.getUint16(this._offset),this._offset+=2,this._map(Z);case 223:return Z=this._view.getUint32(this._offset),this._offset+=4,this._map(Z)}throw new Error("Could not parse")},O.decode=function(V){var O=new Z(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),d=O._parse();if(O._offset!==V.byteLength)throw new Error(V.byteLength-O._offset+" trailing bytes");return d};function d(V,O,Z){for(var d=0,p=0,r=Z.length;p<r;p++)(d=Z.charCodeAt(p))<128?V.setUint8(O++,d):d<2048?(V.setUint8(O++,192|d>>6),V.setUint8(O++,128|63&d)):d<55296||d>=57344?(V.setUint8(O++,224|d>>12),V.setUint8(O++,128|d>>6&63),V.setUint8(O++,128|63&d)):(p++,d=65536+((1023&d)<<10|1023&Z.charCodeAt(p)),V.setUint8(O++,240|d>>18),V.setUint8(O++,128|d>>12&63),V.setUint8(O++,128|d>>6&63),V.setUint8(O++,128|63&d))}function p(V,O,Z){var d=typeof Z,r=0,Y=0,m=0,a=0,R=0,i=0;if("string"===d){if(R=function(V){for(var O=0,Z=0,d=0,p=V.length;d<p;d++)(O=V.charCodeAt(d))<128?Z+=1:O<2048?Z+=2:O<55296||O>=57344?Z+=3:(d++,Z+=4);return Z}(Z),R<32)V.push(160|R),i=1;else if(R<256)V.push(217,R),i=2;else if(R<65536)V.push(218,R>>8,R),i=3;else{if(!(R<4294967296))throw new Error("String too long");V.push(219,R>>24,R>>16,R>>8,R),i=5}return O.push({_str:Z,_length:R,_offset:V.length}),i+R}if("number"===d)return Math.floor(Z)===Z&&isFinite(Z)?Z>=0?Z<128?(V.push(Z),1):Z<256?(V.push(204,Z),2):Z<65536?(V.push(205,Z>>8,Z),3):Z<4294967296?(V.push(206,Z>>24,Z>>16,Z>>8,Z),5):(m=Z/Math.pow(2,32)|0,a=Z>>>0,V.push(207,m>>24,m>>16,m>>8,m,a>>24,a>>16,a>>8,a),9):Z>=-32?(V.push(Z),1):Z>=-128?(V.push(208,Z),2):Z>=-32768?(V.push(209,Z>>8,Z),3):Z>=-2147483648?(V.push(210,Z>>24,Z>>16,Z>>8,Z),5):(m=Math.floor(Z/Math.pow(2,32)),a=Z>>>0,V.push(211,m>>24,m>>16,m>>8,m,a>>24,a>>16,a>>8,a),9):(V.push(203),O.push({_float:Z,_length:8,_offset:V.length}),9);if("object"===d){if(null===Z)return V.push(192),1;if(Array.isArray(Z)){if((R=Z.length)<16)V.push(144|R),i=1;else if(R<65536)V.push(220,R>>8,R),i=3;else{if(!(R<4294967296))throw new Error("Array too large");V.push(221,R>>24,R>>16,R>>8,R),i=5}for(r=0;r<R;r++)i+=p(V,O,Z[r]);return i}if(Z instanceof Date){var M=Z.getTime(),c=Math.floor(M/1e3),W=1e6*(M-1e3*c);return c>=0&&W>=0&&c<=17179869183?0===W&&c<=4294967295?(V.push(214,255,c>>24,c>>16,c>>8,c),6):(m=c/4294967296,a=4294967295&c,V.push(215,255,W>>22,W>>14,W>>6,m,a>>24,a>>16,a>>8,a),10):(m=Math.floor(c/4294967296),a=c>>>0,V.push(199,12,255,W>>24,W>>16,W>>8,W,m>>24,m>>16,m>>8,m,a>>24,a>>16,a>>8,a),15)}if(Z instanceof ArrayBuffer){if((R=Z.byteLength)<256)V.push(196,R),i=2;else if(R<65536)V.push(197,R>>8,R),i=3;else{if(!(R<4294967296))throw new Error("Buffer too large");V.push(198,R>>24,R>>16,R>>8,R),i=5}return O.push({_bin:Z,_length:R,_offset:V.length}),i+R}if("function"===typeof Z.toJSON)return p(V,O,Z.toJSON());var F=[],Q="",b=Object.keys(Z);for(r=0,Y=b.length;r<Y;r++)void 0!==Z[Q=b[r]]&&"function"!==typeof Z[Q]&&F.push(Q);if((R=F.length)<16)V.push(128|R),i=1;else if(R<65536)V.push(222,R>>8,R),i=3;else{if(!(R<4294967296))throw new Error("Object too large");V.push(223,R>>24,R>>16,R>>8,R),i=5}for(r=0;r<R;r++)i+=p(V,O,Q=F[r]),i+=p(V,O,Z[Q]);return i}if("boolean"===d)return V.push(Z?195:194),1;if("undefined"===d)return V.push(192),1;if("function"===typeof Z.toJSON)return p(V,O,Z.toJSON());throw new Error("Could not encode")}O.encode=function(V){var O=[],Z=[],r=p(O,Z,V),Y=new ArrayBuffer(r),m=new DataView(Y),a=0,R=0,i=-1;Z.length>0&&(i=Z[0]._offset);for(var M,c=0,W=0,F=0,Q=O.length;F<Q;F++)if(m.setUint8(R+F,O[F]),F+1===i){if(c=(M=Z[a])._length,W=R+i,M._bin)for(var b=new Uint8Array(M._bin),U=0;U<c;U++)m.setUint8(W+U,b[U]);else M._str?d(m,W,M._str):void 0!==M._float&&m.setFloat64(W,M._float);R+=c,Z[++a]&&(i=Z[a]._offset)}return Y}},10822:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(V){}getState(){return null}patch(V){}teardown(){}handshake(V){}}},10818:(V,O,Z)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const d=Z(10803);O.SchemaSerializer=class{setState(V){return this.state.decode(V)}getState(){return this.state}patch(V){return this.state.decode(V)}teardown(){var V,O;null===(O=null===(V=this.state)||void 0===V?void 0:V.$changes)||void 0===O||O.root.clearRefs()}handshake(V,O){if(this.state){(new d.Reflection).decode(V,O)}else this.state=d.Reflection.decode(V,O)}}},10785:(V,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const Z={};O.registerSerializer=function(V,O){Z[V]=O},O.getSerializer=function(V){const O=Z[V];if(!O)throw new Error("missing serializer: "+V);return O}},10763:function(V,O,Z){"use strict";var d=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const p=d(Z(10768)),r=globalThis.WebSocket||p.default;O.WebSocketTransport=class{constructor(V){this.events=V}send(V){V instanceof ArrayBuffer?this.ws.send(V):Array.isArray(V)&&this.ws.send(new Uint8Array(V).buffer)}connect(V){this.ws=new r(V,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(V,O){this.ws.close(V,O)}get isOpen(){return this.ws.readyState===r.OPEN}}},10768:V=>{"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12404:V=>{"use strict";function O(V,Z,d){var p=0|V[d];if(p<=0)return[];var r,Y=new Array(p);if(d===V.length-1)for(r=0;r<p;++r)Y[r]=Z;else for(r=0;r<p;++r)Y[r]=O(V,Z,d+1);return Y}V.exports=function(V,Z){switch("undefined"===typeof Z&&(Z=0),typeof V){case"number":if(V>0)return function(V,O){var Z,d;for(Z=new Array(V),d=0;d<V;++d)Z[d]=O;return Z}(0|V,Z);break;case"object":if("number"===typeof V.length)return O(V,Z,0)}return[]}},12368:(V,O,Z)=>{V.exports=function(){var V=this;this.components={},this.comps=this.components;var O=this.components,Z=1,p={},r=[],Y=[],m={timeout:!1,removals:[],multiComps:[]};function a(V,Z){var d=O[Z],r=p[Z],Y=r.hash[V];Y&&(r.remove(V),d.cb&&(d.multi?(Y.forEach((O=>{O&&d.cb(V,O)})),Y.length=0):d.cb(V,Y)),m.removals.push(r),R())}function R(){m.timeout||(m.timeout=!0,setTimeout(i,1))}function i(){m.timeout=!1,M()}function M(){m.multiComps.length&&function(V){for(var O=0;O<V.length;O++){var{entID:Z,data:d}=V[O],p=d.hash[Z];if(p){for(var r=0;r<p.length;r++)p[r]||(p.splice(r,1),r--);0===p.length&&(d.remove(Z),m.removals.push(d))}}V.length=0}(m.multiComps),m.removals.length&&function(V){for(var O=0;O<V.length;O++){V[O].flush()}V.length=0}(m.removals)}this.ni=p,this._systems=r,this._renderSystems=Y,this.Hg=function(O){var d=Z++;return Array.isArray(O)&&O.forEach((O=>V.ke(d,O))),d},this.deleteEntity=function(O){return Object.keys(p).forEach((V=>{p[V].hash[O]&&a(O,V)})),V},this.fh=function(V){if(!V)throw new Error("Missing component definition");var Z=V.name;if(!Z)throw new Error("Component definition must have a name property.");if("string"!==typeof Z)throw new Error("Component name must be a string.");if(""===Z)throw new Error("Component name must be a non-empty string.");if(p[Z])throw new Error(`Component ${Z} already exists.`);var m={};return m.name=Z,m.multi=!!V.multi,m.order=isNaN(V.order)?99:V.order,m.stateConstructor=V.stateConstructor||null,m.state=V.state||{},m.ve=V.ve||null,m.cb=V.cb||null,m.system=V.system||null,m.dg=V.dg||null,O[Z]=m,p[Z]=new d,p[Z]._pendingMultiCleanup=!1,p[Z]._multiCleanupIDs=m.multi?[]:null,m.system&&(r.push(Z),r.sort(((V,Z)=>O[V].order-O[Z].order))),m.dg&&(Y.push(Z),Y.sort(((V,Z)=>O[V].order-O[Z].order))),Z},this.overwriteComponent=function(V,Z){var d=O[V];if(!d)throw new Error(`Unknown component: ${V}`);if(!Z)throw new Error("Missing component definition");if(d.name!==Z.name)throw new Error("Overwriting component must use the same name property.");var m={};m.name=V,m.multi=!!Z.multi,m.order=isNaN(Z.order)?99:Z.order,m.state=Z.state||{},m.ve=Z.ve||null,m.cb=Z.cb||null,m.system=Z.system||null,m.dg=Z.dg||null,O[V]=m,p[V]._pendingMultiCleanup=!1,p[V]._multiCleanupIDs=m.multi?[]:null;var a=r.indexOf(V);m.system&&a<0&&r.push(V),!m.system&&a>=0&&r.splice(a,1),r.sort(((V,Z)=>O[V].order-O[Z].order));var R=Y.indexOf(V);m.dg&&R<0&&Y.push(V),!m.dg&&R>=0&&Y.splice(R,1),Y.sort(((V,Z)=>O[V].order-O[Z].order));var i=m.state;return this.gg(V).forEach((V=>{for(var O in i)O in V||(V[O]=i[O]);m.ve&&m.ve(V.cg,V)})),V},this.deleteComponent=function(Z){var d=p[Z];if(!d)throw new Error(`Unknown component: ${Z}`);d.flush(),d.list.forEach((V=>{V&&a(V.cg||V[0].cg,Z)}));var m=r.indexOf(Z),R=Y.indexOf(Z);return m>-1&&r.splice(m,1),R>-1&&Y.splice(R,1),p[Z].dispose(),delete p[Z],delete O[Z],V},this.ke=function(V,Z,d){var r,Y=O[Z],m=p[Z];if(!m)throw new Error(`Unknown component: ${Z}.`);if(m.hash[V]&&!Y.multi)throw new Error(`Entity ${V} already has component: ${Z}.`);if(Y.stateConstructor){if(!(r=new Y.stateConstructor).hasOwnProperty("cg"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else r=Object.assign({},{cg:V},Y.state,d);if(r.cg=V,Y.multi){var a=m.hash[V];a||(a=[],m.add(V,a)),a.push(r)}else m.add(V,r);return Y.ve&&Y.ve(V,r),this},this.Be=function(V,O){var Z=p[O];if(!Z)throw new Error(`Unknown component: ${O}.`);return!!Z.hash[V]},this.re=function(O,Z){if(!p[Z])throw new Error(`Unknown component: ${Z}.`);return a(O,Z),V},this.getState=function(V,O){var Z=p[O];if(!Z)throw new Error(`Unknown component: ${O}.`);return Z.hash[V]},this.gg=function(V){var O=p[V];if(!O)throw new Error(`Unknown component: ${V}.`);return M(),O.list},this.mk=function(V){if(!p[V])throw new Error(`Unknown component: ${V}.`);var O=p[V].hash;return V=>O[V]},this.qk=function(V){if(!p[V])throw new Error(`Unknown component: ${V}.`);var O=p[V].hash;return V=>!!O[V]},this.vd=function(Z){M();for(var d=0;d<r.length;d++){var Y=r[d],m=O[Y],a=p[Y];m.system(Z,a.list),M()}return V},this.render=function(Z){M();for(var d=0;d<Y.length;d++){var r=Y[d],m=O[r],a=p[r];m.dg(Z,a.list),M()}return V},this.removeMultiComponent=function(Z,d,r){var Y=O[d],a=p[d];if(!a)throw new Error(`Unknown component: ${d}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(V,O,Z,d){var p=Z.hash[V];if(p){var r=p[d];r&&(p[d]=null,O.cb&&O.cb(V,r),m.multiComps.push({entID:V,data:Z}),R())}}(Z,Y,a,r),V}};var d=Z(12371)},12371:V=>{function O(V,O){var Z=V._map[O];if(delete V.hash[O],delete V._map[O],Z===V.list.length-1)V.list.pop();else{var d=V.list.pop();if(V.list[Z]=d,null===d||null===d[0]){var p=V.list.length;for(var r in V._map)if(V._map[r]===p)return void(V._map[r]=Z)}else{var Y=d.cg||d[0].cg;V._map[Y]=Z}}}V.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(V,O){if("number"===typeof this._map[V]){var Z=this._map[V];this.hash[V]=O,this.list[Z]=O}else this._map[V]=this.list.length,this.hash[V]=O,this.list.push(O)}remove(V){var O=this._map[V];this.hash[V]=null,this.list[O]=null,this._pendingRemovals.push(V)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var V=0;V<this._pendingRemovals.length;V++){var Z=this._pendingRemovals[V];null===this.hash[Z]&&O(this,Z)}this._pendingRemovals.length=0}}},12627:V=>{"use strict";V.exports=function(V,O,Z,d,p,r){var Y=+O[0],m=+O[1],a=+O[2],R=+Z[0],i=+Z[1],M=+Z[2],c=Math.sqrt(R*R+i*i+M*M);if(0===c)throw new Error("Can't raycast along a zero vector");return function(V,O,Z,d,p,r,Y,m,a,R){for(var i=0,M=Math.floor,c=0|M(O),W=0|M(Z),F=0|M(d),Q=p>0?1:-1,b=r>0?1:-1,U=Y>0?1:-1,H=Math.abs(1/p),S=Math.abs(1/r),z=Math.abs(1/Y),G=H<1/0?H*(Q>0?c+1-O:O-c):1/0,w=S<1/0?S*(b>0?W+1-Z:Z-W):1/0,t=z<1/0?z*(U>0?F+1-d:d-F):1/0,C=-1;i<=m;){var v=V(c,W,F);if(v)return a&&(a[0]=O+i*p,a[1]=Z+i*r,a[2]=d+i*Y),R&&(R[0]=R[1]=R[2]=0,0===C&&(R[0]=-Q),1===C&&(R[1]=-b),2===C&&(R[2]=-U)),v;G<w?G<t?(c+=Q,i=G,G+=H,C=0):(F+=U,i=t,t+=z,C=2):w<t?(W+=b,i=w,w+=S,C=1):(F+=U,i=t,t+=z,C=2)}return a&&(a[0]=O+i*p,a[1]=Z+i*r,a[2]=d+i*Y),R&&(R[0]=R[1]=R[2]=0),0}(V,Y,m,a,R/=c,i/=c,M/=c,d="undefined"===typeof d?64:+d,p,r)}},12647:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>r});var d=Z(747);function p(){this.gj=!1,this.stopPropagation=!1,this.hj=!1,this.disabled=!1}class r{constructor(V,O){this.version="0.7.0";var Z=Object.assign({},new p,O||{});this.element=V||document,this.gj=!!Z.gj,this.stopPropagation=!!Z.stopPropagation,this.hj=!!Z.hj,this.disabled=!!Z.disabled,this.filterEvents=(V,O)=>!0,this.down=new d.EventEmitter,this.up=new d.EventEmitter,this.state={},this.Vf={dx:0,dy:0,dk:0,Tf:0,ek:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?m(this):document.addEventListener("DOMContentLoaded",(V=>{m(this)}),{once:!0})}bind(V){for(var O=arguments.length,Z=new Array(O>1?O-1:0),d=1;d<O;d++)Z[d-1]=arguments[d];Z.forEach((O=>{var Z=this._keyBindmap[O]||[];Z.includes(V)||(Z.push(V),this._keyBindmap[O]=Z)})),this.state[V]=!!this.state[V],this.pressCount[V]=this.pressCount[V]||0,this.releaseCount[V]=this.releaseCount[V]||0}unbind(V){for(var O in this._keyBindmap){var Z=this._keyBindmap[O],d=Z.indexOf(V);d>-1&&Z.splice(d,1)}}getBindings(){var V={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((Z=>{V[Z]=V[Z]||[],V[Z].push(O)}))}return V}vd(){Y(this.Vf),Y(this.pressCount),Y(this.releaseCount)}}function Y(V){for(var O in V)V[O]=0}function m(V){window.addEventListener("keydown",F.bind(null,V,!0),!1),window.addEventListener("keyup",F.bind(null,V,!1),!1);var O={passive:!0};V.element.addEventListener("touchstart",M.bind(void 0,V),{passive:!1}),V.element.addEventListener("touchend",W.bind(void 0,V),O),V.element.addEventListener("mousedown",Q.bind(null,V,!0),O),window.document.addEventListener("mouseup",Q.bind(null,V,!1),O),V.element.addEventListener("touchmove",b.bind(null,V),O),V.element.addEventListener("mousemove",b.bind(null,V),O),window.PointerEvent,V.element.addEventListener("wheel",U.bind(null,V),O),V.element.addEventListener("contextmenu",H.bind(null,V),!1),window.addEventListener("blur",S.bind(null,V),!1)}var a=0,R=0,i=null;function M(V,O){O.preventDefault(),c(O)}function c(V){let O=!1;for(let Z=0;Z<V.touches.length;++Z)if(V.touches[Z].identifier===i){O=!0;break}if(!O){const O=V.changedTouches[0];a=O.clientX,R=O.clientY,i=O.identifier}}function W(V,O){for(var Z=O.changedTouches,d=0;d<Z.length;++d)Z[d].identifier===i&&(i=null)}function F(V,O,Z){z(Z.code,O,V,Z)}function Q(V,O,Z){if("pointerId"in Z)if(O){if(null!==V._touches.currID)return;V._touches.currID=Z.pointerId}else{if(V._touches.currID!==Z.pointerId)return;V._touches.currID=null}return z("Mouse"+("button"in Z?Z.button+1:1),O,V,Z),!1}function b(V,O){var Z=O.movementX||O.mozMovementX||0,d=O.movementY||O.mozMovementY||0;if(O.touches&&0===(Z|d)){var p=function(V){c(V);for(let O=0;O<V.changedTouches.length;++O)if(V.changedTouches[O].identifier==i){const Z=V.changedTouches[O],d=[Z.clientX-a,Z.clientY-R];return a=Z.clientX,R=Z.clientY,d}return console.error(`Did not find touch id ${i}`),[0,0]}(O);Z=p[0],d=p[1]}V.Vf.dx+=Z,V.Vf.dy+=d}function U(V,O){var Z=1;switch(O.deltaMode){case 0:Z=1;break;case 1:Z=12;break;case 2:Z=V.element.clientHeight||window.innerHeight}V.Vf.dk+=(O.deltaX||0)*Z,V.Vf.Tf+=(O.deltaY||0)*Z,V.Vf.ek+=(O.deltaZ||0)*Z}function H(V,O){if(!V.hj)return O.preventDefault(),!1}function S(V){for(var O in V._keyStates)V._keyStates[O]&&(/^Mouse\d/.test(O)||z(O,!1,V,{code:O,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function z(V,O,Z,d){var p=Z._keyBindmap[V];p&&(G(Z._keyStates[V],O)&&(Z._keyStates[V]=O,p.forEach((V=>{(!Z.filterEvents||Z.filterEvents(d,V))&&function(V,O,Z,d){var p=O?Z.pressCount:Z.releaseCount;p[V]=(p[V]||0)+1;var r=Z._bindPressCount[V]||0;(r+=O?1:-1)<0&&(r=0);Z._bindPressCount[V]=r;var Y=Z.state[V];if(G(Y,r)){Z.state[V]=r>0;var m=O?Z.down:Z.up;Z.disabled||m.emit(V,d)}}(V,O,Z,d)}))),"button"in d||(Z.gj&&!d.defaultPrevented&&d.preventDefault(),Z.stopPropagation&&d.stopPropagation()))}function G(V,O){return V?!O:O}},10879:V=>{"use strict";V.exports=function(V){for(var O=new Array(V),Z=0;Z<V;++Z)O[Z]=Z;return O}},10888:V=>{function O(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(O(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&O(V.slice(0,0))}(V)||!!V._isBuffer)}},12630:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d});class d{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Mh=!1,this.Nh=!1,this.Kh=30,this.Lh=0,this.Vh=!1,this.fullscreen=!1,this.Ph=function(V){},this.Qh=function(){},this.Th=function(){},this.eb=function(){},this.Rh=function(V){},this.onFullscreenChanged=function(V){},R((()=>{!function(V,O){V._nowObject=performance||Date,V._lastTick=0,V._renderAccum=0,V._rt=0,V._frameCB=m.bind(null,V),requestAnimationFrame(V._frameCB),O>0&&(V._intervalCB=Y.bind(null,V),V._interval=setInterval(V._intervalCB,Math.max(O,1e3/V.Kh/2)))}(this,O),function(V,O){if(!O)return;var Z=!1,d=!1;document.addEventListener("pointerlockchange",(d=>{Z=document.pointerLockElement===O,V.Rh(Z)})),document.addEventListener("fullscreenchange",(Z=>{d=document.fullscreenElement===O,V.onFullscreenChanged(d)})),Object.defineProperty(V,"Vh",{get:()=>Z,set:V=>{V&&!Z?a(O):Z&&!V&&function(V){V.exitPointerLock&&V.exitPointerLock()}(document)}}),Object.defineProperty(V,"fullscreen",{get:()=>d,set:V=>{V&&!d?O.requestFullscreen():d&&!V&&document.exitFullscreen()}}),O.addEventListener("click",(p=>{V.Mh&&!Z&&a(O),V.Nh&&!d&&O.requestFullscreen()}));var p=()=>V.eb();if(window.ResizeObserver){new ResizeObserver(p).observe(O)}else window.addEventListener("resize",p)}(this,V),this.Th()}))}}var p=3,r=20;function Y(V){for(var O=1e3/V.Kh,Z=V._nowObject.now()+r,d=0;V._nowObject.now()>=V._lastTick+O&&V._nowObject.now()<Z&&++d<=p;)V.Ph(O),V._lastTick+=O;var Y=5*(O+5),m=V._nowObject.now();if(m-V._lastTick>Y)for(;m>=V._lastTick+O;)V._lastTick+=O}function m(V){requestAnimationFrame(V._frameCB),Y(V);var O=V._nowObject.now(),Z=O-V._rt;if(V._rt=O,V.Lh>0){V._renderAccum+=Z;var d=1e3/V.Lh;if(V._renderAccum<d)return;V._renderAccum=Math.min(V._renderAccum-d,d)}var p=1e3/V.Kh,r=(O-V._lastTick)/p;V.Qh(Z,r,p)}function a(V){V.requestPointerLock&&V.requestPointerLock()}var R=V=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),V()};document.addEventListener("readystatechange",O)}else setTimeout(V,1)}},10871:(V,O,Z)=>{var d=Z(10879),p=Z(10888),r="undefined"!==typeof Float64Array;function Y(V,O){return V[0]-O[0]}function m(){var V,O=this.stride,Z=new Array(O.length);for(V=0;V<Z.length;++V)Z[V]=[Math.abs(O[V]),V];Z.sort(Y);var d=new Array(Z.length);for(V=0;V<d.length;++V)d[V]=Z[V][1];return d}function a(V,O){var Z=["View",O,"d",V].join("");O<0&&(Z="View_Nil"+V);var p="generic"===V;if(-1===O){var r="function "+Z+"(a){this.data=a;};var proto="+Z+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Z+"(a){return new "+Z+"(a);}";return new Function(r)()}if(0===O){r="function "+Z+"(a,d) {this.data = a;this.offset = d};var proto="+Z+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Z+"_copy() {return new "+Z+"(this.data,this.offset)};proto.pick=function "+Z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Z+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Z+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Z+"(a,b,c,d){return new "+Z+"(a,d)}";return new Function("TrivialArray",r)(R[V][0])}r=["'use strict'"];var Y=d(O),a=Y.map((function(V){return"i"+V})),i="this.offset+"+Y.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),M=Y.map((function(V){return"b"+V})).join(","),c=Y.map((function(V){return"c"+V})).join(",");r.push("function "+Z+"(a,"+M+","+c+",d){this.data=a","this.shape=["+M+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+Z+".prototype","proto.dtype='"+V+"'","proto.dimension="+O),r.push("Object.defineProperty(proto,'size',{get:function "+Z+"_size(){return "+Y.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===O?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),O<4?(r.push("function "+Z+"_order(){"),2===O?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+Z+"_set("+a.join(",")+",v){"),p?r.push("return this.data.set("+i+",v)}"):r.push("return this.data["+i+"]=v}"),r.push("proto.get=function "+Z+"_get("+a.join(",")+"){"),p?r.push("return this.data.get("+i+")}"):r.push("return this.data["+i+"]}"),r.push("proto.index=function "+Z+"_index(",a.join(),"){return "+i+"}"),r.push("proto.hi=function "+Z+"_hi("+a.join(",")+"){return new "+Z+"(this.data,"+Y.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+Y.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var W=Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})),F=Y.map((function(V){return"c"+V+"=this.stride["+V+"]"}));r.push("proto.lo=function "+Z+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+W.join(",")+","+F.join(","));for(var Q=0;Q<O;++Q)r.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");r.push("return new "+Z+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"c"+V})).join(",")+",b)}"),r.push("proto.step=function "+Z+"_step("+a.join(",")+"){var "+Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+Y.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<O;++Q)r.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");r.push("return new "+Z+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"b"+V})).join(",")+",c)}");var b=new Array(O),U=new Array(O);for(Q=0;Q<O;++Q)b[Q]="a[i"+Q+"]",U[Q]="b[i"+Q+"]";r.push("proto.transpose=function "+Z+"_transpose("+a+"){"+a.map((function(V,O){return V+"=("+V+"===undefined?"+O+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Z+"(this.data,"+b.join(",")+","+U.join(",")+",this.offset)}"),r.push("proto.pick=function "+Z+"_pick("+a+"){var a=[],b=[],c=this.offset");for(Q=0;Q<O;++Q)r.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+Z+"(data,shape,stride,offset){return new "+Z+"(data,"+Y.map((function(V){return"shape["+V+"]"})).join(",")+","+Y.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(R[V],m)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,O,Z,d){if(void 0===V)return(0,R.array[0])([]);"number"===typeof V&&(V=[V]),void 0===O&&(O=[V.length]);var Y=O.length;if(void 0===Z){Z=new Array(Y);for(var m=Y-1,i=1;m>=0;--m)Z[m]=i,i*=O[m]}if(void 0===d){d=0;for(m=0;m<Y;++m)Z[m]<0&&(d-=(O[m]-1)*Z[m])}for(var M=function(V){if(p(V))return"buffer";if(r)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),c=R[M];c.length<=Y+1;)c.push(a(M,c.length-1));return(0,c[Y+1])(V,O,Z,d)}},10842:V=>{var O;self,O=()=>(()=>{"use strict";var V={d:(O,Z)=>{for(var d in Z)V.o(Z,d)&&!V.o(O,d)&&Object.defineProperty(O,d,{enumerable:!0,get:Z[d]})},o:(V,O)=>Object.prototype.hasOwnProperty.call(V,O)},O={};V.d(O,{default:()=>u});var Z,d=function(V,O){var Z=O.x-V.x,d=O.y-V.y;return Math.sqrt(Z*Z+d*d)},p=function(V){return V*(Math.PI/180)},r=new Map,Y=function(V){r.has(V)&&clearTimeout(r.get(V)),r.set(V,setTimeout(V,100))},m=function(V,O,Z){for(var d,p=O.split(/[ ,]+/g),r=0;r<p.length;r+=1)d=p[r],V.addEventListener?V.addEventListener(d,Z,!1):V.attachEvent&&V.attachEvent(d,Z)},a=function(V,O,Z){for(var d,p=O.split(/[ ,]+/g),r=0;r<p.length;r+=1)d=p[r],V.removeEventListener?V.removeEventListener(d,Z):V.detachEvent&&V.detachEvent(d,Z)},R=function(V){return V.preventDefault(),V.type.match(/^touch/)?V.changedTouches:V},i=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},M=function(V,O){O.top||O.right||O.bottom||O.left?(V.style.top=O.top,V.style.right=O.right,V.style.bottom=O.bottom,V.style.left=O.left):(V.style.left=O.x+"px",V.style.top=O.y+"px")},c=function(V,O,Z){var d=W(V);for(var p in d)if(d.hasOwnProperty(p))if("string"==typeof O)d[p]=O+" "+Z;else{for(var r="",Y=0,m=O.length;Y<m;Y+=1)r+=O[Y]+" "+Z+", ";d[p]=r.slice(0,-2)}return d},W=function(V){var O={};return O[V]="",["webkit","Moz","o"].forEach((function(Z){O[Z+V.charAt(0).toUpperCase()+V.slice(1)]=""})),O},F=function(V,O){for(var Z in O)O.hasOwnProperty(Z)&&(V[Z]=O[Z]);return V},Q=function(V,O){if(V.length)for(var Z=0,d=V.length;Z<d;Z+=1)O(V[Z]);else O(V)},b="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,H=!!("ontouchstart"in window),S=!!window.PointerEvent,z=!!window.MSPointerEvent,G={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w={start:"mousedown",move:"mousemove",end:"mouseup"},t={};function C(){}b&&!U?Z=G:S?Z={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:z?Z={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:H?(Z=G,t=w):Z=w,C.prototype.on=function(V,O){var Z,d=this,p=V.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var r=0;r<p.length;r+=1)Z=p[r],d._handlers_[Z]=d._handlers_[Z]||[],d._handlers_[Z].push(O);return d},C.prototype.off=function(V,O){var Z=this;return Z._handlers_=Z._handlers_||{},void 0===V?Z._handlers_={}:void 0===O?Z._handlers_[V]=null:Z._handlers_[V]&&Z._handlers_[V].indexOf(O)>=0&&Z._handlers_[V].splice(Z._handlers_[V].indexOf(O),1),Z},C.prototype.trigger=function(V,O){var Z,d=this,p=V.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var r=0;r<p.length;r+=1)Z=p[r],d._handlers_[Z]&&d._handlers_[Z].length&&d._handlers_[Z].forEach((function(V){V.call(d,{type:Z,target:d},O)}))},C.prototype.config=function(V){var O=this;O.options=O.defaults||{},V&&(O.options=function(V,O){var Z={};for(var d in V)V.hasOwnProperty(d)&&O.hasOwnProperty(d)?Z[d]=O[d]:V.hasOwnProperty(d)&&(Z[d]=V[d]);return Z}(O.options,V))},C.prototype.bindEvt=function(V,O){var d=this;return d._domHandlers_=d._domHandlers_||{},d._domHandlers_[O]=function(){"function"==typeof d["on"+O]?d["on"+O].apply(d,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},m(V,Z[O],d._domHandlers_[O]),t[O]&&m(V,t[O],d._domHandlers_[O]),d},C.prototype.unbindEvt=function(V,O){var d=this;return d._domHandlers_=d._domHandlers_||{},a(V,Z[O],d._domHandlers_[O]),t[O]&&a(V,t[O],d._domHandlers_[O]),delete d._domHandlers_[O],this};const v=C;function A(V,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=V,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=A.id,A.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}A.prototype=new v,A.constructor=A,A.id=0,A.prototype.buildEl=function(V){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},A.prototype.stylize=function(){if(this.options.dataOnly)return this;var V=this.options.fadeTime+"ms",O=function(){var V=W("borderRadius");for(var O in V)V.hasOwnProperty(O)&&(V[O]="50%");return V}(),Z=c("transition","opacity",V),d={};return d.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},d.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},d.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},F(d.el,Z),"circle"===this.options.shape&&F(d.back,O),F(d.front,O),this.applyStyles(d),this},A.prototype.applyStyles=function(V){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var Z in V[O])this.ui[O].style[Z]=V[O][Z];return this},A.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},A.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},A.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},A.prototype.show=function(V){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof V&&V.call(this)}),O.options.fadeTime)),O},A.prototype.hide=function(V){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var Z="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=Z,"function"==typeof V&&V.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var Z=O.options.restJoystick,d={};d.x=!0===Z||!1!==Z.x?0:O.instance.frontPosition.x,d.y=!0===Z||!1!==Z.y?0:O.instance.frontPosition.y,O.setPosition(V,d)}return O},A.prototype.setPosition=function(V,O){var Z=this;Z.frontPosition={x:O.x,y:O.y};var d=Z.options.fadeTime+"ms",p={};p.front=c("transition",["transform"],d);var r={front:{}};r.front={transform:"translate("+Z.frontPosition.x+"px,"+Z.frontPosition.y+"px)"},Z.applyStyles(p),Z.applyStyles(r),Z.restTimeout=setTimeout((function(){"function"==typeof V&&V.call(Z),Z.restCallback()}),Z.options.fadeTime)},A.prototype.restCallback=function(){var V=this,O={};O.front=c("transition","none",""),V.applyStyles(O),V.trigger("rested",V.instance)},A.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},A.prototype.computeDirection=function(V){var O,Z,d,p=V.angle.radian,r=Math.PI/4,Y=Math.PI/2;if(p>r&&p<3*r&&!V.lockX?O="up":p>-r&&p<=r&&!V.lockY?O="left":p>3*-r&&p<=-r&&!V.lockX?O="down":V.lockY||(O="right"),V.lockY||(Z=p>-Y&&p<Y?"left":"right"),V.lockX||(d=p>0?"up":"down"),V.force>this.options.threshold){var m,a={};for(m in this.direction)this.direction.hasOwnProperty(m)&&(a[m]=this.direction[m]);var R={};for(m in this.direction={x:Z,y:d,angle:O},V.direction=this.direction,a)a[m]===this.direction[m]&&(R[m]=!0);if(R.x&&R.y&&R.angle)return V;R.x&&R.y||this.trigger("plain",V),R.x||this.trigger("plain:"+Z,V),R.y||this.trigger("plain:"+d,V),R.angle||this.trigger("dir dir:"+O,V)}else this.resetDirection();return V};const l=A;function I(V,O){var Z=this;Z.nipples=[],Z.idles=[],Z.actives=[],Z.ids=[],Z.pressureIntervals={},Z.manager=V,Z.id=I.id,I.id+=1,Z.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Z.config(O),"static"!==Z.options.mode&&"semi"!==Z.options.mode||(Z.options.multitouch=!1),Z.options.multitouch||(Z.options.maxNumberOfNipples=1);var d=getComputedStyle(Z.options.zone.parentElement);return d&&"flex"===d.display&&(Z.parentIsFlex=!0),Z.updateBox(),Z.prepareNipples(),Z.ij(),Z.begin(),Z.nipples}I.prototype=new v,I.constructor=I,I.id=0,I.prototype.prepareNipples=function(){var V=this,O=V.nipples;O.on=V.on.bind(V),O.off=V.off.bind(V),O.options=V.options,O.destroy=V.destroy.bind(V),O.ids=V.ids,O.id=V.id,O.processOnMove=V.processOnMove.bind(V),O.processOnEnd=V.processOnEnd.bind(V),O.get=function(V){if(void 0===V)return O[0];for(var Z=0,d=O.length;Z<d;Z+=1)if(O[Z].identifier===V)return O[Z];return!1}},I.prototype.ij=function(){var V=this;V.bindEvt(V.options.zone,"start"),V.options.zone.style.touchAction="none",V.options.zone.style.msTouchAction="none"},I.prototype.begin=function(){var V=this,O=V.options;if("static"===O.mode){var Z=V.createNipple(O.position,V.manager.getIdentifier());Z.add(),V.idles.push(Z)}},I.prototype.createNipple=function(V,O){var Z=this,d=Z.manager.scroll,p={},r=Z.options,Y=Z.parentIsFlex?d.x:d.x+Z.box.left,m=Z.parentIsFlex?d.y:d.y+Z.box.top;if(V.x&&V.y)p={x:V.x-Y,y:V.y-m};else if(V.top||V.right||V.bottom||V.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=V.top,a.style.right=V.right,a.style.bottom=V.bottom,a.style.left=V.left,a.style.position="absolute",r.zone.appendChild(a);var R=a.getBoundingClientRect();r.zone.removeChild(a),p=V,V={x:R.left+d.x,y:R.top+d.y}}var i=new l(Z,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:O,position:V,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(M(i.ui.el,p),M(i.ui.front,i.frontPosition)),Z.nipples.push(i),Z.trigger("added "+i.identifier+":added",i),Z.manager.trigger("added "+i.identifier+":added",i),Z.bindNipple(i),i},I.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},I.prototype.bindNipple=function(V){var O,Z=this,d=function(V,d){O=V.type+" "+d.id+":"+V.type,Z.trigger(O,d)};V.on("destroyed",Z.onDestroyed.bind(Z)),V.on("shown hidden rested dir plain",d),V.on("dir:up dir:right dir:down dir:left",d),V.on("plain:up plain:right plain:down plain:left",d)},I.prototype.pressureFn=function(V,O,Z){var d=this,p=0;clearInterval(d.pressureIntervals[Z]),d.pressureIntervals[Z]=setInterval(function(){var Z=V.force||V.pressure||V.webkitForce||0;Z!==p&&(O.trigger("pressure",Z),d.trigger("pressure "+O.identifier+":pressure",Z),p=Z)}.bind(d),100)},I.prototype.onstart=function(V){var O=this,Z=O.options,d=V;return V=R(V),O.updateBox(),Q(V,(function(p){O.actives.length<Z.maxNumberOfNipples?O.processOnStart(p):d.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(Z){if(Object.values(d.touches).findIndex((function(V){return V.identifier===Z}))<0){var p=[V[0]];p.identifier=Z,O.processOnEnd(p)}})),O.actives.length<Z.maxNumberOfNipples&&O.processOnStart(p))})),O.manager.bindDocument(),!1},I.prototype.processOnStart=function(V){var O,Z=this,p=Z.options,r=Z.manager.getIdentifier(V),Y=V.force||V.pressure||V.webkitForce||0,m={x:V.pageX,y:V.pageY},a=Z.getOrCreate(r,m);a.identifier!==r&&Z.manager.removeIdentifier(a.identifier),a.identifier=r;var R=function(O){O.trigger("start",O),Z.trigger("start "+O.id+":start",O),O.show(),Y>0&&Z.pressureFn(V,O,O.identifier),Z.processOnMove(V)};if((O=Z.idles.indexOf(a))>=0&&Z.idles.splice(O,1),Z.actives.push(a),Z.ids.push(a.identifier),"semi"!==p.mode)R(a);else{if(!(d(m,a.position)<=p.catchDistance))return a.destroy(),void Z.processOnStart(V);R(a)}return a},I.prototype.getOrCreate=function(V,O){var Z,d=this,p=d.options;return/(semi|static)/.test(p.mode)?(Z=d.idles[0])?(d.idles.splice(0,1),Z):"semi"===p.mode?d.createNipple(O,V):(console.warn("Coudln't find the needed nipple."),!1):Z=d.createNipple(O,V)},I.prototype.processOnMove=function(V){var O=this,Z=O.options,r=O.manager.getIdentifier(V),Y=O.nipples.get(r),m=O.manager.scroll;if(function(V){return isNaN(V.buttons)?0!==V.pressure:0!==V.buttons}(V)){if(!Y)return console.error("Found zombie joystick with ID "+r),void O.manager.removeIdentifier(r);if(Z.dynamicPage){var a=Y.el.getBoundingClientRect();Y.position={x:m.x+a.left,y:m.y+a.top}}Y.identifier=r;var R=Y.options.size/2,i={x:V.pageX,y:V.pageY};Z.lockX&&(i.y=Y.position.y),Z.lockY&&(i.x=Y.position.x);var M,c,W,F,Q,b,U,H,S,z,G=d(i,Y.position),w=(M=i,W=(c=Y.position).x-M.x,F=c.y-M.y,function(V){return V*(180/Math.PI)}(Math.atan2(F,W))),t=p(w),C=G/R,v={distance:G,position:i};if("circle"===Y.options.shape?(Q=Math.min(G,R),U=Y.position,H=Q,z={x:0,y:0},S=p(S=w),z.x=U.x-H*Math.cos(S),z.y=U.y-H*Math.sin(S),b=z):(b=function(V,O,Z){return{x:Math.min(Math.max(V.x,O.x-Z),O.x+Z),y:Math.min(Math.max(V.y,O.y-Z),O.y+Z)}}(i,Y.position,R),Q=d(b,Y.position)),Z.follow){if(G>R){var A=i.x-b.x,l=i.y-b.y;Y.position.x+=A,Y.position.y+=l,Y.el.style.top=Y.position.y-(O.box.top+m.y)+"px",Y.el.style.left=Y.position.x-(O.box.left+m.x)+"px",G=d(i,Y.position)}}else i=b,G=Q;var I=i.x-Y.position.x,g=i.y-Y.position.y;Y.frontPosition={x:I,y:g},Z.dataOnly||(Y.ui.front.style.transform="translate("+I+"px,"+g+"px)");var n={identifier:Y.identifier,position:i,force:C,pressure:V.force||V.pressure||V.webkitForce||0,distance:G,angle:{radian:t,degree:w},vector:{x:I/R,y:-g/R},raw:v,instance:Y,lockX:Z.lockX,lockY:Z.lockY};(n=Y.computeDirection(n)).angle={radian:p(180-w),degree:180-w},Y.trigger("move",n),O.trigger("move "+Y.id+":move",n)}else this.processOnEnd(V)},I.prototype.processOnEnd=function(V){var O=this,Z=O.options,d=O.manager.getIdentifier(V),p=O.nipples.get(d),r=O.manager.removeIdentifier(p.identifier);p&&(Z.dataOnly||p.hide((function(){"dynamic"===Z.mode&&(p.trigger("removed",p),O.trigger("removed "+p.id+":removed",p),O.manager.trigger("removed "+p.id+":removed",p),p.destroy())})),clearInterval(O.pressureIntervals[p.identifier]),p.resetDirection(),p.trigger("end",p),O.trigger("end "+p.id+":end",p),O.ids.indexOf(p.identifier)>=0&&O.ids.splice(O.ids.indexOf(p.identifier),1),O.actives.indexOf(p)>=0&&O.actives.splice(O.actives.indexOf(p),1),/(semi|static)/.test(Z.mode)?O.idles.push(p):O.nipples.indexOf(p)>=0&&O.nipples.splice(O.nipples.indexOf(p),1),O.manager.unbindDocument(),/(semi|static)/.test(Z.mode)&&(O.manager.ids[r.id]=r.identifier))},I.prototype.onDestroyed=function(V,O){var Z=this;Z.nipples.indexOf(O)>=0&&Z.nipples.splice(Z.nipples.indexOf(O),1),Z.actives.indexOf(O)>=0&&Z.actives.splice(Z.actives.indexOf(O),1),Z.idles.indexOf(O)>=0&&Z.idles.splice(Z.idles.indexOf(O),1),Z.ids.indexOf(O.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(O.identifier),1),Z.manager.removeIdentifier(O.identifier),Z.manager.unbindDocument()},I.prototype.destroy=function(){var V=this;for(var O in V.unbindEvt(V.options.zone,"start"),V.nipples.forEach((function(V){V.destroy()})),V.pressureIntervals)V.pressureIntervals.hasOwnProperty(O)&&clearInterval(V.pressureIntervals[O]);V.trigger("destroyed",V.nipples),V.manager.unbindDocument(),V.off()};const g=I;function n(V){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=i(),O.config(V),O.prepareCollections();var Z=function(){var V;O.collections.forEach((function(Z){Z.forEach((function(Z){V=Z.el.getBoundingClientRect(),Z.position={x:O.scroll.x+V.left,y:O.scroll.y+V.top}}))}))};m(window,"resize",(function(){Y(Z)}));var d=function(){O.scroll=i()};return m(window,"scroll",(function(){Y(d)})),O.collections}n.prototype=new v,n.constructor=n,n.prototype.prepareCollections=function(){var V=this;V.collections.create=V.create.bind(V),V.collections.on=V.on.bind(V),V.collections.off=V.off.bind(V),V.collections.destroy=V.destroy.bind(V),V.collections.get=function(O){var Z;return V.collections.every((function(V){return!(Z=V.get(O))})),Z}},n.prototype.create=function(V){return this.createCollection(V)},n.prototype.createCollection=function(V){var O=this,Z=new g(O,V);return O.bindCollection(Z),O.collections.push(Z),Z},n.prototype.bindCollection=function(V){var O,Z=this,d=function(V,d){O=V.type+" "+d.id+":"+V.type,Z.trigger(O,d)};V.on("destroyed",Z.onDestroyed.bind(Z)),V.on("shown hidden rested dir plain",d),V.on("dir:up dir:right dir:down dir:left",d),V.on("plain:up plain:right plain:down plain:left",d)},n.prototype.bindDocument=function(){var V=this;V.binded||(V.bindEvt(document,"move").bindEvt(document,"end"),V.binded=!0)},n.prototype.unbindDocument=function(V){var O=this;Object.keys(O.ids).length&&!0!==V||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},n.prototype.getIdentifier=function(V){var O;return V?void 0===(O=void 0===V.identifier?V.pointerId:V.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},n.prototype.removeIdentifier=function(V){var O={};for(var Z in this.ids)if(this.ids[Z]===V){O.id=Z,O.identifier=this.ids[Z],delete this.ids[Z];break}return O},n.prototype.onmove=function(V){return this.onAny("move",V),!1},n.prototype.onend=function(V){return this.onAny("end",V),!1},n.prototype.oncancel=function(V){return this.onAny("end",V),!1},n.prototype.onAny=function(V,O){var Z,d=this,p="processOn"+V.charAt(0).toUpperCase()+V.slice(1);O=R(O);var r=function(V,O,Z){Z.ids.indexOf(O)>=0&&(Z[p](V),V._found_=!0)};return Q(O,(function(V){Z=d.getIdentifier(V),Q(d.collections,r.bind(null,V,Z)),V._found_||d.removeIdentifier(Z)})),!1},n.prototype.destroy=function(){var V=this;V.unbindDocument(!0),V.ids={},V.index=0,V.collections.forEach((function(V){V.destroy()})),V.off()},n.prototype.onDestroyed=function(V,O){var Z=this;if(Z.collections.indexOf(O)<0)return!1;Z.collections.splice(Z.collections.indexOf(O),1)};var e=new n;const u={create:function(V){return e.create(V)},factory:e};return O.default})(),V.exports=O()},11067:(V,O,Z)=>{"use strict";const{Deflate:d,deflate:p,deflateRaw:r,gzip:Y}=Z(11074),{Inflate:m,inflate:a,inflateRaw:R,ungzip:i}=Z(11139),M=Z(11110);V.exports.Deflate=d,V.exports.deflate=p,V.exports.deflateRaw=r,V.exports.gzip=Y,V.exports.Inflate=m,V.exports.inflate=a,V.exports.inflateRaw=R,V.exports.ungzip=i,V.exports.constants=M},11074:(V,O,Z)=>{"use strict";const d=Z(11078),p=Z(11115),r=Z(11123),Y=Z(11107),m=Z(11130),a=Object.prototype.toString,{Z_NO_FLUSH:R,Z_SYNC_FLUSH:i,Z_FULL_FLUSH:M,Z_FINISH:c,Z_OK:W,Z_STREAM_END:F,Z_DEFAULT_COMPRESSION:Q,Z_DEFAULT_STRATEGY:b,Z_DEFLATED:U}=Z(11110);function H(V){this.options=p.assign({level:Q,method:U,Ja:16384,windowBits:15,memLevel:8,strategy:b},V||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;let Z=d.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(Z!==W)throw new Error(Y[Z]);if(O.header&&d.deflateSetHeader(this.strm,O.header),O.dictionary){let V;if(V="string"===typeof O.dictionary?r.string2buf(O.dictionary):"[object ArrayBuffer]"===a.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,Z=d.deflateSetDictionary(this.strm,V),Z!==W)throw new Error(Y[Z]);this._dict_set=!0}}function S(V,O){const Z=new H(O);if(Z.push(V,!0),Z.err)throw Z.msg||Y[Z.err];return Z.result}H.prototype.push=function(V,O){const Z=this.strm,p=this.options.Ja;let Y,m;if(this.ended)return!1;for(m=O===~~O?O:!0===O?c:R,"string"===typeof V?Z.input=r.string2buf(V):"[object ArrayBuffer]"===a.call(V)?Z.input=new Uint8Array(V):Z.input=V,Z.next_in=0,Z.avail_in=Z.input.length;;)if(0===Z.avail_out&&(Z.output=new Uint8Array(p),Z.next_out=0,Z.avail_out=p),(m===i||m===M)&&Z.avail_out<=6)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else{if(Y=d.deflate(Z,m),Y===F)return Z.next_out>0&&this.onData(Z.output.subarray(0,Z.next_out)),Y=d.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===W;if(0!==Z.avail_out){if(m>0&&Z.next_out>0)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else if(0===Z.avail_in)break}else this.onData(Z.output)}return!0},H.prototype.onData=function(V){this.chunks.push(V)},H.prototype.onEnd=function(V){V===W&&(this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},V.exports.Deflate=H,V.exports.deflate=S,V.exports.deflateRaw=function(V,O){return(O=O||{}).raw=!0,S(V,O)},V.exports.gzip=function(V,O){return(O=O||{}).gzip=!0,S(V,O)},V.exports.constants=Z(11110)},11139:(V,O,Z)=>{"use strict";const d=Z(11144),p=Z(11115),r=Z(11123),Y=Z(11107),m=Z(11130),a=Z(11166),R=Object.prototype.toString,{Z_NO_FLUSH:i,Z_FINISH:M,Z_OK:c,Z_STREAM_END:W,Z_NEED_DICT:F,Z_STREAM_ERROR:Q,Z_DATA_ERROR:b,Z_MEM_ERROR:U}=Z(11110);function H(V){this.options=p.assign({Ja:65536,windowBits:15,to:""},V||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||V&&V.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;let Z=d.inflateInit2(this.strm,O.windowBits);if(Z!==c)throw new Error(Y[Z]);if(this.header=new a,d.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=r.string2buf(O.dictionary):"[object ArrayBuffer]"===R.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(Z=d.inflateSetDictionary(this.strm,O.dictionary),Z!==c)))throw new Error(Y[Z])}function S(V,O){const Z=new H(O);if(Z.push(V),Z.err)throw Z.msg||Y[Z.err];return Z.result}H.prototype.push=function(V,O){const Z=this.strm,p=this.options.Ja,Y=this.options.dictionary;let m,a,H;if(this.ended)return!1;for(a=O===~~O?O:!0===O?M:i,"[object ArrayBuffer]"===R.call(V)?Z.input=new Uint8Array(V):Z.input=V,Z.next_in=0,Z.avail_in=Z.input.length;;){for(0===Z.avail_out&&(Z.output=new Uint8Array(p),Z.next_out=0,Z.avail_out=p),m=d.inflate(Z,a),m===F&&Y&&(m=d.inflateSetDictionary(Z,Y),m===c?m=d.inflate(Z,a):m===b&&(m=F));Z.avail_in>0&&m===W&&Z.state.wrap>0&&0!==V[Z.next_in];)d.inflateReset(Z),m=d.inflate(Z,a);switch(m){case Q:case b:case F:case U:return this.onEnd(m),this.ended=!0,!1}if(H=Z.avail_out,Z.next_out&&(0===Z.avail_out||m===W))if("string"===this.options.to){let V=r.utf8border(Z.output,Z.next_out),O=Z.next_out-V,d=r.buf2string(Z.output,V);Z.next_out=O,Z.avail_out=p-O,O&&Z.output.set(Z.output.subarray(V,V+O),0),this.onData(d)}else this.onData(Z.output.length===Z.next_out?Z.output:Z.output.subarray(0,Z.next_out));if(m!==c||0!==H){if(m===W)return m=d.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,!0;if(0===Z.avail_in)break}}return!0},H.prototype.onData=function(V){this.chunks.push(V)},H.prototype.onEnd=function(V){V===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},V.exports.Inflate=H,V.exports.inflate=S,V.exports.inflateRaw=function(V,O){return(O=O||{}).raw=!0,S(V,O)},V.exports.ungzip=S,V.exports.constants=Z(11110)},11115:V=>{"use strict";const O=(V,O)=>Object.prototype.hasOwnProperty.call(V,O);V.exports.assign=function(V){const Z=Array.prototype.slice.call(arguments,1);for(;Z.length;){const d=Z.shift();if(d){if("object"!==typeof d)throw new TypeError(d+"must be non-object");for(const Z in d)O(d,Z)&&(V[Z]=d[Z])}}return V},V.exports.flattenChunks=V=>{let O=0;for(let d=0,p=V.length;d<p;d++)O+=V[d].length;const Z=new Uint8Array(O);for(let d=0,p=0,r=V.length;d<r;d++){let O=V[d];Z.set(O,p),p+=O.length}return Z}},11123:V=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){O=!1}const Z=new Uint8Array(256);for(let p=0;p<256;p++)Z[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;Z[254]=Z[254]=1,V.exports.string2buf=V=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(V);let O,Z,d,p,r,Y=V.length,m=0;for(p=0;p<Y;p++)Z=V.charCodeAt(p),55296===(64512&Z)&&p+1<Y&&(d=V.charCodeAt(p+1),56320===(64512&d)&&(Z=65536+(Z-55296<<10)+(d-56320),p++)),m+=Z<128?1:Z<2048?2:Z<65536?3:4;for(O=new Uint8Array(m),r=0,p=0;r<m;p++)Z=V.charCodeAt(p),55296===(64512&Z)&&p+1<Y&&(d=V.charCodeAt(p+1),56320===(64512&d)&&(Z=65536+(Z-55296<<10)+(d-56320),p++)),Z<128?O[r++]=Z:Z<2048?(O[r++]=192|Z>>>6,O[r++]=128|63&Z):Z<65536?(O[r++]=224|Z>>>12,O[r++]=128|Z>>>6&63,O[r++]=128|63&Z):(O[r++]=240|Z>>>18,O[r++]=128|Z>>>12&63,O[r++]=128|Z>>>6&63,O[r++]=128|63&Z);return O};V.exports.buf2string=(V,d)=>{const p=d||V.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(V.subarray(0,d));let r,Y;const m=new Array(2*p);for(Y=0,r=0;r<p;){let O=V[r++];if(O<128){m[Y++]=O;continue}let d=Z[O];if(d>4)m[Y++]=65533,r+=d-1;else{for(O&=2===d?31:3===d?15:7;d>1&&r<p;)O=O<<6|63&V[r++],d--;d>1?m[Y++]=65533:O<65536?m[Y++]=O:(O-=65536,m[Y++]=55296|O>>10&1023,m[Y++]=56320|1023&O)}}return((V,Z)=>{if(Z<65534&&V.subarray&&O)return String.fromCharCode.apply(null,V.length===Z?V:V.subarray(0,Z));let d="";for(let O=0;O<Z;O++)d+=String.fromCharCode(V[O]);return d})(m,Y)},V.exports.utf8border=(V,O)=>{(O=O||V.length)>V.length&&(O=V.length);let d=O-1;for(;d>=0&&128===(192&V[d]);)d--;return d<0||0===d?O:d+Z[V[d]]>O?d:O}},11090:V=>{"use strict";V.exports=(V,O,Z,d)=>{let p=65535&V,r=V>>>16&65535,Y=0;for(;0!==Z;){Y=Z>2e3?2e3:Z,Z-=Y;do{p=p+O[d++]|0,r=r+p|0}while(--Y);p%=65521,r%=65521}return p|r<<16}},11110:V=>{"use strict";V.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11099:V=>{"use strict";const O=new Uint32Array((()=>{let V,O=[];for(var Z=0;Z<256;Z++){V=Z;for(var d=0;d<8;d++)V=1&V?3988292384^V>>>1:V>>>1;O[Z]=V}return O})());V.exports=(V,Z,d,p)=>{const r=O,Y=p+d;V^=-1;for(let O=p;O<Y;O++)V=V>>>8^r[255&(V^Z[O])];return~V}},11078:(V,O,Z)=>{"use strict";const{_tr_init:d,_tr_stored_block:p,_tr_flush_block:r,_tr_tally:Y,_tr_align:m}=Z(11081),a=Z(11090),R=Z(11099),i=Z(11107),{Z_NO_FLUSH:M,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:W,Z_FINISH:F,Z_BLOCK:Q,Z_OK:b,Z_STREAM_END:U,Z_STREAM_ERROR:H,Z_DATA_ERROR:S,Z_BUF_ERROR:z,Z_DEFAULT_COMPRESSION:G,Z_FILTERED:w,Z_HUFFMAN_ONLY:t,Z_RLE:C,Z_FIXED:v,Z_DEFAULT_STRATEGY:A,Z_UNKNOWN:l,Z_DEFLATED:I}=Z(11110),g=258,n=262,e=103,u=113,k=666,D=(V,O)=>(V.msg=i[O],O),X=V=>(V<<1)-(V>4?9:0),o=V=>{let O=V.length;for(;--O>=0;)V[O]=0};let E=(V,O,Z)=>(O<<V.hash_shift^Z)&V.hash_mask;const L=V=>{const O=V.state;let Z=O.pending;Z>V.avail_out&&(Z=V.avail_out),0!==Z&&(V.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+Z),V.next_out),V.next_out+=Z,O.pending_out+=Z,V.total_out+=Z,V.avail_out-=Z,O.pending-=Z,0===O.pending&&(O.pending_out=0))},J=(V,O)=>{r(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,O),V.block_start=V.strstart,L(V.strm)},N=(V,O)=>{V.pending_buf[V.pending++]=O},P=(V,O)=>{V.pending_buf[V.pending++]=O>>>8&255,V.pending_buf[V.pending++]=255&O},f=(V,O,Z,d)=>{let p=V.avail_in;return p>d&&(p=d),0===p?0:(V.avail_in-=p,O.set(V.input.subarray(V.next_in,V.next_in+p),Z),1===V.state.wrap?V.adler=a(V.adler,O,p,Z):2===V.state.wrap&&(V.adler=R(V.adler,O,p,Z)),V.next_in+=p,V.total_in+=p,p)},q=(V,O)=>{let Z,d,p=V.max_chain_length,r=V.strstart,Y=V.prev_length,m=V.nice_match;const a=V.strstart>V.w_size-n?V.strstart-(V.w_size-n):0,R=V.window,i=V.w_mask,M=V.prev,c=V.strstart+g;let W=R[r+Y-1],F=R[r+Y];V.prev_length>=V.good_match&&(p>>=2),m>V.lookahead&&(m=V.lookahead);do{if(Z=O,R[Z+Y]===F&&R[Z+Y-1]===W&&R[Z]===R[r]&&R[++Z]===R[r+1]){r+=2,Z++;do{}while(R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&R[++r]===R[++Z]&&r<c);if(d=g-(c-r),r=c-g,d>Y){if(V.match_start=O,Y=d,d>=m)break;W=R[r+Y-1],F=R[r+Y]}}}while((O=M[O&i])>a&&0!==--p);return Y<=V.lookahead?Y:V.lookahead},K=V=>{const O=V.w_size;let Z,d,p,r,Y;do{if(r=V.window_size-V.lookahead-V.strstart,V.strstart>=O+(O-n)){V.window.set(V.window.subarray(O,O+O),0),V.match_start-=O,V.strstart-=O,V.block_start-=O,d=V.hash_size,Z=d;do{p=V.head[--Z],V.head[Z]=p>=O?p-O:0}while(--d);d=O,Z=d;do{p=V.prev[--Z],V.prev[Z]=p>=O?p-O:0}while(--d);r+=O}if(0===V.strm.avail_in)break;if(d=f(V.strm,V.window,V.strstart+V.lookahead,r),V.lookahead+=d,V.lookahead+V.insert>=3)for(Y=V.strstart-V.insert,V.ins_h=V.window[Y],V.ins_h=E(V,V.ins_h,V.window[Y+1]);V.insert&&(V.ins_h=E(V,V.ins_h,V.window[Y+3-1]),V.prev[Y&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=Y,Y++,V.insert--,!(V.lookahead+V.insert<3)););}while(V.lookahead<n&&0!==V.strm.avail_in)},s=(V,O)=>{let Z,d;for(;;){if(V.lookahead<n){if(K(V),V.lookahead<n&&O===M)return 1;if(0===V.lookahead)break}if(Z=0,V.lookahead>=3&&(V.ins_h=E(V,V.ins_h,V.window[V.strstart+3-1]),Z=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),0!==Z&&V.strstart-Z<=V.w_size-n&&(V.match_length=q(V,Z)),V.match_length>=3)if(d=Y(V,V.strstart-V.match_start,V.match_length-3),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=3){V.match_length--;do{V.strstart++,V.ins_h=E(V,V.ins_h,V.window[V.strstart+3-1]),Z=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart}while(0!==--V.match_length);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=E(V,V.ins_h,V.window[V.strstart+1]);else d=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(d&&(J(V,!1),0===V.strm.avail_out))return 1}return V.insert=V.strstart<2?V.strstart:2,O===F?(J(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(J(V,!1),0===V.strm.avail_out)?1:2},h=(V,O)=>{let Z,d,p;for(;;){if(V.lookahead<n){if(K(V),V.lookahead<n&&O===M)return 1;if(0===V.lookahead)break}if(Z=0,V.lookahead>=3&&(V.ins_h=E(V,V.ins_h,V.window[V.strstart+3-1]),Z=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=2,0!==Z&&V.prev_length<V.max_lazy_match&&V.strstart-Z<=V.w_size-n&&(V.match_length=q(V,Z),V.match_length<=5&&(V.strategy===w||3===V.match_length&&V.strstart-V.match_start>4096)&&(V.match_length=2)),V.prev_length>=3&&V.match_length<=V.prev_length){p=V.strstart+V.lookahead-3,d=Y(V,V.strstart-1-V.prev_match,V.prev_length-3),V.lookahead-=V.prev_length-1,V.prev_length-=2;do{++V.strstart<=p&&(V.ins_h=E(V,V.ins_h,V.window[V.strstart+3-1]),Z=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart)}while(0!==--V.prev_length);if(V.match_available=0,V.match_length=2,V.strstart++,d&&(J(V,!1),0===V.strm.avail_out))return 1}else if(V.match_available){if(d=Y(V,0,V.window[V.strstart-1]),d&&J(V,!1),V.strstart++,V.lookahead--,0===V.strm.avail_out)return 1}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(d=Y(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<2?V.strstart:2,O===F?(J(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(J(V,!1),0===V.strm.avail_out)?1:2};function x(V,O,Z,d,p){this.good_length=V,this.max_lazy=O,this.nice_length=Z,this.max_chain=d,this.func=p}const y=[new x(0,0,0,0,((V,O)=>{let Z=65535;for(Z>V.pending_buf_size-5&&(Z=V.pending_buf_size-5);;){if(V.lookahead<=1){if(K(V),0===V.lookahead&&O===M)return 1;if(0===V.lookahead)break}V.strstart+=V.lookahead,V.lookahead=0;const d=V.block_start+Z;if((0===V.strstart||V.strstart>=d)&&(V.lookahead=V.strstart-d,V.strstart=d,J(V,!1),0===V.strm.avail_out))return 1;if(V.strstart-V.block_start>=V.w_size-n&&(J(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,O===F?(J(V,!0),0===V.strm.avail_out?3:4):(V.strstart>V.block_start&&(J(V,!1),V.strm.avail_out),1)})),new x(4,4,8,4,s),new x(4,5,16,8,s),new x(4,6,32,32,s),new x(4,4,16,16,h),new x(8,16,32,32,h),new x(8,16,128,128,h),new x(8,32,128,256,h),new x(32,128,258,1024,h),new x(32,258,258,4096,h)];function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=V=>{if(!V||!V.state)return D(V,H);V.total_in=V.total_out=0,V.data_type=l;const O=V.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:u,V.adler=2===O.wrap?0:1,O.last_flush=M,d(O),b},j=V=>{const O=B(V);var Z;return O===b&&((Z=V.state).window_size=2*Z.w_size,o(Z.head),Z.max_lazy_match=y[Z.level].max_lazy,Z.good_match=y[Z.level].good_length,Z.nice_match=y[Z.level].nice_length,Z.max_chain_length=y[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=2,Z.match_available=0,Z.ins_h=0),O},VV=(V,O,Z,d,p,r)=>{if(!V)return H;let Y=1;if(O===G&&(O=6),d<0?(Y=0,d=-d):d>15&&(Y=2,d-=16),p<1||p>9||Z!==I||d<8||d>15||O<0||O>9||r<0||r>v)return D(V,H);8===d&&(d=9);const m=new T;return V.state=m,m.strm=V,m.wrap=Y,m.gzhead=null,m.w_bits=d,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=p+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<p+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.d_buf=1*m.lit_bufsize,m.l_buf=3*m.lit_bufsize,m.level=O,m.strategy=r,m.method=Z,j(V)};V.exports.deflateInit=(V,O)=>VV(V,O,I,15,8,A),V.exports.deflateInit2=VV,V.exports.deflateReset=j,V.exports.deflateResetKeep=B,V.exports.deflateSetHeader=(V,O)=>V&&V.state?2!==V.state.wrap?H:(V.state.gzhead=O,b):H,V.exports.deflate=(V,O)=>{let Z,d;if(!V||!V.state||O>Q||O<0)return V?D(V,H):H;const r=V.state;if(!V.output||!V.input&&0!==V.avail_in||r.status===k&&O!==F)return D(V,0===V.avail_out?z:H);r.strm=V;const a=r.last_flush;if(r.last_flush=O,42===r.status)if(2===r.wrap)V.adler=0,N(r,31),N(r,139),N(r,8),r.gzhead?(N(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),N(r,255&r.gzhead.time),N(r,r.gzhead.time>>8&255),N(r,r.gzhead.time>>16&255),N(r,r.gzhead.time>>24&255),N(r,9===r.level?2:r.strategy>=t||r.level<2?4:0),N(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(N(r,255&r.gzhead.extra.length),N(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(V.adler=R(V.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(N(r,0),N(r,0),N(r,0),N(r,0),N(r,0),N(r,9===r.level?2:r.strategy>=t||r.level<2?4:0),N(r,3),r.status=u);else{let O=I+(r.w_bits-8<<4)<<8,Z=-1;Z=r.strategy>=t||r.level<2?0:r.level<6?1:6===r.level?2:3,O|=Z<<6,0!==r.strstart&&(O|=32),O+=31-O%31,r.status=u,P(r,O),0!==r.strstart&&(P(r,V.adler>>>16),P(r,65535&V.adler)),V.adler=1}if(69===r.status)if(r.gzhead.extra){for(Z=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),L(V),Z=r.pending,r.pending!==r.pending_buf_size));)N(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){Z=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),L(V),Z=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,N(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),0===d&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){Z=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),L(V),Z=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,N(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>Z&&(V.adler=R(V.adler,r.pending_buf,r.pending-Z,Z)),0===d&&(r.status=e)}else r.status=e;if(r.status===e&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&L(V),r.pending+2<=r.pending_buf_size&&(N(r,255&V.adler),N(r,V.adler>>8&255),V.adler=0,r.status=u)):r.status=u),0!==r.pending){if(L(V),0===V.avail_out)return r.last_flush=-1,b}else if(0===V.avail_in&&X(O)<=X(a)&&O!==F)return D(V,z);if(r.status===k&&0!==V.avail_in)return D(V,z);if(0!==V.avail_in||0!==r.lookahead||O!==M&&r.status!==k){let Z=r.strategy===t?((V,O)=>{let Z;for(;;){if(0===V.lookahead&&(K(V),0===V.lookahead)){if(O===M)return 1;break}if(V.match_length=0,Z=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,Z&&(J(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,O===F?(J(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(J(V,!1),0===V.strm.avail_out)?1:2})(r,O):r.strategy===C?((V,O)=>{let Z,d,p,r;const m=V.window;for(;;){if(V.lookahead<=g){if(K(V),V.lookahead<=g&&O===M)return 1;if(0===V.lookahead)break}if(V.match_length=0,V.lookahead>=3&&V.strstart>0&&(p=V.strstart-1,d=m[p],d===m[++p]&&d===m[++p]&&d===m[++p])){r=V.strstart+g;do{}while(d===m[++p]&&d===m[++p]&&d===m[++p]&&d===m[++p]&&d===m[++p]&&d===m[++p]&&d===m[++p]&&d===m[++p]&&p<r);V.match_length=g-(r-p),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=3?(Z=Y(V,1,V.match_length-3),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(Z=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),Z&&(J(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,O===F?(J(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(J(V,!1),0===V.strm.avail_out)?1:2})(r,O):y[r.level].func(r,O);if(3!==Z&&4!==Z||(r.status=k),1===Z||3===Z)return 0===V.avail_out&&(r.last_flush=-1),b;if(2===Z&&(O===c?m(r):O!==Q&&(p(r,0,0,!1),O===W&&(o(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),L(V),0===V.avail_out))return r.last_flush=-1,b}return O!==F?b:r.wrap<=0?U:(2===r.wrap?(N(r,255&V.adler),N(r,V.adler>>8&255),N(r,V.adler>>16&255),N(r,V.adler>>24&255),N(r,255&V.total_in),N(r,V.total_in>>8&255),N(r,V.total_in>>16&255),N(r,V.total_in>>24&255)):(P(r,V.adler>>>16),P(r,65535&V.adler)),L(V),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?b:U)},V.exports.deflateEnd=V=>{if(!V||!V.state)return H;const O=V.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==e&&O!==u&&O!==k?D(V,H):(V.state=null,O===u?D(V,S):b)},V.exports.deflateSetDictionary=(V,O)=>{let Z=O.length;if(!V||!V.state)return H;const d=V.state,p=d.wrap;if(2===p||1===p&&42!==d.status||d.lookahead)return H;if(1===p&&(V.adler=a(V.adler,O,Z,0)),d.wrap=0,Z>=d.w_size){0===p&&(o(d.head),d.strstart=0,d.block_start=0,d.insert=0);let V=new Uint8Array(d.w_size);V.set(O.subarray(Z-d.w_size,Z),0),O=V,Z=d.w_size}const r=V.avail_in,Y=V.next_in,m=V.input;for(V.avail_in=Z,V.next_in=0,V.input=O,K(d);d.lookahead>=3;){let V=d.strstart,O=d.lookahead-2;do{d.ins_h=E(d,d.ins_h,d.window[V+3-1]),d.prev[V&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=V,V++}while(--O);d.strstart=V,d.lookahead=2,K(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,V.next_in=Y,V.input=m,V.avail_in=r,d.wrap=p,b},V.exports.deflateInfo="pako deflate (from Nodeca project)"},11166:V=>{"use strict";V.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11152:V=>{"use strict";V.exports=function(V,O){let Z,d,p,r,Y,m,a,R,i,M,c,W,F,Q,b,U,H,S,z,G,w,t,C,v;const A=V.state;Z=V.next_in,C=V.input,d=Z+(V.avail_in-5),p=V.next_out,v=V.output,r=p-(O-V.avail_out),Y=p+(V.avail_out-257),m=A.dmax,a=A.wsize,R=A.whave,i=A.wnext,M=A.window,c=A.hold,W=A.bits,F=A.lencode,Q=A.distcode,b=(1<<A.lenbits)-1,U=(1<<A.distbits)-1;V:do{W<15&&(c+=C[Z++]<<W,W+=8,c+=C[Z++]<<W,W+=8),H=F[c&b];O:for(;;){if(S=H>>>24,c>>>=S,W-=S,S=H>>>16&255,0===S)v[p++]=65535&H;else{if(!(16&S)){if(0===(64&S)){H=F[(65535&H)+(c&(1<<S)-1)];continue O}if(32&S){A.mode=12;break V}V.msg="invalid literal/length code",A.mode=30;break V}z=65535&H,S&=15,S&&(W<S&&(c+=C[Z++]<<W,W+=8),z+=c&(1<<S)-1,c>>>=S,W-=S),W<15&&(c+=C[Z++]<<W,W+=8,c+=C[Z++]<<W,W+=8),H=Q[c&U];Z:for(;;){if(S=H>>>24,c>>>=S,W-=S,S=H>>>16&255,!(16&S)){if(0===(64&S)){H=Q[(65535&H)+(c&(1<<S)-1)];continue Z}V.msg="invalid distance code",A.mode=30;break V}if(G=65535&H,S&=15,W<S&&(c+=C[Z++]<<W,W+=8,W<S&&(c+=C[Z++]<<W,W+=8)),G+=c&(1<<S)-1,G>m){V.msg="invalid distance too far back",A.mode=30;break V}if(c>>>=S,W-=S,S=p-r,G>S){if(S=G-S,S>R&&A.sane){V.msg="invalid distance too far back",A.mode=30;break V}if(w=0,t=M,0===i){if(w+=a-S,S<z){z-=S;do{v[p++]=M[w++]}while(--S);w=p-G,t=v}}else if(i<S){if(w+=a+i-S,S-=i,S<z){z-=S;do{v[p++]=M[w++]}while(--S);if(w=0,i<z){S=i,z-=S;do{v[p++]=M[w++]}while(--S);w=p-G,t=v}}}else if(w+=i-S,S<z){z-=S;do{v[p++]=M[w++]}while(--S);w=p-G,t=v}for(;z>2;)v[p++]=t[w++],v[p++]=t[w++],v[p++]=t[w++],z-=3;z&&(v[p++]=t[w++],z>1&&(v[p++]=t[w++]))}else{w=p-G;do{v[p++]=v[w++],v[p++]=v[w++],v[p++]=v[w++],z-=3}while(z>2);z&&(v[p++]=v[w++],z>1&&(v[p++]=v[w++]))}break}}break}}while(Z<d&&p<Y);z=W>>3,Z-=z,W-=z<<3,c&=(1<<W)-1,V.next_in=Z,V.next_out=p,V.avail_in=Z<d?d-Z+5:5-(Z-d),V.avail_out=p<Y?Y-p+257:257-(p-Y),A.hold=c,A.bits=W}},11144:(V,O,Z)=>{"use strict";const d=Z(11090),p=Z(11099),r=Z(11152),Y=Z(11160),{Z_FINISH:m,Z_BLOCK:a,Z_TREES:R,Z_OK:i,Z_STREAM_END:M,Z_NEED_DICT:c,Z_STREAM_ERROR:W,Z_DATA_ERROR:F,Z_MEM_ERROR:Q,Z_BUF_ERROR:b,Z_DEFLATED:U}=Z(11110),H=12,S=30,z=V=>(V>>>24&255)+(V>>>8&65280)+((65280&V)<<8)+((255&V)<<24);function G(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w=V=>{if(!V||!V.state)return W;const O=V.state;return V.total_in=V.total_out=O.total=0,V.msg="",O.wrap&&(V.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,i},t=V=>{if(!V||!V.state)return W;const O=V.state;return O.wsize=0,O.whave=0,O.wnext=0,w(V)},C=(V,O)=>{let Z;if(!V||!V.state)return W;const d=V.state;return O<0?(Z=0,O=-O):(Z=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?W:(null!==d.window&&d.wbits!==O&&(d.window=null),d.wrap=Z,d.wbits=O,t(V))},v=(V,O)=>{if(!V)return W;const Z=new G;V.state=Z,Z.window=null;const d=C(V,O);return d!==i&&(V.state=null),d};let A,l,I=!0;const g=V=>{if(I){A=new Int32Array(512),l=new Int32Array(32);let O=0;for(;O<144;)V.lens[O++]=8;for(;O<256;)V.lens[O++]=9;for(;O<280;)V.lens[O++]=7;for(;O<288;)V.lens[O++]=8;for(Y(1,V.lens,0,288,A,0,V.work,{bits:9}),O=0;O<32;)V.lens[O++]=5;Y(2,V.lens,0,32,l,0,V.work,{bits:5}),I=!1}V.lencode=A,V.lenbits=9,V.distcode=l,V.distbits=5},n=(V,O,Z,d)=>{let p;const r=V.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),d>=r.wsize?(r.window.set(O.subarray(Z-r.wsize,Z),0),r.wnext=0,r.whave=r.wsize):(p=r.wsize-r.wnext,p>d&&(p=d),r.window.set(O.subarray(Z-d,Z-d+p),r.wnext),(d-=p)?(r.window.set(O.subarray(Z-d,Z),0),r.wnext=d,r.whave=r.wsize):(r.wnext+=p,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=p))),0};V.exports.inflateReset=t,V.exports.inflateReset2=C,V.exports.inflateResetKeep=w,V.exports.inflateInit=V=>v(V,15),V.exports.inflateInit2=v,V.exports.inflate=(V,O)=>{let Z,G,w,t,C,v,A,l,I,e,u,k,D,X,o,E,L,J,N,P,f,q,K=0;const s=new Uint8Array(4);let h,x;const y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!V||!V.state||!V.output||!V.input&&0!==V.avail_in)return W;Z=V.state,Z.mode===H&&(Z.mode=13),C=V.next_out,w=V.output,A=V.avail_out,t=V.next_in,G=V.input,v=V.avail_in,l=Z.hold,I=Z.bits,e=v,u=A,q=i;V:for(;;)switch(Z.mode){case 1:if(0===Z.wrap){Z.mode=13;break}for(;I<16;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(2&Z.wrap&&35615===l){Z.check=0,s[0]=255&l,s[1]=l>>>8&255,Z.check=p(Z.check,s,2,0),l=0,I=0,Z.mode=2;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(1&Z.wrap)||(((255&l)<<8)+(l>>8))%31){V.msg="incorrect header check",Z.mode=S;break}if((15&l)!==U){V.msg="unknown compression method",Z.mode=S;break}if(l>>>=4,I-=4,f=8+(15&l),0===Z.wbits)Z.wbits=f;else if(f>Z.wbits){V.msg="invalid window size",Z.mode=S;break}Z.dmax=1<<Z.wbits,V.adler=Z.check=1,Z.mode=512&l?10:H,l=0,I=0;break;case 2:for(;I<16;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(Z.flags=l,(255&Z.flags)!==U){V.msg="unknown compression method",Z.mode=S;break}if(57344&Z.flags){V.msg="unknown header flags set",Z.mode=S;break}Z.head&&(Z.head.text=l>>8&1),512&Z.flags&&(s[0]=255&l,s[1]=l>>>8&255,Z.check=p(Z.check,s,2,0)),l=0,I=0,Z.mode=3;case 3:for(;I<32;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.head&&(Z.head.time=l),512&Z.flags&&(s[0]=255&l,s[1]=l>>>8&255,s[2]=l>>>16&255,s[3]=l>>>24&255,Z.check=p(Z.check,s,4,0)),l=0,I=0,Z.mode=4;case 4:for(;I<16;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.head&&(Z.head.xflags=255&l,Z.head.os=l>>8),512&Z.flags&&(s[0]=255&l,s[1]=l>>>8&255,Z.check=p(Z.check,s,2,0)),l=0,I=0,Z.mode=5;case 5:if(1024&Z.flags){for(;I<16;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.length=l,Z.head&&(Z.head.extra_len=l),512&Z.flags&&(s[0]=255&l,s[1]=l>>>8&255,Z.check=p(Z.check,s,2,0)),l=0,I=0}else Z.head&&(Z.head.extra=null);Z.mode=6;case 6:if(1024&Z.flags&&(k=Z.length,k>v&&(k=v),k&&(Z.head&&(f=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Uint8Array(Z.head.extra_len)),Z.head.extra.set(G.subarray(t,t+k),f)),512&Z.flags&&(Z.check=p(Z.check,G,k,t)),v-=k,t+=k,Z.length-=k),Z.length))break V;Z.length=0,Z.mode=7;case 7:if(2048&Z.flags){if(0===v)break V;k=0;do{f=G[t+k++],Z.head&&f&&Z.length<65536&&(Z.head.name+=String.fromCharCode(f))}while(f&&k<v);if(512&Z.flags&&(Z.check=p(Z.check,G,k,t)),v-=k,t+=k,f)break V}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=8;case 8:if(4096&Z.flags){if(0===v)break V;k=0;do{f=G[t+k++],Z.head&&f&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(f))}while(f&&k<v);if(512&Z.flags&&(Z.check=p(Z.check,G,k,t)),v-=k,t+=k,f)break V}else Z.head&&(Z.head.comment=null);Z.mode=9;case 9:if(512&Z.flags){for(;I<16;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(l!==(65535&Z.check)){V.msg="header crc mismatch",Z.mode=S;break}l=0,I=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),V.adler=Z.check=0,Z.mode=H;break;case 10:for(;I<32;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}V.adler=Z.check=z(l),l=0,I=0,Z.mode=11;case 11:if(0===Z.havedict)return V.next_out=C,V.avail_out=A,V.next_in=t,V.avail_in=v,Z.hold=l,Z.bits=I,c;V.adler=Z.check=1,Z.mode=H;case H:if(O===a||O===R)break V;case 13:if(Z.last){l>>>=7&I,I-=7&I,Z.mode=27;break}for(;I<3;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}switch(Z.last=1&l,l>>>=1,I-=1,3&l){case 0:Z.mode=14;break;case 1:if(g(Z),Z.mode=20,O===R){l>>>=2,I-=2;break V}break;case 2:Z.mode=17;break;case 3:V.msg="invalid block type",Z.mode=S}l>>>=2,I-=2;break;case 14:for(l>>>=7&I,I-=7&I;I<32;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if((65535&l)!==(l>>>16^65535)){V.msg="invalid stored block lengths",Z.mode=S;break}if(Z.length=65535&l,l=0,I=0,Z.mode=15,O===R)break V;case 15:Z.mode=16;case 16:if(k=Z.length,k){if(k>v&&(k=v),k>A&&(k=A),0===k)break V;w.set(G.subarray(t,t+k),C),v-=k,t+=k,A-=k,C+=k,Z.length-=k;break}Z.mode=H;break;case 17:for(;I<14;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(Z.nlen=257+(31&l),l>>>=5,I-=5,Z.ndist=1+(31&l),l>>>=5,I-=5,Z.ncode=4+(15&l),l>>>=4,I-=4,Z.nlen>286||Z.ndist>30){V.msg="too many length or distance symbols",Z.mode=S;break}Z.have=0,Z.mode=18;case 18:for(;Z.have<Z.ncode;){for(;I<3;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.lens[y[Z.have++]]=7&l,l>>>=3,I-=3}for(;Z.have<19;)Z.lens[y[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,h={bits:Z.lenbits},q=Y(0,Z.lens,0,19,Z.lencode,0,Z.work,h),Z.lenbits=h.bits,q){V.msg="invalid code lengths set",Z.mode=S;break}Z.have=0,Z.mode=19;case 19:for(;Z.have<Z.nlen+Z.ndist;){for(;K=Z.lencode[l&(1<<Z.lenbits)-1],o=K>>>24,E=K>>>16&255,L=65535&K,!(o<=I);){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(L<16)l>>>=o,I-=o,Z.lens[Z.have++]=L;else{if(16===L){for(x=o+2;I<x;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(l>>>=o,I-=o,0===Z.have){V.msg="invalid bit length repeat",Z.mode=S;break}f=Z.lens[Z.have-1],k=3+(3&l),l>>>=2,I-=2}else if(17===L){for(x=o+3;I<x;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}l>>>=o,I-=o,f=0,k=3+(7&l),l>>>=3,I-=3}else{for(x=o+7;I<x;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}l>>>=o,I-=o,f=0,k=11+(127&l),l>>>=7,I-=7}if(Z.have+k>Z.nlen+Z.ndist){V.msg="invalid bit length repeat",Z.mode=S;break}for(;k--;)Z.lens[Z.have++]=f}}if(Z.mode===S)break;if(0===Z.lens[256]){V.msg="invalid code -- missing end-of-block",Z.mode=S;break}if(Z.lenbits=9,h={bits:Z.lenbits},q=Y(1,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,h),Z.lenbits=h.bits,q){V.msg="invalid literal/lengths set",Z.mode=S;break}if(Z.distbits=6,Z.distcode=Z.distdyn,h={bits:Z.distbits},q=Y(2,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,h),Z.distbits=h.bits,q){V.msg="invalid distances set",Z.mode=S;break}if(Z.mode=20,O===R)break V;case 20:Z.mode=21;case 21:if(v>=6&&A>=258){V.next_out=C,V.avail_out=A,V.next_in=t,V.avail_in=v,Z.hold=l,Z.bits=I,r(V,u),C=V.next_out,w=V.output,A=V.avail_out,t=V.next_in,G=V.input,v=V.avail_in,l=Z.hold,I=Z.bits,Z.mode===H&&(Z.back=-1);break}for(Z.back=0;K=Z.lencode[l&(1<<Z.lenbits)-1],o=K>>>24,E=K>>>16&255,L=65535&K,!(o<=I);){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(E&&0===(240&E)){for(J=o,N=E,P=L;K=Z.lencode[P+((l&(1<<J+N)-1)>>J)],o=K>>>24,E=K>>>16&255,L=65535&K,!(J+o<=I);){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}l>>>=J,I-=J,Z.back+=J}if(l>>>=o,I-=o,Z.back+=o,Z.length=L,0===E){Z.mode=26;break}if(32&E){Z.back=-1,Z.mode=H;break}if(64&E){V.msg="invalid literal/length code",Z.mode=S;break}Z.extra=15&E,Z.mode=22;case 22:if(Z.extra){for(x=Z.extra;I<x;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.length+=l&(1<<Z.extra)-1,l>>>=Z.extra,I-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=23;case 23:for(;K=Z.distcode[l&(1<<Z.distbits)-1],o=K>>>24,E=K>>>16&255,L=65535&K,!(o<=I);){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(0===(240&E)){for(J=o,N=E,P=L;K=Z.distcode[P+((l&(1<<J+N)-1)>>J)],o=K>>>24,E=K>>>16&255,L=65535&K,!(J+o<=I);){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}l>>>=J,I-=J,Z.back+=J}if(l>>>=o,I-=o,Z.back+=o,64&E){V.msg="invalid distance code",Z.mode=S;break}Z.offset=L,Z.extra=15&E,Z.mode=24;case 24:if(Z.extra){for(x=Z.extra;I<x;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}Z.offset+=l&(1<<Z.extra)-1,l>>>=Z.extra,I-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){V.msg="invalid distance too far back",Z.mode=S;break}Z.mode=25;case 25:if(0===A)break V;if(k=u-A,Z.offset>k){if(k=Z.offset-k,k>Z.whave&&Z.sane){V.msg="invalid distance too far back",Z.mode=S;break}k>Z.wnext?(k-=Z.wnext,D=Z.wsize-k):D=Z.wnext-k,k>Z.length&&(k=Z.length),X=Z.window}else X=w,D=C-Z.offset,k=Z.length;k>A&&(k=A),A-=k,Z.length-=k;do{w[C++]=X[D++]}while(--k);0===Z.length&&(Z.mode=21);break;case 26:if(0===A)break V;w[C++]=Z.length,A--,Z.mode=21;break;case 27:if(Z.wrap){for(;I<32;){if(0===v)break V;v--,l|=G[t++]<<I,I+=8}if(u-=A,V.total_out+=u,Z.total+=u,u&&(V.adler=Z.check=Z.flags?p(Z.check,w,u,C-u):d(Z.check,w,u,C-u)),u=A,(Z.flags?l:z(l))!==Z.check){V.msg="incorrect data check",Z.mode=S;break}l=0,I=0}Z.mode=28;case 28:if(Z.wrap&&Z.flags){for(;I<32;){if(0===v)break V;v--,l+=G[t++]<<I,I+=8}if(l!==(4294967295&Z.total)){V.msg="incorrect length check",Z.mode=S;break}l=0,I=0}Z.mode=29;case 29:q=M;break V;case S:q=F;break V;case 31:return Q;default:return W}return V.next_out=C,V.avail_out=A,V.next_in=t,V.avail_in=v,Z.hold=l,Z.bits=I,(Z.wsize||u!==V.avail_out&&Z.mode<S&&(Z.mode<27||O!==m))&&n(V,V.output,V.next_out,u-V.avail_out)?(Z.mode=31,Q):(e-=V.avail_in,u-=V.avail_out,V.total_in+=e,V.total_out+=u,Z.total+=u,Z.wrap&&u&&(V.adler=Z.check=Z.flags?p(Z.check,w,u,V.next_out-u):d(Z.check,w,u,V.next_out-u)),V.data_type=Z.bits+(Z.last?64:0)+(Z.mode===H?128:0)+(20===Z.mode||15===Z.mode?256:0),(0===e&&0===u||O===m)&&q===i&&(q=b),q)},V.exports.inflateEnd=V=>{if(!V||!V.state)return W;let O=V.state;return O.window&&(O.window=null),V.state=null,i},V.exports.inflateGetHeader=(V,O)=>{if(!V||!V.state)return W;const Z=V.state;return 0===(2&Z.wrap)?W:(Z.head=O,O.done=!1,i)},V.exports.inflateSetDictionary=(V,O)=>{const Z=O.length;let p,r,Y;return V&&V.state?(p=V.state,0!==p.wrap&&11!==p.mode?W:11===p.mode&&(r=1,r=d(r,O,Z,0),r!==p.check)?F:(Y=n(V,O,Z,Z),Y?(p.mode=31,Q):(p.havedict=1,i))):W},V.exports.inflateInfo="pako inflate (from Nodeca project)"},11160:V=>{"use strict";const O=15,Z=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),d=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),p=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),r=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);V.exports=(V,Y,m,a,R,i,M,c)=>{const W=c.bits;let F,Q,b,U,H,S,z=0,G=0,w=0,t=0,C=0,v=0,A=0,l=0,I=0,g=0,n=null,e=0;const u=new Uint16Array(16),k=new Uint16Array(16);let D,X,o,E=null,L=0;for(z=0;z<=O;z++)u[z]=0;for(G=0;G<a;G++)u[Y[m+G]]++;for(C=W,t=O;t>=1&&0===u[t];t--);if(C>t&&(C=t),0===t)return R[i++]=20971520,R[i++]=20971520,c.bits=1,0;for(w=1;w<t&&0===u[w];w++);for(C<w&&(C=w),l=1,z=1;z<=O;z++)if(l<<=1,l-=u[z],l<0)return-1;if(l>0&&(0===V||1!==t))return-1;for(k[1]=0,z=1;z<O;z++)k[z+1]=k[z]+u[z];for(G=0;G<a;G++)0!==Y[m+G]&&(M[k[Y[m+G]]++]=G);if(0===V?(n=E=M,S=19):1===V?(n=Z,e-=257,E=d,L-=257,S=256):(n=p,E=r,S=-1),g=0,G=0,z=w,H=i,v=C,A=0,b=-1,I=1<<C,U=I-1,1===V&&I>852||2===V&&I>592)return 1;for(;;){D=z-A,M[G]<S?(X=0,o=M[G]):M[G]>S?(X=E[L+M[G]],o=n[e+M[G]]):(X=96,o=0),F=1<<z-A,Q=1<<v,w=Q;do{Q-=F,R[H+(g>>A)+Q]=D<<24|X<<16|o}while(0!==Q);for(F=1<<z-1;g&F;)F>>=1;if(0!==F?(g&=F-1,g+=F):g=0,G++,0===--u[z]){if(z===t)break;z=Y[m+M[G]]}if(z>C&&(g&U)!==b){for(0===A&&(A=C),H+=w,v=z-A,l=1<<v;v+A<t&&(l-=u[v+A],!(l<=0));)v++,l<<=1;if(I+=1<<v,1===V&&I>852||2===V&&I>592)return 1;b=g&U,R[b]=C<<24|v<<16|H-i}}return 0!==g&&(R[H+g]=z-A<<24|64<<16),c.bits=C,0}},11107:V=>{"use strict";V.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11081:V=>{"use strict";function O(V){let O=V.length;for(;--O>=0;)V[O]=0}const Z=256,d=286,p=30,r=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),m=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);O(i);const M=new Array(60);O(M);const c=new Array(512);O(c);const W=new Array(256);O(W);const F=new Array(29);O(F);const Q=new Array(p);function b(V,O,Z,d,p){this.static_tree=V,this.extra_bits=O,this.extra_base=Z,this.elems=d,this.max_length=p,this.has_stree=V&&V.length}let U,H,S;function z(V,O){this.dyn_tree=V,this.max_code=0,this.stat_desc=O}O(Q);const G=V=>V<256?c[V]:c[256+(V>>>7)],w=(V,O)=>{V.pending_buf[V.pending++]=255&O,V.pending_buf[V.pending++]=O>>>8&255},t=(V,O,Z)=>{V.bi_valid>16-Z?(V.bi_buf|=O<<V.bi_valid&65535,w(V,V.bi_buf),V.bi_buf=O>>16-V.bi_valid,V.bi_valid+=Z-16):(V.bi_buf|=O<<V.bi_valid&65535,V.bi_valid+=Z)},C=(V,O,Z)=>{t(V,Z[2*O],Z[2*O+1])},v=(V,O)=>{let Z=0;do{Z|=1&V,V>>>=1,Z<<=1}while(--O>0);return Z>>>1},A=(V,O,Z)=>{const d=new Array(16);let p,Y,m=0;for(p=1;p<=r;p++)d[p]=m=m+Z[p-1]<<1;for(Y=0;Y<=O;Y++){let O=V[2*Y+1];0!==O&&(V[2*Y]=v(d[O]++,O))}},l=V=>{let O;for(O=0;O<d;O++)V.dyn_ltree[2*O]=0;for(O=0;O<p;O++)V.dyn_dtree[2*O]=0;for(O=0;O<19;O++)V.bl_tree[2*O]=0;V.dyn_ltree[512]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0},I=V=>{V.bi_valid>8?w(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0},g=(V,O,Z,d)=>{const p=2*O,r=2*Z;return V[p]<V[r]||V[p]===V[r]&&d[O]<=d[Z]},n=(V,O,Z)=>{const d=V.heap[Z];let p=Z<<1;for(;p<=V.heap_len&&(p<V.heap_len&&g(O,V.heap[p+1],V.heap[p],V.depth)&&p++,!g(O,d,V.heap[p],V.depth));)V.heap[Z]=V.heap[p],Z=p,p<<=1;V.heap[Z]=d},e=(V,O,d)=>{let p,r,a,R,i=0;if(0!==V.last_lit)do{p=V.pending_buf[V.d_buf+2*i]<<8|V.pending_buf[V.d_buf+2*i+1],r=V.pending_buf[V.l_buf+i],i++,0===p?C(V,r,O):(a=W[r],C(V,a+Z+1,O),R=Y[a],0!==R&&(r-=F[a],t(V,r,R)),p--,a=G(p),C(V,a,d),R=m[a],0!==R&&(p-=Q[a],t(V,p,R)))}while(i<V.last_lit);C(V,256,O)},u=(V,O)=>{const Z=O.dyn_tree,d=O.stat_desc.static_tree,p=O.stat_desc.has_stree,Y=O.stat_desc.elems;let m,a,R,i=-1;for(V.heap_len=0,V.heap_max=573,m=0;m<Y;m++)0!==Z[2*m]?(V.heap[++V.heap_len]=i=m,V.depth[m]=0):Z[2*m+1]=0;for(;V.heap_len<2;)R=V.heap[++V.heap_len]=i<2?++i:0,Z[2*R]=1,V.depth[R]=0,V.opt_len--,p&&(V.static_len-=d[2*R+1]);for(O.max_code=i,m=V.heap_len>>1;m>=1;m--)n(V,Z,m);R=Y;do{m=V.heap[1],V.heap[1]=V.heap[V.heap_len--],n(V,Z,1),a=V.heap[1],V.heap[--V.heap_max]=m,V.heap[--V.heap_max]=a,Z[2*R]=Z[2*m]+Z[2*a],V.depth[R]=(V.depth[m]>=V.depth[a]?V.depth[m]:V.depth[a])+1,Z[2*m+1]=Z[2*a+1]=R,V.heap[1]=R++,n(V,Z,1)}while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],((V,O)=>{const Z=O.dyn_tree,d=O.max_code,p=O.stat_desc.static_tree,Y=O.stat_desc.has_stree,m=O.stat_desc.extra_bits,a=O.stat_desc.extra_base,R=O.stat_desc.max_length;let i,M,c,W,F,Q,b=0;for(W=0;W<=r;W++)V.bl_count[W]=0;for(Z[2*V.heap[V.heap_max]+1]=0,i=V.heap_max+1;i<573;i++)M=V.heap[i],W=Z[2*Z[2*M+1]+1]+1,W>R&&(W=R,b++),Z[2*M+1]=W,M>d||(V.bl_count[W]++,F=0,M>=a&&(F=m[M-a]),Q=Z[2*M],V.opt_len+=Q*(W+F),Y&&(V.static_len+=Q*(p[2*M+1]+F)));if(0!==b){do{for(W=R-1;0===V.bl_count[W];)W--;V.bl_count[W]--,V.bl_count[W+1]+=2,V.bl_count[R]--,b-=2}while(b>0);for(W=R;0!==W;W--)for(M=V.bl_count[W];0!==M;)c=V.heap[--i],c>d||(Z[2*c+1]!==W&&(V.opt_len+=(W-Z[2*c+1])*Z[2*c],Z[2*c+1]=W),M--)}})(V,O),A(Z,i,V.bl_count)},k=(V,O,Z)=>{let d,p,r=-1,Y=O[1],m=0,a=7,R=4;for(0===Y&&(a=138,R=3),O[2*(Z+1)+1]=65535,d=0;d<=Z;d++)p=Y,Y=O[2*(d+1)+1],++m<a&&p===Y||(m<R?V.bl_tree[2*p]+=m:0!==p?(p!==r&&V.bl_tree[2*p]++,V.bl_tree[32]++):m<=10?V.bl_tree[34]++:V.bl_tree[36]++,m=0,r=p,0===Y?(a=138,R=3):p===Y?(a=6,R=3):(a=7,R=4))},D=(V,O,Z)=>{let d,p,r=-1,Y=O[1],m=0,a=7,R=4;for(0===Y&&(a=138,R=3),d=0;d<=Z;d++)if(p=Y,Y=O[2*(d+1)+1],!(++m<a&&p===Y)){if(m<R)do{C(V,p,V.bl_tree)}while(0!==--m);else 0!==p?(p!==r&&(C(V,p,V.bl_tree),m--),C(V,16,V.bl_tree),t(V,m-3,2)):m<=10?(C(V,17,V.bl_tree),t(V,m-3,3)):(C(V,18,V.bl_tree),t(V,m-11,7));m=0,r=p,0===Y?(a=138,R=3):p===Y?(a=6,R=3):(a=7,R=4)}};let X=!1;const o=(V,O,Z,d)=>{t(V,0+(d?1:0),3),((V,O,Z,d)=>{I(V),d&&(w(V,Z),w(V,~Z)),V.pending_buf.set(V.window.subarray(O,O+Z),V.pending),V.pending+=Z})(V,O,Z,!0)};V.exports._tr_init=V=>{X||((()=>{let V,O,Z,R,z;const G=new Array(16);for(Z=0,R=0;R<28;R++)for(F[R]=Z,V=0;V<1<<Y[R];V++)W[Z++]=R;for(W[Z-1]=R,z=0,R=0;R<16;R++)for(Q[R]=z,V=0;V<1<<m[R];V++)c[z++]=R;for(z>>=7;R<p;R++)for(Q[R]=z<<7,V=0;V<1<<m[R]-7;V++)c[256+z++]=R;for(O=0;O<=r;O++)G[O]=0;for(V=0;V<=143;)i[2*V+1]=8,V++,G[8]++;for(;V<=255;)i[2*V+1]=9,V++,G[9]++;for(;V<=279;)i[2*V+1]=7,V++,G[7]++;for(;V<=287;)i[2*V+1]=8,V++,G[8]++;for(A(i,287,G),V=0;V<p;V++)M[2*V+1]=5,M[2*V]=v(V,5);U=new b(i,Y,257,d,r),H=new b(M,m,0,p,r),S=new b(new Array(0),a,0,19,7)})(),X=!0),V.l_desc=new z(V.dyn_ltree,U),V.d_desc=new z(V.dyn_dtree,H),V.bl_desc=new z(V.bl_tree,S),V.bi_buf=0,V.bi_valid=0,l(V)},V.exports._tr_stored_block=o,V.exports._tr_flush_block=(V,O,d,p)=>{let r,Y,m=0;V.level>0?(2===V.strm.data_type&&(V.strm.data_type=(V=>{let O,d=4093624447;for(O=0;O<=31;O++,d>>>=1)if(1&d&&0!==V.dyn_ltree[2*O])return 0;if(0!==V.dyn_ltree[18]||0!==V.dyn_ltree[20]||0!==V.dyn_ltree[26])return 1;for(O=32;O<Z;O++)if(0!==V.dyn_ltree[2*O])return 1;return 0})(V)),u(V,V.l_desc),u(V,V.d_desc),m=(V=>{let O;for(k(V,V.dyn_ltree,V.l_desc.max_code),k(V,V.dyn_dtree,V.d_desc.max_code),u(V,V.bl_desc),O=18;O>=3&&0===V.bl_tree[2*R[O]+1];O--);return V.opt_len+=3*(O+1)+5+5+4,O})(V),r=V.opt_len+3+7>>>3,Y=V.static_len+3+7>>>3,Y<=r&&(r=Y)):r=Y=d+5,d+4<=r&&-1!==O?o(V,O,d,p):4===V.strategy||Y===r?(t(V,2+(p?1:0),3),e(V,i,M)):(t(V,4+(p?1:0),3),((V,O,Z,d)=>{let p;for(t(V,O-257,5),t(V,Z-1,5),t(V,d-4,4),p=0;p<d;p++)t(V,V.bl_tree[2*R[p]+1],3);D(V,V.dyn_ltree,O-1),D(V,V.dyn_dtree,Z-1)})(V,V.l_desc.max_code+1,V.d_desc.max_code+1,m+1),e(V,V.dyn_ltree,V.dyn_dtree)),l(V),p&&I(V)},V.exports._tr_tally=(V,O,d)=>(V.pending_buf[V.d_buf+2*V.last_lit]=O>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&O,V.pending_buf[V.l_buf+V.last_lit]=255&d,V.last_lit++,0===O?V.dyn_ltree[2*d]++:(V.matches++,O--,V.dyn_ltree[2*(W[d]+Z+1)]++,V.dyn_dtree[2*G(O)]++),V.last_lit===V.lit_bufsize-1),V.exports._tr_align=V=>{t(V,2,3),C(V,256,i),(V=>{16===V.bi_valid?(w(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(V)}},11130:V=>{"use strict";V.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12108:V=>{function O(V,O,Z){for(var d=V.length,p=-1/0,r=1/0,Y=0;Y<d;Y++){var m=(Z[0][Y]-V[Y])/O[Y],a=(Z[1][Y]-V[Y])/O[Y];if(m>a){var R=m;m=a,a=R}if(a<p||m>r)return 1/0;m>p&&(p=m),a<r&&(r=a)}return p>r?1/0:p}V.exports=function(V,Z,d,p){var r=O(Z,d,p);if(r===1/0)V=null;else{V=V||[];for(var Y=0;Y<Z.length;Y++)V[Y]=Z[Y]+d[Y]*r}return V},V.exports.distance=O},12588:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>Y});var d=Z(38);const p=d.useLayoutEffect;const r=function(V){var O=(0,d.useRef)(V);return p((function(){O.current=V})),O};var Y=function(V){var O=r(V);(0,d.useEffect)((function(){var V=function(V){var Z;if(null!=O.current&&(Z=O.current(V)),V.defaultPrevented&&(V.returnValue=""),"string"===typeof Z)return V.returnValue=Z,Z};return window.addEventListener("beforeunload",V),function(){window.removeEventListener("beforeunload",V)}}),[])}},12537:(V,O,Z)=>{"use strict";var d=Z(12546),p=Array.prototype.concat,r=Array.prototype.slice,Y=V.exports=function(V){for(var O=[],Z=0,Y=V.length;Z<Y;Z++){var m=V[Z];d(m)?O=p.call(O,r.call(m)):O.push(m)}return O};Y.wrap=function(V){return function(){return V(Y(arguments))}}},12546:V=>{V.exports=function(V){return!(!V||"string"===typeof V)&&(V instanceof Array||Array.isArray(V)||V.length>=0&&(V.splice instanceof Function||Object.getOwnPropertyDescriptor(V,V.length-1)&&"String"!==V.constructor.name))}},12486:V=>{"use strict";var O=[],Z=[],d=[],p=[],r=[],Y=[],m=[],a=[],R=[],i=[],M=[],c=[];V.exports=function(V,W,F,Q,b,U){for(var H=m,S=R,z=i,G=c,w=0;w<3;w++)H[w]=+F[w],z[w]=+W.max[w],S[w]=+W.base[w];U||(U=1e-10);var t=function(V,m,R,i,c,W){var F=O,Q=Z,b=d,U=p,H=r,S=Y,z=a,G=Math.floor,w=0,t=0,C=0,v=0,A=0;if(l(),0===C)return 0;for(v=n();t<=C;){if(I(v)&&g())return w;v=n()}for(w+=C,A=0;A<3;A++)i[A]+=R[A],c[A]+=R[A];return w;function l(){if(t=0,0!==(C=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2])))for(var V=0;V<3;V++){var O=R[V]>=0;U[V]=O?1:-1;var Z=O?c[V]:i[V];F[V]=O?i[V]:c[V],Q[V]=e(Z,U[V]),b[V]=u(F[V],U[V]),z[V]=R[V]/C,H[V]=Math.abs(1/z[V]);var d=O?Q[V]+1-Z:Z-Q[V];S[V]=H[V]<1/0?H[V]*d:1/0}}function I(O){for(var Z=U[0],d=0===O?Q[0]:b[0],p=Q[0]+Z,r=U[1],Y=1===O?Q[1]:b[1],m=Q[1]+r,a=U[2],R=2===O?Q[2]:b[2],i=Q[2]+a,M=d;M!=p;M+=Z)for(var c=Y;c!=m;c+=r)for(var W=R;W!=i;W+=a)if(V(M,c,W))return!0;return!1}function g(){w+=t;var V=U[v],O=t/C,Z=M;for(A=0;A<3;A++){var d=R[A]*O;i[A]+=d,c[A]+=d,Z[A]=R[A]-d}if(V>0?c[v]=Math.round(c[v]):i[v]=Math.round(i[v]),m(w,v,V,Z))return!0;for(A=0;A<3;A++)R[A]=Z[A];return l(),0===C}function n(){var V=S[0]<S[1]?S[0]<S[2]?0:2:S[1]<S[2]?1:2,O=S[V]-t;for(t=S[V],Q[V]+=U[V],S[V]+=H[V],A=0;A<3;A++)F[A]+=O*z[A],b[A]=u(F[A],U[A]);return V}function e(V,O){return G(V-O*W)}function u(V,O){return G(V+O*W)}}(V,Q,H,S,z,U);if(!b){for(w=0;w<3;w++)G[w]=F[w]>0?z[w]-W.max[w]:S[w]-W.base[w];W.translate(G)}return t}},10859:(V,O,Z)=>{var d=Z(10868);function p(V){for(var O,Z,p=0,r=V.length,Y=0;Y<V.length;){for(O=V[Y],Z=0;Y<r&&V[Y]===O;)++Y,++Z;p+=d.log2(Z)/7|0,p+=d.log2(O>>>0)/7|0,p+=2}return p}O.size=p,O.encode=function(V,O){O||(O=new Uint8Array(p(V)));for(var Z,d,r=0,Y=O.length,m=0;m<V.length;){for(Z=V[m],d=0;m<V.length&&V[m]===Z;)++m,++d;for(;r<Y&&d>=128;)O[r++]=128+(127&d),d>>>=7;if(r>=Y)throw new Error("RLE buffer overflow");for(O[r++]=d,Z>>>=0;r<Y&&Z>=128;)O[r++]=128+(127&Z),Z>>>=7;if(r>=Y)throw new Error("RLE buffer overflow");O[r++]=Z}return O},O.decode=function(V,O){for(var Z,d,p,r,Y=O.length,m=V.length,a=0,R=0;R<m;){for(Z=0,d=0;R<m&&V[R]>=128;)Z+=(127&V[R++])<<d,d+=7;if(Z+=V[R++]<<d,R>=m)throw new Error("RLE buffer underrun");if(a+Z>Y)throw new Error("Chunk buffer overflow");for(p=0,d=0;R<m&&V[R]>=128;)p+=(127&V[R++])<<d,d+=7;if(R>=m)throw new Error("RLE buffer underrun");for(p+=V[R++]<<d,r=0;r<Z;++r)O[a++]=p}return O}},10868:(V,O)=>{"use strict";function Z(V){var O=32;return(V&=-V)&&O--,65535&V&&(O-=16),16711935&V&&(O-=8),252645135&V&&(O-=4),858993459&V&&(O-=2),1431655765&V&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(V){return(V>0)-(V<0)},O.abs=function(V){var O=V>>31;return(V^O)-O},O.min=function(V,O){return O^(V^O)&-(V<O)},O.max=function(V,O){return V^(V^O)&-(V<O)},O.isPow2=function(V){return!(V&V-1)&&!!V},O.log2=function(V){var O,Z;return O=(V>65535)<<4,O|=Z=((V>>>=O)>255)<<3,O|=Z=((V>>>=Z)>15)<<2,(O|=Z=((V>>>=Z)>3)<<1)|(V>>>=Z)>>1},O.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},O.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},O.countTrailingZeros=Z,O.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},O.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},O.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var d=new Array(256);!function(V){for(var O=0;O<256;++O){var Z=O,d=O,p=7;for(Z>>>=1;Z;Z>>>=1)d<<=1,d|=1&Z,--p;V[O]=d<<p&255}}(d),O.reverse=function(V){return d[255&V]<<24|d[V>>>8&255]<<16|d[V>>>16&255]<<8|d[V>>>24&255]},O.interleave2=function(V,O){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(V,O){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>O&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},O.interleave3=function(V,O,Z){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},O.deinterleave3=function(V,O){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>O&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},O.nextCombination=function(V){var O=V|V-1;return O+1|(~O&-~O)-1>>>Z(V)+1}},12655:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>M});var d=Z(12481),p=Z(141);class r{constructor(V,O,Z,r,Y,m,a){this.fg=new d(V.base,V.Eg),this.mass=O,this.friction=Z,this.restitution=r,this.tc=Y,this.yk=m,this.wc=!!a,this.Dg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ll=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.df=p.create(),this.ag=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=p.create(),this._impulses=p.create(),this._sleepFrameCount=10}loadFromCopy(V){p.j(this.fg.base,V.fg.base),p.j(this.fg.Eg,V.fg.Eg),p.j(this.fg.max,V.fg.max),this.fg.mag=V.fg.mag,this.mass=V.mass,this.friction=V.friction,this.restitution=V.restitution,this.tc=V.tc,this.yk=V.yk,this.wc=V.wc,this.Dg=V.Dg,this.fluidDrag=V.fluidDrag,this.ll=V.ll,this.preventFallOffEdge=V.preventFallOffEdge,this.rolledBackLastTick=V.rolledBackLastTick,p.j(this.df,V.df),p.j(this.ag,V.ag),this.inFluid=V.inFluid,this._ratioInFluid=V._ratioInFluid,p.j(this._forces,V._forces),p.j(this._impulses,V._impulses),this._sleepFrameCount=V._sleepFrameCount}setPosition(V){Y(V),p.fc(V,V,this.fg.base),this.fg.translate(V),this.if()}fb(){return p.clone(this.fg.base)}applyForce(V){Y(V),p.add(this._forces,this._forces,V),this.if()}applyImpulse(V){Y(V),p.add(this._impulses,this._impulses,V),this.if()}if(){this._sleepFrameCount=10}atRestX(){return this.ag[0]}atRestY(){return this.ag[1]}atRestZ(){return this.ag[2]}}var Y=V=>{};var m=Z(12481),a=Z(141),R=Z(12486);function i(){this.Dg=.1,this.fluidDrag=.4,this.Oc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function M(V,O,Z){V=Object.assign(new i,V),this.gravity=V.gravity||[0,-10,0],this.Dg=V.Dg||.1,this.Oc=V.Oc||2,this.fluidDrag=V.fluidDrag||.4,this.minBounceImpulse=V.minBounceImpulse,this.bodies=[],this.Vj=V.Vj,this.testSolid=O,this.testFluid=Z}M.prototype.Fk=function(V,O,Z,d,p,Y){V=V||new m([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof Z&&(Z=1),"undefined"==typeof d&&(d=0),"undefined"==typeof p&&(p=1);var a=new r(V,O,Z,d,p,Y);return this.bodies.push(a),a},M.prototype.Gk=function(V){var O=this.bodies.indexOf(V);O<0||(this.bodies.splice(O,1),V.fg=V.yk=null)};var c=a.create(),W=a.create(),F=a.create(),Q=a.create(),b=a.create(),U=a.create(),H=a.create(),S=new m([0,0,0],[1,1,1]),z=new r(S,1,1,0,1,(()=>{}),!1);function G(V,O,Z){return O=Z,O*=1-(1-V.ratioInFluid)**2}M.prototype.vd=function(V){V/=1e3;var O=E(0,a.squaredLength(this.gravity));this.bodies.forEach((Z=>function(V,O,Z,d){a.j(b,O.ag),V.Vj&&z.loadFromCopy(O);if(O.mass<=0)return a.set(O.df,0,0,0),a.set(O._forces,0,0,0),void a.set(O._impulses,0,0,0);var p=d||0===O.tc;if(function(V,O,Z,d){if(O._sleepFrameCount>0)return!1;if(d)return!0;var p=!1,r=.5*Z*Z*O.tc;return a.scale(o,V.gravity,r),R(V.testSolid,O.fg,o,(function(){return p=!0,!0}),!0),p}(V,O,Z,p))return;O._sleepFrameCount--,function(V,O){var Z=O.fg,d=Math.floor(Z.base[0]),p=Math.floor(Z.base[2]),r=Math.floor(Z.base[1]),Y=Math.floor(Z.max[1]);if(!V.testFluid(d,r,p))return O.inFluid=!1,void(O.ratioInFluid=0);var m=1,R=r+1;for(;R<=Y&&V.testFluid(d,R,p);)m++,R++;var i=(r+m-Z.base[1])/Z.Eg[1];i>1&&(i=1);var M=Z.Eg[0]*Z.Eg[1]*Z.Eg[2]*i,c=t;a.scale(c,V.gravity,-V.Oc*M*O.tc),O.applyForce(c),O.inFluid=!0,O.ratioInFluid=i}(V,O),J(O._forces),J(O._impulses),J(O.df),J(O.ag),a.scale(c,O._forces,1/O.mass),a.jd(c,c,V.gravity,O.tc),a.scale(W,O._impulses,1/O.mass),a.jd(W,W,c,Z),a.add(O.df,O.df,W),O.friction&&(C(V,0,O,W,Z),C(V,1,O,W,Z),C(V,2,O,W,Z));var r=O.fluidDrag>=0?O.fluidDrag:V.fluidDrag,Y=O.Dg>=0?O.Dg:V.Dg,m=Y,i=Y;O.inFluid&&(m=G(O,m,O.fluidDragHoriz>=0?O.fluidDragHoriz:r),i=G(O,i,O.fluidDragVert>=0?O.fluidDragVert:r));m=Math.max(1-m*Z/O.mass,0),i=Math.max(1-i*Z/O.mass,0),a.set(w,m,i,m),a.multiply(O.df,O.df,w),a.scale(F,O.df,Z),a.set(O._forces,0,0,0),a.set(O._impulses,0,0,0),O.wc&&L(l,O.fg);a.j(U,F),a.set(H,0,0,0),O.preventFallOffEdge&&function(V,O,Z,d){if(!O.ag[1]||Z[1]>0)return;var p=k;L(p,O.fg);for(var r=0;r<3;r+=2){a.set(u,0,0,0),u[r]=Z[r];var Y=!0;(Y=(Y=(Y=(Y=Y&&!X(V,p.base[0]+u[0]+1e-5,p.base[1],p.base[2]+u[2]+1e-5))&&!X(V,p.max[0]+u[0]-1e-5,p.base[1],p.base[2]+u[2]+1e-5))&&!X(V,p.base[0]+u[0]+1e-5,p.base[1],p.max[2]+u[2]-1e-5))&&!X(V,p.max[0]+u[0]-1e-5,p.base[1],p.max[2]+u[2]-1e-5))?(d[r]=Z[r]>0?1:-1,Z[r]=0):0===r&&(a.set(D,Z[0],0,0),A(V,p,D,d,O.slideOnCollision))}}(V,O,F,H);A(V,O.fg,F,O.ag,O.slideOnCollision),O.wc&&function(V,O,Z,d){if(O.ag[1]>=0&&!O.inFluid)return;var p=0!==O.ag[0],r=0!==O.ag[2];if(!p&&!r)return;var Y=Math.abs(d[0]/d[2]),m=4;if(!p&&Y>m)return;if(!r&&Y<1/m)return;a.add(g,Z.base,d);var i=V.testSolid;R(i,Z,d,(function(V,O,Z,d){if(1!==O)return!0;d[O]=0}));var M=Z.base[1],c=O.inFluid?1.951:1.001,W=Math.floor(M+c)-M;a.set(n,0,W,0);var F=!1;if(R(i,Z,n,(function(V,O,Z,d){return F=!0,!0})),F)return;a.fc(e,g,Z.base),e[1]=0,A(V,Z,e,I,!0);var Q=E(Z.base[0],g[0]),b=E(Z.base[2],g[2]);if(p&&!Q&&(!b||!r))return;if(r&&(!Q||!p)&&!b)return;var U=!0;if(U=U&&!X(V,Z.base[0]+1e-5,Z.base[1],Z.base[2]+1e-5),U=U&&!X(V,Z.max[0]-1e-5,Z.base[1],Z.base[2]+1e-5),U=U&&!X(V,Z.base[0]+1e-5,Z.base[1],Z.max[2]-1e-5),U=U&&!X(V,Z.max[0]-1e-5,Z.base[1],Z.max[2]-1e-5),U)return;L(O.fg,Z),O.ag[0]=I[0],O.ag[2]=I[2],O.ll&&O.ll()}(V,O,l,U);for(var M=0;M<3;++M)O.ag[M]=O.ag[M]||H[M],Q[M]=0,O.ag[M]&&(b[M]||(Q[M]=-O.df[M]),O.df[M]=0);var S=a.length(Q);S>.001&&(a.scale(Q,Q,O.mass),O.yk&&O.yk(Q),O.restitution>0&&S>V.minBounceImpulse&&(a.scale(Q,Q,O.restitution),O.applyImpulse(Q)));var v=a.squaredLength(O.df);v>1e-5&&O.if();V.Vj&&V.Vj(O)?(O.loadFromCopy(z),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,Z,V,O)))};var w=a.create([0,0,0]);var t=a.create();function C(V,O,Z,d,p){var r=Z.ag[O],Y=d[O];if(!Z.alwaysApplyHorizFriction||1!==O){if(0===r)return;if(r*Y<=0)return}a.j(v,Z.df),v[O]=0;var m=a.length(v);if(!E(m,0)){var R=Math.abs(Z.friction*V.gravity[O]*p),i=m>R?(m-R)/m:0;Z.df[(O+1)%3]*=i,Z.df[(O+2)%3]*=i}}var v=a.create();function A(V,O,Z,d,p){return a.set(d,0,0,0),R(V.testSolid,O,Z,(function(V,O,Z,r){d[O]=Z,r[O]=0,p||(r[0]=0,r[1]=0,r[2]=0)}))}var l=new m([],[]),I=a.create(),g=a.create(),n=a.create(),e=a.create();var u=a.create(),k=new m([],[]),D=a.create();function X(V,O,Z,d){return V.testSolid(Math.floor(O),Math.floor(Z-1),Math.floor(d))}var o=a.create();function E(V,O){return Math.abs(V-O)<1e-5}function L(V,O){for(var Z=0;Z<3;Z++)V.base[Z]=O.base[Z],V.max[Z]=O.max[Z],V.Eg[Z]=O.Eg[Z]}var J=function(V){}},11060:V=>{"use strict";V.exports=function(V,O,Z,d){var p=self||window;try{try{var r;try{r=new p.Blob([V])}catch(R){(r=new(p.BlobBuilder||p.WebKitBlobBuilder||p.MozBlobBuilder||p.MSBlobBuilder)).append(V),r=r.getBlob()}var Y=p.URL||p.webkitURL,m=Y.createObjectURL(r),a=new p[O](m,Z);return Y.revokeObjectURL(m),a}catch(R){return new p[O]("data:application/javascript,".concat(encodeURIComponent(V)),Z)}}catch(R){if(!d)throw Error("Inline worker is not supported");return new p[O](d,Z)}}},12094:(V,O,Z)=>{"use strict";function d(V,O,Z,d,p){var r={};return Object.keys(d).forEach((function(V){r[V]=d[V]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=Z.slice().reverse().reduce((function(Z,d){return d(V,O,Z)||Z}),r),p&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(p):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(V,O,r),r=null),r}Z.d(O,{c:()=>d})},12089:(V,O,Z)=>{"use strict";function d(V,O,Z,d){Z&&Object.defineProperty(V,O,{enumerable:Z.enumerable,configurable:Z.configurable,writable:Z.writable,value:Z.initializer?Z.initializer.call(d):void 0})}Z.d(O,{e:()=>d})},12154:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>S,g:()=>b,j:()=>U,n:()=>c,r:()=>Q,u:()=>F,w:()=>W});var d=Z(11251),p=Z(11274),r=Z(11263),Y=Z(11041),m=Z(12163),a=Z(11521),R=Z(11474),i=Z(10933),M=Z(11283);const c=Object.freeze(new d.g(0,0,0,0)),W=Object.freeze(d.m.Zero()),F=Object.freeze(d.l.Zero()),Q=Object.freeze(R.c.Zero()),b=Object.freeze(p.b.Black()),U=Object.freeze(new p.f(0,0,0,0)),H={key:0,repeatCount:0,loopMode:2};class S{static _PrepareAnimation(V,O,Z,r,Y,m,a,i){let M;if(!isNaN(parseFloat(Y))&&isFinite(Y)?M=S.ANIMATIONTYPE_FLOAT:Y instanceof d.g?M=S.ANIMATIONTYPE_QUATERNION:Y instanceof d.m?M=S.ANIMATIONTYPE_VECTOR3:Y instanceof d.l?M=S.ANIMATIONTYPE_VECTOR2:Y instanceof p.b?M=S.ANIMATIONTYPE_COLOR3:Y instanceof p.f?M=S.ANIMATIONTYPE_COLOR4:Y instanceof R.c&&(M=S.ANIMATIONTYPE_SIZE),void 0==M)return null;const c=new S(V,O,Z,M,a),W=[{frame:0,value:Y},{frame:r,value:m}];return c.setKeys(W),void 0!==i&&c.setEasingFunction(i),c}static CreateAnimation(V,O,Z,d){const p=new S(V+"Animation",V,Z,O,S.ANIMATIONLOOPMODE_CONSTANT);return p.setEasingFunction(d),p}static CreateAndStartAnimation(V,O,Z,d,p,r,Y,m,a,R,i){const M=S._PrepareAnimation(V,Z,d,p,r,Y,m,a);return M?(O.va&&(i=O.va()),i?i.beginDirectAnimation(O,[M],0,p,1===M.loopMode,1,R):null):null}static CreateAndStartHierarchyAnimation(V,O,Z,d,p,r,Y,m,a,R,i){const M=S._PrepareAnimation(V,d,p,r,Y,m,a,R);if(!M)return null;return O.va().beginDirectHierarchyAnimation(O,Z,[M],0,r,1===M.loopMode,1,i)}static CreateMergeAndStartAnimation(V,O,Z,d,p,r,Y,m,a,R){const i=S._PrepareAnimation(V,Z,d,p,r,Y,m,a);return i?(O.animations.push(i),O.va().beginAnimation(O,0,p,1===i.loopMode,1,R)):null}static MakeAnimationAdditive(V,O,Z){let p;p="object"===typeof O?O:{referenceFrame:O??0,range:Z,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let r=V;if(p.cloneOriginalAnimation&&(r=V.clone(),r.name=p.clonedAnimationName||r.name),!r._keys.length)return r;const Y=p.referenceFrame&&p.referenceFrame>=0?p.referenceFrame:0;let m=0;const a=r._keys[0];let R=r._keys.length-1;const i=r._keys[R],M={referenceValue:a.value,referencePosition:d.i.ib[0],referenceQuaternion:d.i.Quaternion[0],referenceScaling:d.i.ib[1],keyPosition:d.i.ib[2],keyQuaternion:d.i.Quaternion[1],keyScaling:d.i.ib[3]};let c=a.frame,W=i.frame;if(p.range){const V=r.getRange(p.range);V&&(c=V.from,W=V.to)}else c=p.fromFrame??c,W=p.toFrame??W;if(c!==a.frame&&(m=r.createKeyForFrame(c)),W!==i.frame&&(R=r.createKeyForFrame(W)),1===r._keys.length){const V=r._getKeyValue(r._keys[0]);M.referenceValue=V.clone?V.clone():V}else if(Y<=a.frame){const V=r._getKeyValue(a.value);M.referenceValue=V.clone?V.clone():V}else if(Y>=i.frame){const V=r._getKeyValue(i.value);M.referenceValue=V.clone?V.clone():V}else{H.key=0;const V=r._interpolate(Y,H);M.referenceValue=V.clone?V.clone():V}r.dataType===S.ANIMATIONTYPE_QUATERNION?M.referenceValue.normalize().conjugateInPlace():r.dataType===S.ANIMATIONTYPE_MATRIX&&(M.referenceValue.decompose(M.referenceScaling,M.referenceQuaternion,M.referencePosition),M.referenceQuaternion.normalize().conjugateInPlace());let F=Number.MAX_VALUE;const Q=p.clipKeys?[]:null;for(let b=m;b<=R;b++){let V=r._keys[b];if((Q||p.cloneOriginalAnimation)&&(V={frame:V.frame,value:V.value.clone?V.value.clone():V.value,inTangent:V.inTangent,outTangent:V.outTangent,interpolation:V.interpolation,lockedTangent:V.lockedTangent},Q&&(F===Number.MAX_VALUE&&(F=V.frame),V.frame-=F,Q.push(V))),!b||r.dataType===S.ANIMATIONTYPE_FLOAT||V.value!==a.value)switch(r.dataType){case S.ANIMATIONTYPE_MATRIX:V.value.decompose(M.keyScaling,M.keyQuaternion,M.keyPosition),M.keyPosition.bi(M.referencePosition),M.keyScaling.divideInPlace(M.referenceScaling),M.referenceQuaternion.multiplyToRef(M.keyQuaternion,M.keyQuaternion),d.c.ComposeToRef(M.keyScaling,M.keyQuaternion,M.keyPosition,V.value);break;case S.ANIMATIONTYPE_QUATERNION:M.referenceValue.multiplyToRef(V.value,V.value);break;case S.ANIMATIONTYPE_VECTOR2:case S.ANIMATIONTYPE_VECTOR3:case S.ANIMATIONTYPE_COLOR3:case S.ANIMATIONTYPE_COLOR4:V.value.subtractToRef(M.referenceValue,V.value);break;case S.ANIMATIONTYPE_SIZE:V.value.width-=M.referenceValue.width,V.value.height-=M.referenceValue.height;break;default:V.value-=M.referenceValue}}return Q&&r.setKeys(Q,!0),r}static TransitionTo(V,O,Z,d,p,r,Y){let m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(Y<=0)return Z[V]=O,m&&m(),null;const a=p*(Y/1e3);r.setKeys([{frame:0,value:Z[V].clone?Z[V].clone():Z[V]},{frame:a,value:O}]),Z.animations||(Z.animations=[]),Z.animations.push(r);const R=d.beginAnimation(Z,0,a,!1);return R.onAnimationEnd=m,R}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const V of this._runtimeAnimations)if(!V.isStopped())return!0;return!1}constructor(V,O,Z,d,p,r){this.name=V,this.targetProperty=O,this.framePerSecond=Z,this.dataType=d,this.loopMode=p,this.enableBlending=r,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=O.split("."),this.dataType=d,this.loopMode=void 0===p?S.ANIMATIONLOOPMODE_CYCLE:p,this.uniqueId=S._UniqueIdGenerator++}toString(V){let O="Name: "+this.name+", property: "+this.targetProperty;if(O+=", datatype: "+["Float","ib","Quaternion","Matrix","jb","Vector2"][this.dataType],O+=", nKeys: "+(this._keys?this._keys.length:"none"),O+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),V){O+=", Ranges: {";let V=!0;for(const Z in this._ranges)V&&(O+=", ",V=!1),O+=Z;O+="}"}return O}addEvent(V){this._events.push(V),this._events.sort(((V,O)=>V.frame-O.frame))}removeEvents(V){for(let O=0;O<this._events.length;O++)this._events[O].frame===V&&(this._events.splice(O,1),O--)}getEvents(){return this._events}createRange(V,O,Z){this._ranges[V]||(this._ranges[V]=new m.d(V,O,Z))}deleteRange(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=this._ranges[V];if(Z){if(O){const V=Z.from,O=Z.to;for(let Z=this._keys.length-1;Z>=0;Z--)this._keys[Z].frame>=V&&this._keys[Z].frame<=O&&this._keys.splice(Z,1)}this._ranges[V]=null}}getRange(V){return this._ranges[V]}getKeys(){return this._keys}getHighestFrame(){let V=0;for(let O=0,Z=this._keys.length;O<Z;O++)V<this._keys[O].frame&&(V=this._keys[O].frame);return V}getEasingFunction(){return this._easingFunction}setEasingFunction(V){this._easingFunction=V}floatInterpolateFunction(V,O,Z){return(0,r.m)(V,O,Z)}floatInterpolateFunctionWithTangents(V,O,Z,d,p){return(0,r.e)(V,O,Z,d,p)}quaternionInterpolateFunction(V,O,Z){return d.g.Slerp(V,O,Z)}quaternionInterpolateFunctionWithTangents(V,O,Z,p,r){return d.g.Hermite(V,O,Z,p,r).normalize()}vector3InterpolateFunction(V,O,Z){return d.m.Lerp(V,O,Z)}vector3InterpolateFunctionWithTangents(V,O,Z,p,r){return d.m.Hermite(V,O,Z,p,r)}vector2InterpolateFunction(V,O,Z){return d.l.Lerp(V,O,Z)}vector2InterpolateFunctionWithTangents(V,O,Z,p,r){return d.l.Hermite(V,O,Z,p,r)}sizeInterpolateFunction(V,O,Z){return R.c.Lerp(V,O,Z)}color3InterpolateFunction(V,O,Z){return p.b.Lerp(V,O,Z)}color3InterpolateFunctionWithTangents(V,O,Z,d,r){return p.b.Hermite(V,O,Z,d,r)}color4InterpolateFunction(V,O,Z){return p.f.Lerp(V,O,Z)}color4InterpolateFunctionWithTangents(V,O,Z,d,r){return p.f.Hermite(V,O,Z,d,r)}_getKeyValue(V){return"function"===typeof V?V():V}evaluate(V){return H.key=0,this._interpolate(V,H)}_interpolate(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(O.loopMode===S.ANIMATIONLOOPMODE_CONSTANT&&O.repeatCount>0)return O.highLimitValue.clone?O.highLimitValue.clone():O.highLimitValue;const d=this._keys,p=d.length;let r=O.key;for(;r>=0&&V<d[r].frame;)--r;for(;r+1<=p-1&&V>=d[r+1].frame;)++r;if(O.key=r,r<0)return Z?void 0:this._getKeyValue(d[0].value);if(r+1>p-1)return Z?void 0:this._getKeyValue(d[p-1].value);const Y=d[r],m=d[r+1];if(Z&&(V===Y.frame||V===m.frame))return;const a=this._getKeyValue(Y.value),R=this._getKeyValue(m.value);if(1===Y.interpolation)return m.frame>V?a:R;const i=void 0!==Y.outTangent&&void 0!==m.inTangent,M=m.frame-Y.frame;let H=(V-Y.frame)/M;const z=Y.easingFunction||this.getEasingFunction();switch(null!==z&&(H=z.ease(H)),this.dataType){case S.ANIMATIONTYPE_FLOAT:{const V=i?this.floatInterpolateFunctionWithTangents(a,Y.outTangent*M,R,m.inTangent*M,H):this.floatInterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(O.offsetValue??0)*O.repeatCount+V}break}case S.ANIMATIONTYPE_QUATERNION:{const V=i?this.quaternionInterpolateFunctionWithTangents(a,Y.outTangent.scale(M),R,m.inTangent.scale(M),H):this.quaternionInterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.addInPlace((O.offsetValue||c).scale(O.repeatCount))}return V}case S.ANIMATIONTYPE_VECTOR3:{const V=i?this.vector3InterpolateFunctionWithTangents(a,Y.outTangent.scale(M),R,m.inTangent.scale(M),H):this.vector3InterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((O.offsetValue||W).scale(O.repeatCount))}break}case S.ANIMATIONTYPE_VECTOR2:{const V=i?this.vector2InterpolateFunctionWithTangents(a,Y.outTangent.scale(M),R,m.inTangent.scale(M),H):this.vector2InterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((O.offsetValue||F).scale(O.repeatCount))}break}case S.ANIMATIONTYPE_SIZE:switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(a,R,H);case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(a,R,H).add((O.offsetValue||Q).scale(O.repeatCount))}break;case S.ANIMATIONTYPE_COLOR3:{const V=i?this.color3InterpolateFunctionWithTangents(a,Y.outTangent.scale(M),R,m.inTangent.scale(M),H):this.color3InterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((O.offsetValue||b).scale(O.repeatCount))}break}case S.ANIMATIONTYPE_COLOR4:{const V=i?this.color4InterpolateFunctionWithTangents(a,Y.outTangent.scale(M),R,m.inTangent.scale(M),H):this.color4InterpolateFunction(a,R,H);switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return V;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((O.offsetValue||U).scale(O.repeatCount))}break}case S.ANIMATIONTYPE_MATRIX:switch(O.loopMode){case S.ANIMATIONLOOPMODE_CYCLE:case S.ANIMATIONLOOPMODE_CONSTANT:case S.ANIMATIONLOOPMODE_YOYO:return S.AllowMatricesInterpolation?this.matrixInterpolateFunction(a,R,H,O.workValue):a;case S.ANIMATIONLOOPMODE_RELATIVE:case S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a}}return 0}matrixInterpolateFunction(V,O,Z,p){return S.AllowMatrixDecomposeForInterpolation?p?(d.c.DecomposeLerpToRef(V,O,Z,p),p):d.c.DecomposeLerp(V,O,Z):p?(d.c.LerpToRef(V,O,Z,p),p):d.c.Lerp(V,O,Z)}clone(){const V=new S(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed,this._keys&&V.setKeys(this._keys),this._ranges){V._ranges={};for(const O in this._ranges){const Z=this._ranges[O];Z&&(V._ranges[O]=Z.clone())}}return V}setKeys(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=O?V:V.slice(0)}createKeyForFrame(V){H.key=0;const O=this._interpolate(V,H,!0);if(!O)return this._keys[H.key].frame===V?H.key:H.key+1;const Z={frame:V,value:O.clone?O.clone():O};return this._keys.splice(H.key+1,0,Z),H.key+1}serialize(){const V={};V.name=this.name,V.property=this.targetProperty,V.framePerSecond=this.framePerSecond,V.dataType=this.dataType,V.loopBehavior=this.loopMode,V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed;const O=this.dataType;V.keys=[];const Z=this.getKeys();for(let d=0;d<Z.length;d++){const p=Z[d],r={};switch(r.frame=p.frame,O){case S.ANIMATIONTYPE_FLOAT:r.values=[p.value],void 0!==p.inTangent&&r.values.push(p.inTangent),void 0!==p.outTangent&&(void 0===p.inTangent&&r.values.push(void 0),r.values.push(p.outTangent)),void 0!==p.interpolation&&(void 0===p.inTangent&&r.values.push(void 0),void 0===p.outTangent&&r.values.push(void 0),r.values.push(p.interpolation));break;case S.ANIMATIONTYPE_QUATERNION:case S.ANIMATIONTYPE_MATRIX:case S.ANIMATIONTYPE_VECTOR3:case S.ANIMATIONTYPE_COLOR3:case S.ANIMATIONTYPE_COLOR4:r.values=p.value.Wi(),void 0!=p.inTangent&&r.values.push(p.inTangent.Wi()),void 0!=p.outTangent&&(void 0===p.inTangent&&r.values.push(void 0),r.values.push(p.outTangent.Wi())),void 0!==p.interpolation&&(void 0===p.inTangent&&r.values.push(void 0),void 0===p.outTangent&&r.values.push(void 0),r.values.push(p.interpolation))}V.keys.push(r)}V.ranges=[];for(const d in this._ranges){const O=this._ranges[d];if(!O)continue;const Z={};Z.name=d,Z.from=O.from,Z.to=O.to,V.ranges.push(Z)}return V}static _UniversalLerp(V,O,Z){const d=V.constructor;return d.Lerp?d.Lerp(V,O,Z):d.Slerp?d.Slerp(V,O,Z):V.toFixed?V*(1-Z)+Z*O:O}static Parse(V){const O=new S(V.name,V.property,V.framePerSecond,V.dataType,V.loopBehavior),Z=V.dataType,r=[];let Y,m;for(V.enableBlending&&(O.enableBlending=V.enableBlending),V.blendingSpeed&&(O.blendingSpeed=V.blendingSpeed),m=0;m<V.keys.length;m++){const O=V.keys[m];let a,R,i;switch(Z){case S.ANIMATIONTYPE_FLOAT:Y=O.values[0],O.values.length>=2&&(a=O.values[1]),O.values.length>=3&&(R=O.values[2]),O.values.length>=4&&(i=O.values[3]);break;case S.ANIMATIONTYPE_QUATERNION:if(Y=d.g.Cg(O.values),O.values.length>=8){const V=d.g.Cg(O.values.slice(4,8));V.equals(d.g.Zero())||(a=V)}if(O.values.length>=12){const V=d.g.Cg(O.values.slice(8,12));V.equals(d.g.Zero())||(R=V)}O.values.length>=13&&(i=O.values[12]);break;case S.ANIMATIONTYPE_MATRIX:Y=d.c.Cg(O.values),O.values.length>=17&&(i=O.values[16]);break;case S.ANIMATIONTYPE_COLOR3:Y=p.b.Cg(O.values),O.values[3]&&(a=p.b.Cg(O.values[3])),O.values[4]&&(R=p.b.Cg(O.values[4])),O.values[5]&&(i=O.values[5]);break;case S.ANIMATIONTYPE_COLOR4:Y=p.f.Cg(O.values),O.values[4]&&(a=p.f.Cg(O.values[4])),O.values[5]&&(R=p.f.Cg(O.values[5])),O.values[6]&&(i=p.f.Cg(O.values[6]));break;case S.ANIMATIONTYPE_VECTOR3:default:Y=d.m.Cg(O.values),O.values[3]&&(a=d.m.Cg(O.values[3])),O.values[4]&&(R=d.m.Cg(O.values[4])),O.values[5]&&(i=O.values[5])}const M={};M.frame=O.frame,M.value=Y,void 0!=a&&(M.inTangent=a),void 0!=R&&(M.outTangent=R),void 0!=i&&(M.interpolation=i),r.push(M)}if(O.setKeys(r),V.ranges)for(m=0;m<V.ranges.length;m++)Y=V.ranges[m],O.createRange(Y.name,Y.from,Y.to);return O}static AppendSerializedAnimations(V,O){M.b.AppendSerializedAnimations(V,O)}static ParseFromFileAsync(V,O){return new Promise(((Z,d)=>{const p=new i.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){let O=JSON.parse(p.responseText);if(O.animations&&(O=O.animations),O.length){const V=[];for(const Z of O)V.push(this.Parse(Z));Z(V)}else{const d=this.Parse(O);V&&(d.name=V),Z(d)}}else d("Unable to load the animation")})),p.open("GET",O),p.send()}))}static ParseFromSnippetAsync(V){return new Promise(((O,Z)=>{const d=new i.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const Z=JSON.parse(JSON.parse(d.responseText).jsonPayload);if(Z.animations){const d=JSON.parse(Z.animations),p=[];for(const O of d.animations){const Z=this.Parse(O);Z.snippetId=V,p.push(Z)}O(p)}else{const d=JSON.parse(Z.animation),p=this.Parse(d);p.snippetId=V,O(p)}}else Z("Unable to load the snippet "+V)})),d.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),d.send()}))}}S._UniqueIdGenerator=0,S.AllowMatricesInterpolation=!1,S.AllowMatrixDecomposeForInterpolation=!0,S.SnippetUrl="https://snippet.babylonjs.com",S.ANIMATIONTYPE_FLOAT=0,S.ANIMATIONTYPE_VECTOR3=1,S.ANIMATIONTYPE_QUATERNION=2,S.ANIMATIONTYPE_MATRIX=3,S.ANIMATIONTYPE_COLOR3=4,S.ANIMATIONTYPE_COLOR4=7,S.ANIMATIONTYPE_VECTOR2=5,S.ANIMATIONTYPE_SIZE=6,S.ANIMATIONLOOPMODE_RELATIVE=0,S.ANIMATIONLOOPMODE_CYCLE=1,S.ANIMATIONLOOPMODE_CONSTANT=2,S.ANIMATIONLOOPMODE_YOYO=4,S.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,S.CreateFromSnippetAsync=S.ParseFromSnippetAsync,(0,Y.f)("BABYLON.Animation",S),a.e._AnimationRangeFactory=(V,O,Z)=>new m.d(V,O,Z)},12163:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{constructor(V,O,Z){this.name=V,this.from=O,this.to=Z}clone(){return new d(this.name,this.from,this.to)}}},11774:(V,O,Z)=>{"use strict";var d=Z(10902),p=Z(10914),r=Z(10983),Y=Z(10906);r.e.AudioEngineFactory=(V,O,Z)=>new m(V,O,Z);class m{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.e,this.onAudioLockedObservable=new d.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,Y.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const p=document.createElement("audio");this._hostElement=V,this._audioContext=O,this._audioDestination=Z;try{p&&p.canPlayType&&(p.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||p.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{p&&p.canPlayType&&p.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}lock(){this._triggerSuspendedState()}unlock(){var V,O;if("running"===(null===(V=this._audioContext)||void 0===V?void 0:V.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var V;null===(V=this._audioContext)||void 0===V||V.addEventListener("statechange",(()=>{var V;this.unlocked&&"running"!==(null===(V=this._audioContext)||void 0===V?void 0:V.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var V;return null!==(V=this._audioContext)&&void 0!==V&&V.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(V){this.canUseWebAudio=!1,p.b.Error("Web Audio: "+V.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const V=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(V)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(V){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=V)}connectToAnalyser(V){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=V,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12149:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>Y});var d=Z(11251),p=Z(11259),r=Z(11521);class Y extends r.e{get _matrix(){return this._compose(),this.Ej}set _matrix(V){(V.updateFlag!==this.Ej.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ej.p(V),this._markAsDirtyAndDecompose())}constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(V,O.va(),!1),this.name=V,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.Ej=(null===p||void 0===p?void 0:p.clone())??d.c.Identity(),this._restMatrix=r??this.Ej.clone(),this._bindMatrix=Y??this.Ej.clone(),this._index=m,this._absoluteMatrix=new d.c,this._absoluteBindMatrix=new d.c,this._absoluteInverseBindMatrix=new d.c,this._finalMatrix=new d.c,O.bones.push(this),this.setParent(Z,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(V){this.setParent(V)}setParent(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==V){if(this.parent){const V=this.parent.children.indexOf(this);-1!==V&&this.parent.children.splice(V,1)}this._parentNode=V,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.sg()}}getLocalMatrix(){return this._compose(),this.Ej}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(V){this._restMatrix.p(V)}setRestPose(V){this.setRestMatrix(V)}getBindPose(){return this.getBindMatrix()}setBindMatrix(V){this.tj(V)}setBindPose(V){this.setBindMatrix(V)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const V=d.i.ib[0],O=d.i.Quaternion[0],Z=d.i.ib[1];this.getRestMatrix().decompose(V,O,Z),this._linkedTransformNode.position.p(Z),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??d.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(O),this._linkedTransformNode.Af.p(V)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(V){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=V,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.tf}set position(V){this._decompose(),this.tf.p(V),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(V){this.setRotation(V)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(V){this.setRotationQuaternion(V)}get Af(){return this.getScale()}set Af(V){this.setScale(V)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=d.m.Zero(),this._localRotation=d.g.Zero(),this.tf=d.m.Zero()),this.Ej.decompose(this._localScaling,this._localRotation,this.tf))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,d.c.ComposeToRef(this._localScaling,this._localRotation,this.tf,this.Ej)):this._needToCompose=!1)}tj(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(V),O&&this._updateAbsoluteBindMatrices(),Z?this._matrix=V:this.sg()}_updateAbsoluteBindMatrices(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V||(V=this._bindMatrix),this.parent?V.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(V),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let Z=0;Z<this.children.length;Z++)this.children[Z]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}sg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.sg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.sg(),this._needToDecompose=!0}_updatePosition(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=this.getLocalMatrix();if(0==O)p?(r.addAtIndex(12,V.x),r.addAtIndex(13,V.y),r.addAtIndex(14,V.z)):r.setTranslationFromFloats(V.x,V.y,V.z);else{let O=null;Z&&(O=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=Y._TmpMats[0],a=Y._TmpVecs[0];this.parent?Z&&O?(m.p(this.parent.getAbsoluteMatrix()),m.multiplyToRef(O,m)):m.p(this.parent.getAbsoluteMatrix()):d.c.IdentityToRef(m),p&&m.setTranslationFromFloats(0,0,0),m.invert(),d.m.TransformCoordinatesToRef(V,m,a),p?(r.addAtIndex(12,a.x),r.addAtIndex(13,a.y),r.addAtIndex(14,a.z)):r.setTranslationFromFloats(a.x,a.y,a.z)}this._markAsDirtyAndDecompose()}translate(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,O,Z,!0)}setPosition(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,O,Z,!1)}setAbsolutePosition(V,O){this.setPosition(V,1,O)}scale(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=this.getLocalMatrix(),m=Y._TmpMats[0];d.c.ScalingToRef(V,O,Z,m),m.multiplyToRef(r,r),m.invert();for(const d of this.children){const p=d.getLocalMatrix();p.multiplyToRef(m,p),p.multiplyAtIndex(12,V),p.multiplyAtIndex(13,O),p.multiplyAtIndex(14,Z),d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),p)for(const d of this.children)d.scale(V,O,Z,p)}setScale(V){this._decompose(),this._localScaling.p(V),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(V){this._decompose(),V.p(this._localScaling)}setYawPitchRoll(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;if(0===p){const m=Y._TmpQuat;return d.g.RotationYawPitchRollToRef(V,O,Z,m),void this.setRotationQuaternion(m,p,r)}const m=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(m,r))return;const a=Y._TmpMats[1];d.c.RotationYawPitchRollToRef(V,O,Z,a),m.multiplyToRef(a,a),this._rotateWithMatrix(a,p,r)}rotate(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;const r=Y._TmpMats[0];r.setTranslationFromFloats(0,0,0),d.c.RotationAxisToRef(V,O,r),this._rotateWithMatrix(r,Z,p)}setAxisAngle(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;if(0===Z){const r=Y._TmpQuat;return d.g.RotationAxisToRef(V,O,r),void this.setRotationQuaternion(r,Z,p)}const r=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,p))return;const m=Y._TmpMats[1];d.c.RotationAxisToRef(V,O,m),r.multiplyToRef(m,m),this._rotateWithMatrix(m,Z,p)}setRotation(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(V.y,V.x,V.z,O,Z)}setRotationQuaternion(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.p(V),void this._markAsDirtyAndCompose();const p=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,Z))return;const r=Y._TmpMats[1];d.c.FromQuaternionToRef(V,r),p.multiplyToRef(r,r),this._rotateWithMatrix(r,O,Z)}setRotationMatrix(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===O){const p=Y._TmpQuat;return d.g.FromRotationMatrixToRef(V,p),void this.setRotationQuaternion(p,O,Z)}const p=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,Z))return;const r=Y._TmpMats[1];r.p(V),p.multiplyToRef(V,r),this._rotateWithMatrix(r,O,Z)}_rotateWithMatrix(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const d=this.getLocalMatrix(),p=d.m[12],r=d.m[13],m=d.m[14],a=this.getParent(),R=Y._TmpMats[3],i=Y._TmpMats[4];a&&1==O?(Z?(R.p(Z.getWorldMatrix()),a.getAbsoluteMatrix().multiplyToRef(R,R)):R.p(a.getAbsoluteMatrix()),i.p(R),i.invert(),d.multiplyToRef(R,d),d.multiplyToRef(V,d),d.multiplyToRef(i,d)):1==O&&Z?(R.p(Z.getWorldMatrix()),i.p(R),i.invert(),d.multiplyToRef(R,d),d.multiplyToRef(V,d),d.multiplyToRef(i,d)):d.multiplyToRef(V,d),d.setTranslationFromFloats(p,r,m),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(V,O){const Z=Y._TmpMats[2];return V.p(this.getAbsoluteMatrix()),O?(V.multiplyToRef(O.getWorldMatrix(),V),d.c.ScalingToRef(O.Af.x,O.Af.y,O.Af.z,Z)):d.c.IdentityToRef(Z),V.invert(),!isNaN(V.m[0])&&(Z.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyToRef(Z,V),!0)}fb(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.m.Zero();return this.getPositionToRef(V,O,Z),Z}getPositionToRef(){let V=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const V=this.getLocalMatrix();O.x=V.m[12],O.y=V.m[13],O.z=V.m[14]}else{let Z=null;V&&(Z=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let d=Y._TmpMats[0];V&&Z?(d.p(this.getAbsoluteMatrix()),d.multiplyToRef(Z,d)):d=this.getAbsoluteMatrix(),O.x=d.m[12],O.y=d.m[13],O.z=d.m[14]}}getAbsolutePosition(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=d.m.Zero();return this.getPositionToRef(1,V,O),O}getAbsolutePositionToRef(V,O){this.getPositionToRef(1,V,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ej.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Ej);const V=this._skeleton.getPoseMatrix();V&&this._absoluteMatrix.multiplyToRef(V,this._absoluteMatrix)}const V=this.children,O=V.length;for(let Z=0;Z<O;Z++)V[Z].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}_d(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.m.Zero();return this.getDirectionToRef(V,O,Z),Z}getDirectionToRef(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,p=null;O&&(p=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=Y._TmpMats[0];r.p(this.getAbsoluteMatrix()),O&&p&&r.multiplyToRef(p,r),d.m.TransformNormalToRef(V,r,Z),Z.normalize()}getRotation(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.m.Zero();return this.getRotationToRef(V,O,Z),Z}getRotationToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;const d=Y._TmpQuat;this.getRotationQuaternionToRef(V,O,d),d.toEulerAnglesToRef(Z)}getRotationQuaternion(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.g.Identity();return this.getRotationQuaternionToRef(V,O,Z),Z}getRotationQuaternionToRef(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.p(this._localRotation);else{const Z=Y._TmpMats[0],d=this.getAbsoluteMatrix();V?d.multiplyToRef(V.getWorldMatrix(),Z):Z.p(d),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.decompose(void 0,O,void 0)}}getRotationMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const Z=d.c.Identity();return this.getRotationMatrixToRef(V,O,Z),Z}getRotationMatrixToRef(){let V=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const Z=Y._TmpMats[0],d=this.getAbsoluteMatrix();V?d.multiplyToRef(V.getWorldMatrix(),Z):Z.p(d),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.m.Zero();return this.getAbsolutePositionFromLocalToRef(V,O,Z),Z}getAbsolutePositionFromLocalToRef(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,p=null;O&&(p=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=Y._TmpMats[0];r.p(this.getAbsoluteMatrix()),O&&p&&r.multiplyToRef(p,r),d.m.TransformCoordinatesToRef(V,r,Z)}getLocalPositionFromAbsolute(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=d.m.Zero();return this.getLocalPositionFromAbsoluteToRef(V,O,Z),Z}getLocalPositionFromAbsoluteToRef(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,p=null;O&&(p=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=Y._TmpMats[0];r.p(this.getAbsoluteMatrix()),O&&p&&r.multiplyToRef(p,r),r.invert(),d.m.TransformCoordinatesToRef(V,r,Z)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}Y._TmpVecs=(0,p.c)(2,d.m.Zero),Y._TmpQuat=d.g.Identity(),Y._TmpMats=(0,p.c)(5,d.c.Identity)},11316:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>r,e:()=>Y});var d=Z(11325),p=Z(10914);class r{get u(){return this._isDisposed}constructor(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,V&&V.va?this._engine=V.va().getEngine():this._engine=V,this._updatable=Z,this._instanced=Y,this._divisor=a||1,this._label=R,O instanceof d.c?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=m?p:p*Float32Array.BYTES_PER_ELEMENT,r||this.create()}createVertexBuffer(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6?arguments[6]:void 0;const a=r?O:O*Float32Array.BYTES_PER_ELEMENT,R=d?r?d:d*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Y(this._engine,this,V,this._updatable,!0,R,void 0===p?this._instanced:p,a,Z,void 0,void 0,!0,this._divisor||m)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!V&&this._buffer||(V=V||this._data,V&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V),this._data=V):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(V,this._label),this._data=V):this._buffer=this._engine.createVertexBuffer(V,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wj>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wj,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wj,void 0,this._label));p.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(V){this.create(V)}updateDirectly(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V,d?O:O*Float32Array.BYTES_PER_ELEMENT,Z?Z*this.byteStride:void 0),this._data=0===O&&void 0===Z?V:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Y{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(V){const O=0!=V;this._instanceDivisor=V,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const V=this.getData();return V?Array.isArray(V)?V.length/(this.byteStride/4)-this.byteOffset/4:(V.byteLength-this.byteOffset)/this.byteStride:0}constructor(V,O,Z,d,p,m,a,R,i,M){let c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]&&arguments[11],F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,Q=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let b=!1;if(this.bd=V,"object"===typeof d&&null!==d?(b=d.updatable??!1,p=d.postponeInternalCreation,m=d.stride,a=d.instanced,R=d.offset,i=d.size,M=d.type,c=d.normalized??!1,W=d.useBytes??!1,F=d.divisor??1,Q=d.takeBufferOwnership??!1,this._label=d.label):b=!!d,O instanceof r?(this._buffer=O,this._ownsBuffer=Q):(this._buffer=new r(V,O,b,m,p,a,W,F,this._label),this._ownsBuffer=!0),this.uniqueId=Y._Counter++,this._kind=Z,void 0===M){const V=this.getData();this.type=V?Y.GetDataType(V):Y.FLOAT}else this.type=M;const U=Y.GetTypeByteLength(this.type);W?(this._size=i||(m?m/U:Y.DeduceStride(Z)),this.byteStride=m||this._buffer.byteStride||this._size*U,this.byteOffset=R||0):(this._size=i||m||Y.DeduceStride(Z),this.byteStride=m?m*U:this._buffer.byteStride||this._size*U,this.byteOffset=(R||0)*U),this.normalized=c,this._instanced=void 0!==a&&a,this._instanceDivisor=a?F:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var V;null===(V=this._buffer)||void 0===V||V._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(V,O){const Z=this.getData();return Z?Y.GetFloatData(Z,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,V,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Y.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/Y.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*Y.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(V){this._buffer.create(V),this._alignBuffer()}update(V){this._buffer.update(V),this._alignBuffer()}updateDirectly(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(V,O,void 0,Z),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(V,O){Y.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,V,this.normalized,O)}_alignBuffer(){}static DeduceStride(V){switch(V){case Y.UVKind:case Y.UV2Kind:case Y.UV3Kind:case Y.UV4Kind:case Y.UV5Kind:case Y.UV6Kind:return 2;case Y.NormalKind:case Y.PositionKind:return 3;case Y.ColorKind:case Y.ColorInstanceKind:case Y.MatricesIndicesKind:case Y.MatricesIndicesExtraKind:case Y.MatricesWeightsKind:case Y.MatricesWeightsExtraKind:case Y.TangentKind:return 4;default:throw new Error("Invalid kind '"+V+"'")}}static GetDataType(V){return V instanceof Int8Array?Y.BYTE:V instanceof Uint8Array?Y.UNSIGNED_BYTE:V instanceof Int16Array?Y.SHORT:V instanceof Uint16Array?Y.UNSIGNED_SHORT:V instanceof Int32Array?Y.INT:V instanceof Uint32Array?Y.UNSIGNED_INT:Y.FLOAT}static GetTypeByteLength(V){switch(V){case Y.BYTE:case Y.UNSIGNED_BYTE:return 1;case Y.SHORT:case Y.UNSIGNED_SHORT:return 2;case Y.INT:case Y.UNSIGNED_INT:case Y.FLOAT:return 4;default:throw new Error(`Invalid type '${V}'`)}}static ForEach(V,O,Z,d,p,r,m,a){if(V instanceof Array){let p=O/4;const Y=Z/4;for(let O=0;O<r;O+=d){for(let Z=0;Z<d;Z++)a(V[p+Z],O+Z);p+=Y}}else{const R=V instanceof ArrayBuffer?new DataView(V):new DataView(V.buffer,V.byteOffset,V.byteLength),i=Y.GetTypeByteLength(p);for(let V=0;V<r;V+=d){let r=O;for(let O=0;O<d;O++){a(Y._GetFloatValue(R,p,r,m),V+O),r+=i}O+=Z}}}static _GetFloatValue(V,O,Z,d){switch(O){case Y.BYTE:{let O=V.getInt8(Z);return d&&(O=Math.max(O/127,-1)),O}case Y.UNSIGNED_BYTE:{let O=V.getUint8(Z);return d&&(O/=255),O}case Y.SHORT:{let O=V.getInt16(Z,!0);return d&&(O=Math.max(O/32767,-1)),O}case Y.UNSIGNED_SHORT:{let O=V.getUint16(Z,!0);return d&&(O/=65535),O}case Y.INT:return V.getInt32(Z,!0);case Y.UNSIGNED_INT:return V.getUint32(Z,!0);case Y.FLOAT:return V.getFloat32(Z,!0);default:throw new Error(`Invalid component type ${O}`)}}static GetFloatData(V,O,Z,d,r,m,a,R){const i=O*Y.GetTypeByteLength(Z),M=a*O;if(Z!==Y.FLOAT||r!==i){const p=new Float32Array(M);return Y.ForEach(V,d,r,O,Z,M,m,((V,O)=>p[O]=V)),p}if(!(V instanceof Array||V instanceof Float32Array)||0!==d||V.length!==M){if(V instanceof Array){const O=d/4;return V.slice(O,O+M)}if(V instanceof ArrayBuffer)return new Float32Array(V,d,M);{const O=V.byteOffset+d;if(0!==(3&O)&&(p.b.Warn("Float array must be aligned to 4-bytes border"),R=!0),R){const Z=new Uint8Array(M*Float32Array.BYTES_PER_ELEMENT),d=new Uint8Array(V.buffer,O,Z.length);return Z.set(d),new Float32Array(Z.buffer)}return new Float32Array(V.buffer,O,M)}}return R?V.slice():V}}Y._Counter=0,Y.BYTE=5120,Y.UNSIGNED_BYTE=5121,Y.SHORT=5122,Y.UNSIGNED_SHORT=5123,Y.INT=5124,Y.UNSIGNED_INT=5125,Y.FLOAT=5126,Y.PositionKind="position",Y.NormalKind="normal",Y.TangentKind="tangent",Y.UVKind="uv",Y.UV2Kind="uv2",Y.UV3Kind="uv3",Y.UV4Kind="uv4",Y.UV5Kind="uv5",Y.UV6Kind="uv6",Y.ColorKind="color",Y.ColorInstanceKind="instanceColor",Y.MatricesIndicesKind="matricesIndices",Y.MatricesWeightsKind="matricesWeights",Y.MatricesIndicesExtraKind="matricesIndicesExtra",Y.MatricesWeightsExtraKind="matricesWeightsExtra"},11325:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});class d{get underlyingResource(){return null}constructor(){this.references=0,this.wj=0,this.is32Bits=!1,this.uniqueId=d._Counter++}}d._Counter=0},12574:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>e});var d=Z(11210),p=Z(11216),r=Z(10902),Y=Z(11251),m=Z(11521),a=Z(11508),R=Z(11349),i=Z(10926),M=Z(11255);class c{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(V){this._idleRotationSpeed=V}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(V){this._idleRotationWaitTime=V}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(V){this._idleRotationSpinupTime=V}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(V){this._attachedCamera=V;const O=this._attachedCamera.va();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((V=>{V.type!==R.c.POINTERDOWN?V.type===R.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const V=i.c.Now;let O=0;null!=this._lastFrameTime&&(O=V-this._lastFrameTime),this._lastFrameTime=V,this._applyUserInteraction();const Z=V-this._lastInteractionTime-this._idleRotationWaitTime,d=Math.max(Math.min(Z/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*d,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.va();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(V){this._lastInteractionTime=V??i.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<M.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let V=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(V=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?V:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=i.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Z(11721);class W{constructor(){this._easingMode=W.EASINGMODE_EASEIN}setEasingMode(V){const O=Math.min(Math.max(V,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(V){throw new Error("You must implement this method")}ease(V){switch(this._easingMode){case W.EASINGMODE_EASEIN:return this.easeInCore(V);case W.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-V)}return V>=.5?.5*(1-this.easeInCore(2*(1-V)))+.5:.5*this.easeInCore(2*V)}}W.EASINGMODE_EASEIN=0,W.EASINGMODE_EASEOUT=1,W.EASINGMODE_EASEINOUT=2;var F=Z(12154);class Q{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(V){if(this._autoTransitionRange===V)return;this._autoTransitionRange=V;const O=this._attachedCamera;O&&(V?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((V=>{if(V&&(V.Cj(!0),V.getBoundingInfo)){const O=V.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(V){this._attachedCamera=V,this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(V){return!!this._attachedCamera&&(this._attachedCamera.i===V&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(V){if(!this._attachedCamera)return;this._radiusBounceTransition||(Q.EasingFunction.setEasingMode(Q.EasingMode),this._radiusBounceTransition=F.c.CreateAnimation("i",F.c.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=F.c.TransitionTo("i",this._attachedCamera.i+V,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Q.EasingFunction=new class extends W{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=V}easeInCore(V){const O=Math.max(0,this.amplitude);return Math.pow(V,3)-V*O*Math.sin(3.141592653589793*V)}}(.3),Q.EasingMode=W.EASINGMODE_EASEOUT;class b{constructor(){this.onTargetFramingAnimationEndObservable=new r.e,this._mode=b.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(V){this._mode=V}get mode(){return this._mode}set radiusScale(V){this._radiusScale=V}get radiusScale(){return this._radiusScale}set positionScale(V){this._positionScale=V}get positionScale(){return this._positionScale}set defaultElevation(V){this._defaultElevation=V}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(V){this._elevationReturnTime=V}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(V){this._elevationReturnWaitTime=V}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(V){this._framingTime=V}get framingTime(){return this._framingTime}init(){}attach(V){this._attachedCamera=V;const O=this._attachedCamera.va();b.EasingFunction.setEasingMode(b.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((V=>{V.type!==R.c.POINTERDOWN?V.type===R.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((V=>{V&&V.getBoundingInfo&&this.zoomOnMesh(V,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.va();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Cj(!0);const d=V.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(d.minimumWorld,d.maximumWorld,O,Z)}zoomOnMeshHierarchy(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Cj(!0);const d=V.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(d.min,d.max,O,Z)}zoomOnMeshesHierarchy(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new Y.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<V.length;r++){const O=V[r].getHierarchyBoundingVectors(!0);Y.m.CheckExtends(O.min,d,p),Y.m.CheckExtends(O.max,d,p)}this.zoomOnBoundingInfo(d,p,O,Z)}zoomOnBoundingInfo(V,O){let Z,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const r=V.y,m=r+(O.y-r)*this._positionScale,a=O.fc(V).scale(.5);if(d)Z=new Y.m(0,m,0);else{const O=V.add(a);Z=new Y.m(O.x,m,O.z)}this._vectorTransition||(this._vectorTransition=F.c.CreateAnimation("target",F.c.ANIMATIONTYPE_VECTOR3,60,b.EasingFunction)),this._betaIsAnimating=!0;let R=F.c.TransitionTo("target",Z,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);R&&this._animatables.push(R);let i=0;if(this._mode===b.FitFrustumSidesMode){const Z=this._calculateLowerRadiusFromModelBoundingSphere(V,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=a.length()+this._attachedCamera.Ii),i=Z}else this._mode===b.IgnoreBoundsSizeMode&&(i=this._calculateLowerRadiusFromModelBoundingSphere(V,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ii));if(this.autoCorrectCameraLimitsAndSensibility){const Z=O.fc(V).length();this._attachedCamera.panningSensibility=5e3/Z,this._attachedCamera.wheelPrecision=100/i}return this._radiusTransition||(this._radiusTransition=F.c.CreateAnimation("i",F.c.ANIMATIONTYPE_FLOAT,60,b.EasingFunction)),R=F.c.TransitionTo("i",i,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),p&&p(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),R&&this._animatables.push(R),!0}_calculateLowerRadiusFromModelBoundingSphere(V,O){const Z=this._attachedCamera;if(!Z)return 0;let d=Z._calculateLowerRadiusFromModelBoundingSphere(V,O,this._radiusScale);return Z.lowerRadiusLimit&&this._mode===b.IgnoreBoundsSizeMode&&(d=d<Z.lowerRadiusLimit?Z.lowerRadiusLimit:d),Z.upperRadiusLimit&&(d=d>Z.upperRadiusLimit?Z.upperRadiusLimit:d),d}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const V=i.c.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,Z=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Z&&V>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.c.CreateAnimation("beta",F.c.ANIMATIONTYPE_FLOAT,60,b.EasingFunction));const V=F.c.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));V&&this._animatables.push(V)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=i.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}b.EasingFunction=new class extends W{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=V}easeInCore(V){return this.exponent<=0?V:(Math.exp(this.exponent*V)-1)/(Math.exp(this.exponent)-1)}},b.EasingMode=W.EASINGMODE_EASEINOUT,b.IgnoreBoundsSizeMode=0,b.FitFrustumSidesMode=1;var U=Z(11519),H=Z(12139),S=Z(12145),z=Z(10900);class G{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(V){V=z.e.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),Z=O.getInputElement();let d=0,p=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=r=>{var Y,m;const a=r.event,i="touch"===a.pointerType;if(r.type!==R.c.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const M=a.target;if(this._altKey=a.altKey,this._ctrlKey=a.ctrlKey,this._metaKey=a.metaKey,this._shiftKey=a.shiftKey,this._buttonsPressed=a.buttons,O.isPointerLock){const V=a.movementX,O=a.movementY;this.onTouch(null,V,O),this._pointA=null,this._pointB=null}else{if(r.type!==R.c.POINTERDOWN&&r.type!==R.c.POINTERDOUBLETAP&&i&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==a.pointerId&&(null===(m=this._pointB)||void 0===m?void 0:m.pointerId)!==a.pointerId)return;if(r.type!==R.c.POINTERDOWN||-1!==this._currentActiveButton&&!i)if(r.type===R.c.POINTERDOUBLETAP)this.onDoubleTap(a.pointerType);else if(r.type!==R.c.POINTERUP||this._currentActiveButton!==a.button&&!i){if(r.type===R.c.POINTERMOVE)if(V||a.preventDefault(),this._pointA&&null===this._pointB){const V=a.clientX-this._pointA.x,O=a.clientY-this._pointA.y;this._pointA.x=a.clientX,this._pointA.y=a.clientY,this.onTouch(this._pointA,V,O)}else if(this._pointA&&this._pointB){const V=this._pointA.pointerId===a.pointerId?this._pointA:this._pointB;V.x=a.clientX,V.y=a.clientY;const O=this._pointA.x-this._pointB.x,Z=this._pointA.y-this._pointB.y,Y=O*O+Z*Z,m={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:a.pointerId,type:r.type};this.onMultiTouch(this._pointA,this._pointB,d,Y,p,m),p=m,d=Y}}else{try{null===M||void 0===M||M.releasePointerCapture(a.pointerId)}catch(c){}i||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==a.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==a.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==d||p)&&(this.onMultiTouch(this._pointA,this._pointB,d,0,p,null),d=0,p=null),this._currentActiveButton=-1,this.onButtonUp(a),V||a.preventDefault()}else{try{null===M||void 0===M||M.setPointerCapture(a.pointerId)}catch(c){}if(null===this._pointA)this._pointA={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType};else{if(null!==this._pointB)return;this._pointB={x:a.clientX,y:a.clientY,pointerId:a.pointerId,type:a.pointerType}}-1!==this._currentActiveButton||i||(this._currentActiveButton=a.button),this.onButtonDown(a),V||(a.preventDefault(),Z&&Z.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,R.c.POINTERDOWN|R.c.POINTERUP|R.c.POINTERMOVE|R.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,d=0,p=null,this.onLostFocus()},this._contextMenuBind=V=>this.onContextMenu(V),Z&&Z.addEventListener("contextmenu",this._contextMenuBind,!1);const r=this.camera.va().getEngine().getHostWindow();r&&z.e.RegisterTopRootEvents(r,[{name:"blur",handler:this._onLostFocus}])}Ei(){if(this._onLostFocus){const V=this.camera.va().getEngine().getHostWindow();V&&z.e.UnregisterTopRootEvents(V,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const V=this.camera.va().getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(V){}onTouch(V,O,Z){}onMultiTouch(V,O,Z,d,p,r){}onContextMenu(V){V.preventDefault()}onButtonDown(V){}onButtonUp(V){}onLostFocus(){}}(0,d.c)([(0,p.K)()],G.prototype,"buttons",void 0);class w extends G{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(V,O){if(0!==this.panningSensibility&&V&&O){const Z=O.x-V.x,d=O.y-V.y;this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility}}_computePinchZoom(V,O){const Z=this.camera.i||w.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=Z*Math.sqrt(V)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-V)*Z*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-V)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(V,O,Z){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=Z/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(V,O,Z,d,p,r){0===Z&&null===p||0===d&&null===r||(this.multiTouchPanAndZoom?(this._computePinchZoom(Z,d),this._computeMultiTouchPanning(p,r)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(d)-Math.sqrt(Z))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Z,d),this._isPinching=!0):this._computeMultiTouchPanning(p,r)):this.multiTouchPanning?this._computeMultiTouchPanning(p,r):this.pinchZoom&&this._computePinchZoom(Z,d))}onButtonDown(V){this._isPanClick=V.button===this.camera._panningMouseButton}onButtonUp(V){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}w.MinimumRadiusForPinch=.001,(0,d.c)([(0,p.K)()],w.prototype,"buttons",void 0),(0,d.c)([(0,p.K)()],w.prototype,"angularSensibilityX",void 0),(0,d.c)([(0,p.K)()],w.prototype,"angularSensibilityY",void 0),(0,d.c)([(0,p.K)()],w.prototype,"pinchPrecision",void 0),(0,d.c)([(0,p.K)()],w.prototype,"pinchDeltaPercentage",void 0),(0,d.c)([(0,p.K)()],w.prototype,"useNaturalPinchZoom",void 0),(0,d.c)([(0,p.K)()],w.prototype,"pinchZoom",void 0),(0,d.c)([(0,p.K)()],w.prototype,"panningSensibility",void 0),(0,d.c)([(0,p.K)()],w.prototype,"multiTouchPanning",void 0),(0,d.c)([(0,p.K)()],w.prototype,"multiTouchPanAndZoom",void 0),S.e.ArcRotateCameraPointersInput=w;var t=Z(11358);class C{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(V){V=z.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const Z=O.event;if(!Z.metaKey)if(O.type===t.b.KEYDOWN){if(this._ctrlPressed=Z.ctrlKey,this._altPressed=Z.altKey,-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),Z.preventDefault&&(V||Z.preventDefault())}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){const O=this._keys.indexOf(Z.keyCode);O>=0&&this._keys.splice(O,1),Z.preventDefault&&(V||Z.preventDefault())}})))}Ei(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let O=0;O<this._keys.length;O++){const Z=this._keys[O];-1!==this.keysLeft.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX-=1/this.panningSensibility:V.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset+=1/this.zoomingSensibility:V.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX+=1/this.panningSensibility:V.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset-=1/this.zoomingSensibility:V.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Z)&&V.useInputToRestoreState&&V.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,d.c)([(0,p.K)()],C.prototype,"keysUp",void 0),(0,d.c)([(0,p.K)()],C.prototype,"keysDown",void 0),(0,d.c)([(0,p.K)()],C.prototype,"keysLeft",void 0),(0,d.c)([(0,p.K)()],C.prototype,"keysRight",void 0),(0,d.c)([(0,p.K)()],C.prototype,"keysReset",void 0),(0,d.c)([(0,p.K)()],C.prototype,"panningSensibility",void 0),(0,d.c)([(0,p.K)()],C.prototype,"zoomingSensibility",void 0),(0,d.c)([(0,p.K)()],C.prototype,"useAltToZoom",void 0),(0,d.c)([(0,p.K)()],C.prototype,"angularSpeed",void 0),S.e.ArcRotateCameraKeyboardMoveInput=C;var v=Z(11386),A=Z(11365),l=Z(11263);class I{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.m(0,0,0),this._globalOffset=new Y.m(0,0,0),this._inertialPanning=Y.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(V,O){let Z=0;const d=.01*V*this.wheelDeltaPercentage*O;return Z=V>0?d/(1+this.wheelDeltaPercentage):d*(1+this.wheelDeltaPercentage),Z}attachControl(V){V=z.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==R.c.POINTERWHEEL)return;const Z=O.event;let d=0;const p=Z.deltaMode===A.e.DOM_DELTA_LINE?40:1,r=-Z.deltaY*p;if(this.customComputeDeltaFromMouseWheel)d=this.customComputeDeltaFromMouseWheel(r,this,Z);else if(this.wheelDeltaPercentage){if(d=this._computeDeltaFromMouseWheelLegacyEvent(r,this.camera.i),d>0){let V=this.camera.i,O=this.camera.inertialRadiusOffset+d;for(let Z=0;Z<20&&Math.abs(O)>.001;Z++)V-=O,O*=this.camera.inertia;V=(0,l.c)(V,0,Number.MAX_VALUE),d=this._computeDeltaFromMouseWheelLegacyEvent(r,V)}}else d=r/(40*this.wheelPrecision);d&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(d)):this.camera.inertialRadiusOffset+=d),Z.preventDefault&&(V||Z.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,R.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.rj(0)}Ei(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const V=this.camera;0+V.inertialAlphaOffset+V.inertialBetaOffset+V.inertialRadiusOffset&&(this._updateHitPlane(),V.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(V.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const V=this.camera,O=V.target.fc(V.position);this._hitPlane=v.c.FromPositionAndNormal(V.target,O)}_getPosition(){const V=this.camera,O=V.va(),Z=O.createPickingRay(O.pointerX,O.pointerY,Y.c.Identity(),V,!1);0===V.targetScreenOffset.x&&0===V.targetScreenOffset.y||(this._viewOffset.set(V.targetScreenOffset.x,V.targetScreenOffset.y,0),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),this._globalOffset=Y.m.TransformNormal(this._viewOffset,V._cameraTransformMatrix),Z.origin.addInPlace(this._globalOffset));let d=0;return this._hitPlane&&(d=Z.intersectsPlane(this._hitPlane)??0),Z.origin.addInPlace(Z.direction.scaleInPlace(d))}_zoomToMouse(V){const O=this.camera,Z=1-O.inertia;if(O.lowerRadiusLimit){const d=O.lowerRadiusLimit??0;O.i-(O.inertialRadiusOffset+V)/Z<d&&(V=(O.i-d)*Z-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const d=O.upperRadiusLimit??0;O.i-(O.inertialRadiusOffset+V)/Z>d&&(V=(O.i-d)*Z-O.inertialRadiusOffset)}const d=V/Z/O.i,p=this._getPosition(),r=Y.i.ib[6];p.subtractToRef(O.target,r),r.scaleInPlace(d),r.scaleInPlace(Z),this._inertialPanning.addInPlace(r),O.inertialRadiusOffset+=V}_zeroIfClose(V){Math.abs(V.x)<M.c&&(V.x=0),Math.abs(V.y)<M.c&&(V.y=0),Math.abs(V.z)<M.c&&(V.z=0)}}(0,d.c)([(0,p.K)()],I.prototype,"wheelPrecision",void 0),(0,d.c)([(0,p.K)()],I.prototype,"zoomToMouseLocation",void 0),(0,d.c)([(0,p.K)()],I.prototype,"wheelDeltaPercentage",void 0),S.e.ArcRotateCameraMouseWheelInput=I;class g extends S.i{constructor(V){super(V)}addMouseWheel(){return this.add(new I),this}addPointers(){return this.add(new w),this}addKeyboard(){return this.add(new C),this}}var n=Z(11041);m.e.AddNodeConstructor("ArcRotateCamera",((V,O)=>()=>new e(V,0,0,1,Y.m.Zero(),O)));class e extends H.b{get target(){return this._target}set target(V){this.setTarget(V)}get targetHost(){return this._targetHost}set targetHost(V){V&&this.setTarget(V)}getTarget(){return this.target}get position(){return this._position}set position(V){this.setPosition(V)}set upVector(V){this._upToYMatrix||(this._yToUpMatrix=new Y.c,this._upToYMatrix=new Y.c,this._upVector=Y.m.Zero()),V.normalize(),this._upVector.p(V),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.c.RotationAlignToRef(Y.m.UpReadOnly,this._upVector,this._yToUpMatrix),Y.c.RotationAlignToRef(this._upVector,Y.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityX:0}set angularSensibilityX(V){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=V)}get angularSensibilityY(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityY:0}set angularSensibilityY(V){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=V)}get pinchPrecision(){const V=this.inputs.attached.pointers;return V?V.pinchPrecision:0}set pinchPrecision(V){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=V)}get pinchDeltaPercentage(){const V=this.inputs.attached.pointers;return V?V.pinchDeltaPercentage:0}set pinchDeltaPercentage(V){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=V)}get useNaturalPinchZoom(){const V=this.inputs.attached.pointers;return!!V&&V.useNaturalPinchZoom}set useNaturalPinchZoom(V){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=V)}get panningSensibility(){const V=this.inputs.attached.pointers;return V?V.panningSensibility:0}set panningSensibility(V){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const O=this.inputs.attached.keyboard;O&&(O.keysUp=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const O=this.inputs.attached.keyboard;O&&(O.keysDown=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const O=this.inputs.attached.keyboard;O&&(O.keysRight=V)}get wheelPrecision(){const V=this.inputs.attached.mousewheel;return V?V.wheelPrecision:0}set wheelPrecision(V){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=V)}get zoomToMouseLocation(){const V=this.inputs.attached.mousewheel;return!!V&&V.zoomToMouseLocation}set zoomToMouseLocation(V){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=V)}get wheelDeltaPercentage(){const V=this.inputs.attached.mousewheel;return V?V.wheelDeltaPercentage:0}set wheelDeltaPercentage(V){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=V)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(V){V!==this.useBouncingBehavior&&(V?(this._bouncingBehavior=new Q,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(V){V!==this.useFramingBehavior&&(V?(this._framingBehavior=new b,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(V){V!==this.useAutoRotationBehavior&&(V?(this._autoRotationBehavior=new c,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(V,O,Z,d,p,m){var a;let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(V,Y.m.Zero(),m,R),a=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new Y.c,this.panningAxis=new Y.m(1,1,0),this._transformedDirection=new Y.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new r.e,this.checkCollisions=!1,this.collisionRadius=new Y.m(.5,.5,.5),this._previousPosition=Y.m.Zero(),this._collisionVelocity=Y.m.Zero(),this._newPosition=Y.m.Zero(),this._computationVector=Y.m.Zero(),this._onCollisionPositionChange=function(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z?(a.setPosition(O),a.yk&&a.yk(Z)):a._previousPosition.p(a._position);const d=Math.cos(a.alpha),p=Math.sin(a.alpha),r=Math.cos(a.beta);let Y=Math.sin(a.beta);0===Y&&(Y=1e-4);const m=a._getTargetPosition();a._computationVector.nf(a.i*d*Y,a.i*r,a.i*p*Y),m.addToRef(a._computationVector,a._newPosition),a._position.p(a._newPosition);let R=a.upVector;a.allowUpsideDown&&a.beta<0&&(R=R.clone(),R=R.negate()),a._computeViewMatrix(a._position,m,R),a._viewMatrix.addAtIndex(12,a.targetScreenOffset.x),a._viewMatrix.addAtIndex(13,a.targetScreenOffset.y),a._collisionTriggered=!1},this._target=Y.m.Zero(),p&&this.setTarget(p),this.alpha=O,this.beta=Z,this.i=d,this.getViewMatrix(),this.inputs=new g(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=Y.l.Zero()}_updateCache(V){V||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const V=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?V.addToRef(this._targetBoundingCenter,this._target):this._target.p(V)}const V=this._getLockedTargetPosition();return V||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>M.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const p=arguments;O=z.e.BackCompatCameraNoPreventDefault(p),this._useCtrlForPanning=Z,this._panningMouseButton=d,"boolean"===typeof p[0]&&(p.length>1&&(this._useCtrlForPanning=p[1]),p.length>2&&(this._panningMouseButton=p[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ei(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const V=this._scene.getEngine().getDeltaTime()/1e3,O=1-Math.pow(2,-V/this.restoreStateInterpolationFactor);this.setTarget(Y.m.Lerp(this.getTarget(),this._storedTarget,O)),Y.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,Y.i.Quaternion[0]),Y.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.i.Quaternion[1]),Y.g.SlerpToRef(Y.i.Quaternion[1],Y.i.Quaternion[0],O,Y.i.Quaternion[2]),Y.i.Quaternion[2].normalize(),Y.i.Quaternion[2].toAlphaBetaGammaToRef(Y.i.ib[0]),this.alpha=Y.i.ib[0].x,this.beta=Y.i.ib[0].y,this.i+=(this._storedRadius-this.i)*O,Y.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,O,this.targetScreenOffset),(Y.m.DistanceSquared(this.getTarget(),this._storedTarget)<M.c&&Y.i.Quaternion[2].equalsWithEpsilon(Y.i.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<M.c&&Y.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<M.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const V=this.invertRotation?-1:1,O=this._calculateHandednessMultiplier();let Z=this.inertialAlphaOffset*O;this.beta<0&&(Z*=-1),this.alpha+=Z*V,this.beta+=this.inertialBetaOffset*V,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<M.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<M.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*M.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const V=new Y.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),V.multiplyInPlace(this.panningAxis),Y.m.TransformNormalToRef(V,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const V=this.upVector,O=Y.m.CrossToRef(this._transformedDirection,V,this._transformedDirection);Y.m.CrossToRef(V,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const V=Y.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.transposeToRef(V),Y.m.TransformCoordinatesToRef(this._transformedDirection,V,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*M.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*M.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const V=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const O=Math.round((V-this.alpha)/(2*Math.PI));this.alpha+=2*O*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(V){this._position.equals(V)||(this._position.p(V),this.rebuildAnglesAndRadius())}setTarget(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(d=this.overrideCloneAlphaBetaRadius??d,V.Cj)O&&V.getBoundingInfo?this._targetBoundingCenter=V.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,V.Cj(),this._targetHost=V,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=V,d=this._getTargetPosition();if(d&&!Z&&d.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}d||this.rebuildAnglesAndRadius()}_getViewMatrix(){const V=Math.cos(this.alpha),O=Math.sin(this.alpha),Z=Math.cos(this.beta);let d=Math.sin(this.beta);0===d&&(d=1e-4),0===this.i&&(this.i=1e-4);const p=this._getTargetPosition();if(this._computationVector.nf(this.i*V*d,this.i*Z,this.i*O*d),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),p.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const V=this.va().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,V.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let V=this.upVector;this.allowUpsideDown&&d<0&&(V=V.negate()),this._computeViewMatrix(this._position,p,V),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=p,this._viewMatrix}zoomOn(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V||this.va().meshes;const Z=a.c.MinMax(V);let d=this._calculateLowerRadiusFromModelBoundingSphere(Z.min,Z.max);d=Math.max(Math.min(d,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=d*this.zoomOnFactor,this.focusOn({min:Z.min,max:Z.max,distance:d},O)}focusOn(V){let O,Z,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===V.min){const d=V||this.va().meshes;O=a.c.MinMax(d),Z=Y.m.Distance(O.min,O.max)}else{O=V,Z=V.distance}this._target=a.c.Center(O),d||(this.maxZ=2*Z)}createRigCamera(V,O){let Z=0;switch(this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:Z=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const d=new e(V,this.alpha+Z,this.beta,this.i,this._target,this.va());return d._cameraRigParams={},d.isRigCamera=!0,d.rigParent=this,d.upVector=this.upVector,d.mode=this.mode,d.orthoLeft=this.orthoLeft,d.orthoRight=this.orthoRight,d.orthoBottom=this.orthoBottom,d.orthoTop=this.orthoTop,d}_updateRigCameras(){const V=this._rigCameras[0],O=this._rigCameras[1];switch(V.beta=O.beta=this.beta,this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const d=Y.m.Distance(V,O),p=this.va().getEngine().getAspectRatio(this),r=Math.tan(this.fov/2),m=r*p,a=.5*d*Z,R=a*Math.sqrt(1+1/(m*m)),i=a*Math.sqrt(1+1/(r*r));return Math.max(R,i)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,d.c)([(0,p.K)()],e.prototype,"alpha",void 0),(0,d.c)([(0,p.K)()],e.prototype,"beta",void 0),(0,d.c)([(0,p.K)()],e.prototype,"i",void 0),(0,d.c)([(0,p.K)()],e.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,d.c)([(0,p.G)("target")],e.prototype,"_target",void 0),(0,d.c)([(0,p.w)("targetHost")],e.prototype,"_targetHost",void 0),(0,d.c)([(0,p.K)()],e.prototype,"inertialAlphaOffset",void 0),(0,d.c)([(0,p.K)()],e.prototype,"inertialBetaOffset",void 0),(0,d.c)([(0,p.K)()],e.prototype,"inertialRadiusOffset",void 0),(0,d.c)([(0,p.K)()],e.prototype,"lowerAlphaLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"upperAlphaLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"lowerBetaLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"upperBetaLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"lowerRadiusLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"upperRadiusLimit",void 0),(0,d.c)([(0,p.K)()],e.prototype,"inertialPanningX",void 0),(0,d.c)([(0,p.K)()],e.prototype,"inertialPanningY",void 0),(0,d.c)([(0,p.K)()],e.prototype,"pinchToPanMaxDistance",void 0),(0,d.c)([(0,p.K)()],e.prototype,"panningDistanceLimit",void 0),(0,d.c)([(0,p.G)()],e.prototype,"panningOriginTarget",void 0),(0,d.c)([(0,p.K)()],e.prototype,"panningInertia",void 0),(0,d.c)([(0,p.K)()],e.prototype,"zoomToMouseLocation",null),(0,d.c)([(0,p.K)()],e.prototype,"zoomOnFactor",void 0),(0,d.c)([(0,p.E)()],e.prototype,"targetScreenOffset",void 0),(0,d.c)([(0,p.K)()],e.prototype,"allowUpsideDown",void 0),(0,d.c)([(0,p.K)()],e.prototype,"useInputToRestoreState",void 0),(0,d.c)([(0,p.K)()],e.prototype,"restoreStateInterpolationFactor",void 0),(0,n.f)("BABYLON.ArcRotateCamera",e)},11519:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>b});var d=Z(11210),p=Z(11216),r=Z(11230),Y=Z(10900),m=Z(10902),a=Z(11251),R=Z(11521),i=Z(10914),M=Z(11041),c=Z(10928),W=Z(11526),F=Z(11377),Q=Z(11283);class b extends R.e{get position(){return this._position}set position(V){this._position=V}set upVector(V){this._upVector=V}get upVector(){return this._upVector}get screenArea(){let V=0,O=0;if(this.mode===b.PERSPECTIVE_CAMERA)this.fovMode===b.FOVMODE_VERTICAL_FIXED?(O=2*this.Ii*Math.tan(this.fov/2),V=this.getEngine().getAspectRatio(this)*O):(V=2*this.Ii*Math.tan(this.fov/2),O=V/this.getEngine().getAspectRatio(this));else{const Z=this.getEngine().getRenderWidth()/2,d=this.getEngine().getRenderHeight()/2;V=(this.orthoRight??Z)-(this.orthoLeft??-Z),O=(this.orthoTop??d)-(this.orthoBottom??-d)}return V*O}set orthoLeft(V){this._orthoLeft=V;for(const O of this._rigCameras)O.orthoLeft=V}get orthoLeft(){return this._orthoLeft}set orthoRight(V){this._orthoRight=V;for(const O of this._rigCameras)O.orthoRight=V}get orthoRight(){return this._orthoRight}set orthoBottom(V){this._orthoBottom=V;for(const O of this._rigCameras)O.orthoBottom=V}get orthoBottom(){return this._orthoBottom}set orthoTop(V){this._orthoTop=V;for(const O of this._rigCameras)O.orthoTop=V}get orthoTop(){return this._orthoTop}set mode(V){this._mode=V;for(const O of this._rigCameras)O.mode=V}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(V,O,Z){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(V,Z,!1),this._position=a.m.Zero(),this._upVector=a.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Ii=1,this.maxZ=1e4,this.inertia=.9,this._mode=b.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new W.c(0,0,1,1),this.layerMask=268435455,this.fovMode=b.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=b.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new m.e,this.onProjectionMatrixChangedObservable=new m.e,this.onAfterCheckInputsObservable=new m.e,this.onRestoreStateObservable=new m.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new a.c,this._postProcesses=new Array,this._activeMeshes=new r.h(256),this._globalPosition=a.m.Zero(),this._computedViewMatrix=a.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=a.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=a.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),d&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=O,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${V}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Zg"}toString(V){let O="Name: "+this.name;if(O+=", type: "+this.getClassName(),this.animations)for(let Z=0;Z<this.animations.length;Z++)O+=", animation[0]: "+this.animations[Z].toString(V);return O}applyVerticalCorrection(){const V=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-V.x:V.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(V)for(const O of this._postProcesses)if(O&&!O.isReady())return!1;return super.isReady(V)}_initCache(){super._initCache(),this._cache.position=new a.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new a.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Ii=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(V){V||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let V=this._cache.mode===this.mode&&this._cache.Ii===this.Ii&&this._cache.maxZ===this.maxZ;if(!V)return!1;const O=this.getEngine();return this.mode===b.PERSPECTIVE_CAMERA?V=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===O.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(V=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===O.getRenderWidth()&&this._cache.renderHeight===O.getRenderHeight(),this.oblique&&(V=V&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),V}attachControl(V,O){}Ei(V){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==b.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let V=0;V<this._postProcesses.length;V++)if(null!==this._postProcesses[V])return this._postProcesses[V];return null}_cascadePostProcessesToRigCams(){const V=this._getFirstPostProcess();V&&V.markTextureDirty();for(let O=0,Z=this._rigCameras.length;O<Z;O++){const V=this._rigCameras[O],Z=V._rigPostProcess;if(Z){"pass"===Z.getEffectName()&&(V.isIntermediate=0===this._postProcesses.length),V._postProcesses=this._postProcesses.slice(0).concat(Z),Z.markTextureDirty()}else V._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!V.isReusable()&&this._postProcesses.indexOf(V)>-1?(i.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==O||O<0?this._postProcesses.push(V):null===this._postProcesses[O]?this._postProcesses[O]=V:this._postProcesses.splice(O,0,V),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.sg(),this._postProcesses.indexOf(V))}detachPostProcess(V){const O=this._postProcesses.indexOf(V);-1!==O&&(this._postProcesses[O]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.sg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return a.c.Identity()}getViewMatrix(V){return!V&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(V){this._doNotComputeProjectionMatrix=!0,void 0!==V&&(this._projectionMatrix=V)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(V){if(this._doNotComputeProjectionMatrix||!V&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Ii=this.Ii,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const O=this.getEngine(),Z=this.va(),d=O.useReverseDepthBuffer;if(this.mode===b.PERSPECTIVE_CAMERA){let V;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=O.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Ii<=0&&(this.Ii=.1),V=Z.useRightHandedSystem?a.c.PerspectiveFovRHToRef:a.c.PerspectiveFovLHToRef,V(this.fov,O.getAspectRatio(this),d?this.maxZ:this.Ii,d?this.Ii:this.maxZ,this._projectionMatrix,this.fovMode===b.FOVMODE_VERTICAL_FIXED,O.isNDCHalfZRange,this.projectionPlaneTilt,d)}else{var p,r,Y;const V=O.getRenderWidth()/2,m=O.getRenderHeight()/2;Z.useRightHandedSystem?this.oblique?a.c.ObliqueOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-m,this.orthoTop??m,d?this.maxZ:this.Ii,d?this.Ii:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,O.isNDCHalfZRange):a.c.OrthoOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-m,this.orthoTop??m,d?this.maxZ:this.Ii,d?this.Ii:this.maxZ,this._projectionMatrix,O.isNDCHalfZRange):this.oblique?a.c.ObliqueOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-m,this.orthoTop??m,d?this.maxZ:this.Ii,d?this.Ii:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,O.isNDCHalfZRange):a.c.OrthoOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-m,this.orthoTop??m,d?this.maxZ:this.Ii,d?this.Ii:this.maxZ,this._projectionMatrix,O.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(p=this.oblique)||void 0===p?void 0:p.angle,this._cache.obliqueLength=null===(r=this.oblique)||void 0===r?void 0:r.length,this._cache.obliqueOffset=null===(Y=this.oblique)||void 0===Y?void 0:Y.offset,this._cache.renderWidth=O.getRenderWidth(),this._cache.renderHeight=O.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(V){return(this.i||(this.target?a.m.Distance(this.position,this.target):this.position.length()))+V}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?F.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=F.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),O&&this.rigCameras.length>0){let O=!1;return this.rigCameras.forEach((Z=>{Z._updateFrustumPlanes(),O=O||V.isInFrustum(Z._frustumPlanes)})),O}return V.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(V){return this._updateFrustumPlanes(),V.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,c.c)("Ray")}getForwardRayToRef(V){throw(0,c.c)("Ray")}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this._parentContainer){const V=this._parentContainer.cameras.indexOf(this);V>-1&&this._parentContainer.cameras.splice(V,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==b.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let V=this._postProcesses.length;for(;--V>=0;){const O=this._postProcesses[V];O&&O.dispose(this)}}let Z=this.customRenderTargets.length;for(;--Z>=0;)this.customRenderTargets[Z].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(V,O)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(V,O){if(this.cameraRigMode!==V){for(;this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this.cameraRigMode=V,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=O.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Y.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==b.RIG_MODE_NONE){const V=this.createRigCamera(this.name+"_L",0);V&&(V._isLeftCamera=!0);const O=this.createRigCamera(this.name+"_R",1);O&&(O._isRightCamera=!0),V&&O&&(this._rigCameras.push(V),this._rigCameras.push(O))}this._setRigMode(O),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(V){}_getVRProjectionMatrix(){return a.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Ii,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(V,O){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[V]=O,"interaxialDistance"===V&&(this._cameraRigParams.stereoHalfAngle=Y.e.ToRadians(O/.0637))}createRigCamera(V,O){return null}_updateRigCameras(){for(let V=0;V<this._rigCameras.length;V++)this._rigCameras[V].Ii=this.Ii,this._rigCameras[V].maxZ=this.maxZ,this._rigCameras[V].fov=this.fov,this._rigCameras[V].upVector.p(this.upVector);this.cameraRigMode===b.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const V=Q.b.Serialize(this);return V.uniqueId=this.uniqueId,V.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(V),this.inputs&&this.inputs.serialize(V),Q.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}clone(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=Q.b.Clone(b.GetConstructorFromName(this.getClassName(),V,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return Z.name=V,Z.parent=O,this.onClonedObservable.notifyObservers(Z),Z}_d(V){const O=a.m.Zero();return this.getDirectionToRef(V,O),O}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(V,O){a.m.TransformNormalToRef(V,this.getWorldMatrix(),O)}static GetConstructorFromName(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=R.e.Construct(V,O,Z,{interaxial_distance:d,isStereoscopicSideBySide:p});return r||(()=>b._CreateDefaultParsedCamera(O,Z))}Cj(){return this.getWorldMatrix()}static Parse(V,O){const Z=V.type,d=b.GetConstructorFromName(Z,V.name,O,V.interaxial_distance,V.isStereoscopicSideBySide),p=Q.b.Parse(d,V,O);if(void 0!==V.parentId&&(p._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(p._waitingParentInstanceIndex=V.parentInstanceIndex),p.inputs&&(p.inputs.parse(V),p._setupInputs()),V.upVector&&(p.upVector=a.m.Cg(V.upVector)),p.setPosition&&(p.position.nf(0,0,0),p.setPosition(a.m.Cg(V.position))),V.target&&p.setTarget&&p.setTarget(a.m.Cg(V.target)),V.cameraRigMode){const O=V.interaxial_distance?{interaxialDistance:V.interaxial_distance}:{};p.setCameraRigMode(V.cameraRigMode,O)}if(V.animations){for(let O=0;O<V.animations.length;O++){const Z=V.animations[O],d=(0,M.c)("BABYLON.Animation");d&&p.animations.push(d.Parse(Z))}R.e.ParseAnimationRanges(p,V,O)}return V.autoAnimate&&O.beginAnimation(p,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&p.If(V.isEnabled),p}_calculateHandednessMultiplier(){let V=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(V*=-1),V}}b._CreateDefaultParsedCamera=(V,O)=>{throw(0,c.c)("UniversalCamera")},b.PERSPECTIVE_CAMERA=0,b.ORTHOGRAPHIC_CAMERA=1,b.FOVMODE_VERTICAL_FIXED=0,b.FOVMODE_HORIZONTAL_FIXED=1,b.RIG_MODE_NONE=0,b.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,b.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,b.RIG_MODE_STEREOSCOPIC_INTERLACED=14,b.RIG_MODE_VR=20,b.RIG_MODE_CUSTOM=22,b.ForceAttachControlToAlwaysPreventDefault=!1,(0,d.c)([(0,p.G)("position")],b.prototype,"_position",void 0),(0,d.c)([(0,p.G)("upVector")],b.prototype,"_upVector",void 0),(0,d.c)([(0,p.K)()],b.prototype,"orthoLeft",null),(0,d.c)([(0,p.K)()],b.prototype,"orthoRight",null),(0,d.c)([(0,p.K)()],b.prototype,"orthoBottom",null),(0,d.c)([(0,p.K)()],b.prototype,"orthoTop",null),(0,d.c)([(0,p.K)()],b.prototype,"fov",void 0),(0,d.c)([(0,p.K)()],b.prototype,"projectionPlaneTilt",void 0),(0,d.c)([(0,p.K)()],b.prototype,"Ii",void 0),(0,d.c)([(0,p.K)()],b.prototype,"maxZ",void 0),(0,d.c)([(0,p.K)()],b.prototype,"inertia",void 0),(0,d.c)([(0,p.K)()],b.prototype,"mode",null),(0,d.c)([(0,p.K)()],b.prototype,"layerMask",void 0),(0,d.c)([(0,p.K)()],b.prototype,"fovMode",void 0),(0,d.c)([(0,p.K)()],b.prototype,"cameraRigMode",void 0),(0,d.c)([(0,p.K)()],b.prototype,"interaxialDistance",void 0),(0,d.c)([(0,p.K)()],b.prototype,"isStereoscopicSideBySide",void 0)},12145:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>Y,i:()=>m});var d=Z(10914),p=Z(11283),r=Z(11519),Y={};class m{constructor(V){this.attachedToElement=!1,this.attached={},this.camera=V,this.checkInputs=()=>{}}add(V){const O=V.getSimpleName();this.attached[O]?d.b.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=V,V.camera=this.camera,V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V))),this.attachedToElement&&V.attachControl(this.noPreventDefault))}remove(V){for(const O in this.attached){const Z=this.attached[O];if(Z===V)return Z.Ei(),Z.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(V){for(const O in this.attached){const Z=this.attached[O];Z.getClassName()===V&&(Z.Ei(),Z.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(V){const O=this.checkInputs;return()=>{O(),V()}}attachInput(V){this.attachedToElement&&V.attachControl(this.noPreventDefault)}attachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){V=!r.d.ForceAttachControlToAlwaysPreventDefault&&V,this.attachedToElement=!0,this.noPreventDefault=V;for(const O in this.attached)this.attached[O].attachControl(V)}}detachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].Ei(),V&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const V in this.attached){const O=this.attached[V];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(V){const O={};for(const Z in this.attached){const V=this.attached[Z],d=p.b.Serialize(V);O[V.getClassName()]=d}V.inputsmgr=O}parse(V){const O=V.inputsmgr;if(O){this.clear();for(const V in O){const Z=Y[V];if(Z){const d=O[V],r=p.b.Parse((()=>new Z),d,null);this.add(r)}}}else for(const Z in this.attached){const O=Y[this.attached[Z].getClassName()];if(O){const d=p.b.Parse((()=>new O),V,null);this.remove(this.attached[Z]),this.add(d)}}}}},12131:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>w});var d=Z(11210),p=Z(11216),r=Z(11251),Y=Z(12139),m=Z(12145),a=Z(11358),R=Z(10900);class i{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(V){V=R.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const Z=O.event;if(!Z.metaKey)if(O.type===a.b.KEYDOWN){if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),V||Z.preventDefault()}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){const O=this._keys.indexOf(Z.keyCode);O>=0&&this._keys.splice(O,1),V||Z.preventDefault()}})))}Ei(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let O=0;O<this._keys.length;O++){const Z=this._keys[O],d=V._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Z)?V._localDirection.nf(-d,0,0):-1!==this.keysUp.indexOf(Z)?V._localDirection.nf(0,0,d):-1!==this.keysRight.indexOf(Z)?V._localDirection.nf(d,0,0):-1!==this.keysDown.indexOf(Z)?V._localDirection.nf(0,0,-d):-1!==this.keysUpward.indexOf(Z)?V._localDirection.nf(0,d,0):-1!==this.keysDownward.indexOf(Z)?V._localDirection.nf(0,-d,0):-1!==this.keysRotateLeft.indexOf(Z)?(V._localDirection.nf(0,0,0),V.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Z)?(V._localDirection.nf(0,0,0),V.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Z)?(V._localDirection.nf(0,0,0),V.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Z)&&(V._localDirection.nf(0,0,0),V.cameraRotation.x+=this._getLocalRotation()),V.va().useRightHandedSystem&&(V._localDirection.z*=-1),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),r.m.TransformNormalToRef(V._localDirection,V._cameraTransformMatrix,V._transformedDirection),V.cameraDirection.addInPlace(V._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const V=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*V}}(0,d.c)([(0,p.K)()],i.prototype,"keysUp",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysUpward",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysDown",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysDownward",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysLeft",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysRight",void 0),(0,d.c)([(0,p.K)()],i.prototype,"rotationSpeed",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysRotateLeft",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysRotateRight",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysRotateUp",void 0),(0,d.c)([(0,p.K)()],i.prototype,"keysRotateDown",void 0),m.e.FreeCameraKeyboardMoveInput=i;var M=Z(10902),c=Z(11349);class W{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=V,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new M.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(V){V=R.e.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),Z=O.getInputElement();this._pointerInput||(this._pointerInput=d=>{const p=d.event,r="touch"===p.pointerType;if(!this.touchEnabled&&r)return;if(d.type!==c.c.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const Y=p.target;if(d.type===c.c.POINTERDOWN){if(r&&-1!==this._activePointerId||!r&&-1!==this._currentActiveButton)return;this._activePointerId=p.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(p.pointerId)}catch(m){}-1===this._currentActiveButton&&(this._currentActiveButton=p.button),this._previousPosition={x:p.clientX,y:p.clientY},V||(p.preventDefault(),Z&&Z.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(d.event)}else if(d.type===c.c.POINTERUP){if(r&&this._activePointerId!==p.pointerId||!r&&this._currentActiveButton!==p.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(p.pointerId)}catch(m){}this._currentActiveButton=-1,this._previousPosition=null,V||p.preventDefault(),this._activePointerId=-1}else if(d.type===c.c.POINTERMOVE&&(this._activePointerId===p.pointerId||!r))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(d.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),Z=(p.clientX-this._previousPosition.x)*O,d=p.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Z/this.angularSensibility,this.camera.cameraRotation.x+=d/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Z,offsetY:d}),this._previousPosition={x:p.clientX,y:p.clientY},V||p.preventDefault()}}),this._onMouseMove=Z=>{if(!O.isPointerLock)return;const d=this.camera._calculateHandednessMultiplier(),p=Z.movementX*d;this.camera.cameraRotation.y+=p/this.angularSensibility;const r=Z.movementY;this.camera.cameraRotation.x+=r/this.angularSensibility,this._previousPosition=null,V||Z.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.c.POINTERDOWN|c.c.POINTERUP|c.c.POINTERMOVE),Z&&(this._contextMenuBind=V=>this.onContextMenu(V),Z.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(V){V.preventDefault()}Ei(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,d.c)([(0,p.K)()],W.prototype,"buttons",void 0),(0,d.c)([(0,p.K)()],W.prototype,"angularSensibility",void 0),m.e.FreeCameraMouseInput=W;var F,Q=Z(11365);class b{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new M.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(V){V=R.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==c.c.POINTERWHEEL)return;const Z=O.event,d=Z.deltaMode===Q.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*d*Z.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*d*Z.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*d*Z.deltaZ/this._normalize,Z.preventDefault&&(V||Z.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,c.c.POINTERWHEEL)}Ei(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,d.c)([(0,p.K)()],b.prototype,"wheelPrecisionX",void 0),(0,d.c)([(0,p.K)()],b.prototype,"wheelPrecisionY",void 0),(0,d.c)([(0,p.K)()],b.prototype,"wheelPrecisionZ",void 0),function(V){V[V.MoveRelative=0]="MoveRelative",V[V.RotateRelative=1]="RotateRelative",V[V.MoveScene=2]="MoveScene"}(F||(F={}));class U extends b{constructor(){super(...arguments),this._moveRelative=r.m.Zero(),this._rotateRelative=r.m.Zero(),this._moveScene=r.m.Zero(),this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(V){null===V&&this._wheelXAction!==F.MoveRelative||(this._wheelXAction=F.MoveRelative,this._wheelXActionCoordinate=V)}get wheelXMoveRelative(){return this._wheelXAction!==F.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(V){null===V&&this._wheelYAction!==F.MoveRelative||(this._wheelYAction=F.MoveRelative,this._wheelYActionCoordinate=V)}get wheelYMoveRelative(){return this._wheelYAction!==F.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(V){null===V&&this._wheelZAction!==F.MoveRelative||(this._wheelZAction=F.MoveRelative,this._wheelZActionCoordinate=V)}get wheelZMoveRelative(){return this._wheelZAction!==F.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(V){null===V&&this._wheelXAction!==F.RotateRelative||(this._wheelXAction=F.RotateRelative,this._wheelXActionCoordinate=V)}get wheelXRotateRelative(){return this._wheelXAction!==F.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(V){null===V&&this._wheelYAction!==F.RotateRelative||(this._wheelYAction=F.RotateRelative,this._wheelYActionCoordinate=V)}get wheelYRotateRelative(){return this._wheelYAction!==F.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(V){null===V&&this._wheelZAction!==F.RotateRelative||(this._wheelZAction=F.RotateRelative,this._wheelZActionCoordinate=V)}get wheelZRotateRelative(){return this._wheelZAction!==F.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(V){null===V&&this._wheelXAction!==F.MoveScene||(this._wheelXAction=F.MoveScene,this._wheelXActionCoordinate=V)}get wheelXMoveScene(){return this._wheelXAction!==F.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(V){null===V&&this._wheelYAction!==F.MoveScene||(this._wheelYAction=F.MoveScene,this._wheelYActionCoordinate=V)}get wheelYMoveScene(){return this._wheelYAction!==F.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(V){null===V&&this._wheelZAction!==F.MoveScene||(this._wheelZAction=F.MoveScene,this._wheelZActionCoordinate=V)}get wheelZMoveScene(){return this._wheelZAction!==F.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.rj(0),this._rotateRelative.rj(0),this._moveScene.rj(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const V=r.c.Zero();this.camera.getViewMatrix().invertToRef(V);const O=r.m.Zero();r.m.TransformNormalToRef(this._moveRelative,V,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(V,O,Z){if(0===V)return;if(null===O||null===Z)return;let d=null;switch(O){case F.MoveRelative:d=this._moveRelative;break;case F.RotateRelative:d=this._rotateRelative;break;case F.MoveScene:d=this._moveScene}switch(Z){case 0:d.set(V,0,0);break;case 1:d.set(0,V,0);break;case 2:d.set(0,0,V)}}}(0,d.c)([(0,p.K)()],U.prototype,"wheelXMoveRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelYMoveRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelZMoveRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelXRotateRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelYRotateRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelZRotateRelative",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelXMoveScene",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelYMoveScene",null),(0,d.c)([(0,p.K)()],U.prototype,"wheelZMoveScene",null),m.e.FreeCameraMouseWheelInput=U;class H{constructor(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=V,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=R.e.IsSafari()}attachControl(V){V=R.e.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Z=>{const d=Z.event,p="mouse"===d.pointerType||this._isSafari&&"undefined"===typeof d.pointerType;if(this.allowMouse||!p)if(Z.type===c.c.POINTERDOWN){if(V||d.preventDefault(),this._pointerPressed.push(d.pointerId),1!==this._pointerPressed.length)return;O={x:d.clientX,y:d.clientY}}else if(Z.type===c.c.POINTERUP){V||d.preventDefault();const Z=this._pointerPressed.indexOf(d.pointerId);if(-1===Z)return;if(this._pointerPressed.splice(Z,1),0!=Z)return;O=null,this._offsetX=null,this._offsetY=null}else if(Z.type===c.c.POINTERMOVE){if(V||d.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(d.pointerId))return;this._offsetX=d.clientX-O.x,this._offsetY=-(d.clientY-O.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.c.POINTERDOWN|c.c.POINTERUP|c.c.POINTERMOVE),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.addEventListener("blur",this._onLostFocus)}}Ei(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const V=this.camera,O=V._calculateHandednessMultiplier();V.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)V.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=V._computeLocalCameraSpeed(),Z=new r.m(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);r.c.RotationYawPitchRollToRef(V.rotation.y,V.rotation.x,0,V._cameraRotationMatrix),V.cameraDirection.addInPlace(r.m.TransformCoordinates(Z,V._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,d.c)([(0,p.K)()],H.prototype,"touchAngularSensibility",void 0),(0,d.c)([(0,p.K)()],H.prototype,"touchMoveSensibility",void 0),m.e.FreeCameraTouchInput=H;class S extends m.i{constructor(V){super(V),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new i),this}addMouse(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new W(V),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new H),this}clear(){super.clear(),this._mouseInput=null}}var z=Z(11041),G=Z(10983);class w extends Y.b{get angularSensibility(){const V=this.inputs.attached.mouse;return V?V.angularSensibility:0}set angularSensibility(V){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const O=this.inputs.attached.keyboard;O&&(O.keysUp=V)}get keysUpward(){const V=this.inputs.attached.keyboard;return V?V.keysUpward:[]}set keysUpward(V){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const O=this.inputs.attached.keyboard;O&&(O.keysDown=V)}get keysDownward(){const V=this.inputs.attached.keyboard;return V?V.keysDownward:[]}set keysDownward(V){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const O=this.inputs.attached.keyboard;O&&(O.keysRight=V)}get keysRotateLeft(){const V=this.inputs.attached.keyboard;return V?V.keysRotateLeft:[]}set keysRotateLeft(V){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=V)}get keysRotateRight(){const V=this.inputs.attached.keyboard;return V?V.keysRotateRight:[]}set keysRotateRight(V){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=V)}get keysRotateUp(){const V=this.inputs.attached.keyboard;return V?V.keysRotateUp:[]}set keysRotateUp(V){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=V)}get keysRotateDown(){const V=this.inputs.attached.keyboard;return V?V.keysRotateDown:[]}set keysRotateDown(V){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=V)}constructor(V,O,Z){var d;super(V,O,Z,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),d=this,this.ellipsoid=new r.m(.5,1,.5),this.ellipsoidOffset=new r.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=r.m.Zero(),this._diffPosition=r.m.Zero(),this._newPosition=r.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d._newPosition.p(O),d._newPosition.subtractToRef(d._oldPosition,d._diffPosition),d._diffPosition.length()>G.e.CollisionsEpsilon&&(d.position.addToRef(d._diffPosition,d._deferredPositionUpdate),d._deferOnly?d._deferredUpdated=!0:d.position.p(d._deferredPositionUpdate),d.yk&&Z&&d.yk(Z))},this.inputs=new S(this),this.inputs.addKeyboard().addMouse()}attachControl(V,O){O=R.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}Ei(){this.inputs.detachElement(),this.cameraDirection=new r.m(0,0,0),this.cameraRotation=new r.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(V){this._collisionMask=isNaN(V)?-1:V}_collideWithWorld(V){let O;O=this.parent?r.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Z=this.va().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let d=V;this.applyGravity&&(d=V.add(this.va().gravity)),Z.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=r.m.Zero(),this._transformedDirection=r.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(V){this._needMoveForGravity=V}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"kb"}}(0,d.c)([(0,p.G)()],w.prototype,"ellipsoid",void 0),(0,d.c)([(0,p.G)()],w.prototype,"ellipsoidOffset",void 0),(0,d.c)([(0,p.K)()],w.prototype,"checkCollisions",void 0),(0,d.c)([(0,p.K)()],w.prototype,"applyGravity",void 0),(0,z.f)("BABYLON.FreeCamera",w)},12139:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>R});var d=Z(11210),p=Z(11216),r=Z(11519),Y=Z(11251),m=Z(11255),a=Z(11562);Z(11521).e.AddNodeConstructor("TargetCamera",((V,O)=>()=>new R(V,Y.m.Zero(),O)));class R extends r.d{constructor(V,O,Z){super(V,O,Z,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=Y.m.Zero(),this._tmpTargetVector=Y.m.Zero(),this.cameraDirection=new Y.m(0,0,0),this.cameraRotation=new Y.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new Y.g,this.rotation=new Y.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=Y.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=Y.c.Zero(),this._camMatrix=Y.c.Zero(),this._cameraTransformMatrix=Y.c.Zero(),this._cameraRotationMatrix=Y.c.Zero(),this._referencePoint=new Y.m(0,0,1),this._transformedReferencePoint=Y.m.Zero(),this._deferredPositionUpdate=new Y.m,this._deferredRotationQuaternionUpdate=new Y.g,this._deferredRotationUpdate=new Y.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=Y.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(V){this.getWorldMatrix();const O=this.getTarget().fc(this.position);return O.normalize(),O.scaleInPlace(V),this.globalPosition.add(O)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const V=this.lockedTarget;V.Cj().getTranslationToRef(V.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.nf(0,0,0),this.cameraRotation.nf(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new Y.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new Y.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(V){V||super._updateCache();const O=this._getLockedTargetPosition();O?this._cache.lockedTarget?this._cache.lockedTarget.p(O):this._cache.lockedTarget=O.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const V=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(V):!V)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const V=this.getEngine();return this.speed*Math.sqrt(V.getDeltaTime()/(100*V.getFps()))}setTarget(V){this.upVector.normalize(),this._initialFocalDistance=V.fc(this.position).length(),this.position.z===V.z&&(this.position.z+=m.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),Y.c.LookAtLHToRef(this.position,V,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const O=V.fc(this.position);O.x>=0?this.rotation.y=-Math.atan(O.z/O.x)+Math.PI/2:this.rotation.y=-Math.atan(O.z/O.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&Y.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(V){this.setTarget(V)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(Y.i.Matrix[0]),Y.m.TransformNormalToRef(this.cameraDirection,Y.i.Matrix[0],Y.i.ib[0]),this._deferredPositionUpdate.addInPlace(Y.i.ib[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const V=this.invertRotation?-this.inverseRotationSpeed:1,O=this._decideIfNeedsToMove(),Z=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),O&&this._updatePosition(),Z){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*V,this._deferredRotationUpdate.y+=this.cameraRotation.y*V,!this.noRotationConstraint){const V=1.570796;this._deferredRotationUpdate.x>V&&(this._deferredRotationUpdate.x=V),this._deferredRotationUpdate.x<-V&&(this._deferredRotationUpdate.x=-V)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(Y.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}O&&(Math.abs(this.cameraDirection.x)<this.speed*m.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*m.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*m.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),Z&&(Math.abs(this.cameraRotation.x)<this.speed*m.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*m.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):Y.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return Y.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),Y.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?a.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(Y.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),a.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(V,O,Z){if(this.ignoreParentScaling){if(this.parent){const d=this.parent.getWorldMatrix();Y.m.TransformCoordinatesToRef(V,d,this._globalPosition),Y.m.TransformCoordinatesToRef(O,d,this._tmpTargetVector),Y.m.TransformNormalToRef(Z,d,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(V),this._tmpTargetVector.p(O),this._tmpUpVector.p(Z);this.va().useRightHandedSystem?Y.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):Y.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?Y.c.LookAtRHToRef(V,O,Z,this._viewMatrix):Y.c.LookAtLHToRef(V,O,Z,this._viewMatrix),this.parent){const V=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(V,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(V)}createRigCamera(V,O){if(this.cameraRigMode!==r.d.RIG_MODE_NONE){const O=new R(V,this.position.clone(),this.va());return O.isRigCamera=!0,O.rigParent=this,this.cameraRigMode===r.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new Y.g),O._cameraRigParams={},O.rotationQuaternion=new Y.g),O.mode=this.mode,O.orthoLeft=this.orthoLeft,O.orthoRight=this.orthoRight,O.orthoTop=this.orthoTop,O.orthoBottom=this.orthoBottom,O}return null}_updateRigCameras(){const V=this._rigCameras[0],O=this._rigCameras[1];switch(this.Cj(),this.cameraRigMode){case r.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const Z=this.cameraRigMode===r.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,d=this.cameraRigMode===r.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*Z,V),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*d,O);break}case r.d.RIG_MODE_VR:V.rotationQuaternion?(V.rotationQuaternion.p(this.rotationQuaternion),O.rotationQuaternion.p(this.rotationQuaternion)):(V.rotation.p(this.rotation),O.rotation.p(this.rotation)),V.position.p(this.position),O.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(V,O){this.getTarget().subtractToRef(this.position,R._TargetFocalPoint),R._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const Z=R._TargetFocalPoint.addInPlace(this.position);Y.c.TranslationToRef(-Z.x,-Z.y,-Z.z,R._TargetTransformMatrix),R._TargetTransformMatrix.multiplyToRef(Y.c.RotationAxis(O.upVector,V),R._RigCamTransformMatrix),Y.c.TranslationToRef(Z.x,Z.y,Z.z,R._TargetTransformMatrix),R._RigCamTransformMatrix.multiplyToRef(R._TargetTransformMatrix,R._RigCamTransformMatrix),Y.m.TransformCoordinatesToRef(this.position,R._RigCamTransformMatrix,O.position),O.setTarget(Z)}getClassName(){return"TargetCamera"}}R._RigCamTransformMatrix=new Y.c,R._TargetTransformMatrix=new Y.c,R._TargetFocalPoint=new Y.m,(0,d.c)([(0,p.G)()],R.prototype,"rotation",void 0),(0,d.c)([(0,p.K)()],R.prototype,"speed",void 0),(0,d.c)([(0,p.w)("lockedTargetId")],R.prototype,"lockedTarget",void 0)},11417:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{constructor(V,O,Z){this.bu=V,this.bv=O,this.distance=Z,this.faceId=0,this.subMeshId=0}}},11310:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(11251),p=Z(11316);class r{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var V;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||Z&&!this.pickedMesh.isVerticesDataPresent(p.e.NormalKind))return null;let r,Y=this.pickedMesh.qf();0===(null===(V=Y)||void 0===V?void 0:V.length)&&(Y=null);const m=d.i.ib[0],a=d.i.ib[1],R=d.i.ib[2];if(Z){const V=this.pickedMesh.getVerticesData(p.e.NormalKind);let O=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId],m):m.nf(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),Z=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId+1],a):a.nf(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),i=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId+2],R):R.nf(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]);O=O.scale(this.bu),Z=Z.scale(this.bv),i=i.scale(1-this.bu-this.bv),r=new d.m(O.x+Z.x+i.x,O.y+Z.y+i.y,O.z+Z.z+i.z)}else{const V=this.pickedMesh.getVerticesData(p.e.PositionKind),O=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId],m):m.nf(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),Z=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId+1],a):a.nf(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),i=Y?d.m.FromArrayToRef(V,3*Y[3*this.faceId+2],R):R.nf(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]),M=O.fc(Z),c=i.fc(Z);r=d.m.Cross(M,c)}const i=(V,O)=>{let Z=V.getWorldMatrix();V.nonUniformScaling&&(d.i.Matrix[0].p(Z),Z=d.i.Matrix[0],Z.setTranslationFromFloats(0,0,0),Z.invert(),Z.transposeToRef(d.i.Matrix[1]),Z=d.i.Matrix[1]),d.m.TransformNormalToRef(O,Z,O)};if(O&&i(this.pickedMesh,r),this.ray){const V=d.i.ib[0].p(r);O||i(this.pickedMesh,V),d.m.Dot(V,this.ray.direction)>0&&r.negateInPlace()}return r.normalize(),r}getTextureCoordinates(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(V))return null;const O=this.pickedMesh.qf();if(!O)return null;const Z=this.pickedMesh.getVerticesData(V);if(!Z)return null;let r=d.l.Cg(Z,2*O[3*this.faceId]),Y=d.l.Cg(Z,2*O[3*this.faceId+1]),m=d.l.Cg(Z,2*O[3*this.faceId+2]);return r=r.scale(this.bu),Y=Y.scale(this.bv),m=m.scale(1-this.bu-this.bv),new d.l(r.x+Y.x+m.x,r.y+Y.y+m.y)}}},11476:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});let d=!1},12633:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>r});var d=Z(11230),p=Z(12636);class r{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Z,this.Zh=[],this._maxBlockCapacity=O||64,this._selectionContent=new d.e(1024),this._creationFunc=V}update(V,O,Z){p.e._CreateBlocks(V,O,Z,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Yh(V){for(let O=0;O<this.eh.length;O++){this.eh[O].addEntry(V)}}Kg(V){for(let O=0;O<this.eh.length;O++){this.eh[O].removeEntry(V)}}select(V,O){this._selectionContent.reset();for(let Z=0;Z<this.eh.length;Z++){this.eh[Z].select(V,this._selectionContent,O)}return O?this._selectionContent.concat(this.Zh):this._selectionContent.concatWithNoDuplicate(this.Zh),this._selectionContent}intersects(V,O,Z){this._selectionContent.reset();for(let d=0;d<this.eh.length;d++){this.eh[d].intersects(V,O,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.Zh):this._selectionContent.concatWithNoDuplicate(this.Zh),this._selectionContent}intersectsRay(V){this._selectionContent.reset();for(let O=0;O<this.eh.length;O++){this.eh[O].intersectsRay(V,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Zh),this._selectionContent}}r.CreationFuncForMeshes=(V,O)=>{const Z=V.getBoundingInfo();!V.isBlocked&&Z.boundingBox.intersectsMinMax(O.ci,O.di)&&O.entries.push(V)},r.CreationFuncForSubMeshes=(V,O)=>{V.getBoundingInfo().boundingBox.intersectsMinMax(O.ci,O.di)&&O.entries.push(V)}},12636:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>r});var d=Z(11251),p=Z(11423);class r{constructor(V,O,Z,d,p,r){this.entries=[],this.ei=new Array,this._capacity=Z,this._depth=d,this._maxDepth=p,this._creationFunc=r,this._minPoint=V,this._maxPoint=O,this.ei.push(V.clone()),this.ei.push(O.clone()),this.ei.push(V.clone()),this.ei[2].x=O.x,this.ei.push(V.clone()),this.ei[3].y=O.y,this.ei.push(V.clone()),this.ei[4].z=O.z,this.ei.push(O.clone()),this.ei[5].z=V.z,this.ei.push(O.clone()),this.ei[6].x=V.x,this.ei.push(O.clone()),this.ei[7].y=V.y}get wj(){return this._capacity}get ci(){return this._minPoint}get di(){return this._maxPoint}addEntry(V){if(this.eh)for(let O=0;O<this.eh.length;O++){this.eh[O].addEntry(V)}else this._creationFunc(V,this),this.entries.length>this.wj&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(V){if(this.eh){for(let O=0;O<this.eh.length;O++){this.eh[O].removeEntry(V)}return}const O=this.entries.indexOf(V);O>-1&&this.entries.splice(O,1)}addEntries(V){for(let O=0;O<V.length;O++){const Z=V[O];this.addEntry(Z)}}select(V,O,Z){if(p.d.IsInFrustum(this.ei,V)){if(this.eh){for(let d=0;d<this.eh.length;d++){this.eh[d].select(V,O,Z)}return}Z?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(V,O,Z,d){if(p.d.IntersectsSphere(this._minPoint,this._maxPoint,V,O)){if(this.eh){for(let p=0;p<this.eh.length;p++){this.eh[p].intersects(V,O,Z,d)}return}d?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersectsRay(V,O){if(V.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.eh){for(let Z=0;Z<this.eh.length;Z++){this.eh[Z].intersectsRay(V,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){r._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(V,O,Z,p,Y,m,a,R){a.eh=new Array;const i=new d.m((O.x-V.x)/2,(O.y-V.y)/2,(O.z-V.z)/2);for(let d=0;d<2;d++)for(let O=0;O<2;O++)for(let M=0;M<2;M++){const c=V.add(i.multiplyByFloats(d,O,M)),W=V.add(i.multiplyByFloats(d+1,O+1,M+1)),F=new r(c,W,p,Y+1,m,R);F.addEntries(Z),a.eh.push(F)}}}},12639:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>i});var d=Z(11238),p=Z(11251),r=Z(11552),Y=Z(11862),m=Z(11342),a=Z(12633),R=Z(10942);d.b.prototype.createOrUpdateSelectionOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Z=this._getComponent(m.b.NAME_OCTREE);Z||(Z=new i(this),this.o(Z)),this.Wh||(this.Wh=new a.c(a.c.CreationFuncForMeshes,V,O));const d=this.getWorldExtends();return this.Wh.update(d.min,d.max,this.meshes),this.Wh},Object.defineProperty(d.b.prototype,"selectionOctree",{get:function(){return this.Wh},enumerable:!0,configurable:!0}),r.d.prototype.createOrUpdateSubmeshesOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Z=this.va();let d=Z._getComponent(m.b.NAME_OCTREE);d||(d=new i(Z),Z.o(d)),this._submeshesOctree||(this._submeshesOctree=new a.c(a.c.CreationFuncForSubMeshes,V,O)),this.Cj(!0);const p=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(p.minimumWorld,p.maximumWorld,this.Ef),this._submeshesOctree};class i{constructor(V){this.name=m.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.d(p.m.Zero(),new p.m(1,1,1)),(V=V||R.e.LastCreatedScene)&&(this.Cf=V,this.Cf.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Cf.getActiveSubMeshCandidates=V=>this.getActiveSubMeshCandidates(V),this.Cf.getCollidingSubMeshCandidates=(V,O)=>this.getCollidingSubMeshCandidates(V,O),this.Cf.getIntersectingSubMeshCandidates=(V,O)=>this.getIntersectingSubMeshCandidates(V,O))}register(){this.Cf.onMeshRemovedObservable.add((V=>{const O=this.Cf.selectionOctree;if(void 0!==O&&null!==O){const Z=O.Zh.indexOf(V);-1!==Z&&O.Zh.splice(Z,1)}})),this.Cf.onMeshImportedObservable.add((V=>{const O=this.Cf.selectionOctree;void 0!==O&&null!==O&&O.Yh(V)}))}getActiveMeshCandidates(){var V;return(null===(V=this.Cf.Wh)||void 0===V?void 0:V.select(this.Cf.frustumPlanes))||this.Cf._getDefaultMeshCandidates()}getActiveSubMeshCandidates(V){if(V._submeshesOctree&&V.useOctreeForRenderingSelection){return V._submeshesOctree.select(this.Cf.frustumPlanes)}return this.Cf._getDefaultSubMeshCandidates(V)}getIntersectingSubMeshCandidates(V,O){if(V._submeshesOctree&&V.useOctreeForPicking){Y.d.TransformToRef(O,V.getWorldMatrix(),this._tempRay);return V._submeshesOctree.intersectsRay(this._tempRay)}return this.Cf._getDefaultSubMeshCandidates(V)}getCollidingSubMeshCandidates(V,O){if(V._submeshesOctree&&V.useOctreeForCollisions){const Z=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return V._submeshesOctree.intersects(O._basePointWorld,Z)}return this.Cf._getDefaultSubMeshCandidates(V)}rebuild(){}dispose(){}}},11423:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y});var d=Z(11259),p=Z(11251),r=Z(11255);class Y{constructor(V,O,Z){this.vectors=(0,d.c)(8,p.m.Zero),this.center=p.m.Zero(),this.centerWorld=p.m.Zero(),this.extendSize=p.m.Zero(),this.extendSizeWorld=p.m.Zero(),this.directions=(0,d.c)(3,p.m.Zero),this.vectorsWorld=(0,d.c)(8,p.m.Zero),this.minimumWorld=p.m.Zero(),this.maximumWorld=p.m.Zero(),this.minimum=p.m.Zero(),this.maximum=p.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(V,O,Z)}reConstruct(V,O,Z){const d=V.x,r=V.y,Y=V.z,m=O.x,a=O.y,R=O.z,i=this.vectors;this.minimum.nf(d,r,Y),this.maximum.nf(m,a,R),i[0].nf(d,r,Y),i[1].nf(m,a,R),i[2].nf(m,r,Y),i[3].nf(d,a,Y),i[4].nf(d,r,R),i[5].nf(m,a,Y),i[6].nf(d,a,R),i[7].nf(m,r,R),O.addToRef(V,this.center).scaleInPlace(.5),O.subtractToRef(V,this.extendSize).scaleInPlace(.5),this._worldMatrix=Z||p.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(V){const O=Y._TmpVector3,Z=this.maximum.subtractToRef(this.minimum,O[0]),d=Z.length();Z.normalizeFromLength(d);const p=d*V,r=Z.scaleInPlace(.5*p),m=this.center.subtractToRef(r,O[1]),a=this.center.addToRef(r,O[2]);return this.reConstruct(m,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){const O=this.minimumWorld,Z=this.maximumWorld,d=this.directions,r=this.vectorsWorld,Y=this.vectors;if(V.isIdentity()){O.p(this.minimum),Z.p(this.maximum);for(let V=0;V<8;++V)r[V].p(Y[V]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{O.rj(Number.MAX_VALUE),Z.rj(-Number.MAX_VALUE);for(let d=0;d<8;++d){const m=r[d];p.m.TransformCoordinatesToRef(Y[d],V,m),O.minimizeInPlace(m),Z.maximizeInPlace(m)}Z.subtractToRef(O,this.extendSizeWorld).scaleInPlace(.5),Z.addToRef(O,this.centerWorld).scaleInPlace(.5)}p.m.FromArrayToRef(V.m,0,d[0]),p.m.FromArrayToRef(V.m,4,d[1]),p.m.FromArrayToRef(V.m,8,d[2]),this._worldMatrix=V}isInFrustum(V){return Y.IsInFrustum(this.vectorsWorld,V)}isCompletelyInFrustum(V){return Y.IsCompletelyInFrustum(this.vectorsWorld,V)}intersectsPoint(V){const O=this.minimumWorld,Z=this.maximumWorld,d=O.x,p=O.y,Y=O.z,m=Z.x,a=Z.y,R=Z.z,i=V.x,M=V.y,c=V.z,W=-r.c;return!(m-i<W||W>i-d)&&(!(a-M<W||W>M-p)&&!(R-c<W||W>c-Y))}intersectsSphere(V){return Y.IntersectsSphere(this.minimumWorld,this.maximumWorld,V.centerWorld,V.radiusWorld)}intersectsMinMax(V,O){const Z=this.minimumWorld,d=this.maximumWorld,p=Z.x,r=Z.y,Y=Z.z,m=d.x,a=d.y,R=d.z,i=V.x,M=V.y,c=V.z,W=O.x,F=O.y,Q=O.z;return!(m<i||p>W)&&(!(a<M||r>F)&&!(R<c||Y>Q))}dispose(){var V,O;null===(V=this._drawWrapperFront)||void 0===V||V.dispose(),null===(O=this._drawWrapperBack)||void 0===O||O.dispose()}static Intersects(V,O){return V.intersectsMinMax(O.minimumWorld,O.maximumWorld)}static IntersectsSphere(V,O,Z,d){const r=Y._TmpVector3[0];p.m.ClampToRef(Z,V,O,r);return p.m.DistanceSquared(Z,r)<=d*d}static IsCompletelyInFrustum(V,O){for(let Z=0;Z<6;++Z){const d=O[Z];for(let O=0;O<8;++O)if(d.dotCoordinate(V[O])<0)return!1}return!0}static IsInFrustum(V,O){for(let Z=0;Z<6;++Z){let d=!0;const p=O[Z];for(let O=0;O<8;++O)if(p.dotCoordinate(V[O])>=0){d=!1;break}if(d)return!1}return!0}}Y._TmpVector3=(0,d.c)(3,p.m.Zero)},11421:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>M});var d=Z(11259),p=Z(11251),r=Z(11423),Y=Z(11426);const m={min:0,max:0},a={min:0,max:0},R=(V,O,Z)=>{const d=p.m.Dot(O.centerWorld,V),r=Math.abs(p.m.Dot(O.directions[0],V))*O.extendSize.x+Math.abs(p.m.Dot(O.directions[1],V))*O.extendSize.y+Math.abs(p.m.Dot(O.directions[2],V))*O.extendSize.z;Z.min=d-r,Z.max=d+r},i=(V,O,Z)=>(R(V,O,m),R(V,Z,a),!(m.min>a.max||a.min>m.max));class M{constructor(V,O,Z){this._isLocked=!1,this.boundingBox=new r.d(V,O,Z),this.boundingSphere=new Y.b(V,O,Z)}reConstruct(V,O,Z){this.boundingBox.reConstruct(V,O,Z),this.boundingSphere.reConstruct(V,O,Z)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(V){this._isLocked=V}update(V){this._isLocked||(this.boundingBox._update(V),this.boundingSphere._update(V))}centerOn(V,O){const Z=M._TmpVector3[0].p(V).bi(O),d=M._TmpVector3[1].p(V).addInPlace(O);return this.boundingBox.reConstruct(Z,d,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(Z,d,this.boundingBox.getWorldMatrix()),this}encapsulate(V){const O=p.m.Minimize(this.minimum,V),Z=p.m.Maximize(this.maximum,V);return this.reConstruct(O,Z,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(V){const O=p.i.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(O);const Z=p.i.ib[0];return p.m.TransformCoordinatesToRef(V.boundingBox.minimumWorld,O,Z),this.encapsulate(Z),p.m.TransformCoordinatesToRef(V.boundingBox.maximumWorld,O,Z),this.encapsulate(Z),this}scale(V){return this.boundingBox.scale(V),this.boundingSphere.scale(V),this}isInFrustum(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===O||3===O)&&this.boundingSphere.isCenterInFrustum(V))return!0;if(!this.boundingSphere.isInFrustum(V))return!1;return!(1!==O&&3!==O)||this.boundingBox.isInFrustum(V)}get diagonalLength(){const V=this.boundingBox;return V.maximumWorld.subtractToRef(V.minimumWorld,M._TmpVector3[0]).length()}isCompletelyInFrustum(V){return this.boundingBox.isCompletelyInFrustum(V)}_checkCollision(V){return V._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(V){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(V)&&!!this.boundingBox.intersectsPoint(V))}intersects(V,O){if(!Y.b.Intersects(this.boundingSphere,V.boundingSphere))return!1;if(!r.d.Intersects(this.boundingBox,V.boundingBox))return!1;if(!O)return!0;const Z=this.boundingBox,d=V.boundingBox;return!!i(Z.directions[0],Z,d)&&(!!i(Z.directions[1],Z,d)&&(!!i(Z.directions[2],Z,d)&&(!!i(d.directions[0],Z,d)&&(!!i(d.directions[1],Z,d)&&(!!i(d.directions[2],Z,d)&&(!!i(p.m.Cross(Z.directions[0],d.directions[0]),Z,d)&&(!!i(p.m.Cross(Z.directions[0],d.directions[1]),Z,d)&&(!!i(p.m.Cross(Z.directions[0],d.directions[2]),Z,d)&&(!!i(p.m.Cross(Z.directions[1],d.directions[0]),Z,d)&&(!!i(p.m.Cross(Z.directions[1],d.directions[1]),Z,d)&&(!!i(p.m.Cross(Z.directions[1],d.directions[2]),Z,d)&&(!!i(p.m.Cross(Z.directions[2],d.directions[0]),Z,d)&&(!!i(p.m.Cross(Z.directions[2],d.directions[1]),Z,d)&&!!i(p.m.Cross(Z.directions[2],d.directions[2]),Z,d))))))))))))))}}M._TmpVector3=(0,d.c)(2,p.m.Zero)},11426:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(11259),p=Z(11251);class r{constructor(V,O,Z){this.center=p.m.Zero(),this.centerWorld=p.m.Zero(),this.minimum=p.m.Zero(),this.maximum=p.m.Zero(),this.reConstruct(V,O,Z)}reConstruct(V,O,Z){this.minimum.p(V),this.maximum.p(O);const d=p.m.Distance(V,O);O.addToRef(V,this.center).scaleInPlace(.5),this.i=.5*d,this._update(Z||p.c.IdentityReadOnly)}scale(V){const O=this.i*V,Z=r._TmpVector3,d=Z[0].rj(O),p=this.center.subtractToRef(d,Z[1]),Y=this.center.addToRef(d,Z[2]);return this.reConstruct(p,Y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){if(V.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.i;else{p.m.TransformCoordinatesToRef(this.center,V,this.centerWorld);const O=r._TmpVector3[0];p.m.TransformNormalFromFloatsToRef(1,1,1,V,O),this.radiusWorld=Math.max(Math.abs(O.x),Math.abs(O.y),Math.abs(O.z))*this.i}}isInFrustum(V){const O=this.centerWorld,Z=this.radiusWorld;for(let d=0;d<6;d++)if(V[d].dotCoordinate(O)<=-Z)return!1;return!0}isCenterInFrustum(V){const O=this.centerWorld;for(let Z=0;Z<6;Z++)if(V[Z].dotCoordinate(O)<0)return!1;return!0}intersectsPoint(V){const O=p.m.DistanceSquared(this.centerWorld,V);return!(this.radiusWorld*this.radiusWorld<O)}static Intersects(V,O){const Z=p.m.DistanceSquared(V.centerWorld,O.centerWorld),d=V.radiusWorld+O.radiusWorld;return!(d*d<Z)}static CreateFromCenterAndRadius(V,O,Z){this._TmpVector3[0].p(V),this._TmpVector3[1].nf(0,0,O),this._TmpVector3[2].p(V),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].bi(this._TmpVector3[1]);const d=new r(this._TmpVector3[0],this._TmpVector3[2]);return d._worldMatrix=Z||p.c.Identity(),d}}r._TmpVector3=(0,d.c)(3,p.m.Zero)},11862:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>W});var d=Z(11238),p=Z(11519),r=Z(11255),Y=Z(11251),m=Z(11259),a=Z(11417),R=Z(11310),i=Z(10942),M=Z(11369);const c={internalPickerForMesh:void 0};class W{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.c;this.origin=V,this.direction=O,this.length=Z,this.epsilon=d}clone(){return new W(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=W._TmpVector3[0].nf(V.x-Z,V.y-Z,V.z-Z),p=W._TmpVector3[1].nf(O.x+Z,O.y+Z,O.z+Z);let r,Y,m,a,R=0,i=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<d.x||this.origin.x>p.x)return!1}else if(r=1/this.direction.x,Y=(d.x-this.origin.x)*r,m=(p.x-this.origin.x)*r,m===-1/0&&(m=1/0),Y>m&&(a=Y,Y=m,m=a),R=Math.max(Y,R),i=Math.min(m,i),R>i)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<d.y||this.origin.y>p.y)return!1}else if(r=1/this.direction.y,Y=(d.y-this.origin.y)*r,m=(p.y-this.origin.y)*r,m===-1/0&&(m=1/0),Y>m&&(a=Y,Y=m,m=a),R=Math.max(Y,R),i=Math.min(m,i),R>i)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<d.z||this.origin.z>p.z)return!1}else if(r=1/this.direction.z,Y=(d.z-this.origin.z)*r,m=(p.z-this.origin.z)*r,m===-1/0&&(m=1/0),Y>m&&(a=Y,Y=m,m=a),R=Math.max(Y,R),i=Math.min(m,i),R>i)return!1;return!0}intersectsBox(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(V.minimum,V.maximum,O)}intersectsSphere(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=V.center.x-this.origin.x,d=V.center.y-this.origin.y,p=V.center.z-this.origin.z,r=Z*Z+d*d+p*p,Y=V.i+O,m=Y*Y;if(r<=m)return!0;const a=Z*this.direction.x+d*this.direction.y+p*this.direction.z;if(a<0)return!1;return r-a*a<=m}intersectsTriangle(V,O,Z){const d=W._TmpVector3[0],p=W._TmpVector3[1],r=W._TmpVector3[2],m=W._TmpVector3[3],R=W._TmpVector3[4];O.subtractToRef(V,d),Z.subtractToRef(V,p),Y.m.CrossToRef(this.direction,p,r);const i=Y.m.Dot(d,r);if(0===i)return null;const M=1/i;this.origin.subtractToRef(V,m);const c=Y.m.Dot(m,r)*M;if(c<-this.epsilon||c>1+this.epsilon)return null;Y.m.CrossToRef(m,d,R);const F=Y.m.Dot(this.direction,R)*M;if(F<-this.epsilon||c+F>1+this.epsilon)return null;const Q=Y.m.Dot(p,R)*M;return Q>this.length?null:new a.d(1-c-F,c,Q)}intersectsPlane(V){let O;const Z=Y.m.Dot(V.ab,this.direction);if(Math.abs(Z)<9.99999997475243e-7)return null;{const d=Y.m.Dot(V.ab,this.origin);return O=(-V.d-d)/Z,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(V){case"y":{const V=(this.origin.y-O)/this.direction.y;return V>0?null:new Y.m(this.origin.x+this.direction.x*-V,O,this.origin.z+this.direction.z*-V)}case"x":{const V=(this.origin.x-O)/this.direction.x;return V>0?null:new Y.m(O,this.origin.y+this.direction.y*-V,this.origin.z+this.direction.z*-V)}case"z":{const V=(this.origin.z-O)/this.direction.z;return V>0?null:new Y.m(this.origin.x+this.direction.x*-V,this.origin.y+this.direction.y*-V,O)}default:return null}}intersectsMesh(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=Y.i.Matrix[0];return V.getWorldMatrix().invertToRef(m),this._tmpRay?W.TransformToRef(this,m,this._tmpRay):this._tmpRay=W.Transform(this,m),V.intersects(this._tmpRay,O,Z,d,p,r)}intersectsMeshes(V,O,Z){Z?Z.length=0:Z=[];for(let d=0;d<V.length;d++){const p=this.intersectsMesh(V[d],O);p.hit&&Z.push(p)}return Z.sort(this._comparePickingInfo),Z}_comparePickingInfo(V,O){return V.distance<O.distance?-1:V.distance>O.distance?1:0}intersectionSegment(V,O,Z){const d=this.origin,p=Y.i.ib[0],r=Y.i.ib[1],m=Y.i.ib[2],a=Y.i.ib[3];O.subtractToRef(V,p),this.direction.scaleToRef(W._Rayl,m),d.addToRef(m,r),V.subtractToRef(d,a);const R=Y.m.Dot(p,p),i=Y.m.Dot(p,m),M=Y.m.Dot(m,m),c=Y.m.Dot(p,a),F=Y.m.Dot(m,a),Q=R*M-i*i;let b,U,H=Q,S=Q;Q<W._Smallnum?(b=0,H=1,U=F,S=M):(b=i*F-M*c,U=R*F-i*c,b<0?(b=0,U=F,S=M):b>H&&(b=H,U=F+i,S=M)),U<0?(U=0,-c<0?b=0:-c>R?b=H:(b=-c,H=R)):U>S&&(U=S,-c+i<0?b=0:-c+i>R?b=H:(b=-c+i,H=R));const z=Math.abs(b)<W._Smallnum?0:b/H,G=Math.abs(U)<W._Smallnum?0:U/S,w=Y.i.ib[4];m.scaleToRef(G,w);const t=Y.i.ib[5];p.scaleToRef(z,t),t.addInPlace(a);const C=Y.i.ib[6];t.subtractToRef(w,C);return G>0&&G<=this.length&&C.lengthSquared()<Z*Z?t.length():-1}update(V,O,Z,d,p,r,m){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){W._RayDistant||(W._RayDistant=W.Zero()),W._RayDistant.unprojectRayToRef(V,O,Z,d,Y.c.IdentityReadOnly,r,m);const a=Y.i.Matrix[0];p.invertToRef(a),W.TransformToRef(W._RayDistant,a,this)}else this.unprojectRayToRef(V,O,Z,d,p,r,m);return this}static Zero(){return new W(Y.m.Zero(),Y.m.Zero())}static CreateNew(V,O,Z,d,p,r,Y){return W.Zero().update(V,O,Z,d,p,r,Y)}static CreateNewFromTo(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.c.IdentityReadOnly;const d=new W(new Y.m(0,0,0),new Y.m(0,0,0));return W.CreateFromToToRef(V,O,d,Z)}static CreateFromToToRef(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.c.IdentityReadOnly;Z.origin.p(V);const p=O.subtractToRef(V,Z.direction),r=Math.sqrt(p.x*p.x+p.y*p.y+p.z*p.z);return Z.length=r,Z.direction.normalize(),W.TransformToRef(Z,d,Z)}static Transform(V,O){const Z=new W(new Y.m(0,0,0),new Y.m(0,0,0));return W.TransformToRef(V,O,Z),Z}static TransformToRef(V,O,Z){Y.m.TransformCoordinatesToRef(V.origin,O,Z.origin),Y.m.TransformNormalToRef(V.direction,O,Z.direction),Z.length=V.length,Z.epsilon=V.epsilon;const d=Z.direction,p=d.length();if(0!==p&&1!==p){const V=1/p;d.x*=V,d.y*=V,d.z*=V,Z.length*=p}return Z}unprojectRayToRef(V,O,Z,d,p,r,m){const a=Y.i.Matrix[0];p.multiplyToRef(r,a),a.multiplyToRef(m,a),a.invert();const R=i.e.LastCreatedEngine,M=Y.i.ib[0];M.x=V/Z*2-1,M.y=-(O/d*2-1),M.z=null!==R&&void 0!==R&&R.useReverseDepthBuffer?1:null!==R&&void 0!==R&&R.isNDCHalfZRange?0:-1;const c=Y.i.ib[1].nf(M.x,M.y,1-1e-8),W=Y.i.ib[2],F=Y.i.ib[3];Y.m._UnprojectFromInvertedMatrixToRef(M,a,W),Y.m._UnprojectFromInvertedMatrixToRef(c,a,F),this.origin.p(W),F.subtractToRef(W,this.direction),this.direction.normalize()}}function F(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=W.Zero();return Q(V,O,Z,d,Y,p,r),Y}function Q(V,O,Z,d,p,r){let m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const R=V.getEngine();if(!r&&!(r=V.activeCamera))return V;const i=r.viewport,M=R.getRenderHeight(),{x:c,y:W,width:F,height:Q}=i.toGlobal(R.getRenderWidth(),M),b=1/R.getHardwareScalingLevel();return O=O*b-c,Z=Z*b-(M-W-Q),p.update(O,Z,F,Q,d||Y.c.IdentityReadOnly,m?Y.c.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix(),a),V}function b(V,O,Z,d,p){if(!R.b)return V;const r=V.getEngine();if(!p&&!(p=V.activeCamera))throw new Error("Active camera not set");const m=p.viewport,a=r.getRenderHeight(),{x:i,y:M,width:c,height:W}=m.toGlobal(r.getRenderWidth(),a),F=Y.c.Identity(),Q=1/r.getHardwareScalingLevel();return O=O*Q-i,Z=Z*Q-(a-M-W),d.update(O,Z,c,W,F,F,p.getProjectionMatrix()),V}function U(V,O,Z,d,p,r,Y,m){const a=O(d,Z.enableDistantPicking),R=Z.intersects(a,p,Y,r,d,m);return R&&R.hit?!p&&null!=V&&R.distance>=V.distance?null:R:null}function H(V,O,Z,d,p,r){let m=null;const a=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),i=V.cameraToUseForPointers||V.activeCamera,M=c.internalPickerForMesh||U;for(let R=0;R<V.meshes.length;R++){const c=V.meshes[R];if(Z){if(!Z(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.oe)continue;const W=a&&c.isWorldMatrixCameraDependent(),F=c.Cj(W,i);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const V=M(m,O,c,F,!0,!0,r);if(V){if(p)return V;const a=Y.i.Matrix[1],R=c.thinInstanceGetWorldMatrices();for(let V=0;V<R.length;V++){if(Z&&!Z(c,V))continue;R[V].multiplyToRef(F,a);const Y=M(m,O,c,a,d,p,r,!0);if(Y&&(m=Y,m.thinInstanceIndex=V,d))return m}}}else{const V=M(m,O,c,F,d,p,r);if(V&&(m=V,d))return m}}return m||new R.b}function S(V,O,Z,d){if(!R.b)return null;const p=[],r=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),m=V.cameraToUseForPointers||V.activeCamera,a=c.internalPickerForMesh||U;for(let R=0;R<V.meshes.length;R++){const i=V.meshes[R];if(Z){if(!Z(i,-1))continue}else if(!i.isEnabled()||!i.isVisible||!i.oe)continue;const M=r&&i.isWorldMatrixCameraDependent(),c=i.Cj(M,m);if(i.hasThinInstances&&i.thinInstanceEnablePicking){if(a(null,O,i,c,!0,!0,d)){const V=Y.i.Matrix[1],r=i.thinInstanceGetWorldMatrices();for(let Y=0;Y<r.length;Y++){if(Z&&!Z(i,Y))continue;r[Y].multiplyToRef(c,V);const m=a(null,O,i,V,!1,!1,d,!0);m&&(m.thinInstanceIndex=Y,p.push(m))}}}else{const V=a(null,O,i,c,!1,!1,d);V&&p.push(V)}}return p}function z(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;d||(d=V.getWorldMatrix()),O.length=Z,p?O.origin.p(p):O.origin.p(V.position);const r=Y.i.ib[2];r.set(0,0,V._scene.useRightHandedSystem?-1:1);const m=Y.i.ib[3];return Y.m.TransformNormalToRef(r,d,m),Y.m.NormalizeToRef(m,O.direction),O}var G,w;W._TmpVector3=(0,m.c)(6,Y.m.Zero),W._RayDistant=W.Zero(),W._Smallnum=1e-8,W._Rayl=1e9,G=d.b,(w=p.d)&&(w.prototype.getForwardRay=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;return z(this,new W(Y.m.Zero(),Y.m.Zero(),V),V,O,Z)},w.prototype.getForwardRayToRef=function(V){return z(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),G&&(M.e._IsPickingAvailable=!0,G.prototype.createPickingRay=function(V,O,Z,d){return F(this,V,O,Z,d,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),d.b.prototype.createPickingRayToRef=function(V,O,Z,d,p){return Q(this,V,O,Z,d,p,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},d.b.prototype.createPickingRayInCameraSpace=function(V,O,Z){return function(V,O,Z,d){const p=W.Zero();return b(V,O,Z,p,d),p}(this,V,O,Z)},d.b.prototype.createPickingRayInCameraSpaceToRef=function(V,O,Z,d){return b(this,V,O,Z,d)},d.b.prototype.pickWithBoundingInfo=function(V,O,Z,d,p){return function(V,O,Z,d,p,r){if(!R.b)return null;const m=H(V,(d=>(V._tempPickingRay||(V._tempPickingRay=W.Zero()),Q(V,O,Z,d,V._tempPickingRay,r||null),V._tempPickingRay)),d,p,!0);return m&&(m.ray=F(V,O,Z,Y.c.Identity(),r||null)),m}(this,V,O,Z,d,p)},d.b.prototype.bc=function(V,O,Z,d,p,r){return function(V,O,Z,d,p,r,m){const a=H(V,((d,p)=>(V._tempPickingRay||(V._tempPickingRay=W.Zero()),Q(V,O,Z,d,V._tempPickingRay,r||null,!1,p),V._tempPickingRay)),d,p,!1,m);return a&&(a.ray=F(V,O,Z,Y.c.Identity(),r||null)),a}(this,V,O,Z,d,p,r)},d.b.prototype.pickWithRay=function(V,O,Z,d){return function(V,O,Z,d,p){const r=H(V,(Z=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=Y.c.Identity()),Z.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=W.Zero()),W.TransformToRef(O,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),Z,d,!1,p);return r&&(r.ray=O),r}(this,V,O,Z,d)},d.b.prototype.multiPick=function(V,O,Z,d,p){return function(V,O,Z,d,p,r){return S(V,(d=>F(V,O,Z,d,p||null)),d,r)}(this,V,O,Z,d,p)},d.b.prototype.multiPickWithRay=function(V,O,Z){return function(V,O,Z,d){return S(V,(Z=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=Y.c.Identity()),Z.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=W.Zero()),W.TransformToRef(O,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),Z,d)}(this,V,O,Z)}},11766:(V,O,Z)=>{"use strict";var d=Z(11013),p=Z(10914),r=Z(10947),Y=Z(11045),m=Z(10983),a=Z(11028);m.e.prototype._partialLoadFile=function(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(V,(V=>{Z[O]=V,Z._internalCount++,6===Z._internalCount&&d(Z)}),void 0,void 0,!0,((V,O)=>{p&&V&&p(V.status+" "+V.statusText,O)}))},m.e.prototype._cascadeLoadFiles=function(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=[];p._internalCount=0;for(let r=0;r<6;r++)this._partialLoadFile(Z[r],r,p,O,d)},m.e.prototype._cascadeLoadImgs=function(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let m=0;m<6;m++)this._partialLoadImg(d[m],m,Y,V,O,Z,p,r)},m.e.prototype._partialLoadImg=function(V,O,Z,d,p,m){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0;const i=(0,Y.b)();(0,r.p)(V,(V=>{Z[O]=V,Z._internalCount++,d&&d.removePendingData(i),6===Z._internalCount&&m&&m(p,Z)}),((V,O)=>{d&&d.removePendingData(i),a&&a(V,O)}),d?d.offlineProvider:null,R),d&&d.addPendingData(i)},m.e.prototype.createCubeTextureBase=function(V,O,Z,r){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],H=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const S=F||new d.d(this,7);S.isCube=!0,S.url=V,S.generateMipMaps=!r,S._lodGenerationScale=c,S._lodGenerationOffset=W,S._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!r),S!==F&&(S.label=V.substring(0,60)),this._doNotHandleContextLost||(S._extension=i,S._files=Z,S._buffer=H);const z=V;this._transformTextureUrl&&!F&&(V=this._transformTextureUrl(V));const G=V.split("?")[0],w=G.lastIndexOf("."),t=i||(w>-1?G.substring(w).toLowerCase():""),C=(0,a.d)(t),v=(d,a)=>{V===z?m&&d&&m(d.status+" "+d.statusText,a):(p.b.Warn(`Failed to load ${V}, falling back to the ${z}`),this.createCubeTextureBase(z,O,Z,!!r,Y,m,R,i,M,c,W,S,Q,b,U,H))};if(C)C.then((d=>{const r=V=>{Q&&Q(S,V),d.loadCubeData(V,S,M,Y,m)};H?r(H):Z&&6===Z.length?d.supportCascades?this._cascadeLoadFiles(O,(V=>r(V.map((V=>new Uint8Array(V))))),Z,m):m?m("Textures type does not support cascades."):p.b.Warn("Texture loader does not support cascades."):this._loadFile(V,(V=>r(new Uint8Array(V))),void 0,void 0,!0,v)}));else{if(!Z||0===Z.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,S,((V,O)=>{b&&b(V,O)}),Z,m)}return this._internalTexturesCache.push(S),S}},11710:(V,O,Z)=>{"use strict";Z(10983).e.prototype.createDepthStencilTexture=function(V,O,Z){if(O.isCube){const Z=V.width||V;return this._createDepthStencilCubeTexture(Z,O)}return this._createDepthStencilTexture(V,O,Z)}},11696:(V,O,Z)=>{"use strict";Z(11678).ThinEngine.prototype.setAlphaMode=function(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==V){switch(V){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}O||(this.depthCullingState.depthMask=0===V),this._alphaMode=V}else if(!O){const O=0===V;this.depthCullingState.depthMask!==O&&(this.depthCullingState.depthMask=O)}}},11673:(V,O,Z)=>{"use strict";var d=Z(11678);d.ThinEngine.prototype.updateDynamicIndexBuffer=function(V,O){let Z;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(V),Z=V.is32Bits?O instanceof Uint32Array?O:new Uint32Array(O):O instanceof Uint16Array?O:new Uint16Array(O),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,Z,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},d.ThinEngine.prototype.updateDynamicVertexBuffer=function(V,O,Z,d){this.bindArrayBuffer(V),void 0===Z&&(Z=0);const p=O.byteLength||O.length;void 0===d||d>=p&&0===Z?O instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Z,new Float32Array(O)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,Z,O):O instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(O).subarray(Z,Z+d)):(O=O instanceof ArrayBuffer?new Uint8Array(O,Z,d):new Uint8Array(O.buffer,O.byteOffset+Z,d),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,O)),this._resetVertexBufferBinding()}},11702:(V,O,Z)=>{"use strict";var d=Z(11013),p=Z(10914),r=Z(11678),Y=Z(11707);class m extends Y.d{constructor(V,O,Z,d,p){super(V,O,Z,d),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=p}_cloneRenderTargetWrapper(){let V=null;return this._colorTextureArray&&this._depthStencilTextureArray?(V=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),V.texture.isReady=!0):V=super._cloneRenderTargetWrapper(),V}_swapRenderTargetWrapper(V){super._swapRenderTargetWrapper(V),V._framebuffer=this._framebuffer,V._depthStencilBuffer=this._depthStencilBuffer,V._MSAAFramebuffer=this._MSAAFramebuffer,V._colorTextureArray=this._colorTextureArray,V._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,r=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const V=this._engine,O=V._currentFramebuffer,Z=this._context;V._bindUnboundFramebuffer(this._framebuffer),Z.framebufferRenderbuffer(Z.FRAMEBUFFER,Z.DEPTH_STENCIL_ATTACHMENT,Z.RENDERBUFFER,null),Z.framebufferRenderbuffer(Z.FRAMEBUFFER,Z.DEPTH_ATTACHMENT,Z.RENDERBUFFER,null),Z.framebufferRenderbuffer(Z.FRAMEBUFFER,Z.STENCIL_ATTACHMENT,Z.RENDERBUFFER,null),V._bindUnboundFramebuffer(O),Z.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(V,O,Z,d,p,r)}shareDepth(V){super.shareDepth(V);const O=this._context,Z=this._depthStencilBuffer,d=V._MSAAFramebuffer||V._framebuffer,p=this._engine;V._depthStencilBuffer&&V._depthStencilBuffer!==Z&&O.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=Z;const r=V._generateStencilBuffer?O.DEPTH_STENCIL_ATTACHMENT:O.DEPTH_ATTACHMENT;p._bindUnboundFramebuffer(d),O.framebufferRenderbuffer(O.FRAMEBUFFER,r,O.RENDERBUFFER,Z),p._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!V._hardwareTexture)return;const p=this._framebuffer,r=this._engine,Y=r._currentFramebuffer;if(r._bindUnboundFramebuffer(p),r.webGLVersion>1){const p=this._context,r=p["COLOR_ATTACHMENT"+O];var m;if(V.is2DArray||V.is3D)Z=Z??(null===(m=this.layerIndices)||void 0===m?void 0:m[O])??0,p.framebufferTextureLayer(p.FRAMEBUFFER,r,V._hardwareTexture.underlyingResource,d,Z);else if(V.isCube){var a;Z=Z??(null===(a=this.faceIndices)||void 0===a?void 0:a[O])??0,p.framebufferTexture2D(p.FRAMEBUFFER,r,p.TEXTURE_CUBE_MAP_POSITIVE_X+Z,V._hardwareTexture.underlyingResource,d)}else p.framebufferTexture2D(p.FRAMEBUFFER,r,p.TEXTURE_2D,V._hardwareTexture.underlyingResource,d)}else{const p=this._context,r=p["COLOR_ATTACHMENT"+O+"_WEBGL"],Y=void 0!==Z?p.TEXTURE_CUBE_MAP_POSITIVE_X+Z:p.TEXTURE_2D;p.framebufferTexture2D(p.FRAMEBUFFER,r,Y,V._hardwareTexture.underlyingResource,d)}r._bindUnboundFramebuffer(Y)}setTexture(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(V,O,Z),this._bindTextureRenderTarget(V,O)}setLayerAndFaceIndices(V,O){var Z;if(super.setLayerAndFaceIndices(V,O),!this.textures||!this.layerIndices||!this.faceIndices)return;const d=(null===(Z=this._attachments)||void 0===Z?void 0:Z.length)??this.textures.length;for(let p=0;p<d;p++){const V=this.textures[p];V&&(V.is2DArray||V.is3D?this._bindTextureRenderTarget(V,p,this.layerIndices[p]):V.isCube?this._bindTextureRenderTarget(V,p,this.faceIndices[p]):this._bindTextureRenderTarget(V,p))}}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(V,O,Z),!this.textures||!this.layerIndices||!this.faceIndices)return;const d=this.textures[V];d.is2DArray||d.is3D?this._bindTextureRenderTarget(this.textures[V],V,this.layerIndices[V]):d.isCube&&this._bindTextureRenderTarget(this.textures[V],V,this.faceIndices[V])}dispose(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const O=this._context;V||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(O.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(O.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(O.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(V)}}Z(11710);r.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(V,O,Z){const d=new m(V,O,Z,this,this._gl);return this._renderTargetWrapperCache.push(d),d},r.ThinEngine.prototype.createRenderTargetTexture=function(V,O){const Z=this._createHardwareRenderTargetWrapper(!1,!1,V);let d,p,r=!0,Y=!1,m=!1,a=1;void 0!==O&&"object"===typeof O&&(r=O.generateDepthBuffer??!0,Y=!!O.generateStencilBuffer,m=!!O.noColorAttachment,d=O.colorAttachment,a=O.samples??1,p=O.label);const R=d||(m?null:this._createInternalTexture(V,O,!0,5)),i=V.width||V,M=V.height||V,c=this._currentFramebuffer,W=this._gl,F=W.createFramebuffer();if(this._bindUnboundFramebuffer(F),Z._depthStencilBuffer=this._setupFramebufferDepthAttachments(Y,r,i,M),!R||R.is2DArray||R.is3D||W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,R._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(c),Z.label=p??"RenderTargetWrapper",Z._framebuffer=F,Z._generateDepthBuffer=r,Z._generateStencilBuffer=Y,Z.setTextures(R),d){if(Z._samples=d.samples,d.samples>1){const V=d._hardwareTexture.getMSAARenderBuffer(0);Z._MSAAFramebuffer=W.createFramebuffer(),this._bindUnboundFramebuffer(Z._MSAAFramebuffer),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.RENDERBUFFER,V),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(Z,a);return Z},r.ThinEngine.prototype._createDepthStencilTexture=function(V,O,Z){const r=this._gl,Y=V.layers||0,m=V.depth||0;let a=r.TEXTURE_2D;0!==Y?a=r.TEXTURE_2D_ARRAY:0!==m&&(a=r.TEXTURE_3D);const R=new d.d(this,12);if(R.label=O.label,!this._caps.depthTextureExtension)return p.b.Error("Depth texture is not supported by your browser or hardware."),R;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...O};if(this._bindTextureDirectly(a,R,!0),this._setupDepthStencilTexture(R,V,0!==i.comparisonFunction&&i.bilinearFiltering,i.comparisonFunction,i.samples),void 0!==i.depthTextureFormat){if(15!==i.depthTextureFormat&&16!==i.depthTextureFormat&&17!==i.depthTextureFormat&&13!==i.depthTextureFormat&&14!==i.depthTextureFormat&&18!==i.depthTextureFormat)return p.b.Error(`Depth texture ${i.depthTextureFormat} format is not supported.`),R;R.format=i.depthTextureFormat}else R.format=i.generateStencil?13:16;const M=17===R.format||13===R.format||18===R.format;let c=r.UNSIGNED_INT;15===R.format?c=r.UNSIGNED_SHORT:17===R.format||13===R.format?c=r.UNSIGNED_INT_24_8:14===R.format?c=r.FLOAT:18===R.format&&(c=r.FLOAT_32_UNSIGNED_INT_24_8_REV);const W=M?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,F=this._getInternalFormatFromDepthTextureFormat(R.format,!0,M);return R.is2DArray?r.texImage3D(a,0,F,R.width,R.height,Y,0,W,c,null):R.is3D?r.texImage3D(a,0,F,R.width,R.height,m,0,W,c,null):r.texImage2D(a,0,F,R.width,R.height,0,W,c,null),this._bindTextureDirectly(a,null),this._internalTexturesCache.push(R),Z._depthStencilBuffer&&(r.deleteRenderbuffer(Z._depthStencilBuffer),Z._depthStencilBuffer=null),this._bindUnboundFramebuffer(Z._MSAAFramebuffer??Z._framebuffer),Z._generateStencilBuffer=M,Z._depthStencilTextureWithStencil=M,Z._depthStencilBuffer=this._setupFramebufferDepthAttachments(Z._generateStencilBuffer,Z._generateDepthBuffer,Z.width,Z.height,Z.samples,R.format),this._bindUnboundFramebuffer(null),R},r.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(V,O){var Z;if(this.webGLVersion<2||!V)return 1;if(V.samples===O)return O;const d=this._gl;O=Math.min(O,this.getCaps().maxMSAASamples),V._depthStencilBuffer&&(d.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=null),V._MSAAFramebuffer&&(d.deleteFramebuffer(V._MSAAFramebuffer),V._MSAAFramebuffer=null);const p=null===(Z=V.texture)||void 0===Z?void 0:Z._hardwareTexture;if(null===p||void 0===p||p.releaseMSAARenderBuffers(),V.texture&&O>1&&"function"===typeof d.renderbufferStorageMultisample){const Z=d.createFramebuffer();if(!Z)throw new Error("Unable to create multi sampled framebuffer");V._MSAAFramebuffer=Z,this._bindUnboundFramebuffer(V._MSAAFramebuffer);const r=this._createRenderBuffer(V.texture.width,V.texture.height,O,-1,this._getRGBABufferInternalSizedFormat(V.texture.type,V.texture.format,V.texture._useSRGBBuffer),d.COLOR_ATTACHMENT0,!1);if(!r)throw new Error("Unable to create multi sampled framebuffer");null===p||void 0===p||p.addMSAARenderBuffer(r)}this._bindUnboundFramebuffer(V._MSAAFramebuffer??V._framebuffer),V.texture&&(V.texture.samples=O),V._samples=O;const r=V._depthStencilTexture?V._depthStencilTexture.format:void 0;return V._depthStencilBuffer=this._setupFramebufferDepthAttachments(V._generateStencilBuffer,V._generateDepthBuffer,V.width,V.height,O,r),this._bindUnboundFramebuffer(null),O},r.ThinEngine.prototype._setupDepthStencilTexture=function(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const r=O.width??O,Y=O.height??O,m=O.layers||0,a=O.depth||0;V.baseWidth=r,V.baseHeight=Y,V.width=r,V.height=Y,V.is2DArray=m>0,V.depth=m||a,V.isReady=!0,V.samples=p,V.generateMipMaps=!1,V.samplingMode=Z?2:1,V.type=0,V._comparisonFunction=d;const R=this._gl,i=this._getTextureTarget(V),M=this._getSamplingParameters(V.samplingMode,!1);R.texParameteri(i,R.TEXTURE_MAG_FILTER,M.mag),R.texParameteri(i,R.TEXTURE_MIN_FILTER,M.min),R.texParameteri(i,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(i,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===d?(R.texParameteri(i,R.TEXTURE_COMPARE_FUNC,515),R.texParameteri(i,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(i,R.TEXTURE_COMPARE_FUNC,d),R.texParameteri(i,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)))}},10965:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>C,e:()=>w,i:()=>t,k:()=>e,n:()=>u});class d{constructor(){this.children=[]}isValid(V){return!0}process(V,O){let Z="";if(this.line){let R=this.line;const i=O.processor;if(i){var d,p,r,Y,m,a;i.lineProcessor&&(R=i.lineProcessor(R,O.isFragment,O.processingContext));const Z=(null===(d=O.processor)||void 0===d?void 0:d.attributeKeywordName)??"attribute",M=O.isFragment&&null!==(p=O.processor)&&void 0!==p&&p.varyingFragmentKeywordName?null===(r=O.processor)||void 0===r?void 0:r.varyingFragmentKeywordName:!O.isFragment&&null!==(Y=O.processor)&&void 0!==Y&&Y.varyingVertexKeywordName?null===(m=O.processor)||void 0===m?void 0:m.varyingVertexKeywordName:"varying";if(!O.isFragment&&i.attributeProcessor&&this.line.startsWith(Z))R=i.attributeProcessor(this.line,V,O.processingContext);else if(i.varyingProcessor&&(null!==(a=i.varyingCheck)&&void 0!==a&&a.call(i,this.line,O.isFragment)||!i.varyingCheck&&this.line.startsWith(M)))R=i.varyingProcessor(this.line,O.isFragment,V,O.processingContext);else if(i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line))O.lookForClosingBracketForUniformBuffer||(R=i.uniformProcessor(this.line,O.isFragment,V,O.processingContext));else if(i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line))O.lookForClosingBracketForUniformBuffer||(R=i.uniformBufferProcessor(this.line,O.isFragment,O.processingContext),O.lookForClosingBracketForUniformBuffer=!0);else if(i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line))R=i.textureProcessor(this.line,O.isFragment,V,O.processingContext);else if((i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!O.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(R=i.uniformProcessor(this.line,O.isFragment,V,O.processingContext)):i.uniformBufferProcessor&&(R=i.uniformBufferProcessor(this.line,O.isFragment,O.processingContext),O.lookForClosingBracketForUniformBuffer=!0)}O.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(O.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(R=i.endOfUniformBufferProcessor(this.line,O.isFragment,O.processingContext)))}Z+=R+"\n"}return this.children.forEach((d=>{Z+=d.process(V,O)})),this.additionalDefineKey&&(V[this.additionalDefineKey]=this.additionalDefineValue||"true"),Z}}class p{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(V){this._lines.length=0;for(const O of V){if(!O||"\r"===O)continue;if("#"===O[0]){this._lines.push(O);continue}const V=O.trim();if(!V)continue;if(V.startsWith("//")){this._lines.push(O);continue}const Z=V.indexOf(";");if(-1===Z)this._lines.push(V);else if(Z===V.length-1)V.length>1&&this._lines.push(V);else{const V=O.split(";");for(let O=0;O<V.length;O++){let Z=V[O];Z&&(Z=Z.trim(),Z&&this._lines.push(Z+(O!==V.length-1?";":"")))}}}}}class r extends d{process(V,O){for(let Z=0;Z<this.children.length;Z++){const d=this.children[Z];if(d.isValid(V))return d.process(V,O)}return""}}class Y extends d{isValid(V){return this.testExpression.isTrue(V)}}class m{isTrue(V){return!0}static postfixToInfix(V){const O=[];for(const Z of V)if(void 0===m._OperatorPriority[Z])O.push(Z);else{const V=O[O.length-1],d=O[O.length-2];O.length-=2,O.push(`(${d}${Z}${V})`)}return O[O.length-1]}static infixToPostfix(V){const O=m._InfixToPostfixCache.get(V);if(O)return O.accessTime=Date.now(),O.result;if(!V.includes("&&")&&!V.includes("||")&&!V.includes(")")&&!V.includes("("))return[V];const Z=[];let d=-1;const p=()=>{i=i.trim(),""!==i&&(Z.push(i),i="")},r=V=>{d<m._Stack.length-1&&(m._Stack[++d]=V)},Y=()=>m._Stack[d],a=()=>-1===d?"!!INVALID EXPRESSION!!":m._Stack[d--];let R=0,i="";for(;R<V.length;){const O=V.charAt(R),M=R<V.length-1?V.substring(R,2+R):"";if("("===O)i="",r(O);else if(")"===O){for(p();-1!==d&&"("!==Y();)Z.push(a());a()}else if(m._OperatorPriority[M]>1){for(p();-1!==d&&m._OperatorPriority[Y()]>=m._OperatorPriority[M];)Z.push(a());r(M),R++}else i+=O;R++}for(p();-1!==d;)"("===Y()?a():Z.push(a());return m._InfixToPostfixCache.size>=m.InfixToPostfixCacheLimitSize&&m.ClearCache(),m._InfixToPostfixCache.set(V,{result:Z,accessTime:Date.now()}),Z}static ClearCache(){const V=Array.from(m._InfixToPostfixCache.entries()).sort(((V,O)=>V[1].accessTime-O[1].accessTime));for(let O=0;O<m.InfixToPostfixCacheCleanupSize;O++)m._InfixToPostfixCache.delete(V[O][0])}}m.InfixToPostfixCacheLimitSize=5e4,m.InfixToPostfixCacheCleanupSize=25e3,m._InfixToPostfixCache=new Map,m._OperatorPriority={")":0,"(":1,"||":2,"&&":3},m._Stack=["","","","","","","","","","","","","","","","","","","",""];class a extends m{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=V,this.not=O}isTrue(V){let O=void 0!==V[this.define];return this.not&&(O=!O),O}}class R extends m{isTrue(V){return this.leftOperand.isTrue(V)||this.rightOperand.isTrue(V)}}class i extends m{isTrue(V){return this.leftOperand.isTrue(V)&&this.rightOperand.isTrue(V)}}class M extends m{constructor(V,O,Z){super(),this.define=V,this.operand=O,this.testValue=Z}isTrue(V){let O=V[this.define];void 0===O&&(O=this.define);let Z=!1;const d=parseInt(O),p=parseInt(this.testValue);switch(this.operand){case">":Z=d>p;break;case"<":Z=d<p;break;case"<=":Z=d<=p;break;case">=":Z=d>=p;break;case"==":Z=d===p;break;case"!=":Z=d!==p}return Z}}var c=Z(10928),W=Z(10970);const F=/defined\s*?\((.+?)\)/g,Q=/defined\s*?\[(.+?)\]/g,b=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,U=/__decl__/,H=/light\{X\}.(\w*)/g,S=/\{X\}/g,z=[],G=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function w(V){V.processor&&V.processor.initializeShaders&&V.processor.initializeShaders(V.processingContext)}function t(V,O,Z,d){var p;null!==(p=O.processor)&&void 0!==p&&p.preProcessShaderCode&&(V=O.processor.preProcessShaderCode(V,O.isFragment)),e(V,O,(V=>{O.processCodeAfterIncludes&&(V=O.processCodeAfterIncludes(O.isFragment?"fragment":"vertex",V,O.defines));const p=function(V,O,Z){let d=function(V,O){var Z;if(null!==(Z=O.processor)&&void 0!==Z&&Z.noPrecision)return V;const d=O.shouldUseHighPrecisionShader;-1===V.indexOf("precision highp float")?V=d?"precision highp float;\n"+V:"precision mediump float;\n"+V:d||(V=V.replace("precision highp float","precision mediump float"));return V}(V,O);if(!O.processor)return d;if(0===O.processor.shaderLanguage&&-1!==d.indexOf("#version 3")&&(d=d.replace("#version 300 es",""),!O.processor.parseGLES3))return d;const p=O.defines,r=n(O,Z);O.processor.preProcessor&&(d=O.processor.preProcessor(d,p,r,O.isFragment,O.processingContext));d=g(d,r,O),O.processor.postProcessor&&(d=O.processor.postProcessor(d,p,O.isFragment,O.processingContext,Z?{drawBuffersExtensionDisabled:!Z.getCaps().drawBuffersExtension}:{}));null!==Z&&void 0!==Z&&Z._features.needShaderCodeInlining&&(d=Z.inlineShaderCode(d));return d}(V,O,d);Z(p,V)}))}function C(V,O,Z){return Z.processor&&Z.processor.finalizeShaders?Z.processor.finalizeShaders(V,O,Z.processingContext):{vertexCode:V,fragmentCode:O}}function v(V){const O=/defined\((.+)\)/.exec(V);if(O&&O.length)return new a(O[1].trim(),"!"===V[0]);const Z=["==","!=",">=","<=","<",">"];let d="",p=0;for(d of Z)if(p=V.indexOf(d),p>-1)break;if(-1===p)return new a(V);const r=V.substring(0,p).trim(),Y=V.substring(p+d.length).trim();return new M(r,d,Y)}function A(V,O){const Z=new Y,d=V.substring(0,O);let p=V.substring(O);return p=p.substring(0,(p.indexOf("//")+1||p.length+1)-1).trim(),Z.testExpression="#ifdef"===d?new a(p):"#ifndef"===d?new a(p,!0):function(V){V=V.replace(F,"defined[$1]");const O=m.infixToPostfix(V),Z=[];for(const p of O)if("||"!==p&&"&&"!==p)Z.push(p);else if(Z.length>=2){let V=Z[Z.length-1],O=Z[Z.length-2];Z.length-=2;const d="&&"==p?new i:new R;"string"===typeof V&&(V=V.replace(Q,"defined($1)")),"string"===typeof O&&(O=O.replace(Q,"defined($1)")),d.leftOperand="string"===typeof O?v(O):O,d.rightOperand="string"===typeof V?v(V):V,Z.push(d)}let d=Z[Z.length-1];return"string"===typeof d&&(d=d.replace(Q,"defined($1)")),"string"===typeof d?v(d):d}(p),Z}function l(V,O,Z){let p=V.currentLine;for(;I(V,Z);){p=V.currentLine;const r=p.substring(0,5).toLowerCase();if("#else"===r){const Z=new d;return O.children.push(Z),void I(V,Z)}if("#elif"===r){const V=A(p,5);O.children.push(V),Z=V}}}function I(V,O){for(;V.canRead;){V.lineIndex++;const Z=V.currentLine;if(Z.indexOf("#")>=0){const d=G.exec(Z);if(d&&d.length){switch(d[0]){case"#ifdef":{const d=new r;O.children.push(d);const p=A(Z,6);d.children.push(p),l(V,d,p);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const d=new r;O.children.push(d);const p=A(Z,7);d.children.push(p),l(V,d,p);break}case"#if":{const d=new r,p=A(Z,3);O.children.push(d),d.children.push(p),l(V,d,p);break}}continue}}const p=new d;if(p.line=Z,O.children.push(p),"#"===Z[0]&&"d"===Z[1]){const V=Z.replace(";","").split(" ");p.additionalDefineKey=V[1],3===V.length&&(p.additionalDefineValue=V[2])}}return!1}function g(V,O,Z){const r=new d,Y=new p;return Y.lineIndex=-1,Y.lines=V.split("\n"),I(Y,r),r.process(O,Z)}function n(V,O){var Z;const d=V.defines,p={};for(const r of d){const V=r.replace("#define","").replace(";","").trim().split(" ");p[V[0]]=V.length>1?V[1]:""}return 0===(null===(Z=V.processor)||void 0===Z?void 0:Z.shaderLanguage)&&(p.GL_ES="true"),p.__VERSION__=V.version,p[V.platformName]="true",(0,W.f)(p,null===O||void 0===O?void 0:O.isNDCHalfZRange,null===O||void 0===O?void 0:O.useReverseDepthBuffer,null===O||void 0===O?void 0:O.useExactSrgbConversions),p}function e(V,O,Z){let d;for(z.length=0;null!==(d=b.exec(V));)z.push(d);let p=String(V),r=[V],Y=!1;for(const m of z){let V=m[1];if(-1!==V.indexOf("__decl__")&&(V=V.replace(U,""),O.supportsUniformBuffers&&(V=V.replace("Vertex","Ubo").replace("Fragment","Ubo")),V+="Declaration"),!O.includesShadersStore[V]){const d=O.shadersRepository+"ShadersInclude/"+V+".fx";return void u.loadFile(d,(d=>{O.includesShadersStore[V]=d,e(r.join(""),O,Z)}))}{let Z=O.includesShadersStore[V];if(m[2]){const V=m[3].split(",");for(let O=0;O<V.length;O+=2){const d=new RegExp(V[O],"g"),p=V[O+1];Z=Z.replace(d,p)}}if(m[4]){const V=m[5];if(-1!==V.indexOf("..")){const d=V.split(".."),p=parseInt(d[0]);let r=parseInt(d[1]),Y=Z.slice(0);Z="",isNaN(r)&&(r=O.indexParameters[d[1]]);for(let V=p;V<r;V++)O.supportsUniformBuffers||(Y=Y.replace(H,((V,O)=>O+"{X}"))),Z+=Y.replace(S,V.toString())+"\n"}else O.supportsUniformBuffers||(Z=Z.replace(H,((V,O)=>O+"{X}"))),Z=Z.replace(S,V)}const d=[];for(const V of r){const O=V.split(m[0]);for(let V=0;V<O.length-1;V++)d.push(O[V]),d.push(Z);d.push(O[O.length-1])}r=d,Y=Y||Z.indexOf("#include<")>=0||Z.indexOf("#include <")>=0}}z.length=0,p=r.join(""),Y?e(p.toString(),O,Z):Z(p)}const u={loadFile:(V,O,Z,d,p,r)=>{throw(0,c.c)("FileTools")}}},11689:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{get underlyingResource(){return this._webGLTexture}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=O,!V&&(V=O.createTexture(),!V))throw new Error("Unable to create webGL texture");this.set(V)}setUsage(){}set(V){this._webGLTexture=V}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(V){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(V)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const V of this._MSAARenderBuffers)this._context.deleteRenderbuffer(V);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._MSAARenderBuffers)||void 0===V?void 0:V[O])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10970:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>p,d:()=>r,f:()=>m,j:()=>Y,l:()=>a});var d=Z(10928);Z(10906);const p={};function r(V,O){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(O?O+"\n":"")+V}function Y(V,O,Z,r,Y,m,a){const R=a||p.loadFile;if(R){return R(V,O,Z,r,Y,m)}throw(0,d.c)("FileTools")}function m(V,O,Z,d){if(V)return O?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,Z?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(d?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return O&&(V+="#define IS_NDC_HALF_ZRANGE"),Z&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),d&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}function a(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;switch(V){case 3:{const V=(ArrayBuffer,new Int8Array(O));return d&&V.set(new Int8Array(d)),V}case 0:{const V=(ArrayBuffer,new Uint8Array(O));return d&&V.set(new Uint8Array(d)),V}case 4:{const V=O instanceof ArrayBuffer?new Int16Array(O):new Int16Array(Z?O/2:O);return d&&V.set(new Int16Array(d)),V}case 5:case 8:case 9:case 10:case 2:{const V=O instanceof ArrayBuffer?new Uint16Array(O):new Uint16Array(Z?O/2:O);return d&&V.set(new Uint16Array(d)),V}case 6:{const V=O instanceof ArrayBuffer?new Int32Array(O):new Int32Array(Z?O/4:O);return d&&V.set(new Int32Array(d)),V}case 7:case 11:case 12:case 13:case 14:case 15:{const V=O instanceof ArrayBuffer?new Uint32Array(O):new Uint32Array(Z?O/4:O);return d&&V.set(new Uint32Array(d)),V}case 1:{const V=O instanceof ArrayBuffer?new Float32Array(O):new Float32Array(Z?O/4:O);return d&&V.set(new Float32Array(d)),V}}const p=(ArrayBuffer,new Uint8Array(O));return d&&p.set(new Uint8Array(d)),p}},10983:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>S});var d=Z(10942),p=Z(10914),r=Z(10986),Y=Z(11006),m=Z(10926);class a{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,V&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(V){this._zOffset!==V&&(this._zOffset=V,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(V){this._zOffsetUnits!==V&&(this._zOffsetUnits=V,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(V){this._cullFace!==V&&(this._cullFace=V,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(V){this._cull!==V&&(this._cull=V,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(V){this._depthFunc!==V&&(this._depthFunc=V,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(V){this._depthMask!==V&&(this._depthMask=V,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(V){this._depthTest!==V&&(this._depthTest=V,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(V){this._frontFace!==V&&(this._frontFace=V,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(V){this.isDirty&&(this._isCullDirty&&(this.cull?V.enable(V.CULL_FACE):V.disable(V.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(V.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(V.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?V.enable(V.DEPTH_TEST):V.disable(V.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(V.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(V.enable(V.POLYGON_OFFSET_FILL),V.polygonOffset(this.zOffset,this.zOffsetUnits)):V.disable(V.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(V.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class R{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(V){this._func!==V&&(this._func=V,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef!==V&&(this._funcRef=V,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask!==V&&(this._funcMask=V,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail!==V&&(this._opStencilFail=V,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail!==V&&(this._opDepthFail=V,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass!==V&&(this._opStencilDepthPass=V,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(V){this._mask!==V&&(this._mask=V,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(V){this._enabled!==V&&(this._enabled=V,this._isStencilTestDirty=!0)}constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,V&&this.reset()}reset(){var V;this.stencilMaterial=void 0,null===(V=this.stencilGlobal)||void 0===V||V.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(V){var O;if(!V)return;const Z=!this.useStencilGlobalOnly&&!(null===(O=this.stencilMaterial)||void 0===O||!O.enabled);this.enabled=Z?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=Z?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=Z?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=Z?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=Z?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=Z?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=Z?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=Z?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?V.enable(V.STENCIL_TEST):V.disable(V.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(V.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(V.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(V.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class i{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=i.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=i.KEEP,this.opDepthFail=i.KEEP,this.opStencilDepthPass=i.REPLACE}get stencilFunc(){return this.func}set stencilFunc(V){this.func=V}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(V){this.funcRef=V}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(V){this.funcMask=V}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(V){this.opStencilFail=V}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(V){this.opDepthFail=V}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(V){this.opStencilDepthPass=V}get stencilMask(){return this.mask}set stencilMask(V){this.mask=V}get stencilTest(){return this.enabled}set stencilTest(V){this.enabled=V}}i.ALWAYS=519,i.KEEP=7680,i.REPLACE=7681;class M{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(V){this._alphaBlend!==V&&(this._alphaBlend=V,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(V,O,Z,d){this._blendConstants[0]===V&&this._blendConstants[1]===O&&this._blendConstants[2]===Z&&this._blendConstants[3]===d||(this._blendConstants[0]=V,this._blendConstants[1]=O,this._blendConstants[2]=Z,this._blendConstants[3]=d,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(V,O,Z,d){this._blendFunctionParameters[0]===V&&this._blendFunctionParameters[1]===O&&this._blendFunctionParameters[2]===Z&&this._blendFunctionParameters[3]===d||(this._blendFunctionParameters[0]=V,this._blendFunctionParameters[1]=O,this._blendFunctionParameters[2]=Z,this._blendFunctionParameters[3]=d,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(V,O){this._blendEquationParameters[0]===V&&this._blendEquationParameters[1]===O||(this._blendEquationParameters[0]=V,this._blendEquationParameters[1]=O,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(V){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?V.enable(V.BLEND):V.disable(V.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(V.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(V.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(V.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var c=Z(10928),W=Z(11013),F=Z(10906),Q=Z(10902),b=Z(10970),U=Z(11028);function H(V,O){if((0,F.n)()){const{requestAnimationFrame:Z}=O||window;if("function"===typeof Z)return Z(V)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(V);return setTimeout(V,16)}class S{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(V){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(V){V!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=V,this._depthCullingState.depthFunc=V?518:515)}setColorWrite(V){V!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=V)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(V){if(V)return this.isNDCHalfZRange?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return this.isNDCHalfZRange&&(V+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}_rebuildInternalTextures(){const V=this._internalTexturesCache.slice();for(const O of V)O._rebuild()}_rebuildRenderTargetWrappers(){const V=this._renderTargetWrapperCache.slice();for(const O of V)O._rebuild()}_rebuildEffects(){for(const V in this._compiledEffects){const O=this._compiledEffects[V];O._pipelineContext=null,O._prepareEffect()}r.c.ResetCache()}_rebuildGraphicsResources(){var V;this.wipeCaches(!0),this._rebuildEffects(),null===(V=this._rebuildComputeEffects)||void 0===V||V.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){p.b.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(V){setTimeout((async()=>{this._clearEmptyResources();const O=this._depthCullingState.depthTest,Z=this._depthCullingState.depthFunc,d=this._depthCullingState.depthMask,p=this._stencilState.stencilTest;await V(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=O,this._depthCullingState.depthFunc=Z,this._depthCullingState.depthMask=d,this._stencilState.stencilTest=p,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(V){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(V){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const V=new Uint8Array(4),O=[V,V,V,V,V,V];this._emptyCubeTexture=this.createRawCubeTexture(O,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(V){if(!V)return this._activeRenderLoops.length=0,void this._cancelFrame();const O=this._activeRenderLoops.indexOf(V);O>=0&&(this._activeRenderLoops.splice(O,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const V=this._frameHandler;if(this._frameHandler=0,(0,F.n)()){const{cancelAnimationFrame:O}=this.getHostWindow()||window;if("function"===typeof O)return O(V)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(V);return clearTimeout(V)}}Si(){this.onBeginFrameObservable.notifyObservers(this)}Ti(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let V=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(V=!1),V&&(this.Si(),this._renderViews()||this._renderFrame(),this.Ti())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let V=0;V<this._activeRenderLoops.length;V++){(0,this._activeRenderLoops[V])()}}_renderViews(){return!1}_queueNewFrame(V,O){return H(V,O)}runRenderLoop(V){-1===this._activeRenderLoops.indexOf(V)&&(this._activeRenderLoops.push(V),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(V){this._depthCullingState.depthTest=V}setZOffset(V){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-V:V}getZOffset(){const V=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-V:V}setZOffsetUnits(V){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-V:V}getZOffsetUnits(){const V=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-V:V}getHostWindow(){return(0,F.n)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(V){this._compatibilityMode=!0}_rebuildTextures(){for(const V of this.scenes)V._rebuildTextures();for(const V of this._virtualScenes)V._rebuildTextures()}_releaseRenderTargetWrapper(V){const O=this._renderTargetWrapperCache.indexOf(V);-1!==O&&this._renderTargetWrapperCache.splice(O,1)}get currentViewport(){return this._cachedViewport}setViewport(V,O,Z){const d=O||this.getRenderWidth(),p=Z||this.getRenderHeight(),r=V.x||0,Y=V.y||0;this._cachedViewport=V,this._viewport(r*d,Y*p,d*V.width,p*V.height)}createCanvasImage(){return document.createElement("img")}get description(){let V=this.name+this.version;return this._caps.parallelShaderCompile&&(V+=" - Parallel shader compilation"),V}_createTextureBase(V,O,Z,r){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0,i=arguments.length>8?arguments[8]:void 0,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,b=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0,z=arguments.length>15?arguments[15]:void 0;const G="data:"===(V=V||"").substr(0,5),w="blob:"===V.substr(0,5),t=G&&-1!==V.indexOf(";base64,"),C=c||new W.d(this,1);C!==c&&(C.label=V.substring(0,60));const v=V;!this._transformTextureUrl||t||c||M||(V=this._transformTextureUrl(V)),v!==V&&(C._originalUrl=v);const A=V.lastIndexOf(".");let l=Q||(A>-1?V.substring(A).toLowerCase():"");l.indexOf("?")>-1&&(l=l.split("?")[0]);const I=(0,U.d)(l,b);r&&r.addPendingData(C),C.url=V,C.generateMipMaps=!O,C.samplingMode=Y,C.invertY=Z,C._useSRGBBuffer=this._getUseSRGBBuffer(!!z,O),this._doNotHandleContextLost||(C._buffer=M);let g=null;m&&!c&&(g=C.onLoadedObservable.add(m)),c||this._internalTexturesCache.push(C);const n=(Z,c)=>{r&&r.removePendingData(C),V===v?(g&&C.onLoadedObservable.remove(g),d.e.UseFallbackTexture&&V!==d.e.FallbackTexture&&this._createTextureBase(d.e.FallbackTexture,O,C.invertY,r,Y,null,a,R,i,M,C),Z=(Z||"Unknown error")+(d.e.UseFallbackTexture?" - Fallback texture was used":""),C.onErrorObservable.notifyObservers({message:Z,exception:c}),a&&a(Z,c)):(p.b.Warn(`Failed to load ${V}, falling back to ${v}`),this._createTextureBase(v,O,C.invertY,r,Y,m,a,R,i,M,C,F,Q,b,H,z))};if(I){const O=async V=>{(await I).loadData(V,C,((V,O,Z,d,p,m)=>{m?n("TextureLoader failed to load data"):R(C,l,r,{width:V,height:O},C.invertY,!Z,d,(()=>(p(),!1)),Y)}),H)};M?M instanceof ArrayBuffer?O(new Uint8Array(M)):ArrayBuffer.isView(M)?O(M):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(V,(V=>O(new Uint8Array(V))),void 0,r?r.offlineProvider:void 0,!0,((V,O)=>{n("Unable to load "+(V&&V.responseURL,O))}))}else{const Z=V=>{w&&!this._doNotHandleContextLost&&(C._buffer=V),R(C,l,r,V,C.invertY,O,!1,i,Y)};!G||t?M&&("string"===typeof M.decoding||M.close)?Z(M):S._FileToolsLoadImage(V||"",Z,n,r?r.offlineProvider:null,b,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof M||M instanceof ArrayBuffer||ArrayBuffer.isView(M)||M instanceof Blob?S._FileToolsLoadImage(M,Z,n,r?r.offlineProvider:null,b,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):M&&Z(M)}return C}_rebuildBuffers(){for(const V of this._uniformBuffers)V._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,F.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const V in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,V)&&(this._boundTexturesCache[V]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(V){this._name=V}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(V){this._hardwareScalingLevel=V,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(V){this._doNotHandleContextLost=V}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(V,O,Z){var p,r;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new a,this._stencilStateComposer=new R,this._stencilState=new i,this._alphaState=new M,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new Q.e,this.onCanvasFocusObservable=new Q.e,this.onNewSceneAddedObservable=new Q.e,this.onResizeObservable=new Q.e,this.onCanvasPointerOutObservable=new Q.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new Q.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new Q.e,this.onAfterShaderCompilationObservable=new Q.e,this.onBeginFrameObservable=new Q.e,this.onEndFrameObservable=new Q.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new Q.e,this.onContextRestoredObservable=new Q.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Xi=new Q.e,d.e.Instances.push(this),this.startTime=m.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,Y.b.SetMatrixPrecision(!!O.useHighPrecisionMatrix),(0,F.j)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=Z??!1,O.antialias=V??O.antialias,O.deterministicLockstep=O.deterministicLockstep??!1,O.lockstepMaxSteps=O.lockstepMaxSteps??4,O.timeStep=O.timeStep??1/60,O.audioEngine=O.audioEngine??!0,O.stencil=O.stencil??!0,this._audioContext=(null===(p=O.audioEngineOptions)||void 0===p?void 0:p.audioContext)??null,this._audioDestination=(null===(r=O.audioEngineOptions)||void 0===r?void 0:r.audioDestination)??null,this.premultipliedAlpha=O.premultipliedAlpha??!0,this._doNotHandleContextLost=!!O.doNotHandleContextLost,this._isStencilEnable=!!O.stencil,this.useExactSrgbConversions=O.useExactSrgbConversions??!1;const c=(0,F.n)()&&window.devicePixelRatio||1,W=O.limitDeviceRatio||c;Z=Z||O.adaptToDeviceRatio||!1,this._hardwareScalingLevel=Z?1/Math.min(W,c):1,this._lastDevicePixelRatio=c,this._creationOptions=O}resize(){let V,O,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const V=(0,F.n)()&&window.devicePixelRatio||1,O=this._lastDevicePixelRatio/V;this._lastDevicePixelRatio=V,this._hardwareScalingLevel*=O}if((0,F.n)()&&(0,F.f)())if(this._renderingCanvas){const Z=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};V=this._renderingCanvas.clientWidth||Z.width||this._renderingCanvas.width||100,O=this._renderingCanvas.clientHeight||Z.height||this._renderingCanvas.height||100}else V=window.innerWidth,O=window.innerHeight;else V=this._renderingCanvas?this._renderingCanvas.width:100,O=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(V/this._hardwareScalingLevel,O/this._hardwareScalingLevel,Z)}setSize(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(V|=0,O|=0,!Z&&this._renderingCanvas.width===V&&this._renderingCanvas.height===O)return!1;if(this._renderingCanvas.width=V,this._renderingCanvas.height=O,this.scenes){for(let V=0;V<this.scenes.length;V++){const O=this.scenes[V];for(let V=0;V<O.cameras.length;V++){O.cameras[V]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(V,O,Z,d,p,r,Y,m,a,R,i){throw(0,c.c)("engine.rawTexture")}createRawCubeTexture(V,O,Z,d,p,r,Y,m){throw(0,c.c)("engine.rawTexture")}createRawTexture3D(V,O,Z,d,p,r,Y,m,a,R,i){throw(0,c.c)("engine.rawTexture")}createRawTexture2DArray(V,O,Z,d,p,r,Y,m,a,R,i){throw(0,c.c)("engine.rawTexture")}_sharedInit(V){this._renderingCanvas=V}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const V=navigator.userAgent;this.hostInformation.isMobile=-1!==V.indexOf("Mobile")||-1!==V.indexOf("Mac")&&(0,F.f)()&&"ontouchend"in document},this._checkForMobile(),(0,F.n)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(V){return document.createElement("video")}_reportDrawCall(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(V=this._drawCalls)||void 0===V||V.addCount(O,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(V,O){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(V,O){return createImageBitmap(V,O)}resizeImageBitmap(V,O,Z){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(V){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(V,O){if("undefined"===typeof document)return new OffscreenCanvas(V,O);const Z=document.createElement("canvas");return Z.width=V,Z.height=O,Z}createCanvas(V,O){return S._CreateCanvas(V,O)}static _FileToolsLoadImage(V,O,Z,d,p,r){throw(0,c.c)("FileTools")}_loadFile(V,O,Z,d,p,r){const Y=(0,b.j)(V,O,Z,d,p,r);return this._activeRequests.push(Y),Y.onCompleteObservable.add((()=>{const V=this._activeRequests.indexOf(Y);-1!==V&&this._activeRequests.splice(V,1)})),Y}static _FileToolsLoadFile(V,O,Z,d,p,r){if(b.b.loadFile)return b.b.loadFile(V,O,Z,d,p,r);throw(0,c.c)("FileTools")}dispose(){var V;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(V=this.releaseComputeEffects)||void 0===V||V.call(this),r.c.ResetCache();for(const Z of this._activeRequests)Z.abort();this._boundRenderFunction=null,this.Xi.notifyObservers(this),this.Xi.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,F.n)()&&window.removeEventListener("resize",this._checkForMobile);const O=d.e.Instances.indexOf(this);O>=0&&d.e.Instances.splice(O,1),d.e.Instances.length||(d.e.OnEnginesDisposedObservable.notifyObservers(this),d.e.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(V){throw(0,c.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(V,O){for(let Z=0;Z<d.e.Instances.length;Z++){const p=d.e.Instances[Z];for(let Z=0;Z<p.scenes.length;Z++)p.scenes[Z].markAllMaterialsAsDirty(V,O)}}}S._RenderPassIdCounter=0,S._RescalePostProcessFactory=null,S.CollisionsEpsilon=.001,S.QueueNewFrame=H},11698:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>C});var d=Z(11013),p=Z(10942),r=Z(11678),Y=Z(10926);class m{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new a(V)}sampleFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const O=V-this._lastFrameTimeMs;this._rollingFrameTime.add(O)}this._lastFrameTimeMs=V}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const V=this._rollingFrameTime.history(0);return 0===V?0:1e3/V}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class a{constructor(V){this._samples=new Array(V),this.reset()}add(V){let O;if(this.isSaturated()){const V=this._samples[this._pos];O=V-this.average,this.average-=O/(this._sampleCount-1),this._m2-=O*(V-this.average)}else this._sampleCount++;O=V-this.average,this.average+=O/this._sampleCount,this._m2+=O*(V-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=V,this._pos++,this._pos%=this._samples.length}history(V){if(V>=this._sampleCount||V>=this._samples.length)return 0;const O=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(O-V)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(V){const O=this._samples.length;return(V%O+O)%O}}var R=Z(11686),i=Z(10914),M=Z(11689),c=(Z(11696),Z(11049));function W(V,O,Z,d){let p,r=1;1===d?p=new Float32Array(O*Z*4):2===d?(p=new Uint16Array(O*Z*4),r=15360):p=7===d?new Uint32Array(O*Z*4):new Uint8Array(O*Z*4);for(let Y=0;Y<O;Y++)for(let d=0;d<Z;d++){const Z=3*(d*O+Y),m=4*(d*O+Y);p[m+0]=V[Z+0],p[m+1]=V[Z+1],p[m+2]=V[Z+2],p[m+3]=r}return p}function F(V){return function(O,Z,p,r,Y,m,a,R){let i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const c=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,W=V?10:11,F=new d.d(this,W);F.baseWidth=Z,F.baseHeight=p,F.baseDepth=r,F.width=Z,F.height=p,F.depth=r,F.format=Y,F.type=M,F.generateMipMaps=m,F.samplingMode=R,V?F.is3D=!0:F.is2DArray=!0,this._doNotHandleContextLost||(F._bufferView=O),V?this.updateRawTexture3D(F,O,Y,a,i,M):this.updateRawTexture2DArray(F,O,Y,a,i,M),this._bindTextureDirectly(c,F,!0);const Q=this._getSamplingParameters(R,m);return this._gl.texParameteri(c,this._gl.TEXTURE_MAG_FILTER,Q.mag),this._gl.texParameteri(c,this._gl.TEXTURE_MIN_FILTER,Q.min),m&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),this._internalTexturesCache.push(F),F}}function Q(V){return function(O,Z,d,p){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const m=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,a=this._getWebGLTextureType(Y),R=this._getInternalFormat(d),i=this._getRGBABufferInternalSizedFormat(Y,d);this._bindTextureDirectly(m,O,!0),this._unpackFlipY(void 0===p||!!p),this._doNotHandleContextLost||(O._bufferView=Z,O.format=d,O.invertY=p,O._compression=r),O.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&Z?this._gl.compressedTexImage3D(m,0,this.getCaps().s3tc[r],O.width,O.height,O.depth,0,Z):this._gl.texImage3D(m,0,i,O.width,O.height,O.depth,0,R,a,Z),O.generateMipMaps&&this._gl.generateMipmap(m),this._bindTextureDirectly(m,null),O.isReady=!0}}r.ThinEngine.prototype.updateRawTexture=function(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!V)return;const m=this._getRGBABufferInternalSizedFormat(r,Z,Y),a=this._getInternalFormat(Z),R=this._getWebGLTextureType(r);this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===d||!!d),this._doNotHandleContextLost||(V._bufferView=O,V.format=Z,V.type=r,V.invertY=d,V._compression=p),V.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),p&&O?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[p],V.width,V.height,0,O):this._gl.texImage2D(this._gl.TEXTURE_2D,0,m,V.width,V.height,0,a,R,O),V.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),V.isReady=!0},r.ThinEngine.prototype.createRawTexture=function(V,O,Z,p,r,Y,m){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const M=new d.d(this,3);M.baseWidth=O,M.baseHeight=Z,M.width=O,M.height=Z,M.format=p,M.generateMipMaps=r,M.samplingMode=m,M.invertY=Y,M._compression=a,M.type=R,M._useSRGBBuffer=this._getUseSRGBBuffer(i,!r),this._doNotHandleContextLost||(M._bufferView=V),this.updateRawTexture(M,V,p,Y,a,R,M._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,M,!0);const c=this._getSamplingParameters(m,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(M),M},r.ThinEngine.prototype.createRawCubeTexture=function(V,O,Z,p,r,Y,m){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const R=this._gl,M=new d.d(this,8);M.isCube=!0,M.format=Z,M.type=p,this._doNotHandleContextLost||(M._bufferViewArray=V);const W=this._getWebGLTextureType(p);let F=this._getInternalFormat(Z);F===R.RGB&&(F=R.RGBA),W!==R.FLOAT||this._caps.textureFloatLinearFiltering?W!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?W!==R.FLOAT||this._caps.textureFloatRender?W!==R.HALF_FLOAT||this._caps.colorBufferFloat||(r=!1,i.b.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(r=!1,i.b.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(r=!1,m=1,i.b.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(r=!1,m=1,i.b.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const Q=O,b=Q;M.width=Q,M.height=b,M.invertY=Y,M._compression=a;if(!this.needPOTTextures||(0,c.k)(M.width)&&(0,c.k)(M.height)||(r=!1),V)this.updateRawCubeTexture(M,V,Z,p,Y,a);else{const V=this._getRGBABufferInternalSizedFormat(p),O=0;this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,M,!0);for(let Z=0;Z<6;Z++)a?R.compressedTexImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Z,O,this.getCaps().s3tc[a],M.width,M.height,0,void 0):R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Z,O,V,M.width,M.height,0,F,W,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,M,!0),V&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const U=this._getSamplingParameters(m,r);return R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_MAG_FILTER,U.mag),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_MIN_FILTER,U.min),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null),M.generateMipMaps=r,M.samplingMode=m,M.isReady=!0,M},r.ThinEngine.prototype.updateRawCubeTexture=function(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;V._bufferViewArray=O,V.format=Z,V.type=d,V.invertY=p,V._compression=r;const m=this._gl,a=this._getWebGLTextureType(d);let R=this._getInternalFormat(Z);const i=this._getRGBABufferInternalSizedFormat(d);let M=!1;R===m.RGB&&(R=m.RGBA,M=!0),this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(void 0===p||!!p),V.width%4!==0&&m.pixelStorei(m.UNPACK_ALIGNMENT,1);for(let c=0;c<6;c++){let Z=O[c];r?m.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+c,Y,this.getCaps().s3tc[r],V.width,V.height,0,Z):(M&&(Z=W(Z,V.width,V.height,d)),m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+c,Y,i,V.width,V.height,0,R,a,Z))}(!this.needPOTTextures||(0,c.k)(V.width)&&(0,c.k)(V.height))&&V.generateMipMaps&&0===Y&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),V.isReady=!0},r.ThinEngine.prototype.createRawCubeTextureFromUrl=function(V,O,Z,d,p,r,Y,m){let a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,M=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const c=this._gl,F=this.createRawCubeTexture(null,Z,d,p,!r,M,i,null);null===O||void 0===O||O.addPendingData(F),F.url=V,F.isReady=!1,this._internalTexturesCache.push(F);const Q=V=>{const Z=F.width,r=Y(V);if(r){if(m){const V=this._getWebGLTextureType(p);let O=this._getInternalFormat(d);const Y=this._getRGBABufferInternalSizedFormat(p);let a=!1;O===c.RGB&&(O=c.RGBA,a=!0),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,F,!0),this._unpackFlipY(!1);const R=m(r);for(let d=0;d<R.length;d++){const r=Z>>d;for(let Z=0;Z<6;Z++){let m=R[d][Z];a&&(m=W(m,r,r,p)),c.texImage2D(Z,d,Y,r,r,0,O,V,m)}}this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(F,r,d,p,M);F.isReady=!0,null===O||void 0===O||O.removePendingData(F),F.onLoadedObservable.notifyObservers(F),F.onLoadedObservable.clear(),a&&a()}};return this._loadFile(V,(V=>{Q(V)}),void 0,null===O||void 0===O?void 0:O.offlineProvider,!0,((V,Z)=>{null===O||void 0===O||O.removePendingData(F),R&&V&&R(V.status+" "+V.statusText,Z)})),F},r.ThinEngine.prototype.createRawTexture2DArray=F(!1),r.ThinEngine.prototype.createRawTexture3D=F(!0),r.ThinEngine.prototype.updateRawTexture2DArray=Q(!1),r.ThinEngine.prototype.updateRawTexture3D=Q(!0);var b=Z(10970);r.ThinEngine.prototype._readTexturePixelsSync=function(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const i=this._gl;if(!i)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const V=i.createFramebuffer();if(!V)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=V}var M,c;(i.bindFramebuffer(i.FRAMEBUFFER,this._dummyFramebuffer),d>-1)?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(M=V._hardwareTexture)||void 0===M?void 0:M.underlyingResource,p):i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null===(c=V._hardwareTexture)||void 0===c?void 0:c.underlyingResource,p);let W=void 0!==V.type?this._getWebGLTextureType(V.type):i.UNSIGNED_BYTE;if(m)r||(r=(0,b.l)(V.type,4*O*Z));else if(W===i.UNSIGNED_BYTE)r||(r=new Uint8Array(4*O*Z)),W=i.UNSIGNED_BYTE;else r||(r=new Float32Array(4*O*Z)),W=i.FLOAT;return Y&&this.flushFramebuffer(),i.readPixels(a,R,O,Z,i.RGBA,W,r),i.bindFramebuffer(i.FRAMEBUFFER,this._currentFramebuffer),r},r.ThinEngine.prototype._readTexturePixels=function(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(V,O,Z,d,p,r,Y,m,a,R))};Z(11673);r.ThinEngine.prototype._createDepthStencilCubeTexture=function(V,O){const Z=new d.d(this,12);if(Z.isCube=!0,1===this.webGLVersion)return i.b.Error("Depth cube texture is not supported by WebGL 1."),Z;const p={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...O},r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,Z,!0),this._setupDepthStencilTexture(Z,V,p.bilinearFiltering,p.comparisonFunction);for(let d=0;d<6;d++)p.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,r.DEPTH24_STENCIL8,V,V,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,r.DEPTH_COMPONENT24,V,V,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(Z),Z},r.ThinEngine.prototype._setCubeMapTextureParams=function(V,O,Z){const d=this._gl;d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,O?d.LINEAR_MIPMAP_LINEAR:d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),V.samplingMode=O?3:2,O&&this.getCaps().textureMaxLevel&&void 0!==Z&&Z>0&&(d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAX_LEVEL,Z),V._maxLodLevel=Z),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)},r.ThinEngine.prototype.createCubeTexture=function(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>13&&void 0!==arguments[13]&&arguments[13],Q=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const b=this._gl;return this.createCubeTextureBase(V,O,Z,!!d,p,r,Y,m,a,R,M,W,(V=>this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,V,!0)),((V,O)=>{const Z=this.needPOTTextures?(0,c.g)(O[0].width,this._caps.maxCubemapTextureSize):O[0].width,r=Z,m=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(!1);const a=Y?this._getInternalFormat(Y,V._useSRGBBuffer):V._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:b.RGBA;let R=Y?this._getInternalFormat(Y):b.RGBA;V._useSRGBBuffer&&1===this.webGLVersion&&(R=a);for(let d=0;d<m.length;d++)if(O[d].width!==Z||O[d].height!==r){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void i.b.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=Z,this._workingCanvas.height=r,this._workingContext.drawImage(O[d],0,0,O[d].width,O[d].height,0,0,Z,r),b.texImage2D(m[d],0,a,R,b.UNSIGNED_BYTE,this._workingCanvas)}else b.texImage2D(m[d],0,a,R,b.UNSIGNED_BYTE,O[d]);d||b.generateMipmap(b.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(V,!d),V.width=Z,V.height=r,V.isReady=!0,Y&&(V.format=Y),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear(),p&&p()}),!!F,Q)},r.ThinEngine.prototype.generateMipMapsForCubemap=function(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.generateMipMaps){const Z=this._gl;this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,V,!0),Z.generateMipmap(Z.TEXTURE_CUBE_MAP),O&&this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,null)}};Z(11702);r.ThinEngine.prototype.setDepthStencilTexture=function(V,O,Z,d){void 0!==V&&(O&&(this._boundUniforms[V]=O),Z&&Z.depthStencilTexture?this._setTexture(V,Z,!1,!0,d):this._setTexture(V,null,void 0,void 0,d))},r.ThinEngine.prototype.createRenderTargetCubeTexture=function(V,O){const Z=this._createHardwareRenderTargetWrapper(!1,!0,V),p={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...O};p.generateStencilBuffer=p.generateDepthBuffer&&p.generateStencilBuffer,(1!==p.type||this._caps.textureFloatLinearFiltering)&&(2!==p.type||this._caps.textureHalfFloatLinearFiltering)||(p.samplingMode=1);const r=this._gl,Y=new d.d(this,5);this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,Y,!0);const m=this._getSamplingParameters(p.samplingMode,p.generateMipMaps);1!==p.type||this._caps.textureFloat||(p.type=0,i.b.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,m.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,m.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(let d=0;d<6;d++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,this._getRGBABufferInternalSizedFormat(p.type,p.format),V,V,0,this._getInternalFormat(p.format),this._getWebGLTextureType(p.type),null);const a=r.createFramebuffer();return this._bindUnboundFramebuffer(a),Z._depthStencilBuffer=this._setupFramebufferDepthAttachments(p.generateStencilBuffer,p.generateDepthBuffer,V,V),p.generateMipMaps&&r.generateMipmap(r.TEXTURE_CUBE_MAP),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),Z._framebuffer=a,Z._generateDepthBuffer=p.generateDepthBuffer,Z._generateStencilBuffer=p.generateStencilBuffer,Y.width=V,Y.height=V,Y.isReady=!0,Y.isCube=!0,Y.samples=1,Y.generateMipMaps=p.generateMipMaps,Y.samplingMode=p.samplingMode,Y.type=p.type,Y.format=p.format,this._internalTexturesCache.push(Y),Z.setTextures(Y),Z};var U=Z(11713),H=Z(11471),S=Z(11726);r.ThinEngine.prototype.createPrefilteredCubeTexture=function(V,O,Z,p){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(V,O,null,!1,(V=>{if(!V)return void(r&&r(null));const Y=V.texture;if(R?V.info.sphericalPolynomial&&(Y._sphericalPolynomial=V.info.sphericalPolynomial):Y._sphericalPolynomial=new U.g,Y._source=9,this.getCaps().textureLOD)return void(r&&r(Y));const m=this._gl,a=V.width;if(!a)return;const M=[];for(let r=0;r<3;r++){const R=1-r/2,c=p,W=Math.log2(a)*Z+p,F=c+(W-c)*R,Q=Math.round(Math.min(Math.max(F,0),W)),b=new d.d(this,2);if(b.type=Y.type,b.format=Y.format,b.width=Math.pow(2,Math.max(Math.log2(a)-Q,0)),b.height=b.width,b.isCube=!0,b._cachedWrapU=0,b._cachedWrapV=0,this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,b,!0),b.samplingMode=2,m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),V.isDDS){const O=V.info,Z=V.data;this._unpackFlipY(O.isCompressed),S.c.UploadDDSLevels(this,b,Z,O,!0,6,Q)}else i.b.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null);const U=new H.c(O);U._isCube=!0,U._texture=b,b.isReady=!0,M.push(U)}Y._lodTextureHigh=M[2],Y._lodTextureMid=M[1],Y._lodTextureLow=M[0],r&&r(Y)}),Y,m,a,R,Z,p)},r.ThinEngine.prototype.createUniformBuffer=function(V,O){const Z=this._gl.createBuffer();if(!Z)throw new Error("Unable to create uniform buffer");const d=new R.e(Z);return this.bindUniformBuffer(d),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),d.references=1,d},r.ThinEngine.prototype.createDynamicUniformBuffer=function(V,O){const Z=this._gl.createBuffer();if(!Z)throw new Error("Unable to create dynamic uniform buffer");const d=new R.e(Z);return this.bindUniformBuffer(d),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),d.references=1,d},r.ThinEngine.prototype.updateUniformBuffer=function(V,O,Z,d){this.bindUniformBuffer(V),void 0===Z&&(Z=0),void 0===d?O instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,Z,O):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,Z,new Float32Array(O)):O instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,O.subarray(Z,Z+d)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(O).subarray(Z,Z+d)),this.bindUniformBuffer(null)},r.ThinEngine.prototype.bindUniformBuffer=function(V){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,V?V.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBufferBase=function(V,O,Z){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,O,V?V.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBlock=function(V,O,Z){const d=V.program,p=this._gl.getUniformBlockIndex(d,O);4294967295!==p&&this._gl.uniformBlockBinding(d,p,Z)};var z=Z(10906),G=Z(10983);G.e.prototype.displayLoadingUI=function(){if(!(0,z.n)())return;const V=this.loadingScreen;V&&V.displayLoadingUI()},G.e.prototype.hideLoadingUI=function(){if(!(0,z.n)())return;const V=this._loadingScreen;V&&V.hideLoadingUI()},Object.defineProperty(G.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=G.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(V){this._loadingScreen=V},enumerable:!0,configurable:!0}),Object.defineProperty(G.e.prototype,"loadingUIText",{set:function(V){this.loadingScreen.loadingUIText=V},enumerable:!0,configurable:!0}),Object.defineProperty(G.e.prototype,"loadingUIBackgroundColor",{set:function(V){this.loadingScreen.loadingUIBackgroundColor=V},enumerable:!0,configurable:!0}),G.e.prototype.getInputElement=function(){return this._renderingCanvas},G.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},G.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},G.e.prototype.getAspectRatio=function(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Z=V.viewport;return this.getRenderWidth(O)*Z.width/(this.getRenderHeight(O)*Z.height)},G.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},G.e.prototype._verifyPointerLock=function(){var V;null===(V=this._onPointerLockChange)||void 0===V||V.call(this)},G.e.prototype.setAlphaEquation=function(V){if(this._alphaEquation!==V){switch(V){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=V}},G.e.prototype.getInputElement=function(){return this._renderingCanvas},G.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},G.e.prototype.setDepthFunction=function(V){this._depthCullingState.depthFunc=V},G.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},G.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},G.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},G.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},G.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},G.e.prototype.setDepthWrite=function(V){this._depthCullingState.depthMask=V},G.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},G.e.prototype.setStencilBuffer=function(V){this._stencilState.stencilTest=V},G.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},G.e.prototype.setStencilMask=function(V){this._stencilState.stencilMask=V},G.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},G.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},G.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},G.e.prototype.setStencilFunction=function(V){this._stencilState.stencilFunc=V},G.e.prototype.setStencilFunctionReference=function(V){this._stencilState.stencilFuncRef=V},G.e.prototype.setStencilFunctionMask=function(V){this._stencilState.stencilFuncMask=V},G.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},G.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},G.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},G.e.prototype.setStencilOperationFail=function(V){this._stencilState.stencilOpStencilFail=V},G.e.prototype.setStencilOperationDepthFail=function(V){this._stencilState.stencilOpDepthFail=V},G.e.prototype.setStencilOperationPass=function(V){this._stencilState.stencilOpStencilDepthPass=V},G.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},G.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},G.e.prototype.setAlphaConstants=function(V,O,Z,d){this._alphaState.setAlphaBlendConstants(V,O,Z,d)},G.e.prototype.getAlphaMode=function(){return this._alphaMode},G.e.prototype.getAlphaEquation=function(){return this._alphaEquation},G.e.prototype.getRenderPassNames=function(){return this._renderPassNames},G.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},G.e.prototype.createRenderPassId=function(V){const O=++G.e._RenderPassIdCounter;return this._renderPassNames[O]=V??"NONAME",O},G.e.prototype.releaseRenderPassId=function(V){this._renderPassNames[V]=void 0;for(let O=0;O<this.scenes.length;++O){const Z=this.scenes[O];for(let O=0;O<Z.meshes.length;++O){const d=Z.meshes[O];if(d.Ef)for(let O=0;O<d.Ef.length;++O){d.Ef[O]._removeDrawWrapper(V)}}}};Z(11710);function w(V){if(V.requestPointerLock){const O=V.requestPointerLock();O instanceof Promise?O.then((()=>{V.focus()})).catch((()=>{})):V.focus()}}var t=Z(11053);Z(11774);class C extends r.ThinEngine{static get NpmPackage(){return G.e.NpmPackage}static get Version(){return G.e.Version}static get Instances(){return p.e.Instances}static get LastCreatedEngine(){return p.e.LastCreatedEngine}static get LastCreatedScene(){return p.e.LastCreatedScene}static DefaultLoadingScreenFactory(V){return G.e.DefaultLoadingScreenFactory(V)}get _supportsHardwareTextureRescaling(){return!!C._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(V,O,Z){if(super(V,O,Z,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new m,this._drawCalls=new t.d,V&&(this._features.supportRenderPasses=!0,Z=this._creationOptions,V.getContext)){const O=V;this._sharedInit(O)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(V){super._sharedInit(V),function(V,O,Z){V._onCanvasFocus=()=>{V.onCanvasFocusObservable.notifyObservers(V)},V._onCanvasBlur=()=>{V.onCanvasBlurObservable.notifyObservers(V)},V._onCanvasContextMenu=O=>{V.disableContextMenu&&O.preventDefault()},O.addEventListener("focus",V._onCanvasFocus),O.addEventListener("blur",V._onCanvasBlur),O.addEventListener("contextmenu",V._onCanvasContextMenu),V._onBlur=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.disable(),V._windowIsBackground=!0},V._onFocus=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.enable(),V._windowIsBackground=!1},V._onCanvasPointerOut=Z=>{document.elementFromPoint(Z.clientX,Z.clientY)!==O&&V.onCanvasPointerOutObservable.notifyObservers(Z)};const d=V.getHostWindow();d&&"function"===typeof d.addEventListener&&(d.addEventListener("blur",V._onBlur),d.addEventListener("focus",V._onFocus)),O.addEventListener("pointerout",V._onCanvasPointerOut),Z.doNotHandleTouchAction||function(V){V&&V.setAttribute&&(V.setAttribute("touch-action","none"),V.style.touchAction="none",V.style.webkitTapHighlightColor="transparent")}(O),!G.e.audioEngine&&Z.audioEngine&&G.e.AudioEngineFactory&&(G.e.audioEngine=G.e.AudioEngineFactory(V.getRenderingCanvas(),V.getAudioContext(),V.getAudioDestination())),(0,z.f)()&&(V._onFullscreenChange=()=>{V.isFullscreen=!!document.fullscreenElement,V.isFullscreen&&V._pointerLockRequested&&O&&w(O)},document.addEventListener("fullscreenchange",V._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",V._onFullscreenChange,!1),V._onPointerLockChange=()=>{V.isPointerLock=document.pointerLockElement===O},document.addEventListener("pointerlockchange",V._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",V._onPointerLockChange,!1)),V.enableOfflineSupport=void 0!==G.e.OfflineProviderFactory,V._deterministicLockstep=!!Z.deterministicLockstep,V._lockstepMaxSteps=Z.lockstepMaxSteps||0,V._timeStep=Z.timeStep||1/60}(this,V,this._creationOptions)}resizeImageBitmap(V,O,Z){return function(V,O,Z,d){const p=V.createCanvas(Z,d).getContext("2d");if(!p)throw new Error("Unable to get 2d context for resizeImageBitmap");return p.drawImage(O,0,0),p.getImageData(0,0,Z,d).data}(this,V,O,Z)}_createImageBitmapFromSource(V,O){return function(V,O,Z){return new Promise(((d,p)=>{const r=new Image;r.onload=()=>{r.decode().then((()=>{V.createImageBitmap(r,Z).then((V=>{d(V)}))}))},r.onerror=()=>{p(`Error loading image ${r.src}`)},r.src=O}))}(this,V,O)}switchFullscreen(V){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(V)}enterFullscreen(V){this.isFullscreen||(this._pointerLockRequested=V,this._renderingCanvas&&function(V){const O=V.requestFullscreen||V.webkitRequestFullscreen;O&&O.call(V)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const V=document;document.exitFullscreen?document.exitFullscreen():V.webkitCancelFullScreen&&V.webkitCancelFullScreen()}()}setDitheringState(V){V?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(V){V?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(V,O,Z,d){const p=this._cachedViewport;return this._cachedViewport=null,this._viewport(V,O,Z,d),p}scissorClear(V,O,Z,d,p){this.enableScissor(V,O,Z,d),this.clear(p,!0,!0,!0),this.disableScissor()}enableScissor(V,O,Z,d){const p=this._gl;p.enable(p.SCISSOR_TEST),p.scissor(V,O,Z,d)}disableScissor(){const V=this._gl;V.disable(V.SCISSOR_TEST)}_loadFileAsync(V,O,Z){return new Promise(((d,p)=>{this._loadFile(V,(V=>{d(V)}),void 0,O,Z,((V,O)=>{p(O)}))}))}getVertexShaderSource(V){const O=this._gl.getAttachedShaders(V);return O?this._gl.getShaderSource(O[0]):null}getFragmentShaderSource(V){const O=this._gl.getAttachedShaders(V);return O?this._gl.getShaderSource(O[1]):null}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const V of this.scenes)V.resetCachedMaterial(),V._rebuildGeometries();for(const V of this._virtualScenes)V.resetCachedMaterial(),V._rebuildGeometries();super._rebuildBuffers()}getFontOffset(V){return function(V){const O=document.createElement("span");O.textContent="Hg",O.style.font=V;const Z=document.createElement("div");Z.style.display="inline-block",Z.style.width="1px",Z.style.height="0px",Z.style.verticalAlign="bottom";const d=document.createElement("div");d.style.whiteSpace="nowrap",d.appendChild(O),d.appendChild(Z),document.body.appendChild(d);let p=0,r=0;try{r=Z.getBoundingClientRect().top-O.getBoundingClientRect().top,Z.style.verticalAlign="baseline",p=Z.getBoundingClientRect().top-O.getBoundingClientRect().top}finally{document.body.removeChild(d)}return{ascent:p,height:r,descent:r-p}}(V)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:V}=this.customAnimationFrameRequester;V&&V(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let V=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(V=!1),V&&(this.Si(),this._renderViews()||this._renderFrame(),this.Ti())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&w(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Si(){this._measureFps(),super.Si()}_deletePipelineContext(V){const O=V;O&&O.program&&O.transformFeedback&&(this.deleteTransformFeedback(O.transformFeedback),O.transformFeedback=null),super._deletePipelineContext(V)}createShaderProgram(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;p=p||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const Y=super.createShaderProgram(V,O,Z,d,p,r);return this.onAfterShaderCompilationObservable.notifyObservers(this),Y}_createShaderProgram(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const r=d.createProgram();if(V.program=r,!r)throw new Error("Unable to create program");if(d.attachShader(r,O),d.attachShader(r,Z),this.webGLVersion>1&&p){const O=this.createTransformFeedback();this.bindTransformFeedback(O),this.setTranformFeedbackVaryings(r,p),V.transformFeedback=O}return d.linkProgram(r),this.webGLVersion>1&&p&&this.bindTransformFeedback(null),V.context=d,V.vertexShader=O,V.fragmentShader=Z,V.isParallelCompiled||this._finalizePipelineContext(V),r}_releaseTexture(V){super._releaseTexture(V)}_releaseRenderTargetWrapper(V){super._releaseRenderTargetWrapper(V),this.scenes.forEach((O=>{O.postProcesses.forEach((O=>{O._outputTexture===V&&(O._outputTexture=null)})),O.cameras.forEach((O=>{O._postProcesses.forEach((O=>{O&&O._outputTexture===V&&(O._outputTexture=null)}))}))}))}_rescaleTexture(V,O,Z,d,p){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const r=this.createRenderTargetTexture({width:O.width,height:O.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&C._RescalePostProcessFactory&&(this._rescalePostProcess=C._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const Y=()=>{this._rescalePostProcess.onApply=function(O){O._bindTexture("textureSampler",V)};let Y=Z;Y||(Y=this.scenes[this.scenes.length-1]),Y.postProcessManager.directRender([this._rescalePostProcess],r,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,O,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,d,0,0,O.width,O.height,0),this.unBindFramebuffer(r),r.dispose(),p&&p()},m=this._rescalePostProcess.getEffect();m?m.executeWhenCompiled(Y):this._rescalePostProcess.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled(Y)}))}}wrapWebGLTexture(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const Y=new M.d(V,this._gl),m=new d.d(this,0,!0);return m._hardwareTexture=Y,m.baseWidth=p,m.baseHeight=r,m.width=p,m.height=r,m.isReady=!0,m.useMipMaps=O,this.updateTextureSamplingMode(Z,m),m}_uploadImageToTexture(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const p=this._gl,r=this._getWebGLTextureType(V.type),Y=this._getInternalFormat(V.format),m=this._getRGBABufferInternalSizedFormat(V.type,Y),a=V.isCube?p.TEXTURE_CUBE_MAP:p.TEXTURE_2D;this._bindTextureDirectly(a,V,!0),this._unpackFlipY(V.invertY);let R=p.TEXTURE_2D;V.isCube&&(R=p.TEXTURE_CUBE_MAP_POSITIVE_X+Z),p.texImage2D(R,d,m,Y,r,O),this._bindTextureDirectly(a,null,!0)}updateTextureComparisonFunction(V,O){if(1===this.webGLVersion)return void i.b.Error("WebGL 1 does not support texture comparison.");const Z=this._gl;V.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,V,!0),0===O?(Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_COMPARE_FUNC,515),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_COMPARE_MODE,Z.NONE)):(Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_COMPARE_FUNC,O),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_COMPARE_MODE,Z.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),0===O?(Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_COMPARE_FUNC,515),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_COMPARE_MODE,Z.NONE)):(Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_COMPARE_FUNC,O),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_COMPARE_MODE,Z.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),V._comparisonFunction=O}createInstancesBuffer(V){const O=this._gl.createBuffer();if(!O)throw new Error("Unable to create instance buffer");const Z=new R.e(O);return Z.wj=V,this.bindArrayBuffer(Z),this._gl.bufferData(this._gl.ARRAY_BUFFER,V,this._gl.DYNAMIC_DRAW),Z.references=1,Z}deleteInstancesBuffer(V){this._gl.deleteBuffer(V)}_clientWaitAsync(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const d=this._gl;return new Promise(((p,r)=>{const Y=()=>{const m=d.clientWaitSync(V,O,0);m!=d.WAIT_FAILED?m!=d.TIMEOUT_EXPIRED?p():setTimeout(Y,Z):r()};Y()}))}_readPixelsAsync(V,O,Z,d,p,r,Y){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const m=this._gl,a=m.createBuffer();m.bindBuffer(m.PIXEL_PACK_BUFFER,a),m.bufferData(m.PIXEL_PACK_BUFFER,Y.byteLength,m.STREAM_READ),m.readPixels(V,O,Z,d,p,r,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const R=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);return R?(m.flush(),this._clientWaitAsync(R,0,10).then((()=>(m.deleteSync(R),m.bindBuffer(m.PIXEL_PACK_BUFFER,a),m.getBufferSubData(m.PIXEL_PACK_BUFFER,0,Y),m.bindBuffer(m.PIXEL_PACK_BUFFER,null),m.deleteBuffer(a),Y)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(V,O){1===p.e.Instances.length&&G.e.audioEngine&&(G.e.audioEngine.dispose(),G.e.audioEngine=null);const Z=V.getHostWindow();Z&&"function"===typeof Z.removeEventListener&&(Z.removeEventListener("blur",V._onBlur),Z.removeEventListener("focus",V._onFocus)),O&&(O.removeEventListener("focus",V._onCanvasFocus),O.removeEventListener("blur",V._onCanvasBlur),O.removeEventListener("pointerout",V._onCanvasPointerOut),O.removeEventListener("contextmenu",V._onCanvasContextMenu)),(0,z.f)()&&(document.removeEventListener("fullscreenchange",V._onFullscreenChange),document.removeEventListener("mozfullscreenchange",V._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",V._onFullscreenChange),document.removeEventListener("msfullscreenchange",V._onFullscreenChange),document.removeEventListener("pointerlockchange",V._onPointerLockChange),document.removeEventListener("mspointerlockchange",V._onPointerLockChange),document.removeEventListener("mozpointerlockchange",V._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",V._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}C.ALPHA_DISABLE=0,C.ALPHA_ADD=1,C.ALPHA_COMBINE=2,C.ALPHA_SUBTRACT=3,C.ALPHA_MULTIPLY=4,C.ALPHA_MAXIMIZED=5,C.ALPHA_ONEONE=6,C.ALPHA_PREMULTIPLIED=7,C.ALPHA_PREMULTIPLIED_PORTERDUFF=8,C.ALPHA_INTERPOLATE=9,C.ALPHA_SCREENMODE=10,C.DELAYLOADSTATE_NONE=0,C.DELAYLOADSTATE_LOADED=1,C.DELAYLOADSTATE_LOADING=2,C.DELAYLOADSTATE_NOTLOADED=4,C.NEVER=512,C.ALWAYS=519,C.LESS=513,C.EQUAL=514,C.LEQUAL=515,C.GREATER=516,C.GEQUAL=518,C.NOTEQUAL=517,C.KEEP=7680,C.REPLACE=7681,C.INCR=7682,C.DECR=7683,C.INVERT=5386,C.INCR_WRAP=34055,C.DECR_WRAP=34056,C.TEXTURE_CLAMP_ADDRESSMODE=0,C.TEXTURE_WRAP_ADDRESSMODE=1,C.TEXTURE_MIRROR_ADDRESSMODE=2,C.TEXTUREFORMAT_ALPHA=0,C.TEXTUREFORMAT_LUMINANCE=1,C.TEXTUREFORMAT_LUMINANCE_ALPHA=2,C.TEXTUREFORMAT_RGB=4,C.TEXTUREFORMAT_RGBA=5,C.TEXTUREFORMAT_RED=6,C.TEXTUREFORMAT_R=6,C.TEXTUREFORMAT_RG=7,C.TEXTUREFORMAT_RED_INTEGER=8,C.TEXTUREFORMAT_R_INTEGER=8,C.TEXTUREFORMAT_RG_INTEGER=9,C.TEXTUREFORMAT_RGB_INTEGER=10,C.TEXTUREFORMAT_RGBA_INTEGER=11,C.TEXTURETYPE_UNSIGNED_BYTE=0,C.TEXTURETYPE_UNSIGNED_INT=0,C.TEXTURETYPE_FLOAT=1,C.TEXTURETYPE_HALF_FLOAT=2,C.TEXTURETYPE_BYTE=3,C.TEXTURETYPE_SHORT=4,C.TEXTURETYPE_UNSIGNED_SHORT=5,C.TEXTURETYPE_INT=6,C.TEXTURETYPE_UNSIGNED_INTEGER=7,C.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,C.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,C.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,C.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,C.TEXTURETYPE_UNSIGNED_INT_24_8=12,C.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,C.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,C.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,C.TEXTURE_NEAREST_SAMPLINGMODE=1,C.TEXTURE_BILINEAR_SAMPLINGMODE=2,C.TEXTURE_TRILINEAR_SAMPLINGMODE=3,C.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,C.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,C.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,C.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,C.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,C.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,C.TEXTURE_NEAREST_LINEAR=7,C.TEXTURE_NEAREST_NEAREST=1,C.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,C.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,C.TEXTURE_LINEAR_LINEAR=2,C.TEXTURE_LINEAR_NEAREST=12,C.TEXTURE_EXPLICIT_MODE=0,C.TEXTURE_SPHERICAL_MODE=1,C.TEXTURE_PLANAR_MODE=2,C.TEXTURE_CUBIC_MODE=3,C.TEXTURE_PROJECTION_MODE=4,C.TEXTURE_SKYBOX_MODE=5,C.TEXTURE_INVCUBIC_MODE=6,C.TEXTURE_EQUIRECTANGULAR_MODE=7,C.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,C.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,C.SCALEMODE_FLOOR=1,C.SCALEMODE_NEAREST=2,C.SCALEMODE_CEILING=3},10942:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});var d=Z(10902);class p{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}p.Instances=[],p.OnEnginesDisposedObservable=new d.e,p._LastCreatedScene=null,p.UseFallbackTexture=!0,p.FallbackTexture=""},12642:(V,O,Z)=>{"use strict";Z(10914);var d=Z(11698);Z(11013),Z(11325),Z(11006),Z(11707),Z(11681);d.b},11006:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d});class d{static SetMatrixPrecision(V){if(d.MatrixTrackPrecisionChange=!1,V&&!d.MatrixUse64Bits&&d.MatrixTrackedMatrices)for(let O=0;O<d.MatrixTrackedMatrices.length;++O){const V=d.MatrixTrackedMatrices[O],Z=V.Dj;V.Dj=new Array(16);for(let O=0;O<16;++O)V.Dj[O]=Z[O]}d.MatrixUse64Bits=V,d.MatrixCurrentType=d.MatrixUse64Bits?Array:Float32Array,d.MatrixTrackedMatrices=null}}d.MatrixUse64Bits=!1,d.MatrixTrackPrecisionChange=!0,d.MatrixCurrentType=Float32Array,d.MatrixTrackedMatrices=[]},11707:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var V;return(null===(V=this._textures)||void 0===V?void 0:V[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(V){var O,Z;if(!this._textures)return-1;const d=this._textures[V],p=(null===(O=this._layerIndices)||void 0===O?void 0:O[V])??0,r=(null===(Z=this._faceIndices)||void 0===Z?void 0:Z[V])??0;return d.isCube?6*p+r:d.is3D?0:p}get samples(){return this._samples}setSamples(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===V&&!Z)return V;const d=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,V,O):this._engine.updateRenderTargetTextureSampleCount(this,V);return this._samples=V,d}constructor(V,O,Z,d,p){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=V,this._isCube=O,this._size=Z,this._engine=d,this._depthStencilTexture=null,this.label=p}setTextures(V){Array.isArray(V)?this._textures=V:this._textures=V?[V]:null}setTexture(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[O]!==V&&(this._textures[O]&&Z&&this._textures[O].dispose(),this._textures[O]=V)}setLayerAndFaceIndices(V,O){this._layerIndices=V,this._faceIndices=O}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==O&&O>=0&&(this._layerIndices[V]=O),void 0!==Z&&Z>=0&&(this._faceIndices[V]=Z)}createDepthStencilTexture(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,Y=arguments.length>5?arguments[5]:void 0;return null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTextureWithStencil=d,this._depthStencilTextureLabel=Y,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:Z,comparisonFunction:O,generateStencil:d,isCube:this._isCube,samples:p,depthTextureFormat:r,label:Y},this),this._depthStencilTexture}_shareDepth(V){this.shareDepth(V)}shareDepth(V){this._depthStencilTexture&&(V._depthStencilTexture&&V._depthStencilTexture.dispose(),V._depthStencilTexture=this._depthStencilTexture,V._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(V){this.texture&&this.texture._swapAndDie(V),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let V=null;if(this._isMulti){const O=this.textures;if(O&&O.length>0){let Z=!1,d=O.length,p=-1;const r=O[O.length-1]._source;14!==r&&12!==r||(Z=!0,p=O[O.length-1].format,d--);const Y=[],m=[],a=[],R=[],i=[],M=[],c=[],W={};for(let V=0;V<d;++V){const Z=O[V];Y.push(Z.samplingMode),m.push(Z.type),a.push(Z.format);void 0!==W[Z.uniqueId]?(R.push(-1),c.push(0)):(W[Z.uniqueId]=V,Z.is2DArray?(R.push(35866),c.push(Z.depth)):Z.isCube?(R.push(34067),c.push(0)):Z.is3D?(R.push(32879),c.push(Z.depth)):(R.push(3553),c.push(0))),this._faceIndices&&i.push(this._faceIndices[V]??0),this._layerIndices&&M.push(this._layerIndices[V]??0)}const F={samplingModes:Y,generateMipMaps:O[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:Z,depthTextureFormat:p,types:m,formats:a,textureCount:d,targetTypes:R,faceIndex:i,layerIndex:M,layerCounts:c,label:this.label},Q={width:this.width,height:this.height,depth:this.depth};V=this._engine.createMultipleRenderTarget(Q,F);for(let b=0;b<d;++b){if(-1!==R[b])continue;const Z=W[O[b].uniqueId];V.setTexture(V.textures[Z],b)}}}else{var O,Z,d,p;const Y={};if(Y.generateDepthBuffer=this._generateDepthBuffer,Y.generateMipMaps=(null===(O=this.texture)||void 0===O?void 0:O.generateMipMaps)??!1,Y.generateStencilBuffer=this._generateStencilBuffer,Y.samplingMode=null===(Z=this.texture)||void 0===Z?void 0:Z.samplingMode,Y.type=null===(d=this.texture)||void 0===d?void 0:d.type,Y.format=null===(p=this.texture)||void 0===p?void 0:p.format,Y.noColorAttachment=!this._textures,Y.label=this.label,this.isCube)V=this._engine.createRenderTargetCubeTexture(this.width,Y);else{var r;const O={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(r=this.texture)||void 0===r?void 0:r.depth:void 0};V=this._engine.createRenderTargetTexture(O,Y)}V.texture&&(V.texture.isReady=!0)}return V}_swapRenderTargetWrapper(V){if(this._textures&&V._textures)for(let O=0;O<this._textures.length;++O)this._textures[O]._swapAndDie(V._textures[O],!1),V._textures[O].isReady=!0;this._depthStencilTexture&&V._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(V._depthStencilTexture),V._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const V=this._cloneRenderTargetWrapper();if(V){if(this._depthStencilTexture){const O=this._depthStencilTexture.samplingMode,Z=this._depthStencilTexture.format,d=2===O||3===O||11===O;V.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,d,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,Z,this._depthStencilTextureLabel)}this.samples>1&&V.setSamples(this.samples),V._swapRenderTargetWrapper(this),V.dispose()}}releaseTextures(){if(this._textures)for(let O=0;O<(null===(V=this._textures)||void 0===V?void 0:V.length);++O){var V;this._textures[O].dispose()}this._textures=null}dispose(){var V;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10991:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.ShadersRepository:d.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.ShadersStore:d.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.IncludesShadersStore:d.IncludesShadersStoreWGSL}}d.ShadersRepository="src/Shaders/",d.ShadersStore={},d.IncludesShadersStore={},d.ShadersRepositoryWGSL="src/ShadersWGSL/",d.ShadersStoreWGSL={},d.IncludesShadersStoreWGSL={}},11001:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>c,g:()=>H,k:()=>W,l:()=>F,m:()=>U,q:()=>M,s:()=>R,v:()=>i,y:()=>a,z:()=>m});class d{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.bd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(V){V&&this.program&&V(this.program)}setEngine(V){this.bd=V}_fillEffectInformation(V,O,Z,d,p,r,Y,m){const a=this.bd;if(a.supportsUniformBuffers)for(const i in O)V.bindUniformBlock(i,O[i]);let R;for(this.bd.getUniforms(this,Z).forEach(((V,O)=>{d[Z[O]]=V})),this._uniforms=d,R=0;R<p.length;R++){null==V.getUniform(p[R])&&(p.splice(R,1),R--)}p.forEach(((V,O)=>{r[V]=O}));for(const i of a.getAttributes(this,Y))m.push(i)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(V,O){const Z=this._valueCache[V],d=O.updateFlag;return(void 0===Z||Z!==d)&&(this._valueCache[V]=d,!0)}_cacheFloat2(V,O,Z){let d=this._valueCache[V];if(!d||2!==d.length)return d=[O,Z],this._valueCache[V]=d,!0;let p=!1;return d[0]!==O&&(d[0]=O,p=!0),d[1]!==Z&&(d[1]=Z,p=!0),p}_cacheFloat3(V,O,Z,d){let p=this._valueCache[V];if(!p||3!==p.length)return p=[O,Z,d],this._valueCache[V]=p,!0;let r=!1;return p[0]!==O&&(p[0]=O,r=!0),p[1]!==Z&&(p[1]=Z,r=!0),p[2]!==d&&(p[2]=d,r=!0),r}_cacheFloat4(V,O,Z,d,p){let r=this._valueCache[V];if(!r||4!==r.length)return r=[O,Z,d,p],this._valueCache[V]=r,!0;let Y=!1;return r[0]!==O&&(r[0]=O,Y=!0),r[1]!==Z&&(r[1]=Z,Y=!0),r[2]!==d&&(r[2]=d,Y=!0),r[3]!==p&&(r[3]=p,Y=!0),Y}setInt(V,O){const Z=this._valueCache[V];void 0!==Z&&Z===O||this.bd.setInt(this._uniforms[V],O)&&(this._valueCache[V]=O)}setInt2(V,O,Z){this._cacheFloat2(V,O,Z)&&(this.bd.setInt2(this._uniforms[V],O,Z)||(this._valueCache[V]=null))}setInt3(V,O,Z,d){this._cacheFloat3(V,O,Z,d)&&(this.bd.setInt3(this._uniforms[V],O,Z,d)||(this._valueCache[V]=null))}setInt4(V,O,Z,d,p){this._cacheFloat4(V,O,Z,d,p)&&(this.bd.setInt4(this._uniforms[V],O,Z,d,p)||(this._valueCache[V]=null))}setIntArray(V,O){this._valueCache[V]=null,this.bd.setIntArray(this._uniforms[V],O)}setIntArray2(V,O){this._valueCache[V]=null,this.bd.setIntArray2(this._uniforms[V],O)}setIntArray3(V,O){this._valueCache[V]=null,this.bd.setIntArray3(this._uniforms[V],O)}setIntArray4(V,O){this._valueCache[V]=null,this.bd.setIntArray4(this._uniforms[V],O)}setUInt(V,O){const Z=this._valueCache[V];void 0!==Z&&Z===O||this.bd.setUInt(this._uniforms[V],O)&&(this._valueCache[V]=O)}setUInt2(V,O,Z){this._cacheFloat2(V,O,Z)&&(this.bd.setUInt2(this._uniforms[V],O,Z)||(this._valueCache[V]=null))}setUInt3(V,O,Z,d){this._cacheFloat3(V,O,Z,d)&&(this.bd.setUInt3(this._uniforms[V],O,Z,d)||(this._valueCache[V]=null))}setUInt4(V,O,Z,d,p){this._cacheFloat4(V,O,Z,d,p)&&(this.bd.setUInt4(this._uniforms[V],O,Z,d,p)||(this._valueCache[V]=null))}setUIntArray(V,O){this._valueCache[V]=null,this.bd.setUIntArray(this._uniforms[V],O)}setUIntArray2(V,O){this._valueCache[V]=null,this.bd.setUIntArray2(this._uniforms[V],O)}setUIntArray3(V,O){this._valueCache[V]=null,this.bd.setUIntArray3(this._uniforms[V],O)}setUIntArray4(V,O){this._valueCache[V]=null,this.bd.setUIntArray4(this._uniforms[V],O)}setArray(V,O){this._valueCache[V]=null,this.bd.setArray(this._uniforms[V],O)}setArray2(V,O){this._valueCache[V]=null,this.bd.setArray2(this._uniforms[V],O)}setArray3(V,O){this._valueCache[V]=null,this.bd.setArray3(this._uniforms[V],O)}setArray4(V,O){this._valueCache[V]=null,this.bd.setArray4(this._uniforms[V],O)}setMatrices(V,O){O&&(this._valueCache[V]=null,this.bd.setMatrices(this._uniforms[V],O))}setMatrix(V,O){this._cacheMatrix(V,O)&&(this.bd.setMatrices(this._uniforms[V],O.Wi())||(this._valueCache[V]=null))}setMatrix3x3(V,O){this._valueCache[V]=null,this.bd.setMatrix3x3(this._uniforms[V],O)}setMatrix2x2(V,O){this._valueCache[V]=null,this.bd.setMatrix2x2(this._uniforms[V],O)}setFloat(V,O){const Z=this._valueCache[V];void 0!==Z&&Z===O||this.bd.setFloat(this._uniforms[V],O)&&(this._valueCache[V]=O)}setVector2(V,O){this._cacheFloat2(V,O.x,O.y)&&(this.bd.setFloat2(this._uniforms[V],O.x,O.y)||(this._valueCache[V]=null))}setFloat2(V,O,Z){this._cacheFloat2(V,O,Z)&&(this.bd.setFloat2(this._uniforms[V],O,Z)||(this._valueCache[V]=null))}setVector3(V,O){this._cacheFloat3(V,O.x,O.y,O.z)&&(this.bd.setFloat3(this._uniforms[V],O.x,O.y,O.z)||(this._valueCache[V]=null))}setFloat3(V,O,Z,d){this._cacheFloat3(V,O,Z,d)&&(this.bd.setFloat3(this._uniforms[V],O,Z,d)||(this._valueCache[V]=null))}setVector4(V,O){this._cacheFloat4(V,O.x,O.y,O.z,O.w)&&(this.bd.setFloat4(this._uniforms[V],O.x,O.y,O.z,O.w)||(this._valueCache[V]=null))}setQuaternion(V,O){this._cacheFloat4(V,O.x,O.y,O.z,O.w)&&(this.bd.setFloat4(this._uniforms[V],O.x,O.y,O.z,O.w)||(this._valueCache[V]=null))}setFloat4(V,O,Z,d,p){this._cacheFloat4(V,O,Z,d,p)&&(this.bd.setFloat4(this._uniforms[V],O,Z,d,p)||(this._valueCache[V]=null))}setColor3(V,O){this._cacheFloat3(V,O.r,O.g,O.b)&&(this.bd.setFloat3(this._uniforms[V],O.r,O.g,O.b)||(this._valueCache[V]=null))}setColor4(V,O,Z){this._cacheFloat4(V,O.r,O.g,O.b,Z)&&(this.bd.setFloat4(this._uniforms[V],O.r,O.g,O.b,Z)||(this._valueCache[V]=null))}setDirectColor4(V,O){this._cacheFloat4(V,O.r,O.g,O.b,O.a)&&(this.bd.setFloat4(this._uniforms[V],O.r,O.g,O.b,O.a)||(this._valueCache[V]=null))}_getVertexShaderCode(){return this.vertexShader?this.bd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.bd._getShaderSource(this.fragmentShader):null}}var p=Z(10970);const r=new WeakMap,Y={_webGLVersion:2,cachedPipelines:{}};function m(V){let O=r.get(V);if(!O){if(!V)return Y;O={_webGLVersion:V.TEXTURE_BINDING_3D?2:1,_context:V,cachedPipelines:{}},r.set(V,O)}return O}function a(V){r.delete(V)}function R(V,O,Z,d,p,r){const Y=m(d);r||(r=Y._createShaderProgramInjection??c);return r(V,b(O,"vertex",d,Y._contextWasLost),b(Z,"fragment",d,Y._contextWasLost),d,p,Y.validateShaderPrograms)}function i(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;const a=m(p);Y||(Y=a._createShaderProgramInjection??c);const R=a._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Y(V,Q(O,"vertex",d,R,p,a._contextWasLost),Q(Z,"fragment",d,R,p,a._contextWasLost),p,r,a.validateShaderPrograms)}function M(V,O){const Z=new d,p=m(V);return p.parallelShaderCompile&&(Z.isParallelCompiled=!0),Z.context=p._context,Z}function c(V,O,Z,d){let p=arguments.length>5?arguments[5]:void 0;const r=d.createProgram();if(V.program=r,!r)throw new Error("Unable to create program");return d.attachShader(r,O),d.attachShader(r,Z),d.linkProgram(r),V.context=d,V.vertexShader=O,V.fragmentShader=Z,V.isParallelCompiled||W(V,d,p),r}function W(V,O,Z){const d=V.context,p=V.vertexShader,r=V.fragmentShader,Y=V.program;if(!d.getProgramParameter(Y,d.LINK_STATUS)){if(!O.getShaderParameter(p,O.COMPILE_STATUS)){const Z=O.getShaderInfoLog(p);if(Z)throw V.vertexCompilationError=Z,new Error("VERTEX SHADER "+Z)}if(!O.getShaderParameter(r,O.COMPILE_STATUS)){const Z=O.getShaderInfoLog(r);if(Z)throw V.fragmentCompilationError=Z,new Error("FRAGMENT SHADER "+Z)}const Z=d.getProgramInfoLog(Y);if(Z)throw V.programLinkError=Z,new Error(Z)}if(Z){d.validateProgram(Y);if(!d.getProgramParameter(Y,d.VALIDATE_STATUS)){const O=d.getProgramInfoLog(Y);if(O)throw V.programValidationError=O,new Error(O)}}d.deleteShader(p),d.deleteShader(r),V.vertexShader=void 0,V.fragmentShader=void 0,V.onCompiled&&(V.onCompiled(),V.onCompiled=void 0)}function F(V,O,Z,d,p,r,Y,a,M){let c=arguments.length>10?arguments[10]:void 0,W=arguments.length>11?arguments[11]:void 0,F=arguments.length>12?arguments[12]:void 0;const Q=m(V.context);W||(W=Q.createRawShaderProgramInjection??R),F||(F=Q.createShaderProgramInjection??i);const b=V;b.program=d?W(b,O,Z,b.context,M):F(b,O,Z,a,b.context,M),b.program.__SPECTOR_rebuildProgram=Y,c()}function Q(V,O,Z,d,r,Y){return b((0,p.d)(V,Z,d),O,r,Y)}function b(V,O,Z,d){const p=Z.createShader("vertex"===O?Z.VERTEX_SHADER:Z.FRAGMENT_SHADER);if(!p){let V=Z.NO_ERROR,p=Z.NO_ERROR;for(;(p=Z.getError())!==Z.NO_ERROR;)V=p;throw new Error(`Something went wrong while creating a gl ${O} shader object. gl error=${V}, gl isContextLost=${Z.isContextLost()}, _contextWasLost=${d}`)}return Z.shaderSource(p,V),Z.compileShader(p),p}function U(V,O){O.useProgram(V)}function H(V,O){const Z=V;if(!Z.isParallelCompiled)return void O(V);const d=Z.onCompiled;Z.onCompiled=()=>{null===d||void 0===d||d(),O(V)}}},11678:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{ThinEngine:()=>S});var d=Z(11001),p=Z(11681),r=Z(10914),Y=Z(10906);class m{constructor(){this.shaderLanguage=0}postProcessor(V,O,Z,d,p){if(p.drawBuffersExtensionDisabled){const O=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;V=V.replace(O,"")}return V}}const a=/(flat\s)?\s*varying\s*.*/;class R{constructor(){this.shaderLanguage=0}attributeProcessor(V){return V.replace("attribute","in")}varyingCheck(V,O){return a.test(V)}varyingProcessor(V,O){return V.replace("varying",O?"in":"out")}postProcessor(V,O,Z){const d=-1!==V.search(/#extension.+GL_EXT_draw_buffers.+require/);if(V=(V=V.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),Z){const O=-1!==V.search(/layout *\(location *= *0\) *out/g);V=(V=(V=(V=(V=(V=(V=V.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(d||O?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==O.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+V}return V}}var i=Z(11686),M=Z(11049),c=Z(10983),W=Z(11689),F=Z(11013),Q=Z(10986),b=Z(10970),U=Z(10996);class H{}class S extends c.e{get name(){return this._name}set name(V){this._name=V}get version(){return this._webGLVersion}static get ShadersRepository(){return Q.c.ShadersRepository}static set ShadersRepository(V){Q.c.ShadersRepository=V}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(V,O,Z,p){if(Z=Z||{},super(O??Z.antialias,Z,p),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!V)return;let Y=null;if(V.getContext){if(Y=V,this._renderingCanvas=Y,void 0===Z.Yg&&(Z.Yg=!1),void 0===Z.xrCompatible&&(Z.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const V=navigator.userAgent;for(const O of S.ExceptionList){const d=O.key,p=O.targets;if(new RegExp(d).test(V)){if(O.capture&&O.captureConstraint){const Z=O.capture,d=O.captureConstraint,p=new RegExp(Z).exec(V);if(p&&p.length>0){if(parseInt(p[p.length-1])>=d)continue}}for(const V of p)switch(V){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":Z.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=V=>{V.preventDefault(),this._contextWasLost=!0,r.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},Y.addEventListener("webglcontextlost",this._onContextLost,!1),Y.addEventListener("webglcontextrestored",this._onContextRestored,!1),Z.powerPreference=Z.powerPreference||"high-performance"),this._badDesktopOS&&(Z.xrCompatible=!1),!Z.disableWebGL2Support)try{this._gl=Y.getContext("webgl2",Z)||Y.getContext("experimental-webgl2",Z),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(M){}if(!this._gl){if(!Y)throw new Error("The provided canvas is null or undefined.");try{this._gl=Y.getContext("webgl",Z)||Y.getContext("experimental-webgl",Z)}catch(M){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=V,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const O=this._gl.getContextAttributes();O&&(Z.stencil=O.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==Z.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=Z.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let d=0;d<this._caps.maxVertexAttribs;d++)this._currentBufferPointers[d]=new H;this._shaderProcessor=this.webGLVersion>1?new R:new m;const a=`Babylon.js v${S.Version}`;r.b.Log(a+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",a);const i=(0,d.z)(this._gl);i.validateShaderPrograms=this.validateShaderPrograms,i.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(V){return null}areAllEffectsReady(){for(const V in this._compiledEffects){if(!this._compiledEffects[V].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const V=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=V&&(this._glRenderer=this._gl.getParameter(V.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(V.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const V=this._gl.getExtension("WEBGL_draw_buffers");if(null!==V){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=V.drawBuffersWEBGL.bind(V),this._caps.maxDrawBuffers=this._gl.getParameter(V.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let O=0;O<16;O++)this._gl["COLOR_ATTACHMENT"+O+"_WEBGL"]=V["COLOR_ATTACHMENT"+O+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const V=this._gl.getExtension("WEBGL_depth_texture");null!=V&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=V.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const V=this._gl.getExtension("OES_vertex_array_object");null!=V&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=V.createVertexArrayOES.bind(V),this._gl.bindVertexArray=V.bindVertexArrayOES.bind(V),this._gl.deleteVertexArray=V.deleteVertexArrayOES.bind(V))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const V=this._gl.getExtension("ANGLE_instanced_arrays");null!=V?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=V.drawArraysInstancedANGLE.bind(V),this._gl.drawElementsInstanced=V.drawElementsInstancedANGLE.bind(V),this._gl.vertexAttribDivisor=V.vertexAttribDivisorANGLE.bind(V)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const V=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),O=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);V&&O&&(this._caps.highPrecisionShaderSupported=0!==V.precision&&0!==O.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const V=this._gl.getExtension("EXT_blend_minmax");null!=V&&(this._caps.blendMinMax=!0,this._gl.MAX=V.MAX_EXT,this._gl.MIN=V.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const V=this._gl.getExtension("EXT_sRGB");null!=V&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:V.SRGB_EXT,SRGB8:V.SRGB_ALPHA_EXT,SRGB8_ALPHA8:V.SRGB_ALPHA_EXT})}if(this._creationOptions){const V=this._creationOptions.forceSRGBBufferSupportState;void 0!==V&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&V)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let O=0;O<this._maxSimultaneousTextures;O++)this._nextFreeTextureSlots.push(O);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const V=this._workingCanvas.getContext("2d");V&&(this._workingContext=V)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const V=this.getGlInfo();return V&&V.renderer?V.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=p;let r=0;if(O&&V){let O=!0;if(this._currentRenderTarget){var Y;const Z=null===(Y=this._currentRenderTarget.texture)||void 0===Y?void 0:Y.format;if(8===Z||9===Z||10===Z||11===Z){var m;const Z=null===(m=this._currentRenderTarget.texture)||void 0===m?void 0:m.type;7===Z||5===Z?(S._TempClearColorUint32[0]=255*V.r,S._TempClearColorUint32[1]=255*V.g,S._TempClearColorUint32[2]=255*V.b,S._TempClearColorUint32[3]=255*V.a,this._gl.clearBufferuiv(this._gl.COLOR,0,S._TempClearColorUint32),O=!1):(S._TempClearColorInt32[0]=255*V.r,S._TempClearColorInt32[1]=255*V.g,S._TempClearColorInt32[2]=255*V.b,S._TempClearColorInt32[3]=255*V.a,this._gl.clearBufferiv(this._gl.COLOR,0,S._TempClearColorInt32),O=!1)}}O&&(this._gl.clearColor(V.r,V.g,V.b,void 0!==V.a?V.a:1),r|=this._gl.COLOR_BUFFER_BIT)}Z&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),r|=this._gl.DEPTH_BUFFER_BIT),d&&(this._gl.clearStencil(0),r|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(r)}_viewport(V,O,Z,d){V===this._viewportCached.x&&O===this._viewportCached.y&&Z===this._viewportCached.z&&d===this._viewportCached.w||(this._viewportCached.x=V,this._viewportCached.y=O,this._viewportCached.z=Z,this._viewportCached.w=d,this._gl.viewport(V,O,Z,d))}Ti(){super.Ti(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=V;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=V,this._bindUnboundFramebuffer(a._framebuffer);const R=this._gl;var i;if(!V.isMulti)if(V.is2DArray||V.is3D)R.framebufferTextureLayer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,null===(i=V.texture._hardwareTexture)||void 0===i?void 0:i.underlyingResource,Y,m),a._currentLOD=Y;else if(V.isCube){var M;R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+O,null===(M=V.texture._hardwareTexture)||void 0===M?void 0:M.underlyingResource,Y)}else if(a._currentLOD!==Y){var c;R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_2D,null===(c=V.texture._hardwareTexture)||void 0===c?void 0:c.underlyingResource,Y),a._currentLOD=Y}const W=V._depthStencilTexture;if(W){V.is3D&&(V.texture.width===W.width&&V.texture.height===W.height&&V.texture.depth===W.depth||r.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const Z=V._depthStencilTextureWithStencil?R.DEPTH_STENCIL_ATTACHMENT:R.DEPTH_ATTACHMENT;var F;if(V.is2DArray||V.is3D)R.framebufferTextureLayer(R.FRAMEBUFFER,Z,null===(F=W._hardwareTexture)||void 0===F?void 0:F.underlyingResource,Y,m);else if(V.isCube){var Q;R.framebufferTexture2D(R.FRAMEBUFFER,Z,R.TEXTURE_CUBE_MAP_POSITIVE_X+O,null===(Q=W._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,Y)}else{var b;R.framebufferTexture2D(R.FRAMEBUFFER,Z,R.TEXTURE_2D,null===(b=W._hardwareTexture)||void 0===b?void 0:b.underlyingResource,Y)}}a._MSAAFramebuffer&&this._bindUnboundFramebuffer(a._MSAAFramebuffer),this._cachedViewport&&!p?this.setViewport(this._cachedViewport,Z,d):(Z||(Z=V.width,Y&&(Z/=Math.pow(2,Y))),d||(d=V.height,Y&&(d/=Math.pow(2,Y))),this._viewport(0,0,Z,d)),this.wipeCaches()}setState(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==V||Z)&&(this._depthCullingState.cull=V);const m=this.cullBackFaces??p??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==m||Z)&&(this._depthCullingState.cullFace=m),this.setZOffset(O),this.setZOffsetUnits(Y);const a=d?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==a||Z)&&(this._depthCullingState.frontFace=a),this._stencilStateComposer.stencilMaterial=r}_bindUnboundFramebuffer(V){this._currentFramebuffer!==V&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,V),this._currentFramebuffer=V)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(V){const O=this._getTextureTarget(V);this._bindTextureDirectly(O,V,!0),this._gl.generateMipmap(O),this._bindTextureDirectly(O,null)}unBindFramebuffer(V){var O;let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;const p=V;this._currentRenderTarget=null;const r=this._gl;if(p._MSAAFramebuffer){if(V.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(V,Z,d);r.bindFramebuffer(r.READ_FRAMEBUFFER,p._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,p._framebuffer),r.blitFramebuffer(0,0,V.width,V.height,0,0,V.width,V.height,r.COLOR_BUFFER_BIT,r.NEAREST)}null===(O=V.texture)||void 0===O||!O.generateMipMaps||Z||V.isCube||this.generateMipmaps(V.texture),d&&(p._MSAAFramebuffer&&this._bindUnboundFramebuffer(p._framebuffer),d()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(V,O,Z){return this._createVertexBuffer(V,this._gl.STATIC_DRAW)}_createVertexBuffer(V,O){const Z=this._gl.createBuffer();if(!Z)throw new Error("Unable to create vertex buffer");const d=new i.e(Z);return this.bindArrayBuffer(d),"number"!==typeof V?V instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(V),O),d.wj=4*V.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,V,O),d.wj=V.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(V),O),d.wj=V),this._resetVertexBufferBinding(),d.references=1,d}createDynamicVertexBuffer(V,O){return this._createVertexBuffer(V,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(V,O,Z){const d=this._gl.createBuffer(),p=new i.e(d);if(!d)throw new Error("Unable to create index buffer");this.bindIndexBuffer(p);const r=this._normalizeIndexData(V);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,O?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),p.references=1,p.is32Bits=4===r.BYTES_PER_ELEMENT,p}_normalizeIndexData(V){if(2===V.BYTES_PER_ELEMENT)return V;if(this._caps.uintIndices){if(V instanceof Uint32Array)return V;for(let O=0;O<V.length;O++)if(V[O]>=65535)return new Uint32Array(V);return new Uint16Array(V)}return new Uint16Array(V)}bindArrayBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ARRAY_BUFFER)}bindUniformBlock(V,O,Z){const d=V.program,p=this._gl.getUniformBlockIndex(d,O);this._gl.uniformBlockBinding(d,p,Z)}bindIndexBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(V,O){(this._vaoRecordInProgress||this._currentBoundBuffer[O]!==V)&&(this._gl.bindBuffer(O,V?V.underlyingResource:null),this._currentBoundBuffer[O]=V)}updateArrayBuffer(V){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,V)}_vertexAttribPointer(V,O,Z,d,p,r,Y){const m=this._currentBufferPointers[O];if(!m)return;let a=!1;m.active?(m.buffer!==V&&(m.buffer=V,a=!0),m.size!==Z&&(m.size=Z,a=!0),m.type!==d&&(m.type=d,a=!0),m.normalized!==p&&(m.normalized=p,a=!0),m.stride!==r&&(m.stride=r,a=!0),m.offset!==Y&&(m.offset=Y,a=!0)):(a=!0,m.active=!0,m.index=O,m.size=Z,m.type=d,m.normalized=p,m.stride=r,m.offset=Y,m.buffer=V),(a||this._vaoRecordInProgress)&&(this.bindArrayBuffer(V),d===this._gl.UNSIGNED_INT||d===this._gl.INT?this._gl.vertexAttribIPointer(O,Z,d,r,Y):this._gl.vertexAttribPointer(O,Z,d,p,r,Y))}_bindIndexBufferWithCache(V){null!=V&&this._cachedIndexBuffer!==V&&(this._cachedIndexBuffer=V,this.bindIndexBuffer(V),this._uintIndicesCurrentlySet=V.is32Bits)}_bindVertexBuffersAttributes(V,O,Z){const d=O.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let p=0;p<d.length;p++){const r=O.getAttributeLocation(p);if(r>=0){const O=d[p];let Y=null;if(Z&&(Y=Z[O]),Y||(Y=V[O]),!Y)continue;this._gl.enableVertexAttribArray(r),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[r]=!0);const m=Y.getBuffer();m&&(this._vertexAttribPointer(m,r,Y.getSize(),Y.type,Y.normalized,Y.byteStride,Y.byteOffset),Y.getIsInstanced()&&(this._gl.vertexAttribDivisor(r,Y.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(r),this._currentInstanceBuffers.push(m))))}}}recordVertexArrayObject(V,O,Z,d){const p=this._gl.createVertexArray();if(!p)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(p),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(V,Z,d),this.bindIndexBuffer(O),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),p}bindVertexArrayObject(V,O){this._cachedVertexArrayObject!==V&&(this._cachedVertexArrayObject=V,this._gl.bindVertexArray(V),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=O&&O.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(V,O,Z,d,p){if(this._cachedVertexBuffers!==V||this._cachedEffectForVertexBuffers!==p){this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=p;const O=p.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let r=0;for(let Y=0;Y<O;Y++)if(Y<Z.length){const O=p.getAttributeLocation(Y);O>=0&&(this._gl.enableVertexAttribArray(O),this._vertexAttribArraysEnabled[O]=!0,this._vertexAttribPointer(V,O,Z[Y],this._gl.FLOAT,!1,d,r)),r+=4*Z[Y]}}this._bindIndexBufferWithCache(O)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(V,O,Z,d){this._cachedVertexBuffers===V&&this._cachedEffectForVertexBuffers===Z||(this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=Z,this._bindVertexBuffersAttributes(V,Z,d)),this._bindIndexBufferWithCache(O)}unbindInstanceAttributes(){let V;for(let O=0,Z=this._currentInstanceLocations.length;O<Z;O++){const Z=this._currentInstanceBuffers[O];V!=Z&&Z.references&&(V=Z,this.bindArrayBuffer(Z));const d=this._currentInstanceLocations[O];this._gl.vertexAttribDivisor(d,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(V){this._gl.deleteVertexArray(V)}_releaseBuffer(V){return V.references--,0===V.references&&(this._deleteBuffer(V),!0)}_deleteBuffer(V){this._gl.deleteBuffer(V.underlyingResource)}updateAndBindInstancesBuffer(V,O,Z){if(this.bindArrayBuffer(V),O&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,O),void 0!==Z[0].index)this.bindInstancesBuffer(V,Z,!0);else for(let d=0;d<4;d++){const O=Z[d];this._vertexAttribArraysEnabled[O]||(this._gl.enableVertexAttribArray(O),this._vertexAttribArraysEnabled[O]=!0),this._vertexAttribPointer(V,O,4,this._gl.FLOAT,!1,64,16*d),this._gl.vertexAttribDivisor(O,1),this._currentInstanceLocations.push(O),this._currentInstanceBuffers.push(V)}}bindInstancesBuffer(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(V);let d=0;if(Z)for(let p=0;p<O.length;p++){d+=4*O[p].attributeSize}for(let p=0;p<O.length;p++){const Z=O[p];void 0===Z.index&&(Z.index=this._currentEffect.getAttributeLocationByName(Z.attributeName)),Z.index<0||(this._vertexAttribArraysEnabled[Z.index]||(this._gl.enableVertexAttribArray(Z.index),this._vertexAttribArraysEnabled[Z.index]=!0),this._vertexAttribPointer(V,Z.index,Z.attributeSize,Z.attributeType||this._gl.FLOAT,Z.normalized||!1,d,Z.offset),this._gl.vertexAttribDivisor(Z.index,void 0===Z.divisor?1:Z.divisor),this._currentInstanceLocations.push(Z.index),this._currentInstanceBuffers.push(V))}}disableInstanceAttributeByName(V){if(!this._currentEffect)return;const O=this._currentEffect.getAttributeLocationByName(V);this.disableInstanceAttribute(O)}disableInstanceAttribute(V){let O,Z=!1;for(;-1!==(O=this._currentInstanceLocations.indexOf(V));)this._currentInstanceLocations.splice(O,1),this._currentInstanceBuffers.splice(O,1),Z=!0,O=this._currentInstanceLocations.indexOf(V);Z&&(this._gl.vertexAttribDivisor(V,0),this.disableAttributeByIndex(V))}disableAttributeByIndex(V){this._gl.disableVertexAttribArray(V),this._vertexAttribArraysEnabled[V]=!1,this._currentBufferPointers[V].active=!1}draw(V,O,Z,d){this.drawElementsType(V?0:1,O,Z,d)}drawPointClouds(V,O,Z){this.drawArraysType(2,V,O,Z)}drawUnIndexed(V,O,Z,d){this.drawArraysType(V?0:1,O,Z,d)}drawElementsType(V,O,Z,d){this.applyStates(),this._reportDrawCall();const p=this._drawMode(V),r=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,Y=this._uintIndicesCurrentlySet?4:2;d?this._gl.drawElementsInstanced(p,Z,r,O*Y,d):this._gl.drawElements(p,Z,r,O*Y)}drawArraysType(V,O,Z,d){this.applyStates(),this._reportDrawCall();const p=this._drawMode(V);d?this._gl.drawArraysInstanced(p,O,Z,d):this._gl.drawArrays(p,O,Z)}_drawMode(V){switch(V){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(V){this._compiledEffects[V._key]&&delete this._compiledEffects[V._key];const O=V.getPipelineContext();O&&this._deletePipelineContext(O)}_deletePipelineContext(V){const O=V;O&&O.program&&(O.program.__SPECTOR_rebuildProgram=null,(0,U.i)(O),this._gl.deleteProgram(O.program))}_getGlobalDefines(V){return(0,b.f)(V,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(V,O,Z,p,r,Y,m,a,R){let i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10?arguments[10]:void 0;const c="string"===typeof V?V:V.vertexToken||V.vertexSource||V.vertexElement||V.vertex,W="string"===typeof V?V:V.fragmentToken||V.fragmentSource||V.fragmentElement||V.fragment,F=this._getGlobalDefines();let b=r??O.defines??"";F&&(b+=F);const U=c+"+"+W+"@"+b;if(this._compiledEffects[U]){const V=this._compiledEffects[U];return m&&V.isReady()&&m(V),V._refCount++,V}this._gl&&(0,d.z)(this._gl);const H=new Q.c(V,O,Z,p,this,r,Y,m,a,R,U,O.shaderLanguage??i,O.extraInitializationsAsync??M);return this._compiledEffects[U]=H,H}_getShaderSource(V){return this._gl.getShaderSource(V)}createRawShaderProgram(V,O,Z,p){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Y=(0,d.z)(this._gl);return Y._contextWasLost=this._contextWasLost,Y.validateShaderPrograms=this.validateShaderPrograms,(0,d.s)(V,O,Z,p||this._gl,r)}createShaderProgram(V,O,Z,p,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const m=(0,d.z)(this._gl);return m._contextWasLost=this._contextWasLost,m.validateShaderPrograms=this.validateShaderPrograms,(0,d.v)(V,O,Z,p,r||this._gl,Y)}inlineShaderCode(V){return V}createPipelineContext(V){if(this._gl){(0,d.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const O=(0,d.q)(this._gl,V);return O.bd=this,O}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(V){return(0,d.k)(V,this._gl,this.validateShaderPrograms)}_preparePipelineContext(V,O,Z,p,r,Y,m,a,R,i,M){const c=(0,d.z)(this._gl);return c._contextWasLost=this._contextWasLost,c.validateShaderPrograms=this.validateShaderPrograms,c._createShaderProgramInjection=this._createShaderProgram.bind(this),c.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),c.createShaderProgramInjection=this.createShaderProgram.bind(this),c.loadFileInjection=this._loadFile.bind(this),(0,d.l)(V,O,Z,p,r,Y,m,a,R,i,M)}_createShaderProgram(V,O,Z,p){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,d.c)(V,O,Z,p,r)}_isRenderingStateCompiled(V){const O=V;return!this._isDisposed&&!O._isDisposed&&(!!this._gl.getProgramParameter(O.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(O),!0))}_executeWhenRenderingStateIsCompiled(V,O){(0,d.g)(V,O)}getUniforms(V,O){const Z=new Array,d=V;for(let p=0;p<O.length;p++)Z.push(this._gl.getUniformLocation(d.program,O[p]));return Z}getAttributes(V,O){const Z=[],d=V;for(let r=0;r<O.length;r++)try{Z.push(this._gl.getAttribLocation(d.program,O[r]))}catch(p){Z.push(-1)}return Z}enableEffect(V){(V=null!==V&&(0,p.e)(V)?V.effect:V)&&V!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(V),this._currentEffect=V,V.onBind&&V.onBind(V),V._onBindObservable&&V._onBindObservable.notifyObservers(V))}setInt(V,O){return!!V&&(this._gl.uniform1i(V,O),!0)}setInt2(V,O,Z){return!!V&&(this._gl.uniform2i(V,O,Z),!0)}setInt3(V,O,Z,d){return!!V&&(this._gl.uniform3i(V,O,Z,d),!0)}setInt4(V,O,Z,d,p){return!!V&&(this._gl.uniform4i(V,O,Z,d,p),!0)}setIntArray(V,O){return!!V&&(this._gl.uniform1iv(V,O),!0)}setIntArray2(V,O){return!(!V||O.length%2!==0)&&(this._gl.uniform2iv(V,O),!0)}setIntArray3(V,O){return!(!V||O.length%3!==0)&&(this._gl.uniform3iv(V,O),!0)}setIntArray4(V,O){return!(!V||O.length%4!==0)&&(this._gl.uniform4iv(V,O),!0)}setUInt(V,O){return!!V&&(this._gl.uniform1ui(V,O),!0)}setUInt2(V,O,Z){return!!V&&(this._gl.uniform2ui(V,O,Z),!0)}setUInt3(V,O,Z,d){return!!V&&(this._gl.uniform3ui(V,O,Z,d),!0)}setUInt4(V,O,Z,d,p){return!!V&&(this._gl.uniform4ui(V,O,Z,d,p),!0)}setUIntArray(V,O){return!!V&&(this._gl.uniform1uiv(V,O),!0)}setUIntArray2(V,O){return!(!V||O.length%2!==0)&&(this._gl.uniform2uiv(V,O),!0)}setUIntArray3(V,O){return!(!V||O.length%3!==0)&&(this._gl.uniform3uiv(V,O),!0)}setUIntArray4(V,O){return!(!V||O.length%4!==0)&&(this._gl.uniform4uiv(V,O),!0)}setArray(V,O){return!!V&&(!(O.length<1)&&(this._gl.uniform1fv(V,O),!0))}setArray2(V,O){return!(!V||O.length%2!==0)&&(this._gl.uniform2fv(V,O),!0)}setArray3(V,O){return!(!V||O.length%3!==0)&&(this._gl.uniform3fv(V,O),!0)}setArray4(V,O){return!(!V||O.length%4!==0)&&(this._gl.uniform4fv(V,O),!0)}setMatrices(V,O){return!!V&&(this._gl.uniformMatrix4fv(V,!1,O),!0)}setMatrix3x3(V,O){return!!V&&(this._gl.uniformMatrix3fv(V,!1,O),!0)}setMatrix2x2(V,O){return!!V&&(this._gl.uniformMatrix2fv(V,!1,O),!0)}setFloat(V,O){return!!V&&(this._gl.uniform1f(V,O),!0)}setFloat2(V,O,Z){return!!V&&(this._gl.uniform2f(V,O,Z),!0)}setFloat3(V,O,Z,d){return!!V&&(this._gl.uniform3f(V,O,Z,d),!0)}setFloat4(V,O,Z,d,p){return!!V&&(this._gl.uniform4f(V,O,Z,d,p),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const V=this._colorWrite;this._gl.colorMask(V,V,V,V)}}wipeCaches(V){this.preventCacheWipeBetweenFrames&&!V||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),V&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(V,O){const Z=this._gl;let d=Z.NEAREST,p=Z.NEAREST;switch(V){case 11:d=Z.LINEAR,p=O?Z.LINEAR_MIPMAP_NEAREST:Z.LINEAR;break;case 3:d=Z.LINEAR,p=O?Z.LINEAR_MIPMAP_LINEAR:Z.LINEAR;break;case 8:d=Z.NEAREST,p=O?Z.NEAREST_MIPMAP_LINEAR:Z.NEAREST;break;case 4:d=Z.NEAREST,p=O?Z.NEAREST_MIPMAP_NEAREST:Z.NEAREST;break;case 5:d=Z.NEAREST,p=O?Z.LINEAR_MIPMAP_NEAREST:Z.LINEAR;break;case 6:d=Z.NEAREST,p=O?Z.LINEAR_MIPMAP_LINEAR:Z.LINEAR;break;case 7:d=Z.NEAREST,p=Z.LINEAR;break;case 1:d=Z.NEAREST,p=Z.NEAREST;break;case 9:d=Z.LINEAR,p=O?Z.NEAREST_MIPMAP_NEAREST:Z.NEAREST;break;case 10:d=Z.LINEAR,p=O?Z.NEAREST_MIPMAP_LINEAR:Z.NEAREST;break;case 2:d=Z.LINEAR,p=Z.LINEAR;break;case 12:d=Z.LINEAR,p=Z.NEAREST}return{min:p,mag:d}}_createTexture(){const V=this._gl.createTexture();if(!V)throw new Error("Unable to create texture");return V}_createHardwareTexture(){return new W.d(this._createTexture(),this._gl)}_createInternalTexture(V,O){let Z,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=!1,Y=0,m=3,a=5,R=!1,i=1;void 0!==O&&"object"===typeof O?(p=!!O.generateMipMaps,Y=void 0===O.type?0:O.type,m=void 0===O.samplingMode?3:O.samplingMode,a=void 0===O.format?5:O.format,R=void 0!==O.useSRGBBuffer&&O.useSRGBBuffer,i=O.samples??1,Z=O.label):p=!!O,R&&(R=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==Y||this._caps.textureFloatLinearFiltering)&&(2!==Y||this._caps.textureHalfFloatLinearFiltering)||(m=1),1!==Y||this._caps.textureFloat||(Y=0,r.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const M=this._gl,c=new F.d(this,d),W=V.width||V,Q=V.height||V,b=V.depth||0,U=V.layers||0,H=this._getSamplingParameters(m,p),S=0!==U?M.TEXTURE_2D_ARRAY:0!==b?M.TEXTURE_3D:M.TEXTURE_2D,z=this._getRGBABufferInternalSizedFormat(Y,a,R),G=this._getInternalFormat(a),w=this._getWebGLTextureType(Y);return this._bindTextureDirectly(S,c),0!==U?(c.is2DArray=!0,M.texImage3D(S,0,z,W,Q,U,0,G,w,null)):0!==b?(c.is3D=!0,M.texImage3D(S,0,z,W,Q,b,0,G,w,null)):M.texImage2D(S,0,z,W,Q,0,G,w,null),M.texParameteri(S,M.TEXTURE_MAG_FILTER,H.mag),M.texParameteri(S,M.TEXTURE_MIN_FILTER,H.min),M.texParameteri(S,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(S,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),p&&this._gl.generateMipmap(S),this._bindTextureDirectly(S,null),c._useSRGBBuffer=R,c.baseWidth=W,c.baseHeight=Q,c.width=W,c.height=Q,c.depth=U,c.isReady=!0,c.samples=i,c.generateMipMaps=p,c.samplingMode=m,c.type=Y,c.format=a,c.label=Z,this._internalTexturesCache.push(c),c}_getUseSRGBBuffer(V,O){return V&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||O)}createTexture(V,O,Z,d){var p=this;let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,c=arguments.length>11?arguments[11]:void 0,W=arguments.length>12?arguments[12]:void 0,Q=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(V,O,Z,d,r,Y,m,(function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];return p._prepareWebGLTexture(...O,i)}),((V,O,Z,p,r,Y)=>{const m=this._gl,a=Z.width===V&&Z.height===O;r._creationFlags=Q??0;const R=this._getTexImageParametersForCreateTexture(r.format,r._useSRGBBuffer);if(a)return m.texImage2D(m.TEXTURE_2D,0,R.internalFormat,R.format,R.type,Z),!1;const i=this._caps.maxTextureSize;if(Z.width>i||Z.height>i||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=V,this._workingCanvas.height=O,this._workingContext.drawImage(Z,0,0,Z.width,Z.height,0,0,V,O),m.texImage2D(m.TEXTURE_2D,0,R.internalFormat,R.format,R.type,this._workingCanvas),r.width=V,r.height=O,!1);{const V=new F.d(this,2);this._bindTextureDirectly(m.TEXTURE_2D,V,!0),m.texImage2D(m.TEXTURE_2D,0,R.internalFormat,R.format,R.type,Z),this._rescaleTexture(V,r,d,R.format,(()=>{this._releaseTexture(V),this._bindTextureDirectly(m.TEXTURE_2D,r,!0),Y()}))}return!0}),a,R,i,M,c,W,b)}_getTexImageParametersForCreateTexture(V,O){let Z,d;return 1===this.webGLVersion?(Z=this._getInternalFormat(V,O),d=Z):(Z=this._getInternalFormat(V,!1),d=this._getRGBABufferInternalSizedFormat(0,V,O)),{internalFormat:d,format:Z,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(V,O,Z,d,p){}_unpackFlipY(V){this._unpackFlipYCached!==V&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,V?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=V))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(V){return V.isCube?this._gl.TEXTURE_CUBE_MAP:V.is3D?this._gl.TEXTURE_3D:V.is2DArray||V.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this._getTextureTarget(O),p=this._getSamplingParameters(V,O.useMipMaps||Z);this._setTextureParameterInteger(d,this._gl.TEXTURE_MAG_FILTER,p.mag,O),this._setTextureParameterInteger(d,this._gl.TEXTURE_MIN_FILTER,p.min),Z&&(O.generateMipMaps=!0,this._gl.generateMipmap(d)),this._bindTextureDirectly(d,null),O.samplingMode=V}updateTextureDimensions(V,O,Z){}updateTextureWrappingMode(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=this._getTextureTarget(V);null!==O&&(this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(O),V),V._cachedWrapU=O),null!==Z&&(this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Z),V),V._cachedWrapV=Z),(V.is2DArray||V.is3D)&&null!==d&&(this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(d),V),V._cachedWrapR=d),this._bindTextureDirectly(p,null)}_uploadCompressedDataToTextureDirectly(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const m=this._gl;let a=m.TEXTURE_2D;if(V.isCube&&(a=m.TEXTURE_CUBE_MAP_POSITIVE_X+r),V._useSRGBBuffer)switch(O){case 37492:case 36196:this._caps.etc2?O=m.COMPRESSED_SRGB8_ETC2:V._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?O=m.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:V._useSRGBBuffer=!1;break;case 36492:O=m.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:O=m.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?O=m.COMPRESSED_SRGB_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?O=m.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?O=m.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:V._useSRGBBuffer=!1;break;default:V._useSRGBBuffer=!1}this._gl.compressedTexImage2D(a,Y,O,Z,d,0,p)}_uploadDataToTextureDirectly(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=this._gl,m=this._getWebGLTextureType(V.type),a=this._getInternalFormat(V.format),R=void 0===p?this._getRGBABufferInternalSizedFormat(V.type,V.format,V._useSRGBBuffer):this._getInternalFormat(p,V._useSRGBBuffer);this._unpackFlipY(V.invertY);let i=Y.TEXTURE_2D;V.isCube&&(i=Y.TEXTURE_CUBE_MAP_POSITIVE_X+Z);const M=Math.round(Math.log(V.width)*Math.LOG2E),c=Math.round(Math.log(V.height)*Math.LOG2E),W=r?V.width:Math.pow(2,Math.max(M-d,0)),F=r?V.height:Math.pow(2,Math.max(c-d,0));Y.texImage2D(i,d,R,W,F,0,a,m,O)}updateTextureData(V,O,Z,d,p,r){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const R=this._gl,i=this._getWebGLTextureType(V.type),M=this._getInternalFormat(V.format);this._unpackFlipY(V.invertY);let c=R.TEXTURE_2D,W=R.TEXTURE_2D;V.isCube&&(W=R.TEXTURE_CUBE_MAP_POSITIVE_X+Y,c=R.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c,V,!0),R.texSubImage2D(W,m,Z,d,p,r,M,i,O),a&&this._gl.generateMipmap(W),this._bindTextureDirectly(c,null)}_uploadArrayBufferViewToTexture(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const p=this._gl,r=V.isCube?p.TEXTURE_CUBE_MAP:p.TEXTURE_2D;this._bindTextureDirectly(r,V,!0),this._uploadDataToTextureDirectly(V,O,Z,d),this._bindTextureDirectly(r,null,!0)}_prepareWebGLTextureContinuation(V,O,Z,d,p){const r=this._gl;if(!r)return;const Y=this._getSamplingParameters(p,!Z);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,Y.mag),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,Y.min),Z||d||r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null),O&&O.removePendingData(V),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear()}_prepareWebGLTexture(V,O,Z,d,p,r,Y,m,a,R){const i=this.getCaps().maxTextureSize,c=Math.min(i,this.needPOTTextures?(0,M.g)(d.width,i):d.width),W=Math.min(i,this.needPOTTextures?(0,M.g)(d.height,i):d.height),F=this._gl;F&&(V._hardwareTexture?(this._bindTextureDirectly(F.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===p||!!p),V.baseWidth=d.width,V.baseHeight=d.height,V.width=c,V.height=W,V.isReady=!0,V.type=-1!==V.type?V.type:0,V.format=-1!==V.format?V.format:R??(".jpg"!==O||V._useSRGBBuffer?5:4),m(c,W,d,O,V,(()=>{this._prepareWebGLTextureContinuation(V,Z,r,Y,a)}))||this._prepareWebGLTextureContinuation(V,Z,r,Y,a)):Z&&Z.removePendingData(V))}_getInternalFormatFromDepthTextureFormat(V,O,Z){const d=this._gl;if(!O)return d.STENCIL_INDEX8;let p=Z?d.DEPTH_STENCIL:d.DEPTH_COMPONENT;return this.webGLVersion>1?15===V?p=d.DEPTH_COMPONENT16:16===V?p=d.DEPTH_COMPONENT24:17===V||13===V?p=Z?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24:14===V?p=d.DEPTH_COMPONENT32F:18===V&&(p=Z?d.DEPTH32F_STENCIL8:d.DEPTH_COMPONENT32F):p=d.DEPTH_COMPONENT16,p}_setupFramebufferDepthAttachments(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5?arguments[5]:void 0;const Y=this._gl;r=r??(V?13:14);const m=this._getInternalFormatFromDepthTextureFormat(r,O,V);return V&&O?this._createRenderBuffer(Z,d,p,Y.DEPTH_STENCIL,m,Y.DEPTH_STENCIL_ATTACHMENT):O?this._createRenderBuffer(Z,d,p,m,m,Y.DEPTH_ATTACHMENT):V?this._createRenderBuffer(Z,d,p,m,m,Y.STENCIL_ATTACHMENT):null}_createRenderBuffer(V,O,Z,d,p,r){let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const m=this._gl.createRenderbuffer();return this._updateRenderBuffer(m,V,O,Z,d,p,r,Y)}_updateRenderBuffer(V,O,Z,d,p,r,Y){let m=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const a=this._gl;return a.bindRenderbuffer(a.RENDERBUFFER,V),d>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,d,r,O,Z):a.renderbufferStorage(a.RENDERBUFFER,p,O,Z),a.framebufferRenderbuffer(a.FRAMEBUFFER,Y,a.RENDERBUFFER,V),m&&a.bindRenderbuffer(a.RENDERBUFFER,null),V}_releaseTexture(V){this._deleteTexture(V._hardwareTexture),this.unbindAllTextures();const O=this._internalTexturesCache.indexOf(V);-1!==O&&this._internalTexturesCache.splice(O,1),V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureLow&&V._lodTextureLow.dispose(),V._irradianceTexture&&V._irradianceTexture.dispose()}_deleteTexture(V){null===V||void 0===V||V.release()}_setProgram(V){this._currentProgram!==V&&((0,d.m)(V,this._gl),this._currentProgram=V)}bindSamplers(V){const O=V.getPipelineContext();this._setProgram(O.program);const Z=V.getSamplers();for(let d=0;d<Z.length;d++){const O=V.getUniform(Z[d]);O&&(this._boundUniforms[d]=O)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=!1;const Y=O&&O._associatedChannel>-1;Z&&Y&&(this._activeChannel=O._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==O||d){if(this._activateCurrentTexture(),O&&O.isMultiview)throw r.b.Error(["_bindTextureDirectly called with a multiview texture!",V,O]),"_bindTextureDirectly called with a multiview texture!";var m;this._gl.bindTexture(V,(null===O||void 0===O||null===(m=O._hardwareTexture)||void 0===m?void 0:m.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=O,O&&(O._associatedChannel=this._activeChannel)}else Z&&(p=!0,this._activateCurrentTexture());return Y&&!Z&&this._bindSamplerUniformToChannel(O._associatedChannel,this._activeChannel),p}_bindTexture(V,O,Z){if(void 0===V)return;O&&(O._associatedChannel=V),this._activeChannel=V;const d=O?this._getTextureTarget(O):this._gl.TEXTURE_2D;this._bindTextureDirectly(d,O)}unbindAllTextures(){for(let V=0;V<this._maxSimultaneousTextures;V++)this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(V,O,Z,d){void 0!==V&&(O&&(this._boundUniforms[V]=O),this._setTexture(V,Z))}_bindSamplerUniformToChannel(V,O){const Z=this._boundUniforms[V];Z&&Z._currentState!==O&&(this._gl.uniform1i(Z,O),Z._currentState=O)}_getTextureWrapMode(V){switch(V){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(V,O){let Z,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!O)return null!=this._boundTexturesCache[V]&&(this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(O.video){this._activeChannel=V;const Z=O.getInternalTexture();Z&&(Z._associatedChannel=V),O.update()}else if(4===O.delayLoadState)return O.delayLoad(),!1;Z=p?O.depthStencilTexture:O.isReady()?O.getInternalTexture():O.isCube?this.emptyCubeTexture:O.is3D?this.emptyTexture3D:O.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!d&&Z&&(Z._associatedChannel=V);let r=!0;this._boundTexturesCache[V]===Z&&(d||this._bindSamplerUniformToChannel(Z._associatedChannel,V),r=!1),this._activeChannel=V;const Y=this._getTextureTarget(Z);if(r&&this._bindTextureDirectly(Y,Z,d),Z&&!Z.isMultiview){if(Z.isCube&&Z._cachedCoordinatesMode!==O.coordinatesMode){Z._cachedCoordinatesMode=O.coordinatesMode;const V=3!==O.coordinatesMode&&5!==O.coordinatesMode?1:0;O.wrapU=V,O.wrapV=V}Z._cachedWrapU!==O.wrapU&&(Z._cachedWrapU=O.wrapU,this._setTextureParameterInteger(Y,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(O.wrapU),Z)),Z._cachedWrapV!==O.wrapV&&(Z._cachedWrapV=O.wrapV,this._setTextureParameterInteger(Y,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(O.wrapV),Z)),Z.is3D&&Z._cachedWrapR!==O.wrapR&&(Z._cachedWrapR=O.wrapR,this._setTextureParameterInteger(Y,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(O.wrapR),Z)),this._setAnisotropicLevel(Y,Z,O.anisotropicFilteringLevel)}return!0}setTextureArray(V,O,Z,d){if(void 0!==V&&O){this._textureUnits&&this._textureUnits.length===Z.length||(this._textureUnits=new Int32Array(Z.length));for(let O=0;O<Z.length;O++){const d=Z[O].getInternalTexture();d?(this._textureUnits[O]=V+O,d._associatedChannel=V+O):this._textureUnits[O]=-1}this._gl.uniform1iv(O,this._textureUnits);for(let V=0;V<Z.length;V++)this._setTexture(this._textureUnits[V],Z[V],!0)}}_setAnisotropicLevel(V,O,Z){const d=this._caps.textureAnisotropicFilterExtension;11!==O.samplingMode&&3!==O.samplingMode&&2!==O.samplingMode&&(Z=1),d&&O._cachedAnisotropicFilteringLevel!==Z&&(this._setTextureParameterFloat(V,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z,this._caps.maxAnisotropy),O),O._cachedAnisotropicFilteringLevel=Z)}_setTextureParameterFloat(V,O,Z,d){this._bindTextureDirectly(V,d,!0,!0),this._gl.texParameterf(V,O,Z)}_setTextureParameterInteger(V,O,Z,d){d&&this._bindTextureDirectly(V,d,!0,!0),this._gl.texParameteri(V,O,Z)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let V=0;V<this._caps.maxVertexAttribs;V++)this.disableAttributeByIndex(V)}else for(let V=0,O=this._vertexAttribArraysEnabled.length;V<O;V++)V>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[V]||this.disableAttributeByIndex(V)}releaseEffects(){const V=Object.keys(this._compiledEffects);for(const O of V){this._compiledEffects[O].dispose()}this._compiledEffects={}}dispose(){var V;((0,Y.n)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(V=this._gl.getExtension("WEBGL_lose_context"))||void 0===V||V.loseContext());(0,d.y)(this._gl)}attachContextLostEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",V,!1)}attachContextRestoredEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",V,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(V){const O=this._gl;for(;O.getError()!==O.NO_ERROR;);let Z=!0;const d=O.createTexture();O.bindTexture(O.TEXTURE_2D,d),O.texImage2D(O.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(V),1,1,0,O.RGBA,this._getWebGLTextureType(V),null),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.NEAREST),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.NEAREST);const p=O.createFramebuffer();O.bindFramebuffer(O.FRAMEBUFFER,p),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,d,0);const r=O.checkFramebufferStatus(O.FRAMEBUFFER);if(Z=Z&&r===O.FRAMEBUFFER_COMPLETE,Z=Z&&O.getError()===O.NO_ERROR,Z&&(O.clear(O.COLOR_BUFFER_BIT),Z=Z&&O.getError()===O.NO_ERROR),Z){O.bindFramebuffer(O.FRAMEBUFFER,null);const V=O.RGBA,d=O.UNSIGNED_BYTE,p=new Uint8Array(4);O.readPixels(0,0,1,1,V,d,p),Z=Z&&O.getError()===O.NO_ERROR}for(O.deleteTexture(d),O.deleteFramebuffer(p),O.bindFramebuffer(O.FRAMEBUFFER,null);!Z&&O.getError()!==O.NO_ERROR;);return Z}_getWebGLTextureType(V){if(1===this._webGLVersion){switch(V){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(V){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=O?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(V){case 0:Z=this._gl.ALPHA;break;case 1:Z=this._gl.LUMINANCE;break;case 2:Z=this._gl.LUMINANCE_ALPHA;break;case 6:Z=this._gl.RED;break;case 7:Z=this._gl.RG;break;case 4:Z=O?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:Z=O?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(V){case 8:Z=this._gl.RED_INTEGER;break;case 9:Z=this._gl.RG_INTEGER;break;case 10:Z=this._gl.RGB_INTEGER;break;case 11:Z=this._gl.RGBA_INTEGER}return Z}_getRGBABufferInternalSizedFormat(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==O)switch(O){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return Z?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(V){case 3:switch(O){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(O){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return Z?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return Z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(O){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(O){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(O){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(O){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(O){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(O){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(O){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return Z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(V,O,Z,d){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const Y=p?4:3,m=p?this._gl.RGBA:this._gl.RGB,a=new Uint8Array(d*Z*Y);return r&&this.flushFramebuffer(),this._gl.readPixels(V,O,Z,d,m,this._gl.UNSIGNED_BYTE,a),Promise.resolve(a)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const V=c.e._CreateCanvas(1,1),O=V.getContext("webgl")||V.getContext("experimental-webgl");this._IsSupported=null!=O&&!!window.WebGLRenderingContext}catch(V){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const V=c.e._CreateCanvas(1,1),O=V.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||V.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!O}catch(V){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}S._TempClearColorUint32=new Uint32Array(4),S._TempClearColorInt32=new Int32Array(4),S.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],S._ConcatenateShader=b.d,S._IsSupported=null,S._HasMajorPerformanceCaveat=null},11365:(V,O,Z)=>{"use strict";var d;Z.d(O,{e:()=>p}),function(V){V[V.PointerMove=0]="PointerMove",V[V.PointerDown=1]="PointerDown",V[V.PointerUp=2]="PointerUp"}(d||(d={}));class p{}p.DOM_DELTA_PIXEL=0,p.DOM_DELTA_LINE=1,p.DOM_DELTA_PAGE=2},11358:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d,d:()=>r,e:()=>p});class d{}d.KEYDOWN=1,d.KEYUP=2;class p{constructor(V,O){this.type=V,this.event=O}}class r extends p{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(V){this.skipOnKeyboardObservable=V}constructor(V,O){super(V,O),this.type=V,this.event=O,this.skipOnKeyboardObservable=!1}}},11349:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>p,g:()=>Y,h:()=>m});var d=Z(11251);class p{}p.POINTERDOWN=1,p.POINTERUP=2,p.POINTERMOVE=4,p.POINTERWHEEL=8,p.POINTERPICK=16,p.POINTERTAP=32,p.POINTERDOUBLETAP=64;class r{constructor(V,O){this.type=V,this.event=O}}class Y extends r{constructor(V,O,Z,p){super(V,O),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new d.l(Z,p)}}class m extends r{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(V,O),this._pickInfo=Z,this._inputManager=d}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10894:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{SceneInstrumentation:()=>r});var d=Z(10900),p=Z(11053);class r{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(V){V!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=V,V?(this._onBeforeActiveMeshesEvaluationObserver=this.Cf.onBeforeActiveMeshesEvaluationObservable.add((()=>{d.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Cf.onAfterActiveMeshesEvaluationObservable.add((()=>{d.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Cf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Cf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(V){V!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=V,V?(this._onBeforeRenderTargetsRenderObserver=this.Cf.onBeforeRenderTargetsRenderObservable.add((()=>{d.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Cf.onAfterRenderTargetsRenderObservable.add((()=>{d.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Cf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Cf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(V){V!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=V,V?(this._onBeforeParticlesRenderingObserver=this.Cf.onBeforeParticlesRenderingObservable.add((()=>{d.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Cf.onAfterParticlesRenderingObservable.add((()=>{d.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Cf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Cf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(V){V!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=V,this.Cf.spriteManagers&&(V?(this._onBeforeSpritesRenderingObserver=this.Cf.onBeforeSpritesRenderingObservable.add((()=>{d.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Cf.onAfterSpritesRenderingObservable.add((()=>{d.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Cf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Cf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(V){V!==this._capturePhysicsTime&&this.Cf.onBeforePhysicsObservable&&(this._capturePhysicsTime=V,V?(this._onBeforePhysicsObserver=this.Cf.onBeforePhysicsObservable.add((()=>{d.e.StartPerformanceCounter("mb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Cf.onAfterPhysicsObservable.add((()=>{d.e.EndPerformanceCounter("mb"),this._physicsTime.endMonitoring()}))):(this.Cf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Cf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(V){V!==this._captureAnimationsTime&&(this._captureAnimationsTime=V,V?this._onAfterAnimationsObserver=this.Cf.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Cf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(V){this._captureFrameTime=V}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(V){this._captureInterFrameTime=V}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(V){V!==this._captureRenderTime&&(this._captureRenderTime=V,V?(this._onBeforeDrawPhaseObserver=this.Cf.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),d.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Cf.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),d.e.EndPerformanceCounter("Main render")}))):(this.Cf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Cf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(V){V!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=V,V?(this._onBeforeCameraRenderObserver=this.Cf.onBeforeCameraRenderObservable.add((V=>{this._cameraRenderTime.beginMonitoring(),d.e.StartPerformanceCounter(`Rendering camera ${V.name}`)})),this._onAfterCameraRenderObserver=this.Cf.onAfterCameraRenderObservable.add((V=>{this._cameraRenderTime.endMonitoring(!1),d.e.EndPerformanceCounter(`Rendering camera ${V.name}`)}))):(this.Cf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Cf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Cf.getEngine()._drawCalls}constructor(V){this.Cf=V,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new p.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new p.d,this._captureFrameTime=!1,this._frameTime=new p.d,this._captureRenderTime=!1,this._renderTime=new p.d,this._captureInterFrameTime=!1,this._interFrameTime=new p.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new p.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new p.d,this._capturePhysicsTime=!1,this._physicsTime=new p.d,this._captureAnimationsTime=!1,this._animationsTime=new p.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new p.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=V.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(d.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Cf.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=V.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(d.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ti(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ti(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ti(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ti(),this._captureRenderTime&&this._renderTime.Ti(),this._captureCameraRenderTime&&this._cameraRenderTime.Ti()}))}dispose(){this.Cf.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Cf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Cf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Cf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Cf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Cf.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Cf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Cf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Cf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Cf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Cf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Cf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Cf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Cf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Cf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Cf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Cf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Cf=null}}},12236:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>i});var d=Z(11210),p=Z(11216),r=Z(11251),Y=Z(11521),m=Z(12193),a=Z(12245),R=Z(11041);Y.e.AddNodeConstructor("Light_Type_1",((V,O)=>()=>new i(V,r.m.Zero(),O)));class i extends a.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(V){this._shadowFrustumSize=V,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(V){this._shadowOrthoScale=V,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(V){this._orthoLeft=V}get orthoRight(){return this._orthoRight}set orthoRight(V){this._orthoRight=V}get orthoTop(){return this._orthoTop}set orthoTop(V){this._orthoTop=V}get orthoBottom(){return this._orthoBottom}set orthoBottom(V){this._orthoBottom=V}constructor(V,O,Z){super(V,Z),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"nb"}getTypeID(){return m.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(V,O,Z){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(V):this._setDefaultAutoExtendShadowProjectionMatrix(V,O,Z)}_setDefaultFixedFrustumShadowProjectionMatrix(V){const O=this.va().activeCamera;O&&r.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.Ii,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,V,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(V,O,Z){const d=this.va().activeCamera;if(!d)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const V=r.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let d=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let Y=0;Y<Z.length;Y++){const m=Z[Y];if(!m)continue;const a=m.getBoundingInfo().boundingBox;for(let Z=0;Z<a.vectorsWorld.length;Z++)r.m.TransformCoordinatesToRef(a.vectorsWorld[Z],O,V),V.x<this._orthoLeft&&(this._orthoLeft=V.x),V.y<this._orthoBottom&&(this._orthoBottom=V.y),V.x>this._orthoRight&&(this._orthoRight=V.x),V.y>this._orthoTop&&(this._orthoTop=V.y),this.autoCalcShadowZBounds&&(V.z<d&&(d=V.z),V.z>p&&(p=V.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=d,this._shadowMaxZ=p)}const p=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,m=void 0!==this.shadowMinZ?this.shadowMinZ:d.Ii,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,R=this.va().getEngine().useReverseDepthBuffer;r.c.OrthoOffCenterLHToRef(this._orthoLeft-p*this.shadowOrthoScale,this._orthoRight+p*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,R?a:m,R?m:a,V,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(V,O){return this.computeTransformedInformation()?(V.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(V.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(V){const O=this._scene.getEngine();return!O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}getDepthMaxZ(V){const O=this._scene.getEngine();return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(V,O){V["DIRLIGHT"+O]=!0}}(0,d.c)([(0,p.K)()],i.prototype,"shadowFrustumSize",null),(0,d.c)([(0,p.K)()],i.prototype,"shadowOrthoScale",null),(0,d.c)([(0,p.K)()],i.prototype,"autoUpdateExtends",void 0),(0,d.c)([(0,p.K)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,d.c)([(0,p.K)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,d.c)([(0,p.K)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,d.c)([(0,p.K)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,d.c)([(0,p.K)("orthoBottom")],i.prototype,"_orthoBottom",void 0),(0,R.f)("BABYLON.DirectionalLight",i)},12580:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>i});var d=Z(11210),p=Z(11216),r=Z(11251),Y=Z(11274),m=Z(11521),a=Z(12193),R=Z(11041);m.e.AddNodeConstructor("Light_Type_3",((V,O)=>()=>new i(V,r.m.Zero(),O)));class i extends a.d{constructor(V,O,Z){super(V,Z),this.groundColor=new Y.b(0,0,0),this.direction=O||r.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ob"}setDirectionToTarget(V){return this.direction=r.m.Normalize(V.fc(r.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(V,O){const Z=r.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Z.x,Z.y,Z.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Mi),O),this}transferToNodeMaterialEffect(V,O){const Z=r.m.Normalize(this.direction);return V.setFloat3(O,Z.x,Z.y,Z.z),this}Cj(){return this._worldMatrix||(this._worldMatrix=r.c.Identity()),this._worldMatrix}getTypeID(){return a.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(V,O){V["HEMILIGHT"+O]=!0}}(0,d.c)([(0,p.k)()],i.prototype,"groundColor",void 0),(0,d.c)([(0,p.G)()],i.prototype,"direction",void 0),(0,R.f)("BABYLON.HemisphericLight",i)},12193:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>c});var d=Z(11210),p=Z(11216),r=Z(11251),Y=Z(11274),m=Z(11521),a=Z(11305),R=Z(11041),i=Z(11397),M=Z(11283);class c extends m.e{get range(){return this._range}set range(V){this._range=V,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(V){this._intensityMode=V,this._computePhotometricScale()}get i(){return this._radius}set i(V){this._radius=V,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(V){this._shadowEnabled!==V&&(this._shadowEnabled=V,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(V){this._includedOnlyMeshes=V,this._hookArrayForIncludedOnly(V)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(V){this._excludedMeshes=V,this._hookArrayForExcluded(V)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(V){this._excludeWithLayerMask=V,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(V){this._includeOnlyWithLayerMask=V,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(V){this._lightmapMode!==V&&(this._lightmapMode=V,this._markMeshesAsLightDirty())}getViewMatrix(V){return null}getProjectionMatrix(V,O){return null}constructor(V,O){super(V,O,!1),this._g=new Y.b(1,1,1),this.ah=new Y.b(1,1,1),this.falloffType=c.FALLOFF_DEFAULT,this.Mi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=c.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new a.b(this.va().getEngine(),void 0,void 0,V),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(V,O){return this}_bindLight(V,O,Z,d){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=V.toString();let m=!1;if(this._uniformBuffer.bindToEffect(Z,"Light"+r),this._renderId!==O.getRenderId()||this._lastUseSpecular!==d||!this._uniformBuffer.useUbo){this._renderId=O.getRenderId(),this._lastUseSpecular=d;const V=this.getScaledIntensity();this.transferToEffect(Z,r),this._g.scaleToRef(V,Y.h.jb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Y.h.jb[0],this.range,r),d&&(this.ah.scaleToRef(V,Y.h.jb[1]),this._uniformBuffer.updateColor4("vLightSpecular",Y.h.jb[1],this.i,r)),m=!0}if(this.transferTexturesToEffect(Z,r),O.shadowsEnabled&&this.shadowEnabled&&p){const V=this.getShadowGenerator(O.activeCamera)??this.getShadowGenerator();V&&(V.bindShadowLight(r,Z),m=!0)}m?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(V){let O="Name: "+this.name;if(O+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let Z=0;Z<this.animations.length;Z++)O+=", animation[0]: "+this.animations[Z].toString(V);return O}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}If(V){super.If(V),this._resyncMeshes()}getShadowGenerator(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(V)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return r.m.Zero()}canAffectMesh(V){return!V||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(V))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(V))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&V.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&V.layerMask)))}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const V=this._shadowGenerators.values();for(let O=V.next();!0!==O.done;O=V.next()){O.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const V=this._parentContainer.lights.indexOf(this);V>-1&&this._parentContainer.lights.splice(V,1),this._parentContainer=null}for(const Z of this.va().meshes)Z._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(V,O)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Mi}clone(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=c.GetConstructorFromName(this.getTypeID(),V,this.va());if(!Z)return null;const d=M.b.Clone(Z,this);return V&&(d.name=V),O&&(d.parent=O),d.If(this.isEnabled()),this.onClonedObservable.notifyObservers(d),d}serialize(){const V=M.b.Serialize(this);return V.uniqueId=this.uniqueId,V.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(V),this.excludedMeshes.length>0&&(V.excludedMeshesIds=[],this.excludedMeshes.forEach((O=>{V.excludedMeshesIds.push(O.id)}))),this.includedOnlyMeshes.length>0&&(V.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((O=>{V.includedOnlyMeshesIds.push(O.id)}))),M.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}static GetConstructorFromName(V,O,Z){const d=m.e.Construct("Light_Type_"+V,O,Z);return d||null}static Parse(V,O){const Z=c.GetConstructorFromName(V.type,V.name,O);if(!Z)return null;const d=M.b.Parse(Z,V,O);if(V.excludedMeshesIds&&(d._excludedMeshesIds=V.excludedMeshesIds),V.includedOnlyMeshesIds&&(d._includedOnlyMeshesIds=V.includedOnlyMeshesIds),void 0!==V.parentId&&(d._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(d._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.falloffType&&(d.falloffType=V.falloffType),void 0!==V.lightmapMode&&(d.lightmapMode=V.lightmapMode),V.animations){for(let O=0;O<V.animations.length;O++){const Z=V.animations[O],p=(0,R.c)("BABYLON.Animation");p&&d.animations.push(p.Parse(Z))}m.e.ParseAnimationRanges(d,V,O)}return V.autoAnimate&&O.beginAnimation(d,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&d.If(V.isEnabled),d}_hookArrayForExcluded(V){var O=this;const Z=V.push;V.push=function(){for(var d=arguments.length,p=new Array(d),r=0;r<d;r++)p[r]=arguments[r];const Y=Z.apply(V,p);for(const V of p)V._resyncLightSource(O);return Y};const d=V.splice;V.splice=(O,Z)=>{const p=d.apply(V,[O,Z]);for(const V of p)V._resyncLightSource(this);return p};for(const p of V)p._resyncLightSource(this)}_hookArrayForIncludedOnly(V){var O=this;const Z=V.push;V.push=function(){for(var d=arguments.length,p=new Array(d),r=0;r<d;r++)p[r]=arguments[r];const Y=Z.apply(V,p);return O._resyncMeshes(),Y};const d=V.splice;V.splice=(O,Z)=>{const p=d.apply(V,[O,Z]);return this._resyncMeshes(),p},this._resyncMeshes()}_resyncMeshes(){for(const V of this.va().meshes)V._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const V of this.va().meshes)-1!==V.lightSources.indexOf(this)&&V._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let V=0;const O=this.getTypeID();let Z=this.intensityMode;switch(Z===c.INTENSITYMODE_AUTOMATIC&&(Z=O===c.LIGHTTYPEID_DIRECTIONALLIGHT?c.INTENSITYMODE_ILLUMINANCE:c.INTENSITYMODE_LUMINOUSINTENSITY),O){case c.LIGHTTYPEID_POINTLIGHT:case c.LIGHTTYPEID_SPOTLIGHT:switch(Z){case c.INTENSITYMODE_LUMINOUSPOWER:V=1/(4*Math.PI);break;case c.INTENSITYMODE_LUMINOUSINTENSITY:V=1;break;case c.INTENSITYMODE_LUMINANCE:V=this.i*this.i}break;case c.LIGHTTYPEID_DIRECTIONALLIGHT:switch(Z){case c.INTENSITYMODE_ILLUMINANCE:V=1;break;case c.INTENSITYMODE_LUMINANCE:{let O=this.i;O=Math.max(O,.001);V=2*Math.PI*(1-Math.cos(O));break}}break;case c.LIGHTTYPEID_HEMISPHERICLIGHT:V=1}return V}_reorderLightsInScene(){const V=this.va();0!=this._renderPriority&&(V.requireLightSorting=!0),this.va().sortLightsByPriority()}}c.FALLOFF_DEFAULT=i.d.FALLOFF_DEFAULT,c.FALLOFF_PHYSICAL=i.d.FALLOFF_PHYSICAL,c.FALLOFF_GLTF=i.d.FALLOFF_GLTF,c.FALLOFF_STANDARD=i.d.FALLOFF_STANDARD,c.LIGHTMAP_DEFAULT=i.d.LIGHTMAP_DEFAULT,c.LIGHTMAP_SPECULAR=i.d.LIGHTMAP_SPECULAR,c.LIGHTMAP_SHADOWSONLY=i.d.LIGHTMAP_SHADOWSONLY,c.INTENSITYMODE_AUTOMATIC=i.d.INTENSITYMODE_AUTOMATIC,c.INTENSITYMODE_LUMINOUSPOWER=i.d.INTENSITYMODE_LUMINOUSPOWER,c.INTENSITYMODE_LUMINOUSINTENSITY=i.d.INTENSITYMODE_LUMINOUSINTENSITY,c.INTENSITYMODE_ILLUMINANCE=i.d.INTENSITYMODE_ILLUMINANCE,c.INTENSITYMODE_LUMINANCE=i.d.INTENSITYMODE_LUMINANCE,c.LIGHTTYPEID_POINTLIGHT=i.d.LIGHTTYPEID_POINTLIGHT,c.LIGHTTYPEID_DIRECTIONALLIGHT=i.d.LIGHTTYPEID_DIRECTIONALLIGHT,c.LIGHTTYPEID_SPOTLIGHT=i.d.LIGHTTYPEID_SPOTLIGHT,c.LIGHTTYPEID_HEMISPHERICLIGHT=i.d.LIGHTTYPEID_HEMISPHERICLIGHT,(0,d.c)([(0,p.k)()],c.prototype,"diffuse",void 0),(0,d.c)([(0,p.k)()],c.prototype,"specular",void 0),(0,d.c)([(0,p.K)()],c.prototype,"falloffType",void 0),(0,d.c)([(0,p.K)()],c.prototype,"intensity",void 0),(0,d.c)([(0,p.K)()],c.prototype,"range",null),(0,d.c)([(0,p.K)()],c.prototype,"intensityMode",null),(0,d.c)([(0,p.K)()],c.prototype,"i",null),(0,d.c)([(0,p.K)()],c.prototype,"_renderPriority",void 0),(0,d.c)([(0,p.b)("_reorderLightsInScene")],c.prototype,"renderPriority",void 0),(0,d.c)([(0,p.K)("shadowEnabled")],c.prototype,"_shadowEnabled",void 0),(0,d.c)([(0,p.K)("excludeWithLayerMask")],c.prototype,"_excludeWithLayerMask",void 0),(0,d.c)([(0,p.K)("includeOnlyWithLayerMask")],c.prototype,"_includeOnlyWithLayerMask",void 0),(0,d.c)([(0,p.K)("lightmapMode")],c.prototype,"_lightmapMode",void 0)},11397:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{static CompareLightsPriority(V,O){return V.shadowEnabled!==O.shadowEnabled?(O.shadowEnabled?1:0)-(V.shadowEnabled?1:0):O.renderPriority-V.renderPriority}}d.FALLOFF_DEFAULT=0,d.FALLOFF_PHYSICAL=1,d.FALLOFF_GLTF=2,d.FALLOFF_STANDARD=3,d.LIGHTMAP_DEFAULT=0,d.LIGHTMAP_SPECULAR=1,d.LIGHTMAP_SHADOWSONLY=2,d.INTENSITYMODE_AUTOMATIC=0,d.INTENSITYMODE_LUMINOUSPOWER=1,d.INTENSITYMODE_LUMINOUSINTENSITY=2,d.INTENSITYMODE_ILLUMINANCE=3,d.INTENSITYMODE_LUMINANCE=4,d.LIGHTTYPEID_POINTLIGHT=0,d.LIGHTTYPEID_DIRECTIONALLIGHT=1,d.LIGHTTYPEID_SPOTLIGHT=2,d.LIGHTTYPEID_HEMISPHERICLIGHT=3},12245:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>a});var d=Z(11210),p=Z(11216),r=Z(11251),Y=Z(12193),m=Z(11562);class a extends Y.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=r.c.Identity(),this._projectionMatrix=r.c.Identity()}_setPosition(V){this._position=V}get position(){return this._position}set position(V){this._setPosition(V)}_setDirection(V){this._direction=V}get direction(){return this._direction}set direction(V){this._setDirection(V)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(V){this._shadowMinZ=V,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(V){this._shadowMaxZ=V,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=r.m.Zero()),r.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=r.m.Zero()),r.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(V){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(V){return this.direction=r.m.Normalize(V.fc(this.position)),this.direction}getRotation(){this.direction.normalize();const V=r.m.Cross(this.direction,m.b.Y),O=r.m.Cross(V,this.direction);return r.m.RotationFromAxis(V,O,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=r.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Cj(V){return!V&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=r.c.Identity()),r.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(V){return void 0!==this.shadowMinZ?this.shadowMinZ:V.Ii}getDepthMaxZ(V){return void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ}setShadowProjectionMatrix(V,O,Z){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(O,Z,V):this._setDefaultShadowProjectionMatrix(V,O,Z),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(V){const O=r.i.ib[0];let Z=this.position;this.computeTransformedInformation()&&(Z=this.transformedPosition),r.m.NormalizeToRef(this.getShadowDirection(V),O),1===Math.abs(r.m.Dot(O,r.m.Up()))&&(O.z=1e-13);const d=r.i.ib[1];return Z.addToRef(O,d),r.c.LookAtLHToRef(Z,d,r.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(V,O){return this.setShadowProjectionMatrix(this._projectionMatrix,V??this._viewMatrix,O??[]),this._projectionMatrix}}(0,d.c)([(0,p.G)()],a.prototype,"position",null),(0,d.c)([(0,p.G)()],a.prototype,"direction",null),(0,d.c)([(0,p.K)()],a.prototype,"shadowMinZ",null),(0,d.c)([(0,p.K)()],a.prototype,"shadowMaxZ",null)},11848:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y,e:()=>r,g:()=>m});const d={},p={};function r(V,O){d[V]=O}function Y(V,O){p[V]=O}function m(V){return p[V]?p[V]:null}},11616:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>u,h:()=>w});var d,p=Z(10900),r=Z(10902),Y=Z(11238),m=Z(10942),a=Z(10914),R=Z(11545),i=Z(10947),M=Z(10951),c=Z(11045),W=Z(10983);!function(V){V[V.Clean=0]="Clean",V[V.Stop=1]="Stop",V[V.Sync=2]="Sync",V[V.NoSync=3]="NoSync"}(d||(d={}));const F=new r.e,Q={};let b=!1;function U(){return Q[".babylon"]}function H(V){const O=Q[V];return O||(a.b.Warn("Unable to find a plugin to load "+V+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U())}function S(V,O,Z){let d="Unable to load from "+(V.rawData?"binary data":V.url);return O?d+=`: ${O}`:Z&&(d+=`: ${Z}`),d}function z(V,O,Z,d,p,r,Y,m,a){var R;const M="data:"===(c=V.url).substring(0,5)?c.substring(5):null;var c;if(V.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const b=Y?H(Y):M?function(V){for(const O in Q){const Z=Q[O].plugin;if(Z.canDirectLoad&&Z.canDirectLoad(V))return Q[O]}return U()}(V.url):function(V){const O=V.indexOf("?");-1!==O&&(V=V.substring(0,O));const Z=V.lastIndexOf(".");return H(V.substring(Z,V.length).toLowerCase())}(V.url);if(!b)throw new Error(`No plugin or fallback for ${Y??V.url}`);if(!1===(null===a||void 0===a||null===(R=a[b.plugin.name])||void 0===R?void 0:R.enabled))throw new Error(`The '${b.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(V.rawData&&!b.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(V=>{if(b.plugin.createPlugin){const O=b.plugin.createPlugin(a??{});return O instanceof Promise?(O.then(V).catch((V=>{p("Error instantiating plugin.",V)})),null):(V(O),O)}return V(b.plugin),b.plugin})((a=>{var R;if(!a)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(a),M&&(a.canDirectLoad&&a.canDirectLoad(V.url)||!(0,i.j)(V.url))){if(a.directLoad){const V=a.directLoad(O,M);V instanceof Promise?V.then((V=>{Z(a,V)})).catch((V=>{p("Error in directLoad of _loadData: "+V,V)})):Z(a,V)}else Z(a,M);return}const c=b.isBinary,Q=(V,d)=>{O.u?p("Scene has been disposed"):Z(a,V,d)};let U=null,H=!1;null===(R=a.Xi)||void 0===R||R.add((()=>{H=!0,U&&(U.abort(),U=null),r()}));const S=()=>{if(H)return;const Z=(V,O)=>{p(null===V||void 0===V?void 0:V.statusText,O)};if(!a.loadFile&&V.rawData)throw"Plugin does not support loading ArrayBufferView.";U=a.loadFile?a.loadFile(O,V.rawData||V.file||V.url,V.rootUrl,Q,d,c,Z,m):O._loadFile(V.file||V.url,Q,d,!0,c,Z)},z=O.getEngine();let G=z.enableOfflineSupport;if(G){let Z=!1;for(const d of O.disableOfflineSupportExceptionRules)if(d.test(V.url)){Z=!0;break}G=!Z}G&&W.e.OfflineProviderFactory?O.offlineProvider=W.e.OfflineProviderFactory(V.url,S,z.disableManifestCheck):S()}))}function G(V,O){let Z,d,r=null,Y=null;if(O)if(O.name)Z=`file:${O.name}`,d=O.name,r=O;else if(ArrayBuffer.isView(O))Z="",d=(0,c.b)(),Y=O;else if(O.startsWith("data:"))Z=O,d="";else if(V){const r=O;if("/"===r.substring(0,1))return p.e.Error("Wrong sceneFilename parameter"),null;Z=V+r,d=r}else Z=O,d=p.e.GetFilename(O),V=p.e.GetFolderPath(O);else Z=V,d=p.e.GetFilename(V),V=p.e.GetFolderPath(V);return{url:Z,rootUrl:V,name:d,file:r,rawData:Y}}function w(V){if("string"===typeof V.extensions){const O=V.extensions;Q[O.toLowerCase()]={plugin:V,isBinary:!1}}else{const O=V.extensions;Object.keys(O).forEach((Z=>{Q[Z.toLowerCase()]={plugin:V,isBinary:O[Z].isBinary}}))}}function t(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.e.LastCreatedScene,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!d)return a.b.Error("No scene available to import mesh to"),null;const W=G(O,Z);if(!W)return null;const F={};d.addPendingData(F);const Q=()=>{d.removePendingData(F)},b=(V,O)=>{const Z=S(W,V,O);Y?Y(d,Z,new M.e(Z,M.d.SceneLoaderError,O)):a.b.Error(Z),Q()},U=r?V=>{try{r(V)}catch(O){b("Error in onProgress callback: "+O,O)}}:void 0,H=(V,O,Z,r,Y,m,a,R)=>{if(d.importedMeshesFiles.push(W.url),p)try{p(V,O,Z,r,Y,m,a,R)}catch(i){b("Error in onSuccess callback: "+i,i)}d.removePendingData(F)};return z(W,d,((O,Z,p)=>{if(O.rewriteRootURL&&(W.rootUrl=O.rewriteRootURL(W.rootUrl,p)),O.importMesh){const p=[],r=[],Y=[];if(!O.importMesh(V,d,Z,W.rootUrl,p,r,Y,b))return;d.loadingPluginName=O.name,H(p,r,Y,[],[],[],[],[])}else{O.importMeshAsync(V,d,Z,W.rootUrl,U,W.name).then((V=>{d.loadingPluginName=O.name,H(V.meshes,V.bj,V.skeletons,V.animationGroups,V.transformNodes,V.geometries,V.lights,V.spriteManagers)})).catch((V=>{b(V.message,V)}))}}),U,b,Q,R,i,c)}function C(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.e.LastCreatedEngine,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return Z?A(V,O,new Y.b(Z),d,r,a,R,i,M):(p.e.Error("No engine available"),null)}function v(V,O,Z,d,p,r,Y){return new Promise(((m,a)=>{C(V,O,Z,(V=>{m(V)}),d,((V,O,Z)=>{a(Z||new Error(O))}),p,r,Y)}))}function A(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.e.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return a.b.Error("No scene available to append to"),null;const W=G(V,O);if(!W)return null;const F={};Z.addPendingData(F);const Q=()=>{Z.removePendingData(F)};R.b.ShowLoadingScreen&&!b&&(b=!0,Z.getEngine().displayLoadingUI(),Z.executeWhenReady((()=>{Z.getEngine().hideLoadingUI(),b=!1})));const U=(V,O)=>{const d=S(W,V,O);r?r(Z,d,new M.e(d,M.d.SceneLoaderError,O)):a.b.Error(d),Q()},H=p?V=>{try{p(V)}catch(O){U("Error in onProgress callback",O)}}:void 0,w=()=>{if(d)try{d(Z)}catch(V){U("Error in onSuccess callback",V)}Z.removePendingData(F)};return z(W,Z,((V,O)=>{if(V.load){if(!V.load(Z,O,W.rootUrl,U))return;Z.loadingPluginName=V.name,w()}else{V.loadAsync(Z,O,W.rootUrl,H,W.name).then((()=>{Z.loadingPluginName=V.name,w()})).catch((V=>{U(V.message,V)}))}}),H,U,Q,Y,i,c)}function l(V,O,Z,d,p,r,Y){return new Promise(((m,a)=>{A(V,O,Z,(V=>{m(V)}),d,((V,O,Z)=>{a(Z||new Error(O))}),p,r,Y)}))}function I(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.e.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return a.b.Error("No scene available to load asset container to"),null;const c=G(V,O);if(!c)return null;const W={};Z.addPendingData(W);const F=()=>{Z.removePendingData(W)},Q=(V,O)=>{const d=S(c,V,O);r?r(Z,d,new M.e(d,M.d.SceneLoaderError,O)):a.b.Error(d),F()},b=p?V=>{try{p(V)}catch(O){Q("Error in onProgress callback",O)}}:void 0,U=V=>{if(d)try{d(V)}catch(O){Q("Error in onSuccess callback",O)}Z.removePendingData(W)};return z(c,Z,((V,O)=>{if(V.loadAssetContainer){const d=V.loadAssetContainer(Z,O,c.rootUrl,Q);if(!d)return;d.populateRootNodes(),Z.loadingPluginName=V.name,U(d)}else if(V.loadAssetContainerAsync){V.loadAssetContainerAsync(Z,O,c.rootUrl,b,c.name).then((O=>{O.populateRootNodes(),Z.loadingPluginName=V.name,U(O)})).catch((V=>{Q(V.message,V)}))}else Q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),b,Q,F,Y,R,i)}function g(V,O,Z,d,p,r,Y){return new Promise(((m,a)=>{I(V,O,Z,(V=>{m(V)}),d,((V,O,Z)=>{a(Z||new Error(O))}),p,r,Y)}))}function n(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.e.LastCreatedScene,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Z)return void a.b.Error("No scene available to load animations to");if(d){for(const V of Z.animatables)V.reset();Z.stopAllAnimations(),Z.animationGroups.slice().forEach((V=>{V.dispose()}));Z.getNodes().forEach((V=>{V.animations&&(V.animations=[])}))}else switch(p){case 0:Z.animationGroups.slice().forEach((V=>{V.dispose()}));break;case 1:Z.animationGroups.forEach((V=>{V.stop()}));break;case 2:Z.animationGroups.forEach((V=>{V.reset(),V.restart()}));break;case 3:break;default:return void a.b.Error("Unknown animation group loading mode value '"+p+"'")}const F=Z.animatables.length;I(V,O,Z,(V=>{V.mergeAnimationsTo(Z,Z.animatables.slice(F),r),V.dispose(),Z.onAnimationFileImportedObservable.notifyObservers(Z),Y&&Y(Z)}),R,i,M,c,W)}function e(V,O,Z,d,p,r,Y,m,a,R){return new Promise(((i,M)=>{n(V,O,Z,d,p,r,(V=>{i(V)}),Y,((V,O,Z)=>{M(Z||new Error(O))}),m,a,R)}))}class u{static get ForceFullSceneLoadingForIncremental(){return R.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){R.b.ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return R.b.ShowLoadingScreen}static set ShowLoadingScreen(V){R.b.ShowLoadingScreen=V}static get loggingLevel(){return R.b.loggingLevel}static set loggingLevel(V){R.b.loggingLevel=V}static get CleanBoneMatrixWeights(){return R.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){R.b.CleanBoneMatrixWeights=V}static GetDefaultPlugin(){return U()}static GetPluginForExtension(V){var O;return null===(O=H(V))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(V){return function(V){return!!Q[V]}(V)}static RegisterPlugin(V){w(V)}static ImportMesh(V,O,Z,d,p,r,Y,m,a){return t(V,O,Z,d,p,r,Y,m,a)}static ImportMeshAsync(V,O,Z,d,p,r,Y){return function(V,O,Z,d,p,r,Y,m){return new Promise(((a,R)=>{t(V,O,Z,d,((V,O,Z,d,p,r,Y,m)=>{a({meshes:V,bj:O,skeletons:Z,animationGroups:d,transformNodes:p,geometries:r,lights:Y,spriteManagers:m})}),p,((V,O,Z)=>{R(Z||new Error(O))}),r,Y,m)}))}(V,O,Z,d,p,r,Y)}static Load(V,O,Z,d,p,r,Y,m){return C(V,O,Z,d,p,r,Y,m)}static LoadAsync(V,O,Z,d,p,r){return v(V,O,Z,d,p,r)}static Append(V,O,Z,d,p,r,Y,m){return A(V,O,Z,d,p,r,Y,m)}static AppendAsync(V,O,Z,d,p,r){return l(V,O,Z,d,p,r)}static LoadAssetContainer(V,O,Z,d,p,r,Y,m){return I(V,O,Z,d,p,r,Y,m)}static LoadAssetContainerAsync(V,O,Z,d,p,r){return g(V,O,Z,d,p,r)}static ImportAnimations(V,O,Z,d,p,r,Y,m,a,R,i){n(V,O,Z,d,p,r,Y,m,a,R,i)}static ImportAnimationsAsync(V,O,Z,d,p,r,Y,m,a,R,i){return e(V,O,Z,d,p,r,m,R,i)}}u.NO_LOGGING=0,u.MINIMAL_LOGGING=1,u.SUMMARY_LOGGING=2,u.DETAILED_LOGGING=3,u.OnPluginActivatedObservable=F},11545:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d});class d{static get ForceFullSceneLoadingForIncremental(){return d._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){d._ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return d._ShowLoadingScreen}static set ShowLoadingScreen(V){d._ShowLoadingScreen=V}static get loggingLevel(){return d._LoggingLevel}static set loggingLevel(V){d._LoggingLevel=V}static get CleanBoneMatrixWeights(){return d._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){d._CleanBoneMatrixWeights=V}}d._ForceFullSceneLoadingForIncremental=!1,d._ShowLoadingScreen=!0,d._CleanBoneMatrixWeights=!1,d._LoggingLevel=0},12180:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>J});var d=Z(11210),p=Z(11216),r=Z(10914),Y=Z(11230),m=Z(12170),a=Z(11238),R=Z(11251),i=Z(11316),M=Z(11463),c=Z(11498);class W extends M.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class F extends c.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRBRDF",90,new W,O),this._useEnergyConservation=F.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=F.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=F.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=F.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=F.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=F.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=F.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=F.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16],this._enable(!0)}prepareDefines(V){V.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,V.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,V.SPHERICAL_HARMONICS=this._useSphericalHarmonics,V.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}F.DEFAULT_USE_ENERGY_CONSERVATION=!0,F.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,F.DEFAULT_USE_SPHERICAL_HARMONICS=!0,F.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsMiscDirty")],F.prototype,"useEnergyConservation",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsMiscDirty")],F.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsMiscDirty")],F.prototype,"useSphericalHarmonics",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsMiscDirty")],F.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var Q=Z(11403),b=Z(11274),U=Z(11265),H=Z(11409),S=Z(11465),z=Z(11467),G=Z(11481),w=(Z(12185),Z(11486)),t=Z(11448);class C extends M.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class v extends c.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRClearCoat",100,new C,O),this._isEnabled=!1,this.isEnabled=!1,this.Mi=1,this.roughness=0,this._indexOfRefraction=v._DefaultIndexOfRefraction,this.indexOfRefraction=v._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=b.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,O,Z){if(!this._isEnabled)return!0;const d=this._material._disableBumpMap;if(V._areTexturesDirty&&O.texturesEnabled){if(this._texture&&G.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(Z.getCaps().standardDerivatives&&this._bumpTexture&&G.e.ClearCoatBumpTextureEnabled&&!d&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,O){this._isEnabled?(V.CLEARCOAT=!0,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,V._areTexturesDirty&&O.texturesEnabled&&(this._texture&&G.e.ClearCoatTextureEnabled?(0,t.D)(this._texture,V,"CLEARCOAT_TEXTURE"):V.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&G.e.ClearCoatTextureEnabled?(0,t.D)(this._textureRoughness,V,"CLEARCOAT_TEXTURE_ROUGHNESS"):V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&G.e.ClearCoatBumpTextureEnabled?(0,t.D)(this._bumpTexture,V,"CLEARCOAT_BUMP"):V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===v._DefaultIndexOfRefraction,this._isTintEnabled?(V.CLEARCOAT_TINT=!0,this._tintTexture&&G.e.ClearCoatTintTextureEnabled?((0,t.D)(this._tintTexture,V,"CLEARCOAT_TINT_TEXTURE"),V.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):V.CLEARCOAT_TINT_TEXTURE=!1):(V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1))):(V.CLEARCOAT=!1,V.CLEARCOAT_TEXTURE=!1,V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.CLEARCOAT_DEFAULTIOR=!1,V.CLEARCOAT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,V.CLEARCOAT_BUMPDIRECTUV=0,V.CLEARCOAT_REMAP_F0=!1,V.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(V,O,Z,d){if(!this._isEnabled)return;const p=d.materialDefines,r=this._material.isFrozen,Y=this._material._disableBumpMap,m=this._material._invertNormalMapX,a=this._material._invertNormalMapY;if(!V.useUbo||!r||!V.isSync){var R,i,M,c;if((this._texture||this._textureRoughness)&&G.e.ClearCoatTextureEnabled)V.updateFloat4("vClearCoatInfos",(null===(R=this._texture)||void 0===R?void 0:R.coordinatesIndex)??0,(null===(i=this._texture)||void 0===i?void 0:i.level)??0,(null===(M=this._textureRoughness)||void 0===M?void 0:M.coordinatesIndex)??0,(null===(c=this._textureRoughness)||void 0===c?void 0:c.level)??0),this._texture&&(0,t.o)(this._texture,V,"clearCoat"),this._textureRoughness&&!p.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,t.o)(this._textureRoughness,V,"clearCoatRoughness");this._bumpTexture&&Z.getCaps().standardDerivatives&&G.e.ClearCoatTextureEnabled&&!Y&&(V.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,t.o)(this._bumpTexture,V,"clearCoatBump"),O._mirroredCameraPosition?V.updateFloat2("vClearCoatTangentSpaceParams",m?1:-1,a?1:-1):V.updateFloat2("vClearCoatTangentSpaceParams",m?-1:1,a?-1:1)),this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&(V.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,t.o)(this._tintTexture,V,"clearCoatTint")),V.updateFloat2("vClearCoatParams",this.Mi,this.roughness);const d=1-this._indexOfRefraction,r=1+this._indexOfRefraction,W=Math.pow(-d/r,2),F=1/this._indexOfRefraction;V.updateFloat4("vClearCoatRefractionParams",W,F,d,r),this._isTintEnabled&&(V.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),V.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}O.texturesEnabled&&(this._texture&&G.e.ClearCoatTextureEnabled&&V.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!p.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.e.ClearCoatTextureEnabled&&V.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&Z.getCaps().standardDerivatives&&G.e.ClearCoatBumpTextureEnabled&&!Y&&V.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&G.e.ClearCoatTintTextureEnabled&&V.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(V){return this._texture===V||(this._textureRoughness===V||(this._bumpTexture===V||this._tintTexture===V))}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness),this._bumpTexture&&V.push(this._bumpTexture),this._tintTexture&&V.push(this._tintTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&V.push(this._tintTexture)}dispose(V){var O,Z,d,p;V&&(null===(O=this._texture)||void 0===O||O.dispose(),null===(Z=this._textureRoughness)||void 0===Z||Z.dispose(),null===(d=this._bumpTexture)||void 0===d||d.dispose(),null===(p=this._tintTexture)||void 0===p||p.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(V,O,Z){return V.CLEARCOAT_BUMP&&O.addFallback(Z++,"CLEARCOAT_BUMP"),V.CLEARCOAT_TINT&&O.addFallback(Z++,"CLEARCOAT_TINT"),V.CLEARCOAT&&O.addFallback(Z++,"CLEARCOAT"),Z}getSamplers(V){V.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}v._DefaultIndexOfRefraction=1.5,(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,d.c)([(0,p.K)()],v.prototype,"intensity",void 0),(0,d.c)([(0,p.K)()],v.prototype,"roughness",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"indexOfRefraction",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"remapF0OnInterfaceChange",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isTintEnabled",void 0),(0,d.c)([(0,p.k)()],v.prototype,"tintColor",void 0),(0,d.c)([(0,p.K)()],v.prototype,"tintColorAtDistance",void 0),(0,d.c)([(0,p.K)()],v.prototype,"tintThickness",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"tintTexture",void 0);class A extends M.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class l extends c.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRIridescence",110,new A,O),this._isEnabled=!1,this.isEnabled=!1,this.Mi=1,this.minimumThickness=l._DefaultMinimumThickness,this.maximumThickness=l._DefaultMaximumThickness,this.indexOfRefraction=l._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,O){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&O.texturesEnabled){if(this._texture&&G.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&G.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,O){this._isEnabled?(V.IRIDESCENCE=!0,V._areTexturesDirty&&O.texturesEnabled&&(this._texture&&G.e.IridescenceTextureEnabled?(0,t.D)(this._texture,V,"IRIDESCENCE_TEXTURE"):V.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&G.e.IridescenceTextureEnabled?(0,t.D)(this._thicknessTexture,V,"IRIDESCENCE_THICKNESS_TEXTURE"):V.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(V.IRIDESCENCE=!1,V.IRIDESCENCE_TEXTURE=!1,V.IRIDESCENCE_THICKNESS_TEXTURE=!1,V.IRIDESCENCE_TEXTUREDIRECTUV=0,V.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(V,O){if(!this._isEnabled)return;const Z=this._material.isFrozen;if(!V.useUbo||!Z||!V.isSync){var d,p,r,Y;if((this._texture||this._thicknessTexture)&&G.e.IridescenceTextureEnabled)V.updateFloat4("vIridescenceInfos",(null===(d=this._texture)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(p=this._texture)||void 0===p?void 0:p.level)??0,(null===(r=this._thicknessTexture)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(Y=this._thicknessTexture)||void 0===Y?void 0:Y.level)??0),this._texture&&(0,t.o)(this._texture,V,"iridescence"),this._thicknessTexture&&(0,t.o)(this._thicknessTexture,V,"iridescenceThickness");V.updateFloat4("vIridescenceParams",this.Mi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}O.texturesEnabled&&(this._texture&&G.e.IridescenceTextureEnabled&&V.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&G.e.IridescenceTextureEnabled&&V.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(V){return this._texture===V||this._thicknessTexture===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._thicknessTexture&&V.push(this._thicknessTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture)}dispose(V){var O,Z;V&&(null===(O=this._texture)||void 0===O||O.dispose(),null===(Z=this._thicknessTexture)||void 0===Z||Z.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(V,O,Z){return V.IRIDESCENCE&&O.addFallback(Z++,"IRIDESCENCE"),Z}getSamplers(V){V.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}l._DefaultMinimumThickness=100,l._DefaultMaximumThickness=400,l._DefaultIndexOfRefraction=1.3,(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,d.c)([(0,p.K)()],l.prototype,"intensity",void 0),(0,d.c)([(0,p.K)()],l.prototype,"minimumThickness",void 0),(0,d.c)([(0,p.K)()],l.prototype,"maximumThickness",void 0),(0,d.c)([(0,p.K)()],l.prototype,"indexOfRefraction",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"thicknessTexture",void 0);class I extends M.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class g extends c.d{set angle(V){this.direction.x=Math.cos(V),this.direction.y=Math.sin(V)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRAnisotropic",110,new I,O),this._isEnabled=!1,this.isEnabled=!1,this.Mi=1,this.direction=new R.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16]}isReadyForSubMesh(V,O){return!this._isEnabled||!(V._areTexturesDirty&&O.texturesEnabled&&this._texture&&G.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(V,O,Z){this._isEnabled?(V.ANISOTROPIC=this._isEnabled,this._isEnabled&&!Z.isVerticesDataPresent(i.e.TangentKind)&&(V._needUVs=!0,V.MAINUV1=!0),V._areTexturesDirty&&O.texturesEnabled&&(this._texture&&G.e.AnisotropicTextureEnabled?(0,t.D)(this._texture,V,"ANISOTROPIC_TEXTURE"):V.ANISOTROPIC_TEXTURE=!1),V._areMiscDirty&&(V.ANISOTROPIC_LEGACY=this._legacy)):(V.ANISOTROPIC=!1,V.ANISOTROPIC_TEXTURE=!1,V.ANISOTROPIC_TEXTUREDIRECTUV=0,V.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(V,O){if(!this._isEnabled)return;const Z=this._material.isFrozen;V.useUbo&&Z&&V.isSync||(this._texture&&G.e.AnisotropicTextureEnabled&&(V.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,t.o)(this._texture,V,"anisotropy")),V.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Mi)),O.texturesEnabled&&this._texture&&G.e.AnisotropicTextureEnabled&&V.setTexture("anisotropySampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){V&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(V,O,Z){return V.ANISOTROPIC&&O.addFallback(Z++,"ANISOTROPIC"),Z}getSamplers(V){V.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(V,O,Z){super.parse(V,O,Z),void 0===V.legacy&&(this.legacy=!0)}}(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,d.c)([(0,p.K)()],g.prototype,"intensity",void 0),(0,d.c)([(0,p.E)()],g.prototype,"direction",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsMiscDirty")],g.prototype,"legacy",void 0);class n extends M.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class e extends c.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"Sheen",120,new n,O),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Mi=1,this.color=b.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,O){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&O.texturesEnabled){if(this._texture&&G.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,O){this._isEnabled?(V.SHEEN=!0,V.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,V.SHEEN_ROUGHNESS=null!==this._roughness,V.SHEEN_ALBEDOSCALING=this._albedoScaling,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V._areTexturesDirty&&O.texturesEnabled&&(this._texture&&G.e.SheenTextureEnabled?((0,t.D)(this._texture,V,"SHEEN_TEXTURE"),V.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):V.SHEEN_TEXTURE=!1,this._textureRoughness&&G.e.SheenTextureEnabled?(0,t.D)(this._textureRoughness,V,"SHEEN_TEXTURE_ROUGHNESS"):V.SHEEN_TEXTURE_ROUGHNESS=!1)):(V.SHEEN=!1,V.SHEEN_TEXTURE=!1,V.SHEEN_TEXTURE_ROUGHNESS=!1,V.SHEEN_LINKWITHALBEDO=!1,V.SHEEN_ROUGHNESS=!1,V.SHEEN_ALBEDOSCALING=!1,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.SHEEN_GAMMATEXTURE=!1,V.SHEEN_TEXTUREDIRECTUV=0,V.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(V,O,Z,d){if(!this._isEnabled)return;const p=d.materialDefines,r=this._material.isFrozen;if(!V.useUbo||!r||!V.isSync){var Y,m,a,R;if((this._texture||this._textureRoughness)&&G.e.SheenTextureEnabled)V.updateFloat4("vSheenInfos",(null===(Y=this._texture)||void 0===Y?void 0:Y.coordinatesIndex)??0,(null===(m=this._texture)||void 0===m?void 0:m.level)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(R=this._textureRoughness)||void 0===R?void 0:R.level)??0),this._texture&&(0,t.o)(this._texture,V,"sheen"),this._textureRoughness&&!p.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,t.o)(this._textureRoughness,V,"sheenRoughness");V.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Mi),null!==this._roughness&&V.updateFloat("vSheenRoughness",this._roughness)}O.texturesEnabled&&(this._texture&&G.e.SheenTextureEnabled&&V.setTexture("sheenSampler",this._texture),this._textureRoughness&&!p.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.e.SheenTextureEnabled&&V.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(V){return this._texture===V||this._textureRoughness===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness)}dispose(V){var O,Z;V&&(null===(O=this._texture)||void 0===O||O.dispose(),null===(Z=this._textureRoughness)||void 0===Z||Z.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(V,O,Z){return V.SHEEN&&O.addFallback(Z++,"SHEEN"),Z}getSamplers(V){V.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),(0,d.c)([(0,p.K)()],e.prototype,"intensity",void 0),(0,d.c)([(0,p.k)()],e.prototype,"color",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useRoughnessFromMainTexture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"roughness",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"textureRoughness",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"albedoScaling",void 0);class u extends M.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class k extends c.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(V){this._scene.enableSubSurfaceForPrePass()&&V&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(V))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(V){this._volumeIndexOfRefraction=V>=1?V:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRSubSurface",130,new u,O),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=b.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=b.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=V.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=V._dirtyCallbacks[32]}isReadyForSubMesh(V,O){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(V._areTexturesDirty&&O.texturesEnabled){if(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const V=this._getRefractionTexture(O);if(V&&G.e.RefractionTextureEnabled&&!V.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,O){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return V.SUBSURFACE=!1,V.SS_DISPERSION=!1,V.SS_TRANSLUCENCY=!1,V.SS_SCATTERING=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,V.SS_HAS_THICKNESS=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,V.SS_REFRACTIONMAP_3D=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(V.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(V._areTexturesDirty){if(V.SUBSURFACE=!0,V.SS_DISPERSION=this._isDispersionEnabled,V.SS_TRANSLUCENCY=this._isTranslucencyEnabled,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_SCATTERING=this._isScatteringEnabled,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_HAS_THICKNESS=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_REFRACTIONMAP_3D=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,V._areTexturesDirty&&O.texturesEnabled&&(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&(0,t.D)(this._thicknessTexture,V,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&(0,t.D)(this._refractionIntensityTexture,V,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&(0,t.D)(this._translucencyIntensityTexture,V,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&(0,t.D)(this._translucencyColorTexture,V,"SS_TRANSLUCENCYCOLOR_TEXTURE")),V.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,V.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&O.texturesEnabled){const Z=this._getRefractionTexture(O);Z&&G.e.RefractionTextureEnabled&&(V.SS_REFRACTION=!0,V.SS_REFRACTIONMAP_3D=Z.isCube,V.SS_GAMMAREFRACTION=Z.gammaSpace,V.SS_RGBDREFRACTION=Z.isRGBD,V.SS_LINEARSPECULARREFRACTION=Z.linearSpecularLOD,V.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&Z.isCube?!Z.invertZ:Z.invertZ,V.SS_LODINREFRACTIONALPHA=Z.lodLevelInAlpha,V.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,V.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=Z.isCube&&Z.boundingBoxSize,V.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(V.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(V,O,Z,d){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)V.updateFloat2("vThicknessParam",0,0);else{d.getRenderingMesh().getWorldMatrix().decompose(R.i.ib[0]);const O=Math.max(Math.abs(R.i.ib[0].x),Math.abs(R.i.ib[0].y),Math.abs(R.i.ib[0].z));V.updateFloat2("vThicknessParam",this.minimumThickness*O,(this.maximumThickness-this.minimumThickness)*O)}}bindForSubMesh(V,O,Z,d){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const p=d.materialDefines,r=this._material.isFrozen,Y=this._material.realTimeFiltering,m=p.LODBASEDMICROSFURACE,a=this._getRefractionTexture(O);if(!V.useUbo||!r||!V.isSync){if(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&(V.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,t.o)(this._thicknessTexture,V,"thickness")),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&p.SS_REFRACTIONINTENSITY_TEXTURE&&(V.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,t.o)(this._refractionIntensityTexture,V,"refractionIntensity")),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&p.SS_TRANSLUCENCYCOLOR_TEXTURE&&(V.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,t.o)(this._translucencyColorTexture,V,"translucencyColor")),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&p.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(V.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,t.o)(this._translucencyIntensityTexture,V,"translucencyIntensity")),a&&G.e.RefractionTextureEnabled){V.tj("refractionMatrix",a.getRefractionTextureMatrix());let O=1;a.isCube||a.depth&&(O=a.depth);const Z=a.getSize().width,d=this.volumeIndexOfRefraction;if(V.updateFloat4("vRefractionInfos",a.level,1/d,O,this._invertRefractionY?-1:1),V.updateFloat4("vRefractionMicrosurfaceInfos",Z,a.lodGenerationScale,a.lodGenerationOffset,1/this.indexOfRefraction),Y&&V.updateFloat2("vRefractionFilteringInfo",Z,Math.log2(Z)),a.boundingBoxSize){const O=a;V.updateVector3("vRefractionPosition",O.boundingBoxPosition),V.updateVector3("vRefractionSize",O.boundingBoxSize)}}this._isScatteringEnabled&&V.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),V.updateColor3("vDiffusionDistance",this.diffusionDistance),V.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),V.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),V.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),V.updateFloat("dispersion",this.dispersion)}O.texturesEnabled&&(this._thicknessTexture&&G.e.ThicknessTextureEnabled&&V.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&G.e.RefractionIntensityTextureEnabled&&p.SS_REFRACTIONINTENSITY_TEXTURE&&V.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&G.e.TranslucencyIntensityTextureEnabled&&p.SS_TRANSLUCENCYINTENSITY_TEXTURE&&V.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&G.e.TranslucencyColorTextureEnabled&&p.SS_TRANSLUCENCYCOLOR_TEXTURE&&V.setTexture("translucencyColorSampler",this._translucencyColorTexture),a&&G.e.RefractionTextureEnabled&&(m?V.setTexture("refractionSampler",a):(V.setTexture("refractionSampler",a._lodTextureMid||a),V.setTexture("refractionSamplerLow",a._lodTextureLow||a),V.setTexture("refractionSamplerHigh",a._lodTextureHigh||a))))}_getRefractionTexture(V){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?V.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(V){G.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&V.push(this._refractionTexture)}hasTexture(V){return this._thicknessTexture===V||(this._refractionTexture===V||(this._refractionIntensityTexture===V||(this._translucencyIntensityTexture===V||this._translucencyColorTexture===V)))}hasRenderTargetTextures(){return!!(G.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(V){this._thicknessTexture&&V.push(this._thicknessTexture),this._refractionTexture&&V.push(this._refractionTexture),this._translucencyColorTexture&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&V.push(this._translucencyIntensityTexture)}getAnimatables(V){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&V.push(this._translucencyIntensityTexture)}dispose(V){V&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(V,O,Z){return V.SS_SCATTERING&&O.addFallback(Z++,"SS_SCATTERING"),V.SS_TRANSLUCENCY&&O.addFallback(Z++,"SS_TRANSLUCENCY"),Z}getSamplers(V){V.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isRefractionEnabled",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isTranslucencyEnabled",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isDispersionEnabled",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markScenePrePassDirty")],k.prototype,"isScatteringEnabled",void 0),(0,d.c)([(0,p.K)()],k.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,d.c)([(0,p.K)()],k.prototype,"refractionIntensity",void 0),(0,d.c)([(0,p.K)()],k.prototype,"translucencyIntensity",void 0),(0,d.c)([(0,p.K)()],k.prototype,"useAlbedoToTintRefraction",void 0),(0,d.c)([(0,p.K)()],k.prototype,"useAlbedoToTintTranslucency",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"thicknessTexture",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"refractionTexture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"indexOfRefraction",void 0),(0,d.c)([(0,p.K)()],k.prototype,"_volumeIndexOfRefraction",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"volumeIndexOfRefraction",null),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"invertRefractionY",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"linkRefractionWithTransparency",void 0),(0,d.c)([(0,p.K)()],k.prototype,"minimumThickness",void 0),(0,d.c)([(0,p.K)()],k.prototype,"maximumThickness",void 0),(0,d.c)([(0,p.K)()],k.prototype,"useThicknessAsDepth",void 0),(0,d.c)([(0,p.k)()],k.prototype,"tintColor",void 0),(0,d.c)([(0,p.K)()],k.prototype,"tintColorAtDistance",void 0),(0,d.c)([(0,p.K)()],k.prototype,"dispersion",void 0),(0,d.c)([(0,p.k)()],k.prototype,"diffusionDistance",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useMaskFromThicknessTexture",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"refractionIntensityTexture",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"translucencyIntensityTexture",void 0),(0,d.c)([(0,p.k)()],k.prototype,"translucencyColor",void 0),(0,d.c)([(0,p.A)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"translucencyColorTexture",void 0),(0,d.c)([(0,p.K)(),(0,p.b)("_markAllSubMeshesAsTexturesDirty")],k.prototype,"useGltfStyleTextures",void 0);var D=Z(11495),X=Z(11456),o=Z(11503);const E={effect:null,subMesh:null};class L extends M.c{constructor(V){super(V),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class J extends S.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(V){this._realTimeFiltering=V,this.sg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(V){this._realTimeFilteringQuality=V,this.sg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(V,O){super(V,O,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||J.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new R.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=J.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=b.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new b.b(0,0,0),this._albedoColor=new b.b(1,1,1),this._reflectivityColor=new b.b(1,1,1),this._reflectionColor=new b.b(1,1,1),this._emissiveColor=new b.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=J.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new Y.h(16),this._globalAmbientColor=new b.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new F(this),this.clearCoat=new v(this),this.iridescence=new l(this),this.anisotropy=new g(this),this.sheen=new e(this),this.subSurface=new k(this),this.detailMap=new D.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),G.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,m.b)(this.va()),this.prePassConfiguration=new Q.d}get hasRenderTargetTextures(){return!!(G.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var V;return this._transparencyMode===J.PBRMATERIAL_OPAQUE||this._transparencyMode===J.PBRMATERIAL_ALPHATEST||(null===(V=this.subSurface)||void 0===V?void 0:V.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var V;return!!this._forceAlphaTest||(null===(V=this.subSurface)||void 0===V||!V.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===J.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.uc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==J.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.uc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(V,O,Z){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const d=O._drawWrapper;if(d.effect&&this.isFrozen&&d._wasPreviouslyReady&&d._wasPreviouslyUsingInstances===Z)return!0;O.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),O.materialDefines=new L(this._eventInfo.defineNames));const p=O.materialDefines;if(this._isReadyForSubMesh(O))return!0;const Y=this.va(),m=Y.getEngine();if(p._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Y.texturesEnabled)){if(this._albedoTexture&&G.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&G.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&G.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const V=this._getReflectionTexture();if(V&&G.e.ReflectionTextureEnabled){if(!V.isReadyOrNotBlocking())return!1;var a;if(V.irradianceTexture){if(!V.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!V.sphericalPolynomial&&null!==(a=V.getInternalTexture())&&void 0!==a&&a._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&G.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&G.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(G.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(m.getCaps().standardDerivatives&&this._bumpTexture&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&G.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=p,this._eventInfo.subMesh=O,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(p._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;m.getCaps().standardDerivatives||V.isVerticesDataPresent(i.e.NormalKind)||(V.createNormals(!0),r.b.Warn("PBRMaterial: Normals have been created for the mesh: "+V.name));const R=O.effect,M=p._areLightsDisposed;let c=this._prepareEffect(V,p,this.onCompiled,this.onError,Z,null,O.getRenderingMesh().hasThinInstances),W=!1;if(c)if(this._onEffectCreatedObservable&&(E.effect=c,E.subMesh=O,this._onEffectCreatedObservable.notifyObservers(E)),this.allowShaderHotSwapping&&R&&!c.isReady()){if(c=R,p.markAsUnprocessed(),W=this.isFrozen,M)return p._areLightsDisposed=!0,!1}else Y.resetCachedMaterial(),O.setEffect(c,p,this._materialContext);return!(!O.effect||!O.effect.isReady())&&(p._renderId=Y.getRenderId(),d._wasPreviouslyReady=!W,d._wasPreviouslyUsingInstances=!!Z,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(V,O){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(V,O,r,Y,m),!O.isDirty)return null;O.markAsProcessed();const a=this.va().getEngine(),R=new w.d;let M=0;O.USESPHERICALINVERTEX&&R.addFallback(M++,"USESPHERICALINVERTEX"),O.FOG&&R.addFallback(M,"FOG"),O.SPECULARAA&&R.addFallback(M,"SPECULARAA"),O.POINTSIZE&&R.addFallback(M,"POINTSIZE"),O.LOGARITHMICDEPTH&&R.addFallback(M,"LOGARITHMICDEPTH"),O.PARALLAX&&R.addFallback(M,"PARALLAX"),O.PARALLAX_RHS&&R.addFallback(M,"PARALLAX_RHS"),O.PARALLAXOCCLUSION&&R.addFallback(M++,"PARALLAXOCCLUSION"),O.ENVIRONMENTBRDF&&R.addFallback(M++,"ENVIRONMENTBRDF"),O.TANGENT&&R.addFallback(M++,"TANGENT"),O.BUMP&&R.addFallback(M++,"BUMP"),M=(0,t.q)(O,R,this._maxSimultaneousLights,M++),O.SPECULARTERM&&R.addFallback(M++,"SPECULARTERM"),O.USESPHERICALFROMREFLECTIONMAP&&R.addFallback(M++,"USESPHERICALFROMREFLECTIONMAP"),O.USEIRRADIANCEMAP&&R.addFallback(M++,"USEIRRADIANCEMAP"),O.LIGHTMAP&&R.addFallback(M++,"LIGHTMAP"),O.NORMAL&&R.addFallback(M++,"NORMAL"),O.AMBIENT&&R.addFallback(M++,"AMBIENT"),O.EMISSIVE&&R.addFallback(M++,"EMISSIVE"),O.VERTEXCOLOR&&R.addFallback(M++,"VERTEXCOLOR"),O.MORPHTARGETS&&R.addFallback(M++,"MORPHTARGETS"),O.MULTIVIEW&&R.addFallback(0,"MULTIVIEW");const c=[i.e.PositionKind];O.NORMAL&&c.push(i.e.NormalKind),O.TANGENT&&c.push(i.e.TangentKind);for(let Z=1;Z<=6;++Z)O["UV"+Z]&&c.push(`uv${1===Z?"":Z}`);O.VERTEXCOLOR&&c.push(i.e.ColorKind),(0,t.v)(c,V,O,R),(0,t.w)(c,O),(0,t.y)(c,V,O),(0,t.r)(c,V,O);let W="pbr";const F=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],b=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],H=["Material","Scene","Mesh"],S={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:O.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=R,this._eventInfo.fallbackRank=M,this._eventInfo.defines=O,this._eventInfo.uniforms=F,this._eventInfo.attributes=c,this._eventInfo.samplers=b,this._eventInfo.uniformBuffersNames=H,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=S,this._callbackPluginEventGeneric(128,this._eventInfo),o.b.AddUniformsAndSamplers(F,b),Q.d.AddUniforms(F),Q.d.AddSamplers(b),(0,X.c)(F),U.b&&(U.b.PrepareUniforms(F,O),U.b.PrepareSamplers(b,O)),(0,t.U)({uniformsNames:F,uniformBuffersNames:H,samplers:b,defines:O,maxSimultaneousLights:this._maxSimultaneousLights});const z={};this.customShaderNameResolve&&(W=this.customShaderNameResolve(W,F,H,b,O,c,z));const G=O.toString(),C=a.createEffect(W,{attributes:c,uniformsNames:F,uniformBuffersNames:H,samplers:b,defines:G,fallbacks:R,onCompiled:d,onError:p,indexParameters:S,processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:O.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([Z.e(21),Z.e(43)]).then(Z.bind(Z,13426)),Promise.all([Z.e(22),Z.e(44)]).then(Z.bind(Z,13440))]):await Promise.all([Promise.all([Z.e(25),Z.e(45)]).then(Z.bind(Z,13442)),Promise.all([Z.e(27),Z.e(46)]).then(Z.bind(Z,13467))]),this._shadersLoaded=!0}},a);return this._eventInfo.customCode=void 0,C}_prepareDefines(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=this.va(),Y=r.getEngine();(0,t.B)(r,V,O,!0,this._maxSimultaneousLights,this._disableLighting),O._needNormals=!0,(0,t.K)(r,O);const m=this.needAlphaBlendingForMesh(V)&&this.va().useOrderIndependentTransparency;if((0,t.R)(r,O,this.canRenderToMRT&&!m),(0,t.N)(r,O,m),o.b.PrepareDefines(Y.currentRenderPassId,V,O),O.METALLICWORKFLOW=this.isMetallicWorkflow(),O._areTexturesDirty){O._needUVs=!1;for(let V=1;V<=6;++V)O["MAINUV"+V]=!1;if(r.texturesEnabled){O.ALBEDODIRECTUV=0,O.AMBIENTDIRECTUV=0,O.OPACITYDIRECTUV=0,O.EMISSIVEDIRECTUV=0,O.REFLECTIVITYDIRECTUV=0,O.MICROSURFACEMAPDIRECTUV=0,O.METALLIC_REFLECTANCEDIRECTUV=0,O.REFLECTANCEDIRECTUV=0,O.BUMPDIRECTUV=0,O.LIGHTMAPDIRECTUV=0,Y.getCaps().textureLOD&&(O.LODBASEDMICROSFURACE=!0),this._albedoTexture&&G.e.DiffuseTextureEnabled?((0,t.D)(this._albedoTexture,O,"ALBEDO"),O.GAMMAALBEDO=this._albedoTexture.gammaSpace):O.ALBEDO=!1,this._ambientTexture&&G.e.AmbientTextureEnabled?((0,t.D)(this._ambientTexture,O,"AMBIENT"),O.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):O.AMBIENT=!1,this._opacityTexture&&G.e.OpacityTextureEnabled?((0,t.D)(this._opacityTexture,O,"OPACITY"),O.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):O.OPACITY=!1;const V=this._getReflectionTexture();if(V&&G.e.ReflectionTextureEnabled){switch(O.REFLECTION=!0,O.GAMMAREFLECTION=V.gammaSpace,O.RGBDREFLECTION=V.isRGBD,O.LODINREFLECTIONALPHA=V.lodLevelInAlpha,O.LINEARSPECULARREFLECTION=V.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(O.NUM_SAMPLES=""+this.realTimeFilteringQuality,Y._features.needTypeSuffixInShaderConstants&&(O.NUM_SAMPLES=O.NUM_SAMPLES+"u"),O.REALTIME_FILTERING=!0):O.REALTIME_FILTERING=!1,O.INVERTCUBICMAP=V.coordinatesMode===z.b.INVCUBIC_MODE,O.REFLECTIONMAP_3D=V.isCube,O.REFLECTIONMAP_OPPOSITEZ=O.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!V.invertZ:V.invertZ,O.REFLECTIONMAP_CUBIC=!1,O.REFLECTIONMAP_EXPLICIT=!1,O.REFLECTIONMAP_PLANAR=!1,O.REFLECTIONMAP_PROJECTION=!1,O.REFLECTIONMAP_SKYBOX=!1,O.REFLECTIONMAP_SPHERICAL=!1,O.REFLECTIONMAP_EQUIRECTANGULAR=!1,O.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,O.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,V.coordinatesMode){case z.b.EXPLICIT_MODE:O.REFLECTIONMAP_EXPLICIT=!0;break;case z.b.PLANAR_MODE:O.REFLECTIONMAP_PLANAR=!0;break;case z.b.PROJECTION_MODE:O.REFLECTIONMAP_PROJECTION=!0;break;case z.b.SKYBOX_MODE:O.REFLECTIONMAP_SKYBOX=!0;break;case z.b.SPHERICAL_MODE:O.REFLECTIONMAP_SPHERICAL=!0;break;case z.b.EQUIRECTANGULAR_MODE:O.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case z.b.FIXED_EQUIRECTANGULAR_MODE:O.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case z.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:O.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case z.b.CUBIC_MODE:case z.b.INVCUBIC_MODE:default:O.REFLECTIONMAP_CUBIC=!0,O.USE_LOCAL_REFLECTIONMAP_CUBIC=!!V.boundingBoxSize}V.coordinatesMode!==z.b.SKYBOX_MODE&&(V.irradianceTexture?(O.USEIRRADIANCEMAP=!0,O.USESPHERICALFROMREFLECTIONMAP=!1):V.isCube&&(O.USESPHERICALFROMREFLECTIONMAP=!0,O.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||Y.getCaps().maxVaryingVectors<=8?O.USESPHERICALINVERTEX=!1:O.USESPHERICALINVERTEX=!0))}else O.REFLECTION=!1,O.REFLECTIONMAP_3D=!1,O.REFLECTIONMAP_SPHERICAL=!1,O.REFLECTIONMAP_PLANAR=!1,O.REFLECTIONMAP_CUBIC=!1,O.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,O.REFLECTIONMAP_PROJECTION=!1,O.REFLECTIONMAP_SKYBOX=!1,O.REFLECTIONMAP_EXPLICIT=!1,O.REFLECTIONMAP_EQUIRECTANGULAR=!1,O.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,O.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,O.INVERTCUBICMAP=!1,O.USESPHERICALFROMREFLECTIONMAP=!1,O.USEIRRADIANCEMAP=!1,O.USESPHERICALINVERTEX=!1,O.REFLECTIONMAP_OPPOSITEZ=!1,O.LODINREFLECTIONALPHA=!1,O.GAMMAREFLECTION=!1,O.RGBDREFLECTION=!1,O.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&G.e.LightmapTextureEnabled?((0,t.D)(this._lightmapTexture,O,"LIGHTMAP"),O.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,O.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,O.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):O.LIGHTMAP=!1,this._emissiveTexture&&G.e.EmissiveTextureEnabled?((0,t.D)(this._emissiveTexture,O,"EMISSIVE"),O.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):O.EMISSIVE=!1,G.e.SpecularTextureEnabled?(this._metallicTexture?((0,t.D)(this._metallicTexture,O,"REFLECTIVITY"),O.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,O.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,O.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,O.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,O.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,t.D)(this._reflectivityTexture,O,"REFLECTIVITY"),O.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,O.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,O.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):O.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(O.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,t.D)(this._metallicReflectanceTexture,O,"METALLIC_REFLECTANCE"),O.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):O.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,t.D)(this._reflectanceTexture,O,"REFLECTANCE"),O.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):O.REFLECTANCE=!1):(O.METALLIC_REFLECTANCE=!1,O.REFLECTANCE=!1),this._microSurfaceTexture?(0,t.D)(this._microSurfaceTexture,O,"MICROSURFACEMAP"):O.MICROSURFACEMAP=!1):(O.REFLECTIVITY=!1,O.MICROSURFACEMAP=!1),Y.getCaps().standardDerivatives&&this._bumpTexture&&G.e.BumpTextureEnabled&&!this._disableBumpMap?((0,t.D)(this._bumpTexture,O,"BUMP"),this._useParallax&&this._albedoTexture&&G.e.DiffuseTextureEnabled?(O.PARALLAX=!0,O.PARALLAX_RHS=r.useRightHandedSystem,O.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):O.PARALLAX=!1,O.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(O.BUMP=!1,O.PARALLAX=!1,O.PARALLAX_RHS=!1,O.PARALLAXOCCLUSION=!1,O.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&G.e.ReflectionTextureEnabled?(O.ENVIRONMENTBRDF=!0,O.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(O.ENVIRONMENTBRDF=!1,O.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?O.ALPHAFROMALBEDO=!0:O.ALPHAFROMALBEDO=!1}O.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===J.LIGHTFALLOFF_STANDARD?(O.USEPHYSICALLIGHTFALLOFF=!1,O.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===J.LIGHTFALLOFF_GLTF?(O.USEPHYSICALLIGHTFALLOFF=!1,O.USEGLTFLIGHTFALLOFF=!0):(O.USEPHYSICALLIGHTFALLOFF=!0,O.USEGLTFLIGHTFALLOFF=!1),O.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Jg&&this._twoSidedLighting?O.TWOSIDEDLIGHTING=!0:O.TWOSIDEDLIGHTING=!1,O.SPECULARAA=Y.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(O._areTexturesDirty||O._areMiscDirty)&&(O.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,O.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,O.ALPHABLEND=this.needAlphaBlendingForMesh(V),O.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,O.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),O._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(O),O.FORCENORMALFORWARD=this._forceNormalForward,O.RADIANCEOCCLUSION=this._useRadianceOcclusion,O.HORIZONOCCLUSION=this._useHorizonOcclusion,O._areMiscDirty&&((0,t.G)(V,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(V)||this._forceAlphaTest,O,this._applyDecalMapAfterDetailMap),O.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!V.isVerticesDataPresent(i.e.NormalKind),O.DEBUGMODE=this._debugMode),(0,t.A)(r,Y,this,O,!!Z,d,p),this._eventInfo.defines=O,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,t.z)(V,O,!0,!0,!0,this._transparencyMode!==J.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(V,O,Z){const d={clipPlane:!1,useInstances:!1,...Z};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const Z=new L(this._eventInfo.defineNames),p=this._prepareEffect(V,Z,void 0,void 0,d.useInstances,d.clipPlane,V.hasThinInstances);this._onEffectCreatedObservable&&(E.effect=p,E.subMesh=null,this._onEffectCreatedObservable.notifyObservers(E)),p.isReady()?O&&O(this):p.onCompileObservable.add((()=>{O&&O(this)}))})()}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("vAlbedoInfos",2),V.addUniform("vAmbientInfos",4),V.addUniform("vOpacityInfos",2),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vReflectivityInfos",3),V.addUniform("vMicroSurfaceSamplerInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionFilteringInfo",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vBumpInfos",3),V.addUniform("albedoMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("reflectivityMatrix",16),V.addUniform("microSurfaceSamplerMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("reflectionMatrix",16),V.addUniform("vReflectionColor",3),V.addUniform("vAlbedoColor",4),V.addUniform("vLightingIntensity",4),V.addUniform("vReflectionMicrosurfaceInfos",3),V.addUniform("pointSize",1),V.addUniform("vReflectivityColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vAmbientColor",3),V.addUniform("vDebugMode",2),V.addUniform("vMetallicReflectanceFactors",4),V.addUniform("vMetallicReflectanceInfos",2),V.addUniform("metallicReflectanceMatrix",16),V.addUniform("vReflectanceInfos",2),V.addUniform("reflectanceMatrix",16),V.addUniform("vSphericalL00",3),V.addUniform("vSphericalL1_1",3),V.addUniform("vSphericalL10",3),V.addUniform("vSphericalL11",3),V.addUniform("vSphericalL2_2",3),V.addUniform("vSphericalL2_1",3),V.addUniform("vSphericalL20",3),V.addUniform("vSphericalL21",3),V.addUniform("vSphericalL22",3),V.addUniform("vSphericalX",3),V.addUniform("vSphericalY",3),V.addUniform("vSphericalZ",3),V.addUniform("vSphericalXX_ZZ",3),V.addUniform("vSphericalYY_ZZ",3),V.addUniform("vSphericalZZ",3),V.addUniform("vSphericalXY",3),V.addUniform("vSphericalYZ",3),V.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(V,O,Z){const d=this.va(),p=Z.materialDefines;if(!p)return;const r=Z.effect;if(!r)return;this._activeEffect=r,O.getMeshUniformBuffer().bindToEffect(r,"Mesh"),O.transferToEffect(V);const Y=d.getEngine();this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,d,O,V,this.isFrozen),o.b.Bind(Y.currentRenderPassId,this._activeEffect,O,V),this._eventInfo.subMesh=Z,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),p.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const m=this._mustRebind(d,r,Z,O.visibility);(0,t.e)(O,this._activeEffect,this.prePassConfiguration);let R=null;const i=this._uniformBuffer;if(m){if(this.bindViewProjection(r),R=this._getReflectionTexture(),!i.useUbo||!this.isFrozen||!i.isSync||Z._drawWrapper._forceRebindOnNextCall){var M;if(d.texturesEnabled){if(this._albedoTexture&&G.e.DiffuseTextureEnabled&&(i.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,t.o)(this._albedoTexture,i,"albedo")),this._ambientTexture&&G.e.AmbientTextureEnabled&&(i.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,t.o)(this._ambientTexture,i,"ambient")),this._opacityTexture&&G.e.OpacityTextureEnabled&&(i.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,t.o)(this._opacityTexture,i,"opacity")),R&&G.e.ReflectionTextureEnabled){if(i.tj("reflectionMatrix",R.getReflectionTextureMatrix()),i.updateFloat2("vReflectionInfos",R.level,0),R.boundingBoxSize){const V=R;i.updateVector3("vReflectionPosition",V.boundingBoxPosition),i.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this.realTimeFiltering){const V=R.getSize().width;i.updateFloat2("vReflectionFilteringInfo",V,Math.log2(V))}if(!p.USEIRRADIANCEMAP){const V=R.sphericalPolynomial;if(p.USESPHERICALFROMREFLECTIONMAP&&V)if(p.SPHERICAL_HARMONICS){const O=V.preScaledHarmonics;i.updateVector3("vSphericalL00",O.l00),i.updateVector3("vSphericalL1_1",O.l1_1),i.updateVector3("vSphericalL10",O.l10),i.updateVector3("vSphericalL11",O.l11),i.updateVector3("vSphericalL2_2",O.l2_2),i.updateVector3("vSphericalL2_1",O.l2_1),i.updateVector3("vSphericalL20",O.l20),i.updateVector3("vSphericalL21",O.l21),i.updateVector3("vSphericalL22",O.l22)}else i.updateFloat3("vSphericalX",V.x.x,V.x.y,V.x.z),i.updateFloat3("vSphericalY",V.y.x,V.y.y,V.y.z),i.updateFloat3("vSphericalZ",V.z.x,V.z.y,V.z.z),i.updateFloat3("vSphericalXX_ZZ",V.xx.x-V.zz.x,V.xx.y-V.zz.y,V.xx.z-V.zz.z),i.updateFloat3("vSphericalYY_ZZ",V.yy.x-V.zz.x,V.yy.y-V.zz.y,V.yy.z-V.zz.z),i.updateFloat3("vSphericalZZ",V.zz.x,V.zz.y,V.zz.z),i.updateFloat3("vSphericalXY",V.xy.x,V.xy.y,V.xy.z),i.updateFloat3("vSphericalYZ",V.yz.x,V.yz.y,V.yz.z),i.updateFloat3("vSphericalZX",V.zx.x,V.zx.y,V.zx.z)}i.updateFloat3("vReflectionMicrosurfaceInfos",R.getSize().width,R.lodGenerationScale,R.lodGenerationOffset)}this._emissiveTexture&&G.e.EmissiveTextureEnabled&&(i.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,t.o)(this._emissiveTexture,i,"emissive")),this._lightmapTexture&&G.e.LightmapTextureEnabled&&(i.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,t.o)(this._lightmapTexture,i,"lightmap")),G.e.SpecularTextureEnabled&&(this._metallicTexture?(i.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,t.o)(this._metallicTexture,i,"reflectivity")):this._reflectivityTexture&&(i.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,t.o)(this._reflectivityTexture,i,"reflectivity")),this._metallicReflectanceTexture&&(i.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,t.o)(this._metallicReflectanceTexture,i,"metallicReflectance")),this._reflectanceTexture&&p.REFLECTANCE&&(i.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,t.o)(this._reflectanceTexture,i,"reflectance")),this._microSurfaceTexture&&(i.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,t.o)(this._microSurfaceTexture,i,"microSurfaceSampler"))),this._bumpTexture&&Y.getCaps().standardDerivatives&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&(i.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,t.o)(this._bumpTexture,i,"bump"),d._mirroredCameraPosition?i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&i.updateFloat("pointSize",this.pointSize),p.METALLICWORKFLOW){var c;b.h.jb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,b.h.jb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,i.updateColor4("vReflectivityColor",b.h.jb[0],1);const V=(null===(c=this.subSurface)||void 0===c?void 0:c._indexOfRefraction)??1.5,O=1,Z=Math.pow((V-O)/(V+O),2);this._metallicReflectanceColor.scaleToRef(Z*this._metallicF0Factor,b.h.jb[0]);const d=this._metallicF0Factor;i.updateColor4("vMetallicReflectanceFactors",b.h.jb[0],d)}else i.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);i.updateColor3("vEmissiveColor",G.e.EmissiveTextureEnabled?this._emissiveColor:b.b.BlackReadOnly),i.updateColor3("vReflectionColor",this._reflectionColor),!p.SS_REFRACTION&&null!==(M=this.subSurface)&&void 0!==M&&M._linkRefractionWithTransparency?i.updateColor4("vAlbedoColor",this._albedoColor,1):i.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*d.environmentIntensity,this._lightingInfos.w=this._specularIntensity,i.updateVector4("vLightingIntensity",this._lightingInfos),d.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),i.updateColor3("vAmbientColor",this._globalAmbientColor),i.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}d.texturesEnabled&&(this._albedoTexture&&G.e.DiffuseTextureEnabled&&i.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&G.e.AmbientTextureEnabled&&i.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&G.e.OpacityTextureEnabled&&i.setTexture("opacitySampler",this._opacityTexture),R&&G.e.ReflectionTextureEnabled&&(p.LODBASEDMICROSFURACE?i.setTexture("reflectionSampler",R):(i.setTexture("reflectionSampler",R._lodTextureMid||R),i.setTexture("reflectionSamplerLow",R._lodTextureLow||R),i.setTexture("reflectionSamplerHigh",R._lodTextureHigh||R)),p.USEIRRADIANCEMAP&&i.setTexture("irradianceSampler",R.irradianceTexture)),p.ENVIRONMENTBRDF&&i.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&G.e.EmissiveTextureEnabled&&i.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&G.e.LightmapTextureEnabled&&i.setTexture("lightmapSampler",this._lightmapTexture),G.e.SpecularTextureEnabled&&(this._metallicTexture?i.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&i.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&i.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&p.REFLECTANCE&&i.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&i.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&Y.getCaps().standardDerivatives&&G.e.BumpTextureEnabled&&!this._disableBumpMap&&i.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(O)&&this.va().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=Z,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,X.g)(this._activeEffect,this,d),this.bindEyePosition(r)}else d.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(m||!this.isFrozen){var W;if(d.lightsEnabled&&!this._disableLighting&&(0,t.g)(d,O,this._activeEffect,p,this._maxSimultaneousLights),(d.fogEnabled&&O.applyFog&&d.fogMode!==a.b.FOGMODE_NONE||R||this.subSurface.refractionTexture||O.receiveShadows||p.PREPASS)&&this.bindView(r),(0,t.f)(d,O,this._activeEffect,!0),p.NUM_MORPH_INFLUENCERS&&(0,t.l)(O,this._activeEffect),p.BAKED_VERTEX_ANIMATION_TEXTURE)null===(W=O.bakedVertexAnimationManager)||void 0===W||W.bind(r,p.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,t.j)(p,this._activeEffect,d)}this._afterBind(O,this._activeEffect,Z),i.update()}getAnimatables(){const V=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&V.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?V.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&V.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&V.push(this._microSurfaceTexture),V}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const V=super.getActiveTextures();return this._albedoTexture&&V.push(this._albedoTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._reflectivityTexture&&V.push(this._reflectivityTexture),this._metallicTexture&&V.push(this._metallicTexture),this._metallicReflectanceTexture&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&V.push(this._microSurfaceTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._albedoTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._reflectivityTexture===V||(this._metallicTexture===V||(this._metallicReflectanceTexture===V||(this._reflectanceTexture===V||(this._microSurfaceTexture===V||(this._bumpTexture===V||this._lightmapTexture===V)))))))))))}setPrePassRenderer(){var V;if(null===(V=this.subSurface)||void 0===V||!V.isScatteringEnabled)return!1;const O=this.va().enableSubSurfaceForPrePass();return O&&(O.enabled=!0),!0}dispose(V,O){var Z,d,p,r,Y,m,a,R,i,M,c,W;(this._breakShaderLoadedCheck=!0,O)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(Z=this._albedoTexture)||void 0===Z||Z.dispose(),null===(d=this._ambientTexture)||void 0===d||d.dispose(),null===(p=this._opacityTexture)||void 0===p||p.dispose(),null===(r=this._reflectionTexture)||void 0===r||r.dispose(),null===(Y=this._emissiveTexture)||void 0===Y||Y.dispose(),null===(m=this._metallicTexture)||void 0===m||m.dispose(),null===(a=this._reflectivityTexture)||void 0===a||a.dispose(),null===(R=this._bumpTexture)||void 0===R||R.dispose(),null===(i=this._lightmapTexture)||void 0===i||i.dispose(),null===(M=this._metallicReflectanceTexture)||void 0===M||M.dispose(),null===(c=this._reflectanceTexture)||void 0===c||c.dispose(),null===(W=this._microSurfaceTexture)||void 0===W||W.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,O)}}J.PBRMATERIAL_OPAQUE=H.e.MATERIAL_OPAQUE,J.PBRMATERIAL_ALPHATEST=H.e.MATERIAL_ALPHATEST,J.PBRMATERIAL_ALPHABLEND=H.e.MATERIAL_ALPHABLEND,J.PBRMATERIAL_ALPHATESTANDBLEND=H.e.MATERIAL_ALPHATESTANDBLEND,J.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,J.LIGHTFALLOFF_PHYSICAL=0,J.LIGHTFALLOFF_GLTF=1,J.LIGHTFALLOFF_STANDARD=2,J.ForceGLSL=!1,(0,d.c)([(0,p.s)()],J.prototype,"_imageProcessingConfiguration",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsMiscDirty")],J.prototype,"debugMode",void 0)},11028:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y});var d=Z(10914);const p=new Map;function r(V,O){(function(V){return p.delete(V)})(V)&&d.b.Warn(`Extension with the name '${name}' already exists`),p.set(V,O)}function Y(V,O){"image/ktx"!==O&&"image/ktx2"!==O||(V=".ktx"),p.has(V)||(V.endsWith(".dds")&&r(".dds",(()=>Z.e(12).then(Z.bind(Z,12856)).then((V=>new V._DDSTextureLoader)))),V.endsWith(".basis")&&r(".basis",(()=>Z.e(13).then(Z.bind(Z,12860)).then((V=>new V._BasisTextureLoader)))),V.endsWith(".env")&&r(".env",(()=>Z.e(14).then(Z.bind(Z,12862)).then((V=>new V._ENVTextureLoader)))),V.endsWith(".hdr")&&r(".hdr",(()=>Z.e(15).then(Z.bind(Z,12871)).then((V=>new V._HDRTextureLoader)))),(V.endsWith(".ktx")||V.endsWith(".ktx2"))&&(r(".ktx",(()=>Z.e(16).then(Z.bind(Z,12873)).then((V=>new V._KTXTextureLoader)))),r(".ktx2",(()=>Z.e(16).then(Z.bind(Z,12873)).then((V=>new V._KTXTextureLoader))))),V.endsWith(".tga")&&r(".tga",(()=>Z.e(17).then(Z.bind(Z,12878)).then((V=>new V._TGATextureLoader)))),V.endsWith(".exr")&&r(".exr",(()=>Z.e(18).then(Z.bind(Z,12885)).then((V=>new V._ExrTextureLoader)))));const d=p.get(V);return d?Promise.resolve(d(O)):null}},11471:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>c});var d=Z(11210),p=Z(11216),r=Z(10902),Y=Z(11251),m=Z(10942),a=Z(11045),R=(Z(10947),Z(11474));class i{get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(V){this._texture&&(this._texture.isCube=V)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(V){return void 0!==(null===V||void 0===V?void 0:V.shareDepth)}constructor(V){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=R.c.Zero(),this._cachedBaseSize=R.c.Zero(),this._initialSamplingMode=2,this._texture=i._IsRenderTargetWrapper(V)?V.texture:V,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(V){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(V,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var M=Z(11283);class c extends i{set uc(V){this._hasAlpha!==V&&(this._hasAlpha=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get uc(){return this._hasAlpha}set getAlphaFromRGB(V){this._getAlphaFromRGB!==V&&(this._getAlphaFromRGB=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(V){this._coordinatesIndex!==V&&(this._coordinatesIndex=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(V){this._coordinatesMode!==V&&(this._coordinatesMode=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(V){this._texture?this._texture.isCube=V:this._isCube=V}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(V){var O;if(this._texture){if(this._texture._gammaSpace===V)return;this._texture._gammaSpace=V}else{if(this._gammaSpace===V)return;this._gammaSpace=V}null===(O=this.va())||void 0===O||O.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(V){var O;V!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=V),null===(O=this.va())||void 0===O||O.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(V){this._texture&&(this._texture._lodGenerationOffset=V)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(V){this._texture&&(this._texture._lodGenerationScale=V)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(V){this._texture&&(this._texture._linearSpecularLOD=V)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(V){this._texture&&(this._texture._irradianceTexture=V)}get uid(){return this._uid||(this._uid=(0,a.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Xi=new r.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,V?c._IsScene(V)?this._scene=V:this._engine=V:this._scene=m.e.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=O,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return Y.c.IdentityReadOnly}getReflectionTextureMatrix(){return Y.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(V){}get canRescale(){return!1}_getFromCache(V,O,Z,d,p,r){const Y=this._getEngine();if(!Y)return null;const m=Y._getUseSRGBBuffer(!!p,O),a=Y.getLoadedTexturesCache();for(let R=0;R<a.length;R++){const Y=a[R];if((void 0===p||m===Y._useSRGBBuffer)&&(void 0===d||d===Y.invertY)&&Y.url===V&&Y.generateMipMaps===!O&&(!Z||Z===Y.samplingMode)&&(void 0===r||r===Y.isCube))return Y.incrementReferences(),Y}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const V=this.va();V&&V.markAllMaterialsAsDirty(1)}readPixels(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const R=this._getEngine();if(!R)return null;const i=this.getSize();let M=i.width,c=i.height;0!==O&&(M/=Math.pow(2,O),c/=Math.pow(2,O),M=Math.round(M),c=Math.round(c)),m=Math.min(M,m),a=Math.min(c,a);try{return this._texture.isCube?R._readTexturePixels(this._texture,m,a,V,O,Z,d,p,r,Y):R._readTexturePixels(this._texture,m,a,-1,O,Z,d,p,r,Y)}catch(W){return null}}_readPixelsSync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const r=this.getSize();let Y=r.width,m=r.height;const a=this._getEngine();if(!a)return null;0!=O&&(Y/=Math.pow(2,O),m/=Math.pow(2,O),Y=Math.round(Y),m=Math.round(m));try{return this._texture.isCube?a._readTexturePixelsSync(this._texture,Y,m,V,O,Z,d,p):a._readTexturePixelsSync(this._texture,Y,m,-1,O,Z,d,p)}catch(R){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const V=this._scene.textures.indexOf(this);if(V>=0&&this._scene.textures.splice(V,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const V=this._parentContainer.textures.indexOf(this);V>-1&&this._parentContainer.textures.splice(V,1),this._parentContainer=null}}this.Xi.notifyObservers(this),this.Xi.clear(),this.metadata=null,super.dispose()}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!V)return null;const O=M.b.Serialize(this);return M.b.AppendSerializedAnimations(this,O),O}static WhenAllReady(V,O){let Z=V.length;if(0!==Z)for(let d=0;d<V.length;d++){const p=V[d];if(p.isReady())0===--Z&&O();else{const V=p.onLoadObservable;V?V.addOnce((()=>{0===--Z&&O()})):0===--Z&&O()}}else O()}static _IsScene(V){return"Scene"===V.getClassName()}}c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,d.c)([(0,p.K)()],c.prototype,"uniqueId",void 0),(0,d.c)([(0,p.K)()],c.prototype,"name",void 0),(0,d.c)([(0,p.K)()],c.prototype,"metadata",void 0),(0,d.c)([(0,p.K)("uc")],c.prototype,"_hasAlpha",void 0),(0,d.c)([(0,p.K)("getAlphaFromRGB")],c.prototype,"_getAlphaFromRGB",void 0),(0,d.c)([(0,p.K)()],c.prototype,"level",void 0),(0,d.c)([(0,p.K)("coordinatesIndex")],c.prototype,"_coordinatesIndex",void 0),(0,d.c)([(0,p.K)()],c.prototype,"optimizeUVAllocation",void 0),(0,d.c)([(0,p.K)("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),(0,d.c)([(0,p.K)()],c.prototype,"wrapU",null),(0,d.c)([(0,p.K)()],c.prototype,"wrapV",null),(0,d.c)([(0,p.K)()],c.prototype,"wrapR",void 0),(0,d.c)([(0,p.K)()],c.prototype,"anisotropicFilteringLevel",void 0),(0,d.c)([(0,p.K)()],c.prototype,"isCube",null),(0,d.c)([(0,p.K)()],c.prototype,"is3D",null),(0,d.c)([(0,p.K)()],c.prototype,"is2DArray",null),(0,d.c)([(0,p.K)()],c.prototype,"gammaSpace",null),(0,d.c)([(0,p.K)()],c.prototype,"invertZ",void 0),(0,d.c)([(0,p.K)()],c.prototype,"lodLevelInAlpha",void 0),(0,d.c)([(0,p.K)()],c.prototype,"lodGenerationOffset",null),(0,d.c)([(0,p.K)()],c.prototype,"lodGenerationScale",null),(0,d.c)([(0,p.K)()],c.prototype,"linearSpecularLOD",null),(0,d.c)([(0,p.A)()],c.prototype,"irradianceTexture",null),(0,d.c)([(0,p.K)()],c.prototype,"isRenderTarget",void 0)},12185:(V,O,Z)=>{"use strict";var d=Z(11732),p=Z(11471);p.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(p.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=d.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},12215:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>c});var d=Z(11210),p=Z(11216),r=Z(10900),Y=Z(11251),m=Z(11471),a=Z(11467),R=Z(11041),i=Z(10902),M=Z(11283);Z(11766);class c extends m.c{set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const O=this.va();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(V){this._rotationY=V,this.setReflectionTextureMatrix(Y.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(V,O,Z){let d="";return V.forEach((V=>d+=V)),new c(d,O,null,Z,V)}static CreateFromPrefilteredData(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const r=new c(V,O,null,!1,null,null,null,void 0,!0,Z,d);return O.useDelayedTextureLoading=p,r}constructor(V,O){var Z;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new i.e,this.boundingBoxPosition=Y.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.c,this._buffer=null,this.name=V,this.url=V,this._noMipmap=p,this.uc=!1,this.isCube=!0,this._textureMatrix=Y.c.Identity(),this.coordinatesMode=a.b.CUBIC_MODE;let S=null,z=null;null===d||Array.isArray(d)?(this._noMipmap=p,this._format=M,this._createPolynomials=F,S=d,this._loaderOptions=U,this._useSRGBBuffer=H,this._lodScale=Q,this._lodOffset=b):(S=d.extensions??null,this._noMipmap=d.noMipmap??!1,r=d.files??null,z=d.buffer??null,this._format=d.format??5,c=d.prefiltered??!1,W=d.forcedExtension??null,this._createPolynomials=d.createPolynomials??!1,this._lodScale=d.lodScale??.8,this._lodOffset=d.lodOffset??0,this._loaderOptions=d.loaderOptions,this._useSRGBBuffer=d.useSRGBBuffer,m=d.X??null,R=d.onError??null),(V||r)&&this.updateURL(V,W,m,c,R,S,null===(Z=this.va())||void 0===Z?void 0:Z.useDelayedTextureLoading,r,z)}getClassName(){return"CubeTexture"}updateURL(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,O&&(this._forcedExtension=O);const R=V.lastIndexOf("."),i=O||(R>-1?V.substring(R).toLowerCase():""),M=0===i.indexOf(".dds"),c=0===i.indexOf(".env"),W=0===i.indexOf(".basis");if(c?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=d,d&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),m)this._files=m;else if(W||c||M||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,r){for(let O=0;O<r.length;O++)this._files.push(V+r[O]);this._extensions=r}this._buffer=a,Y?(this.delayLoadState=4,this._delayedOnLoad=Z,this._delayedOnError=p):this._loadTexture(Z,p)}delayLoad(V){4===this.delayLoadState&&(V&&(this._forcedExtension=V),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(V){var O,Z;if(V.updateFlag===this._textureMatrix.updateFlag)return;V.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Z=this.va())||void 0===Z||Z.markAllMaterialsAsDirty(1,(V=>-1!==V.getActiveTextures().indexOf(this))));if(this._textureMatrix=V,null===(O=this.va())||void 0===O||!O.useRightHandedSystem)return;const d=Y.i.ib[0],p=Y.i.Quaternion[0],r=Y.i.ib[1];this._textureMatrix.decompose(d,p,r),p.z*=-1,p.w*=-1,Y.c.ComposeToRef(d,p,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var V;return null!==(V=this.va())&&void 0!==V&&V.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this.va(),d=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const p=()=>{var O;(this.onLoadObservable.notifyObservers(this),d)&&(d.dispose(),null===(O=this.va())||void 0===O||O.markAllMaterialsAsDirty(1));V&&V()},Y=(V,Z)=>{this._loadingError=!0,this._errorObject={message:V,exception:Z},O&&O(V,Z),a.b.OnTextureLoadErrorObservable.notifyObservers(this)};var m;this._texture?this._texture.isReady?r.e.SetImmediate((()=>p())):this._texture.onLoadedObservable.add((()=>p())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Z,this._lodScale,this._lodOffset,V,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Z,this._files,this._noMipmap,V,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(m=this._texture)||void 0===m||m.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(V,O,Z){const d=M.b.Parse((()=>{let d=!1;return V.prefiltered&&(d=V.prefiltered),new c(Z+(V.url??V.name),O,V.extensions,!1,V.files||null,null,null,void 0,d,V.forcedExtension)}),V,O);if(V.boundingBoxPosition&&(d.boundingBoxPosition=Y.m.Cg(V.boundingBoxPosition)),V.boundingBoxSize&&(d.boundingBoxSize=Y.m.Cg(V.boundingBoxSize)),V.animations)for(let p=0;p<V.animations.length;p++){const O=V.animations[p],Z=(0,R.c)("BABYLON.Animation");Z&&d.animations.push(Z.Parse(O))}return d}clone(){let V=0;const O=M.b.Clone((()=>{const O=new c(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return V=O.uniqueId,O}),this);return O.uniqueId=V,O}}(0,d.c)([(0,p.K)()],c.prototype,"url",void 0),(0,d.c)([(0,p.G)()],c.prototype,"boundingBoxPosition",void 0),(0,d.c)([(0,p.G)()],c.prototype,"boundingBoxSize",null),(0,d.c)([(0,p.K)("rotationY")],c.prototype,"rotationY",null),(0,d.c)([(0,p.K)("files")],c.prototype,"_files",void 0),(0,d.c)([(0,p.K)("forcedExtension")],c.prototype,"_forcedExtension",void 0),(0,d.c)([(0,p.K)("extensions")],c.prototype,"_extensions",void 0),(0,d.c)([(0,p.u)("textureMatrix")],c.prototype,"_textureMatrix",void 0),(0,d.c)([(0,p.u)("textureMatrixRefraction")],c.prototype,"_textureMatrixRefraction",void 0),a.b._CubeTextureParser=c.Parse,(0,R.f)("BABYLON.CubeTexture",c)},12602:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>a});var d=Z(10914),p=Z(11467),r=Z(11049),Y=Z(11678),m=Z(11013);Y.ThinEngine.prototype.createDynamicTexture=function(V,O,Z,d){const p=new m.d(this,4);return p.baseWidth=V,p.baseHeight=O,Z&&(V=this.needPOTTextures?(0,r.g)(V,this._caps.maxTextureSize):V,O=this.needPOTTextures?(0,r.g)(O,this._caps.maxTextureSize):O),p.width=V,p.height=O,p.isReady=!1,p.generateMipMaps=Z,p.samplingMode=d,this.updateTextureSamplingMode(d,p),this._internalTexturesCache.push(p),p},Y.ThinEngine.prototype.updateDynamicTexture=function(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V)return;const Y=this._gl,m=Y.TEXTURE_2D,a=this._bindTextureDirectly(m,V,!0,r);this._unpackFlipY(void 0===Z?V.invertY:Z),d&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const R=this._getWebGLTextureType(V.type),i=this._getInternalFormat(p||V.format),M=this._getRGBABufferInternalSizedFormat(V.type,i);Y.texImage2D(m,0,M,i,R,O),V.generateMipMaps&&Y.generateMipmap(m),a||this._bindTextureDirectly(m,null),d&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p&&(V.format=p),V._dynamicTextureSource=O,V._premulAlpha=d,V.invertY=Z||!1,V.isReady=!0};class a extends p.b{constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,m=arguments.length>6?arguments[6]:void 0;const a=!Z||Z._isScene;super(null,a?Z:null===Z||void 0===Z?void 0:Z.Cf,a?!d:Z,m,r,void 0,void 0,void 0,void 0,Y),this.name=V,this.wrapU=p.b.CLAMP_ADDRESSMODE,this.wrapV=p.b.CLAMP_ADDRESSMODE,this._generateMipMaps=d;const R=this._getEngine();if(!R)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=R.createDynamicTexture(this._canvas.width,this._canvas.height,d,r);else{this._canvas=R.createCanvas(1,1),this._ownCanvas=!0;const V=O;V.width||0===V.width?this._texture=R.createDynamicTexture(V.width,V.height,d,r):this._texture=R.createDynamicTexture(O,O,d,r)}const i=this.getSize();this._canvas.width!==i.width&&(this._canvas.width=i.width),this._canvas.height!==i.height&&(this._canvas.height=i.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(V){this._canvas.width=V.width,this._canvas.height=V.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(V.width,V.height,this._generateMipMaps,this.samplingMode)}scale(V){const O=this.getSize();O.width*=V,O.height*=V,this._recreate(O)}scaleTo(V,O){const Z=this.getSize();Z.width=V,Z.height=O,this._recreate(Z)}getContext(){return this._context}clear(V){const O=this.getSize();V&&(this._context.fillStyle=V),this._context.clearRect(0,0,O.width,O.height)}update(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===V||V,O,this._format||void 0,void 0,Z)}drawText(V,O,Z,d,p,r,Y){let m=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const a=this.getSize();if(r&&(this._context.fillStyle=r,this._context.fillRect(0,0,a.width,a.height)),this._context.font=d,null===O||void 0===O){const Z=this._context.measureText(V);O=(a.width-Z.width)/2}if(null===Z||void 0===Z){const V=parseInt(d.replace(/\D/g,""));Z=a.height/2+V/3.65}this._context.fillStyle=p||"",this._context.fillText(V,O,Z),m&&this.update(Y)}dispose(){var V,O;(super.dispose(),this._ownCanvas)&&(null===(V=this._canvas)||void 0===V||null===(O=V.remove)||void 0===O||O.call(V));this._canvas=null,this._context=null}clone(){const V=this.va();if(!V)return this;const O=this.getSize(),Z=new a(this.name,O,V,this._generateMipMaps);return Z.uc=this.uc,Z.level=this.level,Z.wrapU=this.wrapU,Z.wrapV=this.wrapV,Z}serialize(){const V=this.va();V&&!V.isReady()&&d.b.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return a._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(V){return void 0!==V.toDataURL}_rebuild(){this.update()}}},11013:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y});var d,p=Z(10902),r=Z(11020);!function(V){V[V.Unknown=0]="Unknown",V[V.Url=1]="Url",V[V.Temp=2]="Temp",V[V.Raw=3]="Raw",V[V.Dynamic=4]="Dynamic",V[V.RenderTarget=5]="RenderTarget",V[V.MultiRenderTarget=6]="MultiRenderTarget",V[V.Cube=7]="Cube",V[V.CubeRaw=8]="CubeRaw",V[V.CubePrefiltered=9]="CubePrefiltered",V[V.Raw3D=10]="Raw3D",V[V.Raw2DArray=11]="Raw2DArray",V[V.DepthStencil=12]="DepthStencil",V[V.CubeRawRGBD=13]="CubeRawRGBD",V[V.Depth=14]="Depth"}(d||(d={}));class Y extends r.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(V){this.generateMipMaps=V}get uniqueId(){return this._uniqueId}_setUniqueId(V){this._uniqueId=V}getEngine(){return this._engine}get source(){return this._source}constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new p.e,this.onErrorObservable=new p.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=V,this._source=O,this._uniqueId=Y._Counter++,Z||(this._hardwareTexture=V._createHardwareTexture())}incrementReferences(){this._references++}updateSize(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,V,O,Z),this.width=V,this.height=O,this.depth=Z,this.baseWidth=V,this.baseHeight=O,this.baseDepth=Z,this._size=V*O*Z}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const V=this.onRebuildCallback(this),O=O=>{O._swapAndDie(this,!1),this.isReady=V.isReady};return void(V.isAsync?V.proxy.then(O):O(V.proxy))}let V;switch(this.source){case 2:case 12:case 14:break;case 1:return void(V=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(V=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:V=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),V._swapAndDie(this,!1),this.isReady=!0;break;case 10:V=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 11:V=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 4:V=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),V._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(V=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:V=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),V._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return V=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(V=>{V&&V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(V._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(V){var O;let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(O=this._hardwareTexture)||void 0===O||O.setUsage(V._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),V._hardwareTexture=this._hardwareTexture,Z&&(V._isRGBD=this._isRGBD),this._lodTextureHigh&&(V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(V._lodTextureLow&&V._lodTextureLow.dispose(),V._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(V._irradianceTexture&&V._irradianceTexture.dispose(),V._irradianceTexture=this._irradianceTexture);const d=this._engine.getLoadedTexturesCache();let p=d.indexOf(this);-1!==p&&d.splice(p,1),p=d.indexOf(V),-1===p&&d.push(V)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}Y._Counter=0},11691:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});var d=Z(11467);class p extends d.b{constructor(V,O,Z,p,r){let Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>9?arguments[9]:void 0,M=arguments.length>10?arguments[10]:void 0;super(null,r,!Y,m,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i),this.format=p,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==R||(a=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==R||(a=1),this._texture=this._engine.createRawTexture(V,O,Z,p,Y,m,a,null,R,i??0,M??!1),this.wrapU=d.b.CLAMP_ADDRESSMODE,this.wrapV=d.b.CLAMP_ADDRESSMODE)}update(V){this._getEngine().updateRawTexture(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const V=new p(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return V._texture=this._texture,this._texture.incrementReferences(),V}static CreateLuminanceTexture(V,O,Z,d){return new p(V,O,Z,1,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(V,O,Z,d){return new p(V,O,Z,2,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(V,O,Z,d){return new p(V,O,Z,0,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(V,O,Z,d){return new p(V,O,Z,4,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(V,O,Z,d){return new p(V,O,Z,5,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(V,O,Z,d){return new p(V,O,Z,5,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(V,O,Z,r){let Y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:d.b.TRILINEAR_SAMPLINGMODE;return new p(V,O,Z,6,r,Y,m,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(V,O,Z,r){let Y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:d.b.TRILINEAR_SAMPLINGMODE;return new p(V,O,Z,6,r,Y,m,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12046:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>p});var d=Z(11467);class p extends d.b{get depth(){return this._depth}constructor(V,O,Z,p,r,Y){let m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:d.b.TRILINEAR_SAMPLINGMODE,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10?arguments[10]:void 0;super(null,Y,!m,a),this.format=r,this._texture=Y.getEngine().createRawTexture2DArray(V,O,Z,p,r,m,a,R,null,i,M),this._depth=p,this.is2DArray=!0}update(V){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(V,O,Z,d,r){return new p(V,O,Z,d,5,r,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11743:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>c});var d=Z(10902),p=Z(11251),r=Z(11467),Y=Z(11328),m=Z(11337),a=Z(11259),R=Z(11049),i=Z(10986),M=Z(10914);i.c.prototype.setDepthStencilTexture=function(V,O){this._engine.setDepthStencilTexture(this._samplers[V],this._uniforms[V],O,V)};class c extends r.b{get renderList(){return this._renderList}set renderList(V){this._renderList!==V&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),V&&(this._unObserveRenderList=(0,a.k)(V,this._renderListHasChanged)),this._renderList=V)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(V){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(V)}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}set onClear(V){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(V)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(V,O){let Z;Z=Array.isArray(V)?V:[V];for(let d=0;d<Z.length;++d)for(let V=0;V<this._renderPassIds.length;++V)Z[d].setMaterialForRenderPass(this._renderPassIds[V],void 0!==O?Array.isArray(O)?O[V]:O:void 0)}get isMulti(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const O=this.va();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V._depthStencilTexture)??null}constructor(V,O,Z){let Y,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r.b.TRILINEAR_SAMPLINGMODE,W=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],F=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,U=arguments.length>12&&void 0!==arguments[12]&&arguments[12],H=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],G=arguments.length>16&&void 0!==arguments[16]&&arguments[16],w=!0;if("object"===typeof a){const V=a;a=!!V.generateMipMaps,R=V.doNotChangeAspectRatio??!0,i=V.type??0,M=!!V.isCube,c=V.samplingMode??r.b.TRILINEAR_SAMPLINGMODE,W=V.generateDepthBuffer??!0,F=!!V.generateStencilBuffer,Q=!!V.isMulti,b=V.format??5,U=!!V.delayAllocation,H=V.samples,S=V.creationFlags,z=!!V.noColorAttachment,G=!!V.useSRGBBuffer,Y=V.colorAttachment,w=V.gammaSpace??w}if(super(null,Z,!a,void 0,c,void 0,void 0,void 0,void 0,b),this._unObserveRenderList=null,this._renderListHasChanged=(V,O)=>{const Z=this._renderList?this._renderList.length:0;var d;(0===O&&Z>0||0===Z)&&(null===(d=this.va())||void 0===d||d.meshes.forEach((V=>{V._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new d.e,this.onAfterUnbindObservable=new d.e,this.onBeforeRenderObservable=new d.e,this.onAfterRenderObservable=new d.e,this.onClearObservable=new d.e,this.onResizeObservable=new d.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=p.m.Zero(),this._dumpToolsLoading=!1,!(Z=this.va()))return;const t=this.va().getEngine();this._gammaSpace=w,this._coordinatesMode=r.b.PROJECTION_MODE,this.renderList=[],this.name=V,this.isRenderTarget=!0,this._initialSizeParameter=O,this._renderPassIds=[],this._isCubeData=M,this._processSizeParameter(O),this.renderPassId=this._renderPassIds[0],this._resizeObserver=t.onResizeObservable.add((()=>{})),this._generateMipMaps=!!a,this._doNotChangeAspectRatio=R,this._renderingManager=new m.d(Z),this._renderingManager._useSceneAutoClearSetup=!0,Q||(this._renderTargetOptions={generateMipMaps:a,type:i,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:W,generateStencilBuffer:F,samples:H,creationFlags:S,noColorAttachment:z,useSRGBBuffer:G,colorAttachment:Y,label:this.name},this.samplingMode===r.b.NEAREST_SAMPLINGMODE&&(this.wrapU=r.b.CLAMP_ADDRESSMODE,this.wrapV=r.b.CLAMP_ADDRESSMODE),U||(M?(this._renderTarget=Z.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=r.b.INVCUBIC_MODE,this._textureMatrix=p.c.Identity()):this._renderTarget=Z.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==H&&(this.samples=H)))}createDepthStencilTexture(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,Y=arguments.length>5?arguments[5]:void 0;null===(V=this._renderTarget)||void 0===V||V.createDepthStencilTexture(O,Z,d,p,r,Y)}_releaseRenderPassId(){if(this._scene){const V=this._scene.getEngine();for(let O=0;O<this._renderPassIds.length;++O)V.releaseRenderPassId(this._renderPassIds[O])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const V=this._scene.getEngine(),O=this._isCubeData?6:this.getRenderLayers()||1;for(let Z=0;Z<O;++Z)this._renderPassIds[Z]=V.createRenderPassId(`RenderTargetTexture - ${this.name}#${Z}`)}_processSizeParameter(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.ratio){this._sizeRatio=V.ratio;const O=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(O.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(O.getRenderHeight(),this._sizeRatio)}}else this._size=V;O&&this._createRenderPassId()}get samples(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.samples)??this._samples}set samples(V){this._renderTarget&&(this._samples=this._renderTarget.setSamples(V))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(V){this._refreshRate=V,this.resetRefreshCounter()}addPostProcess(V){if(!this._postProcessManager){const V=this.va();if(!V)return;this._postProcessManager=new Y.b(V),this._postProcesses=new Array}this._postProcesses.push(V),this._postProcesses[0].Fi=!1}clearPostProcesses(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(V)for(const V of this._postProcesses)V.dispose();this._postProcesses=[]}}removePostProcess(V){if(!this._postProcesses)return;const O=this._postProcesses.indexOf(V);-1!==O&&(this._postProcesses.splice(O,1),this._postProcesses.length>0&&(this._postProcesses[0].Fi=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const V=this._size.layers;if(V)return V;const O=this._size.depth;return O||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(V){const O=Math.max(1,this.getRenderSize()*V);this.resize(O)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(V){var O;const Z=this.isCube;null===(O=this._renderTarget)||void 0===O||O.dispose(),this._renderTarget=null;const d=this.va();d&&(this._processSizeParameter(V,!1),this._renderTarget=Z?d.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):d.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(V,O)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(Z.bind(Z,12209)).then((V=>this._dumpTools=V))),this._render(!1,!1,!0)}_render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this.va();if(!d)return Z;const p=d.getEngine();if(void 0!==this.useCameraPostProcesses&&(V=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let V=0;V<this._waitingRenderList.length;V++){const O=this._waitingRenderList[V],Z=d.getMeshById(O);Z&&this.renderList.push(Z)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const V=this.va();if(!V)return Z;const O=V.meshes;for(let Z=0;Z<O.length;Z++){const V=O[Z];this.renderListPredicate(V)&&this.renderList.push(V)}}const r=p.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const Y=this.activeCamera??d.activeCamera,m=d.activeCamera;Y&&(Y!==d.activeCamera&&(d.setTransformMatrix(Y.getViewMatrix(),Y.getProjectionMatrix(!0)),d.activeCamera=Y),p.setViewport(Y.rigParent?Y.rigParent.viewport:Y.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let a=Z;if(Z){d.getViewMatrix()||d.updateTransformMatrix();const V=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let r=0;r<V&&a;r++){let V=null;const O=this.renderList?this.renderList:d.getActiveMeshes().data,Y=this.renderList?this.renderList.length:d.getActiveMeshes().length;p.currentRenderPassId=this._renderPassIds[r],this.onBeforeRenderObservable.notifyObservers(r),this.getCustomRenderList&&(V=this.getCustomRenderList(r,O,Y)),V||(V=O),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0);for(let d=0;d<V.length&&a;++d){const O=V[d];if(O.isEnabled()&&!O.isBlocked&&O.isVisible&&O.Ef)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(O,this.refreshRate,Z)){a=!1;continue}}else if(!O.isReady(!0)){a=!1;continue}}this.onAfterRenderObservable.notifyObservers(r),(this.is2DArray||this.is3D||this.isCube)&&(d.incrementRenderId(),d.resetCachedMaterial())}const O=this.particleSystemList||d.bj;for(const Z of O)Z.isReady()||(a=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let R=0;R<6;R++)this._renderToTarget(R,V,O,void 0,Y),d.incrementRenderId(),d.resetCachedMaterial();else this._renderToTarget(0,V,O,void 0,Y);else for(let R=0;R<this.getRenderLayers();R++)this._renderToTarget(0,V,O,R,Y),d.incrementRenderId(),d.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),p.currentRenderPassId=r,d.activeCamera=m,m&&(this.activeCamera&&this.activeCamera!==d.activeCamera&&d.setTransformMatrix(m.getViewMatrix(),m.getProjectionMatrix(!0)),p.setViewport(m.viewport)),d.resetCachedMaterial(),a}_bestReflectionRenderTargetDimension(V,O){const Z=V*O,d=(0,R.p)(Z+16384/(128+Z));return Math.min((0,R.c)(V),d)}_prepareRenderingManager(V,O,Z,d){const p=this.va();if(!p)return;this._renderingManager.reset();const r=p.getRenderId();for(let m=0;m<O;m++){const O=V[m];if(O&&!O.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(O,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!O.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!O._internalAbstractMeshDataInfo._currentLODIsUpToDate&&Z&&(O._internalAbstractMeshDataInfo._currentLOD=p.customLODSelector?p.customLODSelector(O,Z):O.getLOD(Z),O._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!O._internalAbstractMeshDataInfo._currentLOD)continue;let V,Y=O._internalAbstractMeshDataInfo._currentLOD;if(Y!==O&&0!==Y.billboardMode&&Y.Cj(),Y._preActivateForIntermediateRendering(r),V=!(!d||!Z)&&0===(O.layerMask&Z.layerMask),O.isEnabled()&&O.isVisible&&O.Ef&&!V){if(Y!==O&&Y._activate(r,!0),O._activate(r,!0)&&O.Ef.length){O.isAnInstance?O._internalAbstractMeshDataInfo._actAsRegularMesh&&(Y=O):Y._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,Y._internalAbstractMeshDataInfo._isActiveIntermediate=!0,p._prepareSkeleton(Y);for(let V=0;V<Y.Ef.length;V++){const O=Y.Ef[V];this._renderingManager.dispatch(O,Y)}}O._postActivate()}}}const Y=this.particleSystemList||p.bj;for(let m=0;m<Y.length;m++){const V=Y[m],O=V.k;V.isStarted()&&O&&(!O.position||O.isEnabled())&&this._renderingManager.dispatchParticles(V)}}_bindFrameBuffer(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.va();if(!Z)return;const d=Z.getEngine();this._renderTarget&&d.bindFramebuffer(this._renderTarget,this.isCube?V:void 0,void 0,void 0,this.ignoreCameraViewport,0,O)}_unbindFrameBuffer(V,O){this._renderTarget&&V.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(O)}))}_prepareFrame(V,O,Z,d){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):d&&V.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(O,Z)}_renderToTarget(V,O,Z){var d,p;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const m=this.va();if(!m)return;const a=m.getEngine();this._prepareFrame(m,V,r,O),null===(d=a._debugPushGroup)||void 0===d||d.call(a,`render to face #${V} layer #${r}`,2),this.is2DArray||this.is3D?(a.currentRenderPassId=this._renderPassIds[r],this.onBeforeRenderObservable.notifyObservers(r)):(a.currentRenderPassId=this._renderPassIds[V],this.onBeforeRenderObservable.notifyObservers(V));if(a.snapshotRendering&&1===a.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||m.clearColor,!0,!0,!0);else{var R;let d=null;const p=this.renderList?this.renderList:m.getActiveMeshes().data,i=this.renderList?this.renderList.length:m.getActiveMeshes().length;this.getCustomRenderList&&(d=this.getCustomRenderList(this.is2DArray||this.is3D?r:V,p,i)),d?this._prepareRenderingManager(d,d.length,Y,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(p,i,Y,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),d=p);for(const O of m._beforeRenderTargetClearStage)O.action(this,V,r);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||m.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||m.updateTransformMatrix(!0);for(const O of m._beforeRenderTargetDrawStage)O.action(this,V,r);this._renderingManager.render(this.customRenderFunction,d,this.renderParticles,this.renderSprites);for(const O of m._afterRenderTargetDrawStage)O.action(this,V,r);const c=(null===(R=this._texture)||void 0===R?void 0:R.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,V,this._postProcesses,this.ignoreCameraViewport):O&&m.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,V);for(const O of m._afterRenderTargetPostProcessStage)O.action(this,V,r);this._texture&&(this._texture.generateMipMaps=c),this._doNotChangeAspectRatio||m.updateTransformMatrix(!0),Z&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),a):M.b.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(p=a._debugPopGroup)||void 0===p||p.call(a,2),this._unbindFrameBuffer(a,V),this._texture&&this.isCube&&5===V&&a.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,O,Z,d)}setRenderingAutoClearDepthStencil(V,O){this._renderingManager.setRenderingAutoClearDepthStencil(V,O),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const V=this.getSize(),O=new c(this.name,V,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return O.uc=this.uc,O.level=this.level,O.coordinatesMode=this.coordinatesMode,this.renderList&&(O.renderList=this.renderList.slice(0)),O}serialize(){if(!this.name)return null;const V=super.serialize();if(V.renderTargetSize=this.getRenderSize(),V.renderList=[],this.renderList)for(let O=0;O<this.renderList.length;O++)V.renderList.push(this.renderList[O].id);return V}disposeFramebufferObjects(){var V;null===(V=this._renderTarget)||void 0===V||V.dispose(!0)}releaseInternalTexture(){var V;null===(V=this._renderTarget)||void 0===V||V.releaseTextures(),this._texture=null}dispose(){var V;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const O=this.va();if(!O)return;let Z=O.customRenderTargets.indexOf(this);Z>=0&&O.customRenderTargets.splice(Z,1);for(const d of O.cameras)Z=d.customRenderTargets.indexOf(this),Z>=0&&d.customRenderTargets.splice(Z,1);null===(V=this._renderTarget)||void 0===V||V.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===c.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=c.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}c.REFRESHRATE_RENDER_ONCE=0,c.REFRESHRATE_RENDER_ONEVERYFRAME=1,c.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,r.b._CreateRenderTargetTexture=(V,O,Z,d,p)=>new c(V,O,Z,d)},11467:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>S});var d=Z(11210),p=Z(11216),r=Z(10902),Y=Z(11251),m=Z(11471),a=Z(11041),R=Z(10928),i=Z(10979),M=Z(11036),c=Z(11386),W=Z(10959);function F(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=O.width,p=O.height;if(V instanceof Float32Array){let O=V.byteLength/V.BYTES_PER_ELEMENT;const Z=new Uint8Array(O);for(;--O>=0;){let d=V[O];d<0?d=0:d>1&&(d=1),Z[O]=255*d}V=Z}const r=document.createElement("canvas");r.width=d,r.height=p;const Y=r.getContext("2d");if(!Y)return null;const m=Y.createImageData(d,p);if(m.data.set(V),Y.putImageData(m,0,0),Z){const V=document.createElement("canvas");V.width=d,V.height=p;const O=V.getContext("2d");return O?(O.translate(0,p),O.scale(1,-1),O.drawImage(r,0,0),V.toDataURL("image/png")):null}return r.toDataURL("image/png")}function Q(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=V.getInternalTexture();if(!d)return null;const p=V._readPixelsSync(O,Z);return p?F(p,V.getSize(),d.invertY):null}async function b(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=V.getInternalTexture();if(!d)return null;const p=await V.readPixels(O,Z);return p?F(p,V.getSize(),d.invertY):null}var U=Z(11476),H=Z(11283);class S extends m.c{static _CreateVideoTexture(V,O,Z){arguments.length>5&&void 0!==arguments[5]||S.TRILINEAR_SAMPLINGMODE;throw(0,R.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(V){this._isBlocking=V}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(V,O,Z,d){let p,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.TRILINEAR_SAMPLINGMODE,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9?arguments[9]:void 0,W=arguments.length>10?arguments[10]:void 0,F=arguments.length>11?arguments[11]:void 0,Q=arguments.length>12?arguments[12]:void 0,b=arguments.length>13?arguments[13]:void 0;super(O),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new r.e,this._isBlocking=!0,this.name=V||"",this.url=V;let H=!1,z=null,G=!0;"object"===typeof Z&&null!==Z?(p=Z.noMipmap??!1,d=Z.invertY??!U.c,Y=Z.samplingMode??S.TRILINEAR_SAMPLINGMODE,m=Z.X??null,a=Z.onError??null,R=Z.buffer??null,M=Z.deleteBuffer??!1,c=Z.format,W=Z.mimeType,F=Z.loaderOptions,Q=Z.creationFlags,H=Z.useSRGBBuffer??!1,z=Z.internalTexture??null,G=Z.gammaSpace??G):p=!!Z,this._gammaSpace=G,this._noMipmap=p,this._invertY=void 0===d?!U.c:d,this._initialSamplingMode=Y,this._buffer=R,this._deleteBuffer=M,this._mimeType=W,this._loaderOptions=F,this._creationFlags=Q,this._useSRGBBuffer=H,this._forcedExtension=b,c&&(this._format=c);const w=this.va(),t=this._getEngine();if(!t)return;t.onBeforeTextureInitObservable.notifyObservers(this);const C=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),m&&m(),!this.isBlocking&&w&&w.resetCachedMaterial()},v=(V,O)=>{this._loadingError=!0,this._errorObject={message:V,exception:O},a&&a(V,O),S.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!z)return this._delayedOnLoad=C,void(this._delayedOnError=v);if(this._texture=z??this._getFromCache(this.url,p,Y,this._invertY,H,this.isCube),this._texture)if(this._texture.isReady)i.d.SetImmediate((()=>C()));else{const V=this._texture.onLoadedObservable.add(C);this._texture.onErrorObservable.add((O=>{var Z;v(O.message,O.exception),null===(Z=this._texture)||void 0===Z||Z.onLoadedObservable.remove(V)}))}else if(w&&w.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=v;else{try{this._texture=t.createTexture(this.url,p,this._invertY,w,Y,C,v,this._buffer,void 0,this._format,this._forcedExtension,W,F,Q,H)}catch(A){throw v("error loading",A),A}M&&(this._buffer=null)}}updateURL(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,this._buffer=O,this._forcedExtension=d,this.delayLoadState=4,Z&&(this._delayedOnLoad=Z),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const V=this.va();V&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?i.d.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=V.getEngine().createTexture(this.url,this._noMipmap,this._invertY,V,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(V,O,Z,d){V*=this._cachedUScale,O*=this._cachedVScale,V-=this.uRotationCenter*this._cachedUScale,O-=this.vRotationCenter*this._cachedVScale,Z-=this.wRotationCenter,Y.m.TransformCoordinatesFromFloatsToRef(V,O,Z,this._rowGenerationMatrix,d),d.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,d.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,d.z+=this.wRotationCenter}getTextureMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*V===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*V,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=Y.c.Zero(),this._rowGenerationMatrix=new Y.c,this._t0=Y.m.Zero(),this._t1=Y.m.Zero(),this._t2=Y.m.Zero()),Y.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(Y.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,Y.i.Matrix[0]),Y.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,Y.i.Matrix[1]),Y.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,Y.i.Matrix[2]),Y.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,Y.i.Matrix[3]),Y.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Y.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Y.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(Y.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.bi(this._t0),this._t2.bi(this._t0),Y.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const O=this.va();if(!O)return this._cachedTextureMatrix;const Z=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&Z!==this._cachedIdentity3x2&&O.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const V=this.va();if(!V)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==S.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===V.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=Y.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=Y.c.Zero());const O=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case S.PLANAR_MODE:Y.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case S.PROJECTION_MODE:{Y.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const O=V.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=O.updateFlag,O.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:Y.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return O&&V.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const V={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return H.b.Clone((()=>new S(this._texture?this._texture.url:null,this.va(),V)),this)}serialize(){var V;const O=this.name;S.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const Z=super.serialize(S._SerializeInternalTextureUniqueId);if(!Z)return null;var d;((S.SerializeBuffers||S.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(Z.base64String=this._buffer,Z.name=Z.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?Z.base64String="data:image/png;base64,"+(0,W.k)(this._buffer):(S.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(Z.base64String=!this._engine||this._engine._features.supportSyncTextureRead?Q(this):b(this))),Z.invertY=this._invertY,Z.samplingMode=this.samplingMode,Z._creationFlags=this._creationFlags,Z._useSRGBBuffer=this._useSRGBBuffer,S._SerializeInternalTextureUniqueId)&&(Z.internalTextureUniqueId=null===(d=this._texture)||void 0===d?void 0:d.uniqueId);return Z.internalTextureLabel=null===(V=this._texture)||void 0===V?void 0:V.label,Z.noMipmap=this._noMipmap,this.name=O,Z}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(V,O,Z){if(V.customType){const d=M.b.Instantiate(V.customType).Parse(V,O,Z);return V.samplingMode&&d.updateSamplingMode&&d._samplingMode&&d._samplingMode!==V.samplingMode&&d.updateSamplingMode(V.samplingMode),d}if(V.isCube&&!V.isRenderTarget)return S._CubeTextureParser(V,O,Z);const d=void 0!==V.internalTextureUniqueId;if(!V.name&&!V.isRenderTarget&&!d)return null;let p;if(d){const Z=O.getEngine().getLoadedTexturesCache();for(const O of Z)if(O.uniqueId===V.internalTextureUniqueId){p=O;break}}const r=O=>{if(O&&O._texture&&(O._texture._cachedWrapU=null,O._texture._cachedWrapV=null,O._texture._cachedWrapR=null),V.samplingMode){const Z=V.samplingMode;O&&O.samplingMode!==Z&&O.updateSamplingMode(Z)}if(O&&V.animations)for(let Z=0;Z<V.animations.length;Z++){const d=V.animations[Z],p=(0,a.c)("BABYLON.Animation");p&&O.animations.push(p.Parse(d))}O&&O._texture&&(d&&!p&&O._texture._setUniqueId(V.internalTextureUniqueId),O._texture.label=V.internalTextureLabel)};return H.b.Parse((()=>{let d=!0;if(V.noMipmap&&(d=!1),V.mirrorPlane){const Z=S._CreateMirror(V.name,V.renderTargetSize,O,d);return Z._waitingRenderList=V.renderList,Z.mirrorPlane=c.c.Cg(V.mirrorPlane),r(Z),Z}if(V.isRenderTarget){let Z=null;if(V.isCube){if(O.reflectionProbes)for(let d=0;d<O.reflectionProbes.length;d++){const Z=O.reflectionProbes[d];if(Z.name===V.name)return Z.cubeTexture}}else Z=S._CreateRenderTargetTexture(V.name,V.renderTargetSize,O,d,V._creationFlags??0),Z._waitingRenderList=V.renderList;return r(Z),Z}if(V.isVideo){const p=S._CreateVideoTexture(Z+(V.url||V.name),Z+(V.src||V.url),O,d,V.invertY,V.samplingMode,V.settings||{});return r(p),p}{let Y;if(V.base64String&&!p)Y=S.CreateFromBase64String(V.base64String,V.base64String,O,!d,V.invertY,V.samplingMode,(()=>{r(Y)}),V._creationFlags??0,V._useSRGBBuffer??!1),Y.name=V.name;else{let m;m=V.name&&(V.name.indexOf("://")>0||V.name.startsWith("data:"))?V.name:Z+V.name,V.url&&(V.url.startsWith("data:")||S.UseSerializedUrlIfAny)&&(m=V.url);const a={noMipmap:!d,invertY:V.invertY,samplingMode:V.samplingMode,X:()=>{r(Y)},internalTexture:p};Y=new S(m,O,a)}return Y}}),V,O)}static CreateFromBase64String(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S.TRILINEAR_SAMPLINGMODE;return new S("data:"+O,Z,d,p,r,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.TRILINEAR_SAMPLINGMODE,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,i=arguments.length>10?arguments[10]:void 0,M=arguments.length>11?arguments[11]:void 0;return"data:"!==V.substring(0,5)&&(V="data:"+V),new S(V,Z,p,r,Y,m,a,O,d,R,void 0,void 0,i,M)}}S.SerializeBuffers=!0,S.ForceSerializeBuffers=!1,S.OnTextureLoadErrorObservable=new r.e,S._SerializeInternalTextureUniqueId=!1,S._CubeTextureParser=(V,O,Z)=>{throw(0,R.c)("CubeTexture")},S._CreateMirror=(V,O,Z,d)=>{throw(0,R.c)("MirrorTexture")},S._CreateRenderTargetTexture=(V,O,Z,d,p)=>{throw(0,R.c)("RenderTargetTexture")},S.NEAREST_SAMPLINGMODE=1,S.NEAREST_NEAREST_MIPLINEAR=8,S.BILINEAR_SAMPLINGMODE=2,S.LINEAR_LINEAR_MIPNEAREST=11,S.TRILINEAR_SAMPLINGMODE=3,S.LINEAR_LINEAR_MIPLINEAR=3,S.NEAREST_NEAREST_MIPNEAREST=4,S.NEAREST_LINEAR_MIPNEAREST=5,S.NEAREST_LINEAR_MIPLINEAR=6,S.NEAREST_LINEAR=7,S.NEAREST_NEAREST=1,S.LINEAR_NEAREST_MIPNEAREST=9,S.LINEAR_NEAREST_MIPLINEAR=10,S.LINEAR_LINEAR=2,S.LINEAR_NEAREST=12,S.EXPLICIT_MODE=0,S.SPHERICAL_MODE=1,S.PLANAR_MODE=2,S.CUBIC_MODE=3,S.PROJECTION_MODE=4,S.SKYBOX_MODE=5,S.INVCUBIC_MODE=6,S.EQUIRECTANGULAR_MODE=7,S.FIXED_EQUIRECTANGULAR_MODE=8,S.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,S.CLAMP_ADDRESSMODE=0,S.WRAP_ADDRESSMODE=1,S.MIRROR_ADDRESSMODE=2,S.UseSerializedUrlIfAny=!1,(0,d.c)([(0,p.K)()],S.prototype,"url",void 0),(0,d.c)([(0,p.K)()],S.prototype,"uOffset",void 0),(0,d.c)([(0,p.K)()],S.prototype,"vOffset",void 0),(0,d.c)([(0,p.K)()],S.prototype,"uScale",void 0),(0,d.c)([(0,p.K)()],S.prototype,"vScale",void 0),(0,d.c)([(0,p.K)()],S.prototype,"uAng",void 0),(0,d.c)([(0,p.K)()],S.prototype,"vAng",void 0),(0,d.c)([(0,p.K)()],S.prototype,"wAng",void 0),(0,d.c)([(0,p.K)()],S.prototype,"uRotationCenter",void 0),(0,d.c)([(0,p.K)()],S.prototype,"vRotationCenter",void 0),(0,d.c)([(0,p.K)()],S.prototype,"wRotationCenter",void 0),(0,d.c)([(0,p.K)()],S.prototype,"homogeneousRotationInUVTransform",void 0),(0,d.c)([(0,p.K)()],S.prototype,"isBlocking",null),(0,a.f)("BABYLON.Texture",S),H.b._TextureParser=S.Parse},11020:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>d});class d{get wrapU(){return this._cachedWrapU}set wrapU(V){this._cachedWrapU=V}get wrapV(){return this._cachedWrapV}set wrapV(V){this._cachedWrapV=V}get wrapR(){return this._cachedWrapR}set wrapR(V){this._cachedWrapR=V}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(V){this._cachedAnisotropicFilteringLevel=V}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(V){this._comparisonFunction=V}get useMipMaps(){return this._useMipMaps}set useMipMaps(V){this._useMipMaps=V}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=V,this._cachedWrapV=O,this._cachedWrapR=Z,this._cachedAnisotropicFilteringLevel=d,this.samplingMode=p,this._comparisonFunction=r,this}compareSampler(V){return this._cachedWrapU===V._cachedWrapU&&this._cachedWrapV===V._cachedWrapV&&this._cachedWrapR===V._cachedWrapR&&this._cachedAnisotropicFilteringLevel===V._cachedAnisotropicFilteringLevel&&this.samplingMode===V.samplingMode&&this._comparisonFunction===V._comparisonFunction&&this._useMipMaps===V._useMipMaps}}},11456:(V,O,Z)=>{"use strict";function d(V){-1===V.indexOf("vClipPlane")&&V.push("vClipPlane"),-1===V.indexOf("vClipPlane2")&&V.push("vClipPlane2"),-1===V.indexOf("vClipPlane3")&&V.push("vClipPlane3"),-1===V.indexOf("vClipPlane4")&&V.push("vClipPlane4"),-1===V.indexOf("vClipPlane5")&&V.push("vClipPlane5"),-1===V.indexOf("vClipPlane6")&&V.push("vClipPlane6")}function p(V,O,Z){const d=!!(V.clipPlane??O.clipPlane),p=!!(V.clipPlane2??O.clipPlane2),r=!!(V.clipPlane3??O.clipPlane3),Y=!!(V.clipPlane4??O.clipPlane4),m=!!(V.clipPlane5??O.clipPlane5),a=!!(V.clipPlane6??O.clipPlane6);d&&Z.push("#define CLIPPLANE"),p&&Z.push("#define CLIPPLANE2"),r&&Z.push("#define CLIPPLANE3"),Y&&Z.push("#define CLIPPLANE4"),m&&Z.push("#define CLIPPLANE5"),a&&Z.push("#define CLIPPLANE6")}function r(V,O,Z){let d=!1;const p=!!(V.clipPlane??O.clipPlane),r=!!(V.clipPlane2??O.clipPlane2),Y=!!(V.clipPlane3??O.clipPlane3),m=!!(V.clipPlane4??O.clipPlane4),a=!!(V.clipPlane5??O.clipPlane5),R=!!(V.clipPlane6??O.clipPlane6);return Z.CLIPPLANE!==p&&(Z.CLIPPLANE=p,d=!0),Z.CLIPPLANE2!==r&&(Z.CLIPPLANE2=r,d=!0),Z.CLIPPLANE3!==Y&&(Z.CLIPPLANE3=Y,d=!0),Z.CLIPPLANE4!==m&&(Z.CLIPPLANE4=m,d=!0),Z.CLIPPLANE5!==a&&(Z.CLIPPLANE5=a,d=!0),Z.CLIPPLANE6!==R&&(Z.CLIPPLANE6=R,d=!0),d}function Y(V,O,Z){let d=O.clipPlane??Z.clipPlane;m(V,"vClipPlane",d),d=O.clipPlane2??Z.clipPlane2,m(V,"vClipPlane2",d),d=O.clipPlane3??Z.clipPlane3,m(V,"vClipPlane3",d),d=O.clipPlane4??Z.clipPlane4,m(V,"vClipPlane4",d),d=O.clipPlane5??Z.clipPlane5,m(V,"vClipPlane5",d),d=O.clipPlane6??Z.clipPlane6,m(V,"vClipPlane6",d)}function m(V,O,Z){Z&&V.setFloat4(O,Z.ab.x,Z.ab.y,Z.ab.z,Z.d)}Z.d(O,{c:()=>d,g:()=>Y,i:()=>r,l:()=>p})},11291:(V,O,Z)=>{"use strict";function d(V){V.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}Z.d(O,{d:()=>d})},11681:(V,O,Z)=>{"use strict";function d(V){return void 0===V.getPipelineContext}Z.d(O,{e:()=>d})},11441:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{static GetEffect(V){return void 0===V.getPipelineContext?V.effect:V}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=V.createDrawContext(),O&&(this.materialContext=V.createMaterialContext())}setEffect(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var d;(this.effect=V,void 0!==O&&(this.defines=O),Z)&&(null===(d=this.drawContext)||void 0===d||d.reset())}dispose(){var V;null===(V=this.drawContext)||void 0===V||V.dispose()}}},10996:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>M,d:()=>W,g:()=>R,i:()=>i});var d=Z(10906),p=Z(11001),r=Z(10991),Y=Z(10914),m=Z(10965),a=Z(10970);function R(V,O){return(0,p.z)(O).cachedPipelines[V]}function i(V){const O=V._name,Z=V.context;if(O&&Z){const V=(0,p.z)(Z),d=V.cachedPipelines[O];null===d||void 0===d||d.dispose(),delete V.cachedPipelines[O]}}function M(V,O,Z,p,r,Y,a){let R,i;const M=(0,d.n)()?null===Y||void 0===Y?void 0:Y.getHostDocument():null;R="string"===typeof O?O:O.vertexSource?"source:"+O.vertexSource:O.vertexElement?(null===M||void 0===M?void 0:M.getElementById(O.vertexElement))||O.vertexElement:O.vertex||O,i="string"===typeof O?O:O.fragmentSource?"source:"+O.fragmentSource:O.fragmentElement?(null===M||void 0===M?void 0:M.getElementById(O.fragmentElement))||O.fragmentElement:O.fragment||O;const W=[void 0,void 0],F=()=>{if(W[0]&&W[1]){V.isFragment=!0;const[d,R]=W;(0,m.i)(R,V,((Y,R)=>{a&&(a._fragmentSourceCodeBeforeMigration=R),Z&&(Y=Z("fragment",Y));const i=(0,m.d)(d,Y,V);V=null;const M=function(V,O,Z,d){if(Z){return{vertexSourceCode:(1===d?"//":"")+"#define SHADER_NAME vertex:"+(Z.vertexElement||Z.vertex||Z.spectorName||Z)+"\n"+V,fragmentSourceCode:(1===d?"//":"")+"#define SHADER_NAME fragment:"+(Z.fragmentElement||Z.fragment||Z.spectorName||Z)+"\n"+O}}return{vertexSourceCode:V,fragmentSourceCode:O}}(i.vertexCode,i.fragmentCode,O,r);null===p||void 0===p||p(M.vertexSourceCode,M.fragmentSourceCode)}),Y)}};c(R,"Vertex","",(O=>{(0,m.e)(V),(0,m.i)(O,V,((V,d)=>{a&&(a._rawVertexSourceCode=O,a._vertexSourceCodeBeforeMigration=d),Z&&(V=Z("vertex",V)),W[0]=V,F()}),Y)}),r),c(i,"Fragment","Pixel",(V=>{a&&(a._rawFragmentSourceCode=V),W[1]=V,F()}),r)}function c(V,O,Z,p,Y,m){if("undefined"!==typeof HTMLElement&&V instanceof HTMLElement){return void p((0,d.c)(V))}if("source:"===V.substring(0,7))return void p(V.substring(7));if("base64:"===V.substring(0,7)){return void p(window.atob(V.substring(7)))}const R=r.d.GetShadersStore(Y);if(R[V+O+"Shader"])return void p(R[V+O+"Shader"]);if(Z&&R[V+Z+"Shader"])return void p(R[V+Z+"Shader"]);let i;if(i="."===V[0]||"/"===V[0]||V.indexOf("http")>-1?V:r.d.GetShadersRepository(Y)+V,!(m=m||a.j))throw new Error("loadFileInjection is not defined");m(i+"."+O.toLowerCase()+".fx",p)}const W=(V,O,Z,d)=>{try{const r=V.existingPipelineContext||O(V.shaderProcessingContext);if(r._name=V.name,V.name&&V.context){(0,p.z)(V.context).cachedPipelines[V.name]=r}return Z(r,V.vertex,V.fragment,!!V.createAsRaw,"","",V.rebuildRebind,V.defines,V.transformFeedbackVaryings,"",(()=>{d(r,(()=>{var O;null===(O=V.onRenderingStateCompiled)||void 0===O||O.call(V,r)}))})),r}catch(r){throw Y.b.Error("Error compiling effect"),r}}},10986:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>m});var d=Z(10902),p=Z(10914),r=Z(10991),Y=Z(10996);class m{static get ShadersRepository(){return r.d.ShadersRepository}static set ShadersRepository(V){r.d.ShadersRepository=V}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new d.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9?arguments[9]:void 0,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,Q=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new d.e,this.onErrorObservable=new d.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=V,this._key=W;const b=this._key.replace(/\r/g,"").replace(/\n/g,"|");let U;if(O.attributes){const V=O;if(this._engine=Z,this._attributesNames=V.attributes,this._uniformsNames=V.uniformsNames.concat(V.samplers),this._samplerList=V.samplers.slice(),this.defines=V.defines,this.onError=V.onError,this.onCompiled=V.onCompiled,this._fallbacks=V.fallbacks,this._indexParameters=V.indexParameters,this._transformFeedbackVaryings=V.transformFeedbackVaryings||null,this._multiTarget=!!V.multiTarget,this._shaderLanguage=V.shaderLanguage??0,V.uniformBuffersNames){this._uniformBuffersNamesList=V.uniformBuffersNames.slice();for(let O=0;O<V.uniformBuffersNames.length;O++)this._uniformBuffersNames[V.uniformBuffersNames[O]]=O}this._processFinalCode=V.processFinalCode??null,this._processCodeAfterIncludes=V.processCodeAfterIncludes??void 0,U=V.existingPipelineContext}else this._engine=r,this.defines=null==a?"":a,this._uniformsNames=Z.concat(p),this._samplerList=p?p.slice():[],this._attributesNames=O,this._uniformBuffersNamesList=[],this._shaderLanguage=F,this.onError=M,this.onCompiled=i,this._indexParameters=c,this._fallbacks=R;"WEBGL2"===this._engine.shaderPlatformName&&(U=(0,Y.g)(b,this._engine._gl)??U),this._attributeLocationByName={},this.uniqueId=m._UniqueIdSeed++,U?(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,Q)}async _processShaderCodeAsync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0;d&&await d(),this._processingContext=Z||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const p={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:V??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:r.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:r.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Y.c)(p,this.name,this._processFinalCode,((V,Z)=>{this._vertexSourceCode=V,this._fragmentSourceCode=Z,this._prepareEffect(O)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(V){return this._attributes[V]}getAttributeLocationByName(V){return this._attributeLocationByName[V]}getAttributesCount(){return this._attributes.length}getUniformIndex(V){return this._uniformsNames.indexOf(V)}getUniform(V){return this._uniforms[V]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(V){this.isReady()?V(this):(this.onCompileObservable.add((O=>{V(O)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(V){try{if(this._isReadyInternal())return}catch(O){return void this._processCompilationErrors(O,V)}this._isDisposed||setTimeout((()=>{this._checkIsReady(V)}),16)}get vertexSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(V,O,Z,d){this._isReady=!1,this._vertexSourceCodeOverride=V,this._fragmentSourceCodeOverride=O,this.onError=(V,O)=>{d&&d(O)},this.onCompiled=()=>{var V,O;const d=this.getEngine().scenes;if(d)for(let Z=0;Z<d.length;Z++)d[Z].markAllMaterialsAsDirty(63);null===(V=(O=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===V||V.call(O,Z)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(V){if(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let O=0;O<this._attributesNames.length;O++){const V=this._attributesNames[O];this._attributeLocationByName[V]=this._attributes[O]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),m.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this._pipelineContext;this._isReady=!1;try{const Z=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),d=Z?null:this.defines,p=Z?this._vertexSourceCodeOverride:this._vertexSourceCode,r=Z?this._fragmentSourceCodeOverride:this._fragmentSourceCode,m=this._engine;this._pipelineContext=(0,Y.d)({existingPipelineContext:V?O:null,vertex:p,fragment:r,context:"WEBGL2"===m.shaderPlatformName?m._gl:void 0,rebuildRebind:(V,O,Z,d)=>this._rebuildProgram(V,O,Z,d),defines:d,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Z,parallelShaderCompile:m._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Z=>{O&&!V&&this._engine._deletePipelineContext(O),Z&&this._onRenderingStateCompiled(Z)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(O)}catch(Z){this._processCompilationErrors(Z,O)}}_getShaderCodeAndErrorLine(V,O,Z){const d=Z?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let p=null;if(O&&V){const r=O.match(d);if(r&&2===r.length){const O=parseInt(r[1]),d=V.split("\n",-1);d.length>=O&&(p=`Offending line [${O}] in ${Z?"fragment":"vertex"} code: ${d[O-1]}`)}}return[V,p]}_processCompilationErrors(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=V.message;const Z=this._attributesNames,d=this._fallbacks;if(p.b.Error("Unable to compile effect:"),p.b.Error("Uniforms: "+this._uniformsNames.map((function(V){return" "+V}))),p.b.Error("Attributes: "+Z.map((function(V){return" "+V}))),p.b.Error("Defines:\n"+this.defines),m.LogShaderCodeOnCompilationError){var r,Y;let V=null,O=null,Z=null;var a;if(null!==(r=this._pipelineContext)&&void 0!==r&&r._getVertexShaderCode()&&([Z,V]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Z&&(p.b.Error("Vertex code:"),p.b.Error(Z))),null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getFragmentShaderCode())[Z,O]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),Z&&(p.b.Error("Fragment code:"),p.b.Error(Z));V&&p.b.Error(V),O&&p.b.Error(O)}p.b.Error("Error: "+this._compilationError);const R=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};O&&(this._pipelineContext=O,this._isReady=!0,R()),d?(this._pipelineContext=null,d.hasMoreFallbacks?(this._allFallbacksProcessed=!1,p.b.Error("Trying next fallback."),this.defines=d.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,R(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,O||R())}get isSupported(){return""===this._compilationError}_bindTexture(V,O){this._engine._bindTexture(this._samplers[V],O,V)}setTexture(V,O){this._engine.setTexture(this._samplers[V],this._uniforms[V],O,V)}setTextureArray(V,O){const Z=V+"Ex";if(-1===this._samplerList.indexOf(Z+"0")){const d=this._samplerList.indexOf(V);for(let V=1;V<O.length;V++){const O=Z+(V-1).toString();this._samplerList.splice(d+V,0,O)}let p=0;for(const V of this._samplerList)this._samplers[V]=p,p+=1}this._engine.setTextureArray(this._samplers[V],this._uniforms[V],O,V)}bindUniformBuffer(V,O){const Z=this._uniformBuffersNames[O];void 0===Z||m._BaseCache[Z]===V&&this._engine._features.useUBOBindingCache||(m._BaseCache[Z]=V,this._engine.bindUniformBufferBase(V,Z,O))}bindUniformBlock(V,O){this._engine.bindUniformBlock(this._pipelineContext,V,O)}setInt(V,O){return this._pipelineContext.setInt(V,O),this}setInt2(V,O,Z){return this._pipelineContext.setInt2(V,O,Z),this}setInt3(V,O,Z,d){return this._pipelineContext.setInt3(V,O,Z,d),this}setInt4(V,O,Z,d,p){return this._pipelineContext.setInt4(V,O,Z,d,p),this}setIntArray(V,O){return this._pipelineContext.setIntArray(V,O),this}setIntArray2(V,O){return this._pipelineContext.setIntArray2(V,O),this}setIntArray3(V,O){return this._pipelineContext.setIntArray3(V,O),this}setIntArray4(V,O){return this._pipelineContext.setIntArray4(V,O),this}setUInt(V,O){return this._pipelineContext.setUInt(V,O),this}setUInt2(V,O,Z){return this._pipelineContext.setUInt2(V,O,Z),this}setUInt3(V,O,Z,d){return this._pipelineContext.setUInt3(V,O,Z,d),this}setUInt4(V,O,Z,d,p){return this._pipelineContext.setUInt4(V,O,Z,d,p),this}setUIntArray(V,O){return this._pipelineContext.setUIntArray(V,O),this}setUIntArray2(V,O){return this._pipelineContext.setUIntArray2(V,O),this}setUIntArray3(V,O){return this._pipelineContext.setUIntArray3(V,O),this}setUIntArray4(V,O){return this._pipelineContext.setUIntArray4(V,O),this}setFloatArray(V,O){return this._pipelineContext.setArray(V,O),this}setFloatArray2(V,O){return this._pipelineContext.setArray2(V,O),this}setFloatArray3(V,O){return this._pipelineContext.setArray3(V,O),this}setFloatArray4(V,O){return this._pipelineContext.setArray4(V,O),this}setArray(V,O){return this._pipelineContext.setArray(V,O),this}setArray2(V,O){return this._pipelineContext.setArray2(V,O),this}setArray3(V,O){return this._pipelineContext.setArray3(V,O),this}setArray4(V,O){return this._pipelineContext.setArray4(V,O),this}setMatrices(V,O){return this._pipelineContext.setMatrices(V,O),this}setMatrix(V,O){return this._pipelineContext.setMatrix(V,O),this}setMatrix3x3(V,O){return this._pipelineContext.setMatrix3x3(V,O),this}setMatrix2x2(V,O){return this._pipelineContext.setMatrix2x2(V,O),this}setFloat(V,O){return this._pipelineContext.setFloat(V,O),this}setBool(V,O){return this._pipelineContext.setInt(V,O?1:0),this}setVector2(V,O){return this._pipelineContext.setVector2(V,O),this}setFloat2(V,O,Z){return this._pipelineContext.setFloat2(V,O,Z),this}setVector3(V,O){return this._pipelineContext.setVector3(V,O),this}setFloat3(V,O,Z,d){return this._pipelineContext.setFloat3(V,O,Z,d),this}setVector4(V,O){return this._pipelineContext.setVector4(V,O),this}setQuaternion(V,O){return this._pipelineContext.setQuaternion(V,O),this}setFloat4(V,O,Z,d,p){return this._pipelineContext.setFloat4(V,O,Z,d,p),this}setColor3(V,O){return this._pipelineContext.setColor3(V,O),this}setColor4(V,O,Z){return this._pipelineContext.setColor4(V,O,Z),this}setDirectColor4(V,O){return this._pipelineContext.setDirectColor4(V,O),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,Y.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;O&&(r.d.GetShadersStore(d)[`${V}PixelShader`]=O),Z&&(r.d.GetShadersStore(d)[`${V}VertexShader`]=Z)}static ResetCache(){m._BaseCache={}}}m.LogShaderCodeOnCompilationError=!0,m.AutomaticallyClearCodeCache=!1,m._UniqueIdSeed=0,m._BaseCache={},m.ShadersStore=r.d.ShadersStore,m.IncludesShadersStore=r.d.IncludesShadersStore},11486:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this.Kk=null}unBindMesh(){this.Kk=null}addFallback(V,O){this._defines[V]||(V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V),this._defines[V]=new Array),this._defines[V].push(O)}addCPUSkinningFallback(V,O){this.Kk=O,V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(V,O){if(this.Kk&&this.Kk.computeBonesUsingShaders&&this.Kk.numBoneInfluencers>0){this.Kk.computeBonesUsingShaders=!1,V=V.replace("#define NUM_BONE_INFLUENCERS "+this.Kk.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),O._bonesComputationForcedToCPU=!0;const Z=this.Kk.va();for(let V=0;V<Z.meshes.length;V++){const d=Z.meshes[V];if(d.material){if(d.computeBonesUsingShaders&&0!==d.numBoneInfluencers)if(d.material.getEffect()===O)d.computeBonesUsingShaders=!1;else if(d.Ef)for(const V of d.Ef){if(V.effect===O){d.computeBonesUsingShaders=!1;break}}}else!this.Kk.material&&d.computeBonesUsingShaders&&d.numBoneInfluencers>0&&(d.computeBonesUsingShaders=!1)}}else{const O=this._defines[this._currentRank];if(O)for(let Z=0;Z<O.length;Z++)V=V.replace("#define "+O[Z],"");this._currentRank++}return V}}},11753:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>R,g:()=>i});var d=Z(11316),p=Z(11526),r=Z(10902),Y=Z(10986),m=Z(11441);Z(11762);const a={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class R{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;this._fullscreenViewport=new p.c(0,0,1,1);const Z=O.xa??a.xa,r=O.indices??a.indices;this.bd=V,this._vertexBuffers={[d.e.PositionKind]:new d.e(V,Z,d.e.PositionKind,!1,!1,2)},this._indexBuffer=V.createIndexBuffer(r),this._onContextRestoredObserver=V.onContextRestoredObservable.add((()=>{this._indexBuffer=V.createIndexBuffer(r);for(const V in this._vertexBuffers){this._vertexBuffers[V]._rebuild()}}))}setViewport(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.bd.setViewport(V)}bindBuffers(V){this.bd.bindBuffers(this._vertexBuffers,this._indexBuffer,V)}applyEffectWrapper(V){this.bd.setState(!0),this.bd.depthCullingState.depthTest=!1,this.bd.stencilState.stencilTest=!1,this.bd.enableEffect(V.drawWrapper),this.bindBuffers(V.effect),V.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.bd.depthCullingState.depthTest,this._savedStateStencilTest=this.bd.stencilState.stencilTest}restoreStates(){this.bd.depthCullingState.depthTest=this._savedStateDepthTest,this.bd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.bd.drawElementsType(0,0,6)}_isRenderTargetTexture(V){return void 0!==V.renderTarget}render(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!V.effect.isReady())return;this.saveStates(),this.setViewport();const Z=null===O?null:this._isRenderTargetTexture(O)?O.renderTarget:O;Z&&this.bd.bindFramebuffer(Z),this.applyEffectWrapper(V),this.draw(),Z&&this.bd.unBindFramebuffer(Z),this.restoreStates()}dispose(){const V=this._vertexBuffers[d.e.PositionKind];V&&(V.dispose(),delete this._vertexBuffers[d.e.PositionKind]),this._indexBuffer&&this.bd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.bd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class i{static RegisterShaderCodeProcessing(V,O){O?i._CustomShaderCodeProcessing[V??""]=O:delete i._CustomShaderCodeProcessing[V??""]}static _GetShaderCodeProcessing(V){return i._CustomShaderCodeProcessing[V]??i._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(V){this.options.name=V}isReady(){var V;return(null===(V=this._drawWrapper.effect)||void 0===V?void 0:V.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(V){this._drawWrapper.effect=V}constructor(V){this.alphaMode=0,this.onEffectCreatedObservable=new r.e(void 0,!0),this.onApplyObservable=new r.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...V,name:V.name||"effectWrapper",bd:V.bd,uniforms:V.uniforms||V.uniformNames||[],uniformNames:void 0,samplers:V.samplers||V.samplerNames||[],samplerNames:void 0,attributeNames:V.attributeNames||["position"],uniformBuffers:V.uniformBuffers||[],defines:V.defines||"",useShaderStore:V.useShaderStore||!1,vertexUrl:V.vertexUrl||V.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:V.fragmentShader||"pass",indexParameters:V.indexParameters,blockCompilation:V.blockCompilation||!1,shaderLanguage:V.shaderLanguage||0,onCompiled:V.onCompiled||void 0,extraInitializations:V.extraInitializations||void 0,extraInitializationsAsync:V.extraInitializationsAsync||void 0,useAsPostProcess:V.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),V.vertexUrl||V.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.bd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new m.d(this.options.bd),this._webGPUReady=1===this.options.shaderLanguage;const O=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,O,this.options.extraInitializations)}_gatherImports(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(V&&this._webGPUReady?O.push(Promise.all([Z.e(37).then(Z.bind(Z,13392))])):O.push(Promise.all([Promise.resolve().then(Z.bind(Z,11762))])))}_postConstructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,d&&this._importPromises.push(...d);const p=this.options.bd.isWebGPU&&!i.ForceGLSL;this._gatherImports(p,this._importPromises),void 0!==Z&&Z(p,this._importPromises),p&&this._webGPUReady&&(this.options.shaderLanguage=1),V||this.updateEffect(O)}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;const R=i._GetShaderCodeProcessing(this.name);if(null!==R&&void 0!==R&&R.defineCustomBindings){var M,c;const d=(null===(M=O)||void 0===M?void 0:M.slice())??[];d.push(...this.options.uniforms);const p=(null===(c=Z)||void 0===c?void 0:c.slice())??[];p.push(...this.options.samplers),V=R.defineCustomBindings(this.name,V,d,p),O=d,Z=p}this.options.defines=V||"";const W=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let F;F=this.options.extraInitializationsAsync?async()=>{null===W||void 0===W||W(),await this.options.extraInitializationsAsync}:W,this.options.useShaderStore?this._drawWrapper.effect=this.options.bd.createEffect({vertex:m??this._shaderPath.vertex,fragment:a??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:O||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:Z||this.options.samplers,defines:null!==V?V:"",fallbacks:null,onCompiled:p??this.options.onCompiled,onError:r??null,indexParameters:d||this.options.indexParameters,processCodeAfterIncludes:null!==R&&void 0!==R&&R.processCodeAfterIncludes?(V,O)=>R.processCodeAfterIncludes(this.name,V,O):null,processFinalCode:null!==R&&void 0!==R&&R.processFinalCode?(V,O)=>R.processFinalCode(this.name,V,O):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:F},this.options.bd):this._drawWrapper.effect=new Y.c(this._shaderPath,this.options.attributeNames,O||this.options.uniforms,Z||this.options.samplerNames,this.options.bd,V,void 0,p||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,F),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var V,O;this.options.useAsPostProcess&&(this.options.bd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(V=i._GetShaderCodeProcessing(this.name))||void 0===V||null===(O=V.bindCustomBindings)||void 0===O||O.call(V,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}i.ForceGLSL=!1,i._CustomShaderCodeProcessing={}},11296:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>r,g:()=>p});var d=Z(11291);function p(V,O){O.EXPOSURE&&V.push("exposureLinear"),O.CONTRAST&&V.push("contrast"),O.COLORGRADING&&V.push("colorTransformSettings"),(O.VIGNETTE||O.DITHER)&&V.push("vInverseScreenSize"),O.VIGNETTE&&(V.push("vignetteSettings1"),V.push("vignetteSettings2")),O.COLORCURVES&&(0,d.d)(V),O.DITHER&&V.push("ditherIntensity")}function r(V,O){O.COLORGRADING&&V.push("txColorTransform")}},11265:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>W});var d=Z(11210),p=Z(11216),r=Z(10902),Y=Z(11274),m=Z(11283),a=Z(11291);class R{constructor(){this._dirty=!0,this._tempColor=new Y.f(0,0,0,0),this._globalCurve=new Y.f(0,0,0,0),this._highlightsCurve=new Y.f(0,0,0,0),this._midtonesCurve=new Y.f(0,0,0,0),this._shadowsCurve=new Y.f(0,0,0,0),this._positiveCurve=new Y.f(0,0,0,0),this._negativeCurve=new Y.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(V){this._globalHue=V,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(V){this._globalDensity=V,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(V){this._globalSaturation=V,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(V){this._globalExposure=V,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(V){this._highlightsHue=V,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(V){this._highlightsDensity=V,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(V){this._highlightsSaturation=V,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(V){this._highlightsExposure=V,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(V){this._midtonesHue=V,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(V){this._midtonesDensity=V,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(V){this._midtonesSaturation=V,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(V){this._midtonesExposure=V,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(V){this._shadowsHue=V,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(V){this._shadowsDensity=V,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(V){this._shadowsSaturation=V,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(V){this._shadowsExposure=V,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";V._dirty&&(V._dirty=!1,V._getColorGradingDataToRef(V._globalHue,V._globalDensity,V._globalSaturation,V._globalExposure,V._globalCurve),V._getColorGradingDataToRef(V._highlightsHue,V._highlightsDensity,V._highlightsSaturation,V._highlightsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._highlightsCurve),V._getColorGradingDataToRef(V._midtonesHue,V._midtonesDensity,V._midtonesSaturation,V._midtonesExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._midtonesCurve),V._getColorGradingDataToRef(V._shadowsHue,V._shadowsDensity,V._shadowsSaturation,V._shadowsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._shadowsCurve),V._highlightsCurve.subtractToRef(V._midtonesCurve,V._positiveCurve),V._midtonesCurve.subtractToRef(V._shadowsCurve,V._negativeCurve)),O&&(O.setFloat4(Z,V._positiveCurve.r,V._positiveCurve.g,V._positiveCurve.b,V._positiveCurve.a),O.setFloat4(d,V._midtonesCurve.r,V._midtonesCurve.g,V._midtonesCurve.b,V._midtonesCurve.a),O.setFloat4(p,V._negativeCurve.r,V._negativeCurve.g,V._negativeCurve.b,V._negativeCurve.a))}_getColorGradingDataToRef(V,O,Z,d,p){null!=V&&(V=R._Clamp(V,0,360),O=R._Clamp(O,-100,100),Z=R._Clamp(Z,-100,100),d=R._Clamp(d,-100,100),O=R._ApplyColorGradingSliderNonlinear(O),O*=.5,d=R._ApplyColorGradingSliderNonlinear(d),O<0&&(O*=-1,V=(V+180)%360),R._FromHSBToRef(V,O,50+.25*d,p),p.scaleToRef(2,p),p.a=1+.01*Z)}static _ApplyColorGradingSliderNonlinear(V){V/=100;let O=Math.abs(V);return O=Math.pow(O,2),V<0&&(O*=-1),O*=100,O}static _FromHSBToRef(V,O,Z,d){let p=R._Clamp(V,0,360);const r=R._Clamp(O/100,0,1),Y=R._Clamp(Z/100,0,1);if(0===r)d.r=Y,d.g=Y,d.b=Y;else{p/=60;const V=Math.floor(p),O=p-V,Z=Y*(1-r),m=Y*(1-r*O),a=Y*(1-r*(1-O));switch(V){case 0:d.r=Y,d.g=a,d.b=Z;break;case 1:d.r=m,d.g=Y,d.b=Z;break;case 2:d.r=Z,d.g=Y,d.b=a;break;case 3:d.r=Z,d.g=m,d.b=Y;break;case 4:d.r=a,d.g=Z,d.b=Y;break;default:d.r=Y,d.g=Z,d.b=m}}d.a=1}static _Clamp(V,O,Z){return Math.min(Math.max(V,O),Z)}clone(){return m.b.Clone((()=>new R),this)}serialize(){return m.b.Serialize(this)}static Parse(V){return m.b.Parse((()=>new R),V,null,null)}}R.PrepareUniforms=a.d,(0,d.c)([(0,p.K)()],R.prototype,"_globalHue",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_globalDensity",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_globalSaturation",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_globalExposure",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_highlightsHue",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_highlightsDensity",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_highlightsSaturation",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_highlightsExposure",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_midtonesHue",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_midtonesDensity",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_midtonesSaturation",void 0),(0,d.c)([(0,p.K)()],R.prototype,"_midtonesExposure",void 0),m.b._ColorCurvesParser=R.Parse;var i=Z(11049),M=Z(11296),c=Z(11041);class W{constructor(){this.colorCurves=new R,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=W.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new Y.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=W.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new r.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(V){this._colorCurvesEnabled!==V&&(this._colorCurvesEnabled=V,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(V){this._colorGradingTexture!==V&&(this._colorGradingTexture=V,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(V){this._colorGradingEnabled!==V&&(this._colorGradingEnabled=V,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(V){this._colorGradingWithGreenDepth!==V&&(this._colorGradingWithGreenDepth=V,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(V){this._colorGradingBGR!==V&&(this._colorGradingBGR=V,this._updateParameters())}get exposure(){return this._exposure}set exposure(V){this._exposure!==V&&(this._exposure=V,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(V){this._toneMappingEnabled!==V&&(this._toneMappingEnabled=V,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(V){this._toneMappingType!==V&&(this._toneMappingType=V,this._updateParameters())}get contrast(){return this._contrast}set contrast(V){this._contrast!==V&&(this._contrast=V,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(V){this.vignetteCenterY=V}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(V){this.vignetteCenterX=V}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(V){this._vignetteBlendMode!==V&&(this._vignetteBlendMode=V,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(V){this._vignetteEnabled!==V&&(this._vignetteEnabled=V,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(V){this._ditheringEnabled!==V&&(this._ditheringEnabled=V,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(V){this._ditheringIntensity!==V&&(this._ditheringIntensity=V,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(V){this._skipFinalColorClamp!==V&&(this._skipFinalColorClamp=V,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(V){this._applyByPostProcess!==V&&(this._applyByPostProcess=V,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(V){this._isEnabled!==V&&(this._isEnabled=V,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(V){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return V.VIGNETTE=!1,V.TONEMAPPING=0,V.CONTRAST=!1,V.EXPOSURE=!1,V.COLORCURVES=!1,V.COLORGRADING=!1,V.COLORGRADING3D=!1,V.DITHER=!1,V.IMAGEPROCESSING=!1,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(V.VIGNETTE=this.vignetteEnabled,V.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===W._VIGNETTEMODE_MULTIPLY,V.VIGNETTEBLENDMODEOPAQUE=!V.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case W.TONEMAPPING_KHR_PBR_NEUTRAL:V.TONEMAPPING=3;break;case W.TONEMAPPING_ACES:V.TONEMAPPING=2;break;default:V.TONEMAPPING=1}else V.TONEMAPPING=0;V.CONTRAST=1!==this.contrast,V.EXPOSURE=1!==this.exposure,V.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,V.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,V.COLORGRADING?V.COLORGRADING3D=this.colorGradingTexture.is3D:V.COLORGRADING3D=!1,V.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,V.SAMPLER3DBGRMAP=this.colorGradingBGR,V.DITHER=this._ditheringEnabled,V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,V.IMAGEPROCESSING=V.VIGNETTE||!!V.TONEMAPPING||V.CONTRAST||V.EXPOSURE||V.COLORCURVES||V.COLORGRADING||V.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(V,O){if(this._colorCurvesEnabled&&this.colorCurves&&R.Bind(this.colorCurves,V),this._vignetteEnabled||this._ditheringEnabled){const Z=1/V.getEngine().getRenderWidth(),d=1/V.getEngine().getRenderHeight();if(V.setFloat2("vInverseScreenSize",Z,d),this._ditheringEnabled&&V.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const p=null!=O?O:d/Z;let r=Math.tan(.5*this.vignetteCameraFov),Y=r*p;const m=Math.sqrt(Y*r);Y=(0,i.o)(Y,m,this.vignetteStretch),r=(0,i.o)(r,m,this.vignetteStretch),V.setFloat4("vignetteSettings1",Y,r,-Y*this.vignetteCenterX,-r*this.vignetteCenterY);const a=-2*this.vignetteWeight;V.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,a)}}if(V.setFloat("exposureLinear",this.exposure),V.setFloat("contrast",this.contrast),this.colorGradingTexture){V.setTexture("txColorTransform",this.colorGradingTexture);const O=this.colorGradingTexture.getSize().height;V.setFloat4("colorTransformSettings",(O-1)/O,.5/O,O,this.colorGradingTexture.level)}}clone(){return m.b.Clone((()=>new W),this)}serialize(){return m.b.Serialize(this)}static Parse(V){const O=m.b.Parse((()=>new W),V,null,null);return void 0!==V.vignetteCentreX&&(O.vignetteCenterX=V.vignetteCentreX),void 0!==V.vignetteCentreY&&(O.vignetteCenterY=V.vignetteCentreY),O}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}W.TONEMAPPING_STANDARD=0,W.TONEMAPPING_ACES=1,W.TONEMAPPING_KHR_PBR_NEUTRAL=2,W.PrepareUniforms=M.g,W.PrepareSamplers=M.c,W._VIGNETTEMODE_MULTIPLY=0,W._VIGNETTEMODE_OPAQUE=1,(0,d.c)([(0,p.g)()],W.prototype,"colorCurves",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_colorCurvesEnabled",void 0),(0,d.c)([(0,p.A)("colorGradingTexture")],W.prototype,"_colorGradingTexture",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_colorGradingEnabled",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_colorGradingWithGreenDepth",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_colorGradingBGR",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_exposure",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_toneMappingEnabled",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_toneMappingType",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_contrast",void 0),(0,d.c)([(0,p.K)()],W.prototype,"vignetteStretch",void 0),(0,d.c)([(0,p.K)()],W.prototype,"vignetteCenterX",void 0),(0,d.c)([(0,p.K)()],W.prototype,"vignetteCenterY",void 0),(0,d.c)([(0,p.K)()],W.prototype,"vignetteWeight",void 0),(0,d.c)([(0,p.o)()],W.prototype,"vignetteColor",void 0),(0,d.c)([(0,p.K)()],W.prototype,"vignetteCameraFov",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_vignetteBlendMode",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_vignetteEnabled",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_ditheringEnabled",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_ditheringIntensity",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_skipFinalColorClamp",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_applyByPostProcess",void 0),(0,d.c)([(0,p.K)()],W.prototype,"_isEnabled",void 0),m.b._ImageProcessingConfigurationParser=W.Parse,(0,c.f)("BABYLON.ImageProcessingConfiguration",W)},11495:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>M});var d=Z(11210),p=Z(11409),r=Z(11216),Y=Z(11481),m=Z(11463),a=Z(11498),R=Z(11448);class i extends m.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class M extends a.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"DetailMap",140,new i,O),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=p.e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,O,Z){return!this._isEnabled||!(V._areTexturesDirty&&O.texturesEnabled&&Z.getCaps().standardDerivatives&&this._texture&&Y.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(V,O){if(this._isEnabled){V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const Z=O.getEngine();V._areTexturesDirty&&(Z.getCaps().standardDerivatives&&this._texture&&Y.e.DetailTextureEnabled&&this._isEnabled?((0,R.D)(this._texture,V,"DETAIL"),V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):V.DETAIL=!1)}else V.DETAIL=!1}bindForSubMesh(V,O){if(!this._isEnabled)return;const Z=this._material.isFrozen;V.useUbo&&Z&&V.isSync||this._texture&&Y.e.DetailTextureEnabled&&(V.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,R.o)(this._texture,V,"detail")),O.texturesEnabled&&this._texture&&Y.e.DetailTextureEnabled&&V.setTexture("detailSampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){var O;V&&(null===(O=this._texture)||void 0===O||O.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(V){V.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,d.c)([(0,r.A)("detailTexture"),(0,r.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,d.c)([(0,r.K)()],M.prototype,"diffuseBlendLevel",void 0),(0,d.c)([(0,r.K)()],M.prototype,"roughnessBlendLevel",void 0),(0,d.c)([(0,r.K)()],M.prototype,"bumpLevel",void 0),(0,d.c)([(0,r.K)(),(0,r.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"normalBlendMethod",void 0),(0,d.c)([(0,r.K)(),(0,r.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0)},11409:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>b});var d=Z(11210),p=Z(11216),r=Z(10900),Y=Z(10902),m=Z(10942),a=Z(11413),R=Z(11305),i=Z(10914),M=Z(11386),c=Z(11441),W=Z(11283);class F{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(V){this._func=V}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef=V}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask=V}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail=V}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail=V}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass=V}get mask(){return this._mask}set mask(V){this._mask=V}get enabled(){return this._enabled}set enabled(V){this._enabled=V}getClassName(){return"MaterialStencilState"}copyTo(V){W.b.Clone((()=>V),this)}serialize(){return W.b.Serialize(this)}parse(V,O,Z){W.b.Parse((()=>this),V,O,Z)}}(0,d.c)([(0,p.K)()],F.prototype,"func",null),(0,d.c)([(0,p.K)()],F.prototype,"funcRef",null),(0,d.c)([(0,p.K)()],F.prototype,"funcMask",null),(0,d.c)([(0,p.K)()],F.prototype,"opStencilFail",null),(0,d.c)([(0,p.K)()],F.prototype,"opDepthFail",null),(0,d.c)([(0,p.K)()],F.prototype,"opStencilDepthPass",null),(0,d.c)([(0,p.K)()],F.prototype,"mask",null),(0,d.c)([(0,p.K)()],F.prototype,"enabled",null);var Q=Z(11448);class b{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(V){if(this._alpha===V)return;const O=this._alpha;this._alpha=V,1!==O&&1!==V||this.sg(b.MiscDirtyFlag+b.PrePassDirtyFlag)}get alpha(){return this._alpha}set Jg(V){this._backFaceCulling!==V&&(this._backFaceCulling=V,this.sg(b.TextureDirtyFlag))}get Jg(){return this._backFaceCulling}set cullBackFaces(V){this._cullBackFaces!==V&&(this._cullBackFaces=V,this.sg(b.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(V){this._blockDirtyMechanism!==V&&(this._blockDirtyMechanism=V,V||this.Ri())}atomicMaterialsUpdate(V){this.blockDirtyMechanism=!0;try{V(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Y.e),this._onBindObservable}set onBind(V){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(V)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Y.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Y.e),this._onEffectCreatedObservable}set alphaMode(V){this._alphaMode!==V&&(this._alphaMode=V,this.sg(b.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(V){this._needDepthPrePass!==V&&(this._needDepthPrePass=V,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.sg(b.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case b.WireFrameFillMode:case b.LineListDrawMode:case b.LineLoopDrawMode:case b.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(V){this.fillMode=V?b.WireFrameFillMode:b.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case b.PointFillMode:case b.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(V){this.fillMode=V?b.PointFillMode:b.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(V){this._fillMode!==V&&(this._fillMode=V,this.sg(b.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){const O=this.va().getEngine().getCaps().fragmentDepthSupported;V&&!O&&i.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=V&&O,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(V){this._drawWrapper=V}constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Xi=new Y.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new F,this._useUBO=!1,this._fillMode=b.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=V;const p=O||m.e.LastCreatedScene;p&&(this._scene=p,this._dirtyCallbacks={},this._forceGLSL=d,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=V||r.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new c.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new R.b(this._scene.getEngine(),void 0,void 0,V),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),Z||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),b.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var V;const O=this.va().getEngine();null===(V=this._uniformBuffer)||void 0===V||V.dispose(),O.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new R.b(O,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new R.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(V){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Ri(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Ri(),this.checkReadyOnlyOnce=!1}isReady(V,O){return!0}isReadyForSubMesh(V,O,Z){const d=O.materialDefines;return!!d&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=d,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(V){return null!==this.sideOrientation?this.sideOrientation:V.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(V){this._transparencyMode!==V&&(this._transparencyMode=V,this._forceAlphaTest=V===b.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===b.MATERIAL_OPAQUE||this._transparencyMode===b.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(V){return V.visibility<1||!this._disableAlphaBlending&&(V.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(V){return!this.needAlphaBlendingForMesh(V)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Ri(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.va().meshes;for(const Z of O)if(Z.Ef)for(const O of Z.Ef)if(O.Ha()===this)for(const Z of O._drawWrappers)Z&&this._materialContext===Z.materialContext&&(Z._wasPreviouslyReady=!1,Z._wasPreviouslyUsingInstances=null,Z._forceRebindOnNextCall=V);V&&this.sg(b.AllDirtyFlag)}_preBind(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.getEngine(),d=(null==O?this.sideOrientation:O)===b.ClockWiseSideOrientation;return Z.enableEffect(V||this._getDrawWrapper()),Z.setState(this.Jg,this.zOffset,!1,d,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),d}bind(V,O){}buildUniformLayout(){const V=this._uniformBuffer;this._eventInfo.ubo=V,this._callbackPluginEventGeneric(8,this._eventInfo),V.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(V,O,Z){const d=Z._drawWrapper;this._eventInfo.subMesh=Z,this._callbackPluginEventBindForSubMesh(this._eventInfo),d._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(V){}bindView(V){this._useUBO?this._needToBindSceneUbo=!0:V.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(V){this._useUBO?this._needToBindSceneUbo=!0:(V.setMatrix("viewProjection",this.va().getTransformMatrix()),V.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(V,O){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(V,O)}_afterBind(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&O&&(this._needToBindSceneUbo=!1,(0,Q.m)(O,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=V?V.visibility:1,this._onBindObservable&&V&&this._onBindObservable.notifyObservers(V),this.disableDepthWrite){const V=this._scene.getEngine();this._cachedDepthWriteState=V.getDepthWrite(),V.setDepthWrite(!1)}if(this.disableColorWrite){const V=this._scene.getEngine();this._cachedColorWriteState=V.getColorWrite(),V.setColorWrite(!1)}if(0!==this.depthFunction){const V=this._scene.getEngine();this._cachedDepthFunctionState=V.getDepthFunction()||0,V.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(V){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=V,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(V){return null}_clonePlugins(V,O){const Z={};if(this._serializePlugins(Z),b._ParsePlugins(Z,V,this._scene,O),this.pluginManager)for(const d of this.pluginManager._plugins){const O=V.pluginManager.getPlugin(d.name);O&&d.copyTo(O)}}getBindedMeshes(){if(this.meshMap){const V=[];for(const O in this.meshMap){const Z=this.meshMap[O];Z&&V.push(Z)}return V}return this._scene.meshes.filter((V=>V.material===this))}forceCompilation(V,O,Z,d){const p={clipPlane:!1,useInstances:!1,...Z},r=this.va(),Y=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const m=()=>{if(!this._scene||!this._scene.getEngine())return;const Z=r.clipPlane;if(p.clipPlane&&(r.clipPlane=new M.c(0,0,0,1)),this._storeEffectOnSubMeshes){let Z=!0,r=null;if(V.Ef){const O=new a.c(0,0,0,0,0,V,void 0,!1,!1);O.materialDefines&&(O.materialDefines._renderId=-1),this.isReadyForSubMesh(V,O,p.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?r=O.effect.getCompilationError():(Z=!1,setTimeout(m,16)))}Z&&(this.allowShaderHotSwapping=Y,r&&d&&d(r),O&&O(this))}else this.isReady()?(this.allowShaderHotSwapping=Y,O&&O(this)):setTimeout(m,16);p.clipPlane&&(r.clipPlane=Z)};m()}forceCompilationAsync(V,O){return new Promise(((Z,d)=>{this.forceCompilation(V,(()=>{Z()}),O,(V=>{d(V)}))}))}sg(V){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(b._DirtyCallbackArray.length=0,V&b.TextureDirtyFlag&&b._DirtyCallbackArray.push(b._TextureDirtyCallBack),V&b.LightDirtyFlag&&b._DirtyCallbackArray.push(b._LightsDirtyCallBack),V&b.FresnelDirtyFlag&&b._DirtyCallbackArray.push(b._FresnelDirtyCallBack),V&b.AttributesDirtyFlag&&b._DirtyCallbackArray.push(b._AttributeDirtyCallBack),V&b.MiscDirtyFlag&&b._DirtyCallbackArray.push(b._MiscDirtyCallBack),V&b.PrePassDirtyFlag&&b._DirtyCallbackArray.push(b._PrePassDirtyCallBack),b._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(b._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const V=this.va().meshes;for(const O of V)if(O.Ef)for(const V of O.Ef)V.Ha()===this&&V.resetDrawCache()}_markAllSubMeshesAsDirty(V){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const O=this.va().meshes;for(const Z of O)if(Z.Ef)for(const O of Z.Ef)if(O.Ha(!1)===this)for(const Z of O._drawWrappers)Z&&Z.defines&&Z.defines.markAllAsDirty&&this._materialContext===Z.materialContext&&V(Z.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const V=this.va().enablePrePassRenderer();V&&V.sg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(b._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(b._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(b._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(b._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(b._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(b._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(b._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(b._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(b._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(b._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const V=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Xi.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(V)}))}}setPrePassRenderer(V){return!1}dispose(V,O,Z){const d=this.va();if(d.stopAnimation(this),d.freeProcessedMaterials(),d.removeMaterial(this),this._eventInfo.forceDisposeTextures=O,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const V=this._parentContainer.materials.indexOf(this);V>-1&&this._parentContainer.materials.splice(V,1),this._parentContainer=null}if(!0!==Z)if(this.meshMap)for(const p in this.meshMap){const O=this.meshMap[p];O&&(O.material=null,this.releaseVertexArrayObject(O,V))}else{const O=d.meshes;for(const Z of O)Z.material!==this||Z.sourceMesh||(Z.material=null,this.releaseVertexArrayObject(Z,V))}this._uniformBuffer.dispose(),V&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Xi.notifyObservers(this),this.Xi.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(V,O){const Z=V.oj;if(Z)if(this._storeEffectOnSubMeshes){if(V.Ef)for(const d of V.Ef)Z._releaseVertexArrayObject(d.effect),O&&d.effect&&d.effect.dispose()}else Z._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const V=W.b.Serialize(this);return V.stencil=this.stencil.serialize(),V.uniqueId=this.uniqueId,this._serializePlugins(V),V}_serializePlugins(V){if(V.plugins={},this.pluginManager)for(const O of this.pluginManager._plugins)V.plugins[O.getClassName()]=O.serialize()}static Parse(V,O,Z){if(V.customType){if("BABYLON.PBRMaterial"===V.customType&&V.overloadedAlbedo&&(V.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return i.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else V.customType="BABYLON.StandardMaterial";const d=r.e.Instantiate(V.customType).Parse(V,O,Z);return d._loadedUniqueId=V.uniqueId,d}static _ParsePlugins(V,O,Z,d){if(V.plugins)for(const m in V.plugins){var p,Y;const a=V.plugins[m];let R=null===(p=O.pluginManager)||void 0===p?void 0:p.getPlugin(a.name);if(!R){const V=r.e.Instantiate("BABYLON."+m);V&&(R=new V(O))}null===(Y=R)||void 0===Y||Y.parse(a,Z,d)}}}b.TriangleFillMode=0,b.WireFrameFillMode=1,b.PointFillMode=2,b.PointListDrawMode=3,b.LineListDrawMode=4,b.LineLoopDrawMode=5,b.LineStripDrawMode=6,b.TriangleStripDrawMode=7,b.TriangleFanDrawMode=8,b.ClockWiseSideOrientation=0,b.CounterClockWiseSideOrientation=1,b.TextureDirtyFlag=1,b.LightDirtyFlag=2,b.FresnelDirtyFlag=4,b.AttributesDirtyFlag=8,b.MiscDirtyFlag=16,b.PrePassDirtyFlag=32,b.AllDirtyFlag=63,b.MATERIAL_OPAQUE=0,b.MATERIAL_ALPHATEST=1,b.MATERIAL_ALPHABLEND=2,b.MATERIAL_ALPHATESTANDBLEND=3,b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,b.MATERIAL_NORMALBLENDMETHOD_RNM=1,b.OnEventObservable=new Y.e,b._AllDirtyCallBack=V=>V.markAllAsDirty(),b._ImageProcessingDirtyCallBack=V=>V.markAsImageProcessingDirty(),b._TextureDirtyCallBack=V=>V.markAsTexturesDirty(),b._FresnelDirtyCallBack=V=>V.markAsFresnelDirty(),b._MiscDirtyCallBack=V=>V.markAsMiscDirty(),b._PrePassDirtyCallBack=V=>V.markAsPrePassDirty(),b._LightsDirtyCallBack=V=>V.markAsLightDirty(),b._AttributeDirtyCallBack=V=>V.markAsAttributesDirty(),b._FresnelAndMiscDirtyCallBack=V=>{b._FresnelDirtyCallBack(V),b._MiscDirtyCallBack(V)},b._TextureAndMiscDirtyCallBack=V=>{b._TextureDirtyCallBack(V),b._MiscDirtyCallBack(V)},b._DirtyCallbackArray=[],b._RunDirtyCallBacks=V=>{for(const O of b._DirtyCallbackArray)O(V)},(0,d.c)([(0,p.K)()],b.prototype,"id",void 0),(0,d.c)([(0,p.K)()],b.prototype,"uniqueId",void 0),(0,d.c)([(0,p.K)()],b.prototype,"name",void 0),(0,d.c)([(0,p.K)()],b.prototype,"metadata",void 0),(0,d.c)([(0,p.K)()],b.prototype,"checkReadyOnEveryCall",void 0),(0,d.c)([(0,p.K)()],b.prototype,"checkReadyOnlyOnce",void 0),(0,d.c)([(0,p.K)()],b.prototype,"state",void 0),(0,d.c)([(0,p.K)("alpha")],b.prototype,"_alpha",void 0),(0,d.c)([(0,p.K)("Jg")],b.prototype,"_backFaceCulling",void 0),(0,d.c)([(0,p.K)("cullBackFaces")],b.prototype,"_cullBackFaces",void 0),(0,d.c)([(0,p.K)()],b.prototype,"sideOrientation",void 0),(0,d.c)([(0,p.K)("alphaMode")],b.prototype,"_alphaMode",void 0),(0,d.c)([(0,p.K)()],b.prototype,"_needDepthPrePass",void 0),(0,d.c)([(0,p.K)()],b.prototype,"disableDepthWrite",void 0),(0,d.c)([(0,p.K)()],b.prototype,"disableColorWrite",void 0),(0,d.c)([(0,p.K)()],b.prototype,"forceDepthWrite",void 0),(0,d.c)([(0,p.K)()],b.prototype,"depthFunction",void 0),(0,d.c)([(0,p.K)()],b.prototype,"separateCullingPass",void 0),(0,d.c)([(0,p.K)("fogEnabled")],b.prototype,"_fogEnabled",void 0),(0,d.c)([(0,p.K)()],b.prototype,"pointSize",void 0),(0,d.c)([(0,p.K)()],b.prototype,"zOffset",void 0),(0,d.c)([(0,p.K)()],b.prototype,"zOffsetUnits",void 0),(0,d.c)([(0,p.K)()],b.prototype,"pointsCloud",null),(0,d.c)([(0,p.K)()],b.prototype,"fillMode",null),(0,d.c)([(0,p.K)()],b.prototype,"useLogarithmicDepth",null),(0,d.c)([(0,p.K)()],b.prototype,"transparencyMode",null)},11463:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});class d{constructor(V){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=V,V)for(const O in V)Object.prototype.hasOwnProperty.call(V,O)&&this._setDefaultValue(O)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||V,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const V of Object.keys(this))"_"!==V[0]&&this._keys.push(V);if(this._externalProperties)for(const V in this._externalProperties)-1===this._keys.indexOf(V)&&this._keys.push(V)}isEqual(V){if(this._keys.length!==V._keys.length)return!1;for(let O=0;O<this._keys.length;O++){const Z=this._keys[O];if(this[Z]!==V[Z])return!1}return!0}cloneTo(V){this._keys.length!==V._keys.length&&(V._keys=this._keys.slice(0));for(let O=0;O<this._keys.length;O++){const Z=this._keys[O];V[Z]=this[Z]}}reset(){this._keys.forEach((V=>this._setDefaultValue(V)))}_setDefaultValue(V){var O,Z,d,p;const r=(null===(O=this._externalProperties)||void 0===O||null===(Z=O[V])||void 0===Z?void 0:Z.type)??typeof this[V],Y=null===(d=this._externalProperties)||void 0===d||null===(p=d[V])||void 0===p?void 0:p.default;switch(r){case"number":this[V]=Y??0;break;case"string":this[V]=Y??"";break;default:this[V]=Y??!1}}toString(){let V="";for(let O=0;O<this._keys.length;O++){const Z=this._keys[O],d=this[Z];switch(typeof d){case"number":case"string":V+="#define "+Z+" "+d+"\n";break;default:d&&(V+="#define "+Z+"\n")}}return V}}},11481:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});var d=Z(10983);class p{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){this._DiffuseTextureEnabled!==V&&(this._DiffuseTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(V){this._DetailTextureEnabled!==V&&(this._DetailTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(V){this._DecalMapEnabled!==V&&(this._DecalMapEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(V){this._AmbientTextureEnabled!==V&&(this._AmbientTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(V){this._OpacityTextureEnabled!==V&&(this._OpacityTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){this._ReflectionTextureEnabled!==V&&(this._ReflectionTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){this._EmissiveTextureEnabled!==V&&(this._EmissiveTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(V){this._SpecularTextureEnabled!==V&&(this._SpecularTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(V){this._BumpTextureEnabled!==V&&(this._BumpTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(V){this._LightmapTextureEnabled!==V&&(this._LightmapTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(V){this._RefractionTextureEnabled!==V&&(this._RefractionTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){this._ColorGradingTextureEnabled!==V&&(this._ColorGradingTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(V){this._FresnelEnabled!==V&&(this._FresnelEnabled=V,d.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(V){this._ClearCoatTextureEnabled!==V&&(this._ClearCoatTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(V){this._ClearCoatBumpTextureEnabled!==V&&(this._ClearCoatBumpTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(V){this._ClearCoatTintTextureEnabled!==V&&(this._ClearCoatTintTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(V){this._SheenTextureEnabled!==V&&(this._SheenTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(V){this._AnisotropicTextureEnabled!==V&&(this._AnisotropicTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(V){this._ThicknessTextureEnabled!==V&&(this._ThicknessTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(V){this._RefractionIntensityTextureEnabled!==V&&(this._RefractionIntensityTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(V){this._TranslucencyIntensityTextureEnabled!==V&&(this._TranslucencyIntensityTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(V){this._TranslucencyColorTextureEnabled!==V&&(this._TranslucencyColorTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(V){this._IridescenceTextureEnabled!==V&&(this._IridescenceTextureEnabled=V,d.e.MarkAllMaterialsAsDirty(1))}}p._DiffuseTextureEnabled=!0,p._DetailTextureEnabled=!0,p._DecalMapEnabled=!0,p._AmbientTextureEnabled=!0,p._OpacityTextureEnabled=!0,p._ReflectionTextureEnabled=!0,p._EmissiveTextureEnabled=!0,p._SpecularTextureEnabled=!0,p._BumpTextureEnabled=!0,p._LightmapTextureEnabled=!0,p._RefractionTextureEnabled=!0,p._ColorGradingTextureEnabled=!0,p._FresnelEnabled=!0,p._ClearCoatTextureEnabled=!0,p._ClearCoatBumpTextureEnabled=!0,p._ClearCoatTintTextureEnabled=!0,p._SheenTextureEnabled=!0,p._AnisotropicTextureEnabled=!0,p._ThicknessTextureEnabled=!0,p._RefractionIntensityTextureEnabled=!0,p._TranslucencyIntensityTextureEnabled=!0,p._TranslucencyColorTextureEnabled=!0,p._IridescenceTextureEnabled=!0},11448:(V,O,Z)=>{"use strict";Z.d(O,{A:()=>l,B:()=>v,D:()=>Q,G:()=>C,K:()=>g,N:()=>n,R:()=>e,U:()=>k,X:()=>c,e:()=>H,f:()=>i,g:()=>z,j:()=>R,l:()=>W,m:()=>F,o:()=>b,q:()=>t,r:()=>U,v:()=>G,w:()=>w,y:()=>M,z:()=>I});var d=Z(10914),p=Z(11274),r=Z(10942),Y=Z(11397),m=Z(11456);const a=p.b.Black();function R(V,O,Z){if(!V||V.LOGARITHMICDEPTH||V.indexOf&&V.indexOf("LOGARITHMICDEPTH")>=0){const V=Z.activeCamera;1===V.mode&&d.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),O.setFloat("logarithmicDepthConstant",2/(Math.log(V.maxZ+1)/Math.LN2))}}function i(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Z&&V.fogEnabled&&(!O||O.applyFog)&&0!==V.fogMode&&(Z.setFloat4("vFogInfos",V.fogMode,V.fogStart,V.fogEnd,V.fogDensity),d?(V.fogColor.toLinearSpaceToRef(a,V.getEngine().useExactSrgbConversions),Z.setColor3("vFogColor",a)):Z.setColor3("vFogColor",V.fogColor))}function M(V,O,Z){const p=Z.NUM_MORPH_INFLUENCERS;if(p>0&&r.e.LastCreatedEngine){const Y=r.e.LastCreatedEngine.getCaps().maxVertexAttribs,m=O.morphTargetManager;if(null!==m&&void 0!==m&&m.isUsingTextureForTargets)return;const a=m&&m.supportsNormals&&Z.NORMAL,R=m&&m.supportsTangents&&Z.TANGENT,i=m&&m.supportsUVs&&Z.UV1;for(let Z=0;Z<p;Z++)V.push("position"+Z),a&&V.push("normal"+Z),R&&V.push("tangent"+Z),i&&V.push("uv_"+Z),V.length>Y&&d.b.Error("Cannot add more vertex attributes for mesh "+O.name)}}function c(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.push("world0"),V.push("world1"),V.push("world2"),V.push("world3"),O&&(V.push("previousWorld0"),V.push("previousWorld1"),V.push("previousWorld2"),V.push("previousWorld3"))}function W(V,O){const Z=V.morphTargetManager;V&&Z&&O.setFloatArray("morphTargetInfluences",Z.influences)}function F(V,O){O.bindToEffect(V,"Scene")}function Q(V,O,Z){O._needUVs=!0,O[Z]=!0,V.optimizeUVAllocation&&V.getTextureMatrix().isIdentityAs3x2()?(O[Z+"DIRECTUV"]=V.coordinatesIndex+1,O["MAINUV"+(V.coordinatesIndex+1)]=!0):O[Z+"DIRECTUV"]=0}function b(V,O,Z){const d=V.getTextureMatrix();O.tj(Z+"Matrix",d)}function U(V,O,Z){Z.BAKED_VERTEX_ANIMATION_TEXTURE&&Z.INSTANCES&&V.push("bakedVertexAnimationSettingsInstanced")}function H(V,O,Z){var d;if(O&&V&&(V.computeBonesUsingShaders&&O._bonesComputationForcedToCPU&&(V.computeBonesUsingShaders=!1),V.useBones&&V.computeBonesUsingShaders&&V.skeleton)){const p=V.skeleton;if(p.isUsingTextureForMatrices&&O.getUniformIndex("boneTextureWidth")>-1){const Z=p.getTransformMatrixTexture(V);O.setTexture("boneSampler",Z),O.setFloat("boneTextureWidth",4*(p.bones.length+1))}else{const r=p.getTransformMatrices(V);r&&(O.setMatrices("mBones",r),Z&&V.va().prePassRenderer&&V.va().prePassRenderer.getIndex(2)&&(Z.previousBones[V.uniqueId]||(Z.previousBones[V.uniqueId]=r.slice()),O.setMatrices("mPreviousBones",Z.previousBones[V.uniqueId]),d=r,Z.previousBones[V.uniqueId].set(d)))}}}function S(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];V._bindLight(O,Z,d,p,r)}function z(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const r=Math.min(O.lightSources.length,p);for(let Y=0;Y<r;Y++){S(O.lightSources[Y],Y,V,Z,"boolean"===typeof d?d:d.SPECULARTERM,O.receiveShadows)}}function G(V,O,Z,d){Z.NUM_BONE_INFLUENCERS>0&&(d.addCPUSkinningFallback(0,O),V.push("matricesIndices"),V.push("matricesWeights"),Z.NUM_BONE_INFLUENCERS>4&&(V.push("matricesIndicesExtra"),V.push("matricesWeightsExtra")))}function w(V,O){(O.INSTANCES||O.THIN_INSTANCES)&&c(V,!!O.PREPASS_VELOCITY),O.INSTANCESCOLOR&&V.push("instanceColor")}function t(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=0;for(let r=0;r<Z&&V["LIGHT"+r];r++)r>0&&(p=d+r,O.addFallback(p,"LIGHT"+r)),V.SHADOWS||(V["SHADOW"+r]&&O.addFallback(d,"SHADOW"+r),V["SHADOWPCF"+r]&&O.addFallback(d,"SHADOWPCF"+r),V["SHADOWPCSS"+r]&&O.addFallback(d,"SHADOWPCSS"+r),V["SHADOWPOISSON"+r]&&O.addFallback(d,"SHADOWPOISSON"+r),V["SHADOWESM"+r]&&O.addFallback(d,"SHADOWESM"+r),V["SHADOWCLOSEESM"+r]&&O.addFallback(d,"SHADOWCLOSEESM"+r));return p++}function C(V,O,Z,d,p,r,Y){let m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Y._areMiscDirty&&(Y.LOGARITHMICDEPTH=Z,Y.POINTSIZE=d,Y.FOG=p&&function(V,O){return O.fogEnabled&&V.applyFog&&0!==O.fogMode}(V,O),Y.NONUNIFORMSCALING=V.nonUniformScaling,Y.ALPHATEST=r,Y.DECAL_AFTER_DETAIL=m)}function v(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z._areLightsDirty)return Z._needNormals;let Y=0;const m={needNormals:Z._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(V.lightsEnabled&&!r)for(const R of O.lightSources)if(A(V,O,R,Y,Z,d,m),Y++,Y===p)break;Z.SPECULARTERM=m.specularEnabled,Z.SHADOWS=m.shadowEnabled;for(let R=Y;R<p;R++)void 0!==Z["LIGHT"+R]&&(Z["LIGHT"+R]=!1,Z["HEMILIGHT"+R]=!1,Z["POINTLIGHT"+R]=!1,Z["DIRLIGHT"+R]=!1,Z["SPOTLIGHT"+R]=!1,Z["SHADOW"+R]=!1,Z["SHADOWCSM"+R]=!1,Z["SHADOWCSMDEBUG"+R]=!1,Z["SHADOWCSMNUM_CASCADES"+R]=!1,Z["SHADOWCSMUSESHADOWMAXZ"+R]=!1,Z["SHADOWCSMNOBLEND"+R]=!1,Z["SHADOWCSM_RIGHTHANDED"+R]=!1,Z["SHADOWPCF"+R]=!1,Z["SHADOWPCSS"+R]=!1,Z["SHADOWPOISSON"+R]=!1,Z["SHADOWESM"+R]=!1,Z["SHADOWCLOSEESM"+R]=!1,Z["SHADOWCUBE"+R]=!1,Z["SHADOWLOWQUALITY"+R]=!1,Z["SHADOWMEDIUMQUALITY"+R]=!1);const a=V.getEngine().getCaps();return void 0===Z.SHADOWFLOAT&&(m.needRebuild=!0),Z.SHADOWFLOAT=m.shadowEnabled&&(a.textureFloatRender&&a.textureFloatLinearFiltering||a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering),Z.LIGHTMAPEXCLUDED=m.lightmapMode,m.needRebuild&&Z.rebuild(),m.needNormals}function A(V,O,Z,d,p,r,m){switch(m.needNormals=!0,void 0===p["LIGHT"+d]&&(m.needRebuild=!0),p["LIGHT"+d]=!0,p["SPOTLIGHT"+d]=!1,p["HEMILIGHT"+d]=!1,p["POINTLIGHT"+d]=!1,p["DIRLIGHT"+d]=!1,Z.prepareLightSpecificDefines(p,d),p["LIGHT_FALLOFF_PHYSICAL"+d]=!1,p["LIGHT_FALLOFF_GLTF"+d]=!1,p["LIGHT_FALLOFF_STANDARD"+d]=!1,Z.falloffType){case Y.d.FALLOFF_GLTF:p["LIGHT_FALLOFF_GLTF"+d]=!0;break;case Y.d.FALLOFF_PHYSICAL:p["LIGHT_FALLOFF_PHYSICAL"+d]=!0;break;case Y.d.FALLOFF_STANDARD:p["LIGHT_FALLOFF_STANDARD"+d]=!0}if(r&&!Z.ah.equalsFloats(0,0,0)&&(m.specularEnabled=!0),p["SHADOW"+d]=!1,p["SHADOWCSM"+d]=!1,p["SHADOWCSMDEBUG"+d]=!1,p["SHADOWCSMNUM_CASCADES"+d]=!1,p["SHADOWCSMUSESHADOWMAXZ"+d]=!1,p["SHADOWCSMNOBLEND"+d]=!1,p["SHADOWCSM_RIGHTHANDED"+d]=!1,p["SHADOWPCF"+d]=!1,p["SHADOWPCSS"+d]=!1,p["SHADOWPOISSON"+d]=!1,p["SHADOWESM"+d]=!1,p["SHADOWCLOSEESM"+d]=!1,p["SHADOWCUBE"+d]=!1,p["SHADOWLOWQUALITY"+d]=!1,p["SHADOWMEDIUMQUALITY"+d]=!1,O&&O.receiveShadows&&V.shadowsEnabled&&Z.shadowEnabled){const O=Z.getShadowGenerator(V.activeCamera)??Z.getShadowGenerator();if(O){const V=O.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(m.shadowEnabled=!0,O.prepareDefines(p,d))}}Z.lightmapMode!=Y.d.LIGHTMAP_DEFAULT?(m.lightmapMode=!0,p["LIGHTMAPEXCLUDED"+d]=!0,p["LIGHTMAPNOSPECULAR"+d]=Z.lightmapMode==Y.d.LIGHTMAP_SHADOWSONLY):(p["LIGHTMAPEXCLUDED"+d]=!1,p["LIGHTMAPNOSPECULAR"+d]=!1)}function l(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=function(V,O){let Z=!1;if(V.activeCamera){const d=O.CAMERA_ORTHOGRAPHIC?1:0,p=O.CAMERA_PERSPECTIVE?1:0,r=1===V.activeCamera.mode?1:0,Y=0===V.activeCamera.mode?1:0;(d^r||p^Y)&&(O.CAMERA_ORTHOGRAPHIC=1===r,O.CAMERA_PERSPECTIVE=1===Y,Z=!0)}return Z}(V,d);!1!==r&&(a=(0,m.i)(Z,V,d)),d.DEPTHPREPASS!==!O.getColorWrite()&&(d.DEPTHPREPASS=!d.DEPTHPREPASS,a=!0),d.INSTANCES!==p&&(d.INSTANCES=p,a=!0),d.THIN_INSTANCES!==Y&&(d.THIN_INSTANCES=Y,a=!0),a&&d.markAsUnprocessed()}function I(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!O._areAttributesDirty&&O._needNormals===O._normals&&O._needUVs===O._uvs)return!1;O._normals=O._needNormals,O._uvs=O._needUVs,O.NORMAL=O._needNormals&&V.isVerticesDataPresent("normal"),O._needNormals&&V.isVerticesDataPresent("tangent")&&(O.TANGENT=!0);for(let m=1;m<=6;++m)O["UV"+m]=!!O._needUVs&&V.isVerticesDataPresent(`uv${1===m?"":m}`);if(Z){const Z=V.useVertexColors&&V.isVerticesDataPresent("color");O.VERTEXCOLOR=Z,O.VERTEXALPHA=V.hasVertexAlpha&&Z&&r}return V.isVerticesDataPresent("instanceColor")&&(V.hasInstances||V.hasThinInstances)&&(O.INSTANCESCOLOR=!0),d&&function(V,O){if(V.useBones&&V.computeBonesUsingShaders&&V.skeleton){O.NUM_BONE_INFLUENCERS=V.numBoneInfluencers;const Z=void 0!==O.BONETEXTURE;if(V.skeleton.isUsingTextureForMatrices&&Z)O.BONETEXTURE=!0;else{O.BonesPerMesh=V.skeleton.bones.length+1,O.BONETEXTURE=!Z&&void 0;const d=V.va().prePassRenderer;if(d&&d.enabled){const Z=-1===d.excludedSkinnedMesh.indexOf(V);O.BONES_VELOCITY_ENABLED=Z}}}else O.NUM_BONE_INFLUENCERS=0,O.BonesPerMesh=0,void 0!==O.BONETEXTURE&&(O.BONETEXTURE=!1)}(V,O),p&&function(V,O){const Z=V.morphTargetManager;Z?(O.MORPHTARGETS_UV=Z.supportsUVs&&O.UV1,O.MORPHTARGETS_TANGENT=Z.supportsTangents&&O.TANGENT,O.MORPHTARGETS_NORMAL=Z.supportsNormals&&O.NORMAL,O.NUM_MORPH_INFLUENCERS=Z.numMaxInfluencers||Z.numInfluencers,O.MORPHTARGETS=O.NUM_MORPH_INFLUENCERS>0,O.MORPHTARGETS_TEXTURE=Z.isUsingTextureForTargets):(O.MORPHTARGETS_UV=!1,O.MORPHTARGETS_TANGENT=!1,O.MORPHTARGETS_NORMAL=!1,O.MORPHTARGETS=!1,O.NUM_MORPH_INFLUENCERS=0)}(V,O),Y&&function(V,O){const Z=V.bakedVertexAnimationManager;O.BAKED_VERTEX_ANIMATION_TEXTURE=!(!Z||!Z.isEnabled)}(V,O),!0}function g(V,O){if(V.activeCamera){const Z=O.MULTIVIEW;O.MULTIVIEW=null!==V.activeCamera.outputRenderTarget&&V.activeCamera.outputRenderTarget.getViewCount()>1,O.MULTIVIEW!=Z&&O.markAsUnprocessed()}}function n(V,O,Z){const d=O.ORDER_INDEPENDENT_TRANSPARENCY,p=O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;O.ORDER_INDEPENDENT_TRANSPARENCY=V.useOrderIndependentTransparency&&Z,O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!V.getEngine().getCaps().textureFloatLinearFiltering,d===O.ORDER_INDEPENDENT_TRANSPARENCY&&p===O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||O.markAsUnprocessed()}function e(V,O,Z){const d=O.PREPASS;if(!O._arePrePassDirty)return;const p=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(V.prePassRenderer&&V.prePassRenderer.enabled&&Z){O.PREPASS=!0,O.SCENE_MRT_COUNT=V.prePassRenderer.mrtCount,O.PREPASS_NORMAL_WORLDSPACE=V.prePassRenderer.generateNormalsInWorldSpace,O.PREPASS_COLOR=!0,O.PREPASS_COLOR_INDEX=0;for(let Z=0;Z<p.length;Z++){const d=V.prePassRenderer.getIndex(p[Z].type);-1!==d?(O[p[Z].define]=!0,O[p[Z].index]=d):O[p[Z].define]=!1}}else{O.PREPASS=!1;for(let V=0;V<p.length;V++)O[p[V].define]=!1}O.PREPASS!=d&&(O.markAsUnprocessed(),O.markAsImageProcessingDirty())}function u(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];p&&p.push("Light"+V),r||(O.push("vLightData"+V,"vLightDiffuse"+V,"vLightSpecular"+V,"vLightDirection"+V,"vLightFalloff"+V,"vLightGround"+V,"lightMatrix"+V,"shadowsInfo"+V,"depthValues"+V),Z.push("shadowTexture"+V),Z.push("depthTexture"+V),O.push("viewFrustumZ"+V,"cascadeBlendFactor"+V,"lightSizeUVCorrection"+V,"depthCorrection"+V,"penumbraDarkness"+V,"frustumLengths"+V),d&&(Z.push("projectionLightTexture"+V),O.push("textureProjectionMatrix"+V)))}function k(V,O,Z){let d,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,r=null;if(V.uniformsNames){const Y=V;d=Y.uniformsNames,r=Y.uniformBuffersNames,O=Y.samplers,Z=Y.defines,p=Y.maxSimultaneousLights||0}else d=V,O||(O=[]);for(let Y=0;Y<p&&Z["LIGHT"+Y];Y++)u(Y,d,O,Z["PROJECTEDLIGHTTEXTURE"+Y],r);Z.NUM_MORPH_INFLUENCERS&&(d.push("morphTargetInfluences"),d.push("morphTargetCount")),Z.BAKED_VERTEX_ANIMATION_TEXTURE&&(d.push("bakedVertexAnimationSettings"),d.push("bakedVertexAnimationTextureSizeInverted"),d.push("bakedVertexAnimationTime"),O.push("bakedVertexAnimationTexture"))}},11503:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d,p=Z(11251);!function(V){V[V.Zero=0]="Zero",V[V.One=1]="One",V[V.MaxViewZ=2]="MaxViewZ"}(d||(d={}));class r{static CreateConfiguration(V){return r._Configurations[V]={defines:{},previousWorldMatrices:{},previousViewProjection:p.c.Zero(),currentViewProjection:p.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},r._Configurations[V]}static DeleteConfiguration(V){delete r._Configurations[V]}static GetConfiguration(V){return r._Configurations[V]}static AddUniformsAndSamplers(V,O){V.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(V,O){for(const Z of O)if(Z.Ef)for(const O of Z.Ef)O._removeDrawWrapper(V)}static PrepareDefines(V,O,Z){if(!Z._arePrePassDirty)return;const d=r._Configurations[V];if(!d)return;Z.PREPASS=!0,Z.PREPASS_COLOR=!1,Z.PREPASS_COLOR_INDEX=-1;let p=0;for(let Y=0;Y<r.GeometryTextureDescriptions.length;Y++){const V=r.GeometryTextureDescriptions[Y],O=V.define,m=V.defineIndex,a=d.defines[m];void 0!==a?(Z[O]=!0,Z[m]=a,p++):(Z[O]=!1,delete Z[m])}Z.SCENE_MRT_COUNT=p,Z.BONES_VELOCITY_ENABLED=O.useBones&&O.computeBonesUsingShaders&&O.skeleton&&!O.skeleton.isUsingTextureForMatrices&&-1===d.excludedSkinnedMesh.indexOf(O)}static Bind(V,O,Z,d){const p=r._Configurations[V];if(p&&(void 0!==p.defines.PREPASS_VELOCITY_INDEX||void 0!==p.defines.PREPASS_VELOCITY_LINEAR_INDEX)){p.previousWorldMatrices[Z.uniqueId]||(p.previousWorldMatrices[Z.uniqueId]=d.clone());const V=Z.va();p.previousViewProjection||(p.previousViewProjection=V.getTransformMatrix().clone(),p.currentViewProjection=V.getTransformMatrix().clone());const r=V.getEngine();if(p.currentViewProjection.updateFlag!==V.getTransformMatrix().updateFlag?(p.lastUpdateFrameId=r.frameId,p.previousViewProjection.p(p.currentViewProjection),p.currentViewProjection.p(V.getTransformMatrix())):p.lastUpdateFrameId!==r.frameId&&(p.lastUpdateFrameId=r.frameId,p.previousViewProjection.p(p.currentViewProjection)),O.setMatrix("previousWorld",p.previousWorldMatrices[Z.uniqueId]),O.setMatrix("previousViewProjection",p.previousViewProjection),p.previousWorldMatrices[Z.uniqueId]=d.clone(),Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton){const V=Z.skeleton;if(!V.isUsingTextureForMatrices||-1===O.getUniformIndex("boneTextureWidth")){const d=V.getTransformMatrices(Z);d&&(p.previousBones[Z.uniqueId]||(p.previousBones[Z.uniqueId]=d.slice()),O.setMatrices("mPreviousBones",p.previousBones[Z.uniqueId]),p.previousBones[Z.uniqueId].set(d))}}}}}r.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],r._Configurations={}},11498:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>U});var d=Z(11210),p=Z(11216),r=Z(11409),Y=Z(10942),m=Z(10965),a=Z(10991);const R=new RegExp("^([gimus]+)!");class i{constructor(V){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=V,this._scene=V.va(),this._engine=this._scene.getEngine()}_addPlugin(V){for(let d=0;d<this._plugins.length;++d)if(this._plugins[d].name===V.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!V.isCompatible(this._material.shaderLanguage))throw`The plugin "${V.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const O=V.getClassName();i._MaterialPluginClassToMainDefine[O]||(i._MaterialPluginClassToMainDefine[O]="MATERIALPLUGIN_"+ ++i._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(V,O)=>this._handlePluginEvent(V,O),this._plugins.push(V),this._plugins.sort(((V,O)=>V.priority-O.priority)),this._codeInjectionPoints={};const Z={};Z[i._MaterialPluginClassToMainDefine[O]]={type:"boolean",default:!0};for(const d of this._plugins)d.collectDefines(Z),this._collectPointNames("vertex",d.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",d.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=Z,!0}_activatePlugin(V){-1===this._activePlugins.indexOf(V)&&(this._activePlugins.push(V),this._activePlugins.sort(((V,O)=>V.priority-O.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),V.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(V),this._activePluginsForExtraEvents.sort(((V,O)=>V.priority-O.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(V){for(let O=0;O<this._plugins.length;++O)if(this._plugins[O].name===V)return this._plugins[O];return null}_handlePluginEventIsReadyForSubMesh(V){let O=!0;for(const Z of this._activePlugins)O=O&&Z.isReadyForSubMesh(V.defines,this._scene,this._engine,V.subMesh);V.isReadyForSubMesh=O}_handlePluginEventPrepareDefinesBeforeAttributes(V){for(const O of this._activePlugins)O.prepareDefinesBeforeAttributes(V.defines,this._scene,V.mesh)}_handlePluginEventPrepareDefines(V){for(const O of this._activePlugins)O.prepareDefines(V.defines,this._scene,V.mesh)}_handlePluginEventHardBindForSubMesh(V){for(const O of this._activePluginsForExtraEvents)O.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventBindForSubMesh(V){for(const O of this._activePlugins)O.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventHasRenderTargetTextures(V){let O=!1;for(const Z of this._activePluginsForExtraEvents)if(O=Z.hasRenderTargetTextures(),O)break;V.hasRenderTargetTextures=O}_handlePluginEventFillRenderTargetTextures(V){for(const O of this._activePluginsForExtraEvents)O.fillRenderTargetTextures(V.renderTargets)}_handlePluginEvent(V,O){switch(V){case 512:{const V=O;for(const O of this._activePlugins)O.getActiveTextures(V.activeTextures);break}case 256:{const V=O;for(const O of this._activePlugins)O.getAnimatables(V.animatables);break}case 1024:{const V=O;let Z=!1;for(const O of this._activePlugins)if(Z=O.hasTexture(V.texture),Z)break;V.hasTexture=Z;break}case 2:{const V=O;for(const O of this._plugins)O.dispose(V.forceDisposeTextures);break}case 4:O.defineNames=this._defineNamesFromPlugins;break;case 128:{const V=O;for(const O of this._activePlugins)V.fallbackRank=O.addFallbacks(V.defines,V.fallbacks,V.fallbackRank),O.getAttributes(V.attributes,this._scene,V.mesh);this._uniformList.length>0&&V.uniforms.push(...this._uniformList),this._samplerList.length>0&&V.samplers.push(...this._samplerList),this._uboList.length>0&&V.uniformBuffersNames.push(...this._uboList),V.customCode=this._injectCustomCode(V,V.customCode);break}case 8:{const V=O;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const Z=1===this._material.shaderLanguage;for(const O of this._plugins){const d=O.getUniforms(this._material.shaderLanguage);if(d){if(d.ubo)for(const O of d.ubo){if(O.size&&O.type){const d=O.arraySize??0;if(V.ubo.addUniform(O.name,O.size,d),Z){let V;switch(O.type){case"mat4":V="mat4x4f";break;case"float":V="f32";break;default:V=`${O.type}f`}this._uboDeclaration+=`uniform ${O.name}: ${V}${d>0?`[${d}]`:""};\n`}else this._uboDeclaration+=`${O.type} ${O.name}${d>0?`[${d}]`:""};\n`}this._uniformList.push(O.name)}d.vertex&&(this._vertexDeclaration+=d.vertex+"\n"),d.fragment&&(this._fragmentDeclaration+=d.fragment+"\n")}O.getSamplers(this._samplerList),O.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(V,O){if(O)for(const Z in O)this._codeInjectionPoints[V]||(this._codeInjectionPoints[V]={}),this._codeInjectionPoints[V][Z]=!0}_injectCustomCode(V,O){return(Z,d)=>{var p;O&&(d=O(Z,d)),this._uboDeclaration&&(d=d.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(d=d.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(d=d.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const r=null===(p=this._codeInjectionPoints)||void 0===p?void 0:p[Z];if(!r)return d;let Y=null;for(let O in r){let p="";for(const d of this._activePlugins){var i;let r=null===(i=d.getCustomCode(Z,this._material.shaderLanguage))||void 0===i?void 0:i[O];if(r){if(d.resolveIncludes){if(null===Y){const O=0;Y={defines:[],indexParameters:V.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.d.GetShadersRepository(O),includesShadersStore:a.d.GetIncludesShadersStore(O),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}Y.isFragment="fragment"===Z,(0,m.k)(r,Y,(V=>r=V))}p+=r+"\n"}}if(p.length>0)if("!"===O.charAt(0)){O=O.substring(1);let V="g";if("!"===O.charAt(0))V="",O=O.substring(1);else{const Z=R.exec(O);Z&&Z.length>=2&&(V=Z[1],O=O.substring(V.length+1))}V.indexOf("g")<0&&(V+="g");const Z=d,r=new RegExp(O,V);let Y=r.exec(Z);for(;null!==Y;){let V=p;for(let O=0;O<Y.length;++O)V=V.replace("$"+O,Y[O]);d=d.replace(Y[0],V),Y=r.exec(Z)}}else{const V="#define "+O;d=d.replace(V,"\n"+p+"\n"+V)}}return d}}}i._MaterialPluginClassToMainDefine={},i._MaterialPluginCounter=0,Y.e.OnEnginesDisposedObservable.add((()=>{F()}));const M=[];let c=!1,W=null;function F(){M.length=0,c=!1,r.e.OnEventObservable.remove(W),W=null}var Q=Z(11283),b=Z(11041);class U{isCompatible(V){return 0===V}_enable(V){V&&this._pluginManager._activatePlugin(this)}constructor(V,O,Z,d){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=V,this.name=O,this.priority=Z,this.resolveIncludes=Y,V.pluginManager||(V.pluginManager=new i(V),V.Xi.add((()=>{V.pluginManager=void 0}))),this._pluginDefineNames=d,this._pluginManager=V.pluginManager,p&&this._pluginManager._addPlugin(this),r&&this._enable(!0),this.markAllDefinesAsDirty=V._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(V,O,Z,d){return!0}hardBindForSubMesh(V,O,Z,d){}bindForSubMesh(V,O,Z,d){}dispose(V){}getCustomCode(V){return null}collectDefines(V){if(this._pluginDefineNames)for(const O of Object.keys(this._pluginDefineNames)){if("_"===O[0])continue;const Z=typeof this._pluginDefineNames[O];V[O]={type:"number"===Z?"number":"string"===Z?"string":"boolean"===Z?"boolean":"object",default:this._pluginDefineNames[O]}}}prepareDefinesBeforeAttributes(V,O,Z){}prepareDefines(V,O,Z){}hasTexture(V){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(V){}getActiveTextures(V){}getAnimatables(V){}addFallbacks(V,O,Z){return Z}getSamplers(V){}getAttributes(V,O,Z){}getUniformBuffersNames(V){}getUniforms(){return{}}copyTo(V){Q.b.Clone((()=>V),this)}serialize(){return Q.b.Serialize(this)}parse(V,O,Z){Q.b.Parse((()=>this),V,O,Z)}}(0,d.c)([(0,p.K)()],U.prototype,"name",void 0),(0,d.c)([(0,p.K)()],U.prototype,"priority",void 0),(0,d.c)([(0,p.K)()],U.prototype,"resolveIncludes",void 0),(0,d.c)([(0,p.K)()],U.prototype,"registerForExtraEvents",void 0),(0,b.f)("BABYLON.MaterialPluginBase",U)},11566:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>Y});var d=Z(11409),p=Z(11243),r=Z(11041);class Y extends d.e{get Gf(){return this._subMaterials}set Gf(V){this._subMaterials=V,this._hookArray(V)}getChildren(){return this.Gf}constructor(V,O){super(V,O,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Gf=[],this._storeEffectOnSubMeshes=!0}_hookArray(V){var O=this;const Z=V.push;V.push=function(){for(var d=arguments.length,p=new Array(d),r=0;r<d;r++)p[r]=arguments[r];const Y=Z.apply(V,p);return O._markAllSubMeshesAsTexturesDirty(),Y};const d=V.splice;V.splice=(O,Z)=>{const p=d.apply(V,[O,Z]);return this._markAllSubMeshesAsTexturesDirty(),p}}getSubMaterial(V){return V<0||V>=this.Gf.length?this.va().defaultMaterial:this.Gf[V]}getActiveTextures(){return super.getActiveTextures().concat(...this.Gf.map((V=>V?V.getActiveTextures():[])))}hasTexture(V){if(super.hasTexture(V))return!0;for(let Z=0;Z<this.Gf.length;Z++){var O;if(null!==(O=this.Gf[Z])&&void 0!==O&&O.hasTexture(V))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(V,O,Z){for(let d=0;d<this.Gf.length;d++){const p=this.Gf[d];if(p){if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(V,O,Z))return!1;continue}if(!p.isReady(V))return!1}}return!0}clone(V,O){const Z=new Y(V,this.va());for(let d=0;d<this.Gf.length;d++){let p=null;const r=this.Gf[d];p=O&&r?r.clone(V+"-"+r.name):this.Gf[d],Z.Gf.push(p)}return Z}serialize(){const V={};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,p.e&&(V.tags=p.e.GetTags(this)),V.materialsUniqueIds=[],V.materials=[];for(let O=0;O<this.Gf.length;O++){const Z=this.Gf[O];Z?(V.materialsUniqueIds.push(Z.uniqueId),V.materials.push(Z.id)):(V.materialsUniqueIds.push(null),V.materials.push(null))}return V}dispose(V,O,Z){const d=this.va();if(!d)return;if(Z)for(let r=0;r<this.Gf.length;r++){const Z=this.Gf[r];Z&&Z.dispose(V,O)}const p=d.multiMaterials.indexOf(this);p>=0&&d.multiMaterials.splice(p,1),super.dispose(V,O)}static ParseMultiMaterial(V,O){const Z=new Y(V.name,O);return Z.id=V.id,Z._loadedUniqueId=V.uniqueId,p.e&&p.e.AddTagsTo(Z,V.tags),V.materialsUniqueIds?Z._waitingSubMaterialsUniqueIds=V.materialsUniqueIds:V.materials.forEach((V=>Z.Gf.push(O.getLastMaterialById(V)))),Z}}(0,r.f)("BABYLON.MultiMaterial",Y)},11403:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(V){V.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(V){}bindForSubMesh(V,O,Z,d,p){if(O.prePassRenderer&&O.prePassRenderer.enabled&&O.prePassRenderer.currentRTisSceneRT&&(-1!==O.prePassRenderer.getIndex(2)||-1!==O.prePassRenderer.getIndex(11))){this.previousWorldMatrices[Z.uniqueId]||(this.previousWorldMatrices[Z.uniqueId]=d.clone()),this.previousViewProjection||(this.previousViewProjection=O.getTransformMatrix().clone(),this.currentViewProjection=O.getTransformMatrix().clone());const p=O.getEngine();this.currentViewProjection.updateFlag!==O.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=p.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(O.getTransformMatrix())):this._lastUpdateFrameId!==p.frameId&&(this._lastUpdateFrameId=p.frameId,this.previousViewProjection.p(this.currentViewProjection)),V.setMatrix("previousWorld",this.previousWorldMatrices[Z.uniqueId]),V.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[Z.uniqueId]=d.clone()}}}},11465:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>r});var d=Z(11251),p=Z(11409);class r extends p.e{constructor(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,O,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new d.c,this._storeEffectOnSubMeshes=Z}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(V,O){return!!V&&(!this._storeEffectOnSubMeshes||(!V.Ef||0===V.Ef.length||this.isReadyForSubMesh(V,V.Ef[0],O)))}_isReadyForSubMesh(V){const O=V.materialDefines;return!(this.checkReadyOnEveryCall||!V.effect||!O||O._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(V){this._activeEffect.setMatrix("world",V)}bindOnlyNormalMatrix(V){this._activeEffect.setMatrix("normalMatrix",V)}bind(V,O){O&&this.bindForSubMesh(V,O,O.Ef[0])}_afterBind(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;super._afterBind(V,O,Z),this.va()._cachedEffect=O,Z?Z._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Z._drawWrapper._forceRebindOnNextCall||V.isCachedMaterialInvalid(this,O,d)}dispose(V,O,Z){this._activeEffect=void 0,super.dispose(V,O,Z)}}},11201:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>A});var d=Z(11210),p=Z(11216),r=Z(11230),Y=Z(11238),m=Z(11251),a=Z(11274),R=Z(11316),i=Z(11403),M=Z(11265),c=Z(11409),W=Z(11463),F=Z(11465),Q=Z(11467),b=Z(11041),U=Z(11481),H=Z(11486),S=Z(11495),z=Z(11456),G=Z(11448),w=Z(11283),t=Z(11503);const C={effect:null,subMesh:null};class v extends W.c{constructor(V){super(V),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(V){const O=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const Z of O)this[Z]=Z===V}}class A extends F.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}get canRenderToMRT(){return!0}constructor(V,O){super(V,O,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||A.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new a.b(0,0,0),this.diffuseColor=new a.b(1,1,1),this.specularColor=new a.b(1,1,1),this.emissiveColor=new a.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new r.h(16),this._worldViewProjectionMatrix=m.c.Zero(),this._globalAmbientColor=new a.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new S.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new i.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),A.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),A.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(A.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(A.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"pb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===c.e.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.uc&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==c.e.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.uc||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(V,O){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const p=O._drawWrapper;if(p.effect&&this.isFrozen&&p._wasPreviouslyReady&&p._wasPreviouslyUsingInstances===d)return!0;O.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),O.materialDefines=new v(this._eventInfo.defineNames));const r=this.va(),Y=O.materialDefines;if(this._isReadyForSubMesh(O))return!0;const m=r.getEngine();Y._needNormals=(0,G.B)(r,V,Y,!0,this._maxSimultaneousLights,this._disableLighting),(0,G.K)(r,Y);const a=this.needAlphaBlendingForMesh(V)&&this.va().useOrderIndependentTransparency;if((0,G.R)(r,Y,this.canRenderToMRT&&!a),(0,G.N)(r,Y,a),t.b.PrepareDefines(m.currentRenderPassId,V,Y),Y._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,Y._needUVs=!1;for(let V=1;V<=6;++V)Y["MAINUV"+V]=!1;if(r.texturesEnabled){if(Y.DIFFUSEDIRECTUV=0,Y.BUMPDIRECTUV=0,Y.AMBIENTDIRECTUV=0,Y.OPACITYDIRECTUV=0,Y.EMISSIVEDIRECTUV=0,Y.SPECULARDIRECTUV=0,Y.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&A.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._diffuseTexture,Y,"DIFFUSE")}else Y.DIFFUSE=!1;if(this._ambientTexture&&A.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._ambientTexture,Y,"AMBIENT")}else Y.AMBIENT=!1;if(this._opacityTexture&&A.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._opacityTexture,Y,"OPACITY"),Y.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else Y.OPACITY=!1;if(this._reflectionTexture&&A.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(Y._needNormals=!0,Y.REFLECTION=!0,Y.ROUGHNESS=this._roughness>0,Y.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,Y.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Q.b.INVCUBIC_MODE,Y.REFLECTIONMAP_3D=this._reflectionTexture.isCube,Y.REFLECTIONMAP_OPPOSITEZ=Y.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,Y.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Q.b.EXPLICIT_MODE:Y.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Q.b.PLANAR_MODE:Y.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Q.b.PROJECTION_MODE:Y.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Q.b.SKYBOX_MODE:Y.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Q.b.SPHERICAL_MODE:Y.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Q.b.EQUIRECTANGULAR_MODE:Y.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Q.b.FIXED_EQUIRECTANGULAR_MODE:Y.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Q.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Y.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Q.b.CUBIC_MODE:case Q.b.INVCUBIC_MODE:default:Y.setReflectionMode("REFLECTIONMAP_CUBIC")}Y.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else Y.REFLECTION=!1,Y.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&A.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._emissiveTexture,Y,"EMISSIVE")}else Y.EMISSIVE=!1;if(this._lightmapTexture&&A.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._lightmapTexture,Y,"LIGHTMAP"),Y.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Y.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else Y.LIGHTMAP=!1;if(this._specularTexture&&A.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,G.D)(this._specularTexture,Y,"SPECULAR"),Y.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else Y.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&A.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,G.D)(this._bumpTexture,Y,"BUMP"),Y.PARALLAX=this._useParallax,Y.PARALLAX_RHS=r.useRightHandedSystem,Y.PARALLAXOCCLUSION=this._useParallaxOcclusion,Y.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else Y.BUMP=!1,Y.PARALLAX=!1,Y.PARALLAX_RHS=!1,Y.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&A.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;Y._needUVs=!0,Y.REFRACTION=!0,Y.REFRACTIONMAP_3D=this._refractionTexture.isCube,Y.RGBDREFRACTION=this._refractionTexture.isRGBD,Y.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else Y.REFRACTION=!1;Y.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else Y.DIFFUSE=!1,Y.AMBIENT=!1,Y.OPACITY=!1,Y.REFLECTION=!1,Y.EMISSIVE=!1,Y.LIGHTMAP=!1,Y.BUMP=!1,Y.REFRACTION=!1;Y.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),Y.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,Y.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,Y.SPECULAROVERALPHA=this._useSpecularOverAlpha,Y.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Y.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,Y.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(V)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Y,this._eventInfo.subMesh=O,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(Y._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(Y),Y.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,Y.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}Y._areFresnelDirty&&(A.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(Y.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,Y.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,Y.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,Y.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,Y.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,Y.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,Y._needNormals=!0,Y.FRESNEL=!0):Y.FRESNEL=!1),(0,G.G)(V,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(V)||this._forceAlphaTest,Y,this._applyDecalMapAfterDetailMap),(0,G.A)(r,m,this,Y,d,null,O.getRenderingMesh().hasThinInstances),this._eventInfo.defines=Y,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,G.z)(V,Y,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(Y.isDirty){const d=Y._areLightsDisposed;Y.markAsProcessed();const p=new H.d;Y.REFLECTION&&p.addFallback(0,"REFLECTION"),Y.SPECULAR&&p.addFallback(0,"SPECULAR"),Y.BUMP&&p.addFallback(0,"BUMP"),Y.PARALLAX&&p.addFallback(1,"PARALLAX"),Y.PARALLAX_RHS&&p.addFallback(1,"PARALLAX_RHS"),Y.PARALLAXOCCLUSION&&p.addFallback(0,"PARALLAXOCCLUSION"),Y.SPECULAROVERALPHA&&p.addFallback(0,"SPECULAROVERALPHA"),Y.FOG&&p.addFallback(1,"FOG"),Y.POINTSIZE&&p.addFallback(0,"POINTSIZE"),Y.LOGARITHMICDEPTH&&p.addFallback(0,"LOGARITHMICDEPTH"),(0,G.q)(Y,p,this._maxSimultaneousLights),Y.SPECULARTERM&&p.addFallback(0,"SPECULARTERM"),Y.DIFFUSEFRESNEL&&p.addFallback(1,"DIFFUSEFRESNEL"),Y.OPACITYFRESNEL&&p.addFallback(2,"OPACITYFRESNEL"),Y.REFLECTIONFRESNEL&&p.addFallback(3,"REFLECTIONFRESNEL"),Y.EMISSIVEFRESNEL&&p.addFallback(4,"EMISSIVEFRESNEL"),Y.FRESNEL&&p.addFallback(4,"FRESNEL"),Y.MULTIVIEW&&p.addFallback(0,"MULTIVIEW");const a=[R.e.PositionKind];Y.NORMAL&&a.push(R.e.NormalKind),Y.TANGENT&&a.push(R.e.TangentKind);for(let V=1;V<=6;++V)Y["UV"+V]&&a.push(`uv${1===V?"":V}`);Y.VERTEXCOLOR&&a.push(R.e.ColorKind),(0,G.v)(a,V,Y,p),(0,G.w)(a,Y),(0,G.y)(a,V,Y),(0,G.r)(a,V,Y);let W="default";const F=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],Q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],b=["Material","Scene","Mesh"],U={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Y.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=p,this._eventInfo.fallbackRank=0,this._eventInfo.defines=Y,this._eventInfo.uniforms=F,this._eventInfo.attributes=a,this._eventInfo.samplers=Q,this._eventInfo.uniformBuffersNames=b,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=U,this._callbackPluginEventGeneric(128,this._eventInfo),t.b.AddUniformsAndSamplers(F,Q),i.d.AddUniforms(F),i.d.AddSamplers(Q),M.b&&(M.b.PrepareUniforms(F,Y),M.b.PrepareSamplers(Q,Y)),(0,G.U)({uniformsNames:F,uniformBuffersNames:b,samplers:Q,defines:Y,maxSimultaneousLights:this._maxSimultaneousLights}),(0,z.c)(F);const S={};this.customShaderNameResolve&&(W=this.customShaderNameResolve(W,F,b,Q,Y,a,S));const w=Y.toString(),v=O.effect;let A=r.getEngine().createEffect(W,{attributes:a,uniformsNames:F,uniformBuffersNames:b,samplers:Q,defines:w,fallbacks:p,onCompiled:this.onCompiled,onError:this.onError,indexParameters:U,processFinalCode:S.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Y.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([Z.e(21),Z.e(19)]).then(Z.bind(Z,12894)),Promise.all([Z.e(22),Z.e(20)]).then(Z.bind(Z,13040))]):await Promise.all([Promise.all([Z.e(25),Z.e(24)]).then(Z.bind(Z,13132)),Promise.all([Z.e(27),Z.e(26)]).then(Z.bind(Z,13267))]),this._shadersLoaded=!0}},m);if(this._eventInfo.customCode=void 0,A)if(this._onEffectCreatedObservable&&(C.effect=A,C.subMesh=O,this._onEffectCreatedObservable.notifyObservers(C)),this.allowShaderHotSwapping&&v&&!A.isReady()){if(A=v,Y.markAsUnprocessed(),c=this.isFrozen,d)return Y._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),O.setEffect(A,Y,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(Y._renderId=r.getRenderId(),p._wasPreviouslyReady=!c,p._wasPreviouslyUsingInstances=d,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("diffuseLeftColor",4),V.addUniform("diffuseRightColor",4),V.addUniform("opacityParts",4),V.addUniform("reflectionLeftColor",4),V.addUniform("reflectionRightColor",4),V.addUniform("refractionLeftColor",4),V.addUniform("refractionRightColor",4),V.addUniform("emissiveLeftColor",4),V.addUniform("emissiveRightColor",4),V.addUniform("vDiffuseInfos",2),V.addUniform("vAmbientInfos",2),V.addUniform("vOpacityInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vSpecularInfos",2),V.addUniform("vBumpInfos",3),V.addUniform("diffuseMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("reflectionMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("specularMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("pointSize",1),V.addUniform("alphaCutOff",1),V.addUniform("refractionMatrix",16),V.addUniform("vRefractionInfos",4),V.addUniform("vRefractionPosition",3),V.addUniform("vRefractionSize",3),V.addUniform("vSpecularColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vDiffuseColor",4),V.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(V,O,Z){const d=this.va(),p=Z.materialDefines;if(!p)return;const r=Z.effect;if(!r)return;this._activeEffect=r,O.getMeshUniformBuffer().bindToEffect(r,"Mesh"),O.transferToEffect(V),this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,d,O,V,this.isFrozen),t.b.Bind(d.getEngine().currentRenderPassId,this._activeEffect,O,V),this._eventInfo.subMesh=Z,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),p.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const m=this._mustRebind(d,r,Z,O.visibility);(0,G.e)(O,r);const R=this._uniformBuffer;if(m){if(this.bindViewProjection(r),!R.useUbo||!this.isFrozen||!R.isSync||Z._drawWrapper._forceRebindOnNextCall){if(A.FresnelEnabled&&p.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(R.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),R.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&R.updateColor4("opacityParts",new a.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(R.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),R.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(R.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),R.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(R.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),R.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),d.texturesEnabled){if(this._diffuseTexture&&A.DiffuseTextureEnabled&&(R.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,G.o)(this._diffuseTexture,R,"diffuse")),this._ambientTexture&&A.AmbientTextureEnabled&&(R.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,G.o)(this._ambientTexture,R,"ambient")),this._opacityTexture&&A.OpacityTextureEnabled&&(R.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,G.o)(this._opacityTexture,R,"opacity")),this._hasAlphaChannel()&&R.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&A.ReflectionTextureEnabled&&(R.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),R.tj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const V=this._reflectionTexture;R.updateVector3("vReflectionPosition",V.boundingBoxPosition),R.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this._emissiveTexture&&A.EmissiveTextureEnabled&&(R.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,G.o)(this._emissiveTexture,R,"emissive")),this._lightmapTexture&&A.LightmapTextureEnabled&&(R.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,G.o)(this._lightmapTexture,R,"lightmap")),this._specularTexture&&A.SpecularTextureEnabled&&(R.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,G.o)(this._specularTexture,R,"specular")),this._bumpTexture&&d.getEngine().getCaps().standardDerivatives&&A.BumpTextureEnabled&&(R.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,G.o)(this._bumpTexture,R,"bump"),d._mirroredCameraPosition?R.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):R.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&A.RefractionTextureEnabled){let V=1;if(this._refractionTexture.isCube||(R.tj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(V=this._refractionTexture.depth)),R.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,V,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const V=this._refractionTexture;R.updateVector3("vRefractionPosition",V.boundingBoxPosition),R.updateVector3("vRefractionSize",V.boundingBoxSize)}}}this.pointsCloud&&R.updateFloat("pointSize",this.pointSize),R.updateColor4("vSpecularColor",this.specularColor,this.specularPower),R.updateColor3("vEmissiveColor",A.EmissiveTextureEnabled?this.emissiveColor:a.b.BlackReadOnly),R.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),d.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),R.updateColor3("vAmbientColor",this._globalAmbientColor)}d.texturesEnabled&&(this._diffuseTexture&&A.DiffuseTextureEnabled&&r.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&A.AmbientTextureEnabled&&r.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&A.OpacityTextureEnabled&&r.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&A.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?r.setTexture("reflectionCubeSampler",this._reflectionTexture):r.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&A.EmissiveTextureEnabled&&r.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&A.LightmapTextureEnabled&&r.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&A.SpecularTextureEnabled&&r.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&d.getEngine().getCaps().standardDerivatives&&A.BumpTextureEnabled&&r.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&A.RefractionTextureEnabled&&(this._refractionTexture.isCube?r.setTexture("refractionCubeSampler",this._refractionTexture):r.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(O)&&this.va().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=Z,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,z.g)(r,this,d),this.bindEyePosition(r)}else d.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(m||!this.isFrozen){var i;if(d.lightsEnabled&&!this._disableLighting&&(0,G.g)(d,O,r,p,this._maxSimultaneousLights),(d.fogEnabled&&O.applyFog&&d.fogMode!==Y.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||O.receiveShadows||p.PREPASS)&&this.bindView(r),(0,G.f)(d,O,r),p.NUM_MORPH_INFLUENCERS&&(0,G.l)(O,r),p.BAKED_VERTEX_ANIMATION_TEXTURE)null===(i=O.bakedVertexAnimationManager)||void 0===i||i.bind(r,p.INSTANCES);this.useLogarithmicDepth&&(0,G.j)(p,r,d),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(O,this._activeEffect,Z),R.update()}getAnimatables(){const V=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&V.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&V.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),V}getActiveTextures(){const V=super.getActiveTextures();return this._diffuseTexture&&V.push(this._diffuseTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._specularTexture&&V.push(this._specularTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),this._refractionTexture&&V.push(this._refractionTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._diffuseTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._specularTexture===V||(this._bumpTexture===V||(this._lightmapTexture===V||this._refractionTexture===V))))))))}dispose(V,O){var Z,d,p,r,Y,m,a,R,i;O&&(null===(Z=this._diffuseTexture)||void 0===Z||Z.dispose(),null===(d=this._ambientTexture)||void 0===d||d.dispose(),null===(p=this._opacityTexture)||void 0===p||p.dispose(),null===(r=this._reflectionTexture)||void 0===r||r.dispose(),null===(Y=this._emissiveTexture)||void 0===Y||Y.dispose(),null===(m=this._specularTexture)||void 0===m||m.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(R=this._lightmapTexture)||void 0===R||R.dispose(),null===(i=this._refractionTexture)||void 0===i||i.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,O)}clone(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const d=w.b.Clone((()=>new A(V,this.va())),this,{cloneTexturesOnlyOnce:O});return d.name=V,d.id=V,this.stencil.copyTo(d.stencil),this._clonePlugins(d,Z),d}static Parse(V,O,Z){const d=w.b.Parse((()=>new A(V.name,O)),V,O,Z);return V.stencil&&d.stencil.parse(V.stencil,O,Z),c.e._ParsePlugins(V,d,O,Z),d}static get DiffuseTextureEnabled(){return U.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){U.e.DiffuseTextureEnabled=V}static get DetailTextureEnabled(){return U.e.DetailTextureEnabled}static set DetailTextureEnabled(V){U.e.DetailTextureEnabled=V}static get AmbientTextureEnabled(){return U.e.AmbientTextureEnabled}static set AmbientTextureEnabled(V){U.e.AmbientTextureEnabled=V}static get OpacityTextureEnabled(){return U.e.OpacityTextureEnabled}static set OpacityTextureEnabled(V){U.e.OpacityTextureEnabled=V}static get ReflectionTextureEnabled(){return U.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){U.e.ReflectionTextureEnabled=V}static get EmissiveTextureEnabled(){return U.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){U.e.EmissiveTextureEnabled=V}static get SpecularTextureEnabled(){return U.e.SpecularTextureEnabled}static set SpecularTextureEnabled(V){U.e.SpecularTextureEnabled=V}static get BumpTextureEnabled(){return U.e.BumpTextureEnabled}static set BumpTextureEnabled(V){U.e.BumpTextureEnabled=V}static get LightmapTextureEnabled(){return U.e.LightmapTextureEnabled}static set LightmapTextureEnabled(V){U.e.LightmapTextureEnabled=V}static get RefractionTextureEnabled(){return U.e.RefractionTextureEnabled}static set RefractionTextureEnabled(V){U.e.RefractionTextureEnabled=V}static get ColorGradingTextureEnabled(){return U.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){U.e.ColorGradingTextureEnabled=V}static get FresnelEnabled(){return U.e.FresnelEnabled}static set FresnelEnabled(V){U.e.FresnelEnabled=V}}A.ForceGLSL=!1,(0,d.c)([(0,p.A)("diffuseTexture")],A.prototype,"_diffuseTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],A.prototype,"diffuseTexture",void 0),(0,d.c)([(0,p.A)("ambientTexture")],A.prototype,"_ambientTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"ambientTexture",void 0),(0,d.c)([(0,p.A)("opacityTexture")],A.prototype,"_opacityTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],A.prototype,"opacityTexture",void 0),(0,d.c)([(0,p.A)("reflectionTexture")],A.prototype,"_reflectionTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"reflectionTexture",void 0),(0,d.c)([(0,p.A)("emissiveTexture")],A.prototype,"_emissiveTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"emissiveTexture",void 0),(0,d.c)([(0,p.A)("specularTexture")],A.prototype,"_specularTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"specularTexture",void 0),(0,d.c)([(0,p.A)("bumpTexture")],A.prototype,"_bumpTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"bumpTexture",void 0),(0,d.c)([(0,p.A)("lightmapTexture")],A.prototype,"_lightmapTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"lightmapTexture",void 0),(0,d.c)([(0,p.A)("refractionTexture")],A.prototype,"_refractionTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"refractionTexture",void 0),(0,d.c)([(0,p.k)("ambient")],A.prototype,"ambientColor",void 0),(0,d.c)([(0,p.k)("diffuse")],A.prototype,"diffuseColor",void 0),(0,d.c)([(0,p.k)("specular")],A.prototype,"specularColor",void 0),(0,d.c)([(0,p.k)("emissive")],A.prototype,"emissiveColor",void 0),(0,d.c)([(0,p.K)()],A.prototype,"specularPower",void 0),(0,d.c)([(0,p.K)("useAlphaFromDiffuseTexture")],A.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],A.prototype,"useAlphaFromDiffuseTexture",void 0),(0,d.c)([(0,p.K)("useEmissiveAsIllumination")],A.prototype,"_useEmissiveAsIllumination",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useEmissiveAsIllumination",void 0),(0,d.c)([(0,p.K)("linkEmissiveWithDiffuse")],A.prototype,"_linkEmissiveWithDiffuse",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"linkEmissiveWithDiffuse",void 0),(0,d.c)([(0,p.K)("useSpecularOverAlpha")],A.prototype,"_useSpecularOverAlpha",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useSpecularOverAlpha",void 0),(0,d.c)([(0,p.K)("useReflectionOverAlpha")],A.prototype,"_useReflectionOverAlpha",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useReflectionOverAlpha",void 0),(0,d.c)([(0,p.K)("disableLighting")],A.prototype,"_disableLighting",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsLightsDirty")],A.prototype,"disableLighting",void 0),(0,d.c)([(0,p.K)("useObjectSpaceNormalMap")],A.prototype,"_useObjectSpaceNormalMap",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useObjectSpaceNormalMap",void 0),(0,d.c)([(0,p.K)("useParallax")],A.prototype,"_useParallax",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useParallax",void 0),(0,d.c)([(0,p.K)("useParallaxOcclusion")],A.prototype,"_useParallaxOcclusion",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useParallaxOcclusion",void 0),(0,d.c)([(0,p.K)()],A.prototype,"parallaxScaleBias",void 0),(0,d.c)([(0,p.K)("roughness")],A.prototype,"_roughness",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"roughness",void 0),(0,d.c)([(0,p.K)()],A.prototype,"indexOfRefraction",void 0),(0,d.c)([(0,p.K)()],A.prototype,"invertRefractionY",void 0),(0,d.c)([(0,p.K)()],A.prototype,"alphaCutOff",void 0),(0,d.c)([(0,p.K)("useLightmapAsShadowmap")],A.prototype,"_useLightmapAsShadowmap",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useLightmapAsShadowmap",void 0),(0,d.c)([(0,p.q)("diffuseFresnelParameters")],A.prototype,"_diffuseFresnelParameters",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelDirty")],A.prototype,"diffuseFresnelParameters",void 0),(0,d.c)([(0,p.q)("opacityFresnelParameters")],A.prototype,"_opacityFresnelParameters",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],A.prototype,"opacityFresnelParameters",void 0),(0,d.c)([(0,p.q)("reflectionFresnelParameters")],A.prototype,"_reflectionFresnelParameters",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelDirty")],A.prototype,"reflectionFresnelParameters",void 0),(0,d.c)([(0,p.q)("refractionFresnelParameters")],A.prototype,"_refractionFresnelParameters",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelDirty")],A.prototype,"refractionFresnelParameters",void 0),(0,d.c)([(0,p.q)("emissiveFresnelParameters")],A.prototype,"_emissiveFresnelParameters",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelDirty")],A.prototype,"emissiveFresnelParameters",void 0),(0,d.c)([(0,p.K)("useReflectionFresnelFromSpecular")],A.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsFresnelDirty")],A.prototype,"useReflectionFresnelFromSpecular",void 0),(0,d.c)([(0,p.K)("useGlossinessFromSpecularMapAlpha")],A.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,d.c)([(0,p.K)("maxSimultaneousLights")],A.prototype,"_maxSimultaneousLights",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsLightsDirty")],A.prototype,"maxSimultaneousLights",void 0),(0,d.c)([(0,p.K)("invertNormalMapX")],A.prototype,"_invertNormalMapX",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"invertNormalMapX",void 0),(0,d.c)([(0,p.K)("invertNormalMapY")],A.prototype,"_invertNormalMapY",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"invertNormalMapY",void 0),(0,d.c)([(0,p.K)("twoSidedLighting")],A.prototype,"_twoSidedLighting",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsTexturesDirty")],A.prototype,"twoSidedLighting",void 0),(0,d.c)([(0,p.K)("applyDecalMapAfterDetailMap")],A.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,d.c)([(0,p.b)("_markAllSubMeshesAsMiscDirty")],A.prototype,"applyDecalMapAfterDetailMap",void 0),(0,b.f)("BABYLON.StandardMaterial",A),Y.b.DefaultMaterialFactory=V=>new A("default material",V)},11305:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(10914),p=Z(10900);class r{constructor(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=V,this._noUBO=!V.supportsUniformBuffers||p,this._dynamic=Z,this._name=d??"no-name",this._data=O||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.tj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.tj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(V){let O;if(O=V<=2?V:4,this._uniformLocationPointer%O!==0){const V=this._uniformLocationPointer;this._uniformLocationPointer+=O-this._uniformLocationPointer%O;const Z=this._uniformLocationPointer-V;for(let O=0;O<Z;O++)this._data.push(0)}}addUniform(V,O){let Z,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[V]){if(d>0){if(O instanceof Array)throw"addUniform should not be use with Array in UBO: "+V;if(this._fillAlignment(4),this._uniformArraySizes[V]={strideSize:O,arraySize:d},16==O)O*=d;else{O=O*d+(4-O)*d}Z=[];for(let V=0;V<O;V++)Z.push(0)}else{if(O instanceof Array)Z=O,O=Z.length;else{Z=[];for(let V=0;V<O;V++)Z.push(0)}this._fillAlignment(O)}this._uniformSizes[V]=O,this._uniformLocations[V]=this._uniformLocationPointer,this._uniformLocationPointer+=O;for(let V=0;V<O;V++)this._data.push(Z[V]);this._needSync=!0}}addMatrix(V,O){this.addUniform(V,Array.prototype.slice.call(O.Wi()))}addFloat2(V,O,Z){const d=[O,Z];this.addUniform(V,d)}addFloat3(V,O,Z,d){const p=[O,Z,d];this.addUniform(V,p)}addColor3(V,O){const Z=[O.r,O.g,O.b];this.addUniform(V,Z)}addColor4(V,O,Z){const d=[O.r,O.g,O.b,Z];this.addUniform(V,d)}addVector3(V,O){const Z=[O.x,O.y,O.z];this.addUniform(V,Z)}addMatrix3x3(V){this.addUniform(V,12)}addMatrix2x2(V){this.addUniform(V,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const V=[];let O=0;for(const Z in this._uniformLocations)if(V.push(Z),10===++O)break;return V.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(V,O){for(let Z=0;Z<V.length;++Z)if(V[Z]!==O[Z])return!1;return!0}_copyBuffer(V,O){for(let Z=0;Z<V.length;++Z)O[Z]=V[Z]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(r._UpdatedUbosInFrame[this._name]||(r._UpdatedUbosInFrame[this._name]=0),r._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(V,O,Z){this._checkNewFrame();let p=this._uniformLocations[V];if(void 0===p){if(this._buffer)return void d.b.Error("Cannot add an uniform after UBO has been created. uniformName="+V);this.addUniform(V,Z),p=this._uniformLocations[V]}if(this._buffer||this.create(),this._dynamic)for(let d=0;d<Z;d++)this._bufferData[p+d]=O[d];else{let V=!1;for(let d=0;d<Z;d++)(16===Z&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[p+d]!==Math.fround(O[d]))&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[p+d]=O[d]);this._needSync=this._needSync||V}}updateUniformArray(V,O,Z){this._checkNewFrame();const r=this._uniformLocations[V];if(void 0===r)return void d.b.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const Y=this._uniformArraySizes[V];if(this._dynamic)for(let d=0;d<Z;d++)this._bufferData[r+d]=O[d];else{let V=!1,d=0,m=0;for(let a=0;a<Z;a++)if(this._bufferData[r+4*m+d]!==p.e.FloatRound(O[a])&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+4*m+d]=O[a]),d++,d===Y.strideSize){for(;d<4;d++)this._bufferData[r+4*m+d]=0;d=0,m++}this._needSync=this._needSync||V}}_cacheMatrix(V,O){this._checkNewFrame();const Z=this._valueCache[V],d=O.updateFlag;return(void 0===Z||Z!==d)&&(this._valueCache[V]=d,!0)}_updateMatrix3x3ForUniform(V,O){for(let Z=0;Z<3;Z++)r._TempBuffer[4*Z]=O[3*Z],r._TempBuffer[4*Z+1]=O[3*Z+1],r._TempBuffer[4*Z+2]=O[3*Z+2],r._TempBuffer[4*Z+3]=0;this.updateUniform(V,r._TempBuffer,12)}_updateMatrix3x3ForEffect(V,O){this._currentEffect.setMatrix3x3(V,O)}_updateMatrix2x2ForEffect(V,O){this._currentEffect.setMatrix2x2(V,O)}_updateMatrix2x2ForUniform(V,O){for(let Z=0;Z<2;Z++)r._TempBuffer[4*Z]=O[2*Z],r._TempBuffer[4*Z+1]=O[2*Z+1],r._TempBuffer[4*Z+2]=0,r._TempBuffer[4*Z+3]=0;this.updateUniform(V,r._TempBuffer,8)}_updateFloatForEffect(V,O){this._currentEffect.setFloat(V,O)}_updateFloatForUniform(V,O){r._TempBuffer[0]=O,this.updateUniform(V,r._TempBuffer,1)}_updateFloat2ForEffect(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(V+d,O,Z)}_updateFloat2ForUniform(V,O,Z){r._TempBuffer[0]=O,r._TempBuffer[1]=Z,this.updateUniform(V,r._TempBuffer,2)}_updateFloat3ForEffect(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(V+p,O,Z,d)}_updateFloat3ForUniform(V,O,Z,d){r._TempBuffer[0]=O,r._TempBuffer[1]=Z,r._TempBuffer[2]=d,this.updateUniform(V,r._TempBuffer,3)}_updateFloat4ForEffect(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(V+r,O,Z,d,p)}_updateFloat4ForUniform(V,O,Z,d,p){r._TempBuffer[0]=O,r._TempBuffer[1]=Z,r._TempBuffer[2]=d,r._TempBuffer[3]=p,this.updateUniform(V,r._TempBuffer,4)}_updateFloatArrayForEffect(V,O){this._currentEffect.setFloatArray(V,O)}_updateFloatArrayForUniform(V,O){this.updateUniformArray(V,O,O.length)}_updateArrayForEffect(V,O){this._currentEffect.setArray(V,O)}_updateArrayForUniform(V,O){this.updateUniformArray(V,O,O.length)}_updateIntArrayForEffect(V,O){this._currentEffect.setIntArray(V,O)}_updateIntArrayForUniform(V,O){r._TempBufferInt32View.set(O),this.updateUniformArray(V,r._TempBuffer,O.length)}_updateUIntArrayForEffect(V,O){this._currentEffect.setUIntArray(V,O)}_updateUIntArrayForUniform(V,O){r._TempBufferUInt32View.set(O),this.updateUniformArray(V,r._TempBuffer,O.length)}_updateMatrixForEffect(V,O){this._currentEffect.setMatrix(V,O)}_updateMatrixForUniform(V,O){this._cacheMatrix(V,O)&&this.updateUniform(V,O.Wi(),16)}_updateMatricesForEffect(V,O){this._currentEffect.setMatrices(V,O)}_updateMatricesForUniform(V,O){this.updateUniform(V,O,O.length)}_updateVector3ForEffect(V,O){this._currentEffect.setVector3(V,O)}_updateVector3ForUniform(V,O){r._TempBuffer[0]=O.x,r._TempBuffer[1]=O.y,r._TempBuffer[2]=O.z,this.updateUniform(V,r._TempBuffer,3)}_updateVector4ForEffect(V,O){this._currentEffect.setVector4(V,O)}_updateVector4ForUniform(V,O){r._TempBuffer[0]=O.x,r._TempBuffer[1]=O.y,r._TempBuffer[2]=O.z,r._TempBuffer[3]=O.w,this.updateUniform(V,r._TempBuffer,4)}_updateColor3ForEffect(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(V+Z,O)}_updateColor3ForUniform(V,O){r._TempBuffer[0]=O.r,r._TempBuffer[1]=O.g,r._TempBuffer[2]=O.b,this.updateUniform(V,r._TempBuffer,3)}_updateColor4ForEffect(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(V+d,O,Z)}_updateDirectColor4ForEffect(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(V+Z,O)}_updateColor4ForUniform(V,O,Z){r._TempBuffer[0]=O.r,r._TempBuffer[1]=O.g,r._TempBuffer[2]=O.b,r._TempBuffer[3]=Z,this.updateUniform(V,r._TempBuffer,4)}_updateDirectColor4ForUniform(V,O){r._TempBuffer[0]=O.r,r._TempBuffer[1]=O.g,r._TempBuffer[2]=O.b,r._TempBuffer[3]=O.a,this.updateUniform(V,r._TempBuffer,4)}_updateIntForEffect(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(V+Z,O)}_updateIntForUniform(V,O){r._TempBufferInt32View[0]=O,this.updateUniform(V,r._TempBuffer,1)}_updateInt2ForEffect(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(V+d,O,Z)}_updateInt2ForUniform(V,O,Z){r._TempBufferInt32View[0]=O,r._TempBufferInt32View[1]=Z,this.updateUniform(V,r._TempBuffer,2)}_updateInt3ForEffect(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(V+p,O,Z,d)}_updateInt3ForUniform(V,O,Z,d){r._TempBufferInt32View[0]=O,r._TempBufferInt32View[1]=Z,r._TempBufferInt32View[2]=d,this.updateUniform(V,r._TempBuffer,3)}_updateInt4ForEffect(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(V+r,O,Z,d,p)}_updateInt4ForUniform(V,O,Z,d,p){r._TempBufferInt32View[0]=O,r._TempBufferInt32View[1]=Z,r._TempBufferInt32View[2]=d,r._TempBufferInt32View[3]=p,this.updateUniform(V,r._TempBuffer,4)}_updateUIntForEffect(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(V+Z,O)}_updateUIntForUniform(V,O){r._TempBufferUInt32View[0]=O,this.updateUniform(V,r._TempBuffer,1)}_updateUInt2ForEffect(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(V+d,O,Z)}_updateUInt2ForUniform(V,O,Z){r._TempBufferUInt32View[0]=O,r._TempBufferUInt32View[1]=Z,this.updateUniform(V,r._TempBuffer,2)}_updateUInt3ForEffect(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(V+p,O,Z,d)}_updateUInt3ForUniform(V,O,Z,d){r._TempBufferUInt32View[0]=O,r._TempBufferUInt32View[1]=Z,r._TempBufferUInt32View[2]=d,this.updateUniform(V,r._TempBuffer,3)}_updateUInt4ForEffect(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(V+r,O,Z,d,p)}_updateUInt4ForUniform(V,O,Z,d,p){r._TempBufferUInt32View[0]=O,r._TempBufferUInt32View[1]=Z,r._TempBufferUInt32View[2]=d,r._TempBufferUInt32View[3]=p,this.updateUniform(V,r._TempBuffer,4)}setTexture(V,O){this._currentEffect.setTexture(V,O)}setTextureArray(V,O){this._currentEffect.setTextureArray(V,O)}bindTexture(V,O){this._currentEffect._bindTexture(V,O)}updateUniformDirectly(V,O){this.updateUniform(V,O,O.length),this.update()}bindToEffect(V,O){this._currentEffect=V,this._currentEffectName=O}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(V){if(!this._buffers)return this._buffer===V;for(let O=0;O<this._buffers.length;++O){if(this._buffers[O][0]===V)return this._bufferIndex=O,this._buffer=V,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const V=this._engine._uniformBuffers,O=V.indexOf(this);if(-1!==O&&(V[O]=V[V.length-1],V.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let Z=0;Z<this._buffers.length;++Z){const V=this._buffers[Z][0];this._engine._releaseBuffer(V)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}r._UpdatedUbosInFrame={},r._MAX_UNIFORM_SIZE=256,r._TempBuffer=new Float32Array(r._MAX_UNIFORM_SIZE),r._TempBufferInt32View=new Int32Array(r._TempBuffer.buffer),r._TempBufferUInt32View=new Uint32Array(r._TempBuffer.buffer)},11562:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>Y,f:()=>d});var d,p,r=Z(11251);!function(V){V[V.LOCAL=0]="LOCAL",V[V.WORLD=1]="WORLD",V[V.BONE=2]="BONE"}(d||(d={}));class Y{}Y.X=new r.m(1,0,0),Y.Y=new r.m(0,1,0),Y.Z=new r.m(0,0,1),function(V){V[V.X=0]="X",V[V.Y=1]="Y",V[V.Z=2]="Z"}(p||(p={}))},11274:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>M,f:()=>c,h:()=>W});var d=Z(11259),p=Z(11041),r=Z(11255),Y=Z(11263);function m(V){return Math.pow(V,r.l)}function a(V){return V<=.04045?.0773993808*V:Math.pow(.947867299*(V+.055),2.4)}function R(V){return Math.pow(V,r.j)}function i(V){return V<=.0031308?12.92*V:1.055*Math.pow(V,.41666)-.055}class M{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=V,this.g=O,this.b=Z}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"jb"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V}toArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[O]=this.r,V[O+1]=this.g,V[O+2]=this.b,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return M.FromArrayToRef(V,O,this),this}toColor4(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new c(this.r,this.g,this.b,V)}Wi(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(V){return new M(this.r*V.r,this.g*V.g,this.b*V.b)}multiplyToRef(V,O){return O.r=this.r*V.r,O.g=this.g*V.g,O.b=this.b*V.b,O}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this}multiplyByFloats(V,O,Z){return new M(this.r*V,this.g*O,this.b*Z)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,O){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.r,V.g,V.b)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.r,V.g,V.b)}minimizeInPlaceFromFloats(V,O,Z){return this.r=Math.min(V,this.r),this.g=Math.min(O,this.g),this.b=Math.min(Z,this.b),this}maximizeInPlaceFromFloats(V,O,Z){return this.r=Math.max(V,this.r),this.g=Math.max(O,this.g),this.b=Math.max(Z,this.b),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b}equalsFloats(V,O,Z){return this.equalsToFloats(V,O,Z)}equalsToFloats(V,O,Z){return this.r===V&&this.g===O&&this.b===Z}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return(0,Y.A)(this.r,V.r,O)&&(0,Y.A)(this.g,V.g,O)&&(0,Y.A)(this.b,V.b,O)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}scale(V){return new M(this.r*V,this.g*V,this.b*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this}scaleToRef(V,O){return O.r=this.r*V,O.g=this.g*V,O.b=this.b*V,O}scaleAndAddToRef(V,O){return O.r+=this.r*V,O.g+=this.g*V,O.b+=this.b*V,O}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;return Z.r=(0,Y.c)(this.r,V,O),Z.g=(0,Y.c)(this.g,V,O),Z.b=(0,Y.c)(this.b,V,O),Z}add(V){return new M(this.r+V.r,this.g+V.g,this.b+V.b)}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this}addInPlaceFromFloats(V,O,Z){return this.r+=V,this.g+=O,this.b+=Z,this}addToRef(V,O){return O.r=this.r+V.r,O.g=this.g+V.g,O.b=this.b+V.b,O}fc(V){return new M(this.r-V.r,this.g-V.g,this.b-V.b)}subtractToRef(V,O){return O.r=this.r-V.r,O.g=this.g-V.g,O.b=this.b-V.b,O}bi(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this}subtractFromFloats(V,O,Z){return new M(this.r-V,this.g-O,this.b-Z)}subtractFromFloatsToRef(V,O,Z,d){return d.r=this.r-V,d.g=this.g-O,d.b=this.b-Z,d}clone(){return new M(this.r,this.g,this.b)}p(V){return this.r=V.r,this.g=V.g,this.b=V.b,this}nf(V,O,Z){return this.r=V,this.g=O,this.b=Z,this}set(V,O,Z){return this.nf(V,O,Z)}rj(V){return this.r=this.g=this.b=V,this}toHexString(){const V=Math.round(255*this.r),O=Math.round(255*this.g),Z=Math.round(255*this.b);return"#"+(0,Y.w)(V)+(0,Y.w)(O)+(0,Y.w)(Z)}fromHexString(V){return"#"!==V.substring(0,1)||7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new M)}toHSVToRef(V){const O=this.r,Z=this.g,d=this.b,p=Math.max(O,Z,d),r=Math.min(O,Z,d);let Y=0,m=0;const a=p,R=p-r;return 0!==p&&(m=R/p),p!=r&&(p==O?(Y=(Z-d)/R,Z<d&&(Y+=6)):p==Z?Y=(d-O)/R+2:p==d&&(Y=(O-Z)/R+4),Y*=60),V.r=Y,V.g=m,V.b=a,V}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=new M;return this.toLinearSpaceToRef(O,V),O}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=a(this.r),V.g=a(this.g),V.b=a(this.b)):(V.r=m(this.r),V.g=m(this.g),V.b=m(this.b)),this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=new M;return this.toGammaSpaceToRef(O,V),O}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=i(this.r),V.g=i(this.g),V.b=i(this.b)):(V.r=R(this.r),V.g=R(this.g),V.b=R(this.b)),this}static HSVtoRGBToRef(V,O,Z,d){const p=Z*O,r=V/60,Y=p*(1-Math.abs(r%2-1));let m=0,a=0,R=0;r>=0&&r<=1?(m=p,a=Y):r>=1&&r<=2?(m=Y,a=p):r>=2&&r<=3?(a=p,R=Y):r>=3&&r<=4?(a=Y,R=p):r>=4&&r<=5?(m=Y,R=p):r>=5&&r<=6&&(m=p,R=Y);const i=Z-p;return d.r=m+i,d.g=a+i,d.b=R+i,d}static FromHSV(V,O,Z){const d=new M(0,0,0);return M.HSVtoRGBToRef(V,O,Z,d),d}static FromHexString(V){return new M(0,0,0).fromHexString(V)}static Cg(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new M(V[O],V[O+1],V[O+2])}static FromArrayToRef(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;Z.r=V[O],Z.g=V[O+1],Z.b=V[O+2]}static FromInts(V,O,Z){return new M(V/255,O/255,Z/255)}static Lerp(V,O,Z){const d=new M(0,0,0);return M.LerpToRef(V,O,Z,d),d}static LerpToRef(V,O,Z,d){d.r=V.r+(O.r-V.r)*Z,d.g=V.g+(O.g-V.g)*Z,d.b=V.b+(O.b-V.b)*Z}static Hermite(V,O,Z,d,p){const r=p*p,Y=p*r,m=2*Y-3*r+1,a=-2*Y+3*r,R=Y-2*r+p,i=Y-r,c=V.r*m+Z.r*a+O.r*R+d.r*i,W=V.g*m+Z.g*a+O.g*R+d.g*i,F=V.b*m+Z.b*a+O.b*R+d.b*i;return new M(c,W,F)}static Hermite1stDerivative(V,O,Z,d,p){const r=M.Black();return this.Hermite1stDerivativeToRef(V,O,Z,d,p,r),r}static Hermite1stDerivativeToRef(V,O,Z,d,p,r){const Y=p*p;r.r=6*(Y-p)*V.r+(3*Y-4*p+1)*O.r+6*(-Y+p)*Z.r+(3*Y-2*p)*d.r,r.g=6*(Y-p)*V.g+(3*Y-4*p+1)*O.g+6*(-Y+p)*Z.g+(3*Y-2*p)*d.g,r.b=6*(Y-p)*V.b+(3*Y-4*p+1)*O.b+6*(-Y+p)*Z.b+(3*Y-2*p)*d.b}static Red(){return new M(1,0,0)}static Green(){return new M(0,1,0)}static Blue(){return new M(0,0,1)}static Black(){return new M(0,0,0)}static get BlackReadOnly(){return M._BlackReadOnly}static White(){return new M(1,1,1)}static Purple(){return new M(.5,0,.5)}static Magenta(){return new M(1,0,1)}static Yellow(){return new M(1,1,0)}static Gray(){return new M(.5,.5,.5)}static Teal(){return new M(0,1,1)}static Random(){return new M(Math.random(),Math.random(),Math.random())}}M._BlackReadOnly=M.Black(),Object.defineProperties(M.prototype,{dimension:{value:[3]},rank:{value:1}});class c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=V,this.g=O,this.b=Z,this.a=d}Wi(){return[this.r,this.g,this.b,this.a]}toArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[O]=this.r,V[O+1]=this.g,V[O+2]=this.b,V[O+3]=this.a,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=V[O],this.g=V[O+1],this.b=V[O+2],this.a=V[O+3],this}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b&&this.a===V.a}add(V){return new c(this.r+V.r,this.g+V.g,this.b+V.b,this.a+V.a)}addToRef(V,O){return O.r=this.r+V.r,O.g=this.g+V.g,O.b=this.b+V.b,O.a=this.a+V.a,O}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this.a+=V.a,this}addInPlaceFromFloats(V,O,Z,d){return this.r+=V,this.g+=O,this.b+=Z,this.a+=d,this}fc(V){return new c(this.r-V.r,this.g-V.g,this.b-V.b,this.a-V.a)}subtractToRef(V,O){return O.r=this.r-V.r,O.g=this.g-V.g,O.b=this.b-V.b,O.a=this.a-V.a,O}bi(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this.a-=V.a,this}subtractFromFloats(V,O,Z,d){return new c(this.r-V,this.g-O,this.b-Z,this.a-d)}subtractFromFloatsToRef(V,O,Z,d,p){return p.r=this.r-V,p.g=this.g-O,p.b=this.b-Z,p.a=this.a-d,p}scale(V){return new c(this.r*V,this.g*V,this.b*V,this.a*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this.a*=V,this}scaleToRef(V,O){return O.r=this.r*V,O.g=this.g*V,O.b=this.b*V,O.a=this.a*V,O}scaleAndAddToRef(V,O){return O.r+=this.r*V,O.g+=this.g*V,O.b+=this.b*V,O.a+=this.a*V,O}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;return Z.r=(0,Y.c)(this.r,V,O),Z.g=(0,Y.c)(this.g,V,O),Z.b=(0,Y.c)(this.b,V,O),Z.a=(0,Y.c)(this.a,V,O),Z}multiply(V){return new c(this.r*V.r,this.g*V.g,this.b*V.b,this.a*V.a)}multiplyToRef(V,O){return O.r=this.r*V.r,O.g=this.g*V.g,O.b=this.b*V.b,O.a=this.a*V.a,O}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this.a*=V.a,this}multiplyByFloats(V,O,Z,d){return new c(this.r*V,this.g*O,this.b*Z,this.a*d)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,O){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.r=Math.min(this.r,V.r),this.g=Math.min(this.g,V.g),this.b=Math.min(this.b,V.b),this.a=Math.min(this.a,V.a),this}maximizeInPlace(V){return this.r=Math.max(this.r,V.r),this.g=Math.max(this.g,V.g),this.b=Math.max(this.b,V.b),this.a=Math.max(this.a,V.a),this}minimizeInPlaceFromFloats(V,O,Z,d){return this.r=Math.min(V,this.r),this.g=Math.min(O,this.g),this.b=Math.min(Z,this.b),this.a=Math.min(d,this.a),this}maximizeInPlaceFromFloats(V,O,Z,d){return this.r=Math.max(V,this.r),this.g=Math.max(O,this.g),this.b=Math.max(Z,this.b),this.a=Math.max(d,this.a),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.c;return(0,Y.A)(this.r,V.r,O)&&(0,Y.A)(this.g,V.g,O)&&(0,Y.A)(this.b,V.b,O)&&(0,Y.A)(this.a,V.a,O)}equalsToFloats(V,O,Z,d){return this.r===V&&this.g===O&&this.b===Z&&this.a===d}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"rb"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V=397*V^255*this.a,V}clone(){return(new c).p(this)}p(V){return this.r=V.r,this.g=V.g,this.b=V.b,this.a=V.a,this}nf(V,O,Z,d){return this.r=V,this.g=O,this.b=Z,this.a=d,this}set(V,O,Z,d){return this.nf(V,O,Z,d)}rj(V){return this.r=this.g=this.b=this.a=V,this}toHexString(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=Math.round(255*this.r),Z=Math.round(255*this.g),d=Math.round(255*this.b);if(V)return"#"+(0,Y.w)(O)+(0,Y.w)(Z)+(0,Y.w)(d);const p=Math.round(255*this.a);return"#"+(0,Y.w)(O)+(0,Y.w)(Z)+(0,Y.w)(d)+(0,Y.w)(p)}fromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255,9===V.length&&(this.a=parseInt(V.substring(7,9),16)/255)),this}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=new c;return this.toLinearSpaceToRef(O,V),O}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=a(this.r),V.g=a(this.g),V.b=a(this.b)):(V.r=m(this.r),V.g=m(this.g),V.b=m(this.b)),V.a=this.a,this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=new c;return this.toGammaSpaceToRef(O,V),O}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=i(this.r),V.g=i(this.g),V.b=i(this.b)):(V.r=R(this.r),V.g=R(this.g),V.b=R(this.b)),V.a=this.a,this}static FromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length?new c(0,0,0,0):new c(0,0,0,1).fromHexString(V)}static Lerp(V,O,Z){return c.LerpToRef(V,O,Z,new c)}static LerpToRef(V,O,Z,d){return d.r=V.r+(O.r-V.r)*Z,d.g=V.g+(O.g-V.g)*Z,d.b=V.b+(O.b-V.b)*Z,d.a=V.a+(O.a-V.a)*Z,d}static Hermite(V,O,Z,d,p){const r=p*p,Y=p*r,m=2*Y-3*r+1,a=-2*Y+3*r,R=Y-2*r+p,i=Y-r,M=V.r*m+Z.r*a+O.r*R+d.r*i,W=V.g*m+Z.g*a+O.g*R+d.g*i,F=V.b*m+Z.b*a+O.b*R+d.b*i,Q=V.a*m+Z.a*a+O.a*R+d.a*i;return new c(M,W,F,Q)}static Hermite1stDerivative(V,O,Z,d,p){const r=new c;return this.Hermite1stDerivativeToRef(V,O,Z,d,p,r),r}static Hermite1stDerivativeToRef(V,O,Z,d,p,r){const Y=p*p;r.r=6*(Y-p)*V.r+(3*Y-4*p+1)*O.r+6*(-Y+p)*Z.r+(3*Y-2*p)*d.r,r.g=6*(Y-p)*V.g+(3*Y-4*p+1)*O.g+6*(-Y+p)*Z.g+(3*Y-2*p)*d.g,r.b=6*(Y-p)*V.b+(3*Y-4*p+1)*O.b+6*(-Y+p)*Z.b+(3*Y-2*p)*d.b,r.a=6*(Y-p)*V.a+(3*Y-4*p+1)*O.a+6*(-Y+p)*Z.a+(3*Y-2*p)*d.a}static FromColor3(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c(V.r,V.g,V.b,O)}static Cg(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(V[O],V[O+1],V[O+2],V[O+3])}static FromArrayToRef(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;Z.r=V[O],Z.g=V[O+1],Z.b=V[O+2],Z.a=V[O+3]}static FromInts(V,O,Z,d){return new c(V/255,O/255,Z/255,d/255)}static CheckColors4(V,O){if(V.length===3*O){const O=[];for(let Z=0;Z<V.length;Z+=3){const d=Z/3*4;O[d]=V[Z],O[d+1]=V[Z+1],O[d+2]=V[Z+2],O[d+3]=1}return O}return V}}Object.defineProperties(c.prototype,{dimension:{value:[4]},rank:{value:1}});class W{}W.jb=(0,d.c)(3,M.Black),W.rb=(0,d.c)(3,(()=>new c(0,0,0,0))),(0,p.f)("BABYLON.Color3",M),(0,p.f)("BABYLON.Color4",c)},11255:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>Y,f:()=>r,j:()=>d,l:()=>p});const d=1/2.2,p=2.2,r=(1+Math.sqrt(5))/2,Y=.001},11377:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});var d=Z(11386);class p{static GetPlanes(V){const O=[];for(let Z=0;Z<6;Z++)O.push(new d.c(0,0,0,0));return p.GetPlanesToRef(V,O),O}static GetNearPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]+Z[2],O.ab.y=Z[7]+Z[6],O.ab.z=Z[11]+Z[10],O.d=Z[15]+Z[14],O.normalize()}static GetFarPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]-Z[2],O.ab.y=Z[7]-Z[6],O.ab.z=Z[11]-Z[10],O.d=Z[15]-Z[14],O.normalize()}static GetLeftPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]+Z[0],O.ab.y=Z[7]+Z[4],O.ab.z=Z[11]+Z[8],O.d=Z[15]+Z[12],O.normalize()}static GetRightPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]-Z[0],O.ab.y=Z[7]-Z[4],O.ab.z=Z[11]-Z[8],O.d=Z[15]-Z[12],O.normalize()}static GetTopPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]-Z[1],O.ab.y=Z[7]-Z[5],O.ab.z=Z[11]-Z[9],O.d=Z[15]-Z[13],O.normalize()}static GetBottomPlaneToRef(V,O){const Z=V.m;O.ab.x=Z[3]+Z[1],O.ab.y=Z[7]+Z[5],O.ab.z=Z[11]+Z[9],O.d=Z[15]+Z[13],O.normalize()}static GetPlanesToRef(V,O){p.GetNearPlaneToRef(V,O[0]),p.GetFarPlaneToRef(V,O[1]),p.GetLeftPlaneToRef(V,O[2]),p.GetRightPlaneToRef(V,O[3]),p.GetTopPlaneToRef(V,O[4]),p.GetBottomPlaneToRef(V,O[5])}static IsPointInFrustum(V,O){for(let Z=0;Z<6;Z++)if(O[Z].dotCoordinate(V)<0)return!1;return!0}}},11435:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>m,f:()=>a});var d=Z(11210),p=Z(11251),r=Z(11216);class Y{static extractMinAndMaxIndexed(V,O,Z,d,p,r){for(let Y=Z;Y<Z+d;Y++){const Z=3*O[Y],d=V[Z],m=V[Z+1],a=V[Z+2];p.minimizeInPlaceFromFloats(d,m,a),r.maximizeInPlaceFromFloats(d,m,a)}}static extractMinAndMax(V,O,Z,d,p,r){for(let Y=O,m=O*d;Y<O+Z;Y++,m+=d){const O=V[m],Z=V[m+1],d=V[m+2];p.minimizeInPlaceFromFloats(O,Z,d),r.maximizeInPlaceFromFloats(O,Z,d)}}}function m(V,O,Z,d){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const m=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new p.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Y.extractMinAndMaxIndexed(V,O,Z,d,m,a),r&&(m.x-=m.x*r.x+r.y,m.y-=m.y*r.x+r.y,m.z-=m.z*r.x+r.y,a.x+=a.x*r.x+r.y,a.y+=a.y*r.x+r.y,a.z+=a.z*r.x+r.y),{minimum:m,maximum:a}}function a(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0;const m=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new p.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return r||(r=3),Y.extractMinAndMax(V,O,Z,r,m,a),d&&(m.x-=m.x*d.x+d.y,m.y-=m.y*d.x+d.y,m.z-=m.z*d.x+d.y,a.x+=a.x*d.x+d.y,a.y+=a.y*d.x+d.y,a.z+=a.z*d.x+d.y),{minimum:m,maximum:a}}(0,d.c)([r.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d,p]=O;return!Array.isArray(d)&&!Array.isArray(p)}))],Y,"extractMinAndMaxIndexed",null),(0,d.c)([r.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d]=O;return!Array.isArray(d)}))],Y,"extractMinAndMax",null)},11715:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d.i});Z(11562),Z(11274),Z(11255),Z(11377),Z(11721),Z(11386),Z(11474);var d=Z(11251);Z(11526)},11721:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>m,g:()=>i,k:()=>M});var d,p=Z(11263),r=Z(11251),Y=Z(11255);!function(V){V[V.CW=0]="CW",V[V.CCW=1]="CCW"}(d||(d={}));class m{static Interpolate(V,O,Z,d,p){const r=1-3*d+3*O,Y=3*d-6*O,m=3*O;let a=V;for(let R=0;R<5;R++){const O=a*a;a-=(r*(O*a)+Y*O+m*a-V)*(1/(3*r*O+2*Y*a+m)),a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*Z+3*(1-a)*Math.pow(a,2)*p+Math.pow(a,3)}}class a{constructor(V){this._radians=V,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(V,O){const Z=O.fc(V),d=Math.atan2(Z.y,Z.x);return new a(d)}static BetweenTwoVectors(V,O){let Z=V.lengthSquared()*O.lengthSquared();if(0===Z)return new a(Math.PI/2);Z=Math.sqrt(Z);let d=V.dot(O)/Z;d=(0,p.c)(d,-1,1);const r=Math.acos(d);return new a(r)}static FromRadians(V){return new a(V)}static FromDegrees(V){return new a(V*Math.PI/180)}}class R{constructor(V,O,Z){this.startPoint=V,this.midPoint=O,this.endPoint=Z;const d=Math.pow(O.x,2)+Math.pow(O.y,2),p=(Math.pow(V.x,2)+Math.pow(V.y,2)-d)/2,Y=(d-Math.pow(Z.x,2)-Math.pow(Z.y,2))/2,m=(V.x-O.x)*(O.y-Z.y)-(O.x-Z.x)*(V.y-O.y);this.centerPoint=new r.l((p*(O.y-Z.y)-Y*(V.y-O.y))/m,((V.x-O.x)*Y-(O.x-Z.x)*p)/m),this.i=this.centerPoint.fc(this.startPoint).length(),this.startAngle=a.BetweenTwoPoints(this.centerPoint,this.startPoint);const R=this.startAngle.degrees();let i=a.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),M=a.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();i-R>180&&(i-=360),i-R<-180&&(i+=360),M-i>180&&(M-=360),M-i<-180&&(M+=360),this.orientation=i-R<0?0:1,this.angle=a.FromDegrees(0===this.orientation?R-M:M-R)}}class i{constructor(V,O){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r.l(V,O))}addLineTo(V,O){if(this.closed)return this;const Z=new r.l(V,O),d=this._points[this._points.length-1];return this._points.push(Z),this._length+=Z.fc(d).length(),this}addArcTo(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const Y=this._points[this._points.length-1],m=new r.l(V,O),a=new r.l(Z,d),i=new R(Y,m,a);let M=i.angle.radians()/p;0===i.orientation&&(M*=-1);let c=i.startAngle.radians()+M;for(let r=0;r<p;r++){const V=Math.cos(c)*i.i+i.centerPoint.x,O=Math.sin(c)*i.i+i.centerPoint.y;this.addLineTo(V,O),c+=M}return this}addQuadraticCurveTo(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const r=(V,O,Z,d)=>(1-V)*(1-V)*O+2*V*(1-V)*Z+V*V*d,Y=this._points[this._points.length-1];for(let m=0;m<=p;m++){const a=m/p,R=r(a,Y.x,V,Z),i=r(a,Y.y,O,d);this.addLineTo(R,i)}return this}addBezierCurveTo(V,O,Z,d,p,r){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const m=(V,O,Z,d,p)=>(1-V)*(1-V)*(1-V)*O+3*V*(1-V)*(1-V)*Z+3*V*V*(1-V)*d+V*V*V*p,a=this._points[this._points.length-1];for(let R=0;R<=Y;R++){const i=R/Y,M=m(i,a.x,V,Z,p),c=m(i,a.y,O,d,r);this.addLineTo(M,c)}return this}isPointInside(V){let O=!1;const Z=this._points.length;for(let d=Z-1,p=0;p<Z;d=p++){let Z=this._points[d],r=this._points[p],Y=r.x-Z.x,m=r.y-Z.y;if(Math.abs(m)>Number.EPSILON){if(m<0&&(Z=this._points[p],Y=-Y,r=this._points[d],m=-m),V.y<Z.y||V.y>r.y)continue;if(V.y===Z.y&&V.x===Z.x)return!0;{const d=m*(V.x-Z.x)-Y*(V.y-Z.y);if(0===d)return!0;if(d<0)continue;O=!O}}else{if(V.y!==Z.y)continue;if(r.x<=V.x&&V.x<=Z.x||Z.x<=V.x&&V.x<=r.x)return!0}}return O}close(){return this.closed=!0,this}length(){let V=this._length;if(this.closed){const O=this._points[this._points.length-1];V+=this._points[0].fc(O).length()}return V}area(){const V=this._points.length;let O=0;for(let Z=V-1,d=0;d<V;Z=d++)O+=this._points[Z].x*this._points[d].y-this._points[d].x*this._points[Z].y;return.5*O}getPoints(){return this._points}getPointAtLengthPosition(V){if(V<0||V>1)return r.l.Zero();const O=V*this.length();let Z=0;for(let d=0;d<this._points.length;d++){const V=(d+1)%this._points.length,p=this._points[d],Y=this._points[V].fc(p),m=Y.length()+Z;if(O>=Z&&O<=m){const V=Y.normalize(),d=O-Z;return new r.l(p.x+V.x*d,p.y+V.y*d)}Z=m}return r.l.Zero()}static StartingAt(V,O){return new i(V,O)}}class M{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=V,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:r.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:r.c.Identity()};for(let p=0;p<V.length;p++)this._curve[p]=V[p].clone();this._raw=Z||!1,this._alignTangentsWithPath=d,this._compute(O,d)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(V){return this._updatePointAtData(V).point}getTangentAt(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,O),O?r.m.TransformCoordinates(r.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,O),O?r.m.TransformCoordinates(r.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,O),O?r.m.TransformCoordinates(r.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(V){return this.length()*V}getPreviousPointIndexAt(V){return this._updatePointAtData(V),this._pointAtData.previousPointArrayIndex}getSubPositionAt(V){return this._updatePointAtData(V),this._pointAtData.subPosition}getClosestPositionTo(V){let O=Number.MAX_VALUE,Z=0;for(let d=0;d<this._curve.length-1;d++){const p=this._curve[d+0],Y=this._curve[d+1].fc(p).normalize(),m=this._distances[d+1]-this._distances[d+0],a=Math.min(Math.max(r.m.Dot(Y,V.fc(p).normalize()),0)*r.m.Distance(p,V)/m,1),R=r.m.Distance(p.add(Y.scale(a*m)),V);R<O&&(O=R,Z=(this._distances[d+0]+m*a)/this.length())}return Z}slice(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(V<0&&(V=1- -1*V%1),O<0&&(O=1- -1*O%1),V>O){const Z=V;V=O,O=Z}const Z=this.getCurve(),d=this.getPointAt(V);let p=this.getPreviousPointIndexAt(V);const r=this.getPointAt(O),Y=this.getPreviousPointIndexAt(O)+1,m=[];return 0!==V&&(p++,m.push(d)),m.push(...Z.slice(p,Y)),1===O&&1!==V||m.push(r),new M(m,this.getNormalAt(V),this._raw,this._alignTangentsWithPath)}update(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let d=0;d<V.length;d++)this._curve[d].x=V[d].x,this._curve[d].y=V[d].y,this._curve[d].z=V[d].z;return this._compute(O,Z),this}_compute(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Z=this._curve.length;if(Z<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[Z-1]=this._curve[Z-1].fc(this._curve[Z-2]),this._raw||this._tangents[Z-1].normalize();const d=this._tangents[0],p=this._normalVector(d,V);let Y,m,a,R,i;this._normals[0]=p,this._raw||this._normals[0].normalize(),this._binormals[0]=r.m.Cross(d,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let M=1;M<Z;M++)Y=this._getLastNonNullVector(M),M<Z-1&&(m=this._getFirstNonNullVector(M),this._tangents[M]=O?m:Y.add(m),this._tangents[M].normalize()),this._distances[M]=this._distances[M-1]+this._curve[M].fc(this._curve[M-1]).length(),a=this._tangents[M],i=this._binormals[M-1],this._normals[M]=r.m.Cross(i,a),this._raw||(0===this._normals[M].length()?(R=this._normals[M-1],this._normals[M]=R.clone()):this._normals[M].normalize()),this._binormals[M]=r.m.Cross(a,this._normals[M]),this._raw||this._binormals[M].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(V){let O=1,Z=this._curve[V+O].fc(this._curve[V]);for(;0===Z.length()&&V+O+1<this._curve.length;)O++,Z=this._curve[V+O].fc(this._curve[V]);return Z}_getLastNonNullVector(V){let O=1,Z=this._curve[V].fc(this._curve[V-O]);for(;0===Z.length()&&V>O+1;)O++,Z=this._curve[V].fc(this._curve[V-O]);return Z}_normalVector(V,O){let Z,d=V.length();if(0===d&&(d=1),void 0===O||null===O){let O;O=(0,p.A)(Math.abs(V.y)/d,1,Y.c)?(0,p.A)(Math.abs(V.x)/d,1,Y.c)?(0,p.A)(Math.abs(V.z)/d,1,Y.c)?r.m.Zero():new r.m(0,0,1):new r.m(1,0,0):new r.m(0,-1,0),Z=r.m.Cross(V,O)}else Z=r.m.Cross(V,O),r.m.CrossToRef(Z,V,Z);return Z.normalize(),Z}_updatePointAtData(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===V)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=V;const Z=this.getPoints();if(V<=0)return this._setPointAtData(0,0,Z[0],0,O);if(V>=1)return this._setPointAtData(1,1,Z[Z.length-1],Z.length-1,O);let d,p=Z[0],Y=0;const m=V*this.length();for(let a=1;a<Z.length;a++){d=Z[a];const R=r.m.Distance(p,d);if(Y+=R,Y===m)return this._setPointAtData(V,1,d,a,O);if(Y>m){const Z=(Y-m)/R,r=p.fc(d),i=d.add(r.scaleInPlace(Z));return this._setPointAtData(V,1-Z,i,a-1,O)}p=d}return this._pointAtData}_setPointAtData(V,O,Z,d,p){return this._pointAtData.point=Z,this._pointAtData.position=V,this._pointAtData.subPosition=O,this._pointAtData.previousPointArrayIndex=d,this._pointAtData.interpolateReady=p,p&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=r.c.Identity();const V=this._pointAtData.previousPointArrayIndex;if(V!==this._tangents.length-1){const O=V+1,Z=this._tangents[V].clone(),d=this._normals[V].clone(),p=this._binormals[V].clone(),Y=this._tangents[O].clone(),m=this._normals[O].clone(),a=this._binormals[O].clone(),R=r.g.RotationQuaternionFromAxis(d,p,Z),i=r.g.RotationQuaternionFromAxis(m,a,Y);r.g.Slerp(R,i,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11386:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>p});var d=Z(11251);class p{constructor(V,O,Z,p){this.ab=new d.m(V,O,Z),this.d=p}Wi(){return[this.ab.x,this.ab.y,this.ab.z,this.d]}clone(){return new p(this.ab.x,this.ab.y,this.ab.z,this.d)}getClassName(){return"Plane"}getHashCode(){let V=this.ab.getHashCode();return V=397*V^this.d,V}normalize(){const V=Math.sqrt(this.ab.x*this.ab.x+this.ab.y*this.ab.y+this.ab.z*this.ab.z);let O=0;return 0!==V&&(O=1/V),this.ab.x*=O,this.ab.y*=O,this.ab.z*=O,this.d*=O,this}transform(V){const O=p._TmpMatrix;V.invertToRef(O);const Z=O.m,d=this.ab.x,r=this.ab.y,Y=this.ab.z,m=this.d,a=d*Z[0]+r*Z[1]+Y*Z[2]+m*Z[3],R=d*Z[4]+r*Z[5]+Y*Z[6]+m*Z[7],i=d*Z[8]+r*Z[9]+Y*Z[10]+m*Z[11],M=d*Z[12]+r*Z[13]+Y*Z[14]+m*Z[15];return new p(a,R,i,M)}dotCoordinate(V){return this.ab.x*V.x+this.ab.y*V.y+this.ab.z*V.z+this.d}copyFromPoints(V,O,Z){const d=O.x-V.x,p=O.y-V.y,r=O.z-V.z,Y=Z.x-V.x,m=Z.y-V.y,a=Z.z-V.z,R=p*a-r*m,i=r*Y-d*a,M=d*m-p*Y,c=Math.sqrt(R*R+i*i+M*M);let W;return W=0!==c?1/c:0,this.ab.x=R*W,this.ab.y=i*W,this.ab.z=M*W,this.d=-(this.ab.x*V.x+this.ab.y*V.y+this.ab.z*V.z),this}isFrontFacingTo(V,O){return d.m.Dot(this.ab,V)<=O}signedDistanceTo(V){return d.m.Dot(V,this.ab)+this.d}static Cg(V){return new p(V[0],V[1],V[2],V[3])}static FromPoints(V,O,Z){const d=new p(0,0,0,0);return d.copyFromPoints(V,O,Z),d}static FromPositionAndNormal(V,O){const Z=new p(0,0,0,0);return this.FromPositionAndNormalToRef(V,O,Z)}static FromPositionAndNormalToRef(V,O,Z){return Z.ab.p(O),Z.ab.normalize(),Z.d=-V.dot(Z.ab),Z}static SignedDistanceToPlaneFromPositionAndNormal(V,O,Z){const p=-(O.x*V.x+O.y*V.y+O.z*V.z);return d.m.Dot(Z,O)+p}}p._TmpMatrix=d.c.Identity()},11263:(V,O,Z)=>{"use strict";function d(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(V-O)<=Z}function p(V,O){return V===O?V:Math.random()*(O-V)+V}function r(V,O,Z){return V+(O-V)*Z}function Y(V,O,Z,d,p){const r=p*p,Y=p*r;return V*(2*Y-3*r+1)+Z*(-2*Y+3*r)+O*(Y-2*r+p)+d*(Y-r)}function m(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Z,Math.max(O,V))}function a(V){return V-=2*Math.PI*Math.floor((V+Math.PI)/(2*Math.PI))}function R(V){const O=V.toString(16);return V<=15?("0"+O).toUpperCase():O.toUpperCase()}function i(V){if(Math.log2)return Math.floor(Math.log2(V));if(V<0)return NaN;if(0===V)return-1/0;let O=0;if(V<1){for(;V<1;)O++,V*=2;O=-O}else if(V>1)for(;V>1;)O++,V=Math.floor(V/2);return O}function M(V,O){const Z=V%O;return 0===Z?O:M(O,Z)}Z.d(O,{A:()=>d,c:()=>m,e:()=>Y,g:()=>M,k:()=>i,m:()=>r,q:()=>a,u:()=>p,w:()=>R})},11474:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});class d{constructor(V,O){this.width=V,this.height=O}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let V=0|this.width;return V=397*V^this.height,V}p(V){this.width=V.width,this.height=V.height}nf(V,O){return this.width=V,this.height=O,this}set(V,O){return this.nf(V,O)}multiplyByFloats(V,O){return new d(this.width*V,this.height*O)}clone(){return new d(this.width,this.height)}equals(V){return!!V&&(this.width===V.width&&this.height===V.height)}get surface(){return this.width*this.height}static Zero(){return new d(0,0)}add(V){return new d(this.width+V.width,this.height+V.height)}fc(V){return new d(this.width-V.width,this.height-V.height)}scale(V){return new d(this.width*V,this.height*V)}static Lerp(V,O,Z){const p=V.width+(O.width-V.width)*Z,r=V.height+(O.height-V.height)*Z;return new d(p,r)}}},11251:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>F,g:()=>W,i:()=>b,l:()=>i,m:()=>M,p:()=>c});var d=Z(11255),p=Z(11259),r=Z(11041),Y=Z(11006),m=Z(10942),a=Z(11263);const R=V=>parseInt(V.toString().replace(/\W/g,""));class i{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=O}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let V=R(this.x);return V=397*V^R(this.y),V}toArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[O]=this.x,V[O+1]=this.y,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(V,O,this),this}Wi(){return[this.x,this.y]}p(V){return this.x=V.x,this.y=V.y,this}nf(V,O){return this.x=V,this.y=O,this}set(V,O){return this.nf(V,O)}rj(V){return this.nf(V,V)}add(V){return new i(this.x+V.x,this.y+V.y)}addToRef(V,O){return O.x=this.x+V.x,O.y=this.y+V.y,O}addInPlace(V){return this.x+=V.x,this.y+=V.y,this}addInPlaceFromFloats(V,O){return this.x+=V,this.y+=O,this}addVector3(V){return new i(this.x+V.x,this.y+V.y)}fc(V){return new i(this.x-V.x,this.y-V.y)}subtractToRef(V,O){return O.x=this.x-V.x,O.y=this.y-V.y,O}bi(V){return this.x-=V.x,this.y-=V.y,this}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this}multiply(V){return new i(this.x*V.x,this.y*V.y)}multiplyToRef(V,O){return O.x=this.x*V.x,O.y=this.y*V.y,O}multiplyByFloats(V,O){return new i(this.x*V,this.y*O)}divide(V){return new i(this.x/V.x,this.y/V.y)}divideToRef(V,O){return O.x=this.x/V.x,O.y=this.y/V.y,O}divideInPlace(V){return this.x=this.x/V.x,this.y=this.y/V.y,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.x,V.y)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.x,V.y)}minimizeInPlaceFromFloats(V,O){return this.x=Math.min(V,this.x),this.y=Math.min(O,this.y),this}maximizeInPlaceFromFloats(V,O){return this.x=Math.max(V,this.x),this.y=Math.max(O,this.y),this}subtractFromFloats(V,O){return new i(this.x-V,this.y-O)}subtractFromFloatsToRef(V,O,Z){return Z.x=this.x-V,Z.y=this.y-O,Z}negate(){return new i(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(V){return V.x=-this.x,V.y=-this.y,V}scaleInPlace(V){return this.x*=V,this.y*=V,this}scale(V){return new i(this.x*V,this.y*V)}scaleToRef(V,O){return O.x=this.x*V,O.y=this.y*V,O}scaleAndAddToRef(V,O){return O.x+=this.x*V,O.y+=this.y*V,O}equals(V){return V&&this.x===V.x&&this.y===V.y}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return V&&(0,a.A)(this.x,V.x,O)&&(0,a.A)(this.y,V.y,O)}equalsToFloats(V,O){return this.x===V&&this.y===O}floor(){return new i(Math.floor(this.x),Math.floor(this.y))}floorToRef(V){return V.x=Math.floor(this.x),V.y=Math.floor(this.y),V}fract(){return new i(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(V){return V.x=this.x-Math.floor(this.x),V.y=this.y-Math.floor(this.y),V}rotateToRef(V,O){const Z=Math.cos(V),d=Math.sin(V),p=Z*this.x-d*this.y,r=d*this.x+Z*this.y;return O.x=p,O.y=r,O}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new i;return this.normalizeToRef(V),V}normalizeToRef(V){const O=this.length();return 0===O&&(V.x=this.x,V.y=this.y),this.scaleToRef(1/O,V)}clone(){return new i(this.x,this.y)}dot(V){return this.x*V.x+this.y*V.y}static Zero(){return new i(0,0)}static One(){return new i(1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new i((0,a.u)(V,O),(0,a.u)(V,O))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).nf((0,a.u)(V,O),(0,a.u)(V,O))}static get ZeroReadOnly(){return i._ZeroReadOnly}static Cg(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(V[O],V[O+1])}static FromArrayToRef(V,O,Z){return Z.x=V[O],Z.y=V[O+1],Z}static FromFloatsToRef(V,O,Z){return Z.nf(V,O),Z}static CatmullRom(V,O,Z,d,p){const r=p*p,Y=p*r,m=.5*(2*O.x+(-V.x+Z.x)*p+(2*V.x-5*O.x+4*Z.x-d.x)*r+(-V.x+3*O.x-3*Z.x+d.x)*Y),a=.5*(2*O.y+(-V.y+Z.y)*p+(2*V.y-5*O.y+4*Z.y-d.y)*r+(-V.y+3*O.y-3*Z.y+d.y)*Y);return new i(m,a)}static ClampToRef(V,O,Z,d){return d.x=(0,a.c)(V.x,O.x,Z.x),d.y=(0,a.c)(V.y,O.y,Z.y),d}static Clamp(V,O,Z){const d=(0,a.c)(V.x,O.x,Z.x),p=(0,a.c)(V.y,O.y,Z.y);return new i(d,p)}static Hermite(V,O,Z,d,p){const r=p*p,Y=p*r,m=2*Y-3*r+1,a=-2*Y+3*r,R=Y-2*r+p,M=Y-r,c=V.x*m+Z.x*a+O.x*R+d.x*M,W=V.y*m+Z.y*a+O.y*R+d.y*M;return new i(c,W)}static Hermite1stDerivative(V,O,Z,d,p){return this.Hermite1stDerivativeToRef(V,O,Z,d,p,new i)}static Hermite1stDerivativeToRef(V,O,Z,d,p,r){const Y=p*p;return r.x=6*(Y-p)*V.x+(3*Y-4*p+1)*O.x+6*(-Y+p)*Z.x+(3*Y-2*p)*d.x,r.y=6*(Y-p)*V.y+(3*Y-4*p+1)*O.y+6*(-Y+p)*Z.y+(3*Y-2*p)*d.y,r}static Lerp(V,O,Z){return i.LerpToRef(V,O,Z,new i)}static LerpToRef(V,O,Z,d){return d.x=V.x+(O.x-V.x)*Z,d.y=V.y+(O.y-V.y)*Z,d}static Dot(V,O){return V.x*O.x+V.y*O.y}static Normalize(V){return i.NormalizeToRef(V,new i)}static NormalizeToRef(V,O){return V.normalizeToRef(O),O}static Minimize(V,O){const Z=V.x<O.x?V.x:O.x,d=V.y<O.y?V.y:O.y;return new i(Z,d)}static Maximize(V,O){const Z=V.x>O.x?V.x:O.x,d=V.y>O.y?V.y:O.y;return new i(Z,d)}static Transform(V,O){return i.TransformToRef(V,O,new i)}static TransformToRef(V,O,Z){const d=O.m,p=V.x*d[0]+V.y*d[4]+d[12],r=V.x*d[1]+V.y*d[5]+d[13];return Z.x=p,Z.y=r,Z}static PointInTriangle(V,O,Z,d){const p=.5*(-Z.y*d.x+O.y*(-Z.x+d.x)+O.x*(Z.y-d.y)+Z.x*d.y),r=p<0?-1:1,Y=(O.y*d.x-O.x*d.y+(d.y-O.y)*V.x+(O.x-d.x)*V.y)*r,m=(O.x*Z.y-O.y*Z.x+(O.y-Z.y)*V.x+(Z.x-O.x)*V.y)*r;return Y>0&&m>0&&Y+m<2*p*r}static Distance(V,O){return Math.sqrt(i.DistanceSquared(V,O))}static DistanceSquared(V,O){const Z=V.x-O.x,d=V.y-O.y;return Z*Z+d*d}static Center(V,O){return i.CenterToRef(V,O,new i)}static CenterToRef(V,O,Z){return Z.nf((V.x+O.x)/2,(V.y+O.y)/2)}static DistanceOfPointFromSegment(V,O,Z){const d=i.DistanceSquared(O,Z);if(0===d)return i.Distance(V,O);const p=Z.fc(O),r=Math.max(0,Math.min(1,i.Dot(V.fc(O),p)/d)),Y=O.add(p.multiplyByFloats(r,r));return i.Distance(V,Y)}}i._ZeroReadOnly=i.Zero(),Object.defineProperties(i.prototype,{dimension:{value:[2]},rank:{value:1}});class M{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=V,this._y=O,this._z=Z}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"ib"}getHashCode(){let V=R(this._x);return V=397*V^R(this._y),V=397*V^R(this._z),V}Wi(){return[this._x,this._y,this._z]}toArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[O]=this._x,V[O+1]=this._y,V[O+2]=this._z,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return M.FromArrayToRef(V,O,this),this}toQuaternion(){return W.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._isDirty=!0,this}addInPlaceFromFloats(V,O,Z){return this._x+=V,this._y+=O,this._z+=Z,this._isDirty=!0,this}add(V){return new M(this._x+V._x,this._y+V._y,this._z+V._z)}addToRef(V,O){return O._x=this._x+V._x,O._y=this._y+V._y,O._z=this._z+V._z,O._isDirty=!0,O}bi(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._isDirty=!0,this}fc(V){return new M(this._x-V._x,this._y-V._y,this._z-V._z)}subtractToRef(V,O){return this.subtractFromFloatsToRef(V._x,V._y,V._z,O)}subtractFromFloats(V,O,Z){return new M(this._x-V,this._y-O,this._z-Z)}subtractFromFloatsToRef(V,O,Z,d){return d._x=this._x-V,d._y=this._y-O,d._z=this._z-Z,d._isDirty=!0,d}negate(){return new M(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(V){return V._x=-1*this._x,V._y=-1*this._y,V._z=-1*this._z,V._isDirty=!0,V}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._isDirty=!0,this}scale(V){return new M(this._x*V,this._y*V,this._z*V)}scaleToRef(V,O){return O._x=this._x*V,O._y=this._y*V,O._z=this._z*V,O._isDirty=!0,O}getNormalToRef(V){const O=this.length();let Z=Math.acos(this.y/O);const d=Math.atan2(this.z,this.x);Z>Math.PI/2?Z-=Math.PI/2:Z+=Math.PI/2;const p=O*Math.sin(Z)*Math.cos(d),r=O*Math.cos(Z),Y=O*Math.sin(Z)*Math.sin(d);return V.set(p,r,Y),V}applyRotationQuaternionToRef(V,O){const Z=this._x,d=this._y,p=this._z,r=V._x,Y=V._y,m=V._z,a=V._w,R=2*(Y*p-m*d),i=2*(m*Z-r*p),M=2*(r*d-Y*Z);return O._x=Z+a*R+Y*M-m*i,O._y=d+a*i+m*R-r*M,O._z=p+a*M+r*i-Y*R,O._isDirty=!0,O}applyRotationQuaternionInPlace(V){return this.applyRotationQuaternionToRef(V,this)}applyRotationQuaternion(V){return this.applyRotationQuaternionToRef(V,new M)}scaleAndAddToRef(V,O){return O._x+=this._x*V,O._y+=this._y*V,O._z+=this._z*V,O._isDirty=!0,O}projectOnPlane(V,O){return this.projectOnPlaneToRef(V,O,new M)}projectOnPlaneToRef(V,O,Z){const d=V.ab,p=V.d,r=Q.ib[0];this.subtractToRef(O,r),r.normalize();const Y=M.Dot(r,d);if(Math.abs(Y)<1e-10)Z.rj(1/0);else{const V=-(M.Dot(O,d)+p)/Y,m=r.scaleInPlace(V);O.addToRef(m,Z)}return Z}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return V&&(0,a.A)(this._x,V._x,O)&&(0,a.A)(this._y,V._y,O)&&(0,a.A)(this._z,V._z,O)}equalsToFloats(V,O,Z){return this._x===V&&this._y===O&&this._z===Z}multiplyInPlace(V){return this._x*=V._x,this._y*=V._y,this._z*=V._z,this._isDirty=!0,this}multiply(V){return this.multiplyByFloats(V._x,V._y,V._z)}multiplyToRef(V,O){return O._x=this._x*V._x,O._y=this._y*V._y,O._z=this._z*V._z,O._isDirty=!0,O}multiplyByFloats(V,O,Z){return new M(this._x*V,this._y*O,this._z*Z)}divide(V){return new M(this._x/V._x,this._y/V._y,this._z/V._z)}divideToRef(V,O){return O._x=this._x/V._x,O._y=this._y/V._y,O._z=this._z/V._z,O._isDirty=!0,O}divideInPlace(V){return this._x=this._x/V._x,this._y=this._y/V._y,this._z=this._z/V._z,this._isDirty=!0,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V._x,V._y,V._z)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V._x,V._y,V._z)}minimizeInPlaceFromFloats(V,O,Z){return V<this._x&&(this.x=V),O<this._y&&(this.y=O),Z<this._z&&(this.z=Z),this}maximizeInPlaceFromFloats(V,O,Z){return V>this._x&&(this.x=V),O>this._y&&(this.y=O),Z>this._z&&(this.z=Z),this}isNonUniformWithinEpsilon(V){const O=Math.abs(this._x),Z=Math.abs(this._y);if(!(0,a.A)(O,Z,V))return!0;const d=Math.abs(this._z);return!(0,a.A)(O,d,V)||!(0,a.A)(Z,d,V)}get isNonUniform(){const V=Math.abs(this._x);if(V!==Math.abs(this._y))return!0;return V!==Math.abs(this._z)}floorToRef(V){return V._x=Math.floor(this._x),V._y=Math.floor(this._y),V._z=Math.floor(this._z),V._isDirty=!0,V}floor(){return new M(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(V){return V._x=this.x-Math.floor(this._x),V._y=this.y-Math.floor(this._y),V._z=this.z-Math.floor(this._z),V._isDirty=!0,V}fract(){return new M(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(V){if("xyz"===(V=V.toLowerCase()))return this;const O=Q.ib[0].p(this);return this.x=O[V[0]],this.y=O[V[1]],this.z=O[V[2]],this}rotateByQuaternionToRef(V,O){return V.toRotationMatrix(Q.Matrix[0]),M.TransformCoordinatesToRef(this,Q.Matrix[0],O),O}rotateByQuaternionAroundPointToRef(V,O,Z){return this.subtractToRef(O,Q.ib[0]),Q.ib[0].rotateByQuaternionToRef(V,Q.ib[0]),O.addToRef(Q.ib[0],Z),Z}cross(V){return M.CrossToRef(this,V,new M)}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new M)}normalizeToRef(V){const O=this.length();return 0===O||1===O?(V._x=this._x,V._y=this._y,V._z=this._z,V._isDirty=!0,V):this.scaleToRef(1/O,V)}clone(){return new M(this._x,this._y,this._z)}p(V){return this.nf(V._x,V._y,V._z)}nf(V,O,Z){return this._x=V,this._y=O,this._z=Z,this._isDirty=!0,this}set(V,O,Z){return this.nf(V,O,Z)}rj(V){return this._x=this._y=this._z=V,this._isDirty=!0,this}static GetClipFactor(V,O,Z,d){const p=M.Dot(V,Z);return(p-d)/(p-M.Dot(O,Z))}static GetAngleBetweenVectors(V,O,Z){const d=V.normalizeToRef(Q.ib[1]),p=O.normalizeToRef(Q.ib[2]);let r=M.Dot(d,p);r=(0,a.c)(r,-1,1);const Y=Math.acos(r),m=Q.ib[3];return M.CrossToRef(d,p,m),M.Dot(m,Z)>0?isNaN(Y)?0:Y:isNaN(Y)?-Math.PI:-Math.acos(r)}static GetAngleBetweenVectorsOnPlane(V,O,Z){Q.ib[0].p(V);const d=Q.ib[0];Q.ib[1].p(O);const p=Q.ib[1];Q.ib[2].p(Z);const r=Q.ib[2],Y=Q.ib[3],m=Q.ib[4];d.normalize(),p.normalize(),r.normalize(),M.CrossToRef(r,d,Y),M.CrossToRef(Y,r,m);const R=Math.atan2(M.Dot(p,Y),M.Dot(p,m));return(0,a.q)(R)}static PitchYawRollToMoveBetweenPointsToRef(V,O,Z){const d=b.ib[0];return O.subtractToRef(V,d),Z._y=Math.atan2(d.x,d.z)||0,Z._x=Math.atan2(Math.sqrt(d.x**2+d.z**2),d.y)||0,Z._z=0,Z._isDirty=!0,Z}static PitchYawRollToMoveBetweenPoints(V,O){const Z=M.Zero();return M.PitchYawRollToMoveBetweenPointsToRef(V,O,Z)}static SlerpToRef(V,O,Z,p){Z=(0,a.c)(Z,0,1);const r=Q.ib[0],Y=Q.ib[1];r.p(V);const m=r.length();r.normalizeFromLength(m),Y.p(O);const R=Y.length();Y.normalizeFromLength(R);const i=M.Dot(r,Y);let c,W;if(i<1-d.c){const V=Math.acos(i),O=1/Math.sin(V);c=Math.sin((1-Z)*V)*O,W=Math.sin(Z*V)*O}else c=1-Z,W=Z;return r.scaleInPlace(c),Y.scaleInPlace(W),p.p(r).addInPlace(Y),p.scaleInPlace((0,a.m)(m,R,Z)),p}static SmoothToRef(V,O,Z,d,p){return M.SlerpToRef(V,O,0===d?1:Z/d,p),p}static Cg(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new M(V[O],V[O+1],V[O+2])}static FromFloatArray(V,O){return M.Cg(V,O)}static FromArrayToRef(V,O,Z){return Z._x=V[O],Z._y=V[O+1],Z._z=V[O+2],Z._isDirty=!0,Z}static FromFloatArrayToRef(V,O,Z){return M.FromArrayToRef(V,O,Z)}static FromFloatsToRef(V,O,Z,d){return d.nf(V,O,Z),d}static Zero(){return new M(0,0,0)}static One(){return new M(1,1,1)}static Up(){return new M(0,1,0)}static get UpReadOnly(){return M._UpReadOnly}static get DownReadOnly(){return M._DownReadOnly}static get RightReadOnly(){return M._RightReadOnly}static get LeftReadOnly(){return M._LeftReadOnly}static get LeftHandedForwardReadOnly(){return M._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return M._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return M._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return M._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return M._ZeroReadOnly}static get OneReadOnly(){return M._OneReadOnly}static Down(){return new M(0,-1,0)}static Forward(){return new M(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new M(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new M(1,0,0)}static Left(){return new M(-1,0,0)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new M((0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).nf((0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O))}static TransformCoordinates(V,O){const Z=M.Zero();return M.TransformCoordinatesToRef(V,O,Z),Z}static TransformCoordinatesToRef(V,O,Z){return M.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,O,Z),Z}static TransformCoordinatesFromFloatsToRef(V,O,Z,d,p){const r=d.m,Y=V*r[0]+O*r[4]+Z*r[8]+r[12],m=V*r[1]+O*r[5]+Z*r[9]+r[13],a=V*r[2]+O*r[6]+Z*r[10]+r[14],R=1/(V*r[3]+O*r[7]+Z*r[11]+r[15]);return p._x=Y*R,p._y=m*R,p._z=a*R,p._isDirty=!0,p}static TransformNormal(V,O){const Z=M.Zero();return M.TransformNormalToRef(V,O,Z),Z}static TransformNormalToRef(V,O,Z){return this.TransformNormalFromFloatsToRef(V._x,V._y,V._z,O,Z),Z}static TransformNormalFromFloatsToRef(V,O,Z,d,p){const r=d.m;return p._x=V*r[0]+O*r[4]+Z*r[8],p._y=V*r[1]+O*r[5]+Z*r[9],p._z=V*r[2]+O*r[6]+Z*r[10],p._isDirty=!0,p}static CatmullRom(V,O,Z,d,p){const r=p*p,Y=p*r,m=.5*(2*O._x+(-V._x+Z._x)*p+(2*V._x-5*O._x+4*Z._x-d._x)*r+(-V._x+3*O._x-3*Z._x+d._x)*Y),a=.5*(2*O._y+(-V._y+Z._y)*p+(2*V._y-5*O._y+4*Z._y-d._y)*r+(-V._y+3*O._y-3*Z._y+d._y)*Y),R=.5*(2*O._z+(-V._z+Z._z)*p+(2*V._z-5*O._z+4*Z._z-d._z)*r+(-V._z+3*O._z-3*Z._z+d._z)*Y);return new M(m,a,R)}static Clamp(V,O,Z){const d=new M;return M.ClampToRef(V,O,Z,d),d}static ClampToRef(V,O,Z,d){let p=V._x;p=p>Z._x?Z._x:p,p=p<O._x?O._x:p;let r=V._y;r=r>Z._y?Z._y:r,r=r<O._y?O._y:r;let Y=V._z;return Y=Y>Z._z?Z._z:Y,Y=Y<O._z?O._z:Y,d.nf(p,r,Y),d}static CheckExtends(V,O,Z){O.minimizeInPlace(V),Z.maximizeInPlace(V)}static Hermite(V,O,Z,d,p){const r=p*p,Y=p*r,m=2*Y-3*r+1,a=-2*Y+3*r,R=Y-2*r+p,i=Y-r,c=V._x*m+Z._x*a+O._x*R+d._x*i,W=V._y*m+Z._y*a+O._y*R+d._y*i,F=V._z*m+Z._z*a+O._z*R+d._z*i;return new M(c,W,F)}static Hermite1stDerivative(V,O,Z,d,p){const r=new M;return this.Hermite1stDerivativeToRef(V,O,Z,d,p,r),r}static Hermite1stDerivativeToRef(V,O,Z,d,p,r){const Y=p*p;return r._x=6*(Y-p)*V._x+(3*Y-4*p+1)*O._x+6*(-Y+p)*Z._x+(3*Y-2*p)*d._x,r._y=6*(Y-p)*V._y+(3*Y-4*p+1)*O._y+6*(-Y+p)*Z._y+(3*Y-2*p)*d._y,r._z=6*(Y-p)*V._z+(3*Y-4*p+1)*O._z+6*(-Y+p)*Z._z+(3*Y-2*p)*d._z,r._isDirty=!0,r}static Lerp(V,O,Z){const d=new M(0,0,0);return M.LerpToRef(V,O,Z,d),d}static LerpToRef(V,O,Z,d){return d._x=V._x+(O._x-V._x)*Z,d._y=V._y+(O._y-V._y)*Z,d._z=V._z+(O._z-V._z)*Z,d._isDirty=!0,d}static Dot(V,O){return V._x*O._x+V._y*O._y+V._z*O._z}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z}static Cross(V,O){const Z=new M;return M.CrossToRef(V,O,Z),Z}static CrossToRef(V,O,Z){const d=V._y*O._z-V._z*O._y,p=V._z*O._x-V._x*O._z,r=V._x*O._y-V._y*O._x;return Z.nf(d,p,r),Z}static Normalize(V){const O=M.Zero();return M.NormalizeToRef(V,O),O}static NormalizeToRef(V,O){return V.normalizeToRef(O),O}static Project(V,O,Z,d){const p=new M;return M.ProjectToRef(V,O,Z,d,p),p}static ProjectToRef(V,O,Z,d,p){var r;const Y=d.width,a=d.height,R=d.x,i=d.y,c=Q.Matrix[1],W=null===(r=m.e.LastCreatedEngine)||void 0===r?void 0:r.isNDCHalfZRange,b=W?1:.5,U=W?0:.5;F.FromValuesToRef(Y/2,0,0,0,0,-a/2,0,0,0,0,b,0,R+Y/2,a/2+i,U,1,c);const H=Q.Matrix[0];return O.multiplyToRef(Z,H),H.multiplyToRef(c,H),M.TransformCoordinatesToRef(V,H,p),p}static Reflect(V,O){return this.ReflectToRef(V,O,new M)}static ReflectToRef(V,O,Z){const d=b.ib[0];return d.p(O).scaleInPlace(2*M.Dot(V,O)),Z.p(V).bi(d)}static _UnprojectFromInvertedMatrixToRef(V,O,Z){M.TransformCoordinatesToRef(V,O,Z);const d=O.m,p=V._x*d[3]+V._y*d[7]+V._z*d[11]+d[15];return(0,a.A)(p,1)&&Z.scaleInPlace(1/p),Z}static UnprojectFromTransform(V,O,Z,d,p){return this.Unproject(V,O,Z,d,p,F.IdentityReadOnly)}static Unproject(V,O,Z,d,p,r){const Y=new M;return M.UnprojectToRef(V,O,Z,d,p,r,Y),Y}static UnprojectToRef(V,O,Z,d,p,r,Y){return M.UnprojectFloatsToRef(V._x,V._y,V._z,O,Z,d,p,r,Y),Y}static UnprojectFloatsToRef(V,O,Z,d,p,r,Y,a,R){var i;const c=Q.Matrix[0];r.multiplyToRef(Y,c),c.multiplyToRef(a,c),c.invert();const W=Q.ib[0];return W.x=V/d*2-1,W.y=-(O/p*2-1),null!==(i=m.e.LastCreatedEngine)&&void 0!==i&&i.isNDCHalfZRange?W.z=Z:W.z=2*Z-1,M._UnprojectFromInvertedMatrixToRef(W,c,R),R}static Minimize(V,O){const Z=new M;return Z.p(V),Z.minimizeInPlace(O),Z}static Maximize(V,O){const Z=new M;return Z.p(V),Z.maximizeInPlace(O),Z}static Distance(V,O){return Math.sqrt(M.DistanceSquared(V,O))}static DistanceSquared(V,O){const Z=V._x-O._x,d=V._y-O._y,p=V._z-O._z;return Z*Z+d*d+p*p}static ProjectOnTriangleToRef(V,O,Z,p,r){const Y=Q.ib[0],m=Q.ib[1],R=Q.ib[2],i=Q.ib[3],c=Q.ib[4];Z.subtractToRef(O,Y),p.subtractToRef(O,m),p.subtractToRef(Z,R);const W=Y.length(),F=m.length(),b=R.length();if(W<d.c||F<d.c||b<d.c)return r.p(O),M.Distance(V,O);V.subtractToRef(O,c),M.CrossToRef(Y,m,i);const U=i.length();if(U<d.c)return r.p(O),M.Distance(V,O);i.normalizeFromLength(U);let H=c.length();if(H<d.c)return r.p(O),0;c.normalizeFromLength(H);const S=M.Dot(i,c),z=Q.ib[5],G=Q.ib[6];z.p(i).scaleInPlace(-H*S),G.p(V).addInPlace(z);const w=Q.ib[4],t=Q.ib[5],C=Q.ib[7],v=Q.ib[8];w.p(Y).scaleInPlace(1/W),v.p(m).scaleInPlace(1/F),w.addInPlace(v).scaleInPlace(-1),t.p(Y).scaleInPlace(-1/W),v.p(R).scaleInPlace(1/b),t.addInPlace(v).scaleInPlace(-1),C.p(R).scaleInPlace(-1/b),v.p(m).scaleInPlace(-1/F),C.addInPlace(v).scaleInPlace(-1);const A=Q.ib[9];let l;A.p(G).bi(O),M.CrossToRef(w,A,v),l=M.Dot(v,i);const I=l;A.p(G).bi(Z),M.CrossToRef(t,A,v),l=M.Dot(v,i);const g=l;A.p(G).bi(p),M.CrossToRef(C,A,v),l=M.Dot(v,i);const n=l,e=Q.ib[10];let u,k;I>0&&g<0?(e.p(Y),u=O,k=Z):g>0&&n<0?(e.p(R),u=Z,k=p):(e.p(m).scaleInPlace(-1),u=p,k=O);const D=Q.ib[9],X=Q.ib[4];u.subtractToRef(G,v),k.subtractToRef(G,D),M.CrossToRef(v,D,X);if(!(M.Dot(X,i)<0))return r.p(G),Math.abs(H*S);const o=Q.ib[5];M.CrossToRef(e,X,o),o.normalize();const E=Q.ib[9];E.p(u).bi(G);const L=E.length();if(L<d.c)return r.p(u),M.Distance(V,u);E.normalizeFromLength(L);const J=M.Dot(o,E),N=Q.ib[7];N.p(G).addInPlace(o.scaleInPlace(L*J)),v.p(N).bi(u),H=e.length(),e.normalizeFromLength(H);let P=M.Dot(v,e)/Math.max(H,d.c);return P=(0,a.c)(P,0,1),N.p(u).addInPlace(e.scaleInPlace(P*H)),r.p(N),M.Distance(V,N)}static Center(V,O){return M.CenterToRef(V,O,M.Zero())}static CenterToRef(V,O,Z){return Z.nf((V._x+O._x)/2,(V._y+O._y)/2,(V._z+O._z)/2)}static RotationFromAxis(V,O,Z){const d=new M;return M.RotationFromAxisToRef(V,O,Z,d),d}static RotationFromAxisToRef(V,O,Z,d){const p=Q.Quaternion[0];return W.RotationQuaternionFromAxisToRef(V,O,Z,p),p.toEulerAnglesToRef(d),d}}M._UpReadOnly=M.Up(),M._DownReadOnly=M.Down(),M._LeftHandedForwardReadOnly=M.Forward(!1),M._RightHandedForwardReadOnly=M.Forward(!0),M._LeftHandedBackwardReadOnly=M.Backward(!1),M._RightHandedBackwardReadOnly=M.Backward(!0),M._RightReadOnly=M.Right(),M._LeftReadOnly=M.Left(),M._ZeroReadOnly=M.Zero(),M._OneReadOnly=M.One(),Object.defineProperties(M.prototype,{dimension:{value:[3]},rank:{value:1}});class c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=V,this.y=O,this.z=Z,this.w=d}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let V=R(this.x);return V=397*V^R(this.y),V=397*V^R(this.z),V=397*V^R(this.w),V}Wi(){return[this.x,this.y,this.z,this.w]}toArray(V,O){return void 0===O&&(O=0),V[O]=this.x,V[O+1]=this.y,V[O+2]=this.z,V[O+3]=this.w,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return c.FromArrayToRef(V,O,this),this}addInPlace(V){return this.x+=V.x,this.y+=V.y,this.z+=V.z,this.w+=V.w,this}addInPlaceFromFloats(V,O,Z,d){return this.x+=V,this.y+=O,this.z+=Z,this.w+=d,this}add(V){return new c(this.x+V.x,this.y+V.y,this.z+V.z,this.w+V.w)}addToRef(V,O){return O.x=this.x+V.x,O.y=this.y+V.y,O.z=this.z+V.z,O.w=this.w+V.w,O}bi(V){return this.x-=V.x,this.y-=V.y,this.z-=V.z,this.w-=V.w,this}fc(V){return new c(this.x-V.x,this.y-V.y,this.z-V.z,this.w-V.w)}subtractToRef(V,O){return O.x=this.x-V.x,O.y=this.y-V.y,O.z=this.z-V.z,O.w=this.w-V.w,O}subtractFromFloats(V,O,Z,d){return new c(this.x-V,this.y-O,this.z-Z,this.w-d)}subtractFromFloatsToRef(V,O,Z,d,p){return p.x=this.x-V,p.y=this.y-O,p.z=this.z-Z,p.w=this.w-d,p}negate(){return new c(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(V){return V.x=-this.x,V.y=-this.y,V.z=-this.z,V.w=-this.w,V}scaleInPlace(V){return this.x*=V,this.y*=V,this.z*=V,this.w*=V,this}scale(V){return new c(this.x*V,this.y*V,this.z*V,this.w*V)}scaleToRef(V,O){return O.x=this.x*V,O.y=this.y*V,O.z=this.z*V,O.w=this.w*V,O}scaleAndAddToRef(V,O){return O.x+=this.x*V,O.y+=this.y*V,O.z+=this.z*V,O.w+=this.w*V,O}equals(V){return V&&this.x===V.x&&this.y===V.y&&this.z===V.z&&this.w===V.w}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return V&&(0,a.A)(this.x,V.x,O)&&(0,a.A)(this.y,V.y,O)&&(0,a.A)(this.z,V.z,O)&&(0,a.A)(this.w,V.w,O)}equalsToFloats(V,O,Z,d){return this.x===V&&this.y===O&&this.z===Z&&this.w===d}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this.z*=V.z,this.w*=V.w,this}multiply(V){return new c(this.x*V.x,this.y*V.y,this.z*V.z,this.w*V.w)}multiplyToRef(V,O){return O.x=this.x*V.x,O.y=this.y*V.y,O.z=this.z*V.z,O.w=this.w*V.w,O}multiplyByFloats(V,O,Z,d){return new c(this.x*V,this.y*O,this.z*Z,this.w*d)}divide(V){return new c(this.x/V.x,this.y/V.y,this.z/V.z,this.w/V.w)}divideToRef(V,O){return O.x=this.x/V.x,O.y=this.y/V.y,O.z=this.z/V.z,O.w=this.w/V.w,O}divideInPlace(V){return this.divideToRef(V,this)}minimizeInPlace(V){return V.x<this.x&&(this.x=V.x),V.y<this.y&&(this.y=V.y),V.z<this.z&&(this.z=V.z),V.w<this.w&&(this.w=V.w),this}maximizeInPlace(V){return V.x>this.x&&(this.x=V.x),V.y>this.y&&(this.y=V.y),V.z>this.z&&(this.z=V.z),V.w>this.w&&(this.w=V.w),this}minimizeInPlaceFromFloats(V,O,Z,d){return this.x=Math.min(V,this.x),this.y=Math.min(O,this.y),this.z=Math.min(Z,this.z),this.w=Math.min(d,this.w),this}maximizeInPlaceFromFloats(V,O,Z,d){return this.x=Math.max(V,this.x),this.y=Math.max(O,this.y),this.z=Math.max(Z,this.z),this.w=Math.max(d,this.w),this}floorToRef(V){return V.x=Math.floor(this.x),V.y=Math.floor(this.y),V.z=Math.floor(this.z),V.w=Math.floor(this.w),V}floor(){return new c(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(V){return V.x=this.x-Math.floor(this.x),V.y=this.y-Math.floor(this.y),V.z=this.z-Math.floor(this.z),V.w=this.w-Math.floor(this.w),V}fract(){return new c(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new c)}normalizeToRef(V){const O=this.length();return 0===O||1===O?(V.x=this.x,V.y=this.y,V.z=this.z,V.w=this.w,V):this.scaleToRef(1/O,V)}toVector3(){return new M(this.x,this.y,this.z)}clone(){return new c(this.x,this.y,this.z,this.w)}p(V){return this.x=V.x,this.y=V.y,this.z=V.z,this.w=V.w,this}nf(V,O,Z,d){return this.x=V,this.y=O,this.z=Z,this.w=d,this}set(V,O,Z,d){return this.nf(V,O,Z,d)}rj(V){return this.x=this.y=this.z=this.w=V,this}dot(V){return this.x*V.x+this.y*V.y+this.z*V.z+this.w*V.w}static Cg(V,O){return O||(O=0),new c(V[O],V[O+1],V[O+2],V[O+3])}static FromArrayToRef(V,O,Z){return Z.x=V[O],Z.y=V[O+1],Z.z=V[O+2],Z.w=V[O+3],Z}static FromFloatArrayToRef(V,O,Z){return c.FromArrayToRef(V,O,Z),Z}static FromFloatsToRef(V,O,Z,d,p){return p.x=V,p.y=O,p.z=Z,p.w=d,p}static Zero(){return new c(0,0,0,0)}static One(){return new c(1,1,1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c((0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;return Z.x=(0,a.u)(V,O),Z.y=(0,a.u)(V,O),Z.z=(0,a.u)(V,O),Z.w=(0,a.u)(V,O),Z}static Clamp(V,O,Z){return c.ClampToRef(V,O,Z,new c)}static ClampToRef(V,O,Z,d){return d.x=(0,a.c)(V.x,O.x,Z.x),d.y=(0,a.c)(V.y,O.y,Z.y),d.z=(0,a.c)(V.z,O.z,Z.z),d.w=(0,a.c)(V.w,O.w,Z.w),d}static CheckExtends(V,O,Z){O.minimizeInPlace(V),Z.maximizeInPlace(V)}static get ZeroReadOnly(){return c._ZeroReadOnly}static Normalize(V){return c.NormalizeToRef(V,new c)}static NormalizeToRef(V,O){return V.normalizeToRef(O),O}static Minimize(V,O){const Z=new c;return Z.p(V),Z.minimizeInPlace(O),Z}static Maximize(V,O){const Z=new c;return Z.p(V),Z.maximizeInPlace(O),Z}static Distance(V,O){return Math.sqrt(c.DistanceSquared(V,O))}static DistanceSquared(V,O){const Z=V.x-O.x,d=V.y-O.y,p=V.z-O.z,r=V.w-O.w;return Z*Z+d*d+p*p+r*r}static Center(V,O){return c.CenterToRef(V,O,new c)}static CenterToRef(V,O,Z){return Z.x=(V.x+O.x)/2,Z.y=(V.y+O.y)/2,Z.z=(V.z+O.z)/2,Z.w=(V.w+O.w)/2,Z}static TransformCoordinates(V,O){return c.TransformCoordinatesToRef(V,O,new c)}static TransformCoordinatesToRef(V,O,Z){return c.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,O,Z),Z}static TransformCoordinatesFromFloatsToRef(V,O,Z,d,p){const r=d.m,Y=V*r[0]+O*r[4]+Z*r[8]+r[12],m=V*r[1]+O*r[5]+Z*r[9]+r[13],a=V*r[2]+O*r[6]+Z*r[10]+r[14],R=V*r[3]+O*r[7]+Z*r[11]+r[15];return p.x=Y,p.y=m,p.z=a,p.w=R,p}static TransformNormal(V,O){return c.TransformNormalToRef(V,O,new c)}static TransformNormalToRef(V,O,Z){const d=O.m,p=V.x*d[0]+V.y*d[4]+V.z*d[8],r=V.x*d[1]+V.y*d[5]+V.z*d[9],Y=V.x*d[2]+V.y*d[6]+V.z*d[10];return Z.x=p,Z.y=r,Z.z=Y,Z.w=V.w,Z}static TransformNormalFromFloatsToRef(V,O,Z,d,p,r){const Y=p.m;return r.x=V*Y[0]+O*Y[4]+Z*Y[8],r.y=V*Y[1]+O*Y[5]+Z*Y[9],r.z=V*Y[2]+O*Y[6]+Z*Y[10],r.w=d,r}static FromVector3(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(V._x,V._y,V._z,O)}static Dot(V,O){return V.x*O.x+V.y*O.y+V.z*O.z+V.w*O.w}}c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[4]},rank:{value:1}});class W{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}get w(){return this._w}set w(V){this._w=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=V,this._y=O,this._z=Z,this._w=d}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let V=R(this._x);return V=397*V^R(this._y),V=397*V^R(this._z),V=397*V^R(this._w),V}Wi(){return[this._x,this._y,this._z,this._w]}toArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[O]=this._x,V[O+1]=this._y,V[O+2]=this._z,V[O+3]=this._w,this}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return W.FromArrayToRef(V,O,this)}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z&&this._w===V._w}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return V&&(0,a.A)(this._x,V._x,O)&&(0,a.A)(this._y,V._y,O)&&(0,a.A)(this._z,V._z,O)&&(0,a.A)(this._w,V._w,O)}clone(){return new W(this._x,this._y,this._z,this._w)}p(V){return this._x=V._x,this._y=V._y,this._z=V._z,this._w=V._w,this._isDirty=!0,this}nf(V,O,Z,d){return this._x=V,this._y=O,this._z=Z,this._w=d,this._isDirty=!0,this}set(V,O,Z,d){return this.nf(V,O,Z,d)}rj(V){return this.nf(V,V,V,V)}add(V){return new W(this._x+V._x,this._y+V._y,this._z+V._z,this._w+V._w)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._w+=V._w,this._isDirty=!0,this}addToRef(V,O){return O._x=this._x+V._x,O._y=this._y+V._y,O._z=this._z+V._z,O._w=this._w+V._w,O._isDirty=!0,O}addInPlaceFromFloats(V,O,Z,d){return this._x+=V,this._y+=O,this._z+=Z,this._w+=d,this._isDirty=!0,this}subtractToRef(V,O){return O._x=this._x-V._x,O._y=this._y-V._y,O._z=this._z-V._z,O._w=this._w-V._w,O._isDirty=!0,O}subtractFromFloats(V,O,Z,d){return this.subtractFromFloatsToRef(V,O,Z,d,new W)}subtractFromFloatsToRef(V,O,Z,d,p){return p._x=this._x-V,p._y=this._y-O,p._z=this._z-Z,p._w=this._w-d,p._isDirty=!0,p}fc(V){return new W(this._x-V._x,this._y-V._y,this._z-V._z,this._w-V._w)}bi(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._w-=V._w,this._isDirty=!0,this}scale(V){return new W(this._x*V,this._y*V,this._z*V,this._w*V)}scaleToRef(V,O){return O._x=this._x*V,O._y=this._y*V,O._z=this._z*V,O._w=this._w*V,O._isDirty=!0,O}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._w*=V,this._isDirty=!0,this}scaleAndAddToRef(V,O){return O._x+=this._x*V,O._y+=this._y*V,O._z+=this._z*V,O._w+=this._w*V,O._isDirty=!0,O}multiply(V){const O=new W(0,0,0,1);return this.multiplyToRef(V,O),O}multiplyToRef(V,O){const Z=this._x*V._w+this._y*V._z-this._z*V._y+this._w*V._x,d=-this._x*V._z+this._y*V._w+this._z*V._x+this._w*V._y,p=this._x*V._y-this._y*V._x+this._z*V._w+this._w*V._z,r=-this._x*V._x-this._y*V._y-this._z*V._z+this._w*V._w;return O.nf(Z,d,p,r),O}multiplyInPlace(V){return this.multiplyToRef(V,this)}multiplyByFloats(V,O,Z,d){return this._x*=V,this._y*=O,this._z*=Z,this._w*=d,this._isDirty=!0,this}divide(V){throw new ReferenceError("Can not divide a quaternion")}divideToRef(V,O){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(V){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new W)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(V){return V._x=-this._x,V._y=-this._y,V._z=-this._z,V._w=-this._w,V._isDirty=!0,V}equalsToFloats(V,O,Z,d){return this._x===V&&this._y===O&&this._z===Z&&this._w===d}floorToRef(V){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(V){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(V){return V.nf(-this._x,-this._y,-this._z,this._w),V}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new W(-this._x,-this._y,-this._z,this._w)}invert(){const V=this.conjugate(),O=this.lengthSquared();return 0==O||1==O||V.scaleInPlace(1/O),V}invertInPlace(){this.conjugateInPlace();const V=this.lengthSquared();return 0==V||1==V||this.scaleInPlace(1/V),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new W(0,0,0,1);return this.normalizeToRef(V),V}normalizeToRef(V){const O=this.length();return 0===O||1===O?V.nf(this._x,this._y,this._z,this._w):this.scaleToRef(1/O,V)}toEulerAngles(){const V=M.Zero();return this.toEulerAnglesToRef(V),V}toEulerAnglesToRef(V){const O=this._z,Z=this._x,d=this._y,p=this._w,r=d*O-Z*p,Y=.4999999;if(r<-Y)V._y=2*Math.atan2(d,p),V._x=Math.PI/2,V._z=0,V._isDirty=!0;else if(r>Y)V._y=2*Math.atan2(d,p),V._x=-Math.PI/2,V._z=0,V._isDirty=!0;else{const Y=p*p,m=O*O,a=Z*Z,R=d*d;V._z=Math.atan2(2*(Z*d+O*p),-m-a+R+Y),V._x=Math.asin(-2*r),V._y=Math.atan2(2*(O*Z+d*p),m-a-R+Y),V._isDirty=!0}return V}toAlphaBetaGammaToRef(V){const O=this._z,Z=this._x,d=this._y,p=this._w,r=Math.sqrt(Z*Z+d*d),Y=Math.sqrt(O*O+p*p),m=2*Math.atan2(r,Y),a=2*Math.atan2(O,p),R=2*Math.atan2(d,Z),i=(a+R)/2,M=(a-R)/2;return V.set(M,m,i),V}toRotationMatrix(V){return F.FromQuaternionToRef(this,V),V}fromRotationMatrix(V){return W.FromRotationMatrixToRef(V,this),this}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z+this._w*V._w}static FromRotationMatrix(V){const O=new W;return W.FromRotationMatrixToRef(V,O),O}static FromRotationMatrixToRef(V,O){const Z=V.m,d=Z[0],p=Z[4],r=Z[8],Y=Z[1],m=Z[5],a=Z[9],R=Z[2],i=Z[6],M=Z[10],c=d+m+M;let W;return c>0?(W=.5/Math.sqrt(c+1),O._w=.25/W,O._x=(i-a)*W,O._y=(r-R)*W,O._z=(Y-p)*W,O._isDirty=!0):d>m&&d>M?(W=2*Math.sqrt(1+d-m-M),O._w=(i-a)/W,O._x=.25*W,O._y=(p+Y)/W,O._z=(r+R)/W,O._isDirty=!0):m>M?(W=2*Math.sqrt(1+m-d-M),O._w=(r-R)/W,O._x=(p+Y)/W,O._y=.25*W,O._z=(a+i)/W,O._isDirty=!0):(W=2*Math.sqrt(1+M-d-m),O._w=(Y-p)/W,O._x=(r+R)/W,O._y=(a+i)/W,O._z=.25*W,O._isDirty=!0),O}static Dot(V,O){return V._x*O._x+V._y*O._y+V._z*O._z+V._w*O._w}static AreClose(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const d=W.Dot(V,O);return 1-d*d<=Z}static SmoothToRef(V,O,Z,d,p){let r=0===d?1:Z/d;return r=(0,a.c)(r,0,1),W.SlerpToRef(V,O,r,p),p}static Zero(){return new W(0,0,0,0)}static Inverse(V){return new W(-V._x,-V._y,-V._z,V._w)}static InverseToRef(V,O){return O.set(-V._x,-V._y,-V._z,V._w),O}static Identity(){return new W(0,0,0,1)}static IsIdentity(V){return V&&0===V._x&&0===V._y&&0===V._z&&1===V._w}static RotationAxis(V,O){return W.RotationAxisToRef(V,O,new W)}static RotationAxisToRef(V,O,Z){Z._w=Math.cos(O/2);const d=Math.sin(O/2)/V.length();return Z._x=V._x*d,Z._y=V._y*d,Z._z=V._z*d,Z._isDirty=!0,Z}static Cg(V,O){return O||(O=0),new W(V[O],V[O+1],V[O+2],V[O+3])}static FromArrayToRef(V,O,Z){return Z._x=V[O],Z._y=V[O+1],Z._z=V[O+2],Z._w=V[O+3],Z._isDirty=!0,Z}static FromFloatsToRef(V,O,Z,d,p){return p.nf(V,O,Z,d),p}static FromEulerAngles(V,O,Z){const d=new W;return W.RotationYawPitchRollToRef(O,V,Z,d),d}static FromEulerAnglesToRef(V,O,Z,d){return W.RotationYawPitchRollToRef(O,V,Z,d),d}static FromEulerVector(V){const O=new W;return W.RotationYawPitchRollToRef(V._y,V._x,V._z,O),O}static FromEulerVectorToRef(V,O){return W.RotationYawPitchRollToRef(V._y,V._x,V._z,O),O}static FromUnitVectorsToRef(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.c;const r=M.Dot(V,O)+1;return r<p?Math.abs(V.x)>Math.abs(V.z)?Z.set(-V.y,V.x,0,0):Z.set(0,-V.z,V.y,0):(M.CrossToRef(V,O,b.ib[0]),Z.set(b.ib[0].x,b.ib[0].y,b.ib[0].z,r)),Z.normalize()}static RotationYawPitchRoll(V,O,Z){const d=new W;return W.RotationYawPitchRollToRef(V,O,Z,d),d}static RotationYawPitchRollToRef(V,O,Z,d){const p=.5*Z,r=.5*O,Y=.5*V,m=Math.sin(p),a=Math.cos(p),R=Math.sin(r),i=Math.cos(r),M=Math.sin(Y),c=Math.cos(Y);return d._x=c*R*a+M*i*m,d._y=M*i*a-c*R*m,d._z=c*i*m-M*R*a,d._w=c*i*a+M*R*m,d._isDirty=!0,d}static RotationAlphaBetaGamma(V,O,Z){const d=new W;return W.RotationAlphaBetaGammaToRef(V,O,Z,d),d}static RotationAlphaBetaGammaToRef(V,O,Z,d){const p=.5*(Z+V),r=.5*(Z-V),Y=.5*O;return d._x=Math.cos(r)*Math.sin(Y),d._y=Math.sin(r)*Math.sin(Y),d._z=Math.sin(p)*Math.cos(Y),d._w=Math.cos(p)*Math.cos(Y),d._isDirty=!0,d}static RotationQuaternionFromAxis(V,O,Z){const d=new W(0,0,0,0);return W.RotationQuaternionFromAxisToRef(V,O,Z,d),d}static RotationQuaternionFromAxisToRef(V,O,Z,d){const p=Q.Matrix[0];return V=V.normalizeToRef(Q.ib[0]),O=O.normalizeToRef(Q.ib[1]),Z=Z.normalizeToRef(Q.ib[2]),F.FromXYZAxesToRef(V,O,Z,p),W.FromRotationMatrixToRef(p,d),d}static FromLookDirectionLH(V,O){const Z=new W;return W.FromLookDirectionLHToRef(V,O,Z),Z}static FromLookDirectionLHToRef(V,O,Z){const d=Q.Matrix[0];return F.LookDirectionLHToRef(V,O,d),W.FromRotationMatrixToRef(d,Z),Z}static FromLookDirectionRH(V,O){const Z=new W;return W.FromLookDirectionRHToRef(V,O,Z),Z}static FromLookDirectionRHToRef(V,O,Z){const d=Q.Matrix[0];return F.LookDirectionRHToRef(V,O,d),W.FromRotationMatrixToRef(d,Z)}static Slerp(V,O,Z){const d=W.Identity();return W.SlerpToRef(V,O,Z,d),d}static SlerpToRef(V,O,Z,d){let p,r,Y=V._x*O._x+V._y*O._y+V._z*O._z+V._w*O._w,m=!1;if(Y<0&&(m=!0,Y=-Y),Y>.999999)r=1-Z,p=m?-Z:Z;else{const V=Math.acos(Y),O=1/Math.sin(V);r=Math.sin((1-Z)*V)*O,p=m?-Math.sin(Z*V)*O:Math.sin(Z*V)*O}return d._x=r*V._x+p*O._x,d._y=r*V._y+p*O._y,d._z=r*V._z+p*O._z,d._w=r*V._w+p*O._w,d._isDirty=!0,d}static Hermite(V,O,Z,d,p){const r=p*p,Y=p*r,m=2*Y-3*r+1,a=-2*Y+3*r,R=Y-2*r+p,i=Y-r,M=V._x*m+Z._x*a+O._x*R+d._x*i,c=V._y*m+Z._y*a+O._y*R+d._y*i,F=V._z*m+Z._z*a+O._z*R+d._z*i,Q=V._w*m+Z._w*a+O._w*R+d._w*i;return new W(M,c,F,Q)}static Hermite1stDerivative(V,O,Z,d,p){const r=new W;return this.Hermite1stDerivativeToRef(V,O,Z,d,p,r),r}static Hermite1stDerivativeToRef(V,O,Z,d,p,r){const Y=p*p;return r._x=6*(Y-p)*V._x+(3*Y-4*p+1)*O._x+6*(-Y+p)*Z._x+(3*Y-2*p)*d._x,r._y=6*(Y-p)*V._y+(3*Y-4*p+1)*O._y+6*(-Y+p)*Z._y+(3*Y-2*p)*d._y,r._z=6*(Y-p)*V._z+(3*Y-4*p+1)*O._z+6*(-Y+p)*Z._z+(3*Y-2*p)*d._z,r._w=6*(Y-p)*V._w+(3*Y-4*p+1)*O._w+6*(-Y+p)*Z._w+(3*Y-2*p)*d._w,r._isDirty=!0,r}static Normalize(V){const O=W.Zero();return W.NormalizeToRef(V,O),O}static NormalizeToRef(V,O){return V.normalizeToRef(O),O}static Clamp(V,O,Z){const d=new W;return W.ClampToRef(V,O,Z,d),d}static ClampToRef(V,O,Z,d){return d.nf((0,a.c)(V.x,O.x,Z.x),(0,a.c)(V.y,O.y,Z.y),(0,a.c)(V.z,O.z,Z.z),(0,a.c)(V.w,O.w,Z.w))}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new W((0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).nf((0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O),(0,a.u)(V,O))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(V,O){return Math.sqrt(W.DistanceSquared(V,O))}static DistanceSquared(V,O){const Z=V.x-O.x,d=V.y-O.y,p=V.z-O.z,r=V.w-O.w;return Z*Z+d*d+p*p+r*r}static Center(V,O){return W.CenterToRef(V,O,W.Zero())}static CenterToRef(V,O,Z){return Z.nf((V.x+O.x)/2,(V.y+O.y)/2,(V.z+O.z)/2,(V.w+O.w)/2)}}Object.defineProperties(W.prototype,{dimension:{value:[4]},rank:{value:1}});class F{static get Use64Bits(){return Y.b.MatrixUse64Bits}get m(){return this.Dj}markAsUpdated(){this.updateFlag=F._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=V,this._isIdentity3x2=V||Z,this._isIdentityDirty=!this._isIdentity&&O,this._isIdentity3x2Dirty=!this._isIdentity3x2&&d}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Y.b.MatrixTrackPrecisionChange&&Y.b.MatrixTrackedMatrices.push(this),this.Dj=new Y.b.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const V=this.Dj;this._isIdentity=1===V[0]&&0===V[1]&&0===V[2]&&0===V[3]&&0===V[4]&&1===V[5]&&0===V[6]&&0===V[7]&&0===V[8]&&0===V[9]&&1===V[10]&&0===V[11]&&0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Dj[0]||1!==this.Dj[5]||1!==this.Dj[15]||0!==this.Dj[1]||0!==this.Dj[2]||0!==this.Dj[3]||0!==this.Dj[4]||0!==this.Dj[6]||0!==this.Dj[7]||0!==this.Dj[8]||0!==this.Dj[9]||0!==this.Dj[10]||0!==this.Dj[11]||0!==this.Dj[12]||0!==this.Dj[13]||0!==this.Dj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const V=this.Dj,O=V[0],Z=V[1],d=V[2],p=V[3],r=V[4],Y=V[5],m=V[6],a=V[7],R=V[8],i=V[9],M=V[10],c=V[11],W=V[12],F=V[13],Q=V[14],b=V[15],U=M*b-Q*c,H=i*b-F*c,S=i*Q-F*M,z=R*b-W*c,G=R*Q-M*W,w=R*F-W*i;return O*+(Y*U-m*H+a*S)+Z*-(r*U-m*z+a*G)+d*+(r*H-Y*z+a*w)+p*-(r*S-Y*G+m*w)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!V)return this.Dj;const Z=this.Dj;for(let d=0;d<16;d++)V[O+d]=Z[d];return this}Wi(){return this.Dj}rc(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return F.FromArrayToRef(V,O,this)}nf(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];return F.FromArrayToRef(O,0,this)}set(){const V=this.Dj;for(let O=0;O<16;O++)V[O]=O<0||arguments.length<=O?void 0:arguments[O];return this.markAsUpdated(),this}rj(V){const O=this.Dj;for(let Z=0;Z<16;Z++)O[Z]=V;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return F.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(V){const O=new F;return this.addToRef(V,O),O}addToRef(V,O){const Z=this.Dj,d=O.Dj,p=V.m;for(let r=0;r<16;r++)d[r]=Z[r]+p[r];return O.markAsUpdated(),O}addToSelf(V){const O=this.Dj,Z=V.m;return O[0]+=Z[0],O[1]+=Z[1],O[2]+=Z[2],O[3]+=Z[3],O[4]+=Z[4],O[5]+=Z[5],O[6]+=Z[6],O[7]+=Z[7],O[8]+=Z[8],O[9]+=Z[9],O[10]+=Z[10],O[11]+=Z[11],O[12]+=Z[12],O[13]+=Z[13],O[14]+=Z[14],O[15]+=Z[15],this.markAsUpdated(),this}addInPlace(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]+=Z[d];return this.markAsUpdated(),this}addInPlaceFromFloats(){const V=this.Dj;for(let O=0;O<16;O++)V[O]+=O<0||arguments.length<=O?void 0:arguments[O];return this.markAsUpdated(),this}fc(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]-=Z[d];return this.markAsUpdated(),this}subtractToRef(V,O){const Z=this.Dj,d=V.m,p=O.Dj;for(let r=0;r<16;r++)p[r]=Z[r]-d[r];return O.markAsUpdated(),O}bi(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]-=Z[d];return this.markAsUpdated(),this}subtractFromFloats(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];return this.subtractFromFloatsToRef(...O,new F)}subtractFromFloatsToRef(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];const d=O.pop(),p=this.Dj,r=d.Dj,Y=O;for(let m=0;m<16;m++)r[m]=p[m]-Y[m];return d.markAsUpdated(),d}invertToRef(V){if(!0===this._isIdentity)return F.IdentityToRef(V),V;const O=this.Dj,Z=O[0],d=O[1],p=O[2],r=O[3],Y=O[4],m=O[5],a=O[6],R=O[7],i=O[8],M=O[9],c=O[10],W=O[11],Q=O[12],b=O[13],U=O[14],H=O[15],S=c*H-U*W,z=M*H-b*W,G=M*U-b*c,w=i*H-Q*W,t=i*U-c*Q,C=i*b-Q*M,v=+(m*S-a*z+R*G),A=-(Y*S-a*w+R*t),l=+(Y*z-m*w+R*C),I=-(Y*G-m*t+a*C),g=Z*v+d*A+p*l+r*I;if(0===g)return V.p(this),V;const n=1/g,e=a*H-U*R,u=m*H-b*R,k=m*U-b*a,D=Y*H-Q*R,X=Y*U-Q*a,o=Y*b-Q*m,E=a*W-c*R,L=m*W-M*R,J=m*c-M*a,N=Y*W-i*R,P=Y*c-i*a,f=Y*M-i*m,q=-(d*S-p*z+r*G),K=+(Z*S-p*w+r*t),s=-(Z*z-d*w+r*C),h=+(Z*G-d*t+p*C),x=+(d*e-p*u+r*k),y=-(Z*e-p*D+r*X),T=+(Z*u-d*D+r*o),B=-(Z*k-d*X+p*o),j=-(d*E-p*L+r*J),VV=+(Z*E-p*N+r*P),OV=-(Z*L-d*N+r*f),ZV=+(Z*J-d*P+p*f);return F.FromValuesToRef(v*n,q*n,x*n,j*n,A*n,K*n,y*n,VV*n,l*n,s*n,T*n,OV*n,I*n,h*n,B*n,ZV*n,V),V}addAtIndex(V,O){return this.Dj[V]+=O,this.markAsUpdated(),this}multiplyAtIndex(V,O){return this.Dj[V]*=O,this.markAsUpdated(),this}setTranslationFromFloats(V,O,Z){return this.Dj[12]=V,this.Dj[13]=O,this.Dj[14]=Z,this.markAsUpdated(),this}addTranslationFromFloats(V,O,Z){return this.Dj[12]+=V,this.Dj[13]+=O,this.Dj[14]+=Z,this.markAsUpdated(),this}setTranslation(V){return this.setTranslationFromFloats(V._x,V._y,V._z)}getTranslation(){return new M(this.Dj[12],this.Dj[13],this.Dj[14])}getTranslationToRef(V){return V.x=this.Dj[12],V.y=this.Dj[13],V.z=this.Dj[14],V}removeRotationAndScaling(){const V=this.m;return F.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V[12],V[13],V[14],V[15],this),this._updateIdentityStatus(0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]),this}p(V){V.copyToArray(this.Dj);const O=V;return this.updateFlag=O.updateFlag,this._updateIdentityStatus(O._isIdentity,O._isIdentityDirty,O._isIdentity3x2,O._isIdentity3x2Dirty),this}copyToArray(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.Dj;return V[O]=Z[0],V[O+1]=Z[1],V[O+2]=Z[2],V[O+3]=Z[3],V[O+4]=Z[4],V[O+5]=Z[5],V[O+6]=Z[6],V[O+7]=Z[7],V[O+8]=Z[8],V[O+9]=Z[9],V[O+10]=Z[10],V[O+11]=Z[11],V[O+12]=Z[12],V[O+13]=Z[13],V[O+14]=Z[14],V[O+15]=Z[15],this}multiply(V){const O=new F;return this.multiplyToRef(V,O),O}multiplyInPlace(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]*=Z[d];return this.markAsUpdated(),this}multiplyByFloats(){const V=this.Dj;for(let O=0;O<16;O++)V[O]*=O<0||arguments.length<=O?void 0:arguments[O];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];const d=O.pop(),p=this.Dj,r=d.Dj,Y=O;for(let m=0;m<16;m++)r[m]=p[m]*Y[m];return d.markAsUpdated(),d}multiplyToRef(V,O){return this._isIdentity?(O.p(V),O):V._isIdentity?(O.p(this),O):(this.multiplyToArray(V,O.Dj,0),O.markAsUpdated(),O)}multiplyToArray(V,O,Z){const d=this.Dj,p=V.m,r=d[0],Y=d[1],m=d[2],a=d[3],R=d[4],i=d[5],M=d[6],c=d[7],W=d[8],F=d[9],Q=d[10],b=d[11],U=d[12],H=d[13],S=d[14],z=d[15],G=p[0],w=p[1],t=p[2],C=p[3],v=p[4],A=p[5],l=p[6],I=p[7],g=p[8],n=p[9],e=p[10],u=p[11],k=p[12],D=p[13],X=p[14],o=p[15];return O[Z]=r*G+Y*v+m*g+a*k,O[Z+1]=r*w+Y*A+m*n+a*D,O[Z+2]=r*t+Y*l+m*e+a*X,O[Z+3]=r*C+Y*I+m*u+a*o,O[Z+4]=R*G+i*v+M*g+c*k,O[Z+5]=R*w+i*A+M*n+c*D,O[Z+6]=R*t+i*l+M*e+c*X,O[Z+7]=R*C+i*I+M*u+c*o,O[Z+8]=W*G+F*v+Q*g+b*k,O[Z+9]=W*w+F*A+Q*n+b*D,O[Z+10]=W*t+F*l+Q*e+b*X,O[Z+11]=W*C+F*I+Q*u+b*o,O[Z+12]=U*G+H*v+S*g+z*k,O[Z+13]=U*w+H*A+S*n+z*D,O[Z+14]=U*t+H*l+S*e+z*X,O[Z+15]=U*C+H*I+S*u+z*o,this}divide(V){return this.divideToRef(V,new F)}divideToRef(V,O){const Z=this.Dj,d=V.m,p=O.Dj;for(let r=0;r<16;r++)p[r]=Z[r]/d[r];return O.markAsUpdated(),O}divideInPlace(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]/=Z[d];return this.markAsUpdated(),this}minimizeInPlace(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]=Math.min(O[d],Z[d]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const V=this.Dj;for(let O=0;O<16;O++)V[O]=Math.min(V[O],O<0||arguments.length<=O?void 0:arguments[O]);return this.markAsUpdated(),this}maximizeInPlace(V){const O=this.Dj,Z=V.m;for(let d=0;d<16;d++)O[d]=Math.min(O[d],Z[d]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const V=this.Dj;for(let O=0;O<16;O++)V[O]=Math.min(V[O],O<0||arguments.length<=O?void 0:arguments[O]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new F)}negateInPlace(){const V=this.Dj;for(let O=0;O<16;O++)V[O]=-V[O];return this.markAsUpdated(),this}negateToRef(V){const O=this.Dj,Z=V.Dj;for(let d=0;d<16;d++)Z[d]=-O[d];return V.markAsUpdated(),V}equals(V){const O=V;if(!O)return!1;if((this._isIdentity||O._isIdentity)&&!this._isIdentityDirty&&!O._isIdentityDirty)return this._isIdentity&&O._isIdentity;const Z=this.m,d=O.m;return Z[0]===d[0]&&Z[1]===d[1]&&Z[2]===d[2]&&Z[3]===d[3]&&Z[4]===d[4]&&Z[5]===d[5]&&Z[6]===d[6]&&Z[7]===d[7]&&Z[8]===d[8]&&Z[9]===d[9]&&Z[10]===d[10]&&Z[11]===d[11]&&Z[12]===d[12]&&Z[13]===d[13]&&Z[14]===d[14]&&Z[15]===d[15]}equalsWithEpsilon(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.Dj,d=V.m;for(let p=0;p<16;p++)if(!(0,a.A)(Z[p],d[p],O))return!1;return!0}equalsToFloats(){const V=this.Dj;for(let O=0;O<16;O++)if(V[O]!=(O<0||arguments.length<=O?void 0:arguments[O]))return!1;return!0}floor(){return this.floorToRef(new F)}floorToRef(V){const O=this.Dj,Z=V.Dj;for(let d=0;d<16;d++)Z[d]=Math.floor(O[d]);return V.markAsUpdated(),V}fract(){return this.fractToRef(new F)}fractToRef(V){const O=this.Dj,Z=V.Dj;for(let d=0;d<16;d++)Z[d]=O[d]-Math.floor(O[d]);return V.markAsUpdated(),V}clone(){const V=new F;return V.p(this),V}getClassName(){return"Matrix"}getHashCode(){let V=R(this.Dj[0]);for(let O=1;O<16;O++)V=397*V^R(this.Dj[O]);return V}decomposeToTransformNode(V){return V.rotationQuaternion=V.rotationQuaternion||new W,this.decompose(V.Af,V.rotationQuaternion,V.position)}decompose(V,O,Z,d){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return Z&&Z.rj(0),V&&V.rj(1),O&&O.nf(0,0,0,1),!0;const r=this.Dj;if(Z&&Z.nf(r[12],r[13],r[14]),(V=V||Q.ib[0]).x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),V.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),V.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),d){const O=(p?d.absoluteScaling.x:d.Af.x)<0?-1:1,Z=(p?d.absoluteScaling.y:d.Af.y)<0?-1:1,r=(p?d.absoluteScaling.z:d.Af.z)<0?-1:1;V.x*=O,V.y*=Z,V.z*=r}else this.determinant()<=0&&(V.y*=-1);if(0===V._x||0===V._y||0===V._z)return O&&O.nf(0,0,0,1),!1;if(O){const Z=1/V._x,d=1/V._y,p=1/V._z;F.FromValuesToRef(r[0]*Z,r[1]*Z,r[2]*Z,0,r[4]*d,r[5]*d,r[6]*d,0,r[8]*p,r[9]*p,r[10]*p,0,0,0,0,1,Q.Matrix[0]),W.FromRotationMatrixToRef(Q.Matrix[0],O)}return!0}getRow(V){if(V<0||V>3)return null;const O=4*V;return new c(this.Dj[O+0],this.Dj[O+1],this.Dj[O+2],this.Dj[O+3])}getRowToRef(V,O){if(V>=0&&V<=3){const Z=4*V;O.x=this.Dj[Z+0],O.y=this.Dj[Z+1],O.z=this.Dj[Z+2],O.w=this.Dj[Z+3]}return O}setRow(V,O){return this.setRowFromFloats(V,O.x,O.y,O.z,O.w)}transpose(){const V=new F;return F.TransposeToRef(this,V),V}transposeToRef(V){return F.TransposeToRef(this,V),V}setRowFromFloats(V,O,Z,d,p){if(V<0||V>3)return this;const r=4*V;return this.Dj[r+0]=O,this.Dj[r+1]=Z,this.Dj[r+2]=d,this.Dj[r+3]=p,this.markAsUpdated(),this}scale(V){const O=new F;return this.scaleToRef(V,O),O}scaleToRef(V,O){for(let Z=0;Z<16;Z++)O.Dj[Z]=this.Dj[Z]*V;return O.markAsUpdated(),O}scaleAndAddToRef(V,O){for(let Z=0;Z<16;Z++)O.Dj[Z]+=this.Dj[Z]*V;return O.markAsUpdated(),O}scaleInPlace(V){const O=this.Dj;for(let Z=0;Z<16;Z++)O[Z]*=V;return this.markAsUpdated(),this}toNormalMatrix(V){const O=Q.Matrix[0];this.invertToRef(O),O.transposeToRef(V);const Z=V.Dj;return F.FromValuesToRef(Z[0],Z[1],Z[2],0,Z[4],Z[5],Z[6],0,Z[8],Z[9],Z[10],0,0,0,0,1,V),V}getRotationMatrix(){const V=new F;return this.getRotationMatrixToRef(V),V}getRotationMatrixToRef(V){const O=Q.ib[0];if(!this.decompose(O))return F.IdentityToRef(V),V;const Z=this.Dj,d=1/O._x,p=1/O._y,r=1/O._z;return F.FromValuesToRef(Z[0]*d,Z[1]*d,Z[2]*d,0,Z[4]*p,Z[5]*p,Z[6]*p,0,Z[8]*r,Z[9]*r,Z[10]*r,0,0,0,0,1,V),V}toggleModelMatrixHandInPlace(){const V=this.Dj;return V[2]*=-1,V[6]*=-1,V[8]*=-1,V[9]*=-1,V[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const V=this.Dj;return V[8]*=-1,V[9]*=-1,V[10]*=-1,V[11]*=-1,this.markAsUpdated(),this}static Cg(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=new F;return F.FromArrayToRef(V,O,Z),Z}static FromArrayToRef(V,O,Z){for(let d=0;d<16;d++)Z.Dj[d]=V[d+O];return Z.markAsUpdated(),Z}static FromFloat32ArrayToRefScaled(V,O,Z,d){return d.Dj[0]=V[0+O]*Z,d.Dj[1]=V[1+O]*Z,d.Dj[2]=V[2+O]*Z,d.Dj[3]=V[3+O]*Z,d.Dj[4]=V[4+O]*Z,d.Dj[5]=V[5+O]*Z,d.Dj[6]=V[6+O]*Z,d.Dj[7]=V[7+O]*Z,d.Dj[8]=V[8+O]*Z,d.Dj[9]=V[9+O]*Z,d.Dj[10]=V[10+O]*Z,d.Dj[11]=V[11+O]*Z,d.Dj[12]=V[12+O]*Z,d.Dj[13]=V[13+O]*Z,d.Dj[14]=V[14+O]*Z,d.Dj[15]=V[15+O]*Z,d.markAsUpdated(),d}static get IdentityReadOnly(){return F._IdentityReadOnly}static FromValuesToRef(V,O,Z,d,p,r,Y,m,a,R,i,M,c,W,F,Q,b){const U=b.Dj;U[0]=V,U[1]=O,U[2]=Z,U[3]=d,U[4]=p,U[5]=r,U[6]=Y,U[7]=m,U[8]=a,U[9]=R,U[10]=i,U[11]=M,U[12]=c,U[13]=W,U[14]=F,U[15]=Q,b.markAsUpdated()}static FromValues(V,O,Z,d,p,r,Y,m,a,R,i,M,c,W,Q,b){const U=new F,H=U.Dj;return H[0]=V,H[1]=O,H[2]=Z,H[3]=d,H[4]=p,H[5]=r,H[6]=Y,H[7]=m,H[8]=a,H[9]=R,H[10]=i,H[11]=M,H[12]=c,H[13]=W,H[14]=Q,H[15]=b,U.markAsUpdated(),U}static Compose(V,O,Z){const d=new F;return F.ComposeToRef(V,O,Z,d),d}static ComposeToRef(V,O,Z,d){const p=d.Dj,r=O._x,Y=O._y,m=O._z,a=O._w,R=r+r,i=Y+Y,M=m+m,c=r*R,W=r*i,F=r*M,Q=Y*i,b=Y*M,U=m*M,H=a*R,S=a*i,z=a*M,G=V._x,w=V._y,t=V._z;return p[0]=(1-(Q+U))*G,p[1]=(W+z)*G,p[2]=(F-S)*G,p[3]=0,p[4]=(W-z)*w,p[5]=(1-(c+U))*w,p[6]=(b+H)*w,p[7]=0,p[8]=(F+S)*t,p[9]=(b-H)*t,p[10]=(1-(c+Q))*t,p[11]=0,p[12]=Z._x,p[13]=Z._y,p[14]=Z._z,p[15]=1,d.markAsUpdated(),d}static Identity(){const V=F.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return V._updateIdentityStatus(!0),V}static IdentityToRef(V){return F.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,V),V._updateIdentityStatus(!0),V}static Zero(){const V=F.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return V._updateIdentityStatus(!1),V}static RotationX(V){const O=new F;return F.RotationXToRef(V,O),O}static Invert(V){const O=new F;return V.invertToRef(O),O}static RotationXToRef(V,O){const Z=Math.sin(V),d=Math.cos(V);return F.FromValuesToRef(1,0,0,0,0,d,Z,0,0,-Z,d,0,0,0,0,1,O),O._updateIdentityStatus(1===d&&0===Z),O}static RotationY(V){const O=new F;return F.RotationYToRef(V,O),O}static RotationYToRef(V,O){const Z=Math.sin(V),d=Math.cos(V);return F.FromValuesToRef(d,0,-Z,0,0,1,0,0,Z,0,d,0,0,0,0,1,O),O._updateIdentityStatus(1===d&&0===Z),O}static RotationZ(V){const O=new F;return F.RotationZToRef(V,O),O}static RotationZToRef(V,O){const Z=Math.sin(V),d=Math.cos(V);return F.FromValuesToRef(d,Z,0,0,-Z,d,0,0,0,0,1,0,0,0,0,1,O),O._updateIdentityStatus(1===d&&0===Z),O}static RotationAxis(V,O){const Z=new F;return F.RotationAxisToRef(V,O,Z),Z}static RotationAxisToRef(V,O,Z){const d=Math.sin(-O),p=Math.cos(-O),r=1-p;V=V.normalizeToRef(Q.ib[0]);const Y=Z.Dj;return Y[0]=V._x*V._x*r+p,Y[1]=V._x*V._y*r-V._z*d,Y[2]=V._x*V._z*r+V._y*d,Y[3]=0,Y[4]=V._y*V._x*r+V._z*d,Y[5]=V._y*V._y*r+p,Y[6]=V._y*V._z*r-V._x*d,Y[7]=0,Y[8]=V._z*V._x*r-V._y*d,Y[9]=V._z*V._y*r+V._x*d,Y[10]=V._z*V._z*r+p,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Z.markAsUpdated(),Z}static RotationAlignToRef(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=M.Dot(O,V),Y=Z.Dj;if(r<-1+d.c)Y[0]=-1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=p?1:-1,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=p?-1:1,Y[11]=0;else{const Z=M.Cross(O,V),d=1/(1+r);Y[0]=Z._x*Z._x*d+r,Y[1]=Z._y*Z._x*d-Z._z,Y[2]=Z._z*Z._x*d+Z._y,Y[3]=0,Y[4]=Z._x*Z._y*d+Z._z,Y[5]=Z._y*Z._y*d+r,Y[6]=Z._z*Z._y*d-Z._x,Y[7]=0,Y[8]=Z._x*Z._z*d-Z._y,Y[9]=Z._y*Z._z*d+Z._x,Y[10]=Z._z*Z._z*d+r,Y[11]=0}return Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Z.markAsUpdated(),Z}static RotationYawPitchRoll(V,O,Z){const d=new F;return F.RotationYawPitchRollToRef(V,O,Z,d),d}static RotationYawPitchRollToRef(V,O,Z,d){return W.RotationYawPitchRollToRef(V,O,Z,Q.Quaternion[0]),Q.Quaternion[0].toRotationMatrix(d),d}static Scaling(V,O,Z){const d=new F;return F.ScalingToRef(V,O,Z,d),d}static ScalingToRef(V,O,Z,d){return F.FromValuesToRef(V,0,0,0,0,O,0,0,0,0,Z,0,0,0,0,1,d),d._updateIdentityStatus(1===V&&1===O&&1===Z),d}static Translation(V,O,Z){const d=new F;return F.TranslationToRef(V,O,Z,d),d}static TranslationToRef(V,O,Z,d){return F.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V,O,Z,1,d),d._updateIdentityStatus(0===V&&0===O&&0===Z),d}static Lerp(V,O,Z){const d=new F;return F.LerpToRef(V,O,Z,d),d}static LerpToRef(V,O,Z,d){const p=d.Dj,r=V.m,Y=O.m;for(let m=0;m<16;m++)p[m]=r[m]*(1-Z)+Y[m]*Z;return d.markAsUpdated(),d}static DecomposeLerp(V,O,Z){const d=new F;return F.DecomposeLerpToRef(V,O,Z,d),d}static DecomposeLerpToRef(V,O,Z,d){const p=Q.ib[0],r=Q.Quaternion[0],Y=Q.ib[1];V.decompose(p,r,Y);const m=Q.ib[2],a=Q.Quaternion[1],R=Q.ib[3];O.decompose(m,a,R);const i=Q.ib[4];M.LerpToRef(p,m,Z,i);const c=Q.Quaternion[2];W.SlerpToRef(r,a,Z,c);const b=Q.ib[5];return M.LerpToRef(Y,R,Z,b),F.ComposeToRef(i,c,b,d),d}static LookAtLH(V,O,Z){const d=new F;return F.LookAtLHToRef(V,O,Z,d),d}static LookAtLHToRef(V,O,Z,d){const p=Q.ib[0],r=Q.ib[1],Y=Q.ib[2];O.subtractToRef(V,Y),Y.normalize(),M.CrossToRef(Z,Y,p);const m=p.lengthSquared();0===m?p.x=1:p.normalizeFromLength(Math.sqrt(m)),M.CrossToRef(Y,p,r),r.normalize();const a=-M.Dot(p,V),R=-M.Dot(r,V),i=-M.Dot(Y,V);return F.FromValuesToRef(p._x,r._x,Y._x,0,p._y,r._y,Y._y,0,p._z,r._z,Y._z,0,a,R,i,1,d),d}static LookAtRH(V,O,Z){const d=new F;return F.LookAtRHToRef(V,O,Z,d),d}static LookAtRHToRef(V,O,Z,d){const p=Q.ib[0],r=Q.ib[1],Y=Q.ib[2];V.subtractToRef(O,Y),Y.normalize(),M.CrossToRef(Z,Y,p);const m=p.lengthSquared();0===m?p.x=1:p.normalizeFromLength(Math.sqrt(m)),M.CrossToRef(Y,p,r),r.normalize();const a=-M.Dot(p,V),R=-M.Dot(r,V),i=-M.Dot(Y,V);return F.FromValuesToRef(p._x,r._x,Y._x,0,p._y,r._y,Y._y,0,p._z,r._z,Y._z,0,a,R,i,1,d),d}static LookDirectionLH(V,O){const Z=new F;return F.LookDirectionLHToRef(V,O,Z),Z}static LookDirectionLHToRef(V,O,Z){const d=Q.ib[0];d.p(V),d.scaleInPlace(-1);const p=Q.ib[1];return M.CrossToRef(O,d,p),F.FromValuesToRef(p._x,p._y,p._z,0,O._x,O._y,O._z,0,d._x,d._y,d._z,0,0,0,0,1,Z),Z}static LookDirectionRH(V,O){const Z=new F;return F.LookDirectionRHToRef(V,O,Z),Z}static LookDirectionRHToRef(V,O,Z){const d=Q.ib[2];return M.CrossToRef(O,V,d),F.FromValuesToRef(d._x,d._y,d._z,0,O._x,O._y,O._z,0,V._x,V._y,V._z,0,0,0,0,1,Z),Z}static OrthoLH(V,O,Z,d,p){const r=new F;return F.OrthoLHToRef(V,O,Z,d,r,p),r}static OrthoLHToRef(V,O,Z,d,p,r){const Y=2/V,m=2/O,a=2/(d-Z),R=-(d+Z)/(d-Z);return F.FromValuesToRef(Y,0,0,0,0,m,0,0,0,0,a,0,0,0,R,1,p),r&&p.multiplyToRef(U,p),p._updateIdentityStatus(1===Y&&1===m&&1===a&&0===R),p}static OrthoOffCenterLH(V,O,Z,d,p,r,Y){const m=new F;return F.OrthoOffCenterLHToRef(V,O,Z,d,p,r,m,Y),m}static OrthoOffCenterLHToRef(V,O,Z,d,p,r,Y,m){const a=2/(O-V),R=2/(d-Z),i=2/(r-p),M=-(r+p)/(r-p),c=(V+O)/(V-O),W=(d+Z)/(Z-d);return F.FromValuesToRef(a,0,0,0,0,R,0,0,0,0,i,0,c,W,M,1,Y),m&&Y.multiplyToRef(U,Y),Y.markAsUpdated(),Y}static ObliqueOffCenterLHToRef(V,O,Z,d,p,r,Y,m,a,R,i){const M=-Y*Math.cos(m),c=-Y*Math.sin(m);return F.TranslationToRef(0,0,-a,Q.Matrix[1]),F.FromValuesToRef(1,0,0,0,0,1,0,0,M,c,1,0,0,0,0,1,Q.Matrix[0]),Q.Matrix[1].multiplyToRef(Q.Matrix[0],Q.Matrix[0]),F.TranslationToRef(0,0,a,Q.Matrix[1]),Q.Matrix[0].multiplyToRef(Q.Matrix[1],Q.Matrix[0]),F.OrthoOffCenterLHToRef(V,O,Z,d,p,r,R,i),Q.Matrix[0].multiplyToRef(R,R),R}static OrthoOffCenterRH(V,O,Z,d,p,r,Y){const m=new F;return F.OrthoOffCenterRHToRef(V,O,Z,d,p,r,m,Y),m}static OrthoOffCenterRHToRef(V,O,Z,d,p,r,Y,m){return F.OrthoOffCenterLHToRef(V,O,Z,d,p,r,Y,m),Y.Dj[10]*=-1,Y}static ObliqueOffCenterRHToRef(V,O,Z,d,p,r,Y,m,a,R,i){const M=Y*Math.cos(m),c=Y*Math.sin(m);return F.TranslationToRef(0,0,a,Q.Matrix[1]),F.FromValuesToRef(1,0,0,0,0,1,0,0,M,c,1,0,0,0,0,1,Q.Matrix[0]),Q.Matrix[1].multiplyToRef(Q.Matrix[0],Q.Matrix[0]),F.TranslationToRef(0,0,-a,Q.Matrix[1]),Q.Matrix[0].multiplyToRef(Q.Matrix[1],Q.Matrix[0]),F.OrthoOffCenterRHToRef(V,O,Z,d,p,r,R,i),Q.Matrix[0].multiplyToRef(R,R),R}static PerspectiveLH(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const Y=new F,m=2*Z/V,a=2*Z/O,R=(d+Z)/(d-Z),i=-2*d*Z/(d-Z),M=Math.tan(r);return F.FromValuesToRef(m,0,0,0,0,a,0,M,0,0,R,1,0,0,i,0,Y),p&&Y.multiplyToRef(U,Y),Y._updateIdentityStatus(!1),Y}static PerspectiveFovLH(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const m=new F;return F.PerspectiveFovLHToRef(V,O,Z,d,m,!0,p,r,Y),m}static PerspectiveFovLHToRef(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const R=Z,i=d,M=1/Math.tan(.5*V),c=r?M/O:M,W=r?M:M*O,Q=a&&0===R?-1:0!==i?(i+R)/(i-R):1,b=a&&0===R?2*i:0!==i?-2*i*R/(i-R):-2*R,H=Math.tan(m);return F.FromValuesToRef(c,0,0,0,0,W,0,H,0,0,Q,1,0,0,b,0,p),Y&&p.multiplyToRef(U,p),p._updateIdentityStatus(!1),p}static PerspectiveFovReverseLHToRef(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const a=1/Math.tan(.5*V),R=r?a/O:a,i=r?a:a*O,M=Math.tan(m);return F.FromValuesToRef(R,0,0,0,0,i,0,M,0,0,-Z,1,0,0,1,0,p),Y&&p.multiplyToRef(U,p),p._updateIdentityStatus(!1),p}static PerspectiveFovRH(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const m=new F;return F.PerspectiveFovRHToRef(V,O,Z,d,m,!0,p,r,Y),m}static PerspectiveFovRHToRef(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const R=Z,i=d,M=1/Math.tan(.5*V),c=r?M/O:M,W=r?M:M*O,Q=a&&0===R?1:0!==i?-(i+R)/(i-R):-1,b=a&&0===R?2*i:0!==i?-2*i*R/(i-R):-2*R,H=Math.tan(m);return F.FromValuesToRef(c,0,0,0,0,W,0,H,0,0,Q,-1,0,0,b,0,p),Y&&p.multiplyToRef(U,p),p._updateIdentityStatus(!1),p}static PerspectiveFovReverseRHToRef(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const a=1/Math.tan(.5*V),R=r?a/O:a,i=r?a:a*O,M=Math.tan(m);return F.FromValuesToRef(R,0,0,0,0,i,0,M,0,0,-Z,-1,0,0,-1,0,p),Y&&p.multiplyToRef(U,p),p._updateIdentityStatus(!1),p}static GetFinalMatrix(V,O,Z,d,p,r){const Y=V.width,m=V.height,a=V.x,R=V.y,i=F.FromValues(Y/2,0,0,0,0,-m/2,0,0,0,0,r-p,0,a+Y/2,m/2+R,p,1),M=new F;return O.multiplyToRef(Z,M),M.multiplyToRef(d,M),M.multiplyToRef(i,M)}static GetAsMatrix2x2(V){const O=V.m,Z=[O[0],O[1],O[4],O[5]];return Y.b.MatrixUse64Bits?Z:new Float32Array(Z)}static GetAsMatrix3x3(V){const O=V.m,Z=[O[0],O[1],O[2],O[4],O[5],O[6],O[8],O[9],O[10]];return Y.b.MatrixUse64Bits?Z:new Float32Array(Z)}static Transpose(V){const O=new F;return F.TransposeToRef(V,O),O}static TransposeToRef(V,O){const Z=V.m,d=Z[0],p=Z[4],r=Z[8],Y=Z[12],m=Z[1],a=Z[5],R=Z[9],i=Z[13],M=Z[2],c=Z[6],W=Z[10],F=Z[14],Q=Z[3],b=Z[7],U=Z[11],H=Z[15],S=O.Dj;return S[0]=d,S[1]=p,S[2]=r,S[3]=Y,S[4]=m,S[5]=a,S[6]=R,S[7]=i,S[8]=M,S[9]=c,S[10]=W,S[11]=F,S[12]=Q,S[13]=b,S[14]=U,S[15]=H,O.markAsUpdated(),O._updateIdentityStatus(V._isIdentity,V._isIdentityDirty),O}static Reflection(V){const O=new F;return F.ReflectionToRef(V,O),O}static ReflectionToRef(V,O){V.normalize();const Z=V.ab.x,d=V.ab.y,p=V.ab.z,r=-2*Z,Y=-2*d,m=-2*p;return F.FromValuesToRef(r*Z+1,Y*Z,m*Z,0,r*d,Y*d+1,m*d,0,r*p,Y*p,m*p+1,0,r*V.d,Y*V.d,m*V.d,1,O),O}static FromXYZAxesToRef(V,O,Z,d){return F.FromValuesToRef(V._x,V._y,V._z,0,O._x,O._y,O._z,0,Z._x,Z._y,Z._z,0,0,0,0,1,d),d}static FromQuaternionToRef(V,O){const Z=V._x*V._x,d=V._y*V._y,p=V._z*V._z,r=V._x*V._y,Y=V._z*V._w,m=V._z*V._x,a=V._y*V._w,R=V._y*V._z,i=V._x*V._w;return O.Dj[0]=1-2*(d+p),O.Dj[1]=2*(r+Y),O.Dj[2]=2*(m-a),O.Dj[3]=0,O.Dj[4]=2*(r-Y),O.Dj[5]=1-2*(p+Z),O.Dj[6]=2*(R+i),O.Dj[7]=0,O.Dj[8]=2*(m+a),O.Dj[9]=2*(R-i),O.Dj[10]=1-2*(d+Z),O.Dj[11]=0,O.Dj[12]=0,O.Dj[13]=0,O.Dj[14]=0,O.Dj[15]=1,O.markAsUpdated(),O}}F._UpdateFlagSeed=0,F._IdentityReadOnly=F.Identity(),Object.defineProperties(F.prototype,{dimension:{value:[4,4]},rank:{value:2}});class Q{}Q.ib=(0,p.g)(11,M.Zero),Q.Matrix=(0,p.g)(2,F.Identity),Q.Quaternion=(0,p.g)(3,W.Zero);class b{}b.Vector2=(0,p.g)(3,i.Zero),b.ib=(0,p.g)(13,M.Zero),b.Vector4=(0,p.g)(3,c.Zero),b.Quaternion=(0,p.g)(3,W.Zero),b.Matrix=(0,p.g)(8,F.Identity),(0,r.f)("BABYLON.Vector2",i),(0,r.f)("BABYLON.Vector3",M),(0,r.f)("BABYLON.Vector4",c),(0,r.f)("BABYLON.Matrix",F);const U=F.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11526:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});class d{constructor(V,O,Z,d){this.x=V,this.y=O,this.width=Z,this.height=d}toGlobal(V,O){return new d(this.x*V,this.y*O,this.width*V,this.height*O)}toGlobalToRef(V,O,Z){return Z.x=this.x*V,Z.y=this.y*O,Z.width=this.width*V,Z.height=this.height*O,this}clone(){return new d(this.x,this.y,this.width,this.height)}}},11713:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>R,g:()=>i});var d=Z(11251),p=Z(11715);const r=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],Y=[()=>1,V=>V.y,V=>V.z,V=>V.x,V=>V.x*V.y,V=>V.y*V.z,V=>3*V.z*V.z-1,V=>V.x*V.z,V=>V.x*V.x-V.y*V.y],m=(V,O)=>r[V]*Y[V](O),a=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class R{constructor(){this.preScaled=!1,this.l00=d.m.Zero(),this.l1_1=d.m.Zero(),this.l10=d.m.Zero(),this.l11=d.m.Zero(),this.l2_2=d.m.Zero(),this.l2_1=d.m.Zero(),this.l20=d.m.Zero(),this.l21=d.m.Zero(),this.l22=d.m.Zero()}addLight(V,O,Z){p.c.ib[0].set(O.r,O.g,O.b);const d=p.c.ib[0],r=p.c.ib[1];d.scaleToRef(Z,r),r.scaleToRef(m(0,V),p.c.ib[2]),this.l00.addInPlace(p.c.ib[2]),r.scaleToRef(m(1,V),p.c.ib[2]),this.l1_1.addInPlace(p.c.ib[2]),r.scaleToRef(m(2,V),p.c.ib[2]),this.l10.addInPlace(p.c.ib[2]),r.scaleToRef(m(3,V),p.c.ib[2]),this.l11.addInPlace(p.c.ib[2]),r.scaleToRef(m(4,V),p.c.ib[2]),this.l2_2.addInPlace(p.c.ib[2]),r.scaleToRef(m(5,V),p.c.ib[2]),this.l2_1.addInPlace(p.c.ib[2]),r.scaleToRef(m(6,V),p.c.ib[2]),this.l20.addInPlace(p.c.ib[2]),r.scaleToRef(m(7,V),p.c.ib[2]),this.l21.addInPlace(p.c.ib[2]),r.scaleToRef(m(8,V),p.c.ib[2]),this.l22.addInPlace(p.c.ib[2])}scaleInPlace(V){this.l00.scaleInPlace(V),this.l1_1.scaleInPlace(V),this.l10.scaleInPlace(V),this.l11.scaleInPlace(V),this.l2_2.scaleInPlace(V),this.l2_1.scaleInPlace(V),this.l20.scaleInPlace(V),this.l21.scaleInPlace(V),this.l22.scaleInPlace(V)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(a[0]),this.l1_1.scaleInPlace(a[1]),this.l10.scaleInPlace(a[2]),this.l11.scaleInPlace(a[3]),this.l2_2.scaleInPlace(a[4]),this.l2_1.scaleInPlace(a[5]),this.l20.scaleInPlace(a[6]),this.l21.scaleInPlace(a[7]),this.l22.scaleInPlace(a[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(r[0]),this.l1_1.scaleInPlace(r[1]),this.l10.scaleInPlace(r[2]),this.l11.scaleInPlace(r[3]),this.l2_2.scaleInPlace(r[4]),this.l2_1.scaleInPlace(r[5]),this.l20.scaleInPlace(r[6]),this.l21.scaleInPlace(r[7]),this.l22.scaleInPlace(r[8])}updateFromArray(V){return d.m.FromArrayToRef(V[0],0,this.l00),d.m.FromArrayToRef(V[1],0,this.l1_1),d.m.FromArrayToRef(V[2],0,this.l10),d.m.FromArrayToRef(V[3],0,this.l11),d.m.FromArrayToRef(V[4],0,this.l2_2),d.m.FromArrayToRef(V[5],0,this.l2_1),d.m.FromArrayToRef(V[6],0,this.l20),d.m.FromArrayToRef(V[7],0,this.l21),d.m.FromArrayToRef(V[8],0,this.l22),this}updateFromFloatsArray(V){return d.m.FromFloatsToRef(V[0],V[1],V[2],this.l00),d.m.FromFloatsToRef(V[3],V[4],V[5],this.l1_1),d.m.FromFloatsToRef(V[6],V[7],V[8],this.l10),d.m.FromFloatsToRef(V[9],V[10],V[11],this.l11),d.m.FromFloatsToRef(V[12],V[13],V[14],this.l2_2),d.m.FromFloatsToRef(V[15],V[16],V[17],this.l2_1),d.m.FromFloatsToRef(V[18],V[19],V[20],this.l20),d.m.FromFloatsToRef(V[21],V[22],V[23],this.l21),d.m.FromFloatsToRef(V[24],V[25],V[26],this.l22),this}static Cg(V){return(new R).updateFromArray(V)}static FromPolynomial(V){const O=new R;return O.l00=V.xx.scale(.376127).add(V.yy.scale(.376127)).add(V.zz.scale(.376126)),O.l1_1=V.y.scale(.977204),O.l10=V.z.scale(.977204),O.l11=V.x.scale(.977204),O.l2_2=V.xy.scale(1.16538),O.l2_1=V.yz.scale(1.16538),O.l20=V.zz.scale(1.34567).fc(V.xx.scale(.672834)).fc(V.yy.scale(.672834)),O.l21=V.zx.scale(1.16538),O.l22=V.xx.scale(1.16538).fc(V.yy.scale(1.16538)),O.l1_1.scaleInPlace(-1),O.l11.scaleInPlace(-1),O.l2_1.scaleInPlace(-1),O.l21.scaleInPlace(-1),O.scaleInPlace(Math.PI),O}}class i{constructor(){this.x=d.m.Zero(),this.y=d.m.Zero(),this.z=d.m.Zero(),this.xx=d.m.Zero(),this.yy=d.m.Zero(),this.zz=d.m.Zero(),this.xy=d.m.Zero(),this.yz=d.m.Zero(),this.zx=d.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=R.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(V){p.c.ib[0].nf(V.r,V.g,V.b);const O=p.c.ib[0];this.xx.addInPlace(O),this.yy.addInPlace(O),this.zz.addInPlace(O)}scaleInPlace(V){this.x.scaleInPlace(V),this.y.scaleInPlace(V),this.z.scaleInPlace(V),this.xx.scaleInPlace(V),this.yy.scaleInPlace(V),this.zz.scaleInPlace(V),this.yz.scaleInPlace(V),this.zx.scaleInPlace(V),this.xy.scaleInPlace(V)}updateFromHarmonics(V){return this._harmonics=V,this.x.p(V.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(V.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(V.l10),this.z.scaleInPlace(1.02333),this.xx.p(V.l00),p.c.ib[0].p(V.l20).scaleInPlace(.247708),p.c.ib[1].p(V.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).bi(p.c.ib[0]).addInPlace(p.c.ib[1]),this.yy.p(V.l00),this.yy.scaleInPlace(.886277).bi(p.c.ib[0]).bi(p.c.ib[1]),this.zz.p(V.l00),p.c.ib[0].p(V.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(p.c.ib[0]),this.yz.p(V.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(V.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(V.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(V){return(new i).updateFromHarmonics(V)}static Cg(V){const O=new i;return d.m.FromArrayToRef(V[0],0,O.x),d.m.FromArrayToRef(V[1],0,O.y),d.m.FromArrayToRef(V[2],0,O.z),d.m.FromArrayToRef(V[3],0,O.xx),d.m.FromArrayToRef(V[4],0,O.yy),d.m.FromArrayToRef(V[5],0,O.zz),d.m.FromArrayToRef(V[6],0,O.yz),d.m.FromArrayToRef(V[7],0,O.zx),d.m.FromArrayToRef(V[8],0,O.xy),O}}},11570:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>R});var d=Z(11251),p=Z(11274),r=Z(11508),Y=Z(11530),m=Z(11476);Z(11574);function a(V){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Z=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[];let a=[];const R=V.width||V.size||1,i=V.height||V.size||1,M=V.depth||V.size||1,c=V.wrap||!1;let W=void 0===V.topBaseAt?1:V.topBaseAt,F=void 0===V.bottomBaseAt?0:V.bottomBaseAt;W=(W+4)%4,F=(F+4)%4;let Q=[2,0,3,1][W],b=[2,0,1,3][F],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let V=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Z=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const d=[17,18,19,16],p=[22,23,20,21];for(;Q>0;)V.unshift(V.pop()),d.unshift(d.pop()),Q--;for(;b>0;)Z.unshift(Z.pop()),p.unshift(p.pop()),b--;V=V.flat(),Z=Z.flat(),U=U.concat(V).concat(Z),O.push(d[0],d[2],d[3],d[0],d[1],d[2]),O.push(p[0],p[2],p[3],p[0],p[1],p[2])}const H=[R/2,i/2,M/2];a=U.reduce(((V,O,Z)=>V.concat(O*H[Z%3])),[]);const S=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,z=V.faceUV||new Array(6),G=V.faceColors,w=[];for(let Y=0;Y<6;Y++)void 0===z[Y]&&(z[Y]=new d.p(0,0,1,1)),G&&void 0===G[Y]&&(G[Y]=new p.f(1,1,1,1));for(let d=0;d<6;d++)if(r.push(z[d].z,m.c?1-z[d].w:z[d].w),r.push(z[d].x,m.c?1-z[d].w:z[d].w),r.push(z[d].x,m.c?1-z[d].y:z[d].y),r.push(z[d].z,m.c?1-z[d].y:z[d].y),G)for(let V=0;V<4;V++)w.push(G[d].r,G[d].g,G[d].b,G[d].a);Y.e._ComputeSides(S,a,O,Z,r,V.frontUVs,V.backUVs);const t=new Y.e;if(t.indices=O,t.xa=a,t.ya=Z,t.Aa=r,G){const V=S===Y.e.DOUBLESIDE?w.concat(w):w;t.za=V}return t}function R(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new r.c(V,Z);O.sideOrientation=r.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return a(O).Ca(d,O.updatable),d}Y.e.CreateBox=a,r.c.CreateBox=function(V,O){return R(V,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11855:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>m});var d=Z(11508),p=Z(11530),r=Z(11476);function Y(V){const O=[],Z=[],d=[],Y=[],m=V.i||.5,a=V.Jk||64,R=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,i=0===V.sideOrientation?0:V.sideOrientation||p.e.DEFAULTSIDE;O.push(0,0,0),Y.push(.5,.5);const M=2*Math.PI*R,c=1===R?M/a:M/(a-1);let W=0;for(let p=0;p<a;p++){const V=Math.cos(W),Z=Math.sin(W),d=(V+1)/2,p=(1-Z)/2;O.push(m*V,m*Z,0),Y.push(d,r.c?1-p:p),W+=c}1===R&&(O.push(O[3],O[4],O[5]),Y.push(Y[2],r.c?1-Y[3]:Y[3]));const F=O.length/3;for(let p=1;p<F-1;p++)Z.push(p+1,0,p);p.e.ComputeNormals(O,Z,d),p.e._ComputeSides(i,O,Z,d,Y,V.frontUVs,V.backUVs);const Q=new p.e;return Q.indices=Z,Q.xa=O,Q.ya=d,Q.Aa=Y,Q}function m(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new d.c(V,Z);O.sideOrientation=d.c._GetDefaultSideOrientation(O.sideOrientation),p._originalBuilderSideOrientation=O.sideOrientation;return Y(O).Ca(p,O.updatable),p}p.e.sb=Y,d.c.sb=function(V,O,Z){return m(V,{i:O,Jk:Z,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11574:(V,O,Z)=>{"use strict";Z.d(O,{f:()=>b,d:()=>H,j:()=>U});var d=Z(11251),p=Z(11274),r=Z(11508),Y=Z(11530),m=Z(11316);r.c._GroundMeshParser=(V,O)=>a.Parse(V,O);class a extends r.c{constructor(V,O){super(V,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=V,this._subdivisionsY=V,this.subdivide(V);const Z=this;Z.createOrUpdateSubmeshesOctree&&Z.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(V,O){const Z=this.getWorldMatrix(),p=d.i.Matrix[5];Z.invertToRef(p);const r=d.i.ib[8];if(d.m.TransformCoordinatesFromFloatsToRef(V,0,O,p,r),V=r.x,O=r.z,V<this._minX||V>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(V,O),m=-(Y.x*V+Y.z*O+Y.w)/Y.y;return d.m.TransformCoordinatesFromFloatsToRef(0,m,0,Z,r),r.y}getNormalAtCoordinates(V,O){const Z=new d.m(0,1,0);return this.getNormalAtCoordinatesToRef(V,O,Z),Z}getNormalAtCoordinatesToRef(V,O,Z){const p=this.getWorldMatrix(),r=d.i.Matrix[5];p.invertToRef(r);const Y=d.i.ib[8];if(d.m.TransformCoordinatesFromFloatsToRef(V,0,O,r,Y),V=Y.x,O=Y.z,V<this._minX||V>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const m=this._getFacetAt(V,O);return d.m.TransformNormalFromFloatsToRef(m.x,m.y,m.z,p,Z),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(V,O){const Z=Math.floor((V+this._maxX)*this._subdivisionsX/this._width),d=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),p=this._heightQuads[d*this._subdivisionsX+Z];let r;return r=O<p.slope.x*V+p.slope.y?p.facet1:p.facet2,r}_initHeightQuads(){const V=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=new Array;for(let Z=0;Z<O;Z++)for(let O=0;O<V;O++){const p={slope:d.l.Zero(),facet1:new d.p(0,0,0,0),facet2:new d.p(0,0,0,0)};this._heightQuads[Z*V+O]=p}return this}_computeHeightQuads(){const V=this.getVerticesData(m.e.PositionKind);if(!V)return this;const O=d.i.ib[3],Z=d.i.ib[2],p=d.i.ib[1],r=d.i.ib[0],Y=d.i.ib[4],a=d.i.ib[5],R=d.i.ib[6],i=d.i.ib[7],M=d.i.ib[8];let c=0,W=0,F=0,Q=0,b=0,U=0,H=0;const S=this._subdivisionsX,z=this._subdivisionsY;for(let m=0;m<z;m++)for(let z=0;z<S;z++){c=3*z,W=m*(S+1)*3,F=(m+1)*(S+1)*3,O.x=V[W+c],O.y=V[W+c+1],O.z=V[W+c+2],Z.x=V[W+c+3],Z.y=V[W+c+4],Z.z=V[W+c+5],p.x=V[F+c],p.y=V[F+c+1],p.z=V[F+c+2],r.x=V[F+c+3],r.y=V[F+c+4],r.z=V[F+c+5],Q=(r.z-O.z)/(r.x-O.x),b=O.z-Q*O.x,Z.subtractToRef(O,Y),p.subtractToRef(O,a),r.subtractToRef(O,R),d.m.CrossToRef(R,a,i),d.m.CrossToRef(Y,R,M),i.normalize(),M.normalize(),U=-(i.x*O.x+i.y*O.y+i.z*O.z),H=-(M.x*Z.x+M.y*Z.y+M.z*Z.z);const G=this._heightQuads[m*S+z];G.slope.nf(Q,b),G.facet1.nf(i.x,i.y,i.z,U),G.facet2.nf(M.x,M.y,M.z,H)}return this}serialize(V){super.serialize(V),V.subdivisionsX=this._subdivisionsX,V.subdivisionsY=this._subdivisionsY,V.minX=this._minX,V.maxX=this._maxX,V.Ii=this._minZ,V.maxZ=this._maxZ,V.width=this._width,V.height=this._height}static Parse(V,O){const Z=new a(V.name,O);return Z._subdivisionsX=V.subdivisionsX||1,Z._subdivisionsY=V.subdivisionsY||1,Z._minX=V.minX,Z._maxX=V.maxX,Z._minZ=V.Ii,Z._maxZ=V.maxZ,Z._width=V.width,Z._height=V.height,Z}}var R=Z(10900),i=Z(10942),M=Z(11255),c=Z(11476);function W(V){const O=[],Z=[],p=[],r=[];let m,a;const R=V.width||V.size||1,i=V.height||V.size||1,M=0|(V.subdivisionsX||V.subdivisions||1),W=0|(V.subdivisionsY||V.subdivisions||1);for(m=0;m<=W;m++)for(a=0;a<=M;a++){const V=new d.m(a*R/M-R/2,0,(W-m)*i/W-i/2),O=new d.m(0,1,0);Z.push(V.x,V.y,V.z),p.push(O.x,O.y,O.z),r.push(a/M,c.c?m/W:1-m/W)}for(m=0;m<W;m++)for(a=0;a<M;a++)O.push(a+1+(m+1)*(M+1)),O.push(a+1+m*(M+1)),O.push(a+m*(M+1)),O.push(a+(m+1)*(M+1)),O.push(a+1+(m+1)*(M+1)),O.push(a+m*(M+1));const F=new Y.e;return F.indices=O,F.xa=Z,F.ya=p,F.Aa=r,F}function F(V){const O=void 0!==V.xmin&&null!==V.xmin?V.xmin:-1,Z=void 0!==V.zmin&&null!==V.zmin?V.zmin:-1,p=void 0!==V.xmax&&null!==V.xmax?V.xmax:1,r=void 0!==V.zmax&&null!==V.zmax?V.zmax:1,m=V.subdivisions||{w:1,h:1},a=V.precision||{w:1,h:1},R=[],i=[],M=[],c=[];let W,F,Q,b;m.h=m.h<1?1:m.h,m.w=m.w<1?1:m.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;const U=(p-O)/m.w,H=(r-Z)/m.h;function S(V,O,Z,p){const r=i.length/3,Y=a.w+1;for(W=0;W<a.h;W++)for(F=0;F<a.w;F++){const V=[r+F+W*Y,r+(F+1)+W*Y,r+(F+1)+(W+1)*Y,r+F+(W+1)*Y];R.push(V[1]),R.push(V[2]),R.push(V[3]),R.push(V[0]),R.push(V[1]),R.push(V[3])}const m=d.m.Zero(),Q=new d.m(0,1,0);for(W=0;W<=a.h;W++)for(m.z=W*(p-O)/a.h+O,F=0;F<=a.w;F++)m.x=F*(Z-V)/a.w+V,m.y=0,i.push(m.x,m.y,m.z),M.push(Q.x,Q.y,Q.z),c.push(F/a.w,W/a.h)}for(Q=0;Q<m.h;Q++)for(b=0;b<m.w;b++)S(O+b*U,Z+Q*H,O+(b+1)*U,Z+(Q+1)*H);const z=new Y.e;return z.indices=R,z.xa=i,z.ya=M,z.Aa=c,z}function Q(V){const O=[],Z=[],r=[],m=[];let a,R;const i=V.colorFilter||new p.b(.3,.59,.11),c=V.alphaFilter||0;let W=!1;if(V.minHeight>V.maxHeight){W=!0;const O=V.maxHeight;V.maxHeight=V.minHeight,V.minHeight=O}for(a=0;a<=V.subdivisions;a++)for(R=0;R<=V.subdivisions;R++){const O=new d.m(R*V.width/V.subdivisions-V.width/2,0,(V.subdivisions-a)*V.height/V.subdivisions-V.height/2),p=4*(((O.x+V.width/2)/V.width*(V.bufferWidth-1)|0)+((1-(O.z+V.height/2)/V.height)*(V.bufferHeight-1)|0)*V.bufferWidth);let Y=V.buffer[p]/255,F=V.buffer[p+1]/255,Q=V.buffer[p+2]/255;const b=V.buffer[p+3]/255;W&&(Y=1-Y,F=1-F,Q=1-Q);const U=Y*i.r+F*i.g+Q*i.b;O.y=b>=c?V.minHeight+(V.maxHeight-V.minHeight)*U:V.minHeight-M.c,V.heightBuffer&&(V.heightBuffer[a*(V.subdivisions+1)+R]=O.y),Z.push(O.x,O.y,O.z),r.push(0,0,0),m.push(R/V.subdivisions,1-a/V.subdivisions)}for(a=0;a<V.subdivisions;a++)for(R=0;R<V.subdivisions;R++){const d=R+1+(a+1)*(V.subdivisions+1),p=R+1+a*(V.subdivisions+1),r=R+a*(V.subdivisions+1),Y=R+(a+1)*(V.subdivisions+1),m=Z[3*d+1]>=V.minHeight,i=Z[3*p+1]>=V.minHeight,M=Z[3*r+1]>=V.minHeight;m&&i&&M&&(O.push(d),O.push(p),O.push(r));Z[3*Y+1]>=V.minHeight&&m&&M&&(O.push(Y),O.push(d),O.push(r))}Y.e.ComputeNormals(Z,O,r);const F=new Y.e;return F.indices=O,F.xa=Z,F.ya=r,F.Aa=m,F}function b(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=new a(V,arguments.length>2?arguments[2]:void 0);Z._setReady(!1),Z._subdivisionsX=O.subdivisionsX||O.subdivisions||1,Z._subdivisionsY=O.subdivisionsY||O.subdivisions||1,Z._width=O.width||1,Z._height=O.height||1,Z._maxX=Z._width/2,Z._maxZ=Z._height/2,Z._minX=-Z._maxX,Z._minZ=-Z._maxZ;return W(O).Ca(Z,O.updatable),Z._setReady(!0),Z}function U(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new r.c(V,Z);return F(O).Ca(d,O.updatable),d}function H(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=Z.width||10,Y=Z.height||10,m=Z.subdivisions||1,M=Z.minHeight||0,c=Z.maxHeight||1,W=Z.colorFilter||new p.b(.3,.59,.11),F=Z.alphaFilter||0,b=Z.updatable,U=Z.onReady;d=d||i.e.LastCreatedScene;const H=new a(V,d);let S;H._subdivisionsX=m,H._subdivisionsY=m,H._width=r,H._height=Y,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ,H._setReady(!1),Z.passHeightBufferInCallback&&(S=new Float32Array((m+1)*(m+1)));const z=(V,O,Z)=>{Q({width:r,height:Y,subdivisions:m,minHeight:M,maxHeight:c,colorFilter:W,buffer:V,bufferWidth:O,bufferHeight:Z,alphaFilter:F,heightBuffer:S}).Ca(H,b),U&&U(H,S),H._setReady(!0)};if("string"===typeof O){const V=V=>{var O;const Z=V.width,p=V.height;if(d.u)return;const r=null===(O=d)||void 0===O?void 0:O.getEngine().resizeImageBitmap(V,Z,p);z(r,Z,p)};R.e.LoadImage(O,V,Z.onError?Z.onError:()=>{},d.offlineProvider)}else z(O.data,O.width,O.height);return H}Y.e.CreateGround=W,Y.e.CreateTiledGround=F,Y.e.CreateGroundFromHeightMap=Q,r.c.CreateGround=(V,O,Z,d,p,r)=>b(V,{width:O,height:Z,subdivisions:d,updatable:r},p),r.c.CreateTiledGround=(V,O,Z,d,p,r,Y,m,a)=>U(V,{xmin:O,zmin:Z,xmax:d,zmax:p,subdivisions:r,precision:Y,updatable:a},m),r.c.CreateGroundFromHeightMap=(V,O,Z,d,p,r,Y,m,a,R,i)=>H(V,O,{width:Z,height:d,subdivisions:p,minHeight:r,maxHeight:Y,updatable:a,onReady:R,alphaFilter:i},m)},12596:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>g,f:()=>l,g:()=>I});var d=Z(11251),p=Z(11508),r=Z(11530),Y=Z(11274),m=Z(11316),a=Z(12190),R=Z(11409),i=Z(11283),M=Z(11238),c=Z(11467),W=Z(11041),F=Z(11486),Q=Z(10933),b=Z(11465),U=Z(10942),H=Z(11456),S=Z(11448);const z={effect:null,subMesh:null};class G extends b.c{constructor(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(V,O,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new d.c,this._cachedWorldViewProjectionMatrix=new d.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=Z,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","ab","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...p}}get shaderPath(){return this._shaderPath}set shaderPath(V){this._shaderPath=V}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(V){-1===this._options.uniforms.indexOf(V)&&this._options.uniforms.push(V)}setTexture(V,O){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._textures[V]=O,this}removeTexture(V){delete this._textures[V]}setTextureArray(V,O){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._checkUniform(V),this._textureArrays[V]=O,this}setExternalTexture(V,O){return-1===this._options.externalTextures.indexOf(V)&&this._options.externalTextures.push(V),this._externalTextures[V]=O,this}setFloat(V,O){return this._checkUniform(V),this._floats[V]=O,this}setInt(V,O){return this._checkUniform(V),this._ints[V]=O,this}setUInt(V,O){return this._checkUniform(V),this._uints[V]=O,this}setFloats(V,O){return this._checkUniform(V),this._floatsArrays[V]=O,this}setColor3(V,O){return this._checkUniform(V),this._colors3[V]=O,this}setColor3Array(V,O){return this._checkUniform(V),this._colors3Arrays[V]=O.reduce(((V,O)=>(O.toArray(V,V.length),V)),[]),this}setColor4(V,O){return this._checkUniform(V),this._colors4[V]=O,this}setColor4Array(V,O){return this._checkUniform(V),this._colors4Arrays[V]=O.reduce(((V,O)=>(O.toArray(V,V.length),V)),[]),this}setVector2(V,O){return this._checkUniform(V),this._vectors2[V]=O,this}setVector3(V,O){return this._checkUniform(V),this._vectors3[V]=O,this}setVector4(V,O){return this._checkUniform(V),this._vectors4[V]=O,this}setQuaternion(V,O){return this._checkUniform(V),this._quaternions[V]=O,this}setQuaternionArray(V,O){return this._checkUniform(V),this._quaternionsArrays[V]=O.reduce(((V,O)=>(O.toArray(V,V.length),V)),[]),this}setMatrix(V,O){return this._checkUniform(V),this._matrices[V]=O,this}setMatrices(V,O){this._checkUniform(V);const Z=new Float32Array(16*O.length);for(let d=0;d<O.length;d++){O[d].copyToArray(Z,16*d)}return this._matrixArrays[V]=Z,this}setMatrix3x3(V,O){return this._checkUniform(V),this._matrices3x3[V]=O,this}setMatrix2x2(V,O){return this._checkUniform(V),this._matrices2x2[V]=O,this}setArray2(V,O){return this._checkUniform(V),this._vectors2Arrays[V]=O,this}setArray3(V,O){return this._checkUniform(V),this._vectors3Arrays[V]=O,this}setArray4(V,O){return this._checkUniform(V),this._vectors4Arrays[V]=O,this}setUniformBuffer(V,O){return-1===this._options.uniformBuffers.indexOf(V)&&this._options.uniformBuffers.push(V),this._uniformBuffers[V]=O,this}setTextureSampler(V,O){return-1===this._options.samplerObjects.indexOf(V)&&this._options.samplerObjects.push(V),this._textureSamplers[V]=O,this}setStorageBuffer(V,O){return-1===this._options.storageBuffers.indexOf(V)&&this._options.storageBuffers.push(V),this._storageBuffers[V]=O,this}setDefine(V,O){const Z=V.trimEnd()+" ",d=this.options.defines.findIndex((O=>O===V||O.startsWith(Z)));return d>=0&&this.options.defines.splice(d,1),("boolean"!==typeof O||O)&&this.options.defines.push(Z+O),this}isReadyForSubMesh(V,O,Z){return this.isReady(V,Z,O)}isReady(V,O,Z){var d;const p=Z&&this._storeEffectOnSubMeshes;if(this.isFrozen){const V=p?Z._drawWrapper:this._drawWrapper;if(V.effect&&V._wasPreviouslyReady&&V._wasPreviouslyUsingInstances===O)return!0}const r=this.va(),Y=r.getEngine(),a=[],R=[],i=new F.d;let c=this._shaderPath,W=this._options.uniforms,Q=this._options.uniformBuffers,b=this._options.samplers;Y.getCaps().multiview&&r.activeCamera&&r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,a.push("#define MULTIVIEW"),-1!==W.indexOf("viewProjection")&&-1===W.indexOf("viewProjectionR")&&W.push("viewProjectionR"));for(let m=0;m<this._options.defines.length;m++){const V=0===this._options.defines[m].indexOf("#define")?this._options.defines[m]:`#define ${this._options.defines[m]}`;a.push(V)}for(let m=0;m<this._options.attributes.length;m++)R.push(this._options.attributes[m]);if(V&&V.isVerticesDataPresent(m.e.ColorKind)&&(-1===R.indexOf(m.e.ColorKind)&&R.push(m.e.ColorKind),a.push("#define VERTEXCOLOR")),O&&(a.push("#define INSTANCES"),(0,S.X)(R,this._materialHelperNeedsPreviousMatrices),null!==V&&void 0!==V&&V.hasThinInstances&&(a.push("#define THIN_INSTANCES"),V&&V.isVerticesDataPresent(m.e.ColorInstanceKind)&&(R.push(m.e.ColorInstanceKind),a.push("#define INSTANCESCOLOR")))),V&&V.useBones&&V.computeBonesUsingShaders&&V.skeleton){R.push(m.e.MatricesIndicesKind),R.push(m.e.MatricesWeightsKind),V.numBoneInfluencers>4&&(R.push(m.e.MatricesIndicesExtraKind),R.push(m.e.MatricesWeightsExtraKind));const O=V.skeleton;a.push("#define NUM_BONE_INFLUENCERS "+V.numBoneInfluencers),i.addCPUSkinningFallback(0,V),O.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),-1===W.indexOf("boneTextureWidth")&&W.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(O.bones.length+1)),-1===W.indexOf("mBones")&&W.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");let U=0;const G=V?V.morphTargetManager:null;if(G){const V=G.supportsUVs&&-1!==a.indexOf("#define UV1"),O=G.supportsTangents&&-1!==a.indexOf("#define TANGENT"),Z=G.supportsNormals&&-1!==a.indexOf("#define NORMAL");U=G.numMaxInfluencers||G.numInfluencers,V&&a.push("#define MORPHTARGETS_UV"),O&&a.push("#define MORPHTARGETS_TANGENT"),Z&&a.push("#define MORPHTARGETS_NORMAL"),U>0&&a.push("#define MORPHTARGETS"),G.isUsingTextureForTargets&&(a.push("#define MORPHTARGETS_TEXTURE"),-1===W.indexOf("morphTargetTextureIndices")&&W.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),a.push("#define NUM_MORPH_INFLUENCERS "+U);for(let d=0;d<U;d++)R.push(m.e.PositionKind+d),Z&&R.push(m.e.NormalKind+d),O&&R.push(m.e.TangentKind+d),V&&R.push(m.e.UVKind+"_"+d);U>0&&(W=W.slice(),W.push("morphTargetInfluences"),W.push("morphTargetCount"),W.push("morphTargetTextureInfo"),W.push("morphTargetTextureIndices"))}else a.push("#define NUM_MORPH_INFLUENCERS 0");if(V){const O=V.bakedVertexAnimationManager;O&&O.isEnabled&&(a.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===W.indexOf("bakedVertexAnimationSettings")&&W.push("bakedVertexAnimationSettings"),-1===W.indexOf("bakedVertexAnimationTextureSizeInverted")&&W.push("bakedVertexAnimationTextureSizeInverted"),-1===W.indexOf("bakedVertexAnimationTime")&&W.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,S.r)(R,V,a)}for(const m in this._textures)if(!this._textures[m].isReady())return!1;V&&this._shouldTurnAlphaTestOn(V)&&a.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,H.c)(W),(0,H.l)(this,r,a)),r.fogEnabled&&null!==V&&void 0!==V&&V.applyFog&&r.fogMode!==M.b.FOGMODE_NONE&&(a.push("#define FOG"),-1===W.indexOf("view")&&W.push("view"),-1===W.indexOf("vFogInfos")&&W.push("vFogInfos"),-1===W.indexOf("vFogColor")&&W.push("vFogColor")),this._useLogarithmicDepth&&(a.push("#define LOGARITHMICDEPTH"),-1===W.indexOf("logarithmicDepthConstant")&&W.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(W=W.slice(),Q=Q.slice(),b=b.slice(),c=this.customShaderNameResolve(this.name,W,Q,b,a,R));const w=p?Z._getDrawWrapper(void 0,!0):this._drawWrapper,t=(null===w||void 0===w?void 0:w.effect)??null,C=(null===w||void 0===w?void 0:w.defines)??null,v=a.join("\n");let A=t;return C!==v&&(A=Y.createEffect(c,{attributes:R,uniformsNames:W,uniformBuffersNames:Q,samplers:b,defines:v,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:U},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},Y),p?Z.setEffect(A,v,this._materialContext):w&&w.setEffect(A,v),this._onEffectCreatedObservable&&(z.effect=A,z.subMesh=Z??(null===V||void 0===V?void 0:V.Ef[0])??null,this._onEffectCreatedObservable.notifyObservers(z))),w._wasPreviouslyUsingInstances=!!O,!((null===(d=A)||void 0===d||!d.isReady())??1)&&(t!==A&&r.resetCachedMaterial(),w._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(V,O){const Z=this.va(),d=O??this.getEffect();d&&(-1!==this._options.uniforms.indexOf("world")&&d.setMatrix("world",V),-1!==this._options.uniforms.indexOf("worldView")&&(V.multiplyToRef(Z.getViewMatrix(),this._cachedWorldViewMatrix),d.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(V.multiplyToRef(Z.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),d.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&d.setMatrix("view",Z.getViewMatrix()))}bindForSubMesh(V,O,Z){var d;this.bind(V,O,null===(d=Z._drawWrapperOverride)||void 0===d?void 0:d.effect,Z)}bind(V,O,Z,d){const p=d&&this._storeEffectOnSubMeshes,r=Z??(p?d.effect:this.getEffect());if(!r)return;const Y=this.va();this._activeEffect=r,this.bindOnlyWorldMatrix(V,Z);const m=this._options.uniformBuffers;let a=!1;if(r&&m&&m.length>0&&Y.getEngine().supportsUniformBuffers)for(let M=0;M<m.length;++M){switch(m[M]){case"Mesh":O&&(O.getMeshUniformBuffer().bindToEffect(r,"Mesh"),O.transferToEffect(V));break;case"Scene":(0,S.m)(r,Y.getSceneUniformBuffer()),Y.finalizeSceneUbo(),a=!0}}const R=O&&p?this._mustRebind(Y,r,d,O.visibility):Y.getCachedMaterial()!==this;if(r&&R){let V;for(V in a||-1===this._options.uniforms.indexOf("view")||r.setMatrix("view",Y.getViewMatrix()),a||-1===this._options.uniforms.indexOf("projection")||r.setMatrix("projection",Y.getProjectionMatrix()),a||-1===this._options.uniforms.indexOf("viewProjection")||(r.setMatrix("viewProjection",Y.getTransformMatrix()),this._multiview&&r.setMatrix("viewProjectionR",Y._transformMatrixR)),Y.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&r.setVector3("cameraPosition",Y.activeCamera.globalPosition),(0,S.e)(O,r),(0,H.g)(r,this,Y),this._useLogarithmicDepth&&(0,S.j)(p?d.materialDefines:r.defines,r,Y),O&&(0,S.f)(Y,O,r),this._textures)r.setTexture(V,this._textures[V]);for(V in this._textureArrays)r.setTextureArray(V,this._textureArrays[V]);for(V in this._ints)r.setInt(V,this._ints[V]);for(V in this._uints)r.setUInt(V,this._uints[V]);for(V in this._floats)r.setFloat(V,this._floats[V]);for(V in this._floatsArrays)r.setArray(V,this._floatsArrays[V]);for(V in this._colors3)r.setColor3(V,this._colors3[V]);for(V in this._colors3Arrays)r.setArray3(V,this._colors3Arrays[V]);for(V in this._colors4){const O=this._colors4[V];r.setFloat4(V,O.r,O.g,O.b,O.a)}for(V in this._colors4Arrays)r.setArray4(V,this._colors4Arrays[V]);for(V in this._vectors2)r.setVector2(V,this._vectors2[V]);for(V in this._vectors3)r.setVector3(V,this._vectors3[V]);for(V in this._vectors4)r.setVector4(V,this._vectors4[V]);for(V in this._quaternions)r.setQuaternion(V,this._quaternions[V]);for(V in this._matrices)r.setMatrix(V,this._matrices[V]);for(V in this._matrixArrays)r.setMatrices(V,this._matrixArrays[V]);for(V in this._matrices3x3)r.setMatrix3x3(V,this._matrices3x3[V]);for(V in this._matrices2x2)r.setMatrix2x2(V,this._matrices2x2[V]);for(V in this._vectors2Arrays)r.setArray2(V,this._vectors2Arrays[V]);for(V in this._vectors3Arrays)r.setArray3(V,this._vectors3Arrays[V]);for(V in this._vectors4Arrays)r.setArray4(V,this._vectors4Arrays[V]);for(V in this._quaternionsArrays)r.setArray4(V,this._quaternionsArrays[V]);for(V in this._uniformBuffers){const O=this._uniformBuffers[V].getBuffer();O&&r.bindUniformBuffer(O,V)}const Z=Y.getEngine(),m=Z.setExternalTexture;if(m)for(V in this._externalTextures)m.call(Z,V,this._externalTextures[V]);const R=Z.setTextureSampler;if(R)for(V in this._textureSamplers)R.call(Z,V,this._textureSamplers[V]);const i=Z.setStorageBuffer;if(i)for(V in this._storageBuffers)i.call(Z,V,this._storageBuffers[V])}if(r&&O&&(R||!this.isFrozen)){const V=O.morphTargetManager;V&&V.numInfluencers>0&&(0,S.l)(O,r);const Z=O.bakedVertexAnimationManager;if(Z&&Z.isEnabled){var i;const V=p?d._drawWrapper:this._drawWrapper;null===(i=O.bakedVertexAnimationManager)||void 0===i||i.bind(r,!!V._wasPreviouslyUsingInstances)}}this._afterBind(O,r,d)}getActiveTextures(){const V=super.getActiveTextures();for(const O in this._textures)V.push(this._textures[O]);for(const O in this._textureArrays){const Z=this._textureArrays[O];for(let O=0;O<Z.length;O++)V.push(Z[O])}return V}hasTexture(V){if(super.hasTexture(V))return!0;for(const O in this._textures)if(this._textures[O]===V)return!0;for(const O in this._textureArrays){const Z=this._textureArrays[O];for(let O=0;O<Z.length;O++)if(Z[O]===V)return!0}return!1}clone(V){const O=i.b.Clone((()=>new G(V,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);O.name=V,O.id=V,"object"===typeof O._shaderPath&&(O._shaderPath={...O._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((V=>{const O=this._options[V];Array.isArray(O)&&(this._options[V]=O.slice(0))})),this.stencil.copyTo(O.stencil);for(const Z in this._textures)O.setTexture(Z,this._textures[Z]);for(const Z in this._textureArrays)O.setTextureArray(Z,this._textureArrays[Z]);for(const Z in this._externalTextures)O.setExternalTexture(Z,this._externalTextures[Z]);for(const Z in this._ints)O.setInt(Z,this._ints[Z]);for(const Z in this._uints)O.setUInt(Z,this._uints[Z]);for(const Z in this._floats)O.setFloat(Z,this._floats[Z]);for(const Z in this._floatsArrays)O.setFloats(Z,this._floatsArrays[Z]);for(const Z in this._colors3)O.setColor3(Z,this._colors3[Z]);for(const Z in this._colors3Arrays)O._colors3Arrays[Z]=this._colors3Arrays[Z];for(const Z in this._colors4)O.setColor4(Z,this._colors4[Z]);for(const Z in this._colors4Arrays)O._colors4Arrays[Z]=this._colors4Arrays[Z];for(const Z in this._vectors2)O.setVector2(Z,this._vectors2[Z]);for(const Z in this._vectors3)O.setVector3(Z,this._vectors3[Z]);for(const Z in this._vectors4)O.setVector4(Z,this._vectors4[Z]);for(const Z in this._quaternions)O.setQuaternion(Z,this._quaternions[Z]);for(const Z in this._quaternionsArrays)O._quaternionsArrays[Z]=this._quaternionsArrays[Z];for(const Z in this._matrices)O.setMatrix(Z,this._matrices[Z]);for(const Z in this._matrixArrays)O._matrixArrays[Z]=this._matrixArrays[Z].slice();for(const Z in this._matrices3x3)O.setMatrix3x3(Z,this._matrices3x3[Z]);for(const Z in this._matrices2x2)O.setMatrix2x2(Z,this._matrices2x2[Z]);for(const Z in this._vectors2Arrays)O.setArray2(Z,this._vectors2Arrays[Z]);for(const Z in this._vectors3Arrays)O.setArray3(Z,this._vectors3Arrays[Z]);for(const Z in this._vectors4Arrays)O.setArray4(Z,this._vectors4Arrays[Z]);for(const Z in this._uniformBuffers)O.setUniformBuffer(Z,this._uniformBuffers[Z]);for(const Z in this._textureSamplers)O.setTextureSampler(Z,this._textureSamplers[Z]);for(const Z in this._storageBuffers)O.setStorageBuffer(Z,this._storageBuffers[Z]);return O}dispose(V,O,Z){if(O){let V;for(V in this._textures)this._textures[V].dispose();for(V in this._textureArrays){const O=this._textureArrays[V];for(let V=0;V<O.length;V++)O[V].dispose()}}this._textures={},super.dispose(V,O,Z)}serialize(){const V=i.b.Serialize(this);let O;for(O in V.customType="BABYLON.ShaderMaterial",V.uniqueId=this.uniqueId,V.options=this._options,V.shaderPath=this._shaderPath,V.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,V.stencil=this.stencil.serialize(),V.textures={},this._textures)V.textures[O]=this._textures[O].serialize();for(O in V.textureArrays={},this._textureArrays){V.textureArrays[O]=[];const Z=this._textureArrays[O];for(let d=0;d<Z.length;d++)V.textureArrays[O].push(Z[d].serialize())}for(O in V.ints={},this._ints)V.ints[O]=this._ints[O];for(O in V.uints={},this._uints)V.uints[O]=this._uints[O];for(O in V.floats={},this._floats)V.floats[O]=this._floats[O];for(O in V.floatsArrays={},this._floatsArrays)V.floatsArrays[O]=this._floatsArrays[O];for(O in V.colors3={},this._colors3)V.colors3[O]=this._colors3[O].Wi();for(O in V.colors3Arrays={},this._colors3Arrays)V.colors3Arrays[O]=this._colors3Arrays[O];for(O in V.colors4={},this._colors4)V.colors4[O]=this._colors4[O].Wi();for(O in V.colors4Arrays={},this._colors4Arrays)V.colors4Arrays[O]=this._colors4Arrays[O];for(O in V.vectors2={},this._vectors2)V.vectors2[O]=this._vectors2[O].Wi();for(O in V.vectors3={},this._vectors3)V.vectors3[O]=this._vectors3[O].Wi();for(O in V.vectors4={},this._vectors4)V.vectors4[O]=this._vectors4[O].Wi();for(O in V.quaternions={},this._quaternions)V.quaternions[O]=this._quaternions[O].Wi();for(O in V.matrices={},this._matrices)V.matrices[O]=this._matrices[O].Wi();for(O in V.matrixArray={},this._matrixArrays)V.matrixArray[O]=this._matrixArrays[O];for(O in V.matrices3x3={},this._matrices3x3)V.matrices3x3[O]=this._matrices3x3[O];for(O in V.matrices2x2={},this._matrices2x2)V.matrices2x2[O]=this._matrices2x2[O];for(O in V.vectors2Arrays={},this._vectors2Arrays)V.vectors2Arrays[O]=this._vectors2Arrays[O];for(O in V.vectors3Arrays={},this._vectors3Arrays)V.vectors3Arrays[O]=this._vectors3Arrays[O];for(O in V.vectors4Arrays={},this._vectors4Arrays)V.vectors4Arrays[O]=this._vectors4Arrays[O];for(O in V.quaternionsArrays={},this._quaternionsArrays)V.quaternionsArrays[O]=this._quaternionsArrays[O];return V}static Parse(V,O,Z){const p=i.b.Parse((()=>new G(V.name,O,V.shaderPath,V.options,V.storeEffectOnSubMeshes)),V,O,Z);let r;for(r in V.stencil&&p.stencil.parse(V.stencil,O,Z),V.textures)p.setTexture(r,c.b.Parse(V.textures[r],O,Z));for(r in V.textureArrays){const d=V.textureArrays[r],Y=[];for(let V=0;V<d.length;V++)Y.push(c.b.Parse(d[V],O,Z));p.setTextureArray(r,Y)}for(r in V.ints)p.setInt(r,V.ints[r]);for(r in V.uints)p.setUInt(r,V.uints[r]);for(r in V.floats)p.setFloat(r,V.floats[r]);for(r in V.floatsArrays)p.setFloats(r,V.floatsArrays[r]);for(r in V.colors3)p.setColor3(r,Y.b.Cg(V.colors3[r]));for(r in V.colors3Arrays){const O=V.colors3Arrays[r].reduce(((V,O,Z)=>(Z%3===0?V.push([O]):V[V.length-1].push(O),V)),[]).map((V=>Y.b.Cg(V)));p.setColor3Array(r,O)}for(r in V.colors4)p.setColor4(r,Y.f.Cg(V.colors4[r]));for(r in V.colors4Arrays){const O=V.colors4Arrays[r].reduce(((V,O,Z)=>(Z%4===0?V.push([O]):V[V.length-1].push(O),V)),[]).map((V=>Y.f.Cg(V)));p.setColor4Array(r,O)}for(r in V.vectors2)p.setVector2(r,d.l.Cg(V.vectors2[r]));for(r in V.vectors3)p.setVector3(r,d.m.Cg(V.vectors3[r]));for(r in V.vectors4)p.setVector4(r,d.p.Cg(V.vectors4[r]));for(r in V.quaternions)p.setQuaternion(r,d.g.Cg(V.quaternions[r]));for(r in V.matrices)p.setMatrix(r,d.c.Cg(V.matrices[r]));for(r in V.matrixArray)p._matrixArrays[r]=new Float32Array(V.matrixArray[r]);for(r in V.matrices3x3)p.setMatrix3x3(r,V.matrices3x3[r]);for(r in V.matrices2x2)p.setMatrix2x2(r,V.matrices2x2[r]);for(r in V.vectors2Arrays)p.setArray2(r,V.vectors2Arrays[r]);for(r in V.vectors3Arrays)p.setArray3(r,V.vectors3Arrays[r]);for(r in V.vectors4Arrays)p.setArray4(r,V.vectors4Arrays[r]);for(r in V.quaternionsArrays)p.setArray4(r,V.quaternionsArrays[r]);return p}static ParseFromFileAsync(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((p,r)=>{const Y=new Q.b;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const O=JSON.parse(Y.responseText),r=this.Parse(O,Z||U.e.LastCreatedScene,d);V&&(r.name=V),p(r)}else r("Unable to load the ShaderMaterial")})),Y.open("GET",O),Y.send()}))}static ParseFromSnippetAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((d,p)=>{const r=new Q.b;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const p=JSON.parse(JSON.parse(r.responseText).jsonPayload),Y=JSON.parse(p.shaderMaterial),m=this.Parse(Y,O||U.e.LastCreatedScene,Z);m.snippetId=V,d(m)}else p("Unable to load the snippet "+V)})),r.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),r.send()}))}}G.SnippetUrl="https://snippet.babylonjs.com",G.CreateFromSnippetAsync=G.ParseFromSnippetAsync,(0,W.f)("BABYLON.ShaderMaterial",G),p.c._LinesMeshParser=(V,O)=>w.Parse(V,O);class w extends p.c{_isShaderMaterial(V){return"ShaderMaterial"===V.getClassName()}constructor(V){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0;super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O,arguments.length>4?arguments[4]:void 0),this.useVertexColor=d,this.useVertexAlpha=p,this.color=new Y.b(1,1,1),this.alpha=1,this._shaderLanguage=0,O&&(this.color=O.color.clone(),this.alpha=O.alpha,this.useVertexColor=O.useVertexColor,this.useVertexAlpha=O.useVertexAlpha),this.intersectionThreshold=.1;const a={attributes:[m.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===p?a.needAlphaBlending=!1:a.defines.push("#define VERTEXALPHA"),d?(a.defines.push("#define VERTEXCOLOR"),a.attributes.push(m.e.ColorKind)):(a.uniforms.push("color"),this._color4=new Y.f),r)this.material=r;else{this.va().getEngine().isWebGPU&&!w.ForceGLSL&&(this._shaderLanguage=1),a.shaderLanguage=this._shaderLanguage,a.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([Z.e(23).then(Z.bind(Z,13476)),Z.e(47).then(Z.bind(Z,13478))]):await Promise.all([Z.e(28).then(Z.bind(Z,13480)),Z.e(48).then(Z.bind(Z,13489))])},this.material=new G("colorShader",this.va(),"color",a,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(V){this._lineMaterial=V,this._lineMaterial.fillMode=R.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(V){}_bind(V,O){if(!this._geometry)return this;const Z=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(O,Z):this._geometry._bind(O,Z,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:V,g:O,b:Z}=this.color;this._color4.set(V,O,Z,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(V,O,Z){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const d=this.va().getEngine();return this._unIndexed?d.drawArraysType(R.e.LineListDrawMode,V.verticesStart,V.verticesCount,Z):d.drawElementsType(R.e.LineListDrawMode,V.indexStart,V.indexCount,Z),this}dispose(V){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(V)}clone(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;return new w(V,this.va(),O,this,Z)}Vc(V){const O=new t(V,this);if(this.instancedBuffers){O.instancedBuffers={};for(const V in this.instancedBuffers)O.instancedBuffers[V]=this.instancedBuffers[V]}return O}serialize(V){super.serialize(V),V.color=this.color.Wi(),V.alpha=this.alpha}static Parse(V,O){const Z=new w(V.name,O);return Z.color=Y.b.Cg(V.color),Z.alpha=V.alpha,Z}}w.ForceGLSL=!1;class t extends a.b{constructor(V,O){super(V,O),this.intersectionThreshold=O.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var C=Z(10914);function v(V){const O=[],Z=[],d=V.lines,p=V.za,Y=[];let m=0;for(let r=0;r<d.length;r++){const V=d[r];for(let d=0;d<V.length;d++){const{x:a,y:R,z:i}=V[d];if(Z.push(a,R,i),p){const V=p[r],{r:O,g:Z,b:m,a:a}=V[d];Y.push(O,Z,m,a)}d>0&&(O.push(m-1),O.push(m)),m++}}const a=new r.e;return a.indices=O,a.xa=Z,p&&(a.za=Y),a}function A(V){const O=V.dashSize||3,Z=V.gapSize||1,p=V.dashNb||200,Y=V.points,m=[],a=[],R=d.m.Zero();let i=0,M=0,c=0,W=0,F=0,Q=0,b=0;for(b=0;b<Y.length-1;b++)Y[b+1].subtractToRef(Y[b],R),i+=R.length();for(c=i/p,W=O*c/(O+Z),b=0;b<Y.length-1;b++){Y[b+1].subtractToRef(Y[b],R),M=Math.floor(R.length()/c),R.normalize();for(let V=0;V<M;V++)F=c*V,m.push(Y[b].x+F*R.x,Y[b].y+F*R.y,Y[b].z+F*R.z),m.push(Y[b].x+(F+W)*R.x,Y[b].y+(F+W)*R.y,Y[b].z+(F+W)*R.z),a.push(Q,Q+1),Q+=2}const U=new r.e;return U.xa=m,U.indices=a,U}function l(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=O.instance,p=O.lines,r=O.za;if(d){const V=d.getVerticesData(m.e.PositionKind);let O,Z;r&&(O=d.getVerticesData(m.e.ColorKind));let Y=0,a=0;for(let d=0;d<p.length;d++){const m=p[d];for(let p=0;p<m.length;p++)V[Y]=m[p].x,V[Y+1]=m[p].y,V[Y+2]=m[p].z,r&&O&&(Z=r[d],O[a]=Z[p].r,O[a+1]=Z[p].g,O[a+2]=Z[p].b,O[a+3]=Z[p].a,a+=4),Y+=3}return d.updateVerticesData(m.e.PositionKind,V,!1,!1),r&&O&&d.updateVerticesData(m.e.ColorKind,O,!1,!1),d.refreshBoundingInfo(),d}const Y=new w(V,Z,null,void 0,void 0,!!r,O.useVertexAlpha,O.material);return v(O).Ca(Y,O.updatable),Y}function I(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=O.za?[O.za]:null;return l(V,{lines:[O.points],updatable:O.updatable,instance:O.instance,za:d,useVertexAlpha:O.useVertexAlpha,material:O.material},Z)}function g(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=O.points,Y=O.instance,m=O.gapSize||1,a=O.dashSize||3;if(Y){const V=V=>{const O=d.m.Zero(),Z=V.length/6;let p=0,m=0,a=0,R=0,i=0,M=0,c=0,W=0;for(c=0;c<r.length-1;c++)r[c+1].subtractToRef(r[c],O),p+=O.length();a=p/Z;const F=Y._creationDataStorage.dashSize;for(R=F*a/(F+Y._creationDataStorage.gapSize),c=0;c<r.length-1;c++)for(r[c+1].subtractToRef(r[c],O),m=Math.floor(O.length()/a),O.normalize(),W=0;W<m&&M<V.length;)i=a*W,V[M]=r[c].x+i*O.x,V[M+1]=r[c].y+i*O.y,V[M+2]=r[c].z+i*O.z,V[M+3]=r[c].x+(i+R)*O.x,V[M+4]=r[c].y+(i+R)*O.y,V[M+5]=r[c].z+(i+R)*O.z,M+=6,W++;for(;M<V.length;)V[M]=r[c].x,V[M+1]=r[c].y,V[M+2]=r[c].z,M+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&C.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Y.updateMeshPositions(V,!1),Y}const R=new w(V,Z,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return A(O).Ca(R,O.updatable),R._creationDataStorage=new p.f,R._creationDataStorage.dashSize=a,R._creationDataStorage.gapSize=m,R}r.e.CreateLineSystem=v,r.e.CreateDashedLines=A,p.c.ub=function(V,O){return I(V,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},p.c.CreateDashedLines=function(V,O,Z,d,p){return g(V,{points:O,dashSize:Z,gapSize:d,dashNb:p,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11623:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>m,h:()=>a});var d=Z(11508),p=Z(11530),r=Z(11476);function Y(V){const O=[],Z=[],d=[],Y=[],m=V.width||V.size||1,a=V.height||V.size||1,R=0===V.sideOrientation?0:V.sideOrientation||p.e.DEFAULTSIDE,i=m/2,M=a/2;Z.push(-i,-M,0),d.push(0,0,-1),Y.push(0,r.c?1:0),Z.push(i,-M,0),d.push(0,0,-1),Y.push(1,r.c?1:0),Z.push(i,M,0),d.push(0,0,-1),Y.push(1,r.c?0:1),Z.push(-i,M,0),d.push(0,0,-1),Y.push(0,r.c?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),p.e._ComputeSides(R,Z,O,d,Y,V.frontUVs,V.backUVs);const c=new p.e;return c.indices=O,c.xa=Z,c.ya=d,c.Aa=Y,c}function m(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new d.c(V,Z);O.sideOrientation=d.c._GetDefaultSideOrientation(O.sideOrientation),p._originalBuilderSideOrientation=O.sideOrientation;return Y(O).Ca(p,O.updatable),O.sourcePlane&&(p.translate(O.sourcePlane.ab,-O.sourcePlane.d),p.setDirection(O.sourcePlane.ab.scale(-1))),p}const a={Jf:m};p.e.Jf=Y,d.c.Jf=(V,O,Z,d,p)=>m(V,{size:O,width:O,height:O,sideOrientation:p,updatable:d},Z)},11846:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>a});var d=Z(11251),p=Z(11508),r=Z(11530),Y=Z(11476);function m(V){const O=0|(V.segments||32),Z=V.diameterX||V.diameter||1,p=V.diameterY||V.diameter||1,m=V.diameterZ||V.diameter||1,a=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,R=V.slice&&V.slice<=0?1:V.slice||1,i=0===V.sideOrientation?0:V.sideOrientation||r.e.DEFAULTSIDE,M=!!V.dedupTopBottomIndices,c=new d.m(Z/2,p/2,m/2),W=2+O,F=2*W,Q=[],b=[],U=[],H=[];for(let r=0;r<=W;r++){const V=r/W,O=V*Math.PI*R;for(let Z=0;Z<=F;Z++){const p=Z/F,r=p*Math.PI*2*a,m=d.c.RotationZ(-O),R=d.c.RotationY(r),i=d.m.TransformCoordinates(d.m.Up(),m),M=d.m.TransformCoordinates(i,R),W=M.multiply(c),Q=M.divide(c).normalize();b.push(W.x,W.y,W.z),U.push(Q.x,Q.y,Q.z),H.push(p,Y.c?1-V:V)}if(r>0){const V=b.length/3;for(let O=V-2*(F+1);O+F+2<V;O++)M?(r>1&&(Q.push(O),Q.push(O+1),Q.push(O+F+1)),(r<W||R<1)&&(Q.push(O+F+1),Q.push(O+1),Q.push(O+F+2))):(Q.push(O),Q.push(O+1),Q.push(O+F+1),Q.push(O+F+1),Q.push(O+1),Q.push(O+F+2))}}r.e._ComputeSides(i,b,Q,U,H,V.frontUVs,V.backUVs);const S=new r.e;return S.indices=Q,S.xa=b,S.ya=U,S.Aa=H,S}function a(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return m(O).Ca(d,O.updatable),d}r.e.CreateSphere=m,p.c.CreateSphere=(V,O,Z,d,p,r)=>a(V,{segments:O,diameterX:Z,diameterY:Z,diameterZ:Z,sideOrientation:r,updatable:p},d)},12224:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>M});var d=Z(10900),p=Z(12230),r=Z(11539),Y=Z(11316),m=Z(11530),a=Z(10914);function R(V,O,Z,d,p){let r=null,Y=null,m=null;try{let a;r=new V.Decoder,Y=new V.DecoderBuffer,Y.Init(O,O.byteLength);const R=r.GetEncodedGeometryType(Y);switch(R){case V.TRIANGULAR_MESH:{const O=new V.Mesh;if(a=r.DecodeBufferToMesh(Y,O),!a.ok()||0===O.ptr)throw new Error(a.error_msg());const Z=3*O.num_faces(),p=4*Z,R=V._malloc(p);try{r.GetTrianglesUInt32Array(O,p,R);const Y=new Uint32Array(Z);Y.set(new Uint32Array(V.HEAPF32.buffer,R,Z)),d(Y)}finally{V._free(R)}m=O;break}case V.POINT_CLOUD:{const O=new V.PointCloud;if(a=r.DecodeBufferToPointCloud(Y,O),!a.ok()||!O.ptr)throw new Error(a.error_msg());m=O;break}default:throw new Error(`Invalid geometry type ${R}`)}const i=m.num_points(),M=(O,Z,d,r)=>{const Y=r.data_type(),m=r.num_components(),a=r.normalized(),R=r.byte_stride(),M=r.byte_offset(),c={[V.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:V.HEAPF32},[V.DT_INT8]:{typedArrayConstructor:Int8Array,heap:V.HEAP8},[V.DT_INT16]:{typedArrayConstructor:Int16Array,heap:V.HEAP16},[V.DT_INT32]:{typedArrayConstructor:Int32Array,heap:V.HEAP32},[V.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:V.HEAPU8},[V.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:V.HEAPU16},[V.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:V.HEAPU32}}[Y];if(!c)throw new Error(`Invalid data type ${Y}`);const W=i*m,F=W*c.typedArrayConstructor.BYTES_PER_ELEMENT,Q=V._malloc(F);try{O.GetAttributeDataArrayForAllPoints(Z,r,Y,F,Q);const V=new c.typedArrayConstructor(c.heap.buffer,Q,W);p(d,V.slice(),m,M,R,a)}finally{V._free(Q)}};if(Z)for(const V in Z){const O=Z[V],d=r.GetAttributeByUniqueId(m,O);M(r,m,V,d)}else{const O={position:V.POSITION,ab:V.NORMAL,color:V.COLOR,uv:V.TEX_COORD};for(const V in O){const Z=r.GetAttributeId(m,O[V]);if(-1!==Z){const O=r.GetAttribute(m,Z);M(r,m,V,O)}}}return i}finally{m&&V.destroy(m),Y&&V.destroy(Y),r&&V.destroy(r)}}function i(){let V;onmessage=O=>{const Z=O.data;switch(Z.id){case"init":{const O=Z.decoder;O.url&&importScripts(O.url);const d=O.wasmBinary?{wasmBinary:O.wasmBinary}:{};V=DracoDecoderModule(d),postMessage({id:"initDone"});break}case"decodeMesh":if(!V)throw new Error("Draco decoder module is not available");V.then((V=>{const O=R(V,Z.dataView,Z.attributes,(V=>{postMessage({id:"indices",data:V},[V.buffer])}),((V,O,Z,d,p,r)=>{postMessage({id:"attribute",kind:V,data:O,size:Z,byteOffset:d,byteStride:p,normalized:r},[O.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:O})}))}}}class M{static get DecoderAvailable(){const V=M.Configuration.decoder;return!!(V.wasmUrl&&V.wasmBinaryUrl&&"object"===typeof WebAssembly||V.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return M._Default||(M._Default=new M),M._Default}static ResetDefault(V){M._Default&&(V||M._Default.dispose(),M._Default=null)}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.DefaultNumWorkers;const O=M.Configuration.decoder;if(O.workerPool||"object"===typeof V&&V.workerPool)this._workerPoolPromise=Promise.resolve(O.workerPool||V.workerPool);else{const Z=O.wasmBinary||"object"===typeof V&&V.wasmBinary,r="number"===typeof V?V:V.numWorkers,Y=r&&"function"===typeof Worker&&"function"===typeof URL,m=Y||!Y&&!O.jsModule,a=O.wasmUrl&&O.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:m?d.e.GetBabylonScriptURL(O.wasmUrl,!0):"",wasmBinaryPromise:Z?Promise.resolve(Z):d.e.LoadFileAsync(d.e.GetBabylonScriptURL(O.wasmBinaryUrl,!0))}:{url:m?d.e.GetBabylonScriptURL(O.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};Y?this._workerPoolPromise=a.wasmBinaryPromise.then((V=>{const O=`${R}(${i})()`,Z=URL.createObjectURL(new Blob([O],{type:"application/javascript"}));return new p.e(r,(()=>function(V,O,Z){return new Promise(((d,p)=>{const r=O=>{V.removeEventListener("error",r),V.removeEventListener("message",Y),p(O)},Y=O=>{"initDone"===O.data.id&&(V.removeEventListener("error",r),V.removeEventListener("message",Y),d(V))};if(V.addEventListener("error",r),V.addEventListener("message",Y),O){const d=O.slice(0);V.postMessage({id:"init",decoder:{url:Z,wasmBinary:d}},[d])}else V.postMessage({id:"init",decoder:{url:Z}})}))}(new Worker(Z),V,a.url)))})):this._decoderModulePromise=a.wasmBinaryPromise.then((async V=>{if("undefined"===typeof DracoDecoderModule&&!O.jsModule){if(!a.url)throw new Error("Draco decoder module is not available");await d.e.LoadBabylonScriptAsync(a.url)}return await(Z=V,p=O.jsModule,new Promise((V=>{(p||DracoDecoderModule)({wasmBinary:Z}).then((O=>{V({module:O})}))})));var Z,p}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((V=>{V.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(V,O,Z){const d=V instanceof ArrayBuffer?new Int8Array(V):new Int8Array(V.buffer,V.byteOffset,V.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((V=>new Promise(((p,r)=>{V.push(((V,Y)=>{let m=null;const R=[],i=O=>{V.removeEventListener("error",i),V.removeEventListener("message",M),r(O),Y()},M=O=>{const d=O.data;switch(d.id){case"decodeMeshDone":V.removeEventListener("error",i),V.removeEventListener("message",M),p({indices:m,attributes:R,totalVertices:d.totalVertices}),Y();break;case"indices":m=d.data;break;case"attribute":R.push({kind:d.kind,data:d.data,size:d.size,byteOffset:d.byteOffset,byteStride:d.byteStride,normalized:(r=d.kind,c=d.normalized,Z&&void 0!==Z[r]?(c!==Z[r]&&a.b.Warn(`Normalized flag from Draco data (${c}) does not match normalized flag from glTF accessor (${Z[r]}). Using flag from glTF accessor.`),Z[r]):c)})}var r,c};V.addEventListener("error",i),V.addEventListener("message",M);const c=d.slice();V.postMessage({id:"decodeMesh",dataView:c,attributes:O},[c.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((V=>{let Z=null;const p=[],r=R(V.module,d,O,(V=>{Z=V}),((V,O,Z,d,r,Y)=>{p.push({kind:V,data:O,size:Z,byteOffset:d,byteStride:r,normalized:Y})}));return{indices:Z,attributes:p,totalVertices:r}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(V,O,Z,d){const p=await this.decodeMeshToMeshDataAsync(Z,d),m=new r.d(V,O);p.indices&&m.setIndices(p.indices);for(const r of p.attributes)m.setVerticesBuffer(new Y.e(O.getEngine(),r.data,r.kind,!1,void 0,r.byteStride,void 0,r.byteOffset,r.size,void 0,r.normalized,!0),p.totalVertices);return m}async _decodeMeshToGeometryForGltfAsync(V,O,Z,d,p){const m=await this.decodeMeshToMeshDataAsync(Z,d,p),a=new r.d(V,O);m.indices&&a.setIndices(m.indices);for(const r of m.attributes)a.setVerticesBuffer(new Y.e(O.getEngine(),r.data,r.kind,!1,void 0,r.byteStride,void 0,r.byteOffset,r.size,void 0,r.normalized,!0),m.totalVertices);return a}async decodeMeshAsync(V,O){const Z=await this.decodeMeshToMeshDataAsync(V,O),d=new m.e;Z.indices&&(d.indices=Z.indices);for(const p of Z.attributes){const V=Y.e.GetFloatData(p.data,p.size,Y.e.GetDataType(p.data),p.byteOffset,p.byteStride,p.normalized,Z.totalVertices);d.set(V,p.kind)}return d}}M.Configuration={decoder:{wasmUrl:`${d.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${d.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${d.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},M.DefaultNumWorkers=M.GetDefaultNumWorkers(),M._Default=null},11686:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});var d=Z(11325);class p extends d.c{constructor(V){super(),this._buffer=V}get underlyingResource(){return this._buffer}}},11552:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>t});var d=Z(11210),p=Z(10902),r=Z(11251),Y=Z(11316),m=Z(11530),a=Z(11556),R=Z(11310),i=Z(11421),M=Z(11305);class c{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new r.m(0,0,0),this._diffPositionForCollisions=new r.m(0,0,0),this._collisionResponse=!0}}var W=Z(10928),F=Z(11435),Q=Z(11274),b=Z(11255),U=Z(11562),H=Z(11041),S=Z(11216),z=Z(10983);class G{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=r.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class w{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new G,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new c,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class t extends a.b{static get BILLBOARDMODE_NONE(){return a.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return a.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return a.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return a.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return a.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return a.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(V){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=V}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(V){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=V}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=V}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=V}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(V){this._internalAbstractMeshDataInfo._collisionRetryCount=V}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(V){this._internalAbstractMeshDataInfo._morphTargetManager!==V&&(this._internalAbstractMeshDataInfo._morphTargetManager=V,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(V){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==V&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=V,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(V){return!!super._updateNonUniformScalingState(V)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(V){this._internalAbstractMeshDataInfo._rawBoundingInfo=V}set yk(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(V)}set onCollisionPositionChange(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(V)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(V){if(this._internalAbstractMeshDataInfo._visibility===V)return;const O=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=V,(1===O&&1!==V||1!==O&&1===V)&&this._markSubMeshesAsDirty((V=>{V.markAsMiscDirty(),V.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(V){this._internalAbstractMeshDataInfo._inheritVisibility=V}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let V=this._parentNode;for(;V;){const O=V.isVisible;if("undefined"!==typeof O)return O;V=V.parent}}return this._isVisible}set isVisible(V){this._isVisible=V}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(V){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=V}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(V){this._internalAbstractMeshDataInfo._renderingGroupId=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){this._setMaterial(V)}_setMaterial(V){this._internalAbstractMeshDataInfo._material!==V&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=V,V&&V.meshMap&&(V.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Ef&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(V){var O;return null===(O=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===O?void 0:O[V]}setMaterialForRenderPass(V,O){this.resetDrawCache(V),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[V]=O}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(V){this._internalAbstractMeshDataInfo._receiveShadows!==V&&(this._internalAbstractMeshDataInfo._receiveShadows=V,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(V){this._internalAbstractMeshDataInfo._hasVertexAlpha!==V&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=V,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(V){this._internalAbstractMeshDataInfo._useVertexColors!==V&&(this._internalAbstractMeshDataInfo._useVertexColors=V,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(V){this._internalAbstractMeshDataInfo._numBoneInfluencers!==V&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=V,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(V){this._internalAbstractMeshDataInfo._applyFog!==V&&(this._internalAbstractMeshDataInfo._applyFog=V,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(V){this._internalAbstractMeshDataInfo._enableDistantPicking=V}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(V){V!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=V,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(V)?-1:V}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=V}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(V)?-1:V}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(V){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=V}get lightSources(){return this._lightSources}set skeleton(V){const O=this._internalAbstractMeshDataInfo._skeleton;O&&O.needInitialSkinMatrix&&O._unregisterMeshWithPoseMatrix(this),V&&V.needInitialSkinMatrix&&V._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=V,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(V){var O;let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(V,Z,!1),O=this,this._internalAbstractMeshDataInfo=new w,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.oi=t.pi,this.onCollideObservable=new p.e,this.onCollisionPositionChangeObservable=new p.e,this.onMaterialChangedObservable=new p.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.oe=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Q.b.Red(),this.outlineWidth=.02,this.overlayColor=Q.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.jg=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new r.m(.5,1,.5),this.ellipsoidOffset=new r.m(0,0,0),this.edgesWidth=1,this.edgesColor=new Q.f(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,yh:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new p.e,this._onCollisionPositionChange=function(V,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.subtractToRef(O._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,O._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),O._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>z.e.CollisionsEpsilon&&O.position.addInPlace(O._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),d&&O.onCollideObservable.notifyObservers(d),O.onCollisionPositionChangeObservable.notifyObservers(O.position)},Z=this.va(),Z.Yh(this),this._resyncLightSources(),this._uniformBuffer=new M.b(this.va().getEngine(),void 0,void 0,V,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),Z.performancePriority){case 2:this.Da=!0;case 1:this.jg=!0,this.oe=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(V){const O=this._uniformBuffer;O.tj("world",V),O.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),O.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(V){let O="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");O+=", # of submeshes: "+(this.Ef?this.Ef.length:0);const Z=this._internalAbstractMeshDataInfo._skeleton;return Z&&(O+=", skeleton: "+Z.name),V&&(O+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],O+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.yh?"YES":"NO")),O}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==a.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(O||this.actionManager.isRecursive)){if(!V)return this.actionManager;if(this.actionManager.hasSpecificTrigger(V))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Ef){for(const V of this.Ef)V._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const V of this.va().lights)V.isEnabled()&&V.canAffectMesh(this)&&this._lightSources.push(V);this._markSubMeshesAsLightDirty()}_resyncLightSource(V){const O=V.isEnabled()&&V.canAffectMesh(this),Z=this._lightSources.indexOf(V);let d=!1;if(-1===Z){if(!O)return;this._lightSources.push(V)}else{if(O)return;d=!0,this._lightSources.splice(Z,1)}this._markSubMeshesAsLightDirty(d)}_unBindEffect(){for(const V of this.Ef)V.setEffect(null)}_removeLightSource(V,O){const Z=this._lightSources.indexOf(V);-1!==Z&&(this._lightSources.splice(Z,1),this._markSubMeshesAsLightDirty(O))}_markSubMeshesAsDirty(V){if(this.Ef)for(const O of this.Ef)for(let Z=0;Z<O._drawWrappers.length;++Z){const d=O._drawWrappers[Z];d&&d.defines&&d.defines.markAllAsDirty&&V(d.defines)}}_markSubMeshesAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((O=>O.markAsLightDirty(V)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((V=>V.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((V=>V.markAsMiscDirty()))}sg(V){return this._currentRenderId=Number.MAX_VALUE,super.sg(V),this._isDirty=!0,this}resetDrawCache(V){if(this.Ef)for(const O of this.Ef)O.resetDrawCache(V)}get isBlocked(){return!1}getLOD(V){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}qf(){return null}getVerticesData(V){return null}Ga(V,O,Z,d){return this}updateVerticesData(V,O,Z,d){return this}setIndices(V,O){return this}isVerticesDataPresent(V){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(V){return this._boundingInfo=V,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(V,O,Z){return this._boundingInfo=new i.c(V,O,Z),this._boundingInfo}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(V,O,Z)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(Y.e.MatricesIndicesKind)&&this.isVerticesDataPresent(Y.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(V){}_activate(V,O){return this._renderId=V,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===a.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(V,O,Z){return this.position.addInPlace(this.calcMovePOV(V,O,Z)),this}calcMovePOV(V,O,Z){const d=new r.c;(this.rotationQuaternion?this.rotationQuaternion:r.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(d);const p=r.m.Zero(),Y=this.definedFacingForward?-1:1;return r.m.TransformCoordinatesFromFloatsToRef(V*Y,O,Z*Y,d,p),p}rotatePOV(V,O,Z){return this.rotation.addInPlace(this.calcRotatePOV(V,O,Z)),this}calcRotatePOV(V,O,Z){const d=this.definedFacingForward?1:-1;return new r.m(V*d,O,Z*d)}Fa(V,O){if(V){const Z=(0,F.f)(V,0,this.getTotalVertices(),O);this._boundingInfo?this._boundingInfo.reConstruct(Z.minimum,Z.maximum):this._boundingInfo=new i.c(Z.minimum,Z.maximum)}if(this.Ef)for(let Z=0;Z<this.Ef.length;Z++)this.Ef[Z].refreshBoundingInfo(V);this.Ea()}_refreshBoundingInfoDirect(V){if(this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new i.c(V.minimum,V.maximum),this.Ef)for(let O=0;O<this.Ef.length;O++)this.Ef[O].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(V,O,Z,d,p,m,a){!function(V,O,Z,d,p,m,a){const R=r.i.ib[0],i=r.i.Matrix[0],M=r.i.Matrix[1],c=O===Y.e.NormalKind?r.m.TransformNormalFromFloatsToRef:r.m.TransformCoordinatesFromFloatsToRef;for(let Y=0,W=0;Y<V.length;Y+=3,W+=4){let O,F;for(i.reset(),O=0;O<4;O++)F=p[W+O],F>0&&(r.c.FromFloat32ArrayToRefScaled(Z,Math.floor(16*d[W+O]),F,M),i.addToSelf(M));if(m&&a)for(O=0;O<4;O++)F=a[W+O],F>0&&(r.c.FromFloat32ArrayToRefScaled(Z,Math.floor(16*m[W+O]),F,M),i.addToSelf(M));c(V[Y],V[Y+1],V[Y+2],i,R),R.toArray(V,Y)}}(V,O,Z,d,p,m,a)}_getData(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.PositionKind;const d=V.cache,p=V=>{if(d){const O=d._vertexData||(d._vertexData={});return O[V]||this.copyVerticesData(V,O),O[V]}return this.getVerticesData(V)};if(O||(O=p(Z)),!O)return null;if(d?(d._outputData?d._outputData.set(O):d._outputData=new Float32Array(O),O=d._outputData):(V.applyMorph&&this.morphTargetManager||V.applySkeleton&&this.skeleton)&&(O=O.slice()),V.applyMorph&&this.morphTargetManager&&function(V,O,Z){let d=null;switch(O){case Y.e.PositionKind:d=V=>V.getPositions();break;case Y.e.NormalKind:d=V=>V.getNormals();break;case Y.e.TangentKind:d=V=>V.getTangents();break;case Y.e.UVKind:d=V=>V.getUVs();break;default:return}for(let p=0;p<V.length;p++){let O=V[p];for(let r=0;r<Z.numTargets;r++){const Y=Z.getTarget(r),m=Y.influence;if(0!==m){const Z=d(Y);Z&&(O+=(Z[p]-V[p])*m)}}V[p]=O}}(O,Z,this.morphTargetManager),V.applySkeleton&&this.skeleton){const V=p(Y.e.MatricesIndicesKind),d=p(Y.e.MatricesWeightsKind);if(d&&V){const r=this.numBoneInfluencers>4,m=r?p(Y.e.MatricesIndicesExtraKind):null,a=r?p(Y.e.MatricesWeightsExtraKind):null,R=this.skeleton.getTransformMatrices(this);t._ApplySkeleton(O,Z,R,V,d,m,a)}}if(!1!==V.updatePositionsArray&&Z===Y.e.PositionKind){const V=this._internalAbstractMeshDataInfo._positions||[],Z=V.length;if(V.length=O.length/3,Z<V.length)for(let O=Z;O<V.length;O++)V[O]=new r.m;for(let d=0,p=0;d<V.length;d++,p+=3)V[d].nf(O[p],O[p+1],O[p+2]);this._internalAbstractMeshDataInfo._positions=V}return O}getNormalsData(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:V,applyMorph:O,updatePositionsArray:!1},null,Y.e.NormalKind)}ze(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:V,applyMorph:O,updatePositionsArray:!1},Z,Y.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new i.c(r.m.Zero(),r.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(V){if(!this.Ef)return this;const O=this.Ef.length;for(let Z=0;Z<O;Z++){const d=this.Ef[Z];(O>1||!d.IsGlobal)&&d.updateBoundingInfo(V)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(V){return this.getBoundingInfo().isInFrustum(V,this.oi)}isCompletelyInFrustum(V){return this.getBoundingInfo().isCompletelyInFrustum(V)}intersectsMesh(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;const d=this.getBoundingInfo(),p=V.getBoundingInfo();if(d.intersects(p,O))return!0;if(Z)for(const r of this.getChildMeshes())if(r.intersectsMesh(V,O,!0))return!0;return!1}intersectsPoint(V){return this.getBoundingInfo().intersectsPoint(V)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(V){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=V}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(V){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const O=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=O.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,O.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,V,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(V,O,Z){var d;if(this._generatePointsArray(),!this._positions)return this;if(!V._lastColliderWorldVertices||!V._lastColliderTransformMatrix.equals(O)){V._lastColliderTransformMatrix=O.clone(),V._lastColliderWorldVertices=[],V._trianglePlanes=[];const Z=V.verticesStart,d=V.verticesStart+V.verticesCount;for(let p=Z;p<d;p++)V._lastColliderWorldVertices.push(r.m.TransformCoordinates(this._positions[p],O))}return Z._collide(V._trianglePlanes,V._lastColliderWorldVertices,this.qf(),V.indexStart,V.indexStart+V.indexCount,V.verticesStart,!!V.Ha(),this,this._shouldConvertRHS(),7===(null===(d=V.Ha())||void 0===d?void 0:d.fillMode)),this}_processCollisionsForSubMeshes(V,O){const Z=this._scene.getCollidingSubMeshCandidates(this,V),d=Z.length;for(let p=0;p<d;p++){const r=Z.data[p];d>1&&!r._checkCollision(V)||this._collideForSubMesh(r,O,V)}return this}_shouldConvertRHS(){return!1}_checkCollision(V){if(!this.getBoundingInfo()._checkCollision(V))return this;const O=r.i.Matrix[0],Z=r.i.Matrix[1];return r.c.ScalingToRef(1/V._radius.x,1/V._radius.y,1/V._radius.z,O),this.worldMatrixFromCache.multiplyToRef(O,Z),this._processCollisionsForSubMeshes(V,Z),this}_generatePointsArray(){return!1}intersects(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=new R.b,a=this.getClassName(),i="InstancedLinesMesh"===a||"LinesMesh"===a||"GreasedLineMesh"===a?this.intersectionThreshold:0,M=this.getBoundingInfo();if(!this.Ef)return m;if(!Y&&(!V.intersectsSphere(M.boundingSphere,i)||!V.intersectsBox(M.boundingBox,i)))return m;if(d)return m.hit=!Y,m.pickedMesh=Y?null:this,m.distance=Y?0:r.m.Distance(V.origin,M.boundingSphere.center),m.subMeshId=0,m;if(!this._generatePointsArray())return m;let c=null;const W=this._scene.getIntersectingSubMeshCandidates(this,V),F=W.length;let Q=!1;for(let r=0;r<F;r++){const V=W.data[r].Ha();if(V&&(7==V.fillMode||0==V.fillMode||1==V.fillMode||2==V.fillMode||4==V.fillMode)){Q=!0;break}}if(!Q)return m.hit=!0,m.pickedMesh=this,m.distance=r.m.Distance(V.origin,M.boundingSphere.center),m.subMeshId=-1,m;for(let r=0;r<F;r++){const d=W.data[r];if(F>1&&!Y&&!d.canIntersects(V))continue;const p=d.intersects(V,this._positions,this.qf(),O,Z);if(p&&(O||!c||p.distance<c.distance)&&(c=p,c.subMeshId=r,O))break}if(c){const O=p??this.getWorldMatrix(),Z=r.i.ib[0],d=r.i.ib[1];r.m.TransformCoordinatesToRef(V.origin,O,Z),V.direction.scaleToRef(c.distance,d);const Y=r.m.TransformNormal(d,O).addInPlace(Z);return m.hit=!0,m.distance=r.m.Distance(Z,Y),m.pickedPoint=Y,m.pickedMesh=this,m.bu=c.bu||0,m.bv=c.bv||0,m.subMeshFaceId=c.faceId,m.faceId=c.faceId+W.data[c.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),m.subMeshId=c.subMeshId,m}return m}clone(V,O,Z){return null}releaseSubMeshes(){if(this.Ef)for(;this.Ef.length;)this.Ef[0].dispose();else this.Ef=[];return this}dispose(V){let O,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const d=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),d.freeActiveMeshes(),d.freeRenderingGroups(),d.renderingManager.maintainStateBetweenFrames&&d.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((V=>V!==this&&V.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),O=0;O<this._intersectionsInProgress.length;O++){const V=this._intersectionsInProgress[O],Z=V._intersectionsInProgress.indexOf(this);V._intersectionsInProgress.splice(Z,1)}this._intersectionsInProgress.length=0;d.lights.forEach((V=>{let O=V.includedOnlyMeshes.indexOf(this);-1!==O&&V.includedOnlyMeshes.splice(O,1),O=V.excludedMeshes.indexOf(this),-1!==O&&V.excludedMeshes.splice(O,1);const Z=V.getShadowGenerators();if(Z){const V=Z.values();for(let Z=V.next();!0!==Z.done;Z=V.next()){const V=Z.value.getShadowMap();V&&V.renderList&&(O=V.renderList.indexOf(this),-1!==O&&V.renderList.splice(O,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const p=d.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,p.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),p.wipeCaches(),d.Kg(this),this._parentContainer){const V=this._parentContainer.meshes.indexOf(this);V>-1&&this._parentContainer.meshes.splice(V,1),this._parentContainer=null}if(Z&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!V)for(O=0;O<d.bj.length;O++)d.bj[O].k===this&&(d.bj[O].dispose(),O--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(V,Z)}_initFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetNormals||(V.facetNormals=[]),V.facetPositions||(V.facetPositions=[]),V.facetPartitioning||(V.facetPartitioning=new Array),V.facetNb=this.qf().length/3|0,V.partitioningSubdivisions=V.partitioningSubdivisions?V.partitioningSubdivisions:10,V.partitioningBBoxRatio=V.partitioningBBoxRatio?V.partitioningBBoxRatio:1.01;for(let O=0;O<V.facetNb;O++)V.facetNormals[O]=r.m.Zero(),V.facetPositions[O]=r.m.Zero();return V.facetDataEnabled=!0,this}updateFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetDataEnabled||this._initFacetData();const O=this.getVerticesData(Y.e.PositionKind),Z=this.qf(),d=this.getVerticesData(Y.e.NormalKind),p=this.getBoundingInfo();if(V.facetDepthSort&&!V.facetDepthSortEnabled){if(V.facetDepthSortEnabled=!0,Z instanceof Uint16Array)V.depthSortedIndices=new Uint16Array(Z);else if(Z instanceof Uint32Array)V.depthSortedIndices=new Uint32Array(Z);else{let O=!1;for(let V=0;V<Z.length;V++)if(Z[V]>65535){O=!0;break}V.depthSortedIndices=O?new Uint32Array(Z):new Uint16Array(Z)}if(V.facetDepthSortFunction=function(V,O){return O.sqDistance-V.sqDistance},!V.facetDepthSortFrom){const O=this.va().activeCamera;V.facetDepthSortFrom=O?O.position:r.m.Zero()}V.depthSortedFacets=[];for(let O=0;O<V.facetNb;O++){const Z={ind:3*O,sqDistance:0};V.depthSortedFacets.push(Z)}V.invertedMatrix=r.c.Identity(),V.facetDepthSortOrigin=r.m.Zero()}V.bbSize.x=p.maximum.x-p.minimum.x>b.c?p.maximum.x-p.minimum.x:b.c,V.bbSize.y=p.maximum.y-p.minimum.y>b.c?p.maximum.y-p.minimum.y:b.c,V.bbSize.z=p.maximum.z-p.minimum.z>b.c?p.maximum.z-p.minimum.z:b.c;let a=V.bbSize.x>V.bbSize.y?V.bbSize.x:V.bbSize.y;if(a=a>V.bbSize.z?a:V.bbSize.z,V.subDiv.max=V.partitioningSubdivisions,V.subDiv.X=Math.floor(V.subDiv.max*V.bbSize.x/a),V.subDiv.Y=Math.floor(V.subDiv.max*V.bbSize.y/a),V.subDiv.Z=Math.floor(V.subDiv.max*V.bbSize.z/a),V.subDiv.X=V.subDiv.X<1?1:V.subDiv.X,V.subDiv.Y=V.subDiv.Y<1?1:V.subDiv.Y,V.subDiv.Z=V.subDiv.Z<1?1:V.subDiv.Z,V.facetParameters.facetNormals=this.getFacetLocalNormals(),V.facetParameters.facetPositions=this.getFacetLocalPositions(),V.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),V.facetParameters.bInfo=p,V.facetParameters.bbSize=V.bbSize,V.facetParameters.subDiv=V.subDiv,V.facetParameters.ratio=this.partitioningBBoxRatio,V.facetParameters.depthSort=V.facetDepthSort,V.facetDepthSort&&V.facetDepthSortEnabled&&(this.Cj(!0),this._worldMatrix.invertToRef(V.invertedMatrix),r.m.TransformCoordinatesToRef(V.facetDepthSortFrom,V.invertedMatrix,V.facetDepthSortOrigin),V.facetParameters.distanceTo=V.facetDepthSortOrigin),V.facetParameters.depthSortedFacets=V.depthSortedFacets,d&&m.e.ComputeNormals(O,Z,d,V.facetParameters),V.facetDepthSort&&V.facetDepthSortEnabled){V.depthSortedFacets.sort(V.facetDepthSortFunction);const O=V.depthSortedIndices.length/3|0;for(let d=0;d<O;d++){const O=V.depthSortedFacets[d].ind;V.depthSortedIndices[3*d]=Z[O],V.depthSortedIndices[3*d+1]=Z[O+1],V.depthSortedIndices[3*d+2]=Z[O+2]}this.updateIndices(V.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetNormals||this.updateFacetData(),V.facetNormals}getFacetLocalPositions(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPositions||this.updateFacetData(),V.facetPositions}getFacetLocalPartitioning(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPartitioning||this.updateFacetData(),V.facetPartitioning}getFacetPosition(V){const O=r.m.Zero();return this.getFacetPositionToRef(V,O),O}getFacetPositionToRef(V,O){const Z=this.getFacetLocalPositions()[V],d=this.getWorldMatrix();return r.m.TransformCoordinatesToRef(Z,d,O),this}getFacetNormal(V){const O=r.m.Zero();return this.getFacetNormalToRef(V,O),O}getFacetNormalToRef(V,O){const Z=this.getFacetLocalNormals()[V];return r.m.TransformNormalToRef(Z,this.getWorldMatrix(),O),this}getFacetsAtLocalCoordinates(V,O,Z){const d=this.getBoundingInfo(),p=this._internalAbstractMeshDataInfo._facetData,r=Math.floor((V-d.minimum.x*p.partitioningBBoxRatio)*p.subDiv.X*p.partitioningBBoxRatio/p.bbSize.x),Y=Math.floor((O-d.minimum.y*p.partitioningBBoxRatio)*p.subDiv.Y*p.partitioningBBoxRatio/p.bbSize.y),m=Math.floor((Z-d.minimum.z*p.partitioningBBoxRatio)*p.subDiv.Z*p.partitioningBBoxRatio/p.bbSize.z);return r<0||r>p.subDiv.max||Y<0||Y>p.subDiv.max||m<0||m>p.subDiv.max?null:p.facetPartitioning[r+p.subDiv.max*Y+p.subDiv.max*p.subDiv.max*m]}getClosestFacetAtCoordinates(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const m=this.getWorldMatrix(),a=r.i.Matrix[5];m.invertToRef(a);const R=r.i.ib[8];r.m.TransformCoordinatesFromFloatsToRef(V,O,Z,a,R);const i=this.getClosestFacetAtLocalCoordinates(R.x,R.y,R.z,d,p,Y);return d&&r.m.TransformCoordinatesFromFloatsToRef(d.x,d.y,d.z,m,d),i}getClosestFacetAtLocalCoordinates(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=null,m=0,a=0,R=0,i=0,M=0,c=0,W=0,F=0;const Q=this.getFacetLocalPositions(),b=this.getFacetLocalNormals(),U=this.getFacetsAtLocalCoordinates(V,O,Z);if(!U)return null;let H,S,z,G=Number.MAX_VALUE,w=G;for(let t=0;t<U.length;t++)H=U[t],S=b[H],z=Q[H],i=(V-z.x)*S.x+(O-z.y)*S.y+(Z-z.z)*S.z,(!p||p&&r&&i>=0||p&&!r&&i<=0)&&(i=S.x*z.x+S.y*z.y+S.z*z.z,M=-(S.x*V+S.y*O+S.z*Z-i)/(S.x*S.x+S.y*S.y+S.z*S.z),c=V+S.x*M,W=O+S.y*M,F=Z+S.z*M,m=c-V,a=W-O,R=F-Z,w=m*m+a*a+R*R,w<G&&(G=w,Y=H,d&&(d.x=c,d.y=W,d.z=F)));return Y}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetDataEnabled&&(V.facetDataEnabled=!1,V.facetPositions=[],V.facetNormals=[],V.facetPartitioning=new Array,V.facetParameters=null,V.depthSortedIndices=new Uint32Array(0)),this}updateIndices(V,O){return this}createNormals(V){const O=this.getVerticesData(Y.e.PositionKind),Z=this.qf();let d;return d=this.isVerticesDataPresent(Y.e.NormalKind)?this.getVerticesData(Y.e.NormalKind):[],m.e.ComputeNormals(O,Z,d,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(Y.e.NormalKind,d,V),this}alignWithNormal(V,O){O||(O=U.b.Y);const Z=r.i.ib[0],d=r.i.ib[1];return r.m.CrossToRef(O,V,d),r.m.CrossToRef(V,d,Z),this.rotationQuaternion?r.g.RotationQuaternionFromAxisToRef(Z,V,d,this.rotationQuaternion):r.m.RotationFromAxisToRef(Z,V,d,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,W.c)("EdgesRenderer")}enableEdgesRendering(V,O,Z){throw(0,W.c)("EdgesRenderer")}cj(){return this._scene.bj.filter((V=>V.k===this))}}t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=0,t.pi=1,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,d.c)([S.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d,p,r,Y,m]=O;return!Array.isArray(d)&&!Array.isArray(p)&&!Array.isArray(r)&&!Array.isArray(Y)&&!Array.isArray(m)}))],t,"_ApplySkeleton",null),(0,H.f)("BABYLON.AbstractMesh",t)},11539:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>b});var d=Z(11251),p=Z(11274),r=Z(11530),Y=Z(11316),m=Z(11413),a=Z(11545),R=Z(11421),i=Z(10900),M=Z(11243),c=Z(11435),W=Z(10942),F=Z(11476),Q=Z(10914);class b{get boundingBias(){return this._boundingBias}set boundingBias(V){this._boundingBias?this._boundingBias.p(V):this._boundingBias=V.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(V){const O=new b(b.RandomId(),V.va());return O.Ca(V),O}get meshes(){return this._meshes}constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=O||W.e.LastCreatedScene,this._scene&&(this.id=V,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=d,Z?this.setAllVerticesData(Z,d):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),p&&(this.Ca(p),p.Cj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let V=0;V<this._meshes.length;V++)if(!this._meshes[V].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const V=new Set;for(const O in this._vertexBuffers)V.add(this._vertexBuffers[O].getWrapperBuffer());V.forEach((V=>{V._rebuild()}))}setAllVerticesData(V,O){V.applyToGeometry(this,O),this._notifyUpdate()}Ga(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;Z&&Array.isArray(O)&&(O=new Float32Array(O));const p=new Y.e(this._engine,O,V,{updatable:Z,postponeInternalCreation:0===this._meshes.length,stride:d,label:"Geometry_"+this.id+"_"+V});this.setVerticesBuffer(p)}removeVerticesData(V){this._vertexBuffers[V]&&(this._vertexBuffers[V].dispose(),delete this._vertexBuffers[V]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const p=V.getKind();this._vertexBuffers[p]&&Z&&this._vertexBuffers[p].dispose(),V._buffer&&V._buffer._increaseReferences(),this._vertexBuffers[p]=V;const r=this._meshes,m=r.length;if(p===Y.e.PositionKind){this._totalVertices=O??V._maxVerticesCount,this._updateExtend(V.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const Z=this._extend&&this._extend.minimum||new d.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),p=this._extend&&this._extend.maximum||new d.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let V=0;V<m;V++){const O=r[V];O.buildBoundingInfo(Z,p),O._createGlobalSubMesh(O.isUnIndexed),O.Cj(!0),O.synchronizeInstances()}}this._notifyUpdate(p)}updateVerticesDataDirectly(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=this.getVertexBuffer(V);p&&(p.updateDirectly(O,Z,d),this._notifyUpdate(V))}updateVerticesData(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this.getVertexBuffer(V);d&&(d.update(O),V===Y.e.PositionKind&&this.Ea(Z,O),this._notifyUpdate(V))}Ea(V,O){if(V&&this._updateExtend(O),this._resetPointsArrayCache(),V){const V=this._meshes;for(const O of V){O.hasBoundingInfo?O.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):O.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const V=O.Ef;for(const O of V)O.refreshBoundingInfo()}}}_bind(V,O,Z,d){if(!V)return;void 0===O&&(O=this._indexBuffer);const p=this.getVertexBuffers();if(!p)return;if(O!=this._indexBuffer||!this._vertexArrayObjects&&!d)return void this._engine.bindBuffers(p,O,V,Z);const r=d||this._vertexArrayObjects,Y=this._engine;r[V.key]||(r[V.key]=Y.recordVertexArrayObject(p,O,V,Z)),Y.bindVertexArrayObject(r[V.key],O)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(V,O,Z){const d=this.getVertexBuffer(V);return d?d.getFloatData(this._totalVertices,Z||O&&1!==this._meshes.length):null}copyVerticesData(V,O){const Z=this.getVertexBuffer(V);if(!Z)return;O[V]||(O[V]=new Float32Array(this._totalVertices*Z.getSize()));const d=Z.getData();d&&function(V,O,Z,d,p,r,m,a){const R=O*Y.e.GetTypeByteLength(Z),i=m*O;if(a.length!==i)throw new Error("Output length is not valid");if(Z===Y.e.FLOAT&&p===R)if(V instanceof Array){const O=d/4;a.set(V,O)}else if(V instanceof ArrayBuffer){const O=new Float32Array(V,d,i);a.set(O)}else{const O=V.byteOffset+d;if(O%4)return Q.b.Warn("CopyFloatData: copied misaligned data."),void a.set(new Float32Array(V.buffer.slice(O,O+4*i)));const Z=new Float32Array(V.buffer,O,i);a.set(Z)}else Y.e.ForEach(V,d,p,O,Z,i,r,((V,O)=>a[O]=V))}(d,Z.getSize(),Z.type,Z.byteOffset,Z.byteStride,Z.normalized,this._totalVertices,O[V])}isVertexBufferUpdatable(V){const O=this._vertexBuffers[V];return!!O&&O.isUpdatable()}getVertexBuffer(V){return this.isReady()?this._vertexBuffers[V]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(V){return this._vertexBuffers?void 0!==this._vertexBuffers[V]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}getVerticesDataKinds(){const V=[];let O;if(!this._vertexBuffers&&this._delayInfo)for(O in this._delayInfo)V.push(O);else for(O in this._vertexBuffers)V.push(O);return V}updateIndices(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const d=V.length!==this._indices.length;if(Z||(this._indices=V.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,V,O),d)for(const V of this._meshes)V._createGlobalSubMesh(!0)}else this.setIndices(V,null,!0)}setIndexBuffer(V,O,Z){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=V,this._totalVertices=O,this._totalIndices=Z,V.is32Bits||(V.is32Bits=this._totalIndices>65535);for(const d of this._meshes)d._createGlobalSubMesh(!0),d.synchronizeInstances();this._notifyUpdate()}setIndices(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=V,this._indexBufferIsUpdatable=Z,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,Z,"Geometry_"+this.id+"_IndexBuffer")),void 0!=O&&(this._totalVertices=O);for(const p of this._meshes)p._createGlobalSubMesh(!d),p.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}qf(V,O){if(!this.isReady())return null;const Z=this._indices;return O||V&&1!==this._meshes.length?Z.slice():Z}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;V&&this._vertexArrayObjects&&this._vertexArrayObjects[V.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[V.key]),delete this._vertexArrayObjects[V.key])}releaseForMesh(V,O){const Z=this._meshes,d=Z.indexOf(V);-1!==d&&(Z.splice(d,1),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject(),V._geometry=null,0===Z.length&&O&&this.dispose())}Ca(V){if(V._geometry===this)return;const O=V._geometry;O&&O.releaseForMesh(V),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject();const Z=this._meshes;V._geometry=this,V._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),Z.push(V),this.isReady()?this._applyToMesh(V):this._boundingInfo&&V.setBoundingInfo(this._boundingInfo)}_updateExtend(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!V&&(V=this.getVerticesData(Y.e.PositionKind),!V))return;this._extend=(0,c.f)(V,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(V){const O=this._meshes.length;for(const Z in this._vertexBuffers)1===O&&this._vertexBuffers[Z].create(),Z===Y.e.PositionKind&&(this._extend||this._updateExtend(),V.buildBoundingInfo(this._extend.minimum,this._extend.maximum),V._createGlobalSubMesh(V.isUnIndexed),V.Ea());1===O&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),V._syncGeometryWithMorphTargetManager(),V.synchronizeInstances()}_notifyUpdate(V){this.onGeometryUpdated&&this.onGeometryUpdated(this,V),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const O of this._meshes)O._markSubMeshesAsAttributesDirty()}load(V,O){2!==this.delayLoadState&&(this.isReady()?O&&O():(this.delayLoadState=2,this._queueLoad(V,O)))}_queueLoad(V,O){this.delayLoadingFile&&(V.addPendingData(this),V._loadFile(this.delayLoadingFile,(Z=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(Z),this),this.delayLoadState=1,this._delayInfo=[],V.removePendingData(this);const d=this._meshes,p=d.length;for(let V=0;V<p;V++)this._applyToMesh(d[V]);O&&O()}),void 0,!0))}toLeftHanded(){const V=this.qf(!1);if(null!=V&&V.length>0){for(let O=0;O<V.length;O+=3){const Z=V[O+0];V[O+0]=V[O+2],V[O+2]=Z}this.setIndices(V)}const O=this.getVerticesData(Y.e.PositionKind,!1);if(null!=O&&O.length>0){for(let V=0;V<O.length;V+=3)O[V+2]=-O[V+2];this.Ga(Y.e.PositionKind,O,!1)}const Z=this.getVerticesData(Y.e.NormalKind,!1);if(null!=Z&&Z.length>0){for(let V=0;V<Z.length;V+=3)Z[V+2]=-Z[V+2];this.Ga(Y.e.NormalKind,Z,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const V=this.getVerticesData(Y.e.PositionKind);if(!V||0===V.length)return!1;for(let O=3*this._positionsCache.length,Z=this._positionsCache.length;O<V.length;O+=3,++Z)this._positionsCache[Z]=d.m.Cg(V,O);for(let O=0,Z=0;O<V.length;O+=3,++Z)this._positionsCache[Z].set(V[0+O],V[1+O],V[2+O]);return this._positionsCache.length=V.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const Z in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Z]);this._vertexArrayObjects={};const V=this._meshes,O=V.length;for(let Z=0;Z<O;Z++)V[Z]._invalidateInstanceVertexArrayObject()}}dispose(){const V=this._meshes,O=V.length;let Z;for(Z=0;Z<O;Z++)this.releaseForMesh(V[Z]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const d in this._vertexBuffers)this._vertexBuffers[d].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const V=this._parentContainer.geometries.indexOf(this);V>-1&&this._parentContainer.geometries.splice(V,1),this._parentContainer=null}this._isDisposed=!0}j(V){const O=new r.e;O.indices=[];const Z=this.qf();if(Z)for(let r=0;r<Z.length;r++)O.indices.push(Z[r]);let d,p=!1,Y=!1;for(d in this._vertexBuffers){const V=this.getVerticesData(d);if(V&&(V instanceof Float32Array?O.set(new Float32Array(V),d):O.set(V.slice(0),d),!Y)){const V=this.getVertexBuffer(d);V&&(p=V.isUpdatable(),Y=!p)}}const m=new b(V,this._scene,O,p);for(d in m.delayLoadState=this.delayLoadState,m.delayLoadingFile=this.delayLoadingFile,m._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)m._delayInfo=m._delayInfo||[],m._delayInfo.push(d);return m._boundingInfo=new R.c(this._extend.minimum,this._extend.maximum),m}serialize(){const V={};return V.id=this.id,V.uniqueId=this.uniqueId,V.updatable=this._updatable,M.e&&M.e.HasTags(this)&&(V.tags=M.e.GetTags(this)),V}_toNumberArray(V){return Array.isArray(V)?V:Array.prototype.slice.call(V)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const V in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,V)&&(this._vertexBuffers[V]._buffer._data=null)}serializeVerticeData(){const V=this.serialize();return this.isVerticesDataPresent(Y.e.PositionKind)&&(V.xa=this._toNumberArray(this.getVerticesData(Y.e.PositionKind)),this.isVertexBufferUpdatable(Y.e.PositionKind)&&(V.xa._updatable=!0)),this.isVerticesDataPresent(Y.e.NormalKind)&&(V.ya=this._toNumberArray(this.getVerticesData(Y.e.NormalKind)),this.isVertexBufferUpdatable(Y.e.NormalKind)&&(V.ya._updatable=!0)),this.isVerticesDataPresent(Y.e.TangentKind)&&(V.tangents=this._toNumberArray(this.getVerticesData(Y.e.TangentKind)),this.isVertexBufferUpdatable(Y.e.TangentKind)&&(V.tangents._updatable=!0)),this.isVerticesDataPresent(Y.e.UVKind)&&(V.Aa=this._toNumberArray(this.getVerticesData(Y.e.UVKind)),this.isVertexBufferUpdatable(Y.e.UVKind)&&(V.Aa._updatable=!0)),this.isVerticesDataPresent(Y.e.UV2Kind)&&(V.uvs2=this._toNumberArray(this.getVerticesData(Y.e.UV2Kind)),this.isVertexBufferUpdatable(Y.e.UV2Kind)&&(V.uvs2._updatable=!0)),this.isVerticesDataPresent(Y.e.UV3Kind)&&(V.uvs3=this._toNumberArray(this.getVerticesData(Y.e.UV3Kind)),this.isVertexBufferUpdatable(Y.e.UV3Kind)&&(V.uvs3._updatable=!0)),this.isVerticesDataPresent(Y.e.UV4Kind)&&(V.uvs4=this._toNumberArray(this.getVerticesData(Y.e.UV4Kind)),this.isVertexBufferUpdatable(Y.e.UV4Kind)&&(V.uvs4._updatable=!0)),this.isVerticesDataPresent(Y.e.UV5Kind)&&(V.uvs5=this._toNumberArray(this.getVerticesData(Y.e.UV5Kind)),this.isVertexBufferUpdatable(Y.e.UV5Kind)&&(V.uvs5._updatable=!0)),this.isVerticesDataPresent(Y.e.UV6Kind)&&(V.uvs6=this._toNumberArray(this.getVerticesData(Y.e.UV6Kind)),this.isVertexBufferUpdatable(Y.e.UV6Kind)&&(V.uvs6._updatable=!0)),this.isVerticesDataPresent(Y.e.ColorKind)&&(V.za=this._toNumberArray(this.getVerticesData(Y.e.ColorKind)),this.isVertexBufferUpdatable(Y.e.ColorKind)&&(V.za._updatable=!0)),this.isVerticesDataPresent(Y.e.MatricesIndicesKind)&&(V.matricesIndices=this._toNumberArray(this.getVerticesData(Y.e.MatricesIndicesKind)),V.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(Y.e.MatricesIndicesKind)&&(V.matricesIndices._updatable=!0)),this.isVerticesDataPresent(Y.e.MatricesWeightsKind)&&(V.matricesWeights=this._toNumberArray(this.getVerticesData(Y.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(Y.e.MatricesWeightsKind)&&(V.matricesWeights._updatable=!0)),V.indices=this._toNumberArray(this.qf()),V}static ExtractFromMesh(V,O){const Z=V._geometry;return Z?Z.j(O):null}static RandomId(){return i.e.RandomId()}static _GetGeometryByLoadedUniqueId(V,O){for(let Z=0;Z<O.geometries.length;Z++)if(O.geometries[Z]._loadedUniqueId===V)return O.geometries[Z];return null}static _ImportGeometry(V,O){const Z=O.va(),d=V.geometryUniqueId,r=V.geometryId;if(d||r){const V=d?this._GetGeometryByLoadedUniqueId(d,Z):Z.getGeometryById(r);V&&V.Ca(O)}else if(V instanceof ArrayBuffer){const Z=O._binaryInfo;if(Z.positionsAttrDesc&&Z.positionsAttrDesc.count>0){const d=new Float32Array(V,Z.positionsAttrDesc.offset,Z.positionsAttrDesc.count);O.Ga(Y.e.PositionKind,d,!1)}if(Z.normalsAttrDesc&&Z.normalsAttrDesc.count>0){const d=new Float32Array(V,Z.normalsAttrDesc.offset,Z.normalsAttrDesc.count);O.Ga(Y.e.NormalKind,d,!1)}if(Z.tangetsAttrDesc&&Z.tangetsAttrDesc.count>0){const d=new Float32Array(V,Z.tangetsAttrDesc.offset,Z.tangetsAttrDesc.count);O.Ga(Y.e.TangentKind,d,!1)}if(Z.uvsAttrDesc&&Z.uvsAttrDesc.count>0){const d=new Float32Array(V,Z.uvsAttrDesc.offset,Z.uvsAttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UVKind,d,!1)}if(Z.uvs2AttrDesc&&Z.uvs2AttrDesc.count>0){const d=new Float32Array(V,Z.uvs2AttrDesc.offset,Z.uvs2AttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UV2Kind,d,!1)}if(Z.uvs3AttrDesc&&Z.uvs3AttrDesc.count>0){const d=new Float32Array(V,Z.uvs3AttrDesc.offset,Z.uvs3AttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UV3Kind,d,!1)}if(Z.uvs4AttrDesc&&Z.uvs4AttrDesc.count>0){const d=new Float32Array(V,Z.uvs4AttrDesc.offset,Z.uvs4AttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UV4Kind,d,!1)}if(Z.uvs5AttrDesc&&Z.uvs5AttrDesc.count>0){const d=new Float32Array(V,Z.uvs5AttrDesc.offset,Z.uvs5AttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UV5Kind,d,!1)}if(Z.uvs6AttrDesc&&Z.uvs6AttrDesc.count>0){const d=new Float32Array(V,Z.uvs6AttrDesc.offset,Z.uvs6AttrDesc.count);if(F.c)for(let V=1;V<d.length;V+=2)d[V]=1-d[V];O.Ga(Y.e.UV6Kind,d,!1)}if(Z.colorsAttrDesc&&Z.colorsAttrDesc.count>0){const d=new Float32Array(V,Z.colorsAttrDesc.offset,Z.colorsAttrDesc.count);O.Ga(Y.e.ColorKind,d,!1,Z.colorsAttrDesc.stride)}if(Z.matricesIndicesAttrDesc&&Z.matricesIndicesAttrDesc.count>0){const d=new Int32Array(V,Z.matricesIndicesAttrDesc.offset,Z.matricesIndicesAttrDesc.count),p=[];for(let V=0;V<d.length;V++){const O=d[V];p.push(255&O),p.push((65280&O)>>8),p.push((16711680&O)>>16),p.push(O>>24&255)}O.Ga(Y.e.MatricesIndicesKind,p,!1)}if(Z.matricesIndicesExtraAttrDesc&&Z.matricesIndicesExtraAttrDesc.count>0){const d=new Int32Array(V,Z.matricesIndicesExtraAttrDesc.offset,Z.matricesIndicesExtraAttrDesc.count),p=[];for(let V=0;V<d.length;V++){const O=d[V];p.push(255&O),p.push((65280&O)>>8),p.push((16711680&O)>>16),p.push(O>>24&255)}O.Ga(Y.e.MatricesIndicesExtraKind,p,!1)}if(Z.matricesWeightsAttrDesc&&Z.matricesWeightsAttrDesc.count>0){const d=new Float32Array(V,Z.matricesWeightsAttrDesc.offset,Z.matricesWeightsAttrDesc.count);O.Ga(Y.e.MatricesWeightsKind,d,!1)}if(Z.indicesAttrDesc&&Z.indicesAttrDesc.count>0){const d=new Int32Array(V,Z.indicesAttrDesc.offset,Z.indicesAttrDesc.count);O.setIndices(d,null)}if(Z.subMeshesAttrDesc&&Z.subMeshesAttrDesc.count>0){const d=new Int32Array(V,Z.subMeshesAttrDesc.offset,5*Z.subMeshesAttrDesc.count);O.Ef=[];for(let V=0;V<Z.subMeshesAttrDesc.count;V++){const Z=d[5*V+0],p=d[5*V+1],r=d[5*V+2],Y=d[5*V+3],a=d[5*V+4];m.c.AddToMesh(Z,p,r,Y,a,O)}}}else if(V.xa&&V.ya&&V.indices){if(O.Ga(Y.e.PositionKind,V.xa,V.xa._updatable),O.Ga(Y.e.NormalKind,V.ya,V.ya._updatable),V.tangents&&O.Ga(Y.e.TangentKind,V.tangents,V.tangents._updatable),V.Aa&&O.Ga(Y.e.UVKind,V.Aa,V.Aa._updatable),V.uvs2&&O.Ga(Y.e.UV2Kind,V.uvs2,V.uvs2._updatable),V.uvs3&&O.Ga(Y.e.UV3Kind,V.uvs3,V.uvs3._updatable),V.uvs4&&O.Ga(Y.e.UV4Kind,V.uvs4,V.uvs4._updatable),V.uvs5&&O.Ga(Y.e.UV5Kind,V.uvs5,V.uvs5._updatable),V.uvs6&&O.Ga(Y.e.UV6Kind,V.uvs6,V.uvs6._updatable),V.za&&O.Ga(Y.e.ColorKind,p.f.CheckColors4(V.za,V.xa.length/3),V.za._updatable),V.matricesIndices)if(V.matricesIndices._isExpanded)delete V.matricesIndices._isExpanded,O.Ga(Y.e.MatricesIndicesKind,V.matricesIndices,V.matricesIndices._updatable);else{const Z=[];for(let O=0;O<V.matricesIndices.length;O++){const d=V.matricesIndices[O];Z.push(255&d),Z.push((65280&d)>>8),Z.push((16711680&d)>>16),Z.push(d>>24&255)}O.Ga(Y.e.MatricesIndicesKind,Z,V.matricesIndices._updatable)}if(V.matricesIndicesExtra)if(V.matricesIndicesExtra._isExpanded)delete V.matricesIndices._isExpanded,O.Ga(Y.e.MatricesIndicesExtraKind,V.matricesIndicesExtra,V.matricesIndicesExtra._updatable);else{const Z=[];for(let O=0;O<V.matricesIndicesExtra.length;O++){const d=V.matricesIndicesExtra[O];Z.push(255&d),Z.push((65280&d)>>8),Z.push((16711680&d)>>16),Z.push(d>>24&255)}O.Ga(Y.e.MatricesIndicesExtraKind,Z,V.matricesIndicesExtra._updatable)}V.matricesWeights&&(b._CleanMatricesWeights(V,O),O.Ga(Y.e.MatricesWeightsKind,V.matricesWeights,V.matricesWeights._updatable)),V.matricesWeightsExtra&&O.Ga(Y.e.MatricesWeightsExtraKind,V.matricesWeightsExtra,V.matricesWeights._updatable),O.setIndices(V.indices,null)}if(V.Ef){O.Ef=[];for(let Z=0;Z<V.Ef.length;Z++){const d=V.Ef[Z];m.c.AddToMesh(d.materialIndex,d.verticesStart,d.verticesCount,d.indexStart,d.indexCount,O)}}O._shouldGenerateFlatShading&&(O.convertToFlatShadedMesh(),O._shouldGenerateFlatShading=!1),O.Cj(!0),Z.onMeshImportedObservable.notifyObservers(O)}static _CleanMatricesWeights(V,O){const Z=.001;if(!a.b.CleanBoneMatrixWeights)return;let d=0;if(!(V.skeletonId>-1))return;{const Z=O.va().getLastSkeletonById(V.skeletonId);if(!Z)return;d=Z.bones.length}const p=O.getVerticesData(Y.e.MatricesIndicesKind),r=O.getVerticesData(Y.e.MatricesIndicesExtraKind),m=V.matricesWeights,R=V.matricesWeightsExtra,i=V.numBoneInfluencer,M=m.length;for(let Y=0;Y<M;Y+=4){let V=0,O=-1;for(let d=0;d<4;d++){const p=m[Y+d];V+=p,p<Z&&O<0&&(O=d)}if(R)for(let d=0;d<4;d++){const p=R[Y+d];V+=p,p<Z&&O<0&&(O=d+4)}if((O<0||O>i-1)&&(O=i-1),V>Z){const O=1/V;for(let V=0;V<4;V++)m[Y+V]*=O;if(R)for(let V=0;V<4;V++)R[Y+V]*=O}else O>=4?(R[Y+O-4]=1-V,r[Y+O-4]=d):(m[Y+O]=1-V,p[Y+O]=d)}O.Ga(Y.e.MatricesIndicesKind,p),V.matricesWeightsExtra&&O.Ga(Y.e.MatricesIndicesExtraKind,r)}static Parse(V,O,Z){const p=new b(V.id,O,void 0,V.updatable);return p._loadedUniqueId=V.uniqueId,M.e&&M.e.AddTagsTo(p,V.tags),V.delayLoadingFile?(p.delayLoadState=4,p.delayLoadingFile=Z+V.delayLoadingFile,p._boundingInfo=new R.c(d.m.Cg(V.boundingBoxMinimum),d.m.Cg(V.boundingBoxMaximum)),p._delayInfo=[],V.hasUVs&&p._delayInfo.push(Y.e.UVKind),V.hasUVs2&&p._delayInfo.push(Y.e.UV2Kind),V.hasUVs3&&p._delayInfo.push(Y.e.UV3Kind),V.hasUVs4&&p._delayInfo.push(Y.e.UV4Kind),V.hasUVs5&&p._delayInfo.push(Y.e.UV5Kind),V.hasUVs6&&p._delayInfo.push(Y.e.UV6Kind),V.hasColors&&p._delayInfo.push(Y.e.ColorKind),V.hasMatricesIndices&&p._delayInfo.push(Y.e.MatricesIndicesKind),V.hasMatricesWeights&&p._delayInfo.push(Y.e.MatricesWeightsKind),p._delayLoadingFunction=r.e.ImportVertexData):r.e.ImportVertexData(V,p),O.pushGeometry(p,!0),p}}},12190:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>c});var d=Z(11251),p=Z(10914),r=Z(11552),Y=Z(11508),m=Z(10919),a=Z(11556),R=Z(11316),i=Z(10900),M=Z(11041);Y.c._instancedMeshFactory=(V,O)=>{const Z=new c(V,O);if(O.instancedBuffers){Z.instancedBuffers={};for(const V in O.instancedBuffers)Z.instancedBuffers[V]=O.instancedBuffers[V]}return Z};class c extends r.d{constructor(V,O){super(V,O.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,O.sj(this),this._sourceMesh=O,this._unIndexed=O._unIndexed,this.position.p(O.position),this.rotation.p(O.rotation),this.Af.p(O.Af),O.rotationQuaternion&&(this.rotationQuaternion=O.rotationQuaternion.clone()),this.animations=O.animations.slice();for(const Z of O.getAnimationRanges())null!=Z&&this.createAnimationRange(Z.name,Z.from,Z.to);this.infiniteDistance=O.infiniteDistance,this.setPivotMatrix(O.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(V){var O;(null===(O=this._sourceMesh)||void 0===O?void 0:O.receiveShadows)!==V&&i.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(V){var O;(null===(O=this._sourceMesh)||void 0===O?void 0:O.material)!==V&&i.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(V){var O;(null===(O=this._sourceMesh)||void 0===O?void 0:O.visibility)!==V&&i.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(V){var O;(null===(O=this._sourceMesh)||void 0===O?void 0:O.skeleton)!==V&&i.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(V){this._sourceMesh&&V!==this._sourceMesh.renderingGroupId&&p.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}Vc(V){return this._sourceMesh.Vc(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(V,!0)}getVerticesData(V,O,Z){return this._sourceMesh.getVerticesData(V,O,Z)}copyVerticesData(V,O){this._sourceMesh.copyVerticesData(V,O)}Ga(V,O,Z,d){return this.sourceMesh&&this.sourceMesh.Ga(V,O,Z,d),this.sourceMesh}updateVerticesData(V,O,Z,d){return this.sourceMesh&&this.sourceMesh.updateVerticesData(V,O,Z,d),this.sourceMesh}setIndices(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(V,O),this.sourceMesh}isVerticesDataPresent(V){return this._sourceMesh.isVerticesDataPresent(V)}qf(){return this._sourceMesh.qf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let V,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof O?O:{applySkeleton:O,applyMorph:Z};const d=this._sourceMesh.oj?this._sourceMesh.oj.boundingBias:null;return this.Fa(this._sourceMesh._getData(V,null,R.e.PositionKind),d),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(V,O){if(super._activate(V,O),this._sourceMesh.Ef||p.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,V),O){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==a.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new d.c);const V=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,d.i.ib[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Cj(!0)),this._currentLOD.position.p(d.i.ib[7]),this._currentLOD._masterMesh=V,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(V){if(!V)return this;const O=this.sourceMesh.getLODLevels();if(O&&0!==O.length){const O=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(V,O.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(V){return this.sourceMesh._preActivateForIntermediateRendering(V)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Ef)for(let V=0;V<this._sourceMesh.Ef.length;V++)this._sourceMesh.Ef[V].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;const d=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).Vc(V);if(m.d.DeepCopy(this,d,["name","Ef","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","aj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),O&&(d.parent=O),!Z)for(let p=0;p<this.va().meshes.length;p++){const V=this.va().meshes[p];V.parent===this&&V.clone(V.name,d)}return d.Cj(!0),this.onClonedObservable.notifyObservers(d),d}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.qj(this),super.dispose(V,O)}_serializeAsParent(V){super._serializeAsParent(V),V.parentId=this._sourceMesh.uniqueId,V.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const d=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0,O&&O.newSourcedMesh);d&&Z&&Z(this,d);for(const p of this.getChildTransformNodes(!0))p.instantiateHierarchy(d,O,Z);return d}}Y.c.prototype.registerInstancedBuffer=function(V,O){var Z,d;if(null===(Z=this._userInstancedBuffersStorage)||void 0===Z||null===(d=Z.vertexBuffers[V])||void 0===d||d.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const V of this.instances)V.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[V]=null,this._userInstancedBuffersStorage.strides[V]=O,this._userInstancedBuffersStorage.sizes[V]=32*O,this._userInstancedBuffersStorage.data[V]=new Float32Array(this._userInstancedBuffersStorage.sizes[V]),this._userInstancedBuffersStorage.vertexBuffers[V]=new R.e(this.getEngine(),this._userInstancedBuffersStorage.data[V],V,!0,!1,O,!0);for(const p of this.instances)p.instancedBuffers[V]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},Y.c.prototype._processInstancedBuffers=function(V,O){const Z=V?V.length:0;for(const d in this.instancedBuffers){let p=this._userInstancedBuffersStorage.sizes[d];const r=this._userInstancedBuffersStorage.strides[d],Y=(Z+1)*r;for(;p<Y;)p*=2;this._userInstancedBuffersStorage.data[d].length!=p&&(this._userInstancedBuffersStorage.data[d]=new Float32Array(p),this._userInstancedBuffersStorage.sizes[d]=p,this._userInstancedBuffersStorage.vertexBuffers[d]&&(this._userInstancedBuffersStorage.vertexBuffers[d].dispose(),this._userInstancedBuffersStorage.vertexBuffers[d]=null));const m=this._userInstancedBuffersStorage.data[d];let a=0;if(O){const V=this.instancedBuffers[d];V.toArray?V.toArray(m,a):V.copyToArray?V.copyToArray(m,a):m[a]=V,a+=r}for(let O=0;O<Z;O++){const Z=V[O].instancedBuffers[d];Z.toArray?Z.toArray(m,a):Z.copyToArray?Z.copyToArray(m,a):m[a]=Z,a+=r}this._userInstancedBuffersStorage.vertexBuffers[d]?this._userInstancedBuffersStorage.vertexBuffers[d].updateDirectly(m,0):(this._userInstancedBuffersStorage.vertexBuffers[d]=new R.e(this.getEngine(),this._userInstancedBuffersStorage.data[d],d,!0,!1,r,!0),this._invalidateInstanceVertexArrayObject())}},Y.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const V in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[V]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},Y.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const V in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[V]&&this._userInstancedBuffersStorage.vertexBuffers[V].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,M.f)("BABYLON.InstancedMesh",c)},11508:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>e,f:()=>A});var d=Z(10902),p=Z(10900),r=Z(10919),Y=Z(11243),m=Z(11517),a=Z(11519),R=Z(11251),i=Z(11274),M=Z(11521),c=Z(11316),W=Z(11530),F=Z(11539),Q=Z(11552),b=Z(11413),U=Z(11409),H=Z(11566),S=Z(11545),z=Z(11283),G=Z(10914),w=Z(11041),t=Z(10928),C=Z(11342);class v{constructor(V,O){this.distanceOrScreenCoverage=V,this.mesh=O}}class A{}class l{constructor(){this.visibleInstances={},this.batchCache=new I,this.batchCacheReplacementModeInFrozenMode=new I,this.instancesBufferSize=2048}}class I{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class g{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class n{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class e extends Q.d{static _GetDefaultSideOrientation(V){return V||e.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(V){this._internalMeshDataInfo._useLODScreenCoverage=V,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(V&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(c.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(c.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new d.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new d.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new d.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new d.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new d.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(V){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(V)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(V){this._internalMeshDataInfo._forcedInstanceCount=V}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(V){this._internalMeshDataInfo._sideOrientation=V,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===V||!this._scene.useRightHandedSystem&&0===V}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(V){this.sideOrientation=V,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(V){this._internalMeshDataInfo._overrideRenderingFillMode=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){V&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(V.sideOrientation=null),this._setMaterial(V)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(V){this._unIndexed!==V&&(this._unIndexed=V,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(V){this._instanceDataStorage.manualUpdate=V}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(V){this._instanceDataStorage.previousManualUpdate=V}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(V){this._instanceDataStorage.forceMatrixUpdates=V}_copySource(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=this.va();if(V._geometry&&V._geometry.Ca(this),r.d.DeepCopy(V,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","oj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","aj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=V,d.useClonedMeshMap&&(V._internalMeshDataInfo.meshMap||(V._internalMeshDataInfo.meshMap={}),V._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=V._originalBuilderSideOrientation,this._creationDataStorage=V._creationDataStorage,V._ranges){const O=V._ranges;for(const V in O)Object.prototype.hasOwnProperty.call(O,V)&&O[V]&&this.createAnimationRange(V,O[V].from,O[V].to)}if(V.metadata&&V.metadata.clone?this.metadata=V.metadata.clone():this.metadata=V.metadata,this._internalMetadata=V._internalMetadata,Y.e&&Y.e.HasTags(V)&&Y.e.AddTagsTo(this,Y.e.GetTags(V,!0)),this.If(V.isEnabled(!1)),this.parent=V.parent,this.setPivotMatrix(V.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+V.id,this.material=V.material,!O){const O=V.getDescendants(!0);for(let V=0;V<O.length;V++){const Z=O[V];Z.clone&&Z.clone(this.name+"."+Z.name,this)}}if(V.morphTargetManager&&(this.morphTargetManager=V.morphTargetManager),d.getPhysicsEngine){const O=d.getPhysicsEngine();if(Z&&O)if(1===O.getPluginVersion()){const Z=O.getImpostorForPhysicsObject(V);Z&&(this.physicsImpostor=Z.clone(this))}else 2===O.getPluginVersion()&&V.physicsBody&&V.physicsBody.clone(this)}for(let p=0;p<d.bj.length;p++){const O=d.bj[p];O.k===V&&O.clone(O.name,this)}this.skeleton=V.skeleton,this.refreshBoundingInfo(!0,!0),this.Cj(!0)}constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0,Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(V,O),this._internalMeshDataInfo=new n,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new l,this._thinInstanceDataStorage=new g,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=e.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,O=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(V,O,Z)=>{V&&Z&&(this._uniformBuffer?this.transferToEffect(O):Z.bindOnlyWorldMatrix(O))},p&&this._copySource(p,r,Y),null!==Z&&(this.parent=Z),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=V=>{V.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new d.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),p&&p.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const d=0===this.getTotalVertices()||O&&O.doNotInstantiate&&(!0===O.doNotInstantiate||O.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),V||this.parent,!0):this.Vc("instance of "+(this.name||this.id));d.parent=V||this.parent,d.position=this.position.clone(),d.Af=this.Af.clone(),this.rotationQuaternion?d.rotationQuaternion=this.rotationQuaternion.clone():d.rotation=this.rotation.clone(),Z&&Z(this,d);for(const p of this.getChildTransformNodes(!0))"InstancedMesh"===p.getClassName()&&"Mesh"===d.getClassName()&&p.sourceMesh===this?p.instantiateHierarchy(d,{doNotInstantiate:O&&O.doNotInstantiate||!1,newSourcedMesh:d},Z):p.instantiateHierarchy(d,O,Z);return d}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(V){let O=super.toString(V);if(O+=", n vertices: "+this.getTotalVertices(),O+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let Z=0;Z<this.animations.length;Z++)O+=", animation[0]: "+this.animations[Z].toString(V);if(V)if(this._geometry){const V=this.qf(),Z=this.getVerticesData(c.e.PositionKind);Z&&V&&(O+=", flat shading: "+(Z.length/3===V.length?"YES":"NO"))}else O+=", flat shading: UNKNOWN";return O}_unBindEffect(){super._unBindEffect();for(const V of this.instances)V._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const V=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((O,Z)=>O.distanceOrScreenCoverage<Z.distanceOrScreenCoverage?V:O.distanceOrScreenCoverage>Z.distanceOrScreenCoverage?-V:0))}addLODLevel(V,O){if(O&&O._masterMesh)return G.b.Warn("You cannot use a mesh as LOD level twice"),this;const Z=new v(V,O);return this._internalMeshDataInfo._LODLevels.push(Z),O&&(O._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(V){const O=this._internalMeshDataInfo;for(let Z=0;Z<O._LODLevels.length;Z++){const d=O._LODLevels[Z];if(d.distanceOrScreenCoverage===V)return d.mesh}return null}removeLODLevel(V){const O=this._internalMeshDataInfo;for(let Z=0;Z<O._LODLevels.length;Z++)O._LODLevels[Z].mesh===V&&(O._LODLevels.splice(Z,1),V&&(V._masterMesh=null));return this._sortLODLevels(),this}getLOD(V,O){const Z=this._internalMeshDataInfo;if(!Z._LODLevels||0===Z._LODLevels.length)return this;const d=O||this.getBoundingInfo().boundingSphere,p=V.mode===a.d.ORTHOGRAPHIC_CAMERA?V.Ii:d.centerWorld.fc(V.globalPosition).length();let r=p,Y=1;if(Z._useLODScreenCoverage){const O=V.screenArea;let Z=d.radiusWorld*V.Ii/p;Z=Z*Z*Math.PI,r=Z/O,Y=-1}if(Y*Z._LODLevels[Z._LODLevels.length-1].distanceOrScreenCoverage>Y*r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this;for(let m=0;m<Z._LODLevels.length;m++){const V=Z._LODLevels[m];if(Y*V.distanceOrScreenCoverage<Y*r){if(V.mesh){if(4===V.mesh.delayLoadState)return V.mesh._checkDelayState(),this;if(2===V.mesh.delayLoadState)return this;V.mesh._preActivate(),V.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,V.mesh),V.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this}get oj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(V,O,Z,d){var p,r;if(!this._geometry)return null;let Y=d||null===(p=this._userInstancedBuffersStorage)||void 0===p||null===(r=p.vertexBuffers[V])||void 0===r?void 0:r.getFloatData(this.instances.length+1,Z||O&&1!==this._geometry.meshes.length);return Y||(Y=this._geometry.getVerticesData(V,O,Z)),Y}copyVerticesData(V,O){this._geometry&&this._geometry.copyVerticesData(V,O)}getVertexBuffer(V,O){var Z;return this._geometry?(O||null===(Z=this._userInstancedBuffersStorage)||void 0===Z?void 0:Z.vertexBuffers[V])??this._geometry.getVertexBuffer(V):null}isVerticesDataPresent(V,O){var Z;return this._geometry?!O&&void 0!==(null===(Z=this._userInstancedBuffersStorage)||void 0===Z?void 0:Z.vertexBuffers[V])||this._geometry.isVerticesDataPresent(V):!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}isVertexBufferUpdatable(V,O){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(V);if(!O){var Z;const O=null===(Z=this._userInstancedBuffersStorage)||void 0===Z?void 0:Z.vertexBuffers[V];if(O)return O.isUpdatable()}return this._geometry.isVertexBufferUpdatable(V)}getVerticesDataKinds(V){if(!this._geometry){const V=[];return this._delayInfo&&this._delayInfo.forEach((function(O){V.push(O)})),V}const O=this._geometry.getVerticesDataKinds();if(!V&&this._userInstancedBuffersStorage)for(const Z in this._userInstancedBuffersStorage.vertexBuffers)-1===O.indexOf(Z)&&O.push(Z);return O}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}qf(V,O){return this._geometry?this._geometry.qf(V,O):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(V))return!1;if(!this.Ef||0===this.Ef.length)return!0;if(!V)return!0;const Z=this.getEngine(),d=this.va(),p=O||Z.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Cj();const r=this.material||d.defaultMaterial;if(r)if(r._storeEffectOnSubMeshes)for(const c of this.Ef){const V=c.Ha();if(V)if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,c,p))return!1}else if(!V.isReady(this,p))return!1}else if(!r.isReady(this,p))return!1;const Y=Z.currentRenderPassId;for(const c of this.lightSources){const V=c.getShadowGenerators();if(!V)continue;const O=V.values();for(let d=O.next();!0!==d.done;d=O.next()){var m,a,R,i;const V=d.value;if(V&&(null===(m=V.getShadowMap())||void 0===m||!m.renderList||null!==(a=V.getShadowMap())&&void 0!==a&&a.renderList&&-1!==(null===(R=V.getShadowMap())||void 0===R||null===(i=R.renderList)||void 0===i?void 0:i.indexOf(this)))){const O=V.getShadowMap().renderPassIds??[Z.currentRenderPassId];for(let d=0;d<O.length;++d){Z.currentRenderPassId=O[d];for(const O of this.Ef){var M;if(!V.isReady(O,p,(null===(M=O.Ha())||void 0===M?void 0:M.needAlphaBlendingForMesh(this))??!1))return Z.currentRenderPassId=Y,!1}}Z.currentRenderPassId=Y}}}for(const c of this._internalMeshDataInfo._LODLevels)if(c.mesh&&!c.mesh.isReady(p))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}th(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(V){this._instanceDataStorage.overridenInstanceCount=V}_preActivate(){const V=this._internalMeshDataInfo,O=this.va().getRenderId();return V._preActivateId===O||(V._preActivateId=O,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(V){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=V),this}_registerInstanceForRenderId(V,O){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:O,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[O]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=O,this._instanceDataStorage.visibleInstances[O]=new Array),this._instanceDataStorage.visibleInstances[O].push(V),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let V,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof O?O:{applySkeleton:O,applyMorph:Z};const d=this.oj?this.oj.boundingBias:null;return this.Fa(this._getData(V,null,c.e.PositionKind),d),this}_createGlobalSubMesh(V){const O=this.getTotalVertices();if(!O||!this.qf())return null;if(this.Ef&&this.Ef.length>0){const Z=this.qf();if(!Z)return null;const d=Z.length;let p=!1;if(V)p=!0;else for(const V of this.Ef){if(V.indexStart+V.indexCount>d){p=!0;break}if(V.verticesStart+V.verticesCount>O){p=!0;break}}if(!p)return this.Ef[0]}return this.releaseSubMeshes(),new b.c(0,0,O,0,this.getTotalIndices(),this)}subdivide(V){if(V<1)return;const O=this.getTotalIndices();let Z=O/V|0,d=0;for(;Z%3!==0;)Z++;this.releaseSubMeshes();for(let p=0;p<V&&!(d>=O);p++)b.c.CreateFromIndices(0,d,p===V-1?O-d:Z,this,void 0,!1),d+=Z;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(V,O,Z,d);else{const d=new W.e;d.set(O,V);const p=this.va();new F.d(F.d.RandomId(),p,d,Z,this)}return this}removeVerticesData(V){this._geometry&&this._geometry.removeVerticesData(V)}markVerticesDataAsUpdatable(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=this.getVertexBuffer(V);Z&&Z.isUpdatable()!==O&&this.Ga(V,this.getVerticesData(V),O)}setVerticesBuffer(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=F.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(V,null,O),this}updateVerticesData(V,O,Z,d){return this._geometry?(d?(this.makeGeometryUnique(),this.updateVerticesData(V,O,Z,!1)):this._geometry.updateVerticesData(V,O,Z),this):this}updateMeshPositions(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=this.getVerticesData(c.e.PositionKind);if(!Z)return this;if(V(Z),this.updateVerticesData(c.e.PositionKind,Z,!1,!1),O){const V=this.qf(),O=this.getVerticesData(c.e.NormalKind);if(!O)return this;W.e.ComputeNormals(Z,V,O),this.updateVerticesData(c.e.NormalKind,O,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const V=this._geometry,O=this._geometry.j(F.d.RandomId());return V.releaseForMesh(this,!0),O.Ca(this),this}setIndexBuffer(V,O,Z){let d=this._geometry;d||(d=new F.d(F.d.RandomId(),this.va(),void 0,void 0,this)),d.setIndexBuffer(V,O,Z)}setIndices(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(V,O,Z,d);else{const O=new W.e;O.indices=V;const d=this.va();new F.d(F.d.RandomId(),d,O,Z,this)}return this}updateIndices(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(V,O,Z),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(V,O,Z){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const p=this.va().getEngine();let r;if(this._unIndexed)if(this._getRenderingFillMode(Z)===U.e.WireFrameFillMode)r=V._getLinesIndexBuffer(this.qf(),p);else r=null;else switch(this._getRenderingFillMode(Z)){case U.e.PointFillMode:r=null;break;case U.e.WireFrameFillMode:r=V._getLinesIndexBuffer(this.qf(),p);break;default:case U.e.TriangleFillMode:r=this._geometry.getIndexBuffer()}return this._bindDirect(O,r,d)}_bindDirect(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(V),Z&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(V,O,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(V,O),this):this}_draw(V,O,Z){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const d=this.va().getEngine();return this._unIndexed&&O!==U.e.WireFrameFillMode||O==U.e.PointFillMode?d.drawArraysType(O,V.verticesStart,V.verticesCount,this.forcedInstanceCount||Z):O==U.e.WireFrameFillMode?d.drawElementsType(O,0,V._linesIndexCount,this.forcedInstanceCount||Z):d.drawElementsType(O,V.indexStart,V.indexCount,this.forcedInstanceCount||Z),this}registerBeforeRender(V){return this.onBeforeRenderObservable.add(V),this}unregisterBeforeRender(V){return this.onBeforeRenderObservable.removeCallback(V),this}registerAfterRender(V){return this.onAfterRenderObservable.add(V),this}unregisterAfterRender(V){return this.onAfterRenderObservable.removeCallback(V),this}_getInstancesRenderList(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(O)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[V]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[V]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const Z=this.va(),d=Z._isInIntermediateRendering(),p=d?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[V]=O||!p&&this.isEnabled()&&this.isVisible,r.visibleInstances[V]=null,this._instanceDataStorage.visibleInstances&&!O){const O=this._instanceDataStorage.visibleInstances,p=Z.getRenderId(),Y=d?O.intermediateDefaultRenderId:O.defaultRenderId;r.visibleInstances[V]=O[p],!r.visibleInstances[V]&&Y&&(r.visibleInstances[V]=O[Y])}return r.hardwareInstancedRendering[V]=!O&&this._instanceDataStorage.hardwareInstancedRendering&&null!==r.visibleInstances[V]&&void 0!==r.visibleInstances[V],this._instanceDataStorage.previousBatch=r,r}_renderWithInstances(V,O,Z,d,p){const r=Z.visibleInstances[V._id],Y=r?r.length:0,m=this._instanceDataStorage,a=m.instancesBufferSize;let i=m.instancesBuffer,M=m.instancesPreviousBuffer;const W=16*(Y+1)*4;for(;m.instancesBufferSize<W;)m.instancesBufferSize*=2;m.instancesData&&a==m.instancesBufferSize||(m.instancesData=new Float32Array(m.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!m.instancesPreviousData||a!=m.instancesBufferSize)&&(m.instancesPreviousData=new Float32Array(m.instancesBufferSize/4));let F=0,Q=0;const b=Z.renderSelf[V._id],U=!i||a!==m.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!m.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||m.isFrozen&&!U)Q=(b?1:0)+Y;else{const O=this.getWorldMatrix();if(b&&(this._scene.needsPreviousWorldMatrices&&(m.masterMeshPreviousWorldMatrix?(m.masterMeshPreviousWorldMatrix.copyToArray(m.instancesPreviousData,F),m.masterMeshPreviousWorldMatrix.p(O)):(m.masterMeshPreviousWorldMatrix=O.clone(),m.masterMeshPreviousWorldMatrix.copyToArray(m.instancesPreviousData,F))),O.copyToArray(m.instancesData,F),F+=16,Q++),r){var H;if(e.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(H=V.Ha())&&void 0!==H&&H.needAlphaBlendingForMesh(V.getRenderingMesh())){const V=this._scene.activeCamera.globalPosition;for(let O=0;O<r.length;O++){const Z=r[O];Z._distanceToCamera=R.m.Distance(Z.getBoundingInfo().boundingSphere.centerWorld,V)}r.sort(((V,O)=>V._distanceToCamera>O._distanceToCamera?-1:V._distanceToCamera<O._distanceToCamera?1:0))}for(let V=0;V<r.length;V++){const O=r[V],Z=O.getWorldMatrix();Z.copyToArray(m.instancesData,F),this._scene.needsPreviousWorldMatrices&&(O._previousWorldMatrix?(O._previousWorldMatrix.copyToArray(m.instancesPreviousData,F),O._previousWorldMatrix.p(Z)):(O._previousWorldMatrix=Z.clone(),O._previousWorldMatrix.copyToArray(m.instancesPreviousData,F))),F+=16,Q++}}}return U?(i&&i.dispose(),M&&M.dispose(),i=new c.c(p,m.instancesData,!0,16,!1,!0),m.instancesBuffer=i,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=i.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=i.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=i.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=i.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(M=new c.c(p,m.instancesPreviousData,!0,16,!1,!0),m.instancesPreviousBuffer=M,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=M.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=M.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=M.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=M.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(i.updateDirectly(m.instancesData,0,Q),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||M.updateDirectly(m.instancesPreviousData,0,Q)),this._processInstancedBuffers(r,b),this.va()._activeIndices.addCount(V.indexCount*Q,!1),p._currentDrawContext&&(p._currentDrawContext.useInstancing=!0),this._bind(V,d,O),this._draw(V,O,Q),!this._scene.needsPreviousWorldMatrices||U||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||M.updateDirectly(m.instancesData,0,Q),p.unbindInstanceAttributes(),this}_renderWithThinInstances(V,O,Z,d){var p;const r=(null===(p=this._thinInstanceDataStorage)||void 0===p?void 0:p.instancesCount)??0;this.va()._activeIndices.addCount(V.indexCount*r,!1),d._currentDrawContext&&(d._currentDrawContext.useInstancing=!0),this._bind(V,Z,O),this._draw(V,O,r),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,r):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),d.unbindInstanceAttributes()}_processInstancedBuffers(V,O){}_processRendering(V,O,Z,d,p,r,Y,m){const a=this.va(),R=a.getEngine();if(d=this._getRenderingFillMode(d),r&&O.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(O,d,Z,R),this;if(r)this._renderWithInstances(O,d,p,Z,R);else{R._currentDrawContext&&(R._currentDrawContext.useInstancing=!1);let Z=0;p.renderSelf[O._id]&&(Y&&Y(!1,V.getWorldMatrix(),m),Z++,this._draw(O,d,this._instanceDataStorage.overridenInstanceCount));const r=p.visibleInstances[O._id];if(r){const V=r.length;Z+=V;for(let Z=0;Z<V;Z++){const V=r[Z].getWorldMatrix();Y&&Y(!0,V,m),this._draw(O,d)}}a._activeIndices.addCount(O.indexCount*Z,!1)}return this}_rebuild(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(V&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const O in this._userInstancedBuffersStorage.vertexBuffers){const Z=this._userInstancedBuffersStorage.vertexBuffers[O];Z&&(V&&Z.dispose(),this._userInstancedBuffersStorage.vertexBuffers[O]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(V)}_freeze(){if(this.Ef){for(let V=0;V<this.Ef.length;V++)this._getInstancesRenderList(V);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(V,O,Z,d){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=this._scene.getEngine(),Y=r.currentRenderPassId;if(void 0!==V&&(r.currentRenderPassId=V),d)(!p||p&&d.isInFrustum(this._scene._frustumPlanes))&&this.render(d,!!O,Z);else for(let m=0;m<this.Ef.length;m++){const V=this.Ef[m];(!p||p&&V.isInFrustum(this._scene._frustumPlanes))&&this.render(V,!!O,Z)}return void 0!==V&&(r.currentRenderPassId=Y),this}directRender(){if(!this.Ef)return this;for(const V of this.Ef)this.render(V,!1);return this}render(V,O,Z){var d,p,r;const Y=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const m=(null===(d=Y.activeCameras)||void 0===d?void 0:d.length)??0;if((m>1&&Y.activeCamera===Y.activeCameras[0]||m<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const a=this._getInstancesRenderList(V._id,!!Z);if(a.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const R=Y.getEngine();let i=0,M=null;this.ignoreCameraMaxZ&&Y.activeCamera&&!Y._isInIntermediateRendering()&&(i=Y.activeCamera.maxZ,M=Y.activeCamera,Y.activeCamera.maxZ=0,Y.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const c=V.getRenderingMesh(),W=a.hardwareInstancedRendering[V._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!V.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,F=this._instanceDataStorage,Q=V.Ha();if(!Q)return M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),this;if(F.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===Q){if(Q._storeEffectOnSubMeshes&&(null===(p=V._drawWrapper)||void 0===p||!p._wasPreviouslyReady)||!Q._storeEffectOnSubMeshes&&!Q._getDrawWrapper()._wasPreviouslyReady)return M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),this}else{if(Q._storeEffectOnSubMeshes){if(!Q.isReadyForSubMesh(this,V,W))return M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),this}else if(!Q.isReady(this,W))return M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=Q}let b;O&&R.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),b=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?V._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const H=(null===(r=b)||void 0===r?void 0:r.effect)??null;for(const U of Y._beforeRenderingMeshStage)U.action(this,V,a,H);if(!b||!H)return M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),this;const S=Z||this;let z;if(F.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Jg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)z=F.sideOrientation;else{const V=S._getWorldMatrixDeterminant();z=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),V<0&&(z=z===U.e.ClockWiseSideOrientation?U.e.CounterClockWiseSideOrientation:U.e.ClockWiseSideOrientation),F.sideOrientation=z}const G=this._internalMeshDataInfo._effectiveMaterial._preBind(b,z);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&R.setDepthWrite(!0);const w=this._internalMeshDataInfo._effectiveMaterial,t=w.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),W||this._bind(V,H,t,!1);const C=S.getWorldMatrix();w._storeEffectOnSubMeshes?w.bindForSubMesh(C,this,V):w.bind(C,this),!w.Jg&&w.separateCullingPass&&(R.setState(!0,w.zOffset,!1,!G,w.cullBackFaces,w.stencil,w.zOffsetUnits),this._processRendering(this,V,H,t,a,W,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),R.setState(!0,w.zOffset,!1,G,w.cullBackFaces,w.stencil,w.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(V)),this._processRendering(this,V,H,t,a,W,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const U of Y._afterRenderingMeshStage)U.action(this,V,a,H);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),M&&(M.maxZ=i,Y.updateTransformMatrix(!0)),2!==Y.performancePriority||F.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(c.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(c.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const V=this.getVerticesData(c.e.MatricesWeightsKind),O=V.length;for(let Z=0;Z<O;Z+=4){const O=V[Z]+V[Z+1]+V[Z+2]+V[Z+3];if(0===O)V[Z]=1;else{const d=1/O;V[Z]*=d,V[Z+1]*=d,V[Z+2]*=d,V[Z+3]*=d}}this.Ga(c.e.MatricesWeightsKind,V)}_normalizeSkinWeightsAndExtra(){const V=this.getVerticesData(c.e.MatricesWeightsExtraKind),O=this.getVerticesData(c.e.MatricesWeightsKind),Z=O.length;for(let d=0;d<Z;d+=4){let Z=O[d]+O[d+1]+O[d+2]+O[d+3];if(Z+=V[d]+V[d+1]+V[d+2]+V[d+3],0===Z)O[d]=1;else{const p=1/Z;O[d]*=p,O[d+1]*=p,O[d+2]*=p,O[d+3]*=p,V[d]*=p,V[d+1]*=p,V[d+2]*=p,V[d+3]*=p}}this.Ga(c.e.MatricesWeightsKind,O),this.Ga(c.e.MatricesWeightsKind,V)}validateSkinning(){const V=this.getVerticesData(c.e.MatricesWeightsExtraKind),O=this.getVerticesData(c.e.MatricesWeightsKind);if(null===O||null==this.skeleton)return{skinned:!1,valid:!0,_l:"not skinned"};const Z=O.length;let d=0,p=0,r=0,Y=0;const m=null===V?4:8,a=[];for(let c=0;c<=m;c++)a[c]=0;for(let c=0;c<Z;c+=4){let Z=O[c],R=Z,i=0===R?0:1;for(let p=1;p<m;p++){const r=p<4?O[c+p]:V[c+p-4];r>Z&&d++,0!==r&&i++,R+=r,Z=r}if(a[i]++,i>r&&(r=i),0===R)p++;else{const Z=1/R;let d=0;for(let p=0;p<m;p++)d+=p<4?Math.abs(O[c+p]-O[c+p]*Z):Math.abs(V[c+p-4]-V[c+p-4]*Z);d>.001&&Y++}}const R=this.skeleton.bones.length,i=this.getVerticesData(c.e.MatricesIndicesKind),M=this.getVerticesData(c.e.MatricesIndicesExtraKind);let W=0;for(let c=0;c<Z;c+=4)for(let V=0;V<m;V++){const O=V<4?i[c+V]:M[c+V-4];(O>=R||O<0)&&W++}return{skinned:!0,valid:0===p&&0===Y&&0===W,_l:"Number of Weights = "+Z/4+"\nMaximum influences = "+r+"\nMissing Weights = "+p+"\nNot Sorted = "+d+"\nNot Normalized = "+Y+"\nWeightCounts = ["+a+"]\nNumber of bones = "+R+"\nBad Bone Indices = "+W}}_checkDelayState(){const V=this.va();return this._geometry?this._geometry.load(V):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(V)),this}_queueLoad(V){V.addPendingData(this);const O=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return p.e.LoadFile(this.delayLoadingFile,(O=>{O instanceof ArrayBuffer?this._delayLoadingFunction(O,this):this._delayLoadingFunction(JSON.parse(O),this),this.instances.forEach((V=>{V.refreshBoundingInfo(),V._syncSubMeshes()})),this.delayLoadState=1,V.removePendingData(this)}),(()=>{}),V.offlineProvider,O),this}isInFrustum(V){return 2!==this.delayLoadState&&(!!super.isInFrustum(V)&&(this._checkDelayState(),!0))}setMaterialById(V){const O=this.va().materials;let Z;for(Z=O.length-1;Z>-1;Z--)if(O[Z].id===V)return this.material=O[Z],this;const d=this.va().multiMaterials;for(Z=d.length-1;Z>-1;Z--)if(d[Z].id===V)return this.material=d[Z],this;return this}getAnimatables(){const V=[];return this.material&&V.push(this.material),this.skeleton&&V.push(this.skeleton),V}bakeTransformIntoVertices(V){if(!this.isVerticesDataPresent(c.e.PositionKind))return this;const O=this.Ef.splice(0);this._resetPointsArrayCache();let Z=this.getVerticesData(c.e.PositionKind);const d=R.m.Zero();let p;for(p=0;p<Z.length;p+=3)R.m.TransformCoordinatesFromFloatsToRef(Z[p],Z[p+1],Z[p+2],V,d).toArray(Z,p);if(this.Ga(c.e.PositionKind,Z,this.getVertexBuffer(c.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.e.NormalKind)){for(Z=this.getVerticesData(c.e.NormalKind),p=0;p<Z.length;p+=3)R.m.TransformNormalFromFloatsToRef(Z[p],Z[p+1],Z[p+2],V,d).normalize().toArray(Z,p);this.Ga(c.e.NormalKind,Z,this.getVertexBuffer(c.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(c.e.TangentKind)){for(Z=this.getVerticesData(c.e.TangentKind),p=0;p<Z.length;p+=4)R.m.TransformNormalFromFloatsToRef(Z[p],Z[p+1],Z[p+2],V,d).normalize().toArray(Z,p);this.Ga(c.e.TangentKind,Z,this.getVertexBuffer(c.e.TangentKind).isUpdatable())}return V.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Ef=O,this}bakeCurrentTransformIntoVertices(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Cj(!0)),this.resetLocalMatrix(V),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),V,this,O,Z)}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const Z=this._internalMeshDataInfo;if(Z._onBeforeDrawObservable&&Z._onBeforeDrawObservable.clear(),Z._onBeforeBindObservable&&Z._onBeforeBindObservable.clear(),Z._onBeforeRenderObservable&&Z._onBeforeRenderObservable.clear(),Z._onAfterRenderObservable&&Z._onAfterRenderObservable.clear(),Z._onBetweenPassObservable&&Z._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(Z.meshMap)for(const V in Z.meshMap){const O=Z.meshMap[V];O&&(O._internalMeshDataInfo._source=null,Z.meshMap[V]=void 0)}Z._source&&Z._source._internalMeshDataInfo.meshMap&&(Z._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const V=this.va().meshes;for(const O of V){const V=O;V._internalMeshDataInfo&&V._internalMeshDataInfo._source&&V._internalMeshDataInfo._source===this&&(V._internalMeshDataInfo._source=null)}}Z._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(V,O)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(V,O,Z,d,r,Y){let m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;const R=this.va();return p.e.LoadImage(V,(V=>{const p=V.width,a=V.height,R=this.getEngine().createCanvas(p,a).getContext("2d");R.drawImage(V,0,0);const i=R.getImageData(0,0,p,a).data;this.applyDisplacementMapFromBuffer(i,p,a,O,Z,r,Y,m),d&&d(this)}),a||(()=>{}),R.offlineProvider),this}applyDisplacementMapFromBuffer(V,O,Z,d,p,r,Y){let m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(c.e.PositionKind)||!this.isVerticesDataPresent(c.e.NormalKind)||!this.isVerticesDataPresent(c.e.UVKind))return G.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const a=this.getVerticesData(c.e.PositionKind,!0,!0),i=this.getVerticesData(c.e.NormalKind),M=this.getVerticesData(c.e.UVKind);let F=R.m.Zero();const Q=R.m.Zero(),b=R.l.Zero();r=r||R.l.Zero(),Y=Y||new R.l(1,1);for(let c=0;c<a.length;c+=3){R.m.FromArrayToRef(a,c,F),R.m.FromArrayToRef(i,c,Q),R.l.FromArrayToRef(M,c/3*2,b);const m=4*((Math.abs(b.x*Y.x+r.x%1)*(O-1)%O|0)+(Math.abs(b.y*Y.y+r.y%1)*(Z-1)%Z|0)*O),W=.3*(V[m]/255)+.59*(V[m+1]/255)+.11*(V[m+2]/255);Q.normalize(),Q.scaleInPlace(d+(p-d)*W),F=F.add(Q),F.toArray(a,c)}return W.e.ComputeNormals(a,this.qf(),i),m?(this.Ga(c.e.PositionKind,a),this.Ga(c.e.NormalKind,i),this.Ga(c.e.UVKind,M)):(this.updateVerticesData(c.e.PositionKind,a),this.updateVerticesData(c.e.NormalKind,i)),this}_getFlattenedNormals(V,O){const Z=new Float32Array(3*V.length);let d=0;const p=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let r=0;r<V.length;r+=3){const Y=R.m.Cg(O,3*V[r]),m=R.m.Cg(O,3*V[r+1]),a=R.m.Cg(O,3*V[r+2]),i=Y.fc(m),M=a.fc(m),c=R.m.Normalize(R.m.Cross(i,M));p&&c.scaleInPlace(-1);for(let V=0;V<3;V++)Z[d++]=c.x,Z[d++]=c.y,Z[d++]=c.z}return Z}_convertToUnIndexedMesh(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.getVerticesDataKinds().filter((V=>{var O;return!(null!==(O=this.getVertexBuffer(V))&&void 0!==O&&O.getIsInstanced())})),Z=this.qf(),d={},p=(V,O)=>{const d=new Float32Array(Z.length*O);let p=0;for(let r=0;r<Z.length;r++)for(let Y=0;Y<O;Y++)d[p++]=V[Z[r]*O+Y];return d},r=this.getBoundingInfo(),Y=this.oj?this.Ef.slice(0):[];for(const m of O)d[m]=this.getVerticesData(m);for(const m of O){const O=this.getVertexBuffer(m),r=O.getSize();if(V&&m===c.e.NormalKind){const V=this._getFlattenedNormals(Z,d[c.e.PositionKind]);this.Ga(c.e.NormalKind,V,O.isUpdatable(),r)}else this.Ga(m,p(d[m],r),O.isUpdatable(),r)}if(this.morphTargetManager){for(let O=0;O<this.morphTargetManager.numTargets;O++){const d=this.morphTargetManager.getTarget(O),r=d.getPositions();d.setPositions(p(r,3));const Y=d.getNormals();Y&&d.setNormals(V?this._getFlattenedNormals(Z,r):p(Y,3));const m=d.getTangents();m&&d.setTangents(p(m,3));const a=d.getUVs();a&&d.setUVs(p(a,2))}this.morphTargetManager.synchronize()}for(let m=0;m<Z.length;m++)Z[m]=m;this.setIndices(Z),this._unIndexed=!0,this.releaseSubMeshes();for(const m of Y){const V=m.getBoundingInfo();b.c.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this).setBoundingInfo(V)}return this.setBoundingInfo(r),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=W.e.ExtractFromMesh(this);let Z;if(V&&this.isVerticesDataPresent(c.e.NormalKind)&&O.ya){for(Z=0;Z<O.ya.length;Z++)O.ya[Z]*=-1;this.Ga(c.e.NormalKind,O.ya,this.isVertexBufferUpdatable(c.e.NormalKind))}if(O.indices){let V;for(Z=0;Z<O.indices.length;Z+=3)V=O.indices[Z+1],O.indices[Z+1]=O.indices[Z+2],O.indices[Z+2]=V;this.setIndices(O.indices,null,this.isVertexBufferUpdatable(c.e.PositionKind),!0)}return this}increaseVertices(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const O=W.e.ExtractFromMesh(this),Z=O.indices&&!Array.isArray(O.indices)&&Array.from?Array.from(O.indices):O.indices,d=O.xa&&!Array.isArray(O.xa)&&Array.from?Array.from(O.xa):O.xa,p=O.Aa&&!Array.isArray(O.Aa)&&Array.from?Array.from(O.Aa):O.Aa,r=O.ya&&!Array.isArray(O.ya)&&Array.from?Array.from(O.ya):O.ya;if(Z&&d){O.indices=Z,O.xa=d,p&&(O.Aa=p),r&&(O.ya=r);const Y=V+1,m=new Array;for(let V=0;V<Y+1;V++)m[V]=new Array;let a,i;const M=new R.m(0,0,0),W=new R.m(0,0,0),F=new R.l(0,0),Q=new Array,b=new Array,U=new Array;let H,S,z,G=d.length;p&&(S=p.length),r&&(z=r.length);for(let V=0;V<Z.length;V+=3){b[0]=Z[V],b[1]=Z[V+1],b[2]=Z[V+2];for(let V=0;V<3;V++)if(a=b[V],i=b[(V+1)%3],void 0===U[a]&&void 0===U[i]?(U[a]=new Array,U[i]=new Array):(void 0===U[a]&&(U[a]=new Array),void 0===U[i]&&(U[i]=new Array)),void 0===U[a][i]&&void 0===U[i][a]){U[a][i]=[],M.x=(d[3*i]-d[3*a])/Y,M.y=(d[3*i+1]-d[3*a+1])/Y,M.z=(d[3*i+2]-d[3*a+2])/Y,r&&(W.x=(r[3*i]-r[3*a])/Y,W.y=(r[3*i+1]-r[3*a+1])/Y,W.z=(r[3*i+2]-r[3*a+2])/Y),p&&(F.x=(p[2*i]-p[2*a])/Y,F.y=(p[2*i+1]-p[2*a+1])/Y),U[a][i].push(a);for(let V=1;V<Y;V++)U[a][i].push(d.length/3),d[G++]=d[3*a]+V*M.x,d[G++]=d[3*a+1]+V*M.y,d[G++]=d[3*a+2]+V*M.z,r&&(r[z++]=r[3*a]+V*W.x,r[z++]=r[3*a+1]+V*W.y,r[z++]=r[3*a+2]+V*W.z),p&&(p[S++]=p[2*a]+V*F.x,p[S++]=p[2*a+1]+V*F.y);U[a][i].push(i),U[i][a]=new Array,H=U[a][i].length;for(let V=0;V<H;V++)U[i][a][V]=U[a][i][H-1-V]}m[0][0]=Z[V],m[1][0]=U[Z[V]][Z[V+1]][1],m[1][1]=U[Z[V]][Z[V+2]][1];for(let O=2;O<Y;O++){m[O][0]=U[Z[V]][Z[V+1]][O],m[O][O]=U[Z[V]][Z[V+2]][O],M.x=(d[3*m[O][O]]-d[3*m[O][0]])/O,M.y=(d[3*m[O][O]+1]-d[3*m[O][0]+1])/O,M.z=(d[3*m[O][O]+2]-d[3*m[O][0]+2])/O,r&&(W.x=(r[3*m[O][O]]-r[3*m[O][0]])/O,W.y=(r[3*m[O][O]+1]-r[3*m[O][0]+1])/O,W.z=(r[3*m[O][O]+2]-r[3*m[O][0]+2])/O),p&&(F.x=(p[2*m[O][O]]-p[2*m[O][0]])/O,F.y=(p[2*m[O][O]+1]-p[2*m[O][0]+1])/O);for(let V=1;V<O;V++)m[O][V]=d.length/3,d[G++]=d[3*m[O][0]]+V*M.x,d[G++]=d[3*m[O][0]+1]+V*M.y,d[G++]=d[3*m[O][0]+2]+V*M.z,r&&(r[z++]=r[3*m[O][0]]+V*W.x,r[z++]=r[3*m[O][0]+1]+V*W.y,r[z++]=r[3*m[O][0]+2]+V*W.z),p&&(p[S++]=p[2*m[O][0]]+V*F.x,p[S++]=p[2*m[O][0]+1]+V*F.y)}m[Y]=U[Z[V+1]][Z[V+2]],Q.push(m[0][0],m[1][0],m[1][1]);for(let V=1;V<Y;V++){let O;for(O=0;O<V;O++)Q.push(m[V][O],m[V+1][O],m[V+1][O+1]),Q.push(m[V][O],m[V+1][O+1],m[V][O+1]);Q.push(m[V][O],m[V+1][O],m[V+1][O+1])}}O.indices=Q,O.Ca(this,this.isVertexBufferUpdatable(c.e.PositionKind))}else G.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const V=W.e.ExtractFromMesh(this),O=V.Aa,Z=V.indices,d=V.xa,p=V.za,r=V.matricesIndices,Y=V.matricesWeights,m=V.matricesIndicesExtra,a=V.matricesWeightsExtra;if(void 0===Z||void 0===d||null===Z||null===d)G.b.Warn("VertexData contains empty entries");else{const R=new Array,i=new Array,M=new Array,F=new Array,Q=new Array,b=new Array,U=new Array,H=new Array;let S=new Array,z=0;const G={};let w,t;for(let V=0;V<Z.length;V+=3){t=[Z[V],Z[V+1],Z[V+2]],S=[];for(let V=0;V<3;V++){S[V]="";for(let O=0;O<3;O++)Math.abs(d[3*t[V]+O])<1e-8&&(d[3*t[V]+O]=0),S[V]+=d[3*t[V]+O]+"|"}if(S[0]!=S[1]&&S[0]!=S[2]&&S[1]!=S[2])for(let V=0;V<3;V++){if(w=G[S[V]],void 0===w){G[S[V]]=z,w=z++;for(let O=0;O<3;O++)R.push(d[3*t[V]+O]);if(null!==p&&void 0!==p)for(let O=0;O<4;O++)F.push(p[4*t[V]+O]);if(null!==O&&void 0!==O)for(let Z=0;Z<2;Z++)M.push(O[2*t[V]+Z]);if(null!==r&&void 0!==r)for(let O=0;O<4;O++)Q.push(r[4*t[V]+O]);if(null!==Y&&void 0!==Y)for(let O=0;O<4;O++)b.push(Y[4*t[V]+O]);if(null!==m&&void 0!==m)for(let O=0;O<4;O++)U.push(m[4*t[V]+O]);if(null!==a&&void 0!==a)for(let O=0;O<4;O++)H.push(a[4*t[V]+O])}i.push(w)}}const C=new Array;W.e.ComputeNormals(R,i,C),V.xa=R,V.indices=i,V.ya=C,null!==O&&void 0!==O&&(V.Aa=M),null!==p&&void 0!==p&&(V.za=F),null!==r&&void 0!==r&&(V.matricesIndices=Q),null!==Y&&void 0!==Y&&(V.matricesWeights=b),null!==m&&void 0!==m&&(V.matricesIndicesExtra=U),null!==Y&&void 0!==Y&&(V.matricesWeightsExtra=H),V.Ca(this,this.isVertexBufferUpdatable(c.e.PositionKind))}}static _instancedMeshFactory(V,O){throw(0,t.c)("InstancedMesh")}static _PhysicsImpostorParser(V,O,Z){throw(0,t.c)("PhysicsImpostor")}Vc(V){const O=e._instancedMeshFactory(V,this);return O.parent=this.parent,O}synchronizeInstances(){for(let V=0;V<this.instances.length;V++){this.instances[V]._syncSubMeshes()}return this}optimizeIndices(V){const O=this.qf(),Z=this.getVerticesData(c.e.PositionKind);if(!Z||!O)return this;const d=[];for(let p=0;p<Z.length;p+=3)d.push(R.m.Cg(Z,p));const r=[];return p.b.SyncAsyncForLoop(d.length,40,(V=>{const O=d.length-1-V,Z=d[O];for(let p=0;p<O;++p){const V=d[p];if(Z.equals(V)){r[O]=p;break}}}),(()=>{for(let V=0;V<O.length;++V)O[V]=r[O[V]]||O[V];const Z=this.Ef.slice(0);this.setIndices(O),this.Ef=Z,V&&V(this)})),this}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,V.type=this.getClassName(),Y.e&&Y.e.HasTags(this)&&(V.tags=Y.e.GetTags(this)),V.position=this.position.Wi(),this.rotationQuaternion?V.rotationQuaternion=this.rotationQuaternion.Wi():this.rotation&&(V.rotation=this.rotation.Wi()),V.Af=this.Af.Wi(),this._postMultiplyPivotMatrix?V.pivotMatrix=this.getPivotMatrix().Wi():V.localMatrix=this.getPivotMatrix().Wi(),V.isEnabled=this.isEnabled(!1),V.isVisible=this.isVisible,V.infiniteDistance=this.infiniteDistance,V.pickable=this.oe,V.receiveShadows=this.receiveShadows,V.billboardMode=this.billboardMode,V.visibility=this.visibility,V.jg=this.jg,V.checkCollisions=this.checkCollisions,V.ellipsoid=this.ellipsoid.Wi(),V.ellipsoidOffset=this.ellipsoidOffset.Wi(),V.Da=this.Da,V.isBlocker=this.isBlocker,V.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(V),V.isUnIndexed=this.isUnIndexed;const O=this._geometry;if(O&&this.Ef){V.geometryUniqueId=O.uniqueId,V.geometryId=O.id,V.Ef=[];for(let O=0;O<this.Ef.length;O++){const Z=this.Ef[O];V.Ef.push({materialIndex:Z.materialIndex,verticesStart:Z.verticesStart,verticesCount:Z.verticesCount,indexStart:Z.indexStart,indexCount:Z.indexCount})}}if(this.material?this.material.doNotSerialize||(V.materialUniqueId=this.material.uniqueId,V.materialId=this.material.id):(this.material=null,V.materialUniqueId=this._scene.defaultMaterial.uniqueId,V.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(V.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(V.skeletonId=this.skeleton.id,V.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(C.b.NAME_PHYSICSENGINE)){const O=this.getPhysicsImpostor();O&&(V.physicsMass=O.getParam("mass"),V.physicsFriction=O.getParam("friction"),V.physicsRestitution=O.getParam("mass"),V.physicsImpostor=O.type)}this.metadata&&(V.metadata=this.metadata),V.instances=[];for(let Z=0;Z<this.instances.length;Z++){const O=this.instances[Z];if(O.doNotSerialize)continue;const d={name:O.name,id:O.id,isEnabled:O.isEnabled(!1),isVisible:O.isVisible,oe:O.oe,checkCollisions:O.checkCollisions,position:O.position.Wi(),Af:O.Af.Wi()};if(O.parent&&O.parent._serializeAsParent(d),O.rotationQuaternion?d.rotationQuaternion=O.rotationQuaternion.Wi():O.rotation&&(d.rotation=O.rotation.Wi()),this.va()._getComponent(C.b.NAME_PHYSICSENGINE)){const V=O.getPhysicsImpostor();V&&(d.physicsMass=V.getParam("mass"),d.physicsFriction=V.getParam("friction"),d.physicsRestitution=V.getParam("mass"),d.physicsImpostor=V.type)}O.metadata&&(d.metadata=O.metadata),O.actionManager&&(d.actions=O.actionManager.serialize(O.name)),V.instances.push(d),z.b.AppendSerializedAnimations(O,d),d.ranges=O.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(V.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const O={data:{},sizes:{},strides:{}};for(const V in this._userThinInstanceBuffersStorage.data)O.data[V]=Array.from(this._userThinInstanceBuffersStorage.data[V]),O.sizes[V]=this._userThinInstanceBuffersStorage.sizes[V],O.strides[V]=this._userThinInstanceBuffersStorage.strides[V];V.thinInstances.userThinInstance=O}return z.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.layerMask=this.layerMask,V.alphaIndex=this.alphaIndex,V.hasVertexAlpha=this.hasVertexAlpha,V.overlayAlpha=this.overlayAlpha,V.overlayColor=this.overlayColor.Wi(),V.renderOverlay=this.renderOverlay,V.applyFog=this.applyFog,this.actionManager&&(V.actions=this.actionManager.serialize(this.name)),V}_syncGeometryWithMorphTargetManager(){if(!this.oj)return;this._markSubMeshesAsAttributesDirty();const V=this._internalAbstractMeshDataInfo._morphTargetManager;if(V&&V.vertexCount){if(V.vertexCount!==this.getTotalVertices())return G.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(V.isUsingTextureForTargets)return;for(let O=0;O<V.numInfluencers;O++){const Z=V.getActiveTarget(O),d=Z.getPositions();if(!d)return void G.b.Error("Invalid morph target. Target must have positions.");this.oj.Ga(c.e.PositionKind+O,d,!1,3);const p=Z.getNormals();p&&this.oj.Ga(c.e.NormalKind+O,p,!1,3);const r=Z.getTangents();r&&this.oj.Ga(c.e.TangentKind+O,r,!1,3);const Y=Z.getUVs();Y&&this.oj.Ga(c.e.UVKind+"_"+O,Y,!1,2)}}else{let V=0;for(;this.oj.isVerticesDataPresent(c.e.PositionKind+V);)this.oj.removeVerticesData(c.e.PositionKind+V),this.oj.isVerticesDataPresent(c.e.NormalKind+V)&&this.oj.removeVerticesData(c.e.NormalKind+V),this.oj.isVerticesDataPresent(c.e.TangentKind+V)&&this.oj.removeVerticesData(c.e.TangentKind+V),this.oj.isVerticesDataPresent(c.e.UVKind+V)&&this.oj.removeVerticesData(c.e.UVKind+"_"+V),V++}}static Parse(V,O,Z){let d;if(d=V.type&&"LinesMesh"===V.type?e._LinesMeshParser(V,O):V.type&&"GroundMesh"===V.type?e._GroundMeshParser(V,O):V.type&&"GoldbergMesh"===V.type?e._GoldbergMeshParser(V,O):V.type&&"GreasedLineMesh"===V.type?e._GreasedLineMeshParser(V,O):V.type&&"TrailMesh"===V.type?e._TrailMeshParser(V,O):new e(V.name,O),d.id=V.id,d._waitingParsedUniqueId=V.uniqueId,Y.e&&Y.e.AddTagsTo(d,V.tags),d.position=R.m.Cg(V.position),void 0!==V.metadata&&(d.metadata=V.metadata),V.rotationQuaternion?d.rotationQuaternion=R.g.Cg(V.rotationQuaternion):V.rotation&&(d.rotation=R.m.Cg(V.rotation)),d.Af=R.m.Cg(V.Af),V.localMatrix?d.setPreTransformMatrix(R.c.Cg(V.localMatrix)):V.pivotMatrix&&d.setPivotMatrix(R.c.Cg(V.pivotMatrix)),d.If(V.isEnabled),d.isVisible=V.isVisible,d.infiniteDistance=V.infiniteDistance,d.jg=!!V.jg,d.showBoundingBox=V.showBoundingBox,d.showSubMeshesBoundingBox=V.showSubMeshesBoundingBox,void 0!==V.applyFog&&(d.applyFog=V.applyFog),void 0!==V.pickable&&(d.oe=V.pickable),void 0!==V.alphaIndex&&(d.alphaIndex=V.alphaIndex),d.receiveShadows=V.receiveShadows,void 0!==V.billboardMode&&(d.billboardMode=V.billboardMode),void 0!==V.visibility&&(d.visibility=V.visibility),d.checkCollisions=V.checkCollisions,d.Da=!!V.Da,V.ellipsoid&&(d.ellipsoid=R.m.Cg(V.ellipsoid)),V.ellipsoidOffset&&(d.ellipsoidOffset=R.m.Cg(V.ellipsoidOffset)),null!=V.overrideMaterialSideOrientation&&(d.sideOrientation=V.overrideMaterialSideOrientation),void 0!==V.sideOrientation&&(d.sideOrientation=V.sideOrientation),void 0!==V.isBlocker&&(d.isBlocker=V.isBlocker),d._shouldGenerateFlatShading=V.useFlatShading,V.yh&&(d._waitingData.yh=V.yh),void 0!==V.parentId&&(d._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(d._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.actions&&(d._waitingData.actions=V.actions),void 0!==V.overlayAlpha&&(d.overlayAlpha=V.overlayAlpha),void 0!==V.overlayColor&&(d.overlayColor=i.b.Cg(V.overlayColor)),void 0!==V.renderOverlay&&(d.renderOverlay=V.renderOverlay),d.isUnIndexed=!!V.isUnIndexed,d.hasVertexAlpha=V.hasVertexAlpha,V.delayLoadingFile?(d.delayLoadState=4,d.delayLoadingFile=Z+V.delayLoadingFile,d.buildBoundingInfo(R.m.Cg(V.boundingBoxMinimum),R.m.Cg(V.boundingBoxMaximum)),V._binaryInfo&&(d._binaryInfo=V._binaryInfo),d._delayInfo=[],V.hasUVs&&d._delayInfo.push(c.e.UVKind),V.hasUVs2&&d._delayInfo.push(c.e.UV2Kind),V.hasUVs3&&d._delayInfo.push(c.e.UV3Kind),V.hasUVs4&&d._delayInfo.push(c.e.UV4Kind),V.hasUVs5&&d._delayInfo.push(c.e.UV5Kind),V.hasUVs6&&d._delayInfo.push(c.e.UV6Kind),V.hasColors&&d._delayInfo.push(c.e.ColorKind),V.hasMatricesIndices&&d._delayInfo.push(c.e.MatricesIndicesKind),V.hasMatricesWeights&&d._delayInfo.push(c.e.MatricesWeightsKind),d._delayLoadingFunction=F.d._ImportGeometry,S.b.ForceFullSceneLoadingForIncremental&&d._checkDelayState()):F.d._ImportGeometry(V,d),V.materialUniqueId?d._waitingMaterialId=V.materialUniqueId:V.materialId&&(d._waitingMaterialId=V.materialId),V.morphTargetManagerId>-1&&(d._waitingMorphTargetManagerId=V.morphTargetManagerId),void 0!==V.skeletonId&&null!==V.skeletonId&&(d.skeleton=O.getLastSkeletonById(V.skeletonId),V.numBoneInfluencers&&(d.numBoneInfluencers=V.numBoneInfluencers)),V.animations){for(let O=0;O<V.animations.length;O++){const Z=V.animations[O],p=(0,w.c)("BABYLON.Animation");p&&d.animations.push(p.Parse(Z))}M.e.ParseAnimationRanges(d,V,O)}if(V.autoAnimate&&O.beginAnimation(d,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),V.layerMask&&!isNaN(V.layerMask)?d.layerMask=Math.abs(parseInt(V.layerMask)):d.layerMask=268435455,V.physicsImpostor&&(d.physicsImpostor=e._PhysicsImpostorParser(O,d,V)),V.lodMeshIds&&(d._waitingData.lods={ids:V.lodMeshIds,distances:V.lodDistances?V.lodDistances:null,coverages:V.lodCoverages?V.lodCoverages:null}),V.instances)for(let p=0;p<V.instances.length;p++){const Z=V.instances[p],r=d.Vc(Z.name);if(Z.id&&(r.id=Z.id),Y.e&&(Z.tags?Y.e.AddTagsTo(r,Z.tags):Y.e.AddTagsTo(r,V.tags)),r.position=R.m.Cg(Z.position),void 0!==Z.metadata&&(r.metadata=Z.metadata),void 0!==Z.parentId&&(r._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(r._waitingParentInstanceIndex=Z.parentInstanceIndex),void 0!==Z.isEnabled&&null!==Z.isEnabled&&r.If(Z.isEnabled),void 0!==Z.isVisible&&null!==Z.isVisible&&(r.isVisible=Z.isVisible),void 0!==Z.oe&&null!==Z.oe&&(r.oe=Z.oe),Z.rotationQuaternion?r.rotationQuaternion=R.g.Cg(Z.rotationQuaternion):Z.rotation&&(r.rotation=R.m.Cg(Z.rotation)),r.Af=R.m.Cg(Z.Af),void 0!=Z.checkCollisions&&null!=Z.checkCollisions&&(r.checkCollisions=Z.checkCollisions),void 0!=Z.pickable&&null!=Z.pickable&&(r.oe=Z.pickable),void 0!=Z.showBoundingBox&&null!=Z.showBoundingBox&&(r.showBoundingBox=Z.showBoundingBox),void 0!=Z.showSubMeshesBoundingBox&&null!=Z.showSubMeshesBoundingBox&&(r.showSubMeshesBoundingBox=Z.showSubMeshesBoundingBox),void 0!=Z.alphaIndex&&null!=Z.showSubMeshesBoundingBox&&(r.alphaIndex=Z.alphaIndex),Z.physicsImpostor&&(r.physicsImpostor=e._PhysicsImpostorParser(O,r,Z)),void 0!==Z.actions&&(r._waitingData.actions=Z.actions),Z.animations){for(let V=0;V<Z.animations.length;V++){const O=Z.animations[V],d=(0,w.c)("BABYLON.Animation");d&&r.animations.push(d.Parse(O))}M.e.ParseAnimationRanges(r,Z,O),Z.autoAnimate&&O.beginAnimation(r,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1)}}if(V.thinInstances){const O=V.thinInstances;if(d.thinInstanceEnablePicking=!!O.enablePicking,O.matrixData?(d.Gj("matrix",new Float32Array(O.matrixData),16,!1),d._thinInstanceDataStorage.matrixBufferSize=O.matrixBufferSize,d._thinInstanceDataStorage.instancesCount=O.instancesCount):d._thinInstanceDataStorage.matrixBufferSize=O.matrixBufferSize,V.thinInstances.userThinInstance){const O=V.thinInstances.userThinInstance;for(const V in O.data)d.Gj(V,new Float32Array(O.data[V]),O.strides[V],!1),d._userThinInstanceBuffersStorage.sizes[V]=O.sizes[V]}}return d}setPositionsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourcePositions){const O=this.getVerticesData(c.e.PositionKind);if(!O)return V._sourcePositions;V._sourcePositions=new Float32Array(O),this.isVertexBufferUpdatable(c.e.PositionKind)||this.Ga(c.e.PositionKind,O,!0)}return V._sourcePositions}setNormalsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourceNormals){const O=this.getVerticesData(c.e.NormalKind);if(!O)return V._sourceNormals;V._sourceNormals=new Float32Array(O),this.isVertexBufferUpdatable(c.e.NormalKind)||this.Ga(c.e.NormalKind,O,!0)}return V._sourceNormals}applySkeleton(V){if(!this.oj)return this;if(this.oj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.oj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(c.e.PositionKind))return this;if(!this.isVerticesDataPresent(c.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(c.e.MatricesWeightsKind))return this;const O=this.isVerticesDataPresent(c.e.NormalKind),Z=this._internalMeshDataInfo;if(!Z._sourcePositions){const V=this.Ef.slice();this.setPositionsForCPUSkinning(),this.Ef=V}O&&!Z._sourceNormals&&this.setNormalsForCPUSkinning();let d=this.getVerticesData(c.e.PositionKind);if(!d)return this;d instanceof Float32Array||(d=new Float32Array(d));let p=this.getVerticesData(c.e.NormalKind);if(O){if(!p)return this;p instanceof Float32Array||(p=new Float32Array(p))}const r=this.getVerticesData(c.e.MatricesIndicesKind),Y=this.getVerticesData(c.e.MatricesWeightsKind);if(!Y||!r)return this;const m=this.numBoneInfluencers>4,a=m?this.getVerticesData(c.e.MatricesIndicesExtraKind):null,i=m?this.getVerticesData(c.e.MatricesWeightsExtraKind):null,M=V.getTransformMatrices(this),W=R.m.Zero(),F=new R.c,Q=new R.c;let b,U=0;for(let c=0;c<d.length;c+=3,U+=4){let V;for(b=0;b<4;b++)V=Y[U+b],V>0&&(R.c.FromFloat32ArrayToRefScaled(M,Math.floor(16*r[U+b]),V,Q),F.addToSelf(Q));if(m)for(b=0;b<4;b++)V=i[U+b],V>0&&(R.c.FromFloat32ArrayToRefScaled(M,Math.floor(16*a[U+b]),V,Q),F.addToSelf(Q));R.m.TransformCoordinatesFromFloatsToRef(Z._sourcePositions[c],Z._sourcePositions[c+1],Z._sourcePositions[c+2],F,W),W.toArray(d,c),O&&(R.m.TransformNormalFromFloatsToRef(Z._sourceNormals[c],Z._sourceNormals[c+1],Z._sourceNormals[c+2],F,W),W.toArray(p,c)),F.reset()}return this.updateVerticesData(c.e.PositionKind,d),O&&this.updateVerticesData(c.e.NormalKind,p),this}static MinMax(V){let O=null,Z=null;return V.forEach((function(V){const d=V.getBoundingInfo().boundingBox;O&&Z?(O.minimizeInPlace(d.minimumWorld),Z.maximizeInPlace(d.maximumWorld)):(O=d.minimumWorld,Z=d.maximumWorld)})),O&&Z?{min:O,max:Z}:{min:R.m.Zero(),max:R.m.Zero()}}static Center(V){const O=V instanceof Array?e.MinMax(V):V;return R.m.Center(O.min,O.max)}static MergeMeshes(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return(0,m.i)(e._MergeMeshesCoroutine(V,O,Z,d,p,r,!1))}static MergeMeshesAsync(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return(0,m.g)(e._MergeMeshesCoroutine(V,O,Z,d,p,r,!0),(0,m.c)())}static*_MergeMeshesCoroutine(V){let O,Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0;if(0===(V=V.filter(Boolean)).length)return null;if(!d){let Z=0;for(O=0;O<V.length;O++)if(Z+=V[O].getTotalVertices(),Z>=65536)return G.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}Y&&(r=!1);const a=new Array,R=new Array,i=new Array,M=V[0].sideOrientation;for(O=0;O<V.length;O++){const Z=V[O];if(Z.isAnInstance)return G.b.Warn("Cannot merge instance meshes."),null;if(M!==Z.sideOrientation)return G.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(r&&i.push(Z.getTotalIndices()),Y)if(Z.material){const V=Z.material;if(V instanceof H.e){for(let O=0;O<V.Gf.length;O++)a.indexOf(V.Gf[O])<0&&a.push(V.Gf[O]);for(let O=0;O<Z.Ef.length;O++)R.push(a.indexOf(V.Gf[Z.Ef[O].materialIndex])),i.push(Z.Ef[O].indexCount)}else{a.indexOf(V)<0&&a.push(V);for(let O=0;O<Z.Ef.length;O++)R.push(a.indexOf(V)),i.push(Z.Ef[O].indexCount)}}else for(let V=0;V<Z.Ef.length;V++)R.push(0),i.push(Z.Ef[V].indexCount)}const c=V[0],F=V=>{const O=V.Cj(!0);return{vertexData:W.e.ExtractFromMesh(V,!1,!1),transform:O}},{vertexData:Q,transform:U}=F(c);m&&(yield);const S=new Array(V.length-1);for(let W=1;W<V.length;W++)S[W-1]=F(V[W]),m&&(yield);const z=Q._mergeCoroutine(U,S,d,m,!Z);let w=z.next();for(;!w.done;)m&&(yield),w=z.next();const t=w.value;p||(p=new e(c.name+"_merged",c.va()));const C=t._applyToCoroutine(p,void 0,m);let v=C.next();for(;!v.done;)m&&(yield),v=C.next();if(p.checkCollisions=c.checkCollisions,p.sideOrientation=c.sideOrientation,Z)for(O=0;O<V.length;O++)V[O].dispose();if(r||Y){p.releaseSubMeshes(),O=0;let V=0;for(;O<i.length;)b.c.CreateFromIndices(0,V,i[O],p,void 0,!1),V+=i[O],O++;for(const O of p.Ef)O.refreshBoundingInfo();p.Cj(!0)}if(Y){const V=new H.e(c.name+"_merged",c.va());V.Gf=a;for(let O=0;O<p.Ef.length;O++)p.Ef[O].materialIndex=R[O];p.material=V}else p.material=c.material;return p}sj(V){V._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(V)}qj(V){const O=V._indexInSourceMeshInstanceArray;if(-1!=O){if(O!==this.instances.length-1){const V=this.instances[this.instances.length-1];this.instances[O]=V,V._indexInSourceMeshInstanceArray=O}V._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===U.e.CounterClockWiseSideOrientation}_getRenderingFillMode(V){const O=this.va();return O.forcePointsCloud?U.e.PointFillMode:O.forceWireframe?U.e.WireFrameFillMode:this.overrideRenderingFillMode??V}setMaterialByID(V){return this.setMaterialById(V)}static CreateRibbon(V,O,Z,d,p,r,Y,m,a){throw new Error("Import MeshBuilder to populate this function")}static sb(V,O,Z,d,p,r){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(V,O,Z,d,p){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(V,O,Z,d,p,r){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(V,O,Z,d){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(V,O,Z,d,p,r,Y,m,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(V,O,Z,d,p,r,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(V,O,Z,d,p,r,Y,m,a,R){throw new Error("Import MeshBuilder to populate this function")}static ub(V,O,Z,d,p){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(V,O,Z,d,p,r,Y,m){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(V,O,Z,d,p,r,Y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(V,O,Z,d,p,r,Y,m){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(V,O,Z,d,p,r,Y,m,a,R){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(V,O,Z,d,p,r,Y,m,a,R,i,M){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(V,O,Z,d,p,r,Y){throw new Error("Import MeshBuilder to populate this function")}static Jf(V,O,Z,d,p){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(V,O,Z,d,p,r){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(V,O,Z,d,p,r,Y,m,a){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(V,O,Z,d,p,r,Y,m,a,R,i){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(V,O,Z,d,p,r,Y,m,a,R){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(V,O,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(V,O,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(V,O,Z,d,p,r){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(V,O,Z){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(V){throw new Error("Import MeshBuilder to populate this function")}}e.FRONTSIDE=W.e.FRONTSIDE,e.BACKSIDE=W.e.BACKSIDE,e.DOUBLESIDE=W.e.DOUBLESIDE,e.DEFAULTSIDE=W.e.DEFAULTSIDE,e.NO_CAP=0,e.CAP_START=1,e.CAP_END=2,e.CAP_ALL=3,e.NO_FLIP=0,e.FLIP_TILE=1,e.ROTATE_TILE=2,e.FLIP_ROW=3,e.ROTATE_ROW=4,e.FLIP_N_ROTATE_TILE=5,e.FLIP_N_ROTATE_ROW=6,e.CENTER=0,e.LEFT=1,e.RIGHT=2,e.TOP=3,e.BOTTOM=4,e.INSTANCEDMESH_SORT_TRANSPARENT=!1,e._GroundMeshParser=(V,O)=>{throw(0,t.c)("GroundMesh")},e._GoldbergMeshParser=(V,O)=>{throw(0,t.c)("GoldbergMesh")},e._LinesMeshParser=(V,O)=>{throw(0,t.c)("LinesMesh")},e._GreasedLineMeshParser=(V,O)=>{throw(0,t.c)("GreasedLineMesh")},e._GreasedLineRibbonMeshParser=(V,O)=>{throw(0,t.c)("GreasedLineRibbonMesh")},e._TrailMeshParser=(V,O)=>{throw(0,t.c)("TrailMesh")},(0,w.f)("BABYLON.Mesh",e)},11530:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>F});var d=Z(11210),p=Z(11251),r=Z(11316),Y=Z(10928),m=Z(11274),a=Z(10914),R=Z(11216),i=Z(11517),M=Z(10951),c=Z(11413);class W{}class F{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,i.e)(this._applyToCoroutine.bind(this)),this.uniqueId=F._UniqueIDGenerator,F._UniqueIDGenerator++}set(V,O){switch(V.length||a.b.Warn(`Setting vertex data kind '${O}' with an empty array`),O){case r.e.PositionKind:this.xa=V;break;case r.e.NormalKind:this.ya=V;break;case r.e.TangentKind:this.tangents=V;break;case r.e.UVKind:this.Aa=V;break;case r.e.UV2Kind:this.uvs2=V;break;case r.e.UV3Kind:this.uvs3=V;break;case r.e.UV4Kind:this.uvs4=V;break;case r.e.UV5Kind:this.uvs5=V;break;case r.e.UV6Kind:this.uvs6=V;break;case r.e.ColorKind:this.za=V;break;case r.e.MatricesIndicesKind:this.matricesIndices=V;break;case r.e.MatricesWeightsKind:this.matricesWeights=V;break;case r.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=V;break;case r.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=V}}Ca(V,O){return this._applyTo(V,O,!1),this}applyToGeometry(V,O){return this._applyTo(V,O,!1),this}updateMesh(V){return this._update(V),this}updateGeometry(V){return this._update(V),this}*_applyToCoroutine(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;if(this.xa&&(V.Ga(r.e.PositionKind,this.xa,O),Z&&(yield)),this.ya&&(V.Ga(r.e.NormalKind,this.ya,O),Z&&(yield)),this.tangents&&(V.Ga(r.e.TangentKind,this.tangents,O),Z&&(yield)),this.Aa&&(V.Ga(r.e.UVKind,this.Aa,O),Z&&(yield)),this.uvs2&&(V.Ga(r.e.UV2Kind,this.uvs2,O),Z&&(yield)),this.uvs3&&(V.Ga(r.e.UV3Kind,this.uvs3,O),Z&&(yield)),this.uvs4&&(V.Ga(r.e.UV4Kind,this.uvs4,O),Z&&(yield)),this.uvs5&&(V.Ga(r.e.UV5Kind,this.uvs5,O),Z&&(yield)),this.uvs6&&(V.Ga(r.e.UV6Kind,this.uvs6,O),Z&&(yield)),this.za&&(V.Ga(r.e.ColorKind,this.za,O),this.hasVertexAlpha&&void 0!==V.hasVertexAlpha&&(V.hasVertexAlpha=!0),Z&&(yield)),this.matricesIndices&&(V.Ga(r.e.MatricesIndicesKind,this.matricesIndices,O),Z&&(yield)),this.matricesWeights&&(V.Ga(r.e.MatricesWeightsKind,this.matricesWeights,O),Z&&(yield)),this.matricesIndicesExtra&&(V.Ga(r.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,O),Z&&(yield)),this.matricesWeightsExtra&&(V.Ga(r.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,O),Z&&(yield)),this.indices?(V.setIndices(this.indices,null,O),Z&&(yield)):V.setIndices([],null),V.Ef&&this.materialInfos&&this.materialInfos.length>1){const O=V;O.Ef=[];for(const V of this.materialInfos)new c.c(V.materialIndex,V.verticesStart,V.verticesCount,V.indexStart,V.indexCount,O)}return this}_update(V,O,Z){return this.xa&&V.updateVerticesData(r.e.PositionKind,this.xa,O,Z),this.ya&&V.updateVerticesData(r.e.NormalKind,this.ya,O,Z),this.tangents&&V.updateVerticesData(r.e.TangentKind,this.tangents,O,Z),this.Aa&&V.updateVerticesData(r.e.UVKind,this.Aa,O,Z),this.uvs2&&V.updateVerticesData(r.e.UV2Kind,this.uvs2,O,Z),this.uvs3&&V.updateVerticesData(r.e.UV3Kind,this.uvs3,O,Z),this.uvs4&&V.updateVerticesData(r.e.UV4Kind,this.uvs4,O,Z),this.uvs5&&V.updateVerticesData(r.e.UV5Kind,this.uvs5,O,Z),this.uvs6&&V.updateVerticesData(r.e.UV6Kind,this.uvs6,O,Z),this.za&&V.updateVerticesData(r.e.ColorKind,this.za,O,Z),this.matricesIndices&&V.updateVerticesData(r.e.MatricesIndicesKind,this.matricesIndices,O,Z),this.matricesWeights&&V.updateVerticesData(r.e.MatricesWeightsKind,this.matricesWeights,O,Z),this.matricesIndicesExtra&&V.updateVerticesData(r.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,O,Z),this.matricesWeightsExtra&&V.updateVerticesData(r.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,O,Z),this.indices&&V.setIndices(this.indices,null),this}static _TransformVector3Coordinates(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const r=p.i.ib[0],Y=p.i.ib[1];for(let m=Z;m<Z+d;m+=3)p.m.FromArrayToRef(V,m,r),p.m.TransformCoordinatesToRef(r,O,Y),V[m]=Y.x,V[m+1]=Y.y,V[m+2]=Y.z}static _TransformVector3Normals(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const r=p.i.ib[0],Y=p.i.ib[1];for(let m=Z;m<Z+d;m+=3)p.m.FromArrayToRef(V,m,r),p.m.TransformNormalToRef(r,O,Y),V[m]=Y.x,V[m+1]=Y.y,V[m+2]=Y.z}static _TransformVector4Normals(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const r=p.i.Vector4[0],Y=p.i.Vector4[1];for(let m=Z;m<Z+d;m+=4)p.p.FromArrayToRef(V,m,r),p.p.TransformNormalToRef(r,O,Y),V[m]=Y.x,V[m+1]=Y.y,V[m+2]=Y.z,V[m+3]=Y.w}static _FlipFaces(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.length;for(let d=O;d<O+Z;d+=3){const O=V[d+1];V[d+1]=V[d+2],V[d+2]=O}}transform(V){const O=V.determinant()<0;return this.xa&&F._TransformVector3Coordinates(this.xa,V),this.ya&&F._TransformVector3Normals(this.ya,V),this.tangents&&F._TransformVector4Normals(this.tangents,V),O&&this.indices&&F._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const V=[];for(const O of this.materialInfos){const Z=new F;if(this.xa&&(Z.xa=this.xa.slice(3*O.verticesStart,3*(O.verticesCount+O.verticesStart))),this.ya&&(Z.ya=this.ya.slice(3*O.verticesStart,3*(O.verticesCount+O.verticesStart))),this.tangents&&(Z.tangents=this.tangents.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.za&&(Z.za=this.za.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.Aa&&(Z.Aa=this.Aa.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.uvs2&&(Z.uvs2=this.uvs2.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.uvs3&&(Z.uvs3=this.uvs3.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.uvs4&&(Z.uvs4=this.uvs4.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.uvs5&&(Z.uvs5=this.uvs5.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.uvs6&&(Z.uvs6=this.uvs6.slice(2*O.verticesStart,2*(O.verticesCount+O.verticesStart))),this.matricesIndices&&(Z.matricesIndices=this.matricesIndices.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.matricesIndicesExtra&&(Z.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.matricesWeights&&(Z.matricesWeights=this.matricesWeights.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.matricesWeightsExtra&&(Z.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*O.verticesStart,4*(O.verticesCount+O.verticesStart))),this.indices){Z.indices=[];for(let V=O.indexStart;V<O.indexStart+O.indexCount;V++)Z.indices.push(this.indices[V]-O.verticesStart)}const d=new W;d.indexStart=0,d.indexCount=Z.indices?Z.indices.length:0,d.materialIndex=O.materialIndex,d.verticesStart=0,d.verticesCount=(Z.xa?Z.xa.length:0)/3,Z.materialInfos=[d],V.push(Z)}return V}merge(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=Array.isArray(V)?V.map((V=>({vertexData:V}))):[{vertexData:V}];return(0,i.i)(this._mergeCoroutine(void 0,r,O,!1,Z,d,p))}*_mergeCoroutine(V,O){var Z,d;let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],R=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let i=O.map((V=>V.vertexData)),M=this;if(R)for(const r of i)r&&(r._validate(),!this.ya&&r.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&r.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&r.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&r.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&r.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&r.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&r.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&r.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&r.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&r.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&r.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&r.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&r.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const r of i)if(r)if(R)this.ya&&!r.ya&&(r.ya=new Float32Array(r.xa.length)),this.tangents&&!r.tangents&&(r.tangents=new Float32Array(r.xa.length/3*4)),this.Aa&&!r.Aa&&(r.Aa=new Float32Array(r.xa.length/3*2)),this.uvs2&&!r.uvs2&&(r.uvs2=new Float32Array(r.xa.length/3*2)),this.uvs3&&!r.uvs3&&(r.uvs3=new Float32Array(r.xa.length/3*2)),this.uvs4&&!r.uvs4&&(r.uvs4=new Float32Array(r.xa.length/3*2)),this.uvs5&&!r.uvs5&&(r.uvs5=new Float32Array(r.xa.length/3*2)),this.uvs6&&!r.uvs6&&(r.uvs6=new Float32Array(r.xa.length/3*2)),this.za&&!r.za&&(r.za=new Float32Array(r.xa.length/3*4),r.za.fill(1)),this.matricesIndices&&!r.matricesIndices&&(r.matricesIndices=new Float32Array(r.xa.length/3*4)),this.matricesWeights&&!r.matricesWeights&&(r.matricesWeights=new Float32Array(r.xa.length/3*4)),this.matricesIndicesExtra&&!r.matricesIndicesExtra&&(r.matricesIndicesExtra=new Float32Array(r.xa.length/3*4)),this.matricesWeightsExtra&&!r.matricesWeightsExtra&&(r.matricesWeightsExtra=new Float32Array(r.xa.length/3*4));else if(r._validate(),!this.ya!==!r.ya||!this.tangents!==!r.tangents||!this.Aa!==!r.Aa||!this.uvs2!==!r.uvs2||!this.uvs3!==!r.uvs3||!this.uvs4!==!r.uvs4||!this.uvs5!==!r.uvs5||!this.uvs6!==!r.uvs6||!this.za!==!r.za||!this.matricesIndices!==!r.matricesIndices||!this.matricesWeights!==!r.matricesWeights||!this.matricesIndicesExtra!==!r.matricesIndicesExtra||!this.matricesWeightsExtra!==!r.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(a){let Z=0,d=0,p=0;const r=[];let Y=null;const m=[];for(const O of this.splitBasedOnMaterialID())m.push({vertexData:O,transform:V});for(const V of O)if(V.vertexData)for(const O of V.vertexData.splitBasedOnMaterialID())m.push({vertexData:O,transform:V.transform});m.sort(((V,O)=>{const Z=V.vertexData.materialInfos?V.vertexData.materialInfos[0].materialIndex:0,d=O.vertexData.materialInfos?O.vertexData.materialInfos[0].materialIndex:0;return Z>d?1:Z===d?0:-1}));for(const V of m){const O=V.vertexData;if(Z=O.materialInfos?O.materialInfos[0].materialIndex:0,Y&&Y.materialIndex===Z)Y.indexCount+=O.indices.length,Y.verticesCount+=O.xa.length/3;else{const V=new W;V.materialIndex=Z,V.indexStart=d,V.indexCount=O.indices.length,V.verticesStart=p,V.verticesCount=O.xa.length/3,r.push(V),Y=V}d+=O.indices.length,p+=O.xa.length/3}const a=m.splice(0,1)[0];M=a.vertexData,V=a.transform,i=m.map((V=>V.vertexData)),O=m,this.materialInfos=r}const c=i.reduce(((V,O)=>{var Z;return V+((null===(Z=O.indices)||void 0===Z?void 0:Z.length)??0)}),(null===(Z=M.indices)||void 0===Z?void 0:Z.length)??0);let Q=m||i.some((V=>V.indices===M.indices))?null===(d=M.indices)||void 0===d?void 0:d.slice():M.indices;if(c>0){var b;let Z=(null===(b=Q)||void 0===b?void 0:b.length)??0;if(Q||(Q=new Array(c)),Q.length!==c){if(Array.isArray(Q))Q.length=c;else{const V=p||Q instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);V.set(Q),Q=V}V&&V.determinant()<0&&F._FlipFaces(Q,0,Z)}let d=M.xa?M.xa.length/3:0;for(const{vertexData:V,transform:p}of O)if(V.indices){for(let O=0;O<V.indices.length;O++)Q[Z+O]=V.indices[O]+d;p&&p.determinant()<0&&F._FlipFaces(Q,Z,V.indices.length),d+=V.xa.length/3,Z+=V.indices.length,Y&&(yield)}}return this.indices=Q,this.xa=F._MergeElement(r.e.PositionKind,M.xa,V,O.map((V=>[V.vertexData.xa,V.transform]))),Y&&(yield),M.ya&&(this.ya=F._MergeElement(r.e.NormalKind,M.ya,V,O.map((V=>[V.vertexData.ya,V.transform]))),Y&&(yield)),M.tangents&&(this.tangents=F._MergeElement(r.e.TangentKind,M.tangents,V,O.map((V=>[V.vertexData.tangents,V.transform]))),Y&&(yield)),M.Aa&&(this.Aa=F._MergeElement(r.e.UVKind,M.Aa,V,O.map((V=>[V.vertexData.Aa,V.transform]))),Y&&(yield)),M.uvs2&&(this.uvs2=F._MergeElement(r.e.UV2Kind,M.uvs2,V,O.map((V=>[V.vertexData.uvs2,V.transform]))),Y&&(yield)),M.uvs3&&(this.uvs3=F._MergeElement(r.e.UV3Kind,M.uvs3,V,O.map((V=>[V.vertexData.uvs3,V.transform]))),Y&&(yield)),M.uvs4&&(this.uvs4=F._MergeElement(r.e.UV4Kind,M.uvs4,V,O.map((V=>[V.vertexData.uvs4,V.transform]))),Y&&(yield)),M.uvs5&&(this.uvs5=F._MergeElement(r.e.UV5Kind,M.uvs5,V,O.map((V=>[V.vertexData.uvs5,V.transform]))),Y&&(yield)),M.uvs6&&(this.uvs6=F._MergeElement(r.e.UV6Kind,M.uvs6,V,O.map((V=>[V.vertexData.uvs6,V.transform]))),Y&&(yield)),M.za&&(this.za=F._MergeElement(r.e.ColorKind,M.za,V,O.map((V=>[V.vertexData.za,V.transform]))),(void 0!==M.hasVertexAlpha||O.some((V=>void 0!==V.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=M.hasVertexAlpha||O.some((V=>V.vertexData.hasVertexAlpha))),Y&&(yield)),M.matricesIndices&&(this.matricesIndices=F._MergeElement(r.e.MatricesIndicesKind,M.matricesIndices,V,O.map((V=>[V.vertexData.matricesIndices,V.transform]))),Y&&(yield)),M.matricesWeights&&(this.matricesWeights=F._MergeElement(r.e.MatricesWeightsKind,M.matricesWeights,V,O.map((V=>[V.vertexData.matricesWeights,V.transform]))),Y&&(yield)),M.matricesIndicesExtra&&(this.matricesIndicesExtra=F._MergeElement(r.e.MatricesIndicesExtraKind,M.matricesIndicesExtra,V,O.map((V=>[V.vertexData.matricesIndicesExtra,V.transform]))),Y&&(yield)),M.matricesWeightsExtra&&(this.matricesWeightsExtra=F._MergeElement(r.e.MatricesWeightsExtraKind,M.matricesWeightsExtra,V,O.map((V=>[V.vertexData.matricesWeightsExtra,V.transform])))),this}static _MergeElement(V,O,Z,d){const p=d.filter((V=>null!==V[0]&&void 0!==V[0]));if(!O&&0==p.length)return O;if(!O)return this._MergeElement(V,p[0][0],p[0][1],p.slice(1));const Y=p.reduce(((V,O)=>V+O[0].length),O.length),m=V===r.e.PositionKind?F._TransformVector3Coordinates:V===r.e.NormalKind?F._TransformVector3Normals:V===r.e.TangentKind?F._TransformVector4Normals:()=>{};if(O instanceof Float32Array){const V=new Float32Array(Y);V.set(O),Z&&m(V,Z,0,O.length);let d=O.length;for(const[O,Z]of p)V.set(O,d),Z&&m(V,Z,d,O.length),d+=O.length;return V}{const V=new Array(Y);for(let Z=0;Z<O.length;Z++)V[Z]=O[Z];Z&&m(V,Z,0,O.length);let d=O.length;for(const[O,Z]of p){for(let Z=0;Z<O.length;Z++)V[d+Z]=O[Z];Z&&m(V,Z,d,O.length),d+=O.length}return V}}_validate(){if(!this.xa)throw new M.e("Positions are required",M.d.MeshInvalidPositionsError);const V=(V,O)=>{const Z=r.e.DeduceStride(V);if(O.length%Z!==0)throw new Error("The "+V+"s array count must be a multiple of "+Z);return O.length/Z},O=V(r.e.PositionKind,this.xa),Z=(Z,d)=>{const p=V(Z,d);if(p!==O)throw new Error("The "+Z+"s element count ("+p+") does not match the positions count ("+O+")")};this.ya&&Z(r.e.NormalKind,this.ya),this.tangents&&Z(r.e.TangentKind,this.tangents),this.Aa&&Z(r.e.UVKind,this.Aa),this.uvs2&&Z(r.e.UV2Kind,this.uvs2),this.uvs3&&Z(r.e.UV3Kind,this.uvs3),this.uvs4&&Z(r.e.UV4Kind,this.uvs4),this.uvs5&&Z(r.e.UV5Kind,this.uvs5),this.uvs6&&Z(r.e.UV6Kind,this.uvs6),this.za&&Z(r.e.ColorKind,this.za),this.matricesIndices&&Z(r.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&Z(r.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&Z(r.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&Z(r.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const V=this.serialize();return F.Parse(V)}serialize(){const V={};if(this.xa&&(V.xa=Array.from(this.xa)),this.ya&&(V.ya=Array.from(this.ya)),this.tangents&&(V.tangents=Array.from(this.tangents)),this.Aa&&(V.Aa=Array.from(this.Aa)),this.uvs2&&(V.uvs2=Array.from(this.uvs2)),this.uvs3&&(V.uvs3=Array.from(this.uvs3)),this.uvs4&&(V.uvs4=Array.from(this.uvs4)),this.uvs5&&(V.uvs5=Array.from(this.uvs5)),this.uvs6&&(V.uvs6=Array.from(this.uvs6)),this.za&&(V.za=Array.from(this.za),V.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(V.matricesIndices=Array.from(this.matricesIndices),V.matricesIndices._isExpanded=!0),this.matricesWeights&&(V.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(V.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),V.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(V.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),V.indices=Array.from(this.indices),this.materialInfos){V.materialInfos=[];for(const O of this.materialInfos){const Z={indexStart:O.indexStart,indexCount:O.indexCount,materialIndex:O.materialIndex,verticesStart:O.verticesStart,verticesCount:O.verticesCount};V.materialInfos.push(Z)}}return V}static ExtractFromMesh(V,O,Z){return F._ExtractFrom(V,O,Z)}static ExtractFromGeometry(V,O,Z){return F._ExtractFrom(V,O,Z)}static _ExtractFrom(V,O,Z){const d=new F;if(V.isVerticesDataPresent(r.e.PositionKind)&&(d.xa=V.getVerticesData(r.e.PositionKind,O,Z)),V.isVerticesDataPresent(r.e.NormalKind)&&(d.ya=V.getVerticesData(r.e.NormalKind,O,Z)),V.isVerticesDataPresent(r.e.TangentKind)&&(d.tangents=V.getVerticesData(r.e.TangentKind,O,Z)),V.isVerticesDataPresent(r.e.UVKind)&&(d.Aa=V.getVerticesData(r.e.UVKind,O,Z)),V.isVerticesDataPresent(r.e.UV2Kind)&&(d.uvs2=V.getVerticesData(r.e.UV2Kind,O,Z)),V.isVerticesDataPresent(r.e.UV3Kind)&&(d.uvs3=V.getVerticesData(r.e.UV3Kind,O,Z)),V.isVerticesDataPresent(r.e.UV4Kind)&&(d.uvs4=V.getVerticesData(r.e.UV4Kind,O,Z)),V.isVerticesDataPresent(r.e.UV5Kind)&&(d.uvs5=V.getVerticesData(r.e.UV5Kind,O,Z)),V.isVerticesDataPresent(r.e.UV6Kind)&&(d.uvs6=V.getVerticesData(r.e.UV6Kind,O,Z)),V.isVerticesDataPresent(r.e.ColorKind)){const p=V.oj||V,Y=p.getVertexBuffer(r.e.ColorKind),m=p.getVerticesData(r.e.ColorKind,O,Z);if(3===Y.getSize()){const V=new Float32Array(4*m.length/3);for(let O=0,Z=0;O<m.length;O+=3,Z+=4)V[Z]=m[O],V[Z+1]=m[O+1],V[Z+2]=m[O+2],V[Z+3]=1;d.za=V}else{if(4!==Y.getSize())throw new Error(`Unexpected number of color components: ${Y.getSize()}`);d.za=m}}return V.isVerticesDataPresent(r.e.MatricesIndicesKind)&&(d.matricesIndices=V.getVerticesData(r.e.MatricesIndicesKind,O,Z)),V.isVerticesDataPresent(r.e.MatricesWeightsKind)&&(d.matricesWeights=V.getVerticesData(r.e.MatricesWeightsKind,O,Z)),V.isVerticesDataPresent(r.e.MatricesIndicesExtraKind)&&(d.matricesIndicesExtra=V.getVerticesData(r.e.MatricesIndicesExtraKind,O,Z)),V.isVerticesDataPresent(r.e.MatricesWeightsExtraKind)&&(d.matricesWeightsExtra=V.getVerticesData(r.e.MatricesWeightsExtraKind,O,Z)),d.indices=V.qf(O,Z),d}static CreateRibbon(V){throw(0,Y.c)("ribbonBuilder")}static CreateBox(V){throw(0,Y.c)("boxBuilder")}static CreateTiledBox(V){throw(0,Y.c)("tiledBoxBuilder")}static CreateTiledPlane(V){throw(0,Y.c)("tiledPlaneBuilder")}static CreateSphere(V){throw(0,Y.c)("sphereBuilder")}static CreateCylinder(V){throw(0,Y.c)("cylinderBuilder")}static CreateTorus(V){throw(0,Y.c)("torusBuilder")}static CreateLineSystem(V){throw(0,Y.c)("linesBuilder")}static CreateDashedLines(V){throw(0,Y.c)("linesBuilder")}static CreateGround(V){throw(0,Y.c)("groundBuilder")}static CreateTiledGround(V){throw(0,Y.c)("groundBuilder")}static CreateGroundFromHeightMap(V){throw(0,Y.c)("groundBuilder")}static Jf(V){throw(0,Y.c)("planeBuilder")}static sb(V){throw(0,Y.c)("discBuilder")}static CreatePolygon(V,O,Z,d,p,r,m){throw(0,Y.c)("polygonBuilder")}static CreateIcoSphere(V){throw(0,Y.c)("icoSphereBuilder")}static CreatePolyhedron(V){throw(0,Y.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||p.m.Up();throw(0,Y.c)("capsuleBuilder")}static CreateTorusKnot(V){throw(0,Y.c)("torusKnotBuilder")}static ComputeNormals(V,O,Z,d){let r=0,Y=0,m=0,a=0,R=0,i=0,M=0,c=0,W=0,F=0,Q=0,b=0,U=0,H=0,S=0,z=0,G=0,w=0,t=0,C=0,v=!1,A=!1,l=!1,I=!1,g=1,n=0,e=null;d&&(v=!!d.facetNormals,A=!!d.facetPositions,l=!!d.facetPartitioning,g=!0===d.useRightHandedSystem?-1:1,n=d.ratio||0,I=!!d.depthSort,e=d.distanceTo,I&&void 0===e&&(e=p.m.Zero()));let u=0,k=0,D=0,X=0;for(l&&d&&d.bbSize&&(u=d.subDiv.X*n/d.bbSize.x,k=d.subDiv.Y*n/d.bbSize.y,D=d.subDiv.Z*n/d.bbSize.z,X=d.subDiv.max*d.subDiv.max,d.facetPartitioning.length=0),r=0;r<V.length;r++)Z[r]=0;const o=O.length/3|0;for(r=0;r<o;r++){if(b=3*O[3*r],U=b+1,H=b+2,S=3*O[3*r+1],z=S+1,G=S+2,w=3*O[3*r+2],t=w+1,C=w+2,Y=V[b]-V[S],m=V[U]-V[z],a=V[H]-V[G],R=V[w]-V[S],i=V[t]-V[z],M=V[C]-V[G],c=g*(m*M-a*i),W=g*(a*R-Y*M),F=g*(Y*i-m*R),Q=Math.sqrt(c*c+W*W+F*F),Q=0===Q?1:Q,c/=Q,W/=Q,F/=Q,v&&d&&(d.facetNormals[r].x=c,d.facetNormals[r].y=W,d.facetNormals[r].z=F),A&&d&&(d.facetPositions[r].x=(V[b]+V[S]+V[w])/3,d.facetPositions[r].y=(V[U]+V[z]+V[t])/3,d.facetPositions[r].z=(V[H]+V[G]+V[C])/3),l&&d){const O=Math.floor((d.facetPositions[r].x-d.bInfo.minimum.x*n)*u),Z=Math.floor((d.facetPositions[r].y-d.bInfo.minimum.y*n)*k),p=Math.floor((d.facetPositions[r].z-d.bInfo.minimum.z*n)*D),Y=Math.floor((V[b]-d.bInfo.minimum.x*n)*u),m=Math.floor((V[U]-d.bInfo.minimum.y*n)*k),a=Math.floor((V[H]-d.bInfo.minimum.z*n)*D),R=Math.floor((V[S]-d.bInfo.minimum.x*n)*u),i=Math.floor((V[z]-d.bInfo.minimum.y*n)*k),M=Math.floor((V[G]-d.bInfo.minimum.z*n)*D),c=Math.floor((V[w]-d.bInfo.minimum.x*n)*u),W=Math.floor((V[t]-d.bInfo.minimum.y*n)*k),F=Math.floor((V[C]-d.bInfo.minimum.z*n)*D),Q=Y+d.subDiv.max*m+X*a,v=R+d.subDiv.max*i+X*M,A=c+d.subDiv.max*W+X*F,l=O+d.subDiv.max*Z+X*p;d.facetPartitioning[l]=d.facetPartitioning[l]?d.facetPartitioning[l]:new Array,d.facetPartitioning[Q]=d.facetPartitioning[Q]?d.facetPartitioning[Q]:new Array,d.facetPartitioning[v]=d.facetPartitioning[v]?d.facetPartitioning[v]:new Array,d.facetPartitioning[A]=d.facetPartitioning[A]?d.facetPartitioning[A]:new Array,d.facetPartitioning[Q].push(r),v!=Q&&d.facetPartitioning[v].push(r),A!=v&&A!=Q&&d.facetPartitioning[A].push(r),l!=Q&&l!=v&&l!=A&&d.facetPartitioning[l].push(r)}if(I&&d&&d.facetPositions){const V=d.depthSortedFacets[r];V.ind=3*r,V.sqDistance=p.m.DistanceSquared(d.facetPositions[r],e)}Z[b]+=c,Z[U]+=W,Z[H]+=F,Z[S]+=c,Z[z]+=W,Z[G]+=F,Z[w]+=c,Z[t]+=W,Z[C]+=F}for(r=0;r<Z.length/3;r++)c=Z[3*r],W=Z[3*r+1],F=Z[3*r+2],Q=Math.sqrt(c*c+W*W+F*F),Q=0===Q?1:Q,c/=Q,W/=Q,F/=Q,Z[3*r]=c,Z[3*r+1]=W,Z[3*r+2]=F}static _ComputeSides(V,O,Z,d,r,Y,m){const a=Z.length,R=d.length;let i,M;switch(V=V||F.DEFAULTSIDE){case F.FRONTSIDE:break;case F.BACKSIDE:for(i=0;i<a;i+=3){const V=Z[i];Z[i]=Z[i+2],Z[i+2]=V}for(M=0;M<R;M++)d[M]=-d[M];break;case F.DOUBLESIDE:{const V=O.length,c=V/3;for(let Z=0;Z<V;Z++)O[V+Z]=O[Z];for(i=0;i<a;i+=3)Z[i+a]=Z[i+2]+c,Z[i+1+a]=Z[i+1]+c,Z[i+2+a]=Z[i]+c;for(M=0;M<R;M++)d[R+M]=-d[M];const W=r.length;let F=0;for(F=0;F<W;F++)r[F+W]=r[F];for(Y=Y||new p.p(0,0,1,1),m=m||new p.p(0,0,1,1),F=0,i=0;i<W/2;i++)r[F]=Y.x+(Y.z-Y.x)*r[F],r[F+1]=Y.y+(Y.w-Y.y)*r[F+1],r[F+W]=m.x+(m.z-m.x)*r[F+W],r[F+W+1]=m.y+(m.w-m.y)*r[F+W+1],F+=2;break}}}static Parse(V){const O=new F,Z=V.xa;Z&&O.set(Z,r.e.PositionKind);const d=V.ya;d&&O.set(d,r.e.NormalKind);const p=V.tangents;p&&O.set(p,r.e.TangentKind);const Y=V.Aa;Y&&O.set(Y,r.e.UVKind);const a=V.uvs2;a&&O.set(a,r.e.UV2Kind);const R=V.uvs3;R&&O.set(R,r.e.UV3Kind);const i=V.uvs4;i&&O.set(i,r.e.UV4Kind);const M=V.uvs5;M&&O.set(M,r.e.UV5Kind);const c=V.uvs6;c&&O.set(c,r.e.UV6Kind);const Q=V.za;Q&&(O.set(m.f.CheckColors4(Q,Z.length/3),r.e.ColorKind),void 0!==V.hasVertexAlpha&&(O.hasVertexAlpha=V.hasVertexAlpha));const b=V.matricesIndices;b&&O.set(b,r.e.MatricesIndicesKind);const U=V.matricesWeights;U&&O.set(U,r.e.MatricesWeightsKind);const H=V.indices;H&&(O.indices=H);const S=V.materialInfos;if(S){O.materialInfos=[];for(const V of S){const Z=new W;Z.indexCount=V.indexCount,Z.indexStart=V.indexStart,Z.verticesCount=V.verticesCount,Z.verticesStart=V.verticesStart,Z.materialIndex=V.materialIndex,O.materialInfos.push(Z)}}return O}static ImportVertexData(V,O){const Z=F.Parse(V);O.setAllVerticesData(Z,V.updatable)}}F.FRONTSIDE=0,F.BACKSIDE=1,F.DOUBLESIDE=2,F.DEFAULTSIDE=0,F._UniqueIDGenerator=0,(0,d.c)([R.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d]=O;return!Array.isArray(d)}))],F,"_TransformVector3Coordinates",null),(0,d.c)([R.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d]=O;return!Array.isArray(d)}))],F,"_TransformVector3Normals",null),(0,d.c)([R.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d]=O;return!Array.isArray(d)}))],F,"_TransformVector4Normals",null),(0,d.c)([R.e.filter((function(){for(var V=arguments.length,O=new Array(V),Z=0;Z<V;Z++)O[Z]=arguments[Z];let[d]=O;return!Array.isArray(d)}))],F,"_FlipFaces",null)},12590:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>QV});var d=Z(11251),p=Z(11508),r=Z(11316),Y=Z(11530),m=Z(11476);function a(V){let O=V.pathArray;const Z=V.closeArray||!1,d=V.closePath||!1,p=V.invertUV||!1,a=Math.floor(O[0].length/2);let R=V.offset||a;R=R>a?a:Math.floor(R);const i=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,M=V.Aa,c=V.za,W=[],F=[],Q=[],b=[],U=[],H=[],S=[],z=[];let G;const w=[],t=[];let C,v,A;if(O.length<2){const V=[],Z=[];for(v=0;v<O[0].length-R;v++)V.push(O[0][v]),Z.push(O[0][v+R]);O=[V,Z]}let l=0;const I=d?1:0,g=Z?1:0;let n,e,u,k,D,X;for(G=O[0].length,C=0;C<O.length+g;C++){for(S[C]=0,U[C]=[0],n=C===O.length?O[0]:O[C],e=n.length,G=G<e?G:e,A=0;A<e;)W.push(n[A].x,n[A].y,n[A].z),A>0&&(u=n[A].fc(n[A-1]).length(),k=u+S[C],U[C].push(k),S[C]=k),A++;d&&(A--,W.push(n[0].x,n[0].y,n[0].z),u=n[A].fc(n[0]).length(),k=u+S[C],U[C].push(k),S[C]=k),w[C]=e+I,t[C]=l,l+=e+I}let o,E,L=null,J=null;for(v=0;v<G+I;v++)for(z[v]=0,H[v]=[0],C=0;C<O.length-1+g;C++)D=O[C],X=C===O.length-1?O[0]:O[C+1],v===G?(L=D[0],J=X[0]):(L=D[v],J=X[v]),u=J.fc(L).length(),k=u+z[v],H[v].push(k),z[v]=k;if(M)for(C=0;C<M.length;C++)b.push(M[C].x,m.c?1-M[C].y:M[C].y);else for(C=0;C<O.length+g;C++)for(v=0;v<G+I;v++)o=0!=S[C]?U[C][v]/S[C]:0,E=0!=z[v]?H[v][C]/z[v]:0,p?b.push(E,o):b.push(o,m.c?1-E:E);C=0;let N=0,P=w[C]-1,f=w[C+1]-1,q=P<f?P:f,K=t[1]-t[0];const s=w.length-1;for(;N<=q&&C<s;)F.push(N,N+K,N+1),F.push(N+K+1,N+1,N+K),N+=1,N===q&&(C++,K=t[C+1]-t[C],P=w[C]-1,f=w[C+1]-1,N=t[C],q=P<f?P+N:f+N);if(Y.e.ComputeNormals(W,F,Q),d){let V=0,Z=0;for(C=0;C<O.length;C++){V=3*t[C],Z=C+1<O.length?3*(t[C+1]-1):Q.length-3,Q[V]=.5*(Q[V]+Q[Z]),Q[V+1]=.5*(Q[V+1]+Q[Z+1]),Q[V+2]=.5*(Q[V+2]+Q[Z+2]);const d=Math.sqrt(Q[V]*Q[V]+Q[V+1]*Q[V+1]+Q[V+2]*Q[V+2]);Q[V]/=d,Q[V+1]/=d,Q[V+2]/=d,Q[Z]=Q[V],Q[Z+1]=Q[V+1],Q[Z+2]=Q[V+2]}}if(Z){let V=3*t[0],Z=3*t[O.length];for(v=0;v<G+I;v++){Q[V]=.5*(Q[V]+Q[Z]),Q[V+1]=.5*(Q[V+1]+Q[Z+1]),Q[V+2]=.5*(Q[V+2]+Q[Z+2]);const O=Math.sqrt(Q[V]*Q[V]+Q[V+1]*Q[V+1]+Q[V+2]*Q[V+2]);Q[V]/=O,Q[V+1]/=O,Q[V+2]/=O,Q[Z]=Q[V],Q[Z+1]=Q[V+1],Q[Z+2]=Q[V+2],V+=3,Z+=3}}Y.e._ComputeSides(i,W,F,Q,b,V.frontUVs,V.backUVs);let h=null;if(c){h=new Float32Array(4*c.length);for(let V=0;V<c.length;V++)h[4*V]=c[V].r,h[4*V+1]=c[V].g,h[4*V+2]=c[V].b,h[4*V+3]=c[V].a}const x=new Y.e,y=new Float32Array(W),T=new Float32Array(Q),B=new Float32Array(b);return x.indices=F,x.xa=y,x.ya=T,x.Aa=B,h&&x.set(h,r.e.ColorKind),d&&(x._idx=t),x}function R(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=O.pathArray,i=O.closeArray,M=O.closePath,c=p.c._GetDefaultSideOrientation(O.sideOrientation),W=O.instance,F=O.updatable;if(W){const V=d.i.ib[0].rj(Number.MAX_VALUE),Z=d.i.ib[1].rj(-Number.MAX_VALUE),a=O=>{let d=R[0].length;const r=W;let Y=0;const m=r._originalBuilderSideOrientation===p.c.DOUBLESIDE?2:1;for(let p=1;p<=m;++p)for(let m=0;m<R.length;++m){const p=R[m],a=p.length;d=d<a?d:a;for(let r=0;r<d;++r){const d=p[r];O[Y]=d.x,O[Y+1]=d.y,O[Y+2]=d.z,V.minimizeInPlaceFromFloats(d.x,d.y,d.z),Z.maximizeInPlaceFromFloats(d.x,d.y,d.z),Y+=3}if(r._creationDataStorage&&r._creationDataStorage.closePath){const V=p[0];O[Y]=V.x,O[Y+1]=V.y,O[Y+2]=V.z,Y+=3}}},i=W.getVerticesData(r.e.PositionKind);if(a(i),W.hasBoundingInfo?W.getBoundingInfo().reConstruct(V,Z,W._worldMatrix):W.buildBoundingInfo(V,Z,W._worldMatrix),W.updateVerticesData(r.e.PositionKind,i,!1,!1),O.za){const V=W.getVerticesData(r.e.ColorKind);for(let Z=0,d=0;Z<O.za.length;Z++,d+=4){const p=O.za[Z];V[d]=p.r,V[d+1]=p.g,V[d+2]=p.b,V[d+3]=p.a}W.updateVerticesData(r.e.ColorKind,V,!1,!1)}if(O.Aa){const V=W.getVerticesData(r.e.UVKind);for(let Z=0;Z<O.Aa.length;Z++)V[2*Z]=O.Aa[Z].x,V[2*Z+1]=m.c?1-O.Aa[Z].y:O.Aa[Z].y;W.updateVerticesData(r.e.UVKind,V,!1,!1)}if(!W.areNormalsFrozen||W.isFacetDataEnabled){const V=W.qf(),O=W.getVerticesData(r.e.NormalKind),Z=W.isFacetDataEnabled?W.getFacetDataParameters():null;if(Y.e.ComputeNormals(i,V,O,Z),W._creationDataStorage&&W._creationDataStorage.closePath){let V=0,Z=0;for(let d=0;d<R.length;d++)V=3*W._creationDataStorage.idx[d],Z=d+1<R.length?3*(W._creationDataStorage.idx[d+1]-1):O.length-3,O[V]=.5*(O[V]+O[Z]),O[V+1]=.5*(O[V+1]+O[Z+1]),O[V+2]=.5*(O[V+2]+O[Z+2]),O[Z]=O[V],O[Z+1]=O[V+1],O[Z+2]=O[V+2]}W.areNormalsFrozen||W.updateVerticesData(r.e.NormalKind,O,!1,!1)}return W}{const d=new p.c(V,Z);d._originalBuilderSideOrientation=c,d._creationDataStorage=new p.f;const r=a(O);return M&&(d._creationDataStorage.idx=r._idx),d._creationDataStorage.closePath=M,d._creationDataStorage.closeArray=i,r.Ca(d,F),d}}Y.e.CreateRibbon=a,p.c.CreateRibbon=function(V,O){return R(V,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var i=Z(11855),M=Z(11570),c=Z(11274);function W(V){const O=V.pattern||p.c.NO_FLIP,Z=V.tileWidth||V.tileSize||1,d=V.tileHeight||V.tileSize||1,r=V.alignHorizontal||0,m=V.alignVertical||0,a=V.width||V.size||1,R=Math.floor(a/Z);let i=a-R*Z;const M=V.height||V.size||1,c=Math.floor(M/d);let W=M-c*d;const F=Z*R/2,Q=d*c/2;let b=0,U=0,H=0,S=0,z=0,G=0;if(i>0||W>0){switch(H=-F,S=-Q,z=F,G=Q,r){case p.c.CENTER:i/=2,H-=i,z+=i;break;case p.c.LEFT:z+=i,b=-i/2;break;case p.c.RIGHT:H-=i,b=i/2}switch(m){case p.c.CENTER:W/=2,S-=W,G+=W;break;case p.c.BOTTOM:G+=W,U=-W/2;break;case p.c.TOP:S-=W,U=W/2}}const w=[],t=[],C=[];C[0]=[0,0,1,0,1,1,0,1],C[1]=[0,0,1,0,1,1,0,1],O!==p.c.ROTATE_TILE&&O!==p.c.ROTATE_ROW||(C[1]=[1,1,0,1,0,0,1,0]),O!==p.c.FLIP_TILE&&O!==p.c.FLIP_ROW||(C[1]=[1,0,0,0,0,1,1,1]),O!==p.c.FLIP_N_ROTATE_TILE&&O!==p.c.FLIP_N_ROTATE_ROW||(C[1]=[0,1,1,1,1,0,0,0]);let v=[];const A=[],l=[];let I=0;for(let Y=0;Y<c;Y++)for(let V=0;V<R;V++)w.push(V*Z-F+b,Y*d-Q+U,0),w.push((V+1)*Z-F+b,Y*d-Q+U,0),w.push((V+1)*Z-F+b,(Y+1)*d-Q+U,0),w.push(V*Z-F+b,(Y+1)*d-Q+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),v=O===p.c.FLIP_TILE||O===p.c.ROTATE_TILE||O===p.c.FLIP_N_ROTATE_TILE?v.concat(C[(V%2+Y%2)%2]):O===p.c.FLIP_ROW||O===p.c.ROTATE_ROW||O===p.c.FLIP_N_ROTATE_ROW?v.concat(C[Y%2]):v.concat(C[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),I+=4;if(i>0||W>0){const V=W>0&&(m===p.c.CENTER||m===p.c.TOP),Y=W>0&&(m===p.c.CENTER||m===p.c.BOTTOM),a=i>0&&(r===p.c.CENTER||r===p.c.RIGHT),M=i>0&&(r===p.c.CENTER||r===p.c.LEFT);let C,g,n,e,u=[];if(V&&a&&(w.push(H+b,S+U,0),w.push(-F+b,S+U,0),w.push(-F+b,S+W+U,0),w.push(H+b,S+W+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,C=1-i/Z,g=1-W/d,n=1,e=1,u=[C,g,n,g,n,e,C,e],O===p.c.ROTATE_ROW&&(u=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),O===p.c.FLIP_ROW&&(u=[1-C,g,1-n,g,1-n,e,1-C,e]),O===p.c.FLIP_N_ROTATE_ROW&&(u=[C,1-g,n,1-g,n,1-e,C,1-e]),v=v.concat(u),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&M&&(w.push(F+b,S+U,0),w.push(z+b,S+U,0),w.push(z+b,S+W+U,0),w.push(F+b,S+W+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,C=0,g=1-W/d,n=i/Z,e=1,u=[C,g,n,g,n,e,C,e],(O===p.c.ROTATE_ROW||O===p.c.ROTATE_TILE&&R%2===0)&&(u=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),(O===p.c.FLIP_ROW||O===p.c.FLIP_TILE&&R%2===0)&&(u=[1-C,g,1-n,g,1-n,e,1-C,e]),(O===p.c.FLIP_N_ROTATE_ROW||O===p.c.FLIP_N_ROTATE_TILE&&R%2===0)&&(u=[C,1-g,n,1-g,n,1-e,C,1-e]),v=v.concat(u),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&a&&(w.push(H+b,Q+U,0),w.push(-F+b,Q+U,0),w.push(-F+b,G+U,0),w.push(H+b,G+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,C=1-i/Z,g=0,n=1,e=W/d,u=[C,g,n,g,n,e,C,e],(O===p.c.ROTATE_ROW&&c%2===1||O===p.c.ROTATE_TILE&&c%1===0)&&(u=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),(O===p.c.FLIP_ROW&&c%2===1||O===p.c.FLIP_TILE&&c%2===0)&&(u=[1-C,g,1-n,g,1-n,e,1-C,e]),(O===p.c.FLIP_N_ROTATE_ROW&&c%2===1||O===p.c.FLIP_N_ROTATE_TILE&&c%2===0)&&(u=[C,1-g,n,1-g,n,1-e,C,1-e]),v=v.concat(u),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&M&&(w.push(F+b,Q+U,0),w.push(z+b,Q+U,0),w.push(z+b,G+U,0),w.push(F+b,G+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,C=0,g=0,n=i/Z,e=W/d,u=[C,g,n,g,n,e,C,e],(O===p.c.ROTATE_ROW&&c%2===1||O===p.c.ROTATE_TILE&&(c+R)%2===1)&&(u=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),(O===p.c.FLIP_ROW&&c%2===1||O===p.c.FLIP_TILE&&(c+R)%2===1)&&(u=[1-C,g,1-n,g,1-n,e,1-C,e]),(O===p.c.FLIP_N_ROTATE_ROW&&c%2===1||O===p.c.FLIP_N_ROTATE_TILE&&(c+R)%2===1)&&(u=[C,1-g,n,1-g,n,1-e,C,1-e]),v=v.concat(u),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V){const V=[];C=0,g=1-W/d,n=1,e=1,V[0]=[C,g,n,g,n,e,C,e],V[1]=[C,g,n,g,n,e,C,e],O!==p.c.ROTATE_TILE&&O!==p.c.ROTATE_ROW||(V[1]=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),O!==p.c.FLIP_TILE&&O!==p.c.FLIP_ROW||(V[1]=[1-C,g,1-n,g,1-n,e,1-C,e]),O!==p.c.FLIP_N_ROTATE_TILE&&O!==p.c.FLIP_N_ROTATE_ROW||(V[1]=[C,1-g,n,1-g,n,1-e,C,1-e]);for(let d=0;d<R;d++)w.push(d*Z-F+b,S+U,0),w.push((d+1)*Z-F+b,S+U,0),w.push((d+1)*Z-F+b,S+W+U,0),w.push(d*Z-F+b,S+W+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,v=O===p.c.FLIP_TILE||O===p.c.ROTATE_TILE||O===p.c.FLIP_N_ROTATE_TILE?v.concat(V[(d+1)%2]):O===p.c.FLIP_ROW||O===p.c.ROTATE_ROW||O===p.c.FLIP_N_ROTATE_ROW?v.concat(V[1]):v.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const V=[];C=0,g=0,n=1,e=W/d,V[0]=[C,g,n,g,n,e,C,e],V[1]=[C,g,n,g,n,e,C,e],O!==p.c.ROTATE_TILE&&O!==p.c.ROTATE_ROW||(V[1]=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),O!==p.c.FLIP_TILE&&O!==p.c.FLIP_ROW||(V[1]=[1-C,g,1-n,g,1-n,e,1-C,e]),O!==p.c.FLIP_N_ROTATE_TILE&&O!==p.c.FLIP_N_ROTATE_ROW||(V[1]=[C,1-g,n,1-g,n,1-e,C,1-e]);for(let d=0;d<R;d++)w.push(d*Z-F+b,G-W+U,0),w.push((d+1)*Z-F+b,G-W+U,0),w.push((d+1)*Z-F+b,G+U,0),w.push(d*Z-F+b,G+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,v=O===p.c.FLIP_TILE||O===p.c.ROTATE_TILE||O===p.c.FLIP_N_ROTATE_TILE?v.concat(V[(d+c)%2]):O===p.c.FLIP_ROW||O===p.c.ROTATE_ROW||O===p.c.FLIP_N_ROTATE_ROW?v.concat(V[c%2]):v.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const V=[];C=1-i/Z,g=0,n=1,e=1,V[0]=[C,g,n,g,n,e,C,e],V[1]=[C,g,n,g,n,e,C,e],O!==p.c.ROTATE_TILE&&O!==p.c.ROTATE_ROW||(V[1]=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),O!==p.c.FLIP_TILE&&O!==p.c.FLIP_ROW||(V[1]=[1-C,g,1-n,g,1-n,e,1-C,e]),O!==p.c.FLIP_N_ROTATE_TILE&&O!==p.c.FLIP_N_ROTATE_ROW||(V[1]=[C,1-g,n,1-g,n,1-e,C,1-e]);for(let Z=0;Z<c;Z++)w.push(H+b,Z*d-Q+U,0),w.push(H+i+b,Z*d-Q+U,0),w.push(H+i+b,(Z+1)*d-Q+U,0),w.push(H+b,(Z+1)*d-Q+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,v=O===p.c.FLIP_TILE||O===p.c.ROTATE_TILE||O===p.c.FLIP_N_ROTATE_TILE?v.concat(V[(Z+1)%2]):O===p.c.FLIP_ROW||O===p.c.ROTATE_ROW||O===p.c.FLIP_N_ROTATE_ROW?v.concat(V[Z%2]):v.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const V=[];C=0,g=0,n=i/d,e=1,V[0]=[C,g,n,g,n,e,C,e],V[1]=[C,g,n,g,n,e,C,e],O!==p.c.ROTATE_TILE&&O!==p.c.ROTATE_ROW||(V[1]=[1-C,1-g,1-n,1-g,1-n,1-e,1-C,1-e]),O!==p.c.FLIP_TILE&&O!==p.c.FLIP_ROW||(V[1]=[1-C,g,1-n,g,1-n,e,1-C,e]),O!==p.c.FLIP_N_ROTATE_TILE&&O!==p.c.FLIP_N_ROTATE_ROW||(V[1]=[C,1-g,n,1-g,n,1-e,C,1-e]);for(let Z=0;Z<c;Z++)w.push(z-i+b,Z*d-Q+U,0),w.push(z+b,Z*d-Q+U,0),w.push(z+b,(Z+1)*d-Q+U,0),w.push(z-i+b,(Z+1)*d-Q+U,0),l.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,v=O===p.c.FLIP_TILE||O===p.c.ROTATE_TILE||O===p.c.FLIP_N_ROTATE_TILE?v.concat(V[(Z+R)%2]):O===p.c.FLIP_ROW||O===p.c.ROTATE_ROW||O===p.c.FLIP_N_ROTATE_ROW?v.concat(V[Z%2]):v.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),t.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const g=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE;Y.e._ComputeSides(g,w,l,t,v,V.frontUVs,V.backUVs);const n=new Y.e;n.indices=l,n.xa=w,n.ya=t,n.Aa=v;const e=g===Y.e.DOUBLESIDE?A.concat(A):A;return n.za=e,n}function F(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return W(O).Ca(d,O.updatable),d}function Q(V){const O=V.faceUV||new Array(6),Z=V.faceColors,r=V.pattern||p.c.NO_FLIP,a=V.width||V.size||1,R=V.height||V.size||1,i=V.depth||V.size||1,M=V.tileWidth||V.tileSize||1,F=V.tileHeight||V.tileSize||1,Q=V.alignHorizontal||0,b=V.alignVertical||0,U=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE;for(let p=0;p<6;p++)void 0===O[p]&&(O[p]=new d.p(0,0,1,1)),Z&&void 0===Z[p]&&(Z[p]=new c.f(1,1,1,1));const H=a/2,S=R/2,z=i/2,G=[];for(let d=0;d<2;d++)G[d]=W({pattern:r,tileWidth:M,tileHeight:F,width:a,height:R,alignVertical:b,alignHorizontal:Q,sideOrientation:U});for(let d=2;d<4;d++)G[d]=W({pattern:r,tileWidth:M,tileHeight:F,width:i,height:R,alignVertical:b,alignHorizontal:Q,sideOrientation:U});let w=b;b===p.c.BOTTOM?w=p.c.TOP:b===p.c.TOP&&(w=p.c.BOTTOM);for(let d=4;d<6;d++)G[d]=W({pattern:r,tileWidth:M,tileHeight:F,width:a,height:i,alignVertical:w,alignHorizontal:Q,sideOrientation:U});let t=[],C=[],v=[],A=[];const l=[],I=[],g=[],n=[];let e=0,u=0;for(let p=0;p<6;p++){const V=G[p].xa.length;I[p]=[],g[p]=[];for(let O=0;O<V/3;O++)I[p].push(new d.m(G[p].xa[3*O],G[p].xa[3*O+1],G[p].xa[3*O+2])),g[p].push(new d.m(G[p].ya[3*O],G[p].ya[3*O+1],G[p].ya[3*O+2]));e=G[p].Aa.length,n[p]=[];for(let Z=0;Z<e;Z+=2)n[p][Z]=O[p].x+(O[p].z-O[p].x)*G[p].Aa[Z],n[p][Z+1]=O[p].y+(O[p].w-O[p].y)*G[p].Aa[Z+1],m.c&&(n[p][Z+1]=1-n[p][Z+1]);if(v=v.concat(n[p]),A=A.concat(G[p].indices.map((V=>V+u))),u+=I[p].length,Z)for(let O=0;O<4;O++)l.push(Z[p].r,Z[p].g,Z[p].b,Z[p].a)}const k=new d.m(0,0,z),D=d.c.RotationY(Math.PI);t=I[0].map((V=>d.m.TransformNormal(V,D).add(k))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]),C=g[0].map((V=>d.m.TransformNormal(V,D))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]),t=t.concat(I[1].map((V=>V.fc(k))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),C=C.concat(g[1].map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]));const X=new d.m(H,0,0),o=d.c.RotationY(-Math.PI/2);t=t.concat(I[2].map((V=>d.m.TransformNormal(V,o).add(X))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),C=C.concat(g[2].map((V=>d.m.TransformNormal(V,o))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]));const E=d.c.RotationY(Math.PI/2);t=t.concat(I[3].map((V=>d.m.TransformNormal(V,E).fc(X))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),C=C.concat(g[3].map((V=>d.m.TransformNormal(V,E))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]));const L=new d.m(0,S,0),J=d.c.RotationX(Math.PI/2);t=t.concat(I[4].map((V=>d.m.TransformNormal(V,J).add(L))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),C=C.concat(g[4].map((V=>d.m.TransformNormal(V,J))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[]));const N=d.c.RotationX(-Math.PI/2);t=t.concat(I[5].map((V=>d.m.TransformNormal(V,N).fc(L))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),C=C.concat(g[5].map((V=>d.m.TransformNormal(V,N))).map((V=>[V.x,V.y,V.z])).reduce(((V,O)=>V.concat(O)),[])),Y.e._ComputeSides(U,t,A,C,v);const P=new Y.e;if(P.indices=A,P.xa=t,P.ya=C,P.Aa=v,Z){const V=U===Y.e.DOUBLESIDE?l.concat(l):l;P.za=V}return P}function b(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return Q(O).Ca(d,O.updatable),d}Y.e.CreateTiledPlane=W;Y.e.CreateTiledBox=Q;var U=Z(11846),H=Z(11238),S=Z(11562);function z(V){const O=V.height||2;let Z=0===V.diameterTop?0:V.diameterTop||V.diameter||1,r=0===V.diameterBottom?0:V.diameterBottom||V.diameter||1;Z=Z||1e-5,r=r||1e-5;const a=0|(V.Jk||24),R=0|(V.subdivisions||1),i=!!V.hasRings,M=!!V.enclose,W=0===V.cap?0:V.cap||p.c.CAP_ALL,F=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,Q=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,b=V.faceUV||new Array(3),U=V.faceColors,H=2+(1+(1!==F&&M?2:0))*(i?R:1);let z;for(z=0;z<H;z++)U&&void 0===U[z]&&(U[z]=new c.f(1,1,1,1));for(z=0;z<H;z++)b&&void 0===b[z]&&(b[z]=new d.p(0,0,1,1));const G=[],w=[],t=[],C=[],v=[],A=2*Math.PI*F/a;let l,I,g;const n=(r-Z)/2/O,e=d.m.Zero(),u=d.m.Zero(),k=d.m.Zero(),D=d.m.Zero(),X=d.m.Zero(),o=S.b.Y;let E,L,J,N=1,P=1,f=0,q=0;for(E=0;E<=R;E++)for(I=E/R,g=(I*(Z-r)+r)/2,N=i&&0!==E&&E!==R?2:1,J=0;J<N;J++){for(i&&(P+=J),M&&(P+=2*J),L=0;L<=a;L++)l=L*A,e.x=Math.cos(-l)*g,e.y=-O/2+I*O,e.z=Math.sin(-l)*g,0===Z&&E===R?(u.x=t[t.length-3*(a+1)],u.y=t[t.length-3*(a+1)+1],u.z=t[t.length-3*(a+1)+2]):(u.x=e.x,u.z=e.z,u.y=Math.sqrt(u.x*u.x+u.z*u.z)*n,u.normalize()),0===L&&(k.p(e),D.p(u)),w.push(e.x,e.y,e.z),t.push(u.x,u.y,u.z),q=i?f!==P?b[P].y:b[P].w:b[P].y+(b[P].w-b[P].y)*I,C.push(b[P].x+(b[P].z-b[P].x)*L/a,m.c?1-q:q),U&&v.push(U[P].r,U[P].g,U[P].b,U[P].a);1!==F&&M&&(w.push(e.x,e.y,e.z),w.push(0,e.y,0),w.push(0,e.y,0),w.push(k.x,k.y,k.z),d.m.CrossToRef(o,u,X),X.normalize(),t.push(X.x,X.y,X.z,X.x,X.y,X.z),d.m.CrossToRef(D,o,X),X.normalize(),t.push(X.x,X.y,X.z,X.x,X.y,X.z),q=i?f!==P?b[P+1].y:b[P+1].w:b[P+1].y+(b[P+1].w-b[P+1].y)*I,C.push(b[P+1].x,m.c?1-q:q),C.push(b[P+1].z,m.c?1-q:q),q=i?f!==P?b[P+2].y:b[P+2].w:b[P+2].y+(b[P+2].w-b[P+2].y)*I,C.push(b[P+2].x,m.c?1-q:q),C.push(b[P+2].z,m.c?1-q:q),U&&(v.push(U[P+1].r,U[P+1].g,U[P+1].b,U[P+1].a),v.push(U[P+1].r,U[P+1].g,U[P+1].b,U[P+1].a),v.push(U[P+2].r,U[P+2].g,U[P+2].b,U[P+2].a),v.push(U[P+2].r,U[P+2].g,U[P+2].b,U[P+2].a))),f!==P&&(f=P)}const K=1!==F&&M?a+4:a;for(E=0,P=0;P<R;P++){let V=0,O=0,Z=0,d=0;for(L=0;L<a;L++)V=E*(K+1)+L,O=(E+1)*(K+1)+L,Z=E*(K+1)+(L+1),d=(E+1)*(K+1)+(L+1),G.push(V,O,Z),G.push(d,Z,O);1!==F&&M&&(G.push(V+2,O+2,Z+2),G.push(d+2,Z+2,O+2),G.push(V+4,O+4,Z+4),G.push(d+4,Z+4,O+4)),E=i?E+2:E+1}const s=V=>{const p=V?Z/2:r/2;if(0===p)return;let Y,R,i;const M=V?b[H-1]:b[0];let c=null;U&&(c=V?U[H-1]:U[0]);const W=w.length/3,Q=V?O/2:-O/2,S=new d.m(0,Q,0);w.push(S.x,S.y,S.z),t.push(0,V?1:-1,0);const z=M.y+.5*(M.w-M.y);C.push(M.x+.5*(M.z-M.x),m.c?1-z:z),c&&v.push(c.r,c.g,c.b,c.a);const A=new d.l(.5,.5);for(i=0;i<=a;i++){Y=2*Math.PI*i*F/a;const O=Math.cos(-Y),Z=Math.sin(-Y);R=new d.m(O*p,Q,Z*p);const r=new d.l(O*A.x+.5,Z*A.y+.5);w.push(R.x,R.y,R.z),t.push(0,V?1:-1,0);const W=M.y+(M.w-M.y)*r.y;C.push(M.x+(M.z-M.x)*r.x,m.c?1-W:W),c&&v.push(c.r,c.g,c.b,c.a)}for(i=0;i<a;i++)V?(G.push(W),G.push(W+(i+2)),G.push(W+(i+1))):(G.push(W),G.push(W+(i+1)),G.push(W+(i+2)))};W!==p.c.CAP_START&&W!==p.c.CAP_ALL||s(!1),W!==p.c.CAP_END&&W!==p.c.CAP_ALL||s(!0),Y.e._ComputeSides(Q,w,G,t,C,V.frontUVs,V.backUVs);const h=new Y.e;return h.indices=G,h.xa=w,h.ya=t,h.Aa=C,U&&(h.za=v),h}function G(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return z(O).Ca(d,O.updatable),d}function w(V){const O=[],Z=[],p=[],r=[],a=V.diameter||1,R=V.thickness||.5,i=0|(V.Jk||16),M=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,c=i+1;for(let Y=0;Y<=i;Y++){const V=Y/i,M=Y*Math.PI*2/i-Math.PI/2,W=d.c.Translation(a/2,0,0).multiply(d.c.RotationY(M));for(let a=0;a<=i;a++){const M=1-a/i,F=a*Math.PI*2/i+Math.PI,Q=Math.cos(F),b=Math.sin(F);let U=new d.m(Q,b,0),H=U.scale(R/2);const S=new d.l(V,M);H=d.m.TransformCoordinates(H,W),U=d.m.TransformNormal(U,W),Z.push(H.x,H.y,H.z),p.push(U.x,U.y,U.z),r.push(S.x,m.c?1-S.y:S.y);const z=(Y+1)%c,G=(a+1)%c;O.push(Y*c+a),O.push(Y*c+G),O.push(z*c+a),O.push(Y*c+G),O.push(z*c+G),O.push(z*c+a)}}Y.e._ComputeSides(M,Z,O,p,r,V.frontUVs,V.backUVs);const W=new Y.e;return W.indices=O,W.xa=Z,W.ya=p,W.Aa=r,W}function t(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return w(O).Ca(d,O.updatable),d}Y.e.CreateCylinder=z,p.c.CreateCylinder=(V,O,Z,d,r,Y,m,a,R)=>{void 0!==m&&m instanceof H.b||(void 0!==m&&(R=a||p.c.DEFAULTSIDE,a=m),m=Y,Y=1);return G(V,{height:O,diameterTop:Z,diameterBottom:d,Jk:r,subdivisions:Y,sideOrientation:R,updatable:a},m)};function C(V){const O=[],Z=[],p=[],r=[],a=V.i||2,R=V.tube||.5,i=V.radialSegments||32,M=V.tubularSegments||32,c=V.p||2,W=V.q||3,F=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,Q=V=>{const O=Math.cos(V),Z=Math.sin(V),p=W/c*V,r=Math.cos(p),Y=a*(2+r)*.5*O,m=a*(2+r)*Z*.5,R=a*Math.sin(p)*.5;return new d.m(Y,m,R)};let b,U;for(b=0;b<=i;b++){const V=b%i/i*2*c*Math.PI,O=Q(V),p=Q(V+.01),Y=p.fc(O);let a=p.add(O);const W=d.m.Cross(Y,a);for(a=d.m.Cross(W,Y),W.normalize(),a.normalize(),U=0;U<M;U++){const V=U%M/M*2*Math.PI,d=-R*Math.cos(V),p=R*Math.sin(V);Z.push(O.x+d*a.x+p*W.x),Z.push(O.y+d*a.y+p*W.y),Z.push(O.z+d*a.z+p*W.z),r.push(b/i),r.push(m.c?1-U/M:U/M)}}for(b=0;b<i;b++)for(U=0;U<M;U++){const V=(U+1)%M,Z=b*M+U,d=(b+1)*M+U,p=(b+1)*M+V,r=b*M+V;O.push(r),O.push(d),O.push(Z),O.push(r),O.push(p),O.push(d)}Y.e.ComputeNormals(Z,O,p),Y.e._ComputeSides(F,Z,O,p,r,V.frontUVs,V.backUVs);const H=new Y.e;return H.indices=O,H.xa=Z,H.ya=p,H.Aa=r,H}function v(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return C(O).Ca(d,O.updatable),d}Y.e.CreateTorus=w,p.c.CreateTorus=(V,O,Z,d,p,r,Y)=>t(V,{diameter:O,thickness:Z,Jk:d,sideOrientation:Y,updatable:r},p);Y.e.CreateTorusKnot=C,p.c.CreateTorusKnot=(V,O,Z,d,p,r,Y,m,a,R)=>v(V,{i:O,tube:Z,radialSegments:d,tubularSegments:p,p:r,q:Y,sideOrientation:R,updatable:a},m);var A=Z(12596),l=Z(10914),I=Z(11721),g=Z(11255),n=Z(10942);class e extends d.l{constructor(V,O){super(V.x,V.y),this.index=O}}class u{constructor(){this.elements=[]}add(V){const O=[];return V.forEach((V=>{const Z=new e(V,this.elements.length);O.push(Z),this.elements.push(Z)})),O}computeBounds(){const V=new d.l(this.elements[0].x,this.elements[0].y),O=new d.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((Z=>{Z.x<V.x?V.x=Z.x:Z.x>O.x&&(O.x=Z.x),Z.y<V.y?V.y=Z.y:Z.y>O.y&&(O.y=Z.y)})),{min:V,max:O,width:O.x-V.x,height:O.y-V.y}}}class k{_addToepoint(V){for(const O of V)this._epoints.push(O.x,O.y)}constructor(V,O,Z){let d,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new u,this._outlinepoints=new u,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=p,this._name=V,this._scene=Z||n.e.LastCreatedScene,d=O instanceof I.g?O.getPoints():O,this._addToepoint(d),this._points.add(d),this._outlinepoints.add(d),"undefined"===typeof this.bjsEarcut&&l.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(V){this._points.add(V);const O=new u;return O.add(V),this._holes.push(O),this._eholes.push(this._epoints.length/2),this._addToepoint(V),this}build(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const d=new p.c(this._name,this._scene),Y=this.buildVertexData(O,Z);return d.Ga(r.e.PositionKind,Y.xa,V),d.Ga(r.e.NormalKind,Y.ya,V),d.Ga(r.e.UVKind,Y.Aa,V),d.setIndices(Y.indices),d}buildVertexData(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Z=new Y.e,d=[],p=[],r=[],m=this._points.computeBounds();this._points.elements.forEach((V=>{d.push(0,1,0),p.push(V.x,0,V.y),r.push((V.x-m.min.x)/m.width,(V.y-m.min.y)/m.height)}));const a=[],R=this.bjsEarcut(this._epoints,this._eholes,2);for(let Y=0;Y<R.length;Y++)a.push(R[Y]);if(V>0){const Z=p.length/3;this._points.elements.forEach((O=>{d.push(0,-1,0),p.push(O.x,-V,O.y),r.push(1-(O.x-m.min.x)/m.width,1-(O.y-m.min.y)/m.height)}));const Y=a.length;for(let V=0;V<Y;V+=3){const O=a[V+0],d=a[V+1],p=a[V+2];a.push(p+Z),a.push(d+Z),a.push(O+Z)}this._addSide(p,d,r,a,m,this._outlinepoints,V,!1,O),this._holes.forEach((Z=>{this._addSide(p,d,r,a,m,Z,V,!0,O)}))}return Z.indices=a,Z.xa=p,Z.ya=d,Z.Aa=r,Z}_addSide(V,O,Z,p,r,Y,m,a,R){let i=V.length/3,M=0;for(let c=0;c<Y.elements.length;c++){const W=Y.elements[c],F=Y.elements[(c+1)%Y.elements.length];V.push(W.x,0,W.y),V.push(W.x,-m,W.y),V.push(F.x,0,F.y),V.push(F.x,-m,F.y);const Q=Y.elements[(c+Y.elements.length-1)%Y.elements.length],b=Y.elements[(c+2)%Y.elements.length];let U=new d.m(-(F.y-W.y),0,F.x-W.x),H=new d.m(-(W.y-Q.y),0,W.x-Q.x),S=new d.m(-(b.y-F.y),0,b.x-F.x);a||(U=U.scale(-1),H=H.scale(-1),S=S.scale(-1));const z=U.normalizeToNew();let G=H.normalizeToNew(),w=S.normalizeToNew();const t=d.m.Dot(G,z);G=t>R?t<g.c-1?new d.m(W.x,0,W.y).fc(new d.m(F.x,0,F.y)).normalize():H.add(U).normalize():z;const C=d.m.Dot(S,U);w=C>R?C<g.c-1?new d.m(F.x,0,F.y).fc(new d.m(W.x,0,W.y)).normalize():S.add(U).normalize():z,Z.push(M/r.width,0),Z.push(M/r.width,1),M+=U.length(),Z.push(M/r.width,0),Z.push(M/r.width,1),O.push(G.x,G.y,G.z),O.push(G.x,G.y,G.z),O.push(w.x,w.y,w.z),O.push(w.x,w.y,w.z),a?(p.push(i),p.push(i+2),p.push(i+1),p.push(i+1),p.push(i+2),p.push(i+3)):(p.push(i),p.push(i+1),p.push(i+2),p.push(i+1),p.push(i+3),p.push(i+2)),i+=4}}}function D(V,O,Z,p,a,R,i){const M=Z||new Array(3),W=p,F=[],Q=i||!1;for(let r=0;r<3;r++)void 0===M[r]&&(M[r]=new d.p(0,0,1,1)),W&&void 0===W[r]&&(W[r]=new c.f(1,1,1,1));const b=V.getVerticesData(r.e.PositionKind),U=V.getVerticesData(r.e.NormalKind),H=V.getVerticesData(r.e.UVKind),S=V.qf(),z=b.length/9;let G=0,w=0,t=0,C=0,v=0;const A=[0];if(Q)for(let d=z;d<b.length/3;d+=4)w=b[3*(d+2)]-b[3*d],t=b[3*(d+2)+2]-b[3*d+2],C=Math.sqrt(w*w+t*t),v+=C,A.push(v);let l=0,I=0;for(let d=0;d<U.length;d+=3)Math.abs(U[d+1])<.001&&(I=1),Math.abs(U[d+1]-1)<.001&&(I=0),Math.abs(U[d+1]+1)<.001&&(I=2),l=d/3,1===I?(G=l-z,H[2*l]=G%4<1.5?Q?M[I].x+(M[I].z-M[I].x)*A[Math.floor(G/4)]/v:M[I].x:Q?M[I].x+(M[I].z-M[I].x)*A[Math.floor(G/4)+1]/v:M[I].z,H[2*l+1]=G%2===0?m.c?1-M[I].w:M[I].w:m.c?1-M[I].y:M[I].y):(H[2*l]=(1-H[2*l])*M[I].x+H[2*l]*M[I].z,H[2*l+1]=(1-H[2*l+1])*M[I].y+H[2*l+1]*M[I].w,m.c&&(H[2*l+1]=1-H[2*l+1])),W&&F.push(W[I].r,W[I].g,W[I].b,W[I].a);Y.e._ComputeSides(O,b,S,U,H,a,R);const g=new Y.e;if(g.indices=S,g.xa=b,g.ya=U,g.Aa=H,W){const V=O===Y.e.DOUBLESIDE?F.concat(F):F;g.za=V}return g}function X(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation);const Y=O.shape,m=O.holes||[],a=O.depth||0,R=O.smoothingThreshold||2,i=[];let M=[];for(let p=0;p<Y.length;p++)i[p]=new d.l(Y[p].x,Y[p].z);i[0].equalsWithEpsilon(i[i.length-1],1e-8)&&i.pop();const c=new k(V,i,Z||n.e.LastCreatedScene,r);for(let p=0;p<m.length;p++){M=[];for(let V=0;V<m[p].length;V++)M.push(new d.l(m[p][V].x,m[p][V].z));c.addHole(M)}const W=c.build(!1,a,R);W._originalBuilderSideOrientation=O.sideOrientation;return D(W,O.sideOrientation,O.faceUV,O.faceColors,O.frontUVs,O.backUVs,O.wrap).Ca(W,O.updatable),W}function o(V,O){return X(V,O,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function E(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=O.path,r=O.shape,Y=O.scale||1,m=O.rotation||0,a=0===O.cap?0:O.cap||p.c.NO_CAP,R=O.updatable,i=p.c._GetDefaultSideOrientation(O.sideOrientation),M=O.instance||null,c=O.invertUV||!1,W=O.closeShape||!1;return J(V,r,d,Y,m,null,null,O.closePath||!1,W,a,!1,Z,!!R,i,M,c,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame)}function L(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=O.path,r=O.shape,Y=O.scaleFunction||(()=>1),m=O.rotationFunction||(()=>0),a=O.closePath||O.ribbonCloseArray||!1,R=O.closeShape||O.ribbonClosePath||!1,i=0===O.cap?0:O.cap||p.c.NO_CAP,M=O.updatable,c=O.firstNormal||null,W=O.adjustFrame||!1;return J(V,r,d,null,null,Y,m,a,R,i,!0,Z,!!M,p.c._GetDefaultSideOrientation(O.sideOrientation),O.instance||null,O.invertUV||!1,O.frontUVs||null,O.backUVs||null,c,W)}function J(V,O,Z,r,Y,m,a,i,M,c,W,F,Q,b,U,H,S,z,G,w){const t=(V,O,Z,r,Y,m,a,R,i,M,c)=>{const W=Z.getTangents(),F=Z.getNormals(),Q=Z.getBinormals(),b=Z.getDistances();if(c)for(let p=0;p<W.length;p++)if(0==W[p].x&&0==W[p].y&&0==W[p].z&&W[p].p(W[p-1]),0==F[p].x&&0==F[p].y&&0==F[p].z&&F[p].p(F[p-1]),0==Q[p].x&&0==Q[p].y&&0==Q[p].z&&Q[p].p(Q[p-1]),p>0){let V=W[p-1];d.m.Dot(V,W[p])<0&&W[p].scaleInPlace(-1),V=F[p-1],d.m.Dot(V,F[p])<0&&F[p].scaleInPlace(-1),V=Q[p-1],d.m.Dot(V,Q[p])<0&&Q[p].scaleInPlace(-1)}let U=0;const H=M&&R?R:()=>null!==m?m:0,S=M&&a?a:()=>null!==Y?Y:1;let z=i===p.c.NO_CAP||i===p.c.CAP_END?0:2;const G=d.i.Matrix[0];for(let p=0;p<O.length;p++){const Z=[],Y=H(p,b[p]),m=S(p,b[p]);d.c.RotationAxisToRef(W[p],U,G);for(let r=0;r<V.length;r++){const Y=W[p].scale(V[r].z).add(F[p].scale(V[r].x)).add(Q[p].scale(V[r].y)),a=d.m.Zero();d.m.TransformCoordinatesToRef(Y,G,a),a.scaleInPlace(m).addInPlace(O[p]),Z[r]=a}r[z]=Z,U+=Y,z++}const w=V=>{const O=Array(),Z=d.m.Zero();let p;for(p=0;p<V.length;p++)Z.addInPlace(V[p]);for(Z.scaleInPlace(1/V.length),p=0;p<V.length;p++)O.push(Z);return O};switch(i){case p.c.NO_CAP:break;case p.c.CAP_START:r[0]=w(r[2]),r[1]=r[2];break;case p.c.CAP_END:r[z]=r[z-1],r[z+1]=w(r[z-1]);break;case p.c.CAP_ALL:r[0]=w(r[2]),r[1]=r[2],r[z]=r[z-1],r[z+1]=w(r[z-1])}return r};let C,v;if(U){const V=U._creationDataStorage;return C=G?V.path3D.update(Z,G):V.path3D.update(Z),v=t(O,Z,V.path3D,V.pathArray,r,Y,m,a,V.cap,W,w),U=R("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},F||void 0)}C=G?new I.k(Z,G):new I.k(Z);v=t(O,Z,C,new Array,r,Y,m,a,c=c<0||c>3?0:c,W,w);const A=R(V,{pathArray:v,closeArray:i,closePath:M,updatable:Q,sideOrientation:b,invertUV:H,frontUVs:S||void 0,backUVs:z||void 0},F);return A._creationDataStorage.pathArray=v,A._creationDataStorage.path3D=C,A._creationDataStorage.cap=c,A}Y.e.CreatePolygon=D,p.c.CreatePolygon=function(V,O,Z,d,p,r){return X(V,{shape:O,holes:d,updatable:p,sideOrientation:r},Z,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},p.c.ExtrudePolygon=function(V,O,Z,d,p,r,Y){return o(V,{shape:O,holes:p,depth:Z,updatable:r,sideOrientation:Y},d,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function N(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,Y=void 0===O.closed||O.closed,m=O.shape,a=O.i||1,i=O.Jk||64,M=O.clip||0,c=O.updatable,W=p.c._GetDefaultSideOrientation(O.sideOrientation),F=O.cap||p.c.NO_CAP,Q=2*Math.PI,b=[],U=O.invertUV||!1;let H=0,S=0;const z=Q/i*r;let G,w;for(H=0;H<=i-M;H++){for(w=[],F!=p.c.CAP_START&&F!=p.c.CAP_ALL||(w.push(new d.m(0,m[0].y,0)),w.push(new d.m(Math.cos(H*z)*m[0].x*a,m[0].y,Math.sin(H*z)*m[0].x*a))),S=0;S<m.length;S++)G=new d.m(Math.cos(H*z)*m[S].x*a,m[S].y,Math.sin(H*z)*m[S].x*a),w.push(G);F!=p.c.CAP_END&&F!=p.c.CAP_ALL||(w.push(new d.m(Math.cos(H*z)*m[m.length-1].x*a,m[m.length-1].y,Math.sin(H*z)*m[m.length-1].x*a)),w.push(new d.m(0,m[m.length-1].y,0))),b.push(w)}return R(V,{pathArray:b,closeArray:Y,sideOrientation:W,updatable:c,invertUV:U,frontUVs:O.frontUVs,backUVs:O.backUVs},Z)}p.c.ExtrudeShape=function(V,O,Z,d,r,Y){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0,i=arguments.length>9?arguments[9]:void 0;return E(V,{shape:O,path:Z,scale:d,rotation:r,cap:0===Y?0:Y||p.c.NO_CAP,sideOrientation:R,instance:i,updatable:a},m)},p.c.ExtrudeShapeCustom=(V,O,Z,d,r,Y,m,a,R,i,M,c)=>L(V,{shape:O,path:Z,scaleFunction:d,rotationFunction:r,ribbonCloseArray:Y,ribbonClosePath:m,cap:0===a?0:a||p.c.NO_CAP,sideOrientation:M,instance:c,updatable:i},R);p.c.CreateLathe=(V,O,Z,d,p,r,Y)=>N(V,{shape:O,i:Z,Jk:d,sideOrientation:Y,updatable:r},p);var P=Z(11623),f=Z(11574);function q(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=O.path;let Y=O.instance,m=1;void 0!==O.i?m=O.i:Y&&(m=Y._creationDataStorage.i);const a=O.Jk||64,i=O.radiusFunction||null;let M=O.cap||p.c.NO_CAP;const c=O.invertUV||!1,W=O.updatable,F=p.c._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const Q=(V,O,Z,r,Y,m,a,R)=>{const i=O.getTangents(),M=O.getNormals(),c=O.getDistances(),W=2*Math.PI/Y*R,F=m||(()=>r);let Q,b,U,H;const S=d.i.Matrix[0];let z=a===p.c.NO_CAP||a===p.c.CAP_END?0:2;for(let p=0;p<V.length;p++){b=F(p,c[p]),Q=Array(),U=M[p];for(let O=0;O<Y;O++)d.c.RotationAxisToRef(i[p],W*O,S),H=Q[O]?Q[O]:d.m.Zero(),d.m.TransformCoordinatesToRef(U,S,H),H.scaleInPlace(b).addInPlace(V[p]),Q[O]=H;Z[z]=Q,z++}const G=(O,Z)=>{const d=Array();for(let p=0;p<O;p++)d.push(V[Z]);return d};switch(a){case p.c.NO_CAP:break;case p.c.CAP_START:Z[0]=G(Y,0),Z[1]=Z[2].slice(0);break;case p.c.CAP_END:Z[z]=Z[z-1].slice(0),Z[z+1]=G(Y,V.length-1);break;case p.c.CAP_ALL:Z[0]=G(Y,0),Z[1]=Z[2].slice(0),Z[z]=Z[z-1].slice(0),Z[z+1]=G(Y,V.length-1)}return Z};let b,U;if(Y){const V=Y._creationDataStorage,Z=O.arc||V.arc;return b=V.path3D.update(r),U=Q(r,b,V.pathArray,m,V.Jk,i,V.cap,Z),Y=R("",{pathArray:U,instance:Y}),V.path3D=b,V.pathArray=U,V.arc=Z,V.i=m,Y}b=new I.k(r);M=M<0||M>3?0:M,U=Q(r,b,new Array,m,a,i,M,O.arc);const H=R(V,{pathArray:U,closePath:!0,closeArray:!1,updatable:W,sideOrientation:F,invertUV:c,frontUVs:O.frontUVs,backUVs:O.backUVs},Z);return H._creationDataStorage.pathArray=U,H._creationDataStorage.path3D=b,H._creationDataStorage.Jk=a,H._creationDataStorage.cap=M,H._creationDataStorage.arc=O.arc,H._creationDataStorage.i=m,H}function K(V){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Z=V.type&&(V.type<0||V.type>=O.length)?0:V.type||0,p=V.size,r=V.sizeX||p||1,a=V.sizeY||p||1,R=V.sizeZ||p||1,i=V.custom||O[Z],M=i.face.length,W=V.faceUV||new Array(M),F=V.faceColors,Q=void 0===V.flat||V.flat,b=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,U=[],H=[],S=[],z=[],G=[];let w=0,t=0;const C=[];let v,A,l,I,g,n,e=0,u=0;if(Q)for(u=0;u<M;u++)F&&void 0===F[u]&&(F[u]=new c.f(1,1,1,1)),W&&void 0===W[u]&&(W[u]=new d.p(0,0,1,1));if(Q)for(u=0;u<M;u++){const V=i.face[u].length;for(l=2*Math.PI/V,I=.5*Math.tan(l/2),g=.5,e=0;e<V;e++)U.push(i.vertex[i.face[u][e]][0]*r,i.vertex[i.face[u][e]][1]*a,i.vertex[i.face[u][e]][2]*R),C.push(w),w++,v=W[u].x+(W[u].z-W[u].x)*(.5+I),A=W[u].y+(W[u].w-W[u].y)*(g-.5),z.push(v,m.c?1-A:A),n=I*Math.cos(l)-g*Math.sin(l),g=I*Math.sin(l)+g*Math.cos(l),I=n,F&&G.push(F[u].r,F[u].g,F[u].b,F[u].a);for(e=0;e<V-2;e++)H.push(C[0+t],C[e+2+t],C[e+1+t]);t+=V}else{for(e=0;e<i.vertex.length;e++)U.push(i.vertex[e][0]*r,i.vertex[e][1]*a,i.vertex[e][2]*R),z.push(0,m.c?1:0);for(u=0;u<M;u++)for(e=0;e<i.face[u].length-2;e++)H.push(i.face[u][0],i.face[u][e+2],i.face[u][e+1])}Y.e.ComputeNormals(U,H,S),Y.e._ComputeSides(b,U,H,S,z,V.frontUVs,V.backUVs);const k=new Y.e;return k.xa=U,k.indices=H,k.ya=S,k.Aa=z,F&&Q&&(k.za=G),k}function s(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return K(O).Ca(d,O.updatable),d}p.c.CreateTube=(V,O,Z,d,p,r,Y,m,a,R)=>q(V,{path:O,i:Z,Jk:d,radiusFunction:p,arc:1,cap:r,updatable:m,sideOrientation:a,instance:R},Y);function h(V){const O=V.sideOrientation||Y.e.DEFAULTSIDE,Z=V.i||1,p=void 0===V.flat||V.flat,r=0|(V.subdivisions||4),a=V.radiusX||Z,R=V.radiusY||Z,i=V.radiusZ||Z,M=(1+Math.sqrt(5))/2,c=[-1,M,-0,1,M,0,-1,-M,0,1,-M,0,0,-1,-M,0,1,-M,0,-1,M,0,1,M,M,0,1,M,0,-1,-M,0,1,-M,0,-1],W=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],F=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],b=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],H=[],S=[],z=[];let G=0;const w=new Array(3),t=new Array(3);let C;for(C=0;C<3;C++)w[C]=d.m.Zero(),t[C]=d.l.Zero();for(let Y=0;Y<20;Y++){for(C=0;C<3;C++){const V=W[3*Y+C];w[C].nf(c[3*F[V]],c[3*F[V]+1],c[3*F[V]+2]),w[C].normalize(),t[C].nf(.134765625*Q[2*V]+.05859375+-.0390625*b[Y],.2333984375*Q[2*V+1]+.025390625+.01953125*b[Y])}const V=(V,O,Z,Y)=>{const M=d.m.Lerp(w[0],w[2],O/r),c=d.m.Lerp(w[1],w[2],O/r),W=r===O?w[2]:d.m.Lerp(M,c,V/(r-O));let F;if(W.normalize(),p){const V=d.m.Lerp(w[0],w[2],Y/r),O=d.m.Lerp(w[1],w[2],Y/r);F=d.m.Lerp(V,O,Z/(r-Y))}else F=new d.m(W.x,W.y,W.z);F.x/=a,F.y/=R,F.z/=i,F.normalize();const Q=d.l.Lerp(t[0],t[2],O/r),b=d.l.Lerp(t[1],t[2],O/r),C=r===O?t[2]:d.l.Lerp(Q,b,V/(r-O));H.push(W.x*a,W.y*R,W.z*i),S.push(F.x,F.y,F.z),z.push(C.x,m.c?1-C.y:C.y),U.push(G),G++};for(let O=0;O<r;O++)for(let Z=0;Z+O<r;Z++)V(Z,O,Z+1/3,O+1/3),V(Z+1,O,Z+1/3,O+1/3),V(Z,O+1,Z+1/3,O+1/3),Z+O+1<r&&(V(Z+1,O,Z+2/3,O+2/3),V(Z+1,O+1,Z+2/3,O+2/3),V(Z,O+1,Z+2/3,O+2/3))}Y.e._ComputeSides(O,H,U,S,z,V.frontUVs,V.backUVs);const v=new Y.e;return v.indices=U,v.xa=H,v.ya=S,v.Aa=z,v}function x(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new p.c(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),d._originalBuilderSideOrientation=O.sideOrientation;return h(O).Ca(d,O.updatable),d}Y.e.CreatePolyhedron=K,p.c.CreatePolyhedron=(V,O,Z)=>s(V,O,Z);Y.e.CreateIcoSphere=h,p.c.CreateIcoSphere=(V,O,Z)=>x(V,O,Z);var y=Z(11263);const T=new d.m(1,0,0),B=new d.m(-1,0,0),j=new d.m(0,1,0),VV=new d.m(0,-1,0),OV=new d.m(0,0,1),ZV=new d.m(0,0,-1);class dV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.m.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.m.Up(),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.l.Zero(),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=V,this.ab=O,this.uv=Z,this.vertexIdx=p,this.vertexIdxForBones=r,this.localPositionOverride=Y,this.localNormalOverride=m,this.matrixIndicesOverride=a,this.matrixWeightsOverride=R}clone(){var V,O,Z,d;return new dV(this.position.clone(),this.ab.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(V=this.localPositionOverride)||void 0===V?void 0:V.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(Z=this.matrixIndicesOverride)||void 0===Z?void 0:Z.slice(),null===(d=this.matrixWeightsOverride)||void 0===d?void 0:d.slice())}}function pV(V,O,Z){var a,R,i,M;const c=!!O.skeleton,W=Z.localMode||c,F=O.qf(),Q=c?O.ze(!0,!0):O.getVerticesData(r.e.PositionKind),b=c?O.getNormalsData(!0,!0):O.getVerticesData(r.e.NormalKind),U=W?c?O.getVerticesData(r.e.PositionKind):Q:null,H=W?c?O.getVerticesData(r.e.NormalKind):b:null,S=O.getVerticesData(r.e.UVKind),z=c?O.getVerticesData(r.e.MatricesIndicesKind):null,G=c?O.getVerticesData(r.e.MatricesWeightsKind):null,w=c?O.getVerticesData(r.e.MatricesIndicesExtraKind):null,t=c?O.getVerticesData(r.e.MatricesWeightsExtraKind):null,C=Z.position||d.m.Zero();let v=Z.ab||d.m.Up();const A=Z.size||d.m.One(),l=Z.angle||0;if(!v){const V=new d.m(0,0,1),Z=O.va().activeCamera,p=d.m.TransformCoordinates(V,Z.getWorldMatrix());v=Z.globalPosition.fc(p)}const I=-Math.atan2(v.z,v.x)-Math.PI/2,g=Math.sqrt(v.x*v.x+v.z*v.z),n=Math.atan2(v.y,g),e=new Y.e;e.indices=[],e.xa=[],e.ya=[],e.Aa=[],e.matricesIndices=c?[]:null,e.matricesWeights=c?[]:null,e.matricesIndicesExtra=w?[]:null,e.matricesWeightsExtra=t?[]:null;let u=0;const k=(V,O)=>{const p=new dV;if(!F||!Q||!b)return p;const r=F[V];if(p.vertexIdx=3*r,p.vertexIdxForBones=4*r,p.position=new d.m(Q[3*r],Q[3*r+1],Q[3*r+2]),d.m.TransformCoordinatesToRef(p.position,O,p.position),p.ab=new d.m(b[3*r],b[3*r+1],b[3*r+2]),d.m.TransformNormalToRef(p.ab,O,p.ab),Z.captureUVS&&S){const V=S[2*r+1];p.uv=new d.l(S[2*r],m.c?1-V:V)}return p},D=[0,0,0,0],X=(V,O)=>{if(0===V.length)return V;const Z=.5*Math.abs(d.m.Dot(A,O)),p=(V,O,Z,d)=>{for(let p=0;p<d;++p)if(V[Z+p]===O)return Z+p;return-1},r=(V,r)=>{const Y=d.m.GetClipFactor(V.position,r.position,O,Z);let m=D,a=D;if(z&&G){const O=V.matrixIndicesOverride?0:V.vertexIdxForBones,Z=V.matrixIndicesOverride??z,d=V.matrixWeightsOverride??G,R=r.matrixIndicesOverride?0:r.vertexIdxForBones,i=r.matrixIndicesOverride??z,M=r.matrixWeightsOverride??G;m=[0,0,0,0],a=[0,0,0,0];let c=0;for(let V=0;V<4;++V)if(d[O+V]>0){const r=p(i,Z[O+V],R,4);m[c]=Z[O+V],a[c]=(0,y.m)(d[O+V],r>=0?M[r]:0,Y),c++}for(let V=0;V<4&&c<4;++V){const d=i[R+V];-1===p(Z,d,O,4)&&(m[c]=d,a[c]=(0,y.m)(0,M[R+V],Y),c++)}const W=a[0]+a[1]+a[2]+a[3];a[0]/=W,a[1]/=W,a[2]/=W,a[3]/=W}const R=V.localPositionOverride?V.localPositionOverride[0]:(null===U||void 0===U?void 0:U[V.vertexIdx])??0,i=V.localPositionOverride?V.localPositionOverride[1]:(null===U||void 0===U?void 0:U[V.vertexIdx+1])??0,M=V.localPositionOverride?V.localPositionOverride[2]:(null===U||void 0===U?void 0:U[V.vertexIdx+2])??0,c=r.localPositionOverride?r.localPositionOverride[0]:(null===U||void 0===U?void 0:U[r.vertexIdx])??0,W=r.localPositionOverride?r.localPositionOverride[1]:(null===U||void 0===U?void 0:U[r.vertexIdx+1])??0,F=r.localPositionOverride?r.localPositionOverride[2]:(null===U||void 0===U?void 0:U[r.vertexIdx+2])??0,Q=V.localNormalOverride?V.localNormalOverride[0]:(null===H||void 0===H?void 0:H[V.vertexIdx])??0,b=V.localNormalOverride?V.localNormalOverride[1]:(null===H||void 0===H?void 0:H[V.vertexIdx+1])??0,S=V.localNormalOverride?V.localNormalOverride[2]:(null===H||void 0===H?void 0:H[V.vertexIdx+2])??0,w=Q+((r.localNormalOverride?r.localNormalOverride[0]:(null===H||void 0===H?void 0:H[r.vertexIdx])??0)-Q)*Y,t=b+((r.localNormalOverride?r.localNormalOverride[1]:(null===H||void 0===H?void 0:H[r.vertexIdx+1])??0)-b)*Y,C=S+((r.localNormalOverride?r.localNormalOverride[2]:(null===H||void 0===H?void 0:H[r.vertexIdx+2])??0)-S)*Y,v=Math.sqrt(w*w+t*t+C*C);return new dV(d.m.Lerp(V.position,r.position,Y),d.m.Lerp(V.ab,r.ab,Y).normalize(),d.l.Lerp(V.uv,r.uv,Y),-1,-1,U?[R+(c-R)*Y,i+(W-i)*Y,M+(F-M)*Y]:null,H?[w/v,t/v,C/v]:null,m,a)};let Y=null;V.length>3&&(Y=[]);for(let m=0;m<V.length;m+=3){let p=0,a=null,R=null,i=null,M=null;const c=d.m.Dot(V[m].position,O)-Z>0,W=d.m.Dot(V[m+1].position,O)-Z>0,F=d.m.Dot(V[m+2].position,O)-Z>0;switch(p=(c?1:0)+(W?1:0)+(F?1:0),p){case 0:V.length>3?(Y.push(V[m]),Y.push(V[m+1]),Y.push(V[m+2])):Y=V;break;case 1:if(Y=Y??new Array,c&&(a=V[m+1],R=V[m+2],i=r(V[m],a),M=r(V[m],R)),W){a=V[m],R=V[m+2],i=r(V[m+1],a),M=r(V[m+1],R),Y.push(i),Y.push(R.clone()),Y.push(a.clone()),Y.push(R.clone()),Y.push(i.clone()),Y.push(M);break}F&&(a=V[m],R=V[m+1],i=r(V[m+2],a),M=r(V[m+2],R)),a&&R&&i&&M&&(Y.push(a.clone()),Y.push(R.clone()),Y.push(i),Y.push(M),Y.push(i.clone()),Y.push(R.clone()));break;case 2:Y=Y??new Array,c||(a=V[m].clone(),R=r(a,V[m+1]),i=r(a,V[m+2]),Y.push(a),Y.push(R),Y.push(i)),W||(a=V[m+1].clone(),R=r(a,V[m+2]),i=r(a,V[m]),Y.push(a),Y.push(R),Y.push(i)),F||(a=V[m+2].clone(),R=r(a,V[m]),i=r(a,V[m+1]),Y.push(a),Y.push(R),Y.push(i))}}return Y},o=O instanceof p.c?O:null,E=null===o||void 0===o?void 0:o._thinInstanceDataStorage.matrixData,L=(null===o||void 0===o?void 0:o.Aj)||1,J=d.i.Matrix[0];J.p(d.c.IdentityReadOnly);for(let p=0;p<L;++p){if(null!==o&&void 0!==o&&o.hasThinInstances&&E){const V=16*p;J.setRowFromFloats(0,E[V+0],E[V+1],E[V+2],E[V+3]),J.setRowFromFloats(1,E[V+4],E[V+5],E[V+6],E[V+7]),J.setRowFromFloats(2,E[V+8],E[V+9],E[V+10],E[V+11]),J.setRowFromFloats(3,E[V+12],E[V+13],E[V+14],E[V+15])}const V=d.c.RotationYawPitchRoll(I,n,l).multiply(d.c.Translation(C.x,C.y,C.z)),r=d.c.Invert(V),Y=O.getWorldMatrix(),a=J.multiply(Y).multiply(r),R=new Array(3);for(let O=0;O<F.length;O+=3){let V=R;if(V[0]=k(O,a),V[1]=k(O+1,a),V[2]=k(O+2,a),!(Z.cullBackFaces&&-V[0].ab.z<=0&&-V[1].ab.z<=0&&-V[2].ab.z<=0)&&(V=X(V,T),V&&(V=X(V,B),V&&(V=X(V,j),V&&(V=X(V,VV),V&&(V=X(V,OV),V&&(V=X(V,ZV),V)))))))for(let O=0;O<V.length;O++){const d=V[O];if(e.indices.push(u),W?(d.localPositionOverride?(e.xa[3*u]=d.localPositionOverride[0],e.xa[3*u+1]=d.localPositionOverride[1],e.xa[3*u+2]=d.localPositionOverride[2]):U&&(e.xa[3*u]=U[d.vertexIdx],e.xa[3*u+1]=U[d.vertexIdx+1],e.xa[3*u+2]=U[d.vertexIdx+2]),d.localNormalOverride?(e.ya[3*u]=d.localNormalOverride[0],e.ya[3*u+1]=d.localNormalOverride[1],e.ya[3*u+2]=d.localNormalOverride[2]):H&&(e.ya[3*u]=H[d.vertexIdx],e.ya[3*u+1]=H[d.vertexIdx+1],e.ya[3*u+2]=H[d.vertexIdx+2])):(d.position.toArray(e.xa,3*u),d.ab.toArray(e.ya,3*u)),e.matricesIndices&&e.matricesWeights&&(d.matrixIndicesOverride?(e.matricesIndices[4*u]=d.matrixIndicesOverride[0],e.matricesIndices[4*u+1]=d.matrixIndicesOverride[1],e.matricesIndices[4*u+2]=d.matrixIndicesOverride[2],e.matricesIndices[4*u+3]=d.matrixIndicesOverride[3]):(z&&(e.matricesIndices[4*u]=z[d.vertexIdxForBones],e.matricesIndices[4*u+1]=z[d.vertexIdxForBones+1],e.matricesIndices[4*u+2]=z[d.vertexIdxForBones+2],e.matricesIndices[4*u+3]=z[d.vertexIdxForBones+3]),w&&e.matricesIndicesExtra&&(e.matricesIndicesExtra[4*u]=w[d.vertexIdxForBones],e.matricesIndicesExtra[4*u+1]=w[d.vertexIdxForBones+1],e.matricesIndicesExtra[4*u+2]=w[d.vertexIdxForBones+2],e.matricesIndicesExtra[4*u+3]=w[d.vertexIdxForBones+3])),d.matrixWeightsOverride?(e.matricesWeights[4*u]=d.matrixWeightsOverride[0],e.matricesWeights[4*u+1]=d.matrixWeightsOverride[1],e.matricesWeights[4*u+2]=d.matrixWeightsOverride[2],e.matricesWeights[4*u+3]=d.matrixWeightsOverride[3]):(G&&(e.matricesWeights[4*u]=G[d.vertexIdxForBones],e.matricesWeights[4*u+1]=G[d.vertexIdxForBones+1],e.matricesWeights[4*u+2]=G[d.vertexIdxForBones+2],e.matricesWeights[4*u+3]=G[d.vertexIdxForBones+3]),t&&e.matricesWeightsExtra&&(e.matricesWeightsExtra[4*u]=t[d.vertexIdxForBones],e.matricesWeightsExtra[4*u+1]=t[d.vertexIdxForBones+1],e.matricesWeightsExtra[4*u+2]=t[d.vertexIdxForBones+2],e.matricesWeightsExtra[4*u+3]=t[d.vertexIdxForBones+3]))),Z.captureUVS)d.uv.toArray(e.Aa,2*u);else{e.Aa.push(.5+d.position.x/A.x);const V=.5+d.position.y/A.y;e.Aa.push(m.c?1-V:V)}u++}}}0===e.indices.length&&(e.indices=null),0===e.xa.length&&(e.xa=null),0===e.ya.length&&(e.ya=null),0===e.Aa.length&&(e.Aa=null),0===(null===(a=e.matricesIndices)||void 0===a?void 0:a.length)&&(e.matricesIndices=null),0===(null===(R=e.matricesWeights)||void 0===R?void 0:R.length)&&(e.matricesWeights=null),0===(null===(i=e.matricesIndicesExtra)||void 0===i?void 0:i.length)&&(e.matricesIndicesExtra=null),0===(null===(M=e.matricesWeightsExtra)||void 0===M?void 0:M.length)&&(e.matricesWeightsExtra=null);const N=new p.c(V,O.va());return e.Ca(N),W?(N.skeleton=O.skeleton,N.parent=O):(N.position=C.clone(),N.rotation=new d.m(n,I,l)),N.Cj(!0),N.refreshBoundingInfo(!0,!0),N}function rV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Jk:16,height:1,i:.25,capSubdivisions:6};const O=0|Math.max(V.subdivisions?V.subdivisions:2,1),Z=0|Math.max(V.Jk?V.Jk:16,3),p=Math.max(V.height?V.height:1,0),r=Math.max(V.i?V.i:.25,0),a=0|Math.max(V.capSubdivisions?V.capSubdivisions:6,1),R=Z,i=O,M=Math.max(V.radiusTop?V.radiusTop:r,0),c=Math.max(V.radiusBottom?V.radiusBottom:r,0),W=p-(M+c),F=2*Math.PI,Q=Math.max(V.topCapSubdivisions?V.topCapSubdivisions:a,1),b=Math.max(V.bottomCapSubdivisions?V.bottomCapSubdivisions:a,1),U=Math.acos((c-M)/p);let H=[];const S=[],z=[],G=[];let w=0;const t=[],C=.5*W,v=.5*Math.PI;let A,l;const I=d.m.Zero(),g=d.m.Zero(),n=Math.cos(U),e=Math.sin(U),u=new d.l(M*e,C+M*n).fc(new d.l(c*e,c*n-C)).length(),k=M*U+u+c*(v-U);let D=0;for(l=0;l<=Q;l++){const V=[],O=v-U*(l/Q);D+=M*U/Q;const Z=Math.cos(O),d=Math.sin(O),p=Z*M;for(A=0;A<=R;A++){const O=A/R,r=O*F+0,Y=Math.sin(r),a=Math.cos(r);g.x=p*Y,g.y=C+d*M,g.z=p*a,S.push(g.x,g.y,g.z),I.set(Z*Y,d,Z*a),z.push(I.x,I.y,I.z),G.push(O,m.c?D/k:1-D/k),V.push(w),w++}t.push(V)}const X=p-M-c+n*M-n*c,o=e*(c-M)/X;for(l=1;l<=i;l++){const V=[];D+=u/i;const O=e*(l*(c-M)/i+M);for(A=0;A<=R;A++){const Z=A/R,d=Z*F+0,p=Math.sin(d),r=Math.cos(d);g.x=O*p,g.y=C+n*M-l*X/i,g.z=O*r,S.push(g.x,g.y,g.z),I.set(p,o,r).normalize(),z.push(I.x,I.y,I.z),G.push(Z,m.c?D/k:1-D/k),V.push(w),w++}t.push(V)}for(l=1;l<=b;l++){const V=[],O=v-U-(Math.PI-U)*(l/b);D+=c*U/b;const Z=Math.cos(O),d=Math.sin(O),p=Z*c;for(A=0;A<=R;A++){const O=A/R,r=O*F+0,Y=Math.sin(r),a=Math.cos(r);g.x=p*Y,g.y=d*c-C,g.z=p*a,S.push(g.x,g.y,g.z),I.set(Z*Y,d,Z*a),z.push(I.x,I.y,I.z),G.push(O,m.c?D/k:1-D/k),V.push(w),w++}t.push(V)}for(A=0;A<R;A++)for(l=0;l<Q+i+b;l++){const V=t[l][A],O=t[l+1][A],Z=t[l+1][A+1],d=t[l][A+1];H.push(V),H.push(O),H.push(d),H.push(O),H.push(Z),H.push(d)}if(H=H.reverse(),V.orientation&&!V.orientation.equals(d.m.Up())){const O=new d.c;V.orientation.clone().scale(.5*Math.PI).cross(d.m.Up()).toQuaternion().toRotationMatrix(O);const Z=d.m.Zero();for(let V=0;V<S.length;V+=3)Z.set(S[V],S[V+1],S[V+2]),d.m.TransformCoordinatesToRef(Z.clone(),O,Z),S[V]=Z.x,S[V+1]=Z.y,S[V+2]=Z.z}const E=new Y.e;return E.xa=S,E.ya=z,E.Aa=G,E.indices=H,E}function YV(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:d.m.Up(),subdivisions:2,Jk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new p.c(V,Z);return rV(O).Ca(r,O.updatable),r}p.c.CreateDecal=(V,O,Z,d,p,r)=>pV(V,O,{position:Z,ab:d,size:p,angle:r});p.c.CreateCapsule=(V,O,Z)=>YV(V,O,Z),Y.e.CreateCapsule=rV;class mV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=O,V!==Math.floor(V)&&(V=Math.floor(V),l.b.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),l.b.Warn("y is not an integer, floor(y) used"))}clone(){return new mV(this.x,this.y)}rotate60About(V){const O=this.x;return this.x=V.x+V.y-this.y,this.y=O+this.y-V.x,this}rotateNeg60About(V){const O=this.x;return this.x=O+this.y-V.y,this.y=V.x+V.y-O,this}rotate120(V,O){V!==Math.floor(V)&&(V=Math.floor(V),l.b.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),l.b.Warn("n not an integer only floor(n) used"));const Z=this.x;return this.x=V-Z-this.y,this.y=O+Z,this}rotateNeg120(V,O){V!==Math.floor(V)&&(V=Math.floor(V),l.b.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),l.b.Warn("n is not an integer,   floor(n) used"));const Z=this.x;return this.x=this.y-O,this.y=V+O-Z-this.y,this}toCartesianOrigin(V,O){const Z=d.m.Zero();return Z.x=V.x+2*this.x*O+this.y*O,Z.y=V.y+Math.sqrt(3)*this.y*O,Z}static Zero(){return new mV(0,0)}}class aV{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new RV("icosahedron","Regular",[[0,g.f,-1],[-g.f,1,0],[-1,0,-g.f],[1,0,-g.f],[g.f,1,0],[0,g.f,1],[-1,0,g.f],[-g.f,-1,0],[0,-g.f,-1],[g.f,-1,0],[1,0,g.f],[0,-g.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let V=12;const O={},Z=this.m,d=this.n;let p,r,Y,m,a,R=Z,i=1,M=0;0!==d&&(R=(0,y.g)(Z,d)),i=Z/R,M=d/R;const c=mV.Zero(),W=new mV(Z,d),F=new mV(-d,Z+d),Q=mV.Zero(),b=mV.Zero(),U=mV.Zero();let H,S,z,G,w=[];const t=[],C=this.vertByDist,v=(Z,d,p,r)=>{H=Z+"|"+p,S=d+"|"+r,H in O||S in O?H in O&&!(S in O)?O[S]=O[H]:S in O&&!(H in O)&&(O[H]=O[S]):(O[H]=V,O[S]=V,V++),C[p][0]>2?t[O[H]]=[-C[p][0],C[p][1],O[H]]:t[O[H]]=[w[C[p][0]],C[p][1],O[H]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let A=0;A<20;A++){if(w=this.IDATA.face[A],Y=w[2],m=w[1],a=w[0],z=c.x+"|"+c.y,H=A+"|"+z,H in O||(O[H]=Y,t[Y]=[w[C[z][0]],C[z][1]]),z=W.x+"|"+W.y,H=A+"|"+z,H in O||(O[H]=m,t[m]=[w[C[z][0]],C[z][1]]),z=F.x+"|"+F.y,H=A+"|"+z,H in O||(O[H]=a,t[a]=[w[C[z][0]],C[z][1]]),p=this.IDATA.edgematch[A][0],r=this.IDATA.edgematch[A][1],"B"===r)for(let V=1;V<R;V++)b.x=Z-V*(i+M),b.y=d+V*i,U.x=-V*M,U.y=V*(i+M),z=b.x+"|"+b.y,G=U.x+"|"+U.y,v(A,p,z,G);if("O"===r)for(let V=1;V<R;V++)U.x=-V*M,U.y=V*(i+M),Q.x=V*i,Q.y=V*M,z=U.x+"|"+U.y,G=Q.x+"|"+Q.y,v(A,p,z,G);if(p=this.IDATA.edgematch[A][2],r=this.IDATA.edgematch[A][3],r&&"A"===r)for(let V=1;V<R;V++)Q.x=V*i,Q.y=V*M,b.x=Z-(R-V)*(i+M),b.y=d+(R-V)*i,z=Q.x+"|"+Q.y,G=b.x+"|"+b.y,v(A,p,z,G);for(let Z=0;Z<this.vertices.length;Z++)z=this.vertices[Z].x+"|"+this.vertices[Z].y,H=A+"|"+z,H in O||(O[H]=V++,C[z][0]>2?t[O[H]]=[-C[z][0],C[z][1],O[H]]:t[O[H]]=[w[C[z][0]],C[z][1],O[H]])}this.closestTo=t,this.vecToidx=O}calcCoeffs(){const V=this.m,O=this.n,Z=Math.sqrt(3)/3,d=V*V+O*O+V*O;this.coau=(V+O)/d,this.cobu=-O/d,this.coav=-Z*(V-O)/d,this.cobv=Z*(2*V+O)/d}createInnerFacets(){const V=this.m,O=this.n;for(let Z=0;Z<O+V+1;Z++)for(let V=this.min[Z];V<this.max[Z]+1;V++)V<this.max[Z]&&V<this.max[Z+1]+1&&this.innerFacets.push(["|"+V+"|"+Z,"|"+V+"|"+(Z+1),"|"+(V+1)+"|"+Z]),Z>0&&V<this.max[Z-1]&&V+1<this.max[Z]+1&&this.innerFacets.push(["|"+V+"|"+Z,"|"+(V+1)+"|"+Z,"|"+(V+1)+"|"+(Z-1)])}edgeVecsABOB(){const V=this.m,O=this.n,Z=new mV(-O,V+O);for(let d=1;d<V+O;d++){const V=new mV(this.min[d],d),O=new mV(this.min[d-1],d-1),p=new mV(this.min[d+1],d+1),r=V.clone(),Y=O.clone(),m=p.clone();r.rotate60About(Z),Y.rotate60About(Z),m.rotate60About(Z);const a=new mV(this.max[r.y],r.y),R=new mV(this.max[r.y-1],r.y-1),i=new mV(this.max[r.y-1]-1,r.y-1);r.x===a.x&&r.y===a.y||(r.x!==R.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,R,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,i,a])):r.y===m.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,O,R]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([V,R,p])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,O,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,R,a])))}}mapABOBtoOBOA(){const V=new mV(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const Z=[];for(let d=0;d<3;d++)V.x=this.isoVecsABOB[O][d].x,V.y=this.isoVecsABOB[O][d].y,0===this.vertexTypes[O][d]&&V.rotateNeg120(this.m,this.n),Z.push(V.clone());this.isoVecsOBOA.push(Z)}}mapABOBtoBAOA(){const V=new mV(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const Z=[];for(let d=0;d<3;d++)V.x=this.isoVecsABOB[O][d].x,V.y=this.isoVecsABOB[O][d].y,1===this.vertexTypes[O][d]&&V.rotate120(this.m,this.n),Z.push(V.clone());this.isoVecsBAOA.push(Z)}}MapToFace(V,O){const Z=this.IDATA.face[V],p=Z[2],r=Z[1],Y=Z[0],m=d.m.Cg(this.IDATA.vertex[p]),a=d.m.Cg(this.IDATA.vertex[r]),R=d.m.Cg(this.IDATA.vertex[Y]),i=a.fc(m),M=R.fc(m),c=i.scale(this.coau).add(M.scale(this.cobu)),W=i.scale(this.coav).add(M.scale(this.cobv)),F=[];let Q,b=d.i.ib[0];for(let d=0;d<this.cartesian.length;d++)b=c.scale(this.cartesian[d].x).add(W.scale(this.cartesian[d].y)).add(m),F[d]=[b.x,b.y,b.z],Q=V+"|"+this.vertices[d].x+"|"+this.vertices[d].y,O.vertex[this.vecToidx[Q]]=[b.x,b.y,b.z]}build(V,O){const Z=[],d=mV.Zero(),p=new mV(V,O),r=new mV(-O,V+O);Z.push(d,p,r);for(let z=O;z<V+1;z++)for(let O=0;O<V+1-z;O++)Z.push(new mV(O,z));if(O>0){const d=(0,y.g)(V,O),p=V/d,r=O/d;for(let m=1;m<d;m++)Z.push(new mV(m*p,m*r)),Z.push(new mV(-m*r,m*(p+r))),Z.push(new mV(V-m*(p+r),O+m*p));const Y=V/O;for(let m=1;m<O;m++)for(let d=0;d<m*Y;d++)Z.push(new mV(d,m)),Z.push(new mV(d,m).rotate120(V,O)),Z.push(new mV(d,m).rotateNeg120(V,O))}Z.sort(((V,O)=>V.x-O.x)),Z.sort(((V,O)=>V.y-O.y));const Y=new Array(V+O+1),m=new Array(V+O+1);for(let z=0;z<Y.length;z++)Y[z]=1/0,m[z]=-1/0;let a=0,R=0;const i=Z.length;for(let z=0;z<i;z++)R=Z[z].x,a=Z[z].y,Y[a]=Math.min(R,Y[a]),m[a]=Math.max(R,m[a]);const M=(Z,d)=>{const p=Z.clone();return"A"===d&&p.rotateNeg120(V,O),"B"===d&&p.rotate120(V,O),p.x<0?p.y:p.x+p.y},c=[],W=[],F=[],Q=[],b={},U=[];let H=-1,S=-1;for(let z=0;z<i;z++)c[z]=Z[z].toCartesianOrigin(new mV(0,0),.5),W[z]=M(Z[z],"O"),F[z]=M(Z[z],"A"),Q[z]=M(Z[z],"B"),W[z]===F[z]&&F[z]===Q[z]?(H=3,S=W[z]):W[z]===F[z]?(H=4,S=W[z]):F[z]===Q[z]?(H=5,S=F[z]):Q[z]===W[z]&&(H=6,S=W[z]),W[z]<F[z]&&W[z]<Q[z]&&(H=2,S=W[z]),F[z]<W[z]&&F[z]<Q[z]&&(H=1,S=F[z]),Q[z]<F[z]&&Q[z]<W[z]&&(H=0,S=Q[z]),U.push([H,S,Z[z].x,Z[z].y]);U.sort(((V,O)=>V[2]-O[2])),U.sort(((V,O)=>V[3]-O[3])),U.sort(((V,O)=>V[1]-O[1])),U.sort(((V,O)=>V[0]-O[0]));for(let z=0;z<U.length;z++)b[U[z][2]+"|"+U[z][3]]=[U[z][0],U[z][1],z];return this.m=V,this.n=O,this.vertices=Z,this.vertByDist=b,this.cartesian=c,this.min=Y,this.max=m,this}}class RV{constructor(V,O,Z,d){this.name=V,this.category=O,this.vertex=Z,this.face=d}}class iV extends RV{innerToData(V,O){for(let Z=0;Z<O.innerFacets.length;Z++)this.face.push(O.innerFacets[Z].map((Z=>O.vecToidx[V+Z])))}mapABOBtoDATA(V,O){const Z=O.IDATA.edgematch[V][0];for(let d=0;d<O.isoVecsABOB.length;d++){const p=[];for(let r=0;r<3;r++)0===O.vertexTypes[d][r]?p.push(V+"|"+O.isoVecsABOB[d][r].x+"|"+O.isoVecsABOB[d][r].y):p.push(Z+"|"+O.isoVecsABOB[d][r].x+"|"+O.isoVecsABOB[d][r].y);this.face.push([O.vecToidx[p[0]],O.vecToidx[p[1]],O.vecToidx[p[2]]])}}mapOBOAtoDATA(V,O){const Z=O.IDATA.edgematch[V][0];for(let d=0;d<O.isoVecsOBOA.length;d++){const p=[];for(let r=0;r<3;r++)1===O.vertexTypes[d][r]?p.push(V+"|"+O.isoVecsOBOA[d][r].x+"|"+O.isoVecsOBOA[d][r].y):p.push(Z+"|"+O.isoVecsOBOA[d][r].x+"|"+O.isoVecsOBOA[d][r].y);this.face.push([O.vecToidx[p[0]],O.vecToidx[p[1]],O.vecToidx[p[2]]])}}mapBAOAtoDATA(V,O){const Z=O.IDATA.edgematch[V][2];for(let d=0;d<O.isoVecsBAOA.length;d++){const p=[];for(let r=0;r<3;r++)1===O.vertexTypes[d][r]?p.push(V+"|"+O.isoVecsBAOA[d][r].x+"|"+O.isoVecsBAOA[d][r].y):p.push(Z+"|"+O.isoVecsBAOA[d][r].x+"|"+O.isoVecsBAOA[d][r].y);this.face.push([O.vecToidx[p[0]],O.vecToidx[p[1]],O.vecToidx[p[2]]])}}orderData(V){const O=[];for(let r=0;r<13;r++)O[r]=[];const Z=V.closestTo;for(let r=0;r<Z.length;r++)Z[r][0]>-1?Z[r][1]>0&&O[Z[r][0]].push([r,Z[r][1]]):O[12].push([r,Z[r][0]]);const d=[];for(let r=0;r<12;r++)d[r]=r;let p=12;for(let r=0;r<12;r++){O[r].sort(((V,O)=>V[1]-O[1]));for(let V=0;V<O[r].length;V++)d[O[r][V][0]]=p++}for(let r=0;r<O[12].length;r++)d[O[12][r][0]]=p++;for(let r=0;r<this.vertex.length;r++)this.vertex[r].push(d[r]);this.vertex.sort(((V,O)=>V[3]-O[3]));for(let r=0;r<this.vertex.length;r++)this.vertex[r].pop();for(let r=0;r<this.face.length;r++)for(let V=0;V<this.face[r].length;V++)this.face[r][V]=d[this.face[r][V]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(V,O){const Z=[],d=[];let p=O.pop();d.push(p);let r=this.face[p].indexOf(V);r=(r+2)%3;let Y=this.face[p][r];Z.push(Y);let m=0;for(;O.length>0;)p=O[m],this.face[p].indexOf(Y)>-1?(r=(this.face[p].indexOf(Y)+1)%3,Y=this.face[p][r],Z.push(Y),d.push(p),O.splice(m,1),m=0):m++;return this.adjacentFaces.push(Z),d}toGoldbergPolyhedronData(){const V=new RV("GeoDual","Goldberg",[],[]);V.name="GD dual";const O=this.vertex.length,Z=new Array(O);for(let a=0;a<O;a++)Z[a]=[];for(let a=0;a<this.face.length;a++)for(let V=0;V<3;V++)Z[this.face[a][V]].push(a);let d=0,p=0,r=0,Y=[],m=[];this.adjacentFaces=[];for(let a=0;a<Z.length;a++)V.face[a]=this.setOrder(a,Z[a].concat([])),Z[a].forEach((O=>{d=0,p=0,r=0,Y=this.face[O];for(let V=0;V<3;V++)m=this.vertex[Y[V]],d+=m[0],p+=m[1],r+=m[2];V.vertex[O]=[d/3,p/3,r/3]}));return V}static BuildGeodesicData(V){const O=new iV("Geodesic-m-n","Geodesic",[[0,g.f,-1],[-g.f,1,0],[-1,0,-g.f],[1,0,-g.f],[g.f,1,0],[0,g.f,1],[-1,0,g.f],[-g.f,-1,0],[0,-g.f,-1],[g.f,-1,0],[1,0,g.f],[0,-g.f,1]],[]);V.setIndices(),V.calcCoeffs(),V.createInnerFacets(),V.edgeVecsABOB(),V.mapABOBtoOBOA(),V.mapABOBtoBAOA();for(let Z=0;Z<V.IDATA.face.length;Z++)V.MapToFace(Z,O),O.innerToData(Z,V),"B"===V.IDATA.edgematch[Z][1]&&O.mapABOBtoDATA(Z,V),"O"===V.IDATA.edgematch[Z][1]&&O.mapOBOAtoDATA(Z,V),"A"===V.IDATA.edgematch[Z][3]&&O.mapBAOAtoDATA(Z,V);O.orderData(V);return O.vertex=O.vertex.map((function(V){const O=V[0],Z=V[1],d=V[2],p=Math.sqrt(O*O+Z*Z+d*d);return V[0]*=1/p,V[1]*=1/p,V[2]*=1/p,V})),O}}p.c._GoldbergMeshParser=(V,O)=>MV.Parse(V,O);class MV extends p.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(V,O){return void 0===O?(V>this.goldbergData.nbUnsharedFaces-1&&(l.b.Warn("Maximum number of unshared faces used"),V=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+V):(V>11&&(l.b.Warn("Last pole used"),V=11),O>this.goldbergData.nbFacesAtPole-1&&(l.b.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+V*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(V){for(let Z=0;Z<V.length;Z++){const O=V[Z][0],d=V[Z][1],p=V[Z][2];for(let V=O;V<d+1;V++)this.goldbergData.faceColors[V]=p}const O=[];for(let Z=0;Z<12;Z++)for(let V=0;V<5;V++)O.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);for(let Z=12;Z<this.goldbergData.faceColors.length;Z++)for(let V=0;V<6;V++)O.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);return O}setGoldbergFaceColors(V){const O=this._changeGoldbergFaceColors(V);this.Ga(r.e.ColorKind,O)}updateGoldbergFaceColors(V){const O=this._changeGoldbergFaceColors(V);this.updateVerticesData(r.e.ColorKind,O)}_changeGoldbergFaceUVs(V){const O=this.getVerticesData(r.e.UVKind);for(let Z=0;Z<V.length;Z++){const d=V[Z][0],p=V[Z][1],r=V[Z][2],Y=V[Z][3],m=V[Z][4],a=[],R=[];let i,M;for(let V=0;V<5;V++)i=r.x+Y*Math.cos(m+V*Math.PI/2.5),M=r.y+Y*Math.sin(m+V*Math.PI/2.5),i<0&&(i=0),i>1&&(i=1),a.push(i,M);for(let V=0;V<6;V++)i=r.x+Y*Math.cos(m+V*Math.PI/3),M=r.y+Y*Math.sin(m+V*Math.PI/3),i<0&&(i=0),i>1&&(i=1),R.push(i,M);for(let V=d;V<Math.min(12,p+1);V++)for(let Z=0;Z<5;Z++)O[10*V+2*Z]=a[2*Z],O[10*V+2*Z+1]=a[2*Z+1];for(let V=Math.max(12,d);V<p+1;V++)for(let Z=0;Z<6;Z++)O[12*V-24+2*Z]=R[2*Z],O[12*V-23+2*Z]=R[2*Z+1]}return O}setGoldbergFaceUVs(V){const O=this._changeGoldbergFaceUVs(V);this.Ga(r.e.UVKind,O)}updateGoldbergFaceUVs(V){const O=this._changeGoldbergFaceUVs(V);this.updateVerticesData(r.e.UVKind,O)}placeOnGoldbergFaceAt(V,O,Z){const p=d.m.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);V.rotation=p,V.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(Z.x)).add(this.goldbergData.faceYaxis[O].scale(Z.y)).add(this.goldbergData.faceZaxis[O].scale(Z.z))}serialize(V){super.serialize(V),V.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const V of this.goldbergData.faceColors)O.faceColors.push(V.Wi())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const V of this.goldbergData.faceCenters)O.faceCenters.push(V.Wi())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const V of this.goldbergData.faceZaxis)O.faceZaxis.push(V.Wi())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const V of this.goldbergData.faceYaxis)O.faceYaxis.push(V.Wi())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const V of this.goldbergData.faceXaxis)O.faceXaxis.push(V.Wi())}V.goldbergData=O}static Parse(V,O){const Z=V.goldbergData;Z.faceColors=Z.faceColors.map((V=>c.f.Cg(V))),Z.faceCenters=Z.faceCenters.map((V=>d.m.Cg(V))),Z.faceZaxis=Z.faceZaxis.map((V=>d.m.Cg(V))),Z.faceXaxis=Z.faceXaxis.map((V=>d.m.Cg(V))),Z.faceYaxis=Z.faceYaxis.map((V=>d.m.Cg(V)));const p=new MV(V.name,O);return p.goldbergData=Z,p}}var cV=Z(11556);class WV{constructor(V){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=V}moveTo(V,O){this._currentPath=new I.g(V,O),this._tempPaths.push(this._currentPath)}lineTo(V,O){this._currentPath.addLineTo(V,O)}quadraticCurveTo(V,O,Z,d){this._currentPath.addQuadraticCurveTo(V,O,Z,d,this._resolution)}bezierCurveTo(V,O,Z,d,p,r){this._currentPath.addBezierCurveTo(V,O,Z,d,p,r,this._resolution)}extractHoles(){for(const V of this._tempPaths)V.area()>0?this._holes.push(V):this._paths.push(V);if(!this._paths.length&&this._holes.length){const V=this._holes;this._holes=this._paths,this._paths=V}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function FV(V,O,Z,d,p,r){const Y=r.glyphs[V]||r.glyphs["?"];if(!Y)return null;const m=new WV(p);if(Y.o){const V=Y.o.split(" ");for(let p=0,r=V.length;p<r;){switch(V[p++]){case"m":{const r=parseInt(V[p++])*O+Z,Y=parseInt(V[p++])*O+d;m.moveTo(r,Y);break}case"l":{const r=parseInt(V[p++])*O+Z,Y=parseInt(V[p++])*O+d;m.lineTo(r,Y);break}case"q":{const r=parseInt(V[p++])*O+Z,Y=parseInt(V[p++])*O+d,a=parseInt(V[p++])*O+Z,R=parseInt(V[p++])*O+d;m.quadraticCurveTo(a,R,r,Y);break}case"b":{const r=parseInt(V[p++])*O+Z,Y=parseInt(V[p++])*O+d,a=parseInt(V[p++])*O+Z,R=parseInt(V[p++])*O+d,i=parseInt(V[p++])*O+Z,M=parseInt(V[p++])*O+d;m.bezierCurveTo(a,R,i,M,r,Y);break}}}}return m.extractHoles(),{offsetX:Y.ha*O,shapePath:m}}const QV={CreateBox:M.c,CreateTiledBox:b,CreateSphere:U.b,sb:i.e,CreateIcoSphere:x,CreateRibbon:R,CreateCylinder:G,CreateTorus:t,CreateTorusKnot:v,CreateLineSystem:A.f,ub:A.g,CreateDashedLines:A.c,ExtrudeShape:E,ExtrudeShapeCustom:L,CreateLathe:N,CreateTiledPlane:F,Jf:P.d,CreateGround:f.f,CreateTiledGround:f.j,CreateGroundFromHeightMap:f.d,CreatePolygon:X,ExtrudePolygon:o,CreateTube:q,CreatePolyhedron:s,CreateGeodesic:function(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=O.m||1;d!==Math.floor(d)&&(d=Math.floor(d),l.b.Warn("m not an integer only floor(m) used"));let p=O.n||0;if(p!==Math.floor(p)&&(p=Math.floor(p),l.b.Warn("n not an integer only floor(n) used")),p>d){const V=p;p=d,d=V,l.b.Warn("n > m therefore m and n swapped")}const r=new aV;return r.build(d,p),s(V,{custom:iV.BuildGeodesicData(r),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},Z)},CreateGoldberg:function(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=O.size,a=O.sizeX||r||1,R=O.sizeY||r||1,i=O.sizeZ||r||1;let M=O.m||1;M!==Math.floor(M)&&(M=Math.floor(M),l.b.Warn("m not an integer only floor(m) used"));let W=O.n||0;if(W!==Math.floor(W)&&(W=Math.floor(W),l.b.Warn("n not an integer only floor(n) used")),W>M){const V=W;W=M,M=V,l.b.Warn("n > m therefore m and n swapped")}const F=new aV;F.build(M,W);const Q=iV.BuildGeodesicData(F),b=Q.toGoldbergPolyhedronData(),U=new MV(V,Z);O.sideOrientation=p.c._GetDefaultSideOrientation(O.sideOrientation),U._originalBuilderSideOrientation=O.sideOrientation;(function(V,O){const Z=V.size,p=V.sizeX||Z||1,r=V.sizeY||Z||1,a=V.sizeZ||Z||1,R=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,i=[],M=[],c=[],W=[];let F=1/0,Q=-1/0,b=1/0,U=-1/0;for(let d=0;d<O.vertex.length;d++)F=Math.min(F,O.vertex[d][0]*p),Q=Math.max(Q,O.vertex[d][0]*p),b=Math.min(b,O.vertex[d][1]*r),U=Math.max(U,O.vertex[d][1]*r);let H=0;for(let Y=0;Y<O.face.length;Y++){const V=O.face[Y],Z=d.m.Cg(O.vertex[V[0]]),R=d.m.Cg(O.vertex[V[2]]),S=d.m.Cg(O.vertex[V[1]]),z=R.fc(Z),G=S.fc(Z),w=d.m.Cross(G,z).normalize();for(let d=0;d<V.length;d++){c.push(w.x,w.y,w.z);const Z=O.vertex[V[d]];i.push(Z[0]*p,Z[1]*r,Z[2]*a);const Y=(Z[1]*r-b)/(U-b);W.push((Z[0]*p-F)/(Q-F),m.c?1-Y:Y)}for(let O=0;O<V.length-2;O++)M.push(H,H+O+2,H+O+1);H+=V.length}Y.e._ComputeSides(R,i,M,c,W);const S=new Y.e;return S.xa=i,S.indices=M,S.ya=c,S.Aa=W,S})(O,b).Ca(U,O.updatable),U.goldbergData.nbSharedFaces=Q.sharedNodes,U.goldbergData.nbUnsharedFaces=Q.poleNodes,U.goldbergData.adjacentFaces=Q.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let p=0;p<Q.vertex.length;p++)U.goldbergData.faceCenters.push(d.m.Cg(Q.vertex[p])),U.goldbergData.faceCenters[p].x*=a,U.goldbergData.faceCenters[p].y*=R,U.goldbergData.faceCenters[p].z*=i,U.goldbergData.faceColors.push(new c.f(1,1,1,1));for(let p=0;p<b.face.length;p++){const V=b.face[p],O=d.m.Cg(b.vertex[V[0]]),Z=d.m.Cg(b.vertex[V[2]]),r=d.m.Cg(b.vertex[V[1]]),Y=Z.fc(O),m=r.fc(O),a=d.m.Cross(m,Y).normalize(),R=d.m.Cross(m,a).normalize();U.goldbergData.faceXaxis.push(m.normalize()),U.goldbergData.faceYaxis.push(a),U.goldbergData.faceZaxis.push(R)}return U},CreateDecal:pV,CreateCapsule:YV,CreateText:function(V,O,Z){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const a=function(V,O,Z,d){const p=Array.from(V),r=O/d.resolution,Y=(d.boundingBox.yMax-d.boundingBox.yMin+d.underlineThickness)*r,m=[];let a=0,R=0;for(let i=0;i<p.length;i++){const V=p[i];if("\n"===V)a=0,R-=Y;else{const O=FV(V,r,a,R,Z,d);O&&(a+=O.offsetX,m.push(O.shapePath))}}return m}(O,r.size||50,r.resolution||8,Z),R=[];let i=0;for(const F of a){if(!F.paths.length)continue;const O=F.holes.slice();for(const Z of F.paths){var M,c;const a=[],W=[],F=Z.getPoints();for(const V of F)W.push(new d.m(V.x,0,V.y));const Q=O.slice();for(const V of Q){const p=V.getPoints();let r=!1;for(const V of p)if(Z.isPointInside(V)){r=!0;break}if(!r)continue;const Y=[];for(const V of p)Y.push(new d.m(V.x,0,V.y));a.push(Y),O.splice(O.indexOf(V),1)}if(!a.length&&O.length)for(const V of O){const O=V.getPoints(),Z=[];for(const V of O)Z.push(new d.m(V.x,0,V.y));a.push(Z)}const b=o(V,{shape:W,holes:a.length?a:void 0,depth:r.depth||1,faceUV:r.faceUV||(null===(M=r.perLetterFaceUV)||void 0===M?void 0:M.call(r,i)),faceColors:r.faceColors||(null===(c=r.perLetterFaceColors)||void 0===c?void 0:c.call(r,i)),sideOrientation:p.c._GetDefaultSideOrientation(r.sideOrientation||p.c.DOUBLESIDE)},Y,m);R.push(b),i++}}const W=p.c.MergeMeshes(R,!0,!0);if(W){const O=W.getBoundingInfo().boundingBox;W.position.x+=-(O.minimumWorld.x+O.maximumWorld.x)/2,W.position.y+=-(O.minimumWorld.y+O.maximumWorld.y)/2,W.position.z+=-(O.minimumWorld.z+O.maximumWorld.z)/2+O.extendSize.z,W.name=V;const Z=new cV.b("pivot",Y);Z.rotation.x=-Math.PI/2,W.parent=Z,W.bakeCurrentTransformIntoVertices(),W.parent=null,Z.dispose()}return W}}},11413:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>a});var d=Z(11316),p=Z(11417),r=Z(11421),Y=Z(11435),m=Z(11441);class a{get materialDefines(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(V=this._getDrawWrapper())||void 0===V?void 0:V.defines}set materialDefines(V){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=V}_getDrawWrapper(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V??this._engine.currentRenderPassId;let Z=this._drawWrappers[V];return!Z&&O&&(this._drawWrappers[V]=Z=new m.d(this.Kk.va().getEngine())),Z}_removeDrawWrapper(V){var O;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(O=this._drawWrappers[V])||void 0===O||O.dispose());this._drawWrappers[V]=void 0}get effect(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(V=this._getDrawWrapper())||void 0===V?void 0:V.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(V){this._mainDrawWrapperOverride=V}setEffect(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=this._drawWrapper;p.setEffect(V,O,d),void 0!==Z&&(p.materialContext=Z),V||(p.defines=null,p.materialContext=void 0)}resetDrawCache(V){if(this._drawWrappers){if(void 0!==V)return void this._removeDrawWrapper(V);for(const V of this._drawWrappers)null===V||void 0===V||V.dispose()}this._drawWrappers=[]}static AddToMesh(V,O,Z,d,p,r,Y){return new a(V,O,Z,d,p,r,Y,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(V,O,Z,d,p,r,Y){let m=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],a=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=V,this.verticesStart=O,this.verticesCount=Z,this.indexStart=d,this.indexCount=p,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this.Kk=r,this._renderingMesh=Y||r,a&&r.Ef.push(this),this._engine=this.Kk.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=r.Ef.length-1,m&&(this.refreshBoundingInfo(),r.Cj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this.Kk.getTotalVertices()&&0===this.indexStart&&this.indexCount===this.Kk.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this.Kk.hasThinInstances?this.Kk.getBoundingInfo():this._boundingInfo}setBoundingInfo(V){return this._boundingInfo=V,this}getMesh(){return this.Kk}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this.Kk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Kk:null}getEffectiveMesh(){const V=this.Kk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Kk:null;return V||this._renderingMesh}Ha(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!O)return V?this.Kk.va().defaultMaterial:null;if(this._isMultiMaterial(O)){const V=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==V&&(this._currentMaterial=V,this.resetDrawCache()),V}return O}_isMultiMaterial(V){return void 0!==V.getSubMaterial}refreshBoundingInfo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.oj)return this;if(V||(V=this._renderingMesh.getVerticesData(d.e.PositionKind)),!V)return this._boundingInfo=this.Kk.getBoundingInfo(),this;const O=this._renderingMesh.qf();let Z;if(0===this.indexStart&&this.indexCount===O.length){const V=this._renderingMesh.getBoundingInfo();Z={minimum:V.minimum.clone(),maximum:V.maximum.clone()}}else Z=(0,Y.d)(V,O,this.indexStart,this.indexCount,this._renderingMesh.oj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(Z.minimum,Z.maximum):this._boundingInfo=new r.c(Z.minimum,Z.maximum),this}_checkCollision(V){return this.getBoundingInfo()._checkCollision(V)}updateBoundingInfo(V){let O=this.getBoundingInfo();return O||(this.refreshBoundingInfo(),O=this.getBoundingInfo()),O&&O.update(V),this}isInFrustum(V){const O=this.getBoundingInfo();return!!O&&O.isInFrustum(V,this.Kk.oi)}isCompletelyInFrustum(V){const O=this.getBoundingInfo();return!!O&&O.isCompletelyInFrustum(V)}render(V){return this._renderingMesh.render(this,V,this.Kk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Kk:void 0),this}_getLinesIndexBuffer(V,O){if(!this._linesIndexBuffer){const Z=[];for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=3)Z.push(V[O],V[O+1],V[O+1],V[O+2],V[O+2],V[O]);this._linesIndexBuffer=O.createIndexBuffer(Z),this._linesIndexCount=Z.length}return this._linesIndexBuffer}canIntersects(V){const O=this.getBoundingInfo();return!!O&&V.intersectsBox(O.boundingBox)}intersects(V,O,Z,d,p){const r=this.Ha();if(!r)return null;let Y=3,m=!1;switch(r.fillMode){case 3:case 5:case 6:case 8:return null;case 7:Y=1,m=!0}return 4===r.fillMode?Z.length?this._intersectLines(V,O,Z,this.Kk.intersectionThreshold,d):this._intersectUnIndexedLines(V,O,Z,this.Kk.intersectionThreshold,d):!Z.length&&this.Kk._unIndexed?this._intersectUnIndexedTriangles(V,O,Z,d,p):this._intersectTriangles(V,O,Z,Y,m,d,p)}_intersectLines(V,O,Z,d,r){let Y=null;for(let m=this.indexStart;m<this.indexStart+this.indexCount;m+=2){const a=O[Z[m]],R=O[Z[m+1]],i=V.intersectionSegment(a,R,d);if(!(i<0)&&((r||!Y||i<Y.distance)&&(Y=new p.d(null,null,i),Y.faceId=m/2,r)))break}return Y}_intersectUnIndexedLines(V,O,Z,d,r){let Y=null;for(let m=this.verticesStart;m<this.verticesStart+this.verticesCount;m+=2){const Z=O[m],a=O[m+1],R=V.intersectionSegment(Z,a,d);if(!(R<0)&&((r||!Y||R<Y.distance)&&(Y=new p.d(null,null,R),Y.faceId=m/2,r)))break}return Y}_intersectTriangles(V,O,Z,d,p,r,Y){let m=null,a=-1;for(let R=this.indexStart;R<this.indexStart+this.indexCount-(3-d);R+=d){a++;const d=Z[R],i=Z[R+1],M=Z[R+2];if(p&&4294967295===M){R+=2;continue}const c=O[d],W=O[i],F=O[M];if(!c||!W||!F)continue;if(Y&&!Y(c,W,F,V,d,i,M))continue;const Q=V.intersectsTriangle(c,W,F);if(Q){if(Q.distance<0)continue;if((r||!m||Q.distance<m.distance)&&(m=Q,m.faceId=a,r))break}}return m}_intersectUnIndexedTriangles(V,O,Z,d,p){let r=null;for(let Y=this.verticesStart;Y<this.verticesStart+this.verticesCount;Y+=3){const Z=O[Y],m=O[Y+1],a=O[Y+2];if(p&&!p(Z,m,a,V,-1,-1,-1))continue;const R=V.intersectsTriangle(Z,m,a);if(R){if(R.distance<0)continue;if((d||!r||R.distance<r.distance)&&(r=R,r.faceId=Y/3,d))break}}return r}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(V,O){const Z=new a(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,V,O,!1);if(!this.IsGlobal){const V=this.getBoundingInfo();if(!V)return Z;Z._boundingInfo=new r.c(V.minimum,V.maximum)}return Z}dispose(){this._linesIndexBuffer&&(this.Kk.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const V=this.Kk.Ef.indexOf(this);this.Kk.Ef.splice(V,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(V,O,Z,d,p){let r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=Number.MAX_VALUE,m=-Number.MAX_VALUE;const R=(p||d).qf();for(let a=O;a<O+Z;a++){const V=R[a];V<Y&&(Y=V),V>m&&(m=V)}return new a(V,Y,m-Y+1,O,Z,d,p,r)}}},12218:(V,O,Z)=>{"use strict";var d=Z(11508),p=Z(11316),r=Z(11251),Y=Z(10914),m=Z(11421);d.c.prototype.thinInstanceAdd=function(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return Y.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(V)?V.length:1);const Z=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(V))for(let d=0;d<V.length;++d)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V[d],d===V.length-1&&O);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V,O);return Z},d.c.prototype.thinInstanceAddSelf=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(r.c.IdentityReadOnly,V)},d.c.prototype.thinInstanceRegisterAttribute=function(V,O){V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),this.removeVerticesData(V),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[V]=O,this._userThinInstanceBuffersStorage.sizes[V]=O*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[V]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[V]),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new p.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!0,!1,O,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])},d.c.prototype.thinInstanceSetMatrixAt=function(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||V>=this._thinInstanceDataStorage.instancesCount)return!1;const d=this._thinInstanceDataStorage.matrixData;return O.copyToArray(d,16*V),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[V]=O),Z&&(this.Fj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},d.c.prototype.thinInstanceSetAttributeAt=function(V,O,Z){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[V]||O>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(V,0),this._userThinInstanceBuffersStorage.data[V].set(Z,O*this._userThinInstanceBuffersStorage.strides[V]),d&&this.Fj(V),!0)},Object.defineProperty(d.c.prototype,"Aj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(V){var O;const Z=this._thinInstanceDataStorage.matrixData??(null===(O=this.source)||void 0===O?void 0:O._thinInstanceDataStorage.matrixData);V<=(Z?Z.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=V)},enumerable:!0,configurable:!0}),d.c.prototype._thinInstanceCreateMatrixBuffer=function(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=new p.c(this.getEngine(),O,!Z,16,!1,!0);for(let p=0;p<4;p++)this.setVerticesBuffer(d.createVertexBuffer(V+p,4*p,4));return d},d.c.prototype.Gj=function(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var r;if(Z=Z||16,"matrix"===V)null===(r=this._thinInstanceDataStorage.matrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=O?O.length:32*Z,this._thinInstanceDataStorage.matrixData=O,this._thinInstanceDataStorage.worldMatrices=null,null!==O?(this._thinInstanceDataStorage.instancesCount=O.length/Z,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",O,d),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===V){var Y;null===(Y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Y||Y.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=O,null!==O&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",O,d))}else{var m;if(V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),null===O)null!==(m=this._userThinInstanceBuffersStorage)&&void 0!==m&&m.data[V]&&(this.removeVerticesData(V),delete this._userThinInstanceBuffersStorage.data[V],delete this._userThinInstanceBuffersStorage.strides[V],delete this._userThinInstanceBuffersStorage.sizes[V],delete this._userThinInstanceBuffersStorage.vertexBuffers[V]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[V]=O,this._userThinInstanceBuffersStorage.strides[V]=Z,this._userThinInstanceBuffersStorage.sizes[V]=O.length,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new p.e(this.getEngine(),O,V,!d,!1,Z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},d.c.prototype.Fj=function(V){var O;if("matrix"===V)this.zj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(O=this._thinInstanceDataStorage.matrixBuffer)||void 0===O||O.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===V){var Z;this.zj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(Z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Z||Z.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var d;V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),null!==(d=this._userThinInstanceBuffersStorage)&&void 0!==d&&d.vertexBuffers[V]&&(this.zj&&!this._userThinInstanceBuffersStorage.vertexBuffers[V].isUpdatable()&&this._thinInstanceRecreateBuffer(V),this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(this._userThinInstanceBuffersStorage.data[V],0))}},d.c.prototype.thinInstancePartialBufferUpdate=function(V,O,Z){var d;"matrix"===V?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(O,Z):(V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),null!==(d=this._userThinInstanceBuffersStorage)&&void 0!==d&&d.vertexBuffers[V]&&this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(O,Z))},d.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const V=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let O=0;O<this._thinInstanceDataStorage.instancesCount;++O)this._thinInstanceDataStorage.worldMatrices[O]=r.c.Cg(V,16*O)}return this._thinInstanceDataStorage.worldMatrices},d.c.prototype.thinInstanceRefreshBoundingInfo=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const d=this._thinInstanceDataStorage.boundingVectors;if(V||!this.rawBoundingInfo){d.length=0,this.refreshBoundingInfo(O,Z);const V=this.getBoundingInfo();this.rawBoundingInfo=new m.c(V.minimum,V.maximum)}const p=this.getBoundingInfo(),Y=this._thinInstanceDataStorage.matrixData;if(0===d.length)for(let r=0;r<p.boundingBox.vectors.length;++r)d.push(p.boundingBox.vectors[r].clone());r.i.ib[0].rj(Number.POSITIVE_INFINITY),r.i.ib[1].rj(Number.NEGATIVE_INFINITY);for(let m=0;m<this._thinInstanceDataStorage.instancesCount;++m){r.c.FromArrayToRef(Y,16*m,r.i.Matrix[0]);for(let V=0;V<d.length;++V)r.m.TransformCoordinatesToRef(d[V],r.i.Matrix[0],r.i.ib[2]),r.i.ib[0].minimizeInPlace(r.i.ib[2]),r.i.ib[1].maximizeInPlace(r.i.ib[2])}p.reConstruct(r.i.ib[0],r.i.ib[1]),this.Ea()},d.c.prototype._thinInstanceRecreateBuffer=function(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var Z;if("matrix"===V)null===(Z=this._thinInstanceDataStorage.matrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,O);else if("previousMatrix"===V){var d;if(this._scene.needsPreviousWorldMatrices)null===(d=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===d||d.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,O)}else{var r;V===p.e.ColorKind&&(V=p.e.ColorInstanceKind),null===(r=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===r||r.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new p.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!O,!1,this._userThinInstanceBuffersStorage.strides[V],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},d.c.prototype._thinInstanceUpdateBufferSize=function(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;V===p.e.ColorKind&&(V=p.e.ColorInstanceKind);const Z="matrix"===V;if(!Z&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[V]))return;const d=Z?16:this._userThinInstanceBuffersStorage.strides[V],r=Z?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[V];let Y=Z?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[V];const m=(this._thinInstanceDataStorage.instancesCount+O)*d;let a=r;for(;a<m;)a*=2;if(!Y||r!=a){if(Y){const V=new Float32Array(a);V.set(Y,0),Y=V}else Y=new Float32Array(a);var R,i,M;if(Z){if(null===(R=this._thinInstanceDataStorage.matrixBuffer)||void 0===R||R.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Y,!1),this._thinInstanceDataStorage.matrixData=Y,this._thinInstanceDataStorage.matrixBufferSize=a,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(i=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===i||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Y,!1)}else null===(M=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===M||M.dispose(),this._userThinInstanceBuffersStorage.data[V]=Y,this._userThinInstanceBuffersStorage.sizes[V]=a,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new p.e(this.getEngine(),Y,V,!0,!1,d,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},d.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},d.c.prototype._disposeThinInstanceSpecificData=function(){var V;null!==(V=this._thinInstanceDataStorage)&&void 0!==V&&V.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11556:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>M});var d=Z(11210),p=Z(11216),r=Z(11283),Y=Z(10902),m=Z(11251),a=Z(11521),R=Z(11041);const i=m.c.Compose(m.m.One(),m.g.FromEulerAngles(0,Math.PI,0),m.m.Zero());class M extends a.e{get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._cache.useBillboardPosition=0!==(this._billboardMode&M.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(V){V!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=V,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==M.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(V){this._infiniteDistance!==V&&(this._infiniteDistance=V)}constructor(V){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new m.m(0,0,1),this._up=new m.m(0,1,0),this._right=new m.m(1,0,0),this._position=m.m.Zero(),this._rotation=m.m.Zero(),this._rotationQuaternion=null,this._scaling=m.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=M.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Ej=m.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=m.m.Zero(),this._absoluteScaling=m.m.Zero(),this._absoluteRotationQuaternion=m.g.Identity(),this._pivotMatrix=m.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new Y.e,this._nonUniformScaling=!1,O&&this.va().addTransformNode(this)}getClassName(){return"xb"}get position(){return this._position}set position(V){this._position=V,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(V){this._rotation=V,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Af(){return this._scaling}set Af(V){this._scaling=V,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(V){this._rotationQuaternion=V,V&&this._rotation.rj(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return m.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return m.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return m.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(V){return this._poseMatrix?(this._poseMatrix.p(V),this):(this._poseMatrix=V.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=m.c.Identity()),this._poseMatrix}_isSynchronized(){const V=this._cache;return this._billboardMode===V.billboardMode&&this._billboardMode===M.BILLBOARDMODE_NONE&&(!V.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const V=this._cache;V.localMatrixUpdated=!1,V.billboardMode=-1,V.infiniteDistance=!1,V.useBillboardPosition=!1,V.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(V){return this.setPivotMatrix(V,!1)}setPivotMatrix(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(V),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=O,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=m.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const d=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0);d&&Z&&Z(this,d);for(const p of this.getChildTransformNodes(!0))p.instantiateHierarchy(d,O,Z);return d}yh(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.rj(0),this._rotationQuaternion=this._rotationQuaternion||m.g.Identity(),V.decompose(this._scaling,this._rotationQuaternion,this._position),this.Cj(!0)):(this._worldMatrix=V,this._absolutePosition.nf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Cj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Cj(!0),this}get aj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Cj(),this._absolutePosition}setAbsolutePosition(V){if(!V)return this;let O,Z,d;if(void 0===V.x){if(arguments.length<3)return this;O=arguments[0],Z=arguments[1],d=arguments[2]}else O=V.x,Z=V.y,d=V.z;if(this.parent){const V=m.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(V),m.m.TransformCoordinatesFromFloatsToRef(O,Z,d,V,this.position)}else this.position.x=O,this.position.y=Z,this.position.z=d;return this._absolutePosition.p(V),this}setPositionWithLocalVector(V){return this.Cj(),this.position=m.m.TransformNormal(V,this.Ej),this}getPositionExpressedInLocalSpace(){this.Cj();const V=m.i.Matrix[0];return this.Ej.invertToRef(V),m.m.TransformNormal(this.position,V)}locallyTranslate(V){return this.Cj(!0),this.position=m.m.TransformCoordinates(V,this.Ej),this}lookAt(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const r=M._LookAtVectorCache,Y=0===p?this.position:this.getAbsolutePosition();if(V.subtractToRef(Y,r),this.setDirection(r,O,Z,d),1===p&&this.parent)if(this.rotationQuaternion){const V=m.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(V);const O=m.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(O),O.invert(),V.multiplyToRef(O,V),this.rotationQuaternion.fromRotationMatrix(V)}else{const V=m.i.Quaternion[0];m.g.FromEulerVectorToRef(this.rotation,V);const O=m.i.Matrix[0];V.toRotationMatrix(O);const Z=m.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.invert(),O.multiplyToRef(Z,O),V.fromRotationMatrix(O),V.toEulerAnglesToRef(this.rotation)}return this}_d(V){const O=m.m.Zero();return this.getDirectionToRef(V,O),O}getDirectionToRef(V,O){return m.m.TransformNormalToRef(V,this.getWorldMatrix(),O),this}setDirection(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const p=-Math.atan2(V.z,V.x)+Math.PI/2,r=Math.sqrt(V.x*V.x+V.z*V.z),Y=-Math.atan2(V.y,r);return this.rotationQuaternion?m.g.RotationYawPitchRollToRef(p+O,Y+Z,d,this.rotationQuaternion):(this.rotation.x=Y+Z,this.rotation.y=p+O,this.rotation.z=d),this}setPivotPoint(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Cj(!0);const Z=this.getWorldMatrix();if(1==O){const O=m.i.Matrix[0];Z.invertToRef(O),V=m.m.TransformCoordinates(V,O)}return this.setPivotMatrix(m.c.Translation(-V.x,-V.y,-V.z),!0)}getPivotPoint(){const V=m.m.Zero();return this.getPivotPointToRef(V),V}getPivotPointToRef(V){return V.x=-this._pivotMatrix.m[12],V.y=-this._pivotMatrix.m[13],V.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const V=m.m.Zero();return this.getAbsolutePivotPointToRef(V),V}getAbsolutePivotPointToRef(V){return this.getPivotPointToRef(V),m.m.TransformCoordinatesToRef(V,this.getWorldMatrix(),V),this}sg(V){if(this._isDirty)return this;if(this._children)for(const O of this._children)O.sg(V);return super.sg(V)}setParent(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!V&&!this.parent)return this;const d=m.i.Quaternion[0],p=m.i.ib[0],r=m.i.ib[1],Y=m.i.Matrix[1];m.c.IdentityToRef(Y);const a=m.i.Matrix[0];this.Cj(!0);let R=this.rotationQuaternion;return R||(R=M._TmpRotation,m.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,R)),m.c.ComposeToRef(this.Af,R,this.position,a),this.parent&&a.multiplyToRef(this.parent.Cj(!0),a),V&&(V.Cj(!0).invertToRef(Y),a.multiplyToRef(Y,a)),a.decompose(r,d,p,O?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(d):d.toEulerAnglesToRef(this.rotation),this.Af.p(r),this.position.p(p),this.parent=V,Z&&this.setPivotMatrix(m.c.Identity()),this}addChild(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.setParent(this,O),this}removeChild(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.setParent(null,O),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(V){return this._nonUniformScaling!==V&&(this._nonUniformScaling=V,!0)}attachToBone(V,O){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=O,this.parent=V,V.getSkeleton().prepare(!0),V.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=V?this._currentParentWhenAttachingToBone:null,this):(V&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(V,O,Z){let d;if(V.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.rj(0)),Z&&0!==Z){if(this.parent){const Z=this.parent.getWorldMatrix(),d=m.i.Matrix[0];Z.invertToRef(d),V=m.m.TransformNormal(V,d),Z.determinant()<0&&(O*=-1)}d=m.g.RotationAxisToRef(V,O,M._RotationAxisCache),d.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else d=m.g.RotationAxisToRef(V,O,M._RotationAxisCache),this.rotationQuaternion.multiplyToRef(d,this.rotationQuaternion);return this}rotateAround(V,O,Z){O.normalize(),this.rotationQuaternion||(this.rotationQuaternion=m.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.rj(0));const d=m.i.ib[0],p=m.i.ib[1],r=m.i.ib[2],Y=m.i.Quaternion[0],a=m.i.Matrix[0],R=m.i.Matrix[1],i=m.i.Matrix[2],M=m.i.Matrix[3];return V.subtractToRef(this.position,d),m.c.TranslationToRef(d.x,d.y,d.z,a),m.c.TranslationToRef(-d.x,-d.y,-d.z,R),m.c.RotationAxisToRef(O,Z,i),R.multiplyToRef(i,M),M.multiplyToRef(a,M),M.decompose(p,Y,r),this.position.addInPlace(r),Y.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(V,O,Z){const d=V.scale(O);if(Z&&0!==Z)this.setAbsolutePosition(this.getAbsolutePosition().add(d));else{const V=this.getPositionExpressedInLocalSpace().add(d);this.setPositionWithLocalVector(V)}return this}addRotation(V,O,Z){let d;this.rotationQuaternion?d=this.rotationQuaternion:(d=m.i.Quaternion[1],m.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,d));const p=m.i.Quaternion[0];return m.g.RotationYawPitchRollToRef(O,V,Z,p),d.multiplyInPlace(p),this.rotationQuaternion||d.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==M.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Cj(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const Z=this.va().getRenderId();if(!this._isDirty&&!V&&(this._currentRenderId===Z||this.isSynchronized()))return this._currentRenderId=Z,this._worldMatrix;O=O||this.va().activeCamera,this._updateCache();const d=this._cache;d.pivotMatrixUpdated=!1,d.billboardMode=this.billboardMode,d.infiniteDistance=this.infiniteDistance,d.parent=this._parentNode,this._currentRenderId=Z,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const p=this._getEffectiveParent(),r=M._TmpScaling;let Y,a=this._position;if(this._infiniteDistance&&!this.parent&&O){const V=O.getWorldMatrix(),Z=new m.m(V.m[12],V.m[13],V.m[14]);a=M._TmpTranslation,a.nf(this._position.x+Z.x,this._position.y+Z.y,this._position.z+Z.z)}if(r.nf(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,Y=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(m.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.nf(0,0,0))}}else Y=M._TmpRotation,m.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Y);if(this._usePivotMatrix){const V=m.i.Matrix[1];m.c.ScalingToRef(r.x,r.y,r.z,V);const O=m.i.Matrix[0];Y.toRotationMatrix(O),this._pivotMatrix.multiplyToRef(V,m.i.Matrix[4]),m.i.Matrix[4].multiplyToRef(O,this.Ej),this._postMultiplyPivotMatrix&&this.Ej.multiplyToRef(this._pivotMatrixInverse,this.Ej),this.Ej.addTranslationFromFloats(a.x,a.y,a.z)}else m.c.ComposeToRef(r,Y,a,this.Ej);if(p&&p.getWorldMatrix){if(V&&p.Cj(V),d.useBillboardPath){if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),V.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),m.i.Matrix[7])}else m.i.Matrix[7].p(p.getWorldMatrix());const V=m.i.ib[5],O=m.i.ib[6],Z=m.i.Quaternion[0];m.i.Matrix[7].decompose(O,Z,V),m.c.ScalingToRef(O.x,O.y,O.z,m.i.Matrix[7]),m.i.Matrix[7].setTranslation(V),M.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(Z,V),this.Ej.setTranslation(V)),this.Ej.multiplyToRef(m.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),this.Ej.multiplyToRef(V.getFinalMatrix(),m.i.Matrix[6]),m.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Ej.multiplyToRef(p.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Ej);if(d.useBillboardPath&&O&&this.billboardMode&&!d.useBillboardPosition){const V=m.i.ib[0];if(this._worldMatrix.getTranslationToRef(V),m.i.Matrix[1].p(O.getViewMatrix()),this._scene.useRightHandedSystem&&m.i.Matrix[1].multiplyToRef(i,m.i.Matrix[1]),m.i.Matrix[1].setTranslationFromFloats(0,0,0),m.i.Matrix[1].invertToRef(m.i.Matrix[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){m.i.Matrix[0].decompose(void 0,m.i.Quaternion[0],void 0);const V=m.i.ib[1];m.i.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(V.z=0),m.c.RotationYawPitchRollToRef(V.y,V.x,V.z,m.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(m.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(m.i.ib[0])}else if(d.useBillboardPath&&O&&d.useBillboardPosition){const V=m.i.ib[0];this._worldMatrix.getTranslationToRef(V);const Z=O.globalPosition;this._worldMatrix.invertToRef(m.i.Matrix[1]);const d=m.i.ib[1];m.m.TransformCoordinatesToRef(Z,m.i.Matrix[1],d),d.normalize();const p=-Math.atan2(d.z,d.x)+Math.PI/2,r=Math.sqrt(d.x*d.x+d.z*d.z),Y=-Math.atan2(d.y,r);if(m.g.RotationYawPitchRollToRef(p,Y,0,m.i.Quaternion[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){const V=m.i.ib[1];m.i.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(V.z=0),m.c.RotationYawPitchRollToRef(V.y,V.x,V.z,m.i.Matrix[0])}else m.c.FromQuaternionToRef(m.i.Quaternion[0],m.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(m.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(m.i.ib[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):p&&p._nonUniformScaling?this._updateNonUniformScalingState(p._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.nf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=m.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Cj(),V){const V=this.getChildren();for(let O=0;O<V.length;++O){const Z=V[O];if(Z){Z.Cj();const V=m.i.Matrix[0];Z.Ej.multiplyToRef(this.Ej,V);const O=m.i.Quaternion[0];V.decompose(Z.Af,O,Z.position),Z.rotationQuaternion?Z.rotationQuaternion.p(O):O.toEulerAnglesToRef(Z.rotation)}}}this.Af.nf(1,1,1),this.position.nf(0,0,0),this.rotation.nf(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=m.g.Identity()),this._worldMatrix=m.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.add(V),this}unregisterAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.removeCallback(V),this}getPositionInCameraSpace(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.va().activeCamera),m.m.TransformCoordinates(this.getAbsolutePosition(),V.getViewMatrix())}getDistanceToCamera(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.va().activeCamera),this.getAbsolutePosition().fc(V.globalPosition).length()}clone(V,O,Z){const d=r.b.Clone((()=>new M(V,this.va())),this);if(d.name=V,d.id=V,O&&(d.parent=O),!Z){const O=this.getDescendants(!0);for(let Z=0;Z<O.length;Z++){const p=O[Z];p.clone&&p.clone(V+"."+p.name,d)}}return d}serialize(V){const O=r.b.Serialize(this,V);return O.type=this.getClassName(),O.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(O),O.localMatrix=this.getPivotMatrix().Wi(),O.isEnabled=this.isEnabled(),r.b.AppendSerializedAnimations(this,O),O.ranges=this.serializeAnimationRanges(),O}static Parse(V,O,Z){const d=r.b.Parse((()=>new M(V.name,O)),V,O,Z);if(V.localMatrix?d.setPreTransformMatrix(m.c.Cg(V.localMatrix)):V.pivotMatrix&&d.setPivotMatrix(m.c.Cg(V.pivotMatrix)),d.If(V.isEnabled),d._waitingParsedUniqueId=V.uniqueId,void 0!==V.parentId&&(d._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(d._waitingParentInstanceIndex=V.parentInstanceIndex),V.animations){for(let O=0;O<V.animations.length;O++){const Z=V.animations[O],p=(0,R.c)("BABYLON.Animation");p&&d.animations.push(p.Parse(Z))}a.e.ParseAnimationRanges(d,V,O)}return V.autoAnimate&&O.beginAnimation(d,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),d}getChildTransformNodes(V,O){const Z=[];return this._getDescendants(Z,V,(V=>(!O||O(V))&&V instanceof M)),Z}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const V=this._parentContainer.transformNodes.indexOf(this);V>-1&&this._parentContainer.transformNodes.splice(V,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),V){const V=this.getChildTransformNodes(!0);for(const O of V)O.parent=null,O.Cj(!0)}super.dispose(V,O)}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,d=null,p=null;O&&(this.rotationQuaternion?(p=this.rotationQuaternion.clone(),this.rotationQuaternion.nf(0,0,0,1)):this.rotation&&(d=this.rotation.clone(),this.rotation.nf(0,0,0)));const r=this.getHierarchyBoundingVectors(V,Z),Y=r.max.fc(r.min),m=Math.max(Y.x,Y.y,Y.z);if(0===m)return this;const a=1/m;return this.Af.scaleInPlace(a),O&&(this.rotationQuaternion&&p?this.rotationQuaternion.p(p):this.rotation&&d&&this.rotation.p(d)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}M.BILLBOARDMODE_NONE=0,M.BILLBOARDMODE_X=1,M.BILLBOARDMODE_Y=2,M.BILLBOARDMODE_Z=4,M.BILLBOARDMODE_ALL=7,M.BILLBOARDMODE_USE_POSITION=128,M.BillboardUseParentOrientation=!1,M._TmpRotation=m.g.Zero(),M._TmpScaling=m.m.Zero(),M._TmpTranslation=m.m.Zero(),M._LookAtVectorCache=new m.m(0,0,0),M._RotationAxisCache=new m.g,(0,d.c)([(0,p.G)("position")],M.prototype,"_position",void 0),(0,d.c)([(0,p.G)("rotation")],M.prototype,"_rotation",void 0),(0,d.c)([(0,p.x)("rotationQuaternion")],M.prototype,"_rotationQuaternion",void 0),(0,d.c)([(0,p.G)("Af")],M.prototype,"_scaling",void 0),(0,d.c)([(0,p.K)("billboardMode")],M.prototype,"_billboardMode",void 0),(0,d.c)([(0,p.K)()],M.prototype,"scalingDeterminant",void 0),(0,d.c)([(0,p.K)("infiniteDistance")],M.prototype,"_infiniteDistance",void 0),(0,d.c)([(0,p.K)()],M.prototype,"ignoreNonUniformScaling",void 0),(0,d.c)([(0,p.K)()],M.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11732:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>R});var d=Z(11251),p=Z(11263),r=Z(11713),Y=Z(11255),m=Z(11274);class a{constructor(V,O,Z,d){this.name=V,this.worldAxisForNormal=O,this.worldAxisForFileX=Z,this.worldAxisForFileY=d}}class R{static ConvertCubeMapTextureToSphericalPolynomial(V){var O;if(!V.isCube)return null;null===(O=V.va())||void 0===O||O.getEngine().flushFramebuffer();const Z=V.getSize().width,d=V.readPixels(0,void 0,void 0,!1),p=V.readPixels(1,void 0,void 0,!1);let r,Y;V.isRenderTarget?(r=V.readPixels(3,void 0,void 0,!1),Y=V.readPixels(2,void 0,void 0,!1)):(r=V.readPixels(2,void 0,void 0,!1),Y=V.readPixels(3,void 0,void 0,!1));const m=V.readPixels(4,void 0,void 0,!1),a=V.readPixels(5,void 0,void 0,!1),R=V.gammaSpace;let i=0;return 1!=V.textureType&&2!=V.textureType||(i=1),new Promise((V=>{Promise.all([p,d,r,Y,m,a]).then((O=>{let[d,p,r,Y,m,a]=O;const M={size:Z,right:p,left:d,up:r,down:Y,front:m,back:a,format:5,type:i,gammaSpace:R};V(this.ConvertCubeMapToSphericalPolynomial(M))}))}))}static _AreaElement(V,O){return Math.atan2(V*O,Math.sqrt(V*V+O*O+1))}static ConvertCubeMapToSphericalPolynomial(V){const O=new r.c;let Z=0;const d=2/V.size,a=d,R=.5*d,i=R-1;for(let r=0;r<6;r++){const M=this._FileFaces[r],c=V[M.name];let W=i;const F=5===V.format?4:3;for(let r=0;r<V.size;r++){let Q=i;for(let a=0;a<V.size;a++){const i=M.worldAxisForFileX.scale(Q).add(M.worldAxisForFileY.scale(W)).add(M.worldAxisForNormal);i.normalize();const b=this._AreaElement(Q-R,W-R)-this._AreaElement(Q-R,W+R)-this._AreaElement(Q+R,W-R)+this._AreaElement(Q+R,W+R);let U=c[r*V.size*F+a*F+0],H=c[r*V.size*F+a*F+1],S=c[r*V.size*F+a*F+2];isNaN(U)&&(U=0),isNaN(H)&&(H=0),isNaN(S)&&(S=0),0===V.type&&(U/=255,H/=255,S/=255),V.gammaSpace&&(U=Math.pow((0,p.c)(U),Y.l),H=Math.pow((0,p.c)(H),Y.l),S=Math.pow((0,p.c)(S),Y.l));const z=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const V=Math.max(U,H,S);if(V>z){const O=z/V;U*=O,H*=O,S*=O}}else U=(0,p.c)(U,0,z),H=(0,p.c)(H,0,z),S=(0,p.c)(S,0,z);const G=new m.b(U,H,S);O.addLight(i,G,b),Z+=b,Q+=d}W+=a}}const M=6*(4*Math.PI)/6/Z;return O.scaleInPlace(M),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),r.g.FromHarmonics(O)}}R._FileFaces=[new a("right",new d.m(1,0,0),new d.m(0,0,-1),new d.m(0,-1,0)),new a("left",new d.m(-1,0,0),new d.m(0,0,1),new d.m(0,-1,0)),new a("up",new d.m(0,1,0),new d.m(1,0,0),new d.m(0,0,1)),new a("down",new d.m(0,-1,0),new d.m(1,0,0),new d.m(0,0,-1)),new a("front",new d.m(0,0,1),new d.m(1,0,0),new d.m(0,-1,0)),new a("back",new d.m(0,0,-1),new d.m(-1,0,0),new d.m(0,-1,0))],R.MAX_HDRI_VALUE=4096,R.PRESERVE_CLAMPED_COLORS=!1},11259:(V,O,Z)=>{"use strict";function d(V,O){const Z=[];for(let d=0;d<V;++d)Z.push(O());return Z}function p(V,O){return d(V,O)}Z.d(O,{c:()=>d,g:()=>p,k:()=>Y});const r=["push","splice","pop","shift","unshift"];function Y(V,O){const Z=r.map((Z=>function(V,O,Z){const d=V[O];if("function"!==typeof d)return null;const p=function(){const d=V.length,r=p.previous.apply(V,arguments);return Z(O,d),r};return d.next=p,p.previous=d,V[O]=p,()=>{const Z=p.previous;if(!Z)return;const d=p.next;d?(Z.next=d,d.previous=Z):(Z.next=void 0,V[O]=Z),p.next=void 0,p.previous=void 0}}(V,Z,O)));return()=>{Z.forEach((V=>{null===V||void 0===V||V()}))}}},12170:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>Y});var d=Z(11467),p=Z(12172);let r=0;const Y=V=>{if(!V.environmentBRDFTexture){const O=V.useDelayedTextureLoading;V.useDelayedTextureLoading=!1;const Z=V._blockEntityCollection;V._blockEntityCollection=!1;const Y=d.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+r++,V,!0,!1,d.b.BILINEAR_SAMPLINGMODE);V._blockEntityCollection=Z;const m=V.getEngine().getLoadedTexturesCache(),a=m.indexOf(Y.getInternalTexture());-1!==a&&m.splice(a,1),Y.isRGBD=!0,Y.wrapU=d.b.CLAMP_ADDRESSMODE,Y.wrapV=d.b.CLAMP_ADDRESSMODE,V.environmentBRDFTexture=Y,V.useDelayedTextureLoading=O,p.b.ExpandRGBDTexture(Y);const R=V.getEngine().onContextRestoredObservable.add((()=>{Y.isRGBD=!0;const O=V.onBeforeRenderObservable.add((()=>{Y.isReady()&&(V.onBeforeRenderObservable.remove(O),p.b.ExpandRGBDTexture(Y))}))}));V.Xi.add((()=>{V.getEngine().onContextRestoredObservable.remove(R)}))}return V.environmentBRDFTexture}},11517:(V,O,Z)=>{"use strict";function d(V,O,Z){try{const d=V.next();d.done?O(d):d.value?d.value.then((()=>{d.value=void 0,O(d)}),Z):O(d)}catch(d){Z(d)}}function p(){let V,O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(Z,p,r)=>{const Y=performance.now();void 0===V||Y-V>O?(V=Y,setTimeout((()=>{d(Z,p,r)}),0)):d(Z,p,r)}}function r(V,O,Z,d,p){const r=()=>{let Y;const m=V=>{V.done?Z(V.value):void 0===Y?Y=!0:r()};do{Y=void 0,p&&p.aborted?d(new Error("Aborted")):O(V,m,d),void 0===Y&&(Y=!1)}while(Y)};r()}function Y(V,O){let Z;return r(V,d,(V=>Z=V),(V=>{throw V}),O),Z}function m(V,O,Z){return new Promise(((d,p)=>{r(V,O,d,p,Z)}))}function a(V,O){return function(){return Y(V(...arguments),O)}}Z.d(O,{c:()=>p,e:()=>a,g:()=>m,i:()=>Y})},11726:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>F});var d=Z(11263),p=Z(10914),r=Z(11732),Y=Z(11740);Z(11766);const m=131072,a=131072;function R(V){return V.charCodeAt(0)+(V.charCodeAt(1)<<8)+(V.charCodeAt(2)<<16)+(V.charCodeAt(3)<<24)}const i=R("DXT1"),M=R("DXT3"),c=R("DXT5"),W=R("DX10");class F{static GetDDSInfo(V){const O=new Int32Array(V.buffer,V.byteOffset,31),Z=new Int32Array(V.buffer,V.byteOffset,35);let d=1;O[2]&m&&(d=Math.max(1,O[7]));const p=O[21],r=p===W?Z[32]:0;let Y=0;switch(p){case 113:Y=2;break;case 116:Y=1;break;case W:if(10===r){Y=2;break}if(2===r){Y=1;break}}return{width:O[4],height:O[3],mipmapCount:d,isFourCC:4===(4&O[20]),isRGB:64===(64&O[20]),isLuminance:(O[20]&a)===a,isCube:512===(512&O[28]),isCompressed:p===i||p===M||p===c,dxgiFormat:r,textureType:Y}}static _GetHalfFloatAsFloatRGBAArrayBuffer(V,O,Z,d,p,r){const m=new Float32Array(d),a=new Uint16Array(p,Z);let R=0;for(let i=0;i<O;i++)for(let O=0;O<V;O++){const Z=4*(O+i*V);m[R]=(0,Y.h)(a[Z]),m[R+1]=(0,Y.h)(a[Z+1]),m[R+2]=(0,Y.h)(a[Z+2]),F.StoreLODInAlphaChannel?m[R+3]=r:m[R+3]=(0,Y.h)(a[Z+3]),R+=4}return m}static _GetHalfFloatRGBAArrayBuffer(V,O,Z,d,p,r){if(F.StoreLODInAlphaChannel){const m=new Uint16Array(d),a=new Uint16Array(p,Z);let R=0;for(let Z=0;Z<O;Z++)for(let O=0;O<V;O++){const d=4*(O+Z*V);m[R]=a[d],m[R+1]=a[d+1],m[R+2]=a[d+2],m[R+3]=(0,Y.j)(r),R+=4}return m}return new Uint16Array(p,Z,d)}static _GetFloatRGBAArrayBuffer(V,O,Z,d,p,r){if(F.StoreLODInAlphaChannel){const Y=new Float32Array(d),m=new Float32Array(p,Z);let a=0;for(let Z=0;Z<O;Z++)for(let O=0;O<V;O++){const d=4*(O+Z*V);Y[a]=m[d],Y[a+1]=m[d+1],Y[a+2]=m[d+2],Y[a+3]=r,a+=4}return Y}return new Float32Array(p,Z,d)}static _GetFloatAsHalfFloatRGBAArrayBuffer(V,O,Z,d,p,r){const m=new Uint16Array(d),a=new Float32Array(p,Z);let R=0;for(let i=0;i<O;i++)for(let O=0;O<V;O++)m[R]=(0,Y.j)(a[R]),m[R+1]=(0,Y.j)(a[R+1]),m[R+2]=(0,Y.j)(a[R+2]),F.StoreLODInAlphaChannel?m[R+3]=(0,Y.j)(r):m[R+3]=(0,Y.j)(a[R+3]),R+=4;return m}static _GetFloatAsUIntRGBAArrayBuffer(V,O,Z,p,r,Y){const m=new Uint8Array(p),a=new Float32Array(r,Z);let R=0;for(let i=0;i<O;i++)for(let O=0;O<V;O++){const Z=4*(O+i*V);m[R]=255*(0,d.c)(a[Z]),m[R+1]=255*(0,d.c)(a[Z+1]),m[R+2]=255*(0,d.c)(a[Z+2]),F.StoreLODInAlphaChannel?m[R+3]=Y:m[R+3]=255*(0,d.c)(a[Z+3]),R+=4}return m}static _GetHalfFloatAsUIntRGBAArrayBuffer(V,O,Z,p,r,m){const a=new Uint8Array(p),R=new Uint16Array(r,Z);let i=0;for(let M=0;M<O;M++)for(let O=0;O<V;O++){const Z=4*(O+M*V);a[i]=255*(0,d.c)((0,Y.h)(R[Z])),a[i+1]=255*(0,d.c)((0,Y.h)(R[Z+1])),a[i+2]=255*(0,d.c)((0,Y.h)(R[Z+2])),F.StoreLODInAlphaChannel?a[i+3]=m:a[i+3]=255*(0,d.c)((0,Y.h)(R[Z+3])),i+=4}return a}static _GetRGBAArrayBuffer(V,O,Z,d,p,r,Y,m,a){const R=new Uint8Array(d),i=new Uint8Array(p,Z);let M=0;for(let c=0;c<O;c++)for(let O=0;O<V;O++){const Z=4*(O+c*V);R[M]=i[Z+r],R[M+1]=i[Z+Y],R[M+2]=i[Z+m],R[M+3]=i[Z+a],M+=4}return R}static _ExtractLongWordOrder(V){return 0===V||255===V||-16777216===V?0:1+F._ExtractLongWordOrder(V>>8)}static _GetRGBArrayBuffer(V,O,Z,d,p,r,Y,m){const a=new Uint8Array(d),R=new Uint8Array(p,Z);let i=0;for(let M=0;M<O;M++)for(let O=0;O<V;O++){const Z=3*(O+M*V);a[i]=R[Z+r],a[i+1]=R[Z+Y],a[i+2]=R[Z+m],i+=3}return a}static _GetLuminanceArrayBuffer(V,O,Z,d,p){const r=new Uint8Array(d),Y=new Uint8Array(p,Z);let m=0;for(let a=0;a<O;a++)for(let O=0;O<V;O++){const Z=O+a*V;r[m]=Y[Z],m++}return r}static UploadDDSLevels(V,O,Z,d,Y,a){let R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,Q=arguments.length>7?arguments[7]:void 0,b=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],U=null;d.sphericalPolynomial&&(U=[]);const H=!!V.getCaps().s3tc;O.generateMipMaps=Y;const S=new Int32Array(Z.buffer,Z.byteOffset,31);let z,G,w,t,C,v,A,l=0,I=0,g=1;if(542327876!==S[0])return void p.b.Error("Invalid magic number in DDS header");if(!d.isFourCC&&!d.isRGB&&!d.isLuminance)return void p.b.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(d.isCompressed&&!H)return void p.b.Error("Compressed textures are not supported on this platform.");let n=S[22];t=S[1]+4;let e=!1;if(d.isFourCC)switch(z=S[21],z){case i:g=8,I=33777;break;case M:g=16,I=33778;break;case c:g=16,I=33779;break;case 113:e=!0,n=64;break;case 116:e=!0,n=128;break;case W:{t+=20;let V=!1;switch(d.dxgiFormat){case 10:e=!0,n=64,V=!0;break;case 2:e=!0,n=128,V=!0;break;case 88:d.isRGB=!0,d.isFourCC=!1,n=32,V=!0}if(V)break}default:return void p.b.Error(["Unsupported FourCC code:",(u=z,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))])}var u;const k=F._ExtractLongWordOrder(S[23]),D=F._ExtractLongWordOrder(S[24]),X=F._ExtractLongWordOrder(S[25]),o=F._ExtractLongWordOrder(S[26]);e&&(I=V._getRGBABufferInternalSizedFormat(d.textureType)),v=1,S[2]&m&&!1!==Y&&(v=Math.max(1,S[7]));const E=Q||0,L=V.getCaps();for(let p=E;p<a;p++){for(G=S[4],w=S[3],A=0;A<v;++A){if(-1===R||R===A){const r=-1===R?A:0;if(!d.isCompressed&&d.isFourCC){O.format=5,l=G*w*4;let d=null;if(V._badOS||V._badDesktopOS||!L.textureHalfFloat&&!L.textureFloat)128===n?(d=F._GetFloatAsUIntRGBAArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,r),U&&0==r&&U.push(F._GetFloatRGBAArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,r))):64===n&&(d=F._GetHalfFloatAsUIntRGBAArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,r),U&&0==r&&U.push(F._GetHalfFloatAsFloatRGBAArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,r))),O.type=0;else{const V=L.textureFloat&&(b&&L.textureFloatLinearFiltering||!b),p=L.textureHalfFloat&&(b&&L.textureHalfFloatLinearFiltering||!b),Y=(128===n||64===n&&!p)&&V?1:(64===n||128===n&&!V)&&p?2:0;let m,a=null;if(128===n)switch(Y){case 1:m=F._GetFloatRGBAArrayBuffer,a=null;break;case 2:m=F._GetFloatAsHalfFloatRGBAArrayBuffer,a=F._GetFloatRGBAArrayBuffer;break;case 0:m=F._GetFloatAsUIntRGBAArrayBuffer,a=F._GetFloatRGBAArrayBuffer}else switch(Y){case 1:m=F._GetHalfFloatAsFloatRGBAArrayBuffer,a=null;break;case 2:m=F._GetHalfFloatRGBAArrayBuffer,a=F._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:m=F._GetHalfFloatAsUIntRGBAArrayBuffer,a=F._GetHalfFloatAsFloatRGBAArrayBuffer}O.type=Y,d=m(G,w,Z.byteOffset+t,l,Z.buffer,r),U&&0==r&&U.push(a?a(G,w,Z.byteOffset+t,l,Z.buffer,r):d)}d&&V._uploadDataToTextureDirectly(O,d,p,r)}else if(d.isRGB)O.type=0,24===n?(O.format=4,l=G*w*3,C=F._GetRGBArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,k,D,X),V._uploadDataToTextureDirectly(O,C,p,r)):(O.format=5,l=G*w*4,C=F._GetRGBAArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer,k,D,X,o),V._uploadDataToTextureDirectly(O,C,p,r));else if(d.isLuminance){const d=V._getUnpackAlignement(),Y=G;l=Math.floor((G+d-1)/d)*d*(w-1)+Y,C=F._GetLuminanceArrayBuffer(G,w,Z.byteOffset+t,l,Z.buffer),O.format=1,O.type=0,V._uploadDataToTextureDirectly(O,C,p,r)}else l=Math.max(4,G)/4*Math.max(4,w)/4*g,C=new Uint8Array(Z.buffer,Z.byteOffset+t,l),O.type=0,V._uploadCompressedDataToTextureDirectly(O,I,G,w,C,p,r)}t+=n?G*w*(n/8):l,G*=.5,w*=.5,G=Math.max(1,G),w=Math.max(1,w)}if(void 0!==Q)break}U&&U.length>0?d.sphericalPolynomial=r.e.ConvertCubeMapToSphericalPolynomial({size:S[4],right:U[0],left:U[1],up:U[2],down:U[3],front:U[4],back:U[5],format:5,type:1,gammaSpace:!1}):d.sphericalPolynomial=void 0}}F.StoreLODInAlphaChannel=!1},11223:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>r,i:()=>Y});const d={},p={};function r(V){const O=V.getClassName();return p[O]||(p[O]={}),p[O]}function Y(V){const O=V.getClassName();if(d[O])return d[O];d[O]={};const Z=d[O];let r=V,Y=O;for(;Y;){const V=p[Y];for(const p in V)Z[p]=V[p];let O,d=!1;do{if(O=Object.getPrototypeOf(r),!O.getClassName){d=!0;break}if(O.getClassName()!==Y)break;r=O}while(O);if(d)break;Y=O.getClassName(),r=O}return Z}},11216:(V,O,Z)=>{"use strict";Z.d(O,{A:()=>m,E:()=>i,G:()=>M,K:()=>Y,b:()=>r,e:()=>H,g:()=>W,k:()=>a,o:()=>F,q:()=>R,s:()=>Q,u:()=>U,w:()=>c,x:()=>b});var d=Z(11223);function p(V,O){return(Z,p)=>{const r=(0,d.e)(Z);r[p]||(r[p]={type:V,sourceName:O})}}function r(V){return function(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(Z,d)=>{const p=O||"_"+d;Object.defineProperty(Z,d,{get:function(){return this[p]},set:function(O){"function"===typeof this.equals&&this.equals(O)||this[p]!==O&&(this[p]=O,Z[V].apply(this))},enumerable:!0,configurable:!0})}}(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function Y(V){return p(0,V)}function m(V){return p(1,V)}function a(V){return p(2,V)}function R(V){return p(3,V)}function i(V){return p(4,V)}function M(V){return p(5,V)}function c(V){return p(6,V)}function W(V){return p(7,V)}function F(V){return p(8,V)}function Q(V){return p(9,V)}function b(V){return p(10,V)}function U(V){return p(12,V)}function H(V,O,Z,d){const p=Z.value;Z.value=function(){let Z=p;if("undefined"!==typeof _native&&_native[O]){const V=_native[O];Z=d?function(){return d(...arguments)?V(...arguments):p(...arguments)}:V}return V[O]=Z,Z(...arguments)}}H.filter=function(V){return(O,Z,d)=>H(O,Z,d,V)}},11283:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>R});var d=Z(10928),p=Z(11243),r=Z(11274),Y=Z(11251),m=Z(11223);const a=function(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=V();p.e&&p.e.HasTags(O)&&p.e.AddTagsTo(r,p.e.GetTags(O,!0));const Y=(0,m.i)(r),a={};for(const p in Y){const V=Y[p],m=O[p],i=V.type;if(void 0!==m&&null!==m&&("uniqueId"!==p||R.AllowLoadingUniqueId))switch(i){case 0:case 6:case 11:r[p]=m;break;case 1:d.cloneTexturesOnlyOnce&&a[m.uniqueId]?r[p]=a[m.uniqueId]:(r[p]=Z||m.isRenderTarget?m:m.clone(),a[m.uniqueId]=r[p]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[p]=Z?m:m.clone()}}return r};class R{static AppendSerializedAnimations(V,O){if(V.animations){O.animations=[];for(let Z=0;Z<V.animations.length;Z++){const d=V.animations[Z];O.animations.push(d.serialize())}}}static Serialize(V,O){O||(O={}),p.e&&(O.tags=p.e.GetTags(V));const Z=(0,m.i)(V);for(const d in Z){const p=Z[d],r=p.sourceName||d,Y=p.type,m=V[d];if(void 0!==m&&null!==m&&("uniqueId"!==d||R.AllowLoadingUniqueId))switch(Y){case 0:O[r]=m;break;case 1:case 3:case 7:case 9:O[r]=m.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:O[r]=m.Wi();break;case 6:case 11:O[r]=m.id}}return O}static ParseProperties(V,O,Z,d){d||(d="");const p=(0,m.i)(O);for(const m in p){const a=p[m],i=V[a.sourceName||m],M=a.type;if(void 0!==i&&null!==i&&("uniqueId"!==m||R.AllowLoadingUniqueId)){const V=O;switch(M){case 0:V[m]=i;break;case 1:Z&&(V[m]=R._TextureParser(i,Z,d));break;case 2:V[m]=r.b.Cg(i);break;case 3:V[m]=R._FresnelParametersParser(i);break;case 4:V[m]=Y.l.Cg(i);break;case 5:V[m]=Y.m.Cg(i);break;case 6:Z&&(V[m]=Z.getLastMeshById(i));break;case 7:V[m]=R._ColorCurvesParser(i);break;case 8:V[m]=r.f.Cg(i);break;case 9:V[m]=R._ImageProcessingConfigurationParser(i);break;case 10:V[m]=Y.g.Cg(i);break;case 11:Z&&(V[m]=Z.getCameraById(i));break;case 12:V[m]=Y.c.Cg(i)}}}}static Parse(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=V();return p.e&&p.e.AddTagsTo(r,O.tags),R.ParseProperties(O,r,Z,d),r}static Clone(V,O){return a(V,O,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(V,O){return a(V,O,!0)}}R.AllowLoadingUniqueId=!1,R._ImageProcessingConfigurationParser=V=>{throw(0,d.c)("ImageProcessingConfiguration")},R._FresnelParametersParser=V=>{throw(0,d.c)("FresnelParameters")},R._ColorCurvesParser=V=>{throw(0,d.c)("ColorCurves")},R._TextureParser=(V,O,Z)=>{throw(0,d.c)("Texture")}},10919:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>r});var d=Z(10914);const p=(V,O,Z)=>V?V.getClassName&&"Mesh"===V.getClassName()?null:!V.getClassName||"SubMesh"!==V.getClassName()&&"PhysicsBody"!==V.getClassName()?V.clone?V.clone():Array.isArray(V)?V.slice():Z&&"object"===typeof V?{...V}:null:V.clone(O):null;class r{static DeepCopy(V,O,Z,r){let Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=function(V){const O=[];do{Object.getOwnPropertyNames(V).forEach((function(V){-1===O.indexOf(V)&&O.push(V)}))}while(V=Object.getPrototypeOf(V));return O}(V);for(const R of m){if("_"===R[0]&&(!r||-1===r.indexOf(R)))continue;if(R.endsWith("Observable"))continue;if(Z&&-1!==Z.indexOf(R))continue;const m=V[R],i=typeof m;if("function"!==i)try{if("object"===i)if(m instanceof Uint8Array)O[R]=Uint8Array.from(m);else if(m instanceof Array){if(O[R]=[],m.length>0)if("object"==typeof m[0])for(let V=0;V<m.length;V++){const Z=p(m[V],O,Y);-1===O[R].indexOf(Z)&&O[R].push(Z)}else O[R]=m.slice(0)}else O[R]=p(m,O,Y);else O[R]=m}catch(a){d.b.Warn(a.message)}}}}},10928:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>p});const d={};function p(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!d[V])return d[V]=!0,`${V} needs to be imported before as it contains a side-effect required by your code.`}},10906:(V,O,Z)=>{"use strict";function d(){return"undefined"!==typeof window}function p(){return"undefined"!==typeof navigator}function r(){return"undefined"!==typeof document}function Y(V){let O="",Z=V.firstChild;for(;Z;)3===Z.nodeType&&(O+=Z.textContent),Z=Z.nextSibling;return O}Z.d(O,{c:()=>Y,f:()=>r,j:()=>p,n:()=>d})},12209:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{Dispose:()=>c,DumpData:()=>M,DumpDataAsync:()=>i,DumpFramebuffer:()=>R,DumpTools:()=>W});var d=Z(11753),p=Z(10900),r=Z(11263),Y=Z(10942);let m,a=null;async function R(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const m=await Z.readPixels(0,0,V,O);M(V,O,new Uint8Array(m.buffer),d,p,r,!0,void 0,Y)}function i(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7?arguments[7]:void 0;return new Promise((a=>{M(V,O,Z,(V=>a(V)),d,p,r,Y,m)}))}function M(V,O,R,i){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8?arguments[8]:void 0;(async function(){return a||(a=new Promise(((V,O)=>{let p,r=null;const a={Yg:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Z.bind(Z,11678)).then((R=>{let{ThinEngine:i}=R;try{p=new OffscreenCanvas(100,100),r=new i(p,!1,a)}catch(W){p=document.createElement("canvas"),r=new i(p,!1,a)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((V=>{r&&V!==r&&!r.u&&0===Y.e.Instances.length&&c()})),r.getCaps().parallelShaderCompile=void 0;const M=new d.e(r);Z.e(34).then(Z.bind(Z,13374)).then((Z=>{let{passPixelShader:Y}=Z;if(!r)return void O("Engine is not defined");const a=new d.g({bd:r,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});m={canvas:p,bd:r,renderer:M,wrapper:a},V(m)}))})).catch(O)}))),await a})().then((Z=>{if(Z.bd.setSize(V,O,!0),R instanceof Float32Array){const V=new Uint8Array(R.length);let O=R.length;for(;O--;){const Z=R[O];V[O]=Math.round(255*(0,r.c)(Z))}R=V}const d=Z.bd.createRawTexture(R,V,O,5,!1,!F,1);Z.renderer.setViewport(),Z.renderer.applyEffectWrapper(Z.wrapper),Z.wrapper.effect._bindTexture("textureSampler",d),Z.renderer.draw(),Q?p.e.ToBlob(Z.canvas,(V=>{const O=new FileReader;O.onload=V=>{const O=V.target.result;i&&i(O)},O.readAsArrayBuffer(V)}),M,b):p.e.EncodeScreenshotCanvasData(Z.canvas,i,M,W,b),d.dispose()}))}function c(){var V;m?(m.wrapper.dispose(),m.renderer.dispose(),m.bd.dispose()):null===(V=a)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.bd.dispose()}));a=null,m=null}const W={DumpData:M,DumpDataAsync:i,DumpFramebuffer:R,Dispose:c};p.e.DumpData=M,p.e.DumpDataAsync=i,p.e.DumpFramebuffer=R},12200:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>F,g:()=>U,h:()=>z,k:()=>G});var d=Z(10900),p=Z(11251),r=Z(11263),Y=Z(11713),m=Z(11013),a=Z(11471),R=(Z(11238),Z(11748)),i=Z(10914);Z(12172),Z(12185),Z(12209);const M="image/png",c=2,W=[134,22,135,150,246,214,150,54];function F(V){const O=new DataView(V.buffer,V.byteOffset,V.byteLength);let Z=0;for(let Y=0;Y<W.length;Y++)if(O.getUint8(Z++)!==W[Y])return i.b.Error("Not a babylon environment map"),null;let d="",p=0;for(;p=O.getUint8(Z++);)d+=String.fromCharCode(p);let r=JSON.parse(d);return r=Q(r),r.ah&&(r.ah.specularDataPosition=Z,r.ah.lodGenerationScale=r.ah.lodGenerationScale||.8),r}function Q(V){if(V.version>c)throw new Error(`Unsupported babylon environment map version "${V.version}". Latest supported version is "${c}".`);return 2===V.version?V:V={...V,version:2,imageType:M}}function b(V,O){const Z=(O=Q(O)).ah;let d=Math.log2(O.width);if(d=Math.round(d)+1,Z.mipmaps.length!==6*d)throw new Error(`Unsupported specular mipmaps number "${Z.mipmaps.length}"`);const p=new Array(d);for(let r=0;r<d;r++){p[r]=new Array(6);for(let O=0;O<6;O++){const d=Z.mipmaps[6*r+O];p[r][O]=new Uint8Array(V.buffer,V.byteOffset+Z.specularDataPosition+d.position,d.length)}}return p}function U(V,O,Z){const d=(Z=Q(Z)).ah;if(!d)return Promise.resolve();V._lodGenerationScale=d.lodGenerationScale;return S(V,b(O,Z),Z.imageType)}function H(V,O,Z,d,p,r,Y,m,a,R,i){return new Promise(((M,c)=>{if(Z){const Z=O.createTexture(null,!0,!0,null,1,null,(V=>{c(V)}),V);null===d||void 0===d||d.onEffectCreatedObservable.addOnce((m=>{m.executeWhenCompiled((()=>{d.externalTextureSamplerBinding=!0,d.onApply=d=>{d._bindTexture("textureSampler",Z),d.setFloat2("scale",1,O._features.needsInvertingBitmap&&V instanceof ImageBitmap?-1:1)},O.scenes.length&&(O.scenes[0].postProcessManager.directRender([d],R,!0,r,Y),O.restoreDefaultFramebuffer(),Z.dispose(),URL.revokeObjectURL(p),M())}))}))}else{if(O._uploadImageToTexture(i,V,r,Y),m){const Z=a[Y];Z&&O._uploadImageToTexture(Z._texture,V,r,0)}M()}}))}async function S(V,O){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M;if(!d.e.IsExponentOfTwo(V.width))throw new Error("Texture size must be a power of two");const Y=(0,r.k)(V.width)+1,i=V.getEngine();let c=!1,W=!1,F=null,Q=null,b=null;const U=i.getCaps();V.format=5,V.type=0,V.generateMipMaps=!0,V._cachedAnisotropicFilteringLevel=null,i.updateTextureSamplingMode(3,V),U.textureLOD?i._features.supportRenderAndCopyToLodForFloatTextures?U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering?(c=!0,V.type=2):U.textureFloatRender&&U.textureFloatLinearFiltering&&(c=!0,V.type=1):c=!1:(c=!1,W=!0,b={});let S=0;if(c)i.isWebGPU?(S=1,await Z.e(39).then(Z.bind(Z,13404))):await Z.e(41).then(Z.bind(Z,13414)),F=new R.c("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,V.type,void 0,null,!1,void 0,S),V._isRGBD=!1,V.invertY=!1,Q=i.createRenderTargetCubeTexture(V.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:V.type,format:5});else if(V._isRGBD=!0,V.invertY=!0,W){const O=3,Z=V._lodGenerationScale,d=V._lodGenerationOffset;for(let p=0;p<O;p++){const r=(Y-1)*Z+d,R=d+(r-d)*(1-p/(O-1)),M=Math.round(Math.min(Math.max(R,0),r)),c=new m.d(i,2);c.isCube=!0,c.invertY=!0,c.generateMipMaps=!1,i.updateTextureSamplingMode(2,c);const W=new a.c(null);switch(W._isCube=!0,W._texture=c,b[M]=W,p){case 0:V._lodTextureLow=W;break;case 1:V._lodTextureMid=W;break;case 2:V._lodTextureHigh=W}}}const z=[];for(let Z=0;Z<O.length;Z++)for(let d=0;d<6;d++){const r=O[Z][d],Y=new Blob([r],{type:p}),m=URL.createObjectURL(Y);let a;if(i._features.forceBitmapOverHTMLImageElement)a=i.createImageBitmap(Y,{premultiplyAlpha:"none"}).then((O=>H(O,i,c,F,m,d,Z,W,b,Q,V)));else{const O=new Image;O.src=m,a=new Promise(((p,r)=>{O.onload=()=>{H(O,i,c,F,m,d,Z,W,b,Q,V).then((()=>p())).catch((V=>{r(V)}))},O.onerror=V=>{r(V)}}))}z.push(a)}if(O.length<Y){let Z;const d=Math.pow(2,Y-1-O.length),p=d*d*4;switch(V.type){case 0:Z=new Uint8Array(p);break;case 2:Z=new Uint16Array(p);break;case 1:Z=new Float32Array(p)}for(let r=O.length;r<Y;r++)for(let O=0;O<6;O++)i._uploadArrayBufferViewToTexture(V,Z,O,r)}return Promise.all(z).then((()=>{Q&&(i._releaseTexture(V),Q._swapAndDie(V)),F&&F.dispose(),W&&(V._lodTextureHigh&&V._lodTextureHigh._texture&&(V._lodTextureHigh._texture.isReady=!0),V._lodTextureMid&&V._lodTextureMid._texture&&(V._lodTextureMid._texture.isReady=!0),V._lodTextureLow&&V._lodTextureLow._texture&&(V._lodTextureLow._texture.isReady=!0))}))}function z(V,O){const Z=(O=Q(O)).irradiance;if(!Z)return;const d=new Y.g;p.m.FromArrayToRef(Z.x,0,d.x),p.m.FromArrayToRef(Z.y,0,d.y),p.m.FromArrayToRef(Z.z,0,d.z),p.m.FromArrayToRef(Z.xx,0,d.xx),p.m.FromArrayToRef(Z.yy,0,d.yy),p.m.FromArrayToRef(Z.zz,0,d.zz),p.m.FromArrayToRef(Z.yz,0,d.yz),p.m.FromArrayToRef(Z.zx,0,d.zx),p.m.FromArrayToRef(Z.xy,0,d.xy),V._sphericalPolynomial=d}function G(V,O,Z,d,p){const r=S(V.getEngine().createRawCubeTexture(null,V.width,V.format,V.type,V.generateMipMaps,V.invertY,V.samplingMode,V._compression),O).then((()=>V));return V.onRebuildCallback=V=>({proxy:r,isReady:!0,isAsync:!0}),V._source=13,V._bufferViewArrayArray=O,V._lodGenerationScale=d,V._lodGenerationOffset=p,V._sphericalPolynomial=Z,S(V,O).then((()=>(V.isReady=!0,V)))}},10951:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d,d:()=>p,e:()=>r});class d extends Error{}d._setPrototypeOf=Object.setPrototypeOf||((V,O)=>(V.__proto__=O,V));const p={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class r extends d{constructor(V,O,Z){super(V),this.errorCode=O,this.innerError=Z,this.name="RuntimeError",d._setPrototypeOf(this,r.prototype)}}},10947:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>g,f:()=>S,j:()=>l,o:()=>C,n:()=>b,p:()=>w,t:()=>t,u:()=>v,x:()=>z});var d=Z(10933),p=Z(10906),r=Z(10902);class Y{}Y.FilesToLoad={};var m=Z(10951),a=Z(10959),R=Z(10965),i=Z(10942),M=Z(10914),c=Z(10979),W=Z(10970),F=Z(10983);const Q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class b extends m.e{constructor(V,O){super(V,m.d.LoadFileError),this.name="LoadFileError",m.b._setPrototypeOf(this,b.prototype),O instanceof d.b?this.request=O:this.file=O}}class U extends m.e{constructor(V,O){super(V,m.d.RequestFileError),this.request=O,this.name="RequestFileError",m.b._setPrototypeOf(this,U.prototype)}}class H extends m.e{constructor(V,O){super(V,m.d.ReadFileError),this.file=O,this.name="ReadFileError",m.b._setPrototypeOf(this,H.prototype)}}const S={DefaultRetryStrategy:class{static ExponentialBackoff(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(Z,d,p)=>0!==d.status||p>=V||-1!==Z.indexOf("file:")?-1:Math.pow(2,p)*O}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:V=>V,ScriptBaseUrl:"",ScriptPreprocessUrl:V=>V,CleanUrl:V=>V=V.replace(/#/gm,"%23")},z=(V,O)=>{if((!V||0!==V.indexOf("data:"))&&S.CorsBehavior)if("string"===typeof S.CorsBehavior||S.CorsBehavior instanceof String)O.crossOrigin=S.CorsBehavior;else{const Z=S.CorsBehavior(V);Z&&(O.crossOrigin=Z)}},G={getRequiredSize:null},w=function(V,O,Z,p){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",m=arguments.length>5?arguments[5]:void 0;const R=i.e.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===R||void 0===R||!R._features.forceBitmapOverHTMLImageElement))return Z("LoadImage is only supported in web or BabylonNative environments."),null;let M,c=!1;V instanceof ArrayBuffer||ArrayBuffer.isView(V)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(M=URL.createObjectURL(new Blob([V],{type:r})),c=!0):M=`data:${r};base64,`+(0,a.k)(V):V instanceof Blob?(M=URL.createObjectURL(V),c=!0):(M=S.CleanUrl(V),M=S.PreprocessUrl(M));const W=O=>{if(Z){const d=M||V.toString();Z(`Error while trying to load image: ${0===d.indexOf("http")||d.length<=128?d:d.slice(0,128)+"..."}`,O)}};if(null!==R&&void 0!==R&&R._features.forceBitmapOverHTMLImageElement)return C(M,(d=>{R.createImageBitmap(new Blob([d],{type:r}),{premultiplyAlpha:"none",...m}).then((V=>{O(V),c&&URL.revokeObjectURL(M)})).catch((O=>{Z&&Z("Error while trying to load image: "+V,O)}))}),void 0,p||void 0,!0,((V,O)=>{W(O)})),null;const F=new Image;if(G.getRequiredSize){const O=G.getRequiredSize(V);O.width&&(F.width=O.width),O.height&&(F.height=O.height)}z(M,F);const Q=[],b=()=>{Q.forEach((V=>{V.target.removeEventListener(V.name,V.handler)})),Q.length=0};Q.push({target:F,name:"load",handler:()=>{b(),O(F),c&&F.src&&URL.revokeObjectURL(F.src)}}),Q.push({target:F,name:"error",handler:V=>{b(),W(V),c&&F.src&&URL.revokeObjectURL(F.src)}}),Q.push({target:document,name:"securitypolicyviolation",handler:V=>{if(V.blockedURI!==F.src||"_l"===V.disposition)return;b();const O=new Error(`CSP violation of policy ${V.effectiveDirective} ${V.blockedURI}. Current policy is ${V.originalPolicy}`);i.e.UseFallbackTexture=!1,W(O),c&&F.src&&URL.revokeObjectURL(F.src),F.src=""}}),Q.forEach((V=>{V.target.addEventListener(V.name,V.handler)}));const U="blob:"===M.substring(0,5),H="data:"===M.substring(0,5),w=()=>{U||H||!d.b.IsCustomRequestAvailable?F.src=M:C(M,((V,O,Z)=>{const d=new Blob([V],{type:!r&&Z?Z:r}),p=URL.createObjectURL(d);c=!0,F.src=p}),void 0,p||void 0,!0,((V,O)=>{W(O)}))},t=()=>{p&&p.loadImage(M,F)};if(!U&&!H&&p&&p.enableTexturesOffline)p.open(t,w);else{if(-1!==M.indexOf("file:")){const V=decodeURIComponent(M.substring(5).toLowerCase());if(Y.FilesToLoad[V]&&"undefined"!==typeof URL){try{let O;try{O=URL.createObjectURL(Y.FilesToLoad[V])}catch(v){O=URL.createObjectURL(Y.FilesToLoad[V])}F.src=O,c=!0}catch(A){F.src=""}return F}}w()}return F},t=(V,O,Z,d,p)=>{const Y=new FileReader,m={onCompleteObservable:new r.e,abort:()=>Y.abort()};return Y.onloadend=()=>m.onCompleteObservable.notifyObservers(m),p&&(Y.onerror=()=>{p(new H(`Unable to read ${V.name}`,V))}),Y.onload=V=>{O(V.target.result)},Z&&(Y.onprogress=Z),d?Y.readAsArrayBuffer(V):Y.readAsText(V),m},C=(V,O,Z,d,p,a,R)=>{if(V.name)return t(V,O,Z,p,a?V=>{a(void 0,V)}:void 0);const i=V;if(-1!==i.indexOf("file:")){let V=decodeURIComponent(i.substring(5).toLowerCase());0===V.indexOf("./")&&(V=V.substring(2));const d=Y.FilesToLoad[V];if(d)return t(d,O,Z,p,a?V=>a(void 0,new b(V.message,V.file)):void 0)}const{match:W,type:F}=I(i);if(W){const V={onCompleteObservable:new r.e,abort:()=>()=>{}};try{const V=p?g(i):n(i);O(V,void 0,F)}catch(m){a?a(void 0,m):M.b.Error(m.message||"Failed to parse the Data URL")}return c.d.SetImmediate((()=>{V.onCompleteObservable.notifyObservers(V)})),V}return v(i,((V,Z)=>{O(V,null===Z||void 0===Z?void 0:Z.responseURL,null===Z||void 0===Z?void 0:Z.getResponseHeader("content-type"))}),Z,d,p,a?V=>{a(V.request,new b(V.message,V.request))}:void 0,R)},v=(V,O,Z,Y,m,a,R)=>{V=S.CleanUrl(V),V=S.PreprocessUrl(V);const i=S.BaseUrl+V;let c=!1;const W={onCompleteObservable:new r.e,abort:()=>c=!0},F=()=>{let V,r=new d.b,Y=null;const F=()=>{r&&(Z&&r.removeEventListener("progress",Z),V&&r.removeEventListener("readystatechange",V),r.removeEventListener("loadend",Q))};let Q=()=>{F(),W.onCompleteObservable.notifyObservers(W),W.onCompleteObservable.clear(),Z=void 0,V=null,Q=null,a=void 0,R=void 0,O=void 0};W.abort=()=>{c=!0,Q&&Q(),r&&r.readyState!==(XMLHttpRequest.DONE||4)&&r.abort(),null!==Y&&(clearTimeout(Y),Y=null),r=null};const b=V=>{const O=V.message||"Unknown error";a&&r?a(new U(O,r)):M.b.Error(O)},H=M=>{if(r){if(r.open("GET",i),R)try{R(r)}catch(W){return void b(W)}m&&(r.responseType="arraybuffer"),Z&&r.addEventListener("progress",Z),Q&&r.addEventListener("loadend",Q),V=()=>{if(!c&&r&&r.readyState===(XMLHttpRequest.DONE||4)){if(V&&r.removeEventListener("readystatechange",V),r.status>=200&&r.status<300||0===r.status&&(!(0,p.n)()||A())){try{O&&O(m?r.response:r.responseText,r)}catch(W){b(W)}return}const Z=S.DefaultRetryStrategy;if(Z){const V=Z(i,r,M);if(-1!==V)return F(),r=new d.b,void(Y=setTimeout((()=>H(M+1)),V))}const R=new U("Error status: "+r.status+" "+r.statusText+" - Unable to load "+i,r);a&&a(R)}},r.addEventListener("readystatechange",V),r.send()}};H(0)};if(Y&&Y.enableSceneOffline){const d=V=>{V&&V.status>400?a&&a(V):F()},p=()=>{Y&&Y.loadFile(S.BaseUrl+V,(V=>{!c&&O&&O(V),W.onCompleteObservable.notifyObservers(W)}),Z?V=>{!c&&Z&&Z(V)}:void 0,d,m)};Y.open(p,d)}else F();return W},A=()=>"undefined"!==typeof location&&"file:"===location.protocol,l=V=>Q.test(V),I=V=>{const O=Q.exec(V);if(null===O||0===O.length)return{match:!1,type:""};return{match:!0,type:O[0].replace("data:","").replace("base64,","")}};function g(V){return(0,a.d)(V.split(",")[1])}const n=V=>(0,a.h)(V.split(",")[1]);let e;F.e._FileToolsLoadImage=w,W.b.loadFile=C,R.n.loadFile=C;((V,O,Z,d,p,r,Y,m,a,R)=>{e={DecodeBase64UrlToBinary:V,DecodeBase64UrlToString:O,DefaultRetryStrategy:Z.DefaultRetryStrategy,BaseUrl:Z.BaseUrl,CorsBehavior:Z.CorsBehavior,PreprocessUrl:Z.PreprocessUrl,IsBase64DataUrl:d,IsFileURL:p,LoadFile:r,LoadImage:Y,ReadFile:m,RequestFile:a,SetCorsBehavior:R},Object.defineProperty(e,"DefaultRetryStrategy",{get:function(){return Z.DefaultRetryStrategy},set:function(V){Z.DefaultRetryStrategy=V}}),Object.defineProperty(e,"BaseUrl",{get:function(){return Z.BaseUrl},set:function(V){Z.BaseUrl=V}}),Object.defineProperty(e,"PreprocessUrl",{get:function(){return Z.PreprocessUrl},set:function(V){Z.PreprocessUrl=V}}),Object.defineProperty(e,"CorsBehavior",{get:function(){return Z.CorsBehavior},set:function(V){Z.CorsBehavior=V}})})(g,n,S,l,A,C,w,t,v,z)},11045:(V,O,Z)=>{"use strict";function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(V=>{const O=16*Math.random()|0;return("x"===V?O:3&O|8).toString(16)}))}Z.d(O,{b:()=>d})},11036:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(10914),p=Z(11041);class r{static Instantiate(V){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[V])return this.RegisteredExternalClasses[V];const O=(0,p.c)(V);if(O)return O;d.b.Warn(V+" not found, you may have missed an import.");const Z=V.split(".");let r=window||this;for(let d=0,p=Z.length;d<p;d++)r=r[Z[d]];return"function"!==typeof r?null:r}}r.RegisteredExternalClasses={}},10914:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d});class d{static _CheckLimit(V,O){let Z=d._LogLimitOutputs[V];return Z?Z.current++:(Z={limit:O,current:1},d._LogLimitOutputs[V]=Z),Z.current<=Z.limit}static _GenerateLimitMessage(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Z=d._LogLimitOutputs[V];if(!Z||!d.MessageLimitReached)return;const p=this._Levels[O];Z.current===Z.limit&&d[p.name](d.MessageLimitReached.replace(/%LIMIT%/g,""+Z.limit).replace(/%TYPE%/g,p.name??""))}static _AddLogEntry(V){d._LogCache=V+d._LogCache,d.OnNewCacheEntry&&d.OnNewCacheEntry(V)}static _FormatMessage(V){const O=V=>V<10?"0"+V:""+V,Z=new Date;return"["+O(Z.getHours())+":"+O(Z.getMinutes())+":"+O(Z.getSeconds())+"]: "+V}static _LogDisabled(V,O){}static _LogEnabled(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const p=Array.isArray(O)?O[0]:O;if(void 0!==Z&&!d._CheckLimit(p,Z))return;const r=d._FormatMessage(p),Y=this._Levels[V],m=Array.isArray(O)?O.slice(1):[];Y.logFunc&&Y.logFunc("BJS - "+r,...m);const a=`<div style='color:${Y.color}'>${r}</div><br>`;d._AddLogEntry(a),d._GenerateLimitMessage(p,V)}static get LogCache(){return d._LogCache}static ClearLogCache(){d._LogCache="",d._LogLimitOutputs={},d.errorsCount=0}static set LogLevels(V){d.Log=d._LogDisabled,d.Warn=d._LogDisabled,d.Error=d._LogDisabled,[d.MessageLogLevel,d.WarningLogLevel,d.ErrorLogLevel].forEach((O=>{if((V&O)===O){const V=this._Levels[O];d[V.name]=d._LogEnabled.bind(d,O)}}))}}d.NoneLogLevel=0,d.MessageLogLevel=1,d.WarningLogLevel=2,d.ErrorLogLevel=4,d.AllLogLevel=7,d.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",d._LogCache="",d._LogLimitOutputs={},d._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],d.errorsCount=0,d.Log=d._LogEnabled.bind(d,d.MessageLogLevel),d.Warn=d._LogEnabled.bind(d,d.WarningLogLevel),d.Error=d._LogEnabled.bind(d,d.ErrorLogLevel)},10902:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>r});class d{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this.initialize(V,O,Z,d)}initialize(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;return this.mask=V,this.skipNextObservers=O,this.target=Z,this.currentTarget=d,this}}class p{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=V,this.mask=O,this.scope=Z,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class r{static FromPromise(V,O){const Z=new r;return V.then((V=>{Z.notifyObservers(V)})).catch((V=>{if(!O)throw V;O.notifyObservers(V)})),Z}get observers(){return this._observers}constructor(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=O,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new d(0),V&&(this._onObserverAdded=V)}add(V){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)return null;const d=new p(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return d.unregisterOnNextCall=Z,O?this._observers.unshift(d):this._observers.push(d),this._onObserverAdded&&this._onObserverAdded(d),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(d,this._lastNotifiedValue),d._remove=()=>{this.remove(d)},d}addOnce(V){return this.add(V,void 0,void 0,void 0,!0)}remove(V){if(!V)return!1;V._remove=null;return-1!==this._observers.indexOf(V)&&(this._deferUnregister(V),!0)}removeCallback(V,O){for(let Z=0;Z<this._observers.length;Z++){const d=this._observers[Z];if(!d._willBeUnregistered&&(d.callback===V&&(!O||O===d.scope)))return this._deferUnregister(d),!0}return!1}_deferUnregister(V){V._willBeUnregistered||(this._numObserversMarkedAsDeleted++,V.unregisterOnNextCall=!1,V._willBeUnregistered=!0,setTimeout((()=>{this._remove(V)}),0))}_remove(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V)return!1;const Z=this._observers.indexOf(V);return-1!==Z&&(O&&this._numObserversMarkedAsDeleted--,this._observers.splice(Z,1),!0)}makeObserverTopPriority(V){this._remove(V,!1),this._observers.unshift(V)}makeObserverBottomPriority(V){this._remove(V,!1),this._observers.push(V)}notifyObservers(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),!this._observers.length)return!0;const r=this._eventState;r.mask=O,r.target=Z,r.currentTarget=d,r.skipNextObservers=!1,r.lastReturnValue=V,r.userInfo=p;for(const Y of this._observers)if(!Y._willBeUnregistered&&(Y.mask&O&&(Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.scope?r.lastReturnValue=Y.callback.apply(Y.scope,[V,r]):r.lastReturnValue=Y.callback(V,r)),r.skipNextObservers))return!1;return!0}notifyObserver(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=O),V._willBeUnregistered)return;const d=this._eventState;d.mask=Z,d.skipNextObservers=!1,V.unregisterOnNextCall&&this._deferUnregister(V),V.callback(O,d)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const V=this._observers.pop();V&&(V._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const V=new r;return V._observers=this._observers.slice(0),V}hasSpecificMask(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const O of this._observers)if(O.mask&V||O.mask===V)return!0;return!1}}},11053:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>p});var d=Z(10926);class p{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(V,O){p.Enabled&&(this._current+=V,O&&this._fetchResult())}beginMonitoring(){p.Enabled&&(this._startMonitoringTime=d.c.Now)}endMonitoring(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!p.Enabled)return;V&&this.fetchNewFrame();const O=d.c.Now;this._current=O-this._startMonitoringTime,V&&this._fetchResult()}Ti(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const V=d.c.Now;V-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=V,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}p.Enabled=!0},10926:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>p});var d=Z(10906);class p{static get Now(){return(0,d.n)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12172:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(11748),p=Z(11740);class r{static ExpandRGBDTexture(V){const O=V._texture;if(!O||!V.isRGBD)return;const p=O.getEngine(),r=p.getCaps(),Y=O.isReady;let m=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(m=!0,O.type=2):r.textureFloatRender&&r.textureFloatLinearFiltering&&(m=!0,O.type=1),m&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const a=async()=>{const r=p.isWebGPU,Y=r?1:0;O.isReady=!1,r?await Promise.all([Z.e(39).then(Z.bind(Z,13404)),Z.e(40).then(Z.bind(Z,13408))]):await Promise.all([Z.e(41).then(Z.bind(Z,13414)),Z.e(42).then(Z.bind(Z,13420))]);const m=new d.c("rgbdDecode","rgbdDecode",null,null,1,null,3,p,!1,void 0,O.type,void 0,null,!1,void 0,Y);m.externalTextureSamplerBinding=!0;const a=p.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});m.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{m.onApply=V=>{V._bindTexture("textureSampler",O),V.setFloat2("scale",1,1)},V.va().postProcessManager.directRender([m],a,!0),p.restoreDefaultFramebuffer(),p._releaseTexture(O),m&&m.dispose(),a._swapAndDie(O),O.isReady=!0}))}))};m&&(Y?a():V.onLoadObservable.addOnce(a))}static EncodeTextureToRGBD(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.d)("rgbdEncode",V,O,Z,1,5)}}},11230:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p,h:()=>d});class d{constructor(V){this.length=0,this.data=new Array(V),this._id=d._GlobalId++}push(V){this.data[this.length++]=V,this.length>this.data.length&&(this.data.length*=2)}forEach(V){for(let O=0;O<this.length;O++)V(this.data[O])}sort(V){this.data.sort(V)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let O=0;O<V.length;O++)this.data[this.length++]=(V.data||V)[O]}}indexOf(V){const O=this.data.indexOf(V);return O>=this.length?-1:O}contains(V){return-1!==this.indexOf(V)}}d._GlobalId=0;class p extends d{constructor(){super(...arguments),this._duplicateId=0}push(V){super.push(V),V.__smartArrayFlags||(V.__smartArrayFlags={}),V.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(V){return(!V.__smartArrayFlags||V.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(V),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let O=0;O<V.length;O++){const Z=(V.data||V)[O];this.pushNoDuplicate(Z)}}}}},10959:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y,h:()=>r,i:()=>d,k:()=>p});const d=V=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(V);let O="";for(let Z=0;Z<V.byteLength;Z++)O+=String.fromCharCode(V[Z]);return O},p=V=>{const O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Z,d,p,r,Y,m,a,R="",i=0;const M=ArrayBuffer.isView(V)?new Uint8Array(V.buffer,V.byteOffset,V.byteLength):new Uint8Array(V);for(;i<M.length;)Z=M[i++],d=i<M.length?M[i++]:Number.NaN,p=i<M.length?M[i++]:Number.NaN,r=Z>>2,Y=(3&Z)<<4|d>>4,m=(15&d)<<2|p>>6,a=63&p,isNaN(d)?m=a=64:isNaN(p)&&(a=64),R+=O.charAt(r)+O.charAt(Y)+O.charAt(m)+O.charAt(a);return R},r=V=>atob(V),Y=V=>{const O=r(V),Z=O.length,d=new Uint8Array(new ArrayBuffer(Z));for(let p=0;p<Z;p++)d[p]=O.charCodeAt(p);return d.buffer}},11243:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});class d{static Eval(V,O){return"true"===(V=V.match(/\([^()]*\)/g)?V.replace(/\([^()]*\)/g,(V=>(V=V.slice(1,V.length-1),d._HandleParenthesisContent(V,O)))):d._HandleParenthesisContent(V,O))||"false"!==V&&d.Eval(V,O)}static _HandleParenthesisContent(V,O){let Z;O=O||(V=>"true"===V);const p=V.split("||");for(const r in p)if(Object.prototype.hasOwnProperty.call(p,r)){let V=d._SimplifyNegation(p[r].trim());const Y=V.split("&&");if(Y.length>1)for(let p=0;p<Y.length;++p){const r=d._SimplifyNegation(Y[p].trim());if(Z="true"!==r&&"false"!==r?"!"===r[0]?!O(r.substring(1)):O(r):"true"===r,!Z){V="false";break}}if(Z||"true"===V){Z=!0;break}Z="true"!==V&&"false"!==V?"!"===V[0]?!O(V.substring(1)):O(V):"true"===V}return Z?"true":"false"}static _SimplifyNegation(V){return"!true"===(V=(V=V.replace(/^[\s!]+/,(V=>(V=V.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?V="false":"!false"===V&&(V="true"),V}}class p{static EnableFor(V){V._tags=V._tags||{},V.hasTags=()=>p.HasTags(V),V.addTags=O=>p.AddTagsTo(V,O),V.removeTags=O=>p.RemoveTagsFrom(V,O),V.matchesTagsQuery=O=>p.MatchesQuery(V,O)}static DisableFor(V){delete V._tags,delete V.hasTags,delete V.addTags,delete V.removeTags,delete V.matchesTagsQuery}static HasTags(V){if(!V._tags)return!1;const O=V._tags;for(const Z in O)if(Object.prototype.hasOwnProperty.call(O,Z))return!0;return!1}static GetTags(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V._tags)return null;if(O){const O=[];for(const Z in V._tags)Object.prototype.hasOwnProperty.call(V._tags,Z)&&!0===V._tags[Z]&&O.push(Z);return O.join(" ")}return V._tags}static AddTagsTo(V,O){if(!O)return;if("string"!==typeof O)return;O.split(" ").forEach((function(O){p._AddTagTo(V,O)}))}static _AddTagTo(V,O){""!==(O=O.trim())&&"true"!==O&&"false"!==O&&(O.match(/[\s]/)||O.match(/^([!]|([|]|[&]){2})/)||(p.EnableFor(V),V._tags[O]=!0))}static RemoveTagsFrom(V,O){if(!p.HasTags(V))return;const Z=O.split(" ");for(const d in Z)p._RemoveTagFrom(V,Z[d])}static _RemoveTagFrom(V,O){delete V._tags[O]}static MatchesQuery(V,O){return void 0===O||(""===O?p.HasTags(V):d.Eval(O,(O=>p.HasTags(V)&&V._tags[O])))}}},11740:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>a,h:()=>c,j:()=>M});Z(11467),Z(11743);var d=Z(11748),p=Z(10983),r=Z(11041),Y=Z(11283);class m extends d.c{getClassName(){return"PassPostProcess"}constructor(V,O){super(V,"pass",null,null,O,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(V,O){V?(this._webGPUReady=!0,O.push(Promise.all([Z.e(33).then(Z.bind(Z,13365))]))):O.push(Promise.all([Z.e(34).then(Z.bind(Z,13374))])),super._gatherImports(V,O)}static _Parse(V,O,Z,d){return Y.b.Parse((()=>new m(V.name,V.options,O,V.renderTargetSamplingMode,V._engine,V.reusable)),V,Z,d)}}(0,r.f)("BABYLON.PassPostProcess",m);d.c;function a(V,O,Z,p,r,Y,m,a){const R=O.getEngine();return O.isReady=!1,r=r??O.samplingMode,p=p??O.type,Y=Y??O.format,m=m??O.width,a=a??O.height,-1===p&&(p=0),new Promise((i=>{const M=new d.c("postprocess",V,null,null,1,null,r,R,!1,void 0,p,void 0,null,!1,Y);M.externalTextureSamplerBinding=!0;const c=R.createRenderTargetTexture({width:m,height:a},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:r,type:p,format:Y});M.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{M.onApply=V=>{V._bindTexture("textureSampler",O),V.setFloat2("scale",1,1)},Z.postProcessManager.directRender([M],c,!0),R.restoreDefaultFramebuffer(),R._releaseTexture(O),M&&M.dispose(),c._swapAndDie(O),O.type=p,O.format=5,O.isReady=!0,i(O)}))}))}))}let R,i;function M(V){R||(R=new Float32Array(1),i=new Int32Array(R.buffer)),R[0]=V;const O=i[0];let Z=O>>16&32768,d=O>>12&2047;const p=O>>23&255;return p<103?Z:p>142?(Z|=31744,Z|=(255==p?0:1)&&8388607&O,Z):p<113?(d|=2048,Z|=(d>>114-p)+(d>>113-p&1),Z):(Z|=p-112<<10|d>>1,Z+=1&d,Z)}function c(V){const O=(32768&V)>>15,Z=(31744&V)>>10,d=1023&V;return 0===Z?(O?-1:1)*Math.pow(2,-14)*(d/Math.pow(2,10)):31==Z?d?NaN:1/0*(O?-1:1):(O?-1:1)*Math.pow(2,Z-15)*(1+d/Math.pow(2,10))}p.e._RescalePostProcessFactory=V=>new m("rescale",1,null,2,V,!1,0)},10979:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>p});var d=Z(10906);class p{static SetImmediate(V){(0,d.n)()&&window.setImmediate?window.setImmediate(V):setTimeout(V,1)}}},11049:(V,O,Z)=>{"use strict";function d(V){let O=1;do{O*=2}while(O<V);return O===V}function p(V,O,Z){return V*(1-Z)+O*Z}function r(V){const O=Y(V),Z=m(V);return O-V>V-Z?Z:O}function Y(V){return V--,V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,V|=V>>16,++V}function m(V){return V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,(V|=V>>16)-(V>>1)}function a(V,O){let Z;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:Z=m(V);break;case 2:Z=r(V);break;default:Z=Y(V)}return Math.min(Z,O)}Z.d(O,{c:()=>m,g:()=>a,k:()=>d,o:()=>p,p:()=>r})},10900:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>U,e:()=>b});var d=Z(10902),p=Z(10906),r=Z(10914),Y=Z(10919),m=Z(10926),a=Z(10928),R=Z(10933),i=Z(10942),M=Z(10947),c=Z(10979),W=Z(11036),F=Z(11045),Q=Z(11049);class b{static get BaseUrl(){return M.f.BaseUrl}static set BaseUrl(V){M.f.BaseUrl=V}static get CleanUrl(){return M.f.CleanUrl}static set CleanUrl(V){M.f.CleanUrl=V}static IsAbsoluteUrl(V){return 0===V.indexOf("//")||-1!==V.indexOf("://")&&(-1!==V.indexOf(".")&&(-1!==V.indexOf("/")&&(!(V.indexOf(":")>V.indexOf("/"))&&(V.indexOf("://")<V.indexOf(".")||(0===V.indexOf("data:")||0===V.indexOf("blob:"))))))}static set ScriptBaseUrl(V){M.f.ScriptBaseUrl=V}static get ScriptBaseUrl(){return M.f.ScriptBaseUrl}static set ScriptPreprocessUrl(V){M.f.ScriptPreprocessUrl=V}static get ScriptPreprocessUrl(){return M.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return M.f.DefaultRetryStrategy}static set DefaultRetryStrategy(V){M.f.DefaultRetryStrategy=V}static get CorsBehavior(){return M.f.CorsBehavior}static set CorsBehavior(V){M.f.CorsBehavior=V}static get UseFallbackTexture(){return i.e.UseFallbackTexture}static set UseFallbackTexture(V){i.e.UseFallbackTexture=V}static get RegisteredExternalClasses(){return W.b.RegisteredExternalClasses}static set RegisteredExternalClasses(V){W.b.RegisteredExternalClasses=V}static get fallbackTexture(){return i.e.FallbackTexture}static set fallbackTexture(V){i.e.FallbackTexture=V}static FetchToRef(V,O,Z,d,p,r){const Y=4*((Math.abs(V)*Z%Z|0)+(Math.abs(O)*d%d|0)*Z);r.r=p[Y]/255,r.g=p[Y+1]/255,r.b=p[Y+2]/255,r.a=p[Y+3]/255}static Mix(V,O,Z){return 0}static Instantiate(V){return W.b.Instantiate(V)}static SetImmediate(V){c.d.SetImmediate(V)}static IsExponentOfTwo(V){return!0}static FloatRound(V){return Math.fround(V)}static GetFilename(V){const O=V.lastIndexOf("/");return O<0?V:V.substring(O+1)}static GetFolderPath(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Z=V.lastIndexOf("/");return Z<0?O?V:"":V.substring(0,Z+1)}static ToDegrees(V){return 180*V/Math.PI}static ToRadians(V){return V*Math.PI/180}static SmoothAngleChange(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const d=this.ToRadians(V),p=this.ToRadians(O);return this.ToDegrees(Math.atan2((1-Z)*Math.sin(p)+Z*Math.sin(d),(1-Z)*Math.cos(p)+Z*Math.cos(d)))}static MakeArray(V,O){return!0===O||void 0!==V&&null!=V?Array.isArray(V)?V:[V]:null}static GetPointerPrefix(V){return(0,p.n)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(V,O){(0,M.x)(V,O)}static SetReferrerPolicyBehavior(V,O){O.referrerPolicy=V}static get PreprocessUrl(){return M.f.PreprocessUrl}static set PreprocessUrl(V){M.f.PreprocessUrl=V}static LoadImage(V,O,Z,d,p,r){return(0,M.p)(V,O,Z,d,p,r)}static LoadFile(V,O,Z,d,p,r){return(0,M.o)(V,O,Z,d,p,r)}static LoadFileAsync(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((Z,d)=>{(0,M.o)(V,(V=>{Z(V)}),void 0,void 0,O,((V,O)=>{d(O)}))}))}static GetBabylonScriptURL(V,O){if(!V)return"";if(b.ScriptBaseUrl&&V.startsWith(b._DefaultCdnUrl)){const O="/"===b.ScriptBaseUrl[b.ScriptBaseUrl.length-1]?b.ScriptBaseUrl.substring(0,b.ScriptBaseUrl.length-1):b.ScriptBaseUrl;V=V.replace(b._DefaultCdnUrl,O)}return V=b.ScriptPreprocessUrl(V),O&&(V=b.GetAbsoluteUrl(V)),V}static LoadBabylonScript(V,O,Z,d){V=b.GetBabylonScriptURL(V),b.LoadScript(V,O,Z)}static LoadBabylonScriptAsync(V){return V=b.GetBabylonScriptURL(V),b.LoadScriptAsync(V)}static LoadScript(V,O,Z,d){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(V),O&&O()}catch(a){null===Z||void 0===Z||Z(`Unable to load script '${V}' in worker`,a)}return}if(!(0,p.n)())return void(null===Z||void 0===Z||Z(`Cannot load script '${V}' outside of a window or a worker`));const Y=document.getElementsByTagName("head")[0],m=document.createElement("script");r?(m.setAttribute("type","module"),m.innerText=V):(m.setAttribute("type","text/javascript"),m.setAttribute("src",V)),d&&(m.id=d),m.onload=()=>{O&&O()},m.onerror=O=>{Z&&Z(`Unable to load script '${V}'`,O)},Y.appendChild(m)}static LoadScriptAsync(V,O){return new Promise(((Z,d)=>{this.LoadScript(V,(()=>{Z()}),((V,O)=>{d(O||new Error(V))}),O)}))}static ReadFileAsDataURL(V,O,Z){const p=new FileReader,r={onCompleteObservable:new d.e,abort:()=>p.abort()};return p.onloadend=()=>{r.onCompleteObservable.notifyObservers(r)},p.onload=V=>{O(V.target.result)},p.onprogress=Z,p.readAsDataURL(V),r}static ReadFile(V,O,Z,d,p){return(0,M.t)(V,O,Z,d,p)}static FileAsURL(V){const O=new Blob([V]);return window.URL.createObjectURL(O)}static Format(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return V.toFixed(O)}static DeepCopy(V,O,Z,d){Y.d.DeepCopy(V,O,Z,d)}static IsEmpty(V){for(const O in V)if(Object.prototype.hasOwnProperty.call(V,O))return!1;return!0}static RegisterTopRootEvents(V,O){for(let d=0;d<O.length;d++){const p=O[d];V.addEventListener(p.name,p.handler,!1);try{window.parent&&window.parent.addEventListener(p.name,p.handler,!1)}catch(Z){}}}static UnregisterTopRootEvents(V,O){for(let d=0;d<O.length;d++){const p=O[d];V.removeEventListener(p.name,p.handler);try{V.parent&&V.parent.removeEventListener(p.name,p.handler)}catch(Z){}}}static async DumpFramebuffer(V,O,Z,d){throw(0,a.c)("DumpTools")}static DumpData(V,O,Z,d){throw(0,a.c)("DumpTools")}static DumpDataAsync(V,O,Z){throw(0,a.c)("DumpTools")}static _IsOffScreenCanvas(V){return void 0!==V.convertToBlob}static ToBlob(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",d=arguments.length>3?arguments[3]:void 0;b._IsOffScreenCanvas(V)||V.toBlob||(V.toBlob=function(V,O,Z){setTimeout((()=>{const d=atob(this.toDataURL(O,Z).split(",")[1]),p=d.length,r=new Uint8Array(p);for(let V=0;V<p;V++)r[V]=d.charCodeAt(V);V(new Blob([r]))}))}),b._IsOffScreenCanvas(V)?V.convertToBlob({type:Z,quality:d}).then((V=>O(V))):V.toBlob((function(V){O(V)}),Z,d)}static DownloadBlob(V,O){if("download"in document.createElement("a")){if(!O){const V=new Date;O="screenshot_"+((V.getFullYear()+"-"+(V.getMonth()+1)).slice(2)+"-"+V.getDate()+"_"+V.getHours()+"-"+("0"+V.getMinutes()).slice(-2))+".png"}b.Download(V,O)}else if(V&&"undefined"!==typeof URL){const O=URL.createObjectURL(V),Z=window.open("");if(!Z)return;const d=Z.document.createElement("img");d.onload=function(){URL.revokeObjectURL(O)},d.src=O,Z.document.body.appendChild(d)}}static EncodeScreenshotCanvasData(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;if("string"!==typeof d&&O){if(O){if(b._IsOffScreenCanvas(V))return void V.convertToBlob({type:Z,quality:p}).then((V=>{const Z=new FileReader;Z.readAsDataURL(V),Z.onloadend=()=>{const V=Z.result;O(V)}}));const d=V.toDataURL(Z,p);O(d)}}else this.ToBlob(V,(function(V){V&&b.DownloadBlob(V,d),O&&O("")}),Z,p)}static Download(V,O){if("undefined"===typeof URL)return;const Z=window.URL.createObjectURL(V),d=document.createElement("a");document.body.appendChild(d),d.style.display="none",d.href=Z,d.download=O,d.addEventListener("click",(()=>{d.parentElement&&d.parentElement.removeChild(d)})),d.click(),window.URL.revokeObjectURL(Z)}static BackCompatCameraNoPreventDefault(V){return"boolean"===typeof V[0]?V[0]:"boolean"===typeof V[1]&&V[1]}static CreateScreenshot(V,O,Z,d){throw(0,a.c)("ScreenshotTools")}static CreateScreenshotAsync(V,O,Z){throw(0,a.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(V,O,Z,d){throw(0,a.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(V,O,Z){throw(0,a.c)("ScreenshotTools")}static RandomId(){return(0,F.b)()}static IsBase64(V){return(0,M.j)(V)}static DecodeBase64(V){return(0,M.b)(V)}static get errorsCount(){return r.b.errorsCount}static Log(V){r.b.Log(V)}static Warn(V){r.b.Warn(V)}static Error(V){r.b.Error(V)}static get LogCache(){return r.b.LogCache}static ClearLogCache(){r.b.ClearLogCache()}static set LogLevels(V){r.b.LogLevels=V}static set PerformanceLogLevel(V){return(V&b.PerformanceUserMarkLogLevel)===b.PerformanceUserMarkLogLevel?(b.StartPerformanceCounter=b._StartUserMark,void(b.EndPerformanceCounter=b._EndUserMark)):(V&b.PerformanceConsoleLogLevel)===b.PerformanceConsoleLogLevel?(b.StartPerformanceCounter=b._StartPerformanceConsole,void(b.EndPerformanceCounter=b._EndPerformanceConsole)):(b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,void(b.EndPerformanceCounter=b._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(V,O){}static _EndPerformanceCounterDisabled(V,O){}static _StartUserMark(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!b._Performance){if(!(0,p.n)())return;b._Performance=window.performance}O&&b._Performance.mark&&b._Performance.mark(V+"-Begin")}static _EndUserMark(V){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&b._Performance.mark&&(b._Performance.mark(V+"-End"),b._Performance.measure(V,V+"-Begin",V+"-End"))}static _StartPerformanceConsole(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];O&&(b._StartUserMark(V,O),console.time&&console.time(V))}static _EndPerformanceConsole(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];O&&(b._EndUserMark(V,O),console.timeEnd(V))}static get Now(){return m.c.Now}static GetClassName(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=null;if(!O&&V.getClassName)Z=V.getClassName();else{if(V instanceof Object){Z=(O?V:Object.getPrototypeOf(V)).constructor.__bjsclassName__}Z||(Z=typeof V)}return Z}static First(V,O){for(const Z of V)if(O(Z))return Z;return null}static getFullClassName(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=null,d=null;if(!O&&V.getClassName)Z=V.getClassName();else{if(V instanceof Object){const p=O?V:Object.getPrototypeOf(V);Z=p.constructor.__bjsclassName__,d=p.constructor.__bjsmoduleName__}Z||(Z=typeof V)}return Z?(null!=d?d+".":"")+Z:null}static DelayAsync(V){return new Promise((O=>{setTimeout((()=>{O()}),V)}))}static IsSafari(){return!!(0,p.j)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}b.UseCustomRequestHeaders=!1,b.CustomRequestHeaders=R.b.CustomRequestHeaders,b.GetDOMTextContent=p.c,b._DefaultCdnUrl="https://cdn.babylonjs.com",b.GetAbsoluteUrl="object"===typeof document?V=>{const O=document.createElement("a");return O.href=V,O.href}:"function"===typeof URL&&"object"===typeof location?V=>new URL(V,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},b.NoneLogLevel=r.b.NoneLogLevel,b.MessageLogLevel=r.b.MessageLogLevel,b.WarningLogLevel=r.b.WarningLogLevel,b.ErrorLogLevel=r.b.ErrorLogLevel,b.AllLogLevel=r.b.AllLogLevel,b.IsWindowObjectExist=p.n,b.PerformanceNoneLogLevel=0,b.PerformanceUserMarkLogLevel=1,b.PerformanceConsoleLogLevel=2,b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,b.EndPerformanceCounter=b._EndPerformanceCounterDisabled;class U{constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=V,this.index=d-1,this._done=!1,this._fn=O,this._successCallback=Z}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(V,O,Z){const d=new U(V,O,Z,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return d.executeNext(),d}static SyncAsyncForLoop(V,O,Z,d,p){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return U.Run(Math.ceil(V/O),(d=>{p&&p()?d.breakLoop():setTimeout((()=>{for(let r=0;r<O;++r){const Y=d.index*O+r;if(Y>=V)break;if(Z(Y),p&&p()){d.breakLoop();break}}d.executeNext()}),r)}),d)}}b.Mix=Q.o,b.IsExponentOfTwo=Q.k,i.e.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11041:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>r,f:()=>p});const d={};function p(V,O){d[V]=O}function r(V){return d[V]}},11395:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>d});class d{static get UniqueId(){const V=this._UniqueIdCounter;return this._UniqueIdCounter++,V}}d._UniqueIdCounter=1},10933:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d});class d{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(d.CustomRequestHeaders).length>0||d.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const V in d.CustomRequestHeaders){const O=d.CustomRequestHeaders[V];O&&this._xhr.setRequestHeader(V,O)}}_shouldSkipRequestModifications(V){return d.SkipRequestModificationForBabylonCDN&&(V.includes("preview.babylonjs.com")||V.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(V){this._xhr.onprogress=V}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(V){this._xhr.responseType=V}get timeout(){return this._xhr.timeout}set timeout(V){this._xhr.timeout=V}addEventListener(V,O,Z){this._xhr.addEventListener(V,O,Z)}removeEventListener(V,O,Z){this._xhr.removeEventListener(V,O,Z)}abort(){this._xhr.abort()}send(V){d.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(V)}open(V,O){for(const Z of d.CustomRequestModifiers){if(this._shouldSkipRequestModifications(O))return;Z(this._xhr,O)}O=(O=O.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=O,this._xhr.open(V,O,!0)}setRequestHeader(V,O){this._xhr.setRequestHeader(V,O)}getResponseHeader(V){return this._xhr.getResponseHeader(V)}}d.CustomRequestHeaders={},d.CustomRequestModifiers=new Array,d.SkipRequestModificationForBabylonCDN=!0},12230:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>p});class d{constructor(V){this._pendingActions=new Array,this._workerInfos=V.map((V=>({workerPromise:Promise.resolve(V),idle:!0})))}dispose(){for(const V of this._workerInfos)V.workerPromise.then((V=>{V.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(V){this._executeOnIdleWorker(V)||this._pendingActions.push(V)}_executeOnIdleWorker(V){for(const O of this._workerInfos)if(O.idle)return this._execute(O,V),!0;return!1}_execute(V,O){V.idle=!1,V.workerPromise.then((Z=>{O(Z,(()=>{const O=this._pendingActions.shift();O?this._execute(V,O):V.idle=!0}))}))}}class p extends d{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.DefaultOptions;super([]),this._maxWorkers=V,this._createWorkerAsync=O,this._options=Z}push(V){if(!this._executeOnIdleWorker(V))if(this._workerInfos.length<this._maxWorkers){const O={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(O),this._execute(O,V)}else this._pendingActions.push(V)}_execute(V,O){V.timeoutId&&(clearTimeout(V.timeoutId),delete V.timeoutId),super._execute(V,((Z,d)=>{O(Z,(()=>{d(),V.idle&&(V.timeoutId=setTimeout((()=>{V.workerPromise.then((V=>{V.terminate()}));const O=this._workerInfos.indexOf(V);-1!==O&&this._workerInfos.splice(O,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}p.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11670:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>UV});var d=Z(11251),p=Z(11463);class r extends p.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=Z(11274),m=(Z(11673),Z(11041));class a{get noiseTexture(){return this._noiseTexture}set noiseTexture(V){this._noiseTexture!==V&&(this._noiseTexture=V,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(V){this._isAnimationSheetEnabled!=V&&(this._isAnimationSheetEnabled=V,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){this._useLogarithmicDepth=V&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:d.m.Zero()}set direction1(V){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=V)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:d.m.Zero()}set direction2(V){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=V)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:d.m.Zero()}set minEmitBox(V){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=V)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:d.m.Zero()}set maxEmitBox(V){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=V)}get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(V){this._isBillboardBased!==V&&(this._isBillboardBased=V,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V)}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(!V&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=V)}_reset(){}_removeGradientAndTexture(V,O,Z){if(!O)return this;let d=0;for(const p of O){if(p.gradient===V){O.splice(d,1);break}d++}return Z&&Z.dispose(),this}constructor(V){this.animations=[],this.renderingGroupId=0,this.k=d.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new d.m(10,10,10),this.onAnimationEnd=null,this.blendMode=a.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new d.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.lf=new d.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=d.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.f(1,1,1,1),this.color2=new Y.f(1,1,1,1),this.colorDead=new Y.f(0,0,0,1),this.textureMask=new Y.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new r,this.id=V,this.name=V}createPointEmitter(V,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new d.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new d.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new d.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new d.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new d.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new d.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(V,O,Z,d){throw new Error("Method not implemented.")}}a.BLENDMODE_ONEONE=0,a.BLENDMODE_STANDARD=1,a.BLENDMODE_ADD=2,a.BLENDMODE_MULTIPLY=3,a.BLENDMODE_MULTIPLYADD=4,(0,m.f)("BABYLON.BaseParticleSystem",a);var R=Z(11263),i=Z(10919);class M{constructor(){this.direction1=new d.m(0,1,0),this.direction2=new d.m(0,1,0),this.minEmitBox=new d.m(-.5,-.5,-.5),this.maxEmitBox=new d.m(.5,.5,.5)}startDirectionFunction(V,O,Z,p){const r=(0,R.u)(this.direction1.x,this.direction2.x),Y=(0,R.u)(this.direction1.y,this.direction2.y),m=(0,R.u)(this.direction1.z,this.direction2.z);if(p)return O.x=r,O.y=Y,void(O.z=m);d.m.TransformNormalFromFloatsToRef(r,Y,m,V,O)}startPositionFunction(V,O,Z,p){const r=(0,R.u)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,R.u)(this.minEmitBox.y,this.maxEmitBox.y),m=(0,R.u)(this.minEmitBox.z,this.maxEmitBox.z);if(p)return O.x=r,O.y=Y,void(O.z=m);d.m.TransformCoordinatesFromFloatsToRef(r,Y,m,V,O)}clone(){const V=new M;return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2),V.setVector3("minEmitBox",this.minEmitBox),V.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3),V.addUniform("minEmitBox",3),V.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Wi(),V.direction2=this.direction2.Wi(),V.minEmitBox=this.minEmitBox.Wi(),V.maxEmitBox=this.maxEmitBox.Wi(),V}parse(V){d.m.FromArrayToRef(V.direction1,0,this.direction1),d.m.FromArrayToRef(V.direction2,0,this.direction2),d.m.FromArrayToRef(V.minEmitBox,0,this.minEmitBox),d.m.FromArrayToRef(V.maxEmitBox,0,this.maxEmitBox)}}class c{get i(){return this._radius}set i(V){this._radius=V,this._buildHeight()}get angle(){return this._angle}set angle(V){this._angle=V,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Z,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.i=V}startDirectionFunction(V,O,Z,p){p?d.i.ib[0].p(Z.tf).normalize():Z.position.subtractToRef(V.getTranslation(),d.i.ib[0]).normalize();const r=(0,R.u)(0,this.directionRandomizer),Y=(0,R.u)(0,this.directionRandomizer),m=(0,R.u)(0,this.directionRandomizer);O.x=d.i.ib[0].x+r,O.y=d.i.ib[0].y+Y,O.z=d.i.ib[0].z+m,O.normalize()}startPositionFunction(V,O,Z,p){const r=(0,R.u)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,R.u)(0,this.heightRange),Y=1-Y*Y);let m=this._radius-(0,R.u)(0,this._radius*this.radiusRange);m*=Y;const a=m*Math.sin(r),i=m*Math.cos(r),M=Y*this._height;if(p)return O.x=a,O.y=M,void(O.z=i);d.m.TransformCoordinatesFromFloatsToRef(a,M,i,V,O)}clone(){const V=new c(this._radius,this._angle,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat2("i",this._radius,this.radiusRange),V.setFloat("coneAngle",this._angle),V.setFloat2("height",this._height,this.heightRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("i",2),V.addUniform("coneAngle",1),V.addUniform("height",2),V.addUniform("directionRandomizer",1)}getEffectDefines(){let V="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(V+="\n#define CONEEMITTERSPAWNPOINT"),V}getClassName(){return"ConeParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.i=this._radius,V.angle=this._angle,V.directionRandomizer=this.directionRandomizer,V.radiusRange=this.radiusRange,V.heightRange=this.heightRange,V.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,V}parse(V){this.i=V.i,this.angle=V.angle,this.directionRandomizer=V.directionRandomizer,this.radiusRange=void 0!==V.radiusRange?V.radiusRange:1,this.heightRange=void 0!==V.radiusRange?V.heightRange:1,this.emitFromSpawnPointOnly=void 0!==V.emitFromSpawnPointOnly&&V.emitFromSpawnPointOnly}}class W extends c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0);super(V,O),this.direction1=Z,this.direction2=p}startDirectionFunction(V,O){const Z=(0,R.u)(this.direction1.x,this.direction2.x),p=(0,R.u)(this.direction1.y,this.direction2.y),r=(0,R.u)(this.direction1.z,this.direction2.z);d.m.TransformNormalFromFloatsToRef(Z,p,r,V,O)}clone(){const V=new W(this.i,this.angle,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Wi(),V.direction2=this.direction2.Wi(),V}parse(V){super.parse(V),this.direction1.p(V.direction1),this.direction2.p(V.direction2)}}class F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=V,this.height=O,this.radiusRange=Z,this.directionRandomizer=p,this._tempVector=d.m.Zero()}startDirectionFunction(V,O,Z,p,r){Z.position.subtractToRef(V.getTranslation(),this._tempVector),this._tempVector.normalize(),d.m.TransformNormalToRef(this._tempVector,r,this._tempVector);const Y=(0,R.u)(-this.directionRandomizer/2,this.directionRandomizer/2);let m=Math.atan2(this._tempVector.x,this._tempVector.z);m+=(0,R.u)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(m),this._tempVector.z=Math.cos(m),this._tempVector.normalize(),p?O.p(this._tempVector):d.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V,O)}startPositionFunction(V,O,Z,p){const r=(0,R.u)(-this.height/2,this.height/2),Y=(0,R.u)(0,2*Math.PI),m=(0,R.u)((1-this.radiusRange)*(1-this.radiusRange),1),a=Math.sqrt(m)*this.i,i=a*Math.cos(Y),M=a*Math.sin(Y);p?O.nf(i,r,M):d.m.TransformCoordinatesFromFloatsToRef(i,r,M,V,O)}clone(){const V=new F(this.i,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.i=this.i,V.height=this.height,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.i=V.i,this.height=V.height,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class Q extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.m(0,1,0);super(V,O,Z),this.direction1=p,this.direction2=r}startDirectionFunction(V,O,Z,p){const r=(0,R.u)(this.direction1.x,this.direction2.x),Y=(0,R.u)(this.direction1.y,this.direction2.y),m=(0,R.u)(this.direction1.z,this.direction2.z);p?O.nf(r,Y,m):d.m.TransformNormalFromFloatsToRef(r,Y,m,V,O)}clone(){const V=new Q(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Wi(),V.direction2=this.direction2.Wi(),V}parse(V){super.parse(V),d.m.FromArrayToRef(V.direction1,0,this.direction1),d.m.FromArrayToRef(V.direction2,0,this.direction2)}}class b{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=V,this.radiusRange=O,this.directionRandomizer=Z}startDirectionFunction(V,O,Z,p){const r=Z.position.fc(V.getTranslation()).normalize(),Y=(0,R.u)(0,this.directionRandomizer),m=(0,R.u)(0,this.directionRandomizer),a=(0,R.u)(0,this.directionRandomizer);r.x+=Y,r.y+=m,r.z+=a,r.normalize(),p?O.p(r):d.m.TransformNormalFromFloatsToRef(r.x,r.y,r.z,V,O)}startPositionFunction(V,O,Z,p){const r=this.i-(0,R.u)(0,this.i*this.radiusRange),Y=(0,R.u)(0,1),m=(0,R.u)(0,2*Math.PI),a=Math.acos(2*Y-1),i=r*Math.cos(m)*Math.sin(a),M=r*Math.cos(a),c=r*Math.sin(m)*Math.sin(a);p?O.nf(i,Math.abs(M),c):d.m.TransformCoordinatesFromFloatsToRef(i,Math.abs(M),c,V,O)}clone(){const V=new b(this.i,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.i=this.i,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.i=V.i,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class U{constructor(){this.direction1=new d.m(0,1,0),this.direction2=new d.m(0,1,0)}startDirectionFunction(V,O,Z,p){const r=(0,R.u)(this.direction1.x,this.direction2.x),Y=(0,R.u)(this.direction1.y,this.direction2.y),m=(0,R.u)(this.direction1.z,this.direction2.z);p?O.nf(r,Y,m):d.m.TransformNormalFromFloatsToRef(r,Y,m,V,O)}startPositionFunction(V,O,Z,p){p?O.nf(0,0,0):d.m.TransformCoordinatesFromFloatsToRef(0,0,0,V,O)}clone(){const V=new U;return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Wi(),V.direction2=this.direction2.Wi(),V}parse(V){d.m.FromArrayToRef(V.direction1,0,this.direction1),d.m.FromArrayToRef(V.direction2,0,this.direction2)}}class H{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=V,this.radiusRange=O,this.directionRandomizer=Z}startDirectionFunction(V,O,Z,p){const r=Z.position.fc(V.getTranslation()).normalize(),Y=(0,R.u)(0,this.directionRandomizer),m=(0,R.u)(0,this.directionRandomizer),a=(0,R.u)(0,this.directionRandomizer);r.x+=Y,r.y+=m,r.z+=a,r.normalize(),p?O.p(r):d.m.TransformNormalFromFloatsToRef(r.x,r.y,r.z,V,O)}startPositionFunction(V,O,Z,p){const r=this.i-(0,R.u)(0,this.i*this.radiusRange),Y=(0,R.u)(0,1),m=(0,R.u)(0,2*Math.PI),a=Math.acos(2*Y-1),i=r*Math.cos(m)*Math.sin(a),M=r*Math.cos(a),c=r*Math.sin(m)*Math.sin(a);p?O.nf(i,M,c):d.m.TransformCoordinatesFromFloatsToRef(i,M,c,V,O)}clone(){const V=new H(this.i,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.i=this.i,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.i=V.i,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class S extends H{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.m(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0);super(V),this.direction1=O,this.direction2=Z}startDirectionFunction(V,O){const Z=(0,R.u)(this.direction1.x,this.direction2.x),p=(0,R.u)(this.direction1.y,this.direction2.y),r=(0,R.u)(this.direction1.z,this.direction2.z);d.m.TransformNormalFromFloatsToRef(Z,p,r,V,O)}clone(){const V=new S(this.i,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("i",this.i),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("i",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Wi(),V.direction2=this.direction2.Wi(),V}parse(V){super.parse(V),this.direction1.p(V.direction1),this.direction2.p(V.direction2)}}class z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(V,O,Z,p){const r=d.i.ib[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Z,r);const V=d.i.ib[1];r.subtractToRef(Z.position,V),V.scaleToRef(1/Z.lifeTime,r)}else r.set(0,0,0);p?O.p(r):d.m.TransformNormalToRef(r,V,O)}startPositionFunction(V,O,Z,p){const r=d.i.ib[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Z,r):r.set(0,0,0),p?O.p(r):d.m.TransformCoordinatesToRef(r,V,O)}clone(){const V=new z;return i.d.DeepCopy(this,V),V}applyToShader(V){}buildUniformLayout(V){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.particlePositionGenerator=this.particlePositionGenerator,V.particleDestinationGenerator=this.particleDestinationGenerator,V}parse(V){V.particlePositionGenerator&&(this.particlePositionGenerator=V.particlePositionGenerator),V.particleDestinationGenerator&&(this.particleDestinationGenerator=V.particleDestinationGenerator)}}var G=Z(11316);class w{get mesh(){return this.Kk}set mesh(V){this.Kk!==V&&(this.Kk=V,V?(this._indices=V.qf(),this._positions=V.getVerticesData(G.e.PositionKind),this._normals=V.getVerticesData(G.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=d.m.Zero(),this.Kk=null,this.direction1=new d.m(0,1,0),this.direction2=new d.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=V}startDirectionFunction(V,O,Z,p){if(this.useMeshNormalsForDirection&&this._normals)return void d.m.TransformNormalToRef(this._storedNormal,V,O);const r=(0,R.u)(this.direction1.x,this.direction2.x),Y=(0,R.u)(this.direction1.y,this.direction2.y),m=(0,R.u)(this.direction1.z,this.direction2.z);p?O.nf(r,Y,m):d.m.TransformNormalFromFloatsToRef(r,Y,m,V,O)}startPositionFunction(V,O,Z,p){if(!this._indices||!this._positions)return;const r=3*Math.random()*(this._indices.length/3)|0,Y=Math.random(),m=Math.random()*(1-Y),a=1-Y-m,R=this._indices[r],i=this._indices[r+1],M=this._indices[r+2],c=d.i.ib[0],W=d.i.ib[1],F=d.i.ib[2],Q=d.i.ib[3];d.m.FromArrayToRef(this._positions,3*R,c),d.m.FromArrayToRef(this._positions,3*i,W),d.m.FromArrayToRef(this._positions,3*M,F),Q.x=Y*c.x+m*W.x+a*F.x,Q.y=Y*c.y+m*W.y+a*F.y,Q.z=Y*c.z+m*W.z+a*F.z,p?O.nf(Q.x,Q.y,Q.z):d.m.TransformCoordinatesFromFloatsToRef(Q.x,Q.y,Q.z,V,O),this.useMeshNormalsForDirection&&this._normals&&(d.m.FromArrayToRef(this._normals,3*R,c),d.m.FromArrayToRef(this._normals,3*i,W),d.m.FromArrayToRef(this._normals,3*M,F),this._storedNormal.x=Y*c.x+m*W.x+a*F.x,this._storedNormal.y=Y*c.y+m*W.y+a*F.y,this._storedNormal.z=Y*c.z+m*W.z+a*F.z)}clone(){const V=new w(this.mesh);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var V;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.Wi(),O.direction2=this.direction2.Wi(),O.meshId=null===(V=this.mesh)||void 0===V?void 0:V.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(V,O){d.m.FromArrayToRef(V.direction1,0,this.direction1),d.m.FromArrayToRef(V.direction2,0,this.direction2),V.meshId&&O&&(this.mesh=O.getLastMeshById(V.meshId)),this.useMeshNormalsForDirection=V.useMeshNormalsForDirection}}var t=Z(10986);class C{_isUbo(V){return void 0!==V.addUniform}constructor(V){this._isUbo(V)?(this.setMatrix3x3=V.updateMatrix3x3.bind(V),this.setMatrix2x2=V.updateMatrix2x2.bind(V),this.setFloat=V.updateFloat.bind(V),this.setFloat2=V.updateFloat2.bind(V),this.setFloat3=V.updateFloat3.bind(V),this.setFloat4=V.updateFloat4.bind(V),this.setFloatArray=V.updateFloatArray.bind(V),this.setArray=V.updateArray.bind(V),this.setIntArray=V.updateIntArray.bind(V),this.setMatrix=V.tj.bind(V),this.setMatrices=V.updateMatrices.bind(V),this.setVector3=V.updateVector3.bind(V),this.setVector4=V.updateVector4.bind(V),this.setColor3=V.updateColor3.bind(V),this.setColor4=V.updateColor4.bind(V),this.setDirectColor4=V.updateDirectColor4.bind(V),this.setInt=V.updateInt.bind(V),this.setInt2=V.updateInt2.bind(V),this.setInt3=V.updateInt3.bind(V),this.setInt4=V.updateInt4.bind(V)):(this.setMatrix3x3=V.setMatrix3x3.bind(V),this.setMatrix2x2=V.setMatrix2x2.bind(V),this.setFloat=V.setFloat.bind(V),this.setFloat2=V.setFloat2.bind(V),this.setFloat3=V.setFloat3.bind(V),this.setFloat4=V.setFloat4.bind(V),this.setFloatArray=V.setFloatArray.bind(V),this.setArray=V.setArray.bind(V),this.setIntArray=V.setIntArray.bind(V),this.setMatrix=V.setMatrix.bind(V),this.setMatrices=V.setMatrices.bind(V),this.setVector3=V.setVector3.bind(V),this.setVector4=V.setVector4.bind(V),this.setColor3=V.setColor3.bind(V),this.setColor4=V.setColor4.bind(V),this.setDirectColor4=V.setDirectColor4.bind(V),this.setInt=V.setInt.bind(V),this.setInt2=V.setInt2.bind(V),this.setInt3=V.setInt3.bind(V),this.setInt4=V.setInt4.bind(V))}}var v=Z(10991);const A="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";v.d.ShadersStore[A]=l;const I="gpuUpdateParticlesVertexShader",g="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";v.d.ShadersStore[I]=g;(0,m.f)("BABYLON.WebGL2ParticleSystem",class{constructor(V,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=V,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var V;return(null===(V=this._updateEffect)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=V,this._updateEffect=new t.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new C(this._updateEffect)}createVertexBuffers(V,O){this._updateVAO.push(this._createUpdateVAO(V)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(V){return V}bindDrawBuffers(V,O,Z){Z?this._engine.bindBuffers(this._renderVertexBuffers,Z,O):this._engine.bindVertexArrayObject(this._renderVAO[V],null)}preUpdateParticleBuffer(){const V=this._engine;if(this._engine.enableEffect(this._updateEffect),!V.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(V,O,Z){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[V],null);const d=this._engine;d.bindTransformFeedbackBuffer(O.getBuffer()),d.setRasterizerState(!1),d.beginTransformFeedback(!0),d.drawArraysType(3,0,Z),d.endTransformFeedback(),d.setRasterizerState(!0),d.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let V=0;V<this._updateVAO.length;V++)this._engine.releaseVertexArrayObject(this._updateVAO[V]);this._updateVAO.length=0;for(let V=0;V<this._renderVAO.length;V++)this._engine.releaseVertexArrayObject(this._renderVAO[V]);this._renderVAO.length=0}_createUpdateVAO(V){const O={};O.position=V.createVertexBuffer("position",0,3);let Z=3;O.age=V.createVertexBuffer("age",Z,1),Z+=1,O.size=V.createVertexBuffer("size",Z,3),Z+=3,O.life=V.createVertexBuffer("life",Z,1),Z+=1,O.seed=V.createVertexBuffer("seed",Z,4),Z+=4,O.direction=V.createVertexBuffer("direction",Z,3),Z+=3,this._parent.particleEmitterType instanceof z&&(O.initialPosition=V.createVertexBuffer("initialPosition",Z,3),Z+=3),this._parent._colorGradientsTexture||(O.color=V.createVertexBuffer("color",Z,4),Z+=4),this._parent._isBillboardBased||(O.initialDirection=V.createVertexBuffer("initialDirection",Z,3),Z+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",Z,3),Z+=3,O.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",Z,3),Z+=3),this._parent._angularSpeedGradientsTexture?(O.angle=V.createVertexBuffer("angle",Z,1),Z+=1):(O.angle=V.createVertexBuffer("angle",Z,2),Z+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=V.createVertexBuffer("cellIndex",Z,1),Z+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=V.createVertexBuffer("cellStartOffset",Z,1),Z+=1));const d=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),d}});class n{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,d=arguments.length>3?arguments[3]:void 0;this._engine=V,this._label=d,this._engine._storageBuffers.push(this),this._create(O,Z)}_create(V,O){this._bufferSize=V,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(V,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(V,O,Z){this._buffer&&this._engine.updateStorageBuffer(this._buffer,V,O,Z)}read(V,O,Z,d){return this._engine.readFromStorageBuffer(this._buffer,V,O,Z,d)}dispose(){const V=this._engine._storageBuffers,O=V.indexOf(this);-1!==O&&(V[O]=V[V.length-1],V.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var e=Z(11210),u=Z(11216),k=Z(11283),D=Z(11467),X=Z(11395),o=Z(10914),E=Z(11020),L=Z(11053);class J{constructor(){this._gpuTimeInFrameId=-1,this.counter=new L.d}_addDuration(V,O){V<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==V?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=V):this.counter.addCount(O,!1))}}class N{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=V,this._engine=O,this.uniqueId=X.d.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new J),this._engine.getCaps().supportComputeShaders?d.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=Z,this._options={bindingsMapping:{},defines:[],...d}):o.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):o.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=this._bindings[V];this._bindings[V]={type:Z?0:4,object:O,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!d||d.object!==O||d.type!==this._bindings[V].type)}setStorageTexture(V,O){const Z=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==O),this._bindings[V]={type:1,object:O,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setExternalTexture(V,O){const Z=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==O),this._bindings[V]={type:6,object:O,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setVideoTexture(V,O){return!!O.externalTexture&&(this.setExternalTexture(V,O.externalTexture),!0)}setUniformBuffer(V,O){const Z=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==O),this._bindings[V]={type:N._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setStorageBuffer(V,O){const Z=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==O),this._bindings[V]={type:N._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setTextureSampler(V,O){const Z=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!Z||!O.compareSampler(Z.object)),this._bindings[V]={type:5,object:O,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}isReady(){let V=this._effect;for(const p in this._bindings){const V=this._bindings[p],O=V.type,Z=V.object;switch(O){case 0:case 4:case 1:if(!Z.isReady())return!1;break;case 6:if(!Z.isReady())return!1;break}}const O=[],Z=this._shaderPath;if(this._options.defines)for(let p=0;p<this._options.defines.length;p++)O.push(this._options.defines[p]);const d=O.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,V=this._engine.createComputeEffect(Z,{defines:d,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=V),!!V.isReady()}dispatch(V,O,Z){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,V,O,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Z=N._BufferIsDataBuffer(V)?V:V.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Z,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const Z=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(Z.type){case 0:{const d=this._samplers[O],p=Z.object;var V;if(!d||!p._texture||!d.compareSampler(p._texture))this._samplers[O]=(new E.e).setParameters(p.wrapU,p.wrapV,p.wrapR,p.anisotropicFilteringLevel,p._texture.samplingMode,null===(V=p._texture)||void 0===V?void 0:V._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const V=Z.object;V.getBuffer()!==Z.buffer&&(Z.buffer=V.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((p=>{const r=()=>{this.dispatch(V,O,Z)?p():setTimeout(r,d)};r()}))}serialize(){const V=k.b.Serialize(this);V.options=this._options,V.shaderPath=this._shaderPath,V.ij={},V.textures={};for(const O in this._bindings){const Z=this._bindings[O],d=Z.object;switch(Z.type){case 0:case 4:case 1:{const p=d.serialize();p&&(V.textures[O]=p,V.ij[O]={type:Z.type});break}}}return V}static Parse(V,O,Z){const d=k.b.Parse((()=>new N(V.name,O.getEngine(),V.shaderPath,V.options)),V,O,Z);for(const p in V.textures){const r=V.ij[p],Y=D.b.Parse(V.textures[p],O,Z);0===r.type?d.setTexture(p,Y):4===r.type?d.setTexture(p,Y,!1):d.setStorageTexture(p,Y)}return d}static _BufferIsDataBuffer(V){return void 0!==V.underlyingResource}}(0,e.c)([(0,u.K)()],N.prototype,"name",void 0),(0,e.c)([(0,u.K)()],N.prototype,"fastMode",void 0),(0,m.f)("BABYLON.ComputeShader",N);var P=Z(11305);const f="gpuUpdateParticlesComputeShader",q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";v.d.ShadersStoreWGSL[f]=q;(0,m.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(V,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=V,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var V;return(null===(V=this._updateComputeShader)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){var O;const Z={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Z.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Z.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Z.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Z.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Z.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Z.noiseTexture={group:1,binding:11}),this._updateComputeShader=new N("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Z,defines:V.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new P.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new C(this._simParamsComputeShader)}createVertexBuffers(V,O){this._renderVertexBuffers.push(O)}createParticleBuffer(V){const O=new n(this._engine,4*V.length,11,"ComputeShaderParticleSystemBuffer");return O.update(V),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(V,O,Z){this._engine.bindBuffers(this._renderVertexBuffers[V],Z,O)}preUpdateParticleBuffer(){}updateParticleBuffer(V,O,Z){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[V]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^V]),this._updateComputeShader.dispatch(Math.ceil(Z/64))}releaseBuffers(){var V;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class K{constructor(V,O,Z){this.gradient=V,this.color1=O,this.color2=Z}getColorToRef(V){this.color2?Y.f.LerpToRef(this.color1,this.color2,Math.random(),V):V.p(this.color1)}}class s{constructor(V,O){this.gradient=V,this.color=O}}class h{constructor(V,O,Z){this.gradient=V,this.factor1=O,this.factor2=Z}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class x{static GetCurrentGradient(V,O,Z){if(O[0].gradient>V)return void Z(O[0],O[0],1);for(let p=0;p<O.length-1;p++){const d=O[p],r=O[p+1];if(V>=d.gradient&&V<=r.gradient){return void Z(d,r,(V-d.gradient)/(r.gradient-d.gradient))}}const d=O.length-1;Z(O[d],O[d],1)}}var y=Z(10902),T=Z(11691),B=Z(10942);class j{constructor(V){this.particleSystem=V,this.position=d.m.Zero(),this.direction=d.m.Zero(),this.color=new Y.f(0,0,0,0),this.colorStep=new Y.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new d.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.f(0,0,0,0),this._currentColor2=new Y.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=j._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let V=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,V=this._randomCellOffset):V+=this._randomCellOffset);const Z=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let d;d=this._initialSpriteCellLoop?(0,R.c)(V*O%this.lifeTime/this.lifeTime):(0,R.c)(V*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+d*Z|0}_inheritParticleInfoToSubEmitter(V){if(V.particleSystem.k.position){const O=V.particleSystem.k;if(O.position.p(this.position),V.inheritDirection){const V=d.i.ib[0];this.direction.normalizeToRef(V),O.setDirection(V,0,Math.PI/2)}}else{V.particleSystem.k.p(this.position)}this.direction.scaleToRef(V.inheritedVelocityAmount/2,d.i.ib[0]),V.particleSystem._inheritedVelocityOffset.p(d.i.ib[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((V=>{this._inheritParticleInfoToSubEmitter(V)}))}_reset(){this.age=0,this.id=j._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(V){V.position.p(this.position),this._initialDirection?V._initialDirection?V._initialDirection.p(this._initialDirection):V._initialDirection=this._initialDirection.clone():V._initialDirection=null,V.direction.p(this.direction),this.tf&&(V.tf?V.tf.p(this.tf):V.tf=this.tf.clone()),V.color.p(this.color),V.colorStep.p(this.colorStep),V.lifeTime=this.lifeTime,V.age=this.age,V._randomCellOffset=this._randomCellOffset,V.size=this.size,V.scale.p(this.scale),V.angle=this.angle,V.angularSpeed=this.angularSpeed,V.particleSystem=this.particleSystem,V.cellIndex=this.cellIndex,V.id=this.id,V._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(V._currentColorGradient=this._currentColorGradient,V._currentColor1.p(this._currentColor1),V._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(V._currentSizeGradient=this._currentSizeGradient,V._currentSize1=this._currentSize1,V._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(V._currentAngularSpeedGradient=this._currentAngularSpeedGradient,V._currentAngularSpeed1=this._currentAngularSpeed1,V._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(V._currentVelocityGradient=this._currentVelocityGradient,V._currentVelocity1=this._currentVelocity1,V._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(V._currentLimitVelocityGradient=this._currentLimitVelocityGradient,V._currentLimitVelocity1=this._currentLimitVelocity1,V._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(V._currentDragGradient=this._currentDragGradient,V._currentDrag1=this._currentDrag1,V._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(V._initialStartSpriteCellID=this._initialStartSpriteCellID,V._initialEndSpriteCellID=this._initialEndSpriteCellID,V._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(V.remapData&&this.remapData?V.remapData.p(this.remapData):V.remapData=new d.p(0,0,0,0)),this._randomNoiseCoordinates1&&(V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),V._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(V._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),V._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}j._Count=0;var VV=Z(11441),OV=(Z(11696),Z(11456)),ZV=Z(11448),dV=Z(11296);class pV extends a{set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}get useRampGradients(){return this._useRampGradients}set useRampGradients(V){this._useRampGradients!==V&&(this._useRampGradients=V,this._resetEffect())}get particles(){return this.dj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.dj.length}getClassName(){return"yb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[O])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new VV.d(this._engine),this._customWrappers[O].effect=V,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(V),this._emitterInverseWorldMatrix=d.c.Identity(),this._inheritedVelocityOffset=new d.m,this.Xi=new y.e,this.onStoppedObservable=new y.e,this.dj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.f(0,0,0,0),this._colorDiff=new Y.f(0,0,0,0),this._scaledDirection=d.m.Zero(),this._scaledGravity=d.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=V=>{},this.recycleParticle=V=>{const O=this.dj.pop();O!==V&&O.copyTo(V),this._stockParticles.push(O)},this._createParticle=()=>{let V;return 0!==this._stockParticles.length?(V=this._stockParticles.pop(),V._reset()):V=new j(this),this._prepareParticle(V),V},this._shadersLoaded=!1,this._capacity=O,this._epsilon=m,this._isAnimationSheetEnabled=r,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=d.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||B.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new VV.d(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new M;let a=null;this.updateFunction=V=>{let O=null;var Z;this.noiseTexture&&(O=this.noiseTexture.getSize(),null===(Z=this.noiseTexture.getContent())||void 0===Z||Z.then((V=>{a=V})));const p=V===this.dj;for(let r=0;r<V.length;r++){const Z=V[r];let m=this._scaledUpdateSpeed;const i=Z.age;if(Z.age+=m,Z.age>Z.lifeTime){const V=Z.age-i;m=(Z.lifeTime-i)*m/V,Z.age=Z.lifeTime}const M=Z.age/Z.lifeTime;this._colorGradients&&this._colorGradients.length>0?x.GetCurrentGradient(M,this._colorGradients,((V,O,d)=>{V!==Z._currentColorGradient&&(Z._currentColor1.p(Z._currentColor2),O.getColorToRef(Z._currentColor2),Z._currentColorGradient=V),Y.f.LerpToRef(Z._currentColor1,Z._currentColor2,d,Z.color)})):(Z.colorStep.scaleToRef(m,this._scaledColorStep),Z.color.addInPlace(this._scaledColorStep),Z.color.a<0&&(Z.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&x.GetCurrentGradient(M,this._angularSpeedGradients,((V,O,d)=>{V!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=O.getFactor(),Z._currentAngularSpeedGradient=V),Z.angularSpeed=(0,R.m)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,d)})),Z.angle+=Z.angularSpeed*m;let c=m;if(this._velocityGradients&&this._velocityGradients.length>0&&x.GetCurrentGradient(M,this._velocityGradients,((V,O,d)=>{V!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=O.getFactor(),Z._currentVelocityGradient=V),c*=(0,R.m)(Z._currentVelocity1,Z._currentVelocity2,d)})),Z.direction.scaleToRef(c,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&x.GetCurrentGradient(M,this._limitVelocityGradients,((V,O,d)=>{V!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=O.getFactor(),Z._currentLimitVelocityGradient=V);const p=(0,R.m)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,d);Z.direction.length()>p&&Z.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&x.GetCurrentGradient(M,this._dragGradients,((V,O,d)=>{V!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=O.getFactor(),Z._currentDragGradient=V);const p=(0,R.m)(Z._currentDrag1,Z._currentDrag2,d);this._scaledDirection.scaleInPlace(1-p)})),this.isLocal&&Z.tf?(Z.tf.addInPlace(this._scaledDirection),d.m.TransformCoordinatesToRef(Z.tf,this._emitterWorldMatrix,Z.position)):Z.position.addInPlace(this._scaledDirection),a&&O&&Z._randomNoiseCoordinates1){const V=this._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,O.width,O.height,a),p=this._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,O.width,O.height,a),r=this._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,O.width,O.height,a),Y=d.i.ib[0],R=d.i.ib[1];Y.nf((2*V-1)*this.noiseStrength.x,(2*p-1)*this.noiseStrength.y,(2*r-1)*this.noiseStrength.z),Y.scaleToRef(m,R),Z.direction.addInPlace(R)}this.gravity.scaleToRef(m,this._scaledGravity),Z.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&x.GetCurrentGradient(M,this._sizeGradients,((V,O,d)=>{V!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=O.getFactor(),Z._currentSizeGradient=V),Z.size=(0,R.m)(Z._currentSize1,Z._currentSize2,d)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&x.GetCurrentGradient(M,this._colorRemapGradients,((V,O,d)=>{const p=(0,R.m)(V.factor1,O.factor1,d),r=(0,R.m)(V.factor2,O.factor2,d);Z.remapData.x=p,Z.remapData.y=r-p})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&x.GetCurrentGradient(M,this._alphaRemapGradients,((V,O,d)=>{const p=(0,R.m)(V.factor1,O.factor1,d),r=(0,R.m)(V.factor2,O.factor2,d);Z.remapData.z=p,Z.remapData.w=r-p}))),this._isAnimationSheetEnabled&&Z.updateCellIndex(),Z._inheritParticleInfoToSubEmitters(),Z.age>=Z.lifeTime&&(this._emitFromParticle(Z),Z._attachedSubEmitters&&(Z._attachedSubEmitters.forEach((V=>{V.particleSystem.disposeOnStop=!0,V.particleSystem.stop()})),Z._attachedSubEmitters=null),this.recycleParticle(Z),p&&r--)}}}serialize(V){throw new Error("Method not implemented.")}clone(V,O){throw new Error("Method not implemented.")}_addFactorGradient(V,O,Z,d){const p=new h(O,Z,d);V.push(p),V.sort(((V,O)=>V.gradient<O.gradient?-1:V.gradient>O.gradient?1:0))}_removeFactorGradient(V,O){if(!V)return;let Z=0;for(const d of V){if(d.gradient===O){V.splice(Z,1);break}Z++}}addLifeTimeGradient(V,O,Z){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,V,O,Z),this}removeLifeTimeGradient(V){return this._removeFactorGradient(this._lifeTimeGradients,V),this}addSizeGradient(V,O,Z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,O,Z),this}removeSizeGradient(V){return this._removeFactorGradient(this._sizeGradients,V),this}addColorRemapGradient(V,O,Z){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,V,O,Z),this}removeColorRemapGradient(V){return this._removeFactorGradient(this._colorRemapGradients,V),this}addAlphaRemapGradient(V,O,Z){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,V,O,Z),this}removeAlphaRemapGradient(V){return this._removeFactorGradient(this._alphaRemapGradients,V),this}addAngularSpeedGradient(V,O,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,O,Z),this}removeAngularSpeedGradient(V){return this._removeFactorGradient(this._angularSpeedGradients,V),this}addVelocityGradient(V,O,Z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,O,Z),this}removeVelocityGradient(V){return this._removeFactorGradient(this._velocityGradients,V),this}addLimitVelocityGradient(V,O,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,O,Z),this}removeLimitVelocityGradient(V){return this._removeFactorGradient(this._limitVelocityGradients,V),this}addDragGradient(V,O,Z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,O,Z),this}removeDragGradient(V){return this._removeFactorGradient(this._dragGradients,V),this}addEmitRateGradient(V,O,Z){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,V,O,Z),this}removeEmitRateGradient(V){return this._removeFactorGradient(this._emitRateGradients,V),this}addStartSizeGradient(V,O,Z){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,V,O,Z),this}removeStartSizeGradient(V){return this._removeFactorGradient(this._startSizeGradients,V),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const V=new Uint8Array(4*this._rawTextureWidth),O=Y.h.jb[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const d=Z/this._rawTextureWidth;x.GetCurrentGradient(d,this._rampGradients,((d,p,r)=>{Y.b.LerpToRef(d.color,p.color,r,O),V[4*Z]=255*O.r,V[4*Z+1]=255*O.g,V[4*Z+2]=255*O.b,V[4*Z+3]=255}))}this._rampGradientsTexture=T.e.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((V,O)=>V.gradient<O.gradient?-1:V.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(V,O){this._rampGradients||(this._rampGradients=[]);const Z=new s(V,O);return this._rampGradients.push(Z),this._syncRampGradientTexture(),this}removeRampGradient(V){return this._removeGradientAndTexture(V,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(V,O,Z){this._colorGradients||(this._colorGradients=[]);const d=new K(V,O,Z);return this._colorGradients.push(d),this._colorGradients.sort(((V,O)=>V.gradient<O.gradient?-1:V.gradient>O.gradient?1:0)),this}removeColorGradient(V){if(!this._colorGradients)return this;let O=0;for(const Z of this._colorGradients){if(Z.gradient===V){this._colorGradients.splice(O,1);break}O++}return this}resetDrawCache(){for(const V of this._drawWrappers)if(V)for(const O of V)null===O||void 0===O||O.dispose();this._drawWrappers=[]}_fetchR(V,O,Z,d,p){return p[4*(((V=.5*Math.abs(V)+.5)*Z%Z|0)+((O=.5*Math.abs(O)+.5)*d%d|0)*Z)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const V=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new G.c(V,this._vertexData,!0,O);let Z=0;const d=this._vertexBuffer.createVertexBuffer(G.e.PositionKind,Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.e.PositionKind]=d,Z+=3;const p=this._vertexBuffer.createVertexBuffer(G.e.ColorKind,Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.e.ColorKind]=p,Z+=4;const r=this._vertexBuffer.createVertexBuffer("angle",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=r,Z+=1;const Y=this._vertexBuffer.createVertexBuffer("size",Z,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,Z+=2,this._isAnimationSheetEnabled){const V=this._vertexBuffer.createVertexBuffer("cellIndex",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=V,Z+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const V=this._vertexBuffer.createVertexBuffer("direction",Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=V,Z+=3}if(this._useRampGradients){const V=this._vertexBuffer.createVertexBuffer("remapData",Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=V,Z+=4}let m;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new G.c(V,O,!1,2),m=this._spriteBuffer.createVertexBuffer("offset",0,2)}else m=this._vertexBuffer.createVertexBuffer("offset",Z,2,this._vertexBufferSize,this._useInstancing),Z+=2;this._vertexBuffers.offset=m,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const V=[],O=[];let Z=0;for(let d=0;d<this._capacity;d++)V.push(Z),V.push(Z+1),V.push(Z+2),V.push(Z),V.push(Z+2),V.push(Z+3),O.push(Z,Z+1,Z+1,Z+2,Z+2,Z+3,Z+3,Z,Z,Z+3),Z+=4;this._indexBuffer=this._engine.createIndexBuffer(V),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(V)setTimeout((()=>{this.start(0)}),V);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.k)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.k.Cj(!0);const V=this.noiseTexture;if(V&&V.onGeneratedObservable)V.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),V.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(V))}_postStop(V){}reset(){this._stockParticles.length=0,this.dj.length=0}_appendParticleVertex(V,O,Z,p){let r=V*this._vertexBufferSize;if(this._vertexData[r++]=O.position.x+this.lf.x,this._vertexData[r++]=O.position.y+this.lf.y,this._vertexData[r++]=O.position.z+this.lf.z,this._vertexData[r++]=O.color.r,this._vertexData[r++]=O.color.g,this._vertexData[r++]=O.color.b,this._vertexData[r++]=O.color.a,this._vertexData[r++]=O.angle,this._vertexData[r++]=O.scale.x*O.size,this._vertexData[r++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[r++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[r++]=O.direction.x,this._vertexData[r++]=O.direction.y,this._vertexData[r++]=O.direction.z);else if(O._initialDirection){let V=O._initialDirection;this.isLocal&&(d.m.TransformNormalToRef(V,this._emitterWorldMatrix,d.i.ib[0]),V=d.i.ib[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[r++]=V.x,this._vertexData[r++]=V.y,this._vertexData[r++]=V.z}else{let V=O.direction;this.isLocal&&(d.m.TransformNormalToRef(V,this._emitterWorldMatrix,d.i.ib[0]),V=d.i.ib[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[r++]=V.x,this._vertexData[r++]=V.y,this._vertexData[r++]=V.z}this._useRampGradients&&O.remapData&&(this._vertexData[r++]=O.remapData.x,this._vertexData[r++]=O.remapData.y,this._vertexData[r++]=O.remapData.z,this._vertexData[r++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Z?Z=this._epsilon:1===Z&&(Z=1-this._epsilon),0===p?p=this._epsilon:1===p&&(p=1-this._epsilon)),this._vertexData[r++]=Z,this._vertexData[r++]=p)}_prepareParticle(V){}_update(V){if(this._alive=this.dj.length>0,this.k.position){const V=this.k;this._emitterWorldMatrix=V.getWorldMatrix()}else{const V=this.k;this._emitterWorldMatrix=d.c.Translation(V.x,V.y,V.z)}let O;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.dj);for(let Z=0;Z<V&&this.dj.length!==this._capacity;Z++){if(O=this._createParticle(),this.dj.push(O),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const V=(0,R.c)(this._actualFrame/this.targetStopDuration);x.GetCurrentGradient(V,this._lifeTimeGradients,((Z,d)=>{const p=Z,r=d,Y=p.getFactor(),m=r.getFactor(),a=(V-p.gradient)/(r.gradient-p.gradient);O.lifeTime=(0,R.m)(Y,m,a)}))}else O.lifeTime=(0,R.u)(this.minLifeTime,this.maxLifeTime);const V=(0,R.u)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,O.position,O,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,O.position,O,this.isLocal),this.isLocal&&(O.tf?O.tf.p(O.position):O.tf=O.position.clone(),d.m.TransformCoordinatesToRef(O.tf,this._emitterWorldMatrix,O.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,O.direction,O,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,O.direction,O,this.isLocal,this._emitterInverseWorldMatrix),0===V?O._initialDirection?O._initialDirection.p(O.direction):O._initialDirection=O.direction.clone():O._initialDirection=null,O.direction.scaleInPlace(V),this._sizeGradients&&0!==this._sizeGradients.length?(O._currentSizeGradient=this._sizeGradients[0],O._currentSize1=O._currentSizeGradient.getFactor(),O.size=O._currentSize1,this._sizeGradients.length>1?O._currentSize2=this._sizeGradients[1].getFactor():O._currentSize2=O._currentSize1):O.size=(0,R.u)(this.minSize,this.maxSize),O.scale.nf((0,R.u)(this.minScaleX,this.maxScaleX),(0,R.u)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const V=this._actualFrame/this.targetStopDuration;x.GetCurrentGradient(V,this._startSizeGradients,((V,Z,d)=>{V!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=Z.getFactor(),this._currentStartSizeGradient=V);const p=(0,R.m)(this._currentStartSize1,this._currentStartSize2,d);O.scale.scaleInPlace(p)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(O._currentAngularSpeedGradient=this._angularSpeedGradients[0],O.angularSpeed=O._currentAngularSpeedGradient.getFactor(),O._currentAngularSpeed1=O.angularSpeed,this._angularSpeedGradients.length>1?O._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():O._currentAngularSpeed2=O._currentAngularSpeed1):O.angularSpeed=(0,R.u)(this.minAngularSpeed,this.maxAngularSpeed),O.angle=(0,R.u)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(O._currentVelocityGradient=this._velocityGradients[0],O._currentVelocity1=O._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?O._currentVelocity2=this._velocityGradients[1].getFactor():O._currentVelocity2=O._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(O._currentLimitVelocityGradient=this._limitVelocityGradients[0],O._currentLimitVelocity1=O._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?O._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():O._currentLimitVelocity2=O._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(O._currentDragGradient=this._dragGradients[0],O._currentDrag1=O._currentDragGradient.getFactor(),this._dragGradients.length>1?O._currentDrag2=this._dragGradients[1].getFactor():O._currentDrag2=O._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)O._currentColorGradient=this._colorGradients[0],O._currentColorGradient.getColorToRef(O.color),O._currentColor1.p(O.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(O._currentColor2):O._currentColor2.p(O.color);else{const V=(0,R.u)(0,1);Y.f.LerpToRef(this.color1,this.color2,V,O.color),this.colorDead.subtractToRef(O.color,this._colorDiff),this._colorDiff.scaleToRef(1/O.lifeTime,O.colorStep)}this._isAnimationSheetEnabled&&(O._initialStartSpriteCellID=this.startSpriteCellID,O._initialEndSpriteCellID=this.endSpriteCellID,O._initialSpriteCellLoop=this.spriteCellLoop),O.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(O.remapData=new d.p(0,1,0,1)),this.noiseTexture&&(O._randomNoiseCoordinates1?(O._randomNoiseCoordinates1.nf(Math.random(),Math.random(),Math.random()),O._randomNoiseCoordinates2.nf(Math.random(),Math.random(),Math.random())):(O._randomNoiseCoordinates1=new d.m(Math.random(),Math.random(),Math.random()),O._randomNoiseCoordinates2=new d.m(Math.random(),Math.random(),Math.random()))),O._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=[G.e.PositionKind,G.e.ColorKind,"angle","offset","size"];return V&&d.push("cellIndex"),O||d.push("direction"),Z&&d.push("remapData"),d}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,OV.c)(d),V&&d.push("particlesInfos"),O&&d.push("logarithmicDepthConstant"),Z&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OV.l)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&V.push("#define FOG")),this._isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),O===a.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&V.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case 2:V.push("#define BILLBOARDY");break;case 8:case 9:V.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&V.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:V.push("#define BILLBOARDMODE_ALL")}Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,O,Z){O.push(...pV._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),V.push(...pV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,dV.g)(V,this._imageProcessingConfigurationDefines),(0,dV.c)(Z,this._imageProcessingConfigurationDefines))}_getWrapper(V){const O=this._getCustomDrawWrapper(V);if(null!==O&&void 0!==O&&O.effect)return O;const Z=[];this.fillDefines(Z,V);const d=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let p=this._drawWrappers[d];p||(p=this._drawWrappers[d]=[]);let r=p[V];r||(r=new VV.d(this._engine),r.drawContext&&(r.drawContext.useInstancing=this._useInstancing),p[V]=r);const Y=Z.join("\n");if(r.defines!==Y){const V=[],O=[],Z=[];this.fillUniformsAttributesAndSamplerNames(O,V,Z),r.setEffect(this._engine.createEffect("particles",V,O,Z,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return r}animate(){var V;let O,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!Z&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let V=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;x.GetCurrentGradient(O,this._emitRateGradients,((O,Z,d)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Z.getFactor(),this._currentEmitRateGradient=O),V=(0,R.m)(this._currentEmitRate1,this._currentEmitRate2,d)}))}O=V*this._scaledUpdateSpeed|0,this._newPartsExcess+=V*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Z){let V=0;for(let O=0;O<this.dj.length;O++){const Z=this.dj[O];this._appendParticleVertices(V,Z),V+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.dj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(V,O){this._appendParticleVertex(V++,O,0,0),this._useInstancing||(this._appendParticleVertex(V++,O,1,0),this._appendParticleVertex(V++,O,1,1),this._appendParticleVertex(V++,O,0,1))}rebuild(){var V;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(V=this._spriteBuffer)||void 0===V||V._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!pV.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Z.bind(Z,11939)),Promise.resolve().then(Z.bind(Z,11883))])):await Promise.all([Promise.resolve().then(Z.bind(Z,11877)),Promise.resolve().then(Z.bind(Z,11865))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==a.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(a.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(a.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(V){const O=this._getWrapper(V),Z=O.effect,p=this._engine;p.enableEffect(O);const r=this.defaultViewMatrix??this._scene.getViewMatrix();if(Z.setTexture("diffuseSampler",this.particleTexture),Z.setMatrix("view",r),Z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();Z.setFloat3("particlesInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,this.spriteCellWidth/V.width)}if(Z.setVector2("translationPivot",this.translationPivot),Z.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;Z.setVector3("eyePosition",V.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Z.setTexture("rampSampler",this._rampGradientsTexture));const Y=Z.defines;var m,R,i,M,c,W;(this._scene&&((0,OV.g)(Z,this,this._scene),this.applyFog&&(0,ZV.f)(this._scene,void 0,Z)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(r.invertToRef(d.i.Matrix[0]),Z.setMatrix("invView",d.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?p.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Z):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Z)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?p.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Z):p.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null,Z);switch(this.useLogarithmicDepth&&this._scene&&(0,ZV.j)(Y,Z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Z),V){case a.BLENDMODE_ADD:p.setAlphaMode(1);break;case a.BLENDMODE_ONEONE:p.setAlphaMode(6);break;case a.BLENDMODE_STANDARD:p.setAlphaMode(2);break;case a.BLENDMODE_MULTIPLY:p.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Z),this._useInstancing)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?p.drawElementsType(6,0,10,this.dj.length):p.drawArraysType(7,0,4,this.dj.length):null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?p.drawElementsType(1,0,10*this.dj.length):p.drawElementsType(0,0,6*this.dj.length);return this.dj.length}render(){if(!this.isReady()||!this.dj.length)return 0;const V=this._engine;V.setState&&(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0));let O=0;return O=this.blendMode===a.BLENDMODE_MULTIPLYADD?this._render(a.BLENDMODE_MULTIPLY)+this._render(a.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const V=this._scene.bj.indexOf(this);V>-1&&this._scene.bj.splice(V,1),this._scene._activeParticleSystems.dispose()}this.Xi.notifyObservers(this),this.Xi.clear(),this.onStoppedObservable.clear(),this.reset()}}pV.ForceGLSL=!1;var rV,YV=Z(10928);!function(V){V[V.ATTACHED=0]="ATTACHED",V[V.END=1]="END"}(rV||(rV={}));class mV{constructor(V){if(this.particleSystem=V,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!V.k||!V.k.dispose){const O=(0,m.c)("BABYLON.AbstractMesh");V.k=new O("SubemitterSystemEmitter",V.va()),V._disposeEmitterOnDispose=!0}}clone(){let V=this.particleSystem.k;if(V){if(V instanceof d.m)V=V.clone();else if(-1!==V.getClassName().indexOf("Mesh")){V=new((0,m.c)("BABYLON.Mesh"))("",V.va()),V.isVisible=!1}}else V=new d.m;const O=new mV(this.particleSystem.clone(this.particleSystem.name,V));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(V),O}static _ParseParticleSystem(V,O,Z){throw(0,YV.c)("ParseParticle")}static Parse(V,O,Z){const d=V.particleSystem,p=new mV(mV._ParseParticleSystem(d,O,Z,!0));return p.type=V.type,p.inheritDirection=V.inheritDirection,p.inheritedVelocityAmount=V.inheritedVelocityAmount,p.particleSystem._isSubEmitter=!0,p}dispose(){this.particleSystem.dispose()}}var aV=Z(10983);function RV(V,O){const Z=new U;return Z.direction1=V,Z.direction2=O,Z}function iV(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function MV(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function cV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.m(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0);return new S(V,O,Z)}function WV(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function FV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.m(0,1,0);return new Q(V,O,Z,p,r)}function QV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new c(V,O)}function bV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0);return new W(V,O,Z,p)}class UV extends pV{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=V=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[O].forEach((O=>{if(1===O.type){const Z=O.clone();V._inheritParticleInfoToSubEmitter(Z),Z.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(Z.particleSystem),Z.particleSystem.start()}}))}}createPointEmitter(V,O){const Z=RV(V,O);return this.particleEmitterType=Z,Z}createHemisphericEmitter(){const V=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=MV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=cV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=FV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.m(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=QV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=bV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,O,Z,d){const p=new M;return this.particleEmitterType=p,this.direction1=V,this.direction2=O,this.minEmitBox=Z,this.maxEmitBox=d,p}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((V=>{V instanceof UV?this._subEmitters.push([new mV(V)]):V instanceof mV?this._subEmitters.push([V]):V instanceof Array&&this._subEmitters.push(V)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((V=>{V.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const V=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==V&&this._rootParticleSystem.activeSubSystems.splice(V,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(V){V&&this._stopSubEmitters()}_prepareParticle(V){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];V._attachedSubEmitters=[],O.forEach((O=>{if(0===O.type){const Z=O.clone();V._attachedSubEmitters.push(Z),Z.particleSystem.start()}}))}}_onDispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var Z;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),V)&&(null===(Z=this.particles)||void 0===Z||Z.forEach((V=>{if(V._attachedSubEmitters)for(let O=V._attachedSubEmitters.length-1;O>=0;O-=1)V._attachedSubEmitters[O].dispose()})));if(O&&this.activeSubSystems)for(let d=this.activeSubSystems.length-1;d>=0;d-=1)this.activeSubSystems[d].dispose();if(this._subEmitters&&this._subEmitters.length){for(let V=0;V<this._subEmitters.length;V++)for(const O of this._subEmitters[V])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(V,O,Z,p){let r;r=Z instanceof aV.e?null:Z;const a=(0,m.c)("BABYLON.Texture");if(a&&r&&(V.texture?O.particleTexture=a.Parse(V.texture,r,p):V.textureName&&(O.particleTexture=new a(p+V.textureName,r,!1,void 0===V.invertY||V.invertY),O.particleTexture.name=V.textureName)),V.emitterId||0===V.emitterId||void 0!==V.k?V.emitterId&&r?O.k=r.getLastMeshById(V.emitterId):O.k=d.m.Cg(V.k):O.k=d.m.Zero(),O.isLocal=!!V.isLocal,void 0!==V.renderingGroupId&&(O.renderingGroupId=V.renderingGroupId),void 0!==V.isBillboardBased&&(O.isBillboardBased=V.isBillboardBased),void 0!==V.billboardMode&&(O.billboardMode=V.billboardMode),void 0!==V.useLogarithmicDepth&&(O.useLogarithmicDepth=V.useLogarithmicDepth),V.animations){for(let Z=0;Z<V.animations.length;Z++){const d=V.animations[Z],p=(0,m.c)("BABYLON.Animation");p&&O.animations.push(p.Parse(d))}O.beginAnimationOnStart=V.beginAnimationOnStart,O.beginAnimationFrom=V.beginAnimationFrom,O.beginAnimationTo=V.beginAnimationTo,O.beginAnimationLoop=V.beginAnimationLoop}if(V.autoAnimate&&r&&r.beginAnimation(O,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),O.startDelay=0|V.startDelay,O.minAngularSpeed=V.minAngularSpeed,O.maxAngularSpeed=V.maxAngularSpeed,O.minSize=V.minSize,O.maxSize=V.maxSize,V.minScaleX&&(O.minScaleX=V.minScaleX,O.maxScaleX=V.maxScaleX,O.minScaleY=V.minScaleY,O.maxScaleY=V.maxScaleY),void 0!==V.preWarmCycles&&(O.preWarmCycles=V.preWarmCycles,O.preWarmStepOffset=V.preWarmStepOffset),void 0!==V.minInitialRotation&&(O.minInitialRotation=V.minInitialRotation,O.maxInitialRotation=V.maxInitialRotation),O.minLifeTime=V.minLifeTime,O.maxLifeTime=V.maxLifeTime,O.minEmitPower=V.minEmitPower,O.maxEmitPower=V.maxEmitPower,O.emitRate=V.emitRate,O.gravity=d.m.Cg(V.gravity),V.noiseStrength&&(O.noiseStrength=d.m.Cg(V.noiseStrength)),O.color1=Y.f.Cg(V.color1),O.color2=Y.f.Cg(V.color2),O.colorDead=Y.f.Cg(V.colorDead),O.updateSpeed=V.updateSpeed,O.targetStopDuration=V.targetStopDuration,O.blendMode=V.blendMode,V.colorGradients)for(const d of V.colorGradients)O.addColorGradient(d.gradient,Y.f.Cg(d.color1),d.color2?Y.f.Cg(d.color2):void 0);if(V.rampGradients){for(const Z of V.rampGradients)O.addRampGradient(Z.gradient,Y.b.Cg(Z.color));O.useRampGradients=V.useRampGradients}if(V.colorRemapGradients)for(const d of V.colorRemapGradients)O.addColorRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.alphaRemapGradients)for(const d of V.alphaRemapGradients)O.addAlphaRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.sizeGradients)for(const d of V.sizeGradients)O.addSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.angularSpeedGradients)for(const d of V.angularSpeedGradients)O.addAngularSpeedGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.velocityGradients)for(const d of V.velocityGradients)O.addVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.dragGradients)for(const d of V.dragGradients)O.addDragGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.emitRateGradients)for(const d of V.emitRateGradients)O.addEmitRateGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.startSizeGradients)for(const d of V.startSizeGradients)O.addStartSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.lifeTimeGradients)for(const d of V.lifeTimeGradients)O.addLifeTimeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(V.limitVelocityGradients){for(const Z of V.limitVelocityGradients)O.addLimitVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);O.limitVelocityDamping=V.limitVelocityDamping}if(V.noiseTexture&&r){const Z=(0,m.c)("BABYLON.ProceduralTexture");O.noiseTexture=Z.Parse(V.noiseTexture,r,p)}let R;if(V.particleEmitterType){switch(V.particleEmitterType.type){case"SphereParticleEmitter":R=new H;break;case"SphereDirectedParticleEmitter":R=new S;break;case"ConeEmitter":case"ConeParticleEmitter":R=new c;break;case"ConeDirectedParticleEmitter":R=new W;break;case"CylinderParticleEmitter":R=new F;break;case"CylinderDirectedParticleEmitter":R=new Q;break;case"HemisphericParticleEmitter":R=new b;break;case"PointParticleEmitter":R=new U;break;case"MeshParticleEmitter":R=new w;break;case"CustomParticleEmitter":R=new z;break;default:R=new M}R.parse(V.particleEmitterType,r)}else R=new M,R.parse(V,r);O.particleEmitterType=R,O.startSpriteCellID=V.startSpriteCellID,O.endSpriteCellID=V.endSpriteCellID,O.spriteCellLoop=V.spriteCellLoop??!0,O.spriteCellWidth=V.spriteCellWidth,O.spriteCellHeight=V.spriteCellHeight,O.spriteCellChangeSpeed=V.spriteCellChangeSpeed,O.spriteRandomStartCell=V.spriteRandomStartCell,O.disposeOnStop=V.disposeOnStop??!1,O.manualEmitCount=V.manualEmitCount??-1}static Parse(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;const m=V.name;let a,R,i=null,M=null;if(O instanceof aV.e?a=O:(R=O,a=R.getEngine()),V.customShader&&a.createEffectForParticles){M=V.customShader;const O=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"";i=a.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,O)}const c=new UV(m,r||V.wj,O,i,V.isAnimationSheetEnabled);if(c.customShader=M,c._rootUrl=Z,V.id&&(c.id=V.id),V.subEmitters){c.subEmitters=[];for(const d of V.subEmitters){const V=[];for(const p of d)V.push(mV.Parse(p,O,Z));c.subEmitters.push(V)}}return UV._Parse(V,c,O,Z),V.textureMask&&(c.textureMask=Y.f.Cg(V.textureMask)),V.lf&&(c.lf=d.m.Cg(V.lf)),V.preventAutoStart&&(c.preventAutoStart=V.preventAutoStart),p||c.preventAutoStart||c.start(),c}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(UV._Serialize(O,this,V),O.textureMask=this.textureMask.Wi(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.lf=this.lf.Wi(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Z of this._subEmitters){const d=[];for(const O of Z)d.push(O.serialize(V));O.subEmitters.push(d)}}return O}static _Serialize(V,O,Z){if(V.name=O.name,V.id=O.id,V.wj=O.getCapacity(),V.disposeOnStop=O.disposeOnStop,V.manualEmitCount=O.manualEmitCount,O.k.position){const Z=O.k;V.emitterId=Z.id}else{const Z=O.k;V.k=Z.Wi()}O.particleEmitterType&&(V.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(Z?V.texture=O.particleTexture.serialize():(V.textureName=O.particleTexture.name,V.invertY=!!O.particleTexture._invertY)),V.isLocal=O.isLocal,k.b.AppendSerializedAnimations(O,V),V.beginAnimationOnStart=O.beginAnimationOnStart,V.beginAnimationFrom=O.beginAnimationFrom,V.beginAnimationTo=O.beginAnimationTo,V.beginAnimationLoop=O.beginAnimationLoop,V.startDelay=O.startDelay,V.renderingGroupId=O.renderingGroupId,V.isBillboardBased=O.isBillboardBased,V.billboardMode=O.billboardMode,V.minAngularSpeed=O.minAngularSpeed,V.maxAngularSpeed=O.maxAngularSpeed,V.minSize=O.minSize,V.maxSize=O.maxSize,V.minScaleX=O.minScaleX,V.maxScaleX=O.maxScaleX,V.minScaleY=O.minScaleY,V.maxScaleY=O.maxScaleY,V.minEmitPower=O.minEmitPower,V.maxEmitPower=O.maxEmitPower,V.minLifeTime=O.minLifeTime,V.maxLifeTime=O.maxLifeTime,V.emitRate=O.emitRate,V.gravity=O.gravity.Wi(),V.noiseStrength=O.noiseStrength.Wi(),V.color1=O.color1.Wi(),V.color2=O.color2.Wi(),V.colorDead=O.colorDead.Wi(),V.updateSpeed=O.updateSpeed,V.targetStopDuration=O.targetStopDuration,V.blendMode=O.blendMode,V.preWarmCycles=O.preWarmCycles,V.preWarmStepOffset=O.preWarmStepOffset,V.minInitialRotation=O.minInitialRotation,V.maxInitialRotation=O.maxInitialRotation,V.startSpriteCellID=O.startSpriteCellID,V.spriteCellLoop=O.spriteCellLoop,V.endSpriteCellID=O.endSpriteCellID,V.spriteCellChangeSpeed=O.spriteCellChangeSpeed,V.spriteCellWidth=O.spriteCellWidth,V.spriteCellHeight=O.spriteCellHeight,V.spriteRandomStartCell=O.spriteRandomStartCell,V.isAnimationSheetEnabled=O.isAnimationSheetEnabled,V.useLogarithmicDepth=O.useLogarithmicDepth;const d=O.getColorGradients();if(d){V.colorGradients=[];for(const O of d){const Z={gradient:O.gradient,color1:O.color1.Wi()};O.color2?Z.color2=O.color2.Wi():Z.color2=O.color1.Wi(),V.colorGradients.push(Z)}}const p=O.getRampGradients();if(p){V.rampGradients=[];for(const O of p){const Z={gradient:O.gradient,color:O.color.Wi()};V.rampGradients.push(Z)}V.useRampGradients=O.useRampGradients}const r=O.getColorRemapGradients();if(r){V.colorRemapGradients=[];for(const O of r){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.colorRemapGradients.push(Z)}}const Y=O.getAlphaRemapGradients();if(Y){V.alphaRemapGradients=[];for(const O of Y){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.alphaRemapGradients.push(Z)}}const m=O.getSizeGradients();if(m){V.sizeGradients=[];for(const O of m){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.sizeGradients.push(Z)}}const a=O.getAngularSpeedGradients();if(a){V.angularSpeedGradients=[];for(const O of a){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.angularSpeedGradients.push(Z)}}const R=O.getVelocityGradients();if(R){V.velocityGradients=[];for(const O of R){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.velocityGradients.push(Z)}}const i=O.getDragGradients();if(i){V.dragGradients=[];for(const O of i){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.dragGradients.push(Z)}}const M=O.getEmitRateGradients();if(M){V.emitRateGradients=[];for(const O of M){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.emitRateGradients.push(Z)}}const c=O.getStartSizeGradients();if(c){V.startSizeGradients=[];for(const O of c){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.startSizeGradients.push(Z)}}const W=O.getLifeTimeGradients();if(W){V.lifeTimeGradients=[];for(const O of W){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.lifeTimeGradients.push(Z)}}const F=O.getLimitVelocityGradients();if(F){V.limitVelocityGradients=[];for(const O of F){const Z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?Z.factor2=O.factor2:Z.factor2=O.factor1,V.limitVelocityGradients.push(Z)}V.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(V.noiseTexture=O.noiseTexture.serialize())}clone(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let p=null;const r=this._engine;if(r.createEffectForParticles&&null!=this.customShader){p=this.customShader;const V=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",O=r.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,V);d[0]?d[0].effect=O:this.setCustomEffect(O,0)}const Y=this.serialize(Z),m=UV.Parse(Y,this._scene||this._engine,this._rootUrl);return m.name=V,m.customShader=p,m._customWrappers=d,void 0===O&&(O=this.k),this.noiseTexture&&(m.noiseTexture=this.noiseTexture.clone()),m.k=O,this.preventAutoStart||m.start(),m}}UV.BILLBOARDMODE_Y=2,UV.BILLBOARDMODE_ALL=7,UV.BILLBOARDMODE_STRETCHED=8,UV.BILLBOARDMODE_STRETCHED_LOCAL=9,mV._ParseParticleSystem=UV.Parse;var HV=Z(11265),SV=Z(11238),zV=Z(11698);zV.b.prototype.createTransformFeedback=function(){const V=this._gl.createTransformFeedback();if(!V)throw new Error("Unable to create Transform Feedback");return V},zV.b.prototype.deleteTransformFeedback=function(V){this._gl.deleteTransformFeedback(V)},zV.b.prototype.bindTransformFeedback=function(V){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,V)},zV.b.prototype.beginTransformFeedback=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(V?this._gl.POINTS:this._gl.TRIANGLES)},zV.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},zV.b.prototype.setTranformFeedbackVaryings=function(V,O){this._gl.transformFeedbackVaryings(V,O,this._gl.INTERLEAVED_ATTRIBS)},zV.b.prototype.bindTransformFeedbackBuffer=function(V){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V?V.underlyingResource:null)},zV.b.prototype.readTransformFeedbackBuffer=function(V){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V)};const GV="clipPlaneFragmentDeclaration2",wV="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";v.d.IncludesShadersStore[GV]=wV;Z(11780),Z(11784),Z(11793),Z(11795),Z(11803),Z(11808),Z(11816),Z(11824);const tV="gpuRenderParticlesPixelShader",CV="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";v.d.ShadersStore[tV]=CV;const vV="clipPlaneVertexDeclaration2",AV="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";v.d.IncludesShadersStore[vV]=AV;Z(11829),Z(11831),Z(11839),Z(11844);const lV="gpuRenderParticlesVertexShader",IV="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";v.d.ShadersStore[lV]=IV;class gV extends a{static get IsSupported(){if(!B.e.LastCreatedEngine)return!1;const V=B.e.LastCreatedEngine.getCaps();return V.supportTransformFeedbacks||V.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(V){this._maxActiveParticleCount=Math.min(V,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(V){this.maxActiveParticleCount=V}createPointEmitter(V,O){const Z=RV(V,O);return this.particleEmitterType=Z,Z}createHemisphericEmitter(){const V=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=MV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=cV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=FV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.m(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=QV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=bV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.m(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,O,Z,d){const p=new M;return this.particleEmitterType=p,this.direction1=V,this.direction2=O,this.minEmitBox=Z,this.maxEmitBox=d,p}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==UV.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(UV.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(UV.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";V?setTimeout((()=>{this.start(0)}),V):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var V;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[O])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new VV.d(this._engine),this._customWrappers[O].effect=V}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(V,O,Z){return super._removeGradientAndTexture(V,O,Z),this._releaseBuffers(),this}addColorGradient(V,O){this._colorGradients||(this._colorGradients=[]);const Z=new K(V,O);return this._colorGradients.push(Z),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(V&&this._colorGradients.sort(((V,O)=>V.gradient<O.gradient?-1:V.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(V){return this._removeGradientAndTexture(V,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var V;null===(V=this._drawWrappers[O].drawContext)||void 0===V||V.reset()}}_addFactorGradient(V,O,Z){const d=new h(O,Z);V.push(d),this._releaseBuffers()}addSizeGradient(V,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(V){return this._removeGradientAndTexture(V,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(V,O){if(!V)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&V.sort(((V,O)=>V.gradient<O.gradient?-1:V.gradient>O.gradient?1:0));const Z=this;Z[O]&&(Z[O].dispose(),Z[O]=null)}addAngularSpeedGradient(V,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(V){return this._removeGradientAndTexture(V,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(V,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(V){return this._removeGradientAndTexture(V,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(V,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(V){return this._removeGradientAndTexture(V,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(V,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(V){return this._removeGradientAndTexture(V,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(V){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(V),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Xi=new y.e,this.onStoppedObservable=new y.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=d.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||B.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.bj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,m.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,m.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,m.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,m.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new VV.d(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers={0:new VV.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const Y={wj:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},a=O;isFinite(a)&&(Y.wj=a),this._capacity=Y.wj,this._maxActiveParticleCount=Y.wj,this._currentActiveCount=0,this._isAnimationSheetEnabled=r,this.particleEmitterType=new M;const R=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let i=[];for(let d=0;d<R;++d)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture=new T.e(new Float32Array(i),R,1,5,Z,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,i=[];for(let d=0;d<R;++d)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture2=new T.e(new Float32Array(i),R,1,5,Z,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=R}_reset(){this._releaseBuffers()}_createVertexBuffers(V,O,Z){const d={};d.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let p=3;d.age=O.createVertexBuffer("age",p,1,this._attributesStrideSize,!0),p+=1,d.size=O.createVertexBuffer("size",p,3,this._attributesStrideSize,!0),p+=3,d.life=O.createVertexBuffer("life",p,1,this._attributesStrideSize,!0),p+=1,p+=4,this.billboardMode===UV.BILLBOARDMODE_STRETCHED&&(d.direction=O.createVertexBuffer("direction",p,3,this._attributesStrideSize,!0)),p+=3,this._platform.alignDataInBuffer&&(p+=1),this.particleEmitterType instanceof z&&(p+=3,this._platform.alignDataInBuffer&&(p+=1)),this._colorGradientsTexture||(d.color=O.createVertexBuffer("color",p,4,this._attributesStrideSize,!0),p+=4),this._isBillboardBased||(d.initialDirection=O.createVertexBuffer("initialDirection",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),this.noiseTexture&&(d.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1),d.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),d.angle=O.createVertexBuffer("angle",p,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?p++:p+=2,this._isAnimationSheetEnabled&&(d.cellIndex=O.createVertexBuffer("cellIndex",p,1,this._attributesStrideSize,!0),p+=1,this.spriteRandomStartCell&&(d.cellStartOffset=O.createVertexBuffer("cellStartOffset",p,1,this._attributesStrideSize,!0),p+=1)),d.offset=Z.createVertexBuffer("offset",0,2),d.uv=Z.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(d),this._platform.createVertexBuffers(V,d),this.resetDrawCache()}_initialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!V)return;const O=this._engine,Z=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const p=this.particleEmitterType instanceof z,r=d.i.ib[0];let Y=0;for(let d=0;d<this._capacity;d++)if(Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),p?(this.particleEmitterType.particleDestinationGenerator(d,null,r),Z.push(r.x),Z.push(r.y),Z.push(r.z)):(Z.push(0),Z.push(0),Z.push(0)),this._platform.alignDataInBuffer&&Z.push(0),Y+=16,p&&(this.particleEmitterType.particlePositionGenerator(d,null,r),Z.push(r.x),Z.push(r.y),Z.push(r.z),this._platform.alignDataInBuffer&&Z.push(0),Y+=4),this._colorGradientsTexture||(Z.push(0),Z.push(0),Z.push(0),Z.push(0),Y+=4),this.isBillboardBased||(Z.push(0),Z.push(0),Z.push(0),this._platform.alignDataInBuffer&&Z.push(0),Y+=4),this.noiseTexture&&(Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),Y+=8),Z.push(0),Y+=1,this._angularSpeedGradientsTexture||(Z.push(0),Y+=1),this._isAnimationSheetEnabled&&(Z.push(0),Y+=1,this.spriteRandomStartCell&&(Z.push(0),Y+=1)),this._platform.alignDataInBuffer){let V=3-(Y+3&3);for(Y+=V;V-- >0;)Z.push(0)}const m=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),a=this._platform.createParticleBuffer(Z),R=this._platform.createParticleBuffer(Z);this._buffer0=new G.c(O,a,!1,this._attributesStrideSize),this._buffer1=new G.c(O,R,!1,this._attributesStrideSize),this._spriteBuffer=new G.c(O,m,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let V=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(V+="\n#define BILLBOARD"),this._colorGradientsTexture&&(V+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(V+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(V+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(V+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(V+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(V+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(V+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(V+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(V+="\n#define NOISE"),this.isLocal&&(V+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===V||(this._cachedUpdateDefines=V,this._updateBuffer=this._platform.createUpdateBuffer(V)),this._platform.isUpdateBufferReady()}_getWrapper(V){const O=this._getCustomDrawWrapper(V);if(null!==O&&void 0!==O&&O.effect)return O;const Z=[];this.fillDefines(Z,V);let d=this._drawWrappers[V];d||(d=new VV.d(this._engine),d.drawContext&&(d.drawContext.useInstancing=!0),this._drawWrappers[V]=d);const p=Z.join("\n");if(d.defines!==p){const V=[],O=[],Z=[];this.fillUniformsAttributesAndSamplerNames(O,V,Z),d.setEffect(this._engine.createEffect("gpuRenderParticles",V,O,Z,p),p)}return d}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=[G.e.PositionKind,"age","life","size","angle"];return V||p.push(G.e.ColorKind),O&&p.push("cellIndex"),Z||p.push("initialDirection"),d&&p.push("direction"),p.push("offset",G.e.UVKind),p}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["emitterWM","lf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,OV.c)(d),V&&d.push("sheetInfos"),O&&d.push("logarithmicDepthConstant"),Z&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OV.l)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==SV.b.FOGMODE_NONE&&V.push("#define FOG")),O===UV.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this.isLocal&&V.push("#define LOCAL"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case UV.BILLBOARDMODE_Y:V.push("#define BILLBOARDY");break;case UV.BILLBOARDMODE_STRETCHED:V.push("#define BILLBOARDSTRETCHED");break;case UV.BILLBOARDMODE_ALL:V.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&V.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,O,Z){O.push(...gV._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===UV.BILLBOARDMODE_STRETCHED)),V.push(...gV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(HV.b.PrepareUniforms(V,this._imageProcessingConfigurationDefines),HV.b.PrepareSamplers(Z,this._imageProcessingConfigurationDefines))}animate(){var V;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(V,O){const Z=this[O];if(!V||!V.length||Z)return;const d=new Float32Array(this._rawTextureWidth);for(let p=0;p<this._rawTextureWidth;p++){const O=p/this._rawTextureWidth;x.GetCurrentGradient(O,V,((V,O,Z)=>{d[p]=(0,R.m)(V.factor1,O.factor1,Z)}))}this[O]=T.e.CreateRTexture(d,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const V=new Uint8Array(4*this._rawTextureWidth),O=Y.h.rb[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const d=Z/this._rawTextureWidth;x.GetCurrentGradient(d,this._colorGradients,((d,p,r)=>{Y.f.LerpToRef(d.color1,p.color1,r,O),V[4*Z]=255*O.r,V[4*Z+1]=255*O.g,V[4*Z+2]=255*O.b,V[4*Z+3]=255*O.a}))}this._colorGradientsTexture=T.e.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(V,O){var Z,p,r,Y;const m=this._getWrapper(V),a=m.effect;this._engine.enableEffect(m);const R=(null===(Z=this._scene)||void 0===Z?void 0:Z.getViewMatrix())||d.c.IdentityReadOnly;if(a.setMatrix("view",R),a.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),a.setTexture("diffuseSampler",this.particleTexture),a.setVector2("translationPivot",this.translationPivot),a.setVector3("lf",this.lf),this.isLocal&&a.setMatrix("emitterWM",O),this._colorGradientsTexture?a.setTexture("colorGradientSampler",this._colorGradientsTexture):a.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();a.setFloat3("sheetInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,V.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;a.setVector3("eyePosition",V.globalPosition)}const i=a.defines;if(this._scene&&((0,OV.g)(a,this,this._scene),this.applyFog&&(0,ZV.f)(this._scene,void 0,a)),i.indexOf("#define BILLBOARDMODE_ALL")>=0){const V=R.clone();V.invert(),a.setMatrix("invView",V)}switch(this.useLogarithmicDepth&&this._scene&&(0,ZV.j)(i,a,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a),V){case UV.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case UV.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case UV.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case UV.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,a,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(a),null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(V){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!V)if(this.k.position){V=this.k.getWorldMatrix()}else{const O=this.k;V=d.i.Matrix[0],d.c.TranslationToRef(O.x,O.y,O.z,V)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",V),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const O=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=O}render(){let V,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const V=0|this._accumulatedCount;this._accumulatedCount-=V,this._currentActiveCount+=V}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){V=this.k.getWorldMatrix()}else{const O=this.k;V=d.i.Matrix[0],d.c.TranslationToRef(O.x,O.y,O.z,V)}const p=this._engine;this.updateInAnimate||this._update(V);let r=0;return O||Z||(p.setState(!1),this.forceDepthWrite&&p.setDepthWrite(!0),r=this.blendMode===UV.BLENDMODE_MULTIPLYADD?this._render(UV.BLENDMODE_MULTIPLY,V)+this._render(UV.BLENDMODE_ADD,V):this._render(this.blendMode,V),this._engine.setAlphaMode(0)),r}rebuild(){const V=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(V,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,V()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const V=this._scene.bj.indexOf(this);V>-1&&this._scene.bj.splice(V,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const V=this._renderVertexBuffers[O];for(const O in V)V[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Xi.notifyObservers(this),this.Xi.clear()}clone(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let p=null;const r=this._engine;if(r.createEffectForParticles&&null!=this.customShader){p=this.customShader;const V=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";d[0]=r.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,V,void 0,void 0,void 0,this)}const Y=this.serialize(Z),m=gV.Parse(Y,this._scene||this._engine,this._rootUrl);return m.name=V,m.customShader=p,m._customWrappers=d,void 0===O&&(O=this.k),this.noiseTexture&&(m.noiseTexture=this.noiseTexture.clone()),m.k=O,m}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return UV._Serialize(O,this,V),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const r=V.name;let Y,m;O instanceof aV.e?Y=O:(m=O,Y=m.getEngine());const a=new gV(r,{wj:p||V.wj,randomTextureSize:V.randomTextureSize},O,null,V.isAnimationSheetEnabled);if(a._rootUrl=Z,V.customShader&&Y.createEffectForParticles){const O=V.customShader,Z=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",d=Y.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,Z,void 0,void 0,void 0,a);a.setCustomEffect(d,0),a.customShader=O}return V.id&&(a.id=V.id),V.activeParticleCount&&(a.activeParticleCount=V.activeParticleCount),UV._Parse(V,a,O,Z),V.preventAutoStart&&(a.preventAutoStart=V.preventAutoStart),d||a.preventAutoStart||a.start(),a}}var nV=Z(10900),eV=Z(11846),uV=Z(11201);class kV{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(V){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.k=V;this._emitterNode=V}setEmitterAsSphere(V,O,Z){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:V,renderingGroupId:O};const d=(0,eV.b)("emitterSphere",{diameter:V.diameter,segments:V.segments},Z);d.renderingGroupId=O;const p=new uV.e("emitterSphereMaterial",Z);p.emissiveColor=V.color,d.material=p;for(const r of this.systems)r.k=d;this._emitterNode=d}start(V){for(const O of this.systems)V&&(O.k=V),O.start()}dispose(){for(const V of this.systems)V.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const Z of this.systems)O.systems.push(Z.serialize(V));return this._emitterNode&&(O.k=this._emitterCreationOptions),O}static Parse(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;const p=new kV,r=this.BaseAssetsUrl+"/textures/";O=O||B.e.LastCreatedScene;for(const Y of V.systems)p.systems.push(Z?gV.Parse(Y,O,r,!0,d):UV.Parse(Y,O,r,!0,d));if(V.k){const Z=V.k.options;if("Sphere"===V.k.kind)p.setEmitterAsSphere({diameter:Z.diameter,segments:Z.segments,color:Y.b.Cg(Z.color)},V.k.renderingGroupId,O)}return p}}kV.BaseAssetsUrl="https://assets.babylonjs.com/particles";var DV=Z(10933);class XV{static CreateDefault(V){let O,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,d=arguments.length>2?arguments[2]:void 0;return O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new gV("default system",{wj:Z},d):new UV("default system",Z,d),O.k=V,O.particleTexture=new D.b("https://assets.babylonjs.com/textures/flare.png",O.va()),O.createConeEmitter(.1,Math.PI/4),O.color1=new Y.f(1,1,1,1),O.color2=new Y.f(1,1,1,1),O.colorDead=new Y.f(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;O||(O=B.e.LastCreatedScene);const p={};return O.addPendingData(p),new Promise(((r,Y)=>{if(Z&&!gV.IsSupported)return O.removePendingData(p),Y("Particle system with GPU is not supported.");nV.e.LoadFile(`${XV.BaseAssetsUrl}/systems/${V}.json`,(V=>{O.removePendingData(p);const Y=JSON.parse(V.toString());return r(kV.Parse(Y,O,Z,d))}),void 0,void 0,void 0,(()=>(O.removePendingData(p),Y(`An error occurred with the creation of your particle system. Check if your type '${V}' exists.`))))}))}static ExportSet(V){const O=new kV;for(const Z of V)O.systems.push(Z);return O}static ParseFromFileAsync(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,m)=>{const a=new DV.b;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const O=JSON.parse(a.responseText);let m;m=d?gV.Parse(O,Z,p,!1,r):UV.Parse(O,Z,p,!1,r),V&&(m.name=V),Y(m)}else m("Unable to load the particle system")})),a.open("GET",O),a.send()}))}static ParseFromSnippetAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0;if("_BLANK"===V){const V=this.CreateDefault(null);return V.start(),Promise.resolve(V)}return new Promise(((r,Y)=>{const m=new DV.b;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const Y=JSON.parse(JSON.parse(m.responseText).jsonPayload),a=JSON.parse(Y.particleSystem);let R;R=Z?gV.Parse(a,O,d,!1,p):UV.Parse(a,O,d,!1,p),R.snippetId=V,r(R)}else Y("Unable to load the snippet "+V)})),m.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),m.send()}))}}XV.BaseAssetsUrl=kV.BaseAssetsUrl,XV.SnippetUrl="https://snippet.babylonjs.com",XV.CreateFromSnippetAsync=XV.ParseFromSnippetAsync;var oV=Z(11508),EV=Z(11342),LV=Z(11848);(0,LV.e)(EV.b.NAME_PARTICLESYSTEM,((V,O,Z,d)=>{const p=(0,LV.g)(EV.b.NAME_PARTICLESYSTEM);if(p&&void 0!==V.bj&&null!==V.bj)for(let r=0,Y=V.bj.length;r<Y;r++){const Y=V.bj[r];Z.bj.push(p(Y,O,d))}})),(0,LV.d)(EV.b.NAME_PARTICLESYSTEM,((V,O,Z)=>{if(V.activeParticleCount){return gV.Parse(V,O,Z)}return UV.Parse(V,O,Z)})),aV.e.prototype.createEffectForParticles=function(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=[],M=[];const c=[];return a?a.fillUniformsAttributesAndSamplerNames(M,i,c):(i=UV._GetAttributeNamesOrOptions(),M=UV._GetEffectCreationOptions()),-1===p.indexOf(" BILLBOARD")&&(p+="\n#define BILLBOARD\n"),null!==a&&void 0!==a&&a.isAnimationSheetEnabled&&-1===p.indexOf(" ANIMATESHEET")&&(p+="\n#define ANIMATESHEET\n"),-1===d.indexOf("diffuseSampler")&&d.push("diffuseSampler"),this.createEffect({vertex:(null===a||void 0===a?void 0:a.vertexShaderName)??"particles",fragmentElement:V},i,M.concat(O),c.concat(d),p,r,Y,m,void 0,R,(async()=>{0===R?await Promise.resolve().then(Z.bind(Z,11877)):await Promise.resolve().then(Z.bind(Z,11939))}))},oV.c.prototype.getEmittedParticleSystems=function(){const V=[];for(let O=0;O<this.va().bj.length;O++){const Z=this.va().bj[O];Z.k===this&&V.push(Z)}return V},oV.c.prototype.getHierarchyEmittedParticleSystems=function(){const V=[],O=this.getDescendants();O.push(this);for(let Z=0;Z<this.va().bj.length;Z++){const d=this.va().bj[Z],p=d.k;p.position&&-1!==O.indexOf(p)&&V.push(d)}return V};Z(11421),Z(11426),Z(11552);Z(11530),Z(11855),Z(11562),Z(11413),Z(11566);Z(11715);var JV;Z(11862),Z(11471);!function(V){V[V.Color=2]="Color",V[V.UV=1]="UV",V[V.Random=0]="Random",V[V.Stated=3]="Stated"}(JV||(JV={}));Z(11865),Z(11877),Z(11883),Z(11939)},11748:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>F});var d=Z(11210),p=Z(11230),r=Z(10902),Y=Z(11251),m=Z(10986),a=Z(11216),R=Z(11283),i=Z(11041),M=Z(10983),c=Z(11049),W=Z(11753);M.e.prototype.setTextureFromPostProcess=function(V,O,Z){var d;let p=null;O&&(O._forcedOutputTexture?p=O._forcedOutputTexture:O._textures.data[O._currentRenderTextureInd]&&(p=O._textures.data[O._currentRenderTextureInd])),this._bindTexture(V,(null===(d=p)||void 0===d?void 0:d.texture)??null,Z)},M.e.prototype.setTextureFromPostProcessOutput=function(V,O,Z){var d;this._bindTexture(V,(null===O||void 0===O||null===(d=O._outputTexture)||void 0===d?void 0:d.texture)??null,Z)},m.c.prototype.setTextureFromPostProcess=function(V,O){this._engine.setTextureFromPostProcess(this._samplers[V],O,V)},m.c.prototype.setTextureFromPostProcessOutput=function(V,O){this._engine.setTextureFromPostProcessOutput(this._samplers[V],O,V)};class F{static get ForceGLSL(){return W.g.ForceGLSL}static set ForceGLSL(V){W.g.ForceGLSL=V}static RegisterShaderCodeProcessing(V,O){W.g.RegisterShaderCodeProcessing(V,O)}get name(){return this._effectWrapper.name}set name(V){this._effectWrapper.name=V}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(V){this._effectWrapper.alphaMode=V}get samples(){return this._samples}set samples(V){this._samples=Math.min(V,this._engine.getCaps().maxMSAASamples),this._textures.forEach((V=>{V.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(V){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),V&&(this._onActivateObserver=this.onActivateObservable.add(V))}set onSizeChanged(V){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(V)}set onApply(V){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(V)}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(V){this._forcedOutputTexture=V}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.nf(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(V,O,Z,d,m,a){var R;let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,M=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",H=arguments.length>12?arguments[12]:void 0,S=arguments.length>13&&void 0!==arguments[13]&&arguments[13],z=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,G=arguments.length>15?arguments[15]:void 0,w=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Fi=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new p.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new Y.l(1,1),this._texelSize=Y.l.Zero(),this.onActivateObservable=new r.e,this.onSizeChangedObservable=new r.e,this.onApplyObservable=new r.e,this.onBeforeRenderObservable=new r.e,this.onAfterRenderObservable=new r.e;let t,C=1,v=null;if(Z&&!Array.isArray(Z)){const V=Z;Z=V.uniforms??null,d=V.samplers??null,C=V.size??1,a=V.camera??null,i=V.samplingMode??1,M=V.bd,c=V.reusable,Q=Array.isArray(V.defines)?V.defines.join("\n"):V.defines??null,b=V.textureType??0,U=V.vertexUrl??"postprocess",H=V.indexParameters,S=V.blockCompilation??!1,z=V.textureFormat??5,G=V.shaderLanguage??0,v=V.uniformBuffers??null,w=V.extraInitializations,t=V.effectWrapper}else m&&(C="number"===typeof m?m:{width:m.width,height:m.height});const A=!!t;if(this._effectWrapper=t??new W.g({name:V,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:O,bd:M||(null===(R=a)||void 0===R?void 0:R.va().getEngine()),uniforms:Z,samplers:d,uniformBuffers:v,defines:Q,vertexUrl:U,indexParameters:H,blockCompilation:S,shaderLanguage:G,extraInitializations:w}),this.name=V,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=a?(this._camera=a,this._scene=a.va(),a.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):M&&(this._engine=M,this._engine.postProcesses.push(this)),this._options=C,this.renderTargetSamplingMode=i||1,this._reusable=c||!1,this._textureType=b,this._textureFormat=z,this._shaderLanguage=G||0,this._samplers=d||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=O,this._vertexUrl=U,this._parameters=Z||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=v||[],this._indexParameters=H,!A){this._webGPUReady=1===this._shaderLanguage;const V=[];this._gatherImports(this._engine.isWebGPU&&!F.ForceGLSL,V),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(S,Q,w,V)}}_gatherImports(){let V=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?V.push(Promise.all([Z.e(37).then(Z.bind(Z,13392))])):V.push(Promise.all([Promise.resolve().then(Z.bind(Z,11762))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(V){return this._disposeTextures(),this._shareOutputWithPostProcess=V,this}useOwnOutput(){0==this._textures.length&&(this._textures=new p.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(V,O,Z,d,p,r,Y,m),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let p=0;p<this._textureCache.length;p++)if(this._textureCache[p].texture.width===V.width&&this._textureCache[p].texture.height===V.height&&this._textureCache[p].postProcessChannel===Z&&this._textureCache[p].texture._generateDepthBuffer===O.generateDepthBuffer&&this._textureCache[p].texture.samples===O.samples)return this._textureCache[p].texture;const d=this._engine.createRenderTargetTexture(V,O);return this._textureCache.push({texture:d,postProcessChannel:Z,lastUsedRenderId:-1}),d}_flushTextureCache(){const V=this._renderId;for(let O=this._textureCache.length-1;O>=0;O--)if(V-this._textureCache[O].lastUsedRenderId>100){let V=!1;for(let Z=0;Z<this._textures.length;Z++)if(this._textures.data[Z]===this._textureCache[O].texture){V=!0;break}V||(this._textureCache[O].texture.dispose(),this._textureCache.splice(O,1))}}resize(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=V,this.height=O;let r=null;if(Z)for(let a=0;a<Z._postProcesses.length;a++)if(null!==Z._postProcesses[a]){r=Z._postProcesses[a];break}const Y={width:this.width,height:this.height},m={generateMipMaps:d,generateDepthBuffer:p||r===this,generateStencilBuffer:(p||r===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(Y,m,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(Y,m,1)),this._texelSize.nf(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let V;if(this._shareOutputWithPostProcess)V=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)V=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let O;V=this.inputTexture;for(let Z=0;Z<this._textureCache.length;Z++)if(this._textureCache[Z].texture===V){O=this._textureCache[Z];break}O&&(O.lastUsedRenderId=this._renderId)}return V}activate(V){var O,Z;let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;const r=(V=V||this._camera).va(),Y=r.getEngine(),m=Y.getCaps().maxTextureSize,a=(d?d.width:this._engine.getRenderWidth(!0))*this._options|0,R=(d?d.height:this._engine.getRenderHeight(!0))*this._options|0;let i=this._options.width||a,M=this._options.height||R;const W=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let F=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const V=Y.currentViewport;V&&(i*=V.width,M*=V.height)}(W||this.alwaysForcePOT)&&(this._options.width||(i=Y.needPOTTextures?(0,c.g)(i,m,this.scaleMode):i),this._options.height||(M=Y.needPOTTextures?(0,c.g)(M,m,this.scaleMode):M)),this.width===i&&this.height===M&&(F=this._getTarget())||this.resize(i,M,V,W,p),this._textures.forEach((V=>{V.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(V,this.samples)})),this._flushTextureCache(),this._renderId++}return F||(F=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.nf(a/i,R/M),this._engine.bindFramebuffer(F,0,a,R,this.forceFullscreenViewport)):(this._scaleRatio.nf(1,1),this._engine.bindFramebuffer(F,0,void 0,void 0,this.forceFullscreenViewport)),null===(O=(Z=this._engine)._debugInsertMarker)||void 0===O||O.call(Z,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(V),this.Fi&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),F}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let V;var O;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),V=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(O=V)||void 0===O?void 0:O.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let V=this._textureCache.length-1;V>=0;V--)this._textureCache[V].texture.dispose();this._textureCache.length=0}setPrePassRenderer(V){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=V.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(V){let O;if(V=V||this._camera,this._disposeTextures(),this._scene&&(O=this._scene.postProcesses.indexOf(this),-1!==O&&this._scene.postProcesses.splice(O,1)),this._parentContainer){const V=this._parentContainer.postProcesses.indexOf(this);V>-1&&this._parentContainer.postProcesses.splice(V,1),this._parentContainer=null}if(O=this._engine.postProcesses.indexOf(this),-1!==O&&this._engine.postProcesses.splice(O,1),V){if(V.detachPostProcess(this),O=V._postProcesses.indexOf(this),0===O&&V._postProcesses.length>0){const V=this._camera._getFirstPostProcess();V&&V.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const V=R.b.Serialize(this),O=this.getCamera()||this._scene&&this._scene.activeCamera;return V.customType="BABYLON."+this.getClassName(),V.cameraId=O?O.id:null,V.reusable=this._reusable,V.textureType=this._textureType,V.fragmentUrl=this._fragmentUrl,V.parameters=this._parameters,V.samplers=this._samplers,V.uniformBuffers=this._uniformBuffers,V.options=this._options,V.defines=this._postProcessDefines,V.textureFormat=this._textureFormat,V.vertexUrl=this._vertexUrl,V.indexParameters=this._indexParameters,V}clone(){const V=this.serialize();V._engine=this._engine,V.cameraId=null;const O=F.Parse(V,this._scene,"");return O?(O.onActivateObservable=this.onActivateObservable.clone(),O.onSizeChangedObservable=this.onSizeChangedObservable.clone(),O.onApplyObservable=this.onApplyObservable.clone(),O.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),O.onAfterRenderObservable=this.onAfterRenderObservable.clone(),O._prePassEffectConfiguration=this._prePassEffectConfiguration,O):null}static Parse(V,O,Z){const d=(0,i.c)(V.customType);if(!d||!d._Parse)return null;const p=O?O.getCameraById(V.cameraId):null;return d._Parse(V,p,O,Z)}static _Parse(V,O,Z,d){return R.b.Parse((()=>new F(V.name,V.fragmentUrl,V.parameters,V.samplers,V.options,O,V.renderTargetSamplingMode,V._engine,V.reusable,V.defines,V.textureType,V.vertexUrl,V.indexParameters,!1,V.textureFormat)),V,Z,d)}}(0,d.c)([(0,a.K)()],F.prototype,"uniqueId",void 0),(0,d.c)([(0,a.K)()],F.prototype,"name",null),(0,d.c)([(0,a.K)()],F.prototype,"width",void 0),(0,d.c)([(0,a.K)()],F.prototype,"height",void 0),(0,d.c)([(0,a.K)()],F.prototype,"renderTargetSamplingMode",void 0),(0,d.c)([(0,a.o)()],F.prototype,"clearColor",void 0),(0,d.c)([(0,a.K)()],F.prototype,"Fi",void 0),(0,d.c)([(0,a.K)()],F.prototype,"forceAutoClearInAlphaMode",void 0),(0,d.c)([(0,a.K)()],F.prototype,"alphaMode",null),(0,d.c)([(0,a.K)()],F.prototype,"alphaConstants",void 0),(0,d.c)([(0,a.K)()],F.prototype,"enablePixelPerfectMode",void 0),(0,d.c)([(0,a.K)()],F.prototype,"forceFullscreenViewport",void 0),(0,d.c)([(0,a.K)()],F.prototype,"scaleMode",void 0),(0,d.c)([(0,a.K)()],F.prototype,"alwaysForcePOT",void 0),(0,d.c)([(0,a.K)("samples")],F.prototype,"_samples",void 0),(0,d.c)([(0,a.K)()],F.prototype,"adaptScaleToCurrentViewport",void 0),(0,i.f)("BABYLON.PostProcess",F)},11328:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>r});var d=Z(11316),p=Z(10902);class r{constructor(V){this._vertexBuffers={},this.onBeforeRenderObservable=new p.e,this._scene=V}_prepareBuffers(){if(this._vertexBuffers[d.e.PositionKind])return;const V=[];V.push(1,1),V.push(-1,1),V.push(-1,-1),V.push(1,-1),this._vertexBuffers[d.e.PositionKind]=new d.e(this._scene.getEngine(),V,d.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const V=[];V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(V)}_rebuild(){const V=this._vertexBuffers[d.e.PositionKind];V&&(V._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.activeCamera;return!!Z&&(O=O||Z._postProcesses.filter((V=>null!=V)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(Z,V,null!==O&&void 0!==O),!0))}directRender(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=this._scene.getEngine();for(let a=0;a<V.length;a++){var m;if(a<V.length-1)V[a+1].activate(this._scene.activeCamera,null===O||void 0===O?void 0:O.texture);else O?Y.bindFramebuffer(O,d,void 0,void 0,Z,p):r||Y.restoreDefaultFramebuffer(),null===(m=Y._debugInsertMarker)||void 0===m||m.call(Y,`post process ${V[a].name} output`);const R=V[a],i=R.apply();i&&(R.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,i),Y.drawElementsType(0,0,6),R.onAfterRenderObservable.notifyObservers(i))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0)}_finalizeFrame(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=this._scene.activeCamera;if(!r)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(d=d||r._postProcesses.filter((V=>null!=V))).length||!this._scene.postProcessesEnabled)return;const Y=this._scene.getEngine();for(let a=0,R=d.length;a<R;a++){const i=d[a];var m;if(a<R-1)i._outputTexture=d[a+1].activate(r,null===O||void 0===O?void 0:O.texture);else O?(Y.bindFramebuffer(O,Z,void 0,void 0,p),i._outputTexture=O):(Y.restoreDefaultFramebuffer(),i._outputTexture=null),null===(m=Y._debugInsertMarker)||void 0===m||m.call(Y,`post process ${d[a].name} output`);if(V)break;const M=i.apply();M&&(i.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,M),Y.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(M))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0),Y.setAlphaMode(0)}dispose(){const V=this._vertexBuffers[d.e.PositionKind];V&&(V.dispose(),this._vertexBuffers[d.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11337:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>m});var d=Z(11230),p=Z(11251);class r{set opaqueSortCompareFn(V){this._opaqueSortCompareFn=V||r.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(V){this._alphaTestSortCompareFn=V||r.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(V){this._transparentSortCompareFn=V||r.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=V,this._opaqueSubMeshes=new d.h(256),this._transparentSubMeshes=new d.h(256),this._alphaTestSubMeshes=new d.h(256),this._depthOnlySubMeshes=new d.h(256),this._particleSystems=new d.h(256),this._spriteManagers=new d.h(256),this._empty=!0,this._edgesRenderers=new d.e(16),this._scene=O,this.opaqueSortCompareFn=Z,this.alphaTestSortCompareFn=p,this.transparentSortCompareFn=r}render(V,O,Z,d){if(V)return void V(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const p=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(p.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),p.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const r=p.getStencilBuffer();if(p.setStencilBuffer(!1),O&&this._renderSprites(),Z&&this._renderParticles(d),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(p.setStencilBuffer(r),this._scene.useOrderIndependentTransparency){const V=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);V.length&&this._renderTransparent(V)}else this._renderTransparent(this._transparentSubMeshes);p.setAlphaMode(0)}if(p.setStencilBuffer(!1),this._edgesRenderers.length){for(let V=0;V<this._edgesRenderers.length;V++)this._edgesRenderers.data[V].render();p.setAlphaMode(0)}p.setStencilBuffer(r)}_renderOpaqueSorted(V){r._RenderSorted(V,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(V){r._RenderSorted(V,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(V){r._RenderSorted(V,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(V,O,Z,d){let Y,m=0;const a=Z?Z.globalPosition:r._ZeroVector;if(d)for(;m<V.length;m++)Y=V.data[m],Y._alphaIndex=Y.getMesh().alphaIndex,Y._distanceToCamera=p.m.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,a);const R=V.length===V.data.length?V.data:V.data.slice(0,V.length);O&&R.sort(O);const i=R[0].getMesh().va();for(m=0;m<R.length;m++)if(Y=R[m],!i._activeMeshesFrozenButKeepClipping||Y.isInFrustum(i._frustumPlanes)){if(d){const V=Y.Ha();if(V&&V.needDepthPrePass){const O=V.va().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),Y.render(!1),O.setColorWrite(!0)}}Y.render(d)}}static defaultTransparentSortCompare(V,O){return V._alphaIndex>O._alphaIndex?1:V._alphaIndex<O._alphaIndex?-1:r.backToFrontSortCompare(V,O)}static backToFrontSortCompare(V,O){return V._distanceToCamera<O._distanceToCamera?1:V._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(V,O){return V._distanceToCamera<O._distanceToCamera?-1:V._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(V,O){const Z=V.getMesh(),d=O.getMesh();return Z.material&&d.material?Z.material.uniqueId-d.material.uniqueId:Z.uniqueId-d.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(V,O,Z){void 0===O&&(O=V.getMesh()),void 0===Z&&(Z=V.Ha()),null!==Z&&void 0!==Z&&(Z.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(V):Z.needAlphaTesting()?(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._alphaTestSubMeshes.push(V)):(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._opaqueSubMeshes.push(V)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(V){this._spriteManagers.push(V),this._empty=!1}dispatchParticles(V){this._particleSystems.push(V),this._empty=!1}_renderParticles(V){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let Z=0;Z<this._particleSystems.length;Z++){const d=this._particleSystems.data[Z];if(0===(O&&O.layerMask&d.layerMask))continue;const p=d.k;p.position&&V&&-1===V.indexOf(p)||this._scene._activeParticles.addCount(d.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const V=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const Z=this._spriteManagers.data[O];0!==(V&&V.layerMask&Z.layerMask)&&Z.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}r._ZeroVector=p.m.Zero();class Y{}class m{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(V){V!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=V,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const V of this._scene.meshes)if(V.Ef)for(const O of V.Ef)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const V of this._scene.spriteManagers)V._wasDispatched=!1;for(const V of this._scene.bj)V._wasDispatched=!1}constructor(V){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Y,this._maintainStateBetweenFrames=!1,this._scene=V;for(let O=m.MIN_RENDERINGGROUPS;O<m.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={Fi:!0,depth:!0,stencil:!0}}getRenderingGroup(V){const O=V||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,V,O),this._depthStencilBufferAlreadyCleaned=!0)}render(V,O,Z,d){const p=this._renderingGroupInfo;if(p.Cf=this._scene,p.camera=this._scene.activeCamera,this._scene.spriteManagers&&d)for(let r=0;r<this._scene.spriteManagers.length;r++){const V=this._scene.spriteManagers[r];this.dispatchSprites(V)}for(let r=m.MIN_RENDERINGGROUPS;r<m.MAX_RENDERINGGROUPS;r++){this._depthStencilBufferAlreadyCleaned=r===m.MIN_RENDERINGGROUPS;const Y=this._renderingGroups[r];if(!Y||Y._empty)continue;const a=1<<r;if(p.renderingGroupId=r,this._scene.onBeforeRenderingGroupObservable.notifyObservers(p,a),m.AUTOCLEAR){const V=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(r):this._autoClearDepthStencil[r];V&&V.Fi&&this._clearDepthStencilBuffer(V.depth,V.stencil)}for(const V of this._scene._beforeRenderingGroupDrawStage)V.action(r);Y.render(V,d,Z,O);for(const V of this._scene._afterRenderingGroupDrawStage)V.action(r);this._scene.onAfterRenderingGroupObservable.notifyObservers(p,a)}}reset(){if(!this.maintainStateBetweenFrames)for(let V=m.MIN_RENDERINGGROUPS;V<m.MAX_RENDERINGGROUPS;V++){const O=this._renderingGroups[V];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let V=m.MIN_RENDERINGGROUPS;V<m.MAX_RENDERINGGROUPS;V++){const O=this._renderingGroups[V];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let V=m.MIN_RENDERINGGROUPS;V<m.MAX_RENDERINGGROUPS;V++){const O=this._renderingGroups[V];O&&O.dispose()}}_prepareRenderingGroup(V){void 0===this._renderingGroups[V]&&(this._renderingGroups[V]=new r(V,this._scene,this._customOpaqueSortCompareFn[V],this._customAlphaTestSortCompareFn[V],this._customTransparentSortCompareFn[V]))}dispatchSprites(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchSprites(V))}dispatchParticles(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchParticles(V))}dispatch(V,O,Z){void 0===O&&(O=V.getMesh()),this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(V,O,Z))}setRenderingOrder(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[V]=O,this._customAlphaTestSortCompareFn[V]=Z,this._customTransparentSortCompareFn[V]=d,this._renderingGroups[V]){const O=this._renderingGroups[V];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[V],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[V],O.transparentSortCompareFn=this._customTransparentSortCompareFn[V]}}setRenderingAutoClearDepthStencil(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[V]={Fi:O,depth:Z,stencil:d}}getAutoClearDepthStencilSetup(V){return this._autoClearDepthStencil[V]}}m.MAX_RENDERINGGROUPS=4,m.MIN_RENDERINGGROUPS=0,m.AUTOCLEAR=!0},11923:(V,O,Z)=>{"use strict";const d="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11889:(V,O,Z)=>{"use strict";const d="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11959:(V,O,Z)=>{"use strict";const d="clipPlaneVertex",p="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11943:(V,O,Z)=>{"use strict";const d="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11934:(V,O,Z)=>{"use strict";const d="fogFragment",p="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11917:(V,O,Z)=>{"use strict";const d="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11968:(V,O,Z)=>{"use strict";const d="fogVertex",p="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11950:(V,O,Z)=>{"use strict";const d="fogVertexDeclaration",p="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11909:(V,O,Z)=>{"use strict";const d="helperFunctions",p="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11898:(V,O,Z)=>{"use strict";const d="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11912:(V,O,Z)=>{"use strict";const d="imageProcessingFunctions",p="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11905:(V,O,Z)=>{"use strict";const d="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11932:(V,O,Z)=>{"use strict";const d="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11973:(V,O,Z)=>{"use strict";const d="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Z(10991).d.IncludesShadersStoreWGSL[d]=p},11883:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{particlesPixelShaderWGSL:()=>Y});var d=Z(10991);Z(11889),Z(11898),Z(11905),Z(11909),Z(11912),Z(11917),Z(11923),Z(11932),Z(11934);const p="particlesPixelShader",r="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.d.ShadersStoreWGSL[p]=r;const Y={name:p,shader:r}},11939:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{particlesVertexShaderWGSL:()=>Y});var d=Z(10991);Z(11943),Z(11950),Z(11905),Z(11959),Z(11968),Z(11973);const p="particlesVertexShader",r="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.d.ShadersStoreWGSL[p]=r;const Y={name:p,shader:r}},11808:(V,O,Z)=>{"use strict";const d="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11870:(V,O,Z)=>{"use strict";const d="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11831:(V,O,Z)=>{"use strict";const d="clipPlaneVertex",p="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11881:(V,O,Z)=>{"use strict";const d="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11824:(V,O,Z)=>{"use strict";const d="fogFragment",p="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11803:(V,O,Z)=>{"use strict";const d="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11839:(V,O,Z)=>{"use strict";const d="fogVertex",p="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11829:(V,O,Z)=>{"use strict";const d="fogVertexDeclaration",p="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11793:(V,O,Z)=>{"use strict";const d="helperFunctions",p="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";Z(10991).d.IncludesShadersStore[d]=p},11780:(V,O,Z)=>{"use strict";const d="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11795:(V,O,Z)=>{"use strict";const d="imageProcessingFunctions",p="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Z(10991).d.IncludesShadersStore[d]=p},11784:(V,O,Z)=>{"use strict";const d="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11816:(V,O,Z)=>{"use strict";const d="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11844:(V,O,Z)=>{"use strict";const d="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Z(10991).d.IncludesShadersStore[d]=p},11865:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{particlesPixelShader:()=>Y});var d=Z(10991);Z(11870),Z(11780),Z(11784),Z(11793),Z(11795),Z(11803),Z(11808),Z(11816),Z(11824);const p="particlesPixelShader",r="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.d.ShadersStore[p]=r;const Y={name:p,shader:r}},11877:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{particlesVertexShader:()=>Y});var d=Z(10991);Z(11881),Z(11829),Z(11784),Z(11831),Z(11839),Z(11844);const p="particlesVertexShader",r="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.d.ShadersStore[p]=r;const Y={name:p,shader:r}},11762:(V,O,Z)=>{"use strict";Z.r(O),Z.d(O,{postprocessVertexShader:()=>r});const d="postprocessVertexShader",p="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";Z(10991).d.ShadersStore[d]=p;const r={name:d,shader:p}},11369:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>d});class d{}d._IsPickingAvailable=!1},11521:(V,O,Z)=>{"use strict";Z.d(O,{e:()=>M});var d=Z(11210),p=Z(11251),r=Z(11216),Y=Z(10902),m=Z(10942),a=Z(10928),R=Z(11283);class i{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new Y.e,this._onClonedObservable=new Y.e}}class M{static AddNodeConstructor(V,O){this._NodeConstructors[V]=O}static Construct(V,O,Z,d){const p=this._NodeConstructors[V];return p?p(O,Z,d):null}set accessibilityTag(V){this._accessibilityTag=V,this.onAccessibilityTagChangedObservable.notifyObservers(V)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(V){this._nodeDataStorage._doNotSerialize=V}u(){return this._nodeDataStorage._isDisposed}set parent(V){if(this._parentNode===V)return;const O=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const O=this._parentNode._children.indexOf(this);-1!==O&&this._parentNode._children.splice(O,1),V||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=V,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),O||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(V){V.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const V=this._scene.rootNodes,O=V.length-1;V[this._nodeDataStorage._sceneRootNodesIndex]=V[O],V[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}getClassName(){return"Node"}set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new i,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new Y.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=p.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Xi=new Y.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=V,this.id=V,this._scene=O||m.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),Z&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(V)||(V.init(),this._scene.isLoading&&!O?this._scene.onDataLoadedObservable.addOnce((()=>{V.attach(this)})):V.attach(this),this._behaviors.push(V)),this}removeBehavior(V){const O=this._behaviors.indexOf(V);return-1===O||(this._behaviors[O].detach(),this._behaviors.splice(O,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(V){for(const O of this._behaviors)if(O.name===V)return O;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Cj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(V){!V&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(V){return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_updateCache(V){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}sg(V){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((V=>{V._syncParentEnabledState()}))}If(V){this._nodeDataStorage._isEnabled!==V&&(this._nodeDataStorage._isEnabled=V,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(V))}isDescendantOf(V){return!!this.parent&&(this.parent===V||this.parent.isDescendantOf(V))}_getDescendants(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;if(this._children)for(let d=0;d<this._children.length;d++){const p=this._children[d];Z&&!Z(p)||V.push(p),O||p._getDescendants(V,!1,Z)}}getDescendants(V,O){const Z=[];return this._getDescendants(Z,V,O),Z}getChildMeshes(V,O){const Z=[];return this._getDescendants(Z,V,(V=>(!O||O(V))&&void 0!==V.oi)),Z}getChildren(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(O,V)}_setReady(V){V!==this._nodeDataStorage._isReady&&(V?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(V){for(let O=0;O<this.animations.length;O++){const Z=this.animations[O];if(Z.name===V)return Z}return null}createAnimationRange(V,O,Z){if(!this._ranges[V]){this._ranges[V]=M._AnimationRangeFactory(V,O,Z);for(let d=0,p=this.animations.length;d<p;d++)this.animations[d]&&this.animations[d].createRange(V,O,Z)}}deleteAnimationRange(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Z=0,d=this.animations.length;Z<d;Z++)this.animations[Z]&&this.animations[Z].deleteRange(V,O);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}clone(V,O,Z){const d=R.b.Clone((()=>new M(V,this.va())),this);if(O&&(d.parent=O),!Z){const O=this.getDescendants(!0);for(let Z=0;Z<O.length;Z++){const p=O[Z];p.clone(V+"."+p.name,d)}}return d}getAnimationRanges(){const V=[];let O;for(O in this._ranges)V.push(this._ranges[O]);return V}beginAnimation(V,O,Z,d){const p=this.getAnimationRange(V);return p?this._scene.beginAnimation(this,p.from,p.to,O,Z,d):null}serializeAnimationRanges(){const V=[];for(const O in this._ranges){const Z=this._ranges[O];if(!Z)continue;const d={};d.name=O,d.from=Z.from,d.to=Z.to,V.push(d)}return V}Cj(V){return this._worldMatrix||(this._worldMatrix=p.c.Identity()),this._worldMatrix}dispose(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!V){const Z=this.getDescendants(!0);for(const d of Z)d.dispose(V,O)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Xi.notifyObservers(this),this.Xi.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const Z of this._behaviors)Z.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(V,O,Z){if(O.ranges)for(let d=0;d<O.ranges.length;d++){const Z=O.ranges[d];V.createAnimationRange(Z.name,Z.from,Z.to)}}getHierarchyBoundingVectors(){let V,O,Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Cj(!0);const r=this;if(r.getBoundingInfo&&r.Ef){const Z=r.getBoundingInfo();V=Z.boundingBox.minimumWorld.clone(),O=Z.boundingBox.maximumWorld.clone()}else V=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new p.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(Z){const Z=this.getDescendants(!1);for(const r of Z){const Z=r;if(Z.Cj(!0),d&&!d(Z))continue;if(!Z.getBoundingInfo||0===Z.getTotalVertices())continue;const Y=Z.getBoundingInfo().boundingBox,m=Y.minimumWorld,a=Y.maximumWorld;p.m.CheckExtends(m,V,O),p.m.CheckExtends(a,V,O)}}return{min:V,max:O}}}M._AnimationRangeFactory=(V,O,Z)=>{throw(0,a.c)("AnimationRange")},M._NodeConstructors={},(0,d.c)([(0,r.K)()],M.prototype,"name",void 0),(0,d.c)([(0,r.K)()],M.prototype,"id",void 0),(0,d.c)([(0,r.K)()],M.prototype,"uniqueId",void 0),(0,d.c)([(0,r.K)()],M.prototype,"state",void 0),(0,d.c)([(0,r.K)()],M.prototype,"metadata",void 0)},11238:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>VV});var d=Z(10900),p=Z(10926),r=Z(10902),Y=Z(11230);class m{constructor(){this._count=0,this._data={}}p(V){this.clear(),V.forEach(((V,O)=>this.add(V,O)))}get(V){const O=this._data[V];if(void 0!==O)return O}getOrAddWithFactory(V,O){let Z=this.get(V);return void 0!==Z||(Z=O(V),Z&&this.add(V,Z)),Z}getOrAdd(V,O){const Z=this.get(V);return void 0!==Z?Z:(this.add(V,O),O)}contains(V){return void 0!==this._data[V]}add(V,O){return void 0===this._data[V]&&(this._data[V]=O,++this._count,!0)}set(V,O){return void 0!==this._data[V]&&(this._data[V]=O,!0)}getAndRemove(V){const O=this.get(V);return void 0!==O?(delete this._data[V],--this._count,O):null}remove(V){return!!this.contains(V)&&(delete this._data[V],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(V){for(const O in this._data){V(O,this._data[O])}}first(V){for(const O in this._data){const Z=V(O,this._data[O]);if(Z)return Z}return null}}var a=Z(11243),R=Z(11251),i=Z(11265),M=Z(11305),c=Z(11310);class W{constructor(V,O,Z,d,p,r){this.source=V,this.pointerX=O,this.pointerY=Z,this.meshUnderPointer=d,this.sourceEvent=p,this.additionalData=r}static CreateNew(V,O,Z){const d=V.va();return new W(V,d.pointerX,d.pointerY,d.meshUnderPointer||V,O,Z)}static CreateNewFromSprite(V,O,Z,d){return new W(V,O.pointerX,O.pointerY,O.meshUnderPointer,Z,d)}static CreateNewFromScene(V,O){return new W(null,V.pointerX,V.pointerY,V.meshUnderPointer,O)}static CreateNewFromPrimitive(V,O,Z,d){return new W(V,O.x,O.y,null,Z,d)}}var F=Z(11328),Q=Z(11337),b=Z(11342),U=Z(10906),H=Z(10942),S=Z(10928),z=Z(11349);class G{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const V in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,V))return!0;return!1}static get HasPickTriggers(){for(const V in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,V)){const O=parseInt(V);if(O>=1&&O<=7)return!0}return!1}static HasSpecificTrigger(V){for(const O in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,O)){if(parseInt(O)===V)return!0}return!1}}G.Triggers={};var w,t,C,v,A,l,I,g=Z(11358);!function(V){V[V.Generic=0]="Generic",V[V.Keyboard=1]="Keyboard",V[V.Mouse=2]="Mouse",V[V.Touch=3]="Touch",V[V.DualShock=4]="DualShock",V[V.Xbox=5]="Xbox",V[V.Switch=6]="Switch",V[V.DualSense=7]="DualSense"}(w||(w={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.Move=12]="Move"}(t||(t={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.DeltaHorizontal=10]="DeltaHorizontal",V[V.DeltaVertical=11]="DeltaVertical"}(C||(C={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Share=8]="Share",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(v||(v={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Create=8]="Create",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(A||(A={})),function(V){V[V.A=0]="A",V[V.B=1]="B",V[V.X=2]="X",V[V.Y=3]="Y",V[V.LB=4]="LB",V[V.RB=5]="RB",V[V.LT=6]="LT",V[V.RT=7]="RT",V[V.Back=8]="Back",V[V.Start=9]="Start",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.LStickXAxis=17]="LStickXAxis",V[V.LStickYAxis=18]="LStickYAxis",V[V.RStickXAxis=19]="RStickXAxis",V[V.RStickYAxis=20]="RStickYAxis"}(l||(l={})),function(V){V[V.B=0]="B",V[V.A=1]="A",V[V.Y=2]="Y",V[V.X=3]="X",V[V.L=4]="L",V[V.R=5]="R",V[V.ZL=6]="ZL",V[V.ZR=7]="ZR",V[V.Minus=8]="Minus",V[V.Plus=9]="Plus",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.Capture=17]="Capture",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(I||(I={}));var n=Z(11365);class e{static CreateDeviceEvent(V,O,Z,d,p,r,Y){switch(V){case w.Keyboard:return this._CreateKeyboardEvent(Z,d,p,r);case w.Mouse:if(Z===t.MouseWheelX||Z===t.MouseWheelY||Z===t.MouseWheelZ)return this._CreateWheelEvent(V,O,Z,d,p,r);case w.Touch:return this._CreatePointerEvent(V,O,Z,d,p,r,Y);default:throw`Unable to generate event for device ${w[V]}`}}static _CreatePointerEvent(V,O,Z,d,p,r,Y){const m=this._CreateMouseEvent(V,O,Z,d,p,r);V===w.Mouse?(m.deviceType=w.Mouse,m.pointerId=1,m.pointerType="mouse"):(m.deviceType=w.Touch,m.pointerId=Y??O,m.pointerType="touch");let a=0;return a+=p.pollInput(V,O,t.LeftClick),a+=2*p.pollInput(V,O,t.RightClick),a+=4*p.pollInput(V,O,t.MiddleClick),m.buttons=a,Z===t.Move?m.type="pointermove":Z>=t.LeftClick&&Z<=t.RightClick&&(m.type=1===d?"pointerdown":"pointerup",m.button=Z-2),m}static _CreateWheelEvent(V,O,Z,d,p,r){const Y=this._CreateMouseEvent(V,O,Z,d,p,r);switch(Y.pointerId=1,Y.type="wheel",Y.deltaMode=n.e.DOM_DELTA_PIXEL,Y.deltaX=0,Y.deltaY=0,Y.deltaZ=0,Z){case t.MouseWheelX:Y.deltaX=d;break;case t.MouseWheelY:Y.deltaY=d;break;case t.MouseWheelZ:Y.deltaZ=d}return Y}static _CreateMouseEvent(V,O,Z,d,p,r){const Y=this._CreateEvent(r),m=p.pollInput(V,O,t.Horizontal),a=p.pollInput(V,O,t.Vertical);return r?(Y.movementX=0,Y.movementY=0,Y.offsetX=Y.movementX-r.getBoundingClientRect().x,Y.offsetY=Y.movementY-r.getBoundingClientRect().y):(Y.movementX=p.pollInput(V,O,10),Y.movementY=p.pollInput(V,O,11),Y.offsetX=0,Y.offsetY=0),this._CheckNonCharacterKeys(Y,p),Y.clientX=m,Y.clientY=a,Y.x=m,Y.y=a,Y.deviceType=V,Y.deviceSlot=O,Y.inputIndex=Z,Y}static _CreateKeyboardEvent(V,O,Z,d){const p=this._CreateEvent(d);return this._CheckNonCharacterKeys(p,Z),p.deviceType=w.Keyboard,p.deviceSlot=0,p.inputIndex=V,p.type=1===O?"keydown":"keyup",p.key=String.fromCharCode(V),p.keyCode=V,p}static _CheckNonCharacterKeys(V,O){const Z=O.isDeviceAvailable(w.Keyboard),d=Z&&1===O.pollInput(w.Keyboard,0,18),p=Z&&1===O.pollInput(w.Keyboard,0,17),r=Z&&(1===O.pollInput(w.Keyboard,0,91)||1===O.pollInput(w.Keyboard,0,92)||1===O.pollInput(w.Keyboard,0,93)),Y=Z&&1===O.pollInput(w.Keyboard,0,16);V.altKey=d,V.ctrlKey=p,V.metaKey=r,V.shiftKey=Y}static _CreateEvent(V){const O={preventDefault:()=>{}};return O.target=V,O}}class u{constructor(V,O,Z){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(V,O,((V,O,d,p)=>{const r=e.CreateDeviceEvent(V,O,d,p,this);Z(V,O,r)})):this._createDummyNativeInput()}pollInput(V,O,Z){return this._nativeInput.pollInput(V,O,Z)}isDeviceAvailable(V){return V===w.Mouse||V===w.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const k=Object.keys(t).length/2;class D{constructor(V,O,Z,p){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=d.e.IsSafari(),this._usingMacOS=(0,U.j)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=V=>{},this._keyboardUpEvent=V=>{},this._keyboardBlurEvent=V=>{},this._pointerMoveEvent=V=>{},this._pointerDownEvent=V=>{},this._pointerUpEvent=V=>{},this._pointerCancelEvent=V=>{},this._pointerWheelEvent=V=>{},this._pointerBlurEvent=V=>{},this._pointerMacOSChromeOutEvent=V=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=V=>{},this._gamepadDisconnectedEvent=V=>{},this._eventPrefix=d.e.GetPointerPrefix(V),this._engine=V,this._onDeviceConnected=O,this._onDeviceDisconnected=Z,this._onInputChanged=p,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(V,O,Z){const p=this._inputs[V][O];if(!p)throw`Unable to find device ${w[V]}`;V>=w.DualShock&&V<=w.DualSense&&this._updateDevice(V,O,Z);const r=p[Z];if(void 0===r)throw`Unable to find input ${Z} for device ${w[V]} in slot ${O}`;return Z===t.Move&&d.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),r}isDeviceAvailable(V){return void 0!==this._inputs[V]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const V=null===this||void 0===this?void 0:this._engine.getInputElement();if(V&&(!this._eventsAttached||this._elementToAttachTo!==V)){if(this._disableEvents(),this._inputs)for(const V of this._inputs)if(V)for(const O in V){const Z=V[+O];if(Z)for(let V=0;V<Z.length;V++)Z[V]=0}this._elementToAttachTo=V,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const V=navigator.getGamepads();for(const O of V)O&&this._addGamePad(O)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(w.Mouse,0,0,0)}_addGamePad(V){const O=this._getGamepadDeviceType(V.id),Z=V.index;this._gamepads=this._gamepads||new Array(V.index+1),this._registerDevice(O,Z,V.buttons.length+V.axes.length),this._gamepads[Z]=O}_addPointerDevice(V,O,Z,d){this._pointerActive||(this._pointerActive=!0),this._registerDevice(V,O,k);const p=this._inputs[V][O];p[0]=Z,p[1]=d}_registerDevice(V,O,Z){if(void 0===O)throw`Unable to register device ${w[V]} to undefined slot.`;if(this._inputs[V]||(this._inputs[V]={}),!this._inputs[V][O]){const d=new Array(Z);d.fill(0),this._inputs[V][O]=d,this._onDeviceConnected(V,O)}}_unregisterDevice(V,O){this._inputs[V][O]&&(delete this._inputs[V][O],this._onDeviceDisconnected(V,O))}_handleKeyActions(){this._keyboardDownEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(w.Keyboard,0,255));const O=this._inputs[w.Keyboard][0];if(O){O[V.keyCode]=1;const Z=V;Z.inputIndex=V.keyCode,this._usingMacOS&&V.metaKey&&"Meta"!==V.key&&(this._metaKeys.includes(V.keyCode)||this._metaKeys.push(V.keyCode)),this._onInputChanged(w.Keyboard,0,Z)}},this._keyboardUpEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(w.Keyboard,0,255));const O=this._inputs[w.Keyboard][0];if(O){O[V.keyCode]=0;const Z=V;if(Z.inputIndex=V.keyCode,this._usingMacOS&&"Meta"===V.key&&this._metaKeys.length>0){for(const V of this._metaKeys){const Z=e.CreateDeviceEvent(w.Keyboard,0,V,0,this,this._elementToAttachTo);O[V]=0,this._onInputChanged(w.Keyboard,0,Z)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(w.Keyboard,0,Z)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const V=this._inputs[w.Keyboard][0];for(let O=0;O<V.length;O++)if(0!==V[O]){V[O]=0;const Z=e.CreateDeviceEvent(w.Keyboard,0,O,0,this,this._elementToAttachTo);this._onInputChanged(w.Keyboard,0,Z)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,U.j)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let d=0;d<this._maxTouchPoints;d++)this._activeTouchIds[d]=-1;this._pointerMoveEvent=V=>{const O=this._getPointerType(V);let Z=O===w.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(O===w.Touch&&-1===Z){const p=this._activeTouchIds.indexOf(-1);if(!(p>=0))return void d.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);Z=p,this._activeTouchIds[p]=V.pointerId,this._onDeviceConnected(O,Z)}this._inputs[O]||(this._inputs[O]={}),this._inputs[O][Z]||this._addPointerDevice(O,Z,V.clientX,V.clientY);const p=this._inputs[O][Z];if(p){const d=V;d.inputIndex=t.Move,p[t.Horizontal]=V.clientX,p[t.Vertical]=V.clientY,O===w.Touch&&0===p[t.LeftClick]&&(p[t.LeftClick]=1),void 0===V.pointerId&&(V.pointerId=this._mouseId),this._onInputChanged(O,Z,d),this._usingSafari||-1===V.button||(d.inputIndex=V.button+2,p[V.button+2]=p[V.button+2]?0:1,this._onInputChanged(O,Z,d))}},this._pointerDownEvent=V=>{const O=this._getPointerType(V);let Z=O===w.Mouse?0:V.pointerId;if(O===w.Touch){let O=this._activeTouchIds.indexOf(V.pointerId);if(-1===O&&(O=this._activeTouchIds.indexOf(-1)),!(O>=0))return void d.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);Z=O,this._activeTouchIds[O]=V.pointerId}this._inputs[O]||(this._inputs[O]={}),this._inputs[O][Z]?O===w.Touch&&this._onDeviceConnected(O,Z):this._addPointerDevice(O,Z,V.clientX,V.clientY);const p=this._inputs[O][Z];if(p){const d=p[t.Horizontal],Y=p[t.Vertical];if(O===w.Mouse){if(void 0===V.pointerId&&(V.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(r){}}else if(V.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(V.pointerId)}catch(r){}p[t.Horizontal]=V.clientX,p[t.Vertical]=V.clientY,p[V.button+2]=1;const m=V;m.inputIndex=V.button+2,this._onInputChanged(O,Z,m),d===V.clientX&&Y===V.clientY||(m.inputIndex=t.Move,this._onInputChanged(O,Z,m))}},this._pointerUpEvent=V=>{var O;const Z=this._getPointerType(V),d=Z===w.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(Z===w.Touch){if(-1===d)return;this._activeTouchIds[d]=-1}const p=null===(O=this._inputs[Z])||void 0===O?void 0:O[d];if(p&&0!==p[V.button+2]){var r,Y,m,a;const O=p[t.Horizontal],R=p[t.Vertical];p[t.Horizontal]=V.clientX,p[t.Vertical]=V.clientY,p[V.button+2]=0;const i=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),O===V.clientX&&R===V.clientY||(i.inputIndex=t.Move,this._onInputChanged(Z,d,i)),i.inputIndex=V.button+2,Z===w.Mouse&&this._mouseId>=0&&null!==(r=(Y=this._elementToAttachTo).hasPointerCapture)&&void 0!==r&&r.call(Y,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):V.pointerId&&null!==(m=(a=this._elementToAttachTo).hasPointerCapture)&&void 0!==m&&m.call(a,V.pointerId)&&this._elementToAttachTo.releasePointerCapture(V.pointerId),this._onInputChanged(Z,d,i),Z===w.Touch&&this._onDeviceDisconnected(Z,d)}},this._pointerCancelEvent=V=>{if("mouse"===V.pointerType){var O,Z;const V=this._inputs[w.Mouse][0];this._mouseId>=0&&null!==(O=(Z=this._elementToAttachTo).hasPointerCapture)&&void 0!==O&&O.call(Z,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let O=t.LeftClick;O<=t.BrowserForward;O++)if(1===V[O]){V[O]=0;const Z=e.CreateDeviceEvent(w.Mouse,0,O,0,this,this._elementToAttachTo);this._onInputChanged(w.Mouse,0,Z)}}else{var d,p;const O=this._activeTouchIds.indexOf(V.pointerId);if(-1===O)return;null!==(d=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==d&&d.call(p,V.pointerId)&&this._elementToAttachTo.releasePointerCapture(V.pointerId),this._inputs[w.Touch][O][t.LeftClick]=0;const Z=e.CreateDeviceEvent(w.Touch,O,t.LeftClick,0,this,this._elementToAttachTo,V.pointerId);this._onInputChanged(w.Touch,O,Z),this._activeTouchIds[O]=-1,this._onDeviceDisconnected(w.Touch,O)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let V=!1;const O=function(){};try{const Z=Object.defineProperty({},"passive",{get:function(){V=!0}});this._elementToAttachTo.addEventListener("test",O,Z),this._elementToAttachTo.removeEventListener("test",O,Z)}catch(Z){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(w.Mouse)){var V,O;const Z=this._inputs[w.Mouse][0];this._mouseId>=0&&null!==(V=(O=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(O,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let V=t.LeftClick;V<=t.BrowserForward;V++)if(1===Z[V]){Z[V]=0;const O=e.CreateDeviceEvent(w.Mouse,0,V,0,this,this._elementToAttachTo);this._onInputChanged(w.Mouse,0,O)}}if(this.isDeviceAvailable(w.Touch)){const V=this._inputs[w.Touch];for(let O=0;O<this._activeTouchIds.length;O++){var Z,d,p;const r=this._activeTouchIds[O];if(null!==(Z=(d=this._elementToAttachTo).hasPointerCapture)&&void 0!==Z&&Z.call(d,r)&&this._elementToAttachTo.releasePointerCapture(r),-1!==r&&1===(null===(p=V[O])||void 0===p?void 0:p[t.LeftClick])){V[O][t.LeftClick]=0;const Z=e.CreateDeviceEvent(w.Touch,O,t.LeftClick,0,this,this._elementToAttachTo,r);this._onInputChanged(w.Touch,O,Z),this._activeTouchIds[O]=-1,this._onDeviceDisconnected(w.Touch,O)}}}},this._pointerWheelEvent=V=>{const O=w.Mouse;this._inputs[O]||(this._inputs[O]=[]),this._inputs[O][0]||(this._pointerActive=!0,this._registerDevice(O,0,k));const Z=this._inputs[O][0];if(Z){Z[t.MouseWheelX]=V.deltaX||0,Z[t.MouseWheelY]=V.deltaY||V.wheelDelta||0,Z[t.MouseWheelZ]=V.deltaZ||0;const d=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),0!==Z[t.MouseWheelX]&&(d.inputIndex=t.MouseWheelX,this._onInputChanged(O,0,d)),0!==Z[t.MouseWheelY]&&(d.inputIndex=t.MouseWheelY,this._onInputChanged(O,0,d)),0!==Z[t.MouseWheelZ]&&(d.inputIndex=t.MouseWheelZ,this._onInputChanged(O,0,d))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=V=>{V.buttons>1&&this._pointerCancelEvent(V)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!V&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(w.Mouse)){const V=this._inputs[w.Mouse][0];V[t.MouseWheelX]=0,V[t.MouseWheelY]=0,V[t.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=V=>{this._addGamePad(V.gamepad)},this._gamepadDisconnectedEvent=V=>{if(this._gamepads){const O=this._getGamepadDeviceType(V.gamepad.id),Z=V.gamepad.index;this._unregisterDevice(O,Z),delete this._gamepads[Z]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(V,O,Z){const d=navigator.getGamepads()[O];if(d&&V===this._gamepads[O]){const p=this._inputs[V][O];Z>=d.buttons.length?p[Z]=d.axes[Z-d.buttons.length].valueOf():p[Z]=d.buttons[Z].value}}_getGamepadDeviceType(V){return-1!==V.indexOf("054c")?-1!==V.indexOf("0ce6")?w.DualSense:w.DualShock:-1!==V.indexOf("Xbox One")||-1!==V.search("Xbox 360")||-1!==V.search("xinput")?w.Xbox:-1!==V.indexOf("057e")?w.Switch:w.Generic}_getPointerType(V){let O=w.Mouse;return("touch"===V.pointerType||"pen"===V.pointerType||V.touches)&&(O=w.Touch),O}}class X{constructor(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=O,this.deviceSlot=Z,this.onInputChangedObservable=new r.e,this._deviceInputSystem=V}getInput(V){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,V)}}class o{constructor(V){this._registeredManagers=new Array,this._refCount=0,this.registerManager=V=>{for(let O=0;O<this._devices.length;O++){const Z=this._devices[O];for(const d in Z){const Z=+d;V._addDevice(new X(this._deviceInputSystem,O,Z))}}this._registeredManagers.push(V)},this.unregisterManager=V=>{const O=this._registeredManagers.indexOf(V);O>-1&&this._registeredManagers.splice(O,1)};const O=Object.keys(w).length/2;this._devices=new Array(O);const Z=(V,O)=>{this._devices[V]||(this._devices[V]=new Array),this._devices[V][O]||(this._devices[V][O]=O);for(const Z of this._registeredManagers){const d=new X(this._deviceInputSystem,V,O);Z._addDevice(d)}},d=(V,O)=>{var Z;null!==(Z=this._devices[V])&&void 0!==Z&&Z[O]&&delete this._devices[V][O];for(const d of this._registeredManagers)d._removeDevice(V,O)},p=(V,O,Z)=>{if(Z)for(const d of this._registeredManagers)d._onInputChanged(V,O,Z)};"undefined"!==typeof _native?this._deviceInputSystem=new u(Z,d,p):this._deviceInputSystem=new D(V,Z,d,p)}dispose(){this._deviceInputSystem.dispose()}}class E{getDeviceSource(V,O){if(void 0===O){if(void 0===this._firstDevice[V])return null;O=this._firstDevice[V]}return this._devices[V]&&void 0!==this._devices[V][O]?this._devices[V][O]:null}getDeviceSources(V){return this._devices[V]?this._devices[V].filter((V=>!!V)):[]}constructor(V){const O=Object.keys(w).length/2;this._devices=new Array(O),this._firstDevice=new Array(O),this._engine=V,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new o(V)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new r.e((V=>{for(const O of this._devices)if(O)for(const Z of O)Z&&this.onDeviceConnectedObservable.notifyObserver(V,Z)})),this.onDeviceDisconnectedObservable=new r.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=V.Xi.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Xi.remove(this._onDisposeObserver)}_addDevice(V){this._devices[V.deviceType]||(this._devices[V.deviceType]=new Array),this._devices[V.deviceType][V.deviceSlot]||(this._devices[V.deviceType][V.deviceSlot]=V,this._updateFirstDevices(V.deviceType)),this.onDeviceConnectedObservable.notifyObservers(V)}_removeDevice(V,O){var Z,d;const p=null===(Z=this._devices[V])||void 0===Z?void 0:Z[O];this.onDeviceDisconnectedObservable.notifyObservers(p),null!==(d=this._devices[V])&&void 0!==d&&d[O]&&delete this._devices[V][O],this._updateFirstDevices(V)}_onInputChanged(V,O,Z){var d,p;null===(d=this._devices[V])||void 0===d||null===(p=d[O])||void 0===p||p.onInputChangedObservable.notifyObservers(Z)}_updateFirstDevices(V){switch(V){case w.Keyboard:case w.Mouse:this._firstDevice[V]=0;break;case w.Touch:case w.DualSense:case w.DualShock:case w.Xbox:case w.Switch:case w.Generic:{delete this._firstDevice[V];const O=this._devices[V];if(O)for(let Z=0;Z<O.length;Z++)if(O[Z]){this._firstDevice[V]=Z;break}break}}}}var L=Z(11369);class J{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(V){this._singleClick=V}set doubleClick(V){this._doubleClick=V}set hasSwiped(V){this._hasSwiped=V}set ignore(V){this._ignore=V}}class N{constructor(V){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new R.l(0,0),this._previousStartingPointerPosition=new R.l(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=V||H.e.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(V){return this._meshUnderPointerId[V]||null}get unTranslatedPointer(){return new R.l(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(V){this._pointerX=V}get pointerY(){return this._pointerY}set pointerY(V){this._pointerY=V}_updatePointerPosition(V){const O=this._scene.getEngine().getInputElementClientRect();O&&(this._pointerX=V.clientX-O.left,this._pointerY=V.clientY-O.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(V,O){const Z=this._scene,d=Z.getEngine(),p=d.getInputElement();p&&(p.tabIndex=d.canvasTabIndex,Z.doNotHandleCursors||(p.style.cursor=Z.defaultCursor)),this._setCursorAndPointerOverMesh(V,O,Z);for(const a of Z._pointerMoveStage){var r;const Z=!(null===(r=V=V||this._pickMove(O))||void 0===r||!r.pickedMesh);V=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,Z,p)}const Y=O.inputIndex>=t.MouseWheelX&&O.inputIndex<=t.MouseWheelZ?z.c.POINTERWHEEL:z.c.POINTERMOVE;let m;Z.onPointerMove&&(V=V||this._pickMove(O),Z.onPointerMove(O,V,Y)),V?(m=new z.h(Y,O,V),this._setRayOnPointerInfo(V,O)):(m=new z.h(Y,O,null,this),this._movePointerInfo=m),Z.onPointerObservable.hasObservers()&&Z.onPointerObservable.notifyObservers(m,Y)}_setRayOnPointerInfo(V,O){const Z=this._scene;V&&L.e._IsPickingAvailable&&(V.ray||(V.ray=Z.createPickingRay(O.offsetX,O.offsetY,R.c.Identity(),Z.activeCamera)))}_addCameraPointerObserver(V,O){return this._cameraObserverCount++,this._scene.onPointerObservable.add(V,O)}_removeCameraPointerObserver(V){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(V)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(V,O,Z){const d=this._scene,p=new z.g(Z,O,this._unTranslatedPointerX,this._unTranslatedPointerY);return V&&(p.originalPickingInfo=V,p.ray=V.ray,"xr-near"===O.pointerType&&V.originMesh&&(p.nearInteractionPickingInfo=V)),d.onPrePointerObservable.notifyObservers(p,Z),!!p.skipOnPointerObservable}_pickMove(V){const O=this._scene,Z=O.bc(this._unTranslatedPointerX,this._unTranslatedPointerY,O.pointerMovePredicate,O.pointerMoveFastCheck,O.cameraToUseForPointers,O.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(Z,V,O),Z}_setCursorAndPointerOverMesh(V,O,Z){const d=Z.getEngine().getInputElement();if(null!==V&&void 0!==V&&V.pickedMesh){if(this.setPointerOverMesh(V.pickedMesh,O.pointerId,V,O),!Z.doNotHandleCursors&&d&&this._pointerOverMesh){const V=this._pointerOverMesh._getActionManagerForTrigger();V&&V.hasPointerTriggers&&(d.style.cursor=V.hoverCursor||Z.hoverCursor)}}else this.setPointerOverMesh(null,O.pointerId,V,O)}simulatePointerMove(V,O){const Z=new PointerEvent("pointermove",O);Z.inputIndex=t.Move,this._checkPrePointerObservable(V,Z,z.c.POINTERMOVE)||this._processPointerMove(V,Z)}simulatePointerDown(V,O){const Z=new PointerEvent("pointerdown",O);Z.inputIndex=Z.button+2,this._checkPrePointerObservable(V,Z,z.c.POINTERDOWN)||this._processPointerDown(V,Z)}_processPointerDown(V,O){var Z;const d=this._scene;if(null!==(Z=V)&&void 0!==Z&&Z.pickedMesh){this._pickedDownMesh=V.pickedMesh;const Z=V.pickedMesh._getActionManagerForTrigger();if(Z){if(Z.hasPickTriggers)switch(Z.processTrigger(5,W.CreateNew(V.pickedMesh,O,V)),O.button){case 0:Z.processTrigger(2,W.CreateNew(V.pickedMesh,O,V));break;case 1:Z.processTrigger(4,W.CreateNew(V.pickedMesh,O,V));break;case 2:Z.processTrigger(3,W.CreateNew(V.pickedMesh,O,V))}Z.hasSpecificTrigger(8)&&window.setTimeout((()=>{const V=d.bc(this._unTranslatedPointerX,this._unTranslatedPointerY,(V=>V.oe&&V.isVisible&&V.isReady()&&V.actionManager&&V.actionManager.hasSpecificTrigger(8)&&V===this._pickedDownMesh),!1,d.cameraToUseForPointers);null!==V&&void 0!==V&&V.pickedMesh&&Z&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>N.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,Z.processTrigger(8,W.CreateNew(V.pickedMesh,O)))}),N.LongPressDelay)}}else for(const Y of d._pointerDownStage)V=Y.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,O,!1);let p;const r=z.c.POINTERDOWN;V?(d.onPointerDown&&d.onPointerDown(O,V,r),p=new z.h(r,O,V),this._setRayOnPointerInfo(V,O)):p=new z.h(r,O,null,this),d.onPointerObservable.hasObservers()&&d.onPointerObservable.notifyObservers(p,r)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(V,O,Z){const d=new PointerEvent("pointerup",O);d.inputIndex=t.Move;const p=new J;Z?p.doubleClick=!0:p.singleClick=!0,this._checkPrePointerObservable(V,d,z.c.POINTERUP)||this._processPointerUp(V,d,p)}_processPointerUp(V,O,Z){var d;const p=this._scene;if(null!==(d=V)&&void 0!==d&&d.pickedMesh){if(this._pickedUpMesh=V.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(p.onPointerPick&&p.onPointerPick(O,V),Z.singleClick&&!Z.ignore&&p.onPointerObservable.observers.length>this._cameraObserverCount)){const Z=z.c.POINTERPICK,d=new z.h(Z,O,V);this._setRayOnPointerInfo(V,O),p.onPointerObservable.notifyObservers(d,Z)}const d=V.pickedMesh._getActionManagerForTrigger();if(d&&!Z.ignore){d.processTrigger(7,W.CreateNew(V.pickedMesh,O,V)),!Z.hasSwiped&&Z.singleClick&&d.processTrigger(1,W.CreateNew(V.pickedMesh,O,V));const p=V.pickedMesh._getActionManagerForTrigger(6);Z.doubleClick&&p&&p.processTrigger(6,W.CreateNew(V.pickedMesh,O,V))}}else if(!Z.ignore)for(const r of p._pointerUpStage)V=r.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,O,Z.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const V=this._pickedDownMesh._getActionManagerForTrigger(16);V&&V.processTrigger(16,W.CreateNew(this._pickedDownMesh,O))}if(!Z.ignore){const d=new z.h(z.c.POINTERUP,O,V);if(this._setRayOnPointerInfo(V,O),p.onPointerObservable.notifyObservers(d,z.c.POINTERUP),p.onPointerUp&&p.onPointerUp(O,V,z.c.POINTERUP),!Z.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let d=0;if(Z.singleClick?d=z.c.POINTERTAP:Z.doubleClick&&(d=z.c.POINTERDOUBLETAP),d){const Z=new z.h(d,O,V);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(d)&&p.onPointerObservable.notifyObservers(Z,d)}}}}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[V]}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=this._scene,r=p.getEngine();d||(d=r.getInputElement()),this._alreadyAttached&&this.Ei(),d&&(this._alreadyAttachedTo=d),this._deviceSourceManager=new E(r),this._initActionManager=V=>{if(!this._meshPickProceed){const O=p.skipPointerUpPicking||0===p._registeredActions&&!this._checkForPicking()&&!p.onPointerUp?null:p.bc(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerUpPredicate,p.pointerUpFastCheck,p.cameraToUseForPointers,p.pointerUpTrianglePredicate);this._currentPickResult=O,O&&(V=O.hit&&O.pickedMesh?O.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return V},this._delayedSimpleClick=(V,O,Z)=>{if((Date.now()-this._previousStartingPointerTime>N.DoubleClickDelay&&!this._doubleClickOccured||V!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,O.singleClick=!0,O.ignore=!1,this._delayedClicks[V])){const O=this._delayedClicks[V].evt,Z=z.c.POINTERTAP,d=new z.h(Z,O,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(Z)&&p.onPointerObservable.notifyObservers(d,Z),this._delayedClicks[V]=null}},this._initClickEvent=(V,O,Z,d)=>{const p=new J;this._currentPickResult=null;let r=null,Y=V.hasSpecificMask(z.c.POINTERPICK)||O.hasSpecificMask(z.c.POINTERPICK)||V.hasSpecificMask(z.c.POINTERTAP)||O.hasSpecificMask(z.c.POINTERTAP)||V.hasSpecificMask(z.c.POINTERDOUBLETAP)||O.hasSpecificMask(z.c.POINTERDOUBLETAP);!Y&&G&&(r=this._initActionManager(r,p),r&&(Y=r.hasPickTriggers));let m=!1;if(Y){const Y=Z.button;if(p.hasSwiped=this._isPointerSwiping(),!p.hasSwiped){let i=!N.ExclusiveDoubleClickMode;if(i||(i=!V.hasSpecificMask(z.c.POINTERDOUBLETAP)&&!O.hasSpecificMask(z.c.POINTERDOUBLETAP),i&&!G.HasSpecificTrigger(6)&&(r=this._initActionManager(r,p),r&&(i=!r.hasSpecificTrigger(6)))),i)(Date.now()-this._previousStartingPointerTime>N.DoubleClickDelay||Y!==this._previousButtonPressed)&&(p.singleClick=!0,d(p,this._currentPickResult),m=!0);else{const V={evt:Z,clickInfo:p,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,Y,p,d),N.DoubleClickDelay)};this._delayedClicks[Y]=V}let M=V.hasSpecificMask(z.c.POINTERDOUBLETAP)||O.hasSpecificMask(z.c.POINTERDOUBLETAP);if(!M&&G.HasSpecificTrigger(6)&&(r=this._initActionManager(r,p),r&&(M=r.hasSpecificTrigger(6))),M)if(Y===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<N.DoubleClickDelay&&!this._doubleClickOccured){if(p.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=Y,N.ExclusiveDoubleClickMode){var a;if(this._delayedClicks[Y])clearTimeout(null===(a=this._delayedClicks[Y])||void 0===a?void 0:a.timeoutId),this._delayedClicks[Y]=null;d(p,this._previousPickResult)}else d(p,this._currentPickResult);else{var R;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,p.doubleClick=!0,p.ignore=!1,N.ExclusiveDoubleClickMode&&this._delayedClicks[Y])clearTimeout(null===(R=this._delayedClicks[Y])||void 0===R?void 0:R.timeoutId),this._delayedClicks[Y]=null;d(p,this._currentPickResult)}m=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=Y}}m||d(p,this._currentPickResult)},this._onPointerMove=V=>{if(this._updatePointerPosition(V),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>N.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>N.DragMovementThreshold),r.isPointerLock&&r._verifyPointerLock(),this._checkPrePointerObservable(null,V,V.inputIndex>=t.MouseWheelX&&V.inputIndex<=t.MouseWheelZ?z.c.POINTERWHEEL:z.c.POINTERMOVE))return;if(!p.cameraToUseForPointers&&!p.activeCamera)return;if(p.Ni)return void this._processPointerMove(new c.b,V);p.pointerMovePredicate||(p.pointerMovePredicate=V=>V.oe&&V.isVisible&&V.isReady()&&V.isEnabled()&&(V.enablePointerMoveEvents||p.constantlyUpdateMeshUnderPointer||null!==V._getActionManagerForTrigger())&&(!p.cameraToUseForPointers||0!==(p.cameraToUseForPointers.layerMask&V.layerMask)));const O=p._registeredActions>0||p.constantlyUpdateMeshUnderPointer?this._pickMove(V):null;this._processPointerMove(O,V)},this._onPointerDown=V=>{const O=this._activePointerIds.indexOf(-1);if(-1===O?this._activePointerIds.push(V.pointerId):this._activePointerIds[O]=V.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,N.ExclusiveDoubleClickMode)for(let d=0;d<this._delayedClicks.length;d++)if(this._delayedClicks[d])if(V.button===d){var Z;clearTimeout(null===(Z=this._delayedClicks[d])||void 0===Z?void 0:Z.timeoutId)}else{const V=this._delayedClicks[d].clickInfo;this._doubleClickOccured=!1,V.singleClick=!0,V.ignore=!1;const O=this._delayedClicks[d].evt,Z=z.c.POINTERTAP,r=new z.h(Z,O,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(Z)&&p.onPointerObservable.notifyObservers(r,Z),this._delayedClicks[d]=null}if(this._updatePointerPosition(V),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=V.button),p.preventDefaultOnPointerDown&&d&&(V.preventDefault(),d.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,V,z.c.POINTERDOWN))return;if(!p.cameraToUseForPointers&&!p.activeCamera)return;let r;this._pointerCaptures[V.pointerId]=!0,p.pointerDownPredicate||(p.pointerDownPredicate=V=>V.oe&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!p.cameraToUseForPointers||0!==(p.cameraToUseForPointers.layerMask&V.layerMask))),this._pickedDownMesh=null,r=p.skipPointerDownPicking||0===p._registeredActions&&!this._checkForPicking()&&!p.onPointerDown?new c.b:p.bc(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerDownPredicate,p.pointerDownFastCheck,p.cameraToUseForPointers,p.pointerDownTrianglePredicate),this._processPointerDown(r,V)},this._onPointerUp=V=>{const O=this._activePointerIds.indexOf(V.pointerId);-1!==O&&(this._activePointerIds[O]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(V),p.preventDefaultOnPointerUp&&d&&(V.preventDefault(),d.focus()),this._initClickEvent(p.onPrePointerObservable,p.onPointerObservable,V,((O,Z)=>{if(p.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!O.ignore)){if(this._checkPrePointerObservable(null,V,z.c.POINTERUP))return this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1));O.hasSwiped||(O.singleClick&&p.onPrePointerObservable.hasSpecificMask(z.c.POINTERTAP)&&this._checkPrePointerObservable(null,V,z.c.POINTERTAP)&&(this._skipPointerTap=!0),O.doubleClick&&p.onPrePointerObservable.hasSpecificMask(z.c.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,V,z.c.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[V.pointerId]?(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1),(p.cameraToUseForPointers||p.activeCamera)&&(p.pointerUpPredicate||(p.pointerUpPredicate=V=>V.oe&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!p.cameraToUseForPointers||0!==(p.cameraToUseForPointers.layerMask&V.layerMask))),!this._meshPickProceed&&(G&&G.HasTriggers||this._checkForPicking()||p.onPointerUp)&&this._initActionManager(null,O),Z||(Z=this._currentPickResult),this._processPointerUp(Z,V,O),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=V=>{const O=g.b.KEYDOWN;if(p.onPreKeyboardObservable.hasObservers()){const Z=new g.d(O,V);if(p.onPreKeyboardObservable.notifyObservers(Z,O),Z.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){const Z=new g.e(O,V);p.onKeyboardObservable.notifyObservers(Z,O)}p.actionManager&&p.actionManager.processTrigger(14,W.CreateNewFromScene(p,V))},this._onKeyUp=V=>{const O=g.b.KEYUP;if(p.onPreKeyboardObservable.hasObservers()){const Z=new g.d(O,V);if(p.onPreKeyboardObservable.notifyObservers(Z,O),Z.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){const Z=new g.e(O,V);p.onKeyboardObservable.notifyObservers(Z,O)}p.actionManager&&p.actionManager.processTrigger(15,W.CreateNewFromScene(p,V))},this._deviceSourceManager.onDeviceConnectedObservable.add((d=>{d.deviceType===w.Mouse?d.onInputChangedObservable.add((p=>{this._originMouseEvent=p,p.inputIndex===t.LeftClick||p.inputIndex===t.MiddleClick||p.inputIndex===t.RightClick||p.inputIndex===t.BrowserBack||p.inputIndex===t.BrowserForward?O&&1===d.getInput(p.inputIndex)?this._onPointerDown(p):V&&0===d.getInput(p.inputIndex)&&this._onPointerUp(p):Z&&(p.inputIndex===t.Move?this._onPointerMove(p):p.inputIndex!==t.MouseWheelX&&p.inputIndex!==t.MouseWheelY&&p.inputIndex!==t.MouseWheelZ||this._onPointerMove(p))})):d.deviceType===w.Touch?d.onInputChangedObservable.add((p=>{p.inputIndex===t.LeftClick&&(O&&1===d.getInput(p.inputIndex)?(this._onPointerDown(p),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):V&&0===d.getInput(p.inputIndex)&&(this._onPointerUp(p),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),Z&&p.inputIndex===t.Move&&this._onPointerMove(p)})):d.deviceType===w.Keyboard&&d.onInputChangedObservable.add((V=>{"keydown"===V.type?this._onKeyDown(V):"keyup"===V.type&&this._onKeyUp(V)}))})),this._alreadyAttached=!0}Ei(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[O]===V&&(!V||!V._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const p=this._meshUnderPointerId[O];let r;p&&(r=p._getActionManagerForTrigger(10),r&&r.processTrigger(10,W.CreateNew(p,d,{pointerId:O}))),V?(this._meshUnderPointerId[O]=V,this._pointerOverMesh=V,r=V._getActionManagerForTrigger(9),r&&r.processTrigger(9,W.CreateNew(V,d,{pointerId:O,pickResult:Z}))):(delete this._meshUnderPointerId[O],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(V){this._pointerOverMesh===V&&(this._pointerOverMesh=null),this._pickedDownMesh===V&&(this._pickedDownMesh=null),this._pickedUpMesh===V&&(this._pickedUpMesh=null);for(const O in this._meshUnderPointerId)this._meshUnderPointerId[O]===V&&delete this._meshUnderPointerId[O]}}N.DragMovementThreshold=10,N.LongPressDelay=500,N.DoubleClickDelay=300,N.ExclusiveDoubleClickMode=!1;var P=Z(11053),f=Z(11274),q=Z(11377),K=Z(11395),s=Z(10947),h=Z(11397),x=Z(11259);class y{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Ni=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var T,B=Z(10914),j=Z(11041);!function(V){V[V.BackwardCompatible=0]="BackwardCompatible",V[V.Intermediate=1]="Intermediate",V[V.Aggressive=2]="Aggressive"}(T||(T={}));class VV{static DefaultMaterialFactory(V){throw(0,S.c)("pb")}static CollisionCoordinatorFactory(){throw(0,S.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(V){V!==this._clearColor&&(this._clearColor=V,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(V){if(V!==this._performancePriority){switch(this._performancePriority=V,V){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ni=!1,this.Fi=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ni=!0,this.Fi=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Ni=!0,this.Fi=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(V)}}set forceWireframe(V){this._forceWireframe!==V&&(this._forceWireframe=V,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(V){this._skipFrustumClipping!==V&&(this._skipFrustumClipping=V)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(V){this._forcePointsCloud!==V&&(this._forcePointsCloud=V,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture!==V&&(this._environmentTexture=V,this.markAllMaterialsAsDirty(1))}getNodes(){let V=[];return V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes),this.skeletons.forEach((O=>V=V.concat(O.bones))),V}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}set beforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),V&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V))}set afterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),V&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(V))}set beforeCameraRender(V){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(V)}set afterCameraRender(V){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(V)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(V){this._pointerPickingConfiguration.pointerDownPredicate=V}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(V){this._pointerPickingConfiguration.pointerUpPredicate=V}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(V){this._pointerPickingConfiguration.pointerMovePredicate=V}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(V){this._pointerPickingConfiguration.pointerDownFastCheck=V}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(V){this._pointerPickingConfiguration.pointerUpFastCheck=V}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(V){this._pointerPickingConfiguration.pointerMoveFastCheck=V}get Ni(){return this._pointerPickingConfiguration.Ni}set Ni(V){this._pointerPickingConfiguration.Ni=V}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(V){this._pointerPickingConfiguration.skipPointerDownPicking=V}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(V){this._pointerPickingConfiguration.skipPointerUpPicking=V}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return N.DragMovementThreshold}static set DragMovementThreshold(V){N.DragMovementThreshold=V}static get LongPressDelay(){return N.LongPressDelay}static set LongPressDelay(V){N.LongPressDelay=V}static get DoubleClickDelay(){return N.DoubleClickDelay}static set DoubleClickDelay(V){N.DoubleClickDelay=V}static get ExclusiveDoubleClickMode(){return N.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(V){N.ExclusiveDoubleClickMode=V}bindEyePosition(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,p=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return R.i.Vector4[0].set(d.x,d.y,d.z,p?-1:1),V&&(Z?V.setFloat3(O,R.i.Vector4[0].x,R.i.Vector4[0].y,R.i.Vector4[0].z):V.setVector4(O,R.i.Vector4[0])),R.i.Vector4[0]}finalizeSceneUbo(){const V=this.getSceneUniformBuffer(),O=this.bindEyePosition(null);return V.updateFloat4("vEyePosition",O.x,O.y,O.z,O.w),V.update(),V}set useRightHandedSystem(V){this._useRightHandedSystem!==V&&(this._useRightHandedSystem=V,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(V){this._currentStepId=V}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(V){this._fogMode!==V&&(this._fogMode=V,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(V){this._shadowsEnabled!==V&&(this._shadowsEnabled=V,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(V){this._lightsEnabled!==V&&(this._lightsEnabled=V,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(V){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),V&&(this._unObserveActiveCameras=(0,x.k)(V,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=V}get activeCamera(){return this._activeCamera}set activeCamera(V){V!==this._activeCamera&&(this._activeCamera=V,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.gi||(this.gi=VV.DefaultMaterialFactory(this)),this.gi}set defaultMaterial(V){this.gi=V}set texturesEnabled(V){this._texturesEnabled!==V&&(this._texturesEnabled=V,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(V){if(this._frameGraph)return this._frameGraph=V,void(V||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=V,V&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(V){this._skeletonsEnabled!==V&&(this._skeletonsEnabled=V,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=VV.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const V of this._transientComponents)V.register();this._transientComponents.length=0}}o(V){this._components.push(V),this._transientComponents.push(V);const O=V;O.addFromContainer&&O.serialize&&this._serializableComponents.push(O)}_getComponent(V){for(const O of this._components)if(O.name===V)return O;return null}constructor(V,O){this._inputManager=new N(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Fi=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new f.f(.2,.2,.3,1),this.onClearColorChangedObservable=new r.e,this.ambientColor=new f.b(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new r.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.bj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Rj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Xi=new r.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new r.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new r.e,this.onAfterRenderCameraObservable=new r.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new r.e,this.onAfterAnimationsObservable=new r.e,this.onBeforeDrawPhaseObservable=new r.e,this.onAfterDrawPhaseObservable=new r.e,this.onReadyObservable=new r.e,this.onBeforeCameraRenderObservable=new r.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new r.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new r.e,this.onAfterActiveMeshesEvaluationObservable=new r.e,this.onBeforeParticlesRenderingObservable=new r.e,this.onAfterParticlesRenderingObservable=new r.e,this.onDataLoadedObservable=new r.e,this.onNewCameraAddedObservable=new r.e,this.onCameraRemovedObservable=new r.e,this.onNewLightAddedObservable=new r.e,this.onLightRemovedObservable=new r.e,this.onNewGeometryAddedObservable=new r.e,this.onGeometryRemovedObservable=new r.e,this.onNewTransformNodeAddedObservable=new r.e,this.onTransformNodeRemovedObservable=new r.e,this.onNewMeshAddedObservable=new r.e,this.onMeshRemovedObservable=new r.e,this.onNewSkeletonAddedObservable=new r.e,this.onSkeletonRemovedObservable=new r.e,this.onNewMaterialAddedObservable=new r.e,this.onNewMultiMaterialAddedObservable=new r.e,this.onMaterialRemovedObservable=new r.e,this.onMultiMaterialRemovedObservable=new r.e,this.onNewTextureAddedObservable=new r.e,this.onTextureRemovedObservable=new r.e,this.onBeforeRenderTargetsRenderObservable=new r.e,this.onAfterRenderTargetsRenderObservable=new r.e,this.onBeforeStepObservable=new r.e,this.onAfterStepObservable=new r.e,this.onActiveCameraChanged=new r.e,this.onActiveCamerasChanged=new r.e,this.onBeforeRenderingGroupObservable=new r.e,this.onAfterRenderingGroupObservable=new r.e,this.onMeshImportedObservable=new r.e,this.onAnimationFileImportedObservable=new r.e,this._registeredForLateAnimationBindings=new Y.e(256),this._pointerPickingConfiguration=new y,this.onPrePointerObservable=new r.e,this.onPointerObservable=new r.e,this.onPreKeyboardObservable=new r.e,this.onKeyboardObservable=new r.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=VV.FOGMODE_NONE,this.fogColor=new f.b(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new R.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new Y.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new P.d,this._activeIndices=new P.d,this._activeParticles=new P.d,this._activeBones=new P.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new Y.h(256),this._processedMaterials=new Y.h(256),this._renderTargets=new Y.e(256),this._materialsRenderTargets=new Y.e(256),this._activeParticleSystems=new Y.h(256),this._activeSkeletons=new Y.e(32),this._softwareSkinnedMeshes=new Y.e(32),this._activeAnimatables=new Array,this._transformMatrix=R.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=b.f.Create(),this._beforeClearStage=b.f.Create(),this._beforeRenderTargetClearStage=b.f.Create(),this._gatherRenderTargetsStage=b.f.Create(),this._gatherActiveCameraRenderTargetsStage=b.f.Create(),this._isReadyForMeshStage=b.f.Create(),this._beforeEvaluateActiveMeshStage=b.f.Create(),this._evaluateSubMeshStage=b.f.Create(),this._preActiveMeshStage=b.f.Create(),this._cameraDrawRenderTargetStage=b.f.Create(),this._beforeCameraDrawStage=b.f.Create(),this._beforeRenderTargetDrawStage=b.f.Create(),this._beforeRenderingGroupDrawStage=b.f.Create(),this._beforeRenderingMeshStage=b.f.Create(),this._afterRenderingMeshStage=b.f.Create(),this._afterRenderingGroupDrawStage=b.f.Create(),this._afterCameraDrawStage=b.f.Create(),this._afterCameraPostProcessStage=b.f.Create(),this._afterRenderTargetDrawStage=b.f.Create(),this._afterRenderTargetPostProcessStage=b.f.Create(),this._afterRenderStage=b.f.Create(),this._pointerMoveStage=b.f.Create(),this._pointerDownStage=b.f.Create(),this._pointerUpStage=b.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const Z={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...O};V=this._engine=V||H.e.LastCreatedEngine,Z.virtual?V._virtualScenes.push(this):(H.e._LastCreatedScene=this,V.scenes.push(this)),this._uid=null,this._renderingManager=new Q.d(this),F.b&&(this.postProcessManager=new F.b(this)),(0,U.n)()&&this.attachControl(),this._createUbo(),i.b&&(this._imageProcessingConfiguration=new i.b),this.setDefaultCandidateProviders(),Z.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=Z.useMaterialMeshMap,this.useClonedMeshMap=Z.useClonedMeshMap,O&&O.virtual||V.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(V){return this._defaultSubMeshCandidates.data=V.Ef,this._defaultSubMeshCandidates.length=V.Ef.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=V=>this._getDefaultSubMeshCandidates(V),this.getIntersectingSubMeshCandidates=(V,O)=>this._getDefaultSubMeshCandidates(V),this.getCollidingSubMeshCandidates=(V,O)=>this._getDefaultSubMeshCandidates(V)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(V){this._inputManager.pointerX=V}get pointerY(){return this._inputManager.pointerY}set pointerY(V){this._inputManager.pointerY=V}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==O||this._cachedMaterial!==V||this._cachedVisibility!==Z}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(V,O){return this._inputManager.simulatePointerMove(V,O),this}simulatePointerDown(V,O){return this._inputManager.simulatePointerDown(V,O),this}simulatePointerUp(V,O,Z){return this._inputManager.simulatePointerUp(V,O,Z),this}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(V)}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(V,O,Z)}Ei(){this._inputManager.Ei()}isReady(){var V,O;let Z,d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const p=this.getEngine(),r=p.currentRenderPassId;p.currentRenderPassId=(null===(V=this.activeCamera)||void 0===V?void 0:V.renderPassId)??r;let Y=!0;for(this._pendingData.length>0&&(Y=!1),null===(O=this.prePassRenderer)||void 0===O||O.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&Y&&(Y=this.depthPeelingRenderer.isReady()),d&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),Z=0;Z<this.meshes.length;Z++){const V=this.meshes[Z];if(!V.Ef||0===V.Ef.length)continue;if(!V.isReady(!0)){Y=!1;continue}const O=V.hasThinInstances||"InstancedMesh"===V.getClassName()||"InstancedLinesMesh"===V.getClassName()||p.getCaps().instancedArrays&&V.instances.length>0;for(const Z of this._isReadyForMeshStage)Z.action(V,O)||(Y=!1);if(!d)continue;const r=V.material||this.defaultMaterial;if(r)if(r._storeEffectOnSubMeshes)for(const Z of V.Ef){const V=Z.Ha();V&&V.hasRenderTargetTextures&&null!=V.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(V)&&(this._processedMaterials.push(V),this._materialsRenderTargets.concatWithNoDuplicate(V.getRenderTargetTextures()))}else r.hasRenderTargetTextures&&null!=r.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(r)&&(this._processedMaterials.push(r),this._materialsRenderTargets.concatWithNoDuplicate(r.getRenderTargetTextures()))}if(d)for(Z=0;Z<this._materialsRenderTargets.length;++Z){this._materialsRenderTargets.data[Z].isReadyForRendering()||(Y=!1)}for(Z=0;Z<this.geometries.length;Z++){2===this.geometries[Z].delayLoadState&&(Y=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const m of this.activeCameras)m.isReady(!0)||(Y=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(Y=!1));for(const m of this.bj)m.isReady()||(Y=!1);if(this.layers)for(const m of this.layers)m.isReady()||(Y=!1);return p.areAllEffectsReady()||(Y=!1),p.currentRenderPassId=r,Y}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(V){this.onBeforeRenderObservable.add(V)}unregisterBeforeRender(V){this.onBeforeRenderObservable.removeCallback(V)}registerAfterRender(V){this.onAfterRenderObservable.add(V)}unregisterAfterRender(V){this.onAfterRenderObservable.removeCallback(V)}_executeOnceBeforeRender(V){const O=()=>{V(),setTimeout((()=>{this.unregisterBeforeRender(O)}))};this.registerBeforeRender(O)}executeOnceBeforeRender(V,O){void 0!==O?setTimeout((()=>{this._executeOnceBeforeRender(V)}),O):this._executeOnceBeforeRender(V)}addPendingData(V){this._pendingData.push(V)}removePendingData(V){const O=this.isLoading,Z=this._pendingData.indexOf(V);-1!==Z&&this._pendingData.splice(Z,1),O&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(V),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(O)}whenReadyAsync(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((O=>{this.executeWhenReady((()=>{O()}),V)}))}_checkIsReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(V)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(V)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=p.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(V,O,Z,d){Z||d||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===V.updateFlag&&this._projectionUpdateFlag===O.updateFlag||(this._viewUpdateFlag=V.updateFlag,this._projectionUpdateFlag=O.updateFlag,this._viewMatrix=V,this._projectionMatrix=O,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?q.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=q.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(Z,d):this._sceneUbo.useUbo&&(this._sceneUbo.tj("viewProjection",this._transformMatrix),this._sceneUbo.tj("view",this._viewMatrix),this._sceneUbo.tj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(V){const O=new M.b(this._engine,void 0,!1,V??"Cf");return O.addUniform("viewProjection",16),O.addUniform("view",16),O.addUniform("projection",16),O.addUniform("vEyePosition",4),O}setSceneUniformBuffer(V){this._sceneUbo=V,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return K.d.UniqueId}Yh(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(V),V._resyncLightSources(),V.parent||V._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(V),O&&V.getChildMeshes().forEach((V=>{this.Yh(V)})))}Kg(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const Z=this.meshes.indexOf(V);return-1!==Z&&(this.meshes.splice(Z,1),V.parent||V._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(V),this.onMeshRemovedObservable.notifyObservers(V),O&&V.getChildMeshes().forEach((V=>{this.Kg(V)})),Z}addTransformNode(V){this._blockEntityCollection||V.va()===this&&-1!==V._indexInSceneTransformNodesArray||(V._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(V),V.parent||V._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(V))}removeTransformNode(V){const O=V._indexInSceneTransformNodesArray;if(-1!==O){if(O!==this.transformNodes.length-1){const V=this.transformNodes[this.transformNodes.length-1];this.transformNodes[O]=V,V._indexInSceneTransformNodesArray=O}V._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),V.parent||V._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(V),O}removeSkeleton(V){const O=this.skeletons.indexOf(V);return-1!==O&&(this.skeletons.splice(O,1),this.onSkeletonRemovedObservable.notifyObservers(V),this._executeActiveContainerCleanup(this._activeSkeletons)),O}removeMorphTargetManager(V){const O=this.morphTargetManagers.indexOf(V);return-1!==O&&this.morphTargetManagers.splice(O,1),O}removeLight(V){const O=this.lights.indexOf(V);if(-1!==O){for(const O of this.meshes)O._removeLightSource(V,!1);this.lights.splice(O,1),this.sortLightsByPriority(),V.parent||V._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(V),O}removeCamera(V){const O=this.cameras.indexOf(V);if(-1!==O&&(this.cameras.splice(O,1),V.parent||V._removeFromSceneRootNodes()),this.activeCameras){const O=this.activeCameras.indexOf(V);-1!==O&&this.activeCameras.splice(O,1)}return this.activeCamera===V&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(V),O}removeParticleSystem(V){const O=this.bj.indexOf(V);return-1!==O&&(this.bj.splice(O,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),O}removeAnimation(V){const O=this.animations.indexOf(V);return-1!==O&&this.animations.splice(O,1),O}stopAnimation(V,O,Z){}removeAnimationGroup(V){const O=this.animationGroups.indexOf(V);return-1!==O&&this.animationGroups.splice(O,1),O}removeMultiMaterial(V){const O=this.multiMaterials.indexOf(V);return-1!==O&&this.multiMaterials.splice(O,1),this.onMultiMaterialRemovedObservable.notifyObservers(V),O}removeMaterial(V){const O=V._indexInSceneMaterialArray;if(-1!==O&&O<this.materials.length){if(O!==this.materials.length-1){const V=this.materials[this.materials.length-1];this.materials[O]=V,V._indexInSceneMaterialArray=O}V._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(V),O}removeActionManager(V){const O=this.actionManagers.indexOf(V);return-1!==O&&this.actionManagers.splice(O,1),O}removeTexture(V){const O=this.textures.indexOf(V);return-1!==O&&this.textures.splice(O,1),this.onTextureRemovedObservable.notifyObservers(V),O}addLight(V){if(!this._blockEntityCollection){this.lights.push(V),this.sortLightsByPriority(),V.parent||V._addToSceneRootNodes();for(const O of this.meshes)-1===O.lightSources.indexOf(V)&&(O.lightSources.push(V),O._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(V)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(h.d.CompareLightsPriority)}addCamera(V){this._blockEntityCollection||(this.cameras.push(V),this.onNewCameraAddedObservable.notifyObservers(V),V.parent||V._addToSceneRootNodes())}addSkeleton(V){this._blockEntityCollection||(this.skeletons.push(V),this.onNewSkeletonAddedObservable.notifyObservers(V))}addParticleSystem(V){this._blockEntityCollection||this.bj.push(V)}addAnimation(V){this._blockEntityCollection||this.animations.push(V)}addAnimationGroup(V){this._blockEntityCollection||this.animationGroups.push(V)}addMultiMaterial(V){this._blockEntityCollection||(this.multiMaterials.push(V),this.onNewMultiMaterialAddedObservable.notifyObservers(V))}addMaterial(V){this._blockEntityCollection||V.va()===this&&-1!==V._indexInSceneMaterialArray||(V._indexInSceneMaterialArray=this.materials.length,this.materials.push(V),this.onNewMaterialAddedObservable.notifyObservers(V))}addMorphTargetManager(V){this._blockEntityCollection||this.morphTargetManagers.push(V)}addGeometry(V){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=this.geometries.length),this.geometries.push(V))}addActionManager(V){this.actionManagers.push(V)}addTexture(V){this._blockEntityCollection||(this.textures.push(V),this.onNewTextureAddedObservable.notifyObservers(V))}switchActiveCamera(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Ei(),this.activeCamera=V,O&&V.attachControl())}setActiveCameraById(V){const O=this.getCameraById(V);return O?(this.activeCamera=O,O):null}setActiveCameraByName(V){const O=this.getCameraByName(V);return O?(this.activeCamera=O,O):null}getAnimationGroupByName(V){for(let O=0;O<this.animationGroups.length;O++)if(this.animationGroups[O].name===V)return this.animationGroups[O];return null}_getMaterial(V,O){for(let Z=0;Z<this.materials.length;Z++){const V=this.materials[Z];if(O(V))return V}if(V)for(let Z=0;Z<this.multiMaterials.length;Z++){const V=this.multiMaterials[Z];if(O(V))return V}return null}getMaterialByUniqueID(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(O,(O=>O.uniqueId===V))}getMaterialById(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(O,(O=>O.id===V))}getMaterialByName(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(O,(O=>O.name===V))}getLastMaterialById(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let Z=this.materials.length-1;Z>=0;Z--)if(this.materials[Z].id===V)return this.materials[Z];if(O)for(let Z=this.multiMaterials.length-1;Z>=0;Z--)if(this.multiMaterials[Z].id===V)return this.multiMaterials[Z];return null}getTextureByUniqueId(V){for(let O=0;O<this.textures.length;O++)if(this.textures[O].uniqueId===V)return this.textures[O];return null}getTextureByName(V){for(let O=0;O<this.textures.length;O++)if(this.textures[O].name===V)return this.textures[O];return null}getCameraById(V){for(let O=0;O<this.cameras.length;O++)if(this.cameras[O].id===V)return this.cameras[O];return null}getCameraByUniqueId(V){for(let O=0;O<this.cameras.length;O++)if(this.cameras[O].uniqueId===V)return this.cameras[O];return null}getCameraByName(V){for(let O=0;O<this.cameras.length;O++)if(this.cameras[O].name===V)return this.cameras[O];return null}getBoneById(V){for(let O=0;O<this.skeletons.length;O++){const Z=this.skeletons[O];for(let O=0;O<Z.bones.length;O++)if(Z.bones[O].id===V)return Z.bones[O]}return null}getBoneByName(V){for(let O=0;O<this.skeletons.length;O++){const Z=this.skeletons[O];for(let O=0;O<Z.bones.length;O++)if(Z.bones[O].name===V)return Z.bones[O]}return null}getLightByName(V){for(let O=0;O<this.lights.length;O++)if(this.lights[O].name===V)return this.lights[O];return null}getLightById(V){for(let O=0;O<this.lights.length;O++)if(this.lights[O].id===V)return this.lights[O];return null}getLightByUniqueId(V){for(let O=0;O<this.lights.length;O++)if(this.lights[O].uniqueId===V)return this.lights[O];return null}getParticleSystemById(V){for(let O=0;O<this.bj.length;O++)if(this.bj[O].id===V)return this.bj[O];return null}getGeometryById(V){for(let O=0;O<this.geometries.length;O++)if(this.geometries[O].id===V)return this.geometries[O];return null}_getGeometryByUniqueId(V){if(this._geometriesByUniqueId){const O=this._geometriesByUniqueId[V];if(void 0!==O)return this.geometries[O]}else for(let O=0;O<this.geometries.length;O++)if(this.geometries[O].uniqueId===V)return this.geometries[O];return null}pushGeometry(V,O){return!(!O&&this._getGeometryByUniqueId(V.uniqueId))&&(this.addGeometry(V),this.onNewGeometryAddedObservable.notifyObservers(V),!0)}removeGeometry(V){let O;if(this._geometriesByUniqueId){if(O=this._geometriesByUniqueId[V.uniqueId],void 0===O)return!1}else if(O=this.geometries.indexOf(V),O<0)return!1;if(O!==this.geometries.length-1){const V=this.geometries[this.geometries.length-1];V&&(this.geometries[O]=V,this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=O))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(V),!0}getGeometries(){return this.geometries}getMeshById(V){for(let O=0;O<this.meshes.length;O++)if(this.meshes[O].id===V)return this.meshes[O];return null}getMeshesById(V){return this.meshes.filter((function(O){return O.id===V}))}getTransformNodeById(V){for(let O=0;O<this.transformNodes.length;O++)if(this.transformNodes[O].id===V)return this.transformNodes[O];return null}getTransformNodeByUniqueId(V){for(let O=0;O<this.transformNodes.length;O++)if(this.transformNodes[O].uniqueId===V)return this.transformNodes[O];return null}getTransformNodesById(V){return this.transformNodes.filter((function(O){return O.id===V}))}getMeshByUniqueId(V){for(let O=0;O<this.meshes.length;O++)if(this.meshes[O].uniqueId===V)return this.meshes[O];return null}getLastMeshById(V){for(let O=this.meshes.length-1;O>=0;O--)if(this.meshes[O].id===V)return this.meshes[O];return null}getLastTransformNodeById(V){for(let O=this.transformNodes.length-1;O>=0;O--)if(this.transformNodes[O].id===V)return this.transformNodes[O];return null}getLastEntryById(V){let O;for(O=this.meshes.length-1;O>=0;O--)if(this.meshes[O].id===V)return this.meshes[O];for(O=this.transformNodes.length-1;O>=0;O--)if(this.transformNodes[O].id===V)return this.transformNodes[O];for(O=this.cameras.length-1;O>=0;O--)if(this.cameras[O].id===V)return this.cameras[O];for(O=this.lights.length-1;O>=0;O--)if(this.lights[O].id===V)return this.lights[O];return null}getNodeById(V){const O=this.getMeshById(V);if(O)return O;const Z=this.getTransformNodeById(V);if(Z)return Z;const d=this.getLightById(V);if(d)return d;const p=this.getCameraById(V);if(p)return p;const r=this.getBoneById(V);return r||null}getNodeByName(V){const O=this.getMeshByName(V);if(O)return O;const Z=this.getTransformNodeByName(V);if(Z)return Z;const d=this.getLightByName(V);if(d)return d;const p=this.getCameraByName(V);if(p)return p;const r=this.getBoneByName(V);return r||null}getMeshByName(V){for(let O=0;O<this.meshes.length;O++)if(this.meshes[O].name===V)return this.meshes[O];return null}getTransformNodeByName(V){for(let O=0;O<this.transformNodes.length;O++)if(this.transformNodes[O].name===V)return this.transformNodes[O];return null}getLastSkeletonById(V){for(let O=this.skeletons.length-1;O>=0;O--)if(this.skeletons[O].id===V)return this.skeletons[O];return null}getSkeletonByUniqueId(V){for(let O=0;O<this.skeletons.length;O++)if(this.skeletons[O].uniqueId===V)return this.skeletons[O];return null}getSkeletonById(V){for(let O=0;O<this.skeletons.length;O++)if(this.skeletons[O].id===V)return this.skeletons[O];return null}getSkeletonByName(V){for(let O=0;O<this.skeletons.length;O++)if(this.skeletons[O].name===V)return this.skeletons[O];return null}getMorphTargetManagerById(V){for(let O=0;O<this.morphTargetManagers.length;O++)if(this.morphTargetManagers[O].uniqueId===V)return this.morphTargetManagers[O];return null}getMorphTargetById(V){for(let O=0;O<this.morphTargetManagers.length;++O){const Z=this.morphTargetManagers[O];for(let O=0;O<Z.numTargets;++O){const d=Z.getTarget(O);if(d.id===V)return d}}return null}getMorphTargetByName(V){for(let O=0;O<this.morphTargetManagers.length;++O){const Z=this.morphTargetManagers[O];for(let O=0;O<Z.numTargets;++O){const d=Z.getTarget(O);if(d.name===V)return d}}return null}getPostProcessByName(V){for(let O=0;O<this.postProcesses.length;++O){const Z=this.postProcesses[O];if(Z.name===V)return Z}return null}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}get uid(){return this._uid||(this._uid=d.e.RandomId()),this._uid}addExternalData(V,O){return this._externalData||(this._externalData=new m),this._externalData.add(V,O)}getExternalData(V){return this._externalData?this._externalData.get(V):null}getOrAddExternalDataWithFactory(V,O){return this._externalData||(this._externalData=new m),this._externalData.getOrAddWithFactory(V,O)}removeExternalData(V){return this._externalData.remove(V)}_evaluateSubMesh(V,O,Z,d){if(d||V.isInFrustum(this._frustumPlanes)){for(const d of this._evaluateSubMeshStage)d.action(O,V);const Z=V.Ha();null!==Z&&void 0!==Z&&(Z.hasRenderTargetTextures&&null!=Z.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Z)&&(this._processedMaterials.push(Z),this._materialsRenderTargets.concatWithNoDuplicate(Z.getRenderTargetTextures())),this._renderingManager.dispatch(V,O,Z))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(V){this._preventFreeActiveMeshesAndRenderingGroups!==V&&(V&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=V)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let V=0;V<this.activeCameras.length;V++){const O=this.activeCameras[V];O&&O._activeMeshes&&O._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let V=0;V<this.textures.length;V++){const O=this.textures[V];O&&O.renderList&&O.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=p,this._skipEvaluateActiveMeshesCompletely=V,d)for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._freeze();O&&O()}else Z&&Z("No active camera found")})),this}unfreezeActiveMeshes(){for(let V=0;V<this.meshes.length;V++){const O=this.meshes[V];O._internalAbstractMeshDataInfo&&(O._internalAbstractMeshDataInfo._isActive=!1)}for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(V){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>V.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var V;if(this._activeMeshes.length>0)null===(V=this.activeCamera)||void 0===V||V._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const V=this._activeMeshes.length;for(let O=0;O<V;O++){this._activeMeshes.data[O].Cj()}}if(this._activeParticleSystems){const V=this._activeParticleSystems.length;for(let O=0;O<V;O++)this._activeParticleSystems.data[O].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const d of this._beforeEvaluateActiveMeshStage)d.action();const O=this.getActiveMeshCandidates(),Z=O.length;for(let d=0;d<Z;d++){const V=O.data[d];if(V._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,V.isBlocked)continue;if(this._totalVertices.addCount(V.getTotalVertices(),!1),!V.isReady()||!V.isEnabled()||V.Af.hasAZeroComponent)continue;V.Cj(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V);let Z=this.customLODSelector?this.customLODSelector(V,this.activeCamera):V.getLOD(this.activeCamera);if(V._internalAbstractMeshDataInfo._currentLOD=Z,V._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==Z&&null!==Z&&(Z!==V&&0!==Z.billboardMode&&Z.Cj(),V._preActivate(),V.isVisible&&V.visibility>0&&0!==(V.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||V.jg||V.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(V),this.activeCamera._activeMeshes.push(V),Z!==V&&Z._activate(this._renderId,!1);for(const O of this._preActiveMeshStage)O.action(V);V._activate(this._renderId,!1)&&(V.isAnInstance?V._internalAbstractMeshDataInfo._actAsRegularMesh&&(Z=V):Z._internalAbstractMeshDataInfo._onlyForInstances=!1,Z._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(V,Z)),V._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let V=0;V<this.bj.length;V++){const O=this.bj[V];if(!O.isStarted()||!O.k)continue;const Z=O.k;Z.position&&!Z.isEnabled()||(this._activeParticleSystems.push(O),O.animate(),this._renderingManager.dispatchParticles(O))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(V){this._skeletonsEnabled&&V.skeleton&&(this._activeSkeletons.pushNoDuplicate(V.skeleton)&&(V.skeleton.prepare(),this._activeBones.addCount(V.skeleton.bones.length,!1)),V.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(V)&&this.frameGraph&&V.applySkeleton(V.skeleton))}_activeMesh(V,O){this._prepareSkeleton(O);let Z=V.hasInstances||V.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||O.jg;if(O&&O.Ef&&O.Ef.length>0){const d=this.getActiveSubMeshCandidates(O),p=d.length;Z=Z||1===p;for(let r=0;r<p;r++){const p=d.data[r];this._evaluateSubMesh(p,O,V,Z)}}}updateTransformMatrix(V){const O=this.activeCamera;if(O)if(O._renderingMultiview){const Z=O._rigCameras[0],d=O._rigCameras[1];this.setTransformMatrix(Z.getViewMatrix(),Z.getProjectionMatrix(V),d.getViewMatrix(),d.getProjectionMatrix(V))}else this.setTransformMatrix(O.getViewMatrix(),O.getProjectionMatrix(V))}_bindFrameBuffer(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];V&&V._multiviewTexture?V._multiviewTexture._bindFrameBuffer():V&&V.outputRenderTarget?V.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),O&&this._clearFrameBuffer(V)}_clearFrameBuffer(V){if(V&&V._multiviewTexture);else if(V&&V.outputRenderTarget&&!V._renderingMultiview){const O=V.outputRenderTarget;O.onClearObservable.hasObservers()?O.onClearObservable.notifyObservers(this._engine):O.skipInitialClear||V.isRightCamera||(this.Fi&&this._engine.clear(O.clearColor||this._clearColor,!O._cleared,!0,!0),O._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(V,O){var Z;let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(V&&V._skipRendering)return;const r=this._engine;if(this._activeCamera=V,!this.activeCamera)throw new Error("Active camera not set");if(r.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&p){let O=!0;V._renderingMultiview&&V.outputRenderTarget&&(O=V.outputRenderTarget.skipInitialClear,this.Fi&&(this._defaultFrameBufferCleared=!1,V.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),V._renderingMultiview&&V.outputRenderTarget&&(V.outputRenderTarget.skipInitialClear=O)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let d=0;d<this._softwareSkinnedMeshes.length;d++){const V=this._softwareSkinnedMeshes.data[d];V.applySkeleton(V.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),V.customRenderTargets&&V.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(V.customRenderTargets),O&&O.customRenderTargets&&O.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(O.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const d of this._gatherActiveCameraRenderTargetsStage)d.action(this._renderTargets);let Y=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){d.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let V=0;V<this._renderTargets.length;V++){const O=this._renderTargets.data[V];if(O._shouldRender()){this._renderId++;const V=O.activeCamera&&O.activeCamera!==this.activeCamera;O.render(V,this.dumpNextRenderTargets),Y=!0}}d.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const V of this._cameraDrawRenderTargetStage)Y=V.action(this.activeCamera)||Y;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(Z=V.outputRenderTarget)||void 0===Z?void 0:Z.renderPassId)??V.renderPassId??0,Y&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||V._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const d of this._beforeCameraDrawStage)d.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),r.snapshotRendering&&1===r.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const d of this._afterCameraDrawStage)d.action(this.activeCamera);if(this.postProcessManager&&!V._multiviewTexture){const O=V.outputRenderTarget?V.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(V.isIntermediate,O)}for(const d of this._afterCameraPostProcessStage)d.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===V.cameraRigMode||V._renderingMultiview)return V._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(V,void 0,O),void this.onAfterRenderCameraObservable.notifyObservers(V);if(V._useMultiviewToSingleView)this._renderMultiviewToSingleView(V);else{this.onBeforeCameraRenderObservable.notifyObservers(V);for(let O=0;O<V._rigCameras.length;O++)this._renderForCamera(V._rigCameras[O],V)}this._activeCamera=V,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(V)}_checkIntersections(){for(let V=0;V<this._meshesForIntersections.length;V++){const O=this._meshesForIntersections.data[V];if(O.actionManager)for(let V=0;O.actionManager&&V<O.actionManager.actions.length;V++){const Z=O.actionManager.actions[V];if(12===Z.trigger||13===Z.trigger){const V=Z.getTriggerParameter(),d=V.mesh?V.mesh:V,p=d.intersectsMesh(O,V.usePreciseIntersection),r=O._intersectionsInProgress.indexOf(d);p&&-1===r?12===Z.trigger?(Z._executeCurrent(W.CreateNew(O,void 0,d)),O._intersectionsInProgress.push(d)):13===Z.trigger&&O._intersectionsInProgress.push(d):!p&&r>-1&&(13===Z.trigger&&Z._executeCurrent(W.CreateNew(O,void 0,d)),O.actionManager.hasSpecificTrigger(13,(V=>{const O=V.mesh?V.mesh:V;return d===O}))&&13!==Z.trigger||O._intersectionsInProgress.splice(r,1))}}}}_advancePhysicsEngineStep(V){}_animate(V){}animate(){if(this._engine.isDeterministicLockStep()){let V=Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime))+this._timeAccumulator;const O=this._engine.getTimeStep(),Z=1e3/O/1e3;let d=0;const p=this._engine.getLockstepMaxSteps();let r=Math.floor(V/O);for(r=Math.min(r,p);V>0&&d<r;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=O*Z,this._animate(O),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(O),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,d++,V-=O;this._timeAccumulator=V<0?0:V}else{const V=this.useConstantAnimationDeltaTime?16:Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime));this._animationRatio=.06*V,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(V)}}_clear(){(this.autoClearDepthAndStencil||this.Fi)&&this._engine.clear(this._clearColor,this.Fi||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(V){var O;if(null===V||void 0===V||!V.outputRenderTarget||null!==V&&void 0!==V&&V.isRigCamera||(V.outputRenderTarget._cleared=!1),null!==V&&void 0!==V&&null!==(O=V.rigCameras)&&void 0!==O&&O.length)for(let Z=0;Z<V.rigCameras.length;++Z){const O=V.rigCameras[Z].outputRenderTarget;O&&(O._cleared=!1)}}resetDrawCache(V){if(this.meshes)for(const O of this.meshes)O.resetDrawCache(V)}_renderWithFrameGraph(){var V;let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),O)for(const p of this.cameras)if(p.update(),0!==p.cameraRigMode)for(let V=0;V<p._rigCameras.length;V++)p._rigCameras[V].update();for(const p of this._beforeClearStage)p.action();const Z=this.getActiveMeshCandidates(),d=Z.length;for(let p=0;p<d;p++){const V=Z.data[p];V.isBlocked||(this._totalVertices.addCount(V.getTotalVertices(),!1),V.isReady()&&V.isEnabled()&&!V.Af.hasAZeroComponent&&(V.Cj(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V)))}if(this.particlesEnabled)for(let p=0;p<this.bj.length;p++){const V=this.bj[p];if(!V.isStarted()||!V.k)continue;const O=V.k;O.position&&!O.isEnabled()||(this._activeParticleSystems.push(V),V.animate())}null===(V=this.frameGraph)||void 0===V||V.execute()}render(){var V;let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(V=this.activeCameras)&&void 0!==V&&V.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),Z||this.animate();for(const V of this._beforeCameraUpdateStage)V.action();if(O)if(this.activeCameras&&this.activeCameras.length>0)for(let V=0;V<this.activeCameras.length;V++){const O=this.activeCameras[V];if(O.update(),0!==O.cameraRigMode)for(let V=0;V<O._rigCameras.length;V++)O._rigCameras[V].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let V=0;V<this.activeCamera._rigCameras.length;V++)this.activeCamera._rigCameras[V].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(O,Z);else{var p;const V=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const O=null!==(p=this.activeCameras)&&void 0!==p&&p.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){d.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let Z=0;Z<this.customRenderTargets.length;Z++){const d=this.customRenderTargets[Z];if(d._shouldRender()){if(this._renderId++,this.activeCamera=d.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");V.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),d.render(O!==this.activeCamera,this.dumpNextRenderTargets)}}d.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===O||void 0===O?void 0:O.renderPassId)??0,this.activeCamera=O,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const Z of this._beforeClearStage)Z.action();this._clearFrameBuffer(this.activeCamera);for(const Z of this._gatherRenderTargetsStage)Z.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let Z=0;Z<this.activeCameras.length;Z++)this._processSubCameras(this.activeCameras[Z],Z>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const V of this._afterRenderStage)V.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let V=0;V<this._toBeDisposed.length;V++){const O=this._toBeDisposed[V];O&&O.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].freeze()}unfreezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((V=>{V.onAnimationEndObservable.clear(),V.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const V=this._activeRequests.slice();for(const p of V)p.abort();this._activeRequests.length=0;try{this.Xi.notifyObservers(this)}catch(d){B.b.Error("An error occurred while calling onDisposeObservable!",d)}this.Ei();if(this._engine.getInputElement())for(let p=0;p<this.cameras.length;p++)this.cameras[p].Ei();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(V=>V.dispose(!0))),this._disposeList(this.transformNodes,(V=>V.dispose(!0)));const O=this.cameras;this._disposeList(O),this.gi&&this.gi.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.bj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let Z=this._engine.scenes.indexOf(this);Z>-1&&this._engine.scenes.splice(Z,1),H.e._LastCreatedScene===this&&(this._engine.scenes.length>0?H.e._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:H.e._LastCreatedScene=null),Z=this._engine._virtualScenes.indexOf(this),Z>-1&&this._engine._virtualScenes.splice(Z,1),this._engine.wipeCaches(!0),this.Xi.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(V,O){const Z=V.slice(0);O=O??(V=>V.dispose());for(const d of Z)O(d);V.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let V=0;V<this.meshes.length;V++){const O=this.meshes[V].oj;O&&O.clearCachedData()}}cleanCachedTextureBuffer(){for(const V of this.textures){V._buffer&&(V._buffer=null)}}getWorldExtends(V){const O=new R.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z=new R.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return V=V||(()=>!0),this.meshes.filter(V).forEach((V=>{if(V.Cj(!0),!V.Ef||0===V.Ef.length||V.infiniteDistance)return;const d=V.getBoundingInfo(),p=d.boundingBox.minimumWorld,r=d.boundingBox.maximumWorld;R.m.CheckExtends(p,O,Z),R.m.CheckExtends(r,O,Z)})),{min:O,max:Z}}createPickingRay(V,O,Z,d){throw(0,S.c)("Ray")}createPickingRayToRef(V,O,Z,d,p){throw(0,S.c)("Ray")}createPickingRayInCameraSpace(V,O,Z){throw(0,S.c)("Ray")}createPickingRayInCameraSpaceToRef(V,O,Z,d){throw(0,S.c)("Ray")}bc(V,O,Z,d,p,r){const Y=(0,S.c)("Ray",!0);return Y&&B.b.Warn(Y),new c.b}pickWithBoundingInfo(V,O,Z,d,p){const r=(0,S.c)("Ray",!0);return r&&B.b.Warn(r),new c.b}pickWithRay(V,O,Z,d){throw(0,S.c)("Ray")}multiPick(V,O,Z,d,p){throw(0,S.c)("Ray")}multiPickWithRay(V,O,Z){throw(0,S.c)("Ray")}setPointerOverMesh(V,O,Z){this._inputManager.setPointerOverMesh(V,O,Z)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const V of this._components)V.rebuild();for(const V of this.bj)V.rebuild();if(this.spriteManagers)for(const V of this.spriteManagers)V.rebuild()}_rebuildTextures(){for(const V of this.textures)V._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(V,O,Z){if(void 0===O)return V;const d=[];for(const p in V){const r=V[p];a.e&&a.e.MatchesQuery(r,O)&&(!Z||Z(r))&&d.push(r)}return d}getMeshesByTags(V,O){return this._getByTags(this.meshes,V,O)}getCamerasByTags(V,O){return this._getByTags(this.cameras,V,O)}getLightsByTags(V,O){return this._getByTags(this.lights,V,O)}getMaterialByTags(V,O){return this._getByTags(this.materials,V,O).concat(this._getByTags(this.multiMaterials,V,O))}getTransformNodesByTags(V,O){return this._getByTags(this.transformNodes,V,O)}setRenderingOrder(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,O,Z,d)}setRenderingAutoClearDepthStencil(V,O){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(V,O,Z,d)}getAutoClearDepthStencilSetup(V){return this._renderingManager.getAutoClearDepthStencilSetup(V)}_forceBlockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism=V}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism!==V&&(this._blockMaterialDirtyMechanism=V,V||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(V,O){if(!this._blockMaterialDirtyMechanism)for(const Z of this.materials)O&&!O(Z)||Z.sg(V)}_loadFile(V,O,Z,d,p,r,Y){const m=(0,s.o)(V,O,Z,d?this.offlineProvider:void 0,p,r,Y);return this._activeRequests.push(m),m.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),m}_loadFileAsync(V,O,Z,d,p){return new Promise(((r,Y)=>{this._loadFile(V,(V=>{r(V)}),O,Z,d,((V,O)=>{Y(O)}),p)}))}_requestFile(V,O,Z,d,p,r,Y){const m=(0,s.u)(V,O,Z,d?this.offlineProvider:void 0,p,r,Y);return this._activeRequests.push(m),m.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),m}_requestFileAsync(V,O,Z,d,p){return new Promise(((r,Y)=>{this._requestFile(V,(V=>{r(V)}),O,Z,d,(V=>{Y(V)}),p)}))}_readFile(V,O,Z,d,p){const r=(0,s.t)(V,O,Z,d,p);return this._activeRequests.push(r),r.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),r}_readFileAsync(V,O,Z){return new Promise(((d,p)=>{this._readFile(V,(V=>{d(V)}),O,Z,(V=>{p(V)}))}))}getPerfCollector(){throw(0,S.c)("performanceViewerSceneExtension")}setActiveCameraByID(V){return this.setActiveCameraById(V)}getMaterialByID(V){return this.getMaterialById(V)}getLastMaterialByID(V){return this.getLastMaterialById(V)}getTextureByUniqueID(V){return this.getTextureByUniqueId(V)}getCameraByID(V){return this.getCameraById(V)}getCameraByUniqueID(V){return this.getCameraByUniqueId(V)}getBoneByID(V){return this.getBoneById(V)}getLightByID(V){return this.getLightById(V)}getLightByUniqueID(V){return this.getLightByUniqueId(V)}getParticleSystemByID(V){return this.getParticleSystemById(V)}getGeometryByID(V){return this.getGeometryById(V)}getMeshByID(V){return this.getMeshById(V)}getMeshByUniqueID(V){return this.getMeshByUniqueId(V)}getLastMeshByID(V){return this.getLastMeshById(V)}getMeshesByID(V){return this.getMeshesById(V)}getTransformNodeByID(V){return this.getTransformNodeById(V)}getTransformNodeByUniqueID(V){return this.getTransformNodeByUniqueId(V)}getTransformNodesByID(V){return this.getTransformNodesById(V)}getNodeByID(V){return this.getNodeById(V)}getLastEntryByID(V){return this.getLastEntryById(V)}getLastSkeletonByID(V){return this.getLastSkeletonById(V)}}VV.FOGMODE_NONE=0,VV.FOGMODE_EXP=1,VV.FOGMODE_EXP2=2,VV.FOGMODE_LINEAR=3,VV.MinDeltaTime=1,VV.MaxDeltaTime=1e3,(0,j.f)("BABYLON.Scene",VV)},11342:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>d,f:()=>p});class d{}d.NAME_EFFECTLAYER="EffectLayer",d.NAME_LAYER="Layer",d.NAME_LENSFLARESYSTEM="LensFlareSystem",d.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",d.NAME_PARTICLESYSTEM="yb",d.NAME_GAMEPAD="Gamepad",d.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",d.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",d.NAME_PREPASSRENDERER="PrePassRenderer",d.NAME_DEPTHRENDERER="DepthRenderer",d.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",d.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",d.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",d.NAME_SPRITE="Sprite",d.NAME_SUBSURFACE="SubSurface",d.NAME_OUTLINERENDERER="Outline",d.NAME_PROCEDURALTEXTURE="ProceduralTexture",d.NAME_SHADOWGENERATOR="ShadowGenerator",d.NAME_OCTREE="zb",d.NAME_PHYSICSENGINE="PhysicsEngine",d.NAME_AUDIO="Audio",d.NAME_FLUIDRENDERER="FluidRenderer",d.STEP_ISREADYFORMESH_EFFECTLAYER=0,d.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,d.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_PREPASS=0,d.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_LAYER=2,d.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,d.STEP_BEFORERENDERTARGETDRAW_LAYER=1,d.STEP_BEFORERENDERINGMESH_PREPASS=0,d.STEP_BEFORERENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGMESH_PREPASS=0,d.STEP_AFTERRENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,d.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,d.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,d.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,d.STEP_BEFORECLEAR_PREPASS=1,d.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,d.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,d.STEP_AFTERRENDERTARGETDRAW_LAYER=1,d.STEP_AFTERCAMERADRAW_PREPASS=0,d.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,d.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,d.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,d.STEP_AFTERCAMERADRAW_LAYER=4,d.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,d.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,d.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,d.STEP_AFTERRENDER_AUDIO=0,d.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,d.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,d.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,d.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,d.STEP_POINTERMOVE_SPRITE=0,d.STEP_POINTERDOWN_SPRITE=0,d.STEP_POINTERUP_SPRITE=0;class p extends Array{constructor(V){super(...V)}static Create(){return Object.create(p.prototype)}registerStep(V,O,Z){let d=0,p=Number.MAX_VALUE;for(;d<this.length;d++){if(p=this[d].index,V<p)break}this.splice(d,0,{index:V,component:O,action:Z.bind(O)})}clear(){this.length=0}}},11210:(V,O,Z)=>{"use strict";Z.d(O,{c:()=>d});function d(V,O,Z,d){var p,r=arguments.length,Y=r<3?O:null===d?d=Object.getOwnPropertyDescriptor(O,Z):d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(V,O,Z,d);else for(var m=V.length-1;m>=0;m--)(p=V[m])&&(Y=(r<3?p(Y):r>3?p(O,Z,Y):p(O,Z))||Y);return r>3&&Y&&Object.defineProperty(O,Z,Y),Y}Object.create;Object.create},12124:(V,O,Z)=>{"use strict";class d{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((V,O)=>{this._resolve=V,this._reject=O}))}}var p=Z(11251),r=Z(11274),Y=Z(10900),m=Z(11519),a=Z(12131),R=Z(12149),i=Z(10902),M=Z(11691),c=Z(12154),W=Z(12163),F=Z(10942),Q=Z(10914),b=Z(10919);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(V){this._useTextureToStoreBoneMatrices=V,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(V,O,Z){this.name=V,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=p.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.e,this.bones=[],this._scene=Z||F.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const d=this._scene.getEngine().getCaps();this._canUseTextureForBones=d.textureFloat&&d.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((V=>!V.getParent()))}getTransformMatrices(V){if(this.needInitialSkinMatrix){if(!V)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return V._bonesTransformMatrices||this.prepare(!0),V._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(V){return this.needInitialSkinMatrix&&V._transformMatrixTexture?V._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(V){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,V){O+=", Ranges: {";let V=!0;for(const Z in this._ranges)V&&(O+=", ",V=!1),O+=Z;O+="}"}return O}getBoneIndexByName(V){for(let O=0,Z=this.bones.length;O<Z;O++)if(this.bones[O].name===V)return O;return-1}createAnimationRange(V,O,Z){if(!this._ranges[V]){this._ranges[V]=new W.d(V,O,Z);for(let d=0,p=this.bones.length;d<p;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].createRange(V,O,Z)}}deleteAnimationRange(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Z=0,d=this.bones.length;Z<d;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].deleteRange(V,O);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}getAnimationRanges(){const V=[];let O;for(O in this._ranges)V.push(this._ranges[O]);return V}copyAnimationRange(V,O){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!V.getAnimationRange(O))return!1;let d=!0;const p=this._getHighestAnimationFrame()+1,r={},Y=V.bones;let m,a;for(a=0,m=Y.length;a<m;a++)r[Y[a].name]=Y[a];this.bones.length!==Y.length&&(Q.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),d=!1);const R=Z&&this.dimensionsAtRest&&V.dimensionsAtRest?this.dimensionsAtRest.divide(V.dimensionsAtRest):null;for(a=0,m=this.bones.length;a<m;a++){const V=this.bones[a].name,Y=r[V];Y?d=d&&this.bones[a].copyAnimationRange(Y,O,p,Z,R):(Q.b.Warn("copyAnimationRange: not same rig, missing source bone "+V),d=!1)}const i=V.getAnimationRange(O);return i&&(this._ranges[O]=new W.d(O,i.from+p,i.to+p)),d}returnToRest(){for(const V of this.bones)-1!==V._index&&V.returnToRest()}_getHighestAnimationFrame(){let V=0;for(let O=0,Z=this.bones.length;O<Z;O++)if(this.bones[O].animations[0]){const Z=this.bones[O].animations[0].getHighestFrame();V<Z&&(V=Z)}return V}beginAnimation(V,O,Z,d){const p=this.getAnimationRange(V);return p?this._scene.beginAnimation(this,p.from,p.to,O,Z,d):null}static MakeAnimationAdditive(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const d=V.getAnimationRange(Z);if(!d)return null;const p=V._scene.getAllAnimatablesByTarget(V);let r=null;for(let m=0;m<p.length;m++){const V=p[m];if(V.fromFrame===(null===d||void 0===d?void 0:d.from)&&V.toFrame===(null===d||void 0===d?void 0:d.to)){r=V;break}}const Y=V.getAnimatables();for(let m=0;m<Y.length;m++){const V=Y[m].animations;if(V)for(let d=0;d<V.length;d++)c.c.MakeAnimationAdditive(V[d],O,Z)}return r&&(r.isAdditive=!0),V}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(V){this._meshesWithPoseMatrix.push(V)}_unregisterMeshWithPoseMatrix(V){const O=this._meshesWithPoseMatrix.indexOf(V);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(V,O){this.onBeforeComputeObservable.notifyObservers(this);for(let Z=0;Z<this.bones.length;Z++){const d=this.bones[Z];d._childUpdateId++;const p=d.getParent();if(p?d.getLocalMatrix().multiplyToRef(p.getFinalMatrix(),d.getFinalMatrix()):O?d.getLocalMatrix().multiplyToRef(O,d.getFinalMatrix()):d.getFinalMatrix().p(d.getLocalMatrix()),-1!==d._index){const O=null===d._index?Z:d._index;d.getAbsoluteInverseBindMatrix().multiplyToArray(d.getFinalMatrix(),V,16*O)}}this._identity.copyToArray(V,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const V=this.va().getRenderId();if(this._currentRenderId===V)return;this._currentRenderId=V}if(this._numBonesWithLinkedTransformNode>0)for(const V of this.bones)if(V._linkedTransformNode){const O=V._linkedTransformNode;V.position=O.position,O.rotationQuaternion?V.rotationQuaternion=O.rotationQuaternion:V.rotation=O.rotation,V.Af=O.Af}if(this.needInitialSkinMatrix)for(const V of this._meshesWithPoseMatrix){const O=V.getPoseMatrix();let Z=this._isDirty;if(V._bonesTransformMatrices&&V._bonesTransformMatrices.length===16*(this.bones.length+1)||(V._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Z=!0),Z){if(this._synchronizedWithMesh!==V){this._synchronizedWithMesh=V;for(const V of this.bones)if(!V.getParent()){V.getBindMatrix().multiplyToRef(O,p.i.Matrix[1]),V._updateAbsoluteBindMatrices(p.i.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);V._transformMatrixTexture&&V._transformMatrixTexture.getSize().width===O||(V._transformMatrixTexture&&V._transformMatrixTexture.dispose(),V._transformMatrixTexture=M.e.CreateRGBATexture(V._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(V._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&V._transformMatrixTexture&&V._transformMatrixTexture.update(V._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=M.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let V=0;V<this.bones.length;V++)this._animatables.push(this.bones[V])}return this._animatables}clone(V,O){const Z=new U(V,O||V,this._scene);Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){const V=this.bones[d];let O=null;const p=V.getParent();if(p){const V=this.bones.indexOf(p);O=Z.bones[V]}const r=new R.e(V.name,Z,O,V.getBindMatrix().clone(),V.getRestMatrix().clone());r._index=V._index,V._linkedTransformNode&&r.linkTransformNode(V._linkedTransformNode),b.d.DeepCopy(V.animations,r.animations)}if(this._ranges){Z._ranges={};for(const V in this._ranges){const O=this._ranges[V];O&&(Z._ranges[V]=O.clone())}}return this._isDirty=!0,Z.prepare(!0),Z}enableBlending(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((O=>{O.animations.forEach((O=>{O.enableBlending=!0,O.blendingSpeed=V}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const V=this._parentContainer.skeletons.indexOf(this);V>-1&&this._parentContainer.skeletons.splice(V,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const V={};V.name=this.name,V.id=this.id,this.dimensionsAtRest&&(V.dimensionsAtRest=this.dimensionsAtRest.Wi()),V.bones=[],V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){var O;const d=this.bones[Z],p=d.getParent(),r={parentBoneIndex:p?this.bones.indexOf(p):-1,index:d.getIndex(),name:d.name,id:d.id,matrix:d.getBindMatrix().Wi(),rest:d.getRestMatrix().Wi(),linkedTransformNodeId:null===(O=d.getTransformNode())||void 0===O?void 0:O.id};V.bones.push(r),d.length&&(r.length=d.length),d.metadata&&(r.metadata=d.metadata),d.animations&&d.animations.length>0&&(r.animation=d.animations[0].serialize()),V.ranges=[];for(const O in this._ranges){const Z=this._ranges[O];if(!Z)continue;const d={};d.name=O,d.from=Z.from,d.to=Z.to,V.ranges.push(d)}}return V}static Parse(V,O){const Z=new U(V.name,V.id,O);let d;for(V.dimensionsAtRest&&(Z.dimensionsAtRest=p.m.Cg(V.dimensionsAtRest)),Z.needInitialSkinMatrix=V.needInitialSkinMatrix,d=0;d<V.bones.length;d++){const O=V.bones[d],r=V.bones[d].index;let Y=null;O.parentBoneIndex>-1&&(Y=Z.bones[O.parentBoneIndex]);const m=O.rest?p.c.Cg(O.rest):null,a=new R.e(O.name,Z,Y,p.c.Cg(O.matrix),m,null,r);void 0!==O.id&&null!==O.id&&(a.id=O.id),O.length&&(a.length=O.length),O.metadata&&(a.metadata=O.metadata),O.animation&&a.animations.push(c.c.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(Z._hasWaitingData=!0,a._waitingTransformNodeId=O.linkedTransformNodeId)}if(V.ranges)for(d=0;d<V.ranges.length;d++){const O=V.ranges[d];Z.createAnimationRange(O.name,O.from,O.to)}return Z}computeAbsoluteMatrices(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||V)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(V)}getPoseMatrix(){let V=null;return this._meshesWithPoseMatrix.length>0&&(V=this._meshesWithPoseMatrix[0].getPoseMatrix()),V}sortBones(){const V=[],O=new Array(this.bones.length);for(let Z=0;Z<this.bones.length;Z++)this._sortBones(Z,V,O);this.bones=V}_sortBones(V,O,Z){if(Z[V])return;Z[V]=!0;const d=this.bones[V];if(!d)return;void 0===d._index&&(d._index=V);const p=d.getParent();p&&this._sortBones(this.bones.indexOf(p),O,Z),O.push(d)}setCurrentPoseAsRest(){this.bones.forEach((V=>{V.setCurrentPoseAsRest()}))}}var H=Z(11409),S=Z(11210),z=Z(11216),G=Z(12170),w=Z(12180),t=Z(11041),C=Z(11283);class v extends w.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(V){this.subSurface.refractionTexture=V,V?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(V){this.subSurface.indexOfRefraction=V}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(V){this.subSurface.invertRefractionY=V}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(V){this.subSurface.linkRefractionWithTransparency=V,V&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===w.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(V){V!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?w.e.LIGHTFALLOFF_PHYSICAL:w.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===w.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(V){V!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?w.e.LIGHTFALLOFF_GLTF:w.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}constructor(V,O){super(V,O,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=r.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new r.b(0,0,0),this.albedoColor=new r.b(1,1,1),this.reflectivityColor=new r.b(1,1,1),this.reflectionColor=new r.b(1,1,1),this.emissiveColor=new r.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,G.b)(this.va())}getClassName(){return"PBRMaterial"}clone(V){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const d=C.b.Clone((()=>new v(V,this.va())),this,{cloneTexturesOnlyOnce:O});return d.id=V,d.name=V,this.stencil.copyTo(d.stencil),this._clonePlugins(d,Z),d}serialize(){const V=super.serialize();return V.customType="BABYLON.PBRMaterial",V}static Parse(V,O,Z){const d=C.b.Parse((()=>new v(V.name,O)),V,O,Z);return V.stencil&&d.stencil.parse(V.stencil,O,Z),H.e._ParsePlugins(V,d,O,Z),V.clearCoat&&d.clearCoat.parse(V.clearCoat,O,Z),V.anisotropy&&d.anisotropy.parse(V.anisotropy,O,Z),V.brdf&&d.brdf.parse(V.brdf,O,Z),V.sheen&&d.sheen.parse(V.sheen,O,Z),V.subSurface&&d.subSurface.parse(V.subSurface,O,Z),V.iridescence&&d.iridescence.parse(V.iridescence,O,Z),d}}v.PBRMATERIAL_OPAQUE=w.e.PBRMATERIAL_OPAQUE,v.PBRMATERIAL_ALPHATEST=w.e.PBRMATERIAL_ALPHATEST,v.PBRMATERIAL_ALPHABLEND=w.e.PBRMATERIAL_ALPHABLEND,v.PBRMATERIAL_ALPHATESTANDBLEND=w.e.PBRMATERIAL_ALPHATESTANDBLEND,v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=w.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"directIntensity",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveIntensity",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentIntensity",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"specularIntensity",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"disableBumpMap",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTexture",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureStrength",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"opacityTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicTexture",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallic",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicF0Factor",void 0),(0,S.c)([(0,z.k)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceColor",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectanceTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurfaceTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,S.c)([(0,z.A)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty",null)],v.prototype,"lightmapTexture",void 0),(0,S.c)([(0,z.k)("ambient"),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientColor",void 0),(0,S.c)([(0,z.k)("albedo"),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoColor",void 0),(0,S.c)([(0,z.k)("reflectivity"),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityColor",void 0),(0,S.c)([(0,z.k)("reflection"),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionColor",void 0),(0,S.c)([(0,z.k)("emissive"),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveColor",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurface",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLightmapAsShadowmap",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"useAlphaFromAlbedoTexture",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"forceAlphaTest",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"alphaCutOff",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useSpecularOverAlpha",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientInGrayScale",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,S.c)([(0,z.K)()],v.prototype,"usePhysicalLightFalloff",null),(0,S.c)([(0,z.K)()],v.prototype,"useGLTFLightFalloff",null),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOverAlpha",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useObjectSpaceNormalMap",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallax",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallaxOcclusion",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"parallaxScaleBias",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsLightsDirty")],v.prototype,"disableLighting",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceIrradianceInFragment",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsLightsDirty")],v.prototype,"maxSimultaneousLights",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapX",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapY",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"twoSidedLighting",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAlphaFresnel",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLinearAlphaFresnel",void 0),(0,S.c)([(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentBRDFTexture",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceNormalForward",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"enableSpecularAntiAliasing",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useHorizonOcclusion",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOcclusion",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"unlit",void 0),(0,S.c)([(0,z.K)(),(0,z.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"applyDecalMapAfterDetailMap",void 0),(0,t.f)("BABYLON.PBRMaterial",v);var A=Z(11467),l=Z(11556),I=Z(11316),g=Z(11539),n=Z(11552),e=Z(11508);class u{get influence(){return this._influence}set influence(V){if(this._influence===V)return;const O=this._influence;this._influence=V,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===O||0===V)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=V,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new i.e,this._onDataLayoutChanged=new i.e,this._animationPropertiesOverride=null,this.id=V,this._scene=Z||F.e.LastCreatedScene,this.influence=O,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(V){const O=this.hasPositions;this._positions=V,O!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(V){const O=this.hasNormals;this._normals=V,O!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(V){const O=this.hasTangents;this._tangents=V,O!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(V){const O=this.hasUVs;this._uvs=V,O!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const V=C.b.Clone((()=>new u(this.name,this.influence,this._scene)),this);return V._positions=this._positions,V._normals=this._normals,V._tangents=this._tangents,V._uvs=this._uvs,V}serialize(){const V={};return V.name=this.name,V.influence=this.influence,V.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(V.id=this.id),this.hasNormals&&(V.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(V.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(V.Aa=Array.prototype.slice.call(this.getUVs())),C.b.AppendSerializedAnimations(this,V),V}getClassName(){return"MorphTarget"}static Parse(V,O){const Z=new u(V.name,V.influence);if(Z.setPositions(V.xa),null!=V.id&&(Z.id=V.id),V.ya&&Z.setNormals(V.ya),V.tangents&&Z.setTangents(V.tangents),V.Aa&&Z.setUVs(V.Aa),V.animations){for(let O=0;O<V.animations.length;O++){const d=V.animations[O],p=(0,t.c)("BABYLON.Animation");p&&Z.animations.push(p.Parse(d))}V.autoAnimate&&O&&O.beginAnimation(Z,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1)}return Z}static FromMesh(V,O,Z){O||(O=V.name);const d=new u(O,Z,V.va());return d.setPositions(V.getVerticesData(I.e.PositionKind)),V.isVerticesDataPresent(I.e.NormalKind)&&d.setNormals(V.getVerticesData(I.e.NormalKind)),V.isVerticesDataPresent(I.e.TangentKind)&&d.setTangents(V.getVerticesData(I.e.TangentKind)),V.isVerticesDataPresent(I.e.UVKind)&&d.setUVs(V.getVerticesData(I.e.UVKind)),d}}(0,S.c)([(0,z.K)()],u.prototype,"id",void 0);var k=Z(11230),D=Z(12046);class X{set areUpdatesFrozen(V){V?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new k.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,V||(V=F.e.LastCreatedScene),this._scene=V,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const V=this._scene.getEngine().getCaps();this._canUseTextureForTargets=V.canUseGLVertexID&&V.textureFloat&&V.maxVertexTextureImageUnits>0&&V.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(V){this._numMaxInfluencers!==V&&(this._numMaxInfluencers=V,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(V){this._useTextureToStoreTargets=V}get isUsingTextureForTargets(){var V;return X.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(V=this._scene)&&void 0!==V&&V.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(V){return this._activeTargets.data[V]}getTarget(V){return this._targets[V]}getTargetByName(V){for(const O of this._targets)if(O.name===V)return O;return null}addTarget(V){this._targets.push(V),this._targetInfluenceChangedObservers.push(V.onInfluenceChanged.add((V=>{this._syncActiveTargets(V)}))),this._targetDataLayoutChangedObservers.push(V._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(V){const O=this._targets.indexOf(V);O>=0&&(this._targets.splice(O,1),V.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),V._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(V)}_bind(V){V.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),V.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),V.setTexture("morphTargets",this._targetStoreTexture),V.setInt("morphTargetCount",this.numInfluencers)}clone(){const V=new X(this._scene);for(const O of this._targets)V.addTarget(O.clone());return V.enableNormalMorphing=this.enableNormalMorphing,V.enableTangentMorphing=this.enableTangentMorphing,V.enableUVMorphing=this.enableUVMorphing,V}serialize(){const V={};V.id=this.uniqueId,V.targets=[];for(const O of this._targets)V.targets.push(O.serialize());return V}_syncActiveTargets(V){if(this.areUpdatesFrozen)return;let O=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Z=-1;for(const d of this._targets){if(Z++,0===d.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=X.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(d),this._morphTargetTextureIndices[O]=Z,this._tempInfluences[O++]=d.influence,this._supportsNormals=this._supportsNormals&&d.hasNormals,this._supportsTangents=this._supportsTangents&&d.hasTangents,this._supportsUVs=this._supportsUVs&&d.hasUVs;const V=d.getPositions();if(V){const O=V.length/3;if(0===this._vertexCount)this._vertexCount=O;else if(this._vertexCount!==O)return void Q.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==O&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,O)),this._influences&&this._influences.length===O||(this._influences=new Float32Array(O));for(let d=0;d<O;d++)this._influences[d]=this._tempInfluences[d];V&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const V=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>V&&(this._textureHeight=Math.ceil(this._textureWidth/V),this._textureWidth=V);let O=!0;if(this._targetStoreTexture){const V=this._targetStoreTexture.getSize();V.width===this._textureWidth&&V.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(O=!1)}if(O){this._targetStoreTexture&&this._targetStoreTexture.dispose();const V=this._targets.length,O=new Float32Array(V*this._textureWidth*this._textureHeight*4);let Z=0;for(let d=0;d<V;d++){const V=this._targets[d],p=V.getPositions(),r=V.getNormals(),Y=V.getUVs(),m=V.getTangents();if(!p)return void(0===d&&Q.b.Error("Invalid morph target. Target must have positions."));Z=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)O[Z]=p[3*d],O[Z+1]=p[3*d+1],O[Z+2]=p[3*d+2],Z+=4,this._supportsNormals&&r&&(O[Z]=r[3*d],O[Z+1]=r[3*d+1],O[Z+2]=r[3*d+2],Z+=4),this._supportsUVs&&Y&&(O[Z]=Y[2*d],O[Z+1]=Y[2*d+1],Z+=4),this._supportsTangents&&m&&(O[Z]=m[3*d],O[Z+1]=m[3*d+1],O[Z+2]=m[3*d+2],Z+=4)}this._targetStoreTexture=D.c.CreateRGBATexture(O,this._textureWidth,this._textureHeight,V,this._scene,!1,!1,1,1)}}for(const V of this._scene.meshes)V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const V=this._parentContainer.morphTargetManagers.indexOf(this);V>-1&&this._parentContainer.morphTargetManagers.splice(V,1),this._parentContainer=null}for(const V of this._targets)this._scene.stopAnimation(V)}}static Parse(V,O){const Z=new X(O);for(const d of V.targets)Z.addTarget(u.Parse(d,O));return Z}}X.EnableTextureStorage=!0,X.MaxActiveMorphTargetsInVertexAttributeMode=8;var o=Z(12188),E=Z(10947),L=Z(11421);function J(V,O,Z,d){return p.m.Cg(O,Z).scaleInPlace(d)}class N{constructor(V,O,Z,d){this.type=V,this.name=O,this.getValue=Z,this.getStride=d}_buildAnimation(V,O,Z){const d=new c.c(V,this.name,O,this.type);return d.setKeys(Z),d}}class P extends N{buildAnimations(V,O,Z,d,p){p(V._babylonTransformNode,this._buildAnimation(O,Z,d))}}const f={translation:[new P(c.c.ANIMATIONTYPE_VECTOR3,"position",J,(()=>3))],rotation:[new P(c.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(V,O,Z,d){return p.g.Cg(O,Z).scaleInPlace(d)}),(()=>4))],scale:[new P(c.c.ANIMATIONTYPE_VECTOR3,"Af",J,(()=>3))],weights:[new class extends N{buildAnimations(V,O,Z,d,p){if(V._numMorphTargets)for(let r=0;r<V._numMorphTargets;r++){const Y=new c.c(`${O}_${r}`,this.name,Z,this.type);if(Y.setKeys(d.map((V=>({frame:V.frame,inTangent:V.inTangent?V.inTangent[r]:void 0,value:V.value[r],outTangent:V.outTangent?V.outTangent[r]:void 0,interpolation:V.interpolation})))),V._primitiveBabylonMeshes)for(const O of V._primitiveBabylonMeshes)if(O.morphTargetManager){const V=O.morphTargetManager.getTarget(r),Z=Y.clone();V.animations.push(Z),p(V,Z)}}}}(c.c.ANIMATIONTYPE_FLOAT,"influence",(function(V,O,Z,d){const p=new Array(V._numMorphTargets);for(let r=0;r<p.length;r++)p[r]=O[Z++]*d;return p}),(V=>V._numMorphTargets))]},q=new Map,K=q;function s(V,O,Z){h(V)&&Q.b.Warn(`Extension with the name '${V}' already exists`),q.set(V,{isGLTFExtension:O,factory:Z})}function h(V){return q.delete(V)}function x(){const V=V=>V&&"object"===typeof V;for(var O=arguments.length,Z=new Array(O),d=0;d<O;d++)Z[d]=arguments[d];return Z.reduce(((O,Z)=>(Object.keys(Z).forEach((d=>{const p=O[d],r=Z[d];Array.isArray(p)&&Array.isArray(r)?O[d]=p.concat(...r):V(p)&&V(r)?O[d]=x(p,r):O[d]=r})),O)),{})}class y{static Get(V,O,Z){if(!O||void 0==Z||!O[Z])throw new Error(`${V}: Failed to find index (${Z})`);return O[Z]}static TryGet(V,O){return V&&void 0!=O&&V[O]?V[O]:null}static Assign(V){if(V)for(let O=0;O<V.length;O++)V[O].index=O}}class T{static RegisterExtension(V,O){s(V,!1,O)}static UnregisterExtension(V){return h(V)}get Ai(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(V){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=V}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((V=>V.dispose&&V.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(V,O,Z,d,p,r){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=O,this._assetContainer=Z,this._loadData(d);let r=null;if(V){const O={};if(this._gltf.nodes)for(const V of this._gltf.nodes)V.name&&(O[V.name]=V.index);r=(V instanceof Array?V:[V]).map((V=>{const Z=O[V];if(void 0===Z)throw new Error(`Failed to find node '${V}'`);return Z}))}return this._loadAsync(p,Y,r,(()=>({meshes:this._getMeshes(),bj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=V,this._loadData(O),this._loadAsync(Z,p,null,(()=>{})))))}_loadAsync(V,O,Z,d){return Promise.resolve().then((async()=>{this._rootUrl=V,this._uniqueRootUrl=!V.startsWith("file:")&&O?V:`${V}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const p=`${o.k[o.k.LOADING]} => ${o.k[o.k.READY]}`,r=`${o.k[o.k.LOADING]} => ${o.k[o.k.COMPLETE]}`;this._parent._startPerformanceCounter(p),this._parent._startPerformanceCounter(r),this._parent._setState(o.k.LOADING),this._extensionsOnLoading();const m=new Array;if(!this.parent.loadOnlyMaterials)if(Z)m.push(this.loadSceneAsync("/nodes",{nodes:Z,index:-1}));else if(void 0!=this._gltf.Cf||this._gltf.scenes&&this._gltf.scenes[0]){const V=y.Get("/scene",this._gltf.scenes,this._gltf.Cf||0);m.push(this.loadSceneAsync(`/scenes/${V.index}`,V))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let V=0;V<this._gltf.materials.length;++V){const O=this._gltf.materials[V],Z="/materials/"+V,d=H.e.TriangleFillMode;m.push(this._loadMaterialAsync(Z,O,null,d,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&m.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&m.push(this._compileShadowGeneratorsAsync());return Promise.all(m).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.If(!0),this._extensionsOnReady(),this._parent._setState(o.k.READY),this._startAnimations(),d()))).then((V=>(this._parent._endPerformanceCounter(p),Y.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(r),this._parent._setState(o.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(V=>{this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()}))})),V)))})).catch((V=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()),V}))}_loadData(V){if(this._gltf=V.json,this._setupData(),V.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const Z=O[0];(Z.byteLength<V.bin.byteLength-3||Z.byteLength>V.bin.byteLength)&&Q.b.Warn(`Binary buffer length (${Z.byteLength}) from JSON does not match chunk length (${V.bin.byteLength})`),this._bin=V.bin}else Q.b.Warn("Unexpected BIN chunk")}}_setupData(){if(y.Assign(this._gltf.accessors),y.Assign(this._gltf.animations),y.Assign(this._gltf.buffers),y.Assign(this._gltf.bufferViews),y.Assign(this._gltf.cameras),y.Assign(this._gltf.images),y.Assign(this._gltf.materials),y.Assign(this._gltf.meshes),y.Assign(this._gltf.nodes),y.Assign(this._gltf.samplers),y.Assign(this._gltf.scenes),y.Assign(this._gltf.skins),y.Assign(this._gltf.textures),this._gltf.nodes){const V={};for(const Z of this._gltf.nodes)if(Z.children)for(const O of Z.children)V[O]=Z.index;const O=this._createRootNode();for(const Z of this._gltf.nodes){const d=V[Z.index];Z.parent=void 0===d?O:this._gltf.nodes[d]}}}async _loadExtensionsAsync(){const V=[];if(K.forEach(((O,Z)=>{var d;!1===(null===(d=this.parent.extensionOptions[Z])||void 0===d?void 0:d.enabled)?O.isGLTFExtension&&this.isExtensionUsed(Z)&&Q.b.Warn(`Extension ${Z} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(Z)||V.push((async()=>{const V=await O.factory(this);return V.name!==Z&&Q.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${V.name} !== ${Z}`),this._parent.onExtensionLoadedObservable.notifyObservers(V),V})())})),this._extensions.push(...await Promise.all(V)),this._extensions.sort(((V,O)=>(V.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Z of this._gltf.extensionsRequired){if(!this._extensions.some((V=>V.name===Z&&V.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[Z])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${Z} is disabled`);throw new Error(`Required extension ${Z} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new e.c("__root__",this._babylonScene);this._rootBabylonMesh=V,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.If(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case o.i.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],T._LoadTransform(O,this._rootBabylonMesh));break;case o.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(V),O}loadSceneAsync(V,O){const Z=this._extensionsLoadSceneAsync(V,O);if(Z)return Z;const d=new Array;if(this.logOpen(`${V} ${O.name||""}`),O.nodes)for(const p of O.nodes){const O=y.Get(`${V}/nodes/${p}`,this._gltf.nodes,p);d.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(V=>{V.parent=this._rootBabylonMesh})))}for(const p of this._postSceneLoadActions)p();return d.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(d).then((()=>{}))}_forEachPrimitive(V,O){if(V._primitiveBabylonMeshes)for(const Z of V._primitiveBabylonMeshes)O(Z)}_getGeometries(){const V=[],O=this._gltf.nodes;if(O)for(const Z of O)this._forEachPrimitive(Z,(O=>{const Z=O.oj;Z&&-1===V.indexOf(Z)&&V.push(Z)}));return V}_getMeshes(){const V=[];this._rootBabylonMesh instanceof n.d&&V.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const Z of O)this._forEachPrimitive(Z,(O=>{V.push(O)}));return V}_getTransformNodes(){const V=[],O=this._gltf.nodes;if(O)for(const Z of O)Z._babylonTransformNode&&"xb"===Z._babylonTransformNode.getClassName()&&V.push(Z._babylonTransformNode),Z._babylonTransformNodeForSkin&&V.push(Z._babylonTransformNodeForSkin);return V}_getSkeletons(){const V=[],O=this._gltf.skins;if(O)for(const Z of O)Z._data&&V.push(Z._data.babylonSkeleton);return V}_getAnimationGroups(){const V=[],O=this._gltf.animations;if(O)for(const Z of O)Z._babylonAnimationGroup&&V.push(Z._babylonAnimationGroup);return V}_startAnimations(){switch(this._parent.animationStartMode){case o.e.NONE:break;case o.e.FIRST:{const V=this._getAnimationGroups();0!==V.length&&V[0].start(!0);break}case o.e.ALL:{const V=this._getAnimationGroups();for(const O of V)O.start(!0);break}default:return void Q.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadNodeAsync(V,O,Z);if(d)return d;if(O._babylonTransformNode)throw new Error(`${V}: Invalid recursive node hierarchy`);const p=new Array;this.logOpen(`${V} ${O.name||""}`);const r=d=>{if(T.AddPointerMetadata(d,V),T._LoadTransform(O,d),void 0!=O.camera){const Z=y.Get(`${V}/camera`,this._gltf.cameras,O.camera);p.push(this.loadCameraAsync(`/cameras/${Z.index}`,Z,(V=>{V.parent=d})))}if(O.children)for(const Z of O.children){const O=y.Get(`${V}/children/${Z}`,this._gltf.nodes,Z);p.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(V=>{V.parent=d})))}Z(d)},Y=void 0!=O.mesh,m=this._parent.loadSkins&&void 0!=O.skin;if(!Y||m){const V=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new l.b(V,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=Z:O._babylonTransformNodeForSkin=Z,r(Z)}if(Y)if(m){const Z=y.Get(`${V}/mesh`,this._gltf.meshes,O.mesh);p.push(this._loadMeshAsync(`/meshes/${Z.index}`,O,Z,(Z=>{const d=O._babylonTransformNodeForSkin;Z.metadata=x(d.metadata,Z.metadata||{});const r=y.Get(`${V}/skin`,this._gltf.skins,O.skin);p.push(this._loadSkinAsync(`/skins/${r.index}`,O,r,(V=>{this._forEachPrimitive(O,(O=>{O.skeleton=V})),this._postSceneLoadActions.push((()=>{if(void 0!=r.skeleton){const V=y.Get(`/skins/${r.index}/skeleton`,this._gltf.nodes,r.skeleton).parent;O.index===V.index?Z.parent=d.parent:Z.parent=V._babylonTransformNode}else Z.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:d,skinnedNode:Z})}))})))})))}else{const Z=y.Get(`${V}/mesh`,this._gltf.meshes,O.mesh);p.push(this._loadMeshAsync(`/meshes/${Z.index}`,O,Z,r))}return this.logClose(),Promise.all(p).then((()=>(this._forEachPrimitive(O,(V=>{V.oj&&V.oj.useBoundingInfoFromGeometry?V.Ea():V.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(V,O,Z,d){const p=Z.primitives;if(!p||!p.length)throw new Error(`${V}: Primitives are missing`);void 0==p[0].index&&y.Assign(p);const r=new Array;this.logOpen(`${V} ${Z.name||""}`);const Y=O.name||`node${O.index}`;if(1===p.length){const d=Z.primitives[0];r.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${d.index}`,Y,O,Z,d,(V=>{O._babylonTransformNode=V,O._primitiveBabylonMeshes=[V]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new l.b(Y,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const d of p)r.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${d.index}`,`${Y}_primitive${d.index}`,O,Z,d,(V=>{V.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(V)})))}return d(O._babylonTransformNode),this.logClose(),Promise.all(r).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(V,O,Z,d,p,r){const Y=this._extensionsLoadMeshPrimitiveAsync(V,O,Z,d,p,r);if(Y)return Y;this.logOpen(`${V}`);const m=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Z.skin&&!d.primitives[0].targets;let a,R;if(m&&p._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,a=p._instanceData.babylonSourceMesh.Vc(O),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R=p._instanceData.promise;else{const r=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new e.c(O,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?H.e.CounterClockWiseSideOrientation:H.e.ClockWiseSideOrientation,this._createMorphTargets(V,Z,d,p,Y),r.push(this._loadVertexDataAsync(V,p,Y).then((O=>this._loadMorphTargetsAsync(V,p,Y,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.Ca(Y),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const i=T._GetDrawMode(V,p.mode);if(void 0==p.material){let V=this._defaultBabylonMaterialData[i];V||(V=this._createDefaultMaterial("__GLTFLoader._default",i),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[i]=V),Y.material=V}else if(!this.parent.skipMaterials){const O=y.Get(`${V}/material`,this._gltf.materials,p.material);r.push(this._loadMaterialAsync(`/materials/${O.index}`,O,Y,i,(V=>{Y.material=V})))}R=Promise.all(r),m&&(p._instanceData={babylonSourceMesh:Y,promise:R}),a=Y}return T.AddPointerMetadata(a,V),this._parent.onMeshLoadedObservable.notifyObservers(a),r(a),this.logClose(),R.then((()=>a))}_loadVertexDataAsync(V,O,Z){const d=this._extensionsLoadVertexDataAsync(V,O,Z);if(d)return d;const r=O.attributes;if(!r)throw new Error(`${V}: Attributes are missing`);const Y=new Array,m=new g.d(Z.name,this._babylonScene);if(void 0==O.indices)Z.isUnIndexed=!0;else{const Z=y.Get(`${V}/indices`,this._gltf.accessors,O.indices);Y.push(this._loadIndicesAccessorAsync(`/accessors/${Z.index}`,Z).then((V=>{m.setIndices(V)})))}const a=(O,d,a)=>{if(void 0==r[O])return;Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(d)&&Z._delayInfo.push(d);const R=y.Get(`${V}/attributes/${O}`,this._gltf.accessors,r[O]);Y.push(this._loadVertexAccessorAsync(`/accessors/${R.index}`,R,d).then((V=>{if(V.getKind()===I.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Z.skeleton&&R.min&&R.max){const V=p.i.ib[0].nf(...R.min),O=p.i.ib[1].nf(...R.max);if(R.normalized&&5126!==R.componentType){let Z=1;switch(R.componentType){case 5120:Z=127;break;case 5121:Z=255;break;case 5122:Z=32767;break;case 5123:Z=65535}const d=1/Z;V.scaleInPlace(d),O.scaleInPlace(d)}m._boundingInfo=new L.c(V,O),m.useBoundingInfoFromGeometry=!0}m.setVerticesBuffer(V,R.count)}))),d==I.e.MatricesIndicesExtraKind&&(Z.numBoneInfluencers=8),a&&a(R)};return a("POSITION",I.e.PositionKind),a("NORMAL",I.e.NormalKind),a("TANGENT",I.e.TangentKind),a("TEXCOORD_0",I.e.UVKind),a("TEXCOORD_1",I.e.UV2Kind),a("TEXCOORD_2",I.e.UV3Kind),a("TEXCOORD_3",I.e.UV4Kind),a("TEXCOORD_4",I.e.UV5Kind),a("TEXCOORD_5",I.e.UV6Kind),a("JOINTS_0",I.e.MatricesIndicesKind),a("WEIGHTS_0",I.e.MatricesWeightsKind),a("JOINTS_1",I.e.MatricesIndicesExtraKind),a("WEIGHTS_1",I.e.MatricesWeightsExtraKind),a("COLOR_0",I.e.ColorKind,(V=>{"VEC4"===V.type&&(Z.hasVertexAlpha=!0)})),Promise.all(Y).then((()=>m))}_createMorphTargets(V,O,Z,d,p){if(!d.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=d.targets.length;else if(d.targets.length!==O._numMorphTargets)throw new Error(`${V}: Primitives do not have the same number of targets`);const r=Z.extras?Z.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,p.morphTargetManager=new X(this._babylonScene),p.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<d.targets.length;Y++){const V=O.weights?O.weights[Y]:Z.weights?Z.weights[Y]:0,d=r?r[Y]:`morphTarget${Y}`;p.morphTargetManager.addTarget(new u(d,V,p.va()))}}_loadMorphTargetsAsync(V,O,Z,d){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const p=new Array,r=Z.morphTargetManager;for(let Y=0;Y<r.numTargets;Y++){const Z=r.getTarget(Y);p.push(this._loadMorphTargetVertexDataAsync(`${V}/targets/${Y}`,d,O.targets[Y],Z))}return Promise.all(p).then((()=>{r.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(V,O,Z,d){const p=new Array,r=(d,r,Y)=>{if(void 0==Z[d])return;const m=O.getVertexBuffer(r);if(!m)return;const a=y.Get(`${V}/${d}`,this._gltf.accessors,Z[d]);p.push(this._loadFloatAccessorAsync(`/accessors/${a.index}`,a).then((V=>{Y(m,V)})))};return r("POSITION",I.e.PositionKind,((V,O)=>{const Z=new Float32Array(O.length);V.forEach(O.length,((V,d)=>{Z[d]=O[d]+V})),d.setPositions(Z)})),r("NORMAL",I.e.NormalKind,((V,O)=>{const Z=new Float32Array(O.length);V.forEach(Z.length,((V,d)=>{Z[d]=O[d]+V})),d.setNormals(Z)})),r("TANGENT",I.e.TangentKind,((V,O)=>{const Z=new Float32Array(O.length/3*4);let p=0;V.forEach(O.length/3*4,((V,d)=>{(d+1)%4!==0&&(Z[p]=O[p]+V,p++)})),d.setTangents(Z)})),Promise.all(p).then((()=>{}))}static _LoadTransform(V,O){if(void 0!=V.skin)return;let Z=p.m.Zero(),d=p.g.Identity(),r=p.m.One();if(V.matrix){p.c.Cg(V.matrix).decompose(r,d,Z)}else V.translation&&(Z=p.m.Cg(V.translation)),V.rotation&&(d=p.g.Cg(V.rotation)),V.scale&&(r=p.m.Cg(V.scale));O.position=Z,O.rotationQuaternion=d,O.Af=r}_loadSkinAsync(V,O,Z,d){if(!this._parent.loadSkins)return Promise.resolve();const p=this._extensionsLoadSkinAsync(V,O,Z);if(p)return p;if(Z._data)return d(Z._data.babylonSkeleton),Z._data.promise;const r=`skeleton${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new U(Z.name||r,r,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(V,Z,Y);const m=this._loadSkinInverseBindMatricesDataAsync(V,Z).then((V=>{this._updateBoneMatrices(Y,V)}));return Z._data={babylonSkeleton:Y,promise:m},d(Y),m}_loadBones(V,O,Z){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Z=this._findSkeletonRootNode(`${V}/joints`,O.joints);if(Z)if(void 0===O.skeleton)O.skeleton=Z.index;else{const d=(V,O)=>{for(;O.parent;O=O.parent)if(O.parent===V)return!0;return!1},p=y.Get(`${V}/skeleton`,this._gltf.nodes,O.skeleton);p===Z||d(p,Z)||(Q.b.Warn(`${V}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=Z.index)}else Q.b.Warn(`${V}: Failed to find common root`)}const d={};for(const p of O.joints){const r=y.Get(`${V}/joints/${p}`,this._gltf.nodes,p);this._loadBone(r,O,Z,d)}}_findSkeletonRootNode(V,O){if(0===O.length)return null;const Z={};for(const p of O){const O=[];let d=y.Get(`${V}/${p}`,this._gltf.nodes,p);for(;-1!==d.index;)O.unshift(d),d=d.parent;Z[p]=O}let d=null;for(let p=0;;++p){let V=Z[O[0]];if(p>=V.length)return d;const r=V[p];for(let Y=1;Y<O.length;++Y)if(V=Z[O[Y]],p>=V.length||r!==V[p])return d;d=r}}_loadBone(V,O,Z,d){V._isJoint=!0;let p=d[V.index];if(p)return p;let r=null;V.index!==O.skeleton&&(V.parent&&-1!==V.parent.index?r=this._loadBone(V.parent,O,Z,d):void 0!==O.skeleton&&Q.b.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const Y=O.joints.indexOf(V.index);return p=new R.e(V.name||`joint${V.index}`,Z,r,this._getNodeMatrix(V),null,null,Y),d[V.index]=p,this._postSceneLoadActions.push((()=>{p.linkTransformNode(V._babylonTransformNode)})),p}_loadSkinInverseBindMatricesDataAsync(V,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const Z=y.Get(`${V}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z)}_updateBoneMatrices(V,O){for(const Z of V.bones){const V=p.c.Identity(),d=Z._index;O&&-1!==d&&(p.c.FromArrayToRef(O,16*d,V),V.invertToRef(V));const r=Z.getParent();r&&V.multiplyToRef(r.getAbsoluteInverseBindMatrix(),V),Z.tj(V,!1,!1),Z._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(V){return V.matrix?p.c.Cg(V.matrix):p.c.Compose(V.scale?p.m.Cg(V.scale):p.m.One(),V.rotation?p.g.Cg(V.rotation):p.g.Identity(),V.translation?p.m.Cg(V.translation):p.m.Zero())}loadCameraAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadCameraAsync(V,O,Z);if(d)return d;const r=new Array;this.logOpen(`${V} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new a.c(O.name||`camera${O.index}`,p.m.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.ignoreParentScaling=!0,O._babylonCamera=Y,Y.rotation.set(0,Math.PI,0),O.type){case"perspective":{const Z=O.perspective;if(!Z)throw new Error(`${V}: Camera perspective properties are missing`);Y.fov=Z.yfov,Y.Ii=Z.znear,Y.maxZ=Z.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${V}: Camera orthographic properties are missing`);Y.mode=m.d.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-O.orthographic.xmag,Y.orthoRight=O.orthographic.xmag,Y.orthoBottom=-O.orthographic.ymag,Y.orthoTop=O.orthographic.ymag,Y.Ii=O.orthographic.znear,Y.maxZ=O.orthographic.zfar;break;default:throw new Error(`${V}: Invalid camera type (${O.type})`)}return T.AddPointerMetadata(Y,V),this._parent.onCameraLoadedObservable.notifyObservers(Y),Z(Y),this.logClose(),Promise.all(r).then((()=>Y))}_loadAnimationsAsync(){const V=this._gltf.animations;if(!V)return Promise.resolve();const O=new Array;for(let Z=0;Z<V.length;Z++){const d=V[Z];O.push(this.loadAnimationAsync(`/animations/${d.index}`,d).then((V=>{0===V.targetedAnimations.length&&V.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(V,O){const d=this._extensionsLoadAnimationAsync(V,O);return d||Z.e(38).then(Z.bind(Z,13399)).then((Z=>{let{AnimationGroup:d}=Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new d(O.name||`animation${O.index}`,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=p;const r=new Array;y.Assign(O.channels),y.Assign(O.samplers);for(const Y of O.channels)r.push(this._loadAnimationChannelAsync(`${V}/channels/${Y.index}`,V,O,Y,((V,O)=>{V.animations=V.animations||[],V.animations.push(O),p.addTargetedAnimation(O,V)})));return Promise.all(r).then((()=>(p.normalize(0),p)))}))}_loadAnimationChannelAsync(V,O,Z,d,p){const r=this._extensionsLoadAnimationChannelAsync(V,O,Z,d,p);if(r)return r;if(void 0==d.target.node)return Promise.resolve();const Y=y.Get(`${V}/target/node`,this._gltf.nodes,d.target.node),m=d.target.path,a="weights"===m;if(a&&!Y._numMorphTargets||!a&&!Y._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!a&&!Y._isJoint)return Promise.resolve();let R;switch(m){case"translation":R=f.translation;break;case"rotation":R=f.rotation;break;case"scale":R=f.scale;break;case"weights":R=f.weights;break;default:throw new Error(`${V}/target/path: Invalid value (${d.target.path})`)}const i={object:Y,info:R};return this._loadAnimationChannelFromTargetInfoAsync(V,O,Z,d,i,p)}_loadAnimationChannelFromTargetInfoAsync(V,O,Z,d,p,r){const Y=this.parent.targetFps,m=1/Y,a=y.Get(`${V}/sampler`,Z.samplers,d.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${d.sampler}`,a).then((V=>{let O=0;const a=p.object,R=p.info;for(const p of R){const R=p.getStride(a),i=V.input,M=V.output,c=new Array(i.length);let W=0;switch(V.interpolation){case"STEP":for(let V=0;V<i.length;V++){const O=p.getValue(a,M,W,1);W+=R,c[V]={frame:i[V]*Y,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let V=0;V<i.length;V++){const O=p.getValue(a,M,W,m);W+=R;const Z=p.getValue(a,M,W,1);W+=R;const d=p.getValue(a,M,W,m);W+=R,c[V]={frame:i[V]*Y,inTangent:O,value:Z,outTangent:d}}break;case"LINEAR":for(let V=0;V<i.length;V++){const O=p.getValue(a,M,W,1);W+=R,c[V]={frame:i[V]*Y,value:O}}}if(W>0){const V=`${Z.name||`animation${Z.index}`}_channel${d.index}_${O}`;p.buildAnimations(a,V,Y,c,((V,Z)=>{++O,r(V,Z)}))}}}))}_loadAnimationSamplerAsync(V,O){if(O._data)return O._data;const Z=O.interpolation||"LINEAR";switch(Z){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${V}/interpolation: Invalid value (${O.interpolation})`)}const d=y.Get(`${V}/input`,this._gltf.accessors,O.input),p=y.Get(`${V}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${d.index}`,d),this._loadFloatAccessorAsync(`/accessors/${p.index}`,p)]).then((V=>{let[O,d]=V;return{input:O,interpolation:Z,output:d}})),O._data}loadBufferAsync(V,O,Z,d){const p=this._extensionsLoadBufferAsync(V,O,Z,d);if(p)return p;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${V}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+Z,d)}catch(p){throw new Error(`${V}: ${p.message}`)}}))}loadBufferViewAsync(V,O){const Z=this._extensionsLoadBufferViewAsync(V,O);if(Z)return Z;if(O._data)return O._data;const d=y.Get(`${V}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${d.index}`,d,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(V,O,Z){if(O._data)return O._data;const d=T._GetNumComponents(V,O.type),p=d*I.e.GetTypeByteLength(O.componentType),r=d*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new Z(r));else{const Y=y.Get(`${V}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((m=>{if(5126!==O.componentType||O.normalized||Y.byteStride&&Y.byteStride!==p){const V=new Z(r);return I.e.ForEach(m,O.byteOffset||0,Y.byteStride||p,d,O.componentType,V.length,O.normalized||!1,((O,Z)=>{V[Z]=O})),V}return T._GetTypedArray(V,O.componentType,m,O.byteOffset,r)}))}if(O.sparse){const r=O.sparse;O._data=O._data.then((Y=>{const m=Y,a=y.Get(`${V}/sparse/indices/bufferView`,this._gltf.bufferViews,r.indices.bufferView),R=y.Get(`${V}/sparse/values/bufferView`,this._gltf.bufferViews,r.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${a.index}`,a),this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)]).then((Y=>{let[a,R]=Y;const i=T._GetTypedArray(`${V}/sparse/indices`,r.indices.componentType,a,r.indices.byteOffset,r.count),M=d*r.count;let c;if(5126!==O.componentType||O.normalized){const Y=T._GetTypedArray(`${V}/sparse/values`,O.componentType,R,r.values.byteOffset,M);c=new Z(M),I.e.ForEach(Y,0,p,d,O.componentType,c.length,O.normalized||!1,((V,O)=>{c[O]=V}))}else c=T._GetTypedArray(`${V}/sparse/values`,O.componentType,R,r.values.byteOffset,M);let W=0;for(let V=0;V<i.length;V++){let O=i[V]*d;for(let V=0;V<d;V++)m[O++]=c[W++]}return m}))}))}return O._data}_loadFloatAccessorAsync(V,O){return this._loadAccessorAsync(V,O,Float32Array)}_loadIndicesAccessorAsync(V,O){if("SCALAR"!==O.type)throw new Error(`${V}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${V}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const Z=T._GetTypedArrayConstructor(`${V}/componentType`,O.componentType);O._data=this._loadAccessorAsync(V,O,Z)}else{const Z=y.Get(`${V}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>T._GetTypedArray(V,O.componentType,Z,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(V){if(V._babylonBuffer)return V._babylonBuffer;const O=this._babylonScene.getEngine();return V._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>new I.c(O,V,!1))),V._babylonBuffer}_loadVertexAccessorAsync(V,O,Z){var d;if(null!==(d=O._babylonVertexBuffer)&&void 0!==d&&d[Z])return O._babylonVertexBuffer[Z];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const p=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[Z]=this._loadFloatAccessorAsync(V,O).then((V=>new I.e(p,V,Z,!1)));else{const d=y.Get(`${V}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[Z]=this._loadVertexBufferViewAsync(d).then((r=>{const Y=T._GetNumComponents(V,O.type);return new I.e(p,r,Z,!1,void 0,d.byteStride,void 0,O.byteOffset,Y,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[Z]}_loadMaterialMetallicRoughnessPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return O&&(O.baseColorFactor?(Z.albedoColor=r.b.Cg(O.baseColorFactor),Z.alpha=O.baseColorFactor[3]):Z.albedoColor=r.b.White(),Z.metallic=void 0==O.metallicFactor?1:O.metallicFactor,Z.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&d.push(this.loadTextureInfoAsync(`${V}/baseColorTexture`,O.baseColorTexture,(V=>{V.name=`${Z.name} (Base Color)`,Z.albedoTexture=V}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${V}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(V=>{V.name=`${Z.name} (Metallic Roughness)`,Z.metallicTexture=V}))),Z.useMetallnessFromMetallicTextureBlue=!0,Z.useRoughnessFromMetallicTextureGreen=!0,Z.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(d).then((()=>{}))}_loadMaterialAsync(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const r=this._extensionsLoadMaterialAsync(V,O,Z,d,p);if(r)return r;O._data=O._data||{};let Y=O._data[d];if(!Y){this.logOpen(`${V} ${O.name||""}`);const Z=this.createMaterial(V,O,d);Y={babylonMaterial:Z,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(V,O,Z)},O._data[d]=Y,T.AddPointerMetadata(Z,V),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this.logClose()}return Z&&(Y.babylonMeshes.push(Z),Z.Xi.addOnce((()=>{const V=Y.babylonMeshes.indexOf(Z);-1!==V&&Y.babylonMeshes.splice(V,1)}))),p(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(V,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new v(V,this._babylonScene);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.fillMode=O,Z.enableSpecularAntiAliasing=!0,Z.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Z.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Z.transparencyMode=v.PBRMATERIAL_OPAQUE,Z.metallic=1,Z.roughness=1,Z}createMaterial(V,O,Z){const d=this._extensionsCreateMaterial(V,O,Z);if(d)return d;const p=O.name||`material${O.index}`;return this._createDefaultMaterial(p,Z)}loadMaterialPropertiesAsync(V,O,Z){const d=this._extensionsLoadMaterialPropertiesAsync(V,O,Z);if(d)return d;const p=new Array;return p.push(this.loadMaterialBasePropertiesAsync(V,O,Z)),O.pbrMetallicRoughness&&p.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${V}/pbrMetallicRoughness`,O.pbrMetallicRoughness,Z)),this.loadMaterialAlphaProperties(V,O,Z),Promise.all(p).then((()=>{}))}loadMaterialBasePropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.emissiveColor=O.emissiveFactor?r.b.Cg(O.emissiveFactor):new r.b(0,0,0),O.doubleSided&&(Z.Jg=!1,Z.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${V}/normalTexture`,O.normalTexture,(V=>{V.name=`${Z.name} (Normal)`,Z.bumpTexture=V}))),Z.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Z.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&Z.bumpTexture&&(Z.bumpTexture.level=O.normalTexture.scale),Z.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${V}/occlusionTexture`,O.occlusionTexture,(V=>{V.name=`${Z.name} (Occlusion)`,Z.ambientTexture=V}))),Z.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(Z.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&d.push(this.loadTextureInfoAsync(`${V}/emissiveTexture`,O.emissiveTexture,(V=>{V.name=`${Z.name} (Emissive)`,Z.emissiveTexture=V}))),Promise.all(d).then((()=>{}))}loadMaterialAlphaProperties(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":Z.transparencyMode=v.PBRMATERIAL_OPAQUE,Z.alpha=1;break;case"MASK":Z.transparencyMode=v.PBRMATERIAL_ALPHATEST,Z.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,Z.albedoTexture&&(Z.albedoTexture.uc=!0);break;case"BLEND":Z.transparencyMode=v.PBRMATERIAL_ALPHABLEND,Z.albedoTexture&&(Z.albedoTexture.uc=!0,Z.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${V}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureInfoAsync(V,O,Z);if(d)return d;if(this.logOpen(`${V}`),O.texCoord>=6)throw new Error(`${V}/texCoord: Invalid value (${O.texCoord})`);const p=y.Get(`${V}/index`,this._gltf.textures,O.index);p._textureInfo=O;const r=this._loadTextureAsync(`/textures/${O.index}`,p,(d=>{d.coordinatesIndex=O.texCoord||0,T.AddPointerMetadata(d,V),this._parent.onTextureLoadedObservable.notifyObservers(d),Z(d)}));return this.logClose(),r}_loadTextureAsync(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureAsync(V,O,Z);if(d)return d;this.logOpen(`${V} ${O.name||""}`);const p=void 0==O.sampler?T.DefaultSampler:y.Get(`${V}/sampler`,this._gltf.samplers,O.sampler),r=y.Get(`${V}/source`,this._gltf.images,O.source),Y=this._createTextureAsync(V,p,r,Z,void 0,!O._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(V,O,Z){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const m=this._loadSampler(`/samplers/${O.index}`,O),a=new Array,R=new d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i={noMipmap:m.noMipMaps,invertY:!1,samplingMode:m.samplingMode,X:()=>{this._disposed||R.resolve()},onError:(O,Z)=>{this._disposed||R.reject(new Error(`${V}: ${Z&&Z.message?Z.message:O||"Failed to load texture"}`))},mimeType:Z.mimeType,loaderOptions:r,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},M=new A.b(null,this._babylonScene,i);return M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.push(R.promise),a.push(this.loadImageAsync(`/images/${Z.index}`,Z).then((V=>{const O=Z.uri||`${this._fileName}#image${Z.index}`,d=`data:${this._uniqueRootUrl}${O}`;M.updateURL(d,V);const p=M.getInternalTexture();p&&(p.label=Z.name)}))),M.wrapU=m.wrapU,M.wrapV=m.wrapV,p(M),this._parent.useGltfTextureNames&&(M.name=Z.name||Z.uri||`image${Z.index}`),Promise.all(a).then((()=>M))}_loadSampler(V,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:T._GetTextureSamplingMode(V,O),wrapU:T._GetTextureWrapMode(`${V}/wrapS`,O.wrapS),wrapV:T._GetTextureWrapMode(`${V}/wrapT`,O.wrapT)}),O._data}loadImageAsync(V,O){if(!O._data){if(this.logOpen(`${V} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${V}/uri`,O,O.uri);else{const Z=y.Get(`${V}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}this.logClose()}return O._data}loadUriAsync(V,O,Z){const d=this._extensionsLoadUriAsync(V,O,Z);if(d)return d;if(!T._ValidateUri(Z))throw new Error(`${V}: '${Z}' is invalid`);if((0,E.j)(Z)){const O=new Uint8Array((0,E.b)(Z));return this.log(`${V}: Decoded ${Z.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${V}: Loading ${Z}`),this._parent.preprocessUrlAsync(this._rootUrl+Z).then((O=>new Promise(((d,p)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${V}: Loaded ${Z} (${O.byteLength} bytes)`),d(new Uint8Array(O)))}),!0,(O=>{p(new E.n(`${V}: Failed to load '${Z}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(V,O){V.metadata=V.metadata||{};const Z=V._internalMetadata=V._internalMetadata||{},d=Z.Ai=Z.Ai||{};(d.pointers=d.pointers||[]).push(O)}static _GetTextureWrapMode(V,O){switch(O=void 0==O?10497:O){case 33071:return A.b.CLAMP_ADDRESSMODE;case 33648:return A.b.MIRROR_ADDRESSMODE;case 10497:return A.b.WRAP_ADDRESSMODE;default:return Q.b.Warn(`${V}: Invalid value (${O})`),A.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(V,O){const Z=void 0==O.magFilter?9729:O.magFilter,d=void 0==O.minFilter?9987:O.minFilter;if(9729===Z)switch(d){case 9728:return A.b.LINEAR_NEAREST;case 9729:return A.b.LINEAR_LINEAR;case 9984:return A.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return A.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return A.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return A.b.LINEAR_LINEAR_MIPLINEAR;default:return Q.b.Warn(`${V}/minFilter: Invalid value (${d})`),A.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Z&&Q.b.Warn(`${V}/magFilter: Invalid value (${Z})`),d){case 9728:return A.b.NEAREST_NEAREST;case 9729:return A.b.NEAREST_LINEAR;case 9984:return A.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return A.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return A.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return A.b.NEAREST_LINEAR_MIPLINEAR;default:return Q.b.Warn(`${V}/minFilter: Invalid value (${d})`),A.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(V,O){switch(O){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${V}: Invalid component type ${O}`)}}static _GetTypedArray(V,O,Z,d,p){const r=Z.buffer;d=Z.byteOffset+(d||0);const Y=T._GetTypedArrayConstructor(`${V}/componentType`,O),m=I.e.GetTypeByteLength(O);return d%m!==0?(Q.b.Warn(`${V}: Copying buffer as byte offset (${d}) is not a multiple of component type byte length (${m})`),new Y(r.slice(d,d+p*m),0)):new Y(r,d,p)}static _GetNumComponents(V,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${V}: Invalid type (${O})`)}static _ValidateUri(V){return Y.e.IsBase64(V)||-1===V.indexOf("..")}static _GetDrawMode(V,O){switch(void 0==O&&(O=4),O){case 0:return H.e.PointListDrawMode;case 1:return H.e.LineListDrawMode;case 2:return H.e.LineLoopDrawMode;case 3:return H.e.LineStripDrawMode;case 4:return H.e.TriangleFillMode;case 5:return H.e.TriangleStripDrawMode;case 6:return H.e.TriangleFanDrawMode}throw new Error(`${V}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const V=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const Z in O._data){const d=O._data[Z];for(const O of d.babylonMeshes){O.Cj(!0);const Z=d.babylonMaterial;V.push(Z.forceCompilationAsync(O)),V.push(Z.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(V.push(Z.forceCompilationAsync(O,{clipPlane:!0})),V.push(Z.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const V=new Array,O=this._babylonScene.lights;for(const Z of O){const O=Z.getShadowGenerator();O&&V.push(O.forceCompilationAsync())}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(V){for(const O of this._extensions)O.enabled&&V(O)}_applyExtensions(V,O,Z){for(const d of this._extensions)if(d.enabled){const p=`${d.name}.${O}`,r=V;r._activeLoaderExtensionFunctions=r._activeLoaderExtensionFunctions||{};const Y=r._activeLoaderExtensionFunctions;if(!Y[p]){Y[p]=!0;try{const V=Z(d);if(V)return V}finally{delete Y[p]}}}return null}_extensionsOnLoading(){this._forEachExtensions((V=>V.onLoading&&V.onLoading()))}_extensionsOnReady(){this._forEachExtensions((V=>V.onReady&&V.onReady()))}_extensionsLoadSceneAsync(V,O){return this._applyExtensions(O,"loadScene",(Z=>Z.loadSceneAsync&&Z.loadSceneAsync(V,O)))}_extensionsLoadNodeAsync(V,O,Z){return this._applyExtensions(O,"loadNode",(d=>d.loadNodeAsync&&d.loadNodeAsync(V,O,Z)))}_extensionsLoadCameraAsync(V,O,Z){return this._applyExtensions(O,"loadCamera",(d=>d.loadCameraAsync&&d.loadCameraAsync(V,O,Z)))}_extensionsLoadVertexDataAsync(V,O,Z){return this._applyExtensions(O,"loadVertexData",(d=>d._loadVertexDataAsync&&d._loadVertexDataAsync(V,O,Z)))}_extensionsLoadMeshPrimitiveAsync(V,O,Z,d,p,r){return this._applyExtensions(p,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(V,O,Z,d,p,r)))}_extensionsLoadMaterialAsync(V,O,Z,d,p){return this._applyExtensions(O,"loadMaterial",(r=>r._loadMaterialAsync&&r._loadMaterialAsync(V,O,Z,d,p)))}_extensionsCreateMaterial(V,O,Z){return this._applyExtensions(O,"createMaterial",(d=>d.createMaterial&&d.createMaterial(V,O,Z)))}_extensionsLoadMaterialPropertiesAsync(V,O,Z){return this._applyExtensions(O,"loadMaterialProperties",(d=>d.loadMaterialPropertiesAsync&&d.loadMaterialPropertiesAsync(V,O,Z)))}_extensionsLoadTextureInfoAsync(V,O,Z){return this._applyExtensions(O,"loadTextureInfo",(d=>d.loadTextureInfoAsync&&d.loadTextureInfoAsync(V,O,Z)))}_extensionsLoadTextureAsync(V,O,Z){return this._applyExtensions(O,"loadTexture",(d=>d._loadTextureAsync&&d._loadTextureAsync(V,O,Z)))}_extensionsLoadAnimationAsync(V,O){return this._applyExtensions(O,"loadAnimation",(Z=>Z.loadAnimationAsync&&Z.loadAnimationAsync(V,O)))}_extensionsLoadAnimationChannelAsync(V,O,Z,d,p){return this._applyExtensions(Z,"loadAnimationChannel",(r=>r._loadAnimationChannelAsync&&r._loadAnimationChannelAsync(V,O,Z,d,p)))}_extensionsLoadSkinAsync(V,O,Z){return this._applyExtensions(Z,"loadSkin",(d=>d._loadSkinAsync&&d._loadSkinAsync(V,O,Z)))}_extensionsLoadUriAsync(V,O,Z){return this._applyExtensions(O,"loadUri",(d=>d._loadUriAsync&&d._loadUriAsync(V,O,Z)))}_extensionsLoadBufferViewAsync(V,O){return this._applyExtensions(O,"loadBufferView",(Z=>Z.loadBufferViewAsync&&Z.loadBufferViewAsync(V,O)))}_extensionsLoadBufferAsync(V,O,Z,d){return this._applyExtensions(O,"loadBuffer",(p=>p.loadBufferAsync&&p.loadBufferAsync(V,O,Z,d)))}static LoadExtensionAsync(V,O,Z,d){if(!O.extensions)return null;const p=O.extensions[Z];return p?d(`${V}/extensions/${Z}`,p):null}static LoadExtraAsync(V,O,Z,d){if(!O.extras)return null;const p=O.extras[Z];return p?d(`${V}/extras/${Z}`,p):null}isExtensionUsed(V){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(V)}logOpen(V){this._parent._logOpen(V)}logClose(){this._parent._logClose()}log(V){this._parent._log(V)}startPerformanceCounter(V){this._parent._startPerformanceCounter(V)}endPerformanceCounter(V){this._parent._endPerformanceCounter(V)}}T.DefaultSampler={index:-1},o.d._CreateGLTF2Loader=V=>new T(V);var B=Z(11713),j=Z(12200),VV=Z(12215);class OV extends VV.e{constructor(V,O,Z){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",V),this._texture=V.getEngine().createRawCubeTexture(O,Z,d,p,r,Y,m,a)}update(V,O,Z,d){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,V,O,Z,d,p)}updateRGBDAsync(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,j.k)(this._texture,V,O,Z,d).then((()=>{}))}clone(){return C.b.Clone((()=>{const V=this.va(),O=this._texture,Z=new OV(V,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&Z.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),Z}),this)}}const ZV="EXT_lights_image_based";class dV{constructor(V){this.name=ZV,this._loader=V,this.enabled=this._loader.isExtensionUsed(ZV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.Ai.extensions;if(V&&V[this.name]){const O=V[this.name];this._lights=O.lights}}loadSceneAsync(V,O){return T.LoadExtensionAsync(V,O,this.name,((Z,d)=>{this._loader._allMaterialsDirtyRequired=!0;const p=new Array;p.push(this._loader.loadSceneAsync(V,O)),this._loader.logOpen(`${Z}`);const r=y.Get(`${Z}/light`,this._lights,d.hb);return p.push(this._loadLightAsync(`/extensions/${this.name}/lights/${d.hb}`,r).then((V=>{this._loader.babylonScene.environmentTexture=V}))),this._loader.logClose(),Promise.all(p).then((()=>{}))}))}_loadLightAsync(V,O){if(!O._loaded){const Z=new Array;this._loader.logOpen(`${V}`);const d=new Array(O.specularImages.length);for(let p=0;p<O.specularImages.length;p++){const r=O.specularImages[p];d[p]=new Array(r.length);for(let O=0;O<r.length;O++){const Y=`${V}/specularImages/${p}/${O}`;this._loader.logOpen(`${Y}`);const m=r[O],a=y.Get(Y,this._loader.Ai.images,m);Z.push(this._loader.loadImageAsync(`/images/${m}`,a).then((V=>{d[p][O]=V}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(Z).then((()=>{const Z=new OV(this._loader.babylonScene,null,O.specularImageSize);if(Z.name=O.name||"environment",O._babylonTexture=Z,void 0!=O.Mi&&(Z.level=O.Mi),O.rotation){let V=p.g.Cg(O.rotation);this._loader.babylonScene.useRightHandedSystem||(V=p.g.Inverse(V)),p.c.FromQuaternionToRef(V,Z.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${V}: Irradiance coefficients are missing`);const r=B.c.Cg(O.irradianceCoefficients);r.scaleInPlace(O.Mi),r.convertIrradianceToLambertianRadiance();const Y=B.g.FromHarmonics(r),m=(d.length-1)/Math.log2(O.specularImageSize);return Z.updateRGBDAsync(d,Y,m)}))}return O._loaded.then((()=>O._babylonTexture))}}h(ZV),s(ZV,!0,(V=>new dV(V)));Z(12218);const pV="EXT_mesh_gpu_instancing";class rV{constructor(V){this.name=pV,this._loader=V,this.enabled=this._loader.isExtensionUsed(pV)}dispose(){this._loader=null}loadNodeAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((V,d)=>{this._loader._disableInstancedMesh++;const r=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,Z);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return r;const Y=new Array;let m=0;const a=O=>{if(void 0==d.attributes[O])return void Y.push(Promise.resolve(null));const Z=y.Get(`${V}/attributes/${O}`,this._loader.Ai.accessors,d.attributes[O]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${Z.bufferView}`,Z)),0===m)m=Z.count;else if(m!==Z.count)throw new Error(`${V}/attributes: Instance buffer accessors do not have the same count.`)};return a("TRANSLATION"),a("ROTATION"),a("SCALE"),r.then((V=>Promise.all(Y).then((Z=>{let[d,r,Y]=Z;const a=new Float32Array(16*m);p.i.ib[0].nf(0,0,0),p.i.Quaternion[0].nf(0,0,0,1),p.i.ib[1].nf(1,1,1);for(let V=0;V<m;++V)d&&p.m.FromArrayToRef(d,3*V,p.i.ib[0]),r&&p.g.FromArrayToRef(r,4*V,p.i.Quaternion[0]),Y&&p.m.FromArrayToRef(Y,3*V,p.i.ib[1]),p.c.ComposeToRef(p.i.ib[1],p.i.Quaternion[0],p.i.ib[0],p.i.Matrix[0]),p.i.Matrix[0].copyToArray(a,16*V);for(const V of O._primitiveBabylonMeshes)V.Gj("matrix",a,16,!0);return V}))))}))}}h(pV),s(pV,!0,(V=>new rV(V)));class YV{static get Default(){return YV._Default||(YV._Default=new YV),YV._Default}constructor(){const V=YV.Configuration.decoder;this._decoderModulePromise=Y.e.LoadBabylonScriptAsync(V.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(V,O,Z,d,p){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const r=await MeshoptDecoder.decodeGltfBufferAsync(O,Z,V,d,p);return MeshoptDecoder.useWorkers(0),r}))}}YV.Configuration={decoder:{url:`${Y.e._DefaultCdnUrl}/meshopt_decoder.js`}},YV._Default=null;const mV="EXT_meshopt_compression";class aV{constructor(V){this.name=mV,this.enabled=V.isExtensionUsed(mV),this._loader=V}dispose(){this._loader=null}loadBufferViewAsync(V,O){return T.LoadExtensionAsync(V,O,this.name,((Z,d)=>{const p=O;if(p._meshOptData)return p._meshOptData;const r=y.Get(`${V}/buffer`,this._loader.Ai.buffers,d.buffer);return p._meshOptData=this._loader.loadBufferAsync(`/buffers/${r.index}`,r,d.byteOffset||0,d.byteLength).then((V=>YV.Default.decodeGltfBufferAsync(V,d.count,d.byteStride,d.mode,d.filter))),p._meshOptData}))}}h(mV),s(mV,!0,(V=>new aV(V)));const RV="EXT_texture_webp";class iV{constructor(V){this.name=RV,this._loader=V,this.enabled=V.isExtensionUsed(RV)}dispose(){this._loader=null}_loadTextureAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=void 0==O.sampler?T.DefaultSampler:y.Get(`${V}/sampler`,this._loader.Ai.samplers,O.sampler),Y=y.Get(`${d}/source`,this._loader.Ai.images,p.source);return this._loader._createTextureAsync(V,r,Y,(V=>{Z(V)}),void 0,!O._textureInfo.nonColorData)}))}}h(RV),s(RV,!0,(V=>new iV(V)));const MV="EXT_texture_avif";class cV{constructor(V){this.name=MV,this._loader=V,this.enabled=V.isExtensionUsed(MV)}dispose(){this._loader=null}_loadTextureAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=void 0==O.sampler?T.DefaultSampler:y.Get(`${V}/sampler`,this._loader.Ai.samplers,O.sampler),Y=y.Get(`${d}/source`,this._loader.Ai.images,p.source);return this._loader._createTextureAsync(V,r,Y,(V=>{Z(V)}),void 0,!O._textureInfo.nonColorData)}))}}h(MV),s(MV,!0,(V=>new cV(V)));var WV=Z(12224);const FV="KHR_draco_mesh_compression";class QV{constructor(V){this.name=FV,this.useNormalizedFlagFromAccessor=!0,this._loader=V,this.enabled=WV.b.DecoderAvailable&&this._loader.isExtensionUsed(FV)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${V}: Unsupported mode ${O.mode}`);const r={},Y={},m=(V,d)=>{const m=p.attributes[V];if(void 0!=m&&(Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(d)&&Z._delayInfo.push(d),r[d]=m,this.useNormalizedFlagFromAccessor)){const Z=y.TryGet(this._loader.Ai.accessors,O.attributes[V]);Z&&(Y[d]=Z.normalized||!1)}};m("POSITION",I.e.PositionKind),m("NORMAL",I.e.NormalKind),m("TANGENT",I.e.TangentKind),m("TEXCOORD_0",I.e.UVKind),m("TEXCOORD_1",I.e.UV2Kind),m("TEXCOORD_2",I.e.UV3Kind),m("TEXCOORD_3",I.e.UV4Kind),m("TEXCOORD_4",I.e.UV5Kind),m("TEXCOORD_5",I.e.UV6Kind),m("JOINTS_0",I.e.MatricesIndicesKind),m("WEIGHTS_0",I.e.MatricesWeightsKind),m("COLOR_0",I.e.ColorKind);const a=y.Get(d,this._loader.Ai.bufferViews,p.bufferView);return a._dracoBabylonGeometry||(a._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((O=>(this.dracoCompression||WV.b.Default)._decodeMeshToGeometryForGltfAsync(Z.name,this._loader.babylonScene,O,r,Y).catch((O=>{throw new Error(`${V}: ${O.message}`)}))))),a._dracoBabylonGeometry}))}}h(FV),s(FV,!0,(V=>new QV(V)));var bV=Z(12236),UV=Z(11521),HV=Z(12193),SV=Z(12245);UV.e.AddNodeConstructor("Light_Type_0",((V,O)=>()=>new zV(V,p.m.Zero(),O)));class zV extends SV.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(V){this._shadowAngle=V,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(V){const O=this.needCube();if(this._direction=V,this.needCube()!==O&&this._shadowGenerators){const V=this._shadowGenerators.values();for(let O=V.next();!0!==O.done;O=V.next()){O.value.recreateShadowMap()}}}constructor(V,O,Z){super(V,Z),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return HV.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(V){if(this.direction)return super.getShadowDirection(V);switch(V){case 0:return new p.m(1,0,0);case 1:return new p.m(-1,0,0);case 2:return new p.m(0,-1,0);case 3:return new p.m(0,1,0);case 4:return new p.m(0,0,1);case 5:return new p.m(0,0,-1)}return p.m.Zero()}_setDefaultShadowProjectionMatrix(V,O,Z){const d=this.va().activeCamera;if(!d)return;const r=void 0!==this.shadowMinZ?this.shadowMinZ:d.Ii,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,m=this.va().getEngine().useReverseDepthBuffer;p.c.PerspectiveFovLHToRef(this.shadowAngle,1,m?Y:r,m?r:Y,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,m)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(V,O){return this.computeTransformedInformation()?V.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):V.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(V,O){V["POINTLIGHT"+O]=!0}}(0,S.c)([(0,z.K)()],zV.prototype,"shadowAngle",null),(0,t.f)("BABYLON.PointLight",zV),UV.e.AddNodeConstructor("Light_Type_2",((V,O)=>()=>new GV(V,p.m.Zero(),p.m.Zero(),0,0,O)));class GV extends SV.c{get angle(){return this._angle}set angle(V){this._angle=V,this._cosHalfAngle=Math.cos(.5*V),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(V){this._innerAngle=V,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(V){this._shadowAngleScale=V,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(V){this._projectionTextureLightNear=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(V){this._projectionTextureLightFar=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(V){this._projectionTextureUpDirection=V,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(V){this._projectionTexture!==V&&(this._projectionTexture=V,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(GV._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):GV._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(V){return void 0!==V.onGeneratedObservable}static _IsTexture(V){return void 0!==V.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(V){this._projectionTextureProjectionLightMatrix=V,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(V,O,Z,d,r,Y){super(V,Y),this._innerAngle=0,this._projectionTextureMatrix=p.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=p.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=p.m.Zero(),this._projectionTextureViewLightMatrix=p.c.Zero(),this._projectionTextureProjectionLightMatrix=p.c.Zero(),this._projectionTextureScalingMatrix=p.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=Z,this.angle=d,this.exponent=r}getClassName(){return"SpotLight"}getTypeID(){return HV.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(V){super._setDirection(V),this._projectionTextureViewLightDirty=!0}_setPosition(V){super._setPosition(V),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(V,O,Z){const d=this.va().activeCamera;if(!d)return;this._shadowAngleScale=this._shadowAngleScale||1;const r=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:d.Ii,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,a=this.va().getEngine().useReverseDepthBuffer;p.c.PerspectiveFovLHToRef(r,1,a?m:Y,a?Y:m,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),p.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const V=this.projectionTextureLightFar,O=this.projectionTextureLightNear,Z=V/(V-O),d=-Z*O,r=1/Math.tan(this._angle/2);p.c.FromValuesToRef(r/1,0,0,0,0,r,0,0,0,0,Z,1,0,0,d,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof A.b){const V=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;p.c.FromValuesToRef(V,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(V,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),V.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),V.setTexture("projectionLightTexture"+O,this.projectionTexture)),this}transferToEffect(V,O){let Z;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),Z=p.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),Z=p.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Z.x,Z.y,Z.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(V,O){let Z;return Z=this.computeTransformedInformation()?p.m.Normalize(this.transformedDirection):p.m.Normalize(this.direction),this.va().useRightHandedSystem?V.setFloat3(O,-Z.x,-Z.y,-Z.z):V.setFloat3(O,Z.x,Z.y,Z.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(V){const O=this._scene.getEngine(),Z=void 0!==this.shadowMinZ?this.shadowMinZ:V.Ii;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?Z:this._scene.getEngine().isNDCHalfZRange?0:Z}getDepthMaxZ(V){const O=this._scene.getEngine(),Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:Z}prepareLightSpecificDefines(V,O){V["SPOTLIGHT"+O]=!0,V["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,S.c)([(0,z.K)()],GV.prototype,"angle",null),(0,S.c)([(0,z.K)()],GV.prototype,"innerAngle",null),(0,S.c)([(0,z.K)()],GV.prototype,"shadowAngleScale",null),(0,S.c)([(0,z.K)()],GV.prototype,"exponent",void 0),(0,S.c)([(0,z.K)()],GV.prototype,"projectionTextureLightNear",null),(0,S.c)([(0,z.K)()],GV.prototype,"projectionTextureLightFar",null),(0,S.c)([(0,z.K)()],GV.prototype,"projectionTextureUpDirection",null),(0,S.c)([(0,z.A)("projectedLightTexture")],GV.prototype,"_projectionTexture",void 0),(0,t.f)("BABYLON.SpotLight",GV);const wV="KHR_lights_punctual";class tV{constructor(V){this.name=wV,this._loader=V,this.enabled=this._loader.isExtensionUsed(wV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.Ai.extensions;if(V&&V[this.name]){const O=V[this.name];this._lights=O.lights,y.Assign(this._lights)}}loadNodeAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,Y)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(V,O,(V=>{let O;const m=y.Get(d,this._lights,Y.hb),a=m.name||V.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,m.type){case"directional":{const V=new bV.c(a,p.m.Backward(),this._loader.babylonScene);V.position.rj(0),O=V;break}case"point":O=new zV(a,p.m.Zero(),this._loader.babylonScene);break;case"spot":{const V=new GV(a,p.m.Zero(),p.m.Backward(),0,1,this._loader.babylonScene);V.angle=2*(m.spot&&m.spot.outerConeAngle||Math.PI/4),V.innerAngle=2*(m.spot&&m.spot.innerConeAngle||0),O=V;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${d}: Invalid light type (${m.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,m._babylonLight=O,O.falloffType=HV.d.FALLOFF_GLTF,O._g=m.color?r.b.Cg(m.color):r.b.White(),O.Mi=void 0==m.Mi?1:m.Mi,O.range=void 0==m.range?Number.MAX_VALUE:m.range,O.parent=V,this._loader._babylonLights.push(O),T.AddPointerMetadata(O,d),Z(V)})))))}}h(wV),s(wV,!0,(V=>new tV(V)));const CV="KHR_materials_pbrSpecularGlossiness";class vV{constructor(V){this.name=CV,this.order=200,this._loader=V,this.enabled=this._loader.isExtensionUsed(CV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialBasePropertiesAsync(V,O,Z)),r.push(this._loadSpecularGlossinessPropertiesAsync(d,p,Z)),this._loader.loadMaterialAlphaProperties(V,O,Z),Promise.all(r).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.metallic=null,Z.roughness=null,O.diffuseFactor?(Z.albedoColor=r.b.Cg(O.diffuseFactor),Z.alpha=O.diffuseFactor[3]):Z.albedoColor=r.b.White(),Z.reflectivityColor=O.specularFactor?r.b.Cg(O.specularFactor):r.b.White(),Z.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTexture`,O.diffuseTexture,(V=>{V.name=`${Z.name} (Diffuse)`,Z.albedoTexture=V}))),O.specularGlossinessTexture&&(d.push(this._loader.loadTextureInfoAsync(`${V}/specularGlossinessTexture`,O.specularGlossinessTexture,(V=>{V.name=`${Z.name} (Specular Glossiness)`,Z.reflectivityTexture=V,Z.reflectivityTexture.uc=!0}))),Z.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(d).then((()=>{}))}}h(CV),s(CV,!0,(V=>new vV(V)));const AV="KHR_materials_unlit";class lV{constructor(V){this.name=AV,this.order=210,this._loader=V,this.enabled=this._loader.isExtensionUsed(AV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,(()=>this._loadUnlitPropertiesAsync(V,O,Z)))}_loadUnlitPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;Z.unlit=!0;const p=O.pbrMetallicRoughness;return p&&(p.baseColorFactor?(Z.albedoColor=r.b.Cg(p.baseColorFactor),Z.alpha=p.baseColorFactor[3]):Z.albedoColor=r.b.White(),p.baseColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/baseColorTexture`,p.baseColorTexture,(V=>{V.name=`${Z.name} (Base Color)`,Z.albedoTexture=V})))),O.doubleSided&&(Z.Jg=!1,Z.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(V,O,Z),Promise.all(d).then((()=>{}))}}h(AV),s(AV,!0,(V=>new lV(V)));const IV="KHR_materials_clearcoat";class gV{constructor(V){this.name=IV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(IV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadClearCoatPropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadClearCoatPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.clearCoat.isEnabled=!0,Z.clearCoat.useRoughnessFromMainTexture=!1,Z.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?Z.clearCoat.Mi=O.clearcoatFactor:Z.clearCoat.Mi=0,O.clearcoatTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatTexture`,O.clearcoatTexture,(V=>{V.name=`${Z.name} (ClearCoat)`,Z.clearCoat.texture=V}))),void 0!=O.clearcoatRoughnessFactor?Z.clearCoat.roughness=O.clearcoatRoughnessFactor:Z.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(V=>{V.name=`${Z.name} (ClearCoat Roughness)`,Z.clearCoat.textureRoughness=V})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(V=>{V.name=`${Z.name} (ClearCoat Normal)`,Z.clearCoat.bumpTexture=V}))),Z.invertNormalMapX=!Z.va().useRightHandedSystem,Z.invertNormalMapY=Z.va().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(Z.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(d).then((()=>{}))}}h(IV),s(IV,!0,(V=>new gV(V)));const nV="KHR_materials_iridescence";class eV{constructor(V){this.name=nV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(nV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadIridescencePropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.iridescence.isEnabled=!0,Z.iridescence.Mi=O.iridescenceFactor??0,Z.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,Z.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,Z.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceTexture`,O.iridescenceTexture,(V=>{V.name=`${Z.name} (Iridescence)`,Z.iridescence.texture=V}))),O.iridescenceThicknessTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(V=>{V.name=`${Z.name} (Iridescence Thickness)`,Z.iridescence.thicknessTexture=V}))),Promise.all(d).then((()=>{}))}}h(nV),s(nV,!0,(V=>new eV(V)));const uV="KHR_materials_anisotropy";class kV{constructor(V){this.name=uV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(uV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadIridescencePropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.anisotropy.isEnabled=!0,Z.anisotropy.Mi=O.anisotropyStrength??0,Z.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${V}/anisotropyTexture`,O.anisotropyTexture,(V=>{V.name=`${Z.name} (Anisotropy Intensity)`,Z.anisotropy.texture=V})))),Promise.all(d).then((()=>{}))}}h(uV),s(uV,!0,(V=>new kV(V)));const DV="KHR_materials_emissive_strength";class XV{constructor(V){this.name=DV,this.order=170,this._loader=V,this.enabled=this._loader.isExtensionUsed(DV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>this._loader.loadMaterialPropertiesAsync(V,O,Z).then((()=>{this._loadEmissiveProperties(d,p,Z)}))))}_loadEmissiveProperties(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);void 0!==O.emissiveStrength&&(Z.emissiveIntensity=O.emissiveStrength)}}h(DV),s(DV,!0,(V=>new XV(V)));const oV="KHR_materials_sheen";class EV{constructor(V){this.name=oV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(oV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadSheenPropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadSheenPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return Z.sheen.isEnabled=!0,Z.sheen.Mi=1,void 0!=O.sheenColorFactor?Z.sheen.color=r.b.Cg(O.sheenColorFactor):Z.sheen.color=r.b.Black(),O.sheenColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/sheenColorTexture`,O.sheenColorTexture,(V=>{V.name=`${Z.name} (Sheen Color)`,Z.sheen.texture=V}))),void 0!==O.sheenRoughnessFactor?Z.sheen.roughness=O.sheenRoughnessFactor:Z.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${V}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(V=>{V.name=`${Z.name} (Sheen Roughness)`,Z.sheen.textureRoughness=V})))),Z.sheen.albedoScaling=!0,Z.sheen.useRoughnessFromMainTexture=!1,Promise.all(d).then((()=>{}))}}h(oV),s(oV,!0,(V=>new EV(V)));const LV="KHR_materials_specular";class JV{constructor(V){this.name=LV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(LV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadSpecularPropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadSpecularPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const d=new Array;return void 0!==O.specularFactor&&(Z.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(Z.metallicReflectanceColor=r.b.Cg(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${V}/specularTexture`,O.specularTexture,(V=>{V.name=`${Z.name} (Specular)`,Z.metallicReflectanceTexture=V,Z.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${V}/specularColorTexture`,O.specularColorTexture,(V=>{V.name=`${Z.name} (Specular Color)`,Z.reflectanceTexture=V}))),Promise.all(d).then((()=>{}))}}h(LV),s(LV,!0,(V=>new JV(V)));const NV="KHR_materials_ior";class PV{constructor(V){this.name=NV,this.order=180,this._loader=V,this.enabled=this._loader.isExtensionUsed(NV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadIorPropertiesAsync(d,p,Z)),Promise.all(r).then((()=>{}))}))}_loadIorPropertiesAsync(V,O,Z){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);return void 0!==O.ior?Z.indexOfRefraction=O.ior:Z.indexOfRefraction=PV._DEFAULT_IOR,Promise.resolve()}}PV._DEFAULT_IOR=1.5,h(NV),s(NV,!0,(V=>new PV(V)));const fV="KHR_materials_variants";class qV{constructor(V){this.name=fV,this._loader=V,this.enabled=this._loader.isExtensionUsed(fV)}dispose(){this._loader=null}static GetAvailableVariants(V){const O=this._GetExtensionMetadata(V);return O?Object.keys(O.variants):[]}getAvailableVariants(V){return qV.GetAvailableVariants(V)}static SelectVariant(V,O){const Z=this._GetExtensionMetadata(V);if(!Z)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${fV} extension`);const d=V=>{const O=Z.variants[V];if(O)for(const Z of O)Z.mesh.material=Z.material};if(O instanceof Array)for(const p of O)d(p);else d(O);Z.lastSelected=O}selectVariant(V,O){qV.SelectVariant(V,O)}static Reset(V){const O=this._GetExtensionMetadata(V);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${fV} extension`);for(const Z of O.original)Z.mesh.material=Z.material;O.lastSelected=null}reset(V){qV.Reset(V)}static GetLastSelectedVariant(V){const O=this._GetExtensionMetadata(V);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${fV} extension`);return O.lastSelected}getLastSelectedVariant(V){return qV.GetLastSelectedVariant(V)}static _GetExtensionMetadata(V){var O,Z;return(null===V||void 0===V||null===(O=V._internalMetadata)||void 0===O||null===(Z=O.Ai)||void 0===Z?void 0:Z[fV])||null}onLoading(){const V=this._loader.Ai.extensions;if(V&&V[this.name]){const O=V[this.name];this._variants=O.variants}}_loadMeshPrimitiveAsync(V,O,Z,d,p,r){return T.LoadExtensionAsync(V,p,this.name,((Y,m)=>{const a=new Array;return a.push(this._loader._loadMeshPrimitiveAsync(V,O,Z,d,p,(O=>{if(r(O),O instanceof e.c){const Z=T._GetDrawMode(V,p.mode),d=this._loader.rootBabylonMesh,r=d?d._internalMetadata=d._internalMetadata||{}:{},R=r.Ai=r.Ai||{},i=R[fV]=R[fV]||{lastSelected:null,original:[],variants:{}};i.original.push({mesh:O,material:O.material});for(let V=0;V<m.mappings.length;++V){const p=m.mappings[V],r=y.Get(`${Y}/mappings/${V}/material`,this._loader.Ai.materials,p.material);a.push(this._loader._loadMaterialAsync(`#/materials/${p.material}`,r,O,Z,(V=>{for(let Z=0;Z<p.variants.length;++Z){const r=p.variants[Z],Y=y.Get(`/extensions/${fV}/variants/${r}`,this._variants,r);i.variants[Y.name]=i.variants[Y.name]||[],i.variants[Y.name].push({mesh:O,material:V}),O.onClonedObservable.add((V=>{const Z=V;let p=null,r=Z;do{if(r=r.parent,!r)return;p=qV._GetExtensionMetadata(r)}while(null===p);if(d&&p===qV._GetExtensionMetadata(d)){r._internalMetadata={};for(const V in d._internalMetadata)r._internalMetadata[V]=d._internalMetadata[V];r._internalMetadata.Ai=[];for(const V in d._internalMetadata.Ai)r._internalMetadata.Ai[V]=d._internalMetadata.Ai[V];r._internalMetadata.Ai[fV]={lastSelected:null,original:[],variants:{}};for(const V of p.original)r._internalMetadata.Ai[fV].original.push({mesh:V.mesh,material:V.material});for(const V in p.variants)if(Object.prototype.hasOwnProperty.call(p.variants,V)){r._internalMetadata.Ai[fV].variants[V]=[];for(const O of p.variants[V])r._internalMetadata.Ai[fV].variants[V].push({mesh:O.mesh,material:O.material})}p=r._internalMetadata.Ai[fV]}for(const d of p.original)d.mesh===O&&(d.mesh=Z);for(const d of p.variants[Y.name])d.mesh===O&&(d.mesh=Z)}))}})))}}}))),Promise.all(a).then((V=>{let[O]=V;return O}))}))}}h(fV),s(fV,!0,(V=>new qV(V)));var KV=Z(11743);class sV{}sV.AUTOSAMPLERSUFFIX="Sampler",sV.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",sV.ALPHA_DISABLE=0,sV.ALPHA_ADD=1,sV.ALPHA_COMBINE=2,sV.ALPHA_SUBTRACT=3,sV.ALPHA_MULTIPLY=4,sV.ALPHA_MAXIMIZED=5,sV.ALPHA_ONEONE=6,sV.ALPHA_PREMULTIPLIED=7,sV.ALPHA_PREMULTIPLIED_PORTERDUFF=8,sV.ALPHA_INTERPOLATE=9,sV.ALPHA_SCREENMODE=10,sV.ALPHA_ONEONE_ONEONE=11,sV.ALPHA_ALPHATOCOLOR=12,sV.ALPHA_REVERSEONEMINUS=13,sV.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,sV.ALPHA_ONEONE_ONEZERO=15,sV.ALPHA_EXCLUSION=16,sV.ALPHA_LAYER_ACCUMULATE=17,sV.ALPHA_EQUATION_ADD=0,sV.ALPHA_EQUATION_SUBSTRACT=1,sV.ALPHA_EQUATION_REVERSE_SUBTRACT=2,sV.ALPHA_EQUATION_MAX=3,sV.ALPHA_EQUATION_MIN=4,sV.ALPHA_EQUATION_DARKEN=5,sV.DELAYLOADSTATE_NONE=0,sV.DELAYLOADSTATE_LOADED=1,sV.DELAYLOADSTATE_LOADING=2,sV.DELAYLOADSTATE_NOTLOADED=4,sV.NEVER=512,sV.ALWAYS=519,sV.LESS=513,sV.EQUAL=514,sV.LEQUAL=515,sV.GREATER=516,sV.GEQUAL=518,sV.NOTEQUAL=517,sV.KEEP=7680,sV.ZERO=0,sV.REPLACE=7681,sV.INCR=7682,sV.DECR=7683,sV.INVERT=5386,sV.INCR_WRAP=34055,sV.DECR_WRAP=34056,sV.TEXTURE_CLAMP_ADDRESSMODE=0,sV.TEXTURE_WRAP_ADDRESSMODE=1,sV.TEXTURE_MIRROR_ADDRESSMODE=2,sV.TEXTURE_CREATIONFLAG_STORAGE=1,sV.TEXTUREFORMAT_ALPHA=0,sV.TEXTUREFORMAT_LUMINANCE=1,sV.TEXTUREFORMAT_LUMINANCE_ALPHA=2,sV.TEXTUREFORMAT_RGB=4,sV.TEXTUREFORMAT_RGBA=5,sV.TEXTUREFORMAT_RED=6,sV.TEXTUREFORMAT_R=6,sV.TEXTUREFORMAT_RG=7,sV.TEXTUREFORMAT_RED_INTEGER=8,sV.TEXTUREFORMAT_R_INTEGER=8,sV.TEXTUREFORMAT_RG_INTEGER=9,sV.TEXTUREFORMAT_RGB_INTEGER=10,sV.TEXTUREFORMAT_RGBA_INTEGER=11,sV.TEXTUREFORMAT_BGRA=12,sV.TEXTUREFORMAT_DEPTH24_STENCIL8=13,sV.TEXTUREFORMAT_DEPTH32_FLOAT=14,sV.TEXTUREFORMAT_DEPTH16=15,sV.TEXTUREFORMAT_DEPTH24=16,sV.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,sV.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,sV.TEXTUREFORMAT_STENCIL8=19,sV.TEXTUREFORMAT_UNDEFINED=4294967295,sV.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,sV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,sV.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,sV.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,sV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,sV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,sV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,sV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,sV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,sV.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,sV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,sV.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,sV.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,sV.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,sV.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,sV.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,sV.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,sV.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,sV.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,sV.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,sV.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,sV.TEXTURETYPE_UNSIGNED_BYTE=0,sV.TEXTURETYPE_UNSIGNED_INT=0,sV.TEXTURETYPE_FLOAT=1,sV.TEXTURETYPE_HALF_FLOAT=2,sV.TEXTURETYPE_BYTE=3,sV.TEXTURETYPE_SHORT=4,sV.TEXTURETYPE_UNSIGNED_SHORT=5,sV.TEXTURETYPE_INT=6,sV.TEXTURETYPE_UNSIGNED_INTEGER=7,sV.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,sV.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,sV.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,sV.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,sV.TEXTURETYPE_UNSIGNED_INT_24_8=12,sV.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,sV.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,sV.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,sV.TEXTURETYPE_UNDEFINED=16,sV.TEXTURE_2D=3553,sV.TEXTURE_2D_ARRAY=35866,sV.TEXTURE_CUBE_MAP=34067,sV.TEXTURE_CUBE_MAP_ARRAY=3735928559,sV.TEXTURE_3D=32879,sV.TEXTURE_NEAREST_SAMPLINGMODE=1,sV.TEXTURE_NEAREST_NEAREST=1,sV.TEXTURE_BILINEAR_SAMPLINGMODE=2,sV.TEXTURE_LINEAR_LINEAR=2,sV.TEXTURE_TRILINEAR_SAMPLINGMODE=3,sV.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,sV.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,sV.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,sV.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,sV.TEXTURE_NEAREST_LINEAR=7,sV.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,sV.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,sV.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,sV.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,sV.TEXTURE_LINEAR_NEAREST=12,sV.TEXTURE_EXPLICIT_MODE=0,sV.TEXTURE_SPHERICAL_MODE=1,sV.TEXTURE_PLANAR_MODE=2,sV.TEXTURE_CUBIC_MODE=3,sV.TEXTURE_PROJECTION_MODE=4,sV.TEXTURE_SKYBOX_MODE=5,sV.TEXTURE_INVCUBIC_MODE=6,sV.TEXTURE_EQUIRECTANGULAR_MODE=7,sV.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,sV.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,sV.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,sV.TEXTURE_FILTERING_QUALITY_HIGH=64,sV.TEXTURE_FILTERING_QUALITY_MEDIUM=16,sV.TEXTURE_FILTERING_QUALITY_LOW=8,sV.SCALEMODE_FLOOR=1,sV.SCALEMODE_NEAREST=2,sV.SCALEMODE_CEILING=3,sV.MATERIAL_TextureDirtyFlag=1,sV.MATERIAL_LightDirtyFlag=2,sV.MATERIAL_FresnelDirtyFlag=4,sV.MATERIAL_AttributesDirtyFlag=8,sV.MATERIAL_MiscDirtyFlag=16,sV.MATERIAL_PrePassDirtyFlag=32,sV.MATERIAL_AllDirtyFlag=63,sV.MATERIAL_TriangleFillMode=0,sV.MATERIAL_WireFrameFillMode=1,sV.MATERIAL_PointFillMode=2,sV.MATERIAL_PointListDrawMode=3,sV.MATERIAL_LineListDrawMode=4,sV.MATERIAL_LineLoopDrawMode=5,sV.MATERIAL_LineStripDrawMode=6,sV.MATERIAL_TriangleStripDrawMode=7,sV.MATERIAL_TriangleFanDrawMode=8,sV.MATERIAL_ClockWiseSideOrientation=0,sV.MATERIAL_CounterClockWiseSideOrientation=1,sV.ACTION_NothingTrigger=0,sV.ACTION_OnPickTrigger=1,sV.ACTION_OnLeftPickTrigger=2,sV.ACTION_OnRightPickTrigger=3,sV.ACTION_OnCenterPickTrigger=4,sV.ACTION_OnPickDownTrigger=5,sV.ACTION_OnDoublePickTrigger=6,sV.ACTION_OnPickUpTrigger=7,sV.ACTION_OnPickOutTrigger=16,sV.ACTION_OnLongPressTrigger=8,sV.ACTION_OnPointerOverTrigger=9,sV.ACTION_OnPointerOutTrigger=10,sV.ACTION_OnEveryFrameTrigger=11,sV.ACTION_OnIntersectionEnterTrigger=12,sV.ACTION_OnIntersectionExitTrigger=13,sV.ACTION_OnKeyDownTrigger=14,sV.ACTION_OnKeyUpTrigger=15,sV.PARTICLES_BILLBOARDMODE_Y=2,sV.PARTICLES_BILLBOARDMODE_ALL=7,sV.PARTICLES_BILLBOARDMODE_STRETCHED=8,sV.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,sV.MESHES_CULLINGSTRATEGY_STANDARD=0,sV.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,sV.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,sV.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,sV.SCENELOADER_NO_LOGGING=0,sV.SCENELOADER_MINIMAL_LOGGING=1,sV.SCENELOADER_SUMMARY_LOGGING=2,sV.SCENELOADER_DETAILED_LOGGING=3,sV.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,sV.PREPASS_POSITION_TEXTURE_TYPE=1,sV.PREPASS_VELOCITY_TEXTURE_TYPE=2,sV.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,sV.PREPASS_COLOR_TEXTURE_TYPE=4,sV.PREPASS_DEPTH_TEXTURE_TYPE=5,sV.PREPASS_NORMAL_TEXTURE_TYPE=6,sV.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,sV.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,sV.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,sV.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,sV.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,sV.PREPASS_ALBEDO_TEXTURE_TYPE=12,sV.BUFFER_CREATIONFLAG_READ=1,sV.BUFFER_CREATIONFLAG_WRITE=2,sV.BUFFER_CREATIONFLAG_READWRITE=3,sV.BUFFER_CREATIONFLAG_UNIFORM=4,sV.BUFFER_CREATIONFLAG_VERTEX=8,sV.BUFFER_CREATIONFLAG_INDEX=16,sV.BUFFER_CREATIONFLAG_STORAGE=32,sV.BUFFER_CREATIONFLAG_INDIRECT=64,sV.RENDERPASS_MAIN=0,sV.INPUT_ALT_KEY=18,sV.INPUT_CTRL_KEY=17,sV.INPUT_META_KEY1=91,sV.INPUT_META_KEY2=92,sV.INPUT_META_KEY3=93,sV.INPUT_SHIFT_KEY=16,sV.SNAPSHOTRENDERING_STANDARD=0,sV.SNAPSHOTRENDERING_FAST=1,sV.PERSPECTIVE_CAMERA=0,sV.ORTHOGRAPHIC_CAMERA=1,sV.FOVMODE_VERTICAL_FIXED=0,sV.FOVMODE_HORIZONTAL_FIXED=1,sV.RIG_MODE_NONE=0,sV.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,sV.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,sV.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,sV.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,sV.RIG_MODE_STEREOSCOPIC_INTERLACED=14,sV.RIG_MODE_VR=20,sV.RIG_MODE_CUSTOM=22,sV.MAX_SUPPORTED_UV_SETS=6,sV.GL_ALPHA_EQUATION_ADD=32774,sV.GL_ALPHA_EQUATION_MIN=32775,sV.GL_ALPHA_EQUATION_MAX=32776,sV.GL_ALPHA_EQUATION_SUBTRACT=32778,sV.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,sV.GL_ALPHA_FUNCTION_SRC=768,sV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,sV.GL_ALPHA_FUNCTION_SRC_ALPHA=770,sV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,sV.GL_ALPHA_FUNCTION_DST_ALPHA=772,sV.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,sV.GL_ALPHA_FUNCTION_DST_COLOR=774,sV.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,sV.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,sV.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,sV.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,sV.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,sV.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,sV.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,sV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,sV.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,sV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,sV.SnippetUrl="https://snippet.babylonjs.com",sV.FOGMODE_NONE=0,sV.FOGMODE_EXP=1,sV.FOGMODE_EXP2=2,sV.FOGMODE_LINEAR=3,sV.BYTE=5120,sV.UNSIGNED_BYTE=5121,sV.SHORT=5122,sV.UNSIGNED_SHORT=5123,sV.INT=5124,sV.UNSIGNED_INT=5125,sV.FLOAT=5126,sV.PositionKind="position",sV.NormalKind="ab",sV.TangentKind="tangent",sV.UVKind="uv",sV.UV2Kind="uv2",sV.UV3Kind="uv3",sV.UV4Kind="uv4",sV.UV5Kind="uv5",sV.UV6Kind="uv6",sV.ColorKind="color",sV.ColorInstanceKind="instanceColor",sV.MatricesIndicesKind="matricesIndices",sV.MatricesWeightsKind="matricesWeights",sV.MatricesIndicesExtraKind="matricesIndicesExtra",sV.MatricesWeightsExtraKind="matricesWeightsExtra";class hV{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:sV.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(V,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...hV._GetDefaultOptions(),...V},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new i.e,this._scene.Xi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(V){if(!Object.keys(V).filter((O=>this._options[O]!==V[O])).length)return;const O={...this._options,...V},Z=this._options;this._options=O,O.renderSize===Z.renderSize&&O.renderTargetTextureType===Z.renderTargetTextureType&&O.generateMipmaps===Z.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(V){return!!V&&!!(V instanceof v&&V.subSurface.isRefractionEnabled)}_addMesh(V){this._materialObservers[V.uniqueId]=V.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.e.SetImmediate((()=>{this._shouldRenderAsTransmission(V.material)?(V.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(V)&&this._transparentMeshesCache.push(V)):-1===this._opaqueMeshesCache.indexOf(V)&&this._opaqueMeshesCache.push(V)}))}_removeMesh(V){V.onMaterialChangedObservable.remove(this._materialObservers[V.uniqueId]),delete this._materialObservers[V.uniqueId];let O=this._transparentMeshesCache.indexOf(V);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(V),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(V){const O=this._transparentMeshesCache.indexOf(V),Z=this._opaqueMeshesCache.indexOf(V);this._shouldRenderAsTransmission(V.material)?(V.material instanceof v&&(V.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Z?(this._opaqueMeshesCache.splice(Z,1),this._transparentMeshesCache.push(V)):-1===O&&this._transparentMeshesCache.push(V)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(V)):-1===Z&&this._opaqueMeshesCache.push(V)}_isRenderTargetValid(){var V;return null!==(null===(V=this._opaqueRenderTarget)||void 0===V?void 0:V.getInternalTexture())}_setupRenderTargets(){var V;let O,Z;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new KV.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(V=this._options.clearColor)||void 0===V?void 0:V.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((V=>{Z=this._scene.environmentIntensity,this._scene.environmentIntensity=1,O=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?V.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(V.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=Z,this._scene.imageProcessingConfiguration._applyByPostProcess=O})),this._transparentMeshesCache.forEach((V=>{this._shouldRenderAsTransmission(V.material)&&(V.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const xV="KHR_materials_transmission";class yV{constructor(V){this.name=xV,this.order=175,this._loader=V,this.enabled=this._loader.isExtensionUsed(xV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadTransparentPropertiesAsync(d,O,Z,p)),Promise.all(r).then((()=>{}))}))}_loadTransparentPropertiesAsync(V,O,Z,d){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const p=Z;if(p.subSurface.isRefractionEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.useAlbedoToTintRefraction=!0,void 0===d.transmissionFactor)return p.subSurface.refractionIntensity=0,p.subSurface.isRefractionEnabled=!1,Promise.resolve();{var r;p.subSurface.refractionIntensity=d.transmissionFactor;const V=p.va();if(p.subSurface.refractionIntensity&&!V._transmissionHelper)new hV({},p.va());else if(p.subSurface.refractionIntensity&&(null===(r=V._transmissionHelper)||void 0===r||!r._isRenderTargetValid())){var Y;null===(Y=V._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,d.transmissionTexture?(d.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/transmissionTexture`,d.transmissionTexture,void 0).then((V=>{V.name=`${Z.name} (Transmission)`,p.subSurface.refractionIntensityTexture=V,p.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(xV),s(xV,!0,(V=>new yV(V)));const TV="KHR_materials_diffuse_transmission";class BV{constructor(V){this.name=TV,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(TV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadTranslucentPropertiesAsync(d,O,Z,p)),Promise.all(r).then((()=>{}))}))}_loadTranslucentPropertiesAsync(V,O,Z,d){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);const p=Z;if(p.subSurface.isTranslucencyEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,p.subSurface.useAlbedoToTintTranslucency=!1,void 0===d.diffuseTransmissionFactor)return p.subSurface.translucencyIntensity=0,p.subSurface.isTranslucencyEnabled=!1,Promise.resolve();p.subSurface.translucencyIntensity=d.diffuseTransmissionFactor;const Y=new Array;return p.subSurface.useGltfStyleTextures=!0,d.diffuseTransmissionTexture&&(d.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionTexture`,d.diffuseTransmissionTexture).then((V=>{V.name=`${Z.name} (Diffuse Transmission)`,p.subSurface.translucencyIntensityTexture=V})))),void 0!==d.diffuseTransmissionColorFactor?p.subSurface.translucencyColor=r.b.Cg(d.diffuseTransmissionColorFactor):p.subSurface.translucencyColor=r.b.White(),d.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionColorTexture`,d.diffuseTransmissionColorTexture).then((V=>{V.name=`${Z.name} (Diffuse Transmission Color)`,p.subSurface.translucencyColorTexture=V}))),Promise.all(Y).then((()=>{}))}}h(TV),s(TV,!0,(V=>new BV(V)));const jV="KHR_materials_volume";class VO{constructor(V){this.name=jV,this.order=173,this._loader=V,this.enabled=this._loader.isExtensionUsed(jV),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadVolumePropertiesAsync(d,O,Z,p)),Promise.all(r).then((()=>{}))}))}_loadVolumePropertiesAsync(V,O,Z,d){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);if(!Z.subSurface.isRefractionEnabled&&!Z.subSurface.isTranslucencyEnabled||!d.thicknessFactor)return Promise.resolve();Z.subSurface.volumeIndexOfRefraction=Z.indexOfRefraction;const p=void 0!==d.attenuationDistance?d.attenuationDistance:Number.MAX_VALUE;return Z.subSurface.tintColorAtDistance=p,void 0!==d.attenuationColor&&3==d.attenuationColor.length&&Z.subSurface.tintColor.nf(d.attenuationColor[0],d.attenuationColor[1],d.attenuationColor[2]),Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=d.thicknessFactor,Z.subSurface.useThicknessAsDepth=!0,d.thicknessTexture?(d.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/thicknessTexture`,d.thicknessTexture).then((V=>{V.name=`${Z.name} (Thickness)`,Z.subSurface.thicknessTexture=V,Z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(jV),s(jV,!0,(V=>new VO(V)));const OO="KHR_materials_dispersion";class ZO{constructor(V){this.name=OO,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(OO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(V,O,Z)),r.push(this._loadDispersionPropertiesAsync(d,O,Z,p)),Promise.all(r).then((()=>{}))}))}_loadDispersionPropertiesAsync(V,O,Z,d){if(!(Z instanceof v))throw new Error(`${V}: Material type not supported`);return Z.subSurface.isRefractionEnabled&&d.dispersion?(Z.subSurface.isDispersionEnabled=!0,Z.subSurface.dispersion=d.dispersion,Promise.resolve()):Promise.resolve()}}h(OO),s(OO,!0,(V=>new ZO(V)));const dO="KHR_mesh_quantization";class pO{constructor(V){this.name=dO,this.enabled=V.isExtensionUsed(dO)}dispose(){}}h(dO),s(dO,!0,(V=>new pO(V)));const rO="KHR_texture_basisu";class YO{constructor(V){this.name=rO,this._loader=V,this.enabled=V.isExtensionUsed(rO)}dispose(){this._loader=null}_loadTextureAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>{const r=void 0==O.sampler?T.DefaultSampler:y.Get(`${V}/sampler`,this._loader.Ai.samplers,O.sampler),Y=y.Get(`${d}/source`,this._loader.Ai.images,p.source);return this._loader._createTextureAsync(V,r,Y,(V=>{Z(V)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}h(rO),s(rO,!0,(V=>new YO(V)));const mO="KHR_texture_transform";class aO{constructor(V){this.name=mO,this._loader=V,this.enabled=this._loader.isExtensionUsed(mO)}dispose(){this._loader=null}loadTextureInfoAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((d,p)=>this._loader.loadTextureInfoAsync(V,O,(V=>{if(!(V instanceof A.b))throw new Error(`${d}: Texture type not supported`);p.offset&&(V.uOffset=p.offset[0],V.vOffset=p.offset[1]),V.uRotationCenter=0,V.vRotationCenter=0,p.rotation&&(V.wAng=-p.rotation),p.scale&&(V.uScale=p.scale[0],V.vScale=p.scale[1]),void 0!=p.texCoord&&(V.coordinatesIndex=p.texCoord),Z(V)}))))}}h(mO),s(mO,!0,(V=>new aO(V)));const RO="KHR_xmp_json_ld";class iO{constructor(V){this.name=RO,this.order=100,this._loader=V,this.enabled=this._loader.isExtensionUsed(RO)}dispose(){this._loader=null}onLoading(){var V,O,Z;if(null===this._loader.rootBabylonMesh)return;const d=null===(V=this._loader.Ai.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld,p=null===(O=this._loader.Ai.asset)||void 0===O||null===(Z=O.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld;if(d&&p){const V=+p.packet;d.packets&&V<d.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=d.packets[V])}}}function MO(V,O,Z,d){return r.b.Cg(O,Z).scale(d)}function cO(V,O,Z,d){return O[Z]*d}function WO(V,O,Z,d){return-O[Z]*d}function FO(V,O,Z,d){return O[Z+1]*d}function QO(V,O,Z,d){return O[Z]*d*2}function bO(V){return{scale:[new HO(c.c.ANIMATIONTYPE_FLOAT,`${V}.uScale`,cO,(()=>2)),new HO(c.c.ANIMATIONTYPE_FLOAT,`${V}.vScale`,FO,(()=>2))],offset:[new HO(c.c.ANIMATIONTYPE_FLOAT,`${V}.uOffset`,cO,(()=>2)),new HO(c.c.ANIMATIONTYPE_FLOAT,`${V}.vOffset`,FO,(()=>2))],rotation:[new HO(c.c.ANIMATIONTYPE_FLOAT,`${V}.wAng`,WO,(()=>1))]}}h(RO),s(RO,!0,(V=>new iO(V)));class UO extends N{buildAnimations(V,O,Z,d,p){p(V._babylonCamera,this._buildAnimation(O,Z,d))}}class HO extends N{buildAnimations(V,O,Z,d,p){for(const r in V._data)p(V._data[r].babylonMaterial,this._buildAnimation(O,Z,d))}}class SO extends N{buildAnimations(V,O,Z,d,p){p(V._babylonLight,this._buildAnimation(O,Z,d))}}const zO={__array__:{__target__:!0,...f}},GO={__array__:{__target__:!0,orthographic:{xmag:[new UO(c.c.ANIMATIONTYPE_FLOAT,"orthoLeft",WO,(()=>1)),new UO(c.c.ANIMATIONTYPE_FLOAT,"orthoRight",FO,(()=>1))],ymag:[new UO(c.c.ANIMATIONTYPE_FLOAT,"orthoBottom",WO,(()=>1)),new UO(c.c.ANIMATIONTYPE_FLOAT,"orthoTop",FO,(()=>1))],zfar:[new UO(c.c.ANIMATIONTYPE_FLOAT,"maxZ",cO,(()=>1))],znear:[new UO(c.c.ANIMATIONTYPE_FLOAT,"Ii",cO,(()=>1))]},perspective:{yfov:[new UO(c.c.ANIMATIONTYPE_FLOAT,"fov",cO,(()=>1))],zfar:[new UO(c.c.ANIMATIONTYPE_FLOAT,"maxZ",cO,(()=>1))],znear:[new UO(c.c.ANIMATIONTYPE_FLOAT,"Ii",cO,(()=>1))]}}},wO={nodes:zO,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"albedoColor",MO,(()=>4)),new HO(c.c.ANIMATIONTYPE_FLOAT,"alpha",(function(V,O,Z,d){return O[Z+3]*d}),(()=>4))],metallicFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"metallic",cO,(()=>1))],roughnessFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"roughness",cO,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:bO("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:bO("metallicTexture")}}},emissiveFactor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"emissiveColor",MO,(()=>3))],normalTexture:{scale:[new HO(c.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cO,(()=>1))],extensions:{KHR_texture_transform:bO("bumpTexture")}},occlusionTexture:{strength:[new HO(c.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cO,(()=>1))],extensions:{KHR_texture_transform:bO("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:bO("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new HO(c.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cO,(()=>1))],anisotropyRotation:[new HO(c.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cO,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:bO("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cO,(()=>1))],clearcoatRoughnessFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cO,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:bO("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new HO(c.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cO,(()=>1))],extensions:{KHR_texture_transform:bO("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:bO("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new HO(c.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cO,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new HO(c.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cO,(()=>1))]},KHR_materials_ior:{ior:[new HO(c.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cO,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cO,(()=>1))],iridescenceIor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cO,(()=>1))],iridescenceThicknessMinimum:[new HO(c.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cO,(()=>1))],iridescenceThicknessMaximum:[new HO(c.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cO,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:bO("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:bO("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"sheen.color",MO,(()=>3))],sheenRoughnessFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",cO,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:bO("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:bO("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cO,(()=>1))],specularColorFactor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",MO,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:bO("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:bO("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cO,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:bO("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",MO,(()=>3))],attenuationDistance:[new HO(c.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cO,(()=>1))],thicknessFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cO,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:bO("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new HO(c.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cO,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:bO("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new HO(c.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",MO,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:bO("subSurface.translucencyColorTexture")}}}}}},cameras:GO,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new SO(c.c.ANIMATIONTYPE_COLOR3,"diffuse",MO,(()=>3))],Mi:[new SO(c.c.ANIMATIONTYPE_FLOAT,"intensity",cO,(()=>1))],range:[new SO(c.c.ANIMATIONTYPE_FLOAT,"range",cO,(()=>1))],spot:{innerConeAngle:[new SO(c.c.ANIMATIONTYPE_FLOAT,"innerAngle",QO,(()=>1))],outerConeAngle:[new SO(c.c.ANIMATIONTYPE_FLOAT,"angle",QO,(()=>1))]}}}}}};class tO{constructor(V,O){this._gltf=V,this._infoTree=O}convert(V){let O,Z=this._gltf,d=this._infoTree;if(!V.startsWith("/"))throw new Error("Path must start with a /");const p=V.split("/");p.shift();for(const r of p){if(d.__array__)d=d.__array__;else if(d=d[r],!d)throw new Error(`Path ${V} is invalid`);if(void 0===Z)throw new Error(`Path ${V} is invalid`);Z=Z[r],d.__target__&&(O=Z)}return{object:O,info:d}}}const CO="KHR_animation_pointer";class vO extends tO{constructor(V){super(V,wO)}}class AO{constructor(V){this.name=CO,this._loader=V,this._pathToObjectConverter=new vO(this._loader.Ai)}get enabled(){return this._loader.isExtensionUsed(CO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(V,O,Z,d,p){var r;const Y=null===(r=d.target.extensions)||void 0===r?void 0:r.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==d.target.path&&Q.b.Warn(`${V}/target/path: Value (${d.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=d.target.node&&Q.b.Warn(`${V}/target/node: Value (${d.target.node}) must not be present when using the ${this.name} extension`);const m=`${V}/extensions/${this.name}`,a=Y.pointer;if(!a)throw new Error(`${m}: Pointer is missing`);try{const r=this._pathToObjectConverter.convert(a);return this._loader._loadAnimationChannelFromTargetInfoAsync(V,O,Z,d,r,p)}catch(R){return Q.b.Warn(`${m}/pointer: Invalid pointer (${a}) skipped`),null}}}h(CO),s(CO,!0,(V=>new AO(V)));class lO{constructor(V,O,Z){this.frame=V,this.action=O,this.onlyOnce=Z,this.isDone=!1}_clone(){return new lO(this.frame,this.action,this.onlyOnce)}}var IO=Z(10928),gO=Z(10983);class nO{get loop(){return this._loop}set loop(V){V!==this._loop&&(this._loop=V,this.updateOptions({loop:V}))}get currentTime(){var V;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(V=gO.e.audioEngine)&&void 0!==V&&V.audioContext&&(this.isPlaying||this.isPaused)){const V=this.isPaused?0:gO.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+V}return 0}get spatialSound(){return this._spatialSound}set spatialSound(V){if(V==this._spatialSound)return;const O=this.isPlaying;this.pause(),V?(this._spatialSound=V,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(V,O,Z){var d;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new i.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=p.m.Zero(),this._localDirection=new p.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=V,Z=Z||F.e.LastCreatedScene)if(this._scene=Z,nO._SceneComponentInitialization(Z),this._readyToPlayCallback=r,this._customAttenuationFunction=(V,O,Z,d,p)=>O<Z?V*(1-O/Z):0,m&&(this.autoplay=m.autoplay||!1,this._loop=m.loop||!1,void 0!==m.volume&&(this._volume=m.volume),this._spatialSound=m.spatialSound??!1,this.maxDistance=m.maxDistance??100,this.useCustomAttenuation=m.useCustomAttenuation??!1,this.rolloffFactor=m.rolloffFactor||1,this.refDistance=m.refDistance||1,this.distanceModel=m.distanceModel||"linear",this._playbackRate=m.playbackRate||1,this._streaming=m.streaming??!1,this._length=m.length,this._offset=m.offset),null!==(d=gO.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&gO.e.audioEngine.audioContext){this._soundGain=gO.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let V=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let Z=[],d=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=gO.e.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=gO.e.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(d=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":Z.push(O);case"Array":0===Z.length&&(Z=O);for(let V=0;V<Z.length;V++){const O=Z[V];if(d=m&&m.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&gO.e.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&gO.e.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),d){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.e.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(V=>{this._soundLoaded(V)}),void 0,!0,!0,(V=>{V&&Q.b.Error("XHR "+V.status+" error on: "+O+"."),Q.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:V=!1}V?d||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Q.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(a){Q.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),gO.e.audioEngine&&!gO.e.audioEngine.WarnedWebAudioUnsupported&&(Q.b.Error("Web Audio is not supported by your browser."),gO.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var V;null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(V){var O;null!==(O=gO.e.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=V,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(V){var O;null!==(O=gO.e.audioEngine)&&void 0!==O&&O.audioContext&&gO.e.audioEngine.audioContext.decodeAudioData(V,(V=>{this._audioBufferLoaded(V)}),(V=>{Q.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+V)}))}setAudioBuffer(V){var O;null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=V,this._isReadyToPlay=!0)}updateOptions(V){V&&(this.loop=V.loop??this.loop,this.maxDistance=V.maxDistance??this.maxDistance,this.useCustomAttenuation=V.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=V.rolloffFactor??this.rolloffFactor,this.refDistance=V.refDistance??this.refDistance,this.distanceModel=V.distanceModel??this.distanceModel,this._playbackRate=V.playbackRate??this._playbackRate,this._length=V.length??void 0,this.spatialSound=V.spatialSound??this._spatialSound,this._setOffset(V.offset??void 0),this.setVolume(V.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var V;null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&gO.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??gO.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var V;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(V=this._soundPanner)||void 0===V||V.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var V;null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(V){var O;null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(V),this._isOutputConnected=!0)}setDirectionalCone(V,O,Z){O<V?Q.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=V,this._coneOuterAngle=O,this._coneOuterGain=Z,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!=this._coneInnerAngle){var O;if(this._coneOuterAngle<V)return void Q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V,null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!=this._coneOuterAngle){var O;if(V<this._coneInnerAngle)return void Q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V,null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(V){var O;V.equals(this._position)||(this._position.p(V),null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(V){var O;this._localDirection=V,null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const V=this._connectedTransformNode.getWorldMatrix(),O=p.m.TransformNormal(this._localDirection,V);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var V;if(null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const V=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.fc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,V,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(V){this._customAttenuationFunction=V}play(V,O,Z){var d;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(d=gO.e.audioEngine)&&void 0!==d&&d.audioContext)try{var p,r;this._clearTimeoutsAndObservers();let d=V?(null===(p=gO.e.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+V:null===(r=gO.e.audioEngine)||void 0===r?void 0:r.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=gO.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const V=()=>{var Z;if(null!==(Z=gO.e.audioEngine)&&void 0!==Z&&Z.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const Z=this._htmlAudioElement.play();void 0!==Z&&Z.catch((()=>{var O,Z;(null===(O=gO.e.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Z=gO.e.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{V()})))}))}else{var d;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(d=gO.e.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{V()}))}};V()}}else{var Y;const p=()=>{var p;if(null!==(p=gO.e.audioEngine)&&void 0!==p&&p.audioContext){var r;if(Z=Z||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const V=this._soundSource;V.onended=()=>{V.disconnect()}}if(this._soundSource=null===(r=gO.e.audioEngine)||void 0===r?void 0:r.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==Z&&(this._soundSource.loopEnd=(0|O)+Z),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},d=V?(null===(Y=gO.e.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+V:gO.e.audioEngine.audioContext.currentTime;const p=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(d,p,this.loop?void 0:Z)}}};"suspended"===(null===(Y=gO.e.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var V;"suspended"===(null===(V=gO.e.audioEngine)||void 0===V?void 0:V.audioContext.state)?(gO.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=gO.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{p()})))):p()}),500):p()}this._startTime=d,this.isPlaying=!0,this.isPaused=!1}catch(m){Q.b.Error("Error while trying to play audio: "+this.name+", "+m.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(V){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1}else if(null!==(O=gO.e.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=V?gO.e.audioEngine.audioContext.currentTime+V:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(V=gO.e.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=gO.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(V,O){var Z;null!==(Z=gO.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._soundGain&&(O&&gO.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(gO.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,gO.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(V,gO.e.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=V),this._volume=V}setPlaybackRate(V){this._playbackRate=V,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(V){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=V,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=V=>this._onRegisterAfterWorldMatrixUpdate(V),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(V){var O;if(V.getBoundingInfo){const O=V.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(V.absolutePosition);null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const V=()=>{this._isReadyToPlay?(Z._audioBuffer=this.getAudioBuffer(),Z._isReadyToPlay=!0,Z.autoplay&&Z.play(0,this._offset,this._length)):setTimeout(V,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Z=new nO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&Z.setAttenuationFunction(this._customAttenuationFunction),Z.setPosition(this._position),Z.setPlaybackRate(this._playbackRate),V(),Z}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const V={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(V.connectedMeshId=this._connectedTransformNode.id),V.position=this._position.Wi(),V.refDistance=this.refDistance,V.distanceModel=this.distanceModel,V.isDirectional=this._isDirectional,V.localDirectionToMesh=this._localDirection.Wi(),V.coneInnerAngle=this._coneInnerAngle,V.coneOuterAngle=this._coneOuterAngle,V.coneOuterGain=this._coneOuterGain),V}static Parse(V,O,Z,d){const r=V.name;let Y;Y=V.url?Z+V.url:Z+r;const m={autoplay:V.autoplay,loop:V.loop,volume:V.volume,spatialSound:V.spatialSound,maxDistance:V.maxDistance,rolloffFactor:V.rolloffFactor,refDistance:V.refDistance,distanceModel:V.distanceModel,playbackRate:V.playbackRate};let a;if(d){const V=()=>{d._isReadyToPlay?(a._audioBuffer=d.getAudioBuffer(),a._isReadyToPlay=!0,a.autoplay&&a.play(0,a._offset,a._length)):setTimeout(V,300)};a=new nO(r,new ArrayBuffer(0),O,null,m),V()}else a=new nO(r,Y,O,(()=>{O.removePendingData(a)}),m),O.addPendingData(a);if(V.position){const O=p.m.Cg(V.position);a.setPosition(O)}if(V.isDirectional&&(a.setDirectionalCone(V.coneInnerAngle||360,V.coneOuterAngle||360,V.coneOuterGain||0),V.localDirectionToMesh)){const O=p.m.Cg(V.localDirectionToMesh);a.setLocalDirectionToMesh(O)}if(V.connectedMeshId){const Z=O.getMeshById(V.connectedMeshId);Z&&a.attachToMesh(Z)}return V.metadata&&(a.metadata=V.metadata),a}_setOffset(V){this._offset!==V&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=V)}_clearTimeoutsAndObservers(){var V;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(V=gO.e.audioEngine)||void 0===V||V.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nO._SceneComponentInitialization=V=>{throw(0,IO.c)("AudioSceneComponent")},(0,t.f)("BABYLON.Sound",nO);class eO{constructor(V,O,Z){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==Z.length)throw new Error("Sounds length does not equal weights length");this.loop=V,this._weights=Z;let d=0;for(const r of Z)d+=r;const p=d>0?1/d:0;for(let r=0;r<this._weights.length;r++)this._weights[r]*=p;this._sounds=O;for(const r of this._sounds)r.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!==this._coneInnerAngle){if(this._coneOuterAngle<V)return void Q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V;for(const O of this._sounds)O.directionalConeInnerAngle=V}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!==this._coneOuterAngle){if(V<this._coneInnerAngle)return void Q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V;for(const O of this._sounds)O.directionalConeOuterAngle=V}}get volume(){return this._volume}set volume(V){if(V!==this._volume)for(const O of this._sounds)O.setVolume(V)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(V){if(!this.isPaused){this.stop();const V=Math.random();let O=0;for(let Z=0;Z<this._weights.length;Z++)if(O+=this._weights[Z],V<=O){this._currentIndex=Z;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:V):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class uO{constructor(V){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(V=V||F.e.LastCreatedScene)&&(this._scene=V,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var V;null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&gO.e.audioEngine.audioContext&&(this._outputAudioNode=gO.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(gO.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(gO.e.audioEngine&&gO.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(V){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&V.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==V.soundTrackId&&(-1===V.soundTrackId?this._scene.mainSoundTrack.removeSound(V):this._scene.soundTracks&&this._scene.soundTracks[V.soundTrackId].removeSound(V)),this.soundCollection.push(V),V.soundTrackId=this.id}removeSound(V){const O=this.soundCollection.indexOf(V);-1!==O&&this.soundCollection.splice(O,1)}setVolume(V){var O;null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=V)}switchPanningModelToHRTF(){var V;if(null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var V;if(null!==(V=gO.e.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(V){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=V,null!==(O=gO.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,gO.e.audioEngine.masterGain))}}var kO=Z(11342),DO=Z(11238),XO=(Z(11774),Z(10926));(0,Z(11848).e)(kO.b.NAME_AUDIO,((V,O,Z,d)=>{let p,r=[];if(Z.Rj=Z.Rj||[],void 0!==V.Rj&&null!==V.Rj)for(let m=0,a=V.Rj.length;m<a;m++){var Y;const a=V.Rj[m];null!==(Y=gO.e.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(a.url||(a.url=a.name),r[a.url]?Z.Rj.push(nO.Parse(a,O,d,r[a.url])):(p=nO.Parse(a,O,d),r[a.url]=p,Z.Rj.push(p))):Z.Rj.push(new nO(a.name,null,O))}r=[]})),Object.defineProperty(DO.b.prototype,"mainSoundTrack",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),this._mainSoundTrack||(this._mainSoundTrack=new uO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),DO.b.prototype.getSoundByName=function(V){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===V)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let Z=0;Z<this.soundTracks.length;Z++)for(O=0;O<this.soundTracks[Z].soundCollection.length;O++)if(this.soundTracks[Z].soundCollection[O].name===V)return this.soundTracks[Z].soundCollection[O];return null},Object.defineProperty(DO.b.prototype,"audioEnabled",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),V.audioEnabled},set:function(V){let O=this._getComponent(kO.b.NAME_AUDIO);O||(O=new oO(this),this.o(O)),V?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(DO.b.prototype,"headphone",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),V.headphone},set:function(V){let O=this._getComponent(kO.b.NAME_AUDIO);O||(O=new oO(this),this.o(O)),V?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(DO.b.prototype,"audioListenerPositionProvider",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),V.audioListenerPositionProvider},set:function(V){let O=this._getComponent(kO.b.NAME_AUDIO);if(O||(O=new oO(this),this.o(O)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(DO.b.prototype,"audioListenerRotationProvider",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),V.audioListenerRotationProvider},set:function(V){let O=this._getComponent(kO.b.NAME_AUDIO);if(O||(O=new oO(this),this.o(O)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(DO.b.prototype,"audioPositioningRefreshRate",{get:function(){let V=this._getComponent(kO.b.NAME_AUDIO);return V||(V=new oO(this),this.o(V)),V.audioPositioningRefreshRate},set:function(V){let O=this._getComponent(kO.b.NAME_AUDIO);O||(O=new oO(this),this.o(O)),O.audioPositioningRefreshRate=V},enumerable:!0,configurable:!0});class oO{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(V){this.name=kO.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new p.m,this._cachedCameraPosition=new p.m,this._lastCheck=0,this._invertMatrixTemp=new p.c,this._cameraDirectionTemp=new p.m,(V=V||F.e.LastCreatedScene)&&(this.Cf=V,V.soundTracks=[],V.Rj=[])}register(){this.Cf._afterRenderStage.registerStep(kO.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(V){if(V.Rj=[],this.Cf.soundTracks)for(let O=0;O<this.Cf.soundTracks.length;O++){const Z=this.Cf.soundTracks[O];for(let O=0;O<Z.soundCollection.length;O++)V.Rj.push(Z.soundCollection[O].serialize())}}addFromContainer(V){V.Rj&&V.Rj.forEach((V=>{V.play(),V.autoplay=!0,this.Cf.mainSoundTrack.addSound(V)}))}removeFromContainer(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.Rj&&V.Rj.forEach((V=>{V.stop(),V.autoplay=!1,this.Cf.mainSoundTrack.removeSound(V),O&&V.dispose()}))}dispose(){const V=this.Cf;if(V._mainSoundTrack&&V.mainSoundTrack.dispose(),V.soundTracks)for(let O=0;O<V.soundTracks.length;O++)V.soundTracks[O].dispose()}disableAudio(){const V=this.Cf;let O;for(this._audioEnabled=!1,gO.e.audioEngine&&gO.e.audioEngine.audioContext&&gO.e.audioEngine.audioContext.suspend(),O=0;O<V.mainSoundTrack.soundCollection.length;O++)V.mainSoundTrack.soundCollection[O].pause();if(V.soundTracks)for(O=0;O<V.soundTracks.length;O++)for(let Z=0;Z<V.soundTracks[O].soundCollection.length;Z++)V.soundTracks[O].soundCollection[Z].pause()}enableAudio(){const V=this.Cf;let O;for(this._audioEnabled=!0,gO.e.audioEngine&&gO.e.audioEngine.audioContext&&gO.e.audioEngine.audioContext.resume(),O=0;O<V.mainSoundTrack.soundCollection.length;O++)V.mainSoundTrack.soundCollection[O].isPaused&&V.mainSoundTrack.soundCollection[O].play();if(V.soundTracks)for(O=0;O<V.soundTracks.length;O++)for(let Z=0;Z<V.soundTracks[O].soundCollection.length;Z++)V.soundTracks[O].soundCollection[Z].isPaused&&V.soundTracks[O].soundCollection[Z].play()}switchAudioModeForHeadphones(){const V=this.Cf;if(this._headphone=!0,V.mainSoundTrack.switchPanningModelToHRTF(),V.soundTracks)for(let O=0;O<V.soundTracks.length;O++)V.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const V=this.Cf;if(this._headphone=!1,V.mainSoundTrack.switchPanningModelToEqualPower(),V.soundTracks)for(let O=0;O<V.soundTracks.length;O++)V.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const V=XO.c.Now;if(this._lastCheck&&V-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=V;const O=this.Cf;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const Z=gO.e.audioEngine;if(Z&&Z.audioContext){let V,d=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(d=O.activeCameras[0]),this.audioListenerPositionProvider){const V=this.audioListenerPositionProvider();Z.audioContext.listener.setPosition(V.x||0,V.y||0,V.z||0)}else d?this._cachedCameraPosition.equals(d.globalPosition)||(this._cachedCameraPosition.p(d.globalPosition),Z.audioContext.listener.setPosition(d.globalPosition.x,d.globalPosition.y,d.globalPosition.z)):Z.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const V=this.audioListenerRotationProvider();Z.audioContext.listener.setOrientation(V.x||0,V.y||0,V.z||0,0,1,0)}else d?(d.rigCameras&&d.rigCameras.length>0&&(d=d.rigCameras[0]),d.getViewMatrix().invertToRef(this._invertMatrixTemp),p.m.TransformNormalToRef(oO._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),Z.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Z.audioContext.listener.setOrientation(0,0,0,0,1,0);for(V=0;V<O.mainSoundTrack.soundCollection.length;V++){const Z=O.mainSoundTrack.soundCollection[V];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}if(O.soundTracks)for(V=0;V<O.soundTracks.length;V++)for(let Z=0;Z<O.soundTracks[V].soundCollection.length;Z++){const d=O.soundTracks[V].soundCollection[Z];d.useCustomAttenuation&&d.updateDistanceFromListener()}}}}oO._CameraDirection=new p.m(0,0,-1),nO._SceneComponentInitialization=V=>{let O=V._getComponent(kO.b.NAME_AUDIO);O||(O=new oO(V),V.o(O))};const EO="MSFT_audio_emitter";class LO{constructor(V){this.name=EO,this._loader=V,this.enabled=this._loader.isExtensionUsed(EO)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const V=this._loader.Ai.extensions;if(V&&V[this.name]){const O=V[this.name];this._clips=O.clips,this._emitters=O.emitters,y.Assign(this._clips),y.Assign(this._emitters)}}loadSceneAsync(V,O){return T.LoadExtensionAsync(V,O,this.name,((Z,d)=>{const p=new Array;p.push(this._loader.loadSceneAsync(V,O));for(const V of d.emitters){const O=y.Get(`${Z}/emitters`,this._emitters,V);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${Z}: Direction or Distance properties are not allowed on emitters attached to a scene`);p.push(this._loadEmitterAsync(`${Z}/emitters/${O.index}`,O))}return Promise.all(p).then((()=>{}))}))}loadNodeAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((V,d)=>{const r=new Array;return this._loader.loadNodeAsync(V,O,(O=>{for(const Z of d.emitters){const d=y.Get(`${V}/emitters`,this._emitters,Z);r.push(this._loadEmitterAsync(`${V}/emitters/${d.index}`,d).then((()=>{for(const V of d._babylonSounds)V.attachToMesh(O),void 0==d.innerAngle&&void 0==d.outerAngle||(V.setLocalDirectionToMesh(p.m.Forward()),V.setDirectionalCone(2*Y.e.ToDegrees(void 0==d.innerAngle?Math.PI:d.innerAngle),2*Y.e.ToDegrees(void 0==d.outerAngle?Math.PI:d.outerAngle),0))})))}Z(O)})).then((V=>Promise.all(r).then((()=>V))))}))}loadAnimationAsync(V,O){return T.LoadExtensionAsync(V,O,this.name,((Z,d)=>this._loader.loadAnimationAsync(V,O).then((p=>{const r=new Array;y.Assign(d.events);for(const Y of d.events)r.push(this._loadAnimationEventAsync(`${Z}/events/${Y.index}`,V,O,Y,p));return Promise.all(r).then((()=>p))}))))}_loadClipAsync(V,O){if(O._objectURL)return O._objectURL;let Z;if(O.uri)Z=this._loader.loadUriAsync(V,O,O.uri);else{const d=y.Get(`${V}/bufferView`,this._loader.Ai.bufferViews,O.bufferView);Z=this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return O._objectURL=Z.then((V=>URL.createObjectURL(new Blob([V],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(V,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const V=new Array,Z=O.name||`emitter${O.index}`,d={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let r=0;r<O.clips.length;r++){const p=`/extensions/${this.name}/clips`,Y=y.Get(p,this._clips,O.clips[r].clip);V.push(this._loadClipAsync(`${p}/${O.clips[r].clip}`,Y).then((V=>{const p=O._babylonSounds[r]=new nO(Z,V,this._loader.babylonScene,null,d);p.refDistance=O.refDistance||1,p.maxDistance=O.maxDistance||256,p.rolloffFactor=O.rolloffFactor||1,p.distanceModel=O.distanceModel||"exponential"})))}const p=Promise.all(V).then((()=>{const V=O.clips.map((V=>V.weight||1)),Z=new eO(O.loop||!1,O._babylonSounds,V);O.innerAngle&&(Z.directionalConeInnerAngle=2*Y.e.ToDegrees(O.innerAngle)),O.outerAngle&&(Z.directionalConeOuterAngle=2*Y.e.ToDegrees(O.outerAngle)),O.volume&&(Z.volume=O.volume),O._babylonData.sound=Z}));O._babylonData={loaded:p}}return O._babylonData.loaded}_getEventAction(V,O,Z,d,p){switch(Z){case"play":return V=>{const Z=(p||0)+(V-d);O.play(Z)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${V}: Unsupported action ${Z}`)}}_loadAnimationEventAsync(V,O,Z,d,p){if(0==p.targetedAnimations.length)return Promise.resolve();const r=p.targetedAnimations[0],Y=d.k,m=y.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(V,m).then((()=>{const O=m._babylonData.sound;if(O){const Z=new lO(d.time,this._getEventAction(V,O,d.action,d.time,d.startOffset));r.animation.addEvent(Z),p.onAnimationGroupEndObservable.add((()=>{O.stop()})),p.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}h(EO),s(EO,!0,(V=>new LO(V)));const JO="MSFT_lod";class NO{constructor(V){var O;this.name=JO,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.e,this.onMaterialLODsLoadedObservable=new i.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=V,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[JO])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(JO)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let V=0;V<this._nodePromiseLODs.length;V++){const O=Promise.all(this._nodePromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Node LOD ${V}`),this._loader.log(`Loaded node LOD ${V}`)),this.onNodeLODsLoadedObservable.notifyObservers(V),V!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${V+1}`),this._loadBufferLOD(this._nodeBufferLODs,V+1),this._nodeSignalLODs[V]&&this._nodeSignalLODs[V].resolve())}));this._loader._completePromises.push(O)}for(let V=0;V<this._materialPromiseLODs.length;V++){const O=Promise.all(this._materialPromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Material LOD ${V}`),this._loader.log(`Loaded material LOD ${V}`)),this.onMaterialLODsLoadedObservable.notifyObservers(V),V!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${V+1}`),this._loadBufferLOD(this._materialBufferLODs,V+1),this._materialSignalLODs[V]&&this._materialSignalLODs[V].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(V,O){const Z=this._loader.loadSceneAsync(V,O);return this._loadBufferLOD(this._bufferLODs,0),Z}loadNodeAsync(V,O,Z){return T.LoadExtensionAsync(V,O,this.name,((V,p)=>{let r;const Y=this._getLODs(V,O,this._loader.Ai.nodes,p.ids);this._loader.logOpen(`${V}`);for(let O=0;O<Y.length;O++){const V=Y[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new d);const p=V=>{Z(V),V.If(!1)},m=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,p).then((V=>{if(0!==O){const V=Y[O-1];V._babylonTransformNode&&(this._disposeTransformNode(V._babylonTransformNode),delete V._babylonTransformNode)}return V.If(!0),V}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?r=m:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(m))}return this._loader.logClose(),r}))}_loadMaterialAsync(V,O,Z,d,p){return this._nodeIndexLOD?null:T.LoadExtensionAsync(V,O,this.name,((V,r)=>{let Y;const m=this._getLODs(V,O,this._loader.Ai.materials,r.ids);this._loader.logOpen(`${V}`);for(let O=0;O<m.length;O++){const V=m[O];0!==O&&(this._materialIndexLOD=O);const r=this._loader._loadMaterialAsync(`/materials/${V.index}`,V,Z,d,(V=>{0===O&&p(V)})).then((V=>{if(0!==O){p(V);const Z=m[O-1]._data;Z[d]&&(this._disposeMaterials([Z[d].babylonMaterial]),delete Z[d])}return V}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?Y=r:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(r))}return this._loader.logClose(),Y}))}_loadUriAsync(V,O,Z){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const p=this._nodeIndexLOD-1;return this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new d,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(V,O,Z)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const p=this._materialIndexLOD-1;return this._materialSignalLODs[p]=this._materialSignalLODs[p]||new d,this._materialSignalLODs[p].promise.then((()=>this._loader.loadUriAsync(V,O,Z)))}return null}loadBufferAsync(V,O,Z,p){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);const O=(V,O)=>{const r=Z,Y=r+p-1;let m=V[O];return m?(m.start=Math.min(m.start,r),m.end=Math.max(m.end,Y)):(m={start:r,end:Y,loaded:new d},V[O]=m),m.loaded.promise.then((V=>new Uint8Array(V.buffer,V.byteOffset+Z-m.start,p)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(V,O){const Z=V[O];Z&&(this._loader.log(`Loading buffer range [${Z.start}-${Z.end}]`),this._loader.bin.readAsync(Z.start,Z.end-Z.start+1).then((V=>{Z.loaded.resolve(V)}),(V=>{Z.loaded.reject(V)})))}_getLODs(V,O,Z,d){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const p=[];for(let r=d.length-1;r>=0;r--)if(p.push(y.Get(`${V}/ids/${d[r]}`,Z,d[r])),p.length===this.maxLODsToLoad)return p;return p.push(O),p}_disposeTransformNode(V){const O=[],Z=V.material;Z&&O.push(Z);for(const p of V.getChildMeshes())p.material&&O.push(p.material);V.dispose();const d=O.filter((V=>this._loader.babylonScene.meshes.every((O=>O.material!=V))));this._disposeMaterials(d)}_disposeMaterials(V){const O={};for(const Z of V){for(const V of Z.getActiveTextures())O[V.uniqueId]=V;Z.dispose()}for(const Z in O)for(const V of this._loader.babylonScene.materials)V.hasTexture(O[Z])&&delete O[Z];for(const Z in O)O[Z].dispose()}}h(JO),s(JO,!0,(V=>new NO(V)));const PO="MSFT_minecraftMesh";class fO{constructor(V){this.name=PO,this._loader=V,this.enabled=this._loader.isExtensionUsed(PO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtraAsync(V,O,this.name,((d,p)=>{if(p){if(!(Z instanceof v))throw new Error(`${d}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(V,O,Z);return Z.needAlphaBlending()&&(Z.forceDepthWrite=!0,Z.separateCullingPass=!0),Z.Jg=Z.forceDepthWrite,Z.twoSidedLighting=!0,p}return null}))}}h(PO),s(PO,!0,(V=>new fO(V)));const qO="MSFT_sRGBFactors";class KO{constructor(V){this.name=qO,this._loader=V,this.enabled=this._loader.isExtensionUsed(qO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,O,Z){return T.LoadExtraAsync(V,O,this.name,((d,p)=>{if(p){if(!(Z instanceof v))throw new Error(`${d}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(V,O,Z),r=Z.va().getEngine().useExactSrgbConversions;return Z.albedoTexture||Z.albedoColor.toLinearSpaceToRef(Z.albedoColor,r),Z.reflectivityTexture||Z.reflectivityColor.toLinearSpaceToRef(Z.reflectivityColor,r),p}return null}))}}h(qO),s(qO,!0,(V=>new KO(V)));var sO,hO=Z(11045);!function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(sO||(sO={}));class xO{constructor(V,O,Z){this._ownerBlock=Z,this._connectedPoint=[],this.uniqueId=(0,hO.b)(),this.connectedPointIds=[],this.name=V,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(V){if(this._connectionType===V._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||V._isSingularConnection()&&V._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(V),V._connectedPoint.push(this)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.name=this.name,V._connectionType=this._connectionType,V.connectedPointIds=[],V.className=this.getClassName();for(const O of this._connectedPoint)V.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(V){this.uniqueId=V.uniqueId,this.name=V.name,this._connectionType=V._connectionType,this.connectedPointIds=V.connectedPointIds}static Parse(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;const Z=new(Y.e.Instantiate(V.className))(V.name,V._connectionType,O);return Z.deserialize(V),Z}}class yO{constructor(V){this.value=this._toInt(V)}_toInt(V){return 0|V}add(V){return new yO(this.value+V.value)}fc(V){return new yO(this.value-V.value)}multiply(V){return new yO(Math.imul(this.value,V.value))}divide(V){return new yO(this.value/V.value)}getClassName(){return yO.ClassName}equals(V){return this.value===V.value}static Parse(V){return new yO(V.value)}}yO.ClassName="FlowGraphInteger",(0,t.f)("FlowGraphInteger",yO);class TO{constructor(V,O){this.typeName=V,this.defaultValue=O}serialize(V){V.typeName=this.typeName,V.defaultValue=this.defaultValue}static Parse(V){return new TO(V.typeName,V.defaultValue)}}const BO=new TO("any",void 0),jO=(new TO("string",""),new TO("number",0)),VZ=new TO("boolean",!1),OZ=new TO("Vector2",p.l.Zero()),ZZ=new TO("ib",p.m.Zero()),dZ=(new TO("Vector4",p.p.Zero()),new TO("Matrix",p.c.Identity())),pZ=(new TO("jb",r.b.Black()),new TO("rb",new r.f(0,0,0,0)),new TO("Quaternion",p.g.Identity()),new TO("FlowGraphInteger",new yO(0)));class rZ extends xO{constructor(V,O,Z,d){super(V,O,Z),this.richType=d}_isSingularConnection(){return 0===this.connectionType}setValue(V,O){O._setConnectionValue(this,V)}connectTo(V){super.connectTo(V)}_getValueOrDefault(V){return V._hasConnectionValue(this)?V._getConnectionValue(this):this.richType.defaultValue}getValue(V){return 1===this.connectionType?(V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(V),this._getValueOrDefault(V)):this.isConnected()?this._connectedPoint[0].getValue(V):this._getValueOrDefault(V)}getClassName(){return"FGDataConnection"}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.richType={},this.richType.serialize(V.richType)}static Parse(V,O){const Z=xO.Parse(V,O);return Z.richType=TO.Parse(V.richType),Z}}function YZ(V){return"Mesh"===V||"AbstractMesh"===V||"GroundMesh"===V||"InstanceMesh"===V||"LinesMesh"===V||"GoldbergMesh"===V||"GreasedLineMesh"===V||"TrailMesh"===V}function mZ(V){return"Vector2"===V||"ib"===V||"Vector4"===V||"Quaternion"===V||"jb"===V||"rb"===V}function aZ(V,O,Z){var d;const p=(null===O||void 0===O||null===(d=O.getClassName)||void 0===d?void 0:d.call(O))??"";YZ(p)?Z[V]={name:O.name,className:p}:mZ(p)?Z[V]={value:O.Wi(),className:p}:Z[V]=O}function RZ(V,O,Z){const d=O[V];let Y;const m=null===d||void 0===d?void 0:d.className;return Y=YZ(m)?Z.getMeshByName(d.name):mZ(m)?function(V,O){if("Vector2"===V)return p.l.Cg(O);if("ib"===V)return p.m.Cg(O);if("Vector4"===V)return p.p.Cg(O);if("Quaternion"===V)return p.g.Cg(O);if("jb"===V)return new r.b(O[0],O[1],O[2]);if("rb"===V)return new r.f(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${V}`)}(m,d.value):"Matrix"===m?p.c.Cg(d.value):m===yO.ClassName?yO.Parse(d):d&&void 0!==d.value?d.value:d,Y}(0,t.f)("FGDataConnection",rZ);class iZ{constructor(V){var O;this.config=V,this.uniqueId=(0,hO.b)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(V){}registerDataInput(V,O){const Z=new rZ(V,0,this,O);return this.dataInputs.push(Z),Z}registerDataOutput(V,O){const Z=new rZ(V,1,this,O);return this.dataOutputs.push(Z),Z}getDataInput(V){return this.dataInputs.find((O=>O.name===V))}getDataOutput(V){return this.dataOutputs.find((O=>O.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.config={},this.config&&(V.config.name=this.config.name),V.dataInputs=[],V.dataOutputs=[],V.className=this.getClassName();for(const O of this.dataInputs){const Z={};O.serialize(Z),V.dataInputs.push(Z)}for(const O of this.dataOutputs){const Z={};O.serialize(Z),V.dataOutputs.push(Z)}}getClassName(){return"FGBlock"}static Parse(V,O){const Z=Y.e.Instantiate(V.className),d={},p=O.valueParseFunction??RZ;if(V.config)for(const Y in V.config)d[Y]=p(Y,V.config,O.Cf);var r;("FGSetPropertyBlock"===(r=V.className)||"FGGetPropertyBlock"===r||"FGPlayAnimationBlock"===r||"FGMeshPickEventBlock"===r)&&(d.pathConverter=O.pathConverter);const m=new Z(d);m.uniqueId=V.uniqueId;for(let Y=0;Y<V.dataInputs.length;Y++){const O=m.getDataInput(V.dataInputs[Y].name);if(!O)throw new Error("Could not find data input with name "+V.dataInputs[Y].name+" in block "+V.className);O.deserialize(V.dataInputs[Y])}for(let Y=0;Y<V.dataOutputs.length;Y++){const O=m.getDataOutput(V.dataOutputs[Y].name);if(!O)throw new Error("Could not find data output with name "+V.dataOutputs[Y].name+" in block "+V.className);O.deserialize(V.dataOutputs[Y])}return m.metadata=V.metadata,m.deserialize&&m.deserialize(V),m}}class MZ extends xO{_isSingularConnection(){return 1===this.connectionType}_activateSignal(V){var O;0===this.connectionType?(V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(V,this),V._increaseExecutionId()):null===(O=this._connectedPoint[0])||void 0===O||O._activateSignal(V)}}(0,t.f)("FlowGraphSignalConnection",MZ);class cZ extends iZ{constructor(V){super(V),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(V){const O=new MZ(V,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(V){const O=new MZ(V,1,this);return this.signalOutputs.push(O),O}getSignalInput(V){return this.signalInputs.find((O=>O.name===V))}getSignalOutput(V){return this.signalOutputs.find((O=>O.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.signalInputs=[],V.signalOutputs=[];for(const O of this.signalInputs){const Z={};O.serialize(Z),V.signalInputs.push(Z)}for(const O of this.signalOutputs){const Z={};O.serialize(Z),V.signalOutputs.push(Z)}}deserialize(V){for(let O=0;O<V.signalInputs.length;O++){const Z=this.getSignalInput(V.signalInputs[O].name);if(!Z)throw new Error("Could not find signal input with name "+V.signalInputs[O].name+" in block "+V.className);Z.deserialize(V.signalInputs[O])}for(let O=0;O<V.signalOutputs.length;O++){const Z=this.getSignalOutput(V.signalOutputs[O].name);if(!Z)throw new Error("Could not find signal output with name "+V.signalOutputs[O].name+" in block "+V.className);Z.deserialize(V.signalOutputs[O])}}getClassName(){return"FGExecutionBlock"}}class WZ extends cZ{constructor(V){super(V),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(V){this._preparePendingTasks(V),V._addPendingBlock(this)}}class FZ extends WZ{_execute(V){V._notifyExecuteNode(this),this.out._activateSignal(V)}}class QZ{constructor(V){this.uniqueId=(0,hO.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new i.e,this._configuration=V}hasVariable(V){return V in this._userVariables}setVariable(V,O){this._userVariables[V]=O}getVariable(V){return this._userVariables[V]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(V,O){return`${V.uniqueId}_${O}`}_setExecutionVariable(V,O,Z){this._executionVariables[this._getUniqueIdPrefixedName(V,O)]=Z}_getExecutionVariable(V,O,Z){return this._hasExecutionVariable(V,O)?this._executionVariables[this._getUniqueIdPrefixedName(V,O)]:Z}_deleteExecutionVariable(V,O){delete this._executionVariables[this._getUniqueIdPrefixedName(V,O)]}_hasExecutionVariable(V,O){return this._getUniqueIdPrefixedName(V,O)in this._executionVariables}_hasConnectionValue(V){return V.uniqueId in this._connectionValues}_setConnectionValue(V,O){this._connectionValues[V.uniqueId]=O}_getConnectionValue(V){return this._connectionValues[V.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(V){this._pendingBlocks.push(V)}_removePendingBlock(V){const O=this._pendingBlocks.indexOf(V);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const V of this._pendingBlocks)V._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(V){this.onNodeExecutedObservable.notifyObservers(V)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aZ;V.uniqueId=this.uniqueId,V._userVariables={};for(const Z in this._userVariables)O(Z,this._userVariables[Z],V._userVariables);V._connectionValues={};for(const Z in this._connectionValues)O(Z,this._connectionValues[Z],V._connectionValues)}getClassName(){return"FGContext"}static Parse(V,O){const Z=O.graph.createContext(),d=O.valueParseFunction??RZ;Z.uniqueId=V.uniqueId;for(const p in V._userVariables){const O=d(p,V._userVariables,Z._configuration.Cf);Z._userVariables[p]=O}for(const p in V._connectionValues){const O=d(p,V._connectionValues,Z._configuration.Cf);Z._connectionValues[p]=O}return Z}}(0,S.c)([(0,z.K)()],QZ.prototype,"uniqueId",void 0);var bZ,UZ,HZ=Z(11349);function SZ(V,O){return!(!V.parent||V.parent!==O&&!SZ(V.parent,O))}class zZ extends FZ{constructor(V){super(V),this.config=V}_getReferencedMesh(){const V=this.config.pathConverter.convert(this.config.path),O=V.info.getObject(V.object);if(!O||!(O instanceof n.d))throw new Error("Mesh pick event block requires a valid mesh");return O}_preparePendingTasks(V){let O=V._getExecutionVariable(this,"meshPickObserver");if(!O){const Z=this._getReferencedMesh();V._setExecutionVariable(this,"mesh",Z),O=Z.va().onPointerObservable.add((O=>{var d,p,r;O.type===HZ.c.POINTERPICK&&null!==(d=O.pickInfo)&&void 0!==d&&d.pickedMesh&&((null===(p=O.pickInfo)||void 0===p?void 0:p.pickedMesh)===Z||SZ(null===(r=O.pickInfo)||void 0===r?void 0:r.pickedMesh,Z))&&this._execute(V)}));const d=Z.Xi.add((()=>this._onDispose));V._setExecutionVariable(this,"meshPickObserver",O),V._setExecutionVariable(this,"meshDisposeObserver",d)}}_onDispose(V){this._cancelPendingTasks(V),V._removePendingBlock(this)}_cancelPendingTasks(V){const O=V._getExecutionVariable(this,"mesh"),Z=V._getExecutionVariable(this,"meshPickObserver"),d=V._getExecutionVariable(this,"meshDisposeObserver");O.va().onPointerObservable.remove(Z),O.Xi.remove(d),V._deleteExecutionVariable(this,"mesh"),V._deleteExecutionVariable(this,"meshPickObserver"),V._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return zZ.ClassName}serialize(V){super.serialize(V),V.config.path=this.config.path}}zZ.ClassName="FGMeshPickEventBlock",(0,t.f)(zZ.ClassName,zZ),function(V){V[V.Stopped=0]="Stopped",V[V.Started=1]="Started"}(bZ||(bZ={}));class GZ{constructor(V){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=V.Cf,this._coordinator=V.coordinator,this._sceneDisposeObserver=this._scene.Xi.add((()=>this.dispose()))}createContext(){const V=new QZ({Cf:this._scene,coordinator:this._coordinator});return this._executionContexts.push(V),V}getContext(V){return this._executionContexts[V]}addEventBlock(V){this._eventBlocks.push(V)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const V of this._executionContexts){const O=this._getContextualOrder();for(const Z of O)Z._startPendingTasks(V)}}}_getContextualOrder(){const V=[];for(const O of this._eventBlocks)if(O.getClassName()===zZ.ClassName){const Z=O._getReferencedMesh();let d=0;for(;d<V.length;d++){const O=V[d]._getReferencedMesh();if(Z&&O&&SZ(Z,O))break}V.splice(d,0,O)}else V.push(O);return V}dispose(){if(0!==this.state){this.state=0;for(const V of this._executionContexts)V._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Xi.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(V){const O=[],Z=new Set;for(const d of this._eventBlocks)O.push(d),Z.add(d.uniqueId);for(;O.length>0;){const d=O.pop();V(d);for(const V of d.dataInputs)for(const d of V._connectedPoint)Z.has(d._ownerBlock.uniqueId)||(O.push(d._ownerBlock),Z.add(d._ownerBlock.uniqueId));if(d instanceof cZ)for(const V of d.signalOutputs)for(const d of V._connectedPoint)Z.has(d._ownerBlock.uniqueId)||(O.push(d._ownerBlock),Z.add(d._ownerBlock.uniqueId))}}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;V.allBlocks=[],this.visitAllBlocks((O=>{const Z={};O.serialize(Z),V.allBlocks.push(Z)})),V.executionContexts=[];for(const Z of this._executionContexts){const d={};Z.serialize(d,O),V.executionContexts.push(d)}}static GetDataOutConnectionByUniqueId(V,O){for(const Z of V)for(const V of Z.dataOutputs)if(V.uniqueId===O)return V;throw new Error("Could not find data out connection with unique id "+O)}static GetSignalInConnectionByUniqueId(V,O){for(const Z of V)if(Z instanceof cZ)for(const V of Z.signalInputs)if(V.uniqueId===O)return V;throw new Error("Could not find signal in connection with unique id "+O)}static Parse(V,O){const Z=O.coordinator.createGraph(),d=[],p=O.valueParseFunction??RZ;for(const r of V.allBlocks){const V=iZ.Parse(r,{Cf:O.coordinator.config.Cf,pathConverter:O.pathConverter,valueParseFunction:p});d.push(V),V instanceof FZ&&Z.addEventBlock(V)}for(const r of d){for(const V of r.dataInputs)for(const O of V.connectedPointIds){const Z=GZ.GetDataOutConnectionByUniqueId(d,O);V.connectTo(Z)}if(r instanceof cZ)for(const V of r.signalOutputs)for(const O of V.connectedPointIds){const Z=GZ.GetSignalInConnectionByUniqueId(d,O);V.connectTo(Z)}}for(const r of V.executionContexts)QZ.Parse(r,{graph:Z,valueParseFunction:p});return Z}}class wZ{constructor(V){this.config=V,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Cf.Xi.add((()=>{this.dispose()}));(wZ.SceneCoordinators.get(this.config.Cf)??[]).push(this)}createGraph(){const V=new GZ({Cf:this.config.Cf,coordinator:this});return this._flowGraphs.push(V),V}removeGraph(V){const O=this._flowGraphs.indexOf(V);-1!==O&&(V.dispose(),this._flowGraphs.splice(O,1))}start(){this._flowGraphs.forEach((V=>V.start()))}dispose(){this._flowGraphs.forEach((V=>V.dispose())),this._flowGraphs.length=0;const V=wZ.SceneCoordinators.get(this.config.Cf)??[],O=V.indexOf(this);-1!==O&&V.splice(O,1)}serialize(V,O){V._flowGraphs=[],this._flowGraphs.forEach((Z=>{const d={};Z.serialize(d,O),V._flowGraphs.push(d)}))}static Parse(V,O){var Z;const d=O.valueParseFunction??RZ,p=new wZ({Cf:O.Cf});return null===(Z=V._flowGraphs)||void 0===Z||Z.forEach((V=>{GZ.Parse(V,{coordinator:p,valueParseFunction:d,pathConverter:O.pathConverter})})),p}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(V){let O=this._customEventsMap.get(V);return O||(O=new i.e,this._customEventsMap.set(V,O)),O}notifyCustomEvent(V,O){const Z=this._customEventsMap.get(V);Z&&Z.notifyObservers(O)}}wZ.SceneCoordinators=new Map;class tZ extends FZ{_preparePendingTasks(V){if(!V._getExecutionVariable(this,"sceneReadyObserver")){const O=V.configuration.Cf.onReadyObservable.add((()=>{this._execute(V)}));V._setExecutionVariable(this,"sceneReadyObserver",O)}}_cancelPendingTasks(V){const O=V._getExecutionVariable(this,"sceneReadyObserver");V.configuration.Cf.onReadyObservable.remove(O),V._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return tZ.ClassName}}tZ.ClassName="FGSceneReadyEventBlock",(0,t.f)("FGSceneReadyEventBlock",tZ);class CZ extends FZ{_preparePendingTasks(V){if(!V._getExecutionVariable(this,"sceneBeforeRender")){const O=V.configuration.Cf.onBeforeRenderObservable.add((()=>{this._execute(V)}));V._setExecutionVariable(this,"sceneBeforeRender",O)}}_cancelPendingTasks(V){const O=V._getExecutionVariable(this,"sceneBeforeRender");V.configuration.Cf.onBeforeRenderObservable.remove(O),V._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return CZ.ClassName}}CZ.ClassName="FGSceneTickEventBlock",(0,t.f)(CZ.ClassName,CZ);class vZ extends cZ{constructor(V){super(V),this.out=this._registerSignalOutput("out")}}class AZ extends vZ{constructor(V){super(V),this.message=this.registerDataInput("message",BO)}_execute(V){const O=this.message.getValue(V);Q.b.Log(O),this.out._activateSignal(V)}getClassName(){return AZ.ClassName}}AZ.ClassName="FGConsoleLogBlock",(0,t.f)(AZ.ClassName,AZ),function(V){V[V.INIT=0]="INIT",V[V.STARTED=1]="STARTED",V[V.ENDED=2]="ENDED"}(UZ||(UZ={}));class lZ{constructor(V){this.onEachCountObservable=new i.e,this.onTimerAbortedObservable=new i.e,this.onTimerEndedObservable=new i.e,this.onStateChangedObservable=new i.e,this._observer=null,this._breakOnNextTick=!1,this._tick=V=>{const O=Date.now();this._timer=O-this._startTime;const Z={startTime:this._startTime,currentTime:O,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:V},d=this._breakOnNextTick||this._breakCondition(Z);d||this._timer>=this._timeToEnd?this._stop(Z,d):this.onEachCountObservable.notifyObservers(Z)},this._setState(0),this._contextObservable=V.contextObservable,this._observableParameters=V.observableParameters??{},this._breakCondition=V.breakCondition??(()=>!1),this._timeToEnd=V.timeout,V.onEnded&&this.onTimerEndedObservable.add(V.onEnded),V.Ph&&this.onEachCountObservable.add(V.Ph),V.onAborted&&this.onTimerAbortedObservable.add(V.onAborted)}set breakCondition(V){this._breakCondition=V}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=V,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(V){this._state=V,this.onStateChangedObservable.notifyObservers(this._state)}_stop(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),O?this.onTimerAbortedObservable.notifyObservers(V):this.onTimerEndedObservable.notifyObservers(V)}}class IZ extends WZ{constructor(V){super(V),this.timeout=this.registerDataInput("timeout",jO)}_preparePendingTasks(V){const O=this.timeout.getValue(V);if(void 0!==O&&O>=0){const Z=V._getExecutionVariable(this,"runningTimers")||[],d=V.configuration.Cf,p=new lZ({timeout:O,contextObservable:d.onBeforeRenderObservable,onEnded:()=>this._onEnded(p,V)});p.start(),Z.push(p),V._setExecutionVariable(this,"runningTimers",Z)}}_execute(V){this._startPendingTasks(V),this.out._activateSignal(V)}_onEnded(V,O){const Z=O._getExecutionVariable(this,"runningTimers")||[],d=Z.indexOf(V);-1!==d?Z.splice(d,1):Y.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),O._removePendingBlock(this),this.done._activateSignal(O)}_cancelPendingTasks(V){const O=V._getExecutionVariable(this,"runningTimers")||[];for(const Z of O)Z.dispose();V._deleteExecutionVariable(this,"runningTimers")}getClassName(){return IZ.ClassName}}IZ.ClassName="FGTimerBlock",(0,t.f)("FGTimerBlock",IZ);class gZ extends vZ{constructor(V){super(V),this.config=V;for(let O=0;O<this.config.eventData.length;O++){const V=this.config.eventData[O];this.registerDataInput(V,BO)}}_execute(V){const O=this.config.eventId,Z=this.dataInputs.map((O=>O.getValue(V)));V.configuration.coordinator.notifyCustomEvent(O,Z),this.out._activateSignal(V)}getClassName(){return gZ.ClassName}}gZ.ClassName="FGSendCustomEventBlock",(0,t.f)("FGSendCustomEventBlock",gZ);class nZ extends FZ{constructor(V){super(V),this.config=V;for(let O=0;O<this.config.eventData.length;O++){const V=this.config.eventData[O];this.registerDataOutput(V,BO)}}_preparePendingTasks(V){const O=V.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=O.add((O=>{for(let Z=0;Z<O.length;Z++)this.dataOutputs[Z].setValue(O[Z],V);this._execute(V)}))}_cancelPendingTasks(V){const O=V.configuration.coordinator.getCustomEventObservable(this.config.eventId);O?O.remove(this._eventObserver):Y.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return nZ.ClassName}serialize(V){super.serialize(V),V.eventId=this.config.eventId,V.eventData=this.config.eventData}}nZ.ClassName="FGReceiveCustomEventBlock",(0,t.f)(nZ.ClassName,nZ);class eZ extends cZ{constructor(V){super(V),this.config=V,this.outFlows=[];for(let O=0;O<this.config.numberOutputFlows;O++)this.outFlows.push(this._registerSignalOutput(`${O}`))}_execute(V){for(let O=0;O<this.config.numberOutputFlows;O++)this.outFlows[O]._activateSignal(V)}getClassName(){return eZ.ClassName}}eZ.ClassName="FGSequenceBlock",(0,t.f)(eZ.ClassName,eZ);const uZ=new RegExp(/\{(\w+)\}/g);class kZ{constructor(V,O){this.path=V,this.ownerBlock=O,this.templatedInputs=[];let Z=uZ.exec(V);for(;Z;){const[,d]=Z;this.templatedInputs.push(O.registerDataInput(d,pZ)),Z=uZ.exec(V)}}getAccessor(V,O){let Z=this.path;for(const d of this.templatedInputs){const V=d.getValue(O).value;Z=Z.replace(`{${d.name}}`,V.toString())}return V.convert(Z)}}class DZ extends iZ{constructor(V){super(V),this.config=V,this.value=this.registerDataOutput("value",BO),this.templateComponent=new kZ(V.path,this)}_updateOutputs(V){const O=this.templateComponent.getAccessor(this.config.pathConverter,V),Z=O.info.get(O.object);this.value.setValue(Z,V)}getClassName(){return DZ.ClassName}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.config.path=this.config.path}}DZ.ClassName="FGGetPropertyBlock",(0,t.f)(DZ.ClassName,DZ);class XZ extends vZ{constructor(V){super(V),this.config=V,this.a=this.registerDataInput("a",BO),this.templateComponent=new kZ(V.path,this)}_execute(V){const O=this.a.getValue(V),Z=this.templateComponent.getAccessor(this.config.pathConverter,V);Z.info.set(O,Z.object),this.out._activateSignal(V)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.config.path=this.config.path}getClassName(){return XZ.ClassName}}XZ.ClassName="FGSetPropertyBlock",(0,t.f)("FGSetPropertyBlock",XZ);const oZ="cachedOperationValue",EZ="cachedExecutionId";class LZ extends iZ{constructor(V,O){super(O),this.value=this.registerDataOutput("value",V)}_updateOutputs(V){const O=V._getExecutionVariable(this,EZ),Z=V._getExecutionVariable(this,oZ);if(void 0!==Z&&O===V.executionId)this.value.setValue(Z,V);else{const O=this._doOperation(V);V._setExecutionVariable(this,oZ,O),V._setExecutionVariable(this,EZ,V.executionId),this.value.setValue(O,V)}}}class JZ extends LZ{constructor(V,O,Z,d,p,r){super(Z,r),this._operation=d,this._className=p,this.a=this.registerDataInput("a",V),this.b=this.registerDataInput("b",O)}_doOperation(V){return this._operation(this.a.getValue(V),this.b.getValue(V))}getClassName(){return this._className}}class NZ extends LZ{constructor(V,O,Z,d){super(V,d),this._operation=O,this._className=Z}_doOperation(V){return this._operation()}getClassName(){return this._className}}class PZ extends LZ{constructor(V,O,Z,d,p){super(O,p),this._operation=Z,this._className=d,this.a=this.registerDataInput("a",V)}_doOperation(V){return this._operation(this.a.getValue(V))}getClassName(){return this._className}}class fZ extends LZ{constructor(V,O,Z,d,p,r,Y){super(d,Y),this._operation=p,this._className=r,this.a=this.registerDataInput("a",V),this.b=this.registerDataInput("b",O),this.c=this.registerDataInput("c",Z)}_doOperation(V){return this._operation(this.a.getValue(V),this.b.getValue(V),this.c.getValue(V))}getClassName(){return this._className}}function qZ(V){return V.getClassName?V.getClassName():""}function KZ(V,O){return"Vector2"===V&&"Vector2"===O||"ib"===V&&"ib"===O||"Vector4"===V&&"Vector4"===O}function sZ(V,O){return"Matrix"===V&&"Matrix"===O}function hZ(V,O){return"FlowGraphInteger"===V&&"FlowGraphInteger"===O}class xZ extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicAdd(V,O)),xZ.ClassName,V)}_polymorphicAdd(V,O){const Z=qZ(V),d=qZ(O);return KZ(Z,d)||sZ(Z,d)||hZ(Z,d)?V.add(O):V+O}}xZ.ClassName="FGAddBlock",(0,t.f)(xZ.ClassName,xZ);class yZ extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicAdd(V,O)),yZ.ClassName,V)}_polymorphicAdd(V,O){const Z=qZ(V),d=qZ(O);return KZ(Z,d)||hZ(Z,d)?V.fc(O):sZ(Z,d)?V.add(O.scale(-1)):V-O}}yZ.ClassName="FGSubBlock",(0,t.f)(yZ.ClassName,yZ);class TZ extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicMultiply(V,O)),TZ.ClassName,V)}_polymorphicMultiply(V,O){const Z=qZ(V),d=qZ(O);return KZ(Z,d)||hZ(Z,d)?V.multiply(O):sZ(Z,d)?p.c.FromValues(V.m[0]*O.m[0],V.m[4]*O.m[4],V.m[8]*O.m[8],V.m[12]*O.m[12],V.m[1]*O.m[1],V.m[5]*O.m[5],V.m[9]*O.m[9],V.m[13]*O.m[13],V.m[2]*O.m[2],V.m[6]*O.m[6],V.m[10]*O.m[10],V.m[14]*O.m[14],V.m[3]*O.m[3],V.m[7]*O.m[7],V.m[11]*O.m[11],V.m[15]*O.m[15]):V*O}}TZ.ClassName="FGMultiplyBlock",(0,t.f)(TZ.ClassName,TZ);class BZ extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicDivide(V,O)),BZ.ClassName,V)}_polymorphicDivide(V,O){const Z=qZ(V),d=qZ(O);return KZ(Z,d)||hZ(Z,d)?V.divide(O):sZ(Z,d)?p.c.FromValues(V.m[0]/O.m[0],V.m[4]/O.m[4],V.m[8]/O.m[8],V.m[12]/O.m[12],V.m[1]/O.m[1],V.m[5]/O.m[5],V.m[9]/O.m[9],V.m[13]/O.m[13],V.m[2]/O.m[2],V.m[6]/O.m[6],V.m[10]/O.m[10],V.m[14]/O.m[14],V.m[3]/O.m[3],V.m[7]/O.m[7],V.m[11]/O.m[11],V.m[15]/O.m[15]):V/O}}BZ.ClassName="FGDivideBlock",(0,t.f)(BZ.ClassName,BZ);class jZ extends NZ{constructor(V){super(jO,(()=>Math.random()),jZ.ClassName,V)}}jZ.ClassName="FGRandomBlock",(0,t.f)(jZ.ClassName,jZ);class Vd extends JZ{constructor(V){super(BO,BO,jO,((V,O)=>this._polymorphicDot(V,O)),Vd.ClassName,V)}_polymorphicDot(V,O){switch(qZ(V)){case"Vector2":return p.l.Dot(V,O);case"ib":return p.m.Dot(V,O);case"Vector4":return p.p.Dot(V,O);default:throw new Error(`Cannot get dot product of ${V} and ${O}`)}}}Vd.ClassName="FGDotBlock",(0,t.f)(Vd.ClassName,Vd);class Od extends NZ{constructor(V){super(jO,(()=>Math.E),Od.ClassName,V)}}Od.ClassName="FGEBlock",(0,t.f)(Od.ClassName,Od);class Zd extends NZ{constructor(V){super(jO,(()=>Math.PI),Zd.ClassName,V)}}Zd.ClassName="FGPIBlock",(0,t.f)(Zd.ClassName,Zd);class dd extends NZ{constructor(V){super(jO,(()=>Number.POSITIVE_INFINITY),dd.ClassName,V)}}dd.ClassName="FGInfBlock",(0,t.f)(dd.ClassName,dd);class pd extends NZ{constructor(V){super(jO,(()=>Number.NaN),pd.ClassName,V)}}function rd(V,O){switch(qZ(V)){case"FlowGraphInteger":return new yO(O(V.value));case"Vector2":return new p.l(O(V.x),O(V.y));case"ib":return new p.m(O(V.x),O(V.y),O(V.z));case"Vector4":return new p.p(O(V.x),O(V.y),O(V.z),O(V.w));case"Matrix":return p.c.FromValues(O(V.m[0]),O(V.m[4]),O(V.m[8]),O(V.m[12]),O(V.m[1]),O(V.m[5]),O(V.m[9]),O(V.m[13]),O(V.m[2]),O(V.m[6]),O(V.m[10]),O(V.m[14]),O(V.m[3]),O(V.m[7]),O(V.m[11]),O(V.m[15]));default:return O(V)}}pd.ClassName="FGNaNBlock",(0,t.f)(pd.ClassName,pd);class Yd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicAbs(V)),Yd.ClassName,V)}_polymorphicAbs(V){return rd(V,Math.abs)}}Yd.ClassName="FGAbsBlock",(0,t.f)(Yd.ClassName,Yd);class md extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicSign(V)),md.ClassName,V)}_polymorphicSign(V){return rd(V,Math.sign)}}md.ClassName="FGSignBlock",(0,t.f)(md.ClassName,md);class ad extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicTrunc(V)),ad.ClassName,V)}_polymorphicTrunc(V){return rd(V,Math.trunc)}}ad.ClassName="FGTruncBlock",(0,t.f)(ad.ClassName,ad);class Rd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicFloor(V)),Rd.ClassName,V)}_polymorphicFloor(V){return rd(V,Math.floor)}}Rd.ClassName="FGFloorBlock",(0,t.f)(Rd.ClassName,Rd);class id extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicCeiling(V)),id.ClassName,V)}_polymorphicCeiling(V){return rd(V,Math.ceil)}}id.ClassName="FGCeilBlock",(0,t.f)(id.ClassName,id);class Md extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicFract(V)),Md.ClassName,V)}_polymorphicFract(V){return rd(V,(V=>V-Math.floor(V)))}}Md.ClassName="FGFractBlock",(0,t.f)(Md.ClassName,Md);class cd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicNeg(V)),cd.ClassName,V)}_polymorphicNeg(V){return rd(V,(V=>-V))}}function Wd(V,O,Z){switch(qZ(V)){case"FlowGraphInteger":return new yO(Z(V.value,O.value));case"Vector2":return new p.l(Z(V.x,O.x),Z(V.y,O.y));case"ib":return new p.m(Z(V.x,O.x),Z(V.y,O.y),Z(V.z,O.z));case"Vector4":return new p.p(Z(V.x,O.x),Z(V.y,O.y),Z(V.z,O.z),Z(V.w,O.w));case"Matrix":return p.c.FromValues(Z(V.m[0],O.m[0]),Z(V.m[4],O.m[4]),Z(V.m[8],O.m[8]),Z(V.m[12],O.m[12]),Z(V.m[1],O.m[1]),Z(V.m[5],O.m[5]),Z(V.m[9],O.m[9]),Z(V.m[13],O.m[13]),Z(V.m[2],O.m[2]),Z(V.m[6],O.m[6]),Z(V.m[10],O.m[10]),Z(V.m[14],O.m[14]),Z(V.m[3],O.m[3]),Z(V.m[7],O.m[7]),Z(V.m[11],O.m[11]),Z(V.m[15],O.m[15]));default:return Z(V,O)}}cd.ClassName="FGNegBlock",(0,t.f)(cd.ClassName,cd);class Fd extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicRemainder(V,O)),Fd.ClassName,V)}_polymorphicRemainder(V,O){return Wd(V,O,((V,O)=>V%O))}}Fd.ClassName="FGRemainderBlock",(0,t.f)(Fd.ClassName,Fd);class Qd extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicMin(V,O)),Qd.ClassName,V)}_polymorphicMin(V,O){return Wd(V,O,Math.min)}}Qd.ClassName="FGMinBlock",(0,t.f)(Qd.ClassName,Qd);class bd extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicMax(V,O)),bd.ClassName,V)}_polymorphicMax(V,O){return Wd(V,O,Math.max)}}function Ud(V,O,Z){return Math.min(Math.max(V,Math.min(O,Z)),Math.max(O,Z))}function Hd(V,O,Z,d){switch(qZ(V)){case"FlowGraphInteger":return new yO(d(V.value,O.value,Z.value));case"Vector2":return new p.l(d(V.x,O.x,Z.x),d(V.y,O.y,Z.y));case"ib":return new p.m(d(V.x,O.x,Z.x),d(V.y,O.y,Z.y),d(V.z,O.z,Z.z));case"Vector4":return new p.p(d(V.x,O.x,Z.x),d(V.y,O.y,Z.y),d(V.z,O.z,Z.z),d(V.w,O.w,Z.w));case"Matrix":return p.c.FromValues(d(V.m[0],O.m[0],Z.m[0]),d(V.m[4],O.m[4],Z.m[4]),d(V.m[8],O.m[8],Z.m[8]),d(V.m[12],O.m[12],Z.m[12]),d(V.m[1],O.m[1],Z.m[1]),d(V.m[5],O.m[5],Z.m[5]),d(V.m[9],O.m[9],Z.m[9]),d(V.m[13],O.m[13],Z.m[13]),d(V.m[2],O.m[2],Z.m[2]),d(V.m[6],O.m[6],Z.m[6]),d(V.m[10],O.m[10],Z.m[10]),d(V.m[14],O.m[14],Z.m[14]),d(V.m[3],O.m[3],Z.m[3]),d(V.m[7],O.m[7],Z.m[7]),d(V.m[11],O.m[11],Z.m[11]),d(V.m[15],O.m[15],Z.m[15]));default:return d(V,O,Z)}}bd.ClassName="FGMaxBlock",(0,t.f)(bd.ClassName,bd);class Sd extends fZ{constructor(V){super(BO,BO,BO,BO,((V,O,Z)=>this._polymorphicClamp(V,O,Z)),Sd.ClassName,V)}_polymorphicClamp(V,O,Z){return Hd(V,O,Z,Ud)}}function zd(V){return Math.min(Math.max(V,0),1)}Sd.ClassName="FGClampBlock",(0,t.f)(Sd.ClassName,Sd);class Gd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicSaturate(V)),Gd.ClassName,V)}_polymorphicSaturate(V){return rd(V,zd)}}Gd.ClassName="FGSaturateBlock",(0,t.f)(Gd.ClassName,Gd);class wd extends fZ{constructor(V){super(BO,BO,BO,BO,((V,O,Z)=>this._polymorphicInterpolate(V,O,Z)),wd.ClassName,V)}_interpolate(V,O,Z){return(1-Z)*V+Z*O}_polymorphicInterpolate(V,O,Z){return Hd(V,O,Z,this._interpolate)}}wd.ClassName="FGInterpolateBlock",(0,t.f)(wd.ClassName,wd);class td extends JZ{constructor(V){super(BO,BO,VZ,((V,O)=>this._polymorphicEq(V,O)),td.ClassName,V)}_polymorphicEq(V,O){const Z=qZ(V),d=qZ(O);return KZ(Z,d)||sZ(Z,d)||hZ(Z,d)?V.equals(O):V===O}}function Cd(V,O,Z){const d=qZ(V);if(d===qZ(O)){if(""===d)return Z(V,O);if("FlowGraphInteger"===d)return Z(V.value,O.value);throw new Error(`Cannot compare ${V} and ${O}`)}throw new Error(`${V} and ${O} are of different types.`)}td.ClassName="FGEqBlock",(0,t.f)(td.ClassName,td);class vd extends JZ{constructor(V){super(BO,BO,VZ,((V,O)=>this._polymorphicLessThan(V,O)),vd.ClassName,V)}_polymorphicLessThan(V,O){return Cd(V,O,((V,O)=>V<O))}}vd.ClassName="FGLessThanBlock",(0,t.f)(vd.ClassName,vd);class Ad extends JZ{constructor(V){super(BO,BO,VZ,((V,O)=>this._polymorphicLessThanOrEqual(V,O)),Ad.ClassName,V)}_polymorphicLessThanOrEqual(V,O){return Cd(V,O,((V,O)=>V<=O))}}Ad.ClassName="FGLessThanOrEqualBlock";class ld extends JZ{constructor(V){super(BO,BO,VZ,((V,O)=>this._polymorphicGreaterThan(V,O)),ld.ClassName,V)}_polymorphicGreaterThan(V,O){return Cd(V,O,((V,O)=>V>O))}}ld.ClassName="FGGreaterThanBlock",(0,t.f)(ld.ClassName,ld);class Id extends JZ{constructor(V){super(BO,BO,VZ,((V,O)=>this._polymorphicGreaterThanOrEqual(V,O)),Id.ClassName,V)}_polymorphicGreaterThanOrEqual(V,O){return Cd(V,O,((V,O)=>V>=O))}}Id.ClassName="FGGreaterThanOrEqualBlock",(0,t.f)(Id.ClassName,Id);class gd extends PZ{constructor(V){super(BO,VZ,(V=>this._polymorphicIsNan(V)),gd.ClassName,V)}_polymorphicIsNan(V){const O=qZ(V);if(""===O)return isNaN(V);if("FlowGraphInteger"===O)return isNaN(V.value);throw new Error(`Cannot get NaN of ${V}`)}}gd.ClassName="FGIsNanBlock",(0,t.f)(gd.ClassName,gd);class nd extends PZ{constructor(V){super(BO,VZ,(V=>this._polymorphicIsInf(V)),nd.ClassName,V)}_polymorphicIsInf(V){const O=qZ(V);if(""===O)return!isFinite(V);if("FlowGraphInteger"===O)return!isFinite(V.value);throw new Error(`Cannot get isInf of ${V}`)}}nd.ClassName="FGIsInfBlock";class ed extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicDegToRad(V)),ed.ClassName,V)}_degToRad(V){return V*Math.PI/180}_polymorphicDegToRad(V){return rd(V,this._degToRad)}}ed.ClassName="FGDegToRadBlock",(0,t.f)(ed.ClassName,ed);class ud extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicRadToDeg(V)),ud.ClassName,V)}_radToDeg(V){return 180*V/Math.PI}_polymorphicRadToDeg(V){return rd(V,this._radToDeg)}}ud.ClassName="FGRadToDegBlock",(0,t.f)(ud.ClassName,ud);class kd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicSin(V)),kd.ClassName,V)}_polymorphicSin(V){return rd(V,Math.sin)}}kd.ClassName="FGSinBlock",(0,t.f)(kd.ClassName,kd);class Dd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicCos(V)),Dd.ClassName,V)}_polymorphicCos(V){return rd(V,Math.cos)}}Dd.ClassName="FGCosBlock",(0,t.f)(Dd.ClassName,Dd);class Xd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicTan(V)),Xd.ClassName,V)}_polymorphicTan(V){return rd(V,Math.tan)}}Xd.ClassName="FGTanBlock",(0,t.f)(Xd.ClassName,Xd);class od extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicAsin(V)),od.ClassName,V)}_polymorphicAsin(V){return rd(V,Math.asin)}}od.ClassName="FGAsinBlock",(0,t.f)(od.ClassName,od);class Ed extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicAcos(V)),Ed.ClassName,V)}_polymorphicAcos(V){return rd(V,Math.acos)}}Ed.ClassName="FGAcosBlock",(0,t.f)(Ed.ClassName,Ed);class Ld extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicAtan(V)),Ld.ClassName,V)}_polymorphicAtan(V){return rd(V,Math.atan)}}Ld.ClassName="FGAtanBlock",(0,t.f)(Ld.ClassName,Ld);class Jd extends JZ{constructor(V){super(BO,BO,BO,((V,O)=>this._polymorphicAtan2(V,O)),Jd.ClassName,V)}_polymorphicAtan2(V,O){return Wd(V,O,Math.atan2)}}Jd.ClassName="FGAtan2Block",(0,t.f)(Jd.ClassName,Jd);class Nd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicSinh(V)),Nd.ClassName,V)}_polymorphicSinh(V){return rd(V,Math.sinh)}}Nd.ClassName="FGSinhBlock",(0,t.f)(Nd.ClassName,Nd);class Pd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicCosh(V)),Pd.ClassName,V)}_polymorphicCosh(V){return rd(V,Math.cosh)}}Pd.ClassName="FGCoshBlock",(0,t.f)(Pd.ClassName,Pd);class fd extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicTanh(V)),fd.ClassName,V)}_polymorphicTanh(V){return rd(V,Math.tanh)}}fd.ClassName="FGTanhBlock",(0,t.f)(fd.ClassName,fd);class qd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicAsinh(V)),qd.ClassName,V)}_polymorphicAsinh(V){return rd(V,Math.asinh)}}qd.ClassName="FGAsinhBlock",(0,t.f)(qd.ClassName,qd);class Kd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicAcosh(V)),Kd.ClassName,V)}_polymorphicAcosh(V){return rd(V,Math.acosh)}}Kd.ClassName="FGAcoshBlock",(0,t.f)(Kd.ClassName,Kd);class sd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicAtanh(V)),sd.ClassName,V)}_polymorphicAtanh(V){return rd(V,Math.atanh)}}sd.ClassName="FGAtanhBlock",(0,t.f)(sd.ClassName,sd);class hd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicExp(V)),hd.ClassName,V)}_polymorphicExp(V){return rd(V,Math.exp)}}hd.ClassName="FGExpBlock",(0,t.f)(hd.ClassName,hd);class xd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicLog(V)),xd.ClassName,V)}_polymorphicLog(V){return rd(V,Math.log)}}xd.ClassName="FGLogBlock",(0,t.f)(xd.ClassName,xd);class yd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicLog2(V)),yd.ClassName,V)}_polymorphicLog2(V){return rd(V,Math.log2)}}yd.ClassName="FGLog2Block",(0,t.f)(yd.ClassName,yd);class Td extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicLog10(V)),Td.ClassName,V)}_polymorphicLog10(V){return rd(V,Math.log10)}}Td.ClassName="FGLog10Block",(0,t.f)(Td.ClassName,Td);class Bd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicSqrt(V)),Bd.ClassName,V)}_polymorphicSqrt(V){return rd(V,Math.sqrt)}}Bd.ClassName="FGSqrtBlock",(0,t.f)(Bd.ClassName,Bd);class jd extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicCubeRoot(V)),jd.ClassName,V)}_polymorphicCubeRoot(V){return rd(V,Math.cbrt)}}jd.ClassName="FGCubeRootBlock",(0,t.f)(jd.ClassName,jd);class Vp extends JZ{constructor(V){super(BO,jO,jO,((V,O)=>this._polymorphicPow(V,O)),Vp.ClassName,V)}_polymorphicPow(V,O){return Wd(V,O,Math.pow)}}Vp.ClassName="FGPowBlock",(0,t.f)(Vp.ClassName,Vp);class Op extends PZ{constructor(V){super(BO,jO,(V=>this._polymorphicLength(V)),Op.ClassName,V)}_polymorphicLength(V){switch(qZ(V)){case"Vector2":case"ib":case"Vector4":return V.length();default:throw new Error(`Cannot compute length of value ${V}`)}}}Op.ClassName="FGLengthBlock",(0,t.f)(Op.ClassName,Op);class Zp extends PZ{constructor(V){super(BO,BO,(V=>this._polymorphicNormalize(V)),Zp.ClassName,V)}_polymorphicNormalize(V){switch(qZ(V)){case"Vector2":case"ib":case"Vector4":return V.normalize();default:throw new Error(`Cannot normalize value ${V}`)}}}Zp.ClassName="FGNormalizeBlock",(0,t.f)(Zp.ClassName,Zp);class dp extends JZ{constructor(V){super(ZZ,ZZ,ZZ,((V,O)=>p.m.Cross(V,O)),dp.ClassName,V)}}dp.ClassName="FGCrossBlock",(0,t.f)(dp.ClassName,dp);class pp extends JZ{constructor(V){super(OZ,jO,OZ,((V,O)=>p.l.Transform(V,p.c.RotationZ(O))),pp.ClassName,V)}}pp.ClassName="FGRotate2DBlock",(0,t.f)(pp.ClassName,pp);class rp extends fZ{constructor(V){super(ZZ,ZZ,jO,ZZ,((V,O,Z)=>p.m.TransformCoordinates(V,p.c.RotationAxis(O,Z))),rp.ClassName,V)}}rp.ClassName="FGRotate3DBlock",(0,t.f)(rp.ClassName,rp);class Yp extends PZ{constructor(V){super(dZ,dZ,(V=>p.c.Transpose(V)),Yp.ClassName,V)}}Yp.ClassName="FGTransposeBlock",(0,t.f)(Yp.ClassName,Yp);class mp extends PZ{constructor(V){super(dZ,jO,(V=>V.determinant()),mp.ClassName,V)}}mp.ClassName="FGDeterminantBlock",(0,t.f)(mp.ClassName,mp);class ap extends PZ{constructor(V){super(dZ,dZ,(V=>p.c.Invert(V)),ap.ClassName,V)}}ap.ClassName="FGInvertMatrixBlock",(0,t.f)(ap.ClassName,ap);class Rp extends JZ{constructor(V){super(dZ,dZ,dZ,((V,O)=>O.multiply(V)),Rp.ClassName,V)}}Rp.ClassName="FGMatMulBlock",(0,t.f)(Rp.ClassName,Rp);class ip extends PZ{constructor(V){super(pZ,pZ,(V=>new yO(~V.value)),ip.ClassName,V)}}ip.ClassName="FGBitwiseNotBlock",(0,t.f)(ip.ClassName,ip);class Mp extends JZ{constructor(V){super(pZ,pZ,pZ,((V,O)=>new yO(V.value&O.value)),Mp.ClassName,V)}}Mp.ClassName="FGBitwiseAndBlock",(0,t.f)(Mp.ClassName,Mp);class cp extends JZ{constructor(V){super(pZ,pZ,pZ,((V,O)=>new yO(V.value|O.value)),cp.ClassName,V)}}cp.ClassName="FGBitwiseOrBlock",(0,t.f)(cp.ClassName,cp);class Wp extends JZ{constructor(V){super(pZ,pZ,pZ,((V,O)=>new yO(V.value^O.value)),Wp.ClassName,V)}}Wp.ClassName="FGBitwiseXorBlock",(0,t.f)(Wp.ClassName,Wp);class Fp extends JZ{constructor(V){super(pZ,pZ,pZ,((V,O)=>new yO(V.value<<O.value)),Fp.ClassName,V)}}Fp.ClassName="FGBitwiseLeftShiftBlock",(0,t.f)(Fp.ClassName,Fp);class Qp extends JZ{constructor(V){super(pZ,pZ,pZ,((V,O)=>new yO(V.value>>O.value)),Qp.ClassName,V)}}Qp.ClassName="FGBitwiseRightShiftBlock",(0,t.f)(Qp.ClassName,Qp);class bp extends PZ{constructor(V){super(pZ,pZ,(V=>new yO(Math.clz32(V.value))),bp.ClassName,V)}}bp.ClassName="FGCountLeadingZerosBlock",(0,t.f)(bp.ClassName,bp);class Up extends PZ{constructor(V){super(pZ,pZ,(V=>new yO(V.value?31-Math.clz32(V.value&-V.value):32)),Up.ClassName,V)}}Up.ClassName="FGCountTrailingZerosBlock",(0,t.f)(Up.ClassName,Up);class Hp extends PZ{constructor(V){super(pZ,pZ,(V=>new yO(function(V){let O=0;for(;V;)O+=1&V,V>>=1;return O}(V.value))),Hp.ClassName,V)}}Hp.ClassName="FGCountOneBitsBlock",(0,t.f)(Hp.ClassName,Hp);class Sp extends vZ{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new yO(0)};super(V),this.config=V,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",pZ),this.value=this.registerDataOutput("value",pZ)}_execute(V,O){if(O===this.reset)this.value.setValue(this.config.startIndex,V);else{const O=this.value.getValue(V);O.value<this.n.getValue(V).value&&(this.value.setValue(new yO(O.value+1),V),this.out._activateSignal(V))}}getClassName(){return Sp.ClassName}}Sp.ClassName="FGDoNBlock",(0,t.f)(Sp.ClassName,Sp);class zp extends iZ{constructor(V){super(V),this.config=V,this.output=this.registerDataOutput(V.variableName,BO)}_updateOutputs(V){const O=this.config.variableName;V.hasVariable(O)&&this.output.setValue(V.getVariable(O),V)}getClassName(){return zp.ClassName}serialize(V){super.serialize(V),V.config.variableName=this.config.variableName}}zp.ClassName="FGGetVariableBlock",(0,t.f)(zp.ClassName,zp);class Gp extends vZ{constructor(V){super(V),this.config=V,this.input=this.registerDataInput(V.variableName,BO)}_execute(V){const O=this.config.variableName,Z=this.input.getValue(V);V.setVariable(O,Z),this.out._activateSignal(V)}getClassName(){return Gp.ClassName}}Gp.ClassName="FGSetVariableBlock",(0,t.f)(Gp.ClassName,Gp);class wp extends vZ{constructor(V){super(V),this.config=V,this.condition=this.registerDataInput("condition",VZ),this.loopBody=this._registerSignalOutput("loopBody")}_execute(V,O){var Z;let d=this.condition.getValue(V);for(null!==(Z=this.config)&&void 0!==Z&&Z.isDo&&!d&&this.loopBody._activateSignal(V);d;)this.loopBody._activateSignal(V),d=this.condition.getValue(V);this.out._activateSignal(V)}getClassName(){return wp.ClassName}serialize(V){var O;super.serialize(V),V.isDo=null===(O=this.config)||void 0===O?void 0:O.isDo}}wp.ClassName="FGWhileLoopBlock",(0,t.f)(wp.ClassName,wp);const tp={"lifecycle/onStart":tZ.ClassName,"lifecycle/onTick":CZ.ClassName,log:AZ.ClassName,"flow/delay":IZ.ClassName,"customEvent/send":gZ.ClassName,"customEvent/receive":nZ.ClassName,"flow/sequence":eZ.ClassName,"world/get":DZ.ClassName,"world/set":XZ.ClassName,"flow/doN":Sp.ClassName,"variable/get":zp.ClassName,"variable/set":Gp.ClassName,"flow/whileLoop":wp.ClassName,"math/random":jZ.ClassName,"math/e":Od.ClassName,"math/pi":Zd.ClassName,"math/inf":dd.ClassName,"math/nan":pd.ClassName,"math/abs":Yd.ClassName,"math/sign":md.ClassName,"math/trunc":ad.ClassName,"math/floor":Rd.ClassName,"math/ceil":id.ClassName,"math/fract":Md.ClassName,"math/neg":cd.ClassName,"math/add":xZ.ClassName,"math/sub":yZ.ClassName,"math/mul":TZ.ClassName,"math/div":BZ.ClassName,"math/rem":Fd.ClassName,"math/min":Qd.ClassName,"math/max":bd.ClassName,"math/clamp":Sd.ClassName,"math/saturate":Gd.ClassName,"math/mix":wd.ClassName,"math/eq":td.ClassName,"math/lt":vd.ClassName,"math/le":Ad.ClassName,"math/gt":ld.ClassName,"math/ge":Id.ClassName,"math/isnan":gd.ClassName,"math/isinf":nd.ClassName,"math/rad":ed.ClassName,"math/deg":ud.ClassName,"math/sin":kd.ClassName,"math/cos":Dd.ClassName,"math/tan":Xd.ClassName,"math/asin":od.ClassName,"math/acos":Ed.ClassName,"math/atan":Ld.ClassName,"math/atan2":Jd.ClassName,"math/sinh":Nd.ClassName,"math/cosh":Pd.ClassName,"math/tanh":fd.ClassName,"math/asinh":qd.ClassName,"math/acosh":Kd.ClassName,"math/atanh":sd.ClassName,"math/exp":hd.ClassName,"math/log":xd.ClassName,"math/log2":yd.ClassName,"math/log10":Td.ClassName,"math/sqrt":Bd.ClassName,"math/cbrt":jd.ClassName,"math/pow":Vp.ClassName,"math/length":Op.ClassName,"math/normalize":Zp.ClassName,"math/dot":Vd.ClassName,"math/cross":dp.ClassName,"math/rotate2d":pp.ClassName,"math/rotate3d":rp.ClassName,"math/transpose":Yp.ClassName,"math/determinant":mp.ClassName,"math/inverse":ap.ClassName,"math/matmul":Rp.ClassName,"math/not":ip.ClassName,"math/and":Mp.ClassName,"math/or":cp.ClassName,"math/xor":Wp.ClassName,"math/asr":Qp.ClassName,"math/lsl":Fp.ClassName,"math/clz":bp.ClassName,"math/ctz":Up.ClassName,"math/popcnt":Hp.ClassName},Cp={float2:"Vector2",float3:"ib",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function vp(V,O,Z){if(void 0!==V.type){const d=O.types&&O.types[V.type];if(!d)throw new Error(`${Z}: Unknown type: ${V.type}`);const p=d.signature;if(!p)throw new Error(`${Z}: Type ${V.type} has no signature`);const r=Cp[p];return{value:V.value,className:r}}return V.value}function Ap(V,O,Z){const d=tp[O.type];if(!d)throw new Error(`/extensions/KHR_interactivity/nodes/${V}: Unknown block type: ${O.type}`);const p=V.toString(),r=function(V,O,Z){const d={},p=V.configuration??[];for(const r of p)if("customEvent"===r.id){const V=O.customEvents&&O.customEvents[r.value];if(!V)throw new Error(`/extensions/KHR_interactivity/nodes/${Z}: Unknown custom event: ${r.value}`);d.eventId=V.id,d.eventData=V.values.map((V=>V.id))}else if("variable"===r.id){const V=O.variables&&O.variables[r.value];if(!V)throw new Error(`/extensions/KHR_interactivity/nodes/${Z}: Unknown variable: ${r.value}`);d.variableName=V.id}else if("path"===r.id){const V=r.value;d.path=V}else d[r.id]=vp(r,O,`/extensions/KHR_interactivity/nodes/${Z}`);return d}(O,Z,p);return{className:d,config:r,uniqueId:p,metadata:O.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class lp extends tO{constructor(V){super(V,gp)}}const Ip={__array__:{__target__:!0,translation:{type:"ib",get:V=>V._babylonTransformNode.position,set:(V,O)=>{O._babylonTransformNode.position=V},getObject:V=>V._babylonTransformNode}}},gp={nodes:Ip},np="KHR_interactivity";class ep{constructor(V){this._loader=V,this.name=np,this.enabled=this._loader.isExtensionUsed(np),this._pathConverter=new lp(this._loader.Ai)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var V;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,Z=function(V){const O={uniqueId:(0,hO.b)(),_userVariables:{},_connectionValues:{}},Z=[O],d=[];for(let r=0;r<V.nodes.length;r++){const O=Ap(r,V.nodes[r],V);d.push(O)}for(let r=0;r<V.nodes.length;r++){const Z=V.nodes[r],p=d[r],Y=Z.flows??[];for(const V of Y){const O=V.id,Z={uniqueId:(0,hO.b)(),name:O,_connectionType:1,connectedPointIds:[]};p.signalOutputs.push(Z);const Y=V.node,m=V.socket,a=d[Y];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${r}: Could not find node with id ${Y} that connects its input with with node ${r}'s output ${O}`);let R=a.signalInputs.find((V=>V.name===m));R||(R={uniqueId:(0,hO.b)(),name:m,_connectionType:0,connectedPointIds:[]},a.signalInputs.push(R)),R.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(R.uniqueId)}const m=Z.values??[];for(const a of m){const Z=a.id,Y={uniqueId:(0,hO.b)(),name:Z,_connectionType:0,connectedPointIds:[]};if(p.dataInputs.push(Y),void 0!==a.value){const Z=vp(a,V,`/extensions/KHR_interactivity/nodes/${r}`);O._connectionValues[Y.uniqueId]=Z}else{if(void 0===a.node||void 0===a.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${r}: Invalid socket ${Z} in node ${r}`);{const V=a.node,O=a.socket,p=d[V];if(!p)throw new Error(`/extensions/KHR_interactivity/nodes/${r}: Could not find node with id ${V} that connects its output with node${r}'s input ${Z}`);let m=p.dataOutputs.find((V=>V.name===O));m||(m={uniqueId:(0,hO.b)(),name:O,_connectionType:1,connectedPointIds:[]},p.dataOutputs.push(m)),Y.connectedPointIds.push(m.uniqueId),m.connectedPointIds.push(Y.uniqueId)}}}}const p=V.variables??[];for(let r=0;r<p.length;r++){const Z=p[r],d=Z.id;O._userVariables[d]=vp(Z,V,`/extensions/KHR_interactivity/variables/${r}`)}return{allBlocks:d,executionContexts:Z}}(null===(V=this._loader.Ai.extensions)||void 0===V?void 0:V.KHR_interactivity),d=new wZ({Cf:O});GZ.Parse(Z,{coordinator:d,pathConverter:this._pathConverter}),d.start()}}h(np),s(np,!0,(V=>new ep(V)));const up="KHR_node_visibility";class kp{constructor(V){this.name=up,this._loader=V,this.enabled=V.isExtensionUsed(up)}async onReady(){var V;null===(V=this._loader.Ai.nodes)||void 0===V||V.forEach((V=>{var O,Z,d,p;(null===(O=V._primitiveBabylonMeshes)||void 0===O||O.forEach((V=>{V.inheritVisibility=!0})),null!==(Z=V.extensions)&&void 0!==Z&&Z.KHR_node_visibility)&&(!1===(null===(d=V.extensions)||void 0===d?void 0:d.KHR_node_visibility.visible)&&(V._babylonTransformNode&&(V._babylonTransformNode.isVisible=!1),null===(p=V._primitiveBabylonMeshes)||void 0===p||p.forEach((V=>{V.isVisible=!1}))))}))}dispose(){this._loader=null}}h(up),s(up,!0,(V=>new kp(V)));const Dp="ExtrasAsMetadata";class Xp{_assignExtras(V,O){if(O.extras&&Object.keys(O.extras).length>0){const Z=V.metadata=V.metadata||{};(Z.Ai=Z.Ai||{}).extras=O.extras}}constructor(V){this.name=Dp,this.enabled=!0,this._loader=V}dispose(){this._loader=null}loadNodeAsync(V,O,Z){return this._loader.loadNodeAsync(V,O,(V=>{this._assignExtras(V,O),Z(V)}))}loadCameraAsync(V,O,Z){return this._loader.loadCameraAsync(V,O,(V=>{this._assignExtras(V,O),Z(V)}))}createMaterial(V,O,Z){const d=this._loader.createMaterial(V,O,Z);return this._assignExtras(d,O),d}}h(Dp),s(Dp,!1,(V=>new Xp(V)))},12188:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>n,e:()=>C,i:()=>t,k:()=>v});var d=Z(10902),p=Z(10900),r=Z(11616),Y=Z(11508),m=Z(11556),a=Z(11552),R=Z(10914),i=Z(10942),M=Z(12190),c=Z(12193),W=Z(11519);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.bj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Rj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture=V}getNodes(){let V=[];return V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes),this.skeletons.forEach((O=>V=V.concat(O.bones))),V}}class Q extends F{}class b{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((V=>{V.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((V=>{V.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((V=>{V.dispose()})),this.animationGroups.length=0}}class U extends F{constructor(V){super(),this._wasAddedToScene=!1,(V=V||i.e.LastCreatedScene)&&(this.Cf=V,this.proceduralTextures=[],V.Xi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=V.getEngine().onContextRestoredObservable.add((()=>{for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();for(const V of this.bj)V.rebuild();for(const V of this.textures)V._rebuild()})))}_topologicalSort(V){const O=new Map;for(const Y of V)O.set(Y.uniqueId,Y);const Z={dependsOn:new Map,dependedBy:new Map};for(const Y of V){const V=Y.uniqueId;Z.dependsOn.set(V,new Set),Z.dependedBy.set(V,new Set)}for(const Y of V){const V=Y.uniqueId,d=Z.dependsOn.get(V);if(Y instanceof M.b){const p=Y.sourceMesh;O.has(p.uniqueId)&&(d.add(p.uniqueId),Z.dependedBy.get(p.uniqueId).add(V))}const p=Z.dependedBy.get(V);for(const r of Y.getDescendants()){const d=r.uniqueId;if(O.has(d)){p.add(d);Z.dependsOn.get(d).add(V)}}}const d=[],p=[];for(const Y of V){const V=Y.uniqueId;0===Z.dependsOn.get(V).size&&(p.push(Y),O.delete(V))}const r=p;for(;r.length>0;){const V=r.shift();d.push(V);const p=Z.dependedBy.get(V.uniqueId);for(const d of Array.from(p.values())){const p=Z.dependsOn.get(d);p.delete(V.uniqueId),0===p.size&&O.get(d)&&(r.push(O.get(d)),O.delete(d))}}return O.size>0&&(R.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((V=>R.b.Error(V.name)))),d}_addNodeAndDescendantsToList(V,O,Z,d){if(Z&&(!d||d(Z))&&!O.has(Z.uniqueId)){V.push(Z),O.add(Z.uniqueId);for(const p of Z.getDescendants(!0))this._addNodeAndDescendantsToList(V,O,p,d)}}_isNodeInContainer(V){return V instanceof a.d&&-1!==this.meshes.indexOf(V)||(V instanceof m.b&&-1!==this.transformNodes.indexOf(V)||(V instanceof c.d&&-1!==this.lights.indexOf(V)||V instanceof W.d&&-1!==this.cameras.indexOf(V)))}_isValidHierarchy(){for(const V of this.meshes)if(V.parent&&!this._isNodeInContainer(V.parent))return R.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.transformNodes)if(V.parent&&!this._isNodeInContainer(V.parent))return R.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.lights)if(V.parent&&!this._isNodeInContainer(V.parent))return R.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.cameras)if(V.parent&&!this._isNodeInContainer(V.parent))return R.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(V){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||p.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const d={},r={},m=new b,a=[],R=[],i={doNotInstantiate:!0,...Z},M=[],c=new Set;for(const p of this.transformNodes)null===p.parent&&this._addNodeAndDescendantsToList(M,c,p,i.predicate);for(const p of this.meshes)null===p.parent&&this._addNodeAndDescendantsToList(M,c,p,i.predicate);const W=this._topologicalSort(M),F=(Z,p)=>{if(((O,Z)=>{if(d[O.uniqueId]=Z.uniqueId,r[Z.uniqueId]=Z,V&&(Z.name=V(O.name)),Z instanceof Y.c){const V=Z;if(V.morphTargetManager){const Z=O.morphTargetManager;V.morphTargetManager=Z.clone();for(let O=0;O<Z.numTargets;O++){const p=Z.getTarget(O),Y=V.morphTargetManager.getTarget(O);d[p.uniqueId]=Y.uniqueId,r[Y.uniqueId]=Y}}}})(Z,p),Z.parent){const V=d[Z.parent.uniqueId],O=r[V];p.parent=O||Z.parent}if(p.position&&Z.position&&p.position.p(Z.position),p.rotationQuaternion&&Z.rotationQuaternion&&p.rotationQuaternion.p(Z.rotationQuaternion),p.rotation&&Z.rotation&&p.rotation.p(Z.rotation),p.Af&&Z.Af&&p.Af.p(Z.Af),p.material){const Y=p;if(Y.material)if(O){const O=Z.material;if(-1===R.indexOf(O)){let Z=O.clone(V?V(O.name):"Clone of "+O.name);if(R.push(O),d[O.uniqueId]=Z.uniqueId,r[Z.uniqueId]=Z,"MultiMaterial"===O.getClassName()){const p=O;for(const O of p.Gf)O&&(Z=O.clone(V?V(O.name):"Clone of "+O.name),R.push(O),d[O.uniqueId]=Z.uniqueId,r[Z.uniqueId]=Z);p.Gf=p.Gf.map((V=>V&&r[d[V.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=r[d[O.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.Cf.multiMaterials.indexOf(Y.material)&&this.Cf.addMultiMaterial(Y.material):-1===this.Cf.materials.indexOf(Y.material)&&this.Cf.addMaterial(Y.material)}null===p.parent&&m.rootNodes.push(p)};return W.forEach((V=>{if("InstancedMesh"===V.getClassName()){const O=V,Z=O.sourceMesh,p=d[Z.uniqueId],Y=("number"===typeof p?r[p]:Z).Vc(O.name);F(O,Y)}else{let O=!0;"xb"===V.getClassName()||"Node"===V.getClassName()||V.skeleton||!V.getTotalVertices||0===V.getTotalVertices()?O=!1:i.doNotInstantiate&&(O="function"===typeof i.doNotInstantiate?!i.doNotInstantiate(V):!i.doNotInstantiate);const Z=O?V.Vc(`instance of ${V.name}`):V.clone(`Clone of ${V.name}`,null,!0);if(!Z)throw new Error(`Could not clone or instantiate node on Asset Container ${V.name}`);F(V,Z)}})),this.skeletons.forEach((O=>{if(i.predicate&&!i.predicate(O))return;const Z=O.clone(V?V(O.name):"Clone of "+O.name);for(const V of this.meshes)if(V.skeleton===O&&!V.isAnInstance){const O=r[d[V.uniqueId]];if(!O||O.isAnInstance)continue;if(O.skeleton=Z,-1!==a.indexOf(Z))continue;a.push(Z);for(const V of Z.bones)V._linkedTransformNode&&(V._linkedTransformNode=r[d[V._linkedTransformNode.uniqueId]])}m.skeletons.push(Z)})),this.animationGroups.forEach((O=>{if(i.predicate&&!i.predicate(O))return;const Z=O.clone(V?V(O.name):"Clone of "+O.name,(V=>r[d[V.uniqueId]]||V));m.animationGroups.push(Z)})),m}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||p.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Cf.environmentTexture=this.environmentTexture);for(const V of this.Cf._serializableComponents)V.addFromContainer(this);this.Cf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];this.cameras.forEach((Z=>{V&&!V(Z)||(this.Cf.addCamera(Z),O.push(Z))})),this.lights.forEach((Z=>{V&&!V(Z)||(this.Cf.addLight(Z),O.push(Z))})),this.meshes.forEach((Z=>{V&&!V(Z)||(this.Cf.Yh(Z),O.push(Z))})),this.skeletons.forEach((O=>{V&&!V(O)||this.Cf.addSkeleton(O)})),this.animations.forEach((O=>{V&&!V(O)||this.Cf.addAnimation(O)})),this.animationGroups.forEach((O=>{V&&!V(O)||this.Cf.addAnimationGroup(O)})),this.multiMaterials.forEach((O=>{V&&!V(O)||this.Cf.addMultiMaterial(O)})),this.materials.forEach((O=>{V&&!V(O)||this.Cf.addMaterial(O)})),this.morphTargetManagers.forEach((O=>{V&&!V(O)||this.Cf.addMorphTargetManager(O)})),this.geometries.forEach((O=>{V&&!V(O)||this.Cf.addGeometry(O)})),this.transformNodes.forEach((Z=>{V&&!V(Z)||(this.Cf.addTransformNode(Z),O.push(Z))})),this.actionManagers.forEach((O=>{V&&!V(O)||this.Cf.addActionManager(O)})),this.textures.forEach((O=>{V&&!V(O)||this.Cf.addTexture(O)})),this.reflectionProbes.forEach((O=>{V&&!V(O)||this.Cf.addReflectionProbe(O)}));for(const Z of O)Z.parent&&-1===this.Cf.getNodes().indexOf(Z.parent)&&(Z.setParent?Z.setParent(null):Z.parent=null)}removeAllFromScene(){this._isValidHierarchy()||p.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Cf.environmentTexture&&(this.Cf.environmentTexture=null);for(const V of this.Cf._serializableComponents)V.removeFromContainer(this)}removeFromScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((O=>{V&&!V(O)||this.Cf.removeCamera(O)})),this.lights.forEach((O=>{V&&!V(O)||this.Cf.removeLight(O)})),this.meshes.forEach((O=>{V&&!V(O)||this.Cf.Kg(O,!0)})),this.skeletons.forEach((O=>{V&&!V(O)||this.Cf.removeSkeleton(O)})),this.animations.forEach((O=>{V&&!V(O)||this.Cf.removeAnimation(O)})),this.animationGroups.forEach((O=>{V&&!V(O)||this.Cf.removeAnimationGroup(O)})),this.multiMaterials.forEach((O=>{V&&!V(O)||this.Cf.removeMultiMaterial(O)})),this.materials.forEach((O=>{V&&!V(O)||this.Cf.removeMaterial(O)})),this.morphTargetManagers.forEach((O=>{V&&!V(O)||this.Cf.removeMorphTargetManager(O)})),this.geometries.forEach((O=>{V&&!V(O)||this.Cf.removeGeometry(O)})),this.transformNodes.forEach((O=>{V&&!V(O)||this.Cf.removeTransformNode(O)})),this.actionManagers.forEach((O=>{V&&!V(O)||this.Cf.removeActionManager(O)})),this.textures.forEach((O=>{V&&!V(O)||this.Cf.removeTexture(O)})),this.reflectionProbes.forEach((O=>{V&&!V(O)||this.Cf.removeReflectionProbe(O)}))}dispose(){this.cameras.slice(0).forEach((V=>{V.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((V=>{V.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((V=>{V.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((V=>{V.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((V=>{V.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((V=>{V.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((V=>{V.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((V=>{V.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((V=>{V.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((V=>{V.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((V=>{V.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((V=>{V.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((V=>{V.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const V of this.Cf._serializableComponents)V.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Cf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(V,O,Z){if(V&&O)for(const d of V){let V=!0;if(Z)for(const O of Z)if(d===O){V=!1;break}V&&(O.push(d),d._parentContainer=this)}}moveAllFromScene(V){this._wasAddedToScene=!1,void 0===V&&(V=new Q);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.Cf[O],this[O],V[O]));this.environmentTexture=this.Cf.environmentTexture,this.removeAllFromScene()}createRootMesh(){const V=new Y.c("assetContainerRootMesh",this.Cf);return this.meshes.forEach((O=>{O.parent||V.addChild(O)})),this.meshes.unshift(V),V}mergeAnimationsTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.e.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!V)return R.b.Error("No scene available to merge animations to"),[];const d=Z||(O=>{let Z=null;const d=O.animations.length?O.animations[0].targetProperty:"",p=O.name.split(".").join("").split("_primitive")[0];switch(d){case"position":case"rotationQuaternion":Z=V.getTransformNodeByName(O.name)||V.getTransformNodeByName(p);break;case"influence":Z=V.getMorphTargetByName(O.name)||V.getMorphTargetByName(p);break;default:Z=V.getNodeByName(O.name)||V.getNodeByName(p)}return Z});this.getNodes().forEach((V=>{const O=d(V);if(null!==O){for(const Z of V.animations){const V=O.animations.filter((V=>V.targetProperty===Z.targetProperty));for(const Z of V){const V=O.animations.indexOf(Z,0);V>-1&&O.animations.splice(V,1)}}O.animations=O.animations.concat(V.animations)}}));const p=[];return this.animationGroups.slice().forEach((V=>{p.push(V.clone(V.name,d)),V.animatables.forEach((V=>{V.stop()}))})),O.forEach((O=>{const Z=d(O.target);Z&&(V.beginAnimation(Z,O.fromFrame,O.toFrame,O.loopAnimation,O.speedRatio,O.onAnimationEnd?O.onAnimationEnd:void 0,void 0,!0,void 0,O.onAnimationLoop?O.onAnimationLoop:void 0),V.stopAnimation(O.target))})),p}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.transformNodes.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.lights.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.cameras.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)}))}addAllAssetsToContainer(V){if(!V)return;const O=[],Z=new Set;for(O.push(V);O.length>0;){const V=O.pop();if(V instanceof Y.c?(V.oj&&-1===this.geometries.indexOf(V.oj)&&this.geometries.push(V.oj),this.meshes.push(V)):V instanceof m.b?this.transformNodes.push(V):V instanceof c.d?this.lights.push(V):V instanceof W.d&&this.cameras.push(V),V instanceof a.d){if(V.material&&-1===this.materials.indexOf(V.material)){this.materials.push(V.material);for(const O of V.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}V.skeleton&&-1===this.skeletons.indexOf(V.skeleton)&&this.skeletons.push(V.skeleton),V.morphTargetManager&&-1===this.morphTargetManagers.indexOf(V.morphTargetManager)&&this.morphTargetManagers.push(V.morphTargetManager)}for(const d of V.getChildren())Z.has(d)||O.push(d);Z.add(V)}this.populateRootNodes()}}var H=Z(10959);class S{constructor(V){this.byteOffset=0,this.buffer=V}loadAsync(V){return this.buffer.readAsync(this.byteOffset,V).then((V=>{this._dataView=new DataView(V.buffer,V.byteOffset,V.byteLength),this._dataByteOffset=0}))}readUint32(){const V=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,V}readUint8Array(V){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,V);return this._dataByteOffset+=V,this.byteOffset+=V,O}readString(V){return(0,H.i)(this.readUint8Array(V))}skipBytes(V){this._dataByteOffset+=V,this.byteOffset+=V}}var z=Z(12196);const G="Z2xURg",w={name:"Ai",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:V=>-1!==V.indexOf("asset")&&-1!==V.indexOf("version")||V.startsWith("data:base64,"+G)||V.startsWith("data:;base64,"+G)||V.startsWith("data:application/octet-stream;base64,"+G)||V.startsWith("data:model/gltf-binary;base64,"+G)};var t,C,v,A=Z(10947),l=Z(10951);function I(V,O,Z){try{return Promise.resolve(new Uint8Array(V,O,Z))}catch(d){return Promise.reject(d)}}!function(V){V[V.AUTO=0]="AUTO",V[V.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(t||(t={})),function(V){V[V.NONE=0]="NONE",V[V.FIRST=1]="FIRST",V[V.ALL=2]="ALL"}(C||(C={})),function(V){V[V.LOADING=0]="LOADING",V[V.READY=1]="READY",V[V.COMPLETE=2]="COMPLETE"}(v||(v={}));class g{constructor(){this.coordinateSystemMode=t.AUTO,this.animationStartMode=C.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=V=>Promise.resolve(V),this.extensionOptions={}}p(V){V&&(this.onParsed=V.onParsed,this.coordinateSystemMode=V.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=V.animationStartMode??this.animationStartMode,this.loadNodeAnimations=V.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=V.loadSkins??this.loadSkins,this.loadMorphTargets=V.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=V.compileMaterials??this.compileMaterials,this.useClipPlane=V.useClipPlane??this.useClipPlane,this.compileShadowGenerators=V.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=V.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=V.useRangeRequests??this.useRangeRequests,this.createInstances=V.createInstances??this.createInstances,this.alwaysComputeBoundingBox=V.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=V.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=V.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=V.skipMaterials??this.skipMaterials,this.useSRGBBuffers=V.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=V.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=V.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=V.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=V.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=V.customRootNode,this.onMeshLoaded=V.onMeshLoaded,this.onSkinLoaded=V.onSkinLoaded,this.onTextureLoaded=V.onTextureLoaded,this.onMaterialLoaded=V.onMaterialLoaded,this.onCameraLoaded=V.onCameraLoaded,this.extensionOptions=V.extensionOptions??this.extensionOptions)}}class n extends g{constructor(V){super(),this.onParsedObservable=new d.e,this.onMeshLoadedObservable=new d.e,this.onSkinLoadedObservable=new d.e,this.onTextureLoadedObservable=new d.e,this.onMaterialLoadedObservable=new d.e,this.onCameraLoadedObservable=new d.e,this.onCompleteObservable=new d.e,this.onErrorObservable=new d.e,this.Xi=new d.e,this.onExtensionLoadedObservable=new d.e,this.validate=!1,this.onValidatedObservable=new d.e,this._loader=null,this._state=null,this._requests=new Array,this.name=w.name,this.extensions=w.extensions,this.onLoaderStateChangedObservable=new d.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(V)}set onParsed(V){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),V&&(this._onParsedObserver=this.onParsedObservable.add(V))}set onMeshLoaded(V){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),V&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(V))}set onSkinLoaded(V){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),V&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>V(O.node,O.skinnedNode))))}set onTextureLoaded(V){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),V&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(V))}set onMaterialLoaded(V){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),V&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(V))}set onCameraLoaded(V){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),V&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(V))}set onComplete(V){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(V)}set onError(V){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(V)}set onDispose(V){this._onDisposeObserver&&this.Xi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xi.add(V)}set onExtensionLoaded(V){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(V)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(V){this._loggingEnabled!==V&&(this._loggingEnabled=V,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(V){this._capturePerformanceCounters!==V&&(this._capturePerformanceCounters=V,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(V){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(V)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const V of this._requests)V.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=V=>Promise.resolve(V),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Xi.notifyObservers(void 0),this.Xi.clear()}loadFile(V,O,Z,r,Y,m,a,i){if(ArrayBuffer.isView(O))return this._loadBinary(V,O,Z,r,a,i),null;this._progressCallback=Y;const M=O.name||p.e.GetFilename(O);if(m){if(this.useRangeRequests){this.validate&&R.b.Warn("glTF validation is not supported when range requests are enabled");const Z={abort:()=>{},onCompleteObservable:new d.e},p={readAsync:(Z,d)=>new Promise(((p,r)=>{this._loadFile(V,O,(V=>{p(new Uint8Array(V))}),!0,(V=>{r(V)}),(V=>{V.setRequestHeader("Range",`bytes=${Z}-${Z+d-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new S(p)).then((V=>{Z.onCompleteObservable.notifyObservers(Z),r(V)}),a?V=>a(void 0,V):void 0),Z}return this._loadFile(V,O,(O=>{this._validate(V,new Uint8Array(O,0,O.byteLength),Z,M),this._unpackBinaryAsync(new S({readAsync:(V,Z)=>I(O,V,Z),byteLength:O.byteLength})).then((V=>{r(V)}),a?V=>a(void 0,V):void 0)}),!0,a)}return this._loadFile(V,O,(O=>{try{this._validate(V,O,Z,M),r({json:this._parseJson(O)})}catch{a&&a()}}),!1,a)}_loadBinary(V,O,Z,d,p,r){this._validate(V,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),Z,r),this._unpackBinaryAsync(new S({readAsync:(V,Z)=>function(V,O,Z){try{if(O<0||O>=V.byteLength)throw new RangeError("Offset is out of range.");if(O+Z>V.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(V.buffer,V.byteOffset+O,Z))}catch(d){return Promise.reject(d)}}(O,V,Z),byteLength:O.byteLength})).then((V=>{d(V)}),p?V=>p(void 0,V):void 0)}importMeshAsync(V,O,Z,d,p,r){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(Z),this._loader.importMeshAsync(V,O,null,Z,d,p,r))))}loadAsync(V,O,Z,d,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(V,O,Z,d,p))))}loadAssetContainerAsync(V,O,Z,d,p){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(O);const r=new U(V),Y=[];this.onMaterialLoadedObservable.add((V=>{Y.push(V)}));const m=[];this.onTextureLoadedObservable.add((V=>{m.push(V)}));const a=[];this.onCameraLoadedObservable.add((V=>{a.push(V)}));const R=[];return this.onMeshLoadedObservable.add((V=>{V.morphTargetManager&&R.push(V.morphTargetManager)})),this._loader.importMeshAsync(null,V,r,O,Z,d,p).then((V=>(Array.prototype.push.apply(r.geometries,V.geometries),Array.prototype.push.apply(r.meshes,V.meshes),Array.prototype.push.apply(r.bj,V.bj),Array.prototype.push.apply(r.skeletons,V.skeletons),Array.prototype.push.apply(r.animationGroups,V.animationGroups),Array.prototype.push.apply(r.materials,Y),Array.prototype.push.apply(r.textures,m),Array.prototype.push.apply(r.lights,V.lights),Array.prototype.push.apply(r.transformNodes,V.transformNodes),Array.prototype.push.apply(r.cameras,a),Array.prototype.push.apply(r.morphTargetManagers,R),r)))}))}canDirectLoad(V){return w.canDirectLoad(V)}directLoad(V,O){if(O.startsWith("base64,"+G)||O.startsWith(";base64,"+G)||O.startsWith("application/octet-stream;base64,"+G)||O.startsWith("model/gltf-binary;base64,"+G)){const Z=(0,A.b)(O);return this._validate(V,new Uint8Array(Z,0,Z.byteLength)),this._unpackBinaryAsync(new S({readAsync:(V,O)=>I(Z,V,O),byteLength:Z.byteLength}))}return this._validate(V,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(V){return new n(V[w.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((V,O)=>{this.onCompleteObservable.addOnce((()=>{V()})),this.onErrorObservable.addOnce((V=>{O(V)}))}))}_setState(V){this._state!==V&&(this._state=V,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(v[this._state]))}_loadFile(V,O,Z,d,p,r){const Y=V._loadFile(O,Z,(V=>{this._onProgress(V,Y)}),!0,d,p,r);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(V,O){if(!this._progressCallback)return;O._lengthComputable=V.lengthComputable,O._loaded=V.loaded,O._total=V.total;let Z=!0,d=0,p=0;for(const r of this._requests){if(void 0===r._lengthComputable||void 0===r._loaded||void 0===r._total)return;Z=Z&&r._lengthComputable,d+=r._loaded,p+=r._total}this._progressCallback({lengthComputable:Z,loaded:d,total:Z?p:0})}_validate(V,O){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),z.d.ValidateAsync(O,Z,d,(O=>this.preprocessUrlAsync(Z+O).then((O=>V._loadFileAsync(O,void 0,!0,!0).then((V=>new Uint8Array(V,0,V.byteLength))))))).then((V=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(V),this.onValidatedObservable.clear()}),(V=>{this._endPerformanceCounter("Validate JSON"),p.e.Warn(`Failed to validate: ${V.message}`),this.onValidatedObservable.clear()})))}_getLoader(V){const O=V.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const Z=n._parseVersion(O.version);if(!Z)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const V=n._parseVersion(O.minVersion);if(!V)throw new Error("Invalid minimum version: "+O.minVersion);if(n._compareVersion(V,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const d={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[Z.major];if(!d)throw new Error("Unsupported version: "+O.version);return d(this)}_parseJson(V){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${V.length}`);const O=JSON.parse(V);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(V){return this._startPerformanceCounter("Unpack Binary"),V.loadAsync(20).then((()=>{const O=V.readUint32();if(1179937895!==O)throw new l.e("Unexpected magic: "+O,l.d.GLTFLoaderUnexpectedMagicError);const Z=V.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Z}`);const d=V.readUint32();let p;switch(this.useRangeRequests||d===V.buffer.byteLength||R.b.Warn(`Length in header does not match actual data length: ${d} != ${V.buffer.byteLength}`),Z){case 1:p=this._unpackBinaryV1Async(V,d);break;case 2:p=this._unpackBinaryV2Async(V,d);break;default:throw new Error("Unsupported version: "+Z)}return this._endPerformanceCounter("Unpack Binary"),p}))}_unpackBinaryV1Async(V,O){const Z=V.readUint32(),d=V.readUint32();if(0!==d)throw new Error(`Unexpected content format: ${d}`);const p=O-V.byteOffset,r={json:this._parseJson(V.readString(Z)),bin:null};if(0!==p){const O=V.byteOffset;r.bin={readAsync:(Z,d)=>V.buffer.readAsync(O+Z,d),byteLength:p}}return Promise.resolve(r)}_unpackBinaryV2Async(V,O){const Z=1313821514,d=5130562,p=V.readUint32();if(V.readUint32()!==Z)throw new Error("First chunk format is not JSON");return V.byteOffset+p===O?V.loadAsync(p).then((()=>({json:this._parseJson(V.readString(p)),bin:null}))):V.loadAsync(p+8).then((()=>{const r={json:this._parseJson(V.readString(p)),bin:null},Y=()=>{const p=V.readUint32();switch(V.readUint32()){case Z:throw new Error("Unexpected JSON chunk");case d:{const O=V.byteOffset;r.bin={readAsync:(Z,d)=>V.buffer.readAsync(O+Z,d),byteLength:p},V.skipBytes(p);break}default:V.skipBytes(p)}return V.byteOffset!==O?V.loadAsync(8).then(Y):Promise.resolve(r)};return Y()}))}static _parseVersion(V){if("1.0"===V||"1.0.1"===V)return{major:1,minor:0};const O=(V+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(V,O){return V.major>O.major?1:V.major<O.major?-1:V.minor>O.minor?1:V.minor<O.minor?-1:0}_logOpen(V){this._log(V),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(V){const O=n._logSpaces.substring(0,2*this._logIndentLevel);R.b.Log(`${O}${V}`)}_logDisabled(V){}_startPerformanceCounterEnabled(V){p.e.StartPerformanceCounter(V)}_startPerformanceCounterDisabled(V){}_endPerformanceCounterEnabled(V){p.e.EndPerformanceCounter(V)}_endPerformanceCounterDisabled(V){}}n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",(0,r.h)(new n)},12196:(V,O,Z)=>{"use strict";Z.d(O,{d:()=>Y});var d=Z(10900);function p(V,O,Z,d){const p={externalResourceFunction:d};return Z&&(p.uri="file:"===O?Z:O+Z),ArrayBuffer.isView(V)?GLTFValidator.validateBytes(V,p):GLTFValidator.validateString(V,p)}function r(){const V=[];onmessage=O=>{const Z=O.data;switch(Z.id){case"init":importScripts(Z.url);break;case"validate":p(Z.data,Z.rootUrl,Z.fileName,(O=>new Promise(((Z,d)=>{const p=V.length;V.push({resolve:Z,reject:d}),postMessage({id:"getExternalResource",index:p,uri:O})})))).then((V=>{postMessage({id:"validate.resolve",value:V})}),(V=>{postMessage({id:"validate.reject",reason:V})}));break;case"getExternalResource.resolve":V[Z.index].resolve(Z.value);break;case"getExternalResource.reject":V[Z.index].reject(Z.reason)}}}class Y{static ValidateAsync(V,O,Z,Y){return"function"===typeof Worker?new Promise(((m,a)=>{const R=`${p}(${r})()`,i=URL.createObjectURL(new Blob([R],{type:"application/javascript"})),M=new Worker(i),c=V=>{M.removeEventListener("error",c),M.removeEventListener("message",W),a(V)},W=V=>{const O=V.data;switch(O.id){case"getExternalResource":Y(O.uri).then((V=>{M.postMessage({id:"getExternalResource.resolve",index:O.index,value:V},[V.buffer])}),(V=>{M.postMessage({id:"getExternalResource.reject",index:O.index,reason:V})}));break;case"validate.resolve":M.removeEventListener("error",c),M.removeEventListener("message",W),m(O.value),M.terminate();break;case"validate.reject":M.removeEventListener("error",c),M.removeEventListener("message",W),a(O.reason),M.terminate()}};if(M.addEventListener("error",c),M.addEventListener("message",W),M.postMessage({id:"init",url:d.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(V)){const d=V.slice();M.postMessage({id:"validate",data:d,rootUrl:O,fileName:Z},[d.buffer])}else M.postMessage({id:"validate",data:V,rootUrl:O,fileName:Z})})):(this._LoadScriptPromise||(this._LoadScriptPromise=d.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>p(V,O,Z,Y))))}}Y.Configuration={url:`${d.e._DefaultCdnUrl}/gltf_validator.js`}},12606:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>t});var d=Z(11210),p=Z(11216),r=Z(11283),Y=Z(11251),m=Z(11463),a=Z(11465),R=Z(11316),i=Z(11238),M=Z(11041),c=Z(10991);Z(11870),Z(11784),Z(11803),Z(11793),Z(11808),Z(11816),Z(11824);const W="imageProcessingCompatibility",F="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";c.d.IncludesShadersStore[W]=F;const Q="skyPixelShader",b="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";c.d.ShadersStore[Q]=b;Z(11881),Z(11829),Z(11831),Z(11844),Z(11839);const U="skyVertexShader",H="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";c.d.ShadersStore[U]=H;var S=Z(11486),z=Z(11456),G=Z(11448);class w extends m.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class t extends a.c{constructor(V,O){super(V,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.m.Zero(),this.up=Y.m.Up(),this.dithering=!1,this._cameraPosition=Y.m.Zero(),this._skyOrientation=new Y.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(V,O){const Z=O._drawWrapper;if(this.isFrozen&&Z.effect&&Z._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new w);const d=O.materialDefines,p=this.va();if(this._isReadyForSubMesh(O))return!0;if((0,G.G)(V,p,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,d),(0,G.z)(V,d,!0,!1),d.IMAGEPROCESSINGPOSTPROCESS!==p.imageProcessingConfiguration.applyByPostProcess&&d.markAsMiscDirty(),d.DITHER!==this.dithering&&d.markAsMiscDirty(),d.isDirty){d.markAsProcessed(),p.resetCachedMaterial();const V=new S.d;d.FOG&&V.addFallback(1,"FOG"),d.IMAGEPROCESSINGPOSTPROCESS=p.imageProcessingConfiguration.applyByPostProcess,d.DITHER=this.dithering;const Z=[R.e.PositionKind];d.VERTEXCOLOR&&Z.push(R.e.ColorKind);const r="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,z.c)(Y);const m=d.toString();O.setEffect(p.getEngine().createEffect(r,Z,Y,[],m,V,this.onCompiled,this.onError),d,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(d._renderId=p.getRenderId(),Z._wasPreviouslyReady=!0,!0)}bindForSubMesh(V,O,Z){const d=this.va(),p=Z.materialDefines;if(!p)return;const r=Z.effect;if(!r)return;this._activeEffect=r,this.bindOnlyWorldMatrix(V),this._activeEffect.setMatrix("viewProjection",d.getTransformMatrix()),this._mustRebind(d,r,Z)&&((0,z.g)(r,this,d),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,G.j)(p,r,d)),d.fogEnabled&&O.applyFog&&d.fogMode!==i.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",d.getViewMatrix()),(0,G.f)(d,O,this._activeEffect);const m=d.activeCamera;if(m){const V=m.getWorldMatrix();this._cameraPosition.x=V.m[12],this._cameraPosition.y=V.m[13],this._cameraPosition.z=V.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const V=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(V),this.sunPosition.y=this.distance*Math.sin(-V),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(V),Y.g.FromUnitVectorsToRef(Y.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,Z)}getAnimatables(){return[]}dispose(V){super.dispose(V)}clone(V){return r.b.Clone((()=>new t(V,this.va())),this)}serialize(){const V=super.serialize();return V.customType="BABYLON.SkyMaterial",V}getClassName(){return"SkyMaterial"}static Parse(V,O,Z){return r.b.Parse((()=>new t(V.name,O)),V,O,Z)}}(0,d.c)([(0,p.K)()],t.prototype,"luminance",void 0),(0,d.c)([(0,p.K)()],t.prototype,"turbidity",void 0),(0,d.c)([(0,p.K)()],t.prototype,"rayleigh",void 0),(0,d.c)([(0,p.K)()],t.prototype,"mieCoefficient",void 0),(0,d.c)([(0,p.K)()],t.prototype,"mieDirectionalG",void 0),(0,d.c)([(0,p.K)()],t.prototype,"distance",void 0),(0,d.c)([(0,p.K)()],t.prototype,"inclination",void 0),(0,d.c)([(0,p.K)()],t.prototype,"azimuth",void 0),(0,d.c)([(0,p.G)()],t.prototype,"sunPosition",void 0),(0,d.c)([(0,p.K)()],t.prototype,"useSunPosition",void 0),(0,d.c)([(0,p.G)()],t.prototype,"cameraOffset",void 0),(0,d.c)([(0,p.G)()],t.prototype,"up",void 0),(0,d.c)([(0,p.K)()],t.prototype,"dithering",void 0),(0,M.f)("BABYLON.SkyMaterial",t)},10729:(V,O,Z)=>{"use strict";function d(V,O){O.headers=V.headers||{},O.statusMessage=V.statusText,O.statusCode=V.status,O.data=V.response}function p(V,O,Z){return new Promise((function(p,r){Z=Z||{};var Y,m,a,R=new XMLHttpRequest,i=Z.body,M=Z.headers||{};for(Y in Z.timeout&&(R.timeout=Z.timeout),R.ontimeout=R.onerror=function(V){V.timeout="timeout"==V.type,r(V)},R.open(V,O.href||O),R.onload=function(){for(a=R.getAllResponseHeaders().trim().split(/[\r\n]+/),d(R,R);m=a.shift();)m=m.split(": "),R.headers[m.shift().toLowerCase()]=m.join(": ");if((m=R.headers["content-type"])&&~m.indexOf("application/json"))try{R.data=JSON.parse(R.data,Z.reviver)}catch(V){return d(R,V),r(V)}(R.status>=400?r:p)(R)},typeof FormData<"u"&&i instanceof FormData||i&&"object"==typeof i&&(M["content-type"]="application/json",i=JSON.stringify(i)),R.withCredentials=!!Z.withCredentials,M)R.setRequestHeader(Y,M[Y]);R.send(i)}))}Z.r(O),Z.d(O,{del:()=>a,get:()=>r,patch:()=>m,post:()=>Y,put:()=>R,send:()=>p});var r=p.bind(p,"GET"),Y=p.bind(p,"POST"),m=p.bind(p,"PATCH"),a=p.bind(p,"DELETE"),R=p.bind(p,"PUT")},12709:(V,O,Z)=>{"use strict";Z.d(O,{b:()=>M});const d=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6,r=1/3,Y=1/6,m=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20,R=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),i=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const M=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof V?V:function(V){let O=0,Z=0,d=0,p=1;const r=function(){let V=4022871197;return function(O){O=O.toString();for(let Z=0;Z<O.length;Z++){V+=O.charCodeAt(Z);let d=.02519603282416938*V;V=d>>>0,d-=V,d*=V,V=d>>>0,d-=V,V+=4294967296*d}return 2.3283064365386963e-10*(V>>>0)}}();O=r(" "),Z=r(" "),d=r(" "),O-=r(V),O<0&&(O+=1);Z-=r(V),Z<0&&(Z+=1);d-=r(V),d<0&&(d+=1);return function(){const V=2091639*O+2.3283064365386963e-10*p;return O=Z,Z=d,d=V-(p=0|V)}}(V);this.p=function(V){const O=new Uint8Array(256);for(let Z=0;Z<256;Z++)O[Z]=Z;for(let Z=0;Z<255;Z++){const d=Z+~~(V()*(256-Z)),p=O[Z];O[Z]=O[d],O[d]=p}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Z=0;Z<512;Z++)this.perm[Z]=this.p[255&Z],this.permMod12[Z]=this.perm[Z]%12}noise2D(V,O){const Z=this.permMod12,r=this.perm;let Y=0,m=0,a=0;const i=(V+O)*d,M=Math.floor(V+i),c=Math.floor(O+i),W=(M+c)*p,F=V-(M-W),Q=O-(c-W);let b,U;F>Q?(b=1,U=0):(b=0,U=1);const H=F-b+p,S=Q-U+p,z=F-1+2*p,G=Q-1+2*p,w=255&M,t=255&c;let C=.5-F*F-Q*Q;if(C>=0){const V=3*Z[w+r[t]];C*=C,Y=C*C*(R[V]*F+R[V+1]*Q)}let v=.5-H*H-S*S;if(v>=0){const V=3*Z[w+b+r[t+U]];v*=v,m=v*v*(R[V]*H+R[V+1]*S)}let A=.5-z*z-G*G;if(A>=0){const V=3*Z[w+1+r[t+1]];A*=A,a=A*A*(R[V]*z+R[V+1]*G)}return 70*(Y+m+a)}noise3D(V,O,Z){const d=this.permMod12,p=this.perm;let m,a,i,M;const c=(V+O+Z)*r,W=Math.floor(V+c),F=Math.floor(O+c),Q=Math.floor(Z+c),b=(W+F+Q)*Y,U=V-(W-b),H=O-(F-b),S=Z-(Q-b);let z,G,w,t,C,v;U>=H?H>=S?(z=1,G=0,w=0,t=1,C=1,v=0):U>=S?(z=1,G=0,w=0,t=1,C=0,v=1):(z=0,G=0,w=1,t=1,C=0,v=1):H<S?(z=0,G=0,w=1,t=0,C=1,v=1):U<S?(z=0,G=1,w=0,t=0,C=1,v=1):(z=0,G=1,w=0,t=1,C=1,v=0);const A=U-z+Y,l=H-G+Y,I=S-w+Y,g=U-t+2*Y,n=H-C+2*Y,e=S-v+2*Y,u=U-1+.5,k=H-1+.5,D=S-1+.5,X=255&W,o=255&F,E=255&Q;let L=.6-U*U-H*H-S*S;if(L<0)m=0;else{const V=3*d[X+p[o+p[E]]];L*=L,m=L*L*(R[V]*U+R[V+1]*H+R[V+2]*S)}let J=.6-A*A-l*l-I*I;if(J<0)a=0;else{const V=3*d[X+z+p[o+G+p[E+w]]];J*=J,a=J*J*(R[V]*A+R[V+1]*l+R[V+2]*I)}let N=.6-g*g-n*n-e*e;if(N<0)i=0;else{const V=3*d[X+t+p[o+C+p[E+v]]];N*=N,i=N*N*(R[V]*g+R[V+1]*n+R[V+2]*e)}let P=.6-u*u-k*k-D*D;if(P<0)M=0;else{const V=3*d[X+1+p[o+1+p[E+1]]];P*=P,M=P*P*(R[V]*u+R[V+1]*k+R[V+2]*D)}return 32*(m+a+i+M)}noise4D(V,O,Z,d){const p=this.perm;let r,Y,R,M,c;const W=(V+O+Z+d)*m,F=Math.floor(V+W),Q=Math.floor(O+W),b=Math.floor(Z+W),U=Math.floor(d+W),H=(F+Q+b+U)*a,S=V-(F-H),z=O-(Q-H),G=Z-(b-H),w=d-(U-H);let t=0,C=0,v=0,A=0;S>z?t++:C++,S>G?t++:v++,S>w?t++:A++,z>G?C++:v++,z>w?C++:A++,G>w?v++:A++;const l=t>=3?1:0,I=C>=3?1:0,g=v>=3?1:0,n=A>=3?1:0,e=t>=2?1:0,u=C>=2?1:0,k=v>=2?1:0,D=A>=2?1:0,X=t>=1?1:0,o=C>=1?1:0,E=v>=1?1:0,L=A>=1?1:0,J=S-l+a,N=z-I+a,P=G-g+a,f=w-n+a,q=S-e+2*a,K=z-u+2*a,s=G-k+2*a,h=w-D+2*a,x=S-X+3*a,y=z-o+3*a,T=G-E+3*a,B=w-L+3*a,j=S-1+4*a,VV=z-1+4*a,OV=G-1+4*a,ZV=w-1+4*a,dV=255&F,pV=255&Q,rV=255&b,YV=255&U;let mV=.6-S*S-z*z-G*G-w*w;if(mV<0)r=0;else{const V=p[dV+p[pV+p[rV+p[YV]]]]%32*4;mV*=mV,r=mV*mV*(i[V]*S+i[V+1]*z+i[V+2]*G+i[V+3]*w)}let aV=.6-J*J-N*N-P*P-f*f;if(aV<0)Y=0;else{const V=p[dV+l+p[pV+I+p[rV+g+p[YV+n]]]]%32*4;aV*=aV,Y=aV*aV*(i[V]*J+i[V+1]*N+i[V+2]*P+i[V+3]*f)}let RV=.6-q*q-K*K-s*s-h*h;if(RV<0)R=0;else{const V=p[dV+e+p[pV+u+p[rV+k+p[YV+D]]]]%32*4;RV*=RV,R=RV*RV*(i[V]*q+i[V+1]*K+i[V+2]*s+i[V+3]*h)}let iV=.6-x*x-y*y-T*T-B*B;if(iV<0)M=0;else{const V=p[dV+X+p[pV+o+p[rV+E+p[YV+L]]]]%32*4;iV*=iV,M=iV*iV*(i[V]*x+i[V+1]*y+i[V+2]*T+i[V+3]*B)}let MV=.6-j*j-VV*VV-OV*OV-ZV*ZV;if(MV<0)c=0;else{const V=p[dV+1+p[pV+1+p[rV+1+p[YV+1]]]]%32*4;MV*=MV,c=MV*MV*(i[V]*j+i[V+1]*VV+i[V+2]*OV+i[V+3]*ZV)}return 27*(r+Y+R+M+c)}}}}]);